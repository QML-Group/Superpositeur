#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { 0.027988506879646824 + -0.14410933408705287i, -0.0008798355501693084 + 0.057591327415099265i, 0.04801736653737891 + -0.16433324158276175i, 0.004914295607542071 + -0.026882773519304504i }, { -0.006981995045735755 + 0.03672744257355773i, 0.14463210669266516 + 0.0012623871895677268i, -0.07874003893586054 + -0.1150162236418136i, -0.08548162783896922 + -0.1342981736080131i }, { -0.0867014823051777 + -0.025857645161106495i, -0.08352880492027644 + -0.15867365079197632i, 0.09710798549556993 + 0.12173375372226375i, 0.14737195200665876 + 0.06150826904945989i }, { -0.01499951728188304 + -0.002139854329913451i, -0.13681594226758664 + 0.02944074323941542i, 0.053637866476244626 + 0.06537847089353058i, -0.011653050489700586 + -0.024141537663852155i } }), Matrix({ { 0.0003242793870392238 + 0.24198746817012548i, -0.0911450406680644 + -0.06899387364747755i, 0.054038407940288295 + 0.14280260503186984i, 0.031427311874237425 + 0.05056472657405504i }, { -0.013075369353066767 + 0.018230253759644044i, 0.026818709986706143 + -0.12431296521159166i, 0.14622594123249968 + -0.1026220644831542i, 0.08733331640669209 + 0.025895689301032674i }, { -0.11451151385987732 + -0.040359606275952635i, -0.003229039719544494 + 0.17259322997699675i, 0.05742603809360832 + 0.04097691052814128i, -0.08044039283048424 + -0.10595109871324875i }, { 0.016976530173530527 + -0.08013219628710226i, 0.15802331433148187 + -0.06766599270599943i, -0.13771272846079177 + 0.05073125053844665i, -0.03324549885853063 + 0.08027314269445142i } }), Matrix({ { 0.06504687825851763 + -0.06814343669892997i, 0.13586523679444337 + -0.20198686541417224i, -0.1367088549935777 + 0.2112936409675515i, 0.07818096049489785 + 0.15772113380151906i }, { 0.13826574777723394 + -0.0036443429937162743i, 0.10784495597606795 + 0.025116997852799472i, -0.04516475660834791 + 0.04278266966199301i, -0.25153033651557805 + -0.009857477388117084i }, { 0.024272773624819034 + -0.08455769544654917i, -0.16205103473387422 + -0.008801338562170592i, 0.017654352807801133 + -0.08783154007037144i, 0.03395449836359031 + 0.07122612587702117i }, { -0.1713963436579839 + 0.2708083180367881i, 0.25826966711253724 + 0.04811471377797316i, 0.07756606567651798 + -0.030944220621995578i, 0.04177295495542383 + -0.09741162688040815i } }), Matrix({ { -0.02421995881509742 + 0.08705731504765192i, -0.19200739834592961 + -0.027835952222541097i, -0.15472173462845537 + -0.04710135799493276i, 0.025497472338288425 + -0.0478208850677478i }, { -0.09020700383058153 + -0.10071579722916314i, 0.0033102180322219558 + -0.09049513851926295i, -0.1443142783374664 + -0.11528845552989095i, -0.05049984993924968 + 0.07616789581877137i }, { -0.06948832997128566 + -0.15708686088241147i, -0.03426680545208758 + -0.12836970631482547i, 0.05019473304454976 + -0.02286712514271641i, 0.028445392549910128 + -0.11957017305018121i }, { -0.0034294974538331075 + -0.03126473750813994i, 0.19792931416687135 + -0.028659132377537287i, 0.1573819961366426 + 0.1858002925703579i, 0.09011564643398402 + -0.07580927640087727i } }), Matrix({ { -0.028867420499005265 + 0.07282891406637385i, 0.018608465788888234 + -0.014371690786498277i, -0.04851900883220333 + 0.10173962707301112i, 0.0767306938762026 + -0.12166767760880248i }, { -0.11464015348117587 + -0.05051702737137172i, -0.12406586577204076 + -0.053956202048113425i, -0.07587885344146242 + -0.1401284556373325i, 0.01588350525149272 + 0.049892502819950536i }, { 0.01587324177762794 + 0.06096920898695263i, 0.08031457824047374 + -0.018066987431127394i, -0.059513826182595146 + -0.0032985742411939813i, 0.055301675829494114 + -0.01613576800431069i }, { 0.03633707429953836 + 0.06019418561090774i, 0.08316539977772566 + -0.05079619818796862i, -0.0124305787679087 + -0.15908985532111647i, 0.09465895137254488 + 0.05627713240393017i } }), Matrix({ { 0.1543208858139224 + -0.18950022148922843i, -0.19340594184080387 + -0.030708974833210407i, -0.029391973162072177 + -0.004713041413694582i, 0.10114182547732703 + -0.030913980674138253i }, { 0.013723769826636072 + 0.012270713122429874i, -0.04661037869279302 + 0.029529308881136317i, 0.20590442367376402 + -0.021999586397576282i, -0.07736288564044148 + 0.08469920815355056i }, { -0.11994815508802564 + 0.07999345809589152i, -0.038757603331833354 + 0.03333185459751108i, 0.09849551765960801 + -0.1303924893542096i, 0.02248667159638519 + 0.13972482601778252i }, { 0.020954701070255467 + -0.0787897133439474i, 0.17546214227440887 + 0.012156221608998449i, 0.06832100732514669 + 0.0713360551443332i, 0.003744361834452998 + -0.051877539565360585i } }), Matrix({ { -0.059434592992450574 + -0.037677725617489784i, 0.0685091701643622 + -0.014397134947388713i, 0.0639599772415559 + -0.034806523575452525i, 0.0024229732645827547 + -0.061739638772354624i }, { 0.003234637418073537 + -0.052316215283417164i, -0.009775006247097968 + 0.05162564321899745i, 0.04265556850368995 + -0.08863967239480944i, 0.060484517333517666 + 0.06595453794437828i }, { -0.06609993781468777 + 0.058512925868939816i, 0.003260426826949218 + 0.10108083767153027i, -0.0013474749345124852 + 0.005026424235491374i, 0.09662592310966024 + -0.21254194370476104i }, { -0.10512737375513581 + 0.06134561557360686i, 0.07994928846682452 + 0.010552670022173964i, 0.07503208350202202 + 0.002680659458560734i, 0.09219016608357901 + 0.07600705713939926i } }), Matrix({ { 0.09838177956327569 + -0.015824204552091544i, -0.009344059299064665 + -0.2015178959764971i, -0.09496910722450243 + 0.012791688933139311i, 0.008143343350642923 + 0.007373464541267739i }, { -0.02216803251682929 + 0.19990030169971074i, -0.08917920587869349 + -0.0633207813335362i, 0.07575120748470252 + 0.023023606829334384i, -0.04535706371183627 + 0.14414701930211504i }, { 0.07556597214505352 + 0.03395950077223144i, -0.03942444822086239 + 0.008696374560422007i, 0.010104599557845293 + 0.013723548891263806i, 0.11315878331908243 + -0.03782741429565147i }, { 0.009395924034158155 + -0.03641806408804627i, 0.0623748428443098 + 0.1001843760799952i, -0.07414399516590914 + 0.04746132879294453i, 0.1601499905635664 + -0.1301494299638847i } }), Matrix({ { 0.23897261471009615 + 0.01653161508280339i, -0.016386831989626875 + 0.013528937354400385i, 0.008890747492545729 + 0.014113644544594363i, 0.10087748675027362 + -0.22349417432327456i }, { 0.06572054339913629 + 0.15162139227344384i, -0.06141303299504361 + 0.04873677849974899i, 0.15892399925463965 + -0.11817961018543087i, -0.03374637618717788 + 0.07195808246327796i }, { -0.08028548002503974 + -0.0797105814382492i, -0.07578476369996806 + -0.08992109824322929i, 0.03825236990468 + 0.05380622299398543i, -0.19629840951289473 + -0.06263493268619559i }, { -0.01864683888922851 + -0.07692222724784857i, 0.11302603606636981 + -0.04522633356342232i, 0.13701538736655175 + -0.05099145494445998i, 0.15384697077400006 + -0.1193188181726214i } }), Matrix({ { -0.06316798190626575 + -0.04128686828615627i, 0.07657756118135602 + 0.03236298279321842i, 0.05120433359468584 + -0.048229854304573216i, -0.1572920641930847 + -0.07220887457782646i }, { -0.0036079632393918905 + -0.10607849789785419i, -0.02118025244648055 + -0.053381418337238654i, -0.08271280677741409 + 0.10929050030477447i, -0.05643275670748226 + -0.14294016782872104i }, { 0.1446614635819934 + -0.08351444743034887i, 0.005647807356578498 + 0.006096345336154882i, 0.04432112467386489 + -0.01762060238767927i, 0.06349738849872416 + 0.08561041307628581i }, { 0.016049902025822693 + -0.06195625962993302i, 0.06684063742259151 + -0.07564839743589524i, -0.07274365622563032 + 0.034686622358640555i, 0.06049504017490973 + 0.05680904088534037i } }), Matrix({ { -0.0032455158122689717 + -0.041700324397425464i, 0.06968443289869196 + -0.04621979209685104i, -0.01158159879307533 + -0.006854914539065824i, -0.003649282835093463 + 0.02462741000448438i }, { -0.12252785500490296 + 0.03960921567394439i, -0.11471829782805394 + 0.04053899462230358i, -0.04299963030273622 + 0.030496847076342655i, -0.020709806126031752 + -0.013793135364791962i }, { -0.05174818684812294 + -0.024869751936440095i, 0.17721391947626258 + 0.1568643614081206i, 0.10315905703565431 + 0.031056967067639607i, 0.1456633817054502 + 0.1591799722130559i }, { -0.0593017020652564 + -0.008729523965705267i, -0.018771915130102575 + -0.08881810706100231i, 0.03229763597694816 + -0.0862690046139756i, 0.02479394214159678 + -0.014671746498236708i } }), Matrix({ { 0.030387485102037284 + -0.033517558603407084i, -0.03166403122355105 + 0.1449770869370646i, 0.055848314499442636 + -0.05381181518050028i, -0.06078520532950916 + 0.07047323916752045i }, { 0.07279210361164473 + -0.06750880016479194i, 0.02128043409334637 + -0.015576932914227645i, -0.04177321563925447 + -0.10304602194679838i, 0.01483321447983558 + -0.04726449467118055i }, { 0.02663362893271497 + 0.06963183913047748i, 0.015396015631480535 + 0.061699981421723844i, -0.25098166631826063 + -0.009979936307424362i, 0.04782936259015872 + -0.00027264074348605564i }, { -0.15549726750876922 + 0.13749185027446037i, 0.014394207851900114 + -0.07552883465045072i, -0.140532178499995 + 0.052009231478021105i, -0.007294243012353701 + -0.008435894375980291i } }), Matrix({ { -0.031652619420134503 + 0.050285714389415384i, 0.05564832265626169 + 0.046659630763186494i, -0.05215280301554962 + 0.07404762015677756i, -0.017812060416181316 + -0.007943471439662389i }, { -0.16670607070401444 + -0.035579841347686304i, 0.05530657276412211 + -0.04041734078558549i, -0.12247453863266168 + -0.03303107003227951i, 0.08706967857591479 + 0.042276366210823424i }, { -0.029600088057918732 + -0.10465413291851855i, 0.07430192197382471 + -0.055998164329518096i, -0.00606341764653096 + -0.17027880462773273i, 0.061211626654089794 + -0.048779237169772435i }, { -0.10642818388911059 + 0.022312377209777797i, -0.004328566269441398 + -0.03854134201979126i, 0.10161723863151693 + 0.003649864799878218i, 0.18975900978838003 + -0.13219839706490136i } }), Matrix({ { -0.06737735599044604 + 0.07672896245272141i, 0.03493565853195237 + -0.04184911566055199i, 0.09571255390960502 + -0.02143848780687471i, 0.0558034805152907 + 0.08785499296009688i }, { 0.04003165799694849 + 0.035260188783469676i, -0.13496514704200563 + 0.006208939822545868i, 0.01675884110359363 + -0.11152069929543738i, -0.1014036932508153 + -0.0036382435289615787i }, { 0.008294975939356714 + 0.19142457944446467i, 0.08741912463718925 + -0.14569238292571923i, -0.02173321577143049 + -0.098767778884368i, 0.0718728674942831 + 0.0018304176276808548i }, { -0.04876959888974412 + 0.023268953341834486i, -0.01981054754568288 + -0.10130914609452818i, 0.046852336616329704 + -0.04915612121837246i, -0.051433192874364424 + 0.0040468171582730954i } }), Matrix({ { 0.11507488008174664 + 0.15147262752517704i, -0.10661298972497223 + -0.019877768945789225i, 0.004822033883749384 + 0.028957632556331634i, -0.035796196615555366 + 0.12887683272344727i }, { 0.09232078754434375 + -0.02031627279293476i, -0.03854726650540083 + 0.09602620654879669i, -0.06833661776563824 + -0.07533731784255898i, -0.07954154800332965 + 0.14509479409025122i }, { -0.0992537965551907 + 0.08884965293824755i, -0.17963218353705648 + 0.10195298776743254i, -0.006309101368927972 + 0.0313121859074954i, 0.08741924322613383 + -0.10498476696072913i }, { -0.07670866503369712 + 0.01065064680855901i, -0.025126045973908294 + -0.11226958059848319i, 0.14292440389738226 + -0.036150886428763344i, 0.062431435824095736 + -0.010859412978075855i } }), Matrix({ { -0.1033180270773498 + 0.14667226070273273i, -0.03375171583557759 + 0.11716656580438892i, -0.09307091107200807 + 0.03085723133980129i, 0.18056646705687543 + 0.012708161440245235i }, { -0.04451916783940556 + 0.1093844502132694i, 0.0956558190117197 + 0.04193287552730183i, 0.09827872033019434 + -0.041398050794811785i, -0.11211001506504562 + 0.04590872571295367i }, { 0.0732550536282181 + 0.0445896285669205i, 0.010131971826306372 + 0.04076111917127719i, 0.0747189581141202 + 0.004592346366086198i, 0.11466240421125923 + 0.03418415726154061i }, { -0.017900401398933678 + 0.12336356251870992i, -0.009329061683727744 + -0.03281499039526093i, -0.22007277772282424 + 0.08537489711214578i, -0.033435259548939195 + -0.04750546276196602i } }) }, { QubitIndex{ 6 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.07309643685999556 + 0.0037051764458801858i, -0.09392862114554035 + 0.0616902130909203i, -0.04317252086043845 + -0.013870533078940907i, -0.05101652935475635 + -0.08335311080896797i }, { 0.04018264713087969 + 0.10609557888239031i, 0.012999318731333464 + 0.0011165959641923266i, -0.08666752103758901 + 0.009445330518175199i, 0.18096562355851442 + 0.025978340286418773i }, { -0.11847108857733647 + 0.06787446645310584i, -0.13640879711132445 + -0.11563711013578588i, -0.13108431363766837 + 0.040448710570386535i, -0.016801961609778288 + -0.05657748667294162i }, { 0.02142240255752317 + 0.030537817957842633i, -0.05478908839173587 + -0.02685128028151637i, 0.12440287491190255 + 0.062372286527508154i, 0.15481355777613387 + 0.0017667941476664346i } }), Matrix({ { 0.014951390707061243 + 0.047734964420299085i, 0.06941395912032038 + 0.0021162952584302215i, 0.03909651694185534 + -0.01213395427992021i, -0.05475723695372343 + -0.09925668118717228i }, { -0.0164651365353322 + 0.050840304022774695i, -0.13101530796450864 + 0.04337829848644922i, -0.0059554670596675685 + -0.13203508569761582i, 0.12190324213165585 + -0.047992017902311876i }, { 0.04179857217552481 + -0.15541431565744826i, -0.09678683233767939 + -0.033806654473623986i, 0.06100164602113935 + 0.0870652411360626i, -0.07471910674390399 + -0.11214321056192533i }, { 0.011425537808017763 + -0.02530377309023921i, -0.021567307954561958 + -0.04361628109299193i, -0.01980253749746918 + 0.07099790751967772i, -0.026618730101044194 + -0.1466239009859741i } }), Matrix({ { -0.050556203549465564 + 0.058583445139829576i, 0.0741366379484566 + -0.014670292076516933i, -0.11038790172421964 + -0.036173057912828654i, 0.03722701321250046 + 0.0007894922349588628i }, { -0.0893947849432653 + -0.016438869913020886i, -0.013612509429862077 + 0.13579413917987607i, 0.024146480551430937 + -0.06615146594333458i, -0.04027020055616332 + 0.08723868366677105i }, { -0.0670163992860135 + 0.020138916601426887i, 0.029797687844101063 + -0.017727091975159648i, 0.19196511202032043 + -0.018569022391428942i, 0.11149252612503115 + -0.006992340071035652i }, { 0.08212549163695868 + 0.1128680292550482i, -0.05687122525162024 + -0.028581470666511902i, -0.00486166478167828 + 0.05022862920012399i, -0.048935320680770035 + -0.11639053187831705i } }), Matrix({ { 0.08809104321195069 + 0.040621351702015536i, 0.14484479031691186 + 0.14903565950392547i, -0.23056113184300767 + -0.0011145203015896427i, 0.1163892967867663 + -0.16448700068915104i }, { -0.059229265463208745 + 0.040309170625067926i, -0.015519766144828803 + 0.12602630915791022i, -0.029408440884570876 + -0.09705098023295586i, 0.013045454100772314 + -0.033052247550649755i }, { 0.07590906580894993 + 0.03929118524825285i, -0.0030775867191762955 + -0.07073736640220343i, 0.09181100207741442 + 0.07598327355347417i, -0.00987725227628937 + 0.1419048500409368i }, { -0.05452682714208746 + 0.037849881654296924i, -0.15620368584625122 + -0.003204183514632629i, 0.03409834750674596 + 0.05025617360172379i, 0.003591750793298864 + 0.1000705451819747i } }), Matrix({ { -0.20612917054262125 + 0.22465673457916663i, 0.08320634993889736 + 0.021394787468654156i, 0.003484076698241539 + -0.009615792209576583i, -0.1098023871700225 + 0.02176280062570523i }, { 0.000911381717797342 + -0.0007711511439964325i, 0.0017090002730447472 + 0.06752007124678547i, 0.07685210618821608 + 0.08112036368212011i, 0.04136916295195402 + 0.05293138405937777i }, { -0.05581257110586452 + 0.06159344055747599i, -0.08218458733608439 + -0.10635724222172212i, 0.038151761473509876 + 0.03931372958642412i, -0.045315038881106696 + -0.0032000672140814084i }, { -0.1089554266885782 + -0.05738842460021633i, -0.034491597121817326 + -0.055056945153448014i, -0.15081474137082254 + -0.10863617681428878i, -0.058174914263935784 + 0.18843738961668863i } }), Matrix({ { -0.09691107093200488 + 0.1620847737106215i, -0.014122382174801105 + -0.04130453230971439i, 0.08684395132568176 + -0.08192798474092784i, -0.1213554476121674 + 0.06265329093394127i }, { -0.022738691516537443 + 0.03862827133627632i, 0.08839458450672445 + 0.043777750684276i, -0.1316154103384571 + -0.06525286937810716i, -0.004565614900468597 + -0.09805608730543026i }, { -0.02994737995628306 + 0.1202818151350991i, 0.07198577316348954 + -0.060443324111718724i, 0.08023486122156918 + 0.1397634892518384i, 0.01197742639512168 + -0.02040747006071883i }, { -0.0024982315985017343 + -0.016933766095987113i, 0.06658473586221021 + -0.1285952821743428i, 0.17327020550115524 + 0.06551268276511768i, -0.011406329179604685 + 0.09659668383714148i } }), Matrix({ { -0.15474128502338613 + 0.13611549274462997i, 0.03262395482708089 + 0.06397856822338613i, -0.04761263071513855 + -0.04354290042129203i, -0.09212706664470591 + -0.029036354738719208i }, { -0.15092138860559198 + 0.0233931639838186i, -0.07672170001813042 + 0.13892643859150014i, 0.03630977030517576 + 0.08187098370437716i, -0.07212213198208915 + -0.1405199099857216i }, { 0.0059919651936491776 + 0.08275366646648152i, -0.04426299928461535 + 0.09833184065937164i, 0.005952892316006721 + 0.0328327160202706i, -0.07921762874946361 + 0.06301395610131588i }, { 0.0372221361272403 + -0.04280818970973555i, -0.055398645077487305 + 0.1297695184074858i, -0.05566928729946613 + -0.1339222442825038i, -0.045847230329068775 + -0.06302074290917223i } }), Matrix({ { -0.06726543138225133 + -0.08293603974666093i, -0.006901505145277912 + -0.0006997649214831553i, -0.026365183443201403 + 0.02373809405626227i, -0.14294714074966672 + -0.08188100706369232i }, { 0.019134699213575496 + 0.012090961653387963i, 0.2324266636941062 + -0.08564660756862738i, -0.006991827979108341 + -0.07420147969916614i, -0.04711404685174077 + -0.09678635877389939i }, { 0.09395918359522756 + -0.04239157416105665i, 0.06438537763824433 + 0.08254670786432904i, -0.013279905726866822 + 0.11392770469550526i, -0.020321972633096867 + -0.04900736406563631i }, { 0.00041371639993841665 + -0.036663781070944874i, 0.013911690249383624 + 0.03508335399614919i, -0.041531956767274475 + 0.09172346192243679i, -0.033117052295969944 + -0.07220090854123948i } }), Matrix({ { -0.09746517611616383 + 0.11553799660179641i, 0.10168210434488446 + 0.08226532955126453i, -0.06764481427083163 + -0.07974090193118598i, -0.06752080092348654 + 0.011405009161193079i }, { -0.027783509783414297 + 0.15669947719628818i, 0.05724609400325038 + 0.006656672088505126i, 0.07611136073197748 + -0.3053216808191134i, 0.08703060352108614 + 0.06302331615245638i }, { 0.09328952930187048 + -0.1317438449074095i, -0.11873315998066741 + 0.006427718629146164i, -0.006753226888047227 + 0.05231746490179902i, 0.10713883105362156 + 0.09362908636286019i }, { 0.038861339869819295 + 0.0018198191161780126i, 0.0025040373736813937 + 0.07657908960836958i, -0.024502507468959087 + -0.015578896050496576i, -0.05157463233834335 + -0.03487844798869664i } }), Matrix({ { 0.01539750788481037 + -0.050876880228735884i, -0.101761250340908 + -0.03954632371003321i, -0.05652452967555579 + -0.018732135461724763i, -0.22077130805472103 + 0.02716223473797217i }, { 0.12564367231903856 + 0.030642146493256535i, 0.04328043138965912 + 0.008801111977259489i, 0.04346231343713628 + -0.03540422091627147i, -0.11204539161656527 + 0.07788610920059395i }, { -0.011159924339664479 + 0.005991715715480044i, -0.05373786348110671 + -0.11741034670126876i, -0.07189337384739043 + -0.07231708019770716i, 0.045438323274014716 + 0.017012676581793056i }, { -0.015443758329985863 + -0.043106250642506665i, 0.1213722894670791 + -0.048708893001774126i, 0.1263105645335721 + 0.010207478405122275i, -0.015552706603046485 + 0.05205445895438378i } }), Matrix({ { 0.02267770852502255 + -0.1706715446864199i, 0.0837130230360811 + 0.1712053172260625i, 0.1739358883942317 + 0.06064185352781536i, 0.03841674029409607 + 0.056931635781888916i }, { -0.01624717396409052 + 0.012752437324849101i, 0.06893194674137686 + 0.05647396440536514i, -0.15458423466075394 + -0.1559343798723594i, -0.05056722958489263 + 0.022535682079932888i }, { 0.27415996080962163 + 0.016142193931063982i, 0.008478408690905109 + 0.22329199257382518i, 0.009986937129671901 + -0.01275811736281376i, -0.08283826911909743 + -0.07199640826873029i }, { 0.0680275988811542 + 0.0053571610579142654i, 0.005047776654242005 + -0.0009925607120037246i, 0.04346190108755906 + -0.17821431937494384i, -0.043048314364507054 + 0.08296180750740252i } }), Matrix({ { 0.11270713870817672 + -0.029456858232535823i, -0.09920324695256322 + 0.08645902606251235i, -0.1330206185064041 + 0.0011440819341028766i, 0.19693075637510948 + -0.12519046990290272i }, { -0.0018005914852321735 + 0.03825558601773532i, -0.08856785693032372 + -0.0855846375357454i, 0.110450909015317 + 0.2018699295810134i, 0.07736955082893192 + 0.08497322602483792i }, { 0.09789737767076742 + -0.03846326980772273i, -0.10259723526115454 + -0.1355028151312704i, -0.08711885133446431 + 6.567343652598198e-05i, -0.19232128173448604 + 0.05313942789971988i }, { -0.0628685747114724 + -0.18195005437542947i, -0.09372201553709365 + 0.07324544258960845i, 0.021817422922822696 + -0.1646387828640787i, -0.030254156847625675 + -0.12158371457815621i } }), Matrix({ { 0.11692088208377786 + 0.03000621226138047i, 0.07536263762384404 + -0.003012326568741787i, 0.06007234152022753 + 0.015287682930862613i, -0.03797881142809913 + -0.0455227953758219i }, { -0.07382252225615714 + -0.03229667852131655i, 0.05699765846123895 + 0.013112330129414408i, 0.026697334008249918 + 0.12790043705576917i, 0.0689603911477406 + 0.14453218247897123i }, { 0.02689160281594896 + -0.06219712559673955i, 0.06681561538155131 + -0.05443328589527788i, 0.09527259554338911 + -0.11809667325443701i, 0.012260728753536704 + -0.04808977627367023i }, { -0.12637480022825207 + 0.03686610186625326i, -0.14500438787792058 + 0.13665298333634618i, -0.10418193464523871 + 0.04809424853033888i, -0.10978288201464134 + 0.023690970318729607i } }), Matrix({ { -0.16610469803384895 + 0.06639908174834816i, 0.09596617772768148 + -0.06971529290495408i, -0.04760781202289287 + -0.04701980052640136i, 0.13780936911400365 + 0.16619164787140545i }, { 0.02241513340032694 + -0.028355764106583643i, 0.0839842500860267 + -0.05251409635219233i, 0.017558118003909474 + -0.0392375811405444i, 0.06253806824241286 + 0.12249512564817129i }, { 0.02178342410595808 + -0.0990940745952503i, 0.028559254888703665 + 0.0954281506214689i, 0.10694682690442753 + -0.13773898210439536i, -0.1464515322656115 + 0.017764120159185614i }, { 0.05676444806367057 + 0.11042611057761492i, -0.12229887576997292 + -0.134472482016258i, -0.07167246650160813 + -0.1258537532602808i, -0.19690152631737415 + 0.048889329165172156i } }), Matrix({ { -0.07755505491406725 + -0.012294336129151893i, -0.18170858143659566 + 0.1440325613411935i, 0.010728171893614304 + 0.05395705811404082i, 0.02692423880630717 + 0.007550021365348785i }, { -0.027439598286665715 + 0.11358160494270152i, 0.0050323875885584825 + 0.1877276642963127i, 0.15285528899884043 + 0.0505013477736902i, -0.0024015330367593915 + 0.03674421128928551i }, { 0.09322427437263969 + -0.28704586786259756i, 0.10695344600216716 + -0.01138428583057145i, -0.031499863172692474 + -0.020299473296946143i, 0.19547649287212318 + 0.10477719451223426i }, { 0.09813659723837624 + -0.04570891276961238i, -0.03566247377016419 + -0.04080848878208186i, 0.003282397293087909 + -0.07239281901000516i, -0.16292288694326593 + 0.0824767875141544i } }), Matrix({ { -0.13348969448448875 + 0.07250501096324581i, 0.026154264830323695 + 0.20740608235202015i, -0.10846064044724442 + 0.0607128945911087i, 0.060524320000103334 + 0.06468345485225596i }, { -0.03785267161208602 + 0.014486255661772912i, 0.1416469609336348 + -0.03838150738954962i, 0.040999409689257915 + 0.03435399215447086i, 0.09926554562634576 + -0.040410923986358295i }, { 0.24382461351536108 + -0.0756957526027152i, -0.00025856456028213153 + 0.1757370526507611i, -0.036658796773414146 + -0.16047321967096054i, -0.05310308525104284 + -0.005766641606312842i }, { 0.09759465524501729 + 0.041933074500274996i, -0.060333077891920946 + 0.029655384442234117i, -0.0008279877607066496 + -0.040465452240826635i, -0.08130154962679079 + 0.04020942143005613i } }) }, { QubitIndex{ 9 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.19721561138705734 + 0.06557105277924091i, 0.3627139960369989 + 0.28041950614178274i }, { 0.2074510160989776 + 0.3822216118487847i, 0.3513761393554864 + -0.13784784356154542i } }), Matrix({ { 0.0407579910116783 + -0.055189270950627436i, 0.1708172819931217 + 0.3241275506525387i }, { 0.10637073470771581 + 0.3883675731442677i, -0.06273974195621752 + 0.10254237617851963i } }), Matrix({ { -0.27397330570055745 + -0.22015216858490133i, 0.00783253658603722 + -0.007945978095588058i }, { -0.20175935045946736 + -0.4702323158677695i, 0.08613208700127278 + -0.4070413855363401i } }), Matrix({ { -0.16500244213756096 + 0.303629663294564i, -0.24185946307508777 + -0.23137560541899627i }, { 0.04746376648491302 + 0.306272390300352i, 0.10688290735699534 + -0.44940768976917633i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 9 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 9 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.4039254096878048 + -0.4149510125573986i, 0.01553140142368429 + 0.20101612754091458i }, { -0.017647537954951182 + 0.09098727992394298i, -0.3564394817657862 + -0.48507078070514836i } }), Matrix({ { -0.5407862824094191 + -0.28924102840770055i, -0.26695011966384585 + -0.25316211443850917i }, { 0.07495182476615656 + 0.2172195104480884i, -0.30521021203502774 + 0.14139600657037682i } }), Matrix({ { -0.11236593016780536 + 0.11175989775588908i, 0.05787090313932912 + 0.09006406318458188i }, { 0.2748933826022137 + -0.275265641302905i, -0.4664276921729714 + 0.05676764383350364i } }), Matrix({ { -0.1496346234233907 + -0.00894556147295882i, -0.10724772776104619 + 0.1068050427149297i }, { -0.16565362213633109 + -0.028141502401057183i, -0.11679560911810796 + -0.28234811477087424i } }) }, { QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.2513503538429267 + -0.10569396868718273i, -0.031234341040437565 + 0.006944545735161318i }, { 0.393725476307563 + -0.017172644115480792i, 0.05937913302732519 + -0.02539167421047982i } }), Matrix({ { -0.2426969442966932 + 0.0038734157163878152i, -0.25379478001457795 + 0.7627853855930621i }, { 0.03304547307207341 + 0.3328120617890036i, -0.07672367725459228 + -0.1816546821530121i } }), Matrix({ { 0.08642297694727759 + 0.4838603217643259i, -0.19848806695690932 + 0.16371037594735974i }, { 0.13298314138733563 + -0.33890759470732024i, -0.22652208014253353 + 0.23376472287912578i } }), Matrix({ { 0.29974394030354573 + 0.25910587350180125i, -0.130163522074468 + 0.033453721587317554i }, { -0.01744262801866539 + -0.261046562999226i, 0.2395744329643442 + -0.24910417170412888i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.07523377957425548 + -0.1527183159300418i, -0.047638060164087656 + 0.0004673592856246078i, -0.005765235279570481 + 0.0341273975082366i, -0.045460929517634696 + 0.03509255740520239i }, { -0.00887803073441085 + 0.1753098300128703i, -0.00816529063393633 + -0.04800958699375197i, -0.06410628096736512 + -0.12043116552666985i, 0.08057167910309891 + -0.035074326517941075i }, { 0.08892178549507271 + -0.0754903668882941i, 0.011279864717753794 + -0.2477471188824902i, -0.054863170087756874 + -0.028356767971702578i, -0.08695660305406792 + -0.005115337464964211i }, { 0.0373872929016518 + 0.046531704735694374i, 0.12383337452276147 + 0.028509399634768687i, -0.057831840532032115 + -0.04478329473048412i, 0.10823434873425969 + 0.07561718805441005i } }), Matrix({ { 0.1695220387088618 + -0.038708995889385645i, -0.12679530680722215 + 0.10776634470984747i, -0.11821582738881185 + -0.0970174150100707i, 0.1724683024655329 + 0.14117798971831352i }, { -0.12267536064926354 + 0.023257815668978242i, -0.008978498355015239 + 0.11722220292522129i, -0.11996115400889888 + 0.1833572315809688i, -0.007396920564380051 + 0.021676662438880893i }, { -0.09479791007386815 + 0.03498757111929266i, -0.026180037061540637 + -0.16078241960202025i, 0.01402798498712363 + -0.017942243513373674i, -0.059032142011506965 + -0.02722391479050672i }, { 0.16313009823807645 + 0.06843737560517343i, -0.0907330621318149 + 0.05982039343480313i, 0.025510436732020428 + 0.1465025570679732i, -0.036716248795112275 + -0.03042424220361622i } }), Matrix({ { 0.045275356280399345 + -0.023504709119784886i, -0.11447925162169534 + -0.14605307656490438i, -0.0819884698563276 + -0.06510528300596873i, 0.017433009892390782 + -0.17498308397979576i }, { -0.014955292630555245 + 0.05712379681473322i, -0.0656505970603896 + -0.000806464648145936i, 0.10427766714143619 + 0.1981955076837536i, -0.047599246640777304 + -0.19138683053031677i }, { 0.08388243960413336 + -0.032186243030494374i, -0.0693976844960368 + 0.11803599891207733i, -0.10209785922021762 + -0.13348570636566617i, -0.01335420143810077 + -0.16376561019848856i }, { 0.0939591775757427 + 0.026764350826508174i, -0.0989789245549129 + 0.05555681086808223i, -0.0324627072038822 + 0.06412702827030017i, 0.03278644247241435 + -0.09975900962117223i } }), Matrix({ { -0.1526626240831259 + 0.004210671015371724i, -0.12085614537749609 + 0.030528169071296424i, -0.17236359908407745 + -0.09408547507901147i, -0.0969349643226808 + 0.07719905780375759i }, { -0.005581208545592363 + 0.031080171045875092i, 0.02778802220666364 + 0.008173395727577134i, -0.09171122786463785 + 0.10005320564598723i, 0.0013698603506889827 + 0.0647363944632933i }, { 0.021821762334851 + -0.20980737251684473i, 0.259146606457698 + 0.031660767499047705i, 0.12109054919841754 + -0.10375463646875037i, -0.019831813469074894 + -0.14510203594592475i }, { -0.037871817206660996 + 0.09738993582885286i, -0.06254976279967667 + 0.10099598134645131i, 0.005489168324080122 + 0.04176149311126778i, -0.024585870052089332 + 0.014874639154194048i } }), Matrix({ { 0.08019686662908358 + 0.0775891214981065i, -0.140242961620341 + 0.032893778971054395i, -0.049624446385284585 + 0.20689883210144527i, -0.04898334136631432 + -0.1249352652756547i }, { 0.11039841274931245 + -0.08463791173523649i, -0.04197695033505797 + -0.07539663250127845i, -0.0221556332654157 + -0.04914744726577806i, 0.08062326445275747 + 0.07566826379742042i }, { -0.023456194184260433 + -0.06024712148291704i, 0.10577002037497792 + 0.06954652738568325i, 0.029364368032671666 + 0.021875175842394227i, 0.0017354281096872608 + -0.11875184046313485i }, { -0.054920150704749954 + 0.02161524060632857i, 0.05352134756097648 + -0.03835311151921721i, 0.1392910779448034 + -0.014653920272048081i, 0.038238878744169195 + 0.1023973286938807i } }), Matrix({ { 0.022161346467836327 + -0.007492236541232909i, -0.007065414874416643 + 0.00612051265502767i, 0.006480305816989565 + 0.0036343739346445295i, -0.03497715410058827 + -0.08109520310842241i }, { 0.018309677155496144 + -0.13195748216157036i, 0.06246273861911454 + -0.15521498678898885i, 0.05647452790963645 + -0.0382426729905537i, 0.02962426517803706 + -0.02440278466536953i }, { 0.005946612324892591 + -0.03216173835869964i, -0.18283873528132322 + 0.08442610980766013i, 0.227399652929375 + -0.06561652121871185i, 0.09965346347804657 + -0.04194085709137909i }, { -0.07864843695456472 + 0.04739275542131225i, 0.08573632842001355 + 0.16850866272795476i, 0.02933030820362313 + -0.13775876419227998i, 0.07426518742967712 + -0.02014140778304602i } }), Matrix({ { 0.0015330750741886917 + -0.08109871635957432i, 0.06536569039357705 + -0.019468980854706906i, -0.0943431651117167 + 0.037609352055170304i, 0.17676235601091086 + -0.00712867768988024i }, { 0.053452045032710636 + 0.10469498086652479i, 0.11579242729691619 + 0.10686480386125521i, -0.07183634676444657 + 0.010656373942513397i, 0.002329844833031854 + 0.009308876084214018i }, { -0.05330930625821663 + 0.13415672771658269i, -0.005916765202703687 + 0.17767370550878442i, -0.08467989407071042 + 0.09495181814233873i, -0.08977759332226994 + -0.08696349954143341i }, { 0.06264916540329321 + -0.020557127335613237i, -0.02514740877769567 + -0.04555370654513899i, 0.008753829894186644 + -0.10344897566907903i, -0.09905578510284316 + 0.06059657653493311i } }), Matrix({ { 0.013706536022740459 + 0.07932324584518022i, -0.10295705722706948 + -0.015469541422674715i, 0.15166714897739714 + -0.1310463523174454i, 0.0057630513217829926 + 0.024637684198596858i }, { 0.006611747486661974 + 0.12605600166353997i, -0.044698099666848574 + -0.07411827576141107i, 0.0384279135842216 + 0.15724163007726444i, 0.019945332053118634 + -0.0831412104073574i }, { 0.013050639818152195 + 0.13919613577048873i, -0.06919750954368405 + -0.18397634763229695i, 0.027802884134448425 + 0.114338049286112i, -0.013613289670396723 + 0.041463785630173174i }, { 0.1718763894144388 + 0.07292451394616702i, -0.17160869946745633 + -0.014115927214902067i, -0.07283736926752202 + -0.01443337020538842i, 0.04049701053822413 + 0.1427371905913651i } }), Matrix({ { -0.0783799019424061 + -0.11905419022682948i, 0.0753930360467097 + 0.0036113247162781357i, -0.03452328140736259 + 0.09145311209229748i, 0.055046136237582054 + 0.07490169942614007i }, { 0.1434427840358603 + -0.05122789719167814i, -0.09390814554742992 + 0.034769575076804705i, 0.19242801006771204 + 0.018122439983757857i, -0.09576589548079274 + -0.044941447257702924i }, { 0.030812204299120204 + -0.11297290985613022i, -0.10596896075626615 + -0.1371766429723795i, 0.0337802305166398 + -0.027773001113651313i, -0.07778451370461961 + 0.16564101007777235i }, { 0.03892706858051347 + -0.040882220431934964i, 0.003754007572695447 + -0.10923079232119617i, -0.004247497003990116 + -0.00815505619828078i, 0.08802155796961865 + 0.05111113714378339i } }), Matrix({ { -0.031183074894298494 + 0.0023257969781271056i, -0.12663177319325697 + 0.07196979597103362i, 0.047953941161888114 + 0.007342060156311582i, 0.05059511858749614 + -0.09354729670097951i }, { 0.004967481544235538 + 0.0972618512775402i, -0.0353093017762142 + -0.0580028871626538i, 0.17022737277109157 + -0.131077466245567i, -0.013081951339902531 + -0.20120953565396468i }, { 0.05678134956317631 + -0.08844910793258483i, -0.06347218949727605 + -0.1858035177771519i, -0.006618422087673705 + -0.005197187473219424i, 0.08160682238697228 + -0.28642713588933194i }, { -0.11919016958017355 + 0.040977074818613825i, -0.04097183040838319 + 0.06719452962101057i, 0.12865937803903874 + 0.04720056753345258i, 0.07763756790716707 + -0.05046647832608803i } }), Matrix({ { -0.06866271960480157 + -0.15378385685520696i, -0.11300696260526935 + -3.0272272319280807e-05i, -0.03888347777125454 + 0.11223244104631304i, -0.08339641775075034 + 0.058193313735518344i }, { 0.011293024861208 + -0.01106494018591931i, -0.017150823294090577 + 0.023117480410506142i, -0.10376178616910908 + -0.0036133315289908698i, -0.0282722689931969 + 0.09612210319693297i }, { 0.07660610011167523 + 0.05064112710520333i, -0.03535605041325011 + 0.08909333283915355i, 0.04437038313055666 + 0.024055798597059894i, -0.14447461790179028 + 0.12745305324029585i }, { 0.08413816939142482 + -0.07869469694174176i, 0.08996621370023923 + -0.047892372539701224i, 0.01814848646722399 + -0.040877943099846305i, 0.07568688793380339 + -0.08237626897331653i } }), Matrix({ { 0.05238584294756769 + 0.1428201256948883i, -0.03703490161743968 + 0.033654756917275194i, 0.03946061314789036 + -0.01445743587842514i, 0.06382586503474497 + -0.11769968727192696i }, { 0.06061091464683302 + 0.00012286225438101067i, 0.04560588661296552 + 0.07516264985620519i, 0.02053572796315474 + -0.0033104189464297066i, -0.15621867318803828 + 0.024707589317018965i }, { 0.06603011108894125 + -0.15700421134679324i, 0.04436635856552735 + -0.03883988124015803i, -0.10237509353618328 + 0.005867723513807544i, 0.10102126070730706 + -0.07425492966399798i }, { 0.11648686207212168 + -0.1447121404974022i, 0.04357307758701425 + -0.019588917843089245i, -0.017962143002018097 + 0.16907465859308282i, 0.12517342282101954 + -0.01593504659665764i } }), Matrix({ { 0.008753018999315031 + -0.21861240063804763i, -0.034145427316571074 + 0.0024545383101070724i, 0.09786649972840601 + 0.08513505104791382i, -0.04926894193131117 + 0.1811484352052714i }, { -0.014620504236829215 + -0.13634589566339492i, 0.03795447653707216 + 0.03740424549752776i, 0.06534502563585115 + -0.06740345851891504i, 0.03730393945641123 + 0.14671037076289037i }, { -0.06185310755095146 + 0.04980899641467347i, 0.07033609885358034 + -0.0345506522217188i, -0.08393172992868629 + 0.05484373307382984i, -0.1039715465151968 + -0.006137206084568918i }, { 0.036601273014627234 + -0.009586280792688816i, -0.03807187611794291 + -0.04939891517570577i, 0.08304876565388498 + 0.03953627330452953i, -0.049146850671281 + 0.00383416334420806i } }), Matrix({ { 0.09372534527208837 + -0.02140852391435459i, 0.0003690935295609468 + -0.19387335089230226i, 0.14802893868416275 + 0.06319082815234227i, 0.046212193926426025 + -0.03806641918338569i }, { 0.10057809203049806 + -0.04915709747317127i, 0.016959852242057937 + 0.00018285519434778702i, -0.0706894228792725 + -0.25637942067360614i, 0.07339331281812293 + -0.07121853698997863i }, { -0.13032164371931135 + 0.06617466815939324i, 0.06033232263560574 + -0.023671276799688928i, -0.048592758326760306 + 0.08554132718820749i, -0.0919081300215271 + 0.1360157651985889i }, { -0.0410417172193137 + -0.0949917950862618i, 0.14857855811582885 + 0.06543164210714313i, 0.029998824526145603 + 0.12387550087417988i, -0.05995667269211874 + 0.0499569899025442i } }), Matrix({ { 0.0608971555709977 + -0.043326750542628016i, -0.02506787590939283 + 0.15969749453909513i, 0.03737219761188436 + 0.04425534647053561i, 0.1166287829536454 + -0.06480616706761688i }, { -0.037379559284779394 + -0.11061672825475281i, 0.053997963527292615 + 0.14579139067307487i, 0.012470452743280604 + 0.053108453854496786i, -0.06948346620558171 + -0.03150912825785358i }, { -0.03174479178163311 + -0.21088691347902916i, -0.12197814995341094 + 0.012093913690457724i, -0.06127097540962401 + 0.10105605766069302i, 0.06107323008988869 + -0.04017363591685448i }, { 0.03697139694476216 + -0.2341684214025586i, -0.0013820430747175803 + -0.018249333694382166i, 0.021067774828141515 + 0.057614008586873315i, -0.031020488323023614 + 0.037181340404239885i } }), Matrix({ { 0.05681662814947877 + -0.15833314191057873i, -0.03298187770676953 + -0.053301347732041676i, 0.09494218787581372 + -0.03101600364334849i, 0.014139346253052701 + 0.0174373733986383i }, { -0.0005541673995727546 + -0.014031920801004034i, 0.015328078886752769 + 0.017686122315356233i, 0.10834784838976114 + 0.025671040771374727i, 0.11274423581317893 + -0.13391581405643477i }, { -0.056374234643893746 + -0.013877748266631542i, -0.14860737357692086 + 0.02881372608261438i, 0.030128300940878306 + -0.01844682047862001i, 0.1946925217027607 + 0.07359410059922983i }, { 0.13893151875153345 + 0.06166759878993452i, 0.11110225019122284 + -0.011981489671735294i, -0.13505439653713514 + -0.01832244028005829i, 0.007226186123032853 + -0.013959162326914876i } }) }, { QubitIndex{ 7 }, QubitIndex{ 6 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 10_10_2_100_0_50) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false, false}), Matrix({ { 0.549876809146152 + -6.662443525747106e-20i, 0.08279691017963635 + -0.11210520866018683i }, { 0.08279691017963635 + 0.11210520866018683i, 0.450123190853848 + 2.6300373012246026e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.549876809146152, 1.0e-7), DoubleNear(0.450123190853848, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false, false}), Matrix({ { 0.5318370508682094 + 3.56812629030874e-20i, -0.13131099181348002 + 0.21096471813937093i }, { -0.13131099181348002 + -0.21096471813937093i, 0.4681629491317906 + 1.606980319619018e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5318370508682094, 1.0e-7), DoubleNear(0.4681629491317906, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false, false}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false, false}), Matrix({ { 0.7308442770360639 + 2.7592098256808834e-19i, 0.08820062165946918 + -0.0372478183546678i }, { 0.0882006216594692 + 0.03724781835466779i, 0.2691557229639361 + -7.954168770309914e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.7308442770360639, 1.0e-7), DoubleNear(0.2691557229639361, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false, false}), Matrix({ { 1.0 + 1.963792948649892e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(1.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false, false}), Matrix({ { 1.0 + 1.963792948649892e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(1.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false, false}), Matrix({ { 0.5374409566010994 + 5.336307567702092e-20i, 0.0021237218444732156 + 0.08041564053733216i }, { 0.0021237218444732147 + -0.08041564053733216i, 0.46255904339890064 + 1.4301621918796827e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5374409566010994, 1.0e-7), DoubleNear(0.46255904339890064, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false, false}), Matrix({ { 0.5558541290073047 + 3.9810548520952116e-20i, 0.0034515899114454726 + -0.08076808795479011i }, { 0.003451589911445471 + 0.08076808795479011i, 0.4441458709926954 + 1.5656874634403708e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5558541290073047, 1.0e-7), DoubleNear(0.4441458709926954, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true, false}), Matrix({ { 0.7590371757764252 + 1.173140631947206e-19i, -0.1706017398571967 + 0.1369276247596723i }, { -0.1706017398571967 + -0.1369276247596723i, 0.24096282422357498 + 7.90652316702686e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.7590371757764252, 1.0e-7), DoubleNear(0.24096282422357498, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, false, true}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false, false}), Matrix({ { 0.2924448605171107 + -7.358598729271734e-20i, 0.044034464530937824 + -0.059621703560799016i, -0.07220486918421289 + 0.11600460605289462i, 0.012778099352172011 + 0.03218787295548405i }, { 0.04403446453093782 + 0.059621703560799016i, 0.23939219035109868 + 1.0926725019580474e-19i, -0.03452238814173135 + 0.0027465806822315284i, -0.059106122629267135 + 0.09496011208647631i }, { -0.07220486918421289 + -0.11600460605289462i, -0.03452238814173135 + -0.0027465806822315284i, 0.2574319486290413 + 6.961552035246281e-21i, 0.038762445648698525 + -0.05248350509938782i }, { 0.01277809935217201 + -0.03218787295548405i, -0.059106122629267135 + -0.09496011208647631i, 0.03876244564869853 + 0.05248350509938782i, 0.2107310005027493 + 1.537364799266555e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2924448605171107, 1.0e-7), DoubleNear(0.23939219035109868, 1.0e-7), DoubleNear(0.2574319486290413, 1.0e-7), DoubleNear(0.2107310005027493, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false, false}), Matrix({ { 0.2597980095467409 + 1.3634583472834066e-19i, 0.039118711870557425 + -0.05296588178534646i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.039118711870557425 + 0.05296588178534646i, 0.21266783230273612 + 2.1980504981249094e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2900787995994111 + -2.0297026998581172e-19i, 0.043678198309078924 + -0.05913932687484037i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.043678198309078924 + 0.05913932687484037i, 0.23745535855111186 + 4.319868030996932e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2597980095467409, 1.0e-7), DoubleNear(0.21266783230273612, 1.0e-7), DoubleNear(0.2900787995994111, 1.0e-7), DoubleNear(0.23745535855111186, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false, false}), Matrix({ { 0.4018743190393172 + 6.755087754353045e-20i, 0.06051164796105625 + -0.08193145017523135i, 0.048499476402815905 + -0.0204817115045202i, 0.0031270645005403884 + -0.012971753365791826i }, { 0.06051164796105625 + 0.08193145017523133i, 0.3289699579967468 + 2.0837010502455788e-19i, 0.011478413398113929 + 0.006803744824394149i, 0.03970114525665329 + -0.016766106850147594i }, { 0.048499476402815905 + 0.0204817115045202i, 0.011478413398113929 + -0.006803744824394149i, 0.14800249010683483 + -1.3417531280100151e-19i, 0.0222852622185801 + -0.030173758484955494i }, { 0.0031270645005403884 + 0.012971753365791826i, 0.039701145256653296 + 0.016766106850147594i, 0.0222852622185801 + 0.030173758484955498i, 0.12115323285710124 + 5.463362509790237e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4018743190393172, 1.0e-7), DoubleNear(0.3289699579967468, 1.0e-7), DoubleNear(0.14800249010683483, 1.0e-7), DoubleNear(0.12115323285710124, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false, false}), Matrix({ { 0.549876809146152 + -6.662443525747106e-20i, 0.08279691017963635 + -0.11210520866018683i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08279691017963635 + 0.11210520866018683i, 0.450123190853848 + 2.6300373012246026e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.549876809146152, 1.0e-7), DoubleNear(0.450123190853848, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false, false}), Matrix({ { 0.549876809146152 + -6.662443525747106e-20i, 0.08279691017963635 + -0.11210520866018683i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08279691017963635 + 0.11210520866018683i, 0.450123190853848 + 2.6300373012246026e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.549876809146152, 1.0e-7), DoubleNear(0.450123190853848, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false, false}), Matrix({ { 0.2924049747924566 + -3.9810548520952116e-20i, 0.044223961568379586 + -0.05510421453229775i, -0.0033228067800786893 + 0.04862954191125857i, 0.01049327288531009 + 0.007647002075506533i }, { 0.0442239615683796 + 0.055104214532297746i, 0.2450359818086428 + 9.317362419797304e-20i, -0.01179734388520587 + 0.005438335057618487i, 0.005446528624551904 + 0.031786098626073594i }, { -0.0033228067800786885 + -0.04862954191125857i, -0.01179734388520587 + -0.005438335057618487i, 0.2574718343536955 + -2.6813886736518945e-20i, 0.03857294861125676 + -0.05700099412788909i }, { 0.010493272885310092 + -0.007647002075506533i, 0.005446528624551904 + -0.031786098626073594i, 0.038572948611256756 + 0.057000994127889074i, 0.2050872090452052 + 1.6983010592448722e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2924049747924566, 1.0e-7), DoubleNear(0.2450359818086428, 1.0e-7), DoubleNear(0.2574718343536955, 1.0e-7), DoubleNear(0.2050872090452052, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false, false}), Matrix({ { 0.3077187716887393 + -6.013933925505532e-20i, 0.04580403879361314 + -0.06795274872178797i, 0.0028476261992376375 + -0.04196069010807321i, -0.009865133841875267 + -0.006271365524346983i }, { 0.04580403879361314 + 0.06795274872178797i, 0.24813535731856529 + 9.994988777600744e-20i, 0.01002907869329759 + -0.006646520824568505i, 0.000603963712207834 + -0.0388073978467169i }, { 0.0028476261992376366 + 0.04196069010807321i, 0.01002907869329759 + 0.006646520824568505i, 0.24215803745741274 + -6.485096002415737e-21i, 0.03699287138602321 + -0.04415245993839887i }, { -0.009865133841875267 + 0.006271365524346983i, 0.0006039637122078334 + 0.0388073978467169i, 0.03699287138602321 + 0.044152459938398864i, 0.20198783353528268 + 1.6305384234645282e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.3077187716887393, 1.0e-7), DoubleNear(0.24813535731856529, 1.0e-7), DoubleNear(0.24215803745741274, 1.0e-7), DoubleNear(0.20198783353528268, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true, false}), Matrix({ { 0.41737694023924754 + -4.701032857261367e-20i, 0.06284593286576551 + -0.08509202097125504i, -0.09380994034745722 + 0.07529332538681024i, 0.0012250030135808276 + 0.030462527892819485i }, { 0.06284593286576551 + 0.08509202097125504i, 0.3416602355371775 + 1.6432439176733427e-19i, -0.02947559687647283 + -0.007788159396144411i, -0.07679179950973948 + 0.061634299372862064i }, { -0.09380994034745724 + -0.07529332538681024i, -0.029475596876472828 + 0.007788159396144411i, 0.13249986890690452 + -1.9614106684857392e-20i, 0.019950977313870837 + -0.027013187688931795i }, { 0.0012250030135808276 + -0.030462527892819485i, -0.07679179950973948 + -0.061634299372862064i, 0.019950977313870837 + 0.027013187688931795i, 0.10846295531667047 + 9.867933835512599e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.41737694023924754, 1.0e-7), DoubleNear(0.3416602355371775, 1.0e-7), DoubleNear(0.13249986890690452, 1.0e-7), DoubleNear(0.10846295531667047, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false, true}), Matrix({ { 0.2597980095467409 + 1.3634583472834066e-19i, 0.039118711870557425 + -0.05296588178534646i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.039118711870557425 + 0.05296588178534646i, 0.21266783230273612 + 2.1980504981249094e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2900787995994111 + -2.0297026998581172e-19i, 0.043678198309078924 + -0.05913932687484037i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.043678198309078924 + 0.05913932687484037i, 0.23745535855111186 + 4.319868030996932e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2597980095467409, 1.0e-7), DoubleNear(0.21266783230273612, 1.0e-7), DoubleNear(0.2900787995994111, 1.0e-7), DoubleNear(0.23745535855111186, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false, false}), Matrix({ { 0.25127483996519173 + 1.8285323748852209e-19i, -0.06203995829124563 + 0.09967362315625553i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.062039958291245624 + -0.09967362315625553i, 0.22119100188428534 + 1.732976470523095e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2805622109030177 + -1.4717197458543468e-19i, -0.06927103352223439 + 0.1112910949831154i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.06927103352223439 + -0.1112910949831154i, 0.24697194724750526 + -1.2599615090407718e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25127483996519173, 1.0e-7), DoubleNear(0.22119100188428534, 1.0e-7), DoubleNear(0.2805622109030177, 1.0e-7), DoubleNear(0.24697194724750526, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false, false}), Matrix({ { 0.38869006494276886 + 1.4081922748102743e-19i, -0.0959678868788113 + 0.15418235690868554i, 0.04690835850811481 + -0.01980976986502128i, -0.0037237356081714305 + 0.023498267259146985i }, { -0.0959678868788113 + -0.15418235690868554i, 0.34215421209329505 + 1.351017550870609e-19i, -0.019439686609169386 + -0.013716171317067438i, 0.04129226315135438 + -0.017438048489646515i }, { 0.04690835850811481 + 0.01980976986502128i, -0.019439686609169386 + 0.013716171317067438i, 0.14314698592544056 + -1.0513796457794003e-19i, -0.035343104934668704 + 0.05678236123068538i }, { -0.0037237356081714305 + -0.023498267259146985i, 0.04129226315135438 + 0.017438048489646515i, -0.035343104934668704 + -0.05678236123068538i, 0.12600873703849552 + 2.5596276874840888e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.38869006494276886, 1.0e-7), DoubleNear(0.34215421209329505, 1.0e-7), DoubleNear(0.14314698592544056, 1.0e-7), DoubleNear(0.12600873703849552, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false, false}), Matrix({ { 0.5318370508682094 + 3.56812629030874e-20i, -0.13131099181348002 + 0.21096471813937093i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13131099181348002 + -0.21096471813937093i, 0.4681629491317906 + 1.606980319619018e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5318370508682094, 1.0e-7), DoubleNear(0.4681629491317906, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false, false}), Matrix({ { 0.5318370508682094 + 3.56812629030874e-20i, -0.13131099181348002 + 0.21096471813937093i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13131099181348002 + -0.21096471813937093i, 0.4681629491317906 + 1.606980319619018e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5318370508682094, 1.0e-7), DoubleNear(0.4681629491317906, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false, false}), Matrix({ { 0.285831013374518 + 3.6422416731934915e-20i, -0.07057190505247583 + 0.11338107992590482i, 0.0011294739626290294 + 0.04276801710705276i, -0.01724373096168898 + -0.010111427135947659i }, { -0.07057190505247583 + -0.11338107992590482i, 0.25160994322658137 + 1.6940658945086007e-20i, 0.016685994918221515 + -0.01100748789659909i, 0.000994247881844187 + 0.037647623430279394i }, { 0.0011294739626290283 + -0.04276801710705276i, 0.016685994918221515 + 0.01100748789659909i, 0.24600603749369143 + -7.411538288475128e-22i, -0.060739086761004195 + 0.0975836382134661i }, { -0.01724373096168898 + 0.010111427135947657i, 0.0009942478818441868 + -0.03764762343027939i, -0.060739086761004195 + -0.0975836382134661i, 0.2165530059052092 + 1.4375737301681579e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.285831013374518, 1.0e-7), DoubleNear(0.25160994322658137, 1.0e-7), DoubleNear(0.24600603749369143, 1.0e-7), DoubleNear(0.2165530059052092, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false, false}), Matrix({ { 0.29562382068416215 + 5.675120746603812e-20i, -0.07298975698356724 + 0.11726560965263153i, 0.0018356833993096236 + -0.04295546170213972i, 0.01658598521543291 + 0.011333901429022667i }, { -0.07298975698356724 + -0.11726560965263154i, 0.26023030832314253 + -1.6940658945086007e-20i, -0.01749244860464352 + 0.00987757404342109i, 0.001615906512135848 + -0.03781262625265039i }, { 0.001835683399309623 + 0.04295546170213972i, -0.01749244860464352 + -0.00987757404342109i, 0.23621323018404733 + -2.106994456295072e-20i, -0.058321234829912784 + 0.09369910848673939i }, { 0.01658598521543291 + -0.011333901429022668i, 0.0016159065121358475 + 0.03781262625265039i, -0.058321234829912784 + -0.09369910848673939i, 0.2079326408086481 + 1.776386909069878e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.29562382068416215, 1.0e-7), DoubleNear(0.26023030832314253, 1.0e-7), DoubleNear(0.23621323018404733, 1.0e-7), DoubleNear(0.2079326408086481, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true, false}), Matrix({ { 0.4036840930642686 + -2.159934015498466e-20i, -0.09966992437450514 + 0.16013006384497766i, -0.09073232619863696 + 0.07282318413457294i, -0.00648501409716401 + -0.05397105017691638i }, { -0.09966992437450514 + -0.16013006384497766i, 0.3553530827121565 + 1.3891340334970526e-19i, 0.05128878142867162 + 0.018010845749203183i, -0.07986941365855975 + 0.06410444062509937i }, { -0.09073232619863696 + -0.07282318413457294i, 0.05128878142867162 + -0.01801084574920319i, 0.12815295780394084 + 5.728060305807206e-20i, -0.03164106743897488 + 0.050834654294393274i }, { -0.006485014097164009 + 0.05397105017691638i, -0.07986941365855976 + -0.06410444062509937i, -0.03164106743897488 + -0.050834654294393274i, 0.11280986641963413 + 2.1784628612196537e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4036840930642686, 1.0e-7), DoubleNear(0.3553530827121565, 1.0e-7), DoubleNear(0.12815295780394084, 1.0e-7), DoubleNear(0.11280986641963413, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false, true}), Matrix({ { 0.25127483996519173 + 1.8285323748852209e-19i, -0.06203995829124563 + 0.09967362315625553i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.062039958291245624 + -0.09967362315625553i, 0.22119100188428534 + 1.732976470523095e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2805622109030177 + -1.4717197458543468e-19i, -0.06927103352223439 + 0.1112910949831154i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.06927103352223439 + -0.1112910949831154i, 0.24697194724750526 + -1.2599615090407718e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.25127483996519173, 1.0e-7), DoubleNear(0.22119100188428534, 1.0e-7), DoubleNear(0.2805622109030177, 1.0e-7), DoubleNear(0.24697194724750526, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false, false}), Matrix({ { 0.35045607092521736 + 2.896852679609707e-19i, 0.0 + 0.0i, 0.040906399696023776 + -0.013161401089979975i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.3803882061108466 + -1.376428539288238e-20i, 0.0 + 0.0i, 0.04729422196344541 + -0.02408641726468782i }, { 0.040906399696023776 + 0.013161401089979973i, 0.0 + 0.0i, 0.1220097709242597 + 6.646561657986088e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.04729422196344542 + 0.02408641726468782i, 0.0 + 0.0i, 0.1471459520396764 + -1.4600730428296002e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.35045607092521736, 1.0e-7), DoubleNear(0.3803882061108466, 1.0e-7), DoubleNear(0.1220097709242597, 1.0e-7), DoubleNear(0.1471459520396764, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false, false}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false, false}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false, false}), Matrix({ { 0.25392249400492667 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0010033860291031632 + 0.037993643304335564i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.28351846259617275 + 3.6422416731934915e-20i, 0.0 + 0.0i, 0.0011203358153700524 + 0.04242199723299659i }, { 0.0010033860291031628 + -0.037993643304335564i, 0.0 + 0.0i, 0.21854334784455037 + 3.392102255957456e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.001120335815370052 + -0.04242199723299659i, 0.0 + 0.0i, 0.24401569555435026 + -1.9619400640777732e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.25392249400492667, 1.0e-7), DoubleNear(0.28351846259617275, 1.0e-7), DoubleNear(0.21854334784455037, 1.0e-7), DoubleNear(0.24401569555435026, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false, false}), Matrix({ { 0.262622089006944 + 1.5415999640028266e-19i, 0.0 + 0.0i, 0.001630758333230246 + -0.038160162670132516i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2932320400003606 + -1.1434944787933055e-19i, 0.0 + 0.0i, 0.0018208315782152263 + -0.042607925284657594i }, { 0.0016307583332302454 + 0.038160162670132516i, 0.0 + 0.0i, 0.2098437528425331 + 2.0199088814054893e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0018208315782152257 + 0.042607925284657594i, 0.0 + 0.0i, 0.23430211815016236 + -4.5422141796511856e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.262622089006944, 1.0e-7), DoubleNear(0.2932320400003606, 1.0e-7), DoubleNear(0.2098437528425331, 1.0e-7), DoubleNear(0.23430211815016236, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true, false}), Matrix({ { 0.3586191382482582 + 3.3034284942917713e-19i, 0.0 + 0.0i, -0.08060349464261593 + 0.06469362550452787i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4004180375281669 + -2.1302878623445654e-19i, 0.0 + 0.0i, -0.08999824521458077 + 0.07223399925514443i }, { -0.08060349464261593 + -0.06469362550452787i, 0.0 + 0.0i, 0.11384670360121893 + 2.5808035111654463e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.08999824521458077 + -0.07223399925514444i, 0.0 + 0.0i, 0.12711612062235605 + 5.3257196558614134e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3586191382482582, 1.0e-7), DoubleNear(0.4004180375281669, 1.0e-7), DoubleNear(0.11384670360121893, 1.0e-7), DoubleNear(0.12711612062235605, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false, true}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01573214966434088 + -0.024886883533309024i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01573214966434088 + 0.024886883533309024i, 0.0 + 0.0i, 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false, false}), Matrix({ { 0.7308442770360639 + 2.7592098256808834e-19i, 0.08820062165946918 + -0.0372478183546678i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0882006216594692 + 0.03724781835466779i, 0.2691557229639361 + -7.954168770309914e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.7308442770360639, 1.0e-7), DoubleNear(0.2691557229639361, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false, false}), Matrix({ { 0.7308442770360639 + 2.7592098256808834e-19i, 0.08820062165946918 + -0.0372478183546678i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0882006216594692 + 0.03724781835466779i, 0.2691557229639361 + -7.954168770309914e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.7308442770360639, 1.0e-7), DoubleNear(0.2691557229639361, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false, false}), Matrix({ { 0.3927856473767011 + 7.284483346386983e-20i, 0.04740262647747677 + -0.020018503127836648i, 0.0015521099560497245 + 0.05877131067089851i, 0.0031826207585231407 + 0.007013605481038328i }, { 0.04740262647747677 + 0.020018503127836648i, 0.1446553092243983 + -1.9481757786848908e-20i, -0.002807993584694476 + 0.007171813492035886i, 0.0005716118884234915 + 0.021644329866433644i }, { 0.0015521099560497236 + -0.05877131067089851i, -0.002807993584694476 + -0.007171813492035886i, 0.33805862965936284 + 2.030761491042185e-19i, 0.040797995181992425 + -0.017229315226831146i }, { 0.00318262075852314 + -0.007013605481038328i, 0.0005716118884234913 + -0.02164432986643364i, 0.040797995181992425 + 0.017229315226831146i, 0.12450041373953777 + -6.005992991625023e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3927856473767011, 1.0e-7), DoubleNear(0.1446553092243983, 1.0e-7), DoubleNear(0.33805862965936284, 1.0e-7), DoubleNear(0.12450041373953777, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false, false}), Matrix({ { 0.4062428090518545 + 1.8634724839594607e-20i, 0.049026679730427056 + -0.02070435362895616i, 0.0025225747334553386 + -0.0590288948489038i, -0.002704002693090811 + -0.0072523597619154985i }, { 0.049026679730427056 + 0.02070435362895616i, 0.14961131995545007 + 2.1175823681357508e-20i, 0.0033128674448968964 + -0.006995231373802849i, 0.0009290151779901334 + -0.02173919310588631i }, { 0.0025225747334553373 + 0.0590288948489038i, 0.003312867444896897 + 0.006995231373802849i, 0.3246014679842094 + 2.5728625772849373e-19i, 0.03917394192904214 + -0.016543464725711634i }, { -0.0027040026930908114 + 0.0072523597619154985i, 0.0009290151779901332 + 0.02173919310588631i, 0.039173941929042146 + 0.016543464725711634i, 0.11954440300848602 + -1.0071751138445665e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4062428090518545, 1.0e-7), DoubleNear(0.14961131995545007, 1.0e-7), DoubleNear(0.3246014679842094, 1.0e-7), DoubleNear(0.11954440300848602, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true, false}), Matrix({ { 0.5547379759738171 + 2.0879362149818503e-19i, 0.06694755076612847 + -0.02827247884776033i, -0.12468330522702757 + 0.10007277092374814i, -0.009946924216807405 + 0.018431644243348776i }, { 0.06694755076612849 + 0.028272478847760327i, 0.2042991998026079 + -9.147955830346444e-20i, -0.02014743480637618 + 0.005722559008966472i, -0.045918434630169126 + 0.036854853835924156i }, { -0.12468330522702759 + -0.10007277092374817i, -0.02014743480637618 + -0.005722559008966472i, 0.1761063010622468 + 6.71273610699033e-20i, 0.021253070893340713 + -0.008975339506907465i }, { -0.009946924216807405 + -0.018431644243348776i, -0.045918434630169126 + -0.036854853835924156i, 0.021253070893340713 + 0.008975339506907465i, 0.06485652316132817 + 1.1937870600365295e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5547379759738171, 1.0e-7), DoubleNear(0.2042991998026079, 1.0e-7), DoubleNear(0.1761063010622468, 1.0e-7), DoubleNear(0.06485652316132817, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false, true}), Matrix({ { 0.35045607092521736 + 2.896852679609707e-19i, 0.040906399696023776 + -0.013161401089979975i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.040906399696023776 + 0.013161401089979973i, 0.1220097709242597 + 6.646561657986088e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.3803882061108466 + -1.376428539288238e-20i, 0.04729422196344541 + -0.02408641726468782i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.04729422196344542 + 0.02408641726468782i, 0.1471459520396764 + -1.4600730428296002e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.35045607092521736, 1.0e-7), DoubleNear(0.1220097709242597, 1.0e-7), DoubleNear(0.3803882061108466, 1.0e-7), DoubleNear(0.1471459520396764, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false, false}), Matrix({ { 1.0 + 1.963792948649892e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(1.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false, false}), Matrix({ { 0.5374409566010994 + 5.336307567702092e-20i, 0.0 + 0.0i, 0.0021237218444732156 + 0.08041564053733216i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0021237218444732147 + -0.08041564053733216i, 0.0 + 0.0i, 0.46255904339890064 + 1.4301621918796827e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5374409566010994, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.46255904339890064, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false, false}), Matrix({ { 0.5558541290073047 + 3.9810548520952116e-20i, 0.0 + 0.0i, 0.0034515899114454726 + -0.08076808795479011i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003451589911445471 + 0.08076808795479011i, 0.0 + 0.0i, 0.4441458709926954 + 1.5656874634403708e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5558541290073047, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4441458709926954, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true, false}), Matrix({ { 0.7590371757764252 + 1.173140631947206e-19i, 0.0 + 0.0i, -0.1706017398571967 + 0.1369276247596723i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1706017398571967 + -0.1369276247596723i, 0.0 + 0.0i, 0.24096282422357498 + 7.90652316702686e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.7590371757764252, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24096282422357498, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false, true}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false, false}), Matrix({ { 0.5374409566010994 + 5.336307567702092e-20i, 0.0 + 0.0i, 0.0021237218444732156 + 0.08041564053733216i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0021237218444732147 + -0.08041564053733216i, 0.0 + 0.0i, 0.46255904339890064 + 1.4301621918796827e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5374409566010994, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.46255904339890064, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false, false}), Matrix({ { 0.5558541290073047 + 3.9810548520952116e-20i, 0.0 + 0.0i, 0.0034515899114454726 + -0.08076808795479011i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003451589911445471 + 0.08076808795479011i, 0.0 + 0.0i, 0.4441458709926954 + 1.5656874634403708e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5558541290073047, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4441458709926954, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true, false}), Matrix({ { 0.7590371757764252 + 1.173140631947206e-19i, 0.0 + 0.0i, -0.1706017398571967 + 0.1369276247596723i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1706017398571967 + -0.1369276247596723i, 0.0 + 0.0i, 0.24096282422357498 + 7.90652316702686e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.7590371757764252, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24096282422357498, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false, true}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false, false}), Matrix({ { 0.2633554021173884 + 9.063252535621014e-20i, 0.006053875064704253 + 0.050125980579625834i, -0.004588483539138984 + -0.0533832410478953i, -0.020919858491583333 + -0.0031846067201310264i }, { 0.006053875064704253 + -0.050125980579625834i, 0.29249872688991624 + -5.082197683525802e-20i, 0.024500184505227333 + 0.0015352791954027648i, 0.008040073450584457 + -0.027384846906894814i }, { -0.004588483539138985 + 0.0533832410478953i, 0.024500184505227333 + -0.0015352791954027657i, 0.2740855544837111 + -3.7269449679189215e-20i, -0.003930153220231037 + 0.030289659957706317i }, { -0.020919858491583336 + 0.0031846067201310264i, 0.008040073450584455 + 0.027384846906894814i, -0.003930153220231037 + -0.03028965995770632i, 0.1700603165089844 + 1.938381960232263e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2633554021173884, 1.0e-7), DoubleNear(0.29249872688991624, 1.0e-7), DoubleNear(0.2740855544837111, 1.0e-7), DoubleNear(0.1700603165089844, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true, false}), Matrix({ { 0.40793766584507873 + 9.317362419797304e-20i, 0.0016119838309636494 + 0.0610384606817088i, -0.0916883622666637 + 0.07359051363595467i, -0.011373433293944378 + -0.013428251999585835i }, { 0.0016119838309636486 + -0.0610384606817088i, 0.3510995099313463 + 2.414043899674756e-20i, 0.010648812010664645 + 0.014009844375213732i, -0.07891337759053302 + 0.06333711112371765i }, { -0.0916883622666637 + -0.07359051363595467i, 0.010648812010664647 + -0.014009844375213729i, 0.1295032907560207 + -3.9810548520952116e-20i, 0.0005117380135095664 + 0.019377179855623358i }, { -0.011373433293944378 + 0.013428251999585835i, -0.07891337759053302 + -0.06333711112371765i, 0.0005117380135095664 + -0.019377179855623358i, 0.11145953346755427 + 1.1887578019122071e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.40793766584507873, 1.0e-7), DoubleNear(0.3510995099313463, 1.0e-7), DoubleNear(0.1295032907560207, 1.0e-7), DoubleNear(0.11145953346755427, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false, true}), Matrix({ { 0.25392249400492667 + 1.6940658945086007e-20i, 0.0010033860291031632 + 0.037993643304335564i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010033860291031628 + -0.037993643304335564i, 0.21854334784455037 + 3.392102255957456e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.28351846259617275 + 3.6422416731934915e-20i, 0.0011203358153700524 + 0.04242199723299659i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.001120335815370052 + -0.04242199723299659i, 0.24401569555435026 + -1.9619400640777732e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.25392249400492667, 1.0e-7), DoubleNear(0.21854334784455037, 1.0e-7), DoubleNear(0.28351846259617275, 1.0e-7), DoubleNear(0.24401569555435026, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true, false}), Matrix({ { 0.4219139482253691 + 2.202285662861181e-20i, 0.002619885058321973 + -0.061305981374065774i, -0.09482968151545283 + 0.07611178559782668i, 0.010470535195863565 + 0.01425179433824496i }, { 0.0026198850583219716 + 0.061305981374065774i, 0.33712322755105595 + 9.529120656610879e-20i, -0.011648229684195852 + -0.01330655832180761i, -0.07577205834174386 + 0.060815839161845624i }, { -0.09482968151545283 + -0.07611178559782669i, -0.011648229684195852 + 0.013306558321807608i, 0.1339401807819355 + 1.7787691892340307e-20i, 0.0008317048531234996 + -0.019462106580724333i }, { 0.010470535195863565 + -0.01425179433824496i, -0.07577205834174386 + -0.06081583916184563i, 0.0008317048531234996 + 0.019462106580724333i, 0.10702264344163948 + 6.127753977792829e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.4219139482253691, 1.0e-7), DoubleNear(0.33712322755105595, 1.0e-7), DoubleNear(0.1339401807819355, 1.0e-7), DoubleNear(0.10702264344163948, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false, true}), Matrix({ { 0.262622089006944 + 1.5415999640028266e-19i, 0.001630758333230246 + -0.038160162670132516i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016307583332302454 + 0.038160162670132516i, 0.2098437528425331 + 2.0199088814054893e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2932320400003606 + -1.1434944787933055e-19i, 0.0018208315782152263 + -0.042607925284657594i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0018208315782152257 + 0.042607925284657594i, 0.23430211815016236 + -4.5422141796511856e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.262622089006944, 1.0e-7), DoubleNear(0.2098437528425331, 1.0e-7), DoubleNear(0.2932320400003606, 1.0e-7), DoubleNear(0.23430211815016236, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true, true}), Matrix({ { 0.3586191382482582 + 3.3034284942917713e-19i, -0.08060349464261593 + 0.06469362550452787i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08060349464261593 + -0.06469362550452787i, 0.11384670360121893 + 2.5808035111654463e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.4004180375281669 + -2.1302878623445654e-19i, -0.08999824521458077 + 0.07223399925514443i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.08999824521458077 + -0.07223399925514444i, 0.12711612062235605 + 5.3257196558614134e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3586191382482582, 1.0e-7), DoubleNear(0.11384670360121893, 1.0e-7), DoubleNear(0.4004180375281669, 1.0e-7), DoubleNear(0.12711612062235605, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false, false, false}), Matrix({ { 0.13817020721876963 + 7.697411908173454e-20i, 0.020804780355000475 + -0.028169218365352872i, -0.034114334304750506 + 0.05480821385719779i, 0.006037215467660206 + 0.015207670493256789i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020804780355000475 + 0.028169218365352872i, 0.1131046327464221 + 1.0587911840678754e-19i, -0.016310649176037507 + 0.00129766555423803i, -0.027925623986495125 + 0.04486540929905773i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.034114334304750506 + -0.05480821385719779i, -0.016310649176037507 + -0.0012976655542380302i, 0.12162780232797132 + 5.937171564660611e-20i, 0.01831393151555695 + -0.02479666341999359i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.006037215467660206 + -0.015207670493256789i, -0.027925623986495125 + -0.04486540929905773i, 0.01831393151555695 + 0.02479666341999359i, 0.09956319955631401 + 1.139259314057034e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1542746532983411 + -1.5056010637445189e-19i, 0.02322968417593735 + -0.03145248519544615i, -0.03809053487946238 + 0.06119639219569682i, 0.0067408838845118045 + 0.016980202462227263i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.023229684175937345 + 0.03145248519544615i, 0.12628755760467658 + 3.3881317890172014e-21i, -0.018211738965693842 + 0.0014489151279934987i, -0.031180498642772014 + 0.05009470278741857i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03809053487946238 + -0.06119639219569682i, -0.018211738965693842 + -0.0014489151279934985i, 0.13580414630107 + -5.2410163611359833e-20i, 0.020448514133141575 + -0.027686841679394232i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006740883884511804 + -0.016980202462227263i, -0.03118049864277201 + -0.05009470278741858i, 0.02044851413314158 + 0.027686841679394232i, 0.11116780094643527 + 3.9810548520952116e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.13817020721876963, 1.0e-7), DoubleNear(0.1131046327464221, 1.0e-7), DoubleNear(0.12162780232797132, 1.0e-7), DoubleNear(0.09956319955631401, 1.0e-7), DoubleNear(0.1542746532983411, 1.0e-7), DoubleNear(0.12628755760467658, 1.0e-7), DoubleNear(0.13580414630107, 1.0e-7), DoubleNear(0.11116780094643527, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false, false, false}), Matrix({ { 0.21373165265754035 + 5.2727800966580196e-20i, 0.032182336394783455 + -0.043574180834550676i, -0.052770515417419644 + 0.08478130244358117i, 0.00933880078293315 + 0.023524322739479415i, 0.02579381849872592 + -0.010892933043297498i, 0.0016630887618420702 + -0.006898859054652495i, -0.002047595854325212 + 0.01292115222092324i, 0.002325964351557026 + 0.002363034080982108i }, { 0.032182336394783455 + 0.043574180834550676i, 0.17495841228522852 + 8.809142651444724e-20i, -0.02523048980300203 + 0.0020073227730267214i, -0.04319737146139167 + 0.06940105446510436i, 0.0061046455302990535 + 0.0036184835822656272i, 0.021114540009388887 + -0.00891683682172378i, -0.0029425919569219926 + 0.0015281337662832566i, -0.0016761397538462184 + 0.010577115038223745i }, { -0.05277051541741964 + -0.08478130244358117i, -0.025230489803002028 + -0.0020073227730267214i, 0.18814266638177685 + 1.4823076576950256e-20i, 0.028329311566272795 + -0.038357269340680664i, -0.010689432843451238 + -0.007542204517531017i, -0.0031472002336183913 + 0.0010436335190618369i, 0.022705657904089974 + -0.0095887784612227i, 0.001463975738698318 + -0.006072894311139332i }, { 0.009338800782933148 + -0.02352432273947942i, -0.04319737146139167 + -0.06940105446510438i, 0.028329311566272795 + 0.038357269340680664i, 0.15401154571151826 + 1.2027867851011065e-19i, -7.189173858096237e-05 + -0.0033149467281573105i, -0.008750253765718145 + -0.006173966799536421i, 0.005373767867814874 + 0.0031852612421285212i, 0.018586605247264402 + -0.007849270028423814i }, { 0.02579381849872592 + 0.0108929330432975i, 0.0061046455302990535 + -0.003618483582265627i, -0.01068943284345124 + 0.007542204517531016i, -7.189173858096237e-05 + 0.0033149467281573105i, 0.0787132078595704 + -1.2631378825929754e-19i, 0.011852128136154369 + -0.01604752272624834i, -0.01943435376679325 + 0.03122330360931344i, 0.003439298569238861 + 0.008663550216004637i }, { 0.0016630887618420706 + 0.006898859054652495i, 0.021114540009388887 + 0.00891683682172378i, -0.0031472002336183913 + -0.0010436335190618369i, -0.008750253765718145 + 0.006173966799536421i, 0.011852128136154369 + 0.01604752272624834i, 0.06443377806587017 + 2.1175823681357508e-20i, -0.009291898338729315 + 0.0007392579092048075i, -0.01590875116787546 + 0.02555905762137193i }, { -0.002047595854325212 + -0.01292115222092324i, -0.002942591956921992 + -0.0015281337662832566i, 0.022705657904089974 + 0.009588778461222702i, 0.005373767867814874 + -0.0031852612421285212i, -0.01943435376679325 + -0.03122330360931344i, -0.009291898338729315 + -0.0007392579092048075i, 0.06928928224726447 + -7.861524541703975e-21i, 0.01043313408242573 + -0.014126235758707154i }, { 0.002325964351557026 + -0.0023630340809821086i, -0.0016761397538462186 + -0.010577115038223745i, 0.001463975738698318 + 0.006072894311139332i, 0.018586605247264402 + 0.007849270028423814i, 0.003439298569238861 + -0.008663550216004637i, -0.015908751167875462 + -0.025559057621371933i, 0.01043313408242573 + 0.014126235758707154i, 0.056719454791231055 + 3.3457801416544863e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21373165265754035, 1.0e-7), DoubleNear(0.17495841228522852, 1.0e-7), DoubleNear(0.18814266638177685, 1.0e-7), DoubleNear(0.15401154571151826, 1.0e-7), DoubleNear(0.0787132078595704, 1.0e-7), DoubleNear(0.06443377806587017, 1.0e-7), DoubleNear(0.06928928224726447, 1.0e-7), DoubleNear(0.056719454791231055, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false, false, false}), Matrix({ { 0.2924448605171107 + -7.358598729271734e-20i, 0.044034464530937824 + -0.059621703560799016i, -0.07220486918421289 + 0.11600460605289462i, 0.012778099352172011 + 0.03218787295548405i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04403446453093782 + 0.059621703560799016i, 0.23939219035109868 + 1.0926725019580474e-19i, -0.03452238814173135 + 0.0027465806822315284i, -0.059106122629267135 + 0.09496011208647631i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07220486918421289 + -0.11600460605289462i, -0.03452238814173135 + -0.0027465806822315284i, 0.2574319486290413 + 6.961552035246281e-21i, 0.038762445648698525 + -0.05248350509938782i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01277809935217201 + -0.03218787295548405i, -0.059106122629267135 + -0.09496011208647631i, 0.03876244564869853 + 0.05248350509938782i, 0.2107310005027493 + 1.537364799266555e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2924448605171107, 1.0e-7), DoubleNear(0.23939219035109868, 1.0e-7), DoubleNear(0.2574319486290413, 1.0e-7), DoubleNear(0.2107310005027493, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false, false, false}), Matrix({ { 0.2924448605171107 + -7.358598729271734e-20i, 0.044034464530937824 + -0.059621703560799016i, -0.07220486918421289 + 0.11600460605289462i, 0.012778099352172011 + 0.03218787295548405i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04403446453093782 + 0.059621703560799016i, 0.23939219035109868 + 1.0926725019580474e-19i, -0.03452238814173135 + 0.0027465806822315284i, -0.059106122629267135 + 0.09496011208647631i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07220486918421289 + -0.11600460605289462i, -0.03452238814173135 + -0.0027465806822315284i, 0.2574319486290413 + 6.961552035246281e-21i, 0.038762445648698525 + -0.05248350509938782i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01277809935217201 + -0.03218787295548405i, -0.059106122629267135 + -0.09496011208647631i, 0.03876244564869853 + 0.05248350509938782i, 0.2107310005027493 + 1.537364799266555e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2924448605171107, 1.0e-7), DoubleNear(0.23939219035109868, 1.0e-7), DoubleNear(0.2574319486290413, 1.0e-7), DoubleNear(0.2107310005027493, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false, false, false}), Matrix({ { 0.15551179945281324 + 1.1011428314305904e-20i, 0.023519941298236036 + -0.029306462947266368i, -0.038395987251193094 + 0.06168713308964046i, 0.005817952831632475 + 0.016565484650618367i, -0.001767191758521941 + 0.025862992155155744i, 0.005580711305278666 + 0.004066959031820472i, -0.0098227965486587 + -0.007086588375593448i, -0.0029911297074099855 + 0.0012095749296744435i }, { 0.023519941298236036 + 0.029306462947266368i, 0.1303192139217048 + 2.541098841762901e-20i, -0.01743213734256277 + 0.0020939065239407744i, -0.03217591780128274 + 0.051693946836264354i, -0.006274264579985994 + 0.00289230807867701i, 0.00289666572115097 + 0.01690502495189702i, 0.000401824103753133 + -0.00320293649776559i, -0.00742093441303028 + -0.0030248387603542095i }, { -0.0383959872511931 + -0.06168713308964046i, -0.01743213734256277 + -0.0020939065239407744i, 0.13689317533964335 + -5.082197683525802e-20i, 0.020704020270143557 + -0.02579775158503139i, 0.010695438656452077 + -0.005684598384011666i, 0.00023536556753085507 + -0.0032178457835434497i, -0.001555615021556748 + 0.022766549756102823i, 0.004912561580031426 + 0.0035800430436860623i }, { 0.005817952831632475 + -0.01656548465061837i, -0.03217591780128273 + -0.051693946836264354i, 0.020704020270143557 + 0.025797751585031392i, 0.11471676788693802 + 6.776263578034403e-20i, 0.0026964177489090203 + 0.0017747101573057848i, 0.0059905562617694405 + -0.005322889512587425i, -0.005523079305219877 + 0.002546026978941477i, 0.0025498629034009348 + 0.014881073674176569i }, { -0.001767191758521941 + -0.025862992155155744i, -0.006274264579985995 + -0.00289230807867701i, 0.010695438656452078 + 0.005684598384011667i, 0.0026964177489090203 + -0.0017747101573057848i, 0.13693306106429753 + -8.459741560702325e-20i, 0.020514523232701788 + -0.03031524061353265i, -0.033808881933019785 + 0.05431747296325415i, 0.0069601465205395355 + 0.015622388304865686i }, { 0.005580711305278666 + -0.004066959031820472i, 0.0028966657211509693 + -0.01690502495189702i, 0.00023536556753085501 + 0.00321784578354345i, 0.00599055626176944 + 0.005322889512587425i, 0.020514523232701785 + 0.03031524061353265i, 0.10907297642939388 + 8.385626177817573e-20i, -0.01709025079916858 + 0.0006526741582907545i, -0.026930204827984403 + 0.04326616525021195i }, { -0.0098227965486587 + 0.007086588375593448i, 0.0004018241037531331 + 0.00320293649776559i, -0.0015556150215567477 + -0.022766549756102823i, -0.0055230793052198765 + -0.0025460269789414768i, -0.033808881933019785 + -0.054317472963254156i, -0.01709025079916858 + -0.0006526741582907544i, 0.12053877328939794 + 5.77835288705043e-20i, 0.018058425378554968 + -0.026685753514356432i }, { -0.002991129707409986 + -0.0012095749296744435i, -0.00742093441303028 + 0.0030248387603542095i, 0.004912561580031427 + -0.0035800430436860623i, 0.0025498629034009348 + -0.014881073674176569i, 0.006960146520539535 + -0.015622388304865686i, -0.026930204827984403 + -0.04326616525021196i, 0.018058425378554968 + 0.02668575351435643i, 0.0960142326158113 + 8.597384414631148e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.15551179945281324, 1.0e-7), DoubleNear(0.1303192139217048, 1.0e-7), DoubleNear(0.13689317533964335, 1.0e-7), DoubleNear(0.11471676788693802, 1.0e-7), DoubleNear(0.13693306106429753, 1.0e-7), DoubleNear(0.10907297642939388, 1.0e-7), DoubleNear(0.12053877328939794, 1.0e-7), DoubleNear(0.0960142326158113, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true, false, false}), Matrix({ { 0.16365624403172696 + 8.470329472543003e-22i, 0.024360284909848266 + -0.036139789478584206i, -0.040406857110074176 + 0.0649178039355083i, 0.00832105871783504 + 0.01858597896484957i, 0.0015144731197775936 + -0.022316249679472502i, -0.005246643688883111 + -0.0033353445453852613i, 0.008478300541047208 + 0.00611064849375763i, 0.002618437369342198 + -0.001257695953331518i }, { 0.024360284909848266 + 0.036139789478584206i, 0.13196757665243514 + 5.590417451878382e-20i, -0.02035020624393995 + 0.0007400933026292412i, -0.03258289987349307 + 0.05234780571712322i, 0.0053338356351685864 + -0.003534866033872653i, 0.00032121027953203 + -0.02063921202266722i, 8.525312217020709e-05 + 0.002988543001312136i, 0.0081076846743857 + 0.005223252935265039i }, { -0.040406857110074176 + -0.0649178039355083i, -0.020350206243939947 + -0.0007400933026292412i, 0.14406252765701233 + -6.098637220230962e-20i, 0.02144375388376487 + -0.03181295924320377i, -0.009226149782119098 + 0.004909151176780717i, -2.763635104346121e-05 + 0.002904694407385253i, 0.001333153079460044 + -0.019644440428600703i, -0.0046184901529921565 + -0.0029360209789617217i }, { 0.00832105871783504 + -0.01858597896484957i, -0.03258289987349307 + -0.05234780571712322i, 0.02144375388376487 + 0.031812959243203764i, 0.11616778066613018 + 4.404571325722362e-20i, -0.0027191096625549006 + -0.0012430205181460572i, -0.008266298822524422 + 0.004968422866640372i, 0.004695243058129004 + -0.0031116547906958523i, 0.000282753432675804 + -0.018168185824049686i }, { 0.001514473119777593 + 0.022316249679472502i, 0.0053338356351685864 + 0.003534866033872653i, -0.009226149782119098 + -0.004909151176780716i, -0.0027191096625549006 + 0.001243020518146057i, 0.12878861648538376 + -7.443302023997164e-20i, 0.019674179621089555 + -0.023481914082214818i, -0.03179801207413871 + 0.051086802117386296i, 0.004457040634336969 + 0.013601893990634484i }, { -0.005246643688883111 + 0.003335344545385261i, 0.00032121027953202995 + 0.02063921202266722i, -2.7636351043461153e-05 + -0.0029046944073852525i, -0.008266298822524422 + -0.0049684228666403716i, 0.019674179621089555 + 0.023481914082214818i, 0.10742461369866355 + 5.336307567702092e-20i, -0.014172181897791397 + 0.0020064873796022875i, -0.026523222755774067 + 0.042612306369353085i }, { 0.008478300541047208 + -0.006110648493757629i, 8.52531221702071e-05 + -0.002988543001312136i, 0.0013331530794600441 + 0.019644440428600706i, 0.004695243058129004 + 0.0031116547906958523i, -0.03179801207413871 + -0.0510868021173863i, -0.014172181897791396 + -0.0020064873796022875i, 0.11336942097202896 + 6.79479242375559e-20i, 0.017318691764933655 + -0.020670545856184053i }, { 0.0026184373693421974 + 0.001257695953331518i, 0.0081076846743857 + -0.005223252935265039i, -0.0046184901529921565 + 0.0029360209789617217i, 0.0002827534326758035 + 0.018168185824049686i, 0.00445704063433697 + -0.013601893990634484i, -0.026523222755774067 + -0.04261230636935308i, 0.017318691764933655 + 0.020670545856184053i, 0.09456321983661913 + 1.096907666694319e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.16365624403172696, 1.0e-7), DoubleNear(0.13196757665243514, 1.0e-7), DoubleNear(0.14406252765701233, 1.0e-7), DoubleNear(0.11616778066613018, 1.0e-7), DoubleNear(0.12878861648538376, 1.0e-7), DoubleNear(0.10742461369866355, 1.0e-7), DoubleNear(0.11336942097202896, 1.0e-7), DoubleNear(0.09456321983661913, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, true, false}), Matrix({ { 0.2219765209972383 + -7.072725109573408e-20i, 0.03342379559439021 + -0.04525508948576811i, -0.05480617998289117 + 0.0880518085554459i, 0.00969905244406321 + 0.024431792182380986i, -0.0498916020165143 + 0.040043780123781646i, 0.0006515019900474963 + 0.016201100996507685i, -0.003565958859016359 + -0.029677428857549634i, -0.0065873749714091875 + -0.0037416323352719673i }, { 0.0334237955943902 + 0.04525508948576811i, 0.1817075720670303 + 4.912791094074942e-20i, -0.026203775996157308 + 0.0020847568440831065i, -0.044863744391613974 + 0.07207825528953174i, -0.015676214515363517 + -0.004142031724936978i, -0.04084072418212265 + 0.03277940401079129i, 0.00551349671197606 + -0.0051956400523256166i, -0.0029190552381476507 + -0.02429362131936674i }, { -0.05480617998289117 + -0.0880518085554459i, -0.026203775996157308 + -0.002084756844083106i, 0.19540041924200924 + 2.371692252312041e-20i, 0.029422137271375305 + -0.039836931485486934i, 0.02820251147699237 + 0.009903746390595384i, 0.0062656622500335876 + -0.004258497166231886i, -0.04391833833094293 + 0.0352495452630286i, 0.0005735010235333312 + 0.014261426896311801i }, { 0.00969905244406321 + -0.024431792182380986i, -0.044863744391613974 + -0.07207825528953174i, 0.029422137271375305 + 0.039836931485486934i, 0.15995266347014725 + 1.1519648082658485e-19i, 0.0022274430083118624 + 0.007240981921744008i, 0.02308626995167925 + 0.008107099358607803i, -0.013799382361109315 + -0.0036461276712074324i, -0.03595107532761683 + 0.028854895362070775i }, { -0.049891602016514304 + -0.040043780123781646i, -0.015676214515363513 + 0.004142031724936978i, 0.02820251147699237 + -0.009903746390595384i, 0.0022274430083118624 + -0.007240981921744008i, 0.07046833951987246 + -2.8587361969832636e-21i, 0.010610668936547617 + -0.014366614075030908i, -0.017398689201321715 + 0.027952797497448705i, 0.003079046908108801 + 0.007756080773103066i }, { 0.0006515019900474964 + -0.016201100996507685i, -0.04084072418212265 + -0.03277940401079129i, 0.0062656622500335876 + 0.004258497166231886i, 0.02308626995167925 + -0.008107099358607803i, 0.010610668936547617 + 0.014366614075030907i, 0.057684618284068394 + 6.013933925505532e-20i, -0.008318612145574038 + 0.0006618238381484225i, -0.014242378237653163 + 0.022881856796944565i }, { -0.003565958859016358 + 0.029677428857549634i, 0.005513496711976059 + 0.0051956400523256166i, -0.04391833833094293 + -0.0352495452630286i, -0.013799382361109315 + 0.003646127671207433i, -0.017398689201321715 + -0.02795279749744871i, -0.008318612145574038 + -0.0006618238381484226i, 0.06203152938703206 + -1.675537048787413e-20i, 0.00934030837732322 + -0.01264657361390089i }, { -0.0065873749714091875 + 0.0037416323352719673i, -0.0029190552381476507 + 0.024293621319366736i, 0.0005735010235333312 + -0.0142614268963118i, -0.03595107532761683 + -0.028854895362070775i, 0.003079046908108801 + -0.007756080773103067i, -0.014242378237653163 + -0.02288185679694457i, 0.00934030837732322 + 0.012646573613900886i, 0.05077833703260207 + 3.8539999100070665e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2219765209972383, 1.0e-7), DoubleNear(0.1817075720670303, 1.0e-7), DoubleNear(0.19540041924200924, 1.0e-7), DoubleNear(0.15995266347014725, 1.0e-7), DoubleNear(0.07046833951987246, 1.0e-7), DoubleNear(0.057684618284068394, 1.0e-7), DoubleNear(0.06203152938703206, 1.0e-7), DoubleNear(0.05077833703260207, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false, true}), Matrix({ { 0.13817020721876963 + 7.697411908173454e-20i, 0.020804780355000475 + -0.028169218365352872i, -0.034114334304750506 + 0.05480821385719779i, 0.006037215467660206 + 0.015207670493256789i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020804780355000475 + 0.028169218365352872i, 0.1131046327464221 + 1.0587911840678754e-19i, -0.016310649176037507 + 0.00129766555423803i, -0.027925623986495125 + 0.04486540929905773i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.034114334304750506 + -0.05480821385719779i, -0.016310649176037507 + -0.0012976655542380302i, 0.12162780232797132 + 5.937171564660611e-20i, 0.01831393151555695 + -0.02479666341999359i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.006037215467660206 + -0.015207670493256789i, -0.027925623986495125 + -0.04486540929905773i, 0.01831393151555695 + 0.02479666341999359i, 0.09956319955631401 + 1.139259314057034e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1542746532983411 + -1.5056010637445189e-19i, 0.02322968417593735 + -0.03145248519544615i, -0.03809053487946238 + 0.06119639219569682i, 0.0067408838845118045 + 0.016980202462227263i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.023229684175937345 + 0.03145248519544615i, 0.12628755760467658 + 3.3881317890172014e-21i, -0.018211738965693842 + 0.0014489151279934987i, -0.031180498642772014 + 0.05009470278741857i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03809053487946238 + -0.06119639219569682i, -0.018211738965693842 + -0.0014489151279934985i, 0.13580414630107 + -5.2410163611359833e-20i, 0.020448514133141575 + -0.027686841679394232i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006740883884511804 + -0.016980202462227263i, -0.03118049864277201 + -0.05009470278741858i, 0.02044851413314158 + 0.027686841679394232i, 0.11116780094643527 + 3.9810548520952116e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.13817020721876963, 1.0e-7), DoubleNear(0.1131046327464221, 1.0e-7), DoubleNear(0.12162780232797132, 1.0e-7), DoubleNear(0.09956319955631401, 1.0e-7), DoubleNear(0.1542746532983411, 1.0e-7), DoubleNear(0.12628755760467658, 1.0e-7), DoubleNear(0.13580414630107, 1.0e-7), DoubleNear(0.11116780094643527, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false, false, false}), Matrix({ { 0.19270766602625605 + 1.2027867851011065e-19i, 0.02901667982630349 + -0.03928795095730073i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02249348053850668 + -0.007237149235250874i, 0.0019114618859513684 + -0.0056755438173449885i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02901667982630349 + 0.03928795095730073i, 0.1577484048989613 + 1.6940658945086007e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.004862385116856599 + 0.0034960971295745088i, 0.018412919157517103 + -0.005924251854729099i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.20916665301306114 + -5.2727800966580196e-20i, 0.03149496813475276 + -0.04264349921793061i, 0.0 + 0.0i, 0.0 + 0.0i, 0.026005995864309225 + -0.013244562269269325i, 0.00121560261458902 + -0.007296209548446838i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.03149496813475276 + 0.042643499217930605i, 0.17122155309778547 + 3.8963515573697816e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006616028281257329 + 0.0033076476948196397i, 0.02128822609913619 + -0.010841854995418496i }, { 0.02249348053850668 + 0.007237149235250874i, 0.004862385116856599 + -0.0034960971295745088i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06709034352048487 + 1.606715621823001e-20i, 0.010102032044253938 + -0.01367793082804573i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0019114618859513684 + 0.0056755438173449885i, 0.018412919157517103 + 0.005924251854729099i, 0.0 + 0.0i, 0.0 + 0.0i, 0.010102032044253936 + 0.01367793082804573i, 0.054919427403774826 + 5.039846036163087e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.026005995864309222 + 0.013244562269269325i, 0.006616028281257329 + -0.0033076476948196397i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08091214658634996 + -1.5024246901923152e-19i, 0.012183230174326163 + -0.016495827656909764i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.00121560261458902 + 0.007296209548446838i, 0.021288226099136193 + 0.010841854995418496i, 0.0 + 0.0i, 0.0 + 0.0i, 0.012183230174326163 + 0.016495827656909767i, 0.06623380545332641 + 4.235164736271502e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.19270766602625605, 1.0e-7), DoubleNear(0.1577484048989613, 1.0e-7), DoubleNear(0.20916665301306114, 1.0e-7), DoubleNear(0.17122155309778547, 1.0e-7), DoubleNear(0.06709034352048487, 1.0e-7), DoubleNear(0.054919427403774826, 1.0e-7), DoubleNear(0.08091214658634996, 1.0e-7), DoubleNear(0.06623380545332641, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false, false, false}), Matrix({ { 0.2597980095467409 + 1.3634583472834066e-19i, 0.039118711870557425 + -0.05296588178534646i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.039118711870557425 + 0.05296588178534646i, 0.21266783230273612 + 2.1980504981249094e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2900787995994111 + -2.0297026998581172e-19i, 0.043678198309078924 + -0.05913932687484037i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.043678198309078924 + 0.05913932687484037i, 0.23745535855111186 + 4.319868030996932e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2597980095467409, 1.0e-7), DoubleNear(0.21266783230273612, 1.0e-7), DoubleNear(0.2900787995994111, 1.0e-7), DoubleNear(0.23745535855111186, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false, false, false}), Matrix({ { 0.2597980095467409 + 1.3634583472834066e-19i, 0.039118711870557425 + -0.05296588178534646i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.039118711870557425 + 0.05296588178534646i, 0.21266783230273612 + 2.1980504981249094e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2900787995994111 + -2.0297026998581172e-19i, 0.043678198309078924 + -0.05913932687484037i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.043678198309078924 + 0.05913932687484037i, 0.23745535855111186 + 4.319868030996932e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2597980095467409, 1.0e-7), DoubleNear(0.21266783230273612, 1.0e-7), DoubleNear(0.2900787995994111, 1.0e-7), DoubleNear(0.23745535855111186, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false, false, false}), Matrix({ { 0.13815136257629312 + -3.7269449679189215e-20i, 0.020894311232323385 + -0.026034859108456244i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0015699127026530275 + 0.022975797457857203i, 0.004957713007514323 + 0.003612947273228893i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020894311232323385 + 0.026034859108456244i, 0.11577113142863357 + 5.421010862427522e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005573842010311572 + 0.002569427551257243i, 0.0025732987317561903 + 0.015017845846478365i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.15425361221616346 + -2.541098841762901e-21i, 0.023329650336056204 + -0.02906935542384151i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0017528940774256619 + 0.025653744453401364i, 0.005535559877795768 + 0.004034054802277641i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.02332965033605621 + 0.029069355423841505i, 0.12926485038000923 + 3.8963515573697816e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.006223501874894299 + 0.002868907506361244i, 0.0028732298927957142 + 0.016768252779595226i }, { -0.0015699127026530275 + -0.022975797457857206i, -0.005573842010311572 + -0.002569427551257243i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12164664697044783 + 1.7361528440752987e-19i, 0.018224400638234044 + -0.026931022676890213i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004957713007514324 + -0.003612947273228893i, 0.0025732987317561907 + -0.015017845846478365i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01822440063823404 + 0.026931022676890213i, 0.09689670087410257 + 1.6559494118821572e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.001752894077425661 + -0.02565374445340136i, -0.006223501874894299 + -0.002868907506361244i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13582518738324761 + -2.0042917114404882e-19i, 0.020348547973022716 + -0.03006997145099887i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.005535559877795768 + -0.004034054802277641i, 0.0028732298927957134 + -0.016768252779595226i, 0.0 + 0.0i, 0.0 + 0.0i, 0.020348547973022716 + 0.030069971450998864i, 0.10819050817110262 + 4.235164736271502e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13815136257629312, 1.0e-7), DoubleNear(0.11577113142863357, 1.0e-7), DoubleNear(0.15425361221616346, 1.0e-7), DoubleNear(0.12926485038000923, 1.0e-7), DoubleNear(0.12164664697044783, 1.0e-7), DoubleNear(0.09689670087410257, 1.0e-7), DoubleNear(0.13582518738324761, 1.0e-7), DoubleNear(0.10819050817110262, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true, false, false}), Matrix({ { 0.14538660851880725 + 6.776263578034403e-20i, 0.021640843748730536 + -0.032105352630825534i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0013454061094954363 + -0.019824992776495833i, -0.004660938765559364 + -0.0029630059920063845i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.021640843748730536 + 0.03210535263082553i, 0.11723548048813676 + 8.639736061993863e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0047383971078035 + -0.0031402540567498395i, 0.00028535222373480954 + -0.018335169893636684i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.16233216316993204 + -1.2790197503539935e-19i, 0.024163195044882603 + -0.035847396090962436i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0015022200897422014 + -0.02213569733157738i, -0.005204195076315903 + -0.003308359532340598i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.024163195044882603 + 0.035847396090962436i, 0.13089987683042853 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.005290681585494091 + -0.003506266767818666i, 0.00031861148847302456 + -0.020472227953080218i }, { 0.0013454061094954359 + 0.019824992776495833i, 0.004738397107803499 + 0.0031402540567498395i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1144114010279337 + 6.858319894799663e-20i, 0.01747786812182689 + -0.020860529154520933i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004660938765559364 + 0.0029630059920063845i, 0.0002853522237348089 + 0.018335169893636684i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01747786812182689 + 0.02086052915452093i, 0.09543235181459936 + 1.334076891925523e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0015022200897422007 + 0.02213569733157738i, 0.005290681585494091 + 0.003506266767818666i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12774663642947903 + -7.506829495041237e-20i, 0.01951500326419632 + -0.023291930783877937i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.005204195076315903 + 0.003308359532340598i, 0.00031861148847302446 + 0.020472227953080218i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01951500326419632 + 0.02329193078387793i, 0.10655548172068333 + 2.964615315390051e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.14538660851880725, 1.0e-7), DoubleNear(0.11723548048813676, 1.0e-7), DoubleNear(0.16233216316993204, 1.0e-7), DoubleNear(0.13089987683042853, 1.0e-7), DoubleNear(0.1144114010279337, 1.0e-7), DoubleNear(0.09543235181459936, 1.0e-7), DoubleNear(0.12774663642947903, 1.0e-7), DoubleNear(0.10655548172068333, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, true, false}), Matrix({ { 0.19719634743869496 + 1.2536087619363645e-19i, 0.02969255657823962 + -0.04020307332285737i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0443219924401106 + 0.035573524364525905i, 0.0005787720800796122 + 0.014392503885744135i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02969255657823962 + 0.04020307332285737i, 0.16142279080956318 + 2.0498197323554068e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.013926212692258553 + -0.0036796392855572837i, -0.036281502202505325 + 0.02912010114000197i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.22018059280055255 + -1.7237120476625012e-19i, 0.03315337628752589 + -0.04488894764839767i, 0.0 + 0.0i, 0.0 + 0.0i, -0.049487947907346626 + 0.03971980102228434i, 0.0006462309335012153 + 0.01607002400707535i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.03315337628752589 + 0.04488894764839767i, 0.18023744472761433 + -4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.015549384184214279 + -0.004108520110587127i, -0.040510297307234155 + 0.03251419823286009i }, { -0.044321992440110605 + -0.035573524364525905i, -0.01392621269225855 + 0.0036796392855572837i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06260166210804599 + 1.0984958534704208e-20i, 0.009426155292317804 + -0.012762808462489091i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0005787720800796122 + -0.014392503885744135i, -0.036281502202505325 + -0.02912010114000197i, 0.0 + 0.0i, 0.0 + 0.0i, 0.009426155292317804 + 0.01276280846248909i, 0.051245041493172924 + 1.4823076576950256e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.04948794790734663 + -0.03971980102228435i, -0.015549384184214279 + 0.004108520110587127i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06989820679885853 + -3.05990652195616e-20i, 0.010524822021553033 + -0.014250379226442704i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0006462309335012155 + -0.01607002400707535i, -0.040510297307234155 + -0.03251419823286009i, 0.0 + 0.0i, 0.0 + 0.0i, 0.010524822021553033 + 0.014250379226442704i, 0.057217913823497536 + 8.385626177817573e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.19719634743869496, 1.0e-7), DoubleNear(0.16142279080956318, 1.0e-7), DoubleNear(0.22018059280055255, 1.0e-7), DoubleNear(0.18023744472761433, 1.0e-7), DoubleNear(0.06260166210804599, 1.0e-7), DoubleNear(0.051245041493172924, 1.0e-7), DoubleNear(0.06989820679885853, 1.0e-7), DoubleNear(0.057217913823497536, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false, true}), Matrix({ { 0.2597980095467409 + 1.3634583472834066e-19i, 0.039118711870557425 + -0.05296588178534646i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008650744258437468 + -0.01368472010688788i, -0.004092522654094404 + -0.0002969011397642356i }, { 0.039118711870557425 + 0.05296588178534646i, 0.21266783230273612 + 2.1980504981249094e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001487375888712348 + -0.0038242129813526814i, -0.007081405405903409 + -0.011202163426421146i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008650744258437468 + 0.013684720106887878i, 0.0014873758887123478 + 0.0038242129813526814i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2900787995994111 + -2.0297026998581172e-19i, 0.043678198309078924 + -0.05913932687484037i }, { -0.004092522654094405 + 0.00029690113976423536i, -0.007081405405903411 + 0.011202163426421146i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.043678198309078924 + 0.05913932687484037i, 0.23745535855111186 + 4.319868030996932e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2597980095467409, 1.0e-7), DoubleNear(0.21266783230273612, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2900787995994111, 1.0e-7), DoubleNear(0.23745535855111186, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false, false, false}), Matrix({ { 0.4018743190393172 + 6.755087754353045e-20i, 0.06051164796105625 + -0.08193145017523135i, 0.048499476402815905 + -0.0204817115045202i, 0.0031270645005403884 + -0.012971753365791826i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06051164796105625 + 0.08193145017523133i, 0.3289699579967468 + 2.0837010502455788e-19i, 0.011478413398113929 + 0.006803744824394149i, 0.03970114525665329 + -0.016766106850147594i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.048499476402815905 + 0.0204817115045202i, 0.011478413398113929 + -0.006803744824394149i, 0.14800249010683483 + -1.3417531280100151e-19i, 0.0222852622185801 + -0.030173758484955494i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0031270645005403884 + 0.012971753365791826i, 0.039701145256653296 + 0.016766106850147594i, 0.0222852622185801 + 0.030173758484955498i, 0.12115323285710124 + 5.463362509790237e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4018743190393172, 1.0e-7), DoubleNear(0.3289699579967468, 1.0e-7), DoubleNear(0.14800249010683483, 1.0e-7), DoubleNear(0.12115323285710124, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false, false, false}), Matrix({ { 0.4018743190393172 + 6.755087754353045e-20i, 0.06051164796105625 + -0.08193145017523135i, 0.048499476402815905 + -0.0204817115045202i, 0.0031270645005403884 + -0.012971753365791826i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06051164796105625 + 0.08193145017523133i, 0.3289699579967468 + 2.0837010502455788e-19i, 0.011478413398113929 + 0.006803744824394149i, 0.03970114525665329 + -0.016766106850147594i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.048499476402815905 + 0.0204817115045202i, 0.011478413398113929 + -0.006803744824394149i, 0.14800249010683483 + -1.3417531280100151e-19i, 0.0222852622185801 + -0.030173758484955494i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0031270645005403884 + 0.012971753365791826i, 0.039701145256653296 + 0.016766106850147594i, 0.0222852622185801 + 0.030173758484955498i, 0.12115323285710124 + 5.463362509790237e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4018743190393172, 1.0e-7), DoubleNear(0.3289699579967468, 1.0e-7), DoubleNear(0.14800249010683483, 1.0e-7), DoubleNear(0.12115323285710124, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false, false, false}), Matrix({ { 0.21370250240394145 + -3.218725199566341e-20i, 0.03232082922011306 + -0.04027259983149732i, 0.025790300553016086 + -0.010891447387070638i, 0.0018480691290998818 + -0.00650747206522823i, -0.0024284543189171406 + 0.035540622400728736i, 0.007668948435606587 + 0.005588767703366854i, 0.0015182707201240242 + 0.004412923130960246i, 0.001210347335993037 + 0.0002836188145129364i }, { 0.03232082922011306 + 0.04027259983149732i, 0.17908314497275968 + 1.0503208545953324e-19i, 0.0059530926760512255 + 0.0032129798903826057i, 0.021612325924460676 + -0.009127055740766011i, -0.008622021262729113 + 0.0039745760534650645i, 0.003980564274966865 + 0.023230688270169778i, -0.0008379669482277 + 0.0009190898549781348i, 0.0016643500383991163 + 0.002600682350078082i }, { 0.02579030055301609 + 0.010891447387070638i, 0.0059530926760512255 + -0.0032129798903826057i, 0.07870247238851516 + -7.623296525288703e-21i, 0.011903132348266532 + -0.014831614700800433i, -0.0021044179674385034 + 0.004165388524216188i, 0.0006406790474605671 + 0.0010653218592689185i, -0.0008943524611615485 + 0.01308891951052983i, 0.002824324449703505 + 0.0020582343721396805i }, { 0.0018480691290998818 + 0.006507472065228231i, 0.021612325924460676 + 0.00912705574076601i, 0.011903132348266532 + 0.014831614700800435i, 0.06595283683588314 + -1.1858461261560205e-20i, -0.0012430991809836904 + 4.0239210770736685e-05i, -0.0007035756172559728 + 0.0030064249678196982i, -0.0031753226224767563 + 0.0014637590041534226i, 0.0014659643495850399 + 0.008555410355903813i }, { -0.00242845431891714 + -0.035540622400728736i, -0.008622021262729113 + -0.003974576053465064i, -0.0021044179674385034 + -0.004165388524216188i, -0.0012430991809836904 + -4.023921077073671e-05i, 0.18817181663537577 + 9.973812953919386e-20i, 0.028190818740943188 + -0.041658850343734025i, 0.022709175849799812 + -0.009590264117449562i, 0.0012789953714405066 + -0.006464281300563596i }, { 0.0076689484356065865 + -0.005588767703366854i, 0.003980564274966864 + -0.02323068827016978i, 0.0006406790474605671 + -0.0010653218592689185i, -0.0007035756172559726 + -0.0030064249678196982i, 0.02819081874094319 + 0.04165885034373402i, 0.1498868130239871 + 1.0333801956502464e-19i, 0.005525320722062703 + 0.0035907649340115428i, 0.018088819332192613 + -0.0076390511093815845i }, { 0.0015182707201240242 + -0.004412923130960246i, -0.0008379669482277 + -0.0009190898549781348i, -0.0008943524611615485 + -0.01308891951052983i, -0.0031753226224767563 + -0.0014637590041534226i, 0.022709175849799812 + 0.009590264117449562i, 0.005525320722062703 + -0.0035907649340115428i, 0.06930001771831967 + -1.265520162757128e-19i, 0.010382129870313566 + -0.015342143784155063i }, { 0.0012103473359930369 + -0.00028361881451293634i, 0.0016643500383991161 + -0.002600682350078082i, 0.002824324449703506 + -0.0020582343721396805i, 0.0014659643495850399 + -0.008555410355903813i, 0.0012789953714405066 + 0.006464281300563596i, 0.018088819332192613 + 0.0076390511093815845i, 0.010382129870313565 + 0.015342143784155063i, 0.055200396021218096 + 6.649208635946258e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21370250240394145, 1.0e-7), DoubleNear(0.17908314497275968, 1.0e-7), DoubleNear(0.07870247238851516, 1.0e-7), DoubleNear(0.06595283683588314, 1.0e-7), DoubleNear(0.18817181663537577, 1.0e-7), DoubleNear(0.1498868130239871, 1.0e-7), DoubleNear(0.06930001771831967, 1.0e-7), DoubleNear(0.055200396021218096, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true, false, false}), Matrix({ { 0.2248945032252823 + -4.573977915173222e-20i, 0.03347561961745002 + -0.049662877512188446i, 0.027140986959235072 + -0.011461852912183651i, 0.0015088530550215794 + -0.007699575197626058i, 0.002081171310850786 + -0.030666730225969083i, -0.007209876610529338 + -0.004583391602670267i, -0.0013117817621554654 + -0.0038070268162035932i, -0.0011037056214938687 + -0.00018568362451451073i }, { 0.03347561961745002 + 0.04966287751218844i, 0.18134830582657224 + 6.437450399132683e-20i, 0.006571036337200664 + 0.004287374163836739i, 0.02188569277119198 + -0.00924250071677251i, 0.0073296947669408705 + -0.004857571706836913i, 0.0004414034226045521 + -0.02836216462293472i, 0.0006370025750565399 + -0.0009597885700321676i, -0.0013922209309353455 + -0.0034453329457119052i }, { 0.027140986959235072 + 0.011461852912183651i, 0.006571036337200664 + -0.004287374163836739i, 0.082824268463457 + -1.4399560103323106e-20i, 0.012328419176163119 + -0.018289871209599524i, 0.0018141065642085677 + -0.0035948910893811997i, -0.000636516253720664 + -0.0009205930512878229i, 0.0007664548883868514 + -0.011293959882104125i, -0.00265525723134593 + -0.001687973921676716i }, { 0.0015088530550215794 + 0.007699575197626058i, 0.02188569277119198 + 0.00924250071677251i, 0.012328419176163116 + 0.018289871209599524i, 0.06678705149199306 + 3.5575383784680614e-20i, 0.001132139375784629 + -0.00021266596716693227i, 0.0014987608806883291 + -0.0034003402844216485i, 0.00269938392635672 + -0.0017889491177315927i, 0.000162560289603282 + -0.010445233223782184i }, { 0.0020811713108507854 + 0.030666730225969083i, 0.00732969476694087 + 0.004857571706836913i, 0.0018141065642085677 + 0.0035948910893812i, 0.001132139375784629 + 0.00021266596716693227i, 0.1769798158140349 + 1.1329065669526267e-19i, 0.02703602834360623 + -0.032268572663042894i, 0.02135848944358083 + -0.009019858592336548i, 0.001618211445518809 + -0.005272178168165768i }, { -0.007209876610529338 + 0.004583391602670267i, 0.00044140342260455193 + 0.02836216462293472i, -0.000636516253720664 + 0.0009205930512878229i, 0.0014987608806883291 + 0.0034003402844216485i, 0.02703602834360623 + 0.032268572663042894i, 0.14762165217017448 + 1.4399560103323106e-19i, 0.004907377060913265 + 0.0025163706605574087i, 0.017815452485461312 + -0.007523606133375086i }, { -0.0013117817621554656 + 0.0038070268162035932i, 0.0006370025750565398 + 0.0009597885700321678i, 0.0007664548883868517 + 0.011293959882104125i, 0.00269938392635672 + 0.0017889491177315925i, 0.02135848944358083 + 0.009019858592336548i, 0.004907377060913264 + -0.0025163706605574082i, 0.06517822164337783 + -1.197757526976784e-19i, 0.00995684304241698 + -0.01188388727535597i }, { -0.0011037056214938687 + 0.00018568362451451073i, -0.0013922209309353455 + 0.0034453329457119052i, -0.0026552572313459305 + 0.0016879739216767162i, 0.00016256028960328156 + 0.010445233223782185i, 0.001618211445518809 + 0.005272178168165769i, 0.017815452485461312 + 0.007523606133375086i, 0.00995684304241698 + 0.011883887275355973i, 0.05436618136510818 + 1.9058241313221758e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2248945032252823, 1.0e-7), DoubleNear(0.18134830582657224, 1.0e-7), DoubleNear(0.082824268463457, 1.0e-7), DoubleNear(0.06678705149199306, 1.0e-7), DoubleNear(0.1769798158140349, 1.0e-7), DoubleNear(0.14762165217017448, 1.0e-7), DoubleNear(0.06517822164337783, 1.0e-7), DoubleNear(0.05436618136510818, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, true, false}), Matrix({ { 0.3050375481406773 + 8.004461351553138e-20i, 0.04593059036993741 + -0.06218901654827448i, 0.036812905595428755 + -0.015546380455458525i, 0.0023735582069608933 + -0.009846043039638964i, -0.06856045803203367 + 0.05502769595796446i, 0.0008952864418274795 + 0.022263364174518588i, -0.005469582949156643 + 0.010135133723849665i, 0.0012427087329082937 + 0.0026411852077318195i }, { 0.04593059036993741 + 0.062189016548274474i, 0.24970042783313984 + 1.2874900798265365e-19i, 0.008712542488098675 + 0.005164295256211603i, 0.030134645170699727 + -0.012726098392301804i, -0.02154207128939225 + -0.00569193172331679i, -0.05612284719499392 + 0.04504507496578371i, -0.002889857914793598 + 0.0004109811780273003i, -0.004477341267650762 + 0.008296510519499109i }, { 0.036812905595428755 + 0.015546380455458525i, 0.008712542488098675 + -0.005164295256211603i, 0.1123393920985702 + -1.2705494208814505e-19i, 0.016915342495828108 + -0.022903004422980558i, -0.011078607163810254 + 0.0031467024880010496i, -0.0010266166782431892 + 0.0027324425871993784i, -0.025249482315423562 + 0.020265629428845792i, 0.000329716571753348 + 0.008199163718300897i }, { 0.0023735582069608933 + 0.009846043039638964i, 0.03013464517069973 + 0.012726098392301804i, 0.016915342495828108 + 0.02290300442298056i, 0.0919598077040377 + 3.5575383784680614e-20i, -0.0023096740217840254 + -0.0017848221786732465i, -0.009068827642565924 + 0.0025758565209654223i, -0.00793352558708058 + -0.002096227672827621i, -0.02066895231474556 + 0.016589224407078357i }, { -0.06856045803203367 + -0.05502769595796445i, -0.02154207128939225 + 0.005691931723316791i, -0.011078607163810254 + -0.0031467024880010496i, -0.0023096740217840254 + 0.001784822178673247i, 0.09683677089863987 + -1.249373597200093e-20i, 0.014581057591118846 + -0.019742433626956858i, 0.01168657080738715 + -0.004935331049061674i, 0.0007535062935794948 + -0.003125710326152863i }, { 0.0008952864418274795 + -0.022263364174518588i, -0.05612284719499391 + -0.0450450749657837i, -0.0010266166782431892 + -0.0027324425871993784i, -0.009068827642565924 + -0.0025758565209654223i, 0.014581057591118845 + 0.019742433626956858i, 0.07926953016360694 + 7.962109704190423e-20i, 0.0027658709100152543 + 0.0016394495681825451i, 0.009566500085953564 + -0.00404000845784579i }, { -0.005469582949156643 + -0.010135133723849665i, -0.002889857914793598 + -0.0004109811780273003i, -0.025249482315423566 + -0.020265629428845796i, -0.00793352558708058 + 0.002096227672827621i, 0.01168657080738715 + 0.004935331049061674i, 0.0027658709100152543 + -0.0016394495681825451i, 0.03566309800826464 + -7.120370712856462e-21i, 0.005369919722751993 + -0.007270754061974935i }, { 0.0012427087329082934 + -0.0026411852077318195i, -0.004477341267650762 + -0.00829651051949911i, 0.0003297165717533481 + -0.008199163718300897i, -0.02066895231474556 + -0.01658922440707836i, 0.0007535062935794948 + 0.0031257103261528633i, 0.009566500085953564 + 0.004040008457845791i, 0.005369919722751993 + 0.007270754061974935i, 0.029193425153063536 + 1.9058241313221758e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3050375481406773, 1.0e-7), DoubleNear(0.24970042783313984, 1.0e-7), DoubleNear(0.1123393920985702, 1.0e-7), DoubleNear(0.0919598077040377, 1.0e-7), DoubleNear(0.09683677089863987, 1.0e-7), DoubleNear(0.07926953016360694, 1.0e-7), DoubleNear(0.03566309800826464, 1.0e-7), DoubleNear(0.029193425153063536, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false, true}), Matrix({ { 0.19270766602625605 + 1.2027867851011065e-19i, 0.02901667982630349 + -0.03928795095730073i, 0.02249348053850668 + -0.007237149235250874i, 0.0019114618859513684 + -0.0056755438173449885i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02901667982630349 + 0.03928795095730073i, 0.1577484048989613 + 1.6940658945086007e-19i, 0.004862385116856599 + 0.0034960971295745088i, 0.018412919157517103 + -0.005924251854729099i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02249348053850668 + 0.007237149235250874i, 0.004862385116856599 + -0.0034960971295745088i, 0.06709034352048487 + 1.606715621823001e-20i, 0.010102032044253938 + -0.01367793082804573i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0019114618859513684 + 0.0056755438173449885i, 0.018412919157517103 + 0.005924251854729099i, 0.010102032044253936 + 0.01367793082804573i, 0.054919427403774826 + 5.039846036163087e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20916665301306114 + -5.2727800966580196e-20i, 0.03149496813475276 + -0.04264349921793061i, 0.026005995864309225 + -0.013244562269269325i, 0.00121560261458902 + -0.007296209548446838i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03149496813475276 + 0.042643499217930605i, 0.17122155309778547 + 3.8963515573697816e-20i, 0.006616028281257329 + 0.0033076476948196397i, 0.02128822609913619 + -0.010841854995418496i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.026005995864309222 + 0.013244562269269325i, 0.006616028281257329 + -0.0033076476948196397i, 0.08091214658634996 + -1.5024246901923152e-19i, 0.012183230174326163 + -0.016495827656909764i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00121560261458902 + 0.007296209548446838i, 0.021288226099136193 + 0.010841854995418496i, 0.012183230174326163 + 0.016495827656909767i, 0.06623380545332641 + 4.235164736271502e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.19270766602625605, 1.0e-7), DoubleNear(0.1577484048989613, 1.0e-7), DoubleNear(0.06709034352048487, 1.0e-7), DoubleNear(0.054919427403774826, 1.0e-7), DoubleNear(0.20916665301306114, 1.0e-7), DoubleNear(0.17122155309778547, 1.0e-7), DoubleNear(0.08091214658634996, 1.0e-7), DoubleNear(0.06623380545332641, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false, false, false}), Matrix({ { 0.549876809146152 + -6.662443525747106e-20i, 0.08279691017963635 + -0.11210520866018683i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08279691017963635 + 0.11210520866018683i, 0.450123190853848 + 2.6300373012246026e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.549876809146152, 1.0e-7), DoubleNear(0.450123190853848, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false, false, false}), Matrix({ { 0.2924049747924566 + -3.9810548520952116e-20i, 0.044223961568379586 + -0.05510421453229775i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0033228067800786893 + 0.04862954191125857i, 0.01049327288531009 + 0.007647002075506533i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0442239615683796 + 0.055104214532297746i, 0.2450359818086428 + 9.317362419797304e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01179734388520587 + 0.005438335057618487i, 0.005446528624551904 + 0.031786098626073594i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0033228067800786885 + -0.04862954191125857i, -0.01179734388520587 + -0.005438335057618487i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2574718343536955 + -2.6813886736518945e-20i, 0.03857294861125676 + -0.05700099412788909i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010493272885310092 + -0.007647002075506533i, 0.005446528624551904 + -0.031786098626073594i, 0.0 + 0.0i, 0.0 + 0.0i, 0.038572948611256756 + 0.057000994127889074i, 0.2050872090452052 + 1.6983010592448722e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2924049747924566, 1.0e-7), DoubleNear(0.2450359818086428, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2574718343536955, 1.0e-7), DoubleNear(0.2050872090452052, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true, false, false}), Matrix({ { 0.3077187716887393 + -6.013933925505532e-20i, 0.04580403879361314 + -0.06795274872178797i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0028476261992376375 + -0.04196069010807321i, -0.009865133841875267 + -0.006271365524346983i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04580403879361314 + 0.06795274872178797i, 0.24813535731856529 + 9.994988777600744e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01002907869329759 + -0.006646520824568505i, 0.000603963712207834 + -0.0388073978467169i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0028476261992376366 + 0.04196069010807321i, 0.01002907869329759 + 0.006646520824568505i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24215803745741274 + -6.485096002415737e-21i, 0.03699287138602321 + -0.04415245993839887i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009865133841875267 + 0.006271365524346983i, 0.0006039637122078334 + 0.0388073978467169i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03699287138602321 + 0.044152459938398864i, 0.20198783353528268 + 1.6305384234645282e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.3077187716887393, 1.0e-7), DoubleNear(0.24813535731856529, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24215803745741274, 1.0e-7), DoubleNear(0.20198783353528268, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, true, false}), Matrix({ { 0.41737694023924754 + -4.701032857261367e-20i, 0.06284593286576551 + -0.08509202097125504i, 0.0 + 0.0i, 0.0 + 0.0i, -0.09380994034745722 + 0.07529332538681024i, 0.0012250030135808276 + 0.030462527892819485i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06284593286576551 + 0.08509202097125504i, 0.3416602355371775 + 1.6432439176733427e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.02947559687647283 + -0.007788159396144411i, -0.07679179950973948 + 0.061634299372862064i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09380994034745724 + -0.07529332538681024i, -0.029475596876472828 + 0.007788159396144411i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13249986890690452 + -1.9614106684857392e-20i, 0.019950977313870837 + -0.027013187688931795i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0012250030135808276 + -0.030462527892819485i, -0.07679179950973948 + -0.061634299372862064i, 0.0 + 0.0i, 0.0 + 0.0i, 0.019950977313870837 + 0.027013187688931795i, 0.10846295531667047 + 9.867933835512599e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.41737694023924754, 1.0e-7), DoubleNear(0.3416602355371775, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.13249986890690452, 1.0e-7), DoubleNear(0.10846295531667047, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false, true}), Matrix({ { 0.2597980095467409 + 1.3634583472834066e-19i, 0.039118711870557425 + -0.05296588178534646i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.039118711870557425 + 0.05296588178534646i, 0.21266783230273612 + 2.1980504981249094e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2900787995994111 + -2.0297026998581172e-19i, 0.043678198309078924 + -0.05913932687484037i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.043678198309078924 + 0.05913932687484037i, 0.23745535855111186 + 4.319868030996932e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2597980095467409, 1.0e-7), DoubleNear(0.21266783230273612, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2900787995994111, 1.0e-7), DoubleNear(0.23745535855111186, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false, false, false}), Matrix({ { 0.2924049747924566 + -3.9810548520952116e-20i, 0.044223961568379586 + -0.05510421453229775i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0033228067800786893 + 0.04862954191125857i, 0.01049327288531009 + 0.007647002075506533i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0442239615683796 + 0.055104214532297746i, 0.2450359818086428 + 9.317362419797304e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01179734388520587 + 0.005438335057618487i, 0.005446528624551904 + 0.031786098626073594i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0033228067800786885 + -0.04862954191125857i, -0.01179734388520587 + -0.005438335057618487i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2574718343536955 + -2.6813886736518945e-20i, 0.03857294861125676 + -0.05700099412788909i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010493272885310092 + -0.007647002075506533i, 0.005446528624551904 + -0.031786098626073594i, 0.0 + 0.0i, 0.0 + 0.0i, 0.038572948611256756 + 0.057000994127889074i, 0.2050872090452052 + 1.6983010592448722e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2924049747924566, 1.0e-7), DoubleNear(0.2450359818086428, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2574718343536955, 1.0e-7), DoubleNear(0.2050872090452052, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true, false, false}), Matrix({ { 0.3077187716887393 + -6.013933925505532e-20i, 0.04580403879361314 + -0.06795274872178797i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0028476261992376375 + -0.04196069010807321i, -0.009865133841875267 + -0.006271365524346983i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04580403879361314 + 0.06795274872178797i, 0.24813535731856529 + 9.994988777600744e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01002907869329759 + -0.006646520824568505i, 0.000603963712207834 + -0.0388073978467169i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0028476261992376366 + 0.04196069010807321i, 0.01002907869329759 + 0.006646520824568505i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24215803745741274 + -6.485096002415737e-21i, 0.03699287138602321 + -0.04415245993839887i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009865133841875267 + 0.006271365524346983i, 0.0006039637122078334 + 0.0388073978467169i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03699287138602321 + 0.044152459938398864i, 0.20198783353528268 + 1.6305384234645282e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.3077187716887393, 1.0e-7), DoubleNear(0.24813535731856529, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24215803745741274, 1.0e-7), DoubleNear(0.20198783353528268, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, true, false}), Matrix({ { 0.41737694023924754 + -4.701032857261367e-20i, 0.06284593286576551 + -0.08509202097125504i, 0.0 + 0.0i, 0.0 + 0.0i, -0.09380994034745722 + 0.07529332538681024i, 0.0012250030135808276 + 0.030462527892819485i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06284593286576551 + 0.08509202097125504i, 0.3416602355371775 + 1.6432439176733427e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.02947559687647283 + -0.007788159396144411i, -0.07679179950973948 + 0.061634299372862064i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09380994034745724 + -0.07529332538681024i, -0.029475596876472828 + 0.007788159396144411i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13249986890690452 + -1.9614106684857392e-20i, 0.019950977313870837 + -0.027013187688931795i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0012250030135808276 + -0.030462527892819485i, -0.07679179950973948 + -0.061634299372862064i, 0.0 + 0.0i, 0.0 + 0.0i, 0.019950977313870837 + 0.027013187688931795i, 0.10846295531667047 + 9.867933835512599e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.41737694023924754, 1.0e-7), DoubleNear(0.3416602355371775, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.13249986890690452, 1.0e-7), DoubleNear(0.10846295531667047, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false, true}), Matrix({ { 0.2597980095467409 + 1.3634583472834066e-19i, 0.039118711870557425 + -0.05296588178534646i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.039118711870557425 + 0.05296588178534646i, 0.21266783230273612 + 2.1980504981249094e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2900787995994111 + -2.0297026998581172e-19i, 0.043678198309078924 + -0.05913932687484037i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.043678198309078924 + 0.05913932687484037i, 0.23745535855111186 + 4.319868030996932e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2597980095467409, 1.0e-7), DoubleNear(0.21266783230273612, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2900787995994111, 1.0e-7), DoubleNear(0.23745535855111186, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true, false, false}), Matrix({ { 0.14433242993238754 + 3.134021904840911e-20i, 0.021252202544496085 + -0.030380827182408424i, -0.00037833587867444737 + 0.029464285573844076i, 0.006857116158857118 + 0.005726506150138767i, -0.003905599721527646 + -0.02903741982563531i, -0.007363657378106257 + -0.0043728390360569976i, -0.011292986028201696 + -8.984155881899957e-05i, -0.0012722986563131616 + 0.002957155237092385i }, { 0.021252202544496085 + 0.030380827182408424i, 0.11902297218500082 + 5.929230630780102e-20i, -0.006522957752872347 + 0.0033149188949329125i, 0.0064322109433787005 + 0.020661695005781758i, 0.005143884984555021 + -0.005903734472349518i, -0.0006828838176113385 + -0.02434582122225999i, -0.0014859872468191621 + -0.0027937048318662583i, -0.009626872463381637 + -0.0030947651613120264i }, { -0.0003783358786744472 + -0.029464285573844076i, -0.006522957752872347 + -0.0033149188949329125i, 0.16338634175635178 + -9.147955830346444e-20i, 0.02455183624911705 + -0.03757192153937955i, 0.010856070136364401 + 0.0027045653178188814i, 0.003867968226221799 + -0.0014007271961201597i, 0.006753225920765283 + -0.0129232702824379i, -0.0025014764637690105 + -0.0018985264882899855i }, { 0.006857116158857119 + -0.005726506150138767i, 0.0064322109433787 + -0.02066169500578176i, 0.02455183624911705 + 0.03757192153937955i, 0.12911238513356446 + 4.0657581468206416e-20i, -0.0012925656714270193 + 0.003125549689493372i, 0.013644114368862929 + -0.0011692861224161166i, 0.004885193708742569 + -0.0007427863522189875i, 0.0012868475298191727 + -0.014461576624456915i }, { -0.0039055997215276467 + 0.02903741982563531i, 0.0051438849845550205 + 0.005903734472349518i, 0.010856070136364401 + -0.002704565317818882i, -0.0012925656714270189 + -0.003125549689493372i, 0.14807254486006907 + -7.115076756936123e-20i, 0.0229717590238835 + -0.02472338734988933i, -0.0029444709014042414 + 0.019165256337414487i, 0.0036361567264529726 + 0.0019204959253677667i }, { -0.007363657378106257 + 0.004372839036056997i, -0.0006828838176113389 + 0.02434582122225999i, 0.003867968226221799 + 0.0014007271961201597i, 0.013644114368862929 + 0.0011692861224161162i, 0.0229717590238835 + 0.024723387349889325i, 0.12601300962364198 + 3.3881317890172014e-20i, -0.0052743861323335224 + 0.002123416162685574i, -0.0009856823188267951 + 0.011124403620291832i }, { -0.011292986028201696 + 8.984155881899956e-05i, -0.001485987246819162 + 0.0027937048318662583i, 0.006753225920765283 + 0.0129232702824379i, 0.004885193708742569 + 0.0007427863522189878i, -0.0029444709014042414 + -0.019165256337414487i, -0.0052743861323335224 + -0.0021234161626855746i, 0.09408549259734368 + 6.466567156694549e-20i, 0.014021112362139708 + -0.01942907258850954i }, { -0.001272298656313162 + -0.002957155237092385i, -0.009626872463381637 + 0.003094765161312027i, -0.0025014764637690105 + 0.0018985264882899855i, 0.0012868475298191723 + 0.014461576624456915i, 0.003636156726452972 + -0.0019204959253677667i, -0.0009856823188267956 + -0.011124403620291832i, 0.014021112362139706 + 0.01942907258850954i, 0.0759748239116407 + 1.291725244562808e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.14433242993238754, 1.0e-7), DoubleNear(0.11902297218500082, 1.0e-7), DoubleNear(0.16338634175635178, 1.0e-7), DoubleNear(0.12911238513356446, 1.0e-7), DoubleNear(0.14807254486006907, 1.0e-7), DoubleNear(0.12601300962364198, 1.0e-7), DoubleNear(0.09408549259734368, 1.0e-7), DoubleNear(0.0759748239116407, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, true, false}), Matrix({ { 0.221946246249443 + -5.082197683525802e-21i, 0.033567630890508 + -0.04182614737197352i, -0.0025221338740016854 + 0.03691163015162299i, 0.00796478421551711 + 0.00580435885854894i, -0.04988479744249284 + 0.04003831866624293i, 6.044232115890607e-07 + 0.015456356887695468i, -0.006091851049168857 + -0.008751268498450688i, -0.002837256441761642 + 0.0001322270733675751i }, { 0.03356763089050801 + 0.04182614737197352i, 0.1859914195956357 + 9.825582188149884e-20i, -0.008954622584289942 + 0.004127898483060658i, 0.004134117704965334 + 0.024126830530085804i, -0.015089973997098306 + -0.0033453928576529695i, -0.041803564824170865 + 0.033552194969711735i, 0.0012679890904228267 + -0.0025431716994303855i, -0.00528158224477552 + -0.004676983501135146i }, { -0.0025221338740016846 + -0.03691163015162299i, -0.008954622584289942 + -0.004127898483060658i, 0.1954306939898045 + -4.1928130889087867e-20i, 0.029278301975257506 + -0.04326587359928152i, 0.007225604284950285 + 0.007841300418587669i, 0.0027573056945967367 + -0.0006875928539181819i, -0.04392514290496439 + 0.03525500672056732i, 0.0012243985903692383 + 0.015006171005124018i }, { 0.00796478421551711 + -0.00580435885854894i, 0.004134117704965334 + -0.024126830530085804i, 0.029278301975257506 + 0.04326587359928151i, 0.15566881594154183 + 6.606856988583543e-20i, -0.0007430847802988542 + 0.002741410790913593i, 0.0034232077257143607 + 0.006168543956626062i, -0.014385622879374524 + -0.0044427665384914414i, -0.034988234685568616 + 0.02808210440315033i }, { -0.04988479744249284 + -0.04003831866624293i, -0.015089973997098306 + 0.0033453928576529695i, 0.007225604284950285 + -0.007841300418587669i, -0.0007430847802988542 + -0.002741410790913593i, 0.07045872854301359 + -3.4728350837426314e-20i, 0.010656330677871586 + -0.013278067160324229i, -0.000800672906077004 + 0.01171791175963557i, 0.0025284886697929812 + 0.001842643216957594i }, { 6.044232115891149e-07 + -0.015456356887695468i, -0.04180356482417086 + -0.033552194969711735i, 0.0027573056945967367 + 0.0006875928539181819i, 0.0034232077257143607 + -0.006168543956626062i, 0.010656330677871586 + 0.013278067160324227i, 0.05904456221300711 + -5.082197683525802e-21i, -0.0028427213009159288 + 0.0013104365745578287i, 0.0013124109195865703 + 0.007659268095987789i }, { -0.006091851049168857 + 0.008751268498450687i, 0.001267989090422827 + 0.002543171699430386i, -0.04392514290496439 + -0.03525500672056732i, -0.014385622879374522 + 0.0044427665384914414i, -0.0008006729060770041 + -0.01171791175963557i, -0.0028427213009159288 + -0.001310436574557829i, 0.062041140363890926 + 1.5114244152568922e-20i, 0.009294646635999253 + -0.013735120528607567i }, { -0.0028372564417616423 + -0.0001322270733675751i, -0.00528158224477552 + 0.004676983501135147i, 0.0012243985903692385 + -0.015006171005124018i, -0.03498823468556861 + -0.02808210440315033i, 0.0025284886697929812 + -0.001842643216957594i, 0.0013124109195865705 + -0.007659268095987789i, 0.009294646635999252 + 0.013735120528607566i, 0.049418393103663354 + 1.0376153603865179e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.221946246249443, 1.0e-7), DoubleNear(0.1859914195956357, 1.0e-7), DoubleNear(0.1954306939898045, 1.0e-7), DoubleNear(0.15566881594154183, 1.0e-7), DoubleNear(0.07045872854301359, 1.0e-7), DoubleNear(0.05904456221300711, 1.0e-7), DoubleNear(0.062041140363890926, 1.0e-7), DoubleNear(0.049418393103663354, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false, true}), Matrix({ { 0.13815136257629312 + -3.7269449679189215e-20i, 0.020894311232323385 + -0.026034859108456244i, -0.0015699127026530275 + 0.022975797457857203i, 0.004957713007514323 + 0.003612947273228893i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020894311232323385 + 0.026034859108456244i, 0.11577113142863357 + 5.421010862427522e-20i, -0.005573842010311572 + 0.002569427551257243i, 0.0025732987317561903 + 0.015017845846478365i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0015699127026530275 + -0.022975797457857206i, -0.005573842010311572 + -0.002569427551257243i, 0.12164664697044783 + 1.7361528440752987e-19i, 0.018224400638234044 + -0.026931022676890213i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004957713007514324 + -0.003612947273228893i, 0.0025732987317561907 + -0.015017845846478365i, 0.01822440063823404 + 0.026931022676890213i, 0.09689670087410257 + 1.6559494118821572e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15425361221616346 + -2.541098841762901e-21i, 0.023329650336056204 + -0.02906935542384151i, -0.0017528940774256619 + 0.025653744453401364i, 0.005535559877795768 + 0.004034054802277641i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02332965033605621 + 0.029069355423841505i, 0.12926485038000923 + 3.8963515573697816e-20i, -0.006223501874894299 + 0.002868907506361244i, 0.0028732298927957142 + 0.016768252779595226i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.001752894077425661 + -0.02565374445340136i, -0.006223501874894299 + -0.002868907506361244i, 0.13582518738324761 + -2.0042917114404882e-19i, 0.020348547973022716 + -0.03006997145099887i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.005535559877795768 + -0.004034054802277641i, 0.0028732298927957134 + -0.016768252779595226i, 0.020348547973022716 + 0.030069971450998864i, 0.10819050817110262 + 4.235164736271502e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.13815136257629312, 1.0e-7), DoubleNear(0.11577113142863357, 1.0e-7), DoubleNear(0.12164664697044783, 1.0e-7), DoubleNear(0.09689670087410257, 1.0e-7), DoubleNear(0.15425361221616346, 1.0e-7), DoubleNear(0.12926485038000923, 1.0e-7), DoubleNear(0.13582518738324761, 1.0e-7), DoubleNear(0.10819050817110262, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, true, false}), Matrix({ { 0.2335699873960112 + -4.573977915173222e-20i, 0.03476696824505793 + -0.05157866247603102i, 0.0021614541479362923 + -0.03184972371326167i, -0.007488003329993437 + -0.004760199575861972i, -0.0524973578368184 + 0.04213520050130297i, 0.0014903597676883505 + 0.01786469539642526i, 0.005259767645722265 + 0.007548485429710976i, 0.002541732182596561 + -0.00028090347517020526i }, { 0.03476696824505793 + 0.05157866247603102i, 0.18834396082935786 + 6.776263578034403e-20i, 0.007612443567000123 + -0.005044956395419674i, 0.00045843091038567994 + -0.029456257660804116i, -0.01711885718904222 + -0.005321018923606594i, -0.04233232367863443 + 0.033976585096523716i, -0.0008008859648174456 + 0.0025071659406695535i, 0.0052107675501412995 + 0.006703308908533986i }, { 0.002161454147936291 + 0.03184972371326167i, 0.007612443567000122 + 0.005044956395419674i, 0.1838069528432363 + -1.2705494208814505e-21i, 0.02807896462070758 + -0.03351335849522402i, -0.0062313876138280185 + -0.006768648046380929i, -0.0026210705836651736 + 0.00023934990733260033i, -0.04131258251063882 + 0.033158124885507276i, -0.0002653567541075232 + 0.012597832496394228i }, { -0.007488003329993437 + 0.004760199575861972i, 0.00045843091038567945 + 0.029456257660804116i, 0.028078964620707584 + 0.03351335849522402i, 0.15331627470781964 + 9.656175598699024e-20i, 0.0008242858120995027 + -0.002420715214638277i, -0.005416842070367835 + -0.006537910275426679i, -0.012356739687430611 + -0.0024671404725378175i, -0.03445947583110505 + 0.027657714276338348i }, { -0.052497357836818415 + -0.04213520050130297i, -0.017118857189042217 + 0.005321018923606594i, -0.0062313876138280185 + 0.006768648046380929i, 0.0008242858120995027 + 0.002420715214638277i, 0.07414878429272809 + -1.4399560103323106e-20i, 0.011037070548555211 + -0.016374086245756952i, 0.0006861720513013455 + -0.010110966394811545i, -0.002377130511881831 + -0.0015111659484850102i }, { 0.001490359767688351 + -0.01786469539642526i, -0.04233232367863443 + -0.033976585096523716i, -0.0026210705836651736 + -0.00023934990733260038i, -0.005416842070367835 + 0.00653791027542668i, 0.011037070548555211 + 0.016374086245756952i, 0.05979139648920742 + 3.218725199566341e-20i, 0.0024166351262974685 + -0.0016015644291488313i, 0.00014553280182215417 + -0.009351140185912788i }, { 0.005259767645722265 + -0.007548485429710976i, -0.0008008859648174456 + -0.002507165940669554i, -0.04131258251063882 + -0.03315812488550728i, -0.012356739687430611 + 0.0024671404725378175i, 0.0006861720513013456 + 0.010110966394811545i, 0.002416635126297468 + 0.0016015644291488313i, 0.05835108461417643 + -5.2145465815342865e-21i, 0.008913906765315626 + -0.010639101443174842i }, { 0.002541732182596561 + 0.00028090347517020526i, 0.0052107675501412995 + -0.006703308908533986i, -0.0002653567541075232 + -0.012597832496394228i, -0.03445947583110505 + -0.027657714276338348i, -0.002377130511881831 + 0.0015111659484850102i, 0.00014553280182215392 + 0.009351140185912788i, 0.008913906765315626 + 0.010639101443174842i, 0.04867155882746304 + 6.649208635946258e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.2335699873960112, 1.0e-7), DoubleNear(0.18834396082935786, 1.0e-7), DoubleNear(0.1838069528432363, 1.0e-7), DoubleNear(0.15331627470781964, 1.0e-7), DoubleNear(0.07414878429272809, 1.0e-7), DoubleNear(0.05979139648920742, 1.0e-7), DoubleNear(0.05835108461417643, 1.0e-7), DoubleNear(0.04867155882746304, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false, true}), Matrix({ { 0.14538660851880725 + 6.776263578034403e-20i, 0.021640843748730536 + -0.032105352630825534i, 0.0013454061094954363 + -0.019824992776495833i, -0.004660938765559364 + -0.0029630059920063845i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.021640843748730536 + 0.03210535263082553i, 0.11723548048813676 + 8.639736061993863e-20i, 0.0047383971078035 + -0.0031402540567498395i, 0.00028535222373480954 + -0.018335169893636684i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0013454061094954359 + 0.019824992776495833i, 0.004738397107803499 + 0.0031402540567498395i, 0.1144114010279337 + 6.858319894799663e-20i, 0.01747786812182689 + -0.020860529154520933i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004660938765559364 + 0.0029630059920063845i, 0.0002853522237348089 + 0.018335169893636684i, 0.01747786812182689 + 0.02086052915452093i, 0.09543235181459936 + 1.334076891925523e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.16233216316993204 + -1.2790197503539935e-19i, 0.024163195044882603 + -0.035847396090962436i, 0.0015022200897422014 + -0.02213569733157738i, -0.005204195076315903 + -0.003308359532340598i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.024163195044882603 + 0.035847396090962436i, 0.13089987683042853 + 1.3552527156068805e-20i, 0.005290681585494091 + -0.003506266767818666i, 0.00031861148847302456 + -0.020472227953080218i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0015022200897422007 + 0.02213569733157738i, 0.005290681585494091 + 0.003506266767818666i, 0.12774663642947903 + -7.506829495041237e-20i, 0.01951500326419632 + -0.023291930783877937i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005204195076315903 + 0.003308359532340598i, 0.00031861148847302446 + 0.020472227953080218i, 0.01951500326419632 + 0.02329193078387793i, 0.10655548172068333 + 2.964615315390051e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.14538660851880725, 1.0e-7), DoubleNear(0.11723548048813676, 1.0e-7), DoubleNear(0.1144114010279337, 1.0e-7), DoubleNear(0.09543235181459936, 1.0e-7), DoubleNear(0.16233216316993204, 1.0e-7), DoubleNear(0.13089987683042853, 1.0e-7), DoubleNear(0.12774663642947903, 1.0e-7), DoubleNear(0.10655548172068333, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true, true}), Matrix({ { 0.19719634743869496 + 1.2536087619363645e-19i, 0.02969255657823962 + -0.04020307332285737i, -0.0443219924401106 + 0.035573524364525905i, 0.0005787720800796122 + 0.014392503885744135i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02969255657823962 + 0.04020307332285737i, 0.16142279080956318 + 2.0498197323554068e-19i, -0.013926212692258553 + -0.0036796392855572837i, -0.036281502202505325 + 0.02912010114000197i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.044321992440110605 + -0.035573524364525905i, -0.01392621269225855 + 0.0036796392855572837i, 0.06260166210804599 + 1.0984958534704208e-20i, 0.009426155292317804 + -0.012762808462489091i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0005787720800796122 + -0.014392503885744135i, -0.036281502202505325 + -0.02912010114000197i, 0.009426155292317804 + 0.01276280846248909i, 0.051245041493172924 + 1.4823076576950256e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.22018059280055255 + -1.7237120476625012e-19i, 0.03315337628752589 + -0.04488894764839767i, -0.049487947907346626 + 0.03971980102228434i, 0.0006462309335012153 + 0.01607002400707535i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03315337628752589 + 0.04488894764839767i, 0.18023744472761433 + -4.0657581468206416e-20i, -0.015549384184214279 + -0.004108520110587127i, -0.040510297307234155 + 0.03251419823286009i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04948794790734663 + -0.03971980102228435i, -0.015549384184214279 + 0.004108520110587127i, 0.06989820679885853 + -3.05990652195616e-20i, 0.010524822021553033 + -0.014250379226442704i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0006462309335012155 + -0.01607002400707535i, -0.040510297307234155 + -0.03251419823286009i, 0.010524822021553033 + 0.014250379226442704i, 0.057217913823497536 + 8.385626177817573e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.19719634743869496, 1.0e-7), DoubleNear(0.16142279080956318, 1.0e-7), DoubleNear(0.06260166210804599, 1.0e-7), DoubleNear(0.051245041493172924, 1.0e-7), DoubleNear(0.22018059280055255, 1.0e-7), DoubleNear(0.18023744472761433, 1.0e-7), DoubleNear(0.06989820679885853, 1.0e-7), DoubleNear(0.057217913823497536, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false, false, false}), Matrix({ { 0.18638552321972762 + 1.5246593050577406e-19i, -0.04601873426024559 + 0.07393386622296985i, 0.0 + 0.0i, 0.0 + 0.0i, 0.021755538975969504 + -0.0069997207409885865i, -0.0025948686443366857 + 0.010358043712748392i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04601873426024559 + -0.07393386622296987i, 0.16407054770548973 + 1.3721933745519665e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008148051186870354 + -0.006901570451187817i, 0.019150860720054275 + -0.006161680348991387i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.20230454172304124 + -1.164670302474663e-20i, -0.04994915261856572 + 0.08024849068571568i, 0.0 + 0.0i, 0.0 + 0.0i, 0.025152819532145307 + -0.012810049124032694i, -0.0011288669638347445 + 0.013140223546398593i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.04994915261856572 + -0.08024849068571568i, 0.17808366438780532 + -2.117582368135751e-21i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01129163542229903 + -0.00681460086587962i, 0.022141402431300104 + -0.011276368140655127i }, { 0.021755538975969504 + 0.0069997207409885865i, -0.008148051186870354 + 0.006901570451187816i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0648893167454641 + 3.0387306982748025e-20i, -0.01602122403100004 + 0.025739756933285663i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0025948686443366857 + -0.010358043712748392i, 0.019150860720054275 + 0.006161680348991387i, 0.0 + 0.0i, 0.0 + 0.0i, -0.016021224031000036 + -0.02573975693328566i, 0.05712045417879562 + 3.6078309597112855e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.025152819532145303 + 0.012810049124032694i, -0.01129163542229903 + 0.00681460086587962i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07825766917997647 + -1.3552527156068805e-19i, -0.019321880903668667 + 0.031042604297399717i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0011288669638347445 + -0.013140223546398593i, 0.022141402431300108 + 0.011276368140655127i, 0.0 + 0.0i, 0.0 + 0.0i, -0.019321880903668667 + -0.031042604297399717i, 0.0688882828596999 + -1.0482032722271967e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.18638552321972762, 1.0e-7), DoubleNear(0.16407054770548973, 1.0e-7), DoubleNear(0.20230454172304124, 1.0e-7), DoubleNear(0.17808366438780532, 1.0e-7), DoubleNear(0.0648893167454641, 1.0e-7), DoubleNear(0.05712045417879562, 1.0e-7), DoubleNear(0.07825766917997647, 1.0e-7), DoubleNear(0.0688882828596999, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false, false, false}), Matrix({ { 0.25127483996519173 + 1.8285323748852209e-19i, -0.06203995829124563 + 0.09967362315625553i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.062039958291245624 + -0.09967362315625553i, 0.22119100188428534 + 1.732976470523095e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2805622109030177 + -1.4717197458543468e-19i, -0.06927103352223439 + 0.1112910949831154i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.06927103352223439 + -0.1112910949831154i, 0.24697194724750526 + -1.2599615090407718e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25127483996519173, 1.0e-7), DoubleNear(0.22119100188428534, 1.0e-7), DoubleNear(0.2805622109030177, 1.0e-7), DoubleNear(0.24697194724750526, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false, false, false}), Matrix({ { 0.25127483996519173 + 1.8285323748852209e-19i, -0.06203995829124563 + 0.09967362315625553i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.062039958291245624 + -0.09967362315625553i, 0.22119100188428534 + 1.732976470523095e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2805622109030177 + -1.4717197458543468e-19i, -0.06927103352223439 + 0.1112910949831154i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.06927103352223439 + -0.1112910949831154i, 0.24697194724750526 + -1.2599615090407718e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25127483996519173, 1.0e-7), DoubleNear(0.22119100188428534, 1.0e-7), DoubleNear(0.2805622109030177, 1.0e-7), DoubleNear(0.24697194724750526, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false, false, false}), Matrix({ { 0.13504539036068078 + -3.3881317890172014e-21i, -0.03334281453153936 + 0.053568687376995466i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0005336378666005898 + 0.02020642720671652i, -0.008147073865440276 + -0.0047773039340851566i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03334281453153936 + -0.053568687376995466i, 0.11887710364424589 + 2.0328790734103208e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.007883562636133625 + -0.005200662035714619i, 0.00046974816250257376 + 0.01778721609761905i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.15078562301383724 + 3.9810548520952116e-20i, -0.037229090520936474 + 0.059812392548909354i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0005958360960284396 + 0.022561589900336243i, -0.009096657096248704 + -0.005334123201862501i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.037229090520936474 + -0.059812392548909354i, 0.13273283958233548 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.008802432282087892 + -0.005806825860884471i, 0.0005244997193416133 + 0.019860407332660344i }, { 0.0005336378666005895 + -0.02020642720671652i, 0.007883562636133625 + 0.005200662035714619i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11622944960451094 + 1.8624136927753929e-19i, -0.02869714375970627 + 0.04610493577926006i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008147073865440276 + 0.0047773039340851566i, 0.00046974816250257355 + -0.01778721609761905i, 0.0 + 0.0i, 0.0 + 0.0i, -0.02869714375970627 + -0.046104935779260066i, 0.10231389824003945 + 1.529688563182063e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.000595836096028439 + -0.022561589900336243i, 0.008802432282087892 + 0.005806825860884472i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12977658788918048 + -1.869825231063868e-19i, -0.03204194300129792 + 0.05147870243420604i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.009096657096248704 + 0.0053341232018625i, 0.0005244997193416133 + -0.01986040733266034i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03204194300129792 + -0.05147870243420604i, 0.11423910766516976 + -9.211483301390516e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13504539036068078, 1.0e-7), DoubleNear(0.11887710364424589, 1.0e-7), DoubleNear(0.15078562301383724, 1.0e-7), DoubleNear(0.13273283958233548, 1.0e-7), DoubleNear(0.11622944960451094, 1.0e-7), DoubleNear(0.10231389824003945, 1.0e-7), DoubleNear(0.12977658788918048, 1.0e-7), DoubleNear(0.11423910766516976, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true, false, false}), Matrix({ { 0.13967215731030153 + 1.2705494208814505e-19i, -0.03448516697962985 + 0.05540399498452272i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008672977026239307 + -0.020294988375134413i, 0.007836311467712489 + 0.005354881280102185i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03448516697962984 + -0.055403994984522725i, 0.1229499316966425 + 2.710505431213761e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00826458445600161 + 0.004666816335855487i, 0.0007634606306063149 + -0.0178651742949981i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.15595166337386063 + -7.030373462210693e-20i, -0.0385045900039374 + 0.061861614668108814i, 0.0 + 0.0i, 0.0 + 0.0i, 0.000968385696685693 + -0.02266047332700531i, 0.00874967374772042 + 0.005979020148920482i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0385045900039374 + -0.061861614668108814i, 0.1372803766265 + -4.404571325722362e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00922786414864191 + 0.0052107577075656015i, 0.000852445881529533 + -0.01994745195765229i }, { 0.0008672977026239297 + 0.020294988375134413i, -0.00826458445600161 + -0.004666816335855488i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11160268265489022 + 5.579829540037703e-20i, -0.027554791311615787 + 0.04426962817173281i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007836311467712489 + -0.005354881280102186i, 0.0007634606306063152 + 0.017865174294998103i, 0.0 + 0.0i, 0.0 + 0.0i, -0.027554791311615787 + -0.04426962817173281i, 0.09824107018764285 + 1.461925927401719e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0009683856966856934 + 0.022660473327005305i, -0.00922786414864191 + -0.005210757707565601i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12461054752915711 + -7.686823996332776e-20i, -0.030766443518296997 + 0.04942948031500658i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.00874967374772042 + -0.005979020148920482i, 0.0008524458815295323 + 0.01994745195765229i, 0.0 + 0.0i, 0.0 + 0.0i, -0.030766443518296997 + -0.04942948031500658i, 0.10969157062100525 + 3.14460981668159e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.13967215731030153, 1.0e-7), DoubleNear(0.1229499316966425, 1.0e-7), DoubleNear(0.15595166337386063, 1.0e-7), DoubleNear(0.1372803766265, 1.0e-7), DoubleNear(0.11160268265489022, 1.0e-7), DoubleNear(0.09824107018764285, 1.0e-7), DoubleNear(0.12461054752915711, 1.0e-7), DoubleNear(0.10969157062100525, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, true, false}), Matrix({ { 0.19072694487085232 + 1.759710947920809e-19i, -0.04709063472667429 + 0.07565598541992788i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04286792488040037 + 0.03440646699830048i, -0.0030639476448223206 + -0.025499477657337163i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04709063472667428 + -0.07565598541992788i, 0.16789219337740585 + 1.5437175463709624e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.024232197295131163 + 0.008509509399318358i, -0.03773556976221555 + 0.03028715850622739i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2129571481934163 + -1.9757043494706555e-19i, -0.05257928964783086 + 0.08447407842504978i, 0.0 + 0.0i, 0.0 + 0.0i, -0.047864401318236584 + 0.038416717136272455i, -0.0034210664523416892 + -0.028471572519579214i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.05257928964783086 + -0.08447407842504978i, 0.1874608893347506 + -1.545835128739098e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027056584133540458 + 0.009501336349884827i, -0.0421338438963442 + 0.03381728211887198i }, { -0.04286792488040037 + -0.03440646699830048i, 0.024232197295131163 + -0.00850950939931836i, 0.0 + 0.0i, 0.0 + 0.0i, 0.060547895094339416 + 6.88214269644119e-21i, -0.014949323564571343 + 0.024017637736327653i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0030639476448223206 + 0.025499477657337163i, -0.03773556976221556 + -0.030287158506227395i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014949323564571343 + -0.024017637736327653i, 0.053298808506879486 + 1.8925892415213273e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.047864401318236584 + -0.038416717136272455i, 0.027056584133540455 + -0.009501336349884829i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06760506270960143 + 5.039846036163087e-20i, -0.016691743874403534 + 0.02681701655806562i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.003421066452341689 + 0.028471572519579214i, -0.0421338438963442 + -0.033817282118871986i, 0.0 + 0.0i, 0.0 + 0.0i, -0.016691743874403534 + -0.02681701655806562i, 0.05951105791275464 + 2.8587361969832636e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.19072694487085232, 1.0e-7), DoubleNear(0.16789219337740585, 1.0e-7), DoubleNear(0.2129571481934163, 1.0e-7), DoubleNear(0.1874608893347506, 1.0e-7), DoubleNear(0.060547895094339416, 1.0e-7), DoubleNear(0.053298808506879486, 1.0e-7), DoubleNear(0.06760506270960143, 1.0e-7), DoubleNear(0.05951105791275464, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false, true}), Matrix({ { 0.25127483996519173 + 1.8285323748852209e-19i, -0.06203995829124563 + 0.09967362315625553i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008366940081300345 + -0.013235766743655673i, 0.007316058545754598 + -5.100715975870024e-05i }, { -0.062039958291245624 + -0.09967362315625553i, 0.22119100188428534 + 1.732976470523095e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.003184450194189182 + 0.006586849879569444i, -0.007365209583040534 + -0.01165111678965335i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008366940081300345 + 0.013235766743655675i, -0.0031844501941891827 + -0.006586849879569444i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2805622109030177 + -1.4717197458543468e-19i, -0.06927103352223439 + 0.1112910949831154i }, { 0.007316058545754598 + 5.100715975870024e-05i, -0.0073652095830405336 + 0.01165111678965335i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06927103352223439 + -0.1112910949831154i, 0.24697194724750526 + -1.2599615090407718e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.25127483996519173, 1.0e-7), DoubleNear(0.22119100188428534, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2805622109030177, 1.0e-7), DoubleNear(0.24697194724750526, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false, false, false}), Matrix({ { 0.38869006494276886 + 1.4081922748102743e-19i, -0.0959678868788113 + 0.15418235690868554i, 0.04690835850811481 + -0.01980976986502128i, -0.0037237356081714305 + 0.023498267259146985i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0959678868788113 + -0.15418235690868554i, 0.34215421209329505 + 1.351017550870609e-19i, -0.019439686609169386 + -0.013716171317067438i, 0.04129226315135438 + -0.017438048489646515i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04690835850811481 + 0.01980976986502128i, -0.019439686609169386 + 0.013716171317067438i, 0.14314698592544056 + -1.0513796457794003e-19i, -0.035343104934668704 + 0.05678236123068538i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0037237356081714305 + -0.023498267259146985i, 0.04129226315135438 + 0.017438048489646515i, -0.035343104934668704 + -0.05678236123068538i, 0.12600873703849552 + 2.5596276874840888e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.38869006494276886, 1.0e-7), DoubleNear(0.34215421209329505, 1.0e-7), DoubleNear(0.14314698592544056, 1.0e-7), DoubleNear(0.12600873703849552, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false, false, false}), Matrix({ { 0.38869006494276886 + 1.4081922748102743e-19i, -0.0959678868788113 + 0.15418235690868554i, 0.04690835850811481 + -0.01980976986502128i, -0.0037237356081714305 + 0.023498267259146985i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0959678868788113 + -0.15418235690868554i, 0.34215421209329505 + 1.351017550870609e-19i, -0.019439686609169386 + -0.013716171317067438i, 0.04129226315135438 + -0.017438048489646515i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04690835850811481 + 0.01980976986502128i, -0.019439686609169386 + 0.013716171317067438i, 0.14314698592544056 + -1.0513796457794003e-19i, -0.035343104934668704 + 0.05678236123068538i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0037237356081714305 + -0.023498267259146985i, 0.04129226315135438 + 0.017438048489646515i, -0.035343104934668704 + -0.05678236123068538i, 0.12600873703849552 + 2.5596276874840888e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.38869006494276886, 1.0e-7), DoubleNear(0.34215421209329505, 1.0e-7), DoubleNear(0.14314698592544056, 1.0e-7), DoubleNear(0.12600873703849552, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false, false, false}), Matrix({ { 0.20889796032418514 + 6.098637220230962e-20i, -0.05157707292713445 + 0.08286391338801607i, 0.02521047306918854 + -0.010646581666304668i, -0.0020012880273852303 + 0.01262893123422425i, 0.0008254695816486716 + 0.031256760542869994i, -0.012602482088099973 + -0.007389878654974504i, 0.0016926356382448908 + 0.0037300952549885343i, -0.0018975363918158415 + -0.00024954280063725745i }, { -0.05157707292713445 + -0.08286391338801607i, 0.18388768705251596 + 1.1858461261560205e-20i, -0.010447683767257576 + -0.0073716322335492844i, 0.022192153408288225 + -0.00937192146153198i, 0.012194863892635039 + -0.008044759533773187i, 0.000726640374401053 + 0.027514550128028524i, 0.0010617102150801542 + -0.0015923841831699476i, 0.0014899851202782497 + 0.003283510226049795i }, { 0.02521047306918854 + 0.010646581666304668i, -0.010447683767257576 + 0.007371632233549285i, 0.07693305305033288 + -2.456395547037471e-20i, -0.018994832125341386 + 0.03051716653788873i, -0.0014933950269407615 + 0.0038142361369812i, -0.0011442791892833674 + -0.0015341255178727615i, 0.0003040043809803578 + 0.011511256564182773i, -0.0046412488735890055 + -0.0027215484809731535i }, { -0.0020012880273852303 + -0.012628931234224249i, 0.02219215340828823 + 0.00937192146153198i, -0.018994832125341386 + -0.03051716653788873i, 0.06772225617406541 + 5.082197683525802e-21i, 0.0018817200345076087 + -0.000349350367608298i, -0.0013145985577537142 + 0.003357577355054686i, 0.004491131025586476 + -0.0029627283628259043i, 0.0002676075074431338 + 0.01013307330225087i }, { 0.0008254695816486706 + -0.031256760542869994i, 0.01219486389263504 + 0.008044759533773187i, -0.001493395026940762 + -0.0038142361369812i, 0.0018817200345076087 + 0.000349350367608298i, 0.17979210461858372 + 7.983285527871781e-20i, -0.04439081395167687 + 0.07131844352066946i, 0.02169788543892627 + -0.009163188198716612i, -0.0017224475807862002 + 0.010869336024922734i }, { -0.012602482088099973 + 0.007389878654974504i, 0.0007266403744010533 + -0.027514550128028524i, -0.0011442791892833674 + 0.0015341255178727615i, -0.0013145985577537142 + -0.003357577355054686i, -0.044390813951676864 + -0.07131844352066946i, 0.15826652504077912 + 1.232432938255007e-19i, -0.008992002841911808 + -0.006344539083518153i, 0.019100109743066154 + -0.008066127028114534i }, { 0.0016926356382448908 + -0.0037300952549885343i, 0.0010617102150801542 + 0.0015923841831699476i, 0.0003040043809803577 + -0.011511256564182773i, 0.004491131025586476 + 0.0029627283628259043i, 0.02169788543892627 + 0.009163188198716612i, -0.008992002841911808 + 0.006344539083518152i, 0.06621393287510768 + -8.057400910756532e-20i, -0.01634827280932732 + 0.02626519469279665i }, { -0.0018975363918158417 + 0.00024954280063725745i, 0.0014899851202782497 + -0.0032835102260497947i, -0.0046412488735890055 + 0.0027215484809731535i, 0.00026760750744313363 + -0.010133073302250868i, -0.0017224475807862002 + -0.010869336024922734i, 0.019100109743066154 + 0.008066127028114534i, -0.01634827280932732 + -0.02626519469279665i, 0.058286480864430106 + 2.0514079191315086e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.20889796032418514, 1.0e-7), DoubleNear(0.18388768705251596, 1.0e-7), DoubleNear(0.07693305305033288, 1.0e-7), DoubleNear(0.06772225617406541, 1.0e-7), DoubleNear(0.17979210461858372, 1.0e-7), DoubleNear(0.15826652504077912, 1.0e-7), DoubleNear(0.06621393287510768, 1.0e-7), DoubleNear(0.058286480864430106, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true, false, false}), Matrix({ { 0.21605497750255545 + 7.115076756936123e-20i, -0.053344146173693194 + 0.08570289970777077i, 0.026074204761690548 + -0.011011342374156553i, -0.002069853813133616 + 0.01306160888051401i, 0.0013415987068355465 + -0.031393753352450635i, 0.012121772373703908 + 0.008283316995892083i, -0.0014380888178331128 + -0.003857073627612408i, 0.0018850573085138936 + 0.00038186538732929516i }, { -0.0533441461736932 + -0.08570289970777077i, 0.19018783154929908 + -5.251604272976662e-20i, -0.010805630068314809 + -0.0076241904607634945i, 0.022952474968736508 + -0.009693011254799606i, -0.012784255954051199 + 0.007218968460634276i, 0.0011809760266197921 + -0.027635141496453165i, -0.0011749267575217428 + 0.0015227637193213008i, -0.0012659138752576982 + -0.0033952861343030903i }, { 0.026074204761690544 + 0.011011342374156553i, -0.010805630068314809 + 0.0076241904607634945i, 0.07956884318160665 + -1.4399560103323106e-20i, -0.019645610809874044 + 0.03156270994486076i, 0.0017619056518112658 + -0.00372032322398408i, 0.0010407311051580015 + 0.0016174489164045962i, 0.0004940846924740773 + -0.011561708349689085i, 0.004464212841728999 + 0.0030505844331305846i }, { -0.002069853813133616 + -0.013061608880514008i, 0.022952474968736508 + 0.009693011254799606i, -0.019645610809874044 + -0.03156270994486075i, 0.07004247677384341 + 3.5575383784680614e-20i, -0.0019107629250300032 + 0.0002196526229130527i, 0.0015509617930856308 + -0.0032749081498187685i, -0.004708192650592321 + 0.0026586055827868124i, 0.000434930485516056 + -0.010177484756197225i }, { 0.0013415987068355457 + 0.031393753352450635i, -0.012784255954051197 + -0.0072189684606342765i, 0.0017619056518112658 + 0.00372032322398408i, -0.0019107629250300032 + -0.00021965262291305277i, 0.17263508744021344 + 6.96684599116662e-20i, -0.04262374070511812 + 0.06847945720091478i, 0.020834153746424264 + -0.008798427490864728i, -0.0016538817950378145 + 0.010436658378632974i }, { 0.01212177237370391 + -0.008283316995892083i, 0.0011809760266197917 + 0.027635141496453165i, 0.0010407311051580015 + -0.001617448916404596i, 0.0015509617930856308 + 0.0032749081498187685i, -0.04262374070511811 + -0.06847945720091478i, 0.15196638054399597 + 1.8761779781682753e-19i, -0.008634056540854574 + -0.006091980856303943i, 0.018339788182617875 + -0.007745037234846908i }, { -0.001438088817833113 + 0.003857073627612408i, -0.0011749267575217428 + -0.001522763719321301i, 0.0004940846924740774 + 0.011561708349689085i, -0.004708192650592322 + -0.0026586055827868124i, 0.020834153746424264 + 0.008798427490864728i, -0.008634056540854574 + 0.006091980856303943i, 0.06357814274383392 + -9.073840447461692e-20i, -0.015697494124794664 + 0.025219651285824617i }, { 0.0018850573085138936 + -0.00038186538732929516i, -0.0012659138752576982 + 0.0033952861343030903i, 0.004464212841728999 + -0.003050584433130584i, 0.0004349304855160559 + 0.010177484756197225i, -0.0016538817950378145 + -0.010436658378632974i, 0.018339788182617875 + 0.007745037234846908i, -0.015697494124794664 + -0.025219651285824617i, 0.05596626026465211 + -9.979106909839726e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.21605497750255545, 1.0e-7), DoubleNear(0.19018783154929908, 1.0e-7), DoubleNear(0.07956884318160665, 1.0e-7), DoubleNear(0.07004247677384341, 1.0e-7), DoubleNear(0.17263508744021344, 1.0e-7), DoubleNear(0.15196638054399597, 1.0e-7), DoubleNear(0.06357814274383392, 1.0e-7), DoubleNear(0.05596626026465211, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, true, false}), Matrix({ { 0.2950302091465145 + 1.1265538198482195e-19i, -0.07284319382172438 + 0.11703014074252144i, 0.03560518796230751 + -0.015036351771126685i, -0.002826453759364551 + 0.017836058416022562i, -0.06631120134444314 + 0.05322240736029612i, -0.004739535439410513 + -0.03944443314742558i, -0.005290142840676424 + 0.009802631317034622i, -0.002582286148240729 + -0.004518727550099804i }, { -0.07284319382172438 + -0.11703014074252144i, 0.25970776682730257 + 9.613823951336309e-20i, -0.014755444821802717 + -0.010411083938972476i, 0.031342362803820974 + -0.013236127076633644i, 0.03748411238329821 + 0.013163123540384469i, -0.05837210388258443 + 0.04685036356345204i, 0.005194567117045737 + -0.00032182742259489013i, -0.004656781376130981 + 0.008629012926314154i }, { 0.0356051879623075 + 0.015036351771126685i, -0.014755444821802717 + 0.010411083938972474i, 0.10865388391775407 + -1.342547221398066e-19i, -0.026826730552780766 + 0.0430999231024562i, -0.01071515230998262 + 0.0030434689067480314i, 0.0014383215985601557 + -0.005001832804337055i, -0.02442112485419381 + 0.019600776774276817i, -0.0017454786577534962 + -0.014526617029490797i }, { -0.002826453759364551 + -0.017836058416022562i, 0.031342362803820974 + 0.013236127076633644i, -0.026826730552780766 + -0.043099923102456195i, 0.09564531588485384 + 4.277516383634217e-20i, 0.0038528376952852144 + 0.0034989630059799486i, -0.009432282496393558 + 0.0026790901022184406i, 0.013804669045373407 + 0.004847722208818719i, -0.021497309775975318 + 0.01725407706164734i }, { -0.06631120134444315 + -0.05322240736029612i, 0.03748411238329821 + -0.013163123540384469i, -0.01071515230998262 + -0.0030434689067480314i, 0.003852837695285214 + -0.0034989630059799486i, 0.09365985579625435 + 2.8163845496205486e-20i, -0.023124693057086934 + 0.03715221616616409i, 0.011303170545807307 + -0.004773418093894595i, -0.0008972818488068793 + 0.005662208843124421i }, { -0.004739535439410513 + 0.03944443314742558i, -0.05837210388258443 + -0.04685036356345204i, 0.0014383215985601554 + 0.005001832804337055i, -0.009432282496393558 + -0.00267909010221844i, -0.023124693057086938 + -0.0371522161661641i, 0.08244644526599244 + 3.8963515573697816e-20i, -0.004684241787366667 + -0.003305087378094962i, 0.009949900347533408 + -0.0042019214130128695i }, { -0.005290142840676424 + -0.009802631317034622i, 0.005194567117045737 + 0.0003218274225948902i, -0.02442112485419381 + -0.019600776774276817i, 0.013804669045373407 + -0.004847722208818719i, 0.011303170545807305 + 0.004773418093894595i, -0.004684241787366667 + 0.0033050873780949615i, 0.0344931020076865 + 2.9116757561866574e-20i, -0.008516374381887942 + 0.013682438128229179i }, { -0.002582286148240729 + 0.0045187275500998035i, -0.004656781376130981 + -0.008629012926314152i, -0.0017454786577534962 + 0.014526617029490797i, -0.021497309775975318 + -0.017254077061647333i, -0.0008972818488068794 + -0.005662208843124421i, 0.009949900347533406 + 0.0042019214130128695i, -0.008516374381887942 + -0.013682438128229179i, 0.030363421153641677 + -1.717888696150128e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2950302091465145, 1.0e-7), DoubleNear(0.25970776682730257, 1.0e-7), DoubleNear(0.10865388391775407, 1.0e-7), DoubleNear(0.09564531588485384, 1.0e-7), DoubleNear(0.09365985579625435, 1.0e-7), DoubleNear(0.08244644526599244, 1.0e-7), DoubleNear(0.0344931020076865, 1.0e-7), DoubleNear(0.030363421153641677, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false, true}), Matrix({ { 0.18638552321972762 + 1.5246593050577406e-19i, -0.04601873426024559 + 0.07393386622296985i, 0.021755538975969504 + -0.0069997207409885865i, -0.0025948686443366857 + 0.010358043712748392i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04601873426024559 + -0.07393386622296987i, 0.16407054770548973 + 1.3721933745519665e-19i, -0.008148051186870354 + -0.006901570451187817i, 0.019150860720054275 + -0.006161680348991387i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.021755538975969504 + 0.0069997207409885865i, -0.008148051186870354 + 0.006901570451187816i, 0.0648893167454641 + 3.0387306982748025e-20i, -0.01602122403100004 + 0.025739756933285663i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0025948686443366857 + -0.010358043712748392i, 0.019150860720054275 + 0.006161680348991387i, -0.016021224031000036 + -0.02573975693328566i, 0.05712045417879562 + 3.6078309597112855e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20230454172304124 + -1.164670302474663e-20i, -0.04994915261856572 + 0.08024849068571568i, 0.025152819532145307 + -0.012810049124032694i, -0.0011288669638347445 + 0.013140223546398593i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04994915261856572 + -0.08024849068571568i, 0.17808366438780532 + -2.117582368135751e-21i, -0.01129163542229903 + -0.00681460086587962i, 0.022141402431300104 + -0.011276368140655127i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.025152819532145303 + 0.012810049124032694i, -0.01129163542229903 + 0.00681460086587962i, 0.07825766917997647 + -1.3552527156068805e-19i, -0.019321880903668667 + 0.031042604297399717i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0011288669638347445 + -0.013140223546398593i, 0.022141402431300108 + 0.011276368140655127i, -0.019321880903668667 + -0.031042604297399717i, 0.0688882828596999 + -1.0482032722271967e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.18638552321972762, 1.0e-7), DoubleNear(0.16407054770548973, 1.0e-7), DoubleNear(0.0648893167454641, 1.0e-7), DoubleNear(0.05712045417879562, 1.0e-7), DoubleNear(0.20230454172304124, 1.0e-7), DoubleNear(0.17808366438780532, 1.0e-7), DoubleNear(0.07825766917997647, 1.0e-7), DoubleNear(0.0688882828596999, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false, false, false}), Matrix({ { 0.5318370508682094 + 3.56812629030874e-20i, -0.13131099181348002 + 0.21096471813937093i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13131099181348002 + -0.21096471813937093i, 0.4681629491317906 + 1.606980319619018e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5318370508682094, 1.0e-7), DoubleNear(0.4681629491317906, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false, false, false}), Matrix({ { 0.285831013374518 + 3.6422416731934915e-20i, -0.07057190505247583 + 0.11338107992590482i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0011294739626290294 + 0.04276801710705276i, -0.01724373096168898 + -0.010111427135947659i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07057190505247583 + -0.11338107992590482i, 0.25160994322658137 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.016685994918221515 + -0.01100748789659909i, 0.000994247881844187 + 0.037647623430279394i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0011294739626290283 + -0.04276801710705276i, 0.016685994918221515 + 0.01100748789659909i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24600603749369143 + -7.411538288475128e-22i, -0.060739086761004195 + 0.0975836382134661i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01724373096168898 + 0.010111427135947657i, 0.0009942478818441868 + -0.03764762343027939i, 0.0 + 0.0i, 0.0 + 0.0i, -0.060739086761004195 + -0.0975836382134661i, 0.2165530059052092 + 1.4375737301681579e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.285831013374518, 1.0e-7), DoubleNear(0.25160994322658137, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24600603749369143, 1.0e-7), DoubleNear(0.2165530059052092, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true, false, false}), Matrix({ { 0.29562382068416215 + 5.675120746603812e-20i, -0.07298975698356724 + 0.11726560965263153i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0018356833993096236 + -0.04295546170213972i, 0.01658598521543291 + 0.011333901429022667i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07298975698356724 + -0.11726560965263154i, 0.26023030832314253 + -1.6940658945086007e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01749244860464352 + 0.00987757404342109i, 0.001615906512135848 + -0.03781262625265039i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001835683399309623 + 0.04295546170213972i, -0.01749244860464352 + -0.00987757404342109i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23621323018404733 + -2.106994456295072e-20i, -0.058321234829912784 + 0.09369910848673939i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01658598521543291 + -0.011333901429022668i, 0.0016159065121358475 + 0.03781262625265039i, 0.0 + 0.0i, 0.0 + 0.0i, -0.058321234829912784 + -0.09369910848673939i, 0.2079326408086481 + 1.776386909069878e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.29562382068416215, 1.0e-7), DoubleNear(0.26023030832314253, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23621323018404733, 1.0e-7), DoubleNear(0.2079326408086481, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, true, false}), Matrix({ { 0.4036840930642686 + -2.159934015498466e-20i, -0.09966992437450514 + 0.16013006384497766i, 0.0 + 0.0i, 0.0 + 0.0i, -0.09073232619863696 + 0.07282318413457294i, -0.00648501409716401 + -0.05397105017691638i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09966992437450514 + -0.16013006384497766i, 0.3553530827121565 + 1.3891340334970526e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05128878142867162 + 0.018010845749203183i, -0.07986941365855975 + 0.06410444062509937i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09073232619863696 + -0.07282318413457294i, 0.05128878142867162 + -0.01801084574920319i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12815295780394084 + 5.728060305807206e-20i, -0.03164106743897488 + 0.050834654294393274i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006485014097164009 + 0.05397105017691638i, -0.07986941365855976 + -0.06410444062509937i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03164106743897488 + -0.050834654294393274i, 0.11280986641963413 + 2.1784628612196537e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4036840930642686, 1.0e-7), DoubleNear(0.3553530827121565, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12815295780394084, 1.0e-7), DoubleNear(0.11280986641963413, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false, true}), Matrix({ { 0.25127483996519173 + 1.8285323748852209e-19i, -0.06203995829124563 + 0.09967362315625553i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.062039958291245624 + -0.09967362315625553i, 0.22119100188428534 + 1.732976470523095e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2805622109030177 + -1.4717197458543468e-19i, -0.06927103352223439 + 0.1112910949831154i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06927103352223439 + -0.1112910949831154i, 0.24697194724750526 + -1.2599615090407718e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.25127483996519173, 1.0e-7), DoubleNear(0.22119100188428534, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2805622109030177, 1.0e-7), DoubleNear(0.24697194724750526, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false, false, false}), Matrix({ { 0.285831013374518 + 3.6422416731934915e-20i, -0.07057190505247583 + 0.11338107992590482i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0011294739626290294 + 0.04276801710705276i, -0.01724373096168898 + -0.010111427135947659i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07057190505247583 + -0.11338107992590482i, 0.25160994322658137 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.016685994918221515 + -0.01100748789659909i, 0.000994247881844187 + 0.037647623430279394i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0011294739626290283 + -0.04276801710705276i, 0.016685994918221515 + 0.01100748789659909i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24600603749369143 + -7.411538288475128e-22i, -0.060739086761004195 + 0.0975836382134661i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01724373096168898 + 0.010111427135947657i, 0.0009942478818441868 + -0.03764762343027939i, 0.0 + 0.0i, 0.0 + 0.0i, -0.060739086761004195 + -0.0975836382134661i, 0.2165530059052092 + 1.4375737301681579e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.285831013374518, 1.0e-7), DoubleNear(0.25160994322658137, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24600603749369143, 1.0e-7), DoubleNear(0.2165530059052092, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true, false, false}), Matrix({ { 0.29562382068416215 + 5.675120746603812e-20i, -0.07298975698356724 + 0.11726560965263153i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0018356833993096236 + -0.04295546170213972i, 0.01658598521543291 + 0.011333901429022667i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07298975698356724 + -0.11726560965263154i, 0.26023030832314253 + -1.6940658945086007e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01749244860464352 + 0.00987757404342109i, 0.001615906512135848 + -0.03781262625265039i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001835683399309623 + 0.04295546170213972i, -0.01749244860464352 + -0.00987757404342109i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23621323018404733 + -2.106994456295072e-20i, -0.058321234829912784 + 0.09369910848673939i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01658598521543291 + -0.011333901429022668i, 0.0016159065121358475 + 0.03781262625265039i, 0.0 + 0.0i, 0.0 + 0.0i, -0.058321234829912784 + -0.09369910848673939i, 0.2079326408086481 + 1.776386909069878e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.29562382068416215, 1.0e-7), DoubleNear(0.26023030832314253, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23621323018404733, 1.0e-7), DoubleNear(0.2079326408086481, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, true, false}), Matrix({ { 0.4036840930642686 + -2.159934015498466e-20i, -0.09966992437450514 + 0.16013006384497766i, 0.0 + 0.0i, 0.0 + 0.0i, -0.09073232619863696 + 0.07282318413457294i, -0.00648501409716401 + -0.05397105017691638i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09966992437450514 + -0.16013006384497766i, 0.3553530827121565 + 1.3891340334970526e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05128878142867162 + 0.018010845749203183i, -0.07986941365855975 + 0.06410444062509937i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09073232619863696 + -0.07282318413457294i, 0.05128878142867162 + -0.01801084574920319i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12815295780394084 + 5.728060305807206e-20i, -0.03164106743897488 + 0.050834654294393274i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006485014097164009 + 0.05397105017691638i, -0.07986941365855976 + -0.06410444062509937i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03164106743897488 + -0.050834654294393274i, 0.11280986641963413 + 2.1784628612196537e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4036840930642686, 1.0e-7), DoubleNear(0.3553530827121565, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12815295780394084, 1.0e-7), DoubleNear(0.11280986641963413, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false, true}), Matrix({ { 0.25127483996519173 + 1.8285323748852209e-19i, -0.06203995829124563 + 0.09967362315625553i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.062039958291245624 + -0.09967362315625553i, 0.22119100188428534 + 1.732976470523095e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2805622109030177 + -1.4717197458543468e-19i, -0.06927103352223439 + 0.1112910949831154i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06927103352223439 + -0.1112910949831154i, 0.24697194724750526 + -1.2599615090407718e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.25127483996519173, 1.0e-7), DoubleNear(0.22119100188428534, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2805622109030177, 1.0e-7), DoubleNear(0.24697194724750526, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true, false, false}), Matrix({ { 0.14006216039232322 + 5.336307567702092e-20i, -0.03458145905147212 + 0.05555869817817552i, 0.0032196750607369 + 0.026658853683345345i, -0.011369753703501555 + -0.005304938178857609i, -0.0024403255534130013 + -0.028391185484699377i, 0.011864498725479494 + 0.00604179819169561i, -0.011125955844743948 + -0.0016936918462095657i, 0.003418847026224648 + -0.0039951781832361245i }, { -0.03458145905147212 + -0.05555869817817552i, 0.12329324172506514 + 3.7269449679189215e-20i, 0.009779873025379134 + -0.007859246272210204i, 0.0028342000039673527 + 0.023467126896280496i, -0.010659462076591159 + 0.00797781446473881i, -0.002148157985725983 + -0.02499205556319592i, 0.0020751677080302713 + 0.004831525917148681i, -0.009793902646839384 + -0.0014909148739214602i }, { 0.0032196750607368994 + -0.026658853683345345i, 0.009779873025379134 + 0.007859246272210206i, 0.15556166029183888 + 3.3881317890172014e-21i, -0.03840829793209512 + 0.061706911474456005i, 0.013030105872987103 + 0.0008165183595423238i, -0.0035410332697180403 + 0.004967075484648927i, 0.004276008952722625 + -0.014564276217440345i, 0.004721486489953414 + 0.005292103237327058i }, { -0.011369753703501555 + 0.005304938178857608i, 0.0028342000039673527 + -0.023467126896280492i, -0.03840829793209512 + -0.06170691147445601i, 0.13693706659807736 + -5.421010862427522e-20i, -0.0028932537842712713 + -0.005370273552366805i, 0.011470078632240227 + 0.0007187608358604411i, -0.0068329865280523615 + 0.0018997595786822796i, 0.003764064497861831 + -0.01282057068945447i }, { -0.002440325553413002 + 0.028391185484699374i, -0.010659462076591159 + -0.00797781446473881i, 0.013030105872987106 + -0.0008165183595423243i, -0.002893253784271272 + 0.005370273552366805i, 0.1457688529821948 + -1.6940658945086007e-20i, -0.03599044600100371 + 0.05782238174772929i, -0.0020902010981078707 + 0.01610916342370742i, -0.0058739772581874235 + -0.00480648895709005i }, { 0.011864498725479494 + -0.006041798191695611i, -0.0021481579857259825 + 0.02499205556319592i, -0.003541033269718041 + -0.004967075484648927i, 0.011470078632240227 + -0.0007187608358604413i, -0.03599044600100371 + -0.05782238174772929i, 0.12831670150151625 + -2.0328790734103208e-20i, 0.006906121892842383 + -0.003148241624388886i, -0.001839952122123166 + 0.014180496533998898i }, { -0.011125955844743948 + 0.001693691846209566i, 0.002075167708030271 + -0.004831525917148681i, 0.004276008952722626 + 0.014564276217440345i, -0.006832986528052361 + -0.0018997595786822794i, -0.002090201098107871 + -0.01610916342370742i, 0.006906121892842383 + 0.003148241624388886i, 0.09044437720185253 + -4.129285617864714e-21i, -0.02233078882890907 + 0.035876726739010094i }, { 0.003418847026224648 + 0.0039951781832361245i, -0.009793902646839384 + 0.0014909148739214605i, 0.004721486489953414 + -0.005292103237327058i, 0.00376406449786183 + 0.01282057068945447i, -0.0058739772581874235 + 0.004806488957090049i, -0.001839952122123166 + -0.014180496533998896i, -0.02233078882890907 + -0.0358767267390101i, 0.07961593930713186 + 1.97967481641091e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.14006216039232322, 1.0e-7), DoubleNear(0.12329324172506514, 1.0e-7), DoubleNear(0.15556166029183888, 1.0e-7), DoubleNear(0.13693706659807736, 1.0e-7), DoubleNear(0.1457688529821948, 1.0e-7), DoubleNear(0.12831670150151625, 1.0e-7), DoubleNear(0.09044437720185253, 1.0e-7), DoubleNear(0.07961593930713186, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, true, false}), Matrix({ { 0.21695636514110772 + 7.792703114739563e-20i, -0.05356669950019328 + 0.08606045469343991i, 0.0008573127267069454 + 0.03246251491849517i, -0.0130886328490089 + -0.007674949096338817i, -0.04876326818683843 + 0.03913816174402288i, -0.00348531217995144 + -0.029006252835847873i, -0.006048813221297682 + -0.007141641941774867i, 0.0043263442043493605 + -0.0006361160607469499i }, { -0.05356669950019328 + -0.08606045469343991i, 0.19098130070397096 + 1.5246593050577406e-20i, 0.01266529045774664 + -0.008355092525427755i, 0.0007546711042567046 + 0.028575945763213637i, 0.027564691753929976 + 0.009679766168646605i, -0.04292509407982527 + 0.034452351891931784i, -0.0013394305920447784 + 0.004162670237520875i, -0.005324620072646695 + -0.0062866100578109685i }, { 0.0008573127267069448 + -0.03246251491849516i, 0.012665290457746642 + 0.008355092525427755i, 0.18672772792316086 + -9.952637130238029e-20i, -0.04610322487431187 + 0.07406960915153774i, 0.005663432775001852 + 0.007450954315636243i, -0.0043538889365490885 + 0.0004068770642871952i, -0.04196905801179852 + 0.03368502239055005i, -0.0029997019172125694 + -0.024964797341068504i }, { -0.0130886328490089 + 0.007674949096338815i, 0.0007546711042567043 + -0.028575945763213637i, -0.04610322487431187 + -0.07406960915153774i, 0.16437178200818547 + 1.2366681029912785e-19i, 0.0015572768030377427 + -0.004086170184410834i, 0.004985379235662792 + 0.006558890059577488i, 0.02372408967474164 + 0.00833107958055658i, -0.03694431957873449 + 0.02965208873316759i }, { -0.04876326818683843 + -0.03913816174402289i, 0.027564691753929976 + -0.009679766168646605i, 0.005663432775001853 + -0.007450954315636243i, 0.0015572768030377427 + 0.004086170184410834i, 0.0688746482334103 + -4.1504614415460717e-20i, -0.017005205552282555 + 0.027320625232464903i, 0.000272161235922084 + 0.010305502188557603i, -0.004155098112680078 + -0.0024364780396088415i }, { -0.00348531217995144 + 0.029006252835847873i, -0.04292509407982526 + -0.034452351891931784i, -0.0043538889365490885 + -0.00040687706428719513i, 0.004985379235662793 + -0.006558890059577488i, -0.017005205552282555 + -0.027320625232464903i, 0.0606286425226104 + 1.6940658945086007e-21i, 0.004020704460474877 + -0.002652395371171336i, 0.00023957677758748247 + 0.009071677667065757i }, { -0.006048813221297682 + 0.007141641941774867i, -0.0013394305920447782 + -0.004162670237520875i, -0.041969058011798524 + -0.03368502239055005i, 0.02372408967474164 + -0.008331079580556584i, 0.00027216123592208367 + -0.010305502188557605i, 0.004020704460474877 + 0.002652395371171336i, 0.059278309570530555 + 9.878521747353278e-20i, -0.014635861886692322 + 0.023514029061928364i }, { 0.0043263442043493605 + 0.0006361160607469499i, -0.005324620072646695 + 0.0062866100578109685i, -0.0029997019172125694 + 0.024964797341068504i, -0.03694431957873449 + -0.029652088733167593i, -0.004155098112680078 + 0.002436478039608842i, 0.00023957677758748255 + -0.009071677667065755i, -0.014635861886692322 + -0.023514029061928364i, 0.05218122389702372 + 2.0090562717687936e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.21695636514110772, 1.0e-7), DoubleNear(0.19098130070397096, 1.0e-7), DoubleNear(0.18672772792316086, 1.0e-7), DoubleNear(0.16437178200818547, 1.0e-7), DoubleNear(0.0688746482334103, 1.0e-7), DoubleNear(0.0606286425226104, 1.0e-7), DoubleNear(0.059278309570530555, 1.0e-7), DoubleNear(0.05218122389702372, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false, true}), Matrix({ { 0.13504539036068078 + -3.3881317890172014e-21i, -0.03334281453153936 + 0.053568687376995466i, 0.0005336378666005898 + 0.02020642720671652i, -0.008147073865440276 + -0.0047773039340851566i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03334281453153936 + -0.053568687376995466i, 0.11887710364424589 + 2.0328790734103208e-20i, 0.007883562636133625 + -0.005200662035714619i, 0.00046974816250257376 + 0.01778721609761905i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0005336378666005895 + -0.02020642720671652i, 0.007883562636133625 + 0.005200662035714619i, 0.11622944960451094 + 1.8624136927753929e-19i, -0.02869714375970627 + 0.04610493577926006i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008147073865440276 + 0.0047773039340851566i, 0.00046974816250257355 + -0.01778721609761905i, -0.02869714375970627 + -0.046104935779260066i, 0.10231389824003945 + 1.529688563182063e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15078562301383724 + 3.9810548520952116e-20i, -0.037229090520936474 + 0.059812392548909354i, 0.0005958360960284396 + 0.022561589900336243i, -0.009096657096248704 + -0.005334123201862501i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.037229090520936474 + -0.059812392548909354i, 0.13273283958233548 + -3.3881317890172014e-21i, 0.008802432282087892 + -0.005806825860884471i, 0.0005244997193416133 + 0.019860407332660344i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.000595836096028439 + -0.022561589900336243i, 0.008802432282087892 + 0.005806825860884472i, 0.12977658788918048 + -1.869825231063868e-19i, -0.03204194300129792 + 0.05147870243420604i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.009096657096248704 + 0.0053341232018625i, 0.0005244997193416133 + -0.01986040733266034i, -0.03204194300129792 + -0.05147870243420604i, 0.11423910766516976 + -9.211483301390516e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.13504539036068078, 1.0e-7), DoubleNear(0.11887710364424589, 1.0e-7), DoubleNear(0.11622944960451094, 1.0e-7), DoubleNear(0.10231389824003945, 1.0e-7), DoubleNear(0.15078562301383724, 1.0e-7), DoubleNear(0.13273283958233548, 1.0e-7), DoubleNear(0.12977658788918048, 1.0e-7), DoubleNear(0.11423910766516976, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, true, false}), Matrix({ { 0.22438946994434272 + 1.0164395367051604e-20i, -0.05540193900141448 + 0.08900895716643412i, 0.0013933519430316442 + -0.03260479233456452i, 0.012589379375391736 + 0.008602852531213753i, -0.05043393815194999 + 0.0404790675886616i, -0.003604721862579192 + -0.030000031087699386i, 0.005568618559579868 + 0.007579632270432445i, -0.004381522136934925 + 0.00033749625668703454i }, { -0.05540193900141448 + -0.08900895716643413i, 0.1975244782810264 + 1.1858461261560205e-20i, -0.013277418786282885 + 0.0074974459054408665i, 0.0012265331152903278 + -0.02870118903950126i, 0.02850908092888028 + 0.010011402976608252i, -0.044395743363502854 + 0.03563271800916508i, 0.0016317294141613354 + -0.004080330756040405i, 0.004901916636283697 + 0.006672162067812517i }, { 0.0013933519430316436 + 0.032604792334564515i, -0.013277418786282885 + -0.0074974459054408665i, 0.1792946231199259 + -3.176373552203626e-20i, -0.04426798537309067 + 0.07112110667854352i, -0.006194960123078257 + -0.007076920735075988i, 0.004336754918468219 + -0.0007100681212885582i, -0.040298388046686964 + 0.032344116545911336i, -0.0028802922345848173 + -0.02397101908921699i }, { 0.012589379375391736 + -0.008602852531213755i, 0.0012265331152903273 + 0.02870118903950126i, -0.04426798537309067 + -0.07112110667854352i, 0.15782860443113006 + 1.2705494208814505e-19i, -0.0012776737330622658 + 0.0042046628630095055i, -0.005453269561117597 + -0.00622963758673162i, 0.02277970049979134 + 0.007999442772594935i, -0.03547367029505691 + 0.028471722615934288i }, { -0.05043393815194999 + -0.0404790675886616i, 0.02850908092888028 + -0.010011402976608252i, -0.006194960123078257 + 0.007076920735075988i, -0.0012776737330622658 + -0.004204662863009505i, 0.0712343507398194 + 4.658681209898652e-20i, -0.017587817982152767 + 0.02825665248619741i, 0.0004423314562779794 + -0.010350669367575201i, 0.003996605840041173 + 0.0027310488978089143i }, { -0.003604721862579192 + 0.030000031087699386i, -0.04439574336350285 + -0.03563271800916509i, 0.004336754918468219 + 0.0007100681212885583i, -0.005453269561117597 + 0.006229637586731621i, -0.017587817982152767 + -0.02825665248619741i, 0.0627058300421161 + -2.879912020664621e-20i, -0.004215029818360636 + 0.0023801281379802223i, 0.00038937339684552025 + -0.009111437213149134i }, { 0.005568618559579867 + -0.007579632270432444i, 0.0016317294141613352 + 0.004080330756040405i, -0.040298388046686964 + -0.032344116545911336i, 0.022779700499791337 + -0.007999442772594935i, 0.0004423314562779795 + 0.010350669367575201i, -0.004215029818360636 + -0.0023801281379802223i, 0.05691860706412145 + 1.0693790959085542e-20i, -0.014053249456822112 + 0.022578001808195865i }, { -0.004381522136934925 + -0.0003374962566870345i, 0.004901916636283697 + -0.006672162067812517i, -0.0028802922345848173 + 0.02397101908921699i, -0.03547367029505691 + -0.02847172261593429i, 0.003996605840041173 + -0.0027310488978089147i, 0.00038937339684552003 + 0.009111437213149134i, -0.014053249456822112 + -0.022578001808195865i, 0.05010403637751802 + 5.058374881884275e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.22438946994434272, 1.0e-7), DoubleNear(0.1975244782810264, 1.0e-7), DoubleNear(0.1792946231199259, 1.0e-7), DoubleNear(0.15782860443113006, 1.0e-7), DoubleNear(0.0712343507398194, 1.0e-7), DoubleNear(0.0627058300421161, 1.0e-7), DoubleNear(0.05691860706412145, 1.0e-7), DoubleNear(0.05010403637751802, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false, true}), Matrix({ { 0.13967215731030153 + 1.2705494208814505e-19i, -0.03448516697962985 + 0.05540399498452272i, 0.0008672977026239307 + -0.020294988375134413i, 0.007836311467712489 + 0.005354881280102185i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03448516697962984 + -0.055403994984522725i, 0.1229499316966425 + 2.710505431213761e-20i, -0.00826458445600161 + 0.004666816335855487i, 0.0007634606306063149 + -0.0178651742949981i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0008672977026239297 + 0.020294988375134413i, -0.00826458445600161 + -0.004666816335855488i, 0.11160268265489022 + 5.579829540037703e-20i, -0.027554791311615787 + 0.04426962817173281i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007836311467712489 + -0.005354881280102186i, 0.0007634606306063152 + 0.017865174294998103i, -0.027554791311615787 + -0.04426962817173281i, 0.09824107018764285 + 1.461925927401719e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15595166337386063 + -7.030373462210693e-20i, -0.0385045900039374 + 0.061861614668108814i, 0.000968385696685693 + -0.02266047332700531i, 0.00874967374772042 + 0.005979020148920482i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0385045900039374 + -0.061861614668108814i, 0.1372803766265 + -4.404571325722362e-20i, -0.00922786414864191 + 0.0052107577075656015i, 0.000852445881529533 + -0.01994745195765229i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0009683856966856934 + 0.022660473327005305i, -0.00922786414864191 + -0.005210757707565601i, 0.12461054752915711 + -7.686823996332776e-20i, -0.030766443518296997 + 0.04942948031500658i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00874967374772042 + -0.005979020148920482i, 0.0008524458815295323 + 0.01994745195765229i, -0.030766443518296997 + -0.04942948031500658i, 0.10969157062100525 + 3.14460981668159e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.13967215731030153, 1.0e-7), DoubleNear(0.1229499316966425, 1.0e-7), DoubleNear(0.11160268265489022, 1.0e-7), DoubleNear(0.09824107018764285, 1.0e-7), DoubleNear(0.15595166337386063, 1.0e-7), DoubleNear(0.1372803766265, 1.0e-7), DoubleNear(0.12461054752915711, 1.0e-7), DoubleNear(0.10969157062100525, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true, true}), Matrix({ { 0.19072694487085232 + 1.759710947920809e-19i, -0.04709063472667429 + 0.07565598541992788i, -0.04286792488040037 + 0.03440646699830048i, -0.0030639476448223206 + -0.025499477657337163i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04709063472667428 + -0.07565598541992788i, 0.16789219337740585 + 1.5437175463709624e-19i, 0.024232197295131163 + 0.008509509399318358i, -0.03773556976221555 + 0.03028715850622739i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04286792488040037 + -0.03440646699830048i, 0.024232197295131163 + -0.00850950939931836i, 0.060547895094339416 + 6.88214269644119e-21i, -0.014949323564571343 + 0.024017637736327653i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0030639476448223206 + 0.025499477657337163i, -0.03773556976221556 + -0.030287158506227395i, -0.014949323564571343 + -0.024017637736327653i, 0.053298808506879486 + 1.8925892415213273e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2129571481934163 + -1.9757043494706555e-19i, -0.05257928964783086 + 0.08447407842504978i, -0.047864401318236584 + 0.038416717136272455i, -0.0034210664523416892 + -0.028471572519579214i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05257928964783086 + -0.08447407842504978i, 0.1874608893347506 + -1.545835128739098e-20i, 0.027056584133540458 + 0.009501336349884827i, -0.0421338438963442 + 0.03381728211887198i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.047864401318236584 + -0.038416717136272455i, 0.027056584133540455 + -0.009501336349884829i, 0.06760506270960143 + 5.039846036163087e-20i, -0.016691743874403534 + 0.02681701655806562i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.003421066452341689 + 0.028471572519579214i, -0.0421338438963442 + -0.033817282118871986i, -0.016691743874403534 + -0.02681701655806562i, 0.05951105791275464 + 2.8587361969832636e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.19072694487085232, 1.0e-7), DoubleNear(0.16789219337740585, 1.0e-7), DoubleNear(0.060547895094339416, 1.0e-7), DoubleNear(0.053298808506879486, 1.0e-7), DoubleNear(0.2129571481934163, 1.0e-7), DoubleNear(0.1874608893347506, 1.0e-7), DoubleNear(0.06760506270960143, 1.0e-7), DoubleNear(0.05951105791275464, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false, false, false}), Matrix({ { 0.35045607092521736 + 2.896852679609707e-19i, 0.0 + 0.0i, 0.040906399696023776 + -0.013161401089979975i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.3803882061108466 + -1.376428539288238e-20i, 0.0 + 0.0i, 0.04729422196344541 + -0.02408641726468782i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.040906399696023776 + 0.013161401089979973i, 0.0 + 0.0i, 0.1220097709242597 + 6.646561657986088e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.04729422196344542 + 0.02408641726468782i, 0.0 + 0.0i, 0.1471459520396764 + -1.4600730428296002e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.35045607092521736, 1.0e-7), DoubleNear(0.3803882061108466, 1.0e-7), DoubleNear(0.1220097709242597, 1.0e-7), DoubleNear(0.1471459520396764, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false, false, false}), Matrix({ { 0.35045607092521736 + 2.896852679609707e-19i, 0.0 + 0.0i, 0.040906399696023776 + -0.013161401089979975i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.3803882061108466 + -1.376428539288238e-20i, 0.0 + 0.0i, 0.04729422196344541 + -0.02408641726468782i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.040906399696023776 + 0.013161401089979973i, 0.0 + 0.0i, 0.1220097709242597 + 6.646561657986088e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.04729422196344542 + 0.02408641726468782i, 0.0 + 0.0i, 0.1471459520396764 + -1.4600730428296002e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.35045607092521736, 1.0e-7), DoubleNear(0.3803882061108466, 1.0e-7), DoubleNear(0.1220097709242597, 1.0e-7), DoubleNear(0.1471459520396764, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false, false, false}), Matrix({ { 0.18834944600471154 + 1.1858461261560205e-20i, 0.0 + 0.0i, 0.02198477458373794 + -0.007073475992009589i, 0.0 + 0.0i, 0.0007442712133521402 + 0.028182149423648058i, 0.0 + 0.0i, 0.0011452563136326796 + 0.003261563178633217i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.20443620137198953 + 6.098637220230962e-20i, 0.0 + 0.0i, 0.02541785189373883 + -0.012945027135827058i, 0.0 + 0.0i, 0.0008078387426975842 + 0.030589161247250453i, 0.0 + 0.0i, 0.002037364444890461 + 0.0037520423024051115i }, { 0.02198477458373794 + 0.007073475992009589i, 0.0 + 0.0i, 0.06557304800021514 + 5.082197683525802e-21i, 0.0 + 0.0i, -0.0009715086844062828 + 0.003317465488630546i, 0.0 + 0.0i, 0.00025911481575102306 + 0.009811493880687508i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.02541785189373883 + 0.012945027135827058i, 0.0 + 0.0i, 0.07908226122418316 + -2.456395547037471e-20i, 0.0 + 0.0i, -0.0018364849002881932 + 0.00385434800340534i, 0.0 + 0.0i, 0.0003124970726724685 + 0.011832835985746134i }, { 0.0007442712133521399 + -0.02818214942364806i, 0.0 + 0.0i, -0.0009715086844062828 + -0.003317465488630546i, 0.0 + 0.0i, 0.16210662492050582 + 2.778268066994105e-19i, 0.0 + 0.0i, 0.018921625112285838 + -0.0060879250979703845i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0008078387426975837 + -0.030589161247250453i, 0.0 + 0.0i, -0.0018364849002881934 + -0.00385434800340534i, 0.0 + 0.0i, 0.17595200473885703 + -7.4750657595192e-20i, 0.0 + 0.0i, 0.021876370069706587 + -0.011141390128860762i }, { 0.0011452563136326796 + -0.0032615631786332175i, 0.0 + 0.0i, 0.00025911481575102295 + -0.009811493880687508i, 0.0 + 0.0i, 0.018921625112285838 + 0.0060879250979703845i, 0.0 + 0.0i, 0.056436722924044565 + 6.138341889633508e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0020373644448904603 + -0.003752042302405111i, 0.0 + 0.0i, 0.0003124970726724684 + -0.011832835985746132i, 0.0 + 0.0i, 0.021876370069706587 + 0.011141390128860762i, 0.0 + 0.0i, 0.06806369081549321 + -1.214433488125853e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.18834944600471154, 1.0e-7), DoubleNear(0.20443620137198953, 1.0e-7), DoubleNear(0.06557304800021514, 1.0e-7), DoubleNear(0.07908226122418316, 1.0e-7), DoubleNear(0.16210662492050582, 1.0e-7), DoubleNear(0.17595200473885703, 1.0e-7), DoubleNear(0.056436722924044565, 1.0e-7), DoubleNear(0.06806369081549321, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true, false, false}), Matrix({ { 0.19480245405945887 + 1.2705494208814505e-19i, 0.0 + 0.0i, 0.02273799117385797 + -0.007315819139386608i, 0.0 + 0.0i, 0.0012096306388102987 + -0.028305666760778114i, 0.0 + 0.0i, -0.0009218290843394212 + -0.0033493594477849104i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.21144035499239566 + -1.0842021724855044e-19i, 0.0 + 0.0i, 0.026288688556569087 + -0.013388534489569552i, 0.0 + 0.0i, 0.0013129440946450402 + -0.030723228088125686i, 0.0 + 0.0i, -0.0017821736087513898 + -0.003903000314130588i }, { 0.02273799117385797 + 0.007315819139386608i, 0.0 + 0.0i, 0.06781963494748514 + 2.710505431213761e-20i, 0.0 + 0.0i, 0.0012042133173481248 + -0.003258503929339586i, 0.0 + 0.0i, 0.0004211276944199473 + -0.009854495909354402i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.026288688556569087 + 0.013388534489569552i, 0.0 + 0.0i, 0.08179168500796494 + -5.929230630780102e-21i, 0.0 + 0.0i, 0.0021086541275487716 + -0.0037367274444632627i, 0.0 + 0.0i, 0.0005078874835701861 + -0.01188469719653191i }, { 0.001209630638810298 + 0.028305666760778114i, 0.0 + 0.0i, 0.0012042133173481248 + 0.003258503929339586i, 0.0 + 0.0i, 0.15565361686575852 + 1.6263032587282567e-19i, 0.0 + 0.0i, 0.018168408522165815 + -0.005845581950593366i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0013129440946450393 + 0.030723228088125686i, 0.0 + 0.0i, 0.002108654127548772 + 0.0037367274444632627i, 0.0 + 0.0i, 0.16894785111845093 + 9.465593185566806e-20i, 0.0 + 0.0i, 0.021005533406876328 + -0.010697882775118269i }, { -0.0009218290843394213 + 0.0033493594477849104i, 0.0 + 0.0i, 0.0004211276944199471 + 0.0098544959093544i, 0.0 + 0.0i, 0.018168408522165815 + 0.005845581950593366i, 0.0 + 0.0i, 0.054190135976774564 + 3.936056226772327e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.00178217360875139 + 0.003903000314130588i, 0.0 + 0.0i, 0.0005078874835701861 + 0.01188469719653191i, 0.0 + 0.0i, 0.02100553340687633 + 0.010697882775118267i, 0.0 + 0.0i, 0.06535426703171146 + -1.4007807365217992e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.19480245405945887, 1.0e-7), DoubleNear(0.21144035499239566, 1.0e-7), DoubleNear(0.06781963494748514, 1.0e-7), DoubleNear(0.08179168500796494, 1.0e-7), DoubleNear(0.15565361686575852, 1.0e-7), DoubleNear(0.16894785111845093, 1.0e-7), DoubleNear(0.054190135976774564, 1.0e-7), DoubleNear(0.06535426703171146, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, true, false}), Matrix({ { 0.2660091863087795 + 2.846030702774449e-19i, 0.0 + 0.0i, 0.0310494780964515 + -0.009989992712599162i, 0.0 + 0.0i, -0.05978841544335921 + 0.04798711737439726i, 0.0 + 0.0i, -0.005176543569675239 + 0.007846574072755306i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2887287896650377 + -7.580944877925988e-20i, 0.0 + 0.0i, 0.03589807266967698 + -0.018282486135161168i, 0.0 + 0.0i, -0.06489488978366836 + 0.05208565354935089i, 0.0 + 0.0i, -0.004770380647132167 + 0.010585070170593468i }, { 0.0310494780964515 + 0.00998999271259916i, 0.0 + 0.0i, 0.09260995193947866 + 4.573977915173222e-20i, 0.0 + 0.0i, -0.00878086234919588 + 0.003355858222937329i, 0.0 + 0.0i, -0.020815079199256716 + 0.01670650813013061i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.035898072669676984 + 0.018282486135161168i, 0.0 + 0.0i, 0.11168924786312925 + -1.3721933745519665e-19i, 0.0 + 0.0i, -0.011366572457180299 + 0.002366700786029143i, 0.0 + 0.0i, -0.02510335543091241 + 0.020148345705793547i }, { -0.05978841544335922 + -0.047987117374397266i, 0.0 + 0.0i, -0.00878086234919588 + -0.003355858222937329i, 0.0 + 0.0i, 0.08444688461643787 + 5.082197683525802e-21i, 0.0 + 0.0i, 0.009856921599572278 + -0.003171408377380813i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.06489488978366836 + -0.052085653549350894i, 0.0 + 0.0i, -0.011366572457180299 + -0.002366700786029143i, 0.0 + 0.0i, 0.09165941644580894 + 6.20451633863775e-20i, 0.0 + 0.0i, 0.011396149293768434 + -0.005803931129526652i }, { -0.005176543569675238 + -0.007846574072755307i, 0.0 + 0.0i, -0.020815079199256716 + -0.01670650813013061i, 0.0 + 0.0i, 0.009856921599572278 + 0.003171408377380813i, 0.0 + 0.0i, 0.029399818984781043 + 2.072583742812866e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.004770380647132166 + -0.010585070170593468i, 0.0 + 0.0i, -0.02510335543091241 + -0.020148345705793547i, 0.0 + 0.0i, 0.011396149293768434 + 0.005803931129526652i, 0.0 + 0.0i, 0.03545670417654714 + -8.787966827763366e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2660091863087795, 1.0e-7), DoubleNear(0.2887287896650377, 1.0e-7), DoubleNear(0.09260995193947866, 1.0e-7), DoubleNear(0.11168924786312925, 1.0e-7), DoubleNear(0.08444688461643787, 1.0e-7), DoubleNear(0.09165941644580894, 1.0e-7), DoubleNear(0.029399818984781043, 1.0e-7), DoubleNear(0.03545670417654714, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false, true}), Matrix({ { 0.35045607092521736 + 2.896852679609707e-19i, 0.0 + 0.0i, 0.040906399696023776 + -0.013161401089979975i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01042182962531358 + -0.054568242631897i, 0.0 + 0.0i, -0.04032806919465804 + 0.004467409293914867i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.040906399696023776 + 0.013161401089979973i, 0.0 + 0.0i, 0.1220097709242597 + 6.646561657986088e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06837172458240821 + 0.025520412074000416i, 0.0 + 0.0i, -0.026153979289654454 + 0.029681359098587975i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01042182962531358 + 0.054568242631897i, 0.0 + 0.0i, -0.06837172458240821 + -0.025520412074000416i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3803882061108466 + -1.376428539288238e-20i, 0.0 + 0.0i, 0.04729422196344541 + -0.02408641726468782i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04032806919465804 + -0.004467409293914867i, 0.0 + 0.0i, -0.026153979289654454 + -0.029681359098587972i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04729422196344542 + 0.02408641726468782i, 0.0 + 0.0i, 0.1471459520396764 + -1.4600730428296002e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.35045607092521736, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1220097709242597, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3803882061108466, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1471459520396764, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false, false, false}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false, false, false}), Matrix({ { 0.25392249400492667 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0010033860291031632 + 0.037993643304335564i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.28351846259617275 + 3.6422416731934915e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0011203358153700524 + 0.04242199723299659i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010033860291031628 + -0.037993643304335564i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21854334784455037 + 3.392102255957456e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.001120335815370052 + -0.04242199723299659i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24401569555435026 + -1.9619400640777732e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.25392249400492667, 1.0e-7), DoubleNear(0.28351846259617275, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21854334784455037, 1.0e-7), DoubleNear(0.24401569555435026, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true, false, false}), Matrix({ { 0.262622089006944 + 1.5415999640028266e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001630758333230246 + -0.038160162670132516i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2932320400003606 + -1.1434944787933055e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0018208315782152263 + -0.042607925284657594i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016307583332302454 + 0.038160162670132516i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2098437528425331 + 2.0199088814054893e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0018208315782152257 + 0.042607925284657594i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23430211815016236 + -4.5422141796511856e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.262622089006944, 1.0e-7), DoubleNear(0.2932320400003606, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2098437528425331, 1.0e-7), DoubleNear(0.23430211815016236, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, true, false}), Matrix({ { 0.3586191382482582 + 3.3034284942917713e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08060349464261593 + 0.06469362550452787i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4004180375281669 + -2.1302878623445654e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08999824521458077 + 0.07223399925514443i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08060349464261593 + -0.06469362550452787i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11384670360121893 + 2.5808035111654463e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.08999824521458077 + -0.07223399925514444i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12711612062235605 + 5.3257196558614134e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3586191382482582, 1.0e-7), DoubleNear(0.4004180375281669, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11384670360121893, 1.0e-7), DoubleNear(0.12711612062235605, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false, true}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01573214966434088 + -0.024886883533309024i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01573214966434088 + 0.024886883533309024i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false, false, false}), Matrix({ { 0.25392249400492667 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0010033860291031632 + 0.037993643304335564i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.28351846259617275 + 3.6422416731934915e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0011203358153700524 + 0.04242199723299659i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010033860291031628 + -0.037993643304335564i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21854334784455037 + 3.392102255957456e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.001120335815370052 + -0.04242199723299659i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24401569555435026 + -1.9619400640777732e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.25392249400492667, 1.0e-7), DoubleNear(0.28351846259617275, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21854334784455037, 1.0e-7), DoubleNear(0.24401569555435026, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true, false, false}), Matrix({ { 0.262622089006944 + 1.5415999640028266e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001630758333230246 + -0.038160162670132516i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2932320400003606 + -1.1434944787933055e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0018208315782152263 + -0.042607925284657594i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016307583332302454 + 0.038160162670132516i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2098437528425331 + 2.0199088814054893e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0018208315782152257 + 0.042607925284657594i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23430211815016236 + -4.5422141796511856e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.262622089006944, 1.0e-7), DoubleNear(0.2932320400003606, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2098437528425331, 1.0e-7), DoubleNear(0.23430211815016236, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, true, false}), Matrix({ { 0.3586191382482582 + 3.3034284942917713e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08060349464261593 + 0.06469362550452787i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4004180375281669 + -2.1302878623445654e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08999824521458077 + 0.07223399925514443i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08060349464261593 + -0.06469362550452787i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11384670360121893 + 2.5808035111654463e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.08999824521458077 + -0.07223399925514444i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12711612062235605 + 5.3257196558614134e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3586191382482582, 1.0e-7), DoubleNear(0.4004180375281669, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11384670360121893, 1.0e-7), DoubleNear(0.12711612062235605, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false, true}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01573214966434088 + -0.024886883533309024i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01573214966434088 + 0.024886883533309024i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true, false, false}), Matrix({ { 0.12442643176699944 + 3.049318610115481e-20i, 0.0 + 0.0i, 0.002860249178897053 + 0.02368281361308346i, 0.0 + 0.0i, -0.0021679017381317687 + -0.02522175792234741i, 0.0 + 0.0i, -0.00988391855359785 + -0.0015046178949862073i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.13892897035038893 + 6.013933925505532e-20i, 0.0 + 0.0i, 0.003193625885807199 + 0.026443166966542378i, 0.0 + 0.0i, -0.0024205818010072156 + -0.028161483125547886i, 0.0 + 0.0i, -0.011035939937985483 + -0.0016799888251448189i }, { 0.002860249178897053 + -0.02368281361308346i, 0.0 + 0.0i, 0.13819565723994454 + 1.2366681029912785e-19i, 0.0 + 0.0i, 0.011575500297729744 + 0.0007253669775299551i, 0.0 + 0.0i, 0.003798660071362015 + -0.012938404747785105i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.003193625885807199 + -0.026443166966542378i, 0.0 + 0.0i, 0.1543030696499717 + -1.7448878713438587e-19i, 0.0 + 0.0i, 0.012924684207497587 + 0.0008099122178728098i, 0.0 + 0.0i, 0.004241413379222442 + -0.014446442159109708i }, { -0.002167901738131769 + 0.02522175792234741i, 0.0 + 0.0i, 0.011575500297729744 + -0.0007253669775299555i, 0.0 + 0.0i, 0.12949606223792726 + -1.3552527156068805e-20i, 0.0 + 0.0i, -0.0018568631497938898 + 0.014310829691252108i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.002420581801007216 + 0.028161483125547886i, 0.0 + 0.0i, 0.012924684207497587 + -0.0008099122178728102i, 0.0 + 0.0i, 0.1445894922457838 + -2.371692252312041e-20i, 0.0 + 0.0i, -0.0020732900704371468 + 0.01597883026645421i }, { -0.00988391855359785 + 0.0015046178949862073i, 0.0 + 0.0i, 0.0037986600713620145 + 0.012938404747785107i, 0.0 + 0.0i, -0.00185686314979389 + -0.01431082969125211i, 0.0 + 0.0i, 0.08034769060460584 + 2.1554341529661774e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.011035939937985484 + 0.001679988825144819i, 0.0 + 0.0i, 0.004241413379222441 + 0.014446442159109708i, 0.0 + 0.0i, -0.0020732900704371468 + -0.01597883026645421i, 0.0 + 0.0i, 0.08971262590437856 + -2.1705219273391446e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.12442643176699944, 1.0e-7), DoubleNear(0.13892897035038893, 1.0e-7), DoubleNear(0.13819565723994454, 1.0e-7), DoubleNear(0.1543030696499717, 1.0e-7), DoubleNear(0.12949606223792726, 1.0e-7), DoubleNear(0.1445894922457838, 1.0e-7), DoubleNear(0.08034769060460584, 1.0e-7), DoubleNear(0.08971262590437856, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, true, false}), Matrix({ { 0.19273661271560577 + 4.573977915173222e-20i, 0.0 + 0.0i, 0.0007616072977439869 + 0.02883858771117975i, 0.0 + 0.0i, -0.04331961926611909 + 0.03476900397714674i, 0.0 + 0.0i, -0.0053735587359423015 + -0.006344390385551245i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.21520105312947294 + 4.743384504624082e-20i, 0.0 + 0.0i, 0.0008503765332196626 + 0.03219987297052905i, 0.0 + 0.0i, -0.04836874300054461 + 0.03882150965880793i, 0.0 + 0.0i, -0.005999874558002076 + -0.00708386161403459i }, { 0.0007616072977439864 + -0.02883858771117975i, 0.0 + 0.0i, 0.16588252553265237 + 2.846030702774449e-19i, 0.0 + 0.0i, 0.005031199931315494 + 0.006619172916915517i, 0.0 + 0.0i, -0.037283875376496835 + 0.02992462152738113i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0008503765332196621 + -0.03219987297052905i, 0.0 + 0.0i, 0.18521698439869397 + -2.6046263128069735e-19i, 0.0 + 0.0i, 0.005617612079349151 + 0.007390671458298214i, 0.0 + 0.0i, -0.041629502214036176 + 0.03341248959633651i }, { -0.043319619266119096 + -0.034769003977146745i, 0.0 + 0.0i, 0.005031199931315494 + -0.006619172916915515i, 0.0 + 0.0i, 0.06118588128932092 + -2.879912020664621e-20i, 0.0 + 0.0i, 0.0002417787313591764 + 0.009155055593155818i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.048368743000544605 + -0.03882150965880793i, 0.0 + 0.0i, 0.0056176120793491515 + -0.007390671458298214i, 0.0 + 0.0i, 0.06831740946669979 + -1.1011428314305904e-20i, 0.0 + 0.0i, 0.0002699592821503899 + 0.01022212426246754i }, { -0.0053735587359423015 + 0.006344390385551245i, 0.0 + 0.0i, -0.037283875376496835 + -0.029924621527381134i, 0.0 + 0.0i, 0.00024177873135917646 + -0.009155055593155818i, 0.0 + 0.0i, 0.052660822311897997 + 5.460715531830067e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0059998745580020765 + 0.00708386161403459i, 0.0 + 0.0i, -0.041629502214036176 + -0.03341248959633651i, 0.0 + 0.0i, 0.0002699592821503899 + -0.01022212426246754i, 0.0 + 0.0i, 0.05879871115565628 + 6.426862487292004e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.19273661271560577, 1.0e-7), DoubleNear(0.21520105312947294, 1.0e-7), DoubleNear(0.16588252553265237, 1.0e-7), DoubleNear(0.18521698439869397, 1.0e-7), DoubleNear(0.06118588128932092, 1.0e-7), DoubleNear(0.06831740946669979, 1.0e-7), DoubleNear(0.052660822311897997, 1.0e-7), DoubleNear(0.05879871115565628, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false, true}), Matrix({ { 0.25392249400492667 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0010033860291031632 + 0.037993643304335564i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008455101564995026 + -0.01337523049296175i, 0.0 + 0.0i, 0.001967883970406347 + -0.0013179637104876961i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010033860291031628 + -0.037993643304335564i, 0.0 + 0.0i, 0.21854334784455037 + 3.392102255957456e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002034705390211712 + 0.0012122580740865974i, 0.0 + 0.0i, -0.007277048099345852 + -0.011511653040347273i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008455101564995026 + 0.01337523049296175i, 0.0 + 0.0i, -0.0020347053902117123 + -0.0012122580740865974i, 0.0 + 0.0i, 0.0 + 0.0i, 0.28351846259617275 + 3.6422416731934915e-20i, 0.0 + 0.0i, 0.0011203358153700524 + 0.04242199723299659i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0019678839704063474 + 0.0013179637104876961i, 0.0 + 0.0i, -0.007277048099345853 + 0.011511653040347274i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001120335815370052 + -0.04242199723299659i, 0.0 + 0.0i, 0.24401569555435026 + -1.9619400640777732e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.25392249400492667, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21854334784455037, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28351846259617275, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24401569555435026, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, true, false}), Matrix({ { 0.1993399287363357 + 1.6432439176733427e-19i, 0.0 + 0.0i, 0.0012378061996289563 + -0.028964982100306347i, 0.0 + 0.0i, -0.04480378530951622 + 0.03596021885714408i, 0.0 + 0.0i, 0.004946970225928259 + 0.006733486009884515i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2225740194890334 + -1.4230153513872246e-19i, 0.0 + 0.0i, 0.0013820788586930166 + -0.03234099927375943i, 0.0 + 0.0i, -0.050025896205936615 + 0.0401515667406826i, 0.0 + 0.0i, 0.005523564969935306 + 0.007518308328360444i }, { 0.0012378061996289559 + 0.028964982100306347i, 0.0 + 0.0i, 0.15927920951192248 + 1.6601845766184287e-19i, 0.0 + 0.0i, -0.0055033906437996615 + -0.006286894279631998i, 0.0 + 0.0i, -0.03579970933309971 + 0.02873340664738379i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0013820788586930157 + 0.03234099927375943i, 0.0 + 0.0i, 0.1778440180391335 + -7.072725109573408e-20i, 0.0 + 0.0i, -0.006144839040396191 + -0.007019664042175612i, 0.0 + 0.0i, -0.03997234900864416 + 0.032082432514461835i }, { -0.04480378530951622 + -0.03596021885714409i, 0.0 + 0.0i, -0.0055033906437996615 + 0.006286894279631997i, 0.0 + 0.0i, 0.06328216027060832 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.00039295213360128977 + -0.00919518056982617i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.050025896205936615 + -0.0401515667406826i, 0.0 + 0.0i, -0.006144839040396191 + 0.007019664042175612i, 0.0 + 0.0i, 0.07065802051132719 + 2.795208725939191e-20i, 0.0 + 0.0i, 0.00043875271952220987 + -0.010266926010898163i }, { 0.004946970225928259 + -0.006733486009884515i, 0.0 + 0.0i, -0.03579970933309971 + -0.02873340664738379i, 0.0 + 0.0i, 0.00039295213360128966 + 0.00919518056982617i, 0.0 + 0.0i, 0.050564543330610605 + 3.597243047870607e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0055235649699353065 + -0.007518308328360444i, 0.0 + 0.0i, -0.03997234900864416 + -0.03208243251446184i, 0.0 + 0.0i, 0.00043875271952221 + 0.010266926010898163i, 0.0 + 0.0i, 0.05645810011102887 + 2.5305109299222223e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1993399287363357, 1.0e-7), DoubleNear(0.2225740194890334, 1.0e-7), DoubleNear(0.15927920951192248, 1.0e-7), DoubleNear(0.1778440180391335, 1.0e-7), DoubleNear(0.06328216027060832, 1.0e-7), DoubleNear(0.07065802051132719, 1.0e-7), DoubleNear(0.050564543330610605, 1.0e-7), DoubleNear(0.05645810011102887, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false, true}), Matrix({ { 0.262622089006944 + 1.5415999640028266e-19i, 0.0 + 0.0i, 0.001630758333230246 + -0.038160162670132516i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008744780349084758 + -0.013833476970113716i, 0.0 + 0.0i, -0.002064366927205711 + 0.001184756331676518i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016307583332302454 + 0.038160162670132516i, 0.0 + 0.0i, 0.2098437528425331 + 2.0199088814054893e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001955765069072132 + -0.0013565549639382936i, 0.0 + 0.0i, -0.00698736931525612 + -0.011053406563195308i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008744780349084758 + 0.013833476970113716i, 0.0 + 0.0i, 0.001955765069072132 + 0.0013565549639382936i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2932320400003606 + -1.1434944787933055e-19i, 0.0 + 0.0i, 0.0018208315782152263 + -0.042607925284657594i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0020643669272057104 + -0.0011847563316765178i, 0.0 + 0.0i, -0.00698736931525612 + 0.011053406563195308i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0018208315782152257 + 0.042607925284657594i, 0.0 + 0.0i, 0.23430211815016236 + -4.5422141796511856e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.262622089006944, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2098437528425331, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2932320400003606, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23430211815016236, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true, true}), Matrix({ { 0.3586191382482582 + 3.3034284942917713e-19i, 0.0 + 0.0i, -0.08060349464261593 + 0.06469362550452787i, 0.0 + 0.0i, 0.0 + 0.0i, -0.011941286450113333 + -0.0188900697909997i, 0.0 + 0.0i, 0.0060916339543169735 + 0.0020915797445040653i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08060349464261593 + -0.06469362550452787i, 0.0 + 0.0i, 0.11384670360121893 + 2.5808035111654463e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0007237697454562392 + 0.006399911516307812i, 0.0 + 0.0i, -0.0037908632142275456 + -0.005996813742309325i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011941286450113333 + 0.0188900697909997i, 0.0 + 0.0i, -0.000723769745456239 + -0.006399911516307811i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4004180375281669 + -2.1302878623445654e-19i, 0.0 + 0.0i, -0.08999824521458077 + 0.07223399925514443i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0060916339543169735 + -0.0020915797445040666i, 0.0 + 0.0i, -0.003790863214227545 + 0.005996813742309325i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08999824521458077 + -0.07223399925514444i, 0.0 + 0.0i, 0.12711612062235605 + 5.3257196558614134e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3586191382482582, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11384670360121893, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4004180375281669, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12711612062235605, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false, false, false}), Matrix({ { 0.7308442770360639 + 2.7592098256808834e-19i, 0.08820062165946918 + -0.0372478183546678i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0882006216594692 + 0.03724781835466779i, 0.2691557229639361 + -7.954168770309914e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.7308442770360639, 1.0e-7), DoubleNear(0.2691557229639361, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false, false, false}), Matrix({ { 0.3927856473767011 + 7.284483346386983e-20i, 0.04740262647747677 + -0.020018503127836648i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0015521099560497245 + 0.05877131067089851i, 0.0031826207585231407 + 0.007013605481038328i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04740262647747677 + 0.020018503127836648i, 0.1446553092243983 + -1.9481757786848908e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002807993584694476 + 0.007171813492035886i, 0.0005716118884234915 + 0.021644329866433644i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0015521099560497236 + -0.05877131067089851i, -0.002807993584694476 + -0.007171813492035886i, 0.0 + 0.0i, 0.0 + 0.0i, 0.33805862965936284 + 2.030761491042185e-19i, 0.040797995181992425 + -0.017229315226831146i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00318262075852314 + -0.007013605481038328i, 0.0005716118884234913 + -0.02164432986643364i, 0.0 + 0.0i, 0.0 + 0.0i, 0.040797995181992425 + 0.017229315226831146i, 0.12450041373953777 + -6.005992991625023e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3927856473767011, 1.0e-7), DoubleNear(0.1446553092243983, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.33805862965936284, 1.0e-7), DoubleNear(0.12450041373953777, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true, false, false}), Matrix({ { 0.4062428090518545 + 1.8634724839594607e-20i, 0.049026679730427056 + -0.02070435362895616i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0025225747334553386 + -0.0590288948489038i, -0.002704002693090811 + -0.0072523597619154985i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.049026679730427056 + 0.02070435362895616i, 0.14961131995545007 + 2.1175823681357508e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0033128674448968964 + -0.006995231373802849i, 0.0009290151779901334 + -0.02173919310588631i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0025225747334553373 + 0.0590288948489038i, 0.003312867444896897 + 0.006995231373802849i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3246014679842094 + 2.5728625772849373e-19i, 0.03917394192904214 + -0.016543464725711634i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0027040026930908114 + 0.0072523597619154985i, 0.0009290151779901332 + 0.02173919310588631i, 0.0 + 0.0i, 0.0 + 0.0i, 0.039173941929042146 + 0.016543464725711634i, 0.11954440300848602 + -1.0071751138445665e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4062428090518545, 1.0e-7), DoubleNear(0.14961131995545007, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3246014679842094, 1.0e-7), DoubleNear(0.11954440300848602, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, true, false}), Matrix({ { 0.5547379759738171 + 2.0879362149818503e-19i, 0.06694755076612847 + -0.02827247884776033i, 0.0 + 0.0i, 0.0 + 0.0i, -0.12468330522702757 + 0.10007277092374814i, -0.009946924216807405 + 0.018431644243348776i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06694755076612849 + 0.028272478847760327i, 0.2042991998026079 + -9.147955830346444e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.02014743480637618 + 0.005722559008966472i, -0.045918434630169126 + 0.036854853835924156i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.12468330522702759 + -0.10007277092374817i, -0.02014743480637618 + -0.005722559008966472i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1761063010622468 + 6.71273610699033e-20i, 0.021253070893340713 + -0.008975339506907465i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009946924216807405 + -0.018431644243348776i, -0.045918434630169126 + -0.036854853835924156i, 0.0 + 0.0i, 0.0 + 0.0i, 0.021253070893340713 + 0.008975339506907465i, 0.06485652316132817 + 1.1937870600365295e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5547379759738171, 1.0e-7), DoubleNear(0.2042991998026079, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1761063010622468, 1.0e-7), DoubleNear(0.06485652316132817, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false, true}), Matrix({ { 0.35045607092521736 + 2.896852679609707e-19i, 0.040906399696023776 + -0.013161401089979975i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.040906399696023776 + 0.013161401089979973i, 0.1220097709242597 + 6.646561657986088e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3803882061108466 + -1.376428539288238e-20i, 0.04729422196344541 + -0.02408641726468782i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04729422196344542 + 0.02408641726468782i, 0.1471459520396764 + -1.4600730428296002e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.35045607092521736, 1.0e-7), DoubleNear(0.1220097709242597, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3803882061108466, 1.0e-7), DoubleNear(0.1471459520396764, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false, false, false}), Matrix({ { 0.3927856473767011 + 7.284483346386983e-20i, 0.04740262647747677 + -0.020018503127836648i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0015521099560497245 + 0.05877131067089851i, 0.0031826207585231407 + 0.007013605481038328i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04740262647747677 + 0.020018503127836648i, 0.1446553092243983 + -1.9481757786848908e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002807993584694476 + 0.007171813492035886i, 0.0005716118884234915 + 0.021644329866433644i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0015521099560497236 + -0.05877131067089851i, -0.002807993584694476 + -0.007171813492035886i, 0.0 + 0.0i, 0.0 + 0.0i, 0.33805862965936284 + 2.030761491042185e-19i, 0.040797995181992425 + -0.017229315226831146i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00318262075852314 + -0.007013605481038328i, 0.0005716118884234913 + -0.02164432986643364i, 0.0 + 0.0i, 0.0 + 0.0i, 0.040797995181992425 + 0.017229315226831146i, 0.12450041373953777 + -6.005992991625023e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3927856473767011, 1.0e-7), DoubleNear(0.1446553092243983, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.33805862965936284, 1.0e-7), DoubleNear(0.12450041373953777, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true, false, false}), Matrix({ { 0.4062428090518545 + 1.8634724839594607e-20i, 0.049026679730427056 + -0.02070435362895616i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0025225747334553386 + -0.0590288948489038i, -0.002704002693090811 + -0.0072523597619154985i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.049026679730427056 + 0.02070435362895616i, 0.14961131995545007 + 2.1175823681357508e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0033128674448968964 + -0.006995231373802849i, 0.0009290151779901334 + -0.02173919310588631i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0025225747334553373 + 0.0590288948489038i, 0.003312867444896897 + 0.006995231373802849i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3246014679842094 + 2.5728625772849373e-19i, 0.03917394192904214 + -0.016543464725711634i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0027040026930908114 + 0.0072523597619154985i, 0.0009290151779901332 + 0.02173919310588631i, 0.0 + 0.0i, 0.0 + 0.0i, 0.039173941929042146 + 0.016543464725711634i, 0.11954440300848602 + -1.0071751138445665e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4062428090518545, 1.0e-7), DoubleNear(0.14961131995545007, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3246014679842094, 1.0e-7), DoubleNear(0.11954440300848602, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, true, false}), Matrix({ { 0.5547379759738171 + 2.0879362149818503e-19i, 0.06694755076612847 + -0.02827247884776033i, 0.0 + 0.0i, 0.0 + 0.0i, -0.12468330522702757 + 0.10007277092374814i, -0.009946924216807405 + 0.018431644243348776i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06694755076612849 + 0.028272478847760327i, 0.2042991998026079 + -9.147955830346444e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.02014743480637618 + 0.005722559008966472i, -0.045918434630169126 + 0.036854853835924156i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.12468330522702759 + -0.10007277092374817i, -0.02014743480637618 + -0.005722559008966472i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1761063010622468 + 6.71273610699033e-20i, 0.021253070893340713 + -0.008975339506907465i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009946924216807405 + -0.018431644243348776i, -0.045918434630169126 + -0.036854853835924156i, 0.0 + 0.0i, 0.0 + 0.0i, 0.021253070893340713 + 0.008975339506907465i, 0.06485652316132817 + 1.1937870600365295e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5547379759738171, 1.0e-7), DoubleNear(0.2042991998026079, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1761063010622468, 1.0e-7), DoubleNear(0.06485652316132817, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false, true}), Matrix({ { 0.35045607092521736 + 2.896852679609707e-19i, 0.040906399696023776 + -0.013161401089979975i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.040906399696023776 + 0.013161401089979973i, 0.1220097709242597 + 6.646561657986088e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3803882061108466 + -1.376428539288238e-20i, 0.04729422196344541 + -0.02408641726468782i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04729422196344542 + 0.02408641726468782i, 0.1471459520396764 + -1.4600730428296002e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.35045607092521736, 1.0e-7), DoubleNear(0.1220097709242597, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3803882061108466, 1.0e-7), DoubleNear(0.1471459520396764, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true, false, false}), Matrix({ { 0.1924717884640246 + 7.962109704190423e-20i, 0.023228110184133142 + -0.009809414180788976i, 0.004424439944930435 + 0.03663428603744043i, 0.0024010389636351832 + 0.004195649009661522i, -0.0033534669348539103 + -0.03901483620949097i, -0.002393116366361749 + -0.0045375240452324266i, -0.015289158854977985 + -0.002327451596018351i, -0.001963764176628271 + 0.0004983347966433708i }, { 0.023228110184133142 + 0.009809414180788975i, 0.07088361365336376 + 1.1011428314305904e-20i, -0.0013331278753238342 + 0.004646636287165436i, 0.0016294351197738183 + 0.013491694542185413i, 0.0015837021651091499 + -0.004879346048010891i, -0.001235016604285074 + -0.014368404838404328i, -0.0017265248713432806 + -0.0010601033815563305i, -0.0056306996366053495 + -0.0008571551241126752i }, { 0.004424439944930434 + -0.03663428603744043i, -0.0013331278753238344 + -0.004646636287165436i, 0.21377102058782996 + -6.098637220230962e-20i, 0.02579856954629391 + -0.010894939448167183i, 0.017905819631973047 + 0.0011220500136126428i, 0.0022181173047268075 + -0.0007771658426511806i, 0.0058760416683092485 + -0.020014058639412833i, -0.00031088632672906174 + -0.002714835716683072i }, { 0.0024010389636351832 + -0.004195649009661522i, 0.0016294351197738183 + -0.013491694542185411i, 0.02579856954629391 + 0.010894939448167183i, 0.07872770630208631 + 1.0164395367051604e-20i, 0.002103745703538683 + 0.0010479910015619275i, 0.006594364873254287 + 0.0004132291817901221i, 0.0017291652797877467 + -0.0021158853257919577i, 0.0021640317822752076 + -0.007370788267481982i }, { -0.003353466934853911 + 0.03901483620949097i, 0.0015837021651091499 + 0.004879346048010891i, 0.017905819631973047 + -0.0011220500136126434i, 0.002103745703538683 + -0.0010479910015619277i, 0.2003138589126765 + -6.776263578034403e-21i, 0.024174516293343627 + -0.010209088947047671i, -0.00287232998888071 + 0.022137024633458086i, 0.0007815817948879572 + 0.002817956471376807i }, { -0.0023931163663617494 + 0.0045375240452324266i, -0.001235016604285074 + 0.014368404838404326i, 0.0022181173047268075 + 0.0007771658426511807i, 0.006594364873254287 + -0.0004132291817901221i, 0.024174516293343627 + 0.010209088947047671i, 0.07377169557103454 + -3.049318610115481e-20i, -0.0014748657093706418 + 0.0025251772048704504i, -0.0010578232313503265 + 0.00815263532424823i }, { -0.015289158854977985 + 0.0023274515960183513i, -0.0017265248713432806 + 0.0010601033815563305i, 0.0058760416683092485 + 0.020014058639412833i, 0.0017291652797877467 + 0.0021158853257919577i, -0.0028723299888807107 + -0.022137024633458086i, -0.0014748657093706418 + -0.0025251772048704504i, 0.12428760907153291 + 2.6406252130652813e-19i, 0.014999425635698513 + -0.006334375778663964i }, { -0.001963764176628271 + -0.0004983347966433709i, -0.0056306996366053495 + 0.0008571551241126751i, -0.0003108863267290618 + 0.002714835716683072i, 0.0021640317822752076 + 0.007370788267481982i, 0.000781581794887957 + -0.0028179564713768073i, -0.0010578232313503268 + -0.00815263532424823i, 0.014999425635698513 + 0.006334375778663963i, 0.04577270743745148 + -7.022432528330184e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.1924717884640246, 1.0e-7), DoubleNear(0.07088361365336376, 1.0e-7), DoubleNear(0.21377102058782996, 1.0e-7), DoubleNear(0.07872770630208631, 1.0e-7), DoubleNear(0.2003138589126765, 1.0e-7), DoubleNear(0.07377169557103454, 1.0e-7), DoubleNear(0.12428760907153291, 1.0e-7), DoubleNear(0.04577270743745148, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, true, false}), Matrix({ { 0.298138908470326 + 1.0842021724855044e-19i, 0.035980355725848755 + -0.01519478807742466i, 0.0011781091575344537 + 0.044609609668317673i, 0.002415727472116828 + 0.005323587296337388i, -0.06700991483340055 + 0.053783205734981895i, -0.005345884466319613 + 0.009905920513876513i, -0.008312208633130678 + -0.00981396112449539i, -0.001503316978229676 + -0.0007607445967617095i }, { 0.035980355725848755 + 0.01519478807742466i, 0.10979875737475273 + -1.5246593050577406e-20i, -0.0021313715201248147 + 0.00544367305819018i, 0.0004338746734291959 + 0.01642885101339112i, -0.010828056635397099 + 0.00307553758798518i, -0.024678447433263143 + 0.019807307900972775i, -0.0005029707956271208 + -0.0016080157515652523i, -0.0030612246608136993 + -0.003614290875090446i }, { 0.001178109157534453 + -0.044609609668317673i, -0.0021313715201248147 + -0.00544367305819018i, 0.25659906750349115 + 1.0037340424963459e-19i, 0.030967195040279727 + -0.01307769077033567i, 0.0077826233152271575 + 0.010239014583790847i, 0.001461067977740569 + 0.0008390319677800273i, -0.057673390393627025 + 0.04628956518876626i, -0.004601039750487791 + 0.008525723729472261i }, { 0.0024157274721168277 + -0.005323587296337388i, 0.0004338746734291957 + -0.016428851013391116i, 0.030967195040279727 + 0.01307769077033567i, 0.09450044242785519 + -7.623296525288703e-20i, 0.00041739570081031845 + 0.00163232199871251i, 0.0028661886954374884 + 0.003770829791422885i, -0.00931937817097908 + 0.0026470214209812918i, -0.02123998719690598 + 0.01704754593495138i }, { -0.06700991483340055 + -0.053783205734981895i, -0.010828056635397099 + -0.0030755375879851802i, 0.007782623315227157 + -0.010239014583790845i, 0.0004173957008103184 + -0.0016323219987125102i, 0.09464673890637512 + -3.5575383784680614e-20i, 0.011422270751628015 + -0.004823715050411987i, 0.00037400079851527076 + 0.014161701002580834i, 0.0007668932864063123 + 0.0016900181847009407i }, { -0.005345884466319613 + -0.009905920513876513i, -0.024678447433263143 + -0.019807307900972772i, 0.001461067977740569 + -0.0008390319677800274i, 0.0028661886954374884 + -0.0037708297914228845i, 0.011422270751628015 + 0.004823715050411987i, 0.034856551849645576 + -4.235164736271502e-21i, -0.0006766220645696612 + 0.0017281404338457067i, 0.0001377372149942956 + 0.005215478853042525i }, { -0.008312208633130678 + 0.00981396112449539i, -0.0005029707956271208 + 0.001608015751565252i, -0.057673390393627025 + -0.046289565188766264i, -0.00931937817097908 + -0.002647021420981292i, 0.0003740007985152706 + -0.014161701002580835i, -0.0006766220645696612 + -0.0017281404338457067i, 0.08145956215587168 + 1.0270274485458392e-19i, 0.009830800141712698 + -0.004151624456495477i }, { -0.001503316978229676 + 0.0007607445967617096i, -0.0030612246608136993 + 0.0036142908750904455i, -0.004601039750487791 + -0.008525723729472263i, -0.02123998719690598 + -0.01704754593495138i, 0.0007668932864063123 + -0.001690018184700941i, 0.00013773721499429564 + -0.005215478853042524i, 0.009830800141712698 + 0.004151624456495477i, 0.029999971311682604 + 1.6173035336636797e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.298138908470326, 1.0e-7), DoubleNear(0.10979875737475273, 1.0e-7), DoubleNear(0.25659906750349115, 1.0e-7), DoubleNear(0.09450044242785519, 1.0e-7), DoubleNear(0.09464673890637512, 1.0e-7), DoubleNear(0.034856551849645576, 1.0e-7), DoubleNear(0.08145956215587168, 1.0e-7), DoubleNear(0.029999971311682604, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false, true}), Matrix({ { 0.18834944600471154 + 1.1858461261560205e-20i, 0.02198477458373794 + -0.007073475992009589i, 0.0007442712133521402 + 0.028182149423648058i, 0.0011452563136326796 + 0.003261563178633217i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02198477458373794 + 0.007073475992009589i, 0.06557304800021514 + 5.082197683525802e-21i, -0.0009715086844062828 + 0.003317465488630546i, 0.00025911481575102306 + 0.009811493880687508i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0007442712133521399 + -0.02818214942364806i, -0.0009715086844062828 + -0.003317465488630546i, 0.16210662492050582 + 2.778268066994105e-19i, 0.018921625112285838 + -0.0060879250979703845i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0011452563136326796 + -0.0032615631786332175i, 0.00025911481575102295 + -0.009811493880687508i, 0.018921625112285838 + 0.0060879250979703845i, 0.056436722924044565 + 6.138341889633508e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20443620137198953 + 6.098637220230962e-20i, 0.02541785189373883 + -0.012945027135827058i, 0.0008078387426975842 + 0.030589161247250453i, 0.002037364444890461 + 0.0037520423024051115i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02541785189373883 + 0.012945027135827058i, 0.07908226122418316 + -2.456395547037471e-20i, -0.0018364849002881932 + 0.00385434800340534i, 0.0003124970726724685 + 0.011832835985746134i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008078387426975837 + -0.030589161247250453i, -0.0018364849002881934 + -0.00385434800340534i, 0.17595200473885703 + -7.4750657595192e-20i, 0.021876370069706587 + -0.011141390128860762i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0020373644448904603 + -0.003752042302405111i, 0.0003124970726724684 + -0.011832835985746132i, 0.021876370069706587 + 0.011141390128860762i, 0.06806369081549321 + -1.214433488125853e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.18834944600471154, 1.0e-7), DoubleNear(0.06557304800021514, 1.0e-7), DoubleNear(0.16210662492050582, 1.0e-7), DoubleNear(0.056436722924044565, 1.0e-7), DoubleNear(0.20443620137198953, 1.0e-7), DoubleNear(0.07908226122418316, 1.0e-7), DoubleNear(0.17595200473885703, 1.0e-7), DoubleNear(0.06806369081549321, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, true, false}), Matrix({ { 0.30835339446220117 + 1.3552527156068805e-20i, 0.03721307252027865 + -0.01571537410479926i, 0.0019147280013669088 + -0.04480512563531551i, -0.0020524385674554964 + -0.005504810671398927i, -0.06930573002872131 + 0.055625862919167546i, -0.005529038896835145 + 0.010245305557059131i, 0.007652330725401568 + 0.010415842329601308i, 0.0014543559601215496 + 0.0008670125273444269i }, { 0.03721307252027865 + 0.01571537410479926i, 0.11356055376316793 + 8.470329472543003e-21i, 0.002514589549096202 + -0.005309640665873956i, 0.0007051570569550638 + -0.016500855738750275i, -0.011199034826029682 + 0.0031809080536219624i, -0.025523951486731512 + 0.02048592267865914i, 0.00039265946664348715 + 0.001647021713447791i, 0.0028182044704619957 + 0.0038359520086436536i }, { 0.0019147280013669075 + 0.0448051256353155i, 0.002514589549096202 + 0.005309640665873956i, 0.24638458151161596 + 1.9524109434211623e-19i, 0.029734478245849825 + -0.012557104742961069i, -0.008513042002296137 + -0.009725021996539702i, -0.0015230213666748396 + -0.0007397755727010377i, -0.05537757519830626 + 0.04444690800458061i, -0.00441788531997226 + 0.008186338686289641i }, { -0.002052438567455497 + 0.005504810671398927i, 0.0007051570569550636 + 0.016500855738750275i, 0.02973447824584983 + 0.012557104742961069i, 0.09073864603943999 + -9.994988777600744e-20i, -0.0005317408320818739 + -0.0016075178595617908i, -0.0031351876818997157 + -0.003581536325267907i, -0.008948399980346494 + 0.0025416509553445096i, -0.020394483143437614 + 0.016368931157265017i }, { -0.06930573002872133 + -0.055625862919167546i, -0.011199034826029682 + -0.0031809080536219624i, -0.008513042002296137 + 0.009725021996539702i, -0.0005317408320818739 + 0.0016075178595617908i, 0.09788941458965336 + 5.082197683525802e-21i, 0.011813607210148399 + -0.0049889795241568995i, 0.00060784673208843 + -0.014223769213588297i, -0.0006515641256353144 + -0.0017475490905165723i }, { -0.005529038896835145 + -0.010245305557059133i, -0.025523951486731512 + -0.02048592267865914i, -0.0015230213666748396 + 0.0007397755727010376i, -0.0031351876818997157 + 0.003581536325267907i, 0.011813607210148399 + 0.0049889795241568995i, 0.03605076619228215 + 1.2705494208814505e-20i, 0.0007982778958006948 + -0.0016855907079288926i, 0.00022385812103506962 + -0.005238337367136036i }, { 0.007652330725401568 + -0.010415842329601308i, 0.0003926594666434871 + -0.001647021713447791i, -0.05537757519830626 + -0.04444690800458061i, -0.008948399980346494 + -0.0025416509553445096i, 0.0006078467320884298 + 0.014223769213588297i, 0.0007982778958006949 + 0.0016855907079288926i, 0.07821688647259345 + 6.20451633863775e-20i, 0.009439463683192314 + -0.003986359982750566i }, { 0.0014543559601215496 + -0.0008670125273444269i, 0.0028182044704619953 + -0.003835952008643653i, -0.004417885319972259 + -0.008186338686289641i, -0.020394483143437614 + -0.016368931157265017i, -0.0006515641256353145 + 0.0017475490905165723i, 0.00022385812103506967 + 0.005238337367136036i, 0.009439463683192314 + 0.003986359982750565i, 0.028805756969046026 + -7.676236084492097e-22i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.30835339446220117, 1.0e-7), DoubleNear(0.11356055376316793, 1.0e-7), DoubleNear(0.24638458151161596, 1.0e-7), DoubleNear(0.09073864603943999, 1.0e-7), DoubleNear(0.09788941458965336, 1.0e-7), DoubleNear(0.03605076619228215, 1.0e-7), DoubleNear(0.07821688647259345, 1.0e-7), DoubleNear(0.028805756969046026, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false, true}), Matrix({ { 0.19480245405945887 + 1.2705494208814505e-19i, 0.02273799117385797 + -0.007315819139386608i, 0.0012096306388102987 + -0.028305666760778114i, -0.0009218290843394212 + -0.0033493594477849104i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02273799117385797 + 0.007315819139386608i, 0.06781963494748514 + 2.710505431213761e-20i, 0.0012042133173481248 + -0.003258503929339586i, 0.0004211276944199473 + -0.009854495909354402i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001209630638810298 + 0.028305666760778114i, 0.0012042133173481248 + 0.003258503929339586i, 0.15565361686575852 + 1.6263032587282567e-19i, 0.018168408522165815 + -0.005845581950593366i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0009218290843394213 + 0.0033493594477849104i, 0.0004211276944199471 + 0.0098544959093544i, 0.018168408522165815 + 0.005845581950593366i, 0.054190135976774564 + 3.936056226772327e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21144035499239566 + -1.0842021724855044e-19i, 0.026288688556569087 + -0.013388534489569552i, 0.0013129440946450402 + -0.030723228088125686i, -0.0017821736087513898 + -0.003903000314130588i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.026288688556569087 + 0.013388534489569552i, 0.08179168500796494 + -5.929230630780102e-21i, 0.0021086541275487716 + -0.0037367274444632627i, 0.0005078874835701861 + -0.01188469719653191i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0013129440946450393 + 0.030723228088125686i, 0.002108654127548772 + 0.0037367274444632627i, 0.16894785111845093 + 9.465593185566806e-20i, 0.021005533406876328 + -0.010697882775118269i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00178217360875139 + 0.003903000314130588i, 0.0005078874835701861 + 0.01188469719653191i, 0.02100553340687633 + 0.010697882775118267i, 0.06535426703171146 + -1.4007807365217992e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.19480245405945887, 1.0e-7), DoubleNear(0.06781963494748514, 1.0e-7), DoubleNear(0.15565361686575852, 1.0e-7), DoubleNear(0.054190135976774564, 1.0e-7), DoubleNear(0.21144035499239566, 1.0e-7), DoubleNear(0.08179168500796494, 1.0e-7), DoubleNear(0.16894785111845093, 1.0e-7), DoubleNear(0.06535426703171146, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true, true}), Matrix({ { 0.2660091863087795 + 2.846030702774449e-19i, 0.0310494780964515 + -0.009989992712599162i, -0.05978841544335921 + 0.04798711737439726i, -0.005176543569675239 + 0.007846574072755306i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0310494780964515 + 0.00998999271259916i, 0.09260995193947866 + 4.573977915173222e-20i, -0.00878086234919588 + 0.003355858222937329i, -0.020815079199256716 + 0.01670650813013061i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05978841544335922 + -0.047987117374397266i, -0.00878086234919588 + -0.003355858222937329i, 0.08444688461643787 + 5.082197683525802e-21i, 0.009856921599572278 + -0.003171408377380813i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005176543569675238 + -0.007846574072755307i, -0.020815079199256716 + -0.01670650813013061i, 0.009856921599572278 + 0.003171408377380813i, 0.029399818984781043 + 2.072583742812866e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2887287896650377 + -7.580944877925988e-20i, 0.03589807266967698 + -0.018282486135161168i, -0.06489488978366836 + 0.05208565354935089i, -0.004770380647132167 + 0.010585070170593468i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.035898072669676984 + 0.018282486135161168i, 0.11168924786312925 + -1.3721933745519665e-19i, -0.011366572457180299 + 0.002366700786029143i, -0.02510335543091241 + 0.020148345705793547i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06489488978366836 + -0.052085653549350894i, -0.011366572457180299 + -0.002366700786029143i, 0.09165941644580894 + 6.20451633863775e-20i, 0.011396149293768434 + -0.005803931129526652i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004770380647132166 + -0.010585070170593468i, -0.02510335543091241 + -0.020148345705793547i, 0.011396149293768434 + 0.005803931129526652i, 0.03545670417654714 + -8.787966827763366e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2660091863087795, 1.0e-7), DoubleNear(0.09260995193947866, 1.0e-7), DoubleNear(0.08444688461643787, 1.0e-7), DoubleNear(0.029399818984781043, 1.0e-7), DoubleNear(0.2887287896650377, 1.0e-7), DoubleNear(0.11168924786312925, 1.0e-7), DoubleNear(0.09165941644580894, 1.0e-7), DoubleNear(0.03545670417654714, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false, false, false}), Matrix({ { 0.5374409566010994 + 5.336307567702092e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0021237218444732156 + 0.08041564053733216i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0021237218444732147 + -0.08041564053733216i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.46255904339890064 + 1.4301621918796827e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5374409566010994, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.46255904339890064, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true, false, false}), Matrix({ { 0.5558541290073047 + 3.9810548520952116e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0034515899114454726 + -0.08076808795479011i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003451589911445471 + 0.08076808795479011i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4441458709926954 + 1.5656874634403708e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5558541290073047, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4441458709926954, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, true, false}), Matrix({ { 0.7590371757764252 + 1.173140631947206e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.1706017398571967 + 0.1369276247596723i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1706017398571967 + -0.1369276247596723i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24096282422357498 + 7.90652316702686e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.7590371757764252, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24096282422357498, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false, true}), Matrix({ { 0.47246584184947715 + 3.561508845408316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.527534158150523 + -1.597715896758424e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.47246584184947715, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.527534158150523, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true, false, false}), Matrix({ { 0.2633554021173884 + 9.063252535621014e-20i, 0.0 + 0.0i, 0.006053875064704253 + 0.050125980579625834i, 0.0 + 0.0i, -0.004588483539138984 + -0.0533832410478953i, 0.0 + 0.0i, -0.020919858491583333 + -0.0031846067201310264i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.006053875064704253 + -0.050125980579625834i, 0.0 + 0.0i, 0.29249872688991624 + -5.082197683525802e-20i, 0.0 + 0.0i, 0.024500184505227333 + 0.0015352791954027648i, 0.0 + 0.0i, 0.008040073450584457 + -0.027384846906894814i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004588483539138985 + 0.0533832410478953i, 0.0 + 0.0i, 0.024500184505227333 + -0.0015352791954027657i, 0.0 + 0.0i, 0.2740855544837111 + -3.7269449679189215e-20i, 0.0 + 0.0i, -0.003930153220231037 + 0.030289659957706317i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.020919858491583336 + 0.0031846067201310264i, 0.0 + 0.0i, 0.008040073450584455 + 0.027384846906894814i, 0.0 + 0.0i, -0.003930153220231037 + -0.03028965995770632i, 0.0 + 0.0i, 0.1700603165089844 + 1.938381960232263e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2633554021173884, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29249872688991624, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2740855544837111, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1700603165089844, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, true, false}), Matrix({ { 0.40793766584507873 + 9.317362419797304e-20i, 0.0 + 0.0i, 0.0016119838309636494 + 0.0610384606817088i, 0.0 + 0.0i, -0.0916883622666637 + 0.07359051363595467i, 0.0 + 0.0i, -0.011373433293944378 + -0.013428251999585835i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016119838309636486 + -0.0610384606817088i, 0.0 + 0.0i, 0.3510995099313463 + 2.414043899674756e-20i, 0.0 + 0.0i, 0.010648812010664645 + 0.014009844375213732i, 0.0 + 0.0i, -0.07891337759053302 + 0.06333711112371765i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0916883622666637 + -0.07359051363595467i, 0.0 + 0.0i, 0.010648812010664647 + -0.014009844375213729i, 0.0 + 0.0i, 0.1295032907560207 + -3.9810548520952116e-20i, 0.0 + 0.0i, 0.0005117380135095664 + 0.019377179855623358i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011373433293944378 + 0.013428251999585835i, 0.0 + 0.0i, -0.07891337759053302 + -0.06333711112371765i, 0.0 + 0.0i, 0.0005117380135095664 + -0.019377179855623358i, 0.0 + 0.0i, 0.11145953346755427 + 1.1887578019122071e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.40793766584507873, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3510995099313463, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1295032907560207, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11145953346755427, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false, true}), Matrix({ { 0.25392249400492667 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0010033860291031632 + 0.037993643304335564i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010033860291031628 + -0.037993643304335564i, 0.0 + 0.0i, 0.21854334784455037 + 3.392102255957456e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.28351846259617275 + 3.6422416731934915e-20i, 0.0 + 0.0i, 0.0011203358153700524 + 0.04242199723299659i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001120335815370052 + -0.04242199723299659i, 0.0 + 0.0i, 0.24401569555435026 + -1.9619400640777732e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.25392249400492667, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21854334784455037, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28351846259617275, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24401569555435026, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, true, false}), Matrix({ { 0.4219139482253691 + 2.202285662861181e-20i, 0.0 + 0.0i, 0.002619885058321973 + -0.061305981374065774i, 0.0 + 0.0i, -0.09482968151545283 + 0.07611178559782668i, 0.0 + 0.0i, 0.010470535195863565 + 0.01425179433824496i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0026198850583219716 + 0.061305981374065774i, 0.0 + 0.0i, 0.33712322755105595 + 9.529120656610879e-20i, 0.0 + 0.0i, -0.011648229684195852 + -0.01330655832180761i, 0.0 + 0.0i, -0.07577205834174386 + 0.060815839161845624i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09482968151545283 + -0.07611178559782669i, 0.0 + 0.0i, -0.011648229684195852 + 0.013306558321807608i, 0.0 + 0.0i, 0.1339401807819355 + 1.7787691892340307e-20i, 0.0 + 0.0i, 0.0008317048531234996 + -0.019462106580724333i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010470535195863565 + -0.01425179433824496i, 0.0 + 0.0i, -0.07577205834174386 + -0.06081583916184563i, 0.0 + 0.0i, 0.0008317048531234996 + 0.019462106580724333i, 0.0 + 0.0i, 0.10702264344163948 + 6.127753977792829e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.4219139482253691, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.33712322755105595, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1339401807819355, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.10702264344163948, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false, true}), Matrix({ { 0.262622089006944 + 1.5415999640028266e-19i, 0.0 + 0.0i, 0.001630758333230246 + -0.038160162670132516i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016307583332302454 + 0.038160162670132516i, 0.0 + 0.0i, 0.2098437528425331 + 2.0199088814054893e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2932320400003606 + -1.1434944787933055e-19i, 0.0 + 0.0i, 0.0018208315782152263 + -0.042607925284657594i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0018208315782152257 + 0.042607925284657594i, 0.0 + 0.0i, 0.23430211815016236 + -4.5422141796511856e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.262622089006944, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2098437528425331, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2932320400003606, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23430211815016236, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true, true}), Matrix({ { 0.3586191382482582 + 3.3034284942917713e-19i, 0.0 + 0.0i, -0.08060349464261593 + 0.06469362550452787i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08060349464261593 + -0.06469362550452787i, 0.0 + 0.0i, 0.11384670360121893 + 2.5808035111654463e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4004180375281669 + -2.1302878623445654e-19i, 0.0 + 0.0i, -0.08999824521458077 + 0.07223399925514443i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08999824521458077 + -0.07223399925514444i, 0.0 + 0.0i, 0.12711612062235605 + 5.3257196558614134e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3586191382482582, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11384670360121893, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4004180375281669, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12711612062235605, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true, false, false}), Matrix({ { 0.2633554021173884 + 9.063252535621014e-20i, 0.0 + 0.0i, 0.006053875064704253 + 0.050125980579625834i, 0.0 + 0.0i, -0.004588483539138984 + -0.0533832410478953i, 0.0 + 0.0i, -0.020919858491583333 + -0.0031846067201310264i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.006053875064704253 + -0.050125980579625834i, 0.0 + 0.0i, 0.29249872688991624 + -5.082197683525802e-20i, 0.0 + 0.0i, 0.024500184505227333 + 0.0015352791954027648i, 0.0 + 0.0i, 0.008040073450584457 + -0.027384846906894814i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004588483539138985 + 0.0533832410478953i, 0.0 + 0.0i, 0.024500184505227333 + -0.0015352791954027657i, 0.0 + 0.0i, 0.2740855544837111 + -3.7269449679189215e-20i, 0.0 + 0.0i, -0.003930153220231037 + 0.030289659957706317i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.020919858491583336 + 0.0031846067201310264i, 0.0 + 0.0i, 0.008040073450584455 + 0.027384846906894814i, 0.0 + 0.0i, -0.003930153220231037 + -0.03028965995770632i, 0.0 + 0.0i, 0.1700603165089844 + 1.938381960232263e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2633554021173884, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29249872688991624, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2740855544837111, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1700603165089844, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, true, false}), Matrix({ { 0.40793766584507873 + 9.317362419797304e-20i, 0.0 + 0.0i, 0.0016119838309636494 + 0.0610384606817088i, 0.0 + 0.0i, -0.0916883622666637 + 0.07359051363595467i, 0.0 + 0.0i, -0.011373433293944378 + -0.013428251999585835i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016119838309636486 + -0.0610384606817088i, 0.0 + 0.0i, 0.3510995099313463 + 2.414043899674756e-20i, 0.0 + 0.0i, 0.010648812010664645 + 0.014009844375213732i, 0.0 + 0.0i, -0.07891337759053302 + 0.06333711112371765i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0916883622666637 + -0.07359051363595467i, 0.0 + 0.0i, 0.010648812010664647 + -0.014009844375213729i, 0.0 + 0.0i, 0.1295032907560207 + -3.9810548520952116e-20i, 0.0 + 0.0i, 0.0005117380135095664 + 0.019377179855623358i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011373433293944378 + 0.013428251999585835i, 0.0 + 0.0i, -0.07891337759053302 + -0.06333711112371765i, 0.0 + 0.0i, 0.0005117380135095664 + -0.019377179855623358i, 0.0 + 0.0i, 0.11145953346755427 + 1.1887578019122071e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.40793766584507873, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3510995099313463, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1295032907560207, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11145953346755427, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false, true}), Matrix({ { 0.25392249400492667 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0010033860291031632 + 0.037993643304335564i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010033860291031628 + -0.037993643304335564i, 0.0 + 0.0i, 0.21854334784455037 + 3.392102255957456e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.28351846259617275 + 3.6422416731934915e-20i, 0.0 + 0.0i, 0.0011203358153700524 + 0.04242199723299659i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001120335815370052 + -0.04242199723299659i, 0.0 + 0.0i, 0.24401569555435026 + -1.9619400640777732e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.25392249400492667, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21854334784455037, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28351846259617275, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24401569555435026, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, true, false}), Matrix({ { 0.4219139482253691 + 2.202285662861181e-20i, 0.0 + 0.0i, 0.002619885058321973 + -0.061305981374065774i, 0.0 + 0.0i, -0.09482968151545283 + 0.07611178559782668i, 0.0 + 0.0i, 0.010470535195863565 + 0.01425179433824496i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0026198850583219716 + 0.061305981374065774i, 0.0 + 0.0i, 0.33712322755105595 + 9.529120656610879e-20i, 0.0 + 0.0i, -0.011648229684195852 + -0.01330655832180761i, 0.0 + 0.0i, -0.07577205834174386 + 0.060815839161845624i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09482968151545283 + -0.07611178559782669i, 0.0 + 0.0i, -0.011648229684195852 + 0.013306558321807608i, 0.0 + 0.0i, 0.1339401807819355 + 1.7787691892340307e-20i, 0.0 + 0.0i, 0.0008317048531234996 + -0.019462106580724333i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010470535195863565 + -0.01425179433824496i, 0.0 + 0.0i, -0.07577205834174386 + -0.06081583916184563i, 0.0 + 0.0i, 0.0008317048531234996 + 0.019462106580724333i, 0.0 + 0.0i, 0.10702264344163948 + 6.127753977792829e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.4219139482253691, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.33712322755105595, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1339401807819355, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.10702264344163948, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false, true}), Matrix({ { 0.262622089006944 + 1.5415999640028266e-19i, 0.0 + 0.0i, 0.001630758333230246 + -0.038160162670132516i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016307583332302454 + 0.038160162670132516i, 0.0 + 0.0i, 0.2098437528425331 + 2.0199088814054893e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2932320400003606 + -1.1434944787933055e-19i, 0.0 + 0.0i, 0.0018208315782152263 + -0.042607925284657594i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0018208315782152257 + 0.042607925284657594i, 0.0 + 0.0i, 0.23430211815016236 + -4.5422141796511856e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.262622089006944, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2098437528425331, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2932320400003606, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23430211815016236, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true, true}), Matrix({ { 0.3586191382482582 + 3.3034284942917713e-19i, 0.0 + 0.0i, -0.08060349464261593 + 0.06469362550452787i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08060349464261593 + -0.06469362550452787i, 0.0 + 0.0i, 0.11384670360121893 + 2.5808035111654463e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4004180375281669 + -2.1302878623445654e-19i, 0.0 + 0.0i, -0.08999824521458077 + 0.07223399925514443i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08999824521458077 + -0.07223399925514444i, 0.0 + 0.0i, 0.12711612062235605 + 5.3257196558614134e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3586191382482582, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11384670360121893, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4004180375281669, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12711612062235605, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, true, false}), Matrix({ { 0.1998965406486472 + 9.317362419797304e-20i, 0.004595116231616438 + 0.03804748273218313i, -0.0034828295866446697 + -0.04051986451878657i, -0.015878950307093877 + -0.002417234890806878i, -0.04492888980201812 + 0.03606062967956236i, -0.007896433078434274 + -0.0077226367657304605i, 0.008092443673744561 + 0.008478983649723902i, 0.004005024890211699 + -0.0023212070863456932i }, { 0.004595116231616438 + -0.03804748273218313i, 0.2220174075767219 + -7.115076756936123e-20i, 0.018596550852849083 + 0.0011653339845068165i, 0.006102714644966643 + -0.02078611685527921i, 0.005830829840600984 + 0.009380522232133983i, -0.049900791713434714 + 0.04005115591826432i, -0.004389996236983556 + 0.0030928307685722366i, 0.0023780915221190027 + 0.0057728106885210585i }, { -0.0034828295866446706 + 0.04051986451878657i, 0.018596550852849083 + -0.001165333984506817i, 0.2080411251964315 + 0.0i, -0.002983132400652788 + 0.022990977949525673i, -0.006526837123578124 + -0.009735563954250214i, -0.003969551969844673 + 0.003616673372376775i, -0.04675947246464558 + 0.0375298839563923i, -0.0034770002155101037 + -0.005705615233855374i }, { -0.015878950307093877 + 0.0024172348908068782i, 0.006102714644966642 + 0.02078611685527921i, -0.002983132400652789 + -0.022990977949525673i, 0.12908210235462447 + 9.529120656610879e-20i, 0.003132903622249235 + -0.0034078059807762405i, -0.005121392560617729 + -0.003570994367557395i, 0.004817982170063661 + 0.004629322143079748i, -0.02901258587709829 + 0.023285955205453318i }, { -0.04492888980201812 + -0.03606062967956236i, 0.005830829840600984 + -0.009380522232133981i, -0.006526837123578124 + 0.009735563954250214i, 0.003132903622249235 + 0.0034078059807762405i, 0.06345886146874116 + -2.541098841762901e-21i, 0.0014587588330878145 + 0.012078497847442714i, -0.0011056539524943146 + -0.012863376529108727i, -0.005040908184489457 + -0.0007673718293241483i }, { -0.007896433078434274 + 0.0077226367657304605i, -0.049900791713434714 + -0.04005115591826432i, -0.003969551969844673 + -0.003616673372376775i, -0.005121392560617729 + 0.0035709943675573948i, 0.0014587588330878143 + -0.012078497847442714i, 0.07048131931319435 + 2.0328790734103208e-20i, 0.005903633652378249 + 0.00036994521089594827i, 0.0019373588056178141 + -0.0065987300516156065i }, { 0.008092443673744561 + -0.008478983649723902i, -0.004389996236983556 + -0.003092830768572236i, -0.04675947246464558 + -0.037529883956392306i, 0.004817982170063662 + -0.004629322143079748i, -0.0011056539524943144 + 0.012863376529108725i, 0.005903633652378249 + -0.0003699452108959485i, 0.06604442928727955 + -3.7269449679189215e-20i, -0.0009470208195782482 + 0.007298682008180645i }, { 0.004005024890211699 + 0.0023212070863456937i, 0.0023780915221190023 + -0.0057728106885210585i, -0.0034770002155101037 + 0.005705615233855374i, -0.02901258587709829 + -0.02328595520545332i, -0.005040908184489457 + 0.0007673718293241481i, 0.001937358805617814 + 0.0065987300516156065i, -0.000947020819578248 + -0.007298682008180646i, 0.040978214154359933 + 9.85469894571175e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.1998965406486472, 1.0e-7), DoubleNear(0.2220174075767219, 1.0e-7), DoubleNear(0.2080411251964315, 1.0e-7), DoubleNear(0.12908210235462447, 1.0e-7), DoubleNear(0.06345886146874116, 1.0e-7), DoubleNear(0.07048131931319435, 1.0e-7), DoubleNear(0.06604442928727955, 1.0e-7), DoubleNear(0.040978214154359933, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false, true}), Matrix({ { 0.12442643176699944 + 3.049318610115481e-20i, 0.002860249178897053 + 0.02368281361308346i, -0.0021679017381317687 + -0.02522175792234741i, -0.00988391855359785 + -0.0015046178949862073i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002860249178897053 + -0.02368281361308346i, 0.13819565723994454 + 1.2366681029912785e-19i, 0.011575500297729744 + 0.0007253669775299551i, 0.003798660071362015 + -0.012938404747785105i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002167901738131769 + 0.02522175792234741i, 0.011575500297729744 + -0.0007253669775299555i, 0.12949606223792726 + -1.3552527156068805e-20i, -0.0018568631497938898 + 0.014310829691252108i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00988391855359785 + 0.0015046178949862073i, 0.0037986600713620145 + 0.012938404747785107i, -0.00185686314979389 + -0.01431082969125211i, 0.08034769060460584 + 2.1554341529661774e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13892897035038893 + 6.013933925505532e-20i, 0.003193625885807199 + 0.026443166966542378i, -0.0024205818010072156 + -0.028161483125547886i, -0.011035939937985483 + -0.0016799888251448189i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003193625885807199 + -0.026443166966542378i, 0.1543030696499717 + -1.7448878713438587e-19i, 0.012924684207497587 + 0.0008099122178728098i, 0.004241413379222442 + -0.014446442159109708i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002420581801007216 + 0.028161483125547886i, 0.012924684207497587 + -0.0008099122178728102i, 0.1445894922457838 + -2.371692252312041e-20i, -0.0020732900704371468 + 0.01597883026645421i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.011035939937985484 + 0.001679988825144819i, 0.004241413379222441 + 0.014446442159109708i, -0.0020732900704371468 + -0.01597883026645421i, 0.08971262590437856 + -2.1705219273391446e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.12442643176699944, 1.0e-7), DoubleNear(0.13819565723994454, 1.0e-7), DoubleNear(0.12949606223792726, 1.0e-7), DoubleNear(0.08034769060460584, 1.0e-7), DoubleNear(0.13892897035038893, 1.0e-7), DoubleNear(0.1543030696499717, 1.0e-7), DoubleNear(0.1445894922457838, 1.0e-7), DoubleNear(0.08971262590437856, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true, true}), Matrix({ { 0.19273661271560577 + 4.573977915173222e-20i, 0.0007616072977439869 + 0.02883858771117975i, -0.04331961926611909 + 0.03476900397714674i, -0.0053735587359423015 + -0.006344390385551245i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0007616072977439864 + -0.02883858771117975i, 0.16588252553265237 + 2.846030702774449e-19i, 0.005031199931315494 + 0.006619172916915517i, -0.037283875376496835 + 0.02992462152738113i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.043319619266119096 + -0.034769003977146745i, 0.005031199931315494 + -0.006619172916915515i, 0.06118588128932092 + -2.879912020664621e-20i, 0.0002417787313591764 + 0.009155055593155818i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0053735587359423015 + 0.006344390385551245i, -0.037283875376496835 + -0.029924621527381134i, 0.00024177873135917646 + -0.009155055593155818i, 0.052660822311897997 + 5.460715531830067e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21520105312947294 + 4.743384504624082e-20i, 0.0008503765332196626 + 0.03219987297052905i, -0.04836874300054461 + 0.03882150965880793i, -0.005999874558002076 + -0.00708386161403459i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008503765332196621 + -0.03219987297052905i, 0.18521698439869397 + -2.6046263128069735e-19i, 0.005617612079349151 + 0.007390671458298214i, -0.041629502214036176 + 0.03341248959633651i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.048368743000544605 + -0.03882150965880793i, 0.0056176120793491515 + -0.007390671458298214i, 0.06831740946669979 + -1.1011428314305904e-20i, 0.0002699592821503899 + 0.01022212426246754i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0059998745580020765 + 0.00708386161403459i, -0.041629502214036176 + -0.03341248959633651i, 0.0002699592821503899 + -0.01022212426246754i, 0.05879871115565628 + 6.426862487292004e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.19273661271560577, 1.0e-7), DoubleNear(0.16588252553265237, 1.0e-7), DoubleNear(0.06118588128932092, 1.0e-7), DoubleNear(0.052660822311897997, 1.0e-7), DoubleNear(0.21520105312947294, 1.0e-7), DoubleNear(0.18521698439869397, 1.0e-7), DoubleNear(0.06831740946669979, 1.0e-7), DoubleNear(0.05879871115565628, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true, true}), Matrix({ { 0.1993399287363357 + 1.6432439176733427e-19i, 0.0012378061996289563 + -0.028964982100306347i, -0.04480378530951622 + 0.03596021885714408i, 0.004946970225928259 + 0.006733486009884515i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0012378061996289559 + 0.028964982100306347i, 0.15927920951192248 + 1.6601845766184287e-19i, -0.0055033906437996615 + -0.006286894279631998i, -0.03579970933309971 + 0.02873340664738379i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04480378530951622 + -0.03596021885714409i, -0.0055033906437996615 + 0.006286894279631997i, 0.06328216027060832 + -1.0164395367051604e-20i, 0.00039295213360128977 + -0.00919518056982617i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004946970225928259 + -0.006733486009884515i, -0.03579970933309971 + -0.02873340664738379i, 0.00039295213360128966 + 0.00919518056982617i, 0.050564543330610605 + 3.597243047870607e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2225740194890334 + -1.4230153513872246e-19i, 0.0013820788586930166 + -0.03234099927375943i, -0.050025896205936615 + 0.0401515667406826i, 0.005523564969935306 + 0.007518308328360444i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0013820788586930157 + 0.03234099927375943i, 0.1778440180391335 + -7.072725109573408e-20i, -0.006144839040396191 + -0.007019664042175612i, -0.03997234900864416 + 0.032082432514461835i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.050025896205936615 + -0.0401515667406826i, -0.006144839040396191 + 0.007019664042175612i, 0.07065802051132719 + 2.795208725939191e-20i, 0.00043875271952220987 + -0.010266926010898163i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0055235649699353065 + -0.007518308328360444i, -0.03997234900864416 + -0.03208243251446184i, 0.00043875271952221 + 0.010266926010898163i, 0.05645810011102887 + 2.5305109299222223e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.1993399287363357, 1.0e-7), DoubleNear(0.15927920951192248, 1.0e-7), DoubleNear(0.06328216027060832, 1.0e-7), DoubleNear(0.050564543330610605, 1.0e-7), DoubleNear(0.2225740194890334, 1.0e-7), DoubleNear(0.1778440180391335, 1.0e-7), DoubleNear(0.07065802051132719, 1.0e-7), DoubleNear(0.05645810011102887, 1.0e-7) }));


}
}

}
