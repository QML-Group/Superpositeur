#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { 0.00990688394685324 + -0.0045164326644295235i, 0.1348337766912946 + 0.08660017607536866i, -0.07088230516452794 + 0.11200947529776224i, -0.06279048790667104 + -0.04331148424226676i }, { -0.16918833475039233 + -0.07345079204271039i, 0.032139831190972634 + 0.0026956786164246153i, 0.08593780318140426 + -0.10019016274935287i, -0.04331802884410227 + 0.047207908021967095i }, { -0.044369694128010936 + -0.11732729915601293i, -0.0108563236073275 + 0.07630045118883218i, -0.018888902863472105 + 0.07855725776507352i, -0.08345785168165791 + 0.10749869530019686i }, { 0.05552919117365988 + 0.003917502034922618i, -0.0892055382585673 + 0.022758099285101575i, 0.016476905340454293 + -0.08475528037101678i, 0.03236173357645458 + -0.13716154755541543i } }), Matrix({ { 0.05635213094819201 + -0.056784003969658256i, 0.024525790551159447 + -0.06654251926593761i, 0.1158087328834011 + 0.0646997990637459i, 0.07205043323428112 + -0.049455260098027976i }, { 0.015423290803300049 + 0.06729817344871744i, 0.019859252134765838 + 0.018594867459329766i, -0.018685280400166277 + -0.04945012405264477i, 0.009009310967775241 + 0.02034606201703081i }, { 0.07109388172680062 + 0.1567553136752215i, -0.11182129431635195 + 0.009301604279158389i, -0.148096124331151 + -0.0868840889001593i, -0.15280517308135075 + -0.1159298399065842i }, { 0.031794438988651585 + 0.0269515434706339i, 0.10069979690065031 + 0.14166751524604915i, 0.11600459147055746 + -0.09176770935223477i, -0.0700104966217482 + -0.09277364151942508i } }), Matrix({ { -0.1262747655284251 + -0.09398756601759045i, -0.1602840646975865 + -0.10668765807303726i, -0.06389950802262491 + -0.09440846875683398i, -0.030207248062767658 + -0.09845480425678975i }, { -0.08215612452351202 + 0.06836067189081614i, 0.011274373665475885 + -0.20351356236973756i, 0.0066865422096738895 + 0.05269790716326142i, -0.016594535454265955 + 0.07830414309968639i }, { 0.19533609497498347 + -0.08516113407006484i, 0.02627941961623349 + -0.1381588998774468i, 0.03261180227100304 + -0.1465932871561017i, -0.08187570866418155 + -0.026311130871863705i }, { 0.01688063692411176 + 0.04983970584673003i, 0.1280987385575203 + 0.1164352248152459i, 0.041068348471182375 + -0.06974330891283513i, 0.19740783659591218 + 0.0068277948482566905i } }), Matrix({ { -0.016363695864382667 + 0.0003199212336277863i, -0.23298512830166473 + 0.024636550132653087i, 0.00980339924185841 + 0.08173082077882396i, -0.024569344835211046 + 0.01205204275161582i }, { -0.09191857271915216 + -0.10435376415336449i, 0.14015264342708694 + -0.0452781723535477i, -0.04909972147416398 + -0.05048967938653178i, -0.08161922694357682 + 0.036100555815560764i }, { 0.049023614725116016 + -0.048876390022939364i, 0.04519951647369857 + -0.013819952350391221i, 0.019214776742685298 + -0.126949883713586i, 0.0674835157482756 + -0.037889130628557866i }, { 0.01410296858355991 + 0.0636709512032944i, -0.1745808710758539 + -0.11801834014012505i, 0.03682759715470125 + -0.05708322393277787i, -0.00840636835754692 + -0.12030887915848698i } }), Matrix({ { -0.06106918001590549 + 0.02036079490533459i, -0.05051937417017714 + -0.037124798573149626i, 0.0015939626469380181 + 0.07007556378198765i, -0.21578762829398135 + -0.022613277317104327i }, { -0.08540858410311447 + 0.10782767599437817i, -0.03763191410524503 + -0.02433777758702677i, 0.17922330553573892 + 0.022543960169097824i, -0.04375121906420082 + -0.17410817230672407i }, { -0.060403464802745006 + 0.019020986865496532i, 0.0395512377527731 + -0.10323210096810082i, 0.17070180117113035 + -0.11995639261550611i, -0.12392300322542656 + -0.02777959492894399i }, { -0.08057003785525366 + -0.20722904232543082i, 0.0630411663423996 + 0.0011770573424542978i, 0.03155950734275773 + -0.0922307587252375i, 0.012559255133572027 + -0.11356906685014177i } }), Matrix({ { 0.020296626863947557 + 0.21959010244837532i, 0.02783444692107055 + -0.06912127027484499i, -0.002770590782457812 + -0.0574171978394683i, -0.007096050373262783 + 0.14699644760522174i }, { -0.004813403347123007 + 0.01759327324822051i, 0.07695006996470367 + 0.0055151360715799975i, 0.060360070067499494 + 0.1342673166261136i, 0.025523316175287775 + 0.019768570130038632i }, { -0.08024166394874153 + -0.04222909476878618i, 0.01605584883047063 + 0.13236359145265267i, -0.08892439754180556 + 0.007668116901559098i, 0.0570174767595274 + -0.02512026835614898i }, { -0.1985593283693293 + 0.051971076488979806i, -0.07203465977609444 + -0.05933229680810595i, -0.09465315911718405 + -0.0885768514623182i, 0.156858081139997 + 0.11023730334329497i } }), Matrix({ { -0.05511454372644291 + 0.09443852845156686i, 0.040204950796328624 + 0.007410194041702455i, -0.07820881727526925 + -0.06473967973983809i, 0.0781784377218979 + 0.06576095935943917i }, { -0.02691643275451044 + -0.08270431926468359i, 0.05213574721195942 + -0.061313706534443256i, 0.02440498403296526 + -0.022394782121492256i, 0.16151375904626106 + -0.04313548576239854i }, { -0.1727489747151901 + 0.12689727517911054i, -0.09669440187976663 + -0.031565934585773434i, 0.04057588934952983 + -0.024774965684439154i, 0.10498561606834364 + 0.031493739381297195i }, { -0.01800015830813123 + -0.04526585119143946i, -0.009246630635229229 + -0.05869345370488249i, 0.025984723574424603 + 0.055164286021260486i, 0.02070596537405148 + -0.023147448786157116i } }), Matrix({ { 0.047574219198140304 + 0.0069767686623054825i, -0.10374407996853449 + 0.017509904736834097i, -0.03357184291831211 + -0.10547396584599418i, 0.08219276598345798 + 0.06773836535374116i }, { 0.1074984374156819 + -0.011143873120310541i, 0.023721999556291628 + -0.004085180322131618i, -0.15032891941045606 + 0.2616633087811836i, -0.013001386108869787 + -0.18660607238129687i }, { -0.18096204908371194 + 0.16680993743322434i, 0.14956216505804873 + 0.025571260192846737i, -0.07166124825610905 + -0.045361662850217484i, -0.13038526697832123 + -0.15727466976342455i }, { -0.12474038301774343 + -0.024243875466454054i, 0.10081878623126064 + 0.071111512545961i, -0.1246662954249185 + 0.05849984263994068i, -0.05673370370141916 + -0.09073965223859808i } }), Matrix({ { -0.034950647346818936 + -0.0022163901359450178i, 0.03654638941747502 + 0.13862601063395144i, -0.022592050402375396 + 0.05054952897683229i, -0.19224742359195754 + 0.11666635331741285i }, { 0.09017092150383084 + 0.00680288492598402i, -0.031931025308849295 + 0.05317816016944799i, -0.029638626886326076 + -0.12812984984018422i, -0.031151373910196838 + -0.0581754686628532i }, { 0.00587328721015911 + -0.06069922531532781i, -0.17176963148649346 + -0.10940417990708132i, 0.033576823555488834 + -0.017762219499387614i, -0.01742370516695394 + -0.1668610565974074i }, { -0.14367558939219957 + -0.042487432086439i, 0.025247472764871364 + 0.10836482907383957i, -0.08263552845184302 + 0.0796284189203616i, 0.024986064255052363 + -0.02658324005339174i } }), Matrix({ { -0.07330375876602412 + 0.2212125793023577i, -0.08732052930619924 + -0.018190878493157696i, -0.03412593319015042 + 0.0020778778741460456i, -0.015041510437240614 + 0.10258507342842736i }, { 0.21653362924437536 + 0.10241294671608936i, -0.05433397279942392 + -0.12903514403781158i, -0.0075105715224493596 + -0.09187596390758798i, 0.18098692950656292 + -0.04480634117109999i }, { 0.05601443093273262 + 0.007811594005303345i, -0.1004350337473663 + -0.13992512730653814i, -0.04073465681460823 + 0.07900194092526454i, -0.057392759389729986 + -0.029371969195157808i }, { -0.11073795717521275 + 0.060928909186673444i, 0.09805251093038635 + 0.03499093172154873i, 0.13751589875934908 + 0.1439815324210859i, 0.0664868347044104 + -0.0795432834174396i } }), Matrix({ { -0.1483225363022951 + 0.07610606903781289i, -0.07338830328339772 + 0.10312411160231415i, -0.029427200946525178 + 0.04845740086748795i, -0.08006939435135874 + 0.13946624189720958i }, { 0.08734227885852272 + -0.00020717073115709088i, -0.026455385484976366 + -0.03561298525185704i, 0.054051058652482754 + 0.0964542633391914i, -0.07710072179890438 + -0.10310420897348894i }, { 0.09975005046432928 + -0.09954382397334725i, -0.054980033551031364 + 0.02436577440486399i, 0.005111082945432123 + -0.08401131779802215i, 0.06699871713264115 + 0.15933792879084263i }, { 0.029330325046304704 + 0.03868228620031975i, -0.1625923300187167 + -0.1891937926021404i, 0.06868191081290922 + 0.22840039626693337i, -0.1006953516763939 + 0.11080778075306189i } }), Matrix({ { -0.1513908645106942 + 0.05373700994954603i, 0.023362108408613514 + -0.04162217677475653i, -0.06457611258047093 + 0.03679924602860049i, 0.00882889207415301 + -0.02791370178019022i }, { -0.027243475585965966 + 0.09832263727741322i, 0.06681341705980948 + 0.0639722838873731i, -0.03156683896347276 + 0.04889102099640768i, 0.019810694324007058 + -0.19265198506074357i }, { 0.08904610234149991 + -0.030510549223031744i, -0.10586442791049279 + -0.08021390316548556i, -0.08055185170740582 + -0.1059896117944471i, 0.01774891671411727 + 0.018684872780199455i }, { 0.16957232970875744 + -0.07365888368772645i, 0.002021287675341792 + -0.019224417599233504i, -0.045303165258684656 + 0.04674970071701682i, -0.08789655005099814 + -0.056277328113542434i } }), Matrix({ { 0.044836180529677534 + 0.046160545535308205i, -0.03405804526919705 + -0.03704210137167226i, -0.07082366828876735 + -0.01101862337492482i, 0.0596129482354135 + 0.04435852764906207i }, { -0.09479342164079406 + 0.06548911528794098i, -0.04343387270074435 + 0.03591126619637735i, 0.055031911033219846 + -0.020438604270623637i, 0.09339064902020436 + -0.06273950771201359i }, { 0.0345269664455867 + 0.024075988054853715i, 0.08636054230925994 + 0.14018106915086082i, -0.03940683188698595 + 0.019273670741220654i, 0.13588922725166228 + 0.0205411103590068i }, { -0.05797586090990189 + -0.03155418546698218i, -0.12436994047752915 + -0.051938042486162586i, 0.016474671420885136 + -0.01273607684263931i, -0.05900213403094605 + 0.0313076665411563i } }), Matrix({ { 0.007059217243088219 + -0.062146034212970366i, 0.14086741377315404 + 0.06507759976663266i, 0.049304387651364086 + -0.03720896572104352i, -0.09644032074898617 + 0.0831414210524738i }, { 0.10236328574571797 + -0.11369551084364897i, -0.02748060394147978 + 0.07277819847635172i, 0.052252577028193234 + 0.14378495569820524i, -0.09836805936991172 + -0.02974731538025251i }, { -0.07548745812738542 + -0.14991762151554971i, 0.09222955933854705 + -0.2646362432796296i, -0.12623291712926685 + 0.0159641977837645i, 0.11547500243896379 + -0.03158522858368768i }, { -0.03836550143789013 + -0.11571318667160406i, 0.02699175560488143 + -0.0897646405836625i, -0.17382274411091544 + 0.08236718106569632i, 0.07770795773869654 + 0.0018574141463372i } }), Matrix({ { -0.12185596253518248 + -0.048121874071885486i, -0.059561586552354065 + -0.004585888080325446i, 0.1256888838071148 + -0.197105612768865i, 0.005405510956535354 + -0.09232844855802863i }, { 0.08386512055026185 + 0.06527306593729428i, 0.21338676952107244 + -0.10358438000697631i, -0.0434728900647443 + 0.0312827255003577i, -0.08871416191049851 + -0.0028997163590861047i }, { -0.011028656102460148 + 0.04721420639838003i, -0.0858657288758984 + 0.02485457637445909i, -0.07657274376632743 + 0.08109438484565479i, 0.06947661700719042 + 0.06245279852594699i }, { -0.02416683400372268 + -0.00660791694114703i, -0.016721687125917487 + -0.024079356314702777i, -0.21543298131395647 + -0.25277285215295076i, -0.0901663641916663 + 0.039794679581143855i } }), Matrix({ { 0.07294668986964527 + -0.05447482407831777i, -0.03902616533588787 + -0.10547200692290525i, -0.12472310411830818 + 0.06229720205545051i, 0.0117043666915972 + 0.17295488932383418i }, { 0.04372772461907951 + -0.09251795560616854i, 0.04060244243274531 + 0.017462200057471i, -0.06580275227255974 + -0.0670936166371069i, -0.01645507852800206 + -0.015750565303699986i }, { 0.010877734748718306 + 0.09081206699282002i, -0.029728148605153066 + 0.01644439832965337i, -0.032958557249905714 + 0.007820917738597161i, -0.13563439813138614 + -0.09486886584339971i }, { -0.03098887742402944 + 0.01872214445871028i, -0.12157406802501329 + 0.0021208606176181402i, 0.09560598662004403 + 0.041301088816518575i, 0.06896849610014062 + -0.046175134399980326i } }) }, { QubitIndex{ 9 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.016981704291538335 + -0.052627468375408444i, -0.1061878927321009 + -0.10057663531707843i, 0.008844829868033297 + 0.06837662058091083i, -0.061362800335206046 + 0.14930749737484492i }, { -0.07794597961847062 + 0.019209276956366487i, 0.008121526688013372 + -0.06892274577849042i, -0.046346907546660196 + 0.0060349077887457215i, 0.07411027261311914 + -0.007396766361852749i }, { -0.06938183047594487 + 0.002975561608350045i, -0.03688245618287451 + 0.06376073907327844i, 0.15726326302321547 + 0.08968950109593458i, -0.055016228807112856 + -0.03587333086517832i }, { -0.14889408863024003 + -0.09381074333596043i, 0.08115535635228145 + -0.1895268765012711i, -0.006014325966493752 + -0.08632349669557106i, 0.03340234828651331 + 0.06630455266885177i } }), Matrix({ { 0.036020084297804865 + 0.03615573231481439i, -0.18540807850336263 + 0.028935354567319976i, 0.03896323777772197 + 0.08913431860030299i, -0.018643388514808262 + -0.03584781648007394i }, { 0.004149086544404473 + -0.020733007232568573i, -0.10663521083761064 + -0.03821967599908169i, -0.06592203331312127 + -0.07620259768523091i, 0.09546311820251273 + -0.09659186879008454i }, { -0.07945387121370821 + -0.013021373005371185i, -0.01637685684616219 + -0.019464241695700626i, 0.08568547263819129 + 0.1557078772572155i, 0.002270562238684094 + -0.03811865169878264i }, { -0.039820579431867384 + -0.09998818845314984i, -0.16327193799520948 + 0.08673642295889573i, -0.027993779078709837 + 0.13509519746113427i, 0.11197576078908392 + -0.10127577148452971i } }), Matrix({ { -0.03588570424522054 + -0.017105980743871027i, -0.08075158788453908 + 0.18287231387585268i, 0.13624007229608434 + -0.017196284592167026i, -0.08678664109240768 + 0.0929541925832485i }, { 0.002804346310795519 + 0.030143025333294007i, 0.08881898180512691 + 0.1145265289455833i, -0.1044521846700138 + -0.04863736558068328i, -0.05443892723396996 + -0.04635057903750687i }, { -0.06425347360093944 + 0.10084035725690207i, 0.08689109053627254 + -0.040559559470940684i, 0.07749581277046799 + 0.0950839987063561i, -0.08408421525483502 + 0.07303531440726374i }, { 0.12792083711613467 + -0.09017408612599513i, 0.061305594493672524 + 0.01271583576938433i, -0.06442373285090758 + -0.0768257153422176i, 0.10446784141002965 + 0.027236103063279463i } }), Matrix({ { -0.07995367331541219 + -0.012494655289916595i, 0.13215882780731047 + 0.029349814092102425i, 0.08973486524398373 + 0.07499497756501582i, -0.03529274636389403 + 0.0501138596131107i }, { 0.05187071307927453 + -0.014298971524095754i, -0.04591414790413079 + -0.049020764848147776i, -0.05861324631712625 + -0.05707223557095494i, -0.07763829840935846 + 0.0831598704940774i }, { 0.1819093482520704 + 0.1464579205728483i, -0.08822890136545349 + 0.07123030141877346i, 0.2055576000347136 + 0.19435868037290724i, -0.024965438188947607 + -0.02777455985768504i }, { -0.03133833405120673 + -0.2281957062591778i, 0.005282598190864103 + 0.08106555680340172i, 0.03255949576905739 + -0.04931459688593538i, 0.07817862474112608 + 0.06794089700285487i } }), Matrix({ { 0.11866104692770113 + 0.030562486462255723i, -0.03781777910241299 + -0.2102194997787161i, 0.17007365747702155 + -0.07358843131317917i, -0.048947110142868615 + 0.07752053454758133i }, { 0.1630012344125566 + 0.01753474486715053i, 0.05119670351275253 + 0.003489072229933255i, 0.03447122741992779 + 0.02389318044879666i, 0.09799358108325393 + -0.024248618075258535i }, { 0.05426317184268089 + 0.10463089642435908i, -0.03504443797862472 + 0.0532349064113207i, 0.05625650211726641 + -0.18639021596784808i, -0.06404772826021246 + 0.048581749657903614i }, { 0.02315536960651493 + 0.06992542292900407i, 0.04672989194611338 + -0.012421250879652863i, 0.12613568652963295 + 0.037986103156883756i, 0.053895061467255326 + -0.08664696191925457i } }), Matrix({ { 0.10820592568554892 + 0.12005687708374659i, -0.028048336846729752 + -0.032923174098918075i, 0.0015271989039557171 + 0.12075098680043642i, -0.050049478363215896 + 0.10138559699181436i }, { 0.12640977326328096 + 0.2154708033902702i, 0.19718418818730896 + -0.0014690389746185196i, 0.10957957633655417 + 0.057687025780347616i, 0.10348948231586709 + -0.004824964498854253i }, { 0.014692289735141605 + -0.09881180761380562i, -0.0389446292607157 + 0.19094089358976254i, -0.05424803523467421 + 0.056401675041673i, -0.07666409824541812 + 0.000687784027669314i }, { -0.15873886688743022 + 0.04489400858650196i, 0.0002038421880771334 + 0.10816512533236074i, 0.15769418448984446 + -0.10739391601428862i, 0.07120750246682601 + 0.009263931861496932i } }), Matrix({ { -0.05404276769551056 + 0.0057427780537101045i, -0.037029046468501595 + -0.0063920798711148245i, 0.09878465815032653 + -0.1380685321003058i, 0.013196639536979358 + 0.04275411752672882i }, { -0.007890389602036581 + -0.09112836097502311i, 0.1335606220173722 + -0.19001294486297168i, 0.048104664678336975 + -0.07508591924422907i, -0.15606977074356346 + 0.12115909604807992i }, { 0.08931979019550962 + 0.1239553122650416i, -0.11374813098587636 + -0.024657992439092287i, -0.07057711573953816 + -0.07517102272446707i, 0.08811961655002847 + -0.09766311517296587i }, { -0.06342272265318083 + 0.03146582105960142i, 0.019125792671353527 + -0.13733076831108457i, -0.028543341653225012 + -0.006204448873045782i, 0.04339665544623297 + 0.04391900750997961i } }), Matrix({ { -0.07046388215880096 + 0.007244973836348987i, -0.03677993420109036 + 0.07538318764977785i, -0.03480437054784732 + -0.251418481954503i, -0.057496731820685563 + 0.011662288218003043i }, { -0.018547897069038272 + 0.03688380668031517i, 0.08617097545204837 + 0.0006215959824034979i, -0.14519244550828742 + -0.0433233594726696i, -0.2736214216052638 + 0.022884072505408158i }, { -0.05769388704779639 + 0.0732817242057509i, 0.009576916900781898 + -0.05320640182905583i, 0.057943479812712355 + -0.17048342078747813i, -0.29418166387614425 + 0.07128676259477984i }, { 0.0581762956508822 + 0.12005045669111966i, -0.033603356953731775 + 0.033691891478532104i, 0.0671430970128816 + -0.07214366884202239i, 0.012809643511570443 + -0.05242261346867362i } }), Matrix({ { 0.2064583454244046 + 0.20036666660335412i, -0.031161140890098346 + 0.1286859824177846i, 0.0004696105574069199 + -0.14726136912802887i, 0.05405301069550813 + 0.026322258755208723i }, { 0.06671501342532134 + -0.0846310674766349i, 0.10261441125810924 + -0.04365087013272665i, 0.1002701464196101 + -0.09517699371954354i, 0.18073046082363017 + -0.12296808955705926i }, { 0.07385983233586713 + -0.08891699114963114i, -0.024433708655939832 + -0.10114259492510719i, 0.013499911670078177 + 0.07950220322001723i, -0.04429007940061572 + 0.03460729983736249i }, { -0.09253658591698147 + 0.0142674191363611i, 0.05393762452478247 + 0.019102040448890894i, 0.07839892936311646 + 0.05416527703122257i, 0.06580746026983249 + -0.06199057849076613i } }), Matrix({ { 0.04153518404465859 + 0.036382645030378184i, -0.06131293534100256 + 0.007756888973129944i, 0.10617157283959462 + 0.05117591338391752i, -0.07602488282413734 + 0.10467526791735252i }, { 0.044203199674110655 + 0.11640134352638323i, 0.020619914839904763 + -0.03358791373854844i, -0.009282760160482052 + -0.0033376277929291044i, -0.012951531633223708 + 0.06712480458275347i }, { -0.02641778200451691 + -0.17101001756881748i, 0.12377349881993402 + -0.057587155681124234i, 0.01420163408851967 + 0.03293575236348037i, 0.022963262403266495 + -0.060183019682524985i }, { 0.004716488142330478 + -0.13433344147228585i, -0.01467312866096714 + -0.20136276264886355i, 0.19435750967297322 + 0.017693217553175874i, 0.006766454747544567 + -0.05862579184775158i } }), Matrix({ { -0.1354083247842092 + -0.006037996096945075i, 0.004749093790457367 + -0.08399059616396949i, 0.08896352799700463 + 0.0351277805454652i, 0.10995398453770498 + 0.16372636478659197i }, { -0.04266964554670823 + -0.05392589991111611i, -0.02037852599116699 + 0.04020205767343181i, 0.01848137714180655 + -0.059944592965056824i, 0.02300260745800469 + 0.030946767716163087i }, { 0.0031710627756765036 + -0.08553863018841561i, -0.13043521566229807 + 0.14034921450888527i, -0.03682567215172125 + 0.0355364336861609i, -0.12092472614240131 + -0.14449412461199626i }, { 0.04545168987074502 + 0.0023022865243229043i, -0.006531371158610343 + -0.02901876099282652i, 0.08257448962524586 + 0.046060865766568454i, -0.07876213663901681 + -0.03192339953834727i } }), Matrix({ { -0.06793983606967766 + -0.042593400299715554i, 0.05327955309384715 + 0.0025253586837668887i, 0.014727904818581472 + 0.012997248601621571i, -0.004718348847335218 + -0.04832093529087627i }, { 0.0530995423282835 + -0.05763812696125338i, 0.01241336750860849 + 0.013393136634426876i, 0.04665590725375105 + 0.13723807794272266i, 0.08082772235355284 + 0.1025342462863727i }, { 0.1250748598245384 + 0.010671235338786646i, 0.17270444981010183 + -0.10372348930850335i, -0.025602092693831145 + 0.0477350696769728i, 0.002558745653733578 + 0.017726015885409847i }, { 0.014037798660518672 + -0.038435927540388874i, -0.20181433731069012 + 0.12880385482912707i, -0.15376800176993474 + -0.018342990492248093i, -0.022510558368403166 + 0.019685325850142005i } }), Matrix({ { 0.10498541715295112 + -0.026172536517349552i, -0.04033401419052682 + 0.0553438158964853i, 0.14649512127972655 + -0.10246691174225252i, -0.10498884024856671 + 0.04094704089082039i }, { -0.02014471280567429 + 0.10235292396943513i, -0.19891316298088765 + 0.02970408924298625i, 0.09811791859993514 + 0.08731396817797707i, -0.023437139090064753 + 0.07059673450661674i }, { 0.13167745955518895 + -0.07577464653360418i, 0.024265188421810528 + 0.019461741943408384i, -0.018643805618394845 + 0.06344049639718202i, -0.04324706238590461 + 0.01913396269832897i }, { 0.028013232968047377 + 0.16350219559458454i, -0.07860218923321792 + 0.02006329119609682i, 0.020791058699094558 + 0.08196890215995231i, 0.1332120454901824 + -0.2176816472545643i } }), Matrix({ { 0.05214442329551893 + -0.036467569123427676i, 0.06623224584865392 + -0.0978131276169417i, 0.013886890686352312 + 0.03676925593790842i, 0.03572721943727796 + -0.08733171960681627i }, { -0.10125129602743757 + 0.0879239977130585i, 0.12450010948537109 + 0.0193562699708318i, 0.019382570074871056 + -0.07632222085190954i, 0.1684719478326549 + -0.03970748992784022i }, { -0.10635642268057163 + -0.10783027572263179i, 0.2012418321201203 + 0.04936929464093723i, -0.03283693192854747 + -0.08812864871007346i, 0.1813474238309814 + -0.06649737763742194i }, { 0.062059235258822724 + -0.013085049534076482i, -0.008860191328578968 + -0.005624918799100645i, -0.023830092276075333 + -0.05451019990551004i, 0.1738251293301495 + -0.11739069028788165i } }), Matrix({ { -0.08406781998723878 + 0.07347297321828737i, 0.06683822544571953 + -0.08796274275633643i, 0.0771775581147483 + -0.04561940570479201i, -0.109255155577564 + -0.06949627830134415i }, { 0.05874071629419332 + 0.1462022782653564i, 0.13909641230033232 + -0.028672847276678393i, 0.06030169736422891 + -0.07153115375116988i, -0.10475140935040911 + 0.05210022262807442i }, { 0.07363167400705715 + 0.14221075285783014i, 0.032708792237307605 + -0.07293966923740652i, -0.08349036300348532 + 0.025002994192865308i, -0.03256514344407147 + -0.15926328064413i }, { -0.014204042224105394 + -0.16548560090188785i, 0.0012648815319024381 + 0.04642007802441601i, -0.0025444143531021435 + -0.11433033322942389i, -0.08543699769725434 + -0.0795146644607794i } }), Matrix({ { -0.04515344998779926 + -0.0387605357675604i, -0.10745334112206914 + -0.04443501947335492i, 0.12094256686111657 + -0.13533898955262566i, 0.0924321795419645 + -0.1776657711781415i }, { -0.11369102348000747 + 0.03428717193775099i, 0.0363835446066772 + 0.11357863509622951i, 0.1568648684845238 + -0.08213653098516216i, 0.029696952277418566 + 0.0074698659839954554i }, { -0.02098434897315402 + 0.05363589739242248i, 0.06744925093402648 + 0.11067786519919444i, -0.07350573460425577 + 0.0867700459378146i, 0.07229993721511299 + 0.009396843777007148i }, { -0.012923126269405014 + -0.18980102723271114i, 0.023942969565622852 + -0.07429815314673041i, 0.03974988567351163 + 0.005051447693271355i, -0.08303658278533944 + -0.09746799786028326i } }) }, { QubitIndex{ 7 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.010328200389953633 + 0.23000039437332603i, -0.055733556552747816 + -0.09639070849110654i }, { 0.00474444064349164 + -0.11472651169167944i, 0.7657679758337107 + -0.09690300629727866i } }), Matrix({ { -0.005972152664364959 + -0.3453018364894297i, 0.01557098915521977 + 0.44076181173605417i }, { 0.25446810390457325 + 0.09138842860317806i, 0.16986604219411153 + -0.24161674710708425i } }), Matrix({ { -0.022056483900278184 + -0.38381999721919763i, 0.040721452051901336 + -0.26682081984666794i }, { 0.006031333436898336 + 0.2145171702726481i, 0.12736092905375504 + -0.10003240559846334i } }), Matrix({ { -0.6345498328353504 + 0.04619359383770701i, -0.06454234161149659 + -0.0064440053621768875i }, { 0.372134318840291 + 0.06560500888767055i, 0.05779259296209309 + -0.0586443819989064i } }) }, { QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 0 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.005206145075099533 + -0.06095551713345145i, 0.0299006544625137 + 0.11224209296237453i, -0.06244260196397681 + -0.04850513000172128i, 0.10008772818300007 + 0.043340261698048346i }, { 0.09565895789853776 + 0.07725058639448769i, -0.1511647302998624 + -0.05104810506118734i, 0.13453921845503938 + -0.056849837733178456i, -0.008926122492414755 + 0.12449706821077433i }, { -0.11775522605842642 + 0.14845418889355033i, -0.03967123322098784 + 0.13683670019044536i, -0.19611314575443423 + -0.018820522280721858i, -0.16059176419129834 + 0.001237981322937122i }, { 0.0006212798848809248 + -0.05804588768543516i, -0.08637031929769089 + 0.03666806671595811i, 0.06236110585891882 + 0.14483455392668296i, 0.025989243828454498 + -0.016767325988221934i } }), Matrix({ { -0.060050829186693466 + -0.06386617633940286i, -0.08400763486914949 + -0.14330953321443335i, 0.06921979503938379 + 0.148557354540978i, 0.07083537711891116 + -0.07191582886121611i }, { -0.08210490562134827 + 0.12251050572505555i, -0.25773814631604947 + -0.10921286560680292i, -0.0014089122543325568 + -0.028635363105965837i, 0.14604399031844978 + -0.046078723310862234i }, { -0.023246426561822634 + 0.11971180409931752i, 0.056733385588531804 + -0.02565888882241099i, -0.06204169012306448 + -0.0682594650104621i, 0.06932173882938823 + 0.20422367187624846i }, { -0.06213992977772129 + 0.036602453071292264i, 0.07871317274595714 + -0.0859372250562355i, 0.053614353738279066 + -0.1515833095284074i, -0.004791209089650414 + -0.0457328886354367i } }), Matrix({ { 0.052685534855379614 + 0.08302041745821165i, 0.03648363856238539 + 0.10131283969441068i, -0.1143933490666093 + 0.0008227626708826941i, 0.21810958727243512 + -0.003936371705523336i }, { 0.1556330422720782 + -0.08902319741268991i, -0.03211801232431725 + -0.009581439781525269i, -0.023315133227444277 + -0.08423319228781871i, -0.07966158797281762 + 0.11577541655509026i }, { 0.034810084854593686 + 0.004526489807677399i, -0.0027086332790469546 + 0.03827187095874159i, -0.02422938701698942 + 0.12216917176541547i, -0.022012879695692048 + -0.007349249455923874i }, { -0.018442100213304738 + 0.04569057423892288i, -0.021189931036148885 + 0.1737055931906145i, 0.12427907681215437 + 0.04607719270448533i, -0.11969103935607872 + 0.0810425250017479i } }), Matrix({ { 0.1715124602267054 + -0.11866350483308104i, 0.051353458635926746 + -0.008478956004644543i, 0.05819082918976561 + 0.13948461545536414i, 0.043151342056392004 + 0.06032547757386783i }, { 0.07034752227526825 + 0.07016029879277629i, 0.17491124585479495 + 0.12488544018439401i, -0.1262463806610482 + -0.07760536776800703i, 0.09899336726219604 + -0.09607960352702373i }, { -0.028665275762805496 + -0.05847443569773974i, 0.052942903688903774 + 0.03242510446150028i, 0.0015951893576797334 + 0.14894398168258918i, -0.06954441230396473 + -0.14240371219024986i }, { 0.03534326351292787 + -0.027076508717075756i, -0.029316246831812297 + 0.003958738002847787i, -0.08807024702127252 + -0.0066877925792243635i, -0.03428126836037148 + -0.07508864254704957i } }), Matrix({ { -0.14802986940844343 + 0.12450605202111954i, 0.016332437444690727 + -0.08345962536379377i, -0.00030726062092440863 + -0.07625227093877453i, -0.005283308896771946 + 0.029584405501055833i }, { -0.06036951018632951 + 0.08640334480392071i, 0.12974575019514642 + -0.11236266853142501i, 0.13858557633935356 + 0.027378437096810093i, 0.1581388508229776 + -0.004755336783373317i }, { -0.04088596441924146 + -0.10803530039965387i, -0.11999185080001153 + 0.01599338301661534i, 0.03720765879077485 + 0.0702634987119675i, -0.038300839639890366 + -0.13344789338010038i }, { -0.1229118038167919 + -0.07425626549310667i, -0.02551945095645674 + 0.005673803630368673i, -0.07785102895433159 + -0.0011893856621698264i, -0.17866237887496925 + 0.18369928630042542i } }), Matrix({ { -0.014499879595152507 + 0.02342845919325993i, -0.12523560232301872 + -0.025015792600126183i, 0.04736735498123275 + 0.11862670901863552i, -0.02794772463013862 + -0.0009754732994330905i }, { -0.0008812674802973824 + -0.026338565925565972i, 0.011220585954901397 + 0.1372798706450296i, -0.10067857698757748 + -0.04288558053469651i, -0.027852712004765592 + 0.06823941342840421i }, { 0.054813548948816286 + 0.08571827506623328i, 0.050250285067882206 + -0.1401946177587113i, -0.011086598656462431 + -0.029257262664456943i, -0.01266273117767 + -0.19480122929009763i }, { -0.06882777644440188 + 0.11500544215373644i, -0.012100805600884168 + 0.025468414092266717i, -0.05747762016364729 + -0.025052330870765926i, -0.08541850114034649 + -0.08639574740596127i } }), Matrix({ { -0.03383648849835639 + -0.05111737046833441i, -0.07899903303438044 + -0.1379803331384214i, -0.01098238428141872 + -0.17577640890420962i, 0.07053701279049077 + 0.014519096348378752i }, { 0.06448944451621676 + -0.13903975424131856i, 0.007490365571471279 + -0.19749834012704992i, -0.05530117994135795 + 0.0770244304640405i, -0.03334459309367375 + -0.030034431632136004i }, { 0.1181899117720153 + 0.06222145836733577i, -0.08251041152080657 + 0.04578149889556526i, 0.11720214790117865 + -0.05201905597079394i, 0.08541416106751319 + -0.13821720871787413i }, { 0.0295075459717455 + 0.02891106059958334i, 0.08455747360769192 + 0.10014198094501595i, -0.19949503122676743 + -0.039946353285870206i, 0.005012259735271813 + -0.05276232250508949i } }), Matrix({ { -0.11030726045589243 + -0.1731943069703721i, 0.12833155948867872 + 0.06777043969532007i, 0.05183770907552204 + -0.07447922639265438i, 0.1340978802304802 + -0.06765600417864799i }, { -0.006179641129596271 + 0.02956296526076818i, 0.13149478654866606 + -0.06701177892122281i, -0.11087363515896549 + -0.1445947138399207i, -0.07402166008437826 + 0.0748225155519169i }, { 0.021869913703261343 + 0.06621989876224028i, 0.035325306417061324 + -0.06349845702226371i, -0.09344263476976927 + -0.08163294212267481i, -0.014171061060891136 + 0.07938052567818095i }, { 0.07591584942866908 + -0.07467315149342145i, -0.022851756894072872 + -0.0022932588169823458i, 0.03213014272826054 + 0.07741667520259399i, -0.12977027975379932 + -0.07294942439726075i } }), Matrix({ { -0.06488836034169504 + 0.08693123232478273i, 0.009636509754041657 + 0.10487563932413044i, 0.07520485763399577 + 0.03512199279878054i, -0.06712599215611474 + -0.000960804773452667i }, { 0.0473301725976214 + -0.02521529444444826i, 0.11802200253815612 + -0.06356310860627576i, -0.1699410195575799 + 0.10495590582596134i, -0.02160401081145367 + 0.03243406795799568i }, { -0.007938735827874726 + 0.10481525384270661i, -0.13840228590715298 + 0.04312145580436315i, 0.08968326262614165 + 0.03363958185651817i, 0.00485263276163444 + -0.034859861810358064i }, { -0.029104486526772555 + -0.21846778327406652i, 0.03829650483078093 + -0.02066607521957332i, -0.09512997831768866 + -0.20309740105156732i, 0.08484998839849947 + 0.08823659977735587i } }), Matrix({ { -0.09990799222505137 + -0.038112434095160255i, -0.11060498294695813 + -0.016924276492740274i, -0.04993412865502076 + -0.03899080631022986i, -0.06460045319318274 + -0.14427973514612796i }, { -0.012717291046346356 + 0.15074521120272477i, -0.06910783693031748 + 0.05260626841972272i, -0.05269071205829727 + 0.10624806998650713i, -0.08860110645119028 + 0.1679183129565437i }, { 0.12556918728192204 + -0.06037010084783848i, -0.19818558089464078 + -0.08011268409139301i, -0.08048609442039262 + 0.011950761207470585i, 0.1214568538652357 + 0.03107567617386981i }, { 0.05764086437308302 + -0.17772108305684028i, -0.1652316229723709 + -0.0671191562419688i, -0.03487205626212426 + -0.007219044840281164i, 0.017301572746047624 + 0.04045136309046553i } }), Matrix({ { -0.1120975943012174 + -0.03945101310761677i, -0.1268095979395519 + 0.1089983372023583i, -0.13687043734139737 + 0.1472269091897197i, 0.014721075262495074 + 0.09457972797946615i }, { 0.066333996317387 + 0.04328097560634434i, -0.05994459099284953 + 0.1578756703822942i, -0.1099288381910165 + -0.10961611589013989i, 0.0975395656591944 + 0.05600186553227357i }, { 0.029524043211402437 + -0.10166925001873696i, 0.02370986735437673 + -0.04614858426497076i, -0.04646236236476971 + 0.01616045884453284i, 0.03282427869115253 + 0.0318492275730763i }, { -0.03127916248557444 + -0.06869148416020807i, 0.09635385945071406 + -0.09697258108852438i, -0.18955662388684244 + 0.04052344457916686i, 0.012705887407643626 + -0.05480708495382831i } }), Matrix({ { -0.08945367437466024 + 0.011064598893578748i, -0.21771866049213306 + 0.015411919610686243i, -0.1619914355194498 + 0.01083130633218616i, -0.06425800001994585 + 0.17900670790772966i }, { 0.04253271391699876 + 0.252164753523851i, -0.12830199842765183 + -0.06507361828578893i, -0.19669821439311921 + -0.013158823065913507i, 0.09605854314195844 + -0.10877870545920665i }, { 0.05198915903253301 + -0.14917341087900282i, -0.02139537207240653 + 0.09732575684709097i, -0.016410910945065506 + 0.04439311524648956i, -0.10868643319478422 + -0.06995226687233201i }, { -0.0014632877824920535 + -0.09523239838556592i, 0.015486893740054684 + 0.17387355339802954i, -0.10798337606433267 + -0.13026481681427624i, -0.015224112006821881 + -0.05550173355251121i } }), Matrix({ { 0.015852182794389758 + -0.12523435433155572i, -0.006987322259915955 + -0.12326233639879473i, 0.059714767160024336 + -0.0561894335866668i, -0.06166977147569126 + 0.057166011124168144i }, { -0.1807541142336393 + -0.04139673999525405i, 0.045895480939567565 + 0.0608564667899277i, 0.004653748763247507 + -0.028899122197097737i, 0.013269451873853482 + -0.11243492061516287i }, { 0.06175070288485154 + -0.04219817073486988i, 0.06349624853678729 + -0.06742331864771184i, -0.11944617254781661 + -0.060273381232894906i, -0.07287815626967727 + -0.049383493672413396i }, { -0.04219102728794889 + -0.08025638854459564i, -0.03377414214418414 + -0.04385309926711913i, -0.006751964644213872 + -0.019799124215452924i, 0.13720762389257604 + 0.016902062747758056i } }), Matrix({ { -0.031249819975333895 + -0.22542982333752978i, -0.010163426605804457 + 0.17315158160278138i, -0.13342107534506886 + 0.0605464895838607i, -0.0609299904535827 + 0.02661640400945529i }, { 0.06139038616768154 + -0.08971505731311329i, -0.015040253681897339 + 0.0030810578242149466i, -0.028963591530516114 + -0.001313388402523231i, -0.01956888703268753 + -0.026304568713478384i }, { 0.04241680890402949 + -0.05088184184345014i, 0.007060956736208343 + -0.08318474184322962i, 0.023833527159165466 + -0.06993646832916463i, 0.1551336893836616 + 0.130421782006452i }, { -0.000588455640540603 + 0.0223300211087741i, 0.0385703120031397 + -0.06709270183304253i, -0.06875940068710919 + 0.05940833334782607i, 0.10173123576559873 + 0.03038745054392035i } }), Matrix({ { -0.018815724319076806 + 0.2017506952030452i, 0.08248652142452573 + -0.034748489257884686i, 0.04012576271058847 + -0.05104592726130067i, -0.16578152087654688 + -0.12495388895847392i }, { -0.08554322749016453 + 0.049877690685777444i, -0.012913001756376902 + 0.030209135346757968i, -0.18886459864763336 + -0.11466563712266539i, -0.0009269138426016425 + 0.010178039771925815i }, { -0.12815424281868412 + 0.09065146329881861i, -0.05695146793728401 + 0.017584119894266146i, 0.09821269829850632 + 0.08671116704951243i, 0.16938327749938123 + 0.0096884519875037i }, { 0.02224439961254331 + 0.04388239525713447i, -0.1049455877723398 + -0.11163843980283669i, -0.025110314443048284 + 0.002095208014673642i, -0.05026077388424064 + 0.03765152304372345i } }), Matrix({ { -0.08751835048637982 + 0.03866016944995107i, 0.02333382817354823 + -0.07696607448569813i, 0.04920567147192679 + -0.00034309156278204917i, -0.08033169588047522 + -0.10790956529141478i }, { 0.055151050831244414 + 0.1202366268240941i, -0.0011460989652366494 + -0.01946434007219134i, -0.007263859427757395 + 0.09115300719783435i, -0.03955928431623262 + 0.01084341359597247i }, { -0.06813900640445965 + 0.08702946629881286i, -0.04757541401360873 + -0.0571741037185537i, -0.0009342328609192226 + 0.010815510028323518i, 0.15494982962827508 + 0.11285899711111824i }, { 0.1084239248813366 + -0.003980891008707056i, 0.011185068712215989 + 0.0028709904872124287i, 0.09165790646084074 + -0.011887733278588188i, 0.06268923192552191 + 0.05804553306847195i } }) }, { QubitIndex{ 5 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.23964006195929288 + 0.14164666185808805i, 0.25337956002528844 + 0.051315726514008196i }, { 0.25315432863676673 + 0.17874898783452986i, 0.09811375072986656 + 0.043263261583531123i } }), Matrix({ { 0.25209473409199434 + -0.32903722746915137i, -0.15738029950674765 + -0.24701808292070662i }, { -0.3691590646283221 + 0.14520534981434455i, 0.007466777745325115 + -0.38569488006034847i } }), Matrix({ { -0.25389185016599697 + -0.29600995922274187i, -0.007858902211737982 + 0.1627521346898098i }, { 0.09024341647371283 + 0.004089617076096604i, -0.7275944234745703 + -0.039686993655177194i } }), Matrix({ { -0.08506303974825538 + -0.02345486294645274i, 0.11834740222970701 + -0.33448549682985024i }, { -0.2973270934960063 + 0.49077231984034153i, -0.05162515278418245 + 0.03153026832299219i } }) }, { QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 9 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.009802864384687249 + 0.05121863649660353i, 0.11137799593008801 + 0.05771259824598082i, 0.05783134891025195 + 0.04415252130006137i, -0.07634731031708582 + 0.032037386943886095i }, { -0.011751492106947202 + -0.06691661811280787i, -0.07862071741868644 + 0.03247893609152426i, -0.15258901592885574 + -0.008597240423387343i, -0.1102368218132342 + 0.015719470658678417i }, { -0.06395451594173195 + -0.01783515403773248i, -0.0028782680177442885 + -0.06787312543110027i, 0.10330880927984999 + -0.055714726597403244i, 0.026466210489148167 + 0.03180207468384971i }, { 0.07231002204222453 + -0.029308254925993663i, 0.06546230949261209 + -0.10571980387977092i, -0.12095925166740869 + -0.029769570690801064i, 0.016606091065560533 + 0.10149782366389493i } }), Matrix({ { -0.009968703211768959 + 0.0017752835909719124i, 0.07085981387373548 + -0.03596872026269729i, 0.05061262933635951 + 0.02629797701459599i, 0.0016477141013837484 + 0.013388972017639923i }, { 0.10435306317628583 + -0.05760792030694174i, -0.11039964004595643 + 0.07348958862520295i, 0.18056673627362324 + 0.0340698902373059i, -0.19462386633653475 + 0.00928202536192041i }, { 0.12170621357508889 + 0.04125377547753457i, -0.052875948100783214 + 0.11129887679669462i, 0.03660010932013261 + -0.06203533695469084i, -0.01726259386210054 + -0.02774398418531053i }, { -0.059326668239008215 + -0.046365600904007015i, 0.010552842818833218 + -0.05033761542274994i, 0.09005076994324575 + 0.10638214521799928i, 0.02033671054705017 + -0.10467771273305775i } }), Matrix({ { -0.04426748387781347 + -0.0865001404201009i, 0.14053286894057299 + -0.04518964184998764i, -0.07669836830554524 + 0.008905895890327017i, 0.10705701138460713 + 0.10237113496187578i }, { -0.023914307816937985 + 0.16980960823842794i, -0.07698590886604842 + 0.02926304469377524i, 0.11100085318636566 + 0.057196673074642074i, 0.01999531831121174 + 0.0071500896280817456i }, { 0.14192384190614898 + 0.17025107542671758i, -0.055079468245513456 + -0.028115093249769192i, 0.08025962881209023 + 0.06070463125570525i, 0.06279943814931026 + 0.05314478882811497i }, { -0.07676100408962222 + -0.06539586268229479i, -0.06850850897002647 + 0.033937040742437585i, 0.16008796111172321 + 0.012003139240762841i, 0.11325929370594277 + 0.08159318231893589i } }), Matrix({ { 0.002812383598226338 + -0.05335542027295279i, -0.11324074910175157 + -0.08201108420487051i, -0.003583318949389412 + 0.09964796099622984i, -0.08367989797822901 + 0.04578696062604153i }, { -0.13130204414524646 + -0.121593675300156i, -0.07446757325990201 + -0.13439079846543409i, 0.04701398328255861 + -0.2787485782739569i, -0.04358688439273587 + -0.01969235857592169i }, { -0.07009146440745062 + 0.1529841379380626i, 0.00568158512577634 + -0.16070368324056555i, -0.08100105067326496 + -0.13188037738916633i, 0.017901242276781457 + 0.029804864645884555i }, { 0.07654156125313438 + -0.012056156776987237i, 0.003621709724181974 + -0.05846268835183188i, 0.11117664987407382 + -0.09147640745776785i, -0.12996607649698022 + -0.015510981564619402i } }), Matrix({ { -0.14805840430433925 + -0.07524839154602771i, 0.025545818742008508 + -0.03229264383040836i, -0.07973577103460276 + 0.20523857882706303i, 0.08214975515910711 + -0.03131540368989884i }, { -0.008947103685949899 + -0.047235673230914266i, 0.0310908149701618 + -0.05501080916959373i, 0.05058835114208807 + -0.008263520026130983i, 0.07379061412054612 + -0.004008974944196062i }, { -0.018943325275005477 + -0.09879496578036481i, -0.017609633741270416 + -0.009114391856114599i, -0.12520728722679605 + -0.08301706925346934i, 0.09509345886994905 + 0.05733993808889286i }, { 0.22083249116995274 + 0.01325497713082139i, -0.038590860691743264 + -0.1090847786058839i, -0.03269144149202707 + 0.12572320081373975i, 0.0589306391138131 + -0.09879205245585426i } }), Matrix({ { -0.07940263949329576 + 0.02616523246383209i, 0.044363070411529364 + -0.0032135078118113625i, 0.03498218819559566 + 0.08342762658761012i, -0.005362438330089522 + -0.13960593999869542i }, { 0.017125339985102277 + 0.055948614064930846i, -0.019036428503538084 + -0.0411851086158313i, -0.15938128550712835 + -0.030407028283550762i, -0.030376110486096466 + 0.09442223326007784i }, { -0.08069850472552233 + -0.2680840095212353i, 0.10635287786860759 + -0.05616480471971003i, 0.007805296855806456 + -0.11909955009859371i, 0.10534947826442627 + 0.03838107812630963i }, { 0.09434278792648486 + -0.09444784825000824i, -0.005022793535762327 + 0.04858354526877395i, -0.25285870546158595 + 0.0016625675911720666i, -0.07390341588880843 + -0.02688038344188594i } }), Matrix({ { -0.006365766066449382 + 0.012453256374758496i, 0.0978200250464221 + 0.14845506278070994i, -0.03247868717265353 + -0.011314655950396605i, 0.1345665617424687 + -0.023729033441661978i }, { -0.07754840152728713 + -0.11170926944938897i, -0.08535374400458978 + 0.09261012920278186i, -0.030211416675447068 + -0.016661898973686928i, -0.013838686760166733 + -0.024577242392767453i }, { 0.0828425474943674 + 0.03858269426415073i, -0.01964422009387732 + -0.15615025175786756i, 0.03038601959370629 + 0.08587036964004188i, 0.10938006424519789 + 0.059399501837157836i }, { 0.10145680002893334 + -0.04668802216327009i, 0.0013688078529575023 + -0.028322353793162915i, -0.024511418282089876 + 0.09160449403858388i, 0.09394294096264917 + 0.027582517665235205i } }), Matrix({ { -0.030706517965459104 + -0.1292873773031402i, -0.15134001961015595 + 0.17602706590238587i, -0.17238802292621624 + -0.017549610012167684i, 0.06587409184318757 + 0.1044755149243469i }, { 0.11535413164062731 + -8.070965312201132e-05i, 0.005094175102993484 + 0.05344837310987358i, 0.13250912185339617 + -0.18013474575266128i, 0.23592054230575557 + 0.05303885466047657i }, { 0.05131907182529709 + 0.024477396097570072i, -0.006542902083433018 + -0.20717433467551288i, -0.06543420595807274 + 0.036988745716933884i, 0.16074946161288656 + 0.19533810853848763i }, { -0.10077840972509287 + 0.20645346936142098i, 0.05363816500312215 + 0.09765165291282349i, -0.056840250566681606 + -0.03349292786859148i, -0.06389816128370246 + 0.06799370138739248i } }), Matrix({ { -0.006859501082783597 + -0.07346703545425376i, 0.029532341523639042 + -0.11449509391256138i, -0.021102411958132263 + -0.01908197007833602i, -0.028812302389746698 + 0.14942367856262873i }, { 0.12353866556414608 + -0.04638099174553684i, 0.03081238519832093 + -0.0890148993531579i, 0.06512556478347382 + 0.024987894015071163i, 0.1425911504519794 + 0.15496102369318007i }, { -0.07311440496251632 + 0.07315431979667071i, 0.012485408414628722 + 0.07095305303187957i, -0.08144159077029597 + -0.045092527333484095i, -0.051568990145499406 + -0.14632786956244692i }, { -0.21234734335938124 + 0.023080777366977626i, 0.05627934348391179 + 0.04481534885555081i, 0.1617540924297825 + 0.006743535733389491i, 0.10568264003469581 + 0.031725196023569345i } }), Matrix({ { -0.08137877584087327 + 0.022659149301150386i, 0.2236238040182286 + 0.058334571402075784i, -0.04263810418939577 + 0.030192266960456644i, -0.05429944781844738 + 0.07380965966505894i }, { 0.013991643538759452 + 0.08577015249527173i, 0.11738318474177825 + -0.06453982691677523i, -0.031199987977807663 + 0.04927546515819379i, -0.01261280141090818 + 0.05734865979490452i }, { -0.09380748941072845 + -0.10578236912554881i, 0.018523039788712385 + 0.025468557883956102i, -0.0864412216615466 + -0.06209168846898205i, 0.020517807375654742 + 0.04238077128018827i }, { 0.005173098473898985 + -0.020393122824394202i, 0.06767549697533701 + 0.023325602253566745i, -0.04780565460088443 + 0.13380169998401445i, 0.16769590131229165 + 0.02927676088321873i } }), Matrix({ { 0.10179982696031803 + 0.11212041469475739i, -0.1231743397396691 + 0.2139052811788437i, 0.031372487786190215 + 0.039025914887471154i, -0.03393279390371167 + 0.11750176868745107i }, { -0.04111993879246084 + 0.2305546771847467i, -0.0014179459447978102 + -0.008996844232307158i, 0.007400043915809292 + -0.03780777666581653i, 0.10438000201960831 + 0.054948094626975176i }, { 0.10210609224592376 + 0.004438283179001857i, 0.14237792878395517 + 0.03198491750151551i, -0.0643217074058095 + 0.06017287709695475i, 0.028543104984906333 + 0.0630008703853299i }, { -0.09475363768943397 + 0.1533018572707412i, -0.18442038908724684 + 0.053024484033940424i, 0.10760769424996611 + -0.05456626945058169i, 0.21749780065281912 + 0.02754723193901532i } }), Matrix({ { 0.0329928352972396 + -0.04263147779907726i, -0.07853215323053536 + -0.23992702969236737i, -0.11839796222753236 + 0.09504307491560383i, -0.0958089244963228 + -0.112089845964563i }, { -0.01772938856460378 + 0.062118488435123916i, -0.052760274504444094 + -0.02456464701629266i, 0.03921848073032253 + -0.01793457882584579i, 0.20063833078880805 + -0.1278746984482589i }, { 0.11522291044521102 + 0.030409675925316397i, 0.05974755735355414 + -0.16588273365074369i, -0.02783971758606842 + -0.08782917280286i, 0.032079991043676495 + 0.02600585299445006i }, { -0.07456781644773235 + 0.16106505784257802i, 0.12171506957516556 + -0.12188216282205545i, 0.0420149629998158 + -0.022683585180769645i, 0.0485626288316521 + -0.12596652612652767i } }), Matrix({ { 0.13805636890545311 + -0.035108654549711515i, 0.0716932553782145 + 0.061385301983352784i, 0.15677143684877531 + -0.07290819180693273i, 0.030559815113852484 + 0.06540876725973588i }, { 0.05628457032189406 + -0.17280394211792072i, 0.019764229936578098 + -0.02070397955450405i, -0.06209836903663491 + 0.05151435255374208i, 0.10286921589241493 + -0.02894917066098465i }, { -0.01476492176647438 + -0.06007792515209969i, 0.021544806297434722 + 0.15495202749711018i, 0.13886675594605047 + 0.07308979375496623i, 0.06941946392843497 + -0.03929014859416117i }, { -0.02922540743357338 + -0.061257376061678435i, 0.015669056024406318 + -0.10340844441267522i, 0.09947837675304932 + -0.10300000399316747i, 0.012671712272873165 + 0.019061513487588232i } }), Matrix({ { -0.051498380606893254 + 0.03234607103452691i, 0.09777589316450898 + -0.06876510092273332i, 0.04743704495185132 + 0.07726590613591264i, -0.18198960008931125 + 0.02663810629529787i }, { -0.11961245585952189 + 0.016526721248229927i, -0.11423031342907394 + 0.05871044215621815i, -0.033262192953018285 + -0.19784476701811288i, -0.02866446335811664 + 0.07744415134555288i }, { 0.0623329182695829 + -0.03477247093457398i, -0.10812496335922513 + 0.14723513469621521i, -0.0007928482070758166 + 0.1330411593149353i, 0.09010949481788624 + 0.0028996840844555966i }, { -0.035717967861815136 + 0.034016853420597744i, -0.062443941546306544 + 0.015529092944023196i, 0.022495701127195185 + -0.12983466766479573i, -0.04518530636698776 + 0.02742148742519045i } }), Matrix({ { -0.01139249627852288 + 0.0026510850682365094i, -0.024913731808612134 + 0.05120481055922125i, -0.01012611045610597 + 0.10541772343027572i, -0.06661422471987936 + -0.06821419652504099i }, { 0.021004161278995286 + 0.10133081786230361i, -0.04953144394930648 + -0.06433873324745609i, 0.11581123696437123 + -0.03805953167186898i, 0.08682011818109359 + 0.1875869280930154i }, { 0.08831363448853191 + -0.10435830274289402i, 0.2673660108159836 + 0.06063962201667507i, -0.02529794063850231 + 0.019884509358997153i, -0.04848267453523868 + -0.04651937146070697i }, { 0.003865836494618056 + 0.09136418735990863i, 0.04946332879413422 + 0.0098759826290919i, 0.09547913558356293 + 0.07954515922998648i, 0.0340412686461964 + -0.147146460442124i } }), Matrix({ { 0.01159761928697365 + -0.05658972362259871i, 0.03588836430375091 + 0.03375306999456789i, 0.05052557217184228 + 0.029770940375988278i, -0.041460604649916084 + 0.11556905762671886i }, { -0.03351628021926304 + 0.029478905943325903i, -0.08517540757027092 + 0.07633020087528716i, 0.04924721878837971 + 0.044809964508283666i, -0.015386872800435679 + 0.2002377994985358i }, { 0.12975774423318484 + 0.09232438889018671i, 0.0033957066988011602 + -0.01042867572250035i, -0.11363003847716033 + 0.07969655980494861i, 0.05687696744211758 + -0.013565654607587843i }, { 0.10754663488261958 + 0.027608531246490525i, 0.01545513485140113 + -0.06665795755530177i, -0.008533678205329322 + -0.02172544545569177i, -0.04737256779350949 + -0.13986339383599172i } }) }, { QubitIndex{ 5 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.40527959862203944 + 0.36450373351690224i, -0.046389007478885975 + 0.2105638314690556i }, { 0.3576250233044643 + -0.06822724869463176i, -0.18899042453373255 + 0.5191293883470108i } }), Matrix({ { 0.09134486082960337 + 0.13324202497998372i, 0.09196156502066187 + -0.5607261789614835i }, { 0.2847715436276368 + 0.3161068386431896i, 0.09361144805576002 + 0.02546548116488393i } }), Matrix({ { 0.4529554037206341 + 0.0032301539217051978i, 0.09272550362743211 + 0.03469562471279832i }, { 0.006402590704274955 + 0.006502871611091839i, 0.10044933877488842 + 0.13064516739376028i } }), Matrix({ { -0.16319120741131843 + -0.0967600990733279i, -0.21907652274319714 + 0.15163340841731066i }, { -0.16358741411965022 + 0.30854842885492034i, 0.3858040830524919 + 0.24335944734704446i } }) }, { QubitIndex{ 4 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 10_10_2_100_0_50) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false, false}), Matrix({ { 0.7248674952360022 + 1.3552527156068805e-20i, 1.734723475976807e-18 + -1.3010426069826053e-18i }, { 8.673617379884035e-19 + 1.734723475976807e-18i, 0.2751325047639976 + -3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.7248674952360022, 1.0e-7), DoubleNear(0.2751325047639976, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false, false}), Matrix({ { 0.4204922323425141 + -3.3881317890172014e-21i, -0.045888700914128534 + -0.05958028711108234i }, { -0.045888700914128534 + 0.05958028711108234i, 0.5795077676574858 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4204922323425141, 1.0e-7), DoubleNear(0.5795077676574858, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false, false}), Matrix({ { 0.4853754211032793 + 6.776263578034403e-21i, -0.01648112470226365 + 0.025272380320171636i }, { -0.01648112470226365 + -0.025272380320171636i, 0.5146245788967205 + 3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4853754211032793, 1.0e-7), DoubleNear(0.5146245788967205, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false, false}), Matrix({ { 0.5118457098114706 + 2.0328790734103208e-20i, 0.09645308113475762 + 0.06628788410768127i }, { 0.09645308113475762 + -0.06628788410768127i, 0.4881542901885293 + -1.0164395367051604e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5118457098114706, 1.0e-7), DoubleNear(0.4881542901885293, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false, false}), Matrix({ { 0.4914065523885992 + 1.8634724839594607e-20i, 0.14969362298733874 + 0.15802414018241417i }, { 0.14969362298733874 + -0.15802414018241417i, 0.5085934476114006 + -8.470329472543003e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4914065523885992, 1.0e-7), DoubleNear(0.5085934476114006, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false, false}), Matrix({ { 0.4372225858280545 + 1.0164395367051604e-20i, 0.05860608488459336 + -0.11349504169688346i }, { 0.05860608488459336 + 0.11349504169688346i, 0.5627774141719453 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4372225858280545, 1.0e-7), DoubleNear(0.5627774141719453, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false, false}), Matrix({ { 0.9999999999999998 + 1.0164395367051604e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false, false}), Matrix({ { 0.4617329488754159 + -1.0164395367051604e-20i, -0.02066046319264145 + 0.04548153121824552i }, { -0.02066046319264145 + -0.04548153121824552i, 0.538267051124584 + 2.0328790734103208e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4617329488754159, 1.0e-7), DoubleNear(0.538267051124584, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true, false}), Matrix({ { 0.9999999999999998 + 1.0164395367051604e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, false, true}), Matrix({ { 0.4913318277031304 + 6.776263578034403e-21i, -0.11761073881415093 + -0.08498254748412953i }, { -0.11761073881415095 + 0.08498254748412953i, 0.5086681722968694 + 3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.4913318277031304, 1.0e-7), DoubleNear(0.5086681722968694, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false, false}), Matrix({ { 0.30421394351844067 + 0.0i, -0.003601894839580008 + 0.0023811095408355003i, -0.0343682949578691 + -0.04257168077218596i, -0.0017212779706129355 + 0.00487537589410895i }, { -0.0036018948395800084 + -0.0023811095408355007i, 0.11627828882407339 + -3.3881317890172014e-21i, -0.0020685448808073336 + -0.003593482933863844i, -0.011520405956259444 + -0.01700860633889638i }, { -0.0343682949578691 + 0.04257168077218596i, -0.0020685448808073336 + 0.003593482933863844i, 0.4206535517175616 + 1.3552527156068805e-20i, 0.0036018948395800093 + -0.002381109540835502i }, { -0.0017212779706129357 + -0.00487537589410895i, -0.011520405956259444 + 0.01700860633889638i, 0.0036018948395800093 + 0.002381109540835502i, 0.1588542159399242 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.30421394351844067, 1.0e-7), DoubleNear(0.11627828882407339, 1.0e-7), DoubleNear(0.4206535517175616, 1.0e-7), DoubleNear(0.1588542159399242, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false, false}), Matrix({ { 0.351832865744254 + 6.776263578034403e-21i, 6.505213034913027e-19 + -8.944667923005412e-19i, -0.011946631581602057 + 0.018319127021334453i, -4.0657581468206416e-20 + 1.4907779871675686e-19i }, { 4.336808689942018e-19 + 1.111307226797642e-18i, 0.13354255535902537 + 0.0i, -5.421010862427522e-20 + -6.776263578034403e-21i, -0.004534493120661591 + 0.006953253298837183i }, { -0.011946631581602057 + -0.018319127021334453i, 0.0 + 1.0164395367051604e-19i, 0.37303462949174826 + 6.776263578034403e-21i, 6.505213034913027e-19 + -5.692061405548898e-19i }, { 5.421010862427522e-20 + -6.776263578034403e-20i, -0.004534493120661591 + -0.006953253298837183i, 4.336808689942018e-19 + 7.047314121155779e-19i, 0.14158994940497222 + -3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.351832865744254, 1.0e-7), DoubleNear(0.13354255535902537, 1.0e-7), DoubleNear(0.37303462949174826, 1.0e-7), DoubleNear(0.14158994940497222, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false, false}), Matrix({ { 0.3828699395239349 + 2.0328790734103208e-20i, -0.0017467669197015045 + -0.01402978631120871i, 0.03998127494035153 + 0.06103252251170843i, -0.007269337871256337 + 0.025007599963845942i }, { -0.001746766919701505 + 0.01402978631120871i, 0.12897577028753565 + 0.0i, 0.01867795355596304 + -0.024975297938913472i, 0.05647180619440609 + 0.005255361595972857i }, { 0.03998127494035153 + -0.06103252251170843i, 0.01867795355596304 + 0.024975297938913472i, 0.34199755571206736 + -6.776263578034403e-21i, 0.0017467669197015062 + 0.014029786311208707i }, { -0.007269337871256337 + -0.025007599963845942i, 0.05647180619440609 + -0.005255361595972857i, 0.0017467669197015062 + -0.014029786311208707i, 0.14615673447646194 + -3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3828699395239349, 1.0e-7), DoubleNear(0.12897577028753565, 1.0e-7), DoubleNear(0.34199755571206736, 1.0e-7), DoubleNear(0.14615673447646194, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false, false}), Matrix({ { 0.3562046367724833 + 2.710505431213761e-20i, 7.589415207398531e-19 + -7.047314121155779e-19i, 0.10850804154763467 + 0.11454656268084948i, 5.421010862427522e-19 + -1.0842021724855044e-19i }, { 4.336808689942018e-19 + 1.3010426069826053e-18i, 0.13520191561611591 + -8.470329472543003e-21i, -2.168404344971009e-19 + 4.336808689942018e-19i, 0.041185581439704036 + 0.043477577501564696i }, { 0.10850804154763467 + -0.11454656268084948i, -5.421010862427522e-20 + -3.5236570605778894e-19i, 0.368662858463519 + -1.3552527156068805e-20i, 7.589415207398531e-19 + -5.963111948670274e-19i }, { 4.336808689942018e-19 + -1.0842021724855044e-19i, 0.04118558143970403 + -0.043477577501564696i, 7.589415207398531e-19 + 4.336808689942018e-19i, 0.13993058914788165 + 5.082197683525802e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3562046367724833, 1.0e-7), DoubleNear(0.13520191561611591, 1.0e-7), DoubleNear(0.368662858463519, 1.0e-7), DoubleNear(0.13993058914788165, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false, false}), Matrix({ { 0.3171800340214665 + 1.3552527156068805e-20i, -0.006338954734982574 + -0.001806299875791425i, 0.04394747443321864 + -0.08248769059484007i, -0.003517851571853035 + 0.0018145423658161718i }, { -0.006338954734982575 + 0.0018062998757914254i, 0.12004255180658802 + -3.3881317890172014e-21i, 0.007938245014488171 + 0.01482314059046023i, 0.014658610451374721 + -0.031007351102043404i }, { 0.04394747443321864 + 0.08248769059484005i, 0.007938245014488171 + -0.01482314059046023i, 0.4076874612145358 + 0.0i, 0.006338954734982576 + 0.0018062998757914237i }, { -0.0035178515718530356 + -0.0018145423658161718i, 0.01465861045137472 + 0.031007351102043407i, 0.006338954734982576 + -0.001806299875791424i, 0.15508995295740957 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3171800340214665, 1.0e-7), DoubleNear(0.12004255180658802, 1.0e-7), DoubleNear(0.4076874612145358, 1.0e-7), DoubleNear(0.15508995295740957, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false, false}), Matrix({ { 0.7248674952360022 + 1.3552527156068805e-20i, 1.734723475976807e-18 + -1.3010426069826053e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 8.673617379884035e-19 + 1.734723475976807e-18i, 0.2751325047639976 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.7248674952360022, 1.0e-7), DoubleNear(0.2751325047639976, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false, false}), Matrix({ { 0.33469520611925585 + -6.776263578034403e-21i, 8.673617379884035e-19 + -2.168404344971009e-19i, -0.014976098204865628 + 0.032968083613667674i, 6.776263578034403e-21 + 6.776263578034403e-20i }, { 4.336808689942018e-19 + 2.168404344971009e-19i, 0.12703774275616003 + -3.3881317890172014e-21i, -2.642742795433417e-19 + 1.0842021724855044e-19i, -0.00568436498777582 + 0.012513447604577843i }, { -0.014976098204865628 + -0.03296808361366767i, -2.1006417091906648e-19 + -5.421010862427522e-20i, 0.3901722891167464 + 2.0328790734103208e-20i, 8.673617379884035e-19 + -1.0842021724855044e-18i }, { 4.0657581468206416e-20 + -5.421010862427522e-20i, -0.00568436498777582 + -0.012513447604577843i, 4.336808689942018e-19 + 1.5178830414797062e-18i, 0.14809476200783755 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.33469520611925585, 1.0e-7), DoubleNear(0.12703774275616003, 1.0e-7), DoubleNear(0.3901722891167464, 1.0e-7), DoubleNear(0.14809476200783755, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true, false}), Matrix({ { 0.7248674952360022 + 1.3552527156068805e-20i, 1.734723475976807e-18 + -1.3010426069826053e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 8.673617379884035e-19 + 1.734723475976807e-18i, 0.2751325047639976 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.7248674952360022, 1.0e-7), DoubleNear(0.2751325047639976, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false, true}), Matrix({ { 0.3561504712768952 + 6.776263578034403e-21i, 6.505213034913027e-19 + -6.505213034913027e-19i, -0.08525220165706927 + -0.0616010863335956i, -1.0842021724855044e-19 + -1.0842021724855044e-19i }, { 2.168404344971009e-19 + 8.131516293641283e-19i, 0.1351813564262352 + 0.0i, -2.710505431213761e-19 + -1.0842021724855044e-19i, -0.03235853715708166 + -0.023381461150533925i }, { -0.08525220165706927 + 0.0616010863335956i, -1.0842021724855044e-19 + 1.0842021724855044e-19i, 0.36871702395910705 + 6.776263578034403e-21i, 1.0842021724855044e-18 + -6.505213034913027e-19i }, { -2.168404344971009e-19 + -5.421010862427522e-20i, -0.03235853715708166 + 0.02338146115053392i, 6.505213034913027e-19 + 9.215718466126788e-19i, 0.1399511483377624 + -3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.3561504712768952, 1.0e-7), DoubleNear(0.1351813564262352, 1.0e-7), DoubleNear(0.36871702395910705, 1.0e-7), DoubleNear(0.1399511483377624, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false, false}), Matrix({ { 0.20409659434390576 + 6.776263578034403e-21i, -0.022273247530077582 + -0.028918806945995884i, -0.0069301849175701985 + 0.010626839617437992i, 0.0022620330776469263 + -0.00017776656022604426i }, { -0.022273247530077582 + 0.028918806945995884i, 0.28127882675937355 + 0.0i, -0.0007494382732656607 + -0.0021416668435748844i, -0.009550939784693452 + 0.01464554070273364i }, { -0.006930184917570197 + -0.010626839617437992i, -0.0007494382732656609 + 0.002141666843574884i, 0.21639563799860828 + -1.0164395367051604e-20i, -0.023615453384050956 + -0.030661480165086456i }, { 0.0022620330776469254 + 0.0001777665602260447i, -0.00955093978469345 + -0.01464554070273364i, -0.023615453384050956 + 0.030661480165086456i, 0.29822894089811225 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.20409659434390576, 1.0e-7), DoubleNear(0.28127882675937355, 1.0e-7), DoubleNear(0.21639563799860828, 1.0e-7), DoubleNear(0.29822894089811225, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false, false}), Matrix({ { 0.21978114578502372 + 6.776263578034403e-21i, -0.022391640569593918 + -0.02766043894747626i, 0.040880532338677715 + 0.02640520643164135i, 0.0016604929271525069 + -0.010038031524503742i }, { -0.022391640569593918 + 0.02766043894747626i, 0.29206456402644676 + 1.3552527156068805e-20i, -0.011900444758020524 + 0.0027927480338421603i, 0.055572548796079896 + 0.03988267767603993i }, { 0.040880532338677715 + -0.026405206431641348i, -0.011900444758020524 + -0.0027927480338421607i, 0.20071108655749034 + -1.0164395367051604e-20i, -0.02349706034453462 + -0.03191984816360608i }, { 0.0016604929271525062 + 0.010038031524503742i, 0.055572548796079896 + -0.03988267767603993i, -0.02349706034453462 + 0.03191984816360608i, 0.2874432036310389 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21978114578502372, 1.0e-7), DoubleNear(0.29206456402644676, 1.0e-7), DoubleNear(0.20071108655749034, 1.0e-7), DoubleNear(0.2874432036310389, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false, false}), Matrix({ { 0.2066326382016207 + -1.6940658945086007e-21i, -0.02255000830980347 + -0.029278143479579872i, 0.06294500569738475 + 0.06644792346930972i, 0.0025458777485318574 + -0.016170311542326885i }, { -0.02255000830980347 + 0.02927814347957987i, 0.2847739141869785 + 2.0328790734103208e-20i, -0.016284369536568463 + 0.001667266530240631i, 0.08674861728995396 + 0.09157621671310445i }, { 0.06294500569738476 + -0.06644792346930972i, -0.016284369536568463 + -0.001667266530240631i, 0.21385959414089337 + -1.6940658945086007e-21i, -0.02333869260432507 + -0.030302143631502472i }, { 0.0025458777485318574 + 0.016170311542326885i, 0.08674861728995396 + -0.09157621671310445i, -0.02333869260432507 + 0.030302143631502472i, 0.2947338534705073 + -6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2066326382016207, 1.0e-7), DoubleNear(0.2847739141869785, 1.0e-7), DoubleNear(0.21385959414089337, 1.0e-7), DoubleNear(0.2947338534705073, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false, false}), Matrix({ { 0.1621427111270049 + -3.3881317890172014e-21i, -0.0282451402716759 + -0.010046389019536917i, -0.013511092011646804 + -0.05970242636974675i, -0.03541533452818818 + 0.00039996314372083567i }, { -0.0282451402716759 + 0.010046389019536917i, 0.27507987470104955 + 1.3552527156068805e-20i, -0.027367347961564193 + 0.06632456312114925i, 0.07211717689624017 + -0.053792615327136716i }, { -0.013511092011646804 + 0.059702426369746736i, -0.027367347961564193 + -0.06632456312114925i, 0.25834952121550914 + 0.0i, -0.017643560642452635 + -0.04953389809154543i }, { -0.03541533452818818 + -0.00039996314372083605i, 0.07211717689624017 + 0.05379261532713672i, -0.017643560642452635 + 0.04953389809154542i, 0.3044278929564362 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1621427111270049, 1.0e-7), DoubleNear(0.27507987470104955, 1.0e-7), DoubleNear(0.25834952121550914, 1.0e-7), DoubleNear(0.3044278929564362, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false, false}), Matrix({ { 0.4204922323425141 + -3.3881317890172014e-21i, -0.045888700914128534 + -0.05958028711108234i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.045888700914128534 + 0.05958028711108234i, 0.5795077676574858 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.4204922323425141, 1.0e-7), DoubleNear(0.5795077676574858, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false, false}), Matrix({ { 0.19415511841871558 + -1.0164395367051604e-20i, -0.021188325193142565 + -0.02751018166264399i, -0.00868756428910415 + 0.019124630592315804i, 0.0036578845044292077 + -0.0008561320543251424i }, { -0.021188325193142565 + 0.027510181662643986i, 0.2675778304567003 + 0.0i, -0.0017617208720402385 + -0.0033180447120561953i, -0.0119728989035373 + 0.026356900625929713i }, { -0.008687564289104149 + -0.019124630592315804i, -0.0017617208720402382 + 0.0033180447120561957i, 0.22633711392379846 + 6.776263578034403e-21i, -0.02470037572098597 + -0.03207010544843836i }, { 0.0036578845044292077 + 0.0008561320543251424i, -0.0119728989035373 + -0.026356900625929713i, -0.02470037572098597 + 0.03207010544843836i, 0.31192993720078543 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.19415511841871558, 1.0e-7), DoubleNear(0.2675778304567003, 1.0e-7), DoubleNear(0.22633711392379846, 1.0e-7), DoubleNear(0.31192993720078543, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true, false}), Matrix({ { 0.4204922323425141 + -3.3881317890172014e-21i, -0.045888700914128534 + -0.05958028711108234i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.045888700914128534 + 0.05958028711108234i, 0.5795077676574858 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4204922323425141, 1.0e-7), DoubleNear(0.5795077676574858, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false, true}), Matrix({ { 0.20660121705181683 + 6.776263578034403e-21i, -0.02254657929106109 + -0.029273691361365352i, -0.0494544021114147 + -0.03573450110175533i, 0.00033371943919663534 + 0.010907020290313577i }, { -0.02254657929106109 + 0.029273691361365352i, 0.28473061065131355 + 0.0i, 0.010460288596267887 + -0.003107542881473682i, -0.06815633670273624 + -0.0492480463823742i }, { -0.049454402111414705 + 0.03573450110175533i, 0.010460288596267887 + 0.0031075428814736827i, 0.21389101529069723 + -1.0164395367051604e-20i, -0.023342121623067445 + -0.03030659574971699i }, { 0.0003337194391966362 + -0.010907020290313577i, -0.06815633670273624 + 0.04924804638237419i, -0.023342121623067445 + 0.03030659574971699i, 0.29477715700617224 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.20660121705181683, 1.0e-7), DoubleNear(0.28473061065131355, 1.0e-7), DoubleNear(0.21389101529069723, 1.0e-7), DoubleNear(0.29477715700617224, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false, false}), Matrix({ { 0.24843732693964943 + 6.776263578034403e-21i, -0.0084357929717215 + 0.012935559443603691i, 0.04681595487249175 + 0.032174509662811185i, -0.003264907875888277 + 0.001345100065262071i }, { -0.008435792971721496 + -0.012935559443603691i, 0.26340838287182106 + 1.3552527156068805e-20i, 8.559735968928918e-05 + -0.003530097833717863i, 0.049637126262265865 + 0.0341133744448701i }, { 0.04681595487249175 + -0.032174509662811185i, 8.559735968928874e-05 + 0.0035300978337178632i, 0.23693809416362985 + 0.0i, -0.008045331730542147 + 0.012336820876567943i }, { -0.003264907875888276 + -0.0013451000652620715i, 0.049637126262265865 + -0.0341133744448701i, -0.008045331730542147 + -0.012336820876567943i, 0.2512161960248994 + -1.0164395367051604e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24843732693964943, 1.0e-7), DoubleNear(0.26340838287182106, 1.0e-7), DoubleNear(0.23693809416362985, 1.0e-7), DoubleNear(0.2512161960248994, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false, false}), Matrix({ { 0.23851666229852708 + 5.082197683525802e-21i, -0.008098932669425957 + 0.012419013283789028i, 0.07265760529395507 + 0.07670103358552294i, -0.006460765438046058 + 0.0011786986113260507i }, { -0.008098932669425957 + -0.012419013283789028i, 0.2528898900900721 + 1.3552527156068805e-20i, 0.0015265269028701192 + -0.006387529731954772i, 0.07703601769338364 + 0.08132310659689124i }, { 0.07265760529395507 + -0.07670103358552294i, 0.001526526902870117 + 0.006387529731954772i, 0.24685875880475225 + 1.6940658945086007e-21i, -0.008382192032837691 + 0.012853367036382606i }, { -0.006460765438046058 + -0.0011786986113260516i, 0.07703601769338364 + -0.08132310659689124i, -0.008382192032837691 + -0.012853367036382606i, 0.26173468880664835 + -1.0164395367051604e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.23851666229852708, 1.0e-7), DoubleNear(0.2528898900900721, 1.0e-7), DoubleNear(0.24685875880475225, 1.0e-7), DoubleNear(0.26173468880664835, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false, false}), Matrix({ { 0.21221709671215666 + 6.776263578034403e-21i, -0.0072059199596783375 + 0.01104965547361548i, 0.028445953130074045 + -0.055087703656759066i, 0.001902395664922945 + 0.0033516412015746552i }, { -0.007205919959678336 + -0.011049655473615479i, 0.2250054891158978 + 3.3881317890172014e-21i, -0.0038341840515118087 + 0.0003894106690152427i, 0.030160131754519322 + -0.05840733804012439i }, { 0.02844595313007404 + 0.055087703656759066i, -0.003834184051511809 + -0.00038941066901524357i, 0.27315832439112264 + 0.0i, -0.009275204742585313 + 0.014222724846556154i }, { 0.0019023956649229453 + -0.0033516412015746544i, 0.030160131754519322 + 0.05840733804012439i, -0.009275204742585311 + -0.014222724846556154i, 0.2896190897808226 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21221709671215666, 1.0e-7), DoubleNear(0.2250054891158978, 1.0e-7), DoubleNear(0.27315832439112264, 1.0e-7), DoubleNear(0.2896190897808226, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false, false}), Matrix({ { 0.4853754211032793 + 6.776263578034403e-21i, -0.01648112470226365 + 0.025272380320171636i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01648112470226365 + -0.025272380320171636i, 0.5146245788967205 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.4853754211032793, 1.0e-7), DoubleNear(0.5146245788967205, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false, false}), Matrix({ { 0.22251634186205882 + 0.0i, 0.037833001094008306 + 0.007449968756672508i, -0.0353955083491746 + 0.051821594530891926i, 0.004755157528895782 + -0.07372485076322333i }, { 0.037833001094008306 + -0.007449968756672508i, 0.23921660701335706 + -1.0164395367051604e-20i, 0.027851386217792005 + 0.002804615858920287i, 0.014735045156533151 + -0.006340063312646409i }, { -0.0353955083491746 + -0.051821594530891926i, 0.027851386217792005 + -0.002804615858920287i, 0.2628590792412205 + 6.776263578034403e-21i, -0.054314125796271956 + 0.017822411563499126i }, { 0.004755157528895781 + 0.07372485076322333i, 0.014735045156533151 + 0.006340063312646409i, -0.054314125796271956 + -0.017822411563499126i, 0.2754079718833634 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.22251634186205882, 1.0e-7), DoubleNear(0.23921660701335706, 1.0e-7), DoubleNear(0.2628590792412205, 1.0e-7), DoubleNear(0.2754079718833634, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true, false}), Matrix({ { 0.4853754211032793 + 6.776263578034403e-21i, -0.01648112470226365 + 0.025272380320171636i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01648112470226365 + -0.025272380320171636i, 0.5146245788967205 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4853754211032793, 1.0e-7), DoubleNear(0.5146245788967205, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false, true}), Matrix({ { 0.24849464774088986 + 6.776263578034403e-21i, -0.011602960228482218 + 0.008317021399398897i, -0.062315332107300433 + -0.037415471220752616i, 0.008215716301093365 + -0.00011163221745969301i }, { -0.011602960228482218 + -0.008317021399398897i, 0.24283717996224052 + 0.0i, -6.0473081929664566e-05 + 0.0011853614836927562i, -0.05529540670685049 + -0.04756707626337692i }, { -0.062315332107300433 + 0.037415471220752616i, -6.0473081929664566e-05 + -0.0011853614836927562i, 0.23688077336238944 + 0.0i, -0.0048781644737814316 + 0.01695535892077274i }, { 0.008215716301093365 + 0.00011163221745969041i, -0.05529540670685049 + 0.04756707626337691i, -0.0048781644737814316 + -0.01695535892077274i, 0.27178739893447995 + 3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.24849464774088986, 1.0e-7), DoubleNear(0.24283717996224052, 1.0e-7), DoubleNear(0.23688077336238944, 1.0e-7), DoubleNear(0.27178739893447995, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false, false}), Matrix({ { 0.2515243356133502 + 3.218725199566341e-20i, 0.04739767606768908 + 0.03257430059449068i, 0.07662003871220506 + 0.0808839781990151i, 0.003963325272725748 + 0.025164788746508356i }, { 0.04739767606768908 + -0.03257430059449068i, 0.239882216775249 + -1.3552527156068805e-20i, 0.024913497053981454 + 0.005319041682021062i, 0.07307358427513366 + 0.07714016198339904i }, { 0.07662003871220506 + -0.0808839781990151i, 0.024913497053981454 + -0.005319041682021063i, 0.26032137419812035 + -1.1858461261560205e-20i, 0.04905540506706853 + 0.033713583513190606i }, { 0.003963325272725748 + -0.025164788746508356i, 0.07307358427513366 + -0.07714016198339904i, 0.04905540506706853 + -0.033713583513190606i, 0.24827207341328028 + 3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2515243356133502, 1.0e-7), DoubleNear(0.239882216775249, 1.0e-7), DoubleNear(0.26032137419812035, 1.0e-7), DoubleNear(0.24827207341328028, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false, false}), Matrix({ { 0.2323661989724558 + 2.0328790734103208e-20i, 0.0447709888605934 + 0.02771195510040845i, 0.02783593331430175 + -0.06426692536602403i, 0.018196156073246757 + -0.010512696156591977i }, { 0.0447709888605934 + -0.02771195510040845i, 0.20485638685559868 + -1.0164395367051604e-20i, -0.003916140442519339 + -0.022026845689485562i, 0.03077015157029161 + -0.049228116330859426i }, { 0.02783593331430175 + 0.06426692536602405i, -0.003916140442519339 + 0.022026845689485562i, 0.2794795108390147 + 0.0i, 0.05168209227416422 + 0.03857592900727283i }, { 0.018196156073246757 + 0.010512696156591976i, 0.03077015157029161 + 0.049228116330859426i, 0.05168209227416422 + -0.03857592900727283i, 0.2832979033329306 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2323661989724558, 1.0e-7), DoubleNear(0.20485638685559868, 1.0e-7), DoubleNear(0.2794795108390147, 1.0e-7), DoubleNear(0.2832979033329306, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false, false}), Matrix({ { 0.5118457098114706 + 2.0328790734103208e-20i, 0.09645308113475762 + 0.06628788410768127i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09645308113475762 + -0.06628788410768127i, 0.4881542901885293 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5118457098114706, 1.0e-7), DoubleNear(0.4881542901885293, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false, false}), Matrix({ { 0.23633602896048073 + 0.0i, 0.044535565580471385 + 0.0306073002037515i, -0.010574969447871323 + 0.023279526629715434i, -0.0050076398030364675 + 0.0030172954310016147i }, { 0.044535565580471385 + -0.0306073002037515i, 0.22539691991493516 + -1.0164395367051604e-20i, 0.0010221091378334285 + 0.005756372210451279i, -0.010085493744770125 + 0.02220200458853008i }, { -0.010574969447871325 + -0.023279526629715434i, 0.0010221091378334285 + -0.005756372210451279i, 0.2755096808509898 + 2.0328790734103208e-20i, 0.05191751555428623 + 0.03568058390392978i }, { -0.0050076398030364675 + -0.0030172954310016147i, -0.010085493744770125 + -0.02220200458853008i, 0.051917515554286225 + -0.03568058390392978i, 0.26275737027359414 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.23633602896048073, 1.0e-7), DoubleNear(0.22539691991493516, 1.0e-7), DoubleNear(0.2755096808509898, 1.0e-7), DoubleNear(0.26275737027359414, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true, false}), Matrix({ { 0.5118457098114706 + 2.0328790734103208e-20i, 0.09645308113475762 + 0.06628788410768127i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09645308113475762 + -0.06628788410768127i, 0.4881542901885293 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5118457098114706, 1.0e-7), DoubleNear(0.4881542901885293, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false, true}), Matrix({ { 0.25148608810367595 + 6.776263578034403e-21i, 0.0473904686415388 + 0.03256934725320034i, -0.06019855208978056 + -0.04349795233860128i, -0.005710604874356588 + -0.01599299557185635i }, { 0.04739046864153879 + -0.03256934725320034i, 0.23984573959945443 + 0.0i, -0.01697723139196359 + -0.0004006615231939274i, -0.057412186724370366 + -0.04148459514552824i }, { -0.06019855208978056 + 0.04349795233860128i, -0.01697723139196359 + 0.00040066152319392635i, 0.2603596217077946 + 1.3552527156068805e-20i, 0.04906261249321882 + 0.03371853685448094i }, { -0.005710604874356588 + 0.01599299557185635i, -0.05741218672437037 + 0.04148459514552824i, 0.04906261249321882 + -0.03371853685448094i, 0.24830855058907486 + -1.0164395367051604e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.25148608810367595, 1.0e-7), DoubleNear(0.23984573959945443, 1.0e-7), DoubleNear(0.2603596217077946, 1.0e-7), DoubleNear(0.24830855058907486, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false, false}), Matrix({ { 0.2148540435281927 + 1.1858461261560205e-20i, 0.06544943292449415 + 0.0690917231938101i, 0.028799414122131627 + -0.05577220715346582i, 0.026707913554595546 + -0.007728307809360116i }, { 0.06544943292449415 + -0.0690917231938101i, 0.22236854229986178 + -1.6940658945086007e-21i, -0.009161999203638967 + -0.02625066015605101i, 0.02980667076246174 + -0.05772283454341763i }, { 0.028799414122131627 + 0.05577220715346583i, -0.009161999203638964 + 0.026250660156051007i, 0.2765525088604065 + 6.776263578034403e-21i, 0.08424419006284457 + 0.08893241698860405i }, { 0.026707913554595546 + 0.007728307809360116i, 0.02980667076246174 + 0.05772283454341763i, 0.08424419006284457 + -0.08893241698860405i, 0.2862249053115389 + -6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2148540435281927, 1.0e-7), DoubleNear(0.22236854229986178, 1.0e-7), DoubleNear(0.2765525088604065, 1.0e-7), DoubleNear(0.2862249053115389, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false, false}), Matrix({ { 0.4914065523885992 + 1.8634724839594607e-20i, 0.14969362298733874 + 0.15802414018241417i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.14969362298733874 + -0.15802414018241417i, 0.5085934476114006 + -8.470329472543003e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.4914065523885992, 1.0e-7), DoubleNear(0.5085934476114006, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false, false}), Matrix({ { 0.22689859653108949 + -8.470329472543003e-21i, 0.06911847796978866 + 0.0729649522399282i, -0.010152686988247488 + 0.02234992245331248i, -0.010279919452845935 + 0.0035434432552833408i }, { 0.06911847796978866 + -0.0729649522399282i, 0.23483435234432637 + -1.6940658945086007e-21i, 0.0040944402770398194 + 0.010073147118858502i, -0.010507776204393962 + 0.02313160876493304i }, { -0.010152686988247488 + -0.02234992245331248i, 0.0040944402770398194 + -0.010073147118858504i, 0.26450795585750975 + 2.710505431213761e-20i, 0.08057514501755006 + 0.08505918794248596i }, { -0.010279919452845936 + -0.0035434432552833403i, -0.010507776204393962 + -0.02313160876493304i, 0.08057514501755006 + -0.08505918794248596i, 0.2737590952670742 + -6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.22689859653108949, 1.0e-7), DoubleNear(0.23483435234432637, 1.0e-7), DoubleNear(0.26450795585750975, 1.0e-7), DoubleNear(0.2737590952670742, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true, false}), Matrix({ { 0.4914065523885992 + 1.8634724839594607e-20i, 0.14969362298733874 + 0.15802414018241417i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.14969362298733874 + -0.15802414018241417i, 0.5085934476114006 + -8.470329472543003e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4914065523885992, 1.0e-7), DoubleNear(0.5085934476114006, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false, true}), Matrix({ { 0.2414436795303846 + 2.541098841762901e-20i, 0.07354924137787248 + 0.07764228961704125i, -0.05779468768453793 + -0.041760980672376526i, -0.0041762835986171205 + -0.031306681300917585i }, { 0.07354924137787248 + -0.07764228961704125i, 0.24988814817274582 + -1.8634724839594607e-20i, -0.031034871591998633 + 0.005863990453731791i, -0.059816051129613 + -0.043221566811753i }, { -0.05779468768453793 + 0.04176098067237652i, -0.03103487159199863 + -0.005863990453731793i, 0.2499628728582146 + -6.776263578034403e-21i, 0.07614438160946624 + 0.0803818505653729i }, { -0.004176283598617123 + 0.031306681300917585i, -0.059816051129613 + 0.043221566811753i, 0.07614438160946624 + -0.0803818505653729i, 0.2587052994386548 + 1.0164395367051604e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2414436795303846, 1.0e-7), DoubleNear(0.24988814817274582, 1.0e-7), DoubleNear(0.2499628728582146, 1.0e-7), DoubleNear(0.2587052994386548, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false, false}), Matrix({ { 0.4372225858280545 + 1.0164395367051604e-20i, 0.05860608488459336 + -0.11349504169688346i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.05860608488459336 + 0.11349504169688346i, 0.5627774141719453 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.4372225858280545, 1.0e-7), DoubleNear(0.5627774141719453, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false, false}), Matrix({ { 0.20188007386932225 + -1.0164395367051604e-20i, 0.027060360395806234 + -0.05240440028544029i, -0.009033221141492038 + 0.019885552686660694i, 0.003951099422429921 + 0.005010354610783548i }, { 0.027060360395806234 + 0.0524044002854403i, 0.25985287500609366 + 0.0i, -0.006372757141675845 + 0.00032063434773201276i, -0.01162724205114941 + 0.025595978531584823i }, { -0.009033221141492038 + -0.019885552686660694i, -0.006372757141675845 + -0.0003206343477320131i, 0.23534251195873224 + 2.0328790734103208e-20i, 0.03154572448878713 + -0.061090641411443165i }, { 0.003951099422429921 + -0.005010354610783548i, -0.01162724205114941 + -0.025595978531584823i, 0.03154572448878713 + 0.061090641411443165i, 0.3029245391658517 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.20188007386932225, 1.0e-7), DoubleNear(0.25985287500609366, 1.0e-7), DoubleNear(0.23534251195873224, 1.0e-7), DoubleNear(0.3029245391658517, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true, false}), Matrix({ { 0.4372225858280545 + 1.0164395367051604e-20i, 0.05860608488459336 + -0.11349504169688346i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.05860608488459336 + 0.11349504169688346i, 0.5627774141719453 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4372225858280545, 1.0e-7), DoubleNear(0.5627774141719453, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false, true}), Matrix({ { 0.21482137220798683 + 6.776263578034403e-21i, 0.028795034800872067 + -0.05576372627217275i, -0.05142207134547102 + -0.03715628916126655i, -0.01653780271250053 + 0.008367741314149451i }, { 0.028795034800872067 + 0.055763726272172756i, 0.2765104554951435 + 0.0i, 0.002752392827936791 + -0.018328730097277215i, -0.06618866746867992 + -0.04782625832286298i }, { -0.05142207134547102 + 0.03715628916126654i, 0.0027523928279367896 + 0.018328730097277215i, 0.22240121362006765 + 3.3881317890172014e-21i, 0.029811050083721296 + -0.05773131542471071i }, { -0.01653780271250053 + -0.008367741314149451i, -0.06618866746867992 + 0.04782625832286298i, 0.029811050083721296 + 0.05773131542471071i, 0.2862669586768018 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.21482137220798683, 1.0e-7), DoubleNear(0.2765104554951435, 1.0e-7), DoubleNear(0.22240121362006765, 1.0e-7), DoubleNear(0.2862669586768018, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false, false}), Matrix({ { 0.4617329488754159 + -1.0164395367051604e-20i, 0.0 + 0.0i, -0.02066046319264145 + 0.04548153121824552i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02066046319264145 + -0.04548153121824552i, 0.0 + 0.0i, 0.538267051124584 + 2.0328790734103208e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.4617329488754159, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.538267051124584, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true, false}), Matrix({ { 0.9999999999999998 + 1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false, true}), Matrix({ { 0.4913318277031304 + 6.776263578034403e-21i, 0.0 + 0.0i, -0.11761073881415093 + -0.08498254748412953i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11761073881415095 + 0.08498254748412953i, 0.0 + 0.0i, 0.5086681722968694 + 3.3881317890172014e-21i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.4913318277031304, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5086681722968694, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true, false}), Matrix({ { 0.4617329488754159 + -1.0164395367051604e-20i, -0.02066046319264145 + 0.04548153121824552i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02066046319264145 + -0.04548153121824552i, 0.538267051124584 + 2.0328790734103208e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.4617329488754159, 1.0e-7), DoubleNear(0.538267051124584, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false, true}), Matrix({ { 0.21955437286429508 + 0.0i, -0.0004173466067672149 + 0.02100659161779865i, -0.05035774869189078 + -0.03969095941261082i, 0.0006764186034017761 + -0.00027609597754275016i }, { -0.0004173466067672151 + -0.02100659161779865i, 0.2717774548388353 + 6.776263578034403e-21i, -0.008706958201840722 + 0.008607935473553352i, -0.06725299012226016 + -0.045291588071518715i }, { -0.05035774869189079 + 0.03969095941261082i, -0.008706958201840722 + -0.008607935473553352i, 0.2421785760111208 + -1.0164395367051604e-20i, -0.020243116585874233 + 0.024474939600446867i }, { 0.0006764186034017761 + 0.00027609597754274973i, -0.06725299012226016 + 0.04529158807151871i, -0.020243116585874233 + -0.024474939600446867i, 0.26648959628574864 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.21955437286429508, 1.0e-7), DoubleNear(0.2717774548388353, 1.0e-7), DoubleNear(0.2421785760111208, 1.0e-7), DoubleNear(0.26648959628574864, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true, true}), Matrix({ { 0.4913318277031304 + 6.776263578034403e-21i, 0.0 + 0.0i, -0.11761073881415093 + -0.08498254748412953i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11761073881415095 + 0.08498254748412953i, 0.0 + 0.0i, 0.5086681722968694 + 3.3881317890172014e-21i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.4913318277031304, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5086681722968694, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false, false, false}), Matrix({ { 0.1476579709407524 + 6.776263578034403e-21i, -0.0017482712245308753 + 0.001155732046076067i, -0.016681525637777424 + -0.020663247481874144i, -0.0008354660198220518 + 0.002366387627639909i, -0.0050137879392948125 + 0.007688210479297247i, -8.130278844260174e-07 + -0.0001302718195313891i, 0.0016423158623484419 + -0.00016693944153974808i, -9.48437569187872e-05 + -0.000123852469591283i }, { -0.0017482712245308757 + -0.001155732046076067i, 0.056438623403153365 + 0.0i, -0.0010040208425928924 + -0.0017441882922516114i, -0.0055917218923001565 + -0.008255559464121737i, 0.00011953958391554204 + -5.178509298687e-05i, -0.001916396978275383 + 0.0029386291381407466i, 0.00012490781351146807 + 6.947587411359239e-06i, 0.0006197172152984842 + -1.0827118686296342e-05i }, { -0.016681525637777424 + 0.020663247481874144i, -0.0010040208425928924 + 0.0017441882922516114i, 0.20417489480350157 + 0.0i, 0.0017482712245308761 + -0.0011557320460760681i, -0.0005094595523388021 + -0.001570197800722462i, -5.6723921245838565e-05 + -0.00011150169328557331i, -0.006932843642307246 + 0.010630916542037204i, 8.130278844260377e-07 + 0.0001302718195313893i }, { -0.000835466019822052 + -0.002366387627639909i, -0.0055917218923001565 + 0.008255559464121737i, 0.0017482712245308761 + 0.0011557320460760681i, 0.07710393195587198 + 0.0i, 0.00015158095068064934 + 3.685088657115647e-05i, -0.00023997872092685864 + -0.0005714690428524223i, -0.00011953958391554213 + 5.1785092986870014e-05i, -0.002618096142386209 + 0.004014624160696436i }, { -0.005013787939294812 + -0.007688210479297247i, 0.00011953958391554208 + 5.178509298687005e-05i, -0.0005094595523388025 + 0.0015701978007224618i, 0.00015158095068064934 + -3.6850886571156374e-05i, 0.15655597257768827 + -6.776263578034403e-21i, -0.0018536236150491323 + 0.0012253774947594334i, -0.01768676932009167 + -0.021908433290311818i, -0.0008858119507908833 + 0.0025089882664690406i }, { -8.130278844260241e-07 + 0.00013027181953138918i, -0.001916396978275383 + -0.0029386291381407466i, -5.672392124583857e-05 + 0.00011150169328557331i, -0.00023997872092685861 + 0.0005714690428524221i, -0.0018536236150491327 + -0.0012253774947594337i, 0.05983966542092002 + -3.3881317890172014e-21i, -0.001064524038214441 + -0.001849294641612233i, -0.005928684063959288 + -0.00875304687477464i }, { 0.0016423158623484417 + 0.0001669394415397485i, 0.00012490781351146804 + -6.947587411359239e-06i, -0.006932843642307242 + -0.010630916542037204i, -0.00011953958391554213 + -5.1785092986869974e-05i, -0.01768676932009167 + 0.021908433290311818i, -0.001064524038214441 + 0.001849294641612233i, 0.21647865691405999 + 1.3552527156068805e-20i, 0.0018536236150491334 + -0.0012253774947594337i }, { -9.484375691878709e-05 + 0.000123852469591283i, 0.0006197172152984842 + 1.0827118686296342e-05i, 8.130278844260377e-07 + -0.0001302718195313893i, -0.0026180961423862086 + -0.004014624160696437i, -0.0008858119507908837 + -0.002508988266469041i, -0.005928684063959288 + 0.00875304687477464i, 0.0018536236150491331 + 0.0012253774947594337i, 0.08175028398405221 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1476579709407524, 1.0e-7), DoubleNear(0.056438623403153365, 1.0e-7), DoubleNear(0.20417489480350157, 1.0e-7), DoubleNear(0.07710393195587198, 1.0e-7), DoubleNear(0.15655597257768827, 1.0e-7), DoubleNear(0.05983966542092002, 1.0e-7), DoubleNear(0.21647865691405999, 1.0e-7), DoubleNear(0.08175028398405221, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false, false, false}), Matrix({ { 0.16403236190118264 + 6.776263578034403e-21i, -0.0026472336315648604 + -0.0069870483796774276i, -0.01722143002296482 + -0.02114056102956659i, -0.002111336427791755 + 0.002215167437919454i, 0.018880118955504937 + 0.024514118820570058i, -0.0028203852471511857 + 0.011698383370339212i, 0.0037081729472566083 + -0.006224288530715721i, -1.0043125676587218e-05 + 0.0007525825569473679i }, { -0.002647233631564861 + 0.0069870483796774276i, 0.055748783883841066 + 0.0i, 4.52203941576508e-06 + -0.00038410643125798933i, -0.005170210546629097 + -0.006519877917909665i, 0.007047969121822568 + -0.013328597399414804i, 0.022000413383172778 + 0.0018910876110712913i, -0.007961086820708868 + -0.005409087122614103i, -0.0020476800201041007 + -0.0038137429937880195i }, { -0.01722143002296482 + 0.02114056102956659i, 4.522039415765135e-06 + 0.0003841064312579892i, 0.21883757762275222 + 1.3552527156068805e-20i, 0.0009004667118633557 + -0.007042737931531283i, -0.00737181477732609 + -0.000639419829382239i, 4.690347237491202e-05 + -0.0017357231699245787i, 0.02110115598484659 + 0.03651840369113837i, -0.004448952624105152 + 0.013309216593506729i }, { -0.002111336427791755 + -0.002215167437919454i, -0.005170210546629097 + 0.006519877917909665i, 0.0009004667118633557 + 0.007042737931531283i, 0.0732269864036946 + 0.0i, 0.004961176304934881 + -0.005286537937978017i, -0.004528629980694434 + 0.0034321678632243994i, 0.011629984434140473 + -0.011646700539498669i, 0.034471392811233306 + 0.0033642739849015658i }, { 0.018880118955504937 + -0.024514118820570058i, 0.007047969121822568 + 0.013328597399414804i, -0.00737181477732609 + 0.000639419829382239i, 0.004961176304934881 + 0.005286537937978017i, 0.14018158161725802 + -6.776263578034403e-21i, -0.0009546612080151475 + 0.009368157920512928i, -0.017146864934904277 + -0.021431119742619374i, 0.00039005845717881963 + 0.002660208456189495i }, { -0.0028203852471511857 + -0.011698383370339212i, 0.022000413383172778 + -0.0018910876110712913i, 4.690347237491213e-05 + 0.001735723169924579i, -0.004528629980694433 + -0.0034321678632243994i, -0.0009546612080151476 + -0.009368157920512928i, 0.06052950494023233 + -3.3881317890172014e-21i, -0.0020730669202230984 + -0.0032093765026058553i, -0.006350195409630347 + -0.010488728420986712i }, { 0.0037081729472566074 + 0.006224288530715721i, -0.007961086820708868 + 0.005409087122614103i, 0.02110115598484659 + -0.03651840369113837i, 0.011629984434140473 + 0.011646700539498669i, -0.017146864934904277 + 0.021431119742619374i, -0.0020730669202230984 + 0.0032093765026058553i, 0.20181597409480936 + 0.0i, 0.0027014281277166537 + 0.00466162839069578i }, { -1.0043125676587191e-05 + -0.0007525825569473679i, -0.0020476800201041007 + 0.003813742993788019i, -0.004448952624105151 + -0.013309216593506729i, 0.034471392811233306 + -0.0033642739849015658i, 0.0003900584571788196 + -0.002660208456189495i, -0.006350195409630347 + 0.01048872842098671i, 0.0027014281277166537 + -0.0046616283906957805i, 0.0856272295362296 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.16403236190118264, 1.0e-7), DoubleNear(0.055748783883841066, 1.0e-7), DoubleNear(0.21883757762275222, 1.0e-7), DoubleNear(0.0732269864036946, 1.0e-7), DoubleNear(0.14018158161725802, 1.0e-7), DoubleNear(0.06052950494023233, 1.0e-7), DoubleNear(0.20181597409480936, 1.0e-7), DoubleNear(0.0856272295362296, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false, false, false}), Matrix({ { 0.149492725172937 + 0.0i, -0.0017699947251842985 + 0.0011700928303215738i, -0.016888805336720932 + -0.020920002877647927i, -0.0008458472732413471 + 0.0023957916597225635i, 0.04553888736854102 + 0.048073146856003106i, -0.0009154534760268036 + -0.00021274942115472067i, 0.0015826386620039902 + -0.011803729391701809i, -0.0010280914193219798 + 0.0004578092096932647i }, { -0.0017699947251842987 + -0.0011700928303215738i, 0.057139913028683695 + -1.6940658945086007e-21i, -0.0010164965083386177 + -0.001765861059597301i, -0.005661202973082539 + -0.008358140601931945i, -0.00016290790028545784 + -0.0009256232489494901i, 0.017406118328843728 + 0.018374776613306616i, 0.0002582090733640506 + -0.0008648015057315635i, 0.0009632390865278668 + -0.004366582150625076i }, { -0.016888805336720932 + 0.020920002877647927i, -0.0010164965083386177 + 0.001765861059597301i, 0.20671191159954627 + 2.710505431213761e-20i, 0.0017699947251842993 + -0.0011700928303215747i, -0.011872067838285812 + 0.0009416888711960787i, -0.0008775050284039756 + 0.00021104145329493696i, 0.06296915417909366 + 0.06647341582484637i, 0.0009154534760268042 + 0.00021274942115472078i }, { -0.0008458472732413473 + -0.0023957916597225635i, -0.005661202973082539 + 0.008358140601931945i, 0.0017699947251842993 + 0.0011700928303215747i, 0.07806200258743222 + -6.776263578034403e-21i, 0.0005127627481432914 + -0.0010018161523353444i, -0.004412301698282653 + 0.0007255776590445523i, 0.00016290790028545752 + 0.0009256232489494906i, 0.023779463110860308 + 0.025102800888258076i }, { 0.04553888736854102 + -0.048073146856003106i, -0.00016290790028545773 + 0.00092562324894949i, -0.011872067838285812 + -0.0009416888711960785i, 0.0005127627481432914 + 0.0010018161523353444i, 0.15472121834550367 + 0.0i, -0.0018319001143957095 + 0.0012110167105139269i, -0.01747948962114816 + -0.02165167789453804i, -0.0008754306973715882 + 0.002479584234386386i }, { -0.0009154534760268036 + 0.00021274942115472083i, 0.017406118328843728 + -0.018374776613306616i, -0.0008775050284039756 + -0.0002110414532949369i, -0.004412301698282653 + -0.0007255776590445523i, -0.0018319001143957095 + -0.0012110167105139269i, 0.05913837579538969 + -1.6940658945086007e-21i, -0.0010520483724687157 + -0.0018276218742665435i, -0.005859202983176906 + -0.008650465736964433i }, { 0.0015826386620039904 + 0.011803729391701809i, 0.0002582090733640506 + 0.0008648015057315635i, 0.06296915417909366 + -0.06647341582484637i, 0.00016290790028545757 + -0.0009256232489494906i, -0.01747948962114816 + 0.02165167789453804i, -0.0010520483724687157 + 0.0018276218742665437i, 0.21394164011801528 + -1.3552527156068805e-20i, 0.00183190011439571 + -0.0012110167105139273i }, { -0.0010280914193219798 + -0.0004578092096932647i, 0.0009632390865278668 + 0.004366582150625076i, 0.0009154534760268041 + -0.00021274942115472078i, 0.023779463110860308 + -0.02510280088825808i, -0.0008754306973715882 + -0.002479584234386386i, -0.005859202983176906 + 0.008650465736964433i, 0.00183190011439571 + 0.0012110167105139273i, 0.08079221335249198 + 6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.149492725172937, 1.0e-7), DoubleNear(0.057139913028683695, 1.0e-7), DoubleNear(0.20671191159954627, 1.0e-7), DoubleNear(0.07806200258743222, 1.0e-7), DoubleNear(0.15472121834550367, 1.0e-7), DoubleNear(0.05913837579538969, 1.0e-7), DoubleNear(0.21394164011801528, 1.0e-7), DoubleNear(0.08079221335249198, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false, false, false}), Matrix({ { 0.11795767285670773 + 0.0i, -0.006640052857085504 + -0.005044522745892354i, -0.021458316908482995 + -0.007070189899778678i, 0.0034292960522838804 + 0.00623921072056721i, -0.0096916935582514 + -0.04366735922099966i, -0.002133228787577833 + 0.003528096067449492i, -0.025626202075146997 + -5.16540580629629e-06i, -0.00023776139500428017 + 0.001994671232621362i }, { -0.006640052857085504 + 0.005044522745892354i, 0.04418503827029716 + -3.3881317890172014e-21i, 0.00011054930972291594 + -0.005021421938904194i, -0.006786823363192905 + -0.0029761991197582377i, 0.006145272635323605 + 0.0020662894859403208i, -0.0038193984533954057 + -0.016035067148747084i, 0.005661289241866889 + -0.0050506169918012765i, -0.009789132453041185 + 0.0004051285495271318i }, { -0.021458316908482995 + 0.007070189899778678i, 0.00011054930972291599 + 0.005021421938904194i, 0.19922236116475872 + 1.3552527156068805e-20i, 0.00030109812210292865 + 0.0032382228701009295i, -0.020082018981057135 + 0.04818687478124302i, -0.0007555395344820912 + 0.00032310257950481265i, 0.053639167991470046 + -0.03882033137384039i, -0.0013846227842752028 + -0.0017135537016333203i }, { 0.0034292960522838804 + -0.00623921072056721i, -0.006786823363192905 + 0.0029761991197582377i, 0.00030109812210292865 + -0.003238222870100929i, 0.07585751353629086 + 0.0i, -0.005935834622421343 + -0.000506056231206466i, -0.00728532898050706 + 0.018137688339906224i, 0.0017929723791645672 + 0.012756851104519908i, 0.018478008904770124 + -0.014972283953296325i }, { -0.0096916935582514 + 0.04366735922099966i, 0.006145272635323605 + -0.0020662894859403208i, -0.020082018981057135 + -0.04818687478124302i, -0.005935834622421343 + 0.000506056231206466i, 0.18625627066173295 + 0.0i, 0.003038158017505495 + 0.007425632286727855i, -0.0129099780493861 + -0.03550149087240729i, -0.005150574022896816 + -0.0013638348264582612i }, { -0.002133228787577833 + -0.0035280960674494923i, -0.0038193984533954057 + 0.016035067148747084i, -0.0007555395344820912 + -0.00032310257950481276i, -0.007285328980507059 + -0.018137688339906224i, 0.003038158017505495 + -0.007425632286727855i, 0.07209325055377622 + 0.0i, -0.0021790941905302495 + 0.0014279390050403497i, -0.004733582593066539 + -0.014032407219138138i }, { -0.025626202075147 + 5.165405806296073e-06i, 0.005661289241866889 + 0.005050616991801276i, 0.053639167991470046 + 0.038820331373840396i, 0.0017929723791645677 + -0.012756851104519908i, -0.0129099780493861 + 0.03550149087240729i, -0.0021790941905302495 + -0.0014279390050403497i, 0.22143119055280286 + 0.0i, 0.0033007967174770803 + -0.005619332410936431i }, { -0.0002377613950042802 + -0.0019946712326213614i, -0.009789132453041185 + -0.00040512854952713185i, -0.001384622784275203 + 0.0017135537016333205i, 0.018478008904770124 + 0.014972283953296323i, -0.005150574022896816 + 0.0013638348264582614i, -0.004733582593066539 + 0.014032407219138138i, 0.0033007967174770807 + 0.005619332410936431i, 0.08299670240363333 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.11795767285670773, 1.0e-7), DoubleNear(0.04418503827029716, 1.0e-7), DoubleNear(0.19922236116475872, 1.0e-7), DoubleNear(0.07585751353629086, 1.0e-7), DoubleNear(0.18625627066173295, 1.0e-7), DoubleNear(0.07209325055377622, 1.0e-7), DoubleNear(0.22143119055280286, 1.0e-7), DoubleNear(0.08299670240363333, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false, false, false}), Matrix({ { 0.30421394351844067 + 0.0i, -0.003601894839580008 + 0.0023811095408355003i, -0.0343682949578691 + -0.04257168077218596i, -0.0017212779706129355 + 0.00487537589410895i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0036018948395800084 + -0.0023811095408355007i, 0.11627828882407339 + -3.3881317890172014e-21i, -0.0020685448808073336 + -0.003593482933863844i, -0.011520405956259444 + -0.01700860633889638i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0343682949578691 + 0.04257168077218596i, -0.0020685448808073336 + 0.003593482933863844i, 0.4206535517175616 + 1.3552527156068805e-20i, 0.0036018948395800093 + -0.002381109540835502i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017212779706129357 + -0.00487537589410895i, -0.011520405956259444 + 0.01700860633889638i, 0.0036018948395800093 + 0.002381109540835502i, 0.1588542159399242 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.30421394351844067, 1.0e-7), DoubleNear(0.11627828882407339, 1.0e-7), DoubleNear(0.4206535517175616, 1.0e-7), DoubleNear(0.1588542159399242, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true, false, false}), Matrix({ { 0.14046560122978885 + -6.776263578034403e-21i, -0.0016631135258184204 + 0.0010994367298853636i, -0.015868974178716987 + -0.01965674770152427i, -0.0007947707532054023 + 0.002251121688463043i, -0.00628520098275105 + 0.01383611596915954i, -3.3879692158664184e-05 + -0.00021301451861727483i, 0.002646290121024258 + -0.0006835720364015634i, -0.0001861771607724447 + -0.0001790138819662399i }, { -0.0016631135258184206 + -0.0010994367298853638i, 0.05368951718892673 + -3.3881317890172014e-21i, -0.0009551153276963159 + -0.001659229471786434i, -0.005319351014425579 + -0.007853433961119717i, 0.00018271332367248 + -0.00011462486656511633i, -0.0024023633063531002 + 0.005288514623156264i, 0.00020617420161100778 + -1.9837566684301562e-05i, 0.00101159438340495 + -0.0001725600179235789i }, { -0.015868974178716987 + 0.01965674770152427i, -0.0009551153276963159 + 0.001659229471786434i, 0.194229604889467 + 0.0i, 0.0016631135258184208 + -0.0010994367298853642i, -0.0012261603350824596 + -0.0024426733236868232i, -0.00012070001086651413 + -0.00016832361046125986i, -0.008690897222114578 + 0.019131967644508134i, 3.387969215866416e-05 + 0.0002130145186172749i }, { -0.0007947707532054023 + -0.002251121688463043i, -0.005319351014425579 + 0.007853433961119717i, 0.001663113525818421 + 0.0010994367298853642i, 0.0733482255672333 + 0.0i, 0.00025730196108475104 + 2.244116645481884e-05i, -0.0005355605369577787 + -0.0008753713883693721i, -0.00018271332367248024 + 0.00011462486656511637i, -0.0032820016814227204 + 0.0072249329814215784i }, { -0.006285200982751048 + -0.01383611596915954i, 0.00018271332367248005 + 0.00011462486656511633i, -0.0012261603350824596 + 0.0024426733236868237i, 0.000257301961084751 + -2.244116645481884e-05i, 0.16374834228865182 + 6.776263578034403e-21i, -0.0019387813137615876 + 0.0012816728109501367i, -0.01849932077915211 + -0.02291493307066169i, -0.0009265072174075332 + 0.002624254205645906i }, { -3.387969215866413e-05 + 0.00021301451861727483i, -0.0024023633063531002 + -0.005288514623156264i, -0.00012070001086651412 + 0.00016832361046125986i, -0.0005355605369577788 + 0.0008753713883693723i, -0.0019387813137615876 + -0.0012816728109501369i, 0.06258877163514666 + 0.0i, -0.0011134295531110177 + -0.0019342534620774101i, -0.006201054941833865 + -0.00915517237777666i }, { 0.002646290121024258 + 0.0006835720364015634i, 0.00020617420161100778 + 1.9837566684301528e-05i, -0.008690897222114578 + -0.019131967644508134i, -0.00018271332367248019 + -0.00011462486656511638i, -0.01849932077915211 + 0.02291493307066169i, -0.0011134295531110177 + 0.0019342534620774101i, 0.22642394682809458 + 1.3552527156068805e-20i, 0.0019387813137615882 + -0.001281672810950138i }, { -0.00018617716077244472 + 0.0001790138819662399i, 0.00101159438340495 + 0.00017256001792357887i, 3.38796921586642e-05 + -0.0002130145186172749i, -0.0032820016814227204 + -0.007224932981421578i, -0.0009265072174075334 + -0.002624254205645906i, -0.006201054941833865 + 0.00915517237777666i, 0.0019387813137615884 + 0.0012816728109501377i, 0.08550599037269088 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.14046560122978885, 1.0e-7), DoubleNear(0.05368951718892673, 1.0e-7), DoubleNear(0.194229604889467, 1.0e-7), DoubleNear(0.0733482255672333, 1.0e-7), DoubleNear(0.16374834228865182, 1.0e-7), DoubleNear(0.06258877163514666, 1.0e-7), DoubleNear(0.22642394682809458, 1.0e-7), DoubleNear(0.08550599037269088, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, true, false}), Matrix({ { 0.30421394351844067 + 0.0i, -0.003601894839580008 + 0.0023811095408355003i, -0.0343682949578691 + -0.04257168077218596i, -0.0017212779706129355 + 0.00487537589410895i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0036018948395800084 + -0.0023811095408355007i, 0.11627828882407339 + -3.3881317890172014e-21i, -0.0020685448808073336 + -0.003593482933863844i, -0.011520405956259444 + -0.01700860633889638i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0343682949578691 + 0.04257168077218596i, -0.0020685448808073336 + 0.003593482933863844i, 0.4206535517175616 + 1.3552527156068805e-20i, 0.0036018948395800093 + -0.002381109540835502i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017212779706129357 + -0.00487537589410895i, -0.011520405956259444 + 0.01700860633889638i, 0.0036018948395800093 + 0.002381109540835502i, 0.1588542159399242 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.30421394351844067, 1.0e-7), DoubleNear(0.11627828882407339, 1.0e-7), DoubleNear(0.4206535517175616, 1.0e-7), DoubleNear(0.1588542159399242, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false, true}), Matrix({ { 0.14946999288169233 + 6.776263578034403e-21i, -0.0017697255747253196 + 0.0011699149026600684i, -0.016886237176690105 + -0.020916821722192343i, -0.0008457186512863888 + 0.002395427348792334i, -0.035778826654770196 + -0.025852875900390187i, 0.0006259742678328493 + 2.605414694236243e-05i, 0.0004242306790761453 + 0.007927592086382655i, 0.0006167626372524041 + -0.00042711797403185547i }, { -0.0017697255747253196 + -0.0011699149026600684i, 0.057131224170124464 + 0.0i, -0.0010163419369730213 + -0.00176559253771533i, -0.005660342114370984 + -0.008356869639173007i, 0.00022126875859491534 + 0.0005861422515325363i, -0.013675575456644504 + -0.009881625201365148i, -6.210024235851294e-05 + 0.0005984223963240317i, -9.051123987950972e-05 + 0.002979428203930921i }, { -0.016886237176690105 + 0.020916821722192343i, -0.0010163419369730213 + 0.00176559253771533i, 0.20668047839520284 + 0.0i, 0.0017697255747253196 + -0.0011699149026600688i, 0.007659930444479141 + -0.002086181569971295i, 0.0005486664257624736 + -0.0002468419692115071i, -0.04947337500229908 + -0.03574821043320542i, -0.0006259742678328494 + -2.6054146942362295e-05i }, { -0.000845718651286389 + -0.002395427348792334i, -0.005660342114370984 + 0.008356869639173007i, 0.00176972557472532 + 0.0011699149026600688i, 0.07805013225611071 + 0.0i, -0.0002118810895957847 + 0.0007196751477738552i, 0.0028003581517887467 + -0.001021361311502387i, -0.0002212687585949157 + -0.0005861422515325363i, -0.018682961700437158 + -0.013499835949168777i }, { -0.035778826654770196 + 0.025852875900390183i, 0.0002212687585949155 + -0.0005861422515325362i, 0.007659930444479141 + 0.0020861815699712957i, -0.00021188108959578465 + -0.0007196751477738552i, 0.1547439506367483 + -6.776263578034403e-21i, -0.0018321692648546883 + 0.0012111946381754318i, -0.01748205778117899 + -0.02165485904999362i, -0.0008755593193265467 + 0.0024799485453166153i }, { 0.0006259742678328494 + -2.6054146942362322e-05i, -0.013675575456644504 + 0.009881625201365145i, 0.0005486664257624736 + 0.0002468419692115071i, 0.0028003581517887467 + 0.001021361311502387i, -0.0018321692648546888 + -0.0012111946381754323i, 0.05914706465394892 + -3.3881317890172014e-21i, -0.0010522029438343123 + -0.0018278903961485141i, -0.00586006384188846 + -0.00865173669972337i }, { 0.0004242306790761456 + -0.007927592086382655i, -6.2100242358513e-05 + -0.0005984223963240317i, -0.04947337500229908 + 0.03574821043320542i, -0.00022126875859491564 + 0.0005861422515325361i, -0.01748205778117899 + 0.02165485904999362i, -0.0010522029438343123 + 0.0018278903961485141i, 0.2139730733223587 + 1.3552527156068805e-20i, 0.0018321692648546894 + -0.0012111946381754331i }, { 0.0006167626372524041 + 0.00042711797403185547i, -9.05112398795095e-05 + -0.002979428203930921i, -0.0006259742678328495 + 2.6054146942362105e-05i, -0.018682961700437158 + 0.013499835949168777i, -0.0008755593193265467 + -0.0024799485453166153i, -0.00586006384188846 + 0.00865173669972337i, 0.0018321692648546894 + 0.0012111946381754331i, 0.08080408368381348 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.14946999288169233, 1.0e-7), DoubleNear(0.057131224170124464, 1.0e-7), DoubleNear(0.20668047839520284, 1.0e-7), DoubleNear(0.07805013225611071, 1.0e-7), DoubleNear(0.1547439506367483, 1.0e-7), DoubleNear(0.05914706465394892, 1.0e-7), DoubleNear(0.2139730733223587, 1.0e-7), DoubleNear(0.08080408368381348, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false, false, false}), Matrix({ { 0.18583565812421698 + 6.776263578034403e-21i, -0.0008478377292193963 + -0.006809713438791953i, -0.006310127218042115 + 0.009676034724809997i, 0.0003833547788969939 + 0.0001870816998157509i, 0.01940592816041912 + 0.029623686315115857i, -0.003528357930403061 + 0.012138074363234077i, -0.0022013734988627558 + 4.537371568731066e-06i, -0.0005121947132219618 + -0.0005958668448666859i }, { -0.0008478377292193964 + 0.006809713438791953i, 0.06260166881543246 + 0.0i, -0.000325777412038215 + -0.0002753716156665335i, -0.0021256657536793855 + 0.003259524718793694i, 0.009065819572573058 + -0.012122395754279994i, 0.027410026712072637 + 0.002550823347695328i, 0.0003233515463829044 + 0.0008836573456762213i, -0.0010635343770255216 + 0.0013405626936933393i }, { -0.0063101272180421135 + -0.009676034724809997i, -0.00032577741203821493 + 0.00027537161566653355i, 0.19703428139971785 + 1.3552527156068805e-20i, -0.0008989291904821086 + -0.007220072872416758i, 0.0008835007427679104 + -0.0020163066003870914i, 0.0007518084411400887 + -0.00022843990215025173i, 0.020575346779932415 + 0.03140883619659257i, -0.0037409799408532757 + 0.012869525600611862i }, { 0.0003833547788969939 + -0.00018708169981575083i, -0.0021256657536793855 + -0.003259524718793694i, -0.0008989291904821086 + 0.007220072872416757i, 0.06637410147210321 + 0.0i, -0.0009390189098607358 + -6.041534606137961e-05i, -0.0007979033830786211 + -0.0015137912333307714i, 0.009612133983389986 + -0.01285290218463348i, 0.029061779482333447 + 0.002704538248277529i }, { 0.01940592816041912 + -0.029623686315115857i, 0.009065819572573058 + 0.012122395754279994i, 0.0008835007427679101 + 0.0020163066003870923i, -0.0009390189098607356 + 6.0415346061379826e-05i, 0.16599720762003697 + 0.0i, 0.0008478377292193966 + 0.006809713438791952i, -0.005636504363559944 + 0.008643092296524456i, -0.0003833547788969939 + -0.00018708169981575078i }, { -0.003528357930403061 + -0.012138074363234077i, 0.027410026712072637 + -0.002550823347695328i, 0.0007518084411400887 + 0.00022843990215025173i, -0.0007979033830786213 + 0.0015137912333307714i, 0.0008478377292193966 + -0.006809713438791952i, 0.0709408865435929 + 0.0i, 0.0003257774120382149 + 0.00027537161566653355i, -0.002408827366982206 + 0.0036937285800434884i }, { -0.0022013734988627553 + -4.5373715687314995e-06i, 0.0003233515463829043 + -0.0008836573456762213i, 0.020575346779932415 + -0.03140883619659257i, 0.009612133983389986 + 0.01285290218463348i, -0.005636504363559942 + -0.008643092296524456i, 0.00032577741203821493 + -0.0002753716156665334i, 0.1760003480920304 + -6.776263578034403e-21i, 0.0008989291904821094 + 0.007220072872416756i }, { -0.0005121947132219618 + 0.0005958668448666859i, -0.0010635343770255216 + -0.0013405626936933393i, -0.0037409799408532757 + -0.012869525600611862i, 0.02906177948233345 + -0.002704538248277529i, -0.0003833547788969938 + 0.00018708169981575075i, -0.0024088273669822056 + -0.0036937285800434884i, 0.0008989291904821093 + -0.007220072872416756i, 0.07521584793286903 + -3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.18583565812421698, 1.0e-7), DoubleNear(0.06260166881543246, 1.0e-7), DoubleNear(0.19703428139971785, 1.0e-7), DoubleNear(0.06637410147210321, 1.0e-7), DoubleNear(0.16599720762003697, 1.0e-7), DoubleNear(0.0709408865435929, 1.0e-7), DoubleNear(0.1760003480920304, 1.0e-7), DoubleNear(0.07521584793286903, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false, false, false}), Matrix({ { 0.17289297557238476 + 1.3552527156068805e-20i, 3.7947076036992655e-19 + -5.421010862427522e-19i, -0.005870653038171828 + 0.009002139052322793i, -1.3552527156068805e-20 + 4.0657581468206416e-20i, 0.05266713635927532 + 0.0555980860971505i, 3.3881317890172014e-19 + -1.0842021724855044e-19i, -0.00468319886038378 + 0.0008544003100300686i, -1.8634724839594607e-20 + 3.3881317890172014e-21i }, { 3.2526065174565133e-19 + 6.505213034913027e-19i, 0.06562368672614231 + -8.470329472543003e-21i, -6.776263578034403e-20 + 1.0164395367051604e-20i, -0.0022282796312541337 + 0.0034168742314662345i, -1.8973538018496328e-19 + 2.439454888092385e-19i, 0.019990468934679755 + 0.02110294748837243i, -3.3881317890172014e-21 + -3.3881317890172014e-21i, -0.0017775665776622782 + 0.0003242983012959825i }, { -0.005870653038171826 + -0.009002139052322793i, -5.421010862427522e-20 + 6.776263578034403e-20i, 0.18331166120009854 + 1.3552527156068805e-20i, 2.710505431213761e-19 + -2.981555974335137e-19i, 0.0011065297324938357 + -0.00463011267754755i, -3.3881317890172014e-21 + -1.0164395367051604e-20i, 0.05584090518835936 + 0.058948476583698964i, 2.0328790734103208e-19 + 1.0842021724855044e-19i }, { 0.0 + 0.0i, -0.0022282796312541337 + -0.0034168742314662345i, 2.168404344971009e-19 + 4.87890977618477e-19i, 0.06957822888997361 + 0.0i, 1.0164395367051604e-20 + -1.8634724839594607e-20i, 0.00041999717037628347 + -0.001757417054407223i, 0.0 + 2.0328790734103208e-19i, 0.02119511250502428 + 0.022374630013192263i }, { 0.05266713635927532 + -0.0555980860971505i, -1.3552527156068805e-19 + -2.168404344971009e-19i, 0.0011065297324938347 + 0.00463011267754755i, 1.3552527156068805e-20 + 3.3881317890172014e-21i, 0.17893989017186923 + -6.776263578034403e-21i, 1.6263032587282567e-19 + -3.7947076036992655e-19i, -0.006075978543430232 + 0.00931698796901166i, -6.776263578034403e-21 + 1.1180834903756764e-19i }, { 3.5236570605778894e-19 + 8.131516293641283e-20i, 0.019990468934679755 + -0.02110294748837243i, 1.6940658945086007e-21 + 1.6940658945086007e-20i, 0.00041999717037628336 + 0.001757417054407223i, 1.6263032587282567e-19 + 4.87890977618477e-19i, 0.06791886863288304 + 8.470329472543003e-21i, -6.776263578034403e-21 + -1.6940658945086007e-20i, -0.002306213489407458 + 0.0035363790673709483i }, { -0.004683198860383779 + -0.0008544003100300691i, 3.3881317890172014e-21 + 1.5246593050577406e-20i, 0.05584090518835936 + -0.058948476583698964i, 1.3552527156068805e-19 + -1.4907779871675686e-19i, -0.006075978543430232 + -0.00931698796901166i, 0.0 + 4.743384504624082e-20i, 0.18972296829164975 + -6.776263578034403e-21i, 3.2526065174565133e-19 + -2.710505431213761e-19i }, { -5.082197683525802e-21 + -3.3881317890172014e-21i, -0.0017775665776622782 + -0.0003242983012959825i, 1.2197274440461925e-19 + -1.3552527156068805e-19i, 0.02119511250502428 + -0.022374630013192263i, 2.710505431213761e-20 + -6.437450399132683e-20i, -0.0023062134894074574 + -0.0035363790673709474i, 3.7947076036992655e-19 + 2.168404344971009e-19i, 0.07201172051499861 + -3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.17289297557238476, 1.0e-7), DoubleNear(0.06562368672614231, 1.0e-7), DoubleNear(0.18331166120009854, 1.0e-7), DoubleNear(0.06957822888997361, 1.0e-7), DoubleNear(0.17893989017186923, 1.0e-7), DoubleNear(0.06791886863288304, 1.0e-7), DoubleNear(0.18972296829164975, 1.0e-7), DoubleNear(0.07201172051499861, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false, false, false}), Matrix({ { 0.15395139257872179 + 6.776263578034403e-21i, -0.003076772823846794 + -0.0008767335628510644i, -0.005227483693776019 + 0.00801589444975548i, 0.00015012260090253203 + -0.0001304306213922306i, 0.021331023909449104 + -0.04003749755830752i, -0.001707478688067001 + 0.0008807342649177652i, 0.0013603564819620229 + 0.002470147203082621i, 1.212034566379373e-05 + -0.00011881018184234031i }, { -0.003076772823846794 + 0.0008767335628510646i, 0.05826570413343489 + 0.0i, 5.882360603597274e-05 + -0.00018997032839743438i, -0.001978436265902322 + 0.0030337610238599997i, 0.003853029016728205 + 0.007194788106167748i, 0.007114929220624937 + -0.015050206098451552i, -0.0005054472525423868 + -4.36836814697095e-05i, 0.0005420391829609221 + 0.0008814939984920342i }, { -0.005227483693776017 + -0.00801589444975548i, 5.882360603597279e-05 + 0.00018997032839743438i, 0.16322864144274468 + 6.776263578034403e-21i, -0.0032621819111357804 + -0.0009295663129403607i, -0.0028089640949288622 + 0.0002488326271079782i, 0.00010383595521573443 + 5.899878382522675e-05i, 0.02261645052376954 + -0.042450193036532545i, -0.0018103728837860348 + 0.0009338081008984065i }, { 0.00015012260090253212 + 0.0001304306213922307i, -0.0019784362659023215 + -0.0030337610238599997i, -0.003262181911135781 + 0.0009295663129403611i, 0.061776847673153126 + -3.3881317890172014e-21i, 0.0002437848405405823 + -0.00044492037563141233i, -0.0010252199565829463 + 0.00014057804190726448i, 0.004085215997759966 + 0.007628352484292481i, 0.007543681230749781 + -0.015957145003591855i }, { 0.021331023909449107 + 0.04003749755830752i, 0.0038530290167282048 + -0.007194788106167748i, -0.002808964094928863 + -0.00024883262710797866i, 0.00024378484054058227 + 0.0004449203756314125i, 0.1978814731655322 + 0.0i, 0.003076772823846795 + 0.0008767335628510635i, -0.006719147887826039 + 0.010303232571578972i, -0.0001501226009025321 + 0.00013043062139223076i }, { -0.001707478688067001 + -0.0008807342649177653i, 0.0071149292206249375 + 0.015050206098451552i, 0.00010383595521573442 + -5.8998783825226736e-05i, -0.0010252199565829463 + -0.00014057804190726459i, 0.003076772823846795 + -0.0008767335628510635i, 0.07527685122559047 + 0.0i, -5.882360603597279e-05 + 0.00018997032839743438i, -0.0025560568547592696 + 0.0039194922749771835i }, { 0.0013603564819620229 + -0.002470147203082621i, -0.0005054472525423868 + 4.36836814697095e-05i, 0.02261645052376954 + 0.042450193036532545i, 0.004085215997759967 + -0.0076283524842924826i, -0.006719147887826039 + -0.01030323257157897i, -5.882360603597279e-05 + -0.00018997032839743427i, 0.20980598804900358 + 0.0i, 0.003262181911135781 + 0.0009295663129403602i }, { 1.2120345663793784e-05 + 0.00011881018184234033i, 0.0005420391829609223 + -0.0008814939984920342i, -0.001810372883786035 + -0.0009338081008984065i, 0.007543681230749782 + 0.015957145003591855i, -0.00015012260090253206 + -0.00013043062139223076i, -0.002556056854759269 + -0.0039194922749771835i, 0.0032621819111357813 + -0.0009295663129403603i, 0.0798131017318191 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.15395139257872179, 1.0e-7), DoubleNear(0.05826570413343489, 1.0e-7), DoubleNear(0.16322864144274468, 1.0e-7), DoubleNear(0.061776847673153126, 1.0e-7), DoubleNear(0.1978814731655322, 1.0e-7), DoubleNear(0.07527685122559047, 1.0e-7), DoubleNear(0.20980598804900358, 1.0e-7), DoubleNear(0.0798131017318191, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false, false, false}), Matrix({ { 0.351832865744254 + 6.776263578034403e-21i, 6.505213034913027e-19 + -8.944667923005412e-19i, -0.011946631581602057 + 0.018319127021334453i, -4.0657581468206416e-20 + 1.4907779871675686e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.336808689942018e-19 + 1.111307226797642e-18i, 0.13354255535902537 + 0.0i, -5.421010862427522e-20 + -6.776263578034403e-21i, -0.004534493120661591 + 0.006953253298837183i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011946631581602057 + -0.018319127021334453i, 0.0 + 1.0164395367051604e-19i, 0.37303462949174826 + 6.776263578034403e-21i, 6.505213034913027e-19 + -5.692061405548898e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 5.421010862427522e-20 + -6.776263578034403e-20i, -0.004534493120661591 + -0.006953253298837183i, 4.336808689942018e-19 + 7.047314121155779e-19i, 0.14158994940497222 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.351832865744254, 1.0e-7), DoubleNear(0.13354255535902537, 1.0e-7), DoubleNear(0.37303462949174826, 1.0e-7), DoubleNear(0.14158994940497222, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true, false, false}), Matrix({ { 0.16129486337462862 + 0.0i, 3.2526065174565133e-19 + -1.3552527156068805e-19i, 0.027423912740274742 + 0.005400240192235676i, 6.776263578034403e-20 + -2.0328790734103208e-20i, -0.0256570534796712 + 0.03756378942674335i, 5.421010862427522e-20 + 1.0842021724855044e-19i, 0.0034468591274233033 + -0.05344074790938577i, -1.2197274440461925e-19 + -8.131516293641283e-20i }, { 1.0842021724855044e-19 + 8.131516293641283e-20i, 0.06122147848743023 + 0.0i, 8.131516293641283e-20 + 2.0328790734103208e-20i, 0.010409088353733569 + 0.002049728564436832i, -2.507217523872729e-19 + 2.710505431213761e-20i, -0.009738454869503399 + 0.014257805104148575i, 2.303929616531697e-19 + -2.710505431213761e-20i, 0.001308298401472478 + -0.020284102853837558i }, { 0.027423912740274742 + -0.005400240192235676i, 8.131516293641283e-20 + 4.743384504624082e-20i, 0.17340034274462723 + -6.776263578034403e-21i, 3.2526065174565133e-19 + -2.439454888092385e-19i, 0.02018856456654141 + 0.0020329748727547186i, 1.0164395367051604e-20 + 6.776263578034403e-21i, 0.010680955274805573 + -0.004595705813075674i, 1.6940658945086007e-20 + -2.0328790734103208e-20i }, { 8.131516293641283e-20 + -2.0328790734103208e-20i, 0.010409088353733569 + -0.002049728564436832i, 1.0842021724855044e-19 + 2.710505431213761e-19i, 0.06581626426872982 + -3.3881317890172014e-21i, 1.3552527156068805e-20 + 4.0657581468206416e-20i, 0.007662821651250597 + 0.0007716409861655694i, 1.3552527156068805e-20 + 2.0328790734103208e-20i, 0.004054089881727578 + -0.0017443574995707344i }, { -0.0256570534796712 + -0.03756378942674335i, -2.168404344971009e-19 + 0.0i, 0.02018856456654141 + -0.0020329748727547186i, 1.3552527156068805e-20 + -4.404571325722362e-20i, 0.19053800236962537 + 6.776263578034403e-21i, 3.2526065174565133e-19 + -7.589415207398531e-19i, -0.039370544321876796 + 0.012918886829098777i, -1.0842021724855044e-19 + 1.6940658945086007e-19i }, { 5.421010862427522e-20 + -9.486769009248164e-20i, -0.009738454869503399 + -0.014257805104148575i, -1.3552527156068805e-20 + -4.0657581468206416e-20i, 0.007662821651250597 + -0.0007716409861655693i, 3.2526065174565133e-19 + 1.0299920638612292e-18i, 0.07232107687159513 + 0.0i, -1.3552527156068805e-19 + -2.710505431213761e-20i, -0.01494358147439516 + 0.004903524734400351i }, { 0.0034468591274233037 + 0.05344074790938577i, 1.4907779871675686e-19 + 5.421010862427522e-20i, 0.010680955274805573 + 0.004595705813075674i, 5.421010862427522e-20 + -3.049318610115481e-20i, -0.039370544321876796 + -0.012918886829098777i, -8.131516293641283e-20 + 5.421010862427522e-20i, 0.19963428674712103 + 1.3552527156068805e-20i, 3.2526065174565133e-19 + -3.2526065174565133e-19i }, { -4.0657581468206416e-20 + 8.131516293641283e-20i, 0.0013082984014724777 + 0.020284102853837558i, 1.3552527156068805e-20 + 3.3881317890172014e-20i, 0.004054089881727578 + 0.0017443574995707348i, -2.710505431213761e-20 + -4.743384504624082e-20i, -0.01494358147439516 + -0.004903524734400351i, 3.2526065174565133e-19 + 4.336808689942018e-19i, 0.07577368513624241 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.16129486337462862, 1.0e-7), DoubleNear(0.06122147848743023, 1.0e-7), DoubleNear(0.17340034274462723, 1.0e-7), DoubleNear(0.06581626426872982, 1.0e-7), DoubleNear(0.19053800236962537, 1.0e-7), DoubleNear(0.07232107687159513, 1.0e-7), DoubleNear(0.19963428674712103, 1.0e-7), DoubleNear(0.07577368513624241, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, true, false}), Matrix({ { 0.351832865744254 + 6.776263578034403e-21i, 6.505213034913027e-19 + -8.944667923005412e-19i, -0.011946631581602057 + 0.018319127021334453i, -4.0657581468206416e-20 + 1.4907779871675686e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.336808689942018e-19 + 1.111307226797642e-18i, 0.13354255535902537 + 0.0i, -5.421010862427522e-20 + -6.776263578034403e-21i, -0.004534493120661591 + 0.006953253298837183i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011946631581602057 + -0.018319127021334453i, 0.0 + 1.0164395367051604e-19i, 0.37303462949174826 + 6.776263578034403e-21i, 6.505213034913027e-19 + -5.692061405548898e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 5.421010862427522e-20 + -6.776263578034403e-20i, -0.004534493120661591 + -0.006953253298837183i, 4.336808689942018e-19 + 7.047314121155779e-19i, 0.14158994940497222 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.351832865744254, 1.0e-7), DoubleNear(0.13354255535902537, 1.0e-7), DoubleNear(0.37303462949174826, 1.0e-7), DoubleNear(0.14158994940497222, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false, true}), Matrix({ { 0.18012569288749158 + 6.776263578034403e-21i, 2.168404344971009e-19 + -1.8973538018496328e-19i, -0.008410608718142861 + 0.006028738469606509i, -6.776263578034403e-20 + 1.0164395367051604e-19i, -0.04517035869941851 + -0.02712125890686168i, -8.131516293641283e-20 + -2.710505431213761e-20i, 0.005955305696743141 + -8.09185658576482e-05i, 1.3552527156068805e-20 + -2.371692252312041e-20i }, { 1.0842021724855044e-19 + 1.8973538018496328e-19i, 0.0683689548533983 + 0.0i, -2.710505431213761e-20 + 0.0i, -0.0031923515103393584 + 0.002288282929792387i, -5.421010862427522e-20 + -1.6940658945086007e-19i, -0.017144973407881934 + -0.010294212313890935i, 1.6940658945086007e-21 + 1.3552527156068805e-20i, 0.0022604106043502235 + -3.071365160204438e-05i }, { -0.008410608718142861 + -0.006028738469606509i, 2.710505431213761e-20 + 3.3881317890172014e-20i, 0.1760247783894036 + 0.0i, 2.168404344971009e-19 + -2.981555974335137e-19i, -4.3834971427557726e-05 + 0.0008592300096336002i, -2.710505431213761e-20 + 3.3881317890172014e-20i, -0.040081842957650764 + -0.03447982742673393i, 1.3552527156068805e-20 + -8.131516293641283e-20i }, { 0.0 + -8.809142651444724e-20i, -0.0031923515103393584 + -0.002288282929792387i, 1.0842021724855044e-19 + 4.87890977618477e-19i, 0.0668124015728369 + 0.0i, 0.0 + -2.371692252312041e-20i, -1.6638110502107274e-05 + 0.0003261314740591564i, -1.0842021724855044e-19 + 9.486769009248164e-20i, -0.015213563749199731 + -0.013087248836642987i }, { -0.04517035869941851 + 0.02712125890686168i, -1.3552527156068805e-19 + 4.0657581468206416e-20i, -4.3834971427557726e-05 + -0.0008592300096336002i, 6.776263578034403e-21 + 2.0328790734103208e-20i, 0.1717071728567624 + 0.0i, 4.336808689942018e-19 + -7.047314121155779e-19i, -0.0035360228634591963 + 0.012290388551727944i, 2.710505431213761e-20 + 4.743384504624082e-20i }, { -5.421010862427522e-20 + -5.421010862427522e-20i, -0.017144973407881934 + 0.010294212313890935i, -2.0328790734103208e-20 + -3.3881317890172014e-20i, -1.6638110502107274e-05 + -0.0003261314740591564i, 3.2526065174565133e-19 + 9.215718466126788e-19i, 0.06517360050562707 + 0.0i, -2.710505431213761e-20 + -6.776263578034403e-21i, -0.0013421416103222327 + 0.004664970369044796i }, { 0.005955305696743141 + 8.091856585764647e-05i, 1.6940658945086007e-21 + -1.6940658945086007e-21i, -0.040081842957650764 + 0.034479827426733924i, 5.421010862427522e-20 + -4.0657581468206416e-20i, -0.0035360228634591963 + -0.012290388551727944i, -2.710505431213761e-20 + 6.776263578034403e-20i, 0.19700985110234465 + 6.776263578034403e-21i, 4.336808689942018e-19 + -2.710505431213761e-19i }, { 2.0328790734103208e-20 + 2.371692252312041e-20i, 0.0022604106043502235 + 3.071365160204351e-05i, -1.0842021724855044e-19 + 5.421010862427522e-20i, -0.015213563749199733 + 0.013087248836642987i, 5.421010862427522e-20 + 2.0328790734103208e-20i, -0.0013421416103222318 + -0.004664970369044796i, 3.2526065174565133e-19 + 2.168404344971009e-19i, 0.07477754783213533 + -3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.18012569288749158, 1.0e-7), DoubleNear(0.0683689548533983, 1.0e-7), DoubleNear(0.1760247783894036, 1.0e-7), DoubleNear(0.0668124015728369, 1.0e-7), DoubleNear(0.1717071728567624, 1.0e-7), DoubleNear(0.06517360050562707, 1.0e-7), DoubleNear(0.19700985110234465, 1.0e-7), DoubleNear(0.07477754783213533, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false, false, false}), Matrix({ { 0.18814479699468833 + 3.3881317890172014e-20i, -0.0008583727098369696 + -0.006894328921939835i, 0.01964706047853885 + 0.029991781471058215i, -0.0035722002614619556 + 0.012288898481746795i, 0.057313188380281085 + 0.060502692994962734i, 0.001955565050047209 + -0.002376200883247917i, -0.0036596699956024463 + 0.0154541860106797i, -0.005039978004979956 + 0.0025947473740053966i }, { -0.0008583727098369698 + 0.006894328921939837i, 0.06337953861866183 + -1.6940658945086007e-21i, 0.009178468762610175 + -0.01227302505503956i, 0.027750615589150242 + 0.0025825191234324684i, -0.002478524787496313 + 0.001824138202078088i, 0.019306850331923968 + 0.020381285204052385i, 0.0067426705203777765 + -0.0007870752826160464i, 0.0076229952683281935 + 0.009710602735828654i }, { 0.019647060478538845 + -0.029991781471058215i, 0.009178468762610175 + 0.01227302505503956i, 0.16805983977779496 + -6.776263578034403e-21i, 0.0008583727098369704 + 0.006894328921939835i, 0.015629553790550678 + -0.002818172818988192i, -0.0011507294448150683 + 0.006690210384712297i, 0.05119485316735359 + 0.054043869685886745i, -0.0019555650500472084 + 0.002376200883247917i }, { -0.0035722002614619556 + -0.012288898481746795i, 0.027750615589150242 + -0.0025825191234324684i, 0.0008583727098369703 + -0.006894328921939835i, 0.07182237699745408 + -6.776263578034403e-21i, 0.0028636309596450976 + -0.004892209107606884i, 0.009283943263430777 + 0.008137214501009255i, 0.002478524787496313 + -0.0018241382020780877i, 0.021878731107780068 + 0.02309629229751231i }, { 0.057313188380281085 + -0.060502692994962734i, -0.0024785247874963127 + -0.001824138202078088i, 0.015629553790550678 + 0.002818172818988192i, 0.0028636309596450976 + 0.004892209107606884i, 0.19472514252924653 + -1.3552527156068805e-20i, -0.0008883942098645349 + -0.007135457389268874i, 0.020334214461812685 + 0.031040741040650216i, -0.003697137609794381 + 0.012718701482099148i }, { 0.001955565050047209 + 0.002376200883247917i, 0.019306850331923968 + -0.020381285204052385i, -0.001150729444815068 + -0.006690210384712297i, 0.009283943263430777 + -0.008137214501009255i, -0.0008883942098645351 + 0.007135457389268874i, 0.06559623166887382 + 1.6940658945086007e-21i, 0.009499484793352865 + -0.012702272883873912i, 0.028721190605255846 + 0.0026728424725403883i }, { -0.0036596699956024463 + -0.0154541860106797i, 0.006742670520377777 + 0.0007870752826160464i, 0.05119485316735359 + -0.054043869685886745i, 0.002478524787496313 + 0.0018241382020780877i, 0.020334214461812685 + -0.031040741040650216i, 0.009499484793352865 + 0.012702272883873912i, 0.17393771593427243 + 0.0i, 0.0008883942098645356 + 0.007135457389268873i }, { -0.005039978004979956 + -0.0025947473740053966i, 0.0076229952683281935 + -0.009710602735828654i, -0.0019555650500472084 + -0.002376200883247917i, 0.021878731107780068 + -0.02309629229751231i, -0.003697137609794381 + -0.012718701482099148i, 0.028721190605255846 + -0.0026728424725403883i, 0.0008883942098645356 + -0.007135457389268873i, 0.07433435747900785 + 3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.18814479699468833, 1.0e-7), DoubleNear(0.06337953861866183, 1.0e-7), DoubleNear(0.16805983977779496, 1.0e-7), DoubleNear(0.07182237699745408, 1.0e-7), DoubleNear(0.19472514252924653, 1.0e-7), DoubleNear(0.06559623166887382, 1.0e-7), DoubleNear(0.17393771593427243, 1.0e-7), DoubleNear(0.07433435747900785, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false, false, false}), Matrix({ { 0.1739957357568154 + 2.0328790734103208e-20i, -0.004137245330661343 + -0.010477278154711334i, 0.023276672929824604 + 0.025865831301697267i, -0.0023650261188040453 + 0.012004381809643114i, 0.021723721101032503 + -0.04948228469978658i, -0.007459098862478888 + 0.003120745703586415i, 0.012440598921871607 + -0.008076467701279169i, 0.0009989257716753602 + 0.000776942393887706i }, { -0.004137245330661344 + 0.010477278154711334i, 0.05837046321564042 + 0.0i, 0.006681709506571653 + -0.008497772875296303i, 0.02149431593076879 + 0.0018461237987111886i, 0.009630800750880766 + 0.007522341936959666i, 0.00611221221326925 + -0.01478464066623746i, -0.0009655046678099701 + 0.00789768547038009i, 0.00575555715137515 + -0.0024362284553128086i }, { 0.023276672929824604 + -0.025865831301697267i, 0.006681709506571653 + 0.008497772875296303i, 0.14318429826465107 + -6.776263578034403e-21i, -0.0022017094043212306 + 0.008670978278919907i, -0.006662182303343566 + -0.01848561061818666i, 0.004111932210077809 + -0.005504646411444778i, 0.022223753332186146 + -0.03300540589505348i, 0.0039412472906258525 + -0.0013062033377702433i }, { -0.0023650261188040453 + -0.012004381809643114i, 0.02149431593076879 + -0.0018461237987111884i, -0.002201709404321231 + -0.008670978278919909i, 0.0616720885909476 + -3.3881317890172014e-21i, -0.0013961710974039632 + 0.0008501255389352062i, 0.002746041860824228 + -0.003541235071298905i, -0.0016925557363925941 + 0.007300798653500563i, 0.00854639823810547 + -0.016222710435805948i }, { 0.021723721101032507 + 0.04948228469978658i, 0.009630800750880766 + -0.007522341936959666i, -0.006662182303343566 + 0.01848561061818666i, -0.0013961710974039632 + -0.0008501255389352062i, 0.20887420376711946 + 0.0i, 0.0023904784109598388 + -0.003552508156497376i, 0.016704602010526926 + 0.03516669121001116i, -0.004904311752452291 + 0.013003218154202828i }, { -0.007459098862478888 + -0.003120745703586415i, 0.00611221221326925 + 0.01478464066623746i, 0.004111932210077809 + 0.005504646411444778i, 0.002746041860824228 + 0.003541235071298905i, 0.0023904784109598388 + 0.003552508156497376i, 0.07060530707189525 + 0.0i, 0.011996244049391386 + -0.01647752506361717i, 0.03497749026363729 + 0.0034092377972616684i }, { 0.012440598921871607 + 0.008076467701279167i, -0.0009655046678099703 + -0.00789768547038009i, 0.022223753332186142 + 0.03300540589505348i, -0.001692555736392594 + -0.007300798653500563i, 0.016704602010526926 + -0.03516669121001116i, 0.011996244049391386 + 0.01647752506361717i, 0.1988132574474163 + 0.0i, 0.003948476324022737 + 0.005358808032288801i }, { 0.0009989257716753602 + -0.0007769423938877061i, 0.00575555715137515 + 0.002436228455312808i, 0.0039412472906258525 + 0.0013062033377702433i, 0.00854639823810547 + 0.016222710435805948i, -0.004904311752452291 + -0.013003218154202828i, 0.0349774902636373 + -0.0034092377972616684i, 0.003948476324022737 + -0.005358808032288801i, 0.08448464588551433 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1739957357568154, 1.0e-7), DoubleNear(0.05837046321564042, 1.0e-7), DoubleNear(0.14318429826465107, 1.0e-7), DoubleNear(0.0616720885909476, 1.0e-7), DoubleNear(0.20887420376711946, 1.0e-7), DoubleNear(0.07060530707189525, 1.0e-7), DoubleNear(0.1988132574474163, 1.0e-7), DoubleNear(0.08448464588551433, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false, false, false}), Matrix({ { 0.3828699395239349 + 2.0328790734103208e-20i, -0.0017467669197015045 + -0.01402978631120871i, 0.03998127494035153 + 0.06103252251170843i, -0.007269337871256337 + 0.025007599963845942i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001746766919701505 + 0.01402978631120871i, 0.12897577028753565 + 0.0i, 0.01867795355596304 + -0.024975297938913472i, 0.05647180619440609 + 0.005255361595972857i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03998127494035153 + -0.06103252251170843i, 0.01867795355596304 + 0.024975297938913472i, 0.34199755571206736 + -6.776263578034403e-21i, 0.0017467669197015062 + 0.014029786311208707i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007269337871256337 + -0.025007599963845942i, 0.05647180619440609 + -0.005255361595972857i, 0.0017467669197015062 + -0.014029786311208707i, 0.14615673447646194 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3828699395239349, 1.0e-7), DoubleNear(0.12897577028753565, 1.0e-7), DoubleNear(0.34199755571206736, 1.0e-7), DoubleNear(0.14615673447646194, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true, false, false}), Matrix({ { 0.17678366621213865 + 0.0i, -0.0008065398408318025 + -0.006478014605566342i, 0.018460671978007284 + 0.02818072659663634i, -0.0033564928116669272 + 0.011546832875603333i, -0.007910270293103115 + 0.01741351110698562i, 0.0006741851777491692 + 0.0002104162494939498i, -0.0036018842372445505 + 0.0005574494194376424i, -0.0009871960509250884 + -0.0008472892159168603i }, { -0.0008065398408318029 + 0.006478014605566342i, 0.059552362748342094 + 0.0i, 0.008624226574352876 + -0.011531917966376617i, 0.0260748936024641 + 0.00242657360711516i, -0.0006020071504479361 + -0.0003693075178727549i, -0.002664699154768209 + 0.0058660155227298165i, 0.0007500196209368355 + 0.0013655031515406489i, -0.0014057555657919164 + 0.002459846011563972i }, { 0.018460671978007284 + -0.02818072659663634i, 0.008624226574352876 + 0.011531917966376617i, 0.15791153990711723 + -6.776263578034403e-21i, 0.0008065398408318035 + 0.006478014605566341i, 0.0019498209186445286 + 0.0030793697892520684i, -0.0015218099648505172 + 0.00033350070395629736i, -0.007065827911762513 + 0.015554572506682055i, -0.0006741851777491692 + -0.00021041624949394975i }, { -0.0033564928116669272 + -0.011546832875603333i, 0.0260748936024641 + -0.00242657360711516i, 0.0008065398408318034 + -0.006478014605566342i, 0.06748538000781794 + -3.3881317890172014e-21i, 0.0012875718259730208 + 0.0001860479812618211i, -0.0009277117808111004 + 0.0026770024211992104i, 0.0006020071504479359 + 0.0003693075178727551i, -0.0030196658330076116 + 0.006647432081848025i }, { -0.007910270293103113 + -0.01741351110698562i, -0.0006020071504479361 + 0.00036930751787275497i, 0.0019498209186445286 + -0.0030793697892520684i, 0.0012875718259730208 + -0.0001860479812618211i, 0.20608627331179624 + 2.0328790734103208e-20i, -0.0009402270788697019 + -0.007551771705642368i, 0.021520602962344246 + 0.03285179591507209i, -0.00391284505958941 + 0.01346076708824261i }, { 0.0006741851777491692 + -0.00021041624949394986i, -0.002664699154768209 + -0.0058660155227298165i, -0.001521809964850517 + -0.0003335007039562974i, -0.0009277117808111004 + -0.00267700242119921i, -0.0009402270788697019 + 0.007551771705642368i, 0.06942340753919356 + 0.0i, 0.010053726981610164 + -0.013443379972536857i, 0.03039691259194198 + 0.0028287879888576973i }, { -0.0036018842372445505 + -0.0005574494194376424i, 0.0007500196209368356 + -0.0013655031515406489i, -0.007065827911762513 + -0.015554572506682055i, 0.0006020071504479359 + -0.00036930751787275497i, 0.021520602962344246 + -0.03285179591507209i, 0.010053726981610164 + 0.013443379972536857i, 0.18408601580495015 + 0.0i, 0.0009402270788697028 + 0.007551771705642366i }, { -0.0009871960509250884 + 0.0008472892159168603i, -0.0014057555657919164 + -0.0024598460115639723i, -0.0006741851777491692 + 0.00021041624949394972i, -0.0030196658330076116 + -0.006647432081848025i, -0.00391284505958941 + -0.01346076708824261i, 0.03039691259194198 + -0.0028287879888576973i, 0.0009402270788697027 + -0.007551771705642366i, 0.07867135446864398 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.17678366621213865, 1.0e-7), DoubleNear(0.059552362748342094, 1.0e-7), DoubleNear(0.15791153990711723, 1.0e-7), DoubleNear(0.06748538000781794, 1.0e-7), DoubleNear(0.20608627331179624, 1.0e-7), DoubleNear(0.06942340753919356, 1.0e-7), DoubleNear(0.18408601580495015, 1.0e-7), DoubleNear(0.07867135446864398, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, true, false}), Matrix({ { 0.3828699395239349 + 2.0328790734103208e-20i, -0.0017467669197015045 + -0.01402978631120871i, 0.03998127494035153 + 0.06103252251170843i, -0.007269337871256337 + 0.025007599963845942i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001746766919701505 + 0.01402978631120871i, 0.12897577028753565 + 0.0i, 0.01867795355596304 + -0.024975297938913472i, 0.05647180619440609 + 0.005255361595972857i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03998127494035153 + -0.06103252251170843i, 0.01867795355596304 + 0.024975297938913472i, 0.34199755571206736 + -6.776263578034403e-21i, 0.0017467669197015062 + 0.014029786311208707i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007269337871256337 + -0.025007599963845942i, 0.05647180619440609 + -0.005255361595972857i, 0.0017467669197015062 + -0.014029786311208707i, 0.14615673447646194 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3828699395239349, 1.0e-7), DoubleNear(0.12897577028753565, 1.0e-7), DoubleNear(0.34199755571206736, 1.0e-7), DoubleNear(0.14615673447646194, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false, true}), Matrix({ { 0.18811618715888195 + 6.776263578034403e-21i, -0.0008582421832283078 + -0.006893280550570536i, 0.01964407289034429 + 0.02998722083501016i, -0.00357165706247596 + 0.012287029796705167i, -0.04502961645713928 + -0.0325372628158386i, -0.000986848433422272 + 0.0017984982361631575i, 0.0004844719579610243 + -0.010575790660387791i, 0.002980161749119799 + -0.0023233954568944327i }, { -0.0008582421832283078 + 0.006893280550570536i, 0.063369900944794 + 0.0i, 0.009177073058405505 + -0.012271158783756585i, 0.02774639575119451 + 0.002582126418190185i, 0.0013977255293466974 + -0.001501608830768678i, -0.015168935632641286 + -0.010960689522762683i, -0.004319192360277209 + 0.0013500631677231597i, -0.006195076832317612 + -0.00541720491146856i }, { 0.01964407289034429 + -0.02998722083501016i, 0.009177073058405505 + 0.012271158783756585i, 0.16803428411801324 + 0.0i, 0.0008582421832283084 + 0.006893280550570535i, -0.00988892652689391 + 0.003780369468198866i, -7.426347422921379e-05 + -0.00452466331767515i, -0.040222585199929994 + -0.029063823517757006i, 0.000986848433422272 + -0.0017984982361631578i }, { -0.00357165706247596 + -0.012287029796705167i, 0.02774639575119451 + -0.002582126418190185i, 0.0008582421832283083 + -0.006893280550570535i, 0.07181145548144119 + 0.0i, -0.0012702573536635087 + 0.0035589291585388784i, -0.007088304865069681 + -0.004181030991392793i, -0.0013977255293466978 + 0.001501608830768678i, -0.017189601524440375 + -0.012420771627771242i }, { -0.04502961645713928 + 0.0325372628158386i, 0.0013977255293466974 + 0.001501608830768678i, -0.00988892652689391 + -0.0037803694681988664i, -0.0012702573536635085 + -0.0035589291585388784i, 0.19475375236505293 + 1.3552527156068805e-20i, -0.0008885247364731966 + -0.0071365057606381736i, 0.020337202050007244 + 0.03104530167669827i, -0.003697680808780377 + 0.012720570167140776i }, { -0.0009868484334222723 + -0.001798498236163158i, -0.015168935632641286 + 0.010960689522762683i, -7.426347422921439e-05 + 0.004524663317675151i, -0.007088304865069681 + 0.004181030991392793i, -0.000888524736473197 + 0.0071365057606381736i, 0.06560586934274165 + 0.0i, 0.009500880497557535 + -0.012704139155156887i, 0.02872541044321158 + 0.002673235177782672i }, { 0.0004844719579610236 + 0.010575790660387791i, -0.004319192360277208 + -0.0013500631677231599i, -0.040222585199929994 + 0.029063823517757i, -0.0013977255293466974 + -0.001501608830768678i, 0.02033720205000724 + -0.031045301676698268i, 0.009500880497557535 + 0.012704139155156887i, 0.17396327159405411 + -6.776263578034403e-21i, 0.0008885247364731979 + 0.007136505760638172i }, { 0.0029801617491197986 + 0.0023233954568944327i, -0.006195076832317612 + 0.005417204911468559i, 0.0009868484334222718 + 0.0017984982361631575i, -0.01718960152444038 + 0.012420771627771238i, -0.003697680808780377 + -0.012720570167140776i, 0.028725410443211575 + -0.002673235177782672i, 0.0008885247364731978 + -0.007136505760638173i, 0.07434527899502073 + -3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.18811618715888195, 1.0e-7), DoubleNear(0.063369900944794, 1.0e-7), DoubleNear(0.16803428411801324, 1.0e-7), DoubleNear(0.07181145548144119, 1.0e-7), DoubleNear(0.19475375236505293, 1.0e-7), DoubleNear(0.06560586934274165, 1.0e-7), DoubleNear(0.17396327159405411, 1.0e-7), DoubleNear(0.07434527899502073, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false, false, false}), Matrix({ { 0.15586434700498747 + 1.3552527156068805e-20i, -0.0031150038920651738 + -0.0008876275945426193i, 0.047479828431920675 + 0.05012210215927112i, -0.0006634621154487457 + -0.001272099444259663i, 0.021596076897414086 + -0.04053499164970784i, -0.0017286953127391151 + 0.0008916780081487776i, 0.01961370305093455 + -0.005403119396502228i, -0.0008133414441050496 + -0.0002842800491283905i }, { -0.003115003892065174 + 0.0008876275945426199i, 0.05898969652320524 + -1.6940658945086007e-21i, -0.001234340085015829 + -0.0007313162990420662i, 0.017969604492573468 + 0.018969621034538982i, 0.003900905614585619 + 0.0072841884131295675i, 0.0072033372247175395 + -0.015237215503757985i, -0.0011541093902306071 + 0.0034733639620085008i, 0.007094210503660993 + -0.002325188412857888i }, { 0.047479828431920675 + -0.05012210215927112i, -0.0012343400850158288 + 0.0007313162990420662i, 0.16131568701647903 + 0.0i, -0.0032239508429174005 + -0.0009186722812488056i, -0.006456389712830675 + -0.019292643117498242i, -0.00023985844973972107 + 0.0008275308907344698i, 0.022351397535804562 + -0.04195269894513222i, -0.0017891562591139203 + 0.0009228643576673943i }, { -0.0006634621154487457 + 0.001272099444259663i, 0.017969604492573468 + -0.018969621034538985i, -0.0032239508429174005 + 0.0009186722812488056i, 0.06105285528338278 + -1.6940658945086007e-21i, 0.0035307187029904354 + 0.0009644952760648416i, -0.002705609490808292 + -0.006958017038552769i, 0.004037339399902553 + 0.007538952177330662i, 0.007455273226657179 + -0.01577013559828542i }, { 0.021596076897414086 + 0.040534991649707836i, 0.0039009056145856186 + -0.0072841884131295675i, -0.006456389712830674 + 0.019292643117498242i, 0.0035307187029904354 + -0.0009644952760648417i, 0.20034028976749582 + 1.3552527156068805e-20i, 0.0031150038920651746 + 0.0008876275945426187i, 0.061028213115714006 + 0.06442446052157835i, 0.0006634621154487461 + 0.001272099444259663i }, { -0.0017286953127391151 + -0.0008916780081487776i, 0.0072033372247175395 + 0.015237215503757985i, -0.0002398584497397211 + -0.00082753089073447i, -0.002705609490808292 + 0.006958017038552767i, 0.0031150038920651746 + -0.0008876275945426186i, 0.07621221909291068 + -6.776263578034403e-21i, 0.0012343400850158288 + 0.0007313162990420666i, 0.023215976947130568 + 0.024507956467025714i }, { 0.01961370305093455 + 0.005403119396502228i, -0.0011541093902306071 + -0.0034733639620085008i, 0.022351397535804562 + 0.04195269894513222i, 0.004037339399902553 + -0.007538952177330662i, 0.061028213115714006 + -0.06442446052157835i, 0.0012343400850158286 + -0.0007313162990420666i, 0.20734717144703996 + -1.3552527156068805e-20i, 0.003223950842917401 + 0.000918672281248805i }, { -0.0008133414441050496 + 0.0002842800491283906i, 0.007094210503660993 + 0.0023251884128578874i, -0.0017891562591139205 + -0.0009228643576673942i, 0.007455273226657179 + 0.015770135598285422i, 0.0006634621154487461 + -0.001272099444259663i, 0.023215976947130568 + -0.02450795646702571i, 0.0032239508429174014 + -0.0009186722812488052i, 0.0788777338644989 + 6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.15586434700498747, 1.0e-7), DoubleNear(0.05898969652320524, 1.0e-7), DoubleNear(0.16131568701647903, 1.0e-7), DoubleNear(0.06105285528338278, 1.0e-7), DoubleNear(0.20034028976749582, 1.0e-7), DoubleNear(0.07621221909291068, 1.0e-7), DoubleNear(0.20734717144703996, 1.0e-7), DoubleNear(0.0788777338644989, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false, false, false}), Matrix({ { 0.3562046367724833 + 2.710505431213761e-20i, 7.589415207398531e-19 + -7.047314121155779e-19i, 0.10850804154763467 + 0.11454656268084948i, 5.421010862427522e-19 + -1.0842021724855044e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.336808689942018e-19 + 1.3010426069826053e-18i, 0.13520191561611591 + -8.470329472543003e-21i, -2.168404344971009e-19 + 4.336808689942018e-19i, 0.041185581439704036 + 0.043477577501564696i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.10850804154763467 + -0.11454656268084948i, -5.421010862427522e-20 + -3.5236570605778894e-19i, 0.368662858463519 + -1.3552527156068805e-20i, 7.589415207398531e-19 + -5.963111948670274e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.336808689942018e-19 + -1.0842021724855044e-19i, 0.04118558143970403 + -0.043477577501564696i, 7.589415207398531e-19 + 4.336808689942018e-19i, 0.13993058914788165 + 5.082197683525802e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3562046367724833, 1.0e-7), DoubleNear(0.13520191561611591, 1.0e-7), DoubleNear(0.368662858463519, 1.0e-7), DoubleNear(0.13993058914788165, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true, false, false}), Matrix({ { 0.16447141734005516 + 0.0i, 4.336808689942018e-19 + 5.421010862427522e-20i, 0.050101738000485514 + 0.0528899221701713i, 2.439454888092385e-19 + -1.0842021724855044e-19i, -0.007359352787086109 + 0.016200732307451504i, 1.3552527156068805e-20 + 4.0657581468206416e-20i, -0.007451579465012289 + 0.0025685268369681417i, -6.776263578034403e-21 + 1.0164395367051604e-20i }, { 2.168404344971009e-19 + 3.2526065174565133e-19i, 0.062427179191034354 + -8.470329472543003e-21i, -5.421010862427522e-20 + 1.8973538018496328e-19i, 0.019016739969303142 + 0.02007503006975691i, -1.0842021724855044e-19 + 4.0657581468206416e-20i, -0.002793334201161378 + 0.006149190145860973i, -3.3881317890172014e-20 + 1.3552527156068805e-20i, -0.002828339987833646 + 0.000974916418315199i }, { 0.050101738000485514 + -0.0528899221701713i, 0.0 + -1.6263032587282567e-19i, 0.17022378877920072 + -6.776263578034403e-21i, 4.336808689942018e-19 + -2.710505431213761e-19i, 0.0029679266680112575 + 0.007301696921190716i, 3.049318610115481e-20 + 6.776263578034403e-21i, -0.007616745417779518 + 0.016767351306216167i, 6.776263578034403e-21 + 3.3881317890172014e-20i }, { 1.0842021724855044e-19 + -1.6263032587282567e-19i, 0.019016739969303142 + -0.02007503006975691i, 3.2526065174565133e-19 + -1.0842021724855044e-19i, 0.06461056356512568 + 5.082197683525802e-21i, -2.0328790734103208e-20 + 2.371692252312041e-20i, 0.001126513609028562 + 0.0027714501976677857i, -1.4907779871675686e-19 + 5.421010862427522e-20i, -0.002891030786614442 + 0.006364257458716869i }, { -0.007359352787086109 + -0.016200732307451504i, -9.486769009248164e-20 + -2.710505431213761e-20i, 0.002967926668011257 + -0.007301696921190716i, 3.3881317890172014e-21 + -1.0164395367051604e-20i, 0.19173321943242816 + 2.710505431213761e-20i, 3.2526065174565133e-19 + -7.589415207398531e-19i, 0.058406303547149166 + 0.06165664051067818i, 2.981555974335137e-19 + 0.0i }, { 2.710505431213761e-20 + -4.743384504624082e-20i, -0.002793334201161378 + -0.006149190145860973i, 2.710505431213761e-20 + -1.6940658945086007e-20i, 0.001126513609028562 + -0.0027714501976677857i, 2.168404344971009e-19 + 9.75781955236954e-19i, 0.07277473642508156 + 0.0i, -1.6263032587282567e-19 + 2.439454888092385e-19i, 0.02216884147040089 + 0.023402547431807787i }, { -0.007451579465012289 + -0.0025685268369681417i, -2.0328790734103208e-20 + -1.6940658945086007e-20i, -0.007616745417779518 + -0.016767351306216167i, -1.1519648082658485e-19 + -4.0657581468206416e-20i, 0.058406303547149166 + -0.06165664051067818i, -5.421010862427522e-20 + -1.8973538018496328e-19i, 0.19843906968431824 + -6.776263578034403e-21i, 3.2526065174565133e-19 + -3.2526065174565133e-19i }, { -3.3881317890172014e-21 + -6.776263578034403e-21i, -0.002828339987833646 + -0.000974916418315199i, 1.3552527156068805e-20 + -2.0328790734103208e-20i, -0.0028910307866144426 + -0.006364257458716869i, 3.2526065174565133e-19 + 5.421010862427522e-20i, 0.022168841470400887 + -0.023402547431807787i, 4.336808689942018e-19 + 5.421010862427522e-19i, 0.07532002558275598 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.16447141734005516, 1.0e-7), DoubleNear(0.062427179191034354, 1.0e-7), DoubleNear(0.17022378877920072, 1.0e-7), DoubleNear(0.06461056356512568, 1.0e-7), DoubleNear(0.19173321943242816, 1.0e-7), DoubleNear(0.07277473642508156, 1.0e-7), DoubleNear(0.19843906968431824, 1.0e-7), DoubleNear(0.07532002558275598, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, true, false}), Matrix({ { 0.3562046367724833 + 2.710505431213761e-20i, 7.589415207398531e-19 + -7.047314121155779e-19i, 0.10850804154763467 + 0.11454656268084948i, 5.421010862427522e-19 + -1.0842021724855044e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.336808689942018e-19 + 1.3010426069826053e-18i, 0.13520191561611591 + -8.470329472543003e-21i, -2.168404344971009e-19 + 4.336808689942018e-19i, 0.041185581439704036 + 0.043477577501564696i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.10850804154763467 + -0.11454656268084948i, -5.421010862427522e-20 + -3.5236570605778894e-19i, 0.368662858463519 + -1.3552527156068805e-20i, 7.589415207398531e-19 + -5.963111948670274e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.336808689942018e-19 + -1.0842021724855044e-19i, 0.04118558143970403 + -0.043477577501564696i, 7.589415207398531e-19 + 4.336808689942018e-19i, 0.13993058914788165 + 5.082197683525802e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3562046367724833, 1.0e-7), DoubleNear(0.13520191561611591, 1.0e-7), DoubleNear(0.368662858463519, 1.0e-7), DoubleNear(0.13993058914788165, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false, true}), Matrix({ { 0.17501467522175396 + 2.710505431213761e-20i, 3.2526065174565133e-19 + -3.2526065174565133e-19i, 0.053313454374086564 + 0.05628037199909297i, 1.8973538018496328e-19 + -1.0842021724855044e-19i, -0.04189349049983804 + -0.030271177458584677i, -2.710505431213761e-20 + -2.710505431213761e-20i, -0.003027252231524791 + -0.022693195658747924i, -1.3552527156068805e-20 + 0.0i }, { 2.168404344971009e-19 + 4.87890977618477e-19i, 0.06642900430863066 + -1.6940658945086007e-21i, -5.421010862427522e-20 + 8.131516293641283e-20i, 0.02023578700378591 + 0.021361917617948287i, -1.6263032587282567e-19 + -1.3552527156068805e-20i, -0.015901197184699886 + -0.011489803213791847i, -5.421010862427522e-20 + 0.0i, -0.00114903136709233 + -0.008613485642169664i }, { 0.053313454374086564 + -0.05628037199909297i, 5.421010862427522e-20 + -1.0842021724855044e-19i, 0.18113579605514127 + -2.0328790734103208e-20i, 2.168404344971009e-19 + -3.2526065174565133e-19i, -0.02249616963586301 + 0.0042506160722843925i, 0.0 + 1.3552527156068805e-20i, -0.04335871115723123 + -0.03132990887501093i, -8.131516293641283e-20 + -2.710505431213761e-20i }, { 1.0842021724855044e-19 + -5.421010862427522e-20i, 0.020235787003785907 + -0.021361917617948287i, 2.168404344971009e-19 + 3.2526065174565133e-19i, 0.06875235211760453 + 1.6940658945086007e-21i, 0.0 + 2.0328790734103208e-20i, -0.008538701956135618 + 0.0016133743814473983i, -1.6263032587282567e-19 + -8.131516293641283e-20i, -0.016457339972381774 + -0.011891657936742076i }, { -0.04189349049983804 + 0.030271177458584674i, -1.0842021724855044e-19 + 2.710505431213761e-20i, -0.02249616963586301 + -0.004250616072284395i, 2.710505431213761e-20 + 0.0i, 0.18118996155072936 + 0.0i, 4.336808689942018e-19 + -3.7947076036992655e-19i, 0.05519458717354811 + 0.05826619068175651i, 3.5236570605778894e-19 + 0.0i }, { -8.131516293641283e-20 + -2.710505431213761e-20i, -0.015901197184699886 + 0.011489803213791845i, 1.3552527156068805e-20 + 0.0i, -0.00853870195613562 + -0.001613374381447399i, 2.168404344971009e-19 + 8.131516293641283e-19i, 0.06877291130748525 + -6.776263578034403e-21i, -1.6263032587282567e-19 + 3.5236570605778894e-19i, 0.020949794435918122 + 0.02211565988361641i }, { -0.0030272522315247926 + 0.022693195658747924i, -3.3881317890172014e-20 + 2.710505431213761e-20i, -0.04335871115723123 + 0.03132990887501093i, 0.0 + 8.131516293641283e-20i, 0.05519458717354811 + -0.05826619068175651i, -1.0842021724855044e-19 + -2.439454888092385e-19i, 0.1875270624083777 + 6.776263578034403e-21i, 5.421010862427522e-19 + -2.710505431213761e-19i }, { -4.743384504624082e-20 + 1.3552527156068805e-20i, -0.0011490313670923305 + 0.008613485642169664i, -1.0842021724855044e-19 + -2.710505431213761e-20i, -0.016457339972381774 + 0.011891657936742076i, 3.2526065174565133e-19 + -5.421010862427522e-20i, 0.020949794435918122 + -0.02211565988361641i, 5.421010862427522e-19 + 1.0842021724855044e-19i, 0.07117823703027713 + 3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17501467522175396, 1.0e-7), DoubleNear(0.06642900430863066, 1.0e-7), DoubleNear(0.18113579605514127, 1.0e-7), DoubleNear(0.06875235211760453, 1.0e-7), DoubleNear(0.18118996155072936, 1.0e-7), DoubleNear(0.06877291130748525, 1.0e-7), DoubleNear(0.1875270624083777, 1.0e-7), DoubleNear(0.07117823703027713, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false, false, false}), Matrix({ { 0.3171800340214665 + 1.3552527156068805e-20i, -0.006338954734982574 + -0.001806299875791425i, 0.04394747443321864 + -0.08248769059484007i, -0.003517851571853035 + 0.0018145423658161718i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006338954734982575 + 0.0018062998757914254i, 0.12004255180658802 + -3.3881317890172014e-21i, 0.007938245014488171 + 0.01482314059046023i, 0.014658610451374721 + -0.031007351102043404i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04394747443321864 + 0.08248769059484005i, 0.007938245014488171 + -0.01482314059046023i, 0.4076874612145358 + 0.0i, 0.006338954734982576 + 0.0018062998757914237i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0035178515718530356 + -0.0018145423658161718i, 0.01465861045137472 + 0.031007351102043407i, 0.006338954734982576 + -0.001806299875791424i, 0.15508995295740957 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3171800340214665, 1.0e-7), DoubleNear(0.12004255180658802, 1.0e-7), DoubleNear(0.4076874612145358, 1.0e-7), DoubleNear(0.15508995295740957, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true, false, false}), Matrix({ { 0.1464524724331365 + -6.776263578034403e-21i, -0.0029269042625712847 + -0.0008340281682024718i, 0.020291996965676996 + -0.03808728462427841i, -0.0016243079799777192 + 0.0008378339974276748i, -0.006553086418341271 + 0.014425833619151507i, 0.00021311902517224849 + -0.00025098637557149364i, 0.0028436912969731307 + 0.0037030323257781707i, -9.847722340251753e-06 + -0.00019748656184682148i }, { -0.002926904262571285 + 0.0008340281682024719i, 0.055427601436185775 + -3.3881317890172014e-21i, 0.003665349279435193 + 0.006844332416428076i, 0.0067683634301292425 + -0.01431711566116188i, 4.881245679160689e-05 + -0.0003256243597688168i, -0.0024801347231507664 + 0.005459719067509188i, -0.0008381869504534617 + 5.479058787597274e-05i, 0.0011074081254567904 + 0.0013073222850053775i }, { 0.020291996965676996 + 0.03808728462427841i, 0.003665349279435193 + -0.006844332416428077i, 0.18824273368611938 + 0.0i, 0.0029269042625712856 + 0.0008340281682024716i, -0.0046596416528472615 + 0.0002945645350167915i, 0.0005101713125814568 + 0.0006672964890130787i, -0.008423011786524357 + 0.018542249994516168i, -0.00021311902517224849 + 0.0002509863755714937i }, { -0.0016243079799777194 + -0.0008378339974276747i, 0.006768363430129242 + 0.01431711566116188i, 0.0029269042625712856 + -0.0008340281682024717i, 0.07161014131997426 + 0.0i, 0.0001552086081751428 + -0.0001225079903259544i, -0.0017131154888285836 + 2.6069812715221385e-05i, -4.881245679160716e-05 + 0.0003256243597688169i, -0.003204230264625054 + 0.007053728537068654i }, { -0.00655308641834127 + -0.014425833619151503i, 4.881245679160695e-05 + 0.0003256243597688168i, -0.004659641652847261 + -0.0002945645350167914i, 0.0001552086081751428 + 0.00012250799032595438i, 0.17072756158833 + 2.0328790734103208e-20i, -0.003412050472411289 + -0.0009722717075889532i, 0.023655477467541652 + -0.04440040597056165i, -0.0018935435918753163 + 0.000976708368388497i }, { 0.00021311902517224849 + 0.00025098637557149364i, -0.002480134723150766 + -0.005459719067509188i, 0.0005101713125814568 + -0.0006672964890130787i, -0.0017131154888285836 + -2.606981271522133e-05i, -0.0034120504724112896 + 0.0009722717075889536i, 0.06461495037040224 + 0.0i, 0.004272895735052979 + 0.007978808174032154i, 0.007890247021245477 + -0.016690235440881523i }, { 0.0028436912969731307 + -0.0037030323257781707i, -0.0008381869504534618 + -5.479058787597274e-05i, -0.008423011786524357 + -0.018542249994516168i, -4.881245679160716e-05 + -0.0003256243597688169i, 0.023655477467541652 + 0.04440040597056164i, 0.004272895735052979 + -0.007978808174032154i, 0.21944472752841637 + 0.0i, 0.00341205047241129 + 0.0009722717075889521i }, { -9.84772234025173e-06 + 0.0001974865618468215i, 0.0011074081254567902 + -0.0013073222850053775i, -0.00021311902517224846 + -0.00025098637557149364i, -0.0032042302646250543 + -0.007053728537068654i, -0.0018935435918753163 + -0.000976708368388497i, 0.007890247021245477 + 0.016690235440881527i, 0.00341205047241129 + -0.0009722717075889521i, 0.08347981163743531 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1464524724331365, 1.0e-7), DoubleNear(0.055427601436185775, 1.0e-7), DoubleNear(0.18824273368611938, 1.0e-7), DoubleNear(0.07161014131997426, 1.0e-7), DoubleNear(0.17072756158833, 1.0e-7), DoubleNear(0.06461495037040224, 1.0e-7), DoubleNear(0.21944472752841637, 1.0e-7), DoubleNear(0.08347981163743531, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, true, false}), Matrix({ { 0.3171800340214665 + 1.3552527156068805e-20i, -0.006338954734982574 + -0.001806299875791425i, 0.04394747443321864 + -0.08248769059484007i, -0.003517851571853035 + 0.0018145423658161718i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006338954734982575 + 0.0018062998757914254i, 0.12004255180658802 + -3.3881317890172014e-21i, 0.007938245014488171 + 0.01482314059046023i, 0.014658610451374721 + -0.031007351102043404i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04394747443321864 + 0.08248769059484005i, 0.007938245014488171 + -0.01482314059046023i, 0.4076874612145358 + 0.0i, 0.006338954734982576 + 0.0018062998757914237i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0035178515718530356 + -0.0018145423658161718i, 0.01465861045137472 + 0.031007351102043407i, 0.006338954734982576 + -0.001806299875791424i, 0.15508995295740957 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3171800340214665, 1.0e-7), DoubleNear(0.12004255180658802, 1.0e-7), DoubleNear(0.4076874612145358, 1.0e-7), DoubleNear(0.15508995295740957, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false, true}), Matrix({ { 0.15584064582670826 + 6.776263578034403e-21i, -0.0031145302156664013 + -0.0008874926193525384i, 0.021592792936209915 + -0.04052882778297309i, -0.0017284324423868826 + 0.0008915424170412221i, -0.037303778138362206 + -0.0269547673022471i, 0.0005920251847257389 + 0.000751140784677143i, -0.012178709019939036 + 0.005966669901103658i, 0.0005679415551690955 + 8.554631999390306e-05i }, { -0.0031145302156664017 + 0.0008874926193525385i, 0.05898072638127862 + 0.0i, 0.003900312431723737 + 0.007283080758611286i, 0.0072022418646621525 + -0.015234898489199664i, 0.0008990331146557831 + 0.0003262602588536658i, -0.014118293207108808 + -0.010201521859019447i, 0.00032608538805101 + -0.0024179728002744526i, -0.004359093692561496 + 0.002401071413045793i }, { 0.021592792936209915 + 0.040528827782973086i, 0.003900312431723737 + -0.007283080758611286i, 0.200309825450187 + 0.0i, 0.003114530215666402 + 0.0008874926193525377i, 0.001841319145725326 + -0.013436206566760802i, -0.002193331110134419 + 0.0010687482325056614i, -0.04794842351870707 + -0.0346463190313485i, -0.000592025184725739 + -0.0007511407846771431i }, { -0.0017284324423868826 + -0.0008915424170412219i, 0.007202241864662152 + 0.015234898489199664i, 0.003114530215666402 + -0.0008874926193525377i, 0.07620063004495657 + 0.0i, 0.00025953268963922017 + 0.0005123656565003377i, 0.0009110736822114649 + -0.004892523530516413i, -0.0008990331146557834 + -0.0003262602588536659i, -0.018240243949972854 + -0.013179939291514476i }, { -0.037303778138362206 + 0.026954767302247093i, 0.0008990331146557831 + -0.00032626025885366564i, 0.0018413191457253252 + 0.0134362065667608i, 0.0002595326896392203 + -0.0005123656565003377i, 0.16133938819475824 + 6.776263578034403e-21i, -0.0032244245193161726 + -0.0009188072564388866i, 0.02235468149700873 + -0.04195886281186697i, -0.0017894191294661529 + 0.0009229999487749497i }, { 0.0005920251847257389 + -0.000751140784677143i, -0.014118293207108808 + 0.010201521859019447i, -0.0021933311101344187 + -0.0010687482325056619i, 0.0009110736822114646 + 0.004892523530516412i, -0.003224424519316173 + 0.000918807256438887i, 0.0610618254253094 + -3.3881317890172014e-21i, 0.004037932582764435 + 0.007540059831848944i, 0.007456368586712568 + -0.01577245261284374i }, { -0.012178709019939036 + -0.005966669901103658i, 0.00032608538805100983 + 0.0024179728002744526i, -0.04794842351870707 + 0.0346463190313485i, -0.0008990331146557832 + 0.00032626025885366575i, 0.02235468149700873 + 0.04195886281186697i, 0.004037932582764435 + -0.007540059831848944i, 0.2073776357643488 + 0.0i, 0.0032244245193161734 + 0.000918807256438886i }, { 0.0005679415551690953 + -8.554631999390304e-05i, -0.004359093692561496 + -0.002401071413045793i, -0.0005920251847257391 + 0.0007511407846771429i, -0.018240243949972854 + 0.013179939291514474i, -0.001789419129466153 + -0.0009229999487749497i, 0.007456368586712568 + 0.015772452612843744i, 0.0032244245193161734 + -0.0009188072564388862i, 0.078889322912453 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.15584064582670826, 1.0e-7), DoubleNear(0.05898072638127862, 1.0e-7), DoubleNear(0.200309825450187, 1.0e-7), DoubleNear(0.07620063004495657, 1.0e-7), DoubleNear(0.16133938819475824, 1.0e-7), DoubleNear(0.0610618254253094, 1.0e-7), DoubleNear(0.2073776357643488, 1.0e-7), DoubleNear(0.078889322912453, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true, false, false}), Matrix({ { 0.33469520611925585 + -6.776263578034403e-21i, 8.673617379884035e-19 + -2.168404344971009e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014976098204865628 + 0.032968083613667674i, 6.776263578034403e-21 + 6.776263578034403e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.336808689942018e-19 + 2.168404344971009e-19i, 0.12703774275616003 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, -2.642742795433417e-19 + 1.0842021724855044e-19i, -0.00568436498777582 + 0.012513447604577843i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014976098204865628 + -0.03296808361366767i, -2.1006417091906648e-19 + -5.421010862427522e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3901722891167464 + 2.0328790734103208e-20i, 8.673617379884035e-19 + -1.0842021724855044e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.0657581468206416e-20 + -5.421010862427522e-20i, -0.00568436498777582 + -0.012513447604577843i, 0.0 + 0.0i, 0.0 + 0.0i, 4.336808689942018e-19 + 1.5178830414797062e-18i, 0.14809476200783755 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.33469520611925585, 1.0e-7), DoubleNear(0.12703774275616003, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3901722891167464, 1.0e-7), DoubleNear(0.14809476200783755, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, true, false}), Matrix({ { 0.7248674952360022 + 1.3552527156068805e-20i, 1.734723475976807e-18 + -1.3010426069826053e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 8.673617379884035e-19 + 1.734723475976807e-18i, 0.2751325047639976 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.7248674952360022, 1.0e-7), DoubleNear(0.2751325047639976, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false, true}), Matrix({ { 0.3561504712768952 + 6.776263578034403e-21i, 6.505213034913027e-19 + -6.505213034913027e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08525220165706927 + -0.0616010863335956i, -1.0842021724855044e-19 + -1.0842021724855044e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 2.168404344971009e-19 + 8.131516293641283e-19i, 0.1351813564262352 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -2.710505431213761e-19 + -1.0842021724855044e-19i, -0.03235853715708166 + -0.023381461150533925i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08525220165706927 + 0.0616010863335956i, -1.0842021724855044e-19 + 1.0842021724855044e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36871702395910705 + 6.776263578034403e-21i, 1.0842021724855044e-18 + -6.505213034913027e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.168404344971009e-19 + -5.421010862427522e-20i, -0.03235853715708166 + 0.02338146115053392i, 0.0 + 0.0i, 0.0 + 0.0i, 6.505213034913027e-19 + 9.215718466126788e-19i, 0.1399511483377624 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.3561504712768952, 1.0e-7), DoubleNear(0.1351813564262352, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36871702395910705, 1.0e-7), DoubleNear(0.1399511483377624, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, true, false}), Matrix({ { 0.33469520611925585 + -6.776263578034403e-21i, 8.673617379884035e-19 + -2.168404344971009e-19i, -0.014976098204865628 + 0.032968083613667674i, 6.776263578034403e-21 + 6.776263578034403e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.336808689942018e-19 + 2.168404344971009e-19i, 0.12703774275616003 + -3.3881317890172014e-21i, -2.642742795433417e-19 + 1.0842021724855044e-19i, -0.00568436498777582 + 0.012513447604577843i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014976098204865628 + -0.03296808361366767i, -2.1006417091906648e-19 + -5.421010862427522e-20i, 0.3901722891167464 + 2.0328790734103208e-20i, 8.673617379884035e-19 + -1.0842021724855044e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.0657581468206416e-20 + -5.421010862427522e-20i, -0.00568436498777582 + -0.012513447604577843i, 4.336808689942018e-19 + 1.5178830414797062e-18i, 0.14809476200783755 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.33469520611925585, 1.0e-7), DoubleNear(0.12703774275616003, 1.0e-7), DoubleNear(0.3901722891167464, 1.0e-7), DoubleNear(0.14809476200783755, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false, true}), Matrix({ { 0.1591478283262529 + 0.0i, 2.168404344971009e-19 + 0.0i, -0.0003025209894925954 + 0.01522699544943931i, 8.809142651444724e-20 + 2.710505431213761e-20i, -0.03650269516001495 + -0.028770686332933032i, 0.0 + -1.0842021724855044e-19i, 0.0004903138587788804 + -0.00020013299968614894i, -1.1011428314305904e-20 + 1.3552527156068805e-20i }, { 2.168404344971009e-19 + 1.6263032587282567e-19i, 0.06040654453804217 + 0.0i, -8.809142651444724e-20 + 5.421010862427522e-20i, -0.0001148256172746184 + 0.00577959616835934i, -1.6263032587282567e-19 + -5.421010862427522e-20i, -0.013855053531875838 + -0.010920273079677783i, 1.1858461261560205e-20 + -1.0164395367051604e-20i, 0.00018610474462289587 + -7.59629778566012e-05i }, { -0.0003025209894925954 + -0.015226995449439309i, -4.743384504624082e-20 + -5.421010862427522e-20i, 0.1970026429506423 + 6.776263578034403e-21i, 4.336808689942018e-19 + -6.505213034913027e-19i, -0.006311390982892852 + 0.0062396126258677485i, -1.3552527156068805e-20 + 4.0657581468206416e-20i, -0.048749506497054326 + -0.03283040000066257i, -1.0842021724855044e-19 + 0.0i }, { 6.776263578034403e-20 + 0.0i, -0.0001148256172746185 + -0.00577959616835934i, 0.0 + 6.505213034913027e-19i, 0.07477481188819302 + 0.0i, -2.710505431213761e-20 + 0.0i, -0.0023955672189478706 + 0.0023683228476856022i, -1.0842021724855044e-19 + -5.421010862427522e-20i, -0.018503483625205826 + -0.01246118807085614i }, { -0.03650269516001495 + 0.028770686332933032i, -1.0842021724855044e-19 + 1.0842021724855044e-19i, -0.006311390982892852 + -0.006239612625867749i, -1.3552527156068805e-20 + 0.0i, 0.17554737779300297 + -6.776263578034403e-21i, 6.505213034913027e-19 + -2.168404344971009e-19i, -0.014673577215373032 + 0.017741088164228366i, -8.131516293641283e-20 + 4.0657581468206416e-20i }, { -1.0842021724855044e-19 + -1.6263032587282567e-19i, -0.013855053531875838 + 0.010920273079677783i, -4.0657581468206416e-20 + -4.0657581468206416e-20i, -0.0023955672189478706 + -0.0023683228476856022i, 2.168404344971009e-19 + 5.421010862427522e-20i, 0.06663119821811786 + -3.3881317890172014e-21i, -1.7618285302889447e-19 + 5.421010862427522e-20i, -0.005569539370501202 + 0.006733851436218502i }, { 0.0004903138587788803 + 0.00020013299968614867i, 1.3552527156068805e-20 + 2.371692252312041e-20i, -0.048749506497054326 + 0.03283040000066257i, 0.0 + 0.0i, -0.014673577215373032 + -0.017741088164228362i, -1.6263032587282567e-19 + 0.0i, 0.19316964616610408 + 1.3552527156068805e-20i, 4.336808689942018e-19 + -4.336808689942018e-19i }, { -2.371692252312041e-20 + -4.404571325722362e-20i, 0.00018610474462289593 + 7.596297785660109e-05i, -1.0842021724855044e-19 + 1.0842021724855044e-19i, -0.018503483625205826 + 0.012461188070856138i, -2.710505431213761e-20 + -5.421010862427522e-20i, -0.005569539370501202 + -0.006733851436218502i, 4.336808689942018e-19 + 8.673617379884035e-19i, 0.07331995011964454 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1591478283262529, 1.0e-7), DoubleNear(0.06040654453804217, 1.0e-7), DoubleNear(0.1970026429506423, 1.0e-7), DoubleNear(0.07477481188819302, 1.0e-7), DoubleNear(0.17554737779300297, 1.0e-7), DoubleNear(0.06663119821811786, 1.0e-7), DoubleNear(0.19316964616610408, 1.0e-7), DoubleNear(0.07331995011964454, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true, true}), Matrix({ { 0.3561504712768952 + 6.776263578034403e-21i, 6.505213034913027e-19 + -6.505213034913027e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08525220165706927 + -0.0616010863335956i, -1.0842021724855044e-19 + -1.0842021724855044e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 2.168404344971009e-19 + 8.131516293641283e-19i, 0.1351813564262352 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -2.710505431213761e-19 + -1.0842021724855044e-19i, -0.03235853715708166 + -0.023381461150533925i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08525220165706927 + 0.0616010863335956i, -1.0842021724855044e-19 + 1.0842021724855044e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36871702395910705 + 6.776263578034403e-21i, 1.0842021724855044e-18 + -6.505213034913027e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.168404344971009e-19 + -5.421010862427522e-20i, -0.03235853715708166 + 0.02338146115053392i, 0.0 + 0.0i, 0.0 + 0.0i, 6.505213034913027e-19 + 9.215718466126788e-19i, 0.1399511483377624 + -3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3561504712768952, 1.0e-7), DoubleNear(0.1351813564262352, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36871702395910705, 1.0e-7), DoubleNear(0.1399511483377624, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false, false, false}), Matrix({ { 0.10667636618596713 + 6.776263578034403e-21i, -0.010868351970659922 + -0.013425697202032839i, -0.0036222404708893628 + 0.005554392703482207i, 0.0010680845534192514 + -0.00011001491285465576i, 0.019842405598811928 + 0.012816438191076942i, 0.0008059624537556646 + -0.004872213778253997i, -0.0013410795707417518 + 0.0005979608609652436i, 0.00022631815935350363 + 0.00020740265809455306i }, { -0.010868351970659922 + 0.013425697202032839i, 0.14176096075368233 + 0.0i, -0.00033000571238776463 + -0.0010217652000800688i, -0.004813552500832136 + 0.007381166740121483i, -0.005776183385740525 + 0.001355531252961494i, 0.02697354927367982 + 0.019358071471734243i, 0.00012555332361966536 + -0.000346780194511642i, -0.0019238283051465248 + 0.0007471392042968269i }, { -0.003622240470889362 + -0.0055543927034822065i, -0.0003300057123877648 + 0.0010217652000800688i, 0.11310477959905658 + 0.0i, -0.011523288598933994 + -0.014234741745443421i, -6.434731995586798e-06 + -0.0014683358609430342i, -0.0002810517413527581 + 0.00012347344054664672i, 0.021038126739865787 + 0.01358876824056441i, 0.000854530473396842 + -0.005165817746249744i }, { 0.0010680845534192514 + 0.00011001491285465555i, -0.004813552500832134 + -0.007381166740121484i, -0.011523288598933994 + 0.014234741745443421i, 0.15030360327276449 + 1.3552527156068805e-20i, 0.0002667121045190067 + 0.00025472493729613335i, 9.203209168487608e-05 + -0.002061761972774828i, -0.006124261372279998 + 0.001437216780880666i, 0.028598999522400075 + 0.020524606204305688i }, { 0.019842405598811928 + -0.012816438191076944i, -0.005776183385740525 + -0.001355531252961494i, -6.434731995587015e-06 + 0.0014683358609430346i, 0.0002667121045190066 + -0.00025472493729613335i, 0.09742022815793865 + 0.0i, -0.01140489555941766 + -0.015493109743963042i, -0.0033079444466808322 + 0.005072446913955786i, 0.0011939485242276743 + -6.77516473713886e-05i }, { 0.0008059624537556646 + 0.004872213778253996i, 0.02697354927367982 + -0.019358071471734243i, -0.00028105174135275814 + -0.00012347344054664677i, 9.203209168487608e-05 + 0.0020617619727748286i, -0.01140489555941766 + 0.015493109743963042i, 0.13951786600569122 + 0.0i, -0.000419432560877896 + -0.0011199016434948156i, -0.004737387283861318 + 0.007264373962612159i }, { -0.0013410795707417518 + -0.0005979608609652438i, 0.00012555332361966542 + 0.000346780194511642i, 0.021038126739865787 + -0.01358876824056441i, -0.006124261372279997 + -0.0014372167808806664i, -0.0033079444466808314 + -0.005072446913955786i, -0.0004194325608778962 + 0.0011199016434948151i, 0.10329085839955171 + -1.0164395367051604e-20i, -0.012092164785116963 + -0.01642673841964304i }, { 0.00022631815935350363 + -0.00020740265809455306i, -0.001923828305146525 + -0.0007471392042968272i, 0.0008545304733968415 + 0.005165817746249744i, 0.028598999522400075 + -0.02052460620430569i, 0.001193948524227674 + 6.775164737138903e-05i, -0.004737387283861317 + -0.007264373962612158i, -0.012092164785116962 + 0.01642673841964304i, 0.14792533762534774 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10667636618596713, 1.0e-7), DoubleNear(0.14176096075368233, 1.0e-7), DoubleNear(0.11310477959905658, 1.0e-7), DoubleNear(0.15030360327276449, 1.0e-7), DoubleNear(0.09742022815793865, 1.0e-7), DoubleNear(0.13951786600569122, 1.0e-7), DoubleNear(0.10329085839955171, 1.0e-7), DoubleNear(0.14792533762534774, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false, false, false}), Matrix({ { 0.10029440378079323 + 1.1858461261560205e-20i, -0.01094521977925331 + -0.014210891220523315i, -0.0034055382777586404 + 0.005222098619191785i, 0.0011115778760754486 + -8.735565249066074e-05i, 0.03055195864671644 + 0.03225218883535469i, 0.0012357064842711193 + -0.007848671774228131i, -0.002716701681685348 + 0.0004956336103355129i, 0.00036670333454307447 + 0.00033084531171310213i }, { -0.01094521977925331 + 0.014210891220523315i, 0.13822225851773384 + -6.776263578034403e-21i, -0.00036827887809354334 + -0.0010524291199661075i, -0.00469339439166732 + 0.007196914664597242i, -0.007904032721213334 + 0.0008092501942069497i, 0.042105646647238634 + 0.04444884475016825i, 0.00022624893118259413 + -0.0004390232077991817i, -0.00374406375636071 + 0.0006830650009905382i }, { -0.0034055382777586395 + -0.005222098619191785i, -0.00036827887809354334 + 0.0010524291199661075i, 0.10633823442082747 + -1.3552527156068805e-20i, -0.01160478853055016 + -0.015067252259056557i, 0.0006418927051187603 + -0.0026859066361438425i, -0.00045062119184361804 + 0.00020216453029398327i, 0.0323930470506683 + 0.03419573463395503i, 0.001310171264260738 + -0.008321639768098753i }, { 0.0011115778760754484 + 8.735565249066095e-05i, -0.004693394391667319 + -0.007196914664597242i, -0.01160478853055016 + 0.015067252259056555i, 0.14655165566924466 + 2.710505431213761e-20i, 0.00031052051887726234 + 0.0003840663526055693i, 0.0008846341977513581 + -0.003701623095810929i, -0.008380336815355133 + 0.0008580163360336811i, 0.044642970642715336 + 0.047127371962936204i }, { 0.03055195864671644 + -0.03225218883535469i, -0.007904032721213334 + -0.0008092501942069499i, 0.0006418927051187598 + 0.0026859066361438434i, 0.00031052051887726245 + -0.0003840663526055692i, 0.10380219056311253 + -5.082197683525802e-21i, -0.011328027750824272 + -0.014707915725472568i, -0.003524646639811558 + 0.005404740998246207i, 0.0011504552015714773 + -9.041090773538368e-05i }, { 0.0012357064842711193 + 0.007848671774228131i, 0.042105646647238634 + -0.04444884475016825i, -0.00045062119184361793 + -0.00020216453029398322i, 0.0008846341977513572 + 0.003701623095810929i, -0.011328027750824272 + 0.014707915725472568i, 0.14305656824163973 + 6.776263578034403e-21i, -0.0003811593951721174 + -0.001089237723608777i, -0.004857545393026132 + 0.007448626038136398i }, { -0.002716701681685348 + -0.0004956336103355129i, 0.000226248931182594 + 0.0004390232077991817i, 0.0323930470506683 + -0.03419573463395503i, -0.008380336815355133 + -0.000858016336033681i, -0.0035246466398115572 + -0.005404740998246207i, -0.00038115939517211763 + 0.0010892377236087767i, 0.11005740357778082 + 3.3881317890172014e-21i, -0.012010664853500795 + -0.015594227906029903i }, { 0.0003667033345430745 + -0.000330845311713102i, -0.00374406375636071 + -0.0006830650009905391i, 0.001310171264260738 + 0.008321639768098753i, 0.044642970642715336 + -0.0471273719629362i, 0.0011504552015714773 + 9.041090773538379e-05i, -0.004857545393026131 + -0.007448626038136398i, -0.012010664853500795 + 0.0155942279060299i, 0.15167728522886756 + -1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10029440378079323, 1.0e-7), DoubleNear(0.13822225851773384, 1.0e-7), DoubleNear(0.10633823442082747, 1.0e-7), DoubleNear(0.14655165566924466, 1.0e-7), DoubleNear(0.10380219056311253, 1.0e-7), DoubleNear(0.14305656824163973, 1.0e-7), DoubleNear(0.11005740357778082, 1.0e-7), DoubleNear(0.15167728522886756, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false, false, false}), Matrix({ { 0.07870008669209738 + 6.776263578034403e-21i, -0.013709496853485884 + -0.004876270300925092i, -0.0026722942416472816 + 0.004097732261745394i, 0.0007194078431965528 + -0.0005482461369039492i, -0.006557951974718222 + -0.02897809034010336i, -0.01718973291013285 + 0.00019413227930929227i, 0.0017315004175609936 + 0.0006425056781683392i, 0.0005735765240492889 + -0.0009016216458104507i }, { -0.013709496853485884 + 0.004876270300925092i, 0.13351701002005928 + 0.0i, 0.00021161551490428632 + -0.0008793977173808297i, -0.004533625718031057 + 0.006951923211870085i, -0.013283438041324196 + 0.03219231275441885i, 0.03500390510479226 + -0.026109613316655705i, -0.0012251349092421335 + -0.001784741421661942i, 0.000170895247361952 + 0.0027091355234063162i }, { -0.0026722942416472807 + -0.004097732261745394i, 0.00021161551490428627 + 0.0008793977173808296i, 0.08344262443490752 + -1.0164395367051604e-20i, -0.014535643418190013 + -0.005170118718611823i, -0.0012861444329455747 + 0.0013254205898866804i, 0.0005937925654136177 + 0.0008884379609145057i, -0.006953140036928582 + -0.030724336029643383i, -0.01822560161805533 + 0.0002058308644115435i }, { 0.0007194078431965525 + 0.0005482461369039492i, -0.004533625718031056 + -0.006951923211870085i, -0.014535643418190013 + 0.005170118718611823i, 0.14156286468099027 + 1.3552527156068805e-20i, 0.002127224258291694 + -0.000401465369583693i, -0.0025480396185662336 + -0.0009360099208714379i, -0.014083909920239997 + 0.03413225036673039i, 0.037113271791447904 + -0.02768300201048101i }, { -0.006557951974718222 + 0.02897809034010336i, -0.013283438041324196 + -0.03219231275441885i, -0.0012861444329455747 + -0.0013254205898866808i, 0.002127224258291694 + 0.00040146536958369345i, 0.12539650765180838 + 0.0i, -0.008563750676591698 + -0.024042536645070788i, -0.004257890675922917 + 0.0065291073556926i, 0.001542625234450373 + 0.0003704795766779049i }, { -0.01718973291013285 + -0.00019413227930929237i, 0.03500390510479226 + 0.026109613316655705i, 0.0005937925654136177 + -0.0008884379609145055i, -0.002548039618566234 + 0.0009360099208714375i, -0.008563750676591698 + 0.024042536645070788i, 0.14776181673931427 + 0.0i, -0.0009610537881699471 + -0.0012622691261940547i, -0.005017314066662394 + 0.007693617490863556i }, { 0.0017315004175609931 + -0.0006425056781683389i, -0.0012251349092421337 + 0.0017847414216619418i, -0.006953140036928582 + 0.030724336029643383i, -0.014083909920239997 + -0.03413225036673039i, -0.004257890675922916 + -0.0065291073556926i, -0.0009610537881699472 + 0.0012622691261940544i, 0.1329530135637008 + 0.0i, -0.009079809965860943 + -0.025491361446474636i }, { 0.0005735765240492886 + 0.0009016216458104507i, 0.000170895247361952 + -0.0027091355234063162i, -0.018225601618055334 + -0.0002058308644115436i, 0.037113271791447904 + 0.02768300201048101i, 0.001542625234450373 + -0.0003704795766779045i, -0.005017314066662393 + -0.007693617490863556i, -0.009079809965860943 + 0.025491361446474632i, 0.15666607621712192 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.07870008669209738, 1.0e-7), DoubleNear(0.13351701002005928, 1.0e-7), DoubleNear(0.08344262443490752, 1.0e-7), DoubleNear(0.14156286468099027, 1.0e-7), DoubleNear(0.12539650765180838, 1.0e-7), DoubleNear(0.14776181673931427, 1.0e-7), DoubleNear(0.1329530135637008, 1.0e-7), DoubleNear(0.15666607621712192, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false, false, false}), Matrix({ { 0.20409659434390576 + 6.776263578034403e-21i, -0.022273247530077582 + -0.028918806945995884i, -0.0069301849175701985 + 0.010626839617437992i, 0.0022620330776469263 + -0.00017776656022604426i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.022273247530077582 + 0.028918806945995884i, 0.28127882675937355 + 0.0i, -0.0007494382732656607 + -0.0021416668435748844i, -0.009550939784693452 + 0.01464554070273364i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006930184917570197 + -0.010626839617437992i, -0.0007494382732656609 + 0.002141666843574884i, 0.21639563799860828 + -1.0164395367051604e-20i, -0.023615453384050956 + -0.030661480165086456i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0022620330776469254 + 0.0001777665602260447i, -0.00955093978469345 + -0.01464554070273364i, -0.023615453384050956 + 0.030661480165086456i, 0.29822894089811225 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.20409659434390576, 1.0e-7), DoubleNear(0.28127882675937355, 1.0e-7), DoubleNear(0.21639563799860828, 1.0e-7), DoubleNear(0.29822894089811225, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true, false, false}), Matrix({ { 0.09356639332226716 + 0.0i, -0.010210985860214 + -0.013257587535049218i, 0.01590848308623633 + 0.003132653993375207i, -0.0012922359943957039 + -0.0025959704555494545i, -0.014883536320642526 + 0.021790577967843366i, 0.0047117993770434494 + -0.00026915110243480394i, 0.0019995068044657005 + -0.031000727076546483i, -0.00461075577733761 + 0.003099823975782281i }, { -0.010210985860214 + 0.013257587535049218i, 0.1289499485397917 + 0.0i, -0.0021799785493779866 + 0.0019122316793603608i, 0.021924518007771975 + 0.0043173147632973i, -0.001463291584365823 + -0.004486900202207874i, -0.020511972028532076 + 0.030031016563048556i, 0.00417433977405148 + 0.0036664512774423523i, 0.002755650724430081 + -0.04272412368667684i }, { 0.01590848308623633 + -0.003132653993375207i, -0.0021799785493779866 + -0.001912231679360361i, 0.10058872509644842 + -1.0164395367051604e-20i, -0.010977339332928568 + -0.014252594127594768i, 0.011711291564552891 + 0.0011793191833806092i, -0.0011109641140813736 + -0.0017880937656267045i, 0.0061959720315383745 + -0.002665947375527563i, -0.001053914872614241 + -0.0005869809518903387i }, { -0.0012922359943957043 + 0.0025959704555494545i, 0.021924518007771978 + -0.004317314763297301i, -0.010977339332928568 + 0.014252594127594768i, 0.1386278819169086 + 0.0i, -0.0014451637503029046 + 0.0015306934089686745i, 0.016140094653239113 + 0.001625296675539678i, -0.0002984292876744155 + 0.0011688554901516785i, 0.008539073124994776 + -0.003674115937118845i }, { -0.014883536320642526 + -0.021790577967843366i, -0.001463291584365823 + 0.004486900202207874i, 0.011711291564552893 + -0.0011793191833806092i, -0.0014451637503029048 + -0.0015306934089686745i, 0.1105302010216386 + 6.776263578034403e-21i, -0.012062261669863582 + -0.015661219410946663i, -0.02283866800380653 + 0.007494185624062786i, 0.00355426907204263 + 0.00241820389532341i }, { 0.0047117993770434494 + 0.00026915110243480383i, -0.020511972028532076 + -0.030031016563048556i, -0.0011109641140813736 + 0.0017880937656267045i, 0.016140094653239113 + -0.0016252966755396785i, -0.012062261669863582 + 0.015661219410946663i, 0.15232887821958185 + 0.0i, 0.0014305402761123258 + -0.004053898522935246i, -0.031475457792465425 + 0.010328225939436341i }, { 0.0019995068044657005 + 0.031000727076546483i, 0.00417433977405148 + -0.0036664512774423523i, 0.0061959720315383745 + 0.0026659473755275636i, -0.0002984292876744155 + -0.0011688554901516785i, -0.02283866800380653 + -0.007494185624062786i, 0.0014305402761123258 + 0.004053898522935246i, 0.11580691290215986 + 0.0i, -0.01263811405112239 + -0.016408886037491688i }, { -0.00461075577733761 + -0.003099823975782281i, 0.002755650724430081 + 0.04272412368667684i, -0.001053914872614241 + 0.0005869809518903387i, 0.008539073124994776 + 0.003674115937118845i, 0.00355426907204263 + -0.00241820389532341i, -0.031475457792465425 + -0.010328225939436341i, -0.01263811405112239 + 0.016408886037491688i, 0.15960105898120358 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.09356639332226716, 1.0e-7), DoubleNear(0.1289499485397917, 1.0e-7), DoubleNear(0.10058872509644842, 1.0e-7), DoubleNear(0.1386278819169086, 1.0e-7), DoubleNear(0.1105302010216386, 1.0e-7), DoubleNear(0.15232887821958185, 1.0e-7), DoubleNear(0.11580691290215986, 1.0e-7), DoubleNear(0.15960105898120358, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, true, false}), Matrix({ { 0.20409659434390576 + 6.776263578034403e-21i, -0.022273247530077582 + -0.028918806945995884i, -0.0069301849175701985 + 0.010626839617437992i, 0.0022620330776469263 + -0.00017776656022604426i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.022273247530077582 + 0.028918806945995884i, 0.28127882675937355 + 0.0i, -0.0007494382732656607 + -0.0021416668435748844i, -0.009550939784693452 + 0.01464554070273364i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006930184917570197 + -0.010626839617437992i, -0.0007494382732656609 + 0.002141666843574884i, 0.21639563799860828 + -1.0164395367051604e-20i, -0.023615453384050956 + -0.030661480165086456i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0022620330776469254 + 0.0001777665602260447i, -0.00955093978469345 + -0.01464554070273364i, -0.023615453384050956 + 0.030661480165086456i, 0.29822894089811225 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.20409659434390576, 1.0e-7), DoubleNear(0.28127882675937355, 1.0e-7), DoubleNear(0.21639563799860828, 1.0e-7), DoubleNear(0.29822894089811225, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false, true}), Matrix({ { 0.10449006915373346 + 6.776263578034403e-21i, -0.011403096568943425 + -0.01480538245796949i, -0.004878954648255897 + 0.0034972428946737025i, 0.0010279752945285513 + 0.0003096503942580175i, -0.02620311310696391 + -0.01573291501776136i, 0.0006303451197076218 + 0.0054297127467857085i, 0.003454644887739532 + -4.694048032097124e-05i, -0.0003836596277032992 + -0.0004843720786029534i }, { -0.011403096568943425 + 0.01480538245796949i, 0.1440045785871564 + 0.0i, 3.691424875814709e-05 + -0.0010729650092448628i, -0.0067240055802263235 + 0.0048197785047251925i, 0.005088794155165381 + -0.0019958180099651076i, -0.03611221900033653 + -0.021682556202991254i, -0.00037035746856910873 + 0.000494617393481731i, 0.0047610714133538325 + -6.469173713872112e-05i }, { -0.004878954648255897 + -0.0034972428946737025i, 3.691424875814698e-05 + 0.0010729650092448628i, 0.10211114789808336 + 0.0i, -0.011143482722117664 + -0.014468308903395864i, -2.5428461217236577e-05 + 0.0004984352964108015i, 7.339920869885898e-05 + -5.0791695016443115e-05i, -0.02325128900445079 + -0.020001586083993973i, -0.0002966256805109866 + 0.0054773075435278675i }, { 0.0010279752945285513 + -0.0003096503942580175i, -0.0067240055802263235 + -0.0048197785047251925i, -0.011143482722117664 + 0.014468308903395864i, 0.14072603206415715 + 0.0i, -6.7849146358807e-05 + -5.799770218416591e-05i, -3.5044620712428205e-05 + 0.0006869261872819547i, 0.005371494441102507 + -0.0011117248715085746i, -0.032044117702399705 + -0.02756549017938294i }, { -0.02620311310696391 + 0.01573291501776136i, 0.005088794155165381 + 0.0019958180099651076i, -2.5428461217236577e-05 + -0.0004984352964108015i, -6.784914635880694e-05 + 5.799770218416591e-05i, 0.0996065251901723 + 0.0i, -0.010870150961134157 + -0.014113424488026393i, -0.002051230269314301 + 0.0071295967227642905i, 0.0012340577831183748 + -0.00048741695448406173i }, { 0.0006303451197076223 + -0.0054297127467857085i, -0.03611221900033653 + 0.021682556202991254i, 7.339920869885896e-05 + 5.0791695016443115e-05i, -3.5044620712428205e-05 + -0.0006869261872819547i, -0.010870150961134157 + 0.014113424488026393i, 0.13727424817221714 + 0.0i, -0.0007863525220238078 + -0.0010687018343300215i, -0.0028269342044671287 + 0.009825762198008448i }, { 0.003454644887739532 + 4.694048032097015e-05i, -0.00037035746856910884 + -0.0004946173934817307i, -0.023251289004450792 + 0.020001586083993973i, 0.005371494441102506 + 0.001111724871508575i, -0.0020512302693142994 + -0.0071295967227642905i, -0.0007863525220238079 + 0.0010687018343300213i, 0.11428449010052492 + -1.0164395367051604e-20i, -0.012471970661933292 + -0.016193171261690592i }, { -0.0003836596277032991 + 0.0004843720786029534i, 0.004761071413353833 + 6.469173713872026e-05i, -0.00029662568051098633 + -0.0054773075435278675i, -0.032044117702399705 + 0.027565490179382937i, 0.0012340577831183744 + 0.00048741695448406216i, -0.002826934204467127 + -0.009825762198008448i, -0.012471970661933292 + 0.016193171261690592i, 0.15750290883395507 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.10449006915373346, 1.0e-7), DoubleNear(0.1440045785871564, 1.0e-7), DoubleNear(0.10211114789808336, 1.0e-7), DoubleNear(0.14072603206415715, 1.0e-7), DoubleNear(0.0996065251901723, 1.0e-7), DoubleNear(0.13727424817221714, 1.0e-7), DoubleNear(0.11428449010052492, 1.0e-7), DoubleNear(0.15750290883395507, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false, false, false}), Matrix({ { 0.10800189513023464 + 5.082197683525802e-21i, -0.011003398894628837 + -0.013592520940734645i, 0.02008896145636026 + 0.012975691457682143i, 0.0008159771045976669 + -0.0049327544642244585i, 0.03289983597686867 + 0.034730726590984196i, 0.001019131280250307 + -0.007679011067751554i, 0.0019468949527284534 + 0.010412801989499898i, 0.0018348165029939817 + -0.0012402313394718292i }, { -0.011003398894628837 + 0.013592520940734645i, 0.14352244048311555 + 2.710505431213761e-20i, -0.005847956530429844 + 0.0013723746830004151i, 0.027308714611328826 + 0.019598609136808536i, -0.007722902883235888 + 0.00060217157118407i, 0.04372020273533639 + 0.04615325160803092i, -0.002222742297782811 + -0.0014625009793979116i, 0.0020164303199972943 + 0.014751986757008456i }, { 0.02008896145636026 + -0.012975691457682145i, -0.005847956530429844 + -0.0013723746830004153i, 0.09863074307138606 + -6.776263578034403e-21i, -0.01154660941517463 + -0.01568562253884523i, 0.010292215038127009 + 0.0025074199565379516i, -0.0013400990841947406 + -0.002298614121951111i, 0.030045169720516074 + 0.031717196878325526i, 0.0015267464682815505 + -0.00849130047457533i }, { 0.0008159771045976667 + 0.0049327544642244585i, 0.027308714611328826 + -0.01959860913680854i, -0.01154660941517463 + 0.015685622538845225i, 0.14125147370386296 + -6.776263578034403e-21i, -0.001337686098573362 + 0.001765027273656339i, 0.014621282015854446 + 0.0028116217254831105i, -0.008561466653332577 + 0.0010650949590565609i, 0.04302841455461759 + 0.04542296510507353i }, { 0.03289983597686867 + -0.034730726590984196i, -0.007722902883235888 + -0.0006021715711840701i, 0.010292215038127009 + -0.0025074199565379516i, -0.0013376860985733622 + -0.001765027273656339i, 0.11177925065478908 + 1.6940658945086007e-21i, -0.011388241674965077 + -0.014067918006741613i, 0.020791570882317457 + 0.013429514973959208i, 0.0008445158225548399 + -0.005105277060279282i }, { 0.0010191312802503068 + 0.007679011067751554i, 0.04372020273533639 + -0.04615325160803092i, -0.0013400990841947406 + 0.002298614121951111i, 0.014621282015854446 + -0.0028116217254831105i, -0.011388241674965077 + 0.014067918006741613i, 0.14854212354333124 + -1.3552527156068805e-20i, -0.006052488227590679 + 0.001420373350841745i, 0.02826383418475107 + 0.02028406853923139i }, { 0.0019468949527284536 + -0.010412801989499898i, -0.002222742297782811 + 0.0014625009793979116i, 0.030045169720516074 + -0.03171719687832552i, -0.008561466653332577 + -0.0010650949590565609i, 0.020791570882317457 + -0.013429514973959208i, -0.006052488227590679 + -0.0014203733508417454i, 0.10208034348610429 + -3.3881317890172014e-21i, -0.01195045092935999 + -0.016234225624760852i }, { 0.001834816502993982 + 0.0012402313394718292i, 0.0020164303199972943 + -0.014751986757008458i, 0.0015267464682815505 + 0.00849130047457533i, 0.04302841455461759 + -0.04542296510507353i, 0.0008445158225548396 + 0.005105277060279282i, 0.02826383418475107 + -0.020284068539231394i, -0.01195045092935999 + 0.016234225624760852i, 0.146191729927176 + 6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10800189513023464, 1.0e-7), DoubleNear(0.14352244048311555, 1.0e-7), DoubleNear(0.09863074307138606, 1.0e-7), DoubleNear(0.14125147370386296, 1.0e-7), DoubleNear(0.11177925065478908, 1.0e-7), DoubleNear(0.14854212354333124, 1.0e-7), DoubleNear(0.10208034348610429, 1.0e-7), DoubleNear(0.146191729927176, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false, false, false}), Matrix({ { 0.08893749661586278 + 6.776263578034403e-21i, -0.016134666189492854 + -0.006810237751298015i, 0.01990831339336259 + 0.012866444765259444i, -0.0060568267702104 + -0.004082907431943862i, -0.008243411080323407 + -0.03182381725886389i, -0.01723559682836659 + 0.0043544352222357405i, 0.0040921493553910055 + -0.01013227934323327i, -0.0031434474411435975 + -0.007220309209413687i }, { -0.016134666189492854 + 0.006810237751298015i, 0.14342870235659302 + 1.3552527156068805e-20i, -0.004659885586418947 + -0.00317885632650994i, 0.024862675467230803 + 0.014845510335149012i, -0.010154800011205072 + 0.031437677433129155i, 0.036079344394625165 + -0.03244310810716015i, -0.00897177188343529 + 0.005382689705501877i, 0.014104006717855751 + -0.000380416813358708i }, { 0.01990831339336259 + -0.012866444765259444i, -0.004659885586418947 + 0.00317885632650994i, 0.07320521451114212 + -1.0164395367051604e-20i, -0.012110474082183045 + -0.003236151268238901i, -0.00885379890162149 + -0.006755945383441065i, -0.009158282846618071 + 0.005568685299361893i, -0.005267680931323398 + -0.027878609110882857i, -0.01817973769982159 + -0.003954472078514904i }, { -0.0060568267702104 + 0.004082907431943862i, 0.024862675467230803 + -0.01484551033514901i, -0.012110474082183045 + 0.003236151268238901i, 0.13165117234445656 + 0.0i, 0.0056661349356411685 + 0.010048810153340292i, 0.004937658459102153 + -0.0152709003060445i, -0.01721254795035912 + 0.03488688568802009i, 0.03603783250161501 + -0.02134950721997657i }, { -0.008243411080323407 + 0.031823817258863886i, -0.010154800011205072 + -0.031437677433129155i, -0.00885379890162149 + 0.006755945383441065i, 0.005666134935641169 + -0.010048810153340294i, 0.1308436491691609 + 0.0i, -0.006256974380101062 + -0.020850201196178246i, 0.020972218945315126 + 0.01353876166638191i, 0.007717319697362906 + -0.005955124092559879i }, { -0.017235596828366596 + -0.0043544352222357405i, 0.036079344394625165 + 0.032443108107160154i, -0.009158282846618071 + -0.005568685299361893i, 0.004937658459102153 + 0.0152709003060445i, -0.006256974380101062 + 0.020850201196178246i, 0.14863586166985376 + 0.0i, -0.0072405591716015755 + 0.005971604360352101i, 0.030709873328849096 + 0.02503716734089092i }, { 0.0040921493553910055 + 0.010132279343233267i, -0.00897177188343529 + -0.005382689705501877i, -0.005267680931323397 + 0.027878609110882857i, -0.01721254795035912 + -0.03488688568802009i, 0.020972218945315126 + -0.01353876166638191i, -0.0072405591716015755 + -0.005971604360352101i, 0.12750587204634822 + 0.0i, -0.011386586262351577 + -0.028683696895367178i }, { -0.003143447441143598 + 0.007220309209413687i, 0.014104006717855751 + 0.000380416813358708i, -0.01817973769982159 + 0.003954472078514904i, 0.03603783250161501 + 0.02134950721997657i, 0.0077173196973629055 + 0.005955124092559879i, 0.030709873328849096 + -0.025037167340890922i, -0.011386586262351577 + 0.028683696895367178i, 0.1557920312865824 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.08893749661586278, 1.0e-7), DoubleNear(0.14342870235659302, 1.0e-7), DoubleNear(0.07320521451114212, 1.0e-7), DoubleNear(0.13165117234445656, 1.0e-7), DoubleNear(0.1308436491691609, 1.0e-7), DoubleNear(0.14863586166985376, 1.0e-7), DoubleNear(0.12750587204634822, 1.0e-7), DoubleNear(0.1557920312865824, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false, false, false}), Matrix({ { 0.21978114578502372 + 6.776263578034403e-21i, -0.022391640569593918 + -0.02766043894747626i, 0.040880532338677715 + 0.02640520643164135i, 0.0016604929271525069 + -0.010038031524503742i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.022391640569593918 + 0.02766043894747626i, 0.29206456402644676 + 1.3552527156068805e-20i, -0.011900444758020524 + 0.0027927480338421603i, 0.055572548796079896 + 0.03988267767603993i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.040880532338677715 + -0.026405206431641348i, -0.011900444758020524 + -0.0027927480338421607i, 0.20071108655749034 + -1.0164395367051604e-20i, -0.02349706034453462 + -0.03191984816360608i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016604929271525062 + 0.010038031524503742i, 0.055572548796079896 + -0.03988267767603993i, -0.02349706034453462 + 0.03191984816360608i, 0.2874432036310389 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21978114578502372, 1.0e-7), DoubleNear(0.29206456402644676, 1.0e-7), DoubleNear(0.20071108655749034, 1.0e-7), DoubleNear(0.2874432036310389, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true, false, false}), Matrix({ { 0.1014801965505367 + 0.0i, -0.010338958230356998 + -0.01277173604240662i, 0.018875888748334464 + 0.012192153831345861i, 0.0007667042958408982 + -0.0046348898967135i, -0.004540780272928047 + 0.009995983043203326i, 0.001720660783310968 + -0.0004469286188270795i, -0.0020455599543237534 + 0.0013137654122050407i, 0.0004222384911483737 + 0.0002829121417425468i }, { -0.010338958230356998 + 0.01277173604240662i, 0.134855832409944 + 0.0i, -0.005494827451049802 + 0.0012895037851319608i, 0.02565967683213692 + 0.01841514637240564i, -0.000795417451689064 + -0.001589883580360358i, -0.006034189174943276 + 0.01328354358651211i, 0.00011885024401325994 + -0.0005989499177324344i, -0.0029620798487127137 + 0.0017035300187965745i }, { 0.018875888748334464 + -0.012192153831345861i, -0.005494827451049802 + -0.0012895037851319612i, 0.09267492186817888 + -1.0164395367051604e-20i, -0.010849366962785567 + -0.014738445620237368i, 0.0003563384869660742 + 0.0024048530033550916i, 0.0003728871577850319 + -0.000483550981813399i, -0.004146784016176103 + 0.009128647549112478i, 0.0019372237211182398 + -0.00040920343549806287i }, { 0.0007667042958408978 + 0.0046348898967135i, 0.02565967683213692 + -0.018415146372405638i, -0.010849366962785567 + 0.014738445620237368i, 0.13272199804675627 + 0.0i, -0.0004908515971545255 + -0.0001318686199346215i, 0.0006657706508673544 + 0.003351519207096187i, -0.0009663034203511744 + -0.0017281611316958376i, -0.005938709728594023 + 0.013073357039417604i }, { -0.004540780272928047 + -0.009995983043203326i, -0.0007954174516890638 + 0.001589883580360358i, 0.0003563384869660742 + -0.0024048530033550916i, -0.0004908515971545255 + 0.00013186861993462148i, 0.11830094923448703 + 6.776263578034403e-21i, -0.012052682339236918 + -0.014888702905069637i, 0.02200464359034325 + 0.01421305260029549i, 0.0008937886313116086 + -0.005403141627790241i }, { 0.001720660783310968 + 0.0004469286188270795i, -0.006034189174943277 + -0.013283543586512108i, 0.000372887157785032 + 0.000483550981813399i, 0.0006657706508673544 + -0.0033515192070961864i, -0.012052682339236918 + 0.014888702905069637i, 0.15720873161650278 + 1.3552527156068805e-20i, -0.006405617306970721 + 0.0015032442487101995i, 0.02991287196394298 + 0.021467531303634293i }, { -0.0020455599543237534 + -0.0013137654122050407i, 0.00011885024401325989 + 0.0005989499177324344i, -0.004146784016176103 + -0.009128647549112478i, -0.0009663034203511744 + 0.0017281611316958376i, 0.02200464359034325 + -0.01421305260029549i, -0.006405617306970721 + -0.0015032442487101995i, 0.10803616468931146 + 0.0i, -0.012647693381749054 + -0.017181402543368713i }, { 0.0004222384911483737 + -0.0002829121417425467i, -0.0029620798487127137 + -0.0017035300187965743i, 0.0019372237211182396 + 0.00040920343549806287i, -0.005938709728594023 + -0.013073357039417602i, 0.0008937886313116084 + 0.005403141627790241i, 0.029912871963942978 + -0.021467531303634293i, -0.012647693381749054 + 0.017181402543368716i, 0.15472120558428265 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1014801965505367, 1.0e-7), DoubleNear(0.134855832409944, 1.0e-7), DoubleNear(0.09267492186817888, 1.0e-7), DoubleNear(0.13272199804675627, 1.0e-7), DoubleNear(0.11830094923448703, 1.0e-7), DoubleNear(0.15720873161650278, 1.0e-7), DoubleNear(0.10803616468931146, 1.0e-7), DoubleNear(0.15472120558428265, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, true, false}), Matrix({ { 0.21978114578502372 + 6.776263578034403e-21i, -0.022391640569593918 + -0.02766043894747626i, 0.040880532338677715 + 0.02640520643164135i, 0.0016604929271525069 + -0.010038031524503742i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.022391640569593918 + 0.02766043894747626i, 0.29206456402644676 + 1.3552527156068805e-20i, -0.011900444758020524 + 0.0027927480338421603i, 0.055572548796079896 + 0.03988267767603993i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.040880532338677715 + -0.026405206431641348i, -0.011900444758020524 + -0.0027927480338421607i, 0.20071108655749034 + -1.0164395367051604e-20i, -0.02349706034453462 + -0.03191984816360608i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016604929271525062 + 0.010038031524503742i, 0.055572548796079896 + -0.03988267767603993i, -0.02349706034453462 + 0.03191984816360608i, 0.2874432036310389 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.21978114578502372, 1.0e-7), DoubleNear(0.29206456402644676, 1.0e-7), DoubleNear(0.20071108655749034, 1.0e-7), DoubleNear(0.2874432036310389, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false, true}), Matrix({ { 0.10798547205324388 + 6.776263578034403e-21i, -0.011001725686330146 + -0.013590454023134364i, 0.020085906671439453 + 0.012973718336936802i, 0.0008158530247859624 + -0.0049320043754760646i, -0.025848622933197257 + -0.018677561657792177i, 0.00028284282436508927 + 0.005156063318489475i, -0.0025640079020624726 + -0.006579667617613683i, -0.0010483492906364072 + 0.0010394673848078237i }, { -0.011001725686330146 + 0.013590454023134364i, 0.14350061605043207 + 0.0i, -0.005847067273438362 + 0.0013721659957819927i, 0.027304561970099343 + 0.01959562891626354i, 0.004984151956936624 + -0.001350266002583322i, -0.0343499291565833 + -0.024820390680809108i, 0.0016369549426049844 + 0.000682872952148796i, -0.003146596972294115 + -0.009413327954242668i }, { 0.020085906671439453 + -0.012973718336936802i, -0.005847067273438363 + -0.0013721659957819927i, 0.09861574499857295 + 0.0i, -0.011544853604730943 + -0.015683237338230988i, -0.007051971320872881 + -0.0003685959436826626i, 0.001162285257810583 + 0.0013397872713126835i, -0.02360577917821744 + -0.017056939443963158i, 5.087661483154629e-05 + 0.005750956971824101i }, { 0.000815853024785962 + 0.0049320043754760646i, 0.02730456197009934 + -0.01959562891626354i, -0.011544853604730943 + 0.015683237338230988i, 0.14122999460088148 + 0.0i, 0.00065776569072025 + -0.001321693222865422i, -0.009925260071090708 + -3.206557951126494e-05i, 0.0054761366393312645 + -0.0017572768788903597i, -0.03380640754615293 + -0.024427655701565087i }, { -0.025848622933197257 + 0.01867756165779217i, 0.004984151956936624 + 0.0013502660025833226i, -0.007051971320872881 + 0.00036859594368266217i, 0.0006577656907202499 + 0.001321693222865422i, 0.11179567373177984 + 0.0i, -0.011389914883263772 + -0.014069984924341895i, 0.020794625667238262 + 0.01343148809470455i, 0.0008446399023665444 + -0.0051060271490276764i }, { 0.0002828428243650896 + -0.005156063318489475i, -0.0343499291565833 + 0.024820390680809108i, 0.001162285257810583 + -0.0013397872713126835i, -0.009925260071090708 + 3.206557951126429e-05i, -0.011389914883263772 + 0.014069984924341895i, 0.14856394797601472 + 1.3552527156068805e-20i, -0.006053377484582161 + 0.0014205820380601675i, 0.028267986825980557 + 0.02028704875977639i }, { -0.002564007902062473 + 0.006579667617613682i, 0.0016369549426049844 + -0.0006828729521487957i, -0.02360577917821744 + 0.017056939443963158i, 0.0054761366393312645 + 0.0017572768788903601i, 0.020794625667238262 + -0.013431488094704548i, -0.006053377484582161 + -0.001420582038060168i, 0.10209534155891739 + -1.0164395367051604e-20i, -0.011952206739803677 + -0.016236610825375093i }, { -0.001048349290636407 + -0.001039467384807824i, -0.003146596972294115 + 0.009413327954242667i, 5.0876614831546724e-05 + -0.005750956971824102i, -0.03380640754615293 + 0.024427655701565087i, 0.0008446399023665442 + 0.0051060271490276764i, 0.028267986825980557 + -0.02028704875977639i, -0.011952206739803677 + 0.016236610825375093i, 0.14621320903015747 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.10798547205324388, 1.0e-7), DoubleNear(0.14350061605043207, 1.0e-7), DoubleNear(0.09861574499857295, 1.0e-7), DoubleNear(0.14122999460088148, 1.0e-7), DoubleNear(0.11179567373177984, 1.0e-7), DoubleNear(0.14856394797601472, 1.0e-7), DoubleNear(0.10209534155891739, 1.0e-7), DoubleNear(0.14621320903015747, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false, false, false}), Matrix({ { 0.07967799066986206 + -1.6940658945086007e-21i, -0.013879847002636638 + -0.004936861392045316i, 0.024271729869590846 + 0.025622462512690514i, -0.002640545392302382 + -0.0059672943760379635i, -0.0066394391444485005 + -0.029338163511591443i, -0.017403327442185874 + 0.0001965445095383618i, 0.00741190028014442 + -0.011072151202488192i, -0.005364653566724222 + -0.005536605856044525i }, { -0.013879847002636638 + 0.004936861392045316i, 0.13517605285833065 + 1.3552527156068805e-20i, -0.005815689365803119 + -0.0029595336354885657i, 0.0411777030549033 + 0.043469260681119594i, -0.01344849410981142 + 0.03259232490204399i, 0.035438853266580125 + -0.026434043641874377i, -0.014577599528115572 + 0.005603662515958139i, 0.019296013274451126 + 0.0033438433931280757i }, { 0.024271729869590846 + -0.025622462512690514i, -0.005815689365803119 + 0.0029595336354885657i, 0.08246472045714284 + -1.6940658945086007e-21i, -0.01436529326903926 + -0.0051095276274915995i, -0.011456948907621823 + -0.006801993806356248i, -0.005238245902941942 + 0.0056563497201344804i, -0.006871652867198303 + -0.0303642628581553i, -0.018012007086002306 + 0.00020341863418247387i }, { -0.0026405453923023818 + 0.0059672943760379635i, 0.0411777030549033 + -0.04346926068111959i, -0.01436529326903926 + 0.0051095276274915995i, 0.13990382184271893 + 0.0i, 0.006384164592272165 + 0.014253065777356393i, 0.0022949497039828565 + -0.019448666349694763i, -0.013918853851752774 + 0.03373223821910526i, 0.036678323629660045 + -0.027358571685262338i }, { -0.0066394391444485005 + 0.029338163511591443i, -0.01344849410981142 + -0.03259232490204399i, -0.011456948907621823 + 0.006801993806356248i, 0.006384164592272165 + -0.014253065777356393i, 0.12695464753175864 + 0.0i, -0.008670161307166831 + -0.024341282087534555i, 0.038673275827793896 + 0.04082546095661921i, 0.005186423140834239 + -0.01020301716628892i }, { -0.017403327442185878 + -0.0001965445095383619i, 0.035438853266580125 + 0.02643404364187438i, -0.005238245902941942 + -0.005656349720134481i, 0.0022949497039828565 + 0.019448666349694763i, -0.008670161307166831 + 0.024341282087534555i, 0.14959786132864786 + 6.776263578034403e-21i, -0.010468680170765347 + 0.004626800165729196i, 0.04557091423505068 + 0.04810695603198485i }, { 0.007411900280144421 + 0.011072151202488192i, -0.014577599528115572 + -0.005603662515958139i, -0.006871652867198303 + 0.0303642628581553i, -0.013918853851752774 + -0.03373223821910526i, 0.038673275827793896 + -0.04082546095661921i, -0.010468680170765347 + -0.004626800165729196i, 0.13139487368375052 + 0.0i, -0.008973399335285806 + -0.02519261600401087i }, { -0.005364653566724223 + 0.005536605856044525i, 0.019296013274451126 + -0.0033438433931280757i, -0.018012007086002306 + -0.00020341863418247414i, 0.036678323629660045 + 0.02735857168526234i, 0.005186423140834239 + 0.01020301716628892i, 0.04557091423505068 + -0.04810695603198485i, -0.008973399335285806 + 0.02519261600401087i, 0.15483003162778836 + -6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.07967799066986206, 1.0e-7), DoubleNear(0.13517605285833065, 1.0e-7), DoubleNear(0.08246472045714284, 1.0e-7), DoubleNear(0.13990382184271893, 1.0e-7), DoubleNear(0.12695464753175864, 1.0e-7), DoubleNear(0.14959786132864786, 1.0e-7), DoubleNear(0.13139487368375052, 1.0e-7), DoubleNear(0.15483003162778836, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false, false, false}), Matrix({ { 0.2066326382016207 + -1.6940658945086007e-21i, -0.02255000830980347 + -0.029278143479579872i, 0.06294500569738475 + 0.06644792346930972i, 0.0025458777485318574 + -0.016170311542326885i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02255000830980347 + 0.02927814347957987i, 0.2847739141869785 + 2.0328790734103208e-20i, -0.016284369536568463 + 0.001667266530240631i, 0.08674861728995396 + 0.09157621671310445i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06294500569738476 + -0.06644792346930972i, -0.016284369536568463 + -0.001667266530240631i, 0.21385959414089337 + -1.6940658945086007e-21i, -0.02333869260432507 + -0.030302143631502472i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0025458777485318574 + 0.016170311542326885i, 0.08674861728995396 + -0.09157621671310445i, -0.02333869260432507 + 0.030302143631502472i, 0.2947338534705073 + -6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2066326382016207, 1.0e-7), DoubleNear(0.2847739141869785, 1.0e-7), DoubleNear(0.21385959414089337, 1.0e-7), DoubleNear(0.2947338534705073, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true, false, false}), Matrix({ { 0.09540909737074126 + -1.5246593050577406e-20i, -0.01041208183405069 + -0.013518683526423948i, 0.029063783097633317 + 0.030681195650132338i, 0.0011755156403059192 + -0.0074663656326727675i, -0.004269126015962983 + 0.009397968785075443i, 0.001797508413357237 + -0.0004207089012052872i, -0.004322626279028423 + 0.001489990364593117i, 0.0006828515157045888 + 0.00044987654473147806i }, { -0.01041208183405069 + 0.013518683526423944i, 0.13148949916034824 + 6.776263578034403e-21i, -0.007519029966696749 + 0.0007698318915692897i, 0.04005469487215534 + 0.04228375658979587i, -0.0008657211800003302 + -0.0016305089126227579i, -0.005883560972284505 + 0.012951953668237036i, 0.00026061278268136933 + -0.0007750845602272447i, -0.005957293173817511 + 0.0020534528906902237i }, { 0.02906378309763332 + -0.030681195650132338i, -0.007519029966696749 + -0.0007698318915692897i, 0.09874602104797432 + 5.082197683525802e-21i, -0.010776243359091876 + -0.01399149813622004i, 0.0017216803322855755 + 0.004235680118723377i, 0.00041227245216991966 + -0.0007061915626665255i, -0.004418438273141167 + 0.009726661807240359i, 0.0018603760910719707 + -0.0004354231531198552i }, { 0.0011755156403059192 + 0.0074663656326727675i, 0.040054694872155336 + -0.04228375658979587i, -0.010776243359091876 + 0.01399149813622004i, 0.13608833129635206 + -6.776263578034403e-21i, -0.0007880495427376034 + -0.0002182957081361015i, 0.0023727599447542435 + 0.005837467000135126i, -0.0008959996920399082 + -0.0016875357994334376i, -0.006089337931252794 + 0.013404946957692678i }, { -0.0042691260159629825 + -0.009397968785075443i, -0.0008657211800003302 + 0.0016305089126227579i, 0.0017216803322855755 + -0.004235680118723377i, -0.0007880495427376034 + 0.00021829570813610148i, 0.11122354083087943 + 1.3552527156068805e-20i, -0.01213792647575278 + -0.015759459953155926i, 0.03388122259975143 + 0.03576672781917738i, 0.001370362108225938 + -0.008703945909654115i }, { 0.001797508413357237 + 0.0004207089012052872i, -0.005883560972284505 + -0.012951953668237034i, 0.0004122724521699197 + 0.0007061915626665255i, 0.002372759944754243 + -0.005837467000135127i, -0.01213792647575278 + 0.015759459953155926i, 0.15328441502663026 + 1.3552527156068805e-20i, -0.008765339569871716 + 0.0008974346386713414i, 0.04669392241779863 + 0.049292460123308575i }, { -0.004322626279028423 + -0.001489990364593117i, 0.00026061278268136933 + 0.0007750845602272446i, -0.004418438273141167 + -0.009726661807240359i, -0.0008959996920399082 + 0.0016875357994334378i, 0.03388122259975143 + -0.03576672781917738i, -0.008765339569871716 + -0.0008974346386713414i, 0.11511357309291903 + -6.776263578034403e-21i, -0.012562449245233193 + -0.01631064549528243i }, { 0.0006828515157045888 + -0.0004498765447314781i, -0.005957293173817511 + -0.0020534528906902233i, 0.0018603760910719707 + 0.00043542315311985517i, -0.006089337931252794 + -0.013404946957692678i, 0.0013703621082259382 + 0.008703945909654117i, 0.04669392241779863 + -0.049292460123308575i, -0.012562449245233193 + 0.01631064549528243i, 0.1586455221741552 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.09540909737074126, 1.0e-7), DoubleNear(0.13148949916034824, 1.0e-7), DoubleNear(0.09874602104797432, 1.0e-7), DoubleNear(0.13608833129635206, 1.0e-7), DoubleNear(0.11122354083087943, 1.0e-7), DoubleNear(0.15328441502663026, 1.0e-7), DoubleNear(0.11511357309291903, 1.0e-7), DoubleNear(0.1586455221741552, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, true, false}), Matrix({ { 0.2066326382016207 + -1.6940658945086007e-21i, -0.02255000830980347 + -0.029278143479579872i, 0.06294500569738475 + 0.06644792346930972i, 0.0025458777485318574 + -0.016170311542326885i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02255000830980347 + 0.02927814347957987i, 0.2847739141869785 + 2.0328790734103208e-20i, -0.016284369536568463 + 0.001667266530240631i, 0.08674861728995396 + 0.09157621671310445i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06294500569738476 + -0.06644792346930972i, -0.016284369536568463 + -0.001667266530240631i, 0.21385959414089337 + -1.6940658945086007e-21i, -0.02333869260432507 + -0.030302143631502472i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0025458777485318574 + 0.016170311542326885i, 0.08674861728995396 + -0.09157621671310445i, -0.02333869260432507 + 0.030302143631502472i, 0.2947338534705073 + -6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2066326382016207, 1.0e-7), DoubleNear(0.2847739141869785, 1.0e-7), DoubleNear(0.21385959414089337, 1.0e-7), DoubleNear(0.2947338534705073, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false, true}), Matrix({ { 0.101525191790722 + 1.1858461261560205e-20i, -0.01107953679757652 + -0.01438528374757647i, 0.030926884694080007 + 0.03264797968525368i, 0.001250870767294888 + -0.007944988724620494i, -0.02430221724200976 + -0.01756016798774019i, 0.00016399191908067533 + 0.005359781237695494i, -0.0017560948132779417 + -0.013164216307458482i, -0.0016736168314143013 + 0.0016854471106946601i }, { -0.01107953679757652 + 0.014385283747576468i, 0.1399184877396626 + 1.3552527156068805e-20i, -0.008001029047395363 + 0.0008191811115713858i, 0.04262235668379247 + 0.044994309931787574i, 0.005140254356081783 + -0.0015270669337847159i, -0.03349247044252816 + -0.024200812684636336i, 0.0020569052893933447 + 0.0011877987589688358i, -0.0024201887853391797 + -0.018142464993459104i }, { 0.03092688469408001 + -0.03264797968525368i, -0.008001029047395363 + -0.0008191811115713856i, 0.10507602526109483 + -5.082197683525802e-21i, -0.011467042493484571 + -0.014888407613788884i, -0.01304992243618278 + 0.002465762436324873i, 0.0017735281752435958 + 0.0015799756558122489i, -0.025152184869404938 + -0.018174333114015142i, 0.00016972752011596012 + 0.0055472390526180824i }, { 0.001250870767294888 + 0.007944988724620496i, 0.04262235668379247 + -0.044994309931787574i, -0.011467042493484571 + 0.014888407613788884i, 0.144812122911651 + -1.3552527156068805e-20i, 0.0010747717055436235 + -0.002118157464001455i, -0.017984949155815853 + 0.0033982280174069185i, 0.005320034240186105 + -0.0015804759476889662i, -0.034663866260208065 + -0.025047233697737863i }, { -0.02430221724200976 + 0.01756016798774019i, 0.005140254356081783 + 0.001527066933784716i, -0.01304992243618278 + -0.0024657624363248745i, 0.0010747717055436235 + 0.002118157464001455i, 0.1051074464108987 + -1.3552527156068805e-20i, -0.01147047151222695 + -0.014892859732003402i, 0.03201812100330474 + 0.033799943784056034i, 0.001295006981236969 + -0.008225322817706389i }, { 0.00016399191908067576 + -0.005359781237695494i, -0.03349247044252816 + 0.02420081268463633i, 0.0017735281752435958 + -0.0015799756558122486i, -0.017984949155815853 + -0.0033982280174069193i, -0.01147047151222695 + 0.0148928597320034i, 0.14485542644731592 + 6.776263578034403e-21i, -0.008283340489173101 + 0.0008480854186692453i, 0.044126260606161496 + 0.04658190678131687i }, { -0.0017560948132779423 + 0.013164216307458482i, 0.0020569052893933447 + -0.0011877987589688356i, -0.025152184869404938 + 0.01817433311401514i, 0.005320034240186104 + 0.0015804759476889666i, 0.03201812100330474 + -0.033799943784056034i, -0.008283340489173101 + -0.0008480854186692455i, 0.10878356887979854 + 3.3881317890172014e-21i, -0.011871650110840497 + -0.015413736017713587i }, { -0.001673616831414301 + -0.0016854471106946603i, -0.0024201887853391806 + 0.018142464993459104i, 0.00016972752011596044 + -0.0055472390526180824i, -0.034663866260208065 + 0.025047233697737863i, 0.0012950069812369693 + 0.008225322817706389i, 0.044126260606161496 + -0.04658190678131687i, -0.011871650110840497 + 0.015413736017713587i, 0.14992173055885627 + 6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.101525191790722, 1.0e-7), DoubleNear(0.1399184877396626, 1.0e-7), DoubleNear(0.10507602526109483, 1.0e-7), DoubleNear(0.144812122911651, 1.0e-7), DoubleNear(0.1051074464108987, 1.0e-7), DoubleNear(0.14485542644731592, 1.0e-7), DoubleNear(0.10878356887979854, 1.0e-7), DoubleNear(0.14992173055885627, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false, false, false}), Matrix({ { 0.1621427111270049 + -3.3881317890172014e-21i, -0.0282451402716759 + -0.010046389019536917i, -0.013511092011646804 + -0.05970242636974675i, -0.03541533452818818 + 0.00039996314372083567i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0282451402716759 + 0.010046389019536917i, 0.27507987470104955 + 1.3552527156068805e-20i, -0.027367347961564193 + 0.06632456312114925i, 0.07211717689624017 + -0.053792615327136716i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013511092011646804 + 0.059702426369746736i, -0.027367347961564193 + -0.06632456312114925i, 0.25834952121550914 + 0.0i, -0.017643560642452635 + -0.04953389809154543i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03541533452818818 + -0.00039996314372083605i, 0.07211717689624017 + 0.05379261532713672i, -0.017643560642452635 + 0.04953389809154542i, 0.3044278929564362 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1621427111270049, 1.0e-7), DoubleNear(0.27507987470104955, 1.0e-7), DoubleNear(0.25834952121550914, 1.0e-7), DoubleNear(0.3044278929564362, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true, false, false}), Matrix({ { 0.0748666321473267 + -1.0164395367051604e-20i, -0.01304171190904068 + -0.00463874882754038i, -0.006238516357064755 + -0.02756657738272056i, -0.01635242684710967 + 0.0001846761617917033i, -0.0033499435151945803 + 0.007374498777933839i, 0.001040482836776662 + -0.0010770691784728515i, 0.002994503187939662 + 0.0006189746294032372i, 0.0007135062792674291 + -0.001619007066757657i }, { -0.01304171190904068 + 0.00463874882754038i, 0.12701344172199555 + 0.0i, -0.012636406277192638 + 0.030624236112801902i, 0.03329887675287099 + -0.024837822902719735i, 0.00012663252513124735 + -0.001492195279587051i, -0.005683277626297457 + 0.012511053908726854i, -0.0024511206028909375 + -0.0026150050858069983i, 0.0009565962344902587 + 0.004391379981380311i }, { -0.006238516357064756 + 0.02756657738272056i, -0.012636406277192638 + -0.030624236112801902i, 0.11928848627138888 + 0.0i, -0.008146613284101885 + -0.02287143283510361i, -0.002436212349541621 + -0.0018479849356438408i, 0.003581964773371153 + 0.00012558730445805895i, -0.00533762077390957 + 0.011750131814381963i, 0.0026174016676525458 + 0.00022093712414770897i }, { -0.01635242684710967 + -0.00018467616179170345i, 0.03329887675287099 + 0.024837822902719735i, -0.008146613284101885 + 0.02287143283510361i, 0.14056438873470475 + 0.0i, 0.0007498881516820027 + -0.001602480219139142i, -0.003936544792134224 + 0.0021686192833758537i, -0.0018883533971714858 + -0.0018258494324691447i, -0.006289621277239843 + 0.01384584671720286i }, { -0.0033499435151945803 + -0.007374498777933839i, 0.00012663252513124733 + 0.001492195279587051i, -0.0024362123495416206 + 0.0018479849356438408i, 0.0007498881516820027 + 0.001602480219139142i, 0.0872760789796782 + 6.776263578034403e-21i, -0.015203428362635218 + -0.005407640191996537i, -0.00727257565458205 + -0.03213584898702619i, -0.019062907681078513 + 0.00021528698192913238i }, { 0.001040482836776662 + 0.0010770691784728515i, -0.005683277626297457 + -0.012511053908726854i, 0.003581964773371153 + -0.00012558730445805895i, -0.003936544792134224 + -0.0021686192833758537i, -0.015203428362635218 + 0.005407640191996538i, 0.14806643297905403 + 1.3552527156068805e-20i, -0.014730941684371555 + 0.03570032700834734i, 0.03881830014336918 + -0.02895479242441698i }, { 0.002994503187939662 + -0.0006189746294032372i, -0.0024511206028909375 + 0.0026150050858069983i, -0.00533762077390957 + -0.011750131814381963i, -0.0018883533971714855 + 0.0018258494324691447i, -0.007272575654582049 + 0.03213584898702618i, -0.014730941684371555 + -0.03570032700834734i, 0.13906103494412025 + 0.0i, -0.009496947358350754 + -0.026662465256441815i }, { 0.000713506279267429 + 0.001619007066757657i, 0.0009565962344902587 + -0.004391379981380311i, 0.0026174016676525458 + -0.00022093712414770908i, -0.006289621277239843 + -0.013845846717202858i, -0.019062907681078513 + -0.0002152869819291326i, 0.03881830014336918 + 0.028954792424416984i, -0.009496947358350754 + 0.026662465256441815i, 0.16386350422173143 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.0748666321473267, 1.0e-7), DoubleNear(0.12701344172199555, 1.0e-7), DoubleNear(0.11928848627138888, 1.0e-7), DoubleNear(0.14056438873470475, 1.0e-7), DoubleNear(0.0872760789796782, 1.0e-7), DoubleNear(0.14806643297905403, 1.0e-7), DoubleNear(0.13906103494412025, 1.0e-7), DoubleNear(0.16386350422173143, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, true, false}), Matrix({ { 0.1621427111270049 + -3.3881317890172014e-21i, -0.0282451402716759 + -0.010046389019536917i, -0.013511092011646804 + -0.05970242636974675i, -0.03541533452818818 + 0.00039996314372083567i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0282451402716759 + 0.010046389019536917i, 0.27507987470104955 + 1.3552527156068805e-20i, -0.027367347961564193 + 0.06632456312114925i, 0.07211717689624017 + -0.053792615327136716i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013511092011646804 + 0.059702426369746736i, -0.027367347961564193 + -0.06632456312114925i, 0.25834952121550914 + 0.0i, -0.017643560642452635 + -0.04953389809154543i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03541533452818818 + -0.00039996314372083605i, 0.07211717689624017 + 0.05379261532713672i, -0.017643560642452635 + 0.04953389809154542i, 0.3044278929564362 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1621427111270049, 1.0e-7), DoubleNear(0.27507987470104955, 1.0e-7), DoubleNear(0.25834952121550914, 1.0e-7), DoubleNear(0.3044278929564362, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false, true}), Matrix({ { 0.07966587460677203 + 6.776263578034403e-21i, -0.013877736393413814 + -0.004936110678785735i, -0.00663842953234759 + -0.029333702266559243i, -0.017400681042452484 + 0.0001965146224182482i, -0.0190697240489765 + -0.013779300647556194i, 0.0024681640833642974 + 0.003581907209335707i, -0.003484614770208997 + 0.008169853492785581i, 0.004199213546063681 + 0.002962645387376647i }, { -0.013877736393413814 + 0.004936110678785735i, 0.1351554976012148 + 0.0i, -0.013446449093342878 + 0.03258736881992591i, 0.03543346433321966 + -0.026430024005613513i, 0.0041756995471579645 + 0.0012187807393314863i, -0.03235234729649451 + -0.023376988513710353i, 0.008855124347950726 + -0.005474733922545829i, -0.013053187942291536 + 0.00019788782136386933i }, { -0.00663842953234759 + 0.02933370226655924i, -0.013446449093342878 + -0.03258736881992591i, 0.12693534244504479 + 0.0i, -0.008668842897647274 + -0.02433758068257962i, 0.006662713797560504 + -0.005873439455901144i, -0.0024177363216637 + 0.010126227817862477i, -0.0303846780624382 + -0.021955200454199138i, -0.002134444644167662 + 0.00732511308097787i }, { -0.017400681042452484 + -0.00019651462241824846i, 0.03543346433321966 + 0.026430024005613513i, -0.008668842897647274 + 0.024337580682579615i, 0.14957511305009874 + 0.0i, 0.004131233772357365 + 0.003056725309039523i, -0.003910320969623713 + -0.012455290641376071i, 0.006284589049109923 + -0.004326323620805168i, -0.03580398940624172 + -0.025871057868663845i }, { -0.019069724048976503 + 0.013779300647556192i, 0.0041756995471579645 + -0.001218780739331486i, 0.006662713797560504 + 0.005873439455901146i, 0.004131233772357365 + -0.003056725309039523i, 0.08247683652023287 + -1.0164395367051604e-20i, -0.014367403878262084 + -0.005110278340751182i, -0.006872662479299215 + -0.030368724103187507i, -0.0180146534857357 + 0.00020344852130258748i }, { 0.0024681640833642974 + -0.0035819072093357064i, -0.03235234729649451 + 0.023376988513710346i, -0.0024177363216636998 + -0.010126227817862477i, -0.003910320969623715 + 0.012455290641376071i, -0.014367403878262084 + 0.005110278340751183i, 0.13992437709983477 + 1.3552527156068805e-20i, -0.013920898868221315 + 0.033737194301223336i, 0.03668371256302051 + -0.027362591321523203i }, { -0.0034846147702089964 + -0.008169853492785581i, 0.008855124347950724 + 0.005474733922545829i, -0.0303846780624382 + 0.021955200454199138i, 0.006284589049109923 + 0.004326323620805169i, -0.006872662479299215 + 0.0303687241031875i, -0.013920898868221315 + -0.033737194301223336i, 0.13141417877046435 + 0.0i, -0.008974717744805363 + -0.02519631740896581i }, { 0.004199213546063681 + -0.0029626453873766467i, -0.013053187942291534 + -0.00019788782136387028i, -0.002134444644167661 + -0.00732511308097787i, -0.03580398940624172 + 0.02587105786866384i, -0.0180146534857357 + -0.00020344852130258758i, 0.03668371256302051 + 0.027362591321523206i, -0.008974717744805363 + 0.025196317408965805i, 0.15485277990633745 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.07966587460677203, 1.0e-7), DoubleNear(0.1351554976012148, 1.0e-7), DoubleNear(0.12693534244504479, 1.0e-7), DoubleNear(0.14957511305009874, 1.0e-7), DoubleNear(0.08247683652023287, 1.0e-7), DoubleNear(0.13992437709983477, 1.0e-7), DoubleNear(0.13141417877046435, 1.0e-7), DoubleNear(0.15485277990633745, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true, false, false}), Matrix({ { 0.19415511841871558 + -1.0164395367051604e-20i, -0.021188325193142565 + -0.02751018166264399i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00868756428910415 + 0.019124630592315804i, 0.0036578845044292077 + -0.0008561320543251424i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.021188325193142565 + 0.027510181662643986i, 0.2675778304567003 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0017617208720402385 + -0.0033180447120561953i, -0.0119728989035373 + 0.026356900625929713i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008687564289104149 + -0.019124630592315804i, -0.0017617208720402382 + 0.0033180447120561957i, 0.0 + 0.0i, 0.0 + 0.0i, 0.22633711392379846 + 6.776263578034403e-21i, -0.02470037572098597 + -0.03207010544843836i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0036578845044292077 + 0.0008561320543251424i, -0.0119728989035373 + -0.026356900625929713i, 0.0 + 0.0i, 0.0 + 0.0i, -0.02470037572098597 + 0.03207010544843836i, 0.31192993720078543 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.19415511841871558, 1.0e-7), DoubleNear(0.2675778304567003, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22633711392379846, 1.0e-7), DoubleNear(0.31192993720078543, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, true, false}), Matrix({ { 0.4204922323425141 + -3.3881317890172014e-21i, -0.045888700914128534 + -0.05958028711108234i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.045888700914128534 + 0.05958028711108234i, 0.5795077676574858 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.4204922323425141, 1.0e-7), DoubleNear(0.5795077676574858, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false, true}), Matrix({ { 0.20660121705181683 + 6.776263578034403e-21i, -0.02254657929106109 + -0.029273691361365352i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0494544021114147 + -0.03573450110175533i, 0.00033371943919663534 + 0.010907020290313577i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02254657929106109 + 0.029273691361365352i, 0.28473061065131355 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.010460288596267887 + -0.003107542881473682i, -0.06815633670273624 + -0.0492480463823742i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.049454402111414705 + 0.03573450110175533i, 0.010460288596267887 + 0.0031075428814736827i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21389101529069723 + -1.0164395367051604e-20i, -0.023342121623067445 + -0.03030659574971699i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0003337194391966362 + -0.010907020290313577i, -0.06815633670273624 + 0.04924804638237419i, 0.0 + 0.0i, 0.0 + 0.0i, -0.023342121623067445 + 0.03030659574971699i, 0.29477715700617224 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.20660121705181683, 1.0e-7), DoubleNear(0.28473061065131355, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21389101529069723, 1.0e-7), DoubleNear(0.29477715700617224, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, true, false}), Matrix({ { 0.19415511841871558 + -1.0164395367051604e-20i, -0.021188325193142565 + -0.02751018166264399i, -0.00868756428910415 + 0.019124630592315804i, 0.0036578845044292077 + -0.0008561320543251424i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.021188325193142565 + 0.027510181662643986i, 0.2675778304567003 + 0.0i, -0.0017617208720402385 + -0.0033180447120561953i, -0.0119728989035373 + 0.026356900625929713i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008687564289104149 + -0.019124630592315804i, -0.0017617208720402382 + 0.0033180447120561957i, 0.22633711392379846 + 6.776263578034403e-21i, -0.02470037572098597 + -0.03207010544843836i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0036578845044292077 + 0.0008561320543251424i, -0.0119728989035373 + -0.026356900625929713i, -0.02470037572098597 + 0.03207010544843836i, 0.31192993720078543 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.19415511841871558, 1.0e-7), DoubleNear(0.2675778304567003, 1.0e-7), DoubleNear(0.22633711392379846, 1.0e-7), DoubleNear(0.31192993720078543, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false, true}), Matrix({ { 0.09232090836626815 + 0.0i, -0.010075064950758697 + -0.01308111257174833i, -0.00017549100634012022 + 0.0088331086032757i, 0.0012707302534291664 + -0.0009390995693183753i, -0.021175042163196475 + -0.016689740127224847i, -5.394708908664468e-05 + 0.004821695690810698i, 0.0002844287685424186 + -0.00011609621393773963i, -4.748984859646861e-05 + -2.7631528860901995e-05i }, { -0.010075064950758697 + 0.013081112571748328i, 0.12723346449802692 + 0.0i, -0.0012324272661982324 + -0.0009888308306304284i, -0.00024185560042709522 + 0.012173483014522951i, 0.004675650425948693 + -0.001178962559850471i, -0.029182706528694306 + -0.023001219285385975i, -1.4590093372044616e-05 + 5.297090033500836e-05i, 0.00039198983485935757 + -0.00015999976360501052i }, { -0.00017549100634012 + -0.0088331086032757i, -0.0012324272661982324 + 0.0009888308306304286i, 0.11428030868554867 + 6.776263578034403e-21i, -0.012471514340302392 + -0.016192578789617024i, -0.0036612082912049686 + 0.003619570003134765i, 0.0009124142677440668 + 0.00012375609309585642i, -0.028279359948218223 + -0.019044760974530485i, 0.00038766652828328 + 0.006085324599502879i }, { 0.0012707302534291666 + 0.0009390995693183752i, -0.00024185560042709522 + -0.012173483014522951i, -0.012471514340302392 + 0.016192578789617024i, 0.15749714615328664 + 0.0i, -0.00011331226615189188 + -0.0009137700459638709i, -0.005045749910635755 + 0.004988365470418586i, 0.0057846381703191944 + -0.0019285803216232105i, -0.03897363017404193 + -0.026246827096988223i }, { -0.02117504216319648 + 0.016689740127224843i, 0.004675650425948693 + 0.001178962559850472i, -0.0036612082912049686 + -0.003619570003134765i, -0.00011331226615189188 + 0.0009137700459638709i, 0.10183421005244743 + -1.0164395367051604e-20i, -0.011113260242383868 + -0.01442906909089566i, -0.00851207328276403 + 0.010291521989040105i, 0.0023871542510000413 + 8.296751499323288e-05i }, { -5.394708908664425e-05 + -0.004821695690810698i, -0.029182706528694306 + 0.023001219285385968i, 0.0009124142677440668 + -0.00012375609309585642i, -0.005045749910635755 + -0.004988365470418586i, -0.011113260242383868 + 0.014429069090895658i, 0.1403443659586734 + 0.0i, -0.000529293605842006 + -0.002329213881425767i, -0.011731043303110204 + 0.014183417611406762i }, { 0.00028442876854241865 + 0.00011609621393773951i, -1.4590093372044642e-05 + -5.297090033500838e-05i, -0.028279359948218223 + 0.019044760974530485i, 0.0057846381703191944 + 0.001928580321623211i, -0.00851207328276403 + -0.010291521989040105i, -0.0005292936058420059 + 0.002329213881425767i, 0.1120568052382498 + 0.0i, -0.012228861380683579 + -0.01587752665882133i }, { -4.748984859646857e-05 + 2.763152886090198e-05i, 0.00039198983485935757 + 0.0001599997636050103i, 0.00038766652828328045 + -0.006085324599502879i, -0.03897363017404193 + 0.02624682709698822i, 0.002387154251000041 + -8.296751499323288e-05i, -0.011731043303110204 + -0.014183417611406762i, -0.012228861380683579 + 0.01587752665882133i, 0.15443279104749882 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.09232090836626815, 1.0e-7), DoubleNear(0.12723346449802692, 1.0e-7), DoubleNear(0.11428030868554867, 1.0e-7), DoubleNear(0.15749714615328664, 1.0e-7), DoubleNear(0.10183421005244743, 1.0e-7), DoubleNear(0.1403443659586734, 1.0e-7), DoubleNear(0.1120568052382498, 1.0e-7), DoubleNear(0.15443279104749882, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true, true}), Matrix({ { 0.20660121705181683 + 6.776263578034403e-21i, -0.02254657929106109 + -0.029273691361365352i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0494544021114147 + -0.03573450110175533i, 0.00033371943919663534 + 0.010907020290313577i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02254657929106109 + 0.029273691361365352i, 0.28473061065131355 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.010460288596267887 + -0.003107542881473682i, -0.06815633670273624 + -0.0492480463823742i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.049454402111414705 + 0.03573450110175533i, 0.010460288596267887 + 0.0031075428814736827i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21389101529069723 + -1.0164395367051604e-20i, -0.023342121623067445 + -0.03030659574971699i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0003337194391966362 + -0.010907020290313577i, -0.06815633670273624 + 0.04924804638237419i, 0.0 + 0.0i, 0.0 + 0.0i, -0.023342121623067445 + 0.03030659574971699i, 0.29477715700617224 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.20660121705181683, 1.0e-7), DoubleNear(0.28473061065131355, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21389101529069723, 1.0e-7), DoubleNear(0.29477715700617224, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false, false, false}), Matrix({ { 0.12208373031605244 + 1.1858461261560205e-20i, -0.004145403940897637 + 0.0063566186693990775i, 0.02300566698067142 + 0.015810764868195718i, -0.001604397123156643 + 0.0006609909856881141i, 0.0371894835548861 + 0.039259094978855436i, -0.003306915071562102 + 0.000603311827367978i, 0.00192370067321853 + 0.012214369934811557i, -0.0007012941699339607 + -0.0003145813578124523i }, { -0.004145403940897637 + -0.0063566186693990775i, 0.12944060529729776 + 2.0328790734103208e-20i, 4.2063103418480546e-05 + -0.0017347132060617576i, 0.024392009087017667 + 0.016763535726294958i, 0.000781346246145862 + -0.0032694296895942627i, 0.039430555157318956 + 0.041624883220159684i, 0.0005706540538231084 + -0.0005149066850621982i, 0.002039624599507218 + 0.012950418811696795i }, { 0.02300566698067142 + -0.01581076486819572i, 4.206310341848011e-05 + 0.001734713206061758i, 0.11643293198247465 + -6.776263578034403e-21i, -0.00395352872852832 + 0.006062394614389951i, 0.01209239912373156 + 0.002581732096276869i, -0.0005450272960430282 + 0.0005419595833957677i, 0.03546812173906897 + 0.0374419386066675i, -0.0031538503664839566 + 0.0005753867839580732i }, { -0.0016043971231566427 + -0.0006609909856881145i, 0.02439200908701767 + -0.016763535726294965i, -0.003953528728528319 + -0.006062394614389951i, 0.12344928479277437 + -6.776263578034403e-21i, -0.0002761776073892647 + -0.0007172871619116224i, 0.012821097930249895 + 0.002737309585744193i, 0.000745180656724257 + -0.0031181000423605087i, 0.037605462536064685 + 0.03969822337673155i }, { 0.0371894835548861 + -0.039259094978855436i, 0.0007813462461458611 + 0.0032694296895942627i, 0.01209239912373156 + -0.002581732096276869i, -0.00027617760738926465 + 0.0007172871619116224i, 0.12635359662359702 + -5.082197683525802e-21i, -0.00429038903082386 + 0.006578940774204613i, 0.023810287891820336 + 0.016363744794615463i, -0.001660510752731634 + 0.0006841090795739566i }, { -0.0033069150715621014 + -0.000603311827367978i, 0.03943055515731896 + -0.041624883220159684i, -0.0005450272960430282 + -0.0005419595833957677i, 0.012821097930249895 + -0.0027373095857441934i, -0.0042903890308238594 + -0.006578940774204614i, 0.1339677775745233 + -6.776263578034403e-21i, 4.353425627080863e-05 + -0.0017953846276561052i, 0.025245117175248195 + 0.017349838718575136i }, { 0.00192370067321853 + -0.012214369934811559i, 0.0005706540538231084 + 0.0005149066850621986i, 0.03546812173906897 + -0.0374419386066675i, 0.0007451806567242562 + 0.0031181000423605096i, 0.023810287891820332 + -0.016363744794615463i, 4.353425627080863e-05 + 0.0017953846276561052i, 0.12050516218115521 + 6.776263578034403e-21i, -0.004091803002013829 + 0.0062744262621779925i }, { -0.0007012941699339607 + 0.00031458135781245206i, 0.002039624599507218 + -0.012950418811696795i, -0.003153850366483956 + -0.000575386783958074i, 0.037605462536064685 + -0.03969822337673155i, -0.001660510752731634 + -0.0006841090795739568i, 0.025245117175248195 + -0.017349838718575136i, -0.004091803002013829 + -0.0062744262621779925i, 0.12776691123212505 + -3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12208373031605244, 1.0e-7), DoubleNear(0.12944060529729776, 1.0e-7), DoubleNear(0.11643293198247465, 1.0e-7), DoubleNear(0.12344928479277437, 1.0e-7), DoubleNear(0.12635359662359702, 1.0e-7), DoubleNear(0.1339677775745233, 1.0e-7), DoubleNear(0.12050516218115521, 1.0e-7), DoubleNear(0.12776691123212505, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false, false, false}), Matrix({ { 0.11278484167642414 + 6.776263578034403e-21i, -0.0038296563018560513 + 0.00587244695398458i, 0.02173073757142075 + 0.013450701876455924i, -0.0014382233191681396 + 0.0006747452700417212i, 0.013510877854232016 + -0.031193585962546944i, 0.0011654106917013429 + 0.0017626715044744832i, 0.00883196691651314 + -0.005102604323936657i, -3.421226188523278e-05 + 0.0006331212329620931i }, { -0.0038296563018560504 + -0.00587244695398458i, 0.11958135729603166 + 1.3552527156068805e-20i, -3.752918174205382e-05 + -0.001588193645548447i, 0.023040251289172642 + 0.014261253223952528i, -0.0020829456680151476 + 0.0003557109179025432i, 0.014325055460069737 + -0.03307333940347709i, -0.0005655739728048309 + -0.0002865991203344928i, 0.009364189156733618 + -0.0054100918326553185i }, { 0.02173073757142075 + -0.013450701876455924i, -3.7529181742054036e-05 + 0.0015881936455484475i, 0.09943225503573253 + 0.0i, -0.0033762636578222854 + 0.005177208519630901i, -0.0019007983163874067 + -0.010691289502111009i, 0.0006212132205031518 + 0.00026405699995537624i, 0.014935075275842025 + -0.023894117694212118i, 0.000736984973221602 + 0.0015889696971001723i }, { -0.0014382233191681394 + -0.0006747452700417214i, 0.023040251289172642 + -0.014261253223952528i, -0.0033762636578222854 + -0.0051772085196309i, 0.10542413181986617 + -1.0164395367051604e-20i, -0.0004921284225336733 + 0.00046199738125648414i, -0.002015342126131932 + -0.011335556187374553i, -0.0017512383834966615 + 3.369975111269959e-05i, 0.015835076294449586 + -0.025333998636647308i }, { 0.013510877854232018 + 0.031193585962546944i, -0.0020829456680151476 + -0.00035571091790254344i, -0.0019007983163874067 + 0.01069128950211101i, -0.0004921284225336734 + -0.0004619973812564842i, 0.13565248526322532 + 0.0i, -0.004606136669865446 + 0.0070631124896191125i, 0.025085217301071 + 0.01872380778635526i, -0.0018266845567201375 + 0.0006703547952203494i }, { 0.0011654106917013433 + -0.0017626715044744827i, 0.014325055460069737 + 0.03307333940347709i, 0.0006212132205031518 + -0.00026405699995537613i, -0.0020153421261319316 + 0.011335556187374553i, -0.0046061366698654455 + -0.0070631124896191125i, 0.1438270255757894 + 0.0i, 0.000123126541431343 + -0.0019419041881694158i, 0.02659687497309322 + 0.01985212122091757i }, { 0.00883196691651314 + 0.005102604323936657i, -0.0005655739728048309 + 0.0002865991203344928i, 0.014935075275842025 + 0.023894117694212118i, -0.0017512383834966615 + -3.369975111269959e-05i, 0.025085217301071 + -0.01872380778635526i, 0.000123126541431343 + 0.001941904188169416i, 0.13750583912789735 + 0.0i, -0.004669068072719863 + 0.007159612356937043i }, { -3.421226188523278e-05 + -0.0006331212329620931i, 0.009364189156733618 + 0.0054100918326553185i, 0.0007369849732216023 + -0.001588969697100172i, 0.015835076294449586 + 0.025333998636647308i, -0.0018266845567201373 + -0.0006703547952203499i, 0.026596874973093224 + -0.01985212122091757i, -0.004669068072719862 + -0.0071596123569370425i, 0.14579206420503327 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.11278484167642414, 1.0e-7), DoubleNear(0.11958135729603166, 1.0e-7), DoubleNear(0.09943225503573253, 1.0e-7), DoubleNear(0.10542413181986617, 1.0e-7), DoubleNear(0.13565248526322532, 1.0e-7), DoubleNear(0.1438270255757894, 1.0e-7), DoubleNear(0.13750583912789735, 1.0e-7), DoubleNear(0.14579206420503327, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false, false, false}), Matrix({ { 0.24843732693964943 + 6.776263578034403e-21i, -0.0084357929717215 + 0.012935559443603691i, 0.04681595487249175 + 0.032174509662811185i, -0.003264907875888277 + 0.001345100065262071i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008435792971721496 + -0.012935559443603691i, 0.26340838287182106 + 1.3552527156068805e-20i, 8.559735968928918e-05 + -0.003530097833717863i, 0.049637126262265865 + 0.0341133744448701i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04681595487249175 + -0.032174509662811185i, 8.559735968928874e-05 + 0.0035300978337178632i, 0.23693809416362985 + 0.0i, -0.008045331730542147 + 0.012336820876567943i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003264907875888276 + -0.0013451000652620715i, 0.049637126262265865 + -0.0341133744448701i, -0.008045331730542147 + -0.012336820876567943i, 0.2512161960248994 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.24843732693964943, 1.0e-7), DoubleNear(0.26340838287182106, 1.0e-7), DoubleNear(0.23693809416362985, 1.0e-7), DoubleNear(0.2512161960248994, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true, false, false}), Matrix({ { 0.11389403494503736 + 0.0i, 0.019364659299260827 + 0.003813234546332319i, 0.02146238677543063 + 0.014750137481417345i, 0.003155266858543604 + 0.0032264420329041455i, -0.018117039095121107 + 0.0265246608362266i, 0.00243390698064302 + -0.03773574856964679i, -0.006849149691147943 + 0.002652059106438079i, 0.005345713958191785 + -0.006795779681123867i }, { 0.01936465929926083 + -0.003813234546332319i, 0.12244199401544337 + 0.0i, 0.0041429521896399115 + 0.00178929715102666i, 0.02307317880504076 + 0.015857162722334155i, 0.01425561254787916 + 0.0014355305950575618i, 0.007542069647249783 + -0.0032451342065111643i, 0.0025004399635574896 + 0.0021167233028355353i, 0.0018415098881114766 + 0.0003652363245635358i }, { 0.02146238677543063 + -0.014750137481417347i, 0.0041429521896399115 + -0.0017892971510266595i, 0.10862230691702146 + 0.0i, 0.018468341794747482 + 0.003636734210340189i, 2.113801393008606e-05 + 0.007344645817203182i, -0.004428414768305508 + -0.007426198343502289i, -0.01727846925405349 + 0.025296933694665326i, 0.0023212505482527613 + -0.035989102193576546i }, { 0.0031552668585436046 + -0.003226442032904146i, 0.02307317880504076 + -0.015857162722334155i, 0.018468341794747482 + -0.003636734210340189i, 0.1167746129979137 + -1.0164395367051604e-20i, 0.002872264065602836 + -0.0015756956208510021i, 0.0010009711239033427 + -0.0015882736067519042i, 0.013595773669912846 + 0.0013690852638627259i, 0.007192975509283367 + -0.0030949291061352436i }, { -0.018117039095121107 + -0.0265246608362266i, 0.01425561254787916 + -0.0014355305950575616i, 2.113801393008606e-05 + -0.007344645817203182i, 0.002872264065602836 + 0.001575695620851002i, 0.1345432919946121 + 6.776263578034403e-21i, -0.027800452270982323 + 0.009122324897271373i, 0.025353568097061126 + 0.017424372181393838i, -0.006420174734431881 + -0.0018813419676420745i }, { 0.0024339069806430195 + 0.03773574856964679i, 0.007542069647249783 + 0.003245134206511165i, -0.004428414768305508 + 0.007426198343502289i, 0.0010009711239033427 + 0.0015882736067519044i, -0.027800452270982323 + -0.009122324897271373i, 0.1409663888563777 + 1.3552527156068805e-20i, -0.004057354829950623 + -0.005319394984744523i, 0.026563947457225102 + 0.018256211722535942i }, { -0.006849149691147943 + -0.0026520591064380793i, 0.0025004399635574896 + -0.0021167233028355353i, -0.01727846925405349 + -0.025296933694665326i, 0.013595773669912846 + -0.0013690852638627259i, 0.025353568097061126 + -0.017424372181393838i, -0.004057354829950623 + 0.005319394984744523i, 0.1283157872466084 + 0.0i, -0.02651367352528963 + 0.008700086666227754i }, { 0.005345713958191785 + 0.006795779681123867i, 0.0018415098881114766 + -0.00036523632456353567i, 0.0023212505482527617 + 0.03598910219357655i, 0.007192975509283367 + 0.0030949291061352436i, -0.006420174734431881 + 0.0018813419676420745i, 0.026563947457225106 + -0.018256211722535946i, -0.02651367352528963 + -0.008700086666227754i, 0.13444158302698572 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.11389403494503736, 1.0e-7), DoubleNear(0.12244199401544337, 1.0e-7), DoubleNear(0.10862230691702146, 1.0e-7), DoubleNear(0.1167746129979137, 1.0e-7), DoubleNear(0.1345432919946121, 1.0e-7), DoubleNear(0.1409663888563777, 1.0e-7), DoubleNear(0.1283157872466084, 1.0e-7), DoubleNear(0.13444158302698572, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, true, false}), Matrix({ { 0.24843732693964943 + 6.776263578034403e-21i, -0.0084357929717215 + 0.012935559443603691i, 0.04681595487249175 + 0.032174509662811185i, -0.003264907875888277 + 0.001345100065262071i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008435792971721496 + -0.012935559443603691i, 0.26340838287182106 + 1.3552527156068805e-20i, 8.559735968928918e-05 + -0.003530097833717863i, 0.049637126262265865 + 0.0341133744448701i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04681595487249175 + -0.032174509662811185i, 8.559735968928874e-05 + 0.0035300978337178632i, 0.23693809416362985 + 0.0i, -0.008045331730542147 + 0.012336820876567943i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003264907875888276 + -0.0013451000652620715i, 0.049637126262265865 + -0.0341133744448701i, -0.008045331730542147 + -0.012336820876567943i, 0.2512161960248994 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24843732693964943, 1.0e-7), DoubleNear(0.26340838287182106, 1.0e-7), DoubleNear(0.23693809416362985, 1.0e-7), DoubleNear(0.2512161960248994, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false, true}), Matrix({ { 0.1271909193572871 + 6.776263578034403e-21i, -0.0059389254140617435 + 0.004257031721692518i, 0.023968074420105068 + 0.016472184410827193i, -0.0016704590149656208 + 3.30666569040728e-05i, -0.03189583539459872 + -0.019150948424916773i, 0.004205179141742803 + -5.7138471583484916e-05i, -0.0035303133635692825 + -0.007739588994210844i, 0.0007998310144631607 + 0.0005338351787005725i }, { -0.0059389254140617435 + -0.004257031721692518i, 0.12429516874638884 + 0.0i, -0.0005678235136767024 + -0.001571338022767402i, 0.023422394221433725 + 0.01609716284237315i, -3.095288754477628e-05 + 0.0006067221900038968i, -0.028302716695181845 + -0.024347003913684512i, -8.440791973456537e-05 + 0.00011032313471404608i, -0.0021802915107873057 + -0.008253406577645506i }, { 0.023968074420105068 + -0.016472184410827196i, -0.0005678235136767024 + 0.001571338022767402i, 0.12130372838360273 + 0.0i, -0.005664034814420473 + 0.004059989677706377i, -0.008490698203800351 + 0.0005219140315099617i, 0.0007850312874758576 + -0.0005553697213563577i, -0.03041949671270172 + -0.018264522795835843i, 0.004010537159350562 + -5.4493745876207445e-05i }, { -0.0016704590149656203 + -3.30666569040728e-05i, 0.023422394221433728 + -0.01609716284237315i, -0.005664034814420473 + -0.004059989677706377i, 0.1185420112158517 + 0.0i, 7.274228957890392e-05 + 0.00011834040000722204i, -0.00848653318816324 + -0.0009225755547038892i, -2.9520194384888288e-05 + 0.0005786392936888598i, -0.02699269001166865 + -0.0232200723496924i }, { -0.03189583539459872 + 0.019150948424916773i, -3.095288754477628e-05 + -0.0006067221900038968i, -0.008490698203800351 + -0.000521914031509962i, 7.274228957890392e-05 + -0.00011834040000722203i, 0.12124640758236233 + 0.0i, -0.002496867557659755 + 0.008678527721911173i, 0.022847880452386685 + 0.01570232525198399i, -0.0015944488609226561 + 0.0013120334083579982i }, { 0.004205179141742803 + 5.713847158348318e-05i, -0.028302716695181848 + 0.02434700391368451i, 0.0007850312874758578 + 0.0005553697213563575i, -0.00848653318816324 + 0.0009225755547038885i, -0.0024968675576597515 + -0.008678527721911173i, 0.13911321412543223 + 1.3552527156068805e-20i, 0.0006534208733659915 + -0.001958759810950461i, 0.026214732040832137 + 0.018016211602496952i }, { -0.0035303133635692825 + 0.007739588994210844i, -8.440791973456536e-05 + -0.00011032313471404608i, -0.03041949671270172 + 0.01826452279583584i, -2.9520194384888288e-05 + -0.0005786392936888598i, 0.022847880452386685 + -0.01570232525198399i, 0.0006534208733659911 + 0.0019587598109504613i, 0.11563436578002712 + 0.0i, -0.002381296916121675 + 0.008276831198861566i }, { 0.0007998310144631607 + -0.0005338351787005728i, -0.0021802915107873057 + 0.008253406577645506i, 0.004010537159350562 + 5.449374587620636e-05i, -0.026992690011668652 + 0.0232200723496924i, -0.001594448860922656 + -0.0013120334083579987i, 0.026214732040832137 + -0.018016211602496952i, -0.002381296916121673 + -0.008276831198861566i, 0.13267418480904775 + -1.0164395367051604e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1271909193572871, 1.0e-7), DoubleNear(0.12429516874638884, 1.0e-7), DoubleNear(0.12130372838360273, 1.0e-7), DoubleNear(0.1185420112158517, 1.0e-7), DoubleNear(0.12124640758236233, 1.0e-7), DoubleNear(0.13911321412543223, 1.0e-7), DoubleNear(0.11563436578002712, 1.0e-7), DoubleNear(0.13267418480904775, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false, false, false}), Matrix({ { 0.10428487185323886 + 1.1858461261560205e-20i, -0.0035410362841737262 + 0.005429873101371198i, 0.03176754606669718 + 0.03353542423994679i, -0.0028247925712510213 + 0.0005153536547559132i, 0.01397852775705737 + -0.027070458532972807i, 0.0009348496949788013 + 0.0016470184477093838i, 0.012963364788351797 + -0.003751130657383929i, -0.0002448637196410654 + 0.000802343753653548i }, { -0.0035410362841737254 + -0.005429873101371198i, 0.11056917167495384 + 0.0i, 0.0006674320398089651 + -0.0027927722664588452i, 0.03368188685779695 + 0.03555629895386331i, -0.0018841431659767697 + 0.0001913589543241184i, 0.014820886365074256 + -0.028701748620493017i, -0.0006354891880200682 + -0.0005476013441664639i, 0.01374454876624375 + -0.003977177151976187i }, { 0.03176754606669718 + -0.03353542423994679i, 0.0006674320398089642 + 0.002792772266458846i, 0.10793222485891782 + -5.082197683525802e-21i, -0.003664883675504612 + 0.005619782372244282i, -0.004447009221614173 + -0.012741425227482337i, 0.0008144167185165116 + 0.00020109487518114681i, 0.014467425373016672 + -0.028017245123786262i, 0.0009675459699441438 + 0.0017046227538652715i }, { -0.0028247925712510213 + -0.0005153536547559136i, 0.03368188685779695 + -0.03555629895386331i, -0.0036648836755046113 + -0.005619782372244282i, 0.11443631744094396 + 3.3881317890172014e-21i, -0.0005124166157220834 + 0.0006641859319160942i, -0.004714989982024792 + -0.013509234928568672i, -0.0019500408855350393 + 0.0001980517146911243i, 0.015339245389445068 + -0.029705589419631376i }, { 0.01397852775705737 + 0.027070458532972807i, -0.0018841431659767697 + -0.00019135895432411884i, -0.004447009221614174 + 0.012741425227482337i, -0.0005124166157220833 + -0.0006641859319160943i, 0.1342317904452882 + -6.776263578034403e-21i, -0.0045578963852522325 + 0.00698914018241783i, 0.04089005922725789 + 0.04316560934557614i, -0.003635972866795037 + 0.0006633449565701377i }, { 0.0009348496949788015 + -0.0016470184477093835i, 0.014820886365074256 + 0.028701748620493017i, 0.0008144167185165116 + -0.00020109487518114681i, -0.0047149899820247915 + 0.013509234928568672i, -0.004557896385252232 + -0.00698914018241783i, 0.14232071841511829 + 1.3552527156068805e-20i, 0.0008590948630611541 + -0.0035947574654959266i, 0.04335413083558668 + 0.04576680764302792i }, { 0.012963364788351797 + 0.0037511306573839286i, -0.0006354891880200683 + 0.0005476013441664637i, 0.014467425373016672 + 0.028017245123786262i, -0.0019500408855350395 + -0.0001980517146911245i, 0.040890059227257886 + -0.04316560934557614i, 0.0008590948630611533 + 0.003594757465495927i, 0.13892653394583443 + 6.776263578034403e-21i, -0.004717308357333079 + 0.0072335846641383246i }, { -0.0002448637196410654 + -0.0008023437536535481i, 0.013744548766243748 + 0.003977177151976186i, 0.000967545969944144 + -0.001704622753865271i, 0.015339245389445068 + 0.029705589419631376i, -0.0036359728667950367 + -0.0006633449565701382i, 0.04335413083558668 + -0.04576680764302792i, -0.004717308357333078 + -0.0072335846641383246i, 0.1472983713657044 + -1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10428487185323886, 1.0e-7), DoubleNear(0.11056917167495384, 1.0e-7), DoubleNear(0.10793222485891782, 1.0e-7), DoubleNear(0.11443631744094396, 1.0e-7), DoubleNear(0.1342317904452882, 1.0e-7), DoubleNear(0.14232071841511829, 1.0e-7), DoubleNear(0.13892653394583443, 1.0e-7), DoubleNear(0.1472983713657044, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false, false, false}), Matrix({ { 0.23851666229852708 + 5.082197683525802e-21i, -0.008098932669425957 + 0.012419013283789028i, 0.07265760529395507 + 0.07670103358552294i, -0.006460765438046058 + 0.0011786986113260507i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008098932669425957 + -0.012419013283789028i, 0.2528898900900721 + 1.3552527156068805e-20i, 0.0015265269028701192 + -0.006387529731954772i, 0.07703601769338364 + 0.08132310659689124i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07265760529395507 + -0.07670103358552294i, 0.001526526902870117 + 0.006387529731954772i, 0.24685875880475225 + 1.6940658945086007e-21i, -0.008382192032837691 + 0.012853367036382606i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006460765438046058 + -0.0011786986113260516i, 0.07703601769338364 + -0.08132310659689124i, -0.008382192032837691 + -0.012853367036382606i, 0.26173468880664835 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.23851666229852708, 1.0e-7), DoubleNear(0.2528898900900721, 1.0e-7), DoubleNear(0.24685875880475225, 1.0e-7), DoubleNear(0.26173468880664835, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true, false, false}), Matrix({ { 0.10934598840455728 + -8.470329472543003e-21i, 0.01859138463412073 + 0.003660963462119217i, 0.03330927738722081 + 0.035162953599287984i, 0.0044860840950870316 + 0.007093740282729785i, -0.01739358472790977 + 0.025465471107705494i, 0.002336715567339367 + -0.03622887473891957i, -0.013487544800892438 + 0.0021640174611122923i, 0.0123621229103111 + -0.010284710335012076i }, { 0.01859138463412073 + -0.0036609634621192167i, 0.1175526081265322 + 0.0i, 0.006840633909405078 + 0.004863314654072212i, 0.03580920058256784 + 0.037801998640640225i, 0.01368635368052852 + 0.0013782066100064083i, 0.007240897739662283 + -0.003115548654393013i, 0.0037259778985130774 + 0.004821024468964447i, 0.0032076253480465026 + 0.0013794257941710485i }, { 0.03330927738722081 + -0.035162953599287984i, 0.006840633909405076 + -0.004863314654072211i, 0.11317035345750154 + 8.470329472543003e-21i, 0.019241616459887582 + 0.003789005294553291i, 0.0028905810363593514 + 0.01335070700750785i, -0.01093848939355924 + -0.011787569694883454i, -0.018001923621264827 + 0.026356123423186432i, 0.0024184419615564143 + -0.03749597602430376i }, { 0.0044860840950870316 + -0.007093740282729786i, 0.03580920058256784 + -0.037801998640640225i, 0.019241616459887582 + -0.0037890052945532913i, 0.12166399888682485 + -1.0164395367051604e-20i, 0.00461237191780876 + -0.003981358250945398i, 0.0012038592406804678 + -0.0032775598886493475i, 0.014165032537263486 + 0.0014264092489138789i, 0.007494147416870868 + -0.003224514658253395i }, { -0.01739358472790977 + -0.025465471107705494i, 0.01368635368052852 + -0.0013782066100064083i, 0.0028905810363593514 + -0.01335070700750785i, 0.00461237191780876 + 0.003981358250945398i, 0.1291706738939698 + 1.3552527156068805e-20i, -0.026690317303546686 + 0.008758049821669812i, 0.03934832790673426 + 0.041538079986234946i, -0.01094684953313309 + -0.005915041671403734i }, { 0.002336715567339367 + 0.03622887473891957i, 0.007240897739662283 + 0.003115548654393014i, -0.01093848939355924 + 0.011787569694883454i, 0.0012038592406804676 + 0.003277559888649347i, -0.026690317303546686 + -0.008758049821669812i, 0.13533728196353992 + 1.3552527156068805e-20i, -0.0053141070065349585 + -0.011250844386026984i, 0.0412268171108158 + 0.04352110795625101i }, { -0.013487544800892438 + -0.002164017461112292i, 0.0037259778985130774 + -0.004821024468964447i, -0.018001923621264827 + -0.026356123423186432i, 0.014165032537263486 + -0.0014264092489138789i, 0.03934832790673426 + -0.041538079986234946i, -0.0053141070065349585 + 0.011250844386026984i, 0.13368840534725068 + -6.776263578034403e-21i, -0.02762380849272527 + 0.009064361741829315i }, { 0.0123621229103111 + 0.010284710335012076i, 0.0032076253480465026 + -0.0013794257941710485i, 0.0024184419615564143 + 0.03749597602430376i, 0.007494147416870868 + 0.003224514658253395i, -0.01094684953313309 + 0.005915041671403734i, 0.0412268171108158 + -0.04352110795625101i, -0.02762380849272527 + -0.009064361741829315i, 0.14007068991982352 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10934598840455728, 1.0e-7), DoubleNear(0.1175526081265322, 1.0e-7), DoubleNear(0.11317035345750154, 1.0e-7), DoubleNear(0.12166399888682485, 1.0e-7), DoubleNear(0.1291706738939698, 1.0e-7), DoubleNear(0.13533728196353992, 1.0e-7), DoubleNear(0.13368840534725068, 1.0e-7), DoubleNear(0.14007068991982352, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, true, false}), Matrix({ { 0.23851666229852708 + 5.082197683525802e-21i, -0.008098932669425957 + 0.012419013283789028i, 0.07265760529395507 + 0.07670103358552294i, -0.006460765438046058 + 0.0011786986113260507i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008098932669425957 + -0.012419013283789028i, 0.2528898900900721 + 1.3552527156068805e-20i, 0.0015265269028701192 + -0.006387529731954772i, 0.07703601769338364 + 0.08132310659689124i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07265760529395507 + -0.07670103358552294i, 0.001526526902870117 + 0.006387529731954772i, 0.24685875880475225 + 1.6940658945086007e-21i, -0.008382192032837691 + 0.012853367036382606i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006460765438046058 + -0.0011786986113260516i, 0.07703601769338364 + -0.08132310659689124i, -0.008382192032837691 + -0.012853367036382606i, 0.26173468880664835 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.23851666229852708, 1.0e-7), DoubleNear(0.2528898900900721, 1.0e-7), DoubleNear(0.24685875880475225, 1.0e-7), DoubleNear(0.26173468880664835, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false, true}), Matrix({ { 0.12211189813337013 + 1.1858461261560205e-20i, -0.005701770683380481 + 0.004087038812020815i, 0.03719806411329631 + 0.039268153049186016i, -0.0030511793094982523 + -0.0005885427479374043i, -0.030622162511799098 + -0.018386207718584898i, 0.004037256822923106 + -5.485680311736194e-05i, -0.003415660161621742 + -0.015448184219250706i, 0.0012474809237275277 + 0.0012815708733892714i }, { -0.005701770683380481 + -0.004087038812020815i, 0.11933178139701447 + 1.3552527156068805e-20i, -0.00042259899846075304 + -0.003078552879415897i, 0.036351177264576165 + 0.03837413656785524i, -2.9716868703369816e-05 + 0.0005824944000356925i, -0.02717252517273883 + -0.023374772953791624i, -0.00019636816399316018 + 0.00016788484826749995i, -0.0007606234369953793 + -0.01585849708166688i }, { 0.03719806411329631 + -0.039268153049186016i, -0.00042259899846075347 + 0.0030785528794158978i, 0.12638274960751975 + -5.082197683525802e-21i, -0.0059011895451017374 + 0.00422998258737808i, -0.015240755499980333 + 0.004246469333624776i, 0.0012121997533660793 + -0.001314992135536575i, -0.03169316959550134 + -0.019029263502167718i, 0.004178459478170259 + -5.677541434233064e-05i }, { -0.0030511793094982523 + 0.0005885427479374043i, 0.036351177264576165 + -0.03837413656785524i, -0.0059011895451017374 + -0.00422998258737808i, 0.12350539856522606 + -1.3552527156068805e-20i, 0.0001782632945386371 + 0.00018699726181973186i, -0.0157941160920183 + 0.001617521120107015i, -3.0756213226294966e-05 + 0.0006028670836570639i, -0.02812288153411166 + -0.02419230330958529i }, { -0.030622162511799098 + 0.018386207718584895i, -2.9716868703369816e-05 + -0.0005824944000356925i, -0.015240755499980333 + -0.004246469333624777i, 0.00017826329453863687 + -0.00018699726181973186i, 0.11640476416515695 + -6.776263578034403e-21i, -0.0023971619860454763 + 0.008331974471768214i, 0.03545954118065876 + 0.037432880536336914i, -0.0034095861285478057 + 0.001767241359263455i }, { 0.004037256822923106 + 5.485680311736064e-05i, -0.027172525172738833 + 0.023374772953791624i, 0.0012121997533660795 + 0.0013149921355365749i, -0.0157941160920183 + -0.0016175211201070164i, -0.0023971619860454763 + -0.008331974471768214i, 0.13355810869305768 + 0.0i, 0.0019491259013308723 + -0.003308976852538875i, 0.040684840428807476 + 0.042948970029036i }, { -0.003415660161621743 + 0.015448184219250705i, -0.00019636816399316018 + -0.00016788484826749995i, -0.03169316959550134 + 0.019029263502167715i, -3.0756213226294966e-05 + -0.0006028670836570639i, 0.03545954118065876 + -0.037432880536336914i, 0.0019491259013308705 + 0.0033089768525388745i, 0.1204760091972325 + 6.776263578034403e-21i, -0.0024810024877359536 + 0.008623384449004526i }, { 0.0012474809237275272 + -0.0012815708733892718i, -0.0007606234369953806 + 0.01585849708166688i, 0.004178459478170259 + 5.677541434232977e-05i, -0.02812288153411166 + 0.024192303309585286i, -0.0034095861285478053 + -0.001767241359263456i, 0.040684840428807476 + -0.042948970029036i, -0.0024810024877359536 + -0.008623384449004526i, 0.1382292902414223 + 3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12211189813337013, 1.0e-7), DoubleNear(0.11933178139701447, 1.0e-7), DoubleNear(0.12638274960751975, 1.0e-7), DoubleNear(0.12350539856522606, 1.0e-7), DoubleNear(0.11640476416515695, 1.0e-7), DoubleNear(0.13355810869305768, 1.0e-7), DoubleNear(0.1204760091972325, 1.0e-7), DoubleNear(0.1382292902414223, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false, false, false}), Matrix({ { 0.21221709671215666 + 6.776263578034403e-21i, -0.0072059199596783375 + 0.01104965547361548i, 0.028445953130074045 + -0.055087703656759066i, 0.001902395664922945 + 0.0033516412015746552i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007205919959678336 + -0.011049655473615479i, 0.2250054891158978 + 3.3881317890172014e-21i, -0.0038341840515118087 + 0.0003894106690152427i, 0.030160131754519322 + -0.05840733804012439i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02844595313007404 + 0.055087703656759066i, -0.003834184051511809 + -0.00038941066901524357i, 0.27315832439112264 + 0.0i, -0.009275204742585313 + 0.014222724846556154i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0019023956649229453 + -0.0033516412015746544i, 0.030160131754519322 + 0.05840733804012439i, -0.009275204742585311 + -0.014222724846556154i, 0.2896190897808226 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21221709671215666, 1.0e-7), DoubleNear(0.2250054891158978, 1.0e-7), DoubleNear(0.27315832439112264, 1.0e-7), DoubleNear(0.2896190897808226, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true, false, false}), Matrix({ { 0.09728917037792875 + 0.0i, 0.01654144256795793 + 0.00325729460413057i, 0.013040811619377018 + -0.025254501497872346i, 0.0030627785882333903 + -0.003857244535341594i, -0.015475715687124612 + 0.022657571562529538i, 0.002079062270803556 + -0.03223416989048392i, 0.003807101865237508 + 0.007054275463904391i, -0.008088723845690465 + -0.004860411663950721i }, { 0.01654144256795793 + -0.00325729460413057i, 0.10459090349139351 + -1.0164395367051604e-20i, 0.0013717095588753397 + -0.0047304715380238295i, 0.01401954877642922 + -0.027149898787567947i, 0.012177255101038863 + 0.0012262413980914987i, 0.0064424945456325764 + -0.0027720188758688443i, 0.0019505706986854112 + -0.0029966266850077507i, 0.00014399755719241318 + -0.0020439208531208425i }, { 0.013040811619377018 + 0.025254501497872346i, 0.0013717095588753393 + 0.004730471538023829i, 0.1252271714841301 + 0.0i, 0.02129155852605038 + 0.004192674152541938i, -0.007955886198927627 + -0.0009801539280395264i, 0.008646086177246623 + -0.003781038059916169i, -0.019919792662049986 + 0.029164022968362388i, 0.0026760952580922254 + -0.04149068087273941i }, { 0.0030627785882333908 + 0.003857244535341594i, 0.01401954877642922 + 0.02714989878756795i, 0.02129155852605038 + -0.004192674152541938i, 0.13462570352196357 + 0.0i, 0.0013139507109816136 + 0.003325361795200869i, 0.0015831290572517834 + 0.0013007882757715395i, 0.015674131116753143 + 0.001578374460828789i, 0.008292550610900576 + -0.003568044436777564i }, { -0.015475715687124612 + -0.022657571562529538i, 0.012177255101038863 + -0.0012262413980914982i, -0.007955886198927627 + 0.0009801539280395264i, 0.0013139507109816136 + -0.003325361795200869i, 0.11492792633422794 + 6.776263578034403e-21i, -0.02374736252763627 + 0.00779236086948491i, 0.015405141510697024 + -0.02983320215888672i, -0.0011603829233104454 + 0.0072088857369162485i }, { 0.002079062270803556 + 0.03223416989048393i, 0.0064424945456325764 + 0.0027720188758688443i, 0.008646086177246623 + 0.003781038059916169i, 0.0015831290572517836 + -0.0013007882757715395i, -0.02374736252763627 + -0.007792360869484909i, 0.1204145856245043 + 1.3552527156068805e-20i, -0.0052058936103871484 + 0.005119882207039073i, 0.016140582978090103 + -0.031257439252556446i }, { 0.003807101865237508 + -0.007054275463904391i, 0.0019505706986854112 + 0.0029966266850077507i, -0.019919792662049986 + -0.029164022968362388i, 0.015674131116753143 + -0.001578374460828789i, 0.015405141510697024 + 0.02983320215888672i, -0.0052058936103871484 + -0.005119882207039073i, 0.14793115290699255 + 0.0i, -0.03056676326863569 + 0.010030050694014216i }, { -0.008088723845690465 + 0.004860411663950721i, 0.00014399755719241307 + 0.0020439208531208425i, 0.0026760952580922254 + 0.04149068087273941i, 0.008292550610900576 + 0.0035680444367775645i, -0.0011603829233104454 + -0.0072088857369162485i, 0.016140582978090103 + 0.031257439252556446i, -0.03056676326863569 + -0.010030050694014216i, 0.1549933862588591 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.09728917037792875, 1.0e-7), DoubleNear(0.10459090349139351, 1.0e-7), DoubleNear(0.1252271714841301, 1.0e-7), DoubleNear(0.13462570352196357, 1.0e-7), DoubleNear(0.11492792633422794, 1.0e-7), DoubleNear(0.1204145856245043, 1.0e-7), DoubleNear(0.14793115290699255, 1.0e-7), DoubleNear(0.1549933862588591, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, true, false}), Matrix({ { 0.21221709671215666 + 6.776263578034403e-21i, -0.0072059199596783375 + 0.01104965547361548i, 0.028445953130074045 + -0.055087703656759066i, 0.001902395664922945 + 0.0033516412015746552i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007205919959678336 + -0.011049655473615479i, 0.2250054891158978 + 3.3881317890172014e-21i, -0.0038341840515118087 + 0.0003894106690152427i, 0.030160131754519322 + -0.05840733804012439i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02844595313007404 + 0.055087703656759066i, -0.003834184051511809 + -0.00038941066901524357i, 0.27315832439112264 + 0.0i, -0.009275204742585313 + 0.014222724846556154i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0019023956649229453 + -0.0033516412015746544i, 0.030160131754519322 + 0.05840733804012439i, -0.009275204742585311 + -0.014222724846556154i, 0.2896190897808226 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.21221709671215666, 1.0e-7), DoubleNear(0.2250054891158978, 1.0e-7), DoubleNear(0.27315832439112264, 1.0e-7), DoubleNear(0.2896190897808226, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false, true}), Matrix({ { 0.10864747244970341 + 6.776263578034403e-21i, -0.00507307627435707 + 0.0036363896026324503i, 0.01456329841886972 + -0.02820291040680467i, 0.00026393661845565994 + 0.0018043065170590216i, -0.02724567064068789 + -0.016358889077112616i, 0.003592096725593741 + -4.880812677944633e-05i, -0.007898528109399939 + 0.004879706933512718i, 0.000468821263754312 + -0.0009389853913746548i }, { -0.00507307627435707 + -0.0036363896026324503i, 0.10617389975828344 + 0.0i, -0.0016239447625816398 + 0.0008294503928187188i, 0.014231736382002346 + -0.027560815865368085i, -2.644019725427972e-05 + 0.0005182668130411265i, -0.02417640070478312 + -0.020797400084153927i, 0.00013098856044478603 + 7.633279068737148e-05i, -0.008639274603100594 + 0.0034880343806367327i }, { 0.01456329841886972 + 0.02820291040680467i, -0.0016239447625816398 + -0.0008294503928187188i, 0.13984717529118645 + 0.0i, -0.006529883954125147 + 0.0046806317967664456i, 0.0005944128232157854 + -0.009265255498233694i, 0.0004941606701049186 + 0.0009259007369500587i, -0.03506966146661255 + -0.02105658214364i, 0.004623619575499624 + -6.282409068024582e-05i }, { 0.00026393661845565994 + -0.0018043065170590216i, 0.014231736382002346 + 0.027560815865368085i, -0.006529883954125147 + -0.0046806317967664456i, 0.13666328020395707 + 0.0i, -0.00013807674159039196 + 6.260600077707891e-05i, 0.002157980004721005 + -0.009063474599043522i, -3.403288467538528e-05 + 0.0006670946706516297i, -0.03111900600206737 + -0.026769676179222983i }, { -0.02724567064068789 + 0.016358889077112613i, -2.644019725427972e-05 + -0.0005182668130411263i, 0.0005944128232157849 + 0.009265255498233694i, -0.00013807674159039196 + -6.260600077707891e-05i, 0.10356962426245327 + 0.0i, -0.0021328436853212673 + 0.00741326587098303i, 0.013882654711204322 + -0.026884793249954395i, 0.001638459046467285 + 0.0015473346845156334i }, { 0.003592096725593741 + 4.880812677944568e-05i, -0.02417640070478312 + 0.020797400084153927i, 0.0004941606701049184 + -0.0009259007369500589i, 0.002157980004721005 + 0.009063474599043522i, -0.0021328436853212656 + -0.007413265870983029i, 0.11883158935761437 + 3.3881317890172014e-21i, -0.002210239288930169 + -0.00044003972380347606i, 0.015928395372516974 + -0.030846522174756308i }, { -0.007898528109399939 + -0.004879706933512718i, 0.00013098856044478603 + -7.633279068737151e-05i, -0.03506966146661255 + 0.02105658214364i, -3.403288467538528e-05 + -0.0006670946706516297i, 0.01388265471120432 + 0.026884793249954395i, -0.0022102392889301694 + 0.0004400397238034752i, 0.1333111490999362 + 0.0i, -0.002745320788460166 + 0.009542093049789709i }, { 0.0004688212637543122 + 0.0009389853913746547i, -0.008639274603100593 + -0.0034880343806367336i, 0.004623619575499624 + 6.282409068024452e-05i, -0.03111900600206737 + 0.026769676179222983i, 0.0016384590464672854 + -0.001547334684515633i, 0.015928395372516974 + 0.03084652217475631i, -0.0027453207884601642 + -0.009542093049789709i, 0.15295580957686558 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.10864747244970341, 1.0e-7), DoubleNear(0.10617389975828344, 1.0e-7), DoubleNear(0.13984717529118645, 1.0e-7), DoubleNear(0.13666328020395707, 1.0e-7), DoubleNear(0.10356962426245327, 1.0e-7), DoubleNear(0.11883158935761437, 1.0e-7), DoubleNear(0.1333111490999362, 1.0e-7), DoubleNear(0.15295580957686558, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true, false, false}), Matrix({ { 0.22251634186205882 + 0.0i, 0.037833001094008306 + 0.007449968756672508i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0353955083491746 + 0.051821594530891926i, 0.004755157528895782 + -0.07372485076322333i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.037833001094008306 + -0.007449968756672508i, 0.23921660701335706 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027851386217792005 + 0.002804615858920287i, 0.014735045156533151 + -0.006340063312646409i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0353955083491746 + -0.051821594530891926i, 0.027851386217792005 + -0.002804615858920287i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2628590792412205 + 6.776263578034403e-21i, -0.054314125796271956 + 0.017822411563499126i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004755157528895781 + 0.07372485076322333i, 0.014735045156533151 + 0.006340063312646409i, 0.0 + 0.0i, 0.0 + 0.0i, -0.054314125796271956 + -0.017822411563499126i, 0.2754079718833634 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.22251634186205882, 1.0e-7), DoubleNear(0.23921660701335706, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2628590792412205, 1.0e-7), DoubleNear(0.2754079718833634, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, true, false}), Matrix({ { 0.4853754211032793 + 6.776263578034403e-21i, -0.01648112470226365 + 0.025272380320171636i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01648112470226365 + -0.025272380320171636i, 0.5146245788967205 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.4853754211032793, 1.0e-7), DoubleNear(0.5146245788967205, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false, true}), Matrix({ { 0.24849464774088986 + 6.776263578034403e-21i, -0.011602960228482218 + 0.008317021399398897i, 0.0 + 0.0i, 0.0 + 0.0i, -0.062315332107300433 + -0.037415471220752616i, 0.008215716301093365 + -0.00011163221745969301i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011602960228482218 + -0.008317021399398897i, 0.24283717996224052 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -6.0473081929664566e-05 + 0.0011853614836927562i, -0.05529540670685049 + -0.04756707626337692i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.062315332107300433 + 0.037415471220752616i, -6.0473081929664566e-05 + -0.0011853614836927562i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23688077336238944 + 0.0i, -0.0048781644737814316 + 0.01695535892077274i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.008215716301093365 + 0.00011163221745969041i, -0.05529540670685049 + 0.04756707626337691i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0048781644737814316 + -0.01695535892077274i, 0.27178739893447995 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.24849464774088986, 1.0e-7), DoubleNear(0.24283717996224052, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23688077336238944, 1.0e-7), DoubleNear(0.27178739893447995, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, true, false}), Matrix({ { 0.22251634186205882 + 0.0i, 0.037833001094008306 + 0.007449968756672508i, -0.0353955083491746 + 0.051821594530891926i, 0.004755157528895782 + -0.07372485076322333i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.037833001094008306 + -0.007449968756672508i, 0.23921660701335706 + -1.0164395367051604e-20i, 0.027851386217792005 + 0.002804615858920287i, 0.014735045156533151 + -0.006340063312646409i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0353955083491746 + -0.051821594530891926i, 0.027851386217792005 + -0.002804615858920287i, 0.2628590792412205 + 6.776263578034403e-21i, -0.054314125796271956 + 0.017822411563499126i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004755157528895781 + 0.07372485076322333i, 0.014735045156533151 + 0.006340063312646409i, -0.054314125796271956 + -0.017822411563499126i, 0.2754079718833634 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.22251634186205882, 1.0e-7), DoubleNear(0.23921660701335706, 1.0e-7), DoubleNear(0.2628590792412205, 1.0e-7), DoubleNear(0.2754079718833634, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false, true}), Matrix({ { 0.1130729209545299 + 0.0i, 0.0141531583405279 + 0.001618231968049221i, -0.01887597857388859 + 0.022032957550776153i, 0.0028565075743775077 + -0.035663184210145756i, -0.02831017855588017 + -0.017103236043435475i, 0.0012976520508857989 + -0.0040604828631268745i, 0.010349903214301182 + -0.0021165314335656214i, -0.00819659062749297 + 0.00804323189409698i }, { 0.0141531583405279 + -0.001618231968049221i, 0.10648145190976518 + 0.0i, 0.00637095070594217 + 0.006263486409411505i, 0.018458631967121376 + -0.0010263659329775021i, -0.003949212199450115 + -0.003964311634133303i, -0.022047570136010615 + -0.022587723369175347i, -7.952710993523393e-05 + -0.006231024550589182i, -0.009673484610899405 + 0.0018404354560228712i }, { -0.01887597857388859 + -0.022032957550776153i, 0.00637095070594217 + -0.006263486409411505i, 0.13542172678635997 + 6.776263578034403e-21i, -0.025756118569010118 + 0.006698789431349675i, -0.000847485520745456 + 0.00490939929946448i, 0.0030179745911281817 + 0.0008950071196635011i, -0.03400515355142027 + -0.02031223517731714i, 0.006918064250207566 + 0.0039488506456671815i }, { 0.0028565075743775064 + 0.035663184210145756i, 0.018458631967121376 + 0.0010263659329775021i, -0.025756118569010118 + -0.006698789431349675i, 0.13635572805247534 + 0.0i, 0.0050794780847993335 + -0.007964096556343054i, -0.007859472681095266 + 0.0036985361740888715i, 0.0038887391175204504 + 0.005149673117826059i, -0.03324783657083988 + -0.02497935289420157i }, { -0.02831017855588017 + 0.017103236043435475i, -0.003949212199450115 + 0.003964311634133303i, -0.0008474855207454561 + -0.00490939929946448i, 0.0050794780847993335 + 0.007964096556343052i, 0.10944342090752893 + 0.0i, 0.02367984275348041 + 0.005831736788623287i, -0.01651952977528601 + 0.029788636980115774i, 0.001898649954518274 + -0.03806166655307758i }, { 0.0012976520508857989 + 0.0040604828631268745i, -0.022047570136010615 + 0.02258772336917534i, 0.0030179745911281817 + -0.0008950071196635009i, -0.007859472681095266 + -0.0036985361740888715i, 0.02367984275348041 + -0.005831736788623287i, 0.13273515510359188 + -1.0164395367051604e-20i, 0.021480435511849836 + -0.003458870550491218i, -0.0037235868105882242 + -0.005313697379668907i }, { 0.010349903214301182 + 0.0021165314335656214i, -7.952710993523393e-05 + 0.006231024550589182i, -0.03400515355142027 + 0.020312235177317138i, 0.0038887391175204504 + -0.005149673117826059i, -0.01651952977528601 + -0.029788636980115774i, 0.021480435511849836 + 0.003458870550491218i, 0.12743735245486051 + 0.0i, -0.02855800722726184 + 0.011123622132149453i }, { -0.00819659062749297 + -0.00804323189409698i, -0.009673484610899405 + -0.0018404354560228717i, 0.006918064250207566 + -0.003948850645667184i, -0.03324783657083988 + 0.02497935289420157i, 0.0018986499545182748 + 0.03806166655307758i, -0.0037235868105882242 + 0.005313697379668907i, -0.02855800722726184 + -0.01112362213214945i, 0.13905224383088807 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1130729209545299, 1.0e-7), DoubleNear(0.10648145190976518, 1.0e-7), DoubleNear(0.13542172678635997, 1.0e-7), DoubleNear(0.13635572805247534, 1.0e-7), DoubleNear(0.10944342090752893, 1.0e-7), DoubleNear(0.13273515510359188, 1.0e-7), DoubleNear(0.12743735245486051, 1.0e-7), DoubleNear(0.13905224383088807, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true, true}), Matrix({ { 0.24849464774088986 + 6.776263578034403e-21i, -0.011602960228482218 + 0.008317021399398897i, 0.0 + 0.0i, 0.0 + 0.0i, -0.062315332107300433 + -0.037415471220752616i, 0.008215716301093365 + -0.00011163221745969301i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011602960228482218 + -0.008317021399398897i, 0.24283717996224052 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -6.0473081929664566e-05 + 0.0011853614836927562i, -0.05529540670685049 + -0.04756707626337692i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.062315332107300433 + 0.037415471220752616i, -6.0473081929664566e-05 + -0.0011853614836927562i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23688077336238944 + 0.0i, -0.0048781644737814316 + 0.01695535892077274i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.008215716301093365 + 0.00011163221745969041i, -0.05529540670685049 + 0.04756707626337691i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0048781644737814316 + -0.01695535892077274i, 0.27178739893447995 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.24849464774088986, 1.0e-7), DoubleNear(0.24283717996224052, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23688077336238944, 1.0e-7), DoubleNear(0.27178739893447995, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false, false, false}), Matrix({ { 0.11418627272869779 + 1.8634724839594607e-20i, 0.02200075728301258 + 0.013617836315839377i, 0.03478373818398374 + 0.036719468800078106i, 0.0023227736497522964 + 0.011223199978854317i, 0.013678760022499981 + -0.031581188226733295i, 0.008941710322679063 + -0.005166007774619742i, 0.014322587330185122 + -0.005221599468129485i, 0.004385108298191791 + 0.0013017483430545086i }, { 0.02200075728301258 + -0.013617836315839377i, 0.10066777079949492 + -6.776263578034403e-21i, 0.011081089404783723 + 0.002926594060769113i, 0.030665694740510407 + 0.032372254393731995i, -0.001924417073527992 + -0.01082413630026578i, 0.015120654099631644 + -0.024191018926732533i, 0.002894552100043713 + -0.003916123060504837i, 0.012385326224410425 + -0.0025067083412306304i }, { 0.03478373818398374 + -0.036719468800078106i, 0.011081089404783723 + -0.002926594060769113i, 0.11817992624375802 + 1.6940658945086007e-21i, 0.02277023157758081 + 0.014094118784569076i, -0.005988863916081543 + -0.014019098324464593i, 0.0010625887559029567 + -0.004449115493145157i, 0.014157173291801774 + -0.032685737139290745i, 0.009254445750567695 + -0.005346688381972235i }, { 0.0023227736497522964 + -0.011223199978854317i, 0.030665694740510407 + -0.032372254393731995i, 0.02277023157758081 + -0.014094118784569076i, 0.10418861605610376 + -3.3881317890172014e-21i, -0.004066994601979632 + -0.002678433607979442i, -0.003173135287557422 + -0.012231561831586418i, -0.001991723368991347 + -0.011202709389219783i, 0.015649497470659968 + -0.025037097404126893i }, { 0.013678760022499981 + 0.031581188226733295i, -0.0019244170735279917 + 0.01082413630026578i, -0.005988863916081544 + 0.014019098324464593i, -0.004066994601979632 + 0.002678433607979442i, 0.1373380628846524 + 1.3552527156068805e-20i, 0.025396918784676502 + 0.018956464278651303i, 0.04183630052822132 + 0.044164509398937006i, 0.0016405516229734511 + 0.013941588767654035i }, { 0.008941710322679063 + 0.005166007774619742i, 0.015120654099631644 + 0.024191018926732533i, 0.0010625887559029567 + 0.004449115493145157i, -0.003173135287557422 + 0.012231561831586416i, 0.025396918784676502 + -0.018956464278651303i, 0.1392144459757541 + -6.776263578034403e-21i, 0.013832407649197732 + 0.002392447621251949i, 0.04240788953462325 + 0.04476790758966705i }, { 0.014322587330185122 + 0.005221599468129485i, 0.002894552100043713 + 0.003916123060504837i, 0.014157173291801774 + 0.032685737139290745i, -0.0019917233689913465 + 0.011202709389219783i, 0.04183630052822132 + -0.044164509398937006i, 0.013832407649197732 + -0.002392447621251949i, 0.14214144795436232 + -1.3552527156068805e-20i, 0.026285173489487716 + 0.019619464728621527i }, { 0.004385108298191791 + -0.0013017483430545086i, 0.012385326224410425 + 0.00250670834123063i, 0.009254445750567695 + 0.005346688381972234i, 0.015649497470659968 + 0.025037097404126893i, 0.0016405516229734515 + -0.013941588767654035i, 0.04240788953462325 + -0.04476790758966705i, 0.026285173489487716 + -0.019619464728621527i, 0.1440834573571765 + 6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.11418627272869779, 1.0e-7), DoubleNear(0.10066777079949492, 1.0e-7), DoubleNear(0.11817992624375802, 1.0e-7), DoubleNear(0.10418861605610376, 1.0e-7), DoubleNear(0.1373380628846524, 1.0e-7), DoubleNear(0.1392144459757541, 1.0e-7), DoubleNear(0.14214144795436232, 1.0e-7), DoubleNear(0.1440834573571765, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false, false, false}), Matrix({ { 0.2515243356133502 + 3.218725199566341e-20i, 0.04739767606768908 + 0.03257430059449068i, 0.07662003871220506 + 0.0808839781990151i, 0.003963325272725748 + 0.025164788746508356i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04739767606768908 + -0.03257430059449068i, 0.239882216775249 + -1.3552527156068805e-20i, 0.024913497053981454 + 0.005319041682021062i, 0.07307358427513366 + 0.07714016198339904i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07662003871220506 + -0.0808839781990151i, 0.024913497053981454 + -0.005319041682021063i, 0.26032137419812035 + -1.1858461261560205e-20i, 0.04905540506706853 + 0.033713583513190606i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003963325272725748 + -0.025164788746508356i, 0.07307358427513366 + -0.07714016198339904i, 0.04905540506706853 + -0.033713583513190606i, 0.24827207341328028 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2515243356133502, 1.0e-7), DoubleNear(0.239882216775249, 1.0e-7), DoubleNear(0.26032137419812035, 1.0e-7), DoubleNear(0.24827207341328028, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true, false, false}), Matrix({ { 0.11613707319668198 + 5.082197683525802e-21i, 0.02188506874057581 + 0.015040627871048397i, 0.035377996417534974 + 0.03734679777060611i, 0.0018299978655281217 + 0.011619412115752185i, -0.005196609277993217 + 0.01143971192234705i, -0.0024607870112140747 + 0.0014827187452863763i, -0.005261732669146672 + 0.0018136962281771695i, -0.001226417260892489 + -0.0003396580895282962i }, { 0.02188506874057581 + -0.015040627871048397i, 0.11076152333440752 + -1.3552527156068805e-20i, 0.011503382461533845 + 0.002455976801030838i, 0.03374048155225369 + 0.0356181544693221i, 0.0005022711275876088 + 0.002828719022203403i, -0.004956077710254271 + 0.01091021053096543i, -0.0007566425491957552 + 0.0010232101291248034i, -0.0050181867836992635 + 0.0017297470271061713i }, { 0.035377996417534974 + -0.03734679777060611i, 0.011503382461533845 + -0.0024559768010308375i, 0.12019895576379874 + -5.082197683525802e-21i, 0.022650496839895576 + 0.015566672332703105i, 0.0020957216898821207 + 0.005155897137087501i, -0.0002728062285717751 + 0.0012429978589078472i, -0.005378360169878107 + 0.011839814707368385i, -0.0025468527918223924 + 0.0015345766857152387i }, { 0.0018299978655281217 + -0.011619412115752185i, 0.03374048155225369 + -0.0356181544693221i, 0.022650496839895576 + -0.015566672332703105i, 0.11463539658052765 + 3.3881317890172014e-21i, 0.0010626489890572573 + 0.0007001742937673711i, 0.001998718587157699 + 0.004917249981771002i, 0.0005198380102458197 + 0.0029276531882478753i, -0.005129416034515855 + 0.011291794057564652i }, { -0.005196609277993217 + -0.01143971192234705i, 0.0005022711275876088 + -0.002828719022203403i, 0.0020957216898821207 + -0.005155897137087501i, 0.0010626489890572573 + -0.0007001742937673711i, 0.1353872624166682 + 2.710505431213761e-20i, 0.025512607327113274 + 0.017533672723442282i, 0.04124204229467009 + 0.043537180428409004i, 0.0021333274071976263 + 0.013545376630756169i }, { -0.0024607870112140747 + -0.0014827187452863763i, -0.004956077710254271 + -0.01091021053096543i, -0.0002728062285717751 + -0.0012429978589078472i, 0.001998718587157699 + -0.004917249981771002i, 0.025512607327113274 + -0.017533672723442285i, 0.1291206934408415 + 0.0i, 0.013410114592447609 + 0.002863064880990224i, 0.03933310272287997 + 0.04152200751407695i }, { -0.005261732669146672 + -0.0018136962281771695i, -0.0007566425491957552 + -0.0010232101291248034i, -0.005378360169878107 + -0.011839814707368385i, 0.0005198380102458197 + -0.0029276531882478753i, 0.04124204229467009 + -0.04353718042840901i, 0.013410114592447609 + -0.0028630648809902246i, 0.1401224184343216 + -6.776263578034403e-21i, 0.026404908227172955 + 0.018146911180487498i }, { -0.0012264172608924889 + 0.0003396580895282962i, -0.005018186783699263 + -0.0017297470271061708i, -0.002546852791822392 + -0.0015345766857152387i, -0.005129416034515855 + -0.011291794057564652i, 0.0021333274071976263 + -0.013545376630756169i, 0.03933310272287997 + -0.04152200751407695i, 0.026404908227172952 + -0.018146911180487498i, 0.1336366768327526 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.11613707319668198, 1.0e-7), DoubleNear(0.11076152333440752, 1.0e-7), DoubleNear(0.12019895576379874, 1.0e-7), DoubleNear(0.11463539658052765, 1.0e-7), DoubleNear(0.1353872624166682, 1.0e-7), DoubleNear(0.1291206934408415, 1.0e-7), DoubleNear(0.1401224184343216, 1.0e-7), DoubleNear(0.1336366768327526, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, true, false}), Matrix({ { 0.2515243356133502 + 3.218725199566341e-20i, 0.04739767606768908 + 0.03257430059449068i, 0.07662003871220506 + 0.0808839781990151i, 0.003963325272725748 + 0.025164788746508356i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04739767606768908 + -0.03257430059449068i, 0.239882216775249 + -1.3552527156068805e-20i, 0.024913497053981454 + 0.005319041682021062i, 0.07307358427513366 + 0.07714016198339904i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07662003871220506 + -0.0808839781990151i, 0.024913497053981454 + -0.005319041682021063i, 0.26032137419812035 + -1.1858461261560205e-20i, 0.04905540506706853 + 0.033713583513190606i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003963325272725748 + -0.025164788746508356i, 0.07307358427513366 + -0.07714016198339904i, 0.04905540506706853 + -0.033713583513190606i, 0.24827207341328028 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2515243356133502, 1.0e-7), DoubleNear(0.239882216775249, 1.0e-7), DoubleNear(0.26032137419812035, 1.0e-7), DoubleNear(0.24827207341328028, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false, true}), Matrix({ { 0.12358191152872294 + 2.541098841762901e-20i, 0.023287986811218603 + 0.01600479064724228i, 0.037645863659152325 + 0.039740872840422256i, 0.0019473078500303496 + 0.01236426164858512i, -0.029581962941224574 + -0.021375178794675667i, -0.002806228653361101 + -0.007859062816332064i, -0.002137612842908183 + -0.016024190512309657i, 0.0016724382410921636 + -0.003296462874763346i }, { 0.023287986811218603 + -0.01600479064724228i, 0.11786176800166165 + 0.0i, 0.012240794042009263 + 0.0026134144712565417i, 0.03590337771872016 + 0.037901416776619i, -0.008342722747428328 + -0.0001968876977874927i, -0.028212724743313353 + -0.02038580187770086i, -0.002478069082650513 + -0.002742788868391462i, -0.0020386707557089375 + -0.01528249078860793i }, { 0.037645863659152325 + -0.039740872840422256i, 0.012240794042009263 + -0.002613414471256542i, 0.127904176574953 + -1.8634724839594607e-20i, 0.02410248183032019 + 0.016564556605958066i, -0.015885065878914383 + 0.003001458356118036i, -0.0033821205072753517 + -0.0014916360243799392i, -0.030616589148555987 + -0.022122773543925618i, -0.002904376220995487 + -0.008133932755524287i }, { 0.0019473078500303494 + -0.01236426164858512i, 0.03590337771872015 + -0.037901416776619i, 0.02410248183032019 + -0.016564556605958066i, 0.12198397159779278 + 0.0i, -0.0026046974680643065 + 0.002622835918394412i, -0.015149805713084247 + 0.002862532097613755i, -0.008634508644535261 + -0.0002037738254064348i, -0.029199461981057016 + -0.021098793267827386i }, { -0.029581962941224574 + 0.021375178794675667i, -0.008342722747428328 + 0.00019688769778749218i, -0.015885065878914383 + -0.0030014583561180372i, -0.0026046974680643065 + -0.002622835918394412i, 0.12794242408462725 + 6.776263578034403e-21i, 0.02410968925647048 + 0.0165695099472484i, 0.038974175053052736 + 0.041143105358592856i, 0.0020160174226953984 + 0.012800527097923235i }, { -0.0028062286533611014 + 0.007859062816332064i, -0.028212724743313357 + 0.020385801877700855i, -0.0033821205072753517 + 0.001491636024379939i, -0.015149805713084247 + -0.002862532097613756i, 0.02410968925647048 + -0.016569509947248404i, 0.12202044877358738 + -1.3552527156068805e-20i, 0.012672703011972191 + 0.0027056272107645204i, 0.0371702065564135 + 0.03923874520678005i }, { -0.002137612842908184 + 0.016024190512309657i, -0.0024780690826505126 + 0.0027427888683914615i, -0.030616589148555987 + 0.022122773543925618i, -0.008634508644535261 + 0.00020377382540643428i, 0.038974175053052736 + -0.041143105358592856i, 0.012672703011972191 + -0.0027056272107645204i, 0.13241719762316734 + 6.776263578034403e-21i, 0.024952923236748338 + 0.017149026907232537i }, { 0.0016724382410921632 + 0.003296462874763346i, -0.0020386707557089392 + 0.01528249078860793i, -0.002904376220995487 + 0.008133932755524285i, -0.029199461981057016 + 0.021098793267827386i, 0.002016017422695399 + -0.012800527097923235i, 0.0371702065564135 + -0.03923874520678005i, 0.024952923236748338 + -0.017149026907232537i, 0.1262881018154875 + 3.3881317890172014e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12358191152872294, 1.0e-7), DoubleNear(0.11786176800166165, 1.0e-7), DoubleNear(0.127904176574953, 1.0e-7), DoubleNear(0.12198397159779278, 1.0e-7), DoubleNear(0.12794242408462725, 1.0e-7), DoubleNear(0.12202044877358738, 1.0e-7), DoubleNear(0.13241719762316734, 1.0e-7), DoubleNear(0.1262881018154875, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false, false, false}), Matrix({ { 0.2323661989724558 + 2.0328790734103208e-20i, 0.0447709888605934 + 0.02771195510040845i, 0.02783593331430175 + -0.06426692536602403i, 0.018196156073246757 + -0.010512696156591977i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0447709888605934 + -0.02771195510040845i, 0.20485638685559868 + -1.0164395367051604e-20i, -0.003916140442519339 + -0.022026845689485562i, 0.03077015157029161 + -0.049228116330859426i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02783593331430175 + 0.06426692536602405i, -0.003916140442519339 + 0.022026845689485562i, 0.2794795108390147 + 0.0i, 0.05168209227416422 + 0.03857592900727283i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.018196156073246757 + 0.010512696156591976i, 0.03077015157029161 + 0.049228116330859426i, 0.05168209227416422 + -0.03857592900727283i, 0.2832979033329306 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2323661989724558, 1.0e-7), DoubleNear(0.20485638685559868, 1.0e-7), DoubleNear(0.2794795108390147, 1.0e-7), DoubleNear(0.2832979033329306, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true, false, false}), Matrix({ { 0.10729113027052367 + 0.0i, 0.020672240710670187 + 0.012795522747614719i, 0.01285276757391198 + -0.02967415696441055i, 0.008401764801897535 + -0.004854058197014465i, -0.004800793301084422 + 0.0105683705326308i, -0.0021853715184702955 + 0.0014637112991866793i, 0.0023478548966625245 + 0.002593805316052391i, 0.00010219250563509385 + 0.001044786212496132i }, { 0.020672240710670187 + -0.012795522747614719i, 0.09458894359879857 + -1.0164395367051604e-20i, -0.0018082110747347307 + -0.010170520414629916i, 0.014207592821894256 + -0.02273024332102974i, 0.0003353927835653952 + 0.0026087949558829225i, -0.004232427840407615 + 0.009317182154029893i, 0.0010827239453357 + 0.0002769727708261323i, 0.001603244525767397 + 0.002416549294731157i }, { 0.012852767573911978 + 0.02967415696441055i, -0.0018082110747347307 + 0.010170520414629916i, 0.12904489868995705 + 0.0i, 0.023863324869801198 + 0.017811777456136782i, -0.003498061448008431 + -6.176357600555895e-05i, -0.000920905394395929 + -0.0006331968984090869i, -0.005774176146786901 + 0.012711156097084637i, -0.0028222682845661716 + 0.0015535841318149355i }, { 0.008401764801897535 + 0.004854058197014465i, 0.014207592821894256 + 0.02273024332102974i, 0.023863324869801198 + -0.017811777456136782i, 0.13080797631613658 + 0.0i, -0.0008540745312328417 + 0.0006103918684987485i, -0.0028746956936674135 + 0.00038239792373757166i, 0.0006867163542680334 + 0.003147577254568356i, -0.0058530659043625095 + 0.012884822434500186i }, { -0.004800793301084422 + -0.0105683705326308i, 0.00033539278356539524 + -0.0026087949558829225i, -0.003498061448008431 + 6.176357600555884e-05i, -0.0008540745312328415 + -0.0006103918684987485i, 0.12507506870193213 + 2.0328790734103208e-20i, 0.02409874814992321 + 0.014916432352793732i, 0.014983165740389773 + -0.03459276840161349i, 0.009794391271349222 + -0.005658637959577511i }, { -0.0021853715184702955 + -0.0014637112991866793i, -0.004232427840407615 + -0.009317182154029893i, -0.0009209053943959291 + 0.0006331968984090867i, -0.0028746956936674135 + -0.0003823979237375717i, 0.02409874814992321 + -0.014916432352793732i, 0.1102674432568001 + 0.0i, -0.002107929367784608 + -0.01185632527485565i, 0.016562558748397356 + -0.026497873009829684i }, { 0.0023478548966625245 + -0.002593805316052391i, 0.0010827239453357 + -0.0002769727708261323i, -0.005774176146786901 + -0.012711156097084637i, 0.0006867163542680333 + -0.003147577254568356i, 0.014983165740389775 + 0.03459276840161349i, -0.002107929367784608 + 0.01185632527485565i, 0.15043461214905768 + 0.0i, 0.027818767404363023 + 0.020764151551136048i }, { 0.00010219250563509385 + -0.001044786212496132i, 0.001603244525767397 + -0.002416549294731157i, -0.0028222682845661716 + -0.0015535841318149355i, -0.00585306590436251 + -0.012884822434500186i, 0.009794391271349224 + 0.0056586379595775105i, 0.016562558748397356 + 0.026497873009829684i, 0.027818767404363023 + -0.020764151551136048i, 0.15248992701679404 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10729113027052367, 1.0e-7), DoubleNear(0.09458894359879857, 1.0e-7), DoubleNear(0.12904489868995705, 1.0e-7), DoubleNear(0.13080797631613658, 1.0e-7), DoubleNear(0.12507506870193213, 1.0e-7), DoubleNear(0.1102674432568001, 1.0e-7), DoubleNear(0.15043461214905768, 1.0e-7), DoubleNear(0.15248992701679404, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, true, false}), Matrix({ { 0.2323661989724558 + 2.0328790734103208e-20i, 0.0447709888605934 + 0.02771195510040845i, 0.02783593331430175 + -0.06426692536602403i, 0.018196156073246757 + -0.010512696156591977i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0447709888605934 + -0.02771195510040845i, 0.20485638685559868 + -1.0164395367051604e-20i, -0.003916140442519339 + -0.022026845689485562i, 0.03077015157029161 + -0.049228116330859426i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02783593331430175 + 0.06426692536602405i, -0.003916140442519339 + 0.022026845689485562i, 0.2794795108390147 + 0.0i, 0.05168209227416422 + 0.03857592900727283i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.018196156073246757 + 0.010512696156591976i, 0.03077015157029161 + 0.049228116330859426i, 0.05168209227416422 + -0.03857592900727283i, 0.2832979033329306 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2323661989724558, 1.0e-7), DoubleNear(0.20485638685559868, 1.0e-7), DoubleNear(0.2794795108390147, 1.0e-7), DoubleNear(0.2832979033329306, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false, true}), Matrix({ { 0.11416890923756598 + 6.776263578034403e-21i, 0.021997411784951848 + 0.013615765548710773i, 0.01367667999113834 + -0.031576385900949265i, 0.008940350620639748 + -0.005165222216706011i, -0.027328760336586534 + -0.019747071537883416i, -0.0029105165371359843 + -0.007063976200100431i, -0.008735371719253614 + 0.005192912048964274i, -0.003033459059665955 + -0.00030994973561785733i }, { 0.021997411784951848 + -0.013615765548710773i, 0.10065246297042085 + 0.0i, -0.0019241244411651727 + -0.010822490351149764i, 0.015118354809733728 + -0.024187340371223488i, -0.007620581617533039 + -0.0005455291734131963i, -0.024093311008884483 + -0.017409217623383128i, -0.0014113172889876258 + 0.0029233971863966133i, -0.007802430993246918 + 0.003174829265185177i }, { 0.01367667999113834 + 0.03157638590094927i, -0.0019241244411651731 + 0.010822490351149764i, 0.13731717886610997 + 0.0i, 0.025393056856586944 + 0.018953581704489568i, 0.0021877623539006802 + -0.009924049098259698i, 0.0023324776304769765 + -0.002257790004174774i, -0.03286979175319403 + -0.023750880800717866i, -0.0028000883372206035 + -0.008929019371755921i }, { 0.008940350620639748 + 0.0051652222167060105i, 0.015118354809733728 + 0.024187340371223488i, 0.025393056856586944 + -0.018953581704489568i, 0.13919327662903358 + 0.0i, -0.0012466676590383472 + -0.0027827616594287923i, 0.0005646304740361107 + -0.008404680999017516i, -0.00935664977443055 + 0.00014486765021926886i, -0.03331887571548589 + -0.024075377522145117i }, { -0.027328760336586534 + 0.019747071537883416i, -0.007620581617533039 + 0.0005455291734131958i, 0.0021877623539006794 + 0.009924049098259698i, -0.0012466676590383472 + 0.002782761659428792i, 0.11819728973488983 + 1.3552527156068805e-20i, 0.02277357707564155 + 0.014096189551697677i, 0.014159253323163413 + -0.03269053946507477i, 0.00925580545260701 + -0.005347473939885965i }, { -0.0029105165371359843 + 0.00706397620010043i, -0.024093311008884483 + 0.017409217623383124i, 0.0023324776304769765 + 0.002257790004174774i, 0.0005646304740361103 + 0.008404680999017516i, 0.02277357707564155 + -0.014096189551697677i, 0.10420392388517782 + -1.0164395367051604e-20i, -0.001992016001354166 + -0.0112043553383358i, 0.015651796760557883 + -0.025040775959635938i }, { -0.008735371719253614 + -0.0051929120489642745i, -0.0014113172889876255 + -0.0029233971863966133i, -0.03286979175319403 + 0.023750880800717862i, -0.00935664977443055 + -0.00014486765021926945i, 0.014159253323163413 + 0.03269053946507477i, -0.0019920160013541656 + 0.0112043553383358i, 0.14216233197290473 + 0.0i, 0.026289035417577274 + 0.019622347302783262i }, { -0.0030334590596659545 + 0.00030994973561785717i, -0.007802430993246918 + -0.0031748292651851773i, -0.002800088337220604 + 0.008929019371755921i, -0.03331887571548589 + 0.024075377522145114i, 0.00925580545260701 + 0.005347473939885965i, 0.015651796760557883 + 0.025040775959635938i, 0.026289035417577274 + -0.019622347302783262i, 0.144104626703897 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11416890923756598, 1.0e-7), DoubleNear(0.10065246297042085, 1.0e-7), DoubleNear(0.13731717886610997, 1.0e-7), DoubleNear(0.13919327662903358, 1.0e-7), DoubleNear(0.11819728973488983, 1.0e-7), DoubleNear(0.10420392388517782, 1.0e-7), DoubleNear(0.14216233197290473, 1.0e-7), DoubleNear(0.144104626703897, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true, false, false}), Matrix({ { 0.23633602896048073 + 0.0i, 0.044535565580471385 + 0.0306073002037515i, 0.0 + 0.0i, 0.0 + 0.0i, -0.010574969447871323 + 0.023279526629715434i, -0.0050076398030364675 + 0.0030172954310016147i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.044535565580471385 + -0.0306073002037515i, 0.22539691991493516 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0010221091378334285 + 0.005756372210451279i, -0.010085493744770125 + 0.02220200458853008i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010574969447871325 + -0.023279526629715434i, 0.0010221091378334285 + -0.005756372210451279i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2755096808509898 + 2.0328790734103208e-20i, 0.05191751555428623 + 0.03568058390392978i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0050076398030364675 + -0.0030172954310016147i, -0.010085493744770125 + -0.02220200458853008i, 0.0 + 0.0i, 0.0 + 0.0i, 0.051917515554286225 + -0.03568058390392978i, 0.26275737027359414 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.23633602896048073, 1.0e-7), DoubleNear(0.22539691991493516, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2755096808509898, 1.0e-7), DoubleNear(0.26275737027359414, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, true, false}), Matrix({ { 0.5118457098114706 + 2.0328790734103208e-20i, 0.09645308113475762 + 0.06628788410768127i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09645308113475762 + -0.06628788410768127i, 0.4881542901885293 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.5118457098114706, 1.0e-7), DoubleNear(0.4881542901885293, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false, true}), Matrix({ { 0.25148608810367595 + 6.776263578034403e-21i, 0.0473904686415388 + 0.03256934725320034i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06019855208978056 + -0.04349795233860128i, -0.005710604874356588 + -0.01599299557185635i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04739046864153879 + -0.03256934725320034i, 0.23984573959945443 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01697723139196359 + -0.0004006615231939274i, -0.057412186724370366 + -0.04148459514552824i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06019855208978056 + 0.04349795233860128i, -0.01697723139196359 + 0.00040066152319392635i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2603596217077946 + 1.3552527156068805e-20i, 0.04906261249321882 + 0.03371853685448094i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005710604874356588 + 0.01599299557185635i, -0.05741218672437037 + 0.04148459514552824i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04906261249321882 + -0.03371853685448094i, 0.24830855058907486 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.25148608810367595, 1.0e-7), DoubleNear(0.23984573959945443, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2603596217077946, 1.0e-7), DoubleNear(0.24830855058907486, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, true, false}), Matrix({ { 0.23633602896048073 + 0.0i, 0.044535565580471385 + 0.0306073002037515i, -0.010574969447871323 + 0.023279526629715434i, -0.0050076398030364675 + 0.0030172954310016147i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.044535565580471385 + -0.0306073002037515i, 0.22539691991493516 + -1.0164395367051604e-20i, 0.0010221091378334285 + 0.005756372210451279i, -0.010085493744770125 + 0.02220200458853008i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010574969447871325 + -0.023279526629715434i, 0.0010221091378334285 + -0.005756372210451279i, 0.2755096808509898 + 2.0328790734103208e-20i, 0.05191751555428623 + 0.03568058390392978i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0050076398030364675 + -0.0030172954310016147i, -0.010085493744770125 + -0.02220200458853008i, 0.051917515554286225 + -0.03568058390392978i, 0.26275737027359414 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.23633602896048073, 1.0e-7), DoubleNear(0.22539691991493516, 1.0e-7), DoubleNear(0.2755096808509898, 1.0e-7), DoubleNear(0.26275737027359414, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false, true}), Matrix({ { 0.1123779638209374 + 0.0i, 0.02117669573937068 + 0.01455379482376304i, -0.00021361707017817332 + 0.010752133797331838i, -0.00143273687678186 + 0.001998485462174133i, -0.025775397623708493 + -0.02031564729364605i, -0.002226130302676849 + -0.007166423937752719i, 0.0003462219601878659 + -0.00014131854160146081i, 8.354447659692177e-05 + 1.8208050267665436e-05i }, { 0.02117669573937068 + -0.01455379482376304i, 0.10717640904335768 + 0.0i, 0.0013522281445341924 + 0.002053815509178372i, -0.00020372953658904158 + 0.01025445782046681i, -0.007488189738008505 + -0.0004902067193291277i, -0.02458235106818229 + -0.019375312118964764i, 4.69408402730202e-05 + -7.146866571348766e-05i, 0.00033019664321391013 + -0.00013477743594128937i }, { -0.00021361707017817332 + -0.010752133797331838i, 0.0013522281445341924 + -0.002053815509178372i, 0.13910812428273855 + 6.776263578034403e-21i, 0.026213772902168114 + 0.018015552429437302i, -0.004456619201119971 + 0.004405934842472253i, -0.0014104147749563899 + 0.00025309606241935686i, -0.03442315446607207 + -0.02318230504495523i, -0.0034844745716797387 + -0.008826571634103633i }, { -0.00143273687678186 + -0.001998485462174133i, -0.0002037295365890418 + -0.01025445782046681i, 0.02621377290216811 + -0.018015552429437302i, 0.13266933055609675 + 0.0i, -0.0002692111168017833 + 0.0014074277348474426i, -0.004250339000720752 + 0.004202000631081099i, -0.009489041653955085 + 8.95451961352003e-05i, -0.03282983565618808 + -0.02210928302656348i }, { -0.025775397623708493 + 0.02031564729364605i, -0.007488189738008505 + 0.0004902067193291271i, -0.004456619201119971 + -0.004405934842472253i, -0.00026921111680178335 + -0.0014074277348474426i, 0.12395806513954331 + 0.0i, 0.023358869841100704 + 0.01605350537998846i, -0.01036135237769315 + 0.012527392832383598i, -0.0035749029262546073 + 0.0010188099688274816i }, { -0.002226130302676849 + 0.007166423937752718i, -0.024582351068182292 + 0.01937531211896476i, -0.0014104147749563899 + -0.00025309606241935686i, -0.004250339000720752 + -0.004202000631081099i, 0.023358869841100704 + -0.01605350537998846i, 0.11822051087157748 + -1.0164395367051604e-20i, -0.00033011900670076394 + 0.0037025567012729066i, -0.009881764208181083 + 0.011947546768063269i }, { 0.0003462219601878659 + 0.0001413185416014605i, 4.6940840273020144e-05 + 7.146866571348758e-05i, -0.03442315446607207 + 0.023182305044955227i, -0.009489041653955085 + -8.95451961352007e-05i, -0.010361352377693152 + -0.012527392832383598i, -0.0003301190067007639 + -0.0037025567012729066i, 0.13640155656825126 + 1.3552527156068805e-20i, 0.025703742652118118 + 0.017665031474492478i }, { 8.354447659692177e-05 + -1.8208050267665436e-05i, 0.00033019664321391013 + 0.00013477743594128927i, -0.003484474571679739 + 0.008826571634103633i, -0.032829835656188085 + 0.022109283026563478i, -0.0035749029262546073 + -0.0010188099688274816i, -0.009881764208181083 + -0.011947546768063269i, 0.025703742652118118 + -0.017665031474492478i, 0.13008803971749738 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1123779638209374, 1.0e-7), DoubleNear(0.10717640904335768, 1.0e-7), DoubleNear(0.13910812428273855, 1.0e-7), DoubleNear(0.13266933055609675, 1.0e-7), DoubleNear(0.12395806513954331, 1.0e-7), DoubleNear(0.11822051087157748, 1.0e-7), DoubleNear(0.13640155656825126, 1.0e-7), DoubleNear(0.13008803971749738, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true, true}), Matrix({ { 0.25148608810367595 + 6.776263578034403e-21i, 0.0473904686415388 + 0.03256934725320034i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06019855208978056 + -0.04349795233860128i, -0.005710604874356588 + -0.01599299557185635i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04739046864153879 + -0.03256934725320034i, 0.23984573959945443 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01697723139196359 + -0.0004006615231939274i, -0.057412186724370366 + -0.04148459514552824i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06019855208978056 + 0.04349795233860128i, -0.01697723139196359 + 0.00040066152319392635i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2603596217077946 + 1.3552527156068805e-20i, 0.04906261249321882 + 0.03371853685448094i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005710604874356588 + 0.01599299557185635i, -0.05741218672437037 + 0.04148459514552824i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04906261249321882 + -0.03371853685448094i, 0.24830855058907486 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.25148608810367595, 1.0e-7), DoubleNear(0.23984573959945443, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2603596217077946, 1.0e-7), DoubleNear(0.24830855058907486, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false, false, false}), Matrix({ { 0.2148540435281927 + 1.1858461261560205e-20i, 0.06544943292449415 + 0.0690917231938101i, 0.028799414122131627 + -0.05577220715346582i, 0.026707913554595546 + -0.007728307809360116i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06544943292449415 + -0.0690917231938101i, 0.22236854229986178 + -1.6940658945086007e-21i, -0.009161999203638967 + -0.02625066015605101i, 0.02980667076246174 + -0.05772283454341763i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.028799414122131627 + 0.05577220715346583i, -0.009161999203638964 + 0.026250660156051007i, 0.2765525088604065 + 6.776263578034403e-21i, 0.08424419006284457 + 0.08893241698860405i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026707913554595546 + 0.007728307809360116i, 0.02980667076246174 + 0.05772283454341763i, 0.08424419006284457 + -0.08893241698860405i, 0.2862249053115389 + -6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2148540435281927, 1.0e-7), DoubleNear(0.22236854229986178, 1.0e-7), DoubleNear(0.2765525088604065, 1.0e-7), DoubleNear(0.2862249053115389, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true, false, false}), Matrix({ { 0.09920519109607939 + -1.5246593050577406e-20i, 0.03022015966645042 + 0.03190192509316191i, 0.013297638408496133 + -0.02575186567426034i, 0.012331923683873095 + -0.003568414354632752i, -0.004438984058104409 + 0.009771890888093777i, -0.00449461296527742 + 0.0015492734228099614i, 0.0019415961453208735 + 0.0024621210855294653i, -0.00020030259205134832 + 0.0013743872231442283i }, { 0.03022015966645042 + -0.03190192509316191i, 0.10267488277324285 + 5.082197683525802e-21i, -0.004230396909890433 + -0.01212079472377982i, 0.013762721987310102 + -0.026652534611179952i, 0.0017901817654458858 + 0.004404207430733732i, -0.004594237083387628 + 0.010113661798566915i, 0.001383211366704781 + 0.00012564904513478515i, 0.0020095032771090477 + 0.0025482335252540824i }, { 0.013297638408496133 + 0.025751865674260344i, -0.004230396909890432 + 0.012120794723779818i, 0.1276934054350101 + 6.776263578034403e-21i, 0.038898318303338245 + 0.041063027146766296i, -0.0031316146162007515 + 0.00015756181939635574i, -0.0010046290720691947 + -0.0009590525507384776i, -0.005713702930143078 + 0.0125780315652187i, -0.0057853064875685156 + 0.0019941698324733794i }, { 0.012331923683873093 + 0.0035684143546327518i, 0.013762721987310102 + 0.026652534611179952i, 0.038898318303338245 + -0.041063027146766296i, 0.13215946957108354 + -6.776263578034403e-21i, -0.0009032931378425938 + 0.001055046385070852i, -0.0032411425254750934 + 0.00016307252833565702i, 0.0023042585115939334 + 0.00566893968812477i, -0.005913539121006334 + 0.013017946966366122i }, { -0.004438984058104409 + -0.009771890888093777i, 0.0017901817654458856 + -0.004404207430733732i, -0.0031316146162007515 + -0.00015756181939635585i, -0.0009032931378425938 + -0.001055046385070852i, 0.11564885243211331 + 2.710505431213761e-20i, 0.03522927325804372 + 0.037189798100648194i, 0.015501775713635492 + -0.03002034147920548i, 0.014375989870722453 + -0.004159893454727363i }, { -0.00449461296527742 + -0.0015492734228099614i, -0.004594237083387628 + -0.010113661798566913i, -0.0010046290720691947 + 0.0009590525507384776i, -0.0032411425254750934 + -0.00016307252833565712i, 0.03522927325804372 + -0.037189798100648194i, 0.11969365952661892 + -6.776263578034403e-21i, -0.0049316022937485335 + -0.014129865432271191i, 0.01604394877515164 + -0.031070299932237685i }, { 0.0019415961453208735 + -0.0024621210855294653i, 0.001383211366704781 + -0.00012564904513478515i, -0.005713702930143078 + -0.0125780315652187i, 0.002304258511593933 + -0.00566893968812477i, 0.015501775713635492 + 0.03002034147920548i, -0.004931602293748533 + 0.014129865432271191i, 0.1488591034253964 + 0.0i, 0.04534587175950633 + 0.047869389841837764i }, { -0.00020030259205134832 + -0.0013743872231442283i, 0.0020095032771090477 + -0.0025482335252540824i, -0.005785306487568515 + -0.001994169832473379i, -0.005913539121006334 + -0.013017946966366123i, 0.014375989870722451 + 0.004159893454727364i, 0.01604394877515164 + 0.031070299932237685i, 0.04534587175950633 + -0.047869389841837764i, 0.1540654357404553 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.09920519109607939, 1.0e-7), DoubleNear(0.10267488277324285, 1.0e-7), DoubleNear(0.1276934054350101, 1.0e-7), DoubleNear(0.13215946957108354, 1.0e-7), DoubleNear(0.11564885243211331, 1.0e-7), DoubleNear(0.11969365952661892, 1.0e-7), DoubleNear(0.1488591034253964, 1.0e-7), DoubleNear(0.1540654357404553, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, true, false}), Matrix({ { 0.2148540435281927 + 1.1858461261560205e-20i, 0.06544943292449415 + 0.0690917231938101i, 0.028799414122131627 + -0.05577220715346582i, 0.026707913554595546 + -0.007728307809360116i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06544943292449415 + -0.0690917231938101i, 0.22236854229986178 + -1.6940658945086007e-21i, -0.009161999203638967 + -0.02625066015605101i, 0.02980667076246174 + -0.05772283454341763i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.028799414122131627 + 0.05577220715346583i, -0.009161999203638964 + 0.026250660156051007i, 0.2765525088604065 + 6.776263578034403e-21i, 0.08424419006284457 + 0.08893241698860405i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026707913554595546 + 0.007728307809360116i, 0.02980667076246174 + 0.05772283454341763i, 0.08424419006284457 + -0.08893241698860405i, 0.2862249053115389 + -6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2148540435281927, 1.0e-7), DoubleNear(0.22236854229986178, 1.0e-7), DoubleNear(0.2765525088604065, 1.0e-7), DoubleNear(0.2862249053115389, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false, true}), Matrix({ { 0.10556462989611487 + 1.1858461261560205e-20i, 0.03215738950092515 + 0.03394696263597349i, 0.01415006877740628 + -0.02740266047574997i, 0.013122447980916642 + -0.003797163601025282i, -0.025269142796558494 + -0.018258843956291876i, -0.0018259655141386706 + -0.013687988152081991i, -0.008126784615032712 + 0.004111962910465829i, -0.003797908730721374 + -0.0013607745406134276i }, { 0.03215738950092515 + -0.03394696263597349i, 0.10925674231187196 + -5.082197683525802e-21i, -0.00450158181413856 + -0.012897784832886288i, 0.014644966023465789 + -0.02836106579642278i, -0.013569146808295275 + 0.002563869069451641i, -0.026152928548912525 + -0.01889744520497467i, -0.001153298477846711 + 0.0038659695676851596i, -0.008411018097467821 + 0.004255778403683621i }, { 0.01415006877740628 + 0.027402660475749973i, -0.004501581814138559 + 0.012897784832886287i, 0.13587904963426972 + 1.3552527156068805e-20i, 0.04139185187694733 + 0.04369532698106776i, 0.0013525438703955255 + -0.009006858066764153i, 0.0033083974685559937 + -0.002308749502939549i, -0.032525544887979436 + -0.02350213671608465i, -0.00235031808447845 + -0.017618693148835594i }, { 0.013122447980916642 + 0.0037971636010252817i, 0.014644966023465789 + 0.02836106579642278i, 0.04139185187694733 + -0.04369532698106776i, 0.14063140586087386 + -1.3552527156068805e-20i, -0.002484366159959544 + -0.0031786385230974587i, 0.0013998489575412654 + -0.009321872030513063i, -0.017465724783703358 + 0.0033001213842801503i, -0.03366312258070048 + -0.024324121606778333i }, { -0.025269142796558494 + 0.01825884395629187i, -0.013569146808295275 + -0.0025638690694516414i, 0.001352543870395525 + 0.009006858066764153i, -0.002484366159959544 + 0.0031786385230974587i, 0.10928941363207784 + 0.0i, 0.03329204342356899 + 0.035144760557836614i, 0.014649345344725347 + -0.02836954667771585i, 0.013585465573678904 + -0.003931144208334833i }, { -0.0018259655141386714 + 0.013687988152081991i, -0.026152928548912525 + 0.01889744520497467i, 0.0033083974685559937 + 0.002308749502939549i, 0.0013998489575412646 + 0.009321872030513063i, 0.03329204342356899 + -0.035144760557836614i, 0.11311179998798981 + 3.3881317890172014e-21i, -0.004660417389500407 + -0.013352875323164723i, 0.015161704738995951 + -0.029361768746994855i }, { -0.008126784615032712 + -0.004111962910465829i, -0.0011532984778467106 + -0.0038659695676851596i, -0.032525544887979436 + 0.02350213671608465i, -0.017465724783703358 + -0.0033001213842801516i, 0.014649345344725347 + 0.02836954667771585i, -0.004660417389500406 + 0.013352875323164723i, 0.14067345922613678 + -6.776263578034403e-21i, 0.042852338185897246 + 0.04523709000753629i }, { -0.003797908730721374 + 0.0013607745406134272i, -0.00841101809746782 + -0.004255778403683623i, -0.0023503180844784517 + 0.017618693148835594i, -0.033663122580700484 + 0.024324121606778333i, 0.013585465573678904 + 0.003931144208334834i, 0.015161704738995951 + 0.029361768746994855i, 0.042852338185897246 + -0.04523709000753629i, 0.145593499450665 + 6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.10556462989611487, 1.0e-7), DoubleNear(0.10925674231187196, 1.0e-7), DoubleNear(0.13587904963426972, 1.0e-7), DoubleNear(0.14063140586087386, 1.0e-7), DoubleNear(0.10928941363207784, 1.0e-7), DoubleNear(0.11311179998798981, 1.0e-7), DoubleNear(0.14067345922613678, 1.0e-7), DoubleNear(0.145593499450665, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true, false, false}), Matrix({ { 0.22689859653108949 + -8.470329472543003e-21i, 0.06911847796978866 + 0.0729649522399282i, 0.0 + 0.0i, 0.0 + 0.0i, -0.010152686988247488 + 0.02234992245331248i, -0.010279919452845935 + 0.0035434432552833408i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06911847796978866 + -0.0729649522399282i, 0.23483435234432637 + -1.6940658945086007e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0040944402770398194 + 0.010073147118858502i, -0.010507776204393962 + 0.02313160876493304i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010152686988247488 + -0.02234992245331248i, 0.0040944402770398194 + -0.010073147118858504i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26450795585750975 + 2.710505431213761e-20i, 0.08057514501755006 + 0.08505918794248596i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010279919452845936 + -0.0035434432552833403i, -0.010507776204393962 + -0.02313160876493304i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08057514501755006 + -0.08505918794248596i, 0.2737590952670742 + -6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.22689859653108949, 1.0e-7), DoubleNear(0.23483435234432637, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26450795585750975, 1.0e-7), DoubleNear(0.2737590952670742, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, true, false}), Matrix({ { 0.4914065523885992 + 1.8634724839594607e-20i, 0.14969362298733874 + 0.15802414018241417i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.14969362298733874 + -0.15802414018241417i, 0.5085934476114006 + -8.470329472543003e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.4914065523885992, 1.0e-7), DoubleNear(0.5085934476114006, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false, true}), Matrix({ { 0.2414436795303846 + 2.541098841762901e-20i, 0.07354924137787248 + 0.07764228961704125i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05779468768453793 + -0.041760980672376526i, -0.0041762835986171205 + -0.031306681300917585i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07354924137787248 + -0.07764228961704125i, 0.24988814817274582 + -1.8634724839594607e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.031034871591998633 + 0.005863990453731791i, -0.059816051129613 + -0.043221566811753i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05779468768453793 + 0.04176098067237652i, -0.03103487159199863 + -0.005863990453731793i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2499628728582146 + -6.776263578034403e-21i, 0.07614438160946624 + 0.0803818505653729i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004176283598617123 + 0.031306681300917585i, -0.059816051129613 + 0.043221566811753i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07614438160946624 + -0.0803818505653729i, 0.2587052994386548 + 1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2414436795303846, 1.0e-7), DoubleNear(0.24988814817274582, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2499628728582146, 1.0e-7), DoubleNear(0.2587052994386548, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, true, false}), Matrix({ { 0.22689859653108949 + -8.470329472543003e-21i, 0.06911847796978866 + 0.0729649522399282i, -0.010152686988247488 + 0.02234992245331248i, -0.010279919452845935 + 0.0035434432552833408i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.06911847796978866 + -0.0729649522399282i, 0.23483435234432637 + -1.6940658945086007e-21i, 0.0040944402770398194 + 0.010073147118858502i, -0.010507776204393962 + 0.02313160876493304i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010152686988247488 + -0.02234992245331248i, 0.0040944402770398194 + -0.010073147118858504i, 0.26450795585750975 + 2.710505431213761e-20i, 0.08057514501755006 + 0.08505918794248596i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010279919452845936 + -0.0035434432552833403i, -0.010507776204393962 + -0.02313160876493304i, 0.08057514501755006 + -0.08505918794248596i, 0.2737590952670742 + -6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.22689859653108949, 1.0e-7), DoubleNear(0.23483435234432637, 1.0e-7), DoubleNear(0.26450795585750975, 1.0e-7), DoubleNear(0.2737590952670742, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false, true}), Matrix({ { 0.10789045743108427 + 1.1858461261560205e-20i, 0.032865889516769387 + 0.0346948909951694i, -0.0002050868571825573 + 0.010322776764337682i, -0.003382022704174197 + 0.003078601967191304i, -0.024746127670733545 + -0.019504397525946904i, -0.0012661041129821253 + -0.01389922345287526i, 0.000332396533869178 + -0.00013567537245264309i, 0.00014488538085826374 + 6.556066103534987e-05i }, { 0.032865889516769387 + -0.0346948909951694i, 0.1116639154332108 + -1.1858461261560205e-20i, 0.003257074452957284 + 0.003210503644576178i, -0.0002122597495846576 + 0.010683814853460967i, -0.013810363581367974 + 0.002016256424241006i, -0.025611621021157237 + -0.02018656188666391i, 5.762572194023137e-05 + -0.00014822027537656016i, 0.00034402206953259803 + -0.0001404206050901071i }, { -0.0002050868571825575 + -0.010322776764337682i, 0.003257074452957284 + -0.0032105036445761784i, 0.13355322209930032 + 1.3552527156068805e-20i, 0.0406833518611031 + 0.04294739862187186i, -0.0042786563117581874 + 0.004229995894242377i, -0.0026636377203868326 + -8.735653597266493e-05i, -0.033048560013804386 + -0.022256583146429622i, -0.0029101794856349955 + -0.017407457848042325i }, { -0.0033820227041741974 + -0.0030786019671913034i, -0.0002122597495846576 + -0.010683814853460967i, 0.0406833518611031 + -0.04294739862187186i, 0.13822423273953502 + -6.776263578034403e-21i, 5.688548352110863e-05 + 0.002664462630927534i, -0.0044283018900825345 + 0.004377939579310974i, -0.01722450801063066 + 0.003847734029490785i, -0.034204430108455766 + -0.023035004925089093i }, { -0.024746127670733545 + 0.019504397525946904i, -0.013810363581367972 + -0.002016256424241008i, -0.0042786563117581874 + -0.004229995894242377i, 5.6885483521108685e-05 + -0.002664462630927534i, 0.11900813910000521 + -2.0328790734103208e-20i, 0.03625258845301928 + 0.038270061244758805i, -0.00994760013106493 + 0.012027145688974797i, -0.006897896748671738 + 0.00046484128809203695i }, { -0.0012661041129821268 + 0.01389922345287526i, -0.025611621021157237 + 0.02018656188666391i, -0.0026636377203868326 + 8.735653597266493e-05i, -0.0044283018900825345 + -0.004377939579310974i, 0.03625258845301928 + -0.038270061244758805i, 0.12317043691111558 + 1.0164395367051604e-20i, 0.0008373658240825352 + 0.006862643474282324i, -0.010295516454809304 + 0.01244779391147207i }, { 0.000332396533869178 + 0.00013567537245264281i, 5.762572194023145e-05 + 0.00014822027537656006i, -0.033048560013804386 + 0.022256583146429615i, -0.01722450801063066 + -0.0038477340294907855i, -0.00994760013106493 + -0.012027145688974797i, 0.000837365824082535 + -0.006862643474282325i, 0.1309547337582094 + 1.3552527156068805e-20i, 0.03989179315644696 + 0.0421117893206141i }, { 0.0001448853808582637 + -6.556066103534987e-05i, 0.00034402206953259803 + 0.00014042060509010694i, -0.0029101794856349963 + 0.017407457848042325i, -0.034204430108455766 + 0.023035004925089093i, -0.006897896748671738 + -0.00046484128809203684i, -0.010295516454809304 + -0.01244779391147207i, 0.03989179315644696 + -0.0421117893206141i, 0.1355348625275392 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.10789045743108427, 1.0e-7), DoubleNear(0.1116639154332108, 1.0e-7), DoubleNear(0.13355322209930032, 1.0e-7), DoubleNear(0.13822423273953502, 1.0e-7), DoubleNear(0.11900813910000521, 1.0e-7), DoubleNear(0.12317043691111558, 1.0e-7), DoubleNear(0.1309547337582094, 1.0e-7), DoubleNear(0.1355348625275392, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true, true}), Matrix({ { 0.2414436795303846 + 2.541098841762901e-20i, 0.07354924137787248 + 0.07764228961704125i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05779468768453793 + -0.041760980672376526i, -0.0041762835986171205 + -0.031306681300917585i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07354924137787248 + -0.07764228961704125i, 0.24988814817274582 + -1.8634724839594607e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.031034871591998633 + 0.005863990453731791i, -0.059816051129613 + -0.043221566811753i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05779468768453793 + 0.04176098067237652i, -0.03103487159199863 + -0.005863990453731793i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2499628728582146 + -6.776263578034403e-21i, 0.07614438160946624 + 0.0803818505653729i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004176283598617123 + 0.031306681300917585i, -0.059816051129613 + 0.043221566811753i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07614438160946624 + -0.0803818505653729i, 0.2587052994386548 + 1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2414436795303846, 1.0e-7), DoubleNear(0.24988814817274582, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2499628728582146, 1.0e-7), DoubleNear(0.2587052994386548, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true, false, false}), Matrix({ { 0.20188007386932225 + -1.0164395367051604e-20i, 0.027060360395806234 + -0.05240440028544029i, 0.0 + 0.0i, 0.0 + 0.0i, -0.009033221141492038 + 0.019885552686660694i, 0.003951099422429921 + 0.005010354610783548i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.027060360395806234 + 0.0524044002854403i, 0.25985287500609366 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.006372757141675845 + 0.00032063434773201276i, -0.01162724205114941 + 0.025595978531584823i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009033221141492038 + -0.019885552686660694i, -0.006372757141675845 + -0.0003206343477320131i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23534251195873224 + 2.0328790734103208e-20i, 0.03154572448878713 + -0.061090641411443165i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003951099422429921 + -0.005010354610783548i, -0.01162724205114941 + -0.025595978531584823i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03154572448878713 + 0.061090641411443165i, 0.3029245391658517 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.20188007386932225, 1.0e-7), DoubleNear(0.25985287500609366, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23534251195873224, 1.0e-7), DoubleNear(0.3029245391658517, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, true, false}), Matrix({ { 0.4372225858280545 + 1.0164395367051604e-20i, 0.05860608488459336 + -0.11349504169688346i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.05860608488459336 + 0.11349504169688346i, 0.5627774141719453 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.4372225858280545, 1.0e-7), DoubleNear(0.5627774141719453, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false, true}), Matrix({ { 0.21482137220798683 + 6.776263578034403e-21i, 0.028795034800872067 + -0.05576372627217275i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05142207134547102 + -0.03715628916126655i, -0.01653780271250053 + 0.008367741314149451i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.028795034800872067 + 0.055763726272172756i, 0.2765104554951435 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.002752392827936791 + -0.018328730097277215i, -0.06618866746867992 + -0.04782625832286298i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05142207134547102 + 0.03715628916126654i, 0.0027523928279367896 + 0.018328730097277215i, 0.0 + 0.0i, 0.0 + 0.0i, 0.22240121362006765 + 3.3881317890172014e-21i, 0.029811050083721296 + -0.05773131542471071i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01653780271250053 + -0.008367741314149451i, -0.06618866746867992 + 0.04782625832286298i, 0.0 + 0.0i, 0.0 + 0.0i, 0.029811050083721296 + 0.05773131542471071i, 0.2862669586768018 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.21482137220798683, 1.0e-7), DoubleNear(0.2765104554951435, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22240121362006765, 1.0e-7), DoubleNear(0.2862669586768018, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, true, false}), Matrix({ { 0.20188007386932225 + -1.0164395367051604e-20i, 0.027060360395806234 + -0.05240440028544029i, -0.009033221141492038 + 0.019885552686660694i, 0.003951099422429921 + 0.005010354610783548i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.027060360395806234 + 0.0524044002854403i, 0.25985287500609366 + 0.0i, -0.006372757141675845 + 0.00032063434773201276i, -0.01162724205114941 + 0.025595978531584823i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009033221141492038 + -0.019885552686660694i, -0.006372757141675845 + -0.0003206343477320131i, 0.23534251195873224 + 2.0328790734103208e-20i, 0.03154572448878713 + -0.061090641411443165i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003951099422429921 + -0.005010354610783548i, -0.01162724205114941 + -0.025595978531584823i, 0.03154572448878713 + 0.061090641411443165i, 0.3029245391658517 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.20188007386932225, 1.0e-7), DoubleNear(0.25985287500609366, 1.0e-7), DoubleNear(0.23534251195873224, 1.0e-7), DoubleNear(0.3029245391658517, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false, true}), Matrix({ { 0.09599413063358395 + 0.0i, 0.012867222212868542 + -0.02491833270296627i, -0.0001824733625973257 + 0.009184556306567861i, 0.0023596849409089644 + 0.001278480862025793i, -0.02201754509954782 + -0.017353783908378065i, -0.007455997587957547 + 0.003389223051060904i, 0.000295745490881526 + -0.00012071539723796572i, 8.306721604926378e-06 + -9.295106189379746e-05i }, { 0.012867222212868542 + 0.024918332702966273i, 0.12356024223071113 + 0.0i, -0.0024086030422339573 + 0.0011837473209515975i, -0.0002348732441698892 + 0.011822035311230788i, 0.0015534565990896023 + -0.008041486524033744i, -0.02834020359234296 + -0.022337175504232754i, 7.097777057203888e-05 + 6.058925330146715e-05i, 0.00038067311252025005 + -0.00015538058030478447i }, { -0.00018247336259732548 + -0.009184556306567861i, -0.0024086030422339573 + -0.001183747320951598i, 0.11882724157440289 + 6.776263578034403e-21i, 0.015927812588003527 + -0.03084539356920648i, -0.003806878779705589 + 0.0037635838063880362i, 0.00046667726403133616 + 0.0014926739812151045i, -0.0294045262459232 + -0.019802505252888482i, -0.009081805124542985 + 0.004978518263088546i }, { 0.0023596849409089644 + -0.001278480862025793i, -0.00023487324416988963 + -0.01182203531123079i, 0.015927812588003527 + 0.03084539356920648i, 0.15295021326443242 + 0.0i, -0.001487238726958704 + -0.00048371918712676436i, -0.004900079422135133 + 0.004844351667165315i, 0.0011989362288471887 + -0.010287243573243472i, -0.03784846387633696 + -0.02548908281863023i }, { -0.02201754509954782 + 0.01735378390837806i, 0.0015534565990896016 + 0.008041486524033744i, -0.003806878779705589 + -0.003763583806388036i, -0.001487238726958704 + 0.0004837191871267643i, 0.1058859432357383 + -1.0164395367051604e-20i, 0.014193138182937694 + -0.027486067582474023i, -0.008850747778894712 + 0.010700996380092833i, 0.001591414481520957 + 0.0037318737487577547i }, { -0.007455997587957546 + -0.003389223051060905i, -0.028340203592342964 + 0.022337175504232754i, 0.00046667726403133627 + -0.0014926739812151045i, -0.004900079422135133 + -0.004844351667165315i, 0.014193138182937694 + 0.027486067582474023i, 0.1362926327753825 + 0.0i, -0.003964154099441888 + -0.0008631129732195848i, -0.011392368806979521 + 0.013773943220354034i }, { 0.000295745490881526 + 0.00012071539723796556i, 7.09777705720388e-05 + -6.058925330146715e-05i, -0.0294045262459232 + 0.01980250525288848i, 0.001198936228847188 + 0.010287243573243472i, -0.008850747778894712 + -0.010700996380092831i, -0.003964154099441888 + 0.0008631129732195849i, 0.11651527038432935 + 1.3552527156068805e-20i, 0.015617911900783602 + -0.030245247842236686i }, { 8.306721604926405e-06 + 9.29510618937974e-05i, 0.00038067311252025005 + 0.0001553805803047842i, -0.009081805124542985 + -0.004978518263088547i, -0.03784846387633696 + 0.02548908281863023i, 0.001591414481520957 + -0.0037318737487577547i, -0.011392368806979521 + -0.013773943220354034i, 0.015617911900783602 + 0.030245247842236686i, 0.1499743259014193 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.09599413063358395, 1.0e-7), DoubleNear(0.12356024223071113, 1.0e-7), DoubleNear(0.11882724157440289, 1.0e-7), DoubleNear(0.15295021326443242, 1.0e-7), DoubleNear(0.1058859432357383, 1.0e-7), DoubleNear(0.1362926327753825, 1.0e-7), DoubleNear(0.11651527038432935, 1.0e-7), DoubleNear(0.1499743259014193, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true, true}), Matrix({ { 0.21482137220798683 + 6.776263578034403e-21i, 0.028795034800872067 + -0.05576372627217275i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05142207134547102 + -0.03715628916126655i, -0.01653780271250053 + 0.008367741314149451i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.028795034800872067 + 0.055763726272172756i, 0.2765104554951435 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.002752392827936791 + -0.018328730097277215i, -0.06618866746867992 + -0.04782625832286298i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05142207134547102 + 0.03715628916126654i, 0.0027523928279367896 + 0.018328730097277215i, 0.0 + 0.0i, 0.0 + 0.0i, 0.22240121362006765 + 3.3881317890172014e-21i, 0.029811050083721296 + -0.05773131542471071i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01653780271250053 + -0.008367741314149451i, -0.06618866746867992 + 0.04782625832286298i, 0.0 + 0.0i, 0.0 + 0.0i, 0.029811050083721296 + 0.05773131542471071i, 0.2862669586768018 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.21482137220798683, 1.0e-7), DoubleNear(0.2765104554951435, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22240121362006765, 1.0e-7), DoubleNear(0.2862669586768018, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, true, false}), Matrix({ { 0.4617329488754159 + -1.0164395367051604e-20i, 0.0 + 0.0i, -0.02066046319264145 + 0.04548153121824552i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02066046319264145 + -0.04548153121824552i, 0.0 + 0.0i, 0.538267051124584 + 2.0328790734103208e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.4617329488754159, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.538267051124584, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false, true}), Matrix({ { 0.21955437286429508 + 0.0i, 0.0 + 0.0i, -0.0004173466067672149 + 0.02100659161779865i, 0.0 + 0.0i, -0.05035774869189078 + -0.03969095941261082i, 0.0 + 0.0i, 0.0006764186034017761 + -0.00027609597754275016i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004173466067672151 + -0.02100659161779865i, 0.0 + 0.0i, 0.2717774548388353 + 6.776263578034403e-21i, 0.0 + 0.0i, -0.008706958201840722 + 0.008607935473553352i, 0.0 + 0.0i, -0.06725299012226016 + -0.045291588071518715i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05035774869189079 + 0.03969095941261082i, 0.0 + 0.0i, -0.008706958201840722 + -0.008607935473553352i, 0.0 + 0.0i, 0.2421785760111208 + -1.0164395367051604e-20i, 0.0 + 0.0i, -0.020243116585874233 + 0.024474939600446867i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0006764186034017761 + 0.00027609597754274973i, 0.0 + 0.0i, -0.06725299012226016 + 0.04529158807151871i, 0.0 + 0.0i, -0.020243116585874233 + -0.024474939600446867i, 0.0 + 0.0i, 0.26648959628574864 + 1.3552527156068805e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.21955437286429508, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2717774548388353, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2421785760111208, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26648959628574864, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true, true}), Matrix({ { 0.4913318277031304 + 6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.11761073881415093 + -0.08498254748412953i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11761073881415095 + 0.08498254748412953i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.5086681722968694 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.4913318277031304, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5086681722968694, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true, true}), Matrix({ { 0.21955437286429508 + 0.0i, -0.0004173466067672149 + 0.02100659161779865i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05035774869189078 + -0.03969095941261082i, 0.0006764186034017761 + -0.00027609597754275016i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004173466067672151 + -0.02100659161779865i, 0.2717774548388353 + 6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008706958201840722 + 0.008607935473553352i, -0.06725299012226016 + -0.045291588071518715i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05035774869189079 + 0.03969095941261082i, -0.008706958201840722 + -0.008607935473553352i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2421785760111208 + -1.0164395367051604e-20i, -0.020243116585874233 + 0.024474939600446867i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0006764186034017761 + 0.00027609597754274973i, -0.06725299012226016 + 0.04529158807151871i, 0.0 + 0.0i, 0.0 + 0.0i, -0.020243116585874233 + -0.024474939600446867i, 0.26648959628574864 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.21955437286429508, 1.0e-7), DoubleNear(0.2717774548388353, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2421785760111208, 1.0e-7), DoubleNear(0.26648959628574864, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));


}
}

}
