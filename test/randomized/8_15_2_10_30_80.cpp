#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.03847562246251135 + -0.14434453797282115i, -0.14120753147053816 + -0.014584164956908027i, -0.10557893003635406 + 0.04473680724546917i, -0.0775621505633513 + 0.11219412254364794i }, { 0.023748812431970273 + 0.07481342197236758i, 0.08097832626378026 + 0.036168455835128274i, -0.014836314907958212 + -0.13078557196016363i, -0.02776314537895443 + 0.09592442856153648i }, { -0.0310009116399325 + 0.1010764058195489i, 0.07906478849166812 + 0.1350562094682586i, 0.048170933024889846 + -0.0569618371443976i, 0.1052561842838791 + 0.008900024482346015i }, { 0.24037375563661895 + -0.1183316509658898i, 0.05313014753829771 + 0.07372083615206852i, -0.020971561144488275 + 0.041125904372715315i, 0.09516445824150246 + 0.12860184525329493i } }), Matrix({ { 0.0075719082640866905 + 0.05776044253783427i, -0.05225513977783703 + -0.10582372282281313i, -0.006614342094803882 + -0.01127020147621216i, 0.030468880898786337 + -0.04720421226463623i }, { 0.012665059025663603 + 0.08899996484482994i, 0.08848886981130291 + -0.08285632611203364i, 0.020005077624969513 + 0.11281496498713925i, -0.01488368716209877 + 0.016565534754380176i }, { 0.07038799664532827 + 0.10089218767959607i, -0.0689668502830032 + 0.07545780573607554i, 0.042084825257408504 + -0.12650836210986557i, 0.21214484801649766 + 0.09076142356272246i }, { 0.0637380695139504 + -0.04721802942901494i, -0.04829068173575412 + -0.2289660984777979i, 0.033448764010511965 + 0.22331367715984063i, 0.042659484514106824 + 0.13455928676836793i } }), Matrix({ { -0.08931533021567015 + -0.028966354078614396i, 0.09985142026613192 + 0.01747762693115343i, 0.1201755354089855 + -0.049181626669500655i, -0.07106562061712532 + 0.042771703303634855i }, { -0.1034428192167661 + 0.11194631840096465i, 0.1440350715107522 + -0.01405140040722103i, 0.056741551577706224 + -0.07806214423511607i, 0.02558654475019078 + -0.018468850835204546i }, { -0.04136037309027622 + -0.11988135519011188i, -0.1215044822774769 + -0.0006783588516796495i, -0.05791612701009993 + -0.033439377937360716i, -0.021440322652937518 + -0.0024999064603471476i }, { -0.015669300413415726 + -0.007494841254055196i, 0.042508074900485276 + -0.08465340811335571i, 0.026381241150178522 + -0.06619196990623392i, 0.019770639814613973 + -0.1845365410106934i } }), Matrix({ { -0.02321675183475904 + -0.1295204661607958i, -0.026479239497202284 + -0.0562165026277928i, -0.08199636001246986 + 0.10139114581487947i, 0.0011668634131186196 + 0.06586539538212408i }, { 0.011232540445405694 + 0.07019846138695682i, -0.02536786825583872 + -0.07408075603859995i, 0.0023036682110302844 + -0.12264625821112939i, -0.10057844202627804 + 0.051968798706911984i }, { 0.10324382928063125 + 0.07102536990943605i, 0.11759726800128328 + 0.18336485377669812i, 0.10922798200736668 + 0.09144281343478224i, -0.05199404300017779 + -0.08774059832781808i }, { 0.045294586255415305 + 0.040089282206308106i, -0.038590656662191705 + 0.07086854974437473i, 0.05497418423916305 + 0.0445265320854523i, -0.04309921916494504 + 0.08961842017834779i } }), Matrix({ { -0.01839881108830326 + -0.07206139271771758i, 0.04608515529982318 + 0.03977358751391643i, 0.0775471697242023 + -0.025371181985709864i, -0.07230607334729212 + -0.008508941619170075i }, { -0.21524084752334968 + -0.02022306234278055i, -0.08930092924464976 + -0.044672935442574085i, -0.11157253264303967 + 0.01967827924755588i, 0.053335056462871844 + -0.02386678159746158i }, { 0.1566723506678207 + 0.006658584176547848i, -0.07116030426159974 + -0.1080738842323388i, 0.05060906133574908 + -0.20526511989675048i, -0.06693775431625235 + -0.029303045232124212i }, { 0.05442135298403054 + 0.0033315896020400023i, 0.02842306422078777 + 0.17503464888648815i, 0.014447143692591485 + 0.03932784405425075i, -0.1571013973610845 + 0.04655466312449863i } }), Matrix({ { -0.05406391206768087 + 0.06365828728957154i, -0.0018486796948661275 + 0.011270611575647333i, -0.0023451217996710997 + -0.13585050641521548i, -0.11588673093401503 + 0.11920984686548337i }, { -0.14729609357713078 + -0.06183619357595426i, 0.04299323246240298 + -0.024401199256201954i, 0.1629901643112528 + 0.04908897197775623i, -0.007591851985644839 + -0.15753215608503227i }, { -0.024796607564626177 + 0.012463036967173201i, -0.10134871266034412 + 0.07850220406853829i, 0.14485751254745993 + 0.0664514225324243i, -0.021649564105258094 + -0.037614233971637476i }, { -0.02391589089624057 + -0.0017691982586303468i, 0.05776773485796702 + 0.17407392412617426i, -0.03575449855736453 + 0.11534933898311729i, 0.03277678231795018 + -0.13869630904638347i } }), Matrix({ { -0.039397292471001724 + -0.03976564100717373i, 0.13718979079074067 + -0.02010859870082635i, -0.048410916038001156 + 0.004917019946500078i, 0.008192461367584069 + 0.1001989779213966i }, { -0.14000774031846058 + 0.1860845419277582i, -0.042472200673333176 + 0.09774016214236697i, -0.0023344534253393894 + -0.07329995175901692i, 0.1297979261993205 + -0.1410114892908608i }, { 0.27251392351472153 + 0.02939702629196267i, -0.06266845763410069 + 0.025356077562034247i, 0.021483272584134544 + 0.030681793697436347i, -0.0015383849020951697 + 0.003429123332054627i }, { 0.02875869156817648 + -0.15999400812962744i, -0.08024677822069784 + -0.05079428526000808i, 0.08304939247721317 + -0.03363015134798774i, -0.027887595267306123 + -0.10838109467243633i } }), Matrix({ { 0.0415705402177639 + -0.026940904372007173i, -0.10278255365004878 + -0.15507770462289247i, -0.10021680971088458 + -0.017793438885003753i, -0.1620018006146553 + -0.05144089307023604i }, { -0.12685077670131475 + -0.08532202769615568i, -0.1400517495114398 + 0.03818516568037117i, 0.16774944211366571 + -0.08802089746085111i, -0.15838843809143666 + 0.031134899622757214i }, { 0.10472557444353438 + -0.11419356287589971i, 0.11421458480395585 + 0.03669424520642914i, 0.13171528296503832 + 0.0333725134346393i, 0.09120456827551306 + 0.017227214419298042i }, { -0.10130027262886776 + 0.006901835678131083i, 0.02425152041002741 + -0.12905502769632718i, 0.0577717535496623 + 0.13139047859924521i, 0.03530462526987095 + 0.188544667024429i } }), Matrix({ { 0.035930984499385796 + -0.0624848856556077i, -0.005816775711689239 + -0.011501884452955533i, -0.14057248385631405 + -0.07957955584773657i, -0.059588044017700716 + 0.1332626825304101i }, { 0.0988799788204096 + -0.06436969056116827i, -0.10541312518819765 + 0.013858067266671591i, 0.02742397536830354 + 0.11143913371934402i, -0.1020030603385728 + -0.08567999344644124i }, { 0.04195550560657477 + -0.062141973639271285i, -0.11764020710476883 + -0.021536109002537912i, -0.13739987501931777 + -0.05864353611115516i, 0.07043964375629118 + -0.11002312485848473i }, { -0.09524173563890614 + 0.08820265445768116i, -0.13819208057220747 + 0.18449555842120602i, -0.05617941244265928 + 0.053627173985896316i, 0.10524468825094407 + -0.08972104099752816i } }), Matrix({ { -0.004857053776987901 + -0.06768325573744016i, -0.029311063443502414 + 0.10167788201285725i, -0.20301566199234425 + -0.06612618786888079i, 0.07960000163319719 + -0.104353551731421i }, { -0.08857660915017049 + -0.1735694927227084i, 0.04035876430634227 + 0.14084696677616448i, -0.13346548214785953 + 0.038360511060396715i, -0.14175387886501145 + 0.12113091823111469i }, { 0.13995156176359966 + -0.05380909785253997i, 0.1423826739842312 + -0.0876488572775287i, 0.15339960498308552 + 0.2423799172069671i, 0.16455548263075973 + 0.013327796646422486i }, { 0.029734665304438464 + 0.017072281920375812i, 0.07197632363490226 + 0.10876117670256422i, -0.14083485678191018 + -0.08461123131954607i, 0.11395213641374577 + 0.03512669315099339i } }), Matrix({ { 0.004805065024097922 + 0.03818301512752517i, 0.09381794076290985 + -0.02571077998224014i, -0.07905327342282756 + 0.06794751560692304i, -0.16911670311423838 + -0.09004142368782202i }, { -0.055903216464575724 + 0.11755403206925144i, -0.06265916284977471 + -0.12399616738819698i, 0.0683392129948306 + 0.09790661449823593i, -0.09077472441201126 + 0.1718034598922796i }, { -0.17483232796657894 + -0.004751436612978551i, 0.07711686198048338 + 0.043676680330676156i, 0.05136509294785422 + -0.12697006680192005i, 0.02088487240827007 + -0.06693368773818832i }, { 0.05653936874393317 + 0.14155274807979384i, -0.0572957038069415 + -0.01134957425804544i, 0.02735791283735309 + -0.04448682763948031i, 0.18820672773339495 + 0.03940807767007158i } }), Matrix({ { -0.005839973735913057 + -0.04925182539590755i, 0.03349762738071014 + 0.09514001159312786i, 0.11978059201103125 + 0.024510020058306155i, 0.07808828396121939 + -0.027065233575886097i }, { 0.019318518510234913 + -0.13636749282183955i, -0.015171363273427616 + 0.09268393935182281i, 0.048093282739264526 + -0.052972139665114944i, -0.002065344122400987 + 0.12720730260041538i }, { 0.017833428541748863 + 0.038824877165348576i, -0.10350211260796657 + -0.018342206224625915i, 0.06764191318981898 + 0.05408701635221111i, 0.03078298379043219 + -0.05131465785813377i }, { -0.052971869333249114 + 0.04955597670365689i, 0.08263706891403594 + -0.1681449494624974i, -0.008955428119116416 + 0.11223210461129454i, 0.022384137886657135 + -0.17107941588830278i } }), Matrix({ { -0.07042150662690183 + -0.04596339847138132i, 0.2398550277020677 + 0.00016683838833537142i, 0.053754788716397266 + -0.08478119117548213i, -0.11899129746465355 + 0.07754853987500097i }, { -0.11034804266239417 + -0.0450402908758141i, 0.04412519244697823 + 0.059833857460714984i, -0.11103660025548767 + -0.018337063949543014i, -0.09882268234098968 + -0.06935838613269854i }, { 0.018829004301805834 + -0.09050413426563764i, -0.027904678516493277 + 0.0032520065372540286i, 0.008352282759241565 + 0.10044772874311789i, -0.01607093422861765 + 0.10965621169995486i }, { 0.05326353200687797 + 0.06802004803181438i, 0.06237927419958792 + -0.10744338100185206i, -0.1113244168383083 + 0.03676764645843103i, 0.11230758106364112 + -0.00997292100183724i } }), Matrix({ { -0.06715079009260777 + 0.15102430641335804i, -0.05717439402688661 + 0.08751481456496744i, 0.10607118828641632 + 0.09684909897118035i, 0.043237309029140365 + -0.029233306443210927i }, { 0.09441748431295044 + -0.10987936895645511i, 0.08215477853476358 + -0.08911959840502308i, 0.05417124720251215 + -0.10707950682920447i, -0.02826752609070908 + 0.02971032105971667i }, { 0.018708145880036713 + 0.11152939899769543i, 0.007615055720047237 + -0.00042555727232372i, -0.0674401823985305 + 0.16748907948150363i, -0.09040499878317043 + 0.001681193779873008i }, { -0.12746936148769167 + 0.07131601131925142i, -0.0675623160897094 + -0.100837876588469i, -0.03710405313667717 + -0.10308443349498399i, 0.05074998298711776 + -0.014704607799708766i } }), Matrix({ { -0.02242168601477686 + -0.003375392267596412i, -0.15857023978947588 + 0.06032451511448987i, 0.053117572358633305 + 0.05942010828522606i, -0.12732166842863424 + -0.10505512461083844i }, { -0.27342076211690847 + 0.03345932367329183i, 0.06717147100151877 + -0.1318439823790492i, 0.06202834906729694 + 0.05055996987529742i, -0.04970270298510071 + -0.07225787599163264i }, { 0.07043135845814773 + -0.030866319126857618i, -0.051964810646750924 + -0.01026578777062481i, 0.09415547595124424 + -0.0582227479653034i, 0.06774463006404051 + 0.056780299149174575i }, { 0.075416645130399 + 0.015594092416385057i, -0.05689798757666888 + 0.0011732050217825158i, 0.05000376226947163 + -0.025559386879028798i, -0.08534589517006498 + 0.005422124229735121i } }), Matrix({ { 0.061020036944593806 + 0.027494693118185677i, 0.010908617238722322 + 0.16651631728179359i, 0.11948973406577505 + 0.01237387675548881i, 0.016426745656334424 + 0.09147880604998243i }, { 0.056570587284866636 + 0.0700948317822217i, 0.060545215843739564 + -0.036639412712956336i, 0.008094952838431492 + -0.0609213749786749i, -0.10891902637694718 + 0.023127375864817223i }, { -0.04757567173746048 + -0.025852118058328034i, -0.06821591987168564 + 0.05205427590254701i, -0.09376212334934707 + -0.007311369729487199i, -0.0750200907073535 + -0.011137380504260132i }, { -0.010136057805475492 + 0.02452768652858528i, -0.006459582309779006 + 0.04576765615278538i, 0.012195726272174065 + -0.1434671230227528i, 0.05383799372241112 + 0.07721321561526069i } }) }, { QubitIndex{ 5 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.009471701759524054 + 0.4468164013202089i, -0.3823536580954491 + 0.5437937067498908i, 0.3489316679865173 + -0.48284105475990025i, -0.03424162786298509 + -0.047939470721582896i }, { -0.3869833224851007 + 0.20434448646738143i, 0.2953136657640002 + 0.2306669955692474i, 0.022180329493587142 + 0.13179337755975737i, 0.6748906371490164 + 0.4412833346506549i }, { 0.020682249239171835 + 0.7280863582757582i, -0.18852677268096393 + -0.2437971620858442i, -0.4958990963257348 + 0.18297731761622377i, -0.20990583546162564 + 0.22588941307859034i }, { -0.19991875633874312 + 0.19556998662610448i, 0.3730700443194702 + 0.42838767767197133i, 0.19033821697510633 + 0.5582333707236333i, -0.42425480313650865 + -0.26691260710238013i } }) }, { QubitIndex{ 2 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.5408218432134029 + -0.04245728478128834i, -0.8119174444624566 + 0.21563667649500526i }, { 0.3271777548167254 + 0.7737336942549061i, -0.364987242541767 + -0.4013417495221493i } }) }, { QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.4886938224762858 + -0.1466624366327934i, -0.6410791002843677 + 0.5733114901456567i }, { -0.7141715532912273 + -0.47919460558737875i, 0.46373023675811 + -0.21280458162788538i } }) }, { QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 0 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.626016977670566 + -0.07385154079860547i, -0.7579106522672915 + -0.16798850189715456i }, { 0.19050210565384576 + 0.7525673666399126i, -0.09247609700329584 + -0.623537872060034i } }) }, { QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 0 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 0 }, QubitIndex{ 7 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_15_2_10_30_80) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.9999999999999991 + 3.1468968056391766e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999991, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.4481353388993671 + 1.4690939437178585e-17i, -0.11689140754955937 + 0.09457883857444987i }, { -0.11689140754955937 + -0.09457883857444987i, 0.551864661100632 + 1.677802861921318e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4481353388993671, 1.0e-7), DoubleNear(0.551864661100632, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.9999999999999991 + 3.1468968056391766e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999991, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.6830965825204842 + 3.0791341698588326e-17i, 0.0031519259115711028 + 0.041608256399334576i }, { 0.003151925911571112 + -0.04160825639933458i, 0.3169034174795149 + 6.776263578034403e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.6830965825204842, 1.0e-7), DoubleNear(0.3169034174795149, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.27660922376501274 + 7.318364664277155e-18i, 0.0 + 0.0i, -0.04594585446304561 + -0.14243771708525754i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1715261151343543 + 7.37257477290143e-18i, 0.0 + 0.0i, -0.07094555308651376 + 0.23701655565970742i }, { -0.04594585446304561 + 0.14243771708525754i, 0.0 + 0.0i, 0.10115851519173605 + -5.692061405548898e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.07094555308651376 + -0.23701655565970742i, 0.0 + 0.0i, 0.450706145908896 + 1.734723475976807e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.27660922376501274, 1.0e-7), DoubleNear(0.1715261151343543, 1.0e-7), DoubleNear(0.10115851519173605, 1.0e-7), DoubleNear(0.450706145908896, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.31371173470134744 + 9.974659986866641e-18i, 0.0 + 0.0i, -0.0033353470882359682 + -0.04429250351974587i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.36938484781913683 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.006487272999807071 + 0.08590075991908044i }, { -0.0033353470882359643 + 0.04429250351974589i, 0.0 + 0.0i, 0.06405600425540137 + -3.2255014631443757e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.006487272999807076 + -0.08590075991908047i, 0.0 + 0.0i, 0.2528474132241135 + 3.903127820947816e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.31371173470134744, 1.0e-7), DoubleNear(0.36938484781913683, 1.0e-7), DoubleNear(0.06405600425540137, 1.0e-7), DoubleNear(0.2528474132241135, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004574426081352518 + 0.0382672878157116i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00457442608135248 + -0.038267287815711586i, 0.0 + 0.0i, 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.4481353388993671 + 1.4690939437178585e-17i, 0.0 + 0.0i, -0.11689140754955937 + 0.09457883857444987i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11689140754955937 + -0.09457883857444987i, 0.0 + 0.0i, 0.551864661100632 + 1.677802861921318e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4481353388993671, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.551864661100632, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.9999999999999991 + 3.1468968056391766e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999991, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.6830965825204842 + 3.0791341698588326e-17i, 0.0 + 0.0i, 0.0031519259115711028 + 0.041608256399334576i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003151925911571112 + -0.04160825639933458i, 0.0 + 0.0i, 0.3169034174795149 + 6.776263578034403e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.6830965825204842, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3169034174795149, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.31343470975143195 + 1.3444106938820255e-17i, -0.14398337023797264 + 0.05639617099436217i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.14398337023797264 + -0.0563961709943622i, 0.41683740041237777 + 2.3635607360183997e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.13470062914793512 + 1.2468324983583301e-18i, 0.027091962688413282 + 0.03818266758008771i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.027091962688413275 + -0.038182667580087676i, 0.13502726068825432 + -6.8575787409708155e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.31343470975143195, 1.0e-7), DoubleNear(0.41683740041237777, 1.0e-7), DoubleNear(0.13470062914793512, 1.0e-7), DoubleNear(0.13502726068825432, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.4481353388993671 + 1.4690939437178585e-17i, -0.11689140754955937 + 0.09457883857444987i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11689140754955937 + -0.09457883857444987i, 0.551864661100632 + 1.677802861921318e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.4481353388993671, 1.0e-7), DoubleNear(0.551864661100632, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.33264658797704927 + 1.431146867680866e-17i, -0.07984812102311323 + 0.022964536595318427i, 0.00013608871955717418 + -0.011779895865506644i, -0.04830628883860742 + -0.0007478952681239381i }, { -0.07984812102311321 + -0.02296453659531844i, 0.35044999454343495 + 1.6479873021779667e-17i, 0.04756942272601647 + -0.008979400044278427i, 0.0030158371920139286 + 0.05338815226484121i }, { 0.00013608871955719153 + 0.011779895865506651i, 0.04756942272601648 + 0.008979400044278435i, 0.11548875092231778 + 3.7947076036992655e-19i, -0.03704328652644615 + 0.07161430197913146i }, { -0.04830628883860742 + 0.0007478952681239347i, 0.0030158371920139203 + -0.053388152264841233i, -0.037043286526446166 + -0.07161430197913145i, 0.20141466655719714 + 2.981555974335137e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.33264658797704927, 1.0e-7), DoubleNear(0.35044999454343495, 1.0e-7), DoubleNear(0.11548875092231778, 1.0e-7), DoubleNear(0.20141466655719714, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.31343470975143195 + 1.3444106938820255e-17i, -0.14398337023797264 + 0.05639617099436217i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.14398337023797264 + -0.0563961709943622i, 0.41683740041237777 + 2.3635607360183997e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.13470062914793512 + 1.2468324983583301e-18i, 0.027091962688413282 + 0.03818266758008771i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.027091962688413275 + -0.038182667580087676i, 0.13502726068825432 + -6.8575787409708155e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.31343470975143195, 1.0e-7), DoubleNear(0.41683740041237777, 1.0e-7), DoubleNear(0.13470062914793512, 1.0e-7), DoubleNear(0.13502726068825432, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.27660922376501274 + 7.318364664277155e-18i, -0.04594585446304561 + -0.14243771708525754i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04594585446304561 + 0.14243771708525754i, 0.10115851519173605 + -5.692061405548898e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1715261151343543 + 7.37257477290143e-18i, -0.07094555308651376 + 0.23701655565970742i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.07094555308651376 + -0.23701655565970742i, 0.450706145908896 + 1.734723475976807e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.27660922376501274, 1.0e-7), DoubleNear(0.10115851519173605, 1.0e-7), DoubleNear(0.1715261151343543, 1.0e-7), DoubleNear(0.450706145908896, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.4988463827629215 + 3.5128150388530344e-17i, 0.0 + 0.0i, 0.002301763586523023 + 0.03038534920097892i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1842501997575628 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0008501623250480803 + 0.011222907198355652i }, { 0.00230176358652303 + -0.030385349200978934i, 0.0 + 0.0i, 0.2314257274008883 + 1.951563910473908e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0008501623250480824 + -0.011222907198355652i, 0.0 + 0.0i, 0.08547769007862663 + -1.2739375526704677e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4988463827629215, 1.0e-7), DoubleNear(0.1842501997575628, 1.0e-7), DoubleNear(0.2314257274008883, 1.0e-7), DoubleNear(0.08547769007862663, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05997158904933389 + 0.08613567895832572i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.059971589049333876 + -0.08613567895832575i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.6830965825204842 + 3.0791341698588326e-17i, 0.0 + 0.0i, 0.0031519259115711028 + 0.041608256399334576i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003151925911571112 + -0.04160825639933458i, 0.0 + 0.0i, 0.3169034174795149 + 6.776263578034403e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.6830965825204842, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3169034174795149, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.4988463827629215 + 3.5128150388530344e-17i, 0.002301763586523023 + 0.03038534920097892i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00230176358652303 + -0.030385349200978934i, 0.2314257274008883 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1842501997575628 + -4.336808689942018e-18i, 0.0008501623250480803 + 0.011222907198355652i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0008501623250480824 + -0.011222907198355652i, 0.08547769007862663 + -1.2739375526704677e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.4988463827629215, 1.0e-7), DoubleNear(0.2314257274008883, 1.0e-7), DoubleNear(0.1842501997575628, 1.0e-7), DoubleNear(0.08547769007862663, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.31371173470134744 + 9.974659986866641e-18i, -0.0033353470882359682 + -0.04429250351974587i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0033353470882359643 + 0.04429250351974589i, 0.06405600425540137 + -3.2255014631443757e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.36938484781913683 + 2.0816681711721685e-17i, 0.006487272999807071 + 0.08590075991908044i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.006487272999807076 + -0.08590075991908047i, 0.2528474132241135 + 3.903127820947816e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.31371173470134744, 1.0e-7), DoubleNear(0.06405600425540137, 1.0e-7), DoubleNear(0.36938484781913683, 1.0e-7), DoubleNear(0.2528474132241135, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.27660922376501274 + 7.318364664277155e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04594585446304561 + -0.14243771708525754i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1715261151343543 + 7.37257477290143e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07094555308651376 + 0.23701655565970742i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04594585446304561 + 0.14243771708525754i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10115851519173605 + -5.692061405548898e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.07094555308651376 + -0.23701655565970742i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.450706145908896 + 1.734723475976807e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.27660922376501274, 1.0e-7), DoubleNear(0.1715261151343543, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.10115851519173605, 1.0e-7), DoubleNear(0.450706145908896, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.31371173470134744 + 9.974659986866641e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0033353470882359682 + -0.04429250351974587i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.36938484781913683 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006487272999807071 + 0.08590075991908044i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0033353470882359643 + 0.04429250351974589i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06405600425540137 + -3.2255014631443757e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.006487272999807076 + -0.08590075991908047i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2528474132241135 + 3.903127820947816e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.31371173470134744, 1.0e-7), DoubleNear(0.36938484781913683, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.06405600425540137, 1.0e-7), DoubleNear(0.2528474132241135, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004574426081352518 + 0.0382672878157116i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00457442608135248 + -0.038267287815711586i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.2284651549070498 + 8.673617379884035e-18i, 0.0 + 0.0i, -0.05557685732212324 + -0.09547227627531701i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.08496955484438215 + 4.7704895589362195e-18i, 0.0 + 0.0i, -0.08840651291584942 + 0.15186844726967919i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05557685732212323 + 0.09547227627531699i, 0.0 + 0.0i, 0.05341620962706172 + 2.8189256484623115e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.08840651291584942 + -0.15186844726967919i, 0.0 + 0.0i, 0.36342119078531604 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.048144068857962956 + -1.3552527156068805e-18i, 0.0 + 0.0i, 0.009631002859077625 + -0.04696544080994052i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08655656028997216 + 2.6020852139652106e-18i, 0.0 + 0.0i, 0.017460959829335657 + 0.08514810839002823i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00963100285907762 + 0.04696544080994054i, 0.0 + 0.0i, 0.04774230556467432 + -3.3881317890172014e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.017460959829335657 + -0.08514810839002822i, 0.0 + 0.0i, 0.08728495512358 + -3.469446951953614e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2284651549070498, 1.0e-7), DoubleNear(0.08496955484438215, 1.0e-7), DoubleNear(0.05341620962706172, 1.0e-7), DoubleNear(0.36342119078531604, 1.0e-7), DoubleNear(0.048144068857962956, 1.0e-7), DoubleNear(0.08655656028997216, 1.0e-7), DoubleNear(0.04774230556467432, 1.0e-7), DoubleNear(0.08728495512358, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.27660922376501274 + 7.318364664277155e-18i, 0.0 + 0.0i, -0.04594585446304561 + -0.14243771708525754i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1715261151343543 + 7.37257477290143e-18i, 0.0 + 0.0i, -0.07094555308651376 + 0.23701655565970742i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04594585446304561 + 0.14243771708525754i, 0.0 + 0.0i, 0.10115851519173605 + -5.692061405548898e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.07094555308651376 + -0.23701655565970742i, 0.0 + 0.0i, 0.450706145908896 + 1.734723475976807e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.27660922376501274, 1.0e-7), DoubleNear(0.1715261151343543, 1.0e-7), DoubleNear(0.10115851519173605, 1.0e-7), DoubleNear(0.450706145908896, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.2300441917983913 + 9.107298248878237e-18i, 0.0 + 0.0i, -0.038481305987126374 + -0.11811969016978154i, 0.0 + 0.0i, -0.0020293700603453914 + -0.033709165700009126i, 0.0 + 0.0i, -0.01606743372335705 + 0.008079492026226917i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.10260239617865796 + 5.204170427930421e-18i, 0.0 + 0.0i, -0.04136681503598685 + 0.14108422676509996i, 0.0 + 0.0i, 0.0021654587799025656 + 0.021929269834502482i, 0.0 + 0.0i, -0.032238855115250376 + -0.008827387294350855i }, { -0.03848130598712637 + 0.11811969016978152i, 0.0 + 0.0i, 0.08366754290295611 + 8.673617379884035e-19i, 0.0 + 0.0i, 0.016081991386759347 + 0.0051597513926708955i, 0.0 + 0.0i, -0.0013059770278905768 + -0.010583337819736749i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.04136681503598685 + -0.14108422676509996i, 0.0 + 0.0i, 0.2667824516404788 + 1.5612511283791264e-17i, 0.0 + 0.0i, 0.03148743133925712 + -0.014139151436949323i, 0.0 + 0.0i, 0.004321814219904505 + 0.06397149008457796i }, { -0.002029370060345382 + 0.03370916570000914i, 0.0 + 0.0i, 0.01608199138675936 + -0.005159751392670891i, 0.0 + 0.0i, 0.046565031966621435 + -1.7889335846010823e-18i, 0.0 + 0.0i, -0.00746454847591924 + -0.024318026915476i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0021654587799025734 + -0.02192926983450249i, 0.0 + 0.0i, 0.03148743133925712 + 0.014139151436949327i, 0.0 + 0.0i, 0.06892371895569635 + 2.168404344971009e-18i, 0.0 + 0.0i, -0.029578738050526913 + 0.09593232889460745i }, { -0.016067433723357047 + -0.008079492026226917i, 0.0 + 0.0i, -0.0013059770278905825 + 0.010583337819736742i, 0.0 + 0.0i, -0.0074645484759192455 + 0.024318026915476007i, 0.0 + 0.0i, 0.01749097228877993 + -1.4365678785432934e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.032238855115250376 + 0.008827387294350852i, 0.0 + 0.0i, 0.004321814219904503 + -0.06397149008457798i, 0.0 + 0.0i, -0.029578738050526923 + -0.09593232889460745i, 0.0 + 0.0i, 0.1839236942684172 + 1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2300441917983913, 1.0e-7), DoubleNear(0.10260239617865796, 1.0e-7), DoubleNear(0.08366754290295611, 1.0e-7), DoubleNear(0.2667824516404788, 1.0e-7), DoubleNear(0.046565031966621435, 1.0e-7), DoubleNear(0.06892371895569635, 1.0e-7), DoubleNear(0.01749097228877993, 1.0e-7), DoubleNear(0.1839236942684172, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.2284651549070498 + 8.673617379884035e-18i, 0.0 + 0.0i, -0.05557685732212324 + -0.09547227627531701i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.08496955484438215 + 4.7704895589362195e-18i, 0.0 + 0.0i, -0.08840651291584942 + 0.15186844726967919i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05557685732212323 + 0.09547227627531699i, 0.0 + 0.0i, 0.05341620962706172 + 2.8189256484623115e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.08840651291584942 + -0.15186844726967919i, 0.0 + 0.0i, 0.36342119078531604 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.048144068857962956 + -1.3552527156068805e-18i, 0.0 + 0.0i, 0.009631002859077625 + -0.04696544080994052i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08655656028997216 + 2.6020852139652106e-18i, 0.0 + 0.0i, 0.017460959829335657 + 0.08514810839002823i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00963100285907762 + 0.04696544080994054i, 0.0 + 0.0i, 0.04774230556467432 + -3.3881317890172014e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.017460959829335657 + -0.08514810839002822i, 0.0 + 0.0i, 0.08728495512358 + -3.469446951953614e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2284651549070498, 1.0e-7), DoubleNear(0.08496955484438215, 1.0e-7), DoubleNear(0.05341620962706172, 1.0e-7), DoubleNear(0.36342119078531604, 1.0e-7), DoubleNear(0.048144068857962956, 1.0e-7), DoubleNear(0.08655656028997216, 1.0e-7), DoubleNear(0.04774230556467432, 1.0e-7), DoubleNear(0.08728495512358, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.27660922376501274 + 7.318364664277155e-18i, 0.0 + 0.0i, -0.04594585446304561 + -0.14243771708525754i, 0.0 + 0.0i, 0.0 + 0.0i, -0.021356401162560552 + 0.010932107456186167i, 0.0 + 0.0i, 0.015304417012560512 + -0.0595914975462557i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04594585446304561 + 0.14243771708525754i, 0.0 + 0.0i, 0.10115851519173605 + -5.692061405548898e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006032741951767931 + -0.006005121167469185i, 0.0 + 0.0i, 0.016781975081208034 + 0.027335180359525427i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02135640116256052 + -0.010932107456186169i, 0.0 + 0.0i, 0.006032741951767912 + 0.006005121167469195i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1715261151343543 + 7.37257477290143e-18i, 0.0 + 0.0i, -0.07094555308651376 + 0.23701655565970742i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.015304417012560481 + 0.0595914975462557i, 0.0 + 0.0i, 0.01678197508120804 + -0.027335180359525417i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07094555308651376 + -0.23701655565970742i, 0.0 + 0.0i, 0.450706145908896 + 1.734723475976807e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.27660922376501274, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.10115851519173605, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1715261151343543, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.450706145908896, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.23518049593641285 + 1.431146867680866e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0011501360564870355 + -0.037191616234173386i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2636658868265086 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0034518996430100584 + 0.0675769654351523i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.07853123876493458 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0021852110317489327 + -0.007100887285572486i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10571896099262822 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003035373356797013 + 0.018323794483928138i }, { -0.0011501360564870316 + 0.0371916162341734i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04670086859769867 + -2.8189256484623115e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0034518996430100615 + -0.06757696543515233i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.18472485880318962 + 4.7704895589362195e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0021852110317489327 + 0.007100887285572487i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0173551356577027 + -4.0657581468206416e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003035373356797015 + -0.018323794483928138i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06812255442092394 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.23518049593641285, 1.0e-7), DoubleNear(0.2636658868265086, 1.0e-7), DoubleNear(0.07853123876493458, 1.0e-7), DoubleNear(0.10571896099262822, 1.0e-7), DoubleNear(0.04670086859769867, 1.0e-7), DoubleNear(0.18472485880318962, 1.0e-7), DoubleNear(0.0173551356577027, 1.0e-7), DoubleNear(0.06812255442092394, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08537989465397014 + -0.11114883374542953i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.14535148370330403 + 0.19728451270375524i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08537989465397013 + 0.1111488337454295i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.145351483703304 + -0.19728451270375524i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005870226233583362 + 0.03408205584170027i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001295800152230844 + 0.004185231974011325i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005870226233583346 + -0.03408205584170026i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0012958001522308665 + -0.004185231974011329i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.31371173470134744 + 9.974659986866641e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0033353470882359682 + -0.04429250351974587i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.36938484781913683 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006487272999807071 + 0.08590075991908044i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0033353470882359643 + 0.04429250351974589i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06405600425540137 + -3.2255014631443757e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.006487272999807076 + -0.08590075991908047i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2528474132241135 + 3.903127820947816e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.31371173470134744, 1.0e-7), DoubleNear(0.36938484781913683, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.06405600425540137, 1.0e-7), DoubleNear(0.2528474132241135, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004574426081352518 + 0.0382672878157116i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00457442608135248 + -0.038267287815711586i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.23518049593641285 + 1.431146867680866e-17i, 0.0 + 0.0i, -0.0011501360564870355 + -0.037191616234173386i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2636658868265086 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.0034518996430100584 + 0.0675769654351523i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0011501360564870316 + 0.0371916162341734i, 0.0 + 0.0i, 0.04670086859769867 + -2.8189256484623115e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0034518996430100615 + -0.06757696543515233i, 0.0 + 0.0i, 0.18472485880318962 + 4.7704895589362195e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07853123876493458 + -4.336808689942018e-18i, 0.0 + 0.0i, -0.0021852110317489327 + -0.007100887285572486i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10571896099262822 + 0.0i, 0.0 + 0.0i, 0.003035373356797013 + 0.018323794483928138i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0021852110317489327 + 0.007100887285572487i, 0.0 + 0.0i, 0.0173551356577027 + -4.0657581468206416e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003035373356797015 + -0.018323794483928138i, 0.0 + 0.0i, 0.06812255442092394 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.23518049593641285, 1.0e-7), DoubleNear(0.2636658868265086, 1.0e-7), DoubleNear(0.04670086859769867, 1.0e-7), DoubleNear(0.18472485880318962, 1.0e-7), DoubleNear(0.07853123876493458, 1.0e-7), DoubleNear(0.10571896099262822, 1.0e-7), DoubleNear(0.0173551356577027, 1.0e-7), DoubleNear(0.06812255442092394, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.31371173470134744 + 9.974659986866641e-18i, 0.0 + 0.0i, -0.0033353470882359682 + -0.04429250351974587i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001734761073881706 + 0.037911269155447i, 0.0 + 0.0i, 0.0181790204148395 + 0.013151294118552287i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0033353470882359643 + 0.04429250351974589i, 0.0 + 0.0i, 0.06405600425540137 + -3.2255014631443757e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.015828166487683492 + 0.004453803355466336i, 0.0 + 0.0i, -0.006309187155234224 + 0.00035601866026459955i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0017347610738817389 + -0.037911269155447014i, 0.0 + 0.0i, -0.01582816648768351 + -0.004453803355466344i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36938484781913683 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.006487272999807071 + 0.08590075991908044i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.018179020414839507 + -0.013151294118552292i, 0.0 + 0.0i, -0.006309187155234219 + -0.0003560186602645744i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006487272999807076 + -0.08590075991908047i, 0.0 + 0.0i, 0.2528474132241135 + 3.903127820947816e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.31371173470134744, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.06405600425540137, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36938484781913683, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2528474132241135, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005870226233583362 + 0.03408205584170027i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.001295800152230844 + 0.004185231974011325i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005870226233583346 + -0.03408205584170026i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0012958001522308665 + -0.004185231974011329i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.31343470975143195 + 1.3444106938820255e-17i, 0.0 + 0.0i, -0.14398337023797264 + 0.05639617099436217i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.14398337023797264 + -0.0563961709943622i, 0.0 + 0.0i, 0.41683740041237777 + 2.3635607360183997e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13470062914793512 + 1.2468324983583301e-18i, 0.0 + 0.0i, 0.027091962688413282 + 0.03818266758008771i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027091962688413275 + -0.038182667580087676i, 0.0 + 0.0i, 0.13502726068825432 + -6.8575787409708155e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.31343470975143195, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.41683740041237777, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.13470062914793512, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.13502726068825432, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.4481353388993671 + 1.4690939437178585e-17i, 0.0 + 0.0i, -0.11689140754955937 + 0.09457883857444987i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11689140754955937 + -0.09457883857444987i, 0.0 + 0.0i, 0.551864661100632 + 1.677802861921318e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.4481353388993671, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.551864661100632, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.33264658797704927 + 1.431146867680866e-17i, 0.0 + 0.0i, -0.07984812102311323 + 0.022964536595318427i, 0.0 + 0.0i, 0.00013608871955717418 + -0.011779895865506644i, 0.0 + 0.0i, -0.04830628883860742 + -0.0007478952681239381i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07984812102311321 + -0.02296453659531844i, 0.0 + 0.0i, 0.35044999454343495 + 1.6479873021779667e-17i, 0.0 + 0.0i, 0.04756942272601647 + -0.008979400044278427i, 0.0 + 0.0i, 0.0030158371920139286 + 0.05338815226484121i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00013608871955719153 + 0.011779895865506651i, 0.0 + 0.0i, 0.04756942272601648 + 0.008979400044278435i, 0.0 + 0.0i, 0.11548875092231778 + 3.7947076036992655e-19i, 0.0 + 0.0i, -0.03704328652644615 + 0.07161430197913146i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04830628883860742 + 0.0007478952681239347i, 0.0 + 0.0i, 0.0030158371920139203 + -0.053388152264841233i, 0.0 + 0.0i, -0.037043286526446166 + -0.07161430197913145i, 0.0 + 0.0i, 0.20141466655719714 + 2.981555974335137e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.33264658797704927, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.35044999454343495, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11548875092231778, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20141466655719714, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.31343470975143195 + 1.3444106938820255e-17i, 0.0 + 0.0i, -0.14398337023797264 + 0.05639617099436217i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.14398337023797264 + -0.0563961709943622i, 0.0 + 0.0i, 0.41683740041237777 + 2.3635607360183997e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13470062914793512 + 1.2468324983583301e-18i, 0.0 + 0.0i, 0.027091962688413282 + 0.03818266758008771i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027091962688413275 + -0.038182667580087676i, 0.0 + 0.0i, 0.13502726068825432 + -6.8575787409708155e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.31343470975143195, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.41683740041237777, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.13470062914793512, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.13502726068825432, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.27660922376501274 + 7.318364664277155e-18i, 0.0 + 0.0i, -0.04594585446304561 + -0.14243771708525754i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04594585446304561 + 0.14243771708525754i, 0.0 + 0.0i, 0.10115851519173605 + -5.692061405548898e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1715261151343543 + 7.37257477290143e-18i, 0.0 + 0.0i, -0.07094555308651376 + 0.23701655565970742i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07094555308651376 + -0.23701655565970742i, 0.0 + 0.0i, 0.450706145908896 + 1.734723475976807e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.27660922376501274, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.10115851519173605, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1715261151343543, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.450706145908896, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.4988463827629215 + 3.5128150388530344e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.002301763586523023 + 0.03038534920097892i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1842501997575628 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008501623250480803 + 0.011222907198355652i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00230176358652303 + -0.030385349200978934i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2314257274008883 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0008501623250480824 + -0.011222907198355652i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08547769007862663 + -1.2739375526704677e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4988463827629215, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1842501997575628, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2314257274008883, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.08547769007862663, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05997158904933389 + 0.08613567895832572i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.059971589049333876 + -0.08613567895832575i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.6830965825204842 + 3.0791341698588326e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0031519259115711028 + 0.041608256399334576i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003151925911571112 + -0.04160825639933458i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3169034174795149 + 6.776263578034403e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.6830965825204842, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3169034174795149, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.37776773895674876 + 6.749158523722265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.6222322610432504 + 2.47198095326695e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.37776773895674876, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6222322610432504, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.4988463827629215 + 3.5128150388530344e-17i, 0.0 + 0.0i, 0.002301763586523023 + 0.03038534920097892i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00230176358652303 + -0.030385349200978934i, 0.0 + 0.0i, 0.2314257274008883 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1842501997575628 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0008501623250480803 + 0.011222907198355652i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008501623250480824 + -0.011222907198355652i, 0.0 + 0.0i, 0.08547769007862663 + -1.2739375526704677e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.4988463827629215, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2314257274008883, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1842501997575628, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.08547769007862663, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.31371173470134744 + 9.974659986866641e-18i, 0.0 + 0.0i, -0.0033353470882359682 + -0.04429250351974587i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0033353470882359643 + 0.04429250351974589i, 0.0 + 0.0i, 0.06405600425540137 + -3.2255014631443757e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36938484781913683 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.006487272999807071 + 0.08590075991908044i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006487272999807076 + -0.08590075991908047i, 0.0 + 0.0i, 0.2528474132241135 + 3.903127820947816e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.31371173470134744, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.06405600425540137, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36938484781913683, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2528474132241135, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.31343470975143195 + 1.3444106938820255e-17i, -0.14398337023797264 + 0.05639617099436217i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.14398337023797264 + -0.0563961709943622i, 0.41683740041237777 + 2.3635607360183997e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.13470062914793512 + 1.2468324983583301e-18i, 0.027091962688413282 + 0.03818266758008771i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.027091962688413275 + -0.038182667580087676i, 0.13502726068825432 + -6.8575787409708155e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.31343470975143195, 1.0e-7), DoubleNear(0.41683740041237777, 1.0e-7), DoubleNear(0.13470062914793512, 1.0e-7), DoubleNear(0.13502726068825432, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.24057844628906916 + 1.3877787807814457e-17i, -0.0983545481493408 + 0.009647906711976004i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00027805533542961955 + -0.017338084837984186i, -0.03593859344794859 + -0.004432202872152797i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0983545481493408 + -0.009647906711976045i, 0.25826793647385227 + 2.1250362580715887e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03503094361697179 + -0.007549591100050984i, 0.0025798189219526425 + 0.047723434038963106i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09206814168798011 + 4.336808689942018e-19i, 0.01850642712622759 + 0.013316629883342423i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00041414405498679395 + 0.005558188972477546i, -0.01236769539065883 + 0.0036843076040288594i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.01850642712622759 + -0.013316629883342396i, 0.09218205806958268 + -4.7704895589362195e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.012538479109044678 + -0.001429808944227443i, 0.0004360182700612863 + 0.005664718225878107i }, { -0.000278055335429607 + 0.017338084837984203i, 0.03503094361697179 + 0.007549591100050989i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07285626346236279 + -4.336808689942018e-19i, -0.045628822088631844 + 0.04674826428238617i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03593859344794859 + 0.004432202872152794i, 0.002579818921952637 + -0.04772343403896314i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04562882208863185 + -0.04674826428238617i, 0.1585694639385255 + 2.3852447794681098e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0004141440549867987 + -0.0055581889724775485i, 0.012538479109044688 + 0.0014298089442274459i, 0.0 + 0.0i, 0.0 + 0.0i, 0.042632487459954994 + 8.131516293641283e-19i, 0.00858553556218569 + 0.024866037696745287i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.01236769539065883 + -0.003684307604028859i, 0.0004360182700612837 + -0.005664718225878101i, 0.0 + 0.0i, 0.0 + 0.0i, 0.008585535562185683 + -0.024866037696745284i, 0.04284520261867164 + -2.087089182034596e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24057844628906916, 1.0e-7), DoubleNear(0.25826793647385227, 1.0e-7), DoubleNear(0.09206814168798011, 1.0e-7), DoubleNear(0.09218205806958268, 1.0e-7), DoubleNear(0.07285626346236279, 1.0e-7), DoubleNear(0.1585694639385255, 1.0e-7), DoubleNear(0.042632487459954994, 1.0e-7), DoubleNear(0.04284520261867164, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.31343470975143195 + 1.3444106938820255e-17i, -0.14398337023797264 + 0.05639617099436217i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03529870739033836 + -0.055660054543412676i, -0.13174595401441586 + -0.12654894224271995i }, { -0.14398337023797264 + -0.0563961709943622i, 0.41683740041237777 + 2.3635607360183997e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17192087449720989 + 0.13893124123246448i, -0.02467288165899552 + 0.1417957335017384i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.035298707390338344 + 0.05566005454341265i, 0.1719208744972099 + -0.13893124123246448i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13470062914793512 + 1.2468324983583301e-18i, 0.027091962688413282 + 0.03818266758008771i }, { -0.13174595401441586 + 0.1265489422427199i, -0.024672881658995546 + -0.1417957335017384i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027091962688413275 + -0.038182667580087676i, 0.13502726068825432 + -6.8575787409708155e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.31343470975143195, 1.0e-7), DoubleNear(0.41683740041237777, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.13470062914793512, 1.0e-7), DoubleNear(0.13502726068825432, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.2284651549070498 + 8.673617379884035e-18i, -0.05557685732212324 + -0.09547227627531701i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05557685732212323 + 0.09547227627531699i, 0.05341620962706172 + 2.8189256484623115e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.048144068857962956 + -1.3552527156068805e-18i, 0.009631002859077625 + -0.04696544080994052i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.00963100285907762 + 0.04696544080994054i, 0.04774230556467432 + -3.3881317890172014e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08496955484438215 + 4.7704895589362195e-18i, -0.08840651291584942 + 0.15186844726967919i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08840651291584942 + -0.15186844726967919i, 0.36342119078531604 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08655656028997216 + 2.6020852139652106e-18i, 0.017460959829335657 + 0.08514810839002823i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.017460959829335657 + -0.08514810839002822i, 0.08728495512358 + -3.469446951953614e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2284651549070498, 1.0e-7), DoubleNear(0.05341620962706172, 1.0e-7), DoubleNear(0.048144068857962956, 1.0e-7), DoubleNear(0.04774230556467432, 1.0e-7), DoubleNear(0.08496955484438215, 1.0e-7), DoubleNear(0.36342119078531604, 1.0e-7), DoubleNear(0.08655656028997216, 1.0e-7), DoubleNear(0.08728495512358, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.33264658797704927 + 1.431146867680866e-17i, -0.07984812102311323 + 0.022964536595318427i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00013608871955717418 + -0.011779895865506644i, -0.04830628883860742 + -0.0007478952681239381i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07984812102311321 + -0.02296453659531844i, 0.35044999454343495 + 1.6479873021779667e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04756942272601647 + -0.008979400044278427i, 0.0030158371920139286 + 0.05338815226484121i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00013608871955719153 + 0.011779895865506651i, 0.04756942272601648 + 0.008979400044278435i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11548875092231778 + 3.7947076036992655e-19i, -0.03704328652644615 + 0.07161430197913146i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04830628883860742 + 0.0007478952681239347i, 0.0030158371920139203 + -0.053388152264841233i, 0.0 + 0.0i, 0.0 + 0.0i, -0.037043286526446166 + -0.07161430197913145i, 0.20141466655719714 + 2.981555974335137e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.33264658797704927, 1.0e-7), DoubleNear(0.35044999454343495, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11548875092231778, 1.0e-7), DoubleNear(0.20141466655719714, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.31343470975143195 + 1.3444106938820255e-17i, -0.14398337023797264 + 0.05639617099436217i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.14398337023797264 + -0.0563961709943622i, 0.41683740041237777 + 2.3635607360183997e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13470062914793512 + 1.2468324983583301e-18i, 0.027091962688413282 + 0.03818266758008771i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027091962688413275 + -0.038182667580087676i, 0.13502726068825432 + -6.8575787409708155e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.31343470975143195, 1.0e-7), DoubleNear(0.41683740041237777, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.13470062914793512, 1.0e-7), DoubleNear(0.13502726068825432, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.27660922376501274 + 7.318364664277155e-18i, -0.04594585446304561 + -0.14243771708525754i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04594585446304561 + 0.14243771708525754i, 0.10115851519173605 + -5.692061405548898e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1715261151343543 + 7.37257477290143e-18i, -0.07094555308651376 + 0.23701655565970742i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07094555308651376 + -0.23701655565970742i, 0.450706145908896 + 1.734723475976807e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.27660922376501274, 1.0e-7), DoubleNear(0.10115851519173605, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1715261151343543, 1.0e-7), DoubleNear(0.450706145908896, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.24057844628906916 + 1.3877787807814457e-17i, -0.0983545481493408 + 0.009647906711976004i, -0.00027805533542961955 + -0.017338084837984186i, -0.03593859344794859 + -0.004432202872152797i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0983545481493408 + -0.009647906711976045i, 0.25826793647385227 + 2.1250362580715887e-17i, 0.03503094361697179 + -0.007549591100050984i, 0.0025798189219526425 + 0.047723434038963106i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.000278055335429607 + 0.017338084837984203i, 0.03503094361697179 + 0.007549591100050989i, 0.07285626346236279 + -4.336808689942018e-19i, -0.045628822088631844 + 0.04674826428238617i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03593859344794859 + 0.004432202872152794i, 0.002579818921952637 + -0.04772343403896314i, -0.04562882208863185 + -0.04674826428238617i, 0.1585694639385255 + 2.3852447794681098e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09206814168798011 + 4.336808689942018e-19i, 0.01850642712622759 + 0.013316629883342423i, 0.00041414405498679395 + 0.005558188972477546i, -0.01236769539065883 + 0.0036843076040288594i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01850642712622759 + -0.013316629883342396i, 0.09218205806958268 + -4.7704895589362195e-18i, 0.012538479109044678 + -0.001429808944227443i, 0.0004360182700612863 + 0.005664718225878107i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0004141440549867987 + -0.0055581889724775485i, 0.012538479109044688 + 0.0014298089442274459i, 0.042632487459954994 + 8.131516293641283e-19i, 0.00858553556218569 + 0.024866037696745287i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01236769539065883 + -0.003684307604028859i, 0.0004360182700612837 + -0.005664718225878101i, 0.008585535562185683 + -0.024866037696745284i, 0.04284520261867164 + -2.087089182034596e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.24057844628906916, 1.0e-7), DoubleNear(0.25826793647385227, 1.0e-7), DoubleNear(0.07285626346236279, 1.0e-7), DoubleNear(0.1585694639385255, 1.0e-7), DoubleNear(0.09206814168798011, 1.0e-7), DoubleNear(0.09218205806958268, 1.0e-7), DoubleNear(0.042632487459954994, 1.0e-7), DoubleNear(0.04284520261867164, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.2300441917983913 + 9.107298248878237e-18i, -0.038481305987126374 + -0.11811969016978154i, -0.0020293700603453914 + -0.033709165700009126i, -0.01606743372335705 + 0.008079492026226917i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03848130598712637 + 0.11811969016978152i, 0.08366754290295611 + 8.673617379884035e-19i, 0.016081991386759347 + 0.0051597513926708955i, -0.0013059770278905768 + -0.010583337819736749i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002029370060345382 + 0.03370916570000914i, 0.01608199138675936 + -0.005159751392670891i, 0.046565031966621435 + -1.7889335846010823e-18i, -0.00746454847591924 + -0.024318026915476i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.016067433723357047 + -0.008079492026226917i, -0.0013059770278905825 + 0.010583337819736742i, -0.0074645484759192455 + 0.024318026915476007i, 0.01749097228877993 + -1.4365678785432934e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10260239617865796 + 5.204170427930421e-18i, -0.04136681503598685 + 0.14108422676509996i, 0.0021654587799025656 + 0.021929269834502482i, -0.032238855115250376 + -0.008827387294350855i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04136681503598685 + -0.14108422676509996i, 0.2667824516404788 + 1.5612511283791264e-17i, 0.03148743133925712 + -0.014139151436949323i, 0.004321814219904505 + 0.06397149008457796i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0021654587799025734 + -0.02192926983450249i, 0.03148743133925712 + 0.014139151436949327i, 0.06892371895569635 + 2.168404344971009e-18i, -0.029578738050526913 + 0.09593232889460745i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.032238855115250376 + 0.008827387294350852i, 0.004321814219904503 + -0.06397149008457798i, -0.029578738050526923 + -0.09593232889460745i, 0.1839236942684172 + 1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.2300441917983913, 1.0e-7), DoubleNear(0.08366754290295611, 1.0e-7), DoubleNear(0.046565031966621435, 1.0e-7), DoubleNear(0.01749097228877993, 1.0e-7), DoubleNear(0.10260239617865796, 1.0e-7), DoubleNear(0.2667824516404788, 1.0e-7), DoubleNear(0.06892371895569635, 1.0e-7), DoubleNear(0.1839236942684172, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.2284651549070498 + 8.673617379884035e-18i, -0.05557685732212324 + -0.09547227627531701i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05557685732212323 + 0.09547227627531699i, 0.05341620962706172 + 2.8189256484623115e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.048144068857962956 + -1.3552527156068805e-18i, 0.009631002859077625 + -0.04696544080994052i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.00963100285907762 + 0.04696544080994054i, 0.04774230556467432 + -3.3881317890172014e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08496955484438215 + 4.7704895589362195e-18i, -0.08840651291584942 + 0.15186844726967919i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08840651291584942 + -0.15186844726967919i, 0.36342119078531604 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08655656028997216 + 2.6020852139652106e-18i, 0.017460959829335657 + 0.08514810839002823i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.017460959829335657 + -0.08514810839002822i, 0.08728495512358 + -3.469446951953614e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2284651549070498, 1.0e-7), DoubleNear(0.05341620962706172, 1.0e-7), DoubleNear(0.048144068857962956, 1.0e-7), DoubleNear(0.04774230556467432, 1.0e-7), DoubleNear(0.08496955484438215, 1.0e-7), DoubleNear(0.36342119078531604, 1.0e-7), DoubleNear(0.08655656028997216, 1.0e-7), DoubleNear(0.08728495512358, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.4988463827629215 + 3.5128150388530344e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.002301763586523023 + 0.03038534920097892i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1842501997575628 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008501623250480803 + 0.011222907198355652i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00230176358652303 + -0.030385349200978934i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2314257274008883 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0008501623250480824 + -0.011222907198355652i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08547769007862663 + -1.2739375526704677e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.4988463827629215, 1.0e-7), DoubleNear(0.1842501997575628, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2314257274008883, 1.0e-7), DoubleNear(0.08547769007862663, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.7302721101638097 + 3.707971429900425e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05997158904933389 + 0.08613567895832572i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.059971589049333876 + -0.08613567895832575i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26972788983618945 + -5.6107462426124854e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.7302721101638097, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26972788983618945, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.4988463827629215 + 3.5128150388530344e-17i, 0.0 + 0.0i, 0.002301763586523023 + 0.03038534920097892i, 0.0 + 0.0i, 0.0 + 0.0i, -0.016216327847764764 + 0.02329110219555766i, 0.0 + 0.0i, -0.042580874501444606 + -0.023300299669198426i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00230176358652303 + -0.030385349200978934i, 0.0 + 0.0i, 0.2314257274008883 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03662881165272862 + 0.03184909723824454i, 0.0 + 0.0i, -0.043755261201569126 + 0.06284457676276806i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.016216327847764764 + -0.02329110219555769i, 0.0 + 0.0i, 0.036628811652728625 + -0.03184909723824453i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1842501997575628 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0008501623250480803 + 0.011222907198355652i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.042580874501444606 + 0.023300299669198443i, 0.0 + 0.0i, -0.04375526120156911 + -0.06284457676276806i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008501623250480824 + -0.011222907198355652i, 0.0 + 0.0i, 0.08547769007862663 + -1.2739375526704677e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.4988463827629215, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2314257274008883, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1842501997575628, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.08547769007862663, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.23518049593641285 + 1.431146867680866e-17i, 0.0 + 0.0i, -0.0011501360564870355 + -0.037191616234173386i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.07853123876493458 + -4.336808689942018e-18i, 0.0 + 0.0i, -0.0021852110317489327 + -0.007100887285572486i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0011501360564870316 + 0.0371916162341734i, 0.0 + 0.0i, 0.04670086859769867 + -2.8189256484623115e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0021852110317489327 + 0.007100887285572487i, 0.0 + 0.0i, 0.0173551356577027 + -4.0657581468206416e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2636658868265086 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.0034518996430100584 + 0.0675769654351523i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10571896099262822 + 0.0i, 0.0 + 0.0i, 0.003035373356797013 + 0.018323794483928138i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0034518996430100615 + -0.06757696543515233i, 0.0 + 0.0i, 0.18472485880318962 + 4.7704895589362195e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003035373356797015 + -0.018323794483928138i, 0.0 + 0.0i, 0.06812255442092394 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.23518049593641285, 1.0e-7), DoubleNear(0.07853123876493458, 1.0e-7), DoubleNear(0.04670086859769867, 1.0e-7), DoubleNear(0.0173551356577027, 1.0e-7), DoubleNear(0.2636658868265086, 1.0e-7), DoubleNear(0.10571896099262822, 1.0e-7), DoubleNear(0.18472485880318962, 1.0e-7), DoubleNear(0.06812255442092394, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08537989465397014 + -0.11114883374542953i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08537989465397013 + 0.1111488337454295i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, -0.14535148370330403 + 0.19728451270375524i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.145351483703304 + -0.19728451270375524i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.4988463827629215 + 3.5128150388530344e-17i, 0.0 + 0.0i, 0.002301763586523023 + 0.03038534920097892i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00230176358652303 + -0.030385349200978934i, 0.0 + 0.0i, 0.2314257274008883 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1842501997575628 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0008501623250480803 + 0.011222907198355652i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008501623250480824 + -0.011222907198355652i, 0.0 + 0.0i, 0.08547769007862663 + -1.2739375526704677e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.4988463827629215, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2314257274008883, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1842501997575628, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.08547769007862663, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.31371173470134744 + 9.974659986866641e-18i, 0.0 + 0.0i, -0.0033353470882359682 + -0.04429250351974587i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0033353470882359643 + 0.04429250351974589i, 0.0 + 0.0i, 0.06405600425540137 + -3.2255014631443757e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36938484781913683 + 2.0816681711721685e-17i, 0.0 + 0.0i, 0.006487272999807071 + 0.08590075991908044i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006487272999807076 + -0.08590075991908047i, 0.0 + 0.0i, 0.2528474132241135 + 3.903127820947816e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.31371173470134744, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.06405600425540137, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36938484781913683, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2528474132241135, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.2818813645341115 + 1.1492543028346347e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09588637442263728 + -4.743384504624082e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4483907456296982 + 2.5587171270657905e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17384151541355214 + -8.673617379884035e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.2818813645341115, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.09588637442263728, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4483907456296982, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17384151541355214, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.23518049593641285 + 1.431146867680866e-17i, -0.0011501360564870355 + -0.037191616234173386i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0011501360564870316 + 0.0371916162341734i, 0.04670086859769867 + -2.8189256484623115e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.07853123876493458 + -4.336808689942018e-18i, -0.0021852110317489327 + -0.007100887285572486i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0021852110317489327 + 0.007100887285572487i, 0.0173551356577027 + -4.0657581468206416e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2636658868265086 + 2.0816681711721685e-17i, 0.0034518996430100584 + 0.0675769654351523i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0034518996430100615 + -0.06757696543515233i, 0.18472485880318962 + 4.7704895589362195e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10571896099262822 + 0.0i, 0.003035373356797013 + 0.018323794483928138i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003035373356797015 + -0.018323794483928138i, 0.06812255442092394 + -8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.23518049593641285, 1.0e-7), DoubleNear(0.04670086859769867, 1.0e-7), DoubleNear(0.07853123876493458, 1.0e-7), DoubleNear(0.0173551356577027, 1.0e-7), DoubleNear(0.2636658868265086, 1.0e-7), DoubleNear(0.18472485880318962, 1.0e-7), DoubleNear(0.10571896099262822, 1.0e-7), DoubleNear(0.06812255442092394, 1.0e-7) }));


}
}

}
