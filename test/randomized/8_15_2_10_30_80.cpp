#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.0720948786770552 + 0.08009363755041796i, -0.07645703007490444 + 0.030568496969982224i, -0.1594837648126213 + -0.054059086946169545i, 0.0394191221588243 + 0.17505365203201348i }, { -0.0537006476350049 + -0.19437791190156128i, -0.09131446439158976 + -0.04616411785250866i, 0.1737986177481014 + -0.034945325793047925i, 0.10609093805146014 + -0.061838843145206226i }, { 0.08156768028370202 + 0.050551612063503344i, 0.06554744472003413 + 0.10314867600698482i, 0.008811912218111347 + -0.04772415467135113i, -0.10177933483764791 + -0.013214873909925366i }, { 0.121257952063268 + 0.04065213578142275i, 0.00148926683784265 + 0.06256763671463547i, 0.03891575394426702 + -0.07349931947830102i, -0.006220605736101474 + -0.009692646709790519i } }), Matrix({ { -0.053213766685378076 + 0.17265950425215212i, -0.05292322118657144 + 0.063734594250762i, -0.1930027753309335 + -0.019977552643701536i, 0.01152444953048416 + 0.007835894737141849i }, { -0.03732671584190718 + -0.017454302171664347i, 0.06832370565464463 + 0.06665053824551981i, 0.13097825967928653 + -0.11773533228818756i, -0.15179077920635217 + -0.09207949421950253i }, { 0.0454800341148598 + -0.10791621605676542i, 0.09270367942449974 + -0.12081836652499867i, -0.044956677938011086 + 0.12016272551848575i, -0.06148906318171788 + 0.12197194384436605i }, { 0.06899754479751241 + 0.04317160373191491i, 0.04982513668449857 + 0.01274798050344281i, 0.18563040312137 + -0.1528363856673151i, 0.06300930874663802 + -0.03605495413135908i } }), Matrix({ { 0.020233114694690357 + -0.03411423238965193i, -0.10006652436771864 + 0.0835036177825776i, 0.13090909551859836 + -0.030814209807492075i, -0.05279617192604934 + 0.06859269135968206i }, { 0.044892630219866024 + 0.02383302323717457i, -0.09093892233261851 + 0.12469800968780086i, 0.10363495840335671 + -0.003844440411189019i, -0.043314461203893775 + -0.04342129253381058i }, { -0.02152620345278593 + 0.09040964421941111i, 0.010924973295048318 + -0.07651079439770495i, 0.04074809824110816 + 0.045634627127858075i, 0.01007793765084744 + 0.1645934525931934i }, { 0.02250341363852069 + 0.07232083928433564i, 0.059576307757853955 + 0.048716441984421224i, 0.027656291578892628 + 0.03861365169757554i, 0.018201886461916957 + 0.05659581361627249i } }), Matrix({ { -0.05499208245455007 + 0.14709230582055943i, -0.02514304503672654 + 0.012474545768303803i, 0.060412438831473715 + -0.12346318483238335i, -0.14036503790863777 + 0.07248681081456826i }, { -0.12537567650639792 + -0.015991118397711127i, 0.04027222105160273 + 0.030035262687010525i, 0.07271124498423853 + 0.021426309315676576i, 0.01444309409874602 + -0.1425916182236189i }, { 0.0354368299512936 + -0.13949452848244986i, 0.07420544651115124 + -0.06310459499226866i, -0.0020377458484605493 + -0.14529979516660704i, -0.034144824179696456 + 0.059198776710626816i }, { 0.011506975627015472 + -0.04902125399403774i, 0.0050771403616238706 + -0.09676827243009123i, -0.03742251377383794 + -0.12301583205662268i, -0.08621626839175602 + -0.02494455264044647i } }), Matrix({ { 0.2305609205621942 + -0.024695465384768744i, -0.08531021872121945 + 0.0007858476834452523i, -0.05247543863395136 + -0.0528062344683645i, -0.07145795470990314 + -0.11047818877117555i }, { 0.024537673213072892 + 0.08338825499334879i, 0.017683522880139906 + 0.05856972064335575i, 0.08250667695051035 + -0.03207539065761567i, 0.028527546761867265 + -0.12242152701139768i }, { -0.010663702104629387 + -0.0006119704644981504i, -0.002147817885860709 + 0.07499516601094285i, 0.1530086446282595 + 0.16902063405080006i, 0.022593904003442397 + 0.18062165501072341i }, { -0.06134753852691782 + 0.050319079406332144i, -0.19543511298280672 + 0.16449889489552708i, 0.008707762549041705 + 0.03810871501319495i, 0.029444292105199964 + -0.025462284697944405i } }), Matrix({ { 0.1074213658989264 + -0.009198817255298393i, -0.06359666529633459 + 0.08756447559213697i, 0.07195280589827344 + 0.10411714218775102i, -0.09283873188182169 + 0.2512843536289231i }, { -0.0432472963537786 + 0.020564523183220253i, -0.1455018721011405 + 0.13811788372194655i, -0.02211083512363241 + -0.03301444885212162i, 0.012659797595035467 + 0.04739799801980015i }, { -0.07234595369987484 + -0.013896931058341612i, 0.010151204833044691 + 0.05026170653661041i, -0.1153298968233132 + -0.08498298507408157i, 0.17317305014785495 + -0.08364086572389581i }, { -0.03651832746178191 + 0.04524226281247605i, 0.23975347998806115 + -0.06535557887354404i, -0.1029508432071803 + 0.048067891124671816i, 0.019934729169928837 + 0.04709472132696638i } }), Matrix({ { 0.14362569191294672 + 0.00027654035981612696i, -0.14429726726002415 + 0.0857601485270975i, 0.18995897485763327 + -0.028073358808556624i, 0.04918110339105667 + 0.055896429073700675i }, { 0.16721003636390555 + 0.02565065301196465i, 0.17711965872423105 + -0.013785184442477944i, -0.02330528572462455 + 0.07770242629374569i, 0.040994458063739636 + -0.14432939614869364i }, { -0.06776479785537878 + -0.022225432161070858i, 0.06306146837649725 + 0.14136945056558267i, -0.049514699543907144 + -0.12380308506292233i, -0.034983130856237034 + -0.12061938556030885i }, { -0.03340174767937563 + 0.02416543225074578i, -0.03033113652104333 + 0.12182129613842584i, 0.013152251787661313 + -0.004475354434831873i, -0.134761810393465 + 0.12882515226791996i } }), Matrix({ { 0.06463380255310548 + -0.009483537768488927i, 0.10936299387520997 + -0.0919647913950382i, 0.036052113912427346 + -0.1254516257679322i, -0.014412733611973953 + 0.04850293218795731i }, { -0.11631988818273226 + -0.052959347786940426i, 0.07218090440992765 + 0.09777843871286536i, 0.048315777333834346 + -0.0456344938114452i, -0.10249193086058778 + -0.0665153132625073i }, { 0.022316972450514165 + 0.04756154769417544i, -0.06763784982396956 + 0.07944981777836167i, -0.05302910838765319 + 0.1318864624881485i, 0.08897443834598193 + 0.1253636342024584i }, { 0.024214755816442207 + 0.10665693116448059i, -0.017602292859252563 + -0.011713425669006891i, 0.048771493076005465 + -0.07796105494878829i, 0.08410814536814432 + 0.10440298923886689i } }), Matrix({ { -0.03152269755107264 + 0.09898672357359391i, 0.0742073225778136 + 0.005941086207061741i, 0.04111245952827273 + -0.10043382181994208i, -0.014410524496265509 + 0.04853910903434127i }, { 0.18277463011513106 + -0.12953763284824432i, 0.12652499281184454 + -0.05330915122094199i, -0.03301094295962483 + -0.046888637911881i, -0.09119291294698431 + -0.11074531524525101i }, { -0.1715756646545894 + -0.007879122450356482i, -0.08878040252668759 + 0.0892548369498186i, 0.04242592161765634 + 0.07322197214171172i, 0.08043013452897096 + 0.06352442663997357i }, { -0.06535861176978608 + -0.18758948370953832i, 0.1693359791008247 + 0.07976066325308354i, 0.13839991399819596 + 0.1402943685197732i, -0.01548098840126574 + 0.14966426490492996i } }), Matrix({ { 0.07566649267028834 + -0.08130268918037792i, 0.0011001560044518032 + -0.04563397023089934i, 0.2038713549934869 + 0.005665110772131776i, -0.08072535007467649 + 0.0323583826644719i }, { 0.026784134362466912 + 0.07408289982608737i, -0.06689577798036835 + -0.20174187461497972i, -0.09972510385523069 + -0.09322564683078566i, -0.03700158061840279 + 0.12522353063420966i }, { 0.009304282269947525 + 0.062459225870023345i, -0.11472530559795432 + -0.11606531977820607i, -0.0033639635849747043 + -0.1612051895122108i, -0.16109572778393066 + -0.027426722062350303i }, { 0.1559127013209891 + 0.09198347220586017i, 0.008821943666506769 + -0.1879973490485924i, 0.07728519889645177 + -0.22313400968416625i, 0.12517213654598333 + 0.0971689760827807i } }), Matrix({ { -0.07203516475465702 + 0.02864403588107203i, 0.018536741689743483 + -0.03038550086720358i, -0.09768525830795173 + -0.0656739641112518i, -0.09627214779491418 + 0.07116755854114427i }, { 0.11842770687773556 + -0.06981904300100429i, -0.053154666913646224 + 0.002960395044012333i, -0.1091248407548143 + -0.10164780485650715i, -0.07175710656764395 + -0.04595822729884383i }, { -0.09712397375121441 + 0.08677227543561264i, -0.11879113651107999 + -0.08397511914657649i, -0.012041192671508539 + 0.005039640332125221i, -0.03023276339140508 + 0.029292466123543567i }, { 0.06596453616648894 + -0.13715305827109228i, -0.048476834839169494 + -0.018344834338903375i, 0.0038007633880716546 + 0.008937790613734144i, -0.03806004759884651 + -0.13843989596484876i } }), Matrix({ { -0.013620002873915087 + -0.011691291333687797i, 0.013135778787513121 + -0.028258664217968247i, -0.08227935912191021 + 0.1099883872523446i, 0.004823201380623427 + -0.10747660770697134i }, { -0.005127962385758597 + -0.018079025401435043i, 0.04454176757593531 + -0.07751737003590238i, -0.02201546272933033 + 0.10326632297580743i, -0.1680236131637186 + -0.11194828710104272i }, { 0.023890607729938926 + -0.007796324075187536i, -0.0858248421234862 + 0.024924294952874456i, -0.05903061189374644 + -0.15998557093736948i, 0.15146792897376815 + 0.0353502653238249i }, { 0.02804708389883017 + -0.0777662716997475i, 0.16137632854989437 + 0.01923267557167571i, -0.10461747821964422 + 0.10656764601337027i, 0.031200157134589984 + 0.1514651573745027i } }), Matrix({ { 0.054859028595617296 + 0.04171406228603369i, -0.07351998693428179 + 0.11167998228979288i, 0.07334804023988115 + 0.04017040759694406i, 0.08690017752245337 + -0.0653272629279102i }, { -0.11518909836454458 + 0.07096649615867621i, -0.0788199494333126 + -0.02905325948441172i, -0.042761264249427236 + -0.06122566752490353i, 0.11662511431789166 + -0.012146496483009969i }, { 0.009992486651293386 + -0.006255529709860473i, 0.10011547200051817 + -0.009825289870141408i, 0.03225517221561185 + -0.013128042116526139i, 0.08496850004490752 + -0.012214615765816408i }, { 0.0025612813790928716 + 0.011520759182639609i, 0.030475428207769908 + -0.006637747798550317i, -0.05789976593393858 + 0.04722437191295827i, 0.031737029987119164 + 0.011626183351781833i } }), Matrix({ { -0.10353008805643336 + 0.07392546589431022i, 0.0034412440320163605 + 0.04983594440320465i, 0.044421901581265716 + 0.05637908423729624i, -0.20982101756047036 + -0.045328618068356495i }, { 0.14895679724536218 + 0.11061721199756246i, -0.073884698367203 + 0.026735577135463137i, 0.014393104870985704 + -0.07528435775355453i, -0.0066277028713686474 + 0.06028947132395363i }, { 0.08941876560687062 + -0.0274461076123698i, -0.05484594925598757 + -0.03824124510931105i, -0.07729484150815129 + -0.0317263034290511i, -0.12321996741129282 + 0.0703146442434114i }, { 0.18293686934936113 + -0.006708069320629339i, -0.18384162257521883 + -0.1543848767244631i, 0.07761477950723605 + 0.008486571653976841i, -0.06364093238079345 + -0.05106657428519277i } }), Matrix({ { 0.05673760049451415 + 0.034900062648639874i, 0.15912199446337075 + 0.0005357866118960459i, 0.00022641903493628832 + 0.023584008637276898i, -0.037126131970415845 + 0.08733862482593133i }, { -0.1026154839651575 + 0.015567761153057745i, -0.145265281252843 + -0.01502748552412174i, -0.0959763777539397 + -0.047752825540144136i, 0.04543416584484185 + -0.13007088746666035i }, { -0.10048670204094973 + -0.10488228575463736i, 0.02707856079929703 + 0.13483070148799586i, 0.014265975448075301 + -0.14404449243321382i, 0.02413650344271183 + 0.1362528124551383i }, { 0.1283509471404318 + 0.051251224759939616i, 0.06596849019980683 + 0.06746098351934685i, -0.05199581844685725 + -0.018557687343102817i, 0.03138512808197617 + 0.0928611096175823i } }), Matrix({ { -0.17070124179148521 + -0.0010963278953604585i, 0.0007360173484837016 + -0.12508369380220954i, 0.04901752774841494 + 0.09905427250179434i, 0.005589485005027384 + -0.09442873225322858i }, { 0.09964720661266702 + -0.21436979350836566i, -0.1875508253014908 + 0.054957883323872005i, 0.155000272136771 + -0.042523853042828304i, -0.055746318228965766 + -0.02915043825291927i }, { 0.04441989326838444 + -0.022013868760838145i, -0.010163585930517268 + -0.0589622976136323i, 0.005608421983425289 + -0.14502907044948704i, -0.006723929113898776 + 0.06277983258061418i }, { 0.0879188465245928 + 0.27930687159071826i, -0.06748887805742691 + 0.06183289099560983i, 0.036294910886785735 + 0.0255112334288315i, -0.009430212342875171 + -0.0742143734940376i } }) }, { QubitIndex{ 2 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.18615577633979252 + -0.5651138787409624i, -0.015567752756832087 + 0.803585699265347i }, { -0.7973894691923744 + -0.10080855822189722i, -0.5322517779898128 + -0.2659242633476847i } }) }, { QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.5481626863315868 + -0.045251112139902135i, -0.2897850460196029 + -0.7832589822448618i }, { -0.487069955818271 + -0.6784046464338429i, -0.26918030575049595 + 0.4796581666481135i } }) }, { QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.3476182106247132 + -0.16201780036752866i, 0.01139177131298057 + 0.2557652880763601i, 0.3011711453093111 + 0.3502061741255688i, -0.25450782677588635 + 0.7136129902930115i }, { -0.3773980260239405 + 0.14985889742016506i, 0.5015111763168696 + 0.3922751493724568i, -0.2904945919194452 + -0.4607019236227028i, -0.3566104996008773 + -0.07691143765163486i }, { -0.3844577573505033 + 0.1827447293557456i, 0.2998184075282079 + -0.2771641769712419i, 0.4676339622199246 + 0.38883892293439587i, -0.17464419362666866 + -0.5017048068725516i }, { -0.4819843892184076 + -0.523939403059992i, -0.057823848085537324 + -0.5991714581648061i, -0.12476965302665541 + -0.32337827624413373i, 0.04929933107716 + 0.09086867929305359i } }) }, { QubitIndex{ 3 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.042171576483598816 + -0.21336810358531255i, 0.03450744727973262 + -0.40098314812217606i, -0.026249838643114837 + -0.3803095130388077i, -0.6976017028126013 + 0.39842796840823735i }, { 0.6487287499658094 + -0.19294912688557603i, -0.2272090716017284 + 0.14956165448834852i, 0.028835613313762082 + -0.6125019454694502i, 0.2958041546160045 + -0.06662408726091078i }, { 0.012479674740473831 + -0.45465040330732653i, 0.2354032462969799 + 0.5153744527675761i, 0.5167430950247507 + 0.1664654802515266i, -0.014578118646591571 + 0.42090978801141954i }, { 0.22791845585028164 + 0.48560034996370033i, 0.5190569014275743 + 0.4166335541463561i, -0.41467851286808854 + -0.1095127529502089i, -0.12159289613241757 + 0.26552918437460676i } }) }, { QubitIndex{ 7 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.07300140663377208 + 0.2677455525519506i, -0.06528873607904567 + 0.9584990843289011i }, { -0.894176523622755 + -0.35132813482564335i, 0.2732220576656764 + 0.04864764626158813i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 5 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_15_2_10_30_80) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.39393466135859906 + -1.2297224328237932e-17i, 3.7269449679189215e-20 + -3.8963515573697816e-20i }, { -1.0977546996415732e-18 + -3.2526065174565133e-19i, 0.6060653386414004 + -5.824198545320569e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.39393466135859906, 1.0e-7), DoubleNear(0.6060653386414004, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.5897276943922173 + -6.4967427054404836e-18i, 0.0061073273869565 + 0.056227195131540855i }, { 0.006107327386956504 + -0.056227195131540855i, 0.41027230560778233 + -1.1624680168118018e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5897276943922173, 1.0e-7), DoubleNear(0.41027230560778233, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.5067351040095117 + -6.404416114189765e-18i, -0.09272236639179815 + 0.0005320854683950728i }, { -0.09272236639179815 + -0.0005320854683950641i, 0.4932648959904879 + -1.1717006759368737e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5067351040095117, 1.0e-7), DoubleNear(0.4932648959904879, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.2770590807670843 + -1.026603932072212e-17i, 0.08947011843403536 + 0.020496110697395063i }, { 0.08947011843403538 + -0.02049611069739505i, 0.7229409192329153 + -7.855383552836381e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2770590807670843, 1.0e-7), DoubleNear(0.7229409192329153, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.5606754811111567 + -2.0692167868475303e-17i, 0.029608926982696248 + 0.022705848313020506i }, { 0.029608926982696248 + -0.02270584831302052i, 0.43932451888884294 + 2.5707449949168015e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5606754811111567, 1.0e-7), DoubleNear(0.43932451888884294, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.5477730828215308 + -6.8575787409708155e-18i, 0.10423431289549351 + -0.026862299180017205i }, { 0.1042343128954935 + 0.026862299180017202i, 0.45222691717846886 + -1.1263844132587686e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5477730828215308, 1.0e-7), DoubleNear(0.45222691717846886, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.5037581728058785 + -9.526579557769116e-18i, 0.20540697102974187 + -0.011116789592317433i }, { 0.20540697102974187 + 0.01111678959231745i, 0.4962418271941211 + -8.594843315789386e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5037581728058785, 1.0e-7), DoubleNear(0.4962418271941211, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.34210156417750254 + -7.25229609439132e-18i, -0.09427671512680999 + -0.0984835004083412i }, { -0.09427671512680999 + 0.0984835004083412i, 0.6578984358224971 + -1.0869126779167182e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.34210156417750254, 1.0e-7), DoubleNear(0.6578984358224971, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.030339621016337748 + -1.0079692072326174e-18i, 7.589415207398531e-19 + 0.0i, -0.011341537097811985 + -0.10441602014855382i, 0.0 + 1.0842021724855044e-19i }, { -9.75781955236954e-19 + 4.336808689942018e-19i, 0.5593880733758795 + -5.488773498207866e-18i, 0.0 + 2.6020852139652106e-18i, 0.017448864484768484 + 0.16064321528009468i }, { -0.011341537097811978 + 0.10441602014855382i, 8.673617379884035e-19 + 1.734723475976807e-18i, 0.3635950403422613 + -1.1289255121005315e-17i, -7.589415207398531e-19 + -4.336808689942018e-19i }, { 0.0 + -9.486769009248164e-20i, 0.017448864484768484 + -0.16064321528009468i, -4.87890977618477e-19 + -4.336808689942018e-19i, 0.046677265265521004 + -3.3542504711270293e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.030339621016337748, 1.0e-7), DoubleNear(0.5593880733758795, 1.0e-7), DoubleNear(0.3635950403422613, 1.0e-7), DoubleNear(0.046677265265521004, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.20276541647175425 + -5.4387985543198625e-18i, 3.3881317890172014e-20 + 1.4399560103323106e-19i, -0.07436258993759227 + -0.0015253802645346867i, -2.303929616531697e-19 + -2.0328790734103208e-19i }, { -8.165397611531455e-19 + 4.0657581468206416e-20i, 0.30396968753775744 + -9.656175598699024e-19i, 2.0328790734103208e-19 + -2.574980159653073e-19i, -0.018359776454205876 + 0.0020574657329297595i }, { -0.07436258993759226 + 0.001525380264534696i, -5.183841637196318e-19 + -3.9302328752599536e-19i, 0.1911692448868448 + -6.85842577391807e-18i, 3.3881317890172014e-21 + -1.8295911660692887e-19i }, { 5.793705359219414e-19 + 2.439454888092385e-19i, -0.018359776454205876 + -0.002057465732929761i, -2.812149384884277e-19 + -3.6591823321385775e-19i, 0.30209565110364306 + -4.858580985450667e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.20276541647175425, 1.0e-7), DoubleNear(0.30396968753775744, 1.0e-7), DoubleNear(0.1911692448868448, 1.0e-7), DoubleNear(0.30209565110364306, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.10914317515830615 + -4.7535488999911335e-18i, -1.7957098481791167e-19 + -1.6432439176733427e-19i, -0.05051987649841575 + -0.011573260427655316i, -1.7889335846010823e-18 + 7.945169045245337e-19i }, { -3.9302328752599536e-19 + -1.0842021724855044e-19i, 0.16791590560877814 + -5.5124904207309866e-18i, -1.5178830414797062e-18 + -8.233160247311799e-19i, 0.13998999493245112 + 0.03206937112505038i }, { -0.05051987649841574 + 0.011573260427655314i, -1.1722935989999517e-18 + 7.420008617947671e-19i, 0.28479148620029293 + -7.543675428246799e-18i, 2.168404344971009e-19 + 1.2536087619363645e-19i }, { -1.9617283058409596e-18 + -9.147955830346444e-20i, 0.13998999493245112 + -0.03206937112505036i, -7.047314121155779e-19 + -2.168404344971009e-19i, 0.4381494330326223 + -3.1170812458958252e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10914317515830615, 1.0e-7), DoubleNear(0.16791590560877814, 1.0e-7), DoubleNear(0.28479148620029293, 1.0e-7), DoubleNear(0.4381494330326223, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.22086950578359318 + -1.3185761889907693e-17i, 3.015437292225309e-19 + -1.0672615135404184e-19i, 0.023746120611316864 + 0.01820990719921564i, 9.486769009248164e-20 + 4.607859233063394e-19i }, { -2.541098841762901e-19 + 1.1519648082658485e-19i, 0.33980597532756346 + -7.50640597856761e-18i, 2.168404344971009e-19 + 5.421010862427522e-20i, 0.005862806371379383 + 0.004495941113804868i }, { 0.023746120611316868 + -0.018209907199215652i, 5.827586677109586e-19 + -9.486769009248164e-20i, 0.1730651555750059 + 8.88537561669761e-19i, -2.642742795433417e-19 + 6.776263578034403e-20i }, { 0.0 + 1.3552527156068805e-20i, 0.00586280637137938 + -0.004495941113804868i, -8.436448154652831e-19 + -4.404571325722362e-19i, 0.26625936331383704 + 1.6822074332470405e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.22086950578359318, 1.0e-7), DoubleNear(0.33980597532756346, 1.0e-7), DoubleNear(0.1730651555750059, 1.0e-7), DoubleNear(0.26625936331383704, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.24014746067426546 + -6.6034688567945254e-18i, -1.2163393122571753e-18 + 4.573977915173222e-20i, -0.05885657364207031 + 0.042149342721490124i, -4.106415728288848e-18 + 2.981555974335137e-19i }, { -1.599198204416119e-18 + -5.21772295508649e-19i, 0.30762562214726535 + -2.541098841762901e-19i, 1.497554250745603e-18 + -6.979551485375435e-19i, 0.16309088653756382 + -0.06901164190150733i }, { -0.05885657364207031 + -0.04214934272149012i, 1.0672615135404184e-18 + 3.5236570605778894e-19i, 0.1537872006843336 + -5.693755471443407e-18i, 1.2536087619363645e-18 + -8.470329472543003e-20i }, { -3.9776667203061944e-18 + -6.979551485375435e-19i, 0.16309088653756382 + 0.06901164190150733i, 5.014435047745458e-19 + 1.9651164376299768e-19i, 0.29843971649413514 + -5.570088661144279e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24014746067426546, 1.0e-7), DoubleNear(0.30762562214726535, 1.0e-7), DoubleNear(0.1537872006843336, 1.0e-7), DoubleNear(0.29843971649413514, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.18998826216090117 + -3.697298814765021e-18i, -6.098637220230962e-20 + -1.0164395367051604e-19i, 0.08091692557329695 + 0.020644297182939413i, -2.168404344971009e-19 + -4.1335207826009857e-19i }, { -2.473336205982557e-19 + -9.486769009248164e-20i, 0.31376991064497733 + -5.829280743004095e-18i, 3.049318610115481e-19 + 3.7947076036992655e-19i, 0.1244900454564449 + -0.031761086775256846i }, { 0.08091692557329697 + -0.020644297182939385i, -6.030874584450618e-19 + -9.41900637346782e-19i, 0.20394639919769791 + -8.599925513472911e-18i, 9.825582188149884e-20 + 6.268043809681823e-20i }, { -1.8295911660692887e-19 + -7.047314121155779e-19i, 0.12449004545644489 + 0.031761086775256846i, -8.504210790433175e-19 + -2.303929616531697e-19i, 0.2922954279964231 + 5.082197683525802e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.18998826216090117, 1.0e-7), DoubleNear(0.31376991064497733, 1.0e-7), DoubleNear(0.20394639919769791, 1.0e-7), DoubleNear(0.2922954279964231, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.19908778093697516 + -5.0805036176312934e-18i, 1.883801274693564e-18 + -4.590918574118308e-19i, 0.05975802612613887 + -0.13491829428042773i, 2.5614276324970042e-18 + 7.887570804832045e-18i }, { 1.734723475976807e-18 + 1.0842021724855044e-19i, 0.14301378324052735 + -2.171792476760026e-18i, -1.7143946852427039e-18 + -4.411347589300396e-18i, -0.15403474125294886 + 0.03643479387208657i }, { 0.059758026126138876 + 0.13491829428042773i, -1.3518645838178633e-18 + 4.573977915173222e-18i, 0.1948468804216239 + -7.216720710606639e-18i, -1.8465318250143747e-18 + 4.2012834183813297e-19i }, { 2.9070170749767588e-18 + -8.375461782450522e-18i, -0.15403474125294886 + -0.03643479387208657i, -2.8324781756183803e-18 + -4.336808689942018e-19i, 0.4630515554008731 + -3.652406068560543e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.19908778093697516, 1.0e-7), DoubleNear(0.14301378324052735, 1.0e-7), DoubleNear(0.1948468804216239, 1.0e-7), DoubleNear(0.4630515554008731, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.2961752497018286 + -1.359487880343152e-18i, 0.002913711605862493 + 0.02682512671086856i, -0.02267293877171999 + 0.0017815260901776265i, 0.000662677069194541 + 0.014947214498835142i }, { 0.0029137116058624967 + -0.026825126710868553i, 0.21055985430768306 + -5.044928233846613e-18i, 0.0025620099106875805 + -0.014740911348684058i, -0.07004942762007815 + -0.0012494406217825544i }, { -0.02267293877171999 + -0.0017815260901776278i, 0.002562009910687584 + 0.014740911348684056i, 0.29355244469038866 + -5.1372548250973316e-18i, 0.0031936157810940067 + 0.029402068420672292i }, { 0.0006626770691945385 + -0.014947214498835144i, -0.07004942762007815 + 0.001249440621782563i, 0.0031936157810940093 + -0.029402068420672285i, 0.19971245130009926 + -6.579751934271405e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2961752497018286, 1.0e-7), DoubleNear(0.21055985430768306, 1.0e-7), DoubleNear(0.29355244469038866, 1.0e-7), DoubleNear(0.19971245130009926, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.1633894129111998 + -5.322755040546023e-18i, 0.0016920905117738085 + 0.015578254997256187i, 0.1253175178288885 + 0.028708151533714577i, -0.00608302684751396 + 0.05175288975159871i }, { 0.0016920905117738078 + -0.01557825499725619i, 0.1136696678558845 + -4.943284280176097e-18i, 0.01705273825539481 + -0.04923991197455274i, -0.03584739939485313 + -0.008212040836319516i }, { 0.1253175178288885 + -0.028708151533714563i, 0.017052738255394807 + 0.04923991197455273i, 0.42633828148101754 + -1.1739876648944603e-18i, 0.004415236875182691 + 0.040648940134284654i }, { -0.006083026847513959 + -0.0517528897515987i, -0.035847399394853124 + 0.008212040836319517i, 0.004415236875182697 + -0.040648940134284654i, 0.2966026377518978 + -6.681395887941921e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1633894129111998, 1.0e-7), DoubleNear(0.1136696678558845, 1.0e-7), DoubleNear(0.42633828148101754, 1.0e-7), DoubleNear(0.2966026377518978, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.33064585877792974 + -8.049354097757616e-18i, 0.00342422872098518 + 0.031525209681907564i, 0.007240123550539391 + 0.005552148080278216i, 0.0031201455666981094 + -0.005134968190256958i }, { 0.0034242287209851844 + -0.03152520968190757i, 0.23002962233322694 + -1.2642813770717687e-17i, -0.004149881163888678 + 0.0043453070084792204i, 0.02236880343215685 + 0.01715370023274229i }, { 0.0072401235505393895 + -0.005552148080278216i, -0.00414988116388868 + -0.004345307008479222i, 0.25908183561428755 + 1.5526113923171325e-18i, 0.00268309866597132 + 0.024701985449633278i }, { 0.0031201455666981116 + 0.005134968190256961i, 0.02236880343215685 + -0.0171537002327423i, 0.00268309866597132 + -0.024701985449633274i, 0.1802426832745554 + 1.018133602599669e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.33064585877792974, 1.0e-7), DoubleNear(0.23002962233322694, 1.0e-7), DoubleNear(0.25908183561428755, 1.0e-7), DoubleNear(0.1802426832745554, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.3024286642585904 + -7.623296525288703e-19i, 0.0019427233668618026 + 0.017885709888164302i, 0.14599718423636154 + -0.060450368989818475i, 0.035854202102472914 + 0.05562885471293311i }, { 0.0019427233668618056 + -0.0178857098881643i, 0.24534441856294043 + -6.095249088441945e-18i, -0.023074289084862018 + -0.0620295934881554i, -0.04176287134086805 + 0.03358806980980127i }, { 0.14599718423636157 + 0.06045036898981847i, -0.023074289084862015 + 0.0620295934881554i, 0.28729903013362684 + -5.734413052911613e-18i, 0.004164604020094698 + 0.03834148524337654i }, { 0.03585420210247291 + -0.05562885471293311i, -0.04176287134086805 + -0.033588069809801266i, 0.004164604020094699 + -0.03834148524337654i, 0.1649278870448419 + -5.5294310796760726e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.3024286642585904, 1.0e-7), DoubleNear(0.24534441856294043, 1.0e-7), DoubleNear(0.28729903013362684, 1.0e-7), DoubleNear(0.1649278870448419, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.3042366334998982 + -5.947018322672443e-18i, 0.0035637233684103005 + 0.03280946910728702i, 0.12113417943745867 + -0.027724987278391296i, 0.015145018623946 + 0.010040685792222271i }, { 0.0035637233684103005 + -0.03280946910728702i, 0.1995215393059803 + -3.579561235096673e-18i, -0.012636043384662548 + -0.013058229890713854i, 0.08427279159228318 + 0.016608197686073873i }, { 0.12113417943745867 + 0.027724987278391296i, -0.012636043384662534 + 0.013058229890713844i, 0.285491060892319 + -5.497243827680409e-19i, 0.0025436040185461994 + 0.023417726024253828i }, { 0.015145018623945987 + -0.010040685792222264i, 0.08427279159228318 + -0.016608197686073856i, 0.0025436040185462037 + -0.023417726024253824i, 0.210750766301802 + -8.045118933021345e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3042366334998982, 1.0e-7), DoubleNear(0.1995215393059803, 1.0e-7), DoubleNear(0.285491060892319, 1.0e-7), DoubleNear(0.210750766301802, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.14733242794448384 + -2.4784184036660828e-18i, -0.001614392912021475 + -0.014862930956848226i, -0.13756908799982975 + 0.02323771256779906i, -0.0515738981623384 + -0.051734423241349706i }, { -0.0016143929120214732 + 0.014862930956848226i, 0.19476913623301867 + -4.773877690725237e-18i, 0.039263538905748116 + 0.06160107168200214i, 0.04329237287301978 + -0.12172121297614023i }, { -0.13756908799982978 + -0.02323771256779906i, 0.03926353890574811 + -0.06160107168200215i, 0.4423952664477334 + -4.018324301774401e-18i, 0.007721720298977975 + 0.07109012608838908i }, { -0.051573898162338386 + 0.05173442324134972i, 0.04329237287301979 + 0.12172121297614025i, 0.007721720298977977 + -0.07109012608838908i, 0.21550316937476366 + -6.850802477392781e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.14733242794448384, 1.0e-7), DoubleNear(0.19476913623301867, 1.0e-7), DoubleNear(0.4423952664477334, 1.0e-7), DoubleNear(0.21550316937476366, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.1396057131591189 + -7.253143127338574e-18i, -0.025689573599060395 + 8.501960690704869e-05i, 0.0444381832857132 + 0.009368355599444883i, 0.0041762619101083955 + 0.0015909982042908706i }, { -0.025689573599060392 + -8.501960690704733e-05i, 0.1374533676079654 + -3.0128961933835463e-18i, 0.006415350970104001 + 0.00083536351128954i, 0.04503193514832217 + 0.01112775509795018i }, { 0.04443818328571321 + -0.009368355599444884i, 0.0064153509701039965 + -0.00083536351128954i, 0.36712939085039276 + 8.487270131488089e-19i, -0.06703279279273776 + 0.0004470658614880238i }, { 0.0041762619101083955 + -0.0015909982042908713i, 0.045031935148322176 + -0.011127755097950167i, -0.06703279279273776 + -0.00044706586148801706i, 0.3558115283825225 + -8.70411056598519e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1396057131591189, 1.0e-7), DoubleNear(0.1374533676079654, 1.0e-7), DoubleNear(0.36712939085039276, 1.0e-7), DoubleNear(0.3558115283825225, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.3114558100929982 + -1.3129010682441655e-17i, -0.051987157386486384 + 0.0024583840994859855i, 0.015341323932120945 + 0.01065284630116647i, -0.08869375440959612 + -0.06801553244781577i }, { -0.05198715738648639 + -0.0024583840994859773i, 0.2492196710181584 + -7.563157186033648e-18i, -0.07097067249676521 + -0.0544244418356111i, 0.0142676030505753 + 0.012053002011854037i }, { 0.015341323932120943 + -0.010652846301166476i, -0.07097067249676521 + 0.05442444183561111i, 0.19527929391651344 + 6.7245945682518904e-18i, -0.04073520900531176 + -0.0019262986310909134i }, { -0.08869375440959613 + 0.06801553244781576i, 0.014267603050575303 + -0.012053002011854042i, -0.04073520900531176 + 0.001926298631090913i, 0.2440452249723295 + -4.153849573335089e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3114558100929982, 1.0e-7), DoubleNear(0.2492196710181584, 1.0e-7), DoubleNear(0.19527929391651344, 1.0e-7), DoubleNear(0.2440452249723295, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.27823478579483846 + -2.360680823997735e-18i, -0.054651382474577376 + 3.468372291723387e-05i, 0.051503031770450104 + -0.01264726805419518i, 0.006776291166756939 + -0.005084323694754961i }, { -0.054651382474577376 + -3.4683722917227796e-05i, 0.26953829702669235 + -4.4968979169730805e-18i, 0.005563130199248776 + -0.006647447757910012i, 0.0527312811250434 + -0.014215031125822022i }, { 0.0515030317704501 + 0.012647268054195185i, 0.005563130199248778 + 0.006647447757910011i, 0.22850031821467323 + -4.04373529019203e-18i, -0.038070983917220774 + 0.0004974017454778388i }, { 0.006776291166756938 + 0.005084323694754958i, 0.05273128112504341 + 0.014215031125822012i, -0.03807098391722077 + -0.0004974017454778362i, 0.22372659896379554 + -7.220108842395656e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.27823478579483846, 1.0e-7), DoubleNear(0.26953829702669235, 1.0e-7), DoubleNear(0.22850031821467323, 1.0e-7), DoubleNear(0.22372659896379554, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.24939848876442755 + 2.375080384101058e-18i, -0.04536902000016584 + 0.004576416786185717i, 0.10408692282903506 + 0.011740609918817929i, -0.006295602734975304 + -0.002825554878944133i }, { -0.045369020000165836 + -0.0045764167861857144i, 0.254359684041451 + -1.1901659941870174e-17i, -0.03179603811952309 + -0.0030441430077280916i, 0.10132004820070681 + -0.02285739951113536i }, { 0.10408692282903505 + -0.011740609918817913i, -0.0317960381195231 + 0.003044143007728084i, 0.25733661524508417 + -8.779496498290823e-18i, -0.04735334639163231 + -0.0040443313177906445i }, { -0.006295602734975311 + 0.0028255548789441463i, 0.10132004820070681 + 0.02285739951113536i, -0.04735334639163231 + 0.00404433131779065i, 0.2389052119490369 + 1.8465318250143747e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24939848876442755, 1.0e-7), DoubleNear(0.254359684041451, 1.0e-7), DoubleNear(0.25733661524508417, 1.0e-7), DoubleNear(0.2389052119490369, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.17420214364032155 + -3.043389379484701e-18i, -0.04191394287725771 + -0.000285398826804161i, -0.04649696353644023 + -0.05117120022978i, -0.007260332737142944 + 0.023610327742916375i }, { -0.04191394287725771 + 0.00028539882680416666i, 0.167899420537181 + -4.208906714906618e-18i, -0.005968103677587232 + 0.025118945494536898i, -0.04777975159036976 + -0.04731230017856118i }, { -0.04649696353644023 + 0.05117120022978i, -0.005968103677587235 + -0.0251189454945369i, 0.33253296036919017 + -3.3610267347050637e-18i, -0.05080842351454044 + 0.0008174842951992338i }, { -0.007260332737142947 + -0.02361032774291637i, -0.04777975159036976 + 0.04731230017856118i, -0.05080842351454044 + -0.0008174842951992308i, 0.3253654754533069 + -7.508100044462118e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17420214364032155, 1.0e-7), DoubleNear(0.167899420537181, 1.0e-7), DoubleNear(0.33253296036919017, 1.0e-7), DoubleNear(0.3253654754533069, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.14822460980260832 + -6.709347975201313e-18i, 0.04779238963337866 + 0.019307505836439497i, 0.006450662852131039 + 0.008320013657784562i, -0.0012831274726910402 + -0.0017561587342332981i }, { 0.04779238963337867 + -0.019307505836439497i, 0.4124508713085483 + -1.398281989327399e-17i, -0.002019568065161249 + -0.0011761169040600326i, 0.023158264130565206 + 0.014385834655235945i }, { 0.00645066285213104 + -0.008320013657784568i, -0.0020195680651612495 + 0.0011761169040600352i, 0.12883447096447598 + -3.556691345520807e-18i, 0.04167772880065671 + 0.0011886048609555638i }, { -0.0012831274726910397 + 0.0017561587342332986i, 0.02315826413056521 + -0.014385834655235949i, 0.04167772880065672 + -0.001188604860955556i, 0.31049004792436696 + 6.127436340437609e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.14822460980260832, 1.0e-7), DoubleNear(0.4124508713085483, 1.0e-7), DoubleNear(0.12883447096447598, 1.0e-7), DoubleNear(0.31049004792436696, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.10884462103924937 + -3.3068166260807885e-18i, 0.038811889822663204 + 0.036104017733068434i, 0.02887906291521408 + 0.01669151617323902i, 0.16860555974201957 + 0.03862471937171463i }, { 0.03881188982266322 + -0.036104017733068434i, 0.43892846178228145 + -3.550762114890027e-18i, 0.26057229901040047 + -0.05969276422864582i, 0.07535524998027943 + -0.043553815353256226i }, { 0.02887906291521407 + -0.016691516173239017i, 0.26057229901040047 + 0.05969276422864582i, 0.16821445972783491 + -6.959222694641332e-18i, 0.05065822861137217 + -0.015607907035673368i }, { 0.16860555974201957 + -0.03862471937171463i, 0.07535524998027943 + 0.04355381535325622i, 0.050658228611372175 + 0.01560790703567338i, 0.28401245745063386 + -4.304621437946354e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10884462103924937, 1.0e-7), DoubleNear(0.43892846178228145, 1.0e-7), DoubleNear(0.16821445972783491, 1.0e-7), DoubleNear(0.28401245745063386, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.13913004235855064 + -6.833014785500441e-18i, 0.04663588313105757 + 0.01588055749599801i, 0.05690986657665141 + -0.0017763031267477147i, 0.03503889888086697 + -0.0014126509996369267i }, { 0.04663588313105759 + -0.01588055749599801i, 0.3646281304473279 + -2.693564772268675e-18i, 0.001716673169547986 + -0.009832739032121349i, 0.14849710445309044 + -0.00934048646556972i }, { 0.05690986657665141 + 0.001776303126747726i, 0.0017166731695480025 + 0.009832739032121342i, 0.13792903840853366 + -3.4330245352216793e-18i, 0.0428342353029778 + 0.0046155532013970515i }, { 0.03503889888086697 + 0.0014126509996369215i, 0.14849710445309044 + 0.00934048646556972i, 0.0428342353029778 + -0.004615553201397041i, 0.3583127887855875 + -5.161818780567706e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.13913004235855064, 1.0e-7), DoubleNear(0.3646281304473279, 1.0e-7), DoubleNear(0.13792903840853366, 1.0e-7), DoubleNear(0.3583127887855875, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.09478234490000059 + -2.7985968577282083e-18i, -0.012105705701779263 + -0.0027732151077534185i, -0.026120220030774254 + -0.02728574809385979i, -0.03682110947473986 + 0.012102441223125336i }, { -0.012105705701779261 + 0.0027732151077534154i, 0.24731921927750194 + -4.453699236663111e-18i, -0.02788067928052746 + 0.026924541024246795i, -0.06815649509603575 + -0.0711977523144814i }, { -0.026120220030774258 + 0.027285748093859793i, -0.027880679280527457 + -0.026924541024246802i, 0.1822767358670837 + -7.467442462993912e-18i, 0.10157582413581463 + 0.023269325805148483i }, { -0.03682110947473988 + -0.012102441223125322i, -0.06815649509603573 + 0.0711977523144814i, 0.10157582413581465 + -0.023269325805148466i, 0.47562169995541337 + -3.40168431617327e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.09478234490000059, 1.0e-7), DoubleNear(0.24731921927750194, 1.0e-7), DoubleNear(0.1822767358670837, 1.0e-7), DoubleNear(0.47562169995541337, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.3086477141530208 + -1.0790352715072532e-17i, 0.018154694720756162 + 0.012569250940887837i, 0.05844162353097169 + -0.015918398722431792i, -0.0028308014316970167 + 0.0008596804017801975i }, { 0.018154694720756162 + -0.012569250940887844i, 0.23912536866851 + 3.9327739741017165e-18i, -0.0011095318498218134 + 0.0038813572712324204i, 0.04579268936452182 + -0.010943900457585413i }, { 0.05844162353097169 + 0.015918398722431792i, -0.00110953184982181 + -0.0038813572712324195i, 0.25202776695813583 + -9.901815153402771e-18i, 0.011454232261940084 + 0.01013659737213267i }, { -0.0028308014316970184 + -0.0008596804017801992i, 0.045792689364521806 + 0.01094390045758541i, 0.011454232261940086 + -0.010136597372132676i, 0.2001991502203329 + -1.362028979184915e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.3086477141530208, 1.0e-7), DoubleNear(0.23912536866851, 1.0e-7), DoubleNear(0.25202776695813583, 1.0e-7), DoubleNear(0.2001991502203329, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.29770155298398493 + -9.263999344120283e-18i, 0.0003882707540158851 + 0.030151957438317785i, 0.115166652305686 + -0.05136268587360228i, 0.02968165271731025 + 0.022761618638624127i }, { 0.0003882707540158888 + -0.030151957438317792i, 0.2060566198218936 + -2.625802136488331e-19i, 0.042392159661747246 + -0.03250877505637081i, 0.09024031872405586 + 0.040245896281284846i }, { 0.11516665230568598 + 0.05136268587360228i, 0.04239215966174725 + 0.0325087750563708i, 0.26297392812717174 + -1.142816852435502e-17i, 0.02922065622868036 + -0.007446109125297277i }, { 0.029681652717310242 + -0.022761618638624127i, 0.09024031872405587 + -0.04024589628128483i, 0.029220656228680357 + 0.007446109125297272i, 0.23326789906694934 + 2.8333252085656346e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.29770155298398493, 1.0e-7), DoubleNear(0.2060566198218936, 1.0e-7), DoubleNear(0.26297392812717174, 1.0e-7), DoubleNear(0.23326789906694934, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.19180795908410053 + -9.057323304990234e-18i, 0.013384331337766644 + 0.010263884176016914i, -0.05285864261130368 + -0.05521728397295751i, 0.008078521681069 + -0.006160642070591962i }, { 0.013384331337766647 + -0.010263884176016924i, 0.150293605093402 + 1.805027210598914e-18i, -0.0038543002430187264 + -0.00940002089945099i, -0.041418072515506305 + -0.043266216435383684i }, { -0.05285864261130367 + 0.05521728397295751i, -0.0038543002430187247 + 0.009400020899450984i, 0.36886752202705614 + -1.163484456348507e-17i, 0.016224595644929604 + 0.012441964137003592i }, { 0.008078521681069002 + 0.00616064207059196i, -0.04141807251550632 + 0.04326621643538368i, 0.0162245956449296 + -0.012441964137003596i, 0.28903091379544094 + 7.657177843178875e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.19180795908410053, 1.0e-7), DoubleNear(0.150293605093402, 1.0e-7), DoubleNear(0.36886752202705614, 1.0e-7), DoubleNear(0.28903091379544094, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.27472240000850223 + -3.4330245352216793e-18i, 0.05604924642108402 + -0.016436454422396492i, 0.11251640975399461 + -0.0024724951831471345i, 0.01252067128655988 + -0.017148945378722275i }, { 0.05604924642108402 + 0.016436454422396496i, 0.2290357727973763 + -6.093555022547437e-18i, 0.03030023769189951 + -0.006113538359798141i, 0.09289056127574725 + -0.008644294409170299i }, { 0.11251640975399463 + 0.002472495183147152i, 0.0303002376918995 + 0.006113538359798146i, 0.2730506828130286 + -3.4245542057491363e-18i, 0.04818506647440949 + -0.010425844757620711i }, { 0.012520671286559888 + 0.017148945378722254i, 0.09289056127574724 + 0.008644294409170299i, 0.048185066474409476 + 0.010425844757620706i, 0.2231911443810925 + -5.170289110040249e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.27472240000850223, 1.0e-7), DoubleNear(0.2290357727973763, 1.0e-7), DoubleNear(0.2730506828130286, 1.0e-7), DoubleNear(0.2231911443810925, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.19523832956653228 + -3.808260130855334e-18i, -0.01410336700146812 + -0.000341848445159036i, -0.031637853981505176 + -0.04378382012558195i, 0.0023223337926249416 + 0.10513861858525321i }, { -0.01410336700146812 + 0.00034184844515903687i, 0.14686323461097026 + -3.444035963535985e-18i, -0.07770109278004027 + -0.059671475474912056i, -0.06263886114530481 + -0.05469968028275924i }, { -0.031637853981505176 + 0.043783820125581956i, -0.07770109278004025 + 0.05967147547491207i, 0.3525347532549985 + -3.0493186101154812e-18i, 0.11833767989696163 + -0.02652045073485817i }, { 0.0023223337926249286 + -0.10513861858525322i, -0.06263886114530481 + 0.05469968028275923i, 0.11833767989696162 + 0.026520450734858165i, 0.3053636825674986 + -7.8198081690517e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.19523832956653228, 1.0e-7), DoubleNear(0.14686323461097026, 1.0e-7), DoubleNear(0.3525347532549985, 1.0e-7), DoubleNear(0.3053636825674986, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.17005735777144354 + -2.4182790644110275e-18i, 0.07027004608223766 + 0.0029385793793533614i, -0.05092597647241595 + -0.04620600580196137i, -0.010385270115776732 + -0.009025305453297279i }, { 0.07027004608223766 + -0.0029385793793533614i, 0.172044206406059 + -4.834017029980292e-18i, -0.028344918869887055 + -0.031433089577270146i, -0.04335073865439404 + -0.05227749460637983i }, { -0.05092597647241595 + 0.046206005801961374i, -0.028344918869887055 + 0.03143308957727015i, 0.333700815034435 + -7.108300493358088e-18i, 0.1351369249475042 + -0.014055368971670795i }, { -0.010385270115776734 + 0.009025305453297279i, -0.04335073865439403 + 0.052277494606379815i, 0.1351369249475042 + 0.014055368971670812i, 0.3241976207880621 + -3.7608262858090935e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.17005735777144354, 1.0e-7), DoubleNear(0.172044206406059, 1.0e-7), DoubleNear(0.333700815034435, 1.0e-7), DoubleNear(0.3241976207880621, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.015616361022298821 + -4.921261423547485e-19i, 7.047314121155779e-19 + 1.0842021724855044e-19i, -0.0058376977672810176 + -0.05374484626137467i, -5.421010862427522e-20 + 8.131516293641283e-20i, -0.005727175132848036 + -0.00011748003837025963i, 0.0 + -3.2526065174565133e-19i, 0.0017366127003685381 + 0.019754407543734413i, -4.0657581468206416e-20 + -5.421010862427522e-20i }, { -5.421010862427522e-19 + 3.2526065174565133e-19i, 0.2805588886795298 + -8.673617379884035e-19i, 8.673617379884035e-19 + 6.505213034913027e-19i, 0.00875140937314351 + 0.08056997297224322i, 3.2526065174565133e-19 + -5.149960319306146e-19i, -0.016945763638871954 + 0.001899006128547887i, -1.8431436932253575e-18 + 0.0i, -0.001073935631173997 + -0.0048071930448992705i }, { -0.005837697767281016 + 0.05374484626137467i, -4.336808689942018e-19 + 0.0i, 0.18714905544945543 + -4.946672411965114e-18i, -2.710505431213761e-19 + -2.168404344971009e-19i, 0.0025452449536795653 + -0.01966657492297022i, -1.0842021724855044e-19 + 0.0i, -0.06863541480474422 + -0.0014079002261644272i, -1.0842021724855044e-19 + 8.131516293641283e-20i }, { -5.421010862427522e-20 + -2.710505431213761e-20i, 0.00875140937314351 + -0.08056997297224322i, -3.2526065174565133e-19 + -2.168404344971009e-19i, 0.023410798858227628 + -9.825582188149884e-20i, -8.809142651444724e-20 + 5.421010862427522e-20i, 1.676495700801521e-05 + 0.004925663574286161i, 0.0 + 3.2526065174565133e-19i, -0.0014140128153339233 + 0.00015845960438187252i }, { -0.005727175132848036 + 0.00011748003837026028i, -3.2526065174565133e-19 + -4.87890977618477e-19i, 0.002545244953679568 + 0.01966657492297022i, 1.2874900798265365e-19 + -8.131516293641283e-20i, 0.014723259994038928 + -5.158430648778689e-19i, 0.0 + 0.0i, -0.005503839330530965 + -0.05067117388717915i, 0.0 + 1.2197274440461925e-19i }, { 6.505213034913027e-19 + 1.3552527156068805e-19i, -0.016945763638871954 + -0.0018990061285478876i, -9.75781955236954e-19 + -1.3010426069826053e-18i, 1.6764957008015997e-05 + -0.004925663574286162i, -2.168404344971009e-19 + -2.168404344971009e-19i, 0.2788291846963497 + -4.621411760219463e-18i, -4.336808689942018e-19 + -6.505213034913027e-19i, 0.008697455111624973 + 0.08007324230785144i }, { 0.001736612700368536 + -0.019754407543734413i, 1.0842021724855044e-19 + 0.0i, -0.06863541480474422 + 0.0014079002261644356i, 0.0 + 1.3552527156068805e-19i, -0.005503839330530962 + 0.05067117388717915i, 1.734723475976807e-18 + 1.0842021724855044e-18i, 0.17644598489280588 + -6.342582709040201e-18i, -2.168404344971009e-19 + -3.2526065174565133e-19i }, { -5.421010862427522e-20 + -5.421010862427522e-20i, -0.001073935631173997 + 0.0048071930448992705i, -2.168404344971009e-19 + 2.710505431213761e-19i, -0.0014140128153339233 + -0.00015845960438187263i, -2.710505431213761e-20 + 4.0657581468206416e-20i, 0.00869745511162497 + -0.08007324230785143i, 5.421010862427522e-20 + -3.2526065174565133e-19i, 0.02326646640729338 + -2.371692252312041e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.015616361022298821, 1.0e-7), DoubleNear(0.2805588886795298, 1.0e-7), DoubleNear(0.18714905544945543, 1.0e-7), DoubleNear(0.023410798858227628, 1.0e-7), DoubleNear(0.014723259994038928, 1.0e-7), DoubleNear(0.2788291846963497, 1.0e-7), DoubleNear(0.17644598489280588, 1.0e-7), DoubleNear(0.02326646640729338, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.008405867509608252 + -2.947674656444965e-19i, 2.710505431213761e-20 + 1.0842021724855044e-19i, -0.003142275842805575 + -0.028929406559715688i, 2.710505431213761e-20 + -3.3881317890172014e-20i, -0.003890883583252032 + -0.000891336482267065i, 0.00044740796533527 + -0.0009883936040763128i, -0.0016131120280791834 + 0.013723958653951809i, 0.00029779949806992803 + 9.765440244117806e-05i }, { -2.710505431213761e-19 + -1.0842021724855044e-19i, 0.15498354540159154 + -5.027987574901527e-18i, -1.0842021724855044e-18 + -5.421010862427522e-19i, 0.004834366354579383 + 0.044507661556971875i, -2.7478532254251575e-05 + 0.0010845924277301418i, 0.12920840141214054 + 0.02959948801598164i, 0.00374297600878543 + -0.0003108722509261308i, -0.004469914819434777 + 0.038028931097646906i }, { -0.0031422758428055722 + 0.028929406559715688i, -2.168404344971009e-19 + 5.421010862427522e-19i, 0.1007373076486979 + -4.458781434346637e-18i, -4.0657581468206416e-19 + -1.6263032587282567e-19i, 0.004522087092662717 + -0.013057561023287836i, 0.0032343789788404085 + 0.0019092678125329741i, -0.04662899291516371 + -0.010681923945388248i, -0.00044740796533527193 + 0.0009883936040763137i }, { -2.710505431213761e-20 + -6.776263578034403e-21i, 0.004834366354579379 + -0.044507661556971875i, -2.439454888092385e-19 + 1.6263032587282567e-19i, 0.012932360207186609 + -4.845028458294598e-19i, 0.00031061253169893026 + 4.172263796101247e-05i, 0.012530651162732092 + -0.03618235095126489i, 2.7478532254250274e-05 + -0.0010845924277301424i, 0.01078159352031058 + 0.0024698831090687323i }, { -0.003890883583252032 + 0.0008913364822670647i, -2.7478532254252225e-05 + -0.0010845924277301418i, 0.004522087092662716 + 0.013057561023287836i, 0.00031061253169893015 + -4.172263796101258e-05i, 0.021933753506729495 + -7.132017415881209e-19i, 5.421010862427522e-19 + -3.2526065174565133e-19i, -0.00819926125500641 + -0.07548661358883814i, 5.421010862427522e-20 + 1.7618285302889447e-19i }, { 0.00044740796533526955 + 0.0009883936040763137i, 0.12920840141214054 + -0.029599488015981633i, 0.00323437897884041 + -0.0019092678125329724i, 0.012530651162732089 + 0.03618235095126489i, -7.589415207398531e-19 + 0.0i, 0.40440452797428805 + -4.607859233063394e-19i, 1.3010426069826053e-18 + 2.6020852139652106e-18i, 0.0126144981301891 + 0.11613555372312279i }, { -0.001613112028079183 + -0.013723958653951806i, 0.0037429760087854284 + 0.0003108722509261308i, -0.04662899291516371 + 0.010681923945388248i, 2.7478532254251358e-05 + 0.0010845924277301422i, -0.008199261255006406 + 0.07548661358883814i, 8.673617379884035e-19 + 1.5178830414797062e-18i, 0.26285773269356344 + -6.830473686658678e-18i, -5.963111948670274e-19 + 1.0842021724855044e-19i }, { 0.0002977994980699281 + -9.765440244117812e-05i, -0.0044699148194347746 + -0.038028931097646906i, -0.0004474079653352717 + -0.0009883936040763137i, 0.010781593520310584 + -0.002469883109068731i, 0.0 + -8.131516293641283e-20i, 0.012614498130189103 + -0.11613555372312279i, -2.168404344971009e-19 + -3.2526065174565133e-19i, 0.0337449050583344 + 1.4907779871675686e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.008405867509608252, 1.0e-7), DoubleNear(0.15498354540159154, 1.0e-7), DoubleNear(0.1007373076486979, 1.0e-7), DoubleNear(0.012932360207186609, 1.0e-7), DoubleNear(0.021933753506729495, 1.0e-7), DoubleNear(0.40440452797428805, 1.0e-7), DoubleNear(0.26285773269356344, 1.0e-7), DoubleNear(0.0337449050583344, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.01701068161006533 + -9.884874494457685e-19i, 2.168404344971009e-19 + 0.0i, -0.006358921768855769 + -0.05854350233250266i, 2.710505431213761e-20 + 2.710505431213761e-20i, 0.0018288522707570923 + 0.0014024703519651912i, -6.505213034913027e-19 + -4.336808689942018e-19i, 0.0041430437310225315 + -0.006818399114679062i, 0.0 + -1.6263032587282567e-19i }, { -4.336808689942018e-19 + 3.2526065174565133e-19i, 0.3136351771678644 + -7.060866648311848e-18i, 8.673617379884035e-19 + 1.3010426069826053e-18i, 0.00978315048984095 + 0.09006871201441023i, -6.505213034913027e-19 + -3.7947076036992655e-19i, 0.0054112712797822985 + 0.004149677728313025i, -6.505213034913027e-19 + 3.469446951953614e-18i, -0.0010228981643244225 + 0.001683430924422105i }, { -0.006358921768855762 + 0.05854350233250266i, 8.673617379884035e-19 + 0.0i, 0.20385882417352785 + -1.2197274440461925e-17i, 0.0 + -4.336808689942018e-19i, -0.005510364427878948 + 0.005769858032585173i, 1.734723475976807e-18 + -2.168404344971009e-18i, 0.021917268340559768 + 0.01680743684725045i, 7.589415207398531e-19 + 4.336808689942018e-19i }, { -2.710505431213761e-20 + -8.131516293641283e-20i, 0.009783150489840946 + -0.09006871201441023i, -4.336808689942018e-19 + -3.2526065174565133e-19i, 0.026170798159699082 + -4.45539330255762e-19i, -1.6263032587282567e-19 + 1.6263032587282567e-19i, 0.0013604832639902685 + -0.0014245510241059532i, 1.0842021724855044e-18 + 3.2526065174565133e-19i, 0.0004515350915970832 + 0.0003462633854918432i }, { 0.0018288522707570927 + -0.001402470351965192i, -2.168404344971009e-19 + -4.336808689942018e-19i, -0.005510364427878949 + -0.005769858032585175i, 5.421010862427522e-20 + -5.421010862427522e-20i, 0.013328939406272416 + -1.9481757786848908e-20i, 5.421010862427522e-19 + 1.0842021724855044e-19i, -0.004982615328956215 + -0.04587251781605116i, -2.710505431213761e-20 + 8.131516293641283e-20i }, { -4.336808689942018e-19 + 0.0i, 0.005411271279782297 + -0.0041496777283130245i, 1.734723475976807e-18 + 2.168404344971009e-18i, 0.0013604832639902685 + 0.0014245510241059527i, -4.87890977618477e-19 + -3.2526065174565133e-19i, 0.24575289620801516 + 1.5720931501039814e-18i, -8.673617379884035e-19 + 1.5178830414797062e-18i, 0.007665713994927534 + 0.07057450326568444i }, { 0.004143043731022533 + 0.006818399114679064i, 1.0842021724855044e-18 + -1.734723475976807e-18i, 0.02191726834055977 + -0.01680743684725046i, 1.3010426069826053e-18 + 2.168404344971009e-19i, -0.004982615328956216 + 0.045872517816051166i, 0.0 + 1.951563910473908e-18i, 0.15973621616873346 + 9.0801931945661e-19i, -7.589415207398531e-19 + 0.0i }, { 0.0 + -1.0842021724855044e-19i, -0.0010228981643244223 + -0.0016834309244221045i, 2.168404344971009e-19 + -2.168404344971009e-19i, 0.00045153509159708314 + -0.00034626338549184323i, 0.0 + 0.0i, 0.007665713994927535 + -0.07057450326568444i, -5.421010862427522e-20 + -1.0842021724855044e-19i, 0.02050646710582192 + 1.1011428314305904e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.01701068161006533, 1.0e-7), DoubleNear(0.3136351771678644, 1.0e-7), DoubleNear(0.20385882417352785, 1.0e-7), DoubleNear(0.026170798159699082, 1.0e-7), DoubleNear(0.013328939406272416, 1.0e-7), DoubleNear(0.24575289620801516, 1.0e-7), DoubleNear(0.15973621616873346, 1.0e-7), DoubleNear(0.02050646710582192, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.01849540966962704 + -5.183841637196318e-19i, 0.0005434048000602011 + -0.0008964108668808239i, -0.006913941831849096 + -0.06365330231645222i, 0.00027437860742740973 + 0.00012809165220310878i, -0.004532950039131173 + 0.003246211135236094i, 0.0014186333542967682 + -0.0031569694752572046i, 0.012866576946508177 + 0.014386981906123576i, 0.0009508591504090202 + 0.0003089238026449426i }, { 0.0005434048000602001 + 0.0008964108668808237i, 0.28393325458896335 + -2.439454888092385e-19i, 0.0028819282017898172 + -0.0022052629997417676i, 0.008856665198710898 + 0.08153901220461654i, -0.0009294079381700912 + -0.0007419030994748767i, 0.15053013427549272 + -0.06369658012505457i, -0.0022058830048419854 + 0.0034759629814453095i, 0.02298762515596474 + 0.041241872806809535i }, { -0.006913941831849093 + 0.06365330231645222i, 0.0028819282017898164 + 0.0022052629997417706i, 0.2216520510046384 + -6.085084693074894e-18i, -0.0005434048000602019 + 0.0008964108668808232i, -0.009477568164648304 + -0.016813974912910624i, 0.01033462828530491 + 0.006062466476654549i, -0.054323623602939144 + 0.038903131586254025i, -0.0014186333542967728 + 0.0031569694752572055i }, { 0.00027437860742740984 + -0.00012809165220310873i, 0.008856665198710898 + -0.08153901220461654i, -0.0005434048000602022 + -0.0008964108668808243i, 0.023692367558302008 + -1.0164395367051604e-20i, -0.0002420480859968732 + 0.00024376228121562903i, -0.013596720920213712 + -0.04521561857524479i, 0.000929407938170093 + 0.0007419030994748762i, 0.012560752262071092 + -0.005315061776452752i }, { -0.004532950039131173 + -0.0032462111352360937i, -0.0009294079381700908 + 0.0007419030994748768i, -0.009477568164648302 + 0.016813974912910628i, -0.0002420480859968732 + -0.00024376228121562892i, 0.011844211346710707 + -4.895850435129856e-19i, -0.0005434048000602003 + 0.0008964108668808237i, -0.0044275952659628874 + -0.04076271783210159i, -0.00027437860742740973 + -0.00012809165220310868i }, { 0.0014186333542967693 + 0.0031569694752572046i, 0.15053013427549275 + 0.06369658012505455i, 0.010334628285304912 + -0.0060624664766545525i, -0.013596720920213709 + 0.04521561857524479i, -0.0005434048000602011 + -0.0008964108668808232i, 0.27545481878691613 + -5.244828009398628e-18i, -0.0028819282017898172 + 0.00220526299974177i, 0.008592199286057586 + 0.07910420307547814i }, { 0.012866576946508175 + -0.014386981906123576i, -0.0022058830048419876 + -0.003475962981445306i, -0.054323623602939144 + -0.038903131586254025i, 0.0009294079381700921 + -0.0007419030994748762i, -0.004427595265962884 + 0.0407627178321016i, -0.0028819282017898155 + -0.0022052629997417676i, 0.14194298933762292 + -5.204170427930421e-18i, 0.0005434048000602012 + -0.000896410866880824i }, { 0.0009508591504090202 + -0.00030892380264494287i, 0.022987625155964732 + -0.041241872806809535i, -0.0014186333542967728 + -0.0031569694752572055i, 0.012560752262071092 + 0.005315061776452753i, -0.00027437860742740984 + 0.00012809165220310862i, 0.008592199286057582 + -0.07910420307547814i, 0.0005434048000602016 + 0.0008964108668808236i, 0.022984897707218996 + -3.2526065174565133e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.01849540966962704, 1.0e-7), DoubleNear(0.28393325458896335, 1.0e-7), DoubleNear(0.2216520510046384, 1.0e-7), DoubleNear(0.023692367558302008, 1.0e-7), DoubleNear(0.011844211346710707, 1.0e-7), DoubleNear(0.27545481878691613, 1.0e-7), DoubleNear(0.14194298933762292, 1.0e-7), DoubleNear(0.022984897707218996, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.014632304381734088 + -3.9048218868423246e-19i, 0.0 + 0.0i, -0.005469838363588957 + -0.05035814350878609i, 5.421010862427522e-20 + -1.3552527156068805e-19i, 0.006231969655156237 + 0.0015899594885073413i, -1.0842021724855044e-19 + 6.505213034913027e-19i, 0.0031423308451887146 + -0.022042136031981907i, -1.0842021724855044e-19 + 6.776263578034403e-20i }, { -2.710505431213761e-19 + 1.0842021724855044e-19i, 0.28960432911816414 + -5.55653613398821e-18i, -4.336808689942018e-19 + 2.168404344971009e-19i, 0.009033561731999257 + 0.08316761261607311i, 0.0 + 0.0i, 0.11490220978230245 + -0.02931494676689864i, -8.673617379884035e-19 + -4.336808689942018e-19i, 0.012002687778757275 + 0.03208282182420418i }, { -0.005469838363588954 + 0.05035814350878609i, 4.336808689942018e-19 + -6.505213034913027e-19i, 0.17535595777916707 + -3.3068166260807885e-18i, 0.0 + -2.168404344971009e-19i, -0.00780159240935473 + 0.02085342081940798i, -1.734723475976807e-18 + -4.336808689942018e-19i, 0.07468495591814071 + 0.019054337694432072i, -1.0842021724855044e-19 + -2.168404344971009e-19i }, { -2.710505431213761e-20 + -4.0657581468206416e-20i, 0.009033561731999255 + -0.08316761261607311i, -4.87890977618477e-19 + -1.0842021724855044e-19i, 0.024165581526813223 + -2.727446090158847e-19i, -1.6263032587282567e-19 + -5.421010862427522e-20i, -0.004834450975307811 + -0.03391165071012184i, 2.168404344971009e-19 + 2.168404344971009e-19i, 0.009587835674142453 + -0.0024461400083582068i }, { 0.006231969655156239 + -0.0015899594885073398i, 5.421010862427522e-19 + 0.0i, -0.007801592409354729 + -0.020853420819407983i, -2.710505431213761e-19 + 1.8973538018496328e-19i, 0.01570731663460366 + -6.174870185483849e-19i, 7.589415207398531e-19 + 0.0i, -0.005871698734223028 + -0.05405787663976773i, -2.710505431213761e-20 + 2.439454888092385e-19i }, { 2.168404344971009e-19 + -8.673617379884035e-19i, 0.11490220978230244 + 0.02931494676689863i, -8.673617379884035e-19 + -1.3010426069826053e-18i, -0.004834450975307811 + 0.033911650710121824i, -7.047314121155779e-19 + 2.168404344971009e-19i, 0.2697837442577154 + 6.776263578034403e-20i, 0.0 + 2.6020852139652106e-18i, 0.008415302752769227 + 0.07747560266402156i }, { 0.0031423308451887103 + 0.02204213603198191i, -3.469446951953614e-18 + 3.469446951953614e-18i, 0.07468495591814073 + -0.019054337694432058i, -8.673617379884035e-19 + -1.0842021724855044e-18i, -0.005871698734223023 + 0.05405787663976774i, 8.673617379884035e-19 + 2.8189256484623115e-18i, 0.18823908256309424 + -7.982438494924526e-18i, -7.589415207398531e-19 + -2.168404344971009e-19i }, { 0.0 + -6.776263578034403e-20i, 0.012002687778757279 + -0.032082821824204175i, -4.336808689942018e-19 + -4.336808689942018e-19i, 0.009587835674142451 + 0.0024461400083582068i, 2.710505431213761e-20 + -5.421010862427522e-20i, 0.008415302752769227 + -0.07747560266402156i, 0.0 + -3.2526065174565133e-19i, 0.02251168373870778 + -6.268043809681823e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.014632304381734088, 1.0e-7), DoubleNear(0.28960432911816414, 1.0e-7), DoubleNear(0.17535595777916707, 1.0e-7), DoubleNear(0.024165581526813223, 1.0e-7), DoubleNear(0.01570731663460366, 1.0e-7), DoubleNear(0.2697837442577154, 1.0e-7), DoubleNear(0.18823908256309424, 1.0e-7), DoubleNear(0.02251168373870778, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.015333120984530615 + -4.590918574118308e-19i, -0.0004819944021843429 + 0.0012213286786216674i, -0.00573181716336036 + -0.05277005499834089i, -0.0003657718685686378 + -0.00010032093028118695i, 0.004602377102585181 + -0.010390986927938054i, -0.0059918632743829504 + -0.0015985065048794499i, -0.037481797497261465 + -0.011955064842549264i, 0.00027215098345816156 + -0.0017705853099798372i }, { -0.00048199440218434325 + -0.0012213286786216678i, 0.13199930695995324 + -2.019326546254252e-18i, -0.004023112960307797 + 0.0021153751951159643i, 0.004117424251338884 + 0.03790712404149267i, -0.0022557777621038076 + 0.002520775039592412i, -0.14217146510241496 + 0.03362869949573711i, 0.009518684638211485 + 0.006821109351375002i, -0.014092100665076936 + -0.03977935839880045i }, { -0.005731817163360357 + 0.05277005499834089i, -0.004023112960307797 + -0.0021153751951159634i, 0.18375465995244455 + -4.621411760219463e-18i, 0.00048199440218434477 + -0.0012213286786216682i, 0.0340408823573537 + 0.019723768588889877i, 0.007741251181286796 + -0.020023882145133606i, 0.05515564902355369 + -0.12452730735248971i, 0.005991863274382953 + 0.0015985065048794572i }, { -0.0003657718685686379 + 0.00010032093028118699i, 0.0041174242513388835 + -0.03790712404149267i, 0.00048199440218434504 + 0.001221328678621668i, 0.011014476280574103 + -1.5246593050577406e-19i, 0.0006535438710248934 + 0.0007264367512731616i, 0.005222656548394424 + 0.041877303093112266i, 0.002255777762103805 + -0.0025207750395924164i, -0.01186327615053391 + 0.002806094376349458i }, { 0.004602377102585181 + 0.010390986927938054i, -0.0022557777621038063 + -0.002520775039592411i, 0.0340408823573537 + -0.01972376858888988i, 0.000653543871024893 + -0.0007264367512731615i, 0.015006500031807132 + -5.488773498207866e-19i, 0.0004819944021843437 + -0.0012213286786216674i, -0.005609719934451625 + -0.05164596515021293i, 0.0003657718685686378 + 0.00010032093028118706i }, { -0.005991863274382952 + 0.0015985065048794499i, -0.14217146510241496 + -0.03362869949573711i, 0.007741251181286798 + 0.020023882145133613i, 0.005222656548394421 + -0.041877303093112266i, 0.0004819944021843423 + 0.0012213286786216682i, 0.42738876641592627 + -3.469446951953614e-18i, 0.004023112960307797 + -0.0021153751951159616i, 0.013331440233429599 + 0.12273609123860199i }, { -0.037481797497261465 + 0.011955064842549264i, 0.009518684638211481 + -0.006821109351374999i, 0.0551556490235537 + 0.12452730735248971i, 0.002255777762103805 + 0.0025207750395924156i, -0.005609719934451621 + 0.05164596515021293i, 0.004023112960307798 + 0.002115375195115965i, 0.17984038038981676 + -6.667843360785852e-18i, -0.0004819944021843455 + 0.0012213286786216678i }, { 0.0002721509834581618 + 0.0017705853099798377i, -0.014092100665076936 + 0.03977935839880045i, 0.005991863274382954 + -0.0015985065048794587i, -0.01186327615053391 + -0.0028060943763494584i, 0.0003657718685686379 + -0.00010032093028118709i, 0.013331440233429599 + -0.12273609123860199i, -0.0004819944021843455 + -0.0012213286786216684i, 0.0356627889849469 + -1.8295911660692887e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.015333120984530615, 1.0e-7), DoubleNear(0.13199930695995324, 1.0e-7), DoubleNear(0.18375465995244455, 1.0e-7), DoubleNear(0.011014476280574103, 1.0e-7), DoubleNear(0.015006500031807132, 1.0e-7), DoubleNear(0.42738876641592627, 1.0e-7), DoubleNear(0.17984038038981676, 1.0e-7), DoubleNear(0.0356627889849469, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.05549803831717967 + -2.3030825835844426e-18i, -1.5585406229479126e-19 + 7.284483346386983e-20i, -0.020602830811568953 + -0.00024373383258460886i, 4.0657581468206416e-20 + 4.0657581468206416e-20i, -0.025678706606611132 + -0.007027520364079563i, -9.893344823930228e-19 + 5.759824041329242e-19i, 0.009210120966156286 + 0.0022948419851602578i, 1.5415999640028266e-19 + 8.690558038829121e-19i }, { -3.4220131069073734e-19 + -2.710505431213761e-20i, 0.08410767484193923 + -4.950060543754131e-18i, 5.421010862427522e-20 + 1.2197274440461925e-19i, -0.00508674278749144 + 0.00032875343949165746i, -6.030874584450618e-19 + -3.9979955110402976e-19i, 0.07011688989232434 + 0.016395875963524445i, 5.488773498207866e-19 + -3.3203691532368573e-19i, -0.00503385905604789 + -0.0007038437808693868i }, { -0.020602830811568953 + 0.00024373383258461046i, -2.371692252312041e-20 + -3.1170812458958252e-19i, 0.05364513684112647 + -2.450466316406691e-18i, -2.371692252312041e-20 + -2.371692252312041e-19i, 0.009863036225917688 + 0.0020744999582706877i, 1.3891340334970526e-19 + 8.470329472543003e-19i, -0.024841169891804602 + -0.00454574006357575i, -7.995991022080595e-19 + 2.185345003916095e-19i }, { -3.3881317890172014e-21 + -1.0842021724855044e-19i, -0.00508674278749144 + -0.0003287534394916576i, -5.082197683525802e-20 + -8.131516293641283e-20i, 0.08380823076683891 + -5.624298769768554e-19i, 3.5914196963582334e-19 + -7.148958074826295e-19i, -0.0034476852558136895 + -0.0012391364469811468i, -9.147955830346444e-19 + -4.2351647362715017e-19i, 0.06987310504012678 + 0.01567349516152593i }, { -0.025678706606611132 + 0.007027520364079563i, -5.353248226647178e-19 + 1.0842021724855044e-19i, 0.009863036225917688 + -0.0020744999582706864i, 4.811147140404426e-19 + 5.022905377218001e-19i, 0.14726737815457458 + -3.13571597073542e-18i, 1.8973538018496328e-19 + 7.115076756936123e-20i, -0.05375975912602332 + -0.0012816464319500777i, -2.710505431213761e-19 + -2.439454888092385e-19i }, { -1.0401564592282808e-18 + 1.2874900798265365e-19i, 0.07011688989232434 + -0.01639587596352445i, 3.9302328752599536e-19 + -5.488773498207866e-19i, -0.0034476852558136904 + 0.0012391364469811475i, -4.743384504624082e-19 + 6.776263578034403e-20i, 0.21986201269581818 + 3.984442983884229e-18i, 1.4907779871675686e-19 + -3.7947076036992655e-19i, -0.013273033666714437 + 0.0017287122934381016i }, { 0.009210120966156286 + -0.002294841985160257i, 4.607859233063394e-19 + 5.116079001415974e-19i, -0.024841169891804602 + 0.004545740063575749i, -6.369687763352339e-19 + 6.335806445462167e-19i, -0.053759759126023314 + 0.0012816464319500855i, -4.946672411965114e-19 + -8.131516293641283e-20i, 0.13752410804571835 + -4.407959457511379e-18i, 2.710505431213761e-20 + 5.421010862427522e-20i }, { 1.8634724839594607e-19 + -8.690558038829121e-19i, -0.00503385905604789 + 0.0007038437808693872i, -9.215718466126788e-19 + -2.202285662861181e-19i, 0.06987310504012678 + -0.015673495161525917i, 5.827586677109586e-19 + 3.5236570605778894e-19i, -0.013273033666714437 + -0.0017287122934381027i, -2.303929616531697e-19 + -2.846030702774449e-19i, 0.21828742033680415 + -4.296151108473811e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.05549803831717967, 1.0e-7), DoubleNear(0.08410767484193923, 1.0e-7), DoubleNear(0.05364513684112647, 1.0e-7), DoubleNear(0.08380823076683891, 1.0e-7), DoubleNear(0.14726737815457458, 1.0e-7), DoubleNear(0.21986201269581818, 1.0e-7), DoubleNear(0.13752410804571835, 1.0e-7), DoubleNear(0.21828742033680415, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.13722353545829002 + -8.405954968551677e-18i, 1.6263032587282567e-19 + 1.5246593050577406e-20i, -0.04169328088993121 + -0.007047684649823001i, -2.1006417091906648e-19 + -1.3552527156068805e-20i, 0.010333991171456442 + 0.011111933695118113i, 1.4230153513872246e-19 + 3.6591823321385775e-19i, -0.03907735915897653 + -0.029966793124778974i, 1.3891340334970526e-19 + -7.724940478959219e-19i }, { -5.149960319306146e-19 + 2.778268066994105e-19i, 0.17423227463470825 + -4.723055713889979e-18i, 1.4907779871675686e-19 + -1.2197274440461925e-19i, -0.010293876496555169 + 0.009506068749308988i, 3.1170812458958252e-19 + -1.8295911660692887e-19i, 0.005007332760664502 + -0.0004590873939516421i, 2.0328790734103208e-19 + -1.4230153513872246e-19i, -0.049616395250619595 + -0.038048739323036804i }, { -0.04169328088993121 + 0.007047684649823009i, -1.9312351197398048e-19 + -8.131516293641283e-20i, 0.08364597032530317 + -4.779806921356017e-18i, 1.3891340334970526e-19 + -1.2197274440461925e-19i, -0.02381999278539574 + -0.0182665566813184i, -2.981555974335137e-19 + 6.945670167485263e-20i, 0.01341212943986042 + 0.007097973504097528i, -4.743384504624082e-20 + 9.486769009248164e-20i }, { 3.5914196963582334e-19 + 2.0328790734103208e-19i, -0.010293876496555169 + -0.009506068749308988i, 2.608861477543245e-19 + -1.6263032587282567e-19i, 0.16557370069285524 + -2.783350264677631e-18i, 2.371692252312041e-20 + 9.486769009248164e-20i, -0.04715067971136948 + -0.036157885154292704i, -9.486769009248164e-20 + 2.371692252312041e-19i, 0.00085547361071488 + 0.004955028507756511i }, { 0.010333991171456447 + -0.011111933695118119i, 7.453889935837843e-20 + -9.486769009248164e-20i, -0.02381999278539574 + 0.0182665566813184i, -2.668153783851046e-19 + -2.710505431213761e-20i, 0.06554188101346425 + 2.967156414231814e-18i, -1.2874900798265365e-19 + 1.2874900798265365e-19i, -0.03266930904766106 + 0.005522304385288314i, -2.0328790734103208e-20 + -1.8973538018496328e-19i }, { 6.776263578034403e-21 + -6.776263578034403e-20i, 0.005007332760664499 + 0.00045908739395164166i, 3.1170812458958252e-19 + 7.284483346386983e-20i, -0.04715067971136948 + 0.03615788515429271i, -3.015437292225309e-19 + -2.371692252312041e-19i, 0.12973741290304922 + 3.757438154020076e-18i, 5.421010862427522e-20 + -1.3552527156068805e-19i, -0.008065899957650707 + -0.007448603016379228i }, { -0.039077359158976546 + 0.029966793124778963i, -6.776263578034403e-20 + 2.270048298641525e-19i, 0.01341212943986042 + -0.0070979735040975316i, 5.082197683525802e-19 + 0.0i, -0.03266930904766105 + -0.005522304385288314i, -3.2526065174565133e-19 + -3.1170812458958252e-19i, 0.10752327456154165 + -2.078618852562053e-18i, -1.3552527156068805e-19 + -6.098637220230962e-20i }, { -1.0164395367051604e-19 + 6.640738306473715e-19i, -0.04961639525061959 + 0.0380487393230368i, -6.776263578034403e-21 + 8.131516293641283e-20i, 0.0008554736107148795 + -0.00495502850775651i, 2.202285662861181e-19 + 4.0657581468206416e-20i, -0.008065899957650707 + 0.007448603016379226i, -5.421010862427522e-19 + -2.0328790734103208e-19i, 0.13652195041078785 + -2.075230720773036e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13722353545829002, 1.0e-7), DoubleNear(0.17423227463470825, 1.0e-7), DoubleNear(0.08364597032530317, 1.0e-7), DoubleNear(0.16557370069285524, 1.0e-7), DoubleNear(0.06554188101346425, 1.0e-7), DoubleNear(0.12973741290304922, 1.0e-7), DoubleNear(0.10752327456154165, 1.0e-7), DoubleNear(0.13652195041078785, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.12394262925204733 + -2.797749824780954e-18i, -6.2341624917916505e-19 + 1.2705494208814505e-19i, -0.04533235811514014 + -0.0010178431747198883i, -1.8973538018496328e-19 + 2.0328790734103208e-19i, -0.030294561096697353 + 0.022021375173978466i, -2.3107058801097313e-18 + 6.403569081242511e-19i, 0.011359349344800672 + -0.007728580223343182i, 4.743384504624082e-19 + 2.2459078596447773e-18i }, { -8.097634975751111e-19 + -3.9979955110402976e-19i, 0.15429215654279113 + 4.37069000783219e-19i, 1.9651164376299768e-19 + -7.182839392716467e-19i, -0.00931902435943725 + 0.001052526897637122i, 1.0706496453294356e-18 + 3.3881317890172014e-20i, 0.08179759286714745 + -0.034668643228173646i, 1.4907779871675686e-19 + 5.963111948670274e-19i, -0.0045830581780437335 + 0.0026442565285882224i }, { -0.04533235811514012 + 0.0010178431747198948i, -4.3029273720518457e-19 + 3.9302328752599536e-19i, 0.11620483142221813 + -3.8057190320135714e-18i, -5.929230630780102e-19 + -8.131516293641283e-20i, 0.01086122518287633 + -0.008184385028952919i, 8.74138001566438e-19 + 2.177721707390806e-18i, -0.02856201254537296 + 0.020127967547511654i, -1.7957098481791167e-18 + -3.4220131069073734e-19i }, { 3.6253010142484055e-19 + -3.2526065174565133e-19i, -0.00931902435943725 + -0.0010525268976371229i, -7.894347068410079e-19 + -1.2197274440461925e-19i, 0.15333346560447422 + -6.911788849595091e-19i, 1.6940658945086007e-19 + 6.911788849595091e-19i, -0.005298094983627553 + 0.0015369372710429055i, 4.2690460541616737e-19 + -7.318364664277155e-19i, 0.08129329367041636 + -0.03434299867333368i }, { -0.030294561096697356 + -0.022021375173978463i, 5.590417451878382e-19 + 5.421010862427522e-20i, 0.01086122518287633 + 0.008184385028952915i, 5.759824041329242e-19 + -6.471331717022855e-19i, 0.07882278721970692 + -2.6410487295389085e-18i, 6.572975670693371e-19 + 1.6940658945086007e-20i, -0.02903023182245214 + -0.0005075370898147984i, -4.0657581468206416e-20 + -4.0657581468206416e-19i }, { -1.7787691892340307e-18 + -6.335806445462167e-19i, 0.08179759286714745 + 0.034668643228173646i, 3.015437292225309e-19 + -2.3005414847426797e-18i, -0.005298094983627552 + -0.0015369372710429062i, -6.776263578034403e-21 + 4.404571325722362e-19i, 0.14967753099496628 + -1.4026865606531214e-18i, 6.776263578034403e-21 + 4.607859233063394e-19i, -0.00904075209476863 + 0.0010049388352926373i }, { 0.01135934934480067 + 0.007728580223343182i, 3.3881317890172014e-19 + -9.198777807181702e-19i, -0.02856201254537296 + -0.02012796754751165i, 5.082197683525802e-19 + 2.981555974335137e-19i, -0.02903023182245214 + 0.0005075370898148011i, -8.809142651444724e-20 + -7.860465750519907e-19i, 0.07496441346462669 + -3.0527067419044984e-18i, 5.963111948670274e-19 + -1.0164395367051604e-19i }, { 1.2197274440461925e-19 + -2.3683041205230237e-18i, -0.0045830581780437335 + -0.002644256528588222i, -2.1988975310721637e-18 + -6.437450399132683e-20i, 0.08129329367041636 + 0.034342998673333666i, 2.168404344971009e-19 + 5.692061405548898e-19i, -0.009040752094768628 + -0.0010049388352926377i, 5.082197683525802e-19 + -2.439454888092385e-19i, 0.14876218549916886 + -4.167402100491158e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.12394262925204733, 1.0e-7), DoubleNear(0.15429215654279113, 1.0e-7), DoubleNear(0.11620483142221813, 1.0e-7), DoubleNear(0.15333346560447422, 1.0e-7), DoubleNear(0.07882278721970692, 1.0e-7), DoubleNear(0.14967753099496628, 1.0e-7), DoubleNear(0.07496441346462669, 1.0e-7), DoubleNear(0.14876218549916886, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.09091773641428068 + 3.1848438816761693e-18i, -1.5585406229479126e-19 + -1.3552527156068805e-19i, -0.035863864284757935 + 0.0010724318674832022i, -6.776263578034403e-20 + -8.131516293641283e-20i, 0.041649430027047185 + 0.030955705295998913i, -1.0164395367051604e-19 + -1.3552527156068805e-19i, -0.009846247604152602 + -0.004210323817612034i, 1.3552527156068805e-20 + -9.317362419797304e-20i }, { -9.825582188149884e-20 + -9.486769009248164e-20i, 0.1584807523501469 + -8.097634975751111e-19i, 2.168404344971009e-19 + -2.846030702774449e-19i, -0.009505155715407908 + 0.0035039849187025155i, 2.236166980751353e-19 + 1.7618285302889447e-19i, 0.06243749280198786 + -0.019215095377180982i, 4.0657581468206416e-19 + -8.639736061993863e-20i, 0.003550644869177298 + 0.0013847689386679014i }, { -0.035863864284757935 + -0.0010724318674831998i, -2.0328790734103208e-19 + -8.131516293641283e-20i, 0.09907052574662048 + -6.88214269644119e-18i, 9.486769009248164e-20 + 3.3881317890172014e-20i, -0.020702941109862587 + -0.0035836763379988134i, -6.776263578034403e-20 + 1.0164395367051604e-19i, 0.03926749554624977 + -0.010311408113059502i, -1.1519648082658485e-19 + -2.778268066994105e-19i }, { 7.792703114739563e-20 + 2.710505431213761e-20i, -0.009505155715407908 + -0.0035039849187025146i, -1.4907779871675686e-19 + 0.0i, 0.15528915829483048 + -5.019517245428984e-18i, 3.6591823321385775e-19 + -1.3552527156068805e-19i, -0.011093097009660508 + 0.0005395333302707201i, 8.131516293641283e-20 + 2.0328790734103208e-19i, 0.06205255265445705 + -0.012545991398075862i }, { 0.04164943002704719 + -0.030955705295998902i, 8.131516293641283e-20 + -1.07742590890747e-18i, -0.020702941109862594 + 0.0035836763379988043i, -7.115076756936123e-19 + -8.470329472543003e-20i, 0.11184768005747359 + -8.623642435996032e-18i, 1.8973538018496328e-19 + 2.795208725939191e-19i, -0.03849872565283434 + -0.002597812132017889i, -1.6263032587282567e-19 + -1.2197274440461925e-19i }, { -6.776263578034403e-20 + -9.486769009248164e-20i, 0.06243749280198785 + 0.019215095377180993i, -4.2012834183813297e-19 + 1.2874900798265365e-19i, -0.011093097009660508 + -0.0005395333302707198i, -7.182839392716467e-19 + 1.3552527156068805e-19i, 0.14548893518761055 + -1.5585406229479126e-19i, -1.3552527156068805e-20 + 2.710505431213761e-20i, -0.008854620738797968 + -0.001446519185772756i }, { -0.00984624760415261 + 0.004210323817612046i, -1.7618285302889447e-19 + 5.421010862427522e-20i, 0.039267495546249774 + 0.010311408113059507i, -6.844026213814747e-19 + 1.3552527156068805e-19i, -0.03849872565283433 + 0.0025978121320178963i, -3.1509625637859973e-19 + -3.1170812458958252e-19i, 0.09209871914022433 + 2.371692252312041e-20i, -9.147955830346444e-20 + -2.168404344971009e-19i }, { -4.472333961502706e-19 + 5.929230630780102e-20i, 0.0035506448691773 + -0.0013847689386678997i, -1.1519648082658485e-19 + -6.098637220230962e-19i, 0.06205255265445704 + 0.012545991398075853i, 5.014435047745458e-19 + 2.168404344971009e-19i, -0.008854620738797971 + 0.0014465191857727538i, -1.3213713977167085e-19 + -3.6591823321385775e-19i, 0.14680649280881258 + 1.6093625997831706e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.09091773641428068, 1.0e-7), DoubleNear(0.1584807523501469, 1.0e-7), DoubleNear(0.09907052574662048, 1.0e-7), DoubleNear(0.15528915829483048, 1.0e-7), DoubleNear(0.11184768005747359, 1.0e-7), DoubleNear(0.14548893518761055, 1.0e-7), DoubleNear(0.09209871914022433, 1.0e-7), DoubleNear(0.14680649280881258, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.10247414298833687 + -2.1116531375049707e-18i, 9.520650327138336e-19 + -2.354751593366955e-19i, -0.03758156990893667 + -0.0007709008669202187i, -1.4230153513872246e-19 + -9.622294280808852e-19i, 0.030758555272105213 + -0.06944492783417894i, 1.81603863891322e-18 + 4.092863201132779e-18i, -0.011802879390411237 + 0.025236977230354785i, 3.772684747070654e-18 + -1.2807138162485021e-18i }, { 9.859463506040056e-19 + 1.2197274440461925e-19i, 0.07172800065198465 + -9.317362419797304e-19i, -1.3552527156068805e-19 + 6.369687763352339e-19i, -0.004332372968321034 + 0.0004855020401160578i, -8.809142651444724e-19 + -2.3174821436877657e-18i, -0.07725551880854545 + 0.018273727604398944i, 2.0769247866675444e-18 + -4.1335207826009857e-19i, 0.004542546653268292 + -0.0016266494874384158i }, { -0.03758156990893667 + 0.0007709008669202241i, -2.947674656444965e-19 + -8.809142651444724e-19i, 0.09661363794863828 + -2.9688504801263227e-18i, 9.317362419797304e-19 + -2.236166980751353e-19i, -0.010758027420745601 + 0.025699763182654545i, 4.0538996855590814e-18 + -1.81603863891322e-18i, 0.028999470854033656 + -0.06547336644624879i, 7.453889935837843e-19 + 3.7947076036992655e-18i }, { -7.792703114739563e-20 + 1.0842021724855044e-18i, -0.004332372968321034 + -0.000485502040116058i, 7.487771253728015e-19 + -1.3552527156068805e-20i, 0.0712857825885427 + -1.2400562347802957e-18i, 2.2937652211646453e-18 + -4.54009659728305e-19i, 0.0047899237431583705 + -0.0005808176881176441i, -8.334804200982315e-19 + -2.0938654456126304e-18i, -0.07677922244440341 + 0.018161066267687622i }, { 0.03075855527210522 + 0.06944492783417895i, -6.14945919706622e-19 + 2.4123498337802474e-18i, -0.010758027420745605 + -0.025699763182654545i, 2.1616280813929745e-18 + 4.336808689942018e-19i, 0.10029127348341738 + -3.3271454168148917e-18i, -9.181837148236616e-19 + 3.7947076036992655e-19i, -0.0367810200286556 + -0.000754479397614468i, -8.809142651444724e-20 + 7.589415207398531e-19i }, { 1.7889335846010823e-18 + -4.404571325722362e-18i, -0.07725551880854545 + -0.018273727604398944i, 3.757438154020076e-18 + 1.7889335846010823e-18i, 0.004789923743158371 + 0.0005808176881176442i, -1.802486111757151e-18 + -8.131516293641283e-20i, 0.2322416868857728 + -3.3881317890172014e-20i, 3.3881317890172014e-19 + -8.944667923005412e-19i, -0.014027403485884844 + 0.0015719636928137016i }, { -0.011802879390411239 + -0.025236977230354785i, 1.9447876468958736e-18 + 3.1170812458958252e-19i, 0.028999470854033663 + 0.0654733664462488i, -7.369186641112413e-19 + 2.1616280813929745e-18i, -0.036781020028655596 + 0.000754479397614472i, -2.236166980751353e-19 + 4.87890977618477e-19i, 0.09455560693820653 + -3.889575293791747e-18i, -9.283481101907132e-19 + 4.0657581468206416e-20i }, { 3.97089045672816e-18 + 1.5043305143236374e-18i, 0.0045425466532682925 + 0.0016266494874384153i, 1.1180834903756764e-18 + -3.97089045672816e-18i, -0.07677922244440341 + -0.018161066267687626i, 6.572975670693371e-19 + -8.402566836762659e-19i, -0.014027403485884844 + -0.0015719636928137027i, -1.0299920638612292e-18 + -3.5236570605778894e-19i, 0.23080986851510035 + -3.618524750670371e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.10247414298833687, 1.0e-7), DoubleNear(0.07172800065198465, 1.0e-7), DoubleNear(0.09661363794863828, 1.0e-7), DoubleNear(0.0712857825885427, 1.0e-7), DoubleNear(0.10029127348341738, 1.0e-7), DoubleNear(0.2322416868857728, 1.0e-7), DoubleNear(0.09455560693820653, 1.0e-7), DoubleNear(0.23080986851510035, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.058390811467601014 + -3.7159335396046156e-18i, -5.082197683525802e-20 + -1.2366681029912785e-19i, -0.026986279487520682 + -0.010902107065707281i, -9.41900637346782e-19 + 2.456395547037471e-19i, 0.005173379575665264 + 0.0066725838434137305i, -1.3552527156068805e-20 + 2.168404344971009e-19i, -0.002310629387694732 + -0.0031624542901150373i, 8.91078660511524e-19 + -1.455202603382888e-18i }, { -1.8634724839594607e-19 + -2.0328790734103208e-20i, 0.0898337983350073 + -2.9934144355966974e-18i, -9.41900637346782e-19 + -7.352245982167327e-19i, 0.07477866912089935 + 0.030209612902146778i, -9.486769009248164e-20 + -1.3552527156068805e-20i, 0.0012772832764657745 + 0.0016474298143708324i, -1.8465318250143747e-18 + 3.3203691532368573e-19i, 0.0010275019150036927 + 0.0014062955558817379i }, { -0.026986279487520675 + 0.010902107065707285i, -4.0657581468206416e-19 + 3.3542504711270293e-19i, 0.16247869431599216 + -9.469828350303078e-18i, 3.5236570605778894e-19 + 1.6940658945086007e-20i, -0.0036367963597760174 + -0.0021179269711887883i, -8.809142651444724e-20 + -1.7550522667109103e-18i, 0.018572741035651597 + 0.011537323355801911i, 1.0842021724855044e-19 + 2.439454888092385e-19i }, { -1.0672615135404184e-18 + 2.541098841762901e-19i, 0.07477866912089935 + -0.030209612902146778i, -6.776263578034403e-20 + 1.3552527156068805e-19i, 0.24997217699255614 + -4.512991542970912e-18i, -1.1214716221646936e-18 + 1.1926223897340549e-18i, 0.0016172282946147678 + 0.0009418100671287553i, 3.1170812458958252e-19 + 6.776263578034403e-20i, 0.0045855230949136076 + 0.0028485112994340363i }, { 0.005173379575665266 + -0.006672583843413734i, 1.7618285302889447e-19 + 6.776263578034403e-21i, -0.0036367963597760166 + 0.002117926971188791i, -1.3099364529287755e-18 + -9.012430558785756e-19i, 0.050752363690705134 + -1.037615360386518e-18i, -1.2874900798265365e-19 + -4.0657581468206416e-20i, -0.023533597010895052 + -0.0006711533619480317i, -8.470329472543003e-19 + 5.488773498207866e-19i }, { 1.3552527156068805e-19 + 4.0657581468206416e-20i, 0.0012772832764657743 + -0.0016474298143708322i, 2.0328790734103208e-19 + 1.5111067779016718e-18i, 0.0016172282946147667 + -0.0009418100671287553i, -2.0667603913004928e-19 + -8.809142651444724e-20i, 0.07808210727377082 + -2.5190759851342892e-18i, -5.759824041329242e-19 + -8.809142651444724e-20i, 0.06521132581155178 + 0.001859758222903597i }, { -0.002310629387694734 + 0.0031624542901150373i, -1.9498698445793994e-18 + -3.3373098121819433e-19i, 0.018572741035651603 + -0.011537323355801914i, 4.0657581468206416e-19 + -1.0164395367051604e-19i, -0.02353359701089506 + 0.0006711533619480278i, -7.657177843178875e-19 + 4.0657581468206416e-19i, 0.12231279188430078 + 1.926152922056279e-18i, -1.3552527156068805e-19 + 1.0842021724855044e-19i }, { 5.692061405548898e-19 + 1.773686991550505e-18i, 0.0010275019150036927 + -0.0014062955558817377i, -1.3552527156068805e-19 + -2.710505431213761e-20i, 0.004585523094913605 + -0.0028485112994340363i, -8.944667923005412e-19 + -3.4558944247975454e-19i, 0.06521132581155178 + -0.0018597582229035806i, -6.369687763352339e-19 + -3.5236570605778894e-19i, 0.18817725604006622 + 4.20128341838133e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.058390811467601014, 1.0e-7), DoubleNear(0.0898337983350073, 1.0e-7), DoubleNear(0.16247869431599216, 1.0e-7), DoubleNear(0.24997217699255614, 1.0e-7), DoubleNear(0.050752363690705134, 1.0e-7), DoubleNear(0.07808210727377082, 1.0e-7), DoubleNear(0.12231279188430078, 1.0e-7), DoubleNear(0.18817725604006622, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.027740606606768727 + -2.0904773138236132e-18i, 7.691059161069047e-19 + -6.268043809681823e-20i, -0.015965957301150843 + -0.0463569407680156i, 2.1480755542369057e-18 + 9.16489648929153e-19i, -0.01630674819037221 + -0.026190477256336487i, 1.3823577699190182e-18 + 8.131516293641283e-20i, 0.04297153556932135 + 0.009844061517759352i, 1.6093625997831706e-18 + 3.8285889215894375e-19i }, { 7.318364664277155e-19 + -1.0164395367051604e-19i, 0.08110401443248064 + -1.2163393122571753e-18i, -3.821812658011403e-18 + -1.0977546996415732e-18i, 0.05477784712381405 + 0.08246095850108404i, -2.656295322589486e-18 + -5.285485590866834e-19i, 0.045185811105586296 + 0.04288199342957551i, 1.4230153513872246e-18 + 3.9979955110402976e-19i, 0.1256340241726982 + 0.028780657853955276i }, { -0.015965957301150836 + 0.046356940768015595i, -3.4897757426877174e-18 + 1.2874900798265365e-18i, 0.2124068540674967 + -4.512991542970912e-18i, -1.98544522836408e-18 + 1.0842021724855044e-19i, 0.12609649888092195 + -0.028886603089978275i, -1.3078188705606397e-18 + 3.9979955110402976e-19i, -0.04254982545169811 + 0.06833981997782661i, -5.488773498207866e-18 + 2.168404344971009e-19i }, { 2.104029840979682e-18 + -5.38712954453735e-19i, 0.05477784712381405 + -0.08246095850108404i, -2.3310346708438345e-18 + -4.2012834183813297e-19i, 0.22652160771478472 + 9.622294280808852e-19i, -1.463672932855431e-18 + 3.1170812458958252e-19i, 0.1344758001294785 + -0.030806161138667548i, 4.153849573335089e-18 + -1.6940658945086007e-19i, 0.11790507543197754 + -0.11189363533108283i }, { -0.016306748190372207 + 0.026190477256336487i, -2.5986970821761934e-18 + 3.1170812458958252e-19i, 0.12609649888092198 + 0.028886603089978265i, -1.277325684459485e-18 + -1.6263032587282567e-19i, 0.08140256855153741 + -2.6630715861675203e-18i, -9.486769009248164e-19 + -1.0164395367051604e-19i, -0.0345539191972649 + 0.034783680340360286i, -3.937009138837988e-18 + -1.2197274440461925e-19i }, { 1.7143946852427039e-18 + -3.4558944247975454e-19i, 0.04518581110558628 + -0.04288199342957551i, -1.328147661294743e-18 + -4.87890977618477e-19i, 0.1344758001294785 + 0.03080616113866755i, -1.1248597539537109e-18 + -6.776263578034403e-21i, 0.08681189117629749 + -4.296151108473811e-18i, 2.303929616531697e-18 + 2.744386749103933e-19i, 0.08521214780863709 + -0.05039158737603366i }, { 0.042971535569321345 + -0.009844061517759354i, 1.2807138162485021e-18 + -1.6601845766184287e-19i, -0.0425498254516981 + -0.0683398199778266i, 3.665958595716612e-18 + 4.0657581468206416e-20i, -0.0345539191972649 + -0.034783680340360286i, 2.3174821436877657e-18 + -5.454892180317694e-19i, 0.07238463213279621 + -3.0306838852758866e-18i, 2.202285662861181e-18 + 1.6940658945086007e-20i }, { 1.4501204056993622e-18 + -3.1848438816761693e-19i, 0.12563402417269823 + -0.028780657853955276i, -5.692061405548898e-18 + -3.5236570605778894e-19i, 0.11790507543197754 + 0.11189363533108282i, -4.065758146820642e-18 + 4.472333961502706e-19i, 0.08521214780863709 + 0.05039158737603367i, 1.6263032587282567e-18 + 2.0328790734103208e-19i, 0.21162782531783764 + -1.2739375526704677e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.027740606606768727, 1.0e-7), DoubleNear(0.08110401443248064, 1.0e-7), DoubleNear(0.2124068540674967, 1.0e-7), DoubleNear(0.22652160771478472, 1.0e-7), DoubleNear(0.08140256855153741, 1.0e-7), DoubleNear(0.08681189117629749, 1.0e-7), DoubleNear(0.07238463213279621, 1.0e-7), DoubleNear(0.21162782531783764, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.05345643278306115 + -3.294111131871974e-18i, -8.809142651444724e-20 + -1.5585406229479126e-19i, -0.024755873086278097 + -0.004292989434368408i, -3.9302328752599536e-19 + 3.8116482626443515e-19i, 0.02241876901783624 + 0.003298661842165886i, 1.8973538018496328e-19 + 2.0328790734103208e-20i, -0.005958899902857687 + -0.0038682684695993414i, -1.7660636950252162e-18 + 1.3552527156068805e-19i }, { -2.337810934421869e-19 + -1.0842021724855044e-19i, 0.0856736095754895 + -3.538903653628467e-18i, -9.622294280808852e-19 + -4.1335207826009857e-19i, 0.07139175621733568 + 0.020173546930366416i, 1.4230153513872246e-19 + 1.2197274440461925e-19i, 0.03449109755881517 + -0.005074964968913595i, -1.0842021724855044e-18 + -6.674619624363887e-19i, 0.040997798783724664 + 0.002455617469962413i }, { -0.024755873086278097 + 0.0042929894343684055i, -9.351243737687476e-19 + 3.3881317890172014e-19i, 0.13653182937784003 + -4.0318768289304696e-19i, 2.710505431213761e-20 + 5.421010862427522e-20i, -0.014795369713814756 + 0.000886188269166764i, -1.362028979184915e-18 + 6.742382260144231e-19i, 0.058498156555460715 + 0.017345635340773533i, -4.0657581468206416e-19 + -4.336808689942018e-19i }, { -7.555533889508359e-19 + 8.470329472543003e-20i, 0.07139175621733568 + -0.020173546930366416i, -1.3552527156068805e-20 + 1.3552527156068805e-20i, 0.22809630106948783 + -2.290377089375628e-18i, -1.7584403984999275e-18 + -3.5575383784680614e-19i, 0.01651204288336274 + -0.010718927301288109i, 1.6263032587282567e-19 + 2.574980159653073e-19i, 0.08999894789762974 + -0.026686121806343256i }, { 0.022418769017836238 + -0.00329866184216588i, -2.1006417091906648e-19 + -3.7269449679189215e-19i, -0.014795369713814758 + -0.0008861882691667683i, -1.742770288975723e-18 + 4.0657581468206416e-19i, 0.055686742375245 + -1.4594377681191595e-18i, -9.147955830346444e-20 + -8.470329472543003e-21i, -0.025764003412137644 + -0.007280270993286908i, -1.395910297075087e-18 + 4.1335207826009857e-19i }, { 3.3881317890172014e-20 + -2.439454888092385e-19i, 0.03449109755881517 + 0.005074964968913609i, -1.2197274440461925e-18 + -1.1993986533120893e-18i, 0.016512042883362762 + 0.010718927301288109i, -1.5924219408380846e-19 + 0.0i, 0.08224229603328864 + -1.9735867671025198e-18i, -5.55653613398821e-19 + -4.0996394647108136e-19i, 0.06859823871511544 + 0.01189582419468396i }, { -0.005958899902857685 + 0.003868268469599342i, -1.2849489809847736e-18 + 8.775261333554552e-19i, 0.05849815655546072 + -0.017345635340773515i, -3.9302328752599536e-19 + -5.692061405548898e-19i, -0.02576400341213764 + 0.007280270993286908i, -2.371692252312041e-19 + 4.0318768289304696e-19i, 0.1482596568224529 + -7.140487745353752e-18i, 1.8973538018496328e-19 + 7.115076756936123e-20i }, { -1.904130065427667e-18 + -4.743384504624082e-19i, 0.04099779878372465 + -0.0024556174699624242i, -2.168404344971009e-19 + -4.607859233063394e-19i, 0.08999894789762972 + 0.026686121806343242i, -1.2061749168901237e-18 + -1.7618285302889447e-19i, 0.06859823871511544 + -0.011895824194683945i, -6.911788849595091e-19 + -2.303929616531697e-19i, 0.21005313196313452 + 1.9786689647860456e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.05345643278306115, 1.0e-7), DoubleNear(0.0856736095754895, 1.0e-7), DoubleNear(0.13653182937784003, 1.0e-7), DoubleNear(0.22809630106948783, 1.0e-7), DoubleNear(0.055686742375245, 1.0e-7), DoubleNear(0.08224229603328864, 1.0e-7), DoubleNear(0.1482596568224529, 1.0e-7), DoubleNear(0.21005313196313452, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.055159077578357016 + -1.5619287547369298e-18i, 4.607859233063394e-19 + -1.5077186461126546e-19i, 0.02317148535286028 + 0.005308200515744769i, -1.6872896309305663e-18 + -1.6449379835678513e-18i, 0.016556503786963453 + -0.0373803385919983i, 7.995991022080595e-19 + 2.1412992906588713e-18i, -0.008345739027760035 + 0.03784500077155323i, 1.6737371037744975e-18 + 3.330533548603909e-18i }, { 3.6591823321385775e-19 + 1.0842021724855044e-19i, 0.03962326732164356 + -1.2366681029912785e-18i, -2.032879073410321e-18 + 1.2095630486791409e-18i, -0.03527719105463954 + -0.008081415623498187i, -4.946672411965114e-19 + -1.1722935989999517e-18i, -0.042676723817737704 + 0.010094590498138505i, -1.3552527156068805e-20 + 2.676624113323589e-18i, -0.028475370446979835 + -0.02574255954842789i }, { 0.02317148535286028 + -0.005308200515744774i, -2.202285662861181e-18 + -1.1824579943670033e-18i, 0.14392870335861815 + -3.5185748628943636e-18i, 1.4230153513872246e-18 + -3.083199928005653e-19i, 0.00896127414081535 + 0.03770399195166867i, 3.3881317890172014e-18 + 2.1955093992831465e-18i, 0.043201522339175416 + -0.09753795568842945i, 1.7618285302889447e-18 + 5.7462715141731735e-18i }, { -1.582257545471033e-18 + 2.185345003916095e-18i, -0.03527719105463954 + 0.008081415623498192i, 1.3688052427629493e-18 + 0.0i, 0.10339051591888379 + -9.351243737687476e-19i, 1.111307226797642e-18 + 2.202285662861181e-18i, -0.036841953421342805 + -0.010779450927421871i, -1.2197274440461925e-18 + -3.2390539903004445e-18i, -0.11135801743521115 + 0.026340203373948063i }, { 0.016556503786963453 + 0.0373803385919983i, -4.1335207826009857e-19 + 1.1858461261560205e-18i, 0.008961274140815347 + -0.03770399195166867i, 1.1248597539537109e-18 + -2.4191260973582818e-18i, 0.05398409757994913 + -3.1916201452542037e-18i, -6.403569081242511e-19 + -1.3552527156068805e-20i, -0.07369136185127603 + -0.016881460943400085i, -1.0164395367051604e-19 + 2.439454888092385e-18i }, { 6.979551485375435e-19 + -2.3852447794681098e-18i, -0.042676723817737704 + -0.010094590498138503i, 2.8392544391964147e-18 + -2.520770051028798e-18i, -0.036841953421342805 + 0.010779450927421868i, -7.589415207398531e-19 + -2.168404344971009e-19i, 0.12829263828713458 + -4.275822317739708e-18i, 5.149960319306146e-19 + -2.032879073410321e-18i, 0.17526718598709068 + 0.040150786748548564i }, { -0.008345739027760035 + -0.037845000771553235i, 1.6940658945086007e-20 + -2.3445871979999033e-18i, 0.04320152233917543 + 0.09753795568842946i, -9.385125055577648e-19 + 3.3881317890172014e-18i, -0.07369136185127602 + 0.016881460943400088i, 1.0299920638612292e-18 + 1.9244588561617704e-18i, 0.14086278284167478 + -4.025100565352435e-18i, -1.2061749168901237e-18 + 4.336808689942018e-19i }, { 1.81603863891322e-18 + -3.550762114890027e-18i, -0.028475370446979835 + 0.025742559548427895i, 2.2090619264392153e-18 + -5.990217002982412e-18i, -0.11135801743521116 + -0.02634020337394806i, -3.7947076036992655e-19 + -2.2768245622195593e-18i, 0.17526718598709068 + -0.04015078674854855i, -2.0735366548785272e-18 + -2.168404344971009e-19i, 0.33475891711373856 + 6.2341624917916505e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.055159077578357016, 1.0e-7), DoubleNear(0.03962326732164356, 1.0e-7), DoubleNear(0.14392870335861815, 1.0e-7), DoubleNear(0.10339051591888379, 1.0e-7), DoubleNear(0.05398409757994913, 1.0e-7), DoubleNear(0.12829263828713458, 1.0e-7), DoubleNear(0.14086278284167478, 1.0e-7), DoubleNear(0.33475891711373856, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.1360229768014472 + -7.822349267893464e-18i, -4.573977915173222e-19 + -1.5246593050577406e-20i, 0.015167063910130563 + 0.010300866519524002i, 5.149960319306146e-19 + -1.4365678785432934e-18i, -0.03299943774332201 + 0.024977387037228228i, -2.4462311516704194e-18 + 4.0318768289304696e-19i, -0.004715199627624086 + 0.0004946832472230789i, 1.285796013932028e-18 + -5.601428880192688e-18i }, { -6.2680438096818225e-19 + -6.776263578034403e-20i, 0.1726247373515736 + -2.9680034471790684e-18i, -1.7618285302889447e-19 + 1.6805133673525319e-18i, 0.002987630810625599 + 0.0022683844213638336i, 9.893344823930228e-19 + -5.149960319306146e-19i, 0.09144106127429369 + -0.04089578575966002i, 8.131516293641283e-20 + -2.3649159887340065e-18i, 0.00188439819592707 + 0.0003649971545571207i }, { 0.015167063910130566 + -0.01030086651952401i, -8.267041565201971e-19 + -1.5382118322138094e-18i, 0.10412448387281825 + 1.2188804110989382e-18i, -7.589415207398531e-19 + 6.098637220230962e-20i, -0.002380470967359198 + 0.005936056394686568i, -3.815036394433369e-18 + -4.428288248245482e-18i, -0.025857135898748308 + 0.017171955684261893i, -1.6601845766184287e-18 + -1.0503208545953324e-19i }, { 5.55653613398821e-19 + 1.734723475976807e-18i, 0.002987630810625597 + -0.002268384421363833i, -9.723938234479368e-19 + -4.54009659728305e-19i, 0.13500088479569175 + 2.7138935630027783e-18i, -5.55653613398821e-19 + -1.8634724839594607e-18i, 0.0012709391175373854 + -0.0020546991234541485i, 5.082197683525802e-19 + -1.8295911660692887e-19i, 0.07164982526327013 + -0.028115856141847303i }, { -0.03299943774332201 + -0.02497738703722822i, 6.369687763352339e-19 + 4.2012834183813297e-19i, -0.002380470967359198 + -0.005936056394686567i, -5.488773498207866e-19 + 2.15485181781494e-18i, 0.08484652898214598 + -5.36341262201423e-18i, 7.589415207398531e-19 + -9.147955830346444e-20i, 0.008579056701186302 + 0.007909040679691637i, -4.2012834183813297e-19 + 1.8973538018496328e-18i }, { -2.3005414847426797e-18 + -5.082197683525802e-20i, 0.09144106127429369 + 0.04089578575966002i, -3.291570033030211e-18 + 4.37069000783219e-18i, 0.0012709391175373867 + 0.002054699123454149i, 3.7269449679189215e-19 + 1.8295911660692887e-19i, 0.16718123797598988 + -4.538402531388541e-18i, 3.9302328752599536e-19 + -1.6263032587282567e-18i, 0.002875175560753783 + 0.002227556692441035i }, { -0.004715199627624086 + -0.0004946832472230798i, -6.860966872759833e-20 + 2.4411489539868936e-18i, -0.025857135898748308 + -0.017171955684261893i, 4.3029273720518457e-19 + -6.776263578034403e-20i, 0.008579056701186303 + -0.007909040679691639i, 1.4094628242311558e-18 + 1.4433441421213278e-18i, 0.06894067170218764 + -3.3034284942917713e-19i, 4.946672411965114e-19 + 6.776263578034403e-21i }, { 1.5043305143236374e-18 + 5.405764269376945e-18i, 0.001884398195927069 + -0.0003649971545571206i, -1.6771252355635147e-18 + -6.471331717022855e-19i, 0.07164982526327011 + 0.028115856141847296i, -5.55653613398821e-19 + -1.7211709488207383e-18i, 0.0028751755607537826 + -0.0022275566924410354i, 1.2874900798265365e-19 + 1.3552527156068805e-20i, 0.13125847851814526 + -1.0316861297557378e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.1360229768014472, 1.0e-7), DoubleNear(0.1726247373515736, 1.0e-7), DoubleNear(0.10412448387281825, 1.0e-7), DoubleNear(0.13500088479569175, 1.0e-7), DoubleNear(0.08484652898214598, 1.0e-7), DoubleNear(0.16718123797598988, 1.0e-7), DoubleNear(0.06894067170218764, 1.0e-7), DoubleNear(0.13125847851814526, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.07818949889791252 + -4.8323229640857834e-18i, 6.776263578034403e-20 + -6.776263578034403e-20i, -0.007269289199791978 + 0.034066999543476556i, 8.131516293641283e-20 + -1.3552527156068805e-20i, 0.04536813617584395 + 0.0953824431489997i, -1.3552527156068805e-20 + -1.5585406229479126e-19i, 0.02046256941404667 + 0.01569188905364674i, 2.185345003916095e-19 + 1.0842021724855044e-19i }, { 1.4907779871675686e-19 + 8.131516293641283e-20i, 0.21951205408607238 + -4.431676380034499e-18i, 2.439454888092385e-19 + 9.486769009248164e-20i, 0.007657559953807863 + -0.0039150421051587754i, 2.0328790734103208e-19 + 1.3552527156068805e-20i, 0.06979851612984206 + -0.14674512902260198i, -2.846030702774449e-19 + 1.4230153513872246e-19i, 0.009219083303263577 + 0.007069729584977388i }, { -0.007269289199791972 + -0.03406699954347657i, 3.2526065174565133e-19 + -1.0842021724855044e-19i, 0.11179876326298865 + 1.1350241493207625e-18i, -1.2874900798265365e-19 + -3.3881317890172014e-20i, 0.0373400467587962 + -0.028634520872769378i, 6.098637220230962e-20 + 5.692061405548898e-19i, 0.03554878939745301 + -0.0747381459660603i, -2.0328790734103208e-19 + -2.574980159653073e-19i }, { 2.0328790734103208e-19 + 1.2197274440461925e-19i, 0.007657559953807861 + 0.003915042105158776i, -3.9641141931501256e-19 + -1.7618285302889447e-19i, 0.09425785655890495 + -1.3976043629695956e-18i, 6.776263578034403e-20 + -1.7279472123987727e-19i, 0.005052112902951045 + -0.003874254183601429i, 1.0164395367051604e-19 + 3.6591823321385775e-19i, 0.05469152932660286 + 0.11498404224734514i }, { 0.04536813617584394 + -0.09538244314899968i, -5.963111948670274e-19 + -1.0164395367051604e-18i, 0.03734004675879621 + 0.028634520872769367i, 1.4907779871675686e-19 + -2.371692252312041e-20i, 0.14268000688568067 + -8.35343892582191e-18i, 2.337810934421869e-19 + -3.8963515573697816e-20i, 0.03101540981110884 + -0.01585709234426092i, 1.3552527156068805e-20 + 4.743384504624082e-19i }, { 8.809142651444724e-20 + -1.4907779871675686e-19i, 0.06979851612984203 + 0.14674512902260198i, -3.3881317890172014e-20 + -2.303929616531697e-19i, 0.005052112902951046 + 0.00387425418360143i, -4.0318768289304696e-19 + 3.3881317890172014e-20i, 0.12029392124149106 + -3.0747295985331102e-18i, -2.710505431213761e-20 + -4.0657581468206416e-20i, -0.001794753582428481 + 0.008410983218963644i }, { 0.020462569414046665 + -0.01569188905364674i, 2.846030702774449e-19 + 1.0079692072326174e-19i, 0.03554878939745301 + 0.0747381459660603i, -6.776263578034403e-21 + 7.453889935837843e-20i, 0.03101540981110884 + 0.015857092344260915i, 2.574980159653073e-19 + 1.3552527156068805e-20i, 0.06126639231201725 + -2.464865876510014e-19i, -1.3552527156068805e-19 + 1.0164395367051604e-19i }, { -1.4230153513872246e-19 + -4.0657581468206416e-20i, 0.009219083303263577 + -0.007069729584977387i, -2.710505431213761e-19 + -5.55653613398821e-19i, 0.05469152932660286 + -0.11498404224734513i, -2.0328790734103208e-19 + -1.0842021724855044e-19i, -0.0017947535824284812 + -0.008410983218963644i, -4.472333961502706e-19 + -2.642742795433417e-19i, 0.1720015067549321 + 3.079811796216636e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.07818949889791252, 1.0e-7), DoubleNear(0.21951205408607238, 1.0e-7), DoubleNear(0.11179876326298865, 1.0e-7), DoubleNear(0.09425785655890495, 1.0e-7), DoubleNear(0.14268000688568067, 1.0e-7), DoubleNear(0.12029392124149106, 1.0e-7), DoubleNear(0.06126639231201725, 1.0e-7), DoubleNear(0.1720015067549321, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.11162363736019115 + -6.511142265543807e-18i, 1.1756817307889689e-18 + -1.8804131429045468e-19i, 0.012000879643503465 + 0.009202972906362034i, -9.215718466126788e-19 + 2.1141942363467336e-18i, 0.033504860048525986 + -0.07564537955637549i, 1.4230153513872246e-18 + 4.512991542970912e-18i, 0.00983886744274164 + -0.0053704286167524i, -9.081463743986981e-18 + -2.5986970821761934e-18i }, { 1.0469327228063152e-18 + 8.809142651444724e-20i, 0.08018432172390938 + -2.546181039446427e-18i, 1.599198204416119e-18 + -1.1519648082658485e-18i, 0.0013834516942631799 + 0.0010609112696548825i, -1.0977546996415732e-18 + -2.459783678826488e-18i, -0.08636350265982967 + 0.020428095583417967i, -4.472333961502706e-18 + -2.270048298641525e-18i, -0.0017603457616726399 + -0.0007902134538395607i }, { 0.012000879643503468 + -0.009202972906362045i, 1.8295911660692887e-18 + 1.294266343404571e-18i, 0.08746414357678402 + 1.4306386479125133e-18i, 7.081195439045951e-19 + -2.710505431213761e-19i, -0.002634518929759272 + -0.010895142316290076i, -4.6349642873755315e-18 + 8.036648603548802e-18i, 0.026253166077612883 + -0.05927291472405227i, 1.1384122811097797e-18 + 3.3745792618611326e-18i }, { -8.605854744103691e-19 + -1.8295911660692887e-18i, 0.0013834516942631797 + -0.0010609112696548825i, 6.877907531704919e-19 + 2.0328790734103208e-20i, 0.06282946151661797 + 3.7438856268640075e-19i, -3.5914196963582334e-18 + 3.889575293791747e-18i, -0.0012197813132594538 + 0.0014951214168390861i, -6.166399856011306e-19 + -1.951563910473908e-18i, -0.06767123859311919 + 0.0160066982886686i }, { 0.033504860048526 + 0.07564537955637547i, -8.046812998915853e-19 + 2.6156377411212794e-18i, -0.00263451892975927 + 0.01089514231629007i, -3.3881317890172014e-18 + -3.8624702394796095e-18i, 0.10924586842340203 + -6.674619624363887e-18i, -8.74138001566438e-19 + 8.131516293641283e-20i, 0.0117452409678134 + 0.009006934292853605i, 1.0164395367051604e-18 + -1.6534083130403943e-18i }, { 1.7143946852427039e-18 + -4.87890977618477e-18i, -0.08636350265982967 + -0.020428095583417967i, -4.9737774662772516e-18 + -7.667342238545927e-18i, -0.0012197813132594545 + -0.001495121416839086i, -1.3010426069826053e-18 + 2.710505431213761e-20i, 0.2596216536036541 + -4.960224939121183e-18i, -1.3823577699190182e-18 + 1.2061749168901237e-18i, 0.004479354677116203 + 0.003435029844149986i }, { 0.009838867442741641 + 0.005370428616752401i, -5.061868892791699e-18 + 2.425902360936316e-18i, 0.02625316607761288 + 0.05927291472405227i, -5.47183283926278e-19 + 1.9583401740519424e-18i, 0.0117452409678134 + -0.009006934292853607i, -1.2468324983583301e-18 + -1.3891340334970526e-18i, 0.08560101199822187 + -5.421010862427522e-19i, -9.723938234479368e-19 + 3.3881317890172014e-19i }, { -9.422394505256837e-18 + 2.6969529040576923e-18i, -0.0017603457616726394 + 0.0007902134538395607i, 1.1926223897340549e-18 + -3.496552006265752e-18i, -0.06767123859311919 + -0.016006698288668603i, 8.605854744103691e-19 + 1.8431436932253575e-18i, 0.0044793546771162 + -0.0034350298441499856i, -1.531435568635775e-18 + -4.607859233063394e-19i, 0.20342990179721906 + 1.3078188705606397e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.11162363736019115, 1.0e-7), DoubleNear(0.08018432172390938, 1.0e-7), DoubleNear(0.08746414357678402, 1.0e-7), DoubleNear(0.06282946151661797, 1.0e-7), DoubleNear(0.10924586842340203, 1.0e-7), DoubleNear(0.2596216536036541, 1.0e-7), DoubleNear(0.08560101199822187, 1.0e-7), DoubleNear(0.20342990179721906, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.11541679499942456 + -1.1121542597448963e-18i, -6.098637220230962e-19 + -2.981555974335137e-19i, -0.028385565526113998 + 0.01993513824314562i, -2.032879073410321e-18 + -4.845028458294598e-19i, 0.04932796249758493 + 0.01377535652787127i, -2.100641709190665e-18 + -1.5585406229479126e-19i, -0.01546032417648674 + 0.005573367479139229i, -5.409999434113216e-18 + 8.893845946170154e-19i }, { -7.826584432629735e-19 + 9.486769009248164e-20i, 0.1593056050090777 + -2.320870275476783e-18i, 8.809142651444724e-19 + -7.250602028496811e-19i, 0.08443481194719801 + -0.036371592665542116i, -1.5788694136820158e-18 + 1.2197274440461925e-19i, 0.06318844725640968 + -0.016247851711018408i, 2.185345003916095e-18 + -9.58841296291868e-19i, 0.027980995463046627 + -0.022722312857861495i }, { -0.028385565526113998 + -0.01993513824314562i, 3.5236570605778894e-19 + 5.963111948670274e-19i, 0.07457146716147661 + -2.5851445550201246e-18i, 5.488773498207866e-19 + 1.9651164376299768e-19i, -0.008718776857526478 + -0.011742170159492334i, 2.0176324803597434e-18 + 7.657177843178875e-19i, 0.031588963075712025 + 0.006868940655068141i, 1.883801274693564e-18 + -2.574980159653073e-19i }, { -2.083701050245579e-18 + 3.6930636500287495e-19i, 0.08443481194719801 + 0.036371592665542116i, 5.353248226647178e-19 + -1.8973538018496328e-19i, 0.15446430563589966 + -3.508410467527312e-18i, -5.4786091028408146e-18 + -1.0384623933337722e-18i, 0.039019014549425995 + 0.005628631799694186i, 1.883801274693564e-18 + 2.574980159653073e-19i, 0.06130159820003522 + -0.015513235064238438i }, { 0.049327962497584935 + -0.013775356527871253i, -1.9651164376299768e-18 + -3.8624702394796095e-19i, -0.008718776857526476 + 0.011742170159492334i, -5.862315027947013e-18 + 9.639234939753938e-19i, 0.1247306656748409 + -5.491314597049629e-18i, -6.06475590234079e-19 + 3.4389537658524594e-19i, -0.030471008115956315 + 0.0222142044783445i, -2.0735366548785272e-18 + 7.826584432629735e-19i }, { -1.836367429647323e-18 + -3.5236570605778894e-19i, 0.06318844725640967 + 0.01624785171101841i, 1.5720931501039814e-18 + -5.149960319306146e-19i, 0.039019014549425975 + -0.005628631799694176i, -8.165397611531455e-19 + -6.166399856011306e-19i, 0.14832001713818768 + 2.066760391300493e-18i, 6.166399856011306e-19 + 2.710505431213761e-20i, 0.0786560745903658 + -0.03264004923596521i }, { -0.015460324176486743 + -0.0055733674791392344i, 1.843990726172612e-18 + 3.2864878353466853e-19i, 0.031588963075712025 + -0.006868940655068132i, 1.362028979184915e-18 + -5.55653613398821e-19i, -0.030471008115956315 + -0.022214204478344497i, 7.148958074826295e-19 + -2.439454888092385e-19i, 0.079215733522857 + -3.1086109164232822e-18i, 7.047314121155779e-19 + -2.812149384884277e-19i }, { -5.5091022889419694e-18 + -1.463672932855431e-18i, 0.02798099546304663 + 0.02272231285786149i, 1.6534083130403943e-18 + -3.5236570605778894e-19i, 0.06130159820003522 + 0.01551323506423843i, -1.8939656700606156e-18 + -1.0672615135404184e-18i, 0.0786560745903658 + 0.032640049235965196i, -3.3881317890172014e-20 + 3.8624702394796095e-19i, 0.14397541085823545 + -2.061678193616967e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.11541679499942456, 1.0e-7), DoubleNear(0.1593056050090777, 1.0e-7), DoubleNear(0.07457146716147661, 1.0e-7), DoubleNear(0.15446430563589966, 1.0e-7), DoubleNear(0.1247306656748409, 1.0e-7), DoubleNear(0.14832001713818768, 1.0e-7), DoubleNear(0.079215733522857, 1.0e-7), DoubleNear(0.14397541085823545, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.13561976723970356 + -3.3440860757599777e-18i, 2.0769247866675444e-18 + -6.996492144320521e-19i, 0.026995201267159517 + 0.022883647141464042i, -2.520770051028798e-18 + -2.2632720350634905e-18i, 0.026069808018561486 + -0.10043800761824424i, 7.995991022080595e-19 + 5.990217002982412e-18i, 0.017029359471921038 + 0.07576922063875115i, 3.2356658585114273e-18 + 4.141991112073529e-18i }, { 2.1412992906588713e-18 + 2.642742795433417e-19i, 0.0596185623268287 + -4.641740550953566e-19i, -1.1045309632196076e-18 + 1.3755815063409838e-18i, -0.041098568268627636 + -0.023225495586623075i, 2.710505431213761e-20 + -2.270048298641525e-18i, -0.05770766200006666 + 0.056654187492662295i, 5.014435047745458e-19 + 2.6834003769016235e-18i, -0.014707025679296095 + 0.02936939794650207i }, { 0.026995201267159513 + -0.022883647141464045i, -1.196010521523072e-18 + -1.260385025514399e-18i, 0.0634680136972716 + -1.7364175418713157e-18i, -1.9312351197398048e-19 + 2.405573570202213e-19i, -0.016312249886113628 + 0.01224672797383077i, 2.5309344463958494e-18 + 2.1819568721270777e-18i, 0.03368821810757738 + -0.034480286662183515i, 1.7618285302889447e-18 + 1.8973538018496328e-18i }, { -3.028989819381378e-18 + 2.0803129184565616e-18i, -0.041098568268627636 + 0.02322549558662308i, -4.0657581468206416e-19 + -1.5585406229479126e-19i, 0.08339522091369865 + -1.7076184216646695e-18i, 1.1655173354219173e-18 + 2.8528069663524835e-18i, -0.06138884289392664 + -0.07191820344874282i, -1.7414997395548415e-18 + -2.1412992906588713e-18i, -0.0963270792528822 + -0.020219393620575732i }, { 0.026069808018561492 + 0.10043800761824424i, -7.115076756936123e-20 + 2.337810934421869e-18i, -0.01631224988611363 + -0.012246727973830765i, 8.538092108323347e-19 + -3.1001405869507392e-18i, 0.10452769343456189 + -3.2593827810345477e-18i, -3.2932640989247197e-18 + 7.453889935837843e-19i, -0.08585177490922982 + 0.019265695580026082i, -1.5856456772600502e-18 + 2.5614276324970042e-18i }, { 1.1858461261560205e-18 + -5.9495594215142056e-18i, -0.05770766200006666 + -0.056654187492662295i, 2.846030702774449e-18 + -2.72405795836983e-18i, -0.06138884289392663 + 0.07191820344874282i, -3.74049749507499e-18 + -7.860465750519907e-19i, 0.24800705982043664 + 2.1006417091906648e-19i, 2.6020852139652106e-18 + -2.0735366548785272e-18i, 0.20418945480619144 + -0.04578614631488424i }, { 0.017029359471921027 + -0.07576922063875115i, 2.947674656444965e-19 + -2.5614276324970042e-18i, 0.03368821810757738 + 0.0344802866621835i, -1.2807138162485021e-18 + 2.236166980751353e-18i, -0.08585177490922982 + -0.01926569558002607i, 2.2632720350634905e-18 + 1.6127507315721878e-18i, 0.09031918698706201 + -3.957337929572091e-18i, 1.446732273910345e-18 + -3.2526065174565133e-19i }, { 3.3068166260807885e-18 + -5.163512846462215e-18i, -0.014707025679296097 + -0.02936939794650207i, 1.7211709488207383e-18 + -2.425902360936316e-18i, -0.0963270792528822 + 0.020219393620575725i, -9.486769009248164e-19 + -2.778268066994105e-18i, 0.20418945480619144 + 0.04578614631488424i, 9.0801931945661e-19 + 3.5236570605778894e-19i, 0.21504449558043648 + -3.8624702394796095e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.13561976723970356, 1.0e-7), DoubleNear(0.0596185623268287, 1.0e-7), DoubleNear(0.0634680136972716, 1.0e-7), DoubleNear(0.08339522091369865, 1.0e-7), DoubleNear(0.10452769343456189, 1.0e-7), DoubleNear(0.24800705982043664, 1.0e-7), DoubleNear(0.09031918698706201, 1.0e-7), DoubleNear(0.21504449558043648, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.09601678965551744 + -6.750852589616774e-19i, 9.9272261418204e-19 + 2.0328790734103208e-20i, 0.04089401805129686 + 0.01043327160138745i, 1.883801274693564e-18 + -4.54009659728305e-19i, 0.028820321356632064 + -0.06506889283529654i, 2.574980159653073e-19 + 3.984442983884229e-18i, 0.01934516015603711 + -0.024581515860917787i, 3.364414866494081e-18 + 9.615518017230817e-18i }, { 7.962109704190423e-19 + -6.776263578034403e-20i, 0.07404056811592609 + -1.74319380544935e-18i, 2.2429432443293873e-18 + 5.014435047745458e-19i, 0.029376028030940797 + -0.007494692222034097i, -1.3484764520288461e-18 + -2.188733135705112e-18i, -0.07974629782904802 + 0.018862887033335184i, -1.463672932855431e-18 + -5.597193715456417e-18i, -0.02973043027181383 + 0.015556210407620504i }, { 0.04089401805129687 + -0.01043327160138744i, 2.3987973066241786e-18 + -8.605854744103691e-19i, 0.10307099128145773 + -4.405418358669616e-18i, 8.91078660511524e-19 + -4.79420648145934e-19i, 0.00520427012653564 + -0.030844800468366254i, 3.211948935988307e-18 + 1.0028870095490916e-17i, 0.03093770476950681 + -0.0698494014451312i, 2.303929616531697e-18 + 3.903127820947816e-18i }, { 2.120970499924768e-18 + 3.9302328752599536e-19i, 0.029376028030940794 + 0.007494692222034088i, 9.385125055577648e-19 + 1.7618285302889447e-19i, 0.06897321512460126 + -4.2859867131067597e-19i, -1.1519648082658485e-18 + -5.068645156369733e-18i, -0.0335491889964227 + -0.0005882891089038916i, -3.6591823321385775e-19 + -2.222614453595284e-18i, -0.07428844342390084 + 0.017571906838751386i }, { 0.028820321356632067 + 0.06506889283529654i, -1.3061248046661311e-18 + 2.0803129184565616e-18i, 0.005204270126535642 + 0.030844800468366254i, -1.4501204056993622e-18 + 5.0550926292136644e-18i, 0.09397147250538374 + -3.0222135558033436e-18i, -1.0537089863843496e-18 + -1.2197274440461925e-19i, 0.04002290752200009 + 0.010211025581551961i, -2.100641709190665e-18 + 4.0657581468206416e-20i }, { 2.574980159653073e-19 + -4.472333961502706e-18i, -0.07974629782904802 + -0.018862887033335184i, 2.8663594935085523e-18 + -9.930614273609417e-18i, -0.0335491889964227 + 0.0005882891089038916i, -1.043544591017298e-18 + -2.710505431213761e-20i, 0.23972934252905126 + -4.086086937554745e-18i, -1.938011383317839e-18 + -1.2197274440461925e-19i, 0.09511401742550411 + -0.02426639455322275i }, { 0.0193451601560371 + 0.024581515860917794i, -1.328147661294743e-18 + 5.597193715456417e-18i, 0.03093770476950681 + 0.0698494014451312i, -4.573977915173222e-20 + 2.4936649967166602e-18i, 0.04002290752200009 + -0.010211025581551944i, -3.0018847650692404e-18 + -8.131516293641283e-20i, 0.10087540791624017 + -4.194507154803295e-18i, -7.928228386300251e-19 + 5.421010862427522e-19i }, { 3.0831999280056532e-18 + -9.10391011708922e-18i, -0.029730430271813824 + -0.015556210407620504i, 2.6495190590114515e-18 + -3.903127820947816e-18i, -0.07428844342390084 + -0.017571906838751386i, -2.303929616531697e-18 + -1.0977546996415732e-18i, 0.0951140174255041 + 0.024266394553222756i, -1.7889335846010823e-18 + -4.0657581468206416e-19i, 0.22332221287182186 + 4.336808689942018e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.09601678965551744, 1.0e-7), DoubleNear(0.07404056811592609, 1.0e-7), DoubleNear(0.10307099128145773, 1.0e-7), DoubleNear(0.06897321512460126, 1.0e-7), DoubleNear(0.09397147250538374, 1.0e-7), DoubleNear(0.23972934252905126, 1.0e-7), DoubleNear(0.10087540791624017, 1.0e-7), DoubleNear(0.22332221287182186, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.0819042497191465 + -4.647669781584346e-18i, 0.0008236829246794726 + 0.007583248383144324i, -0.006281743574381127 + 0.0002846622523603481i, 0.0002949713665746954 + 0.004129164566969585i, 0.062739011330463 + 0.01459187891222646i, -0.0034505938286897445 + 0.026065876552138822i, -0.003936832066476723 + -0.00047289434023205343i, 0.0003847394514610759 + -0.0038618318215703443i }, { 0.0008236829246794711 + -0.007583248383144325i, 0.0577014634399724 + -2.605473345754228e-18i, 0.000598457443833031 + -0.004096200290041602i, -0.019407830024679266 + -0.00019964264545329927i, 0.008966581214784122 + -0.02471713857873951i, -0.018300828044749792 + -0.0052235233127815766i, -0.0012049192614081014 + 0.003689165086722421i, 0.008113093976585118 + 0.0020638925445229245i }, { -0.006281743574381127 + -0.0002846622523603483i, 0.0005984574438330317 + 0.004096200290041601i, 0.08148516319205328 + -6.750852589616774e-19i, 0.0008684075870943359 + 0.007995006614111864i, -0.0024225349331256905 + -0.0009839304887784394i, 0.0004950889152516581 + -0.0036235305817572654i, 0.06257850649842552 + 0.01411627262148812i, -0.002632433018824216 + 0.025687013199459888i }, { 0.00029497136657469485 + -0.004129164566969585i, -0.019407830024679266 + 0.0001996426454533009i, 0.0008684075870943368 + -0.007995006614111863i, 0.055968204415912104 + -2.337810934421869e-18i, -0.001261530948877515 + 0.0034327287361455485i, 0.00883788590322969 + 0.0018192940000679794i, 0.00808615704061069 + -0.024522773395813227i, -0.017546571350103336 + -0.0029885175235379404i }, { 0.06273901133046302 + -0.014591878912226457i, 0.008966581214784124 + 0.02471713857873951i, -0.00242253493312569 + 0.0009839304887784394i, -0.0012615309488775146 + -0.0034327287361455485i, 0.21427099998268215 + 3.288181901241194e-18i, 0.0020900286811830204 + 0.01924187832772423i, -0.01639119519733886 + 0.0014968638378172788i, 0.0003677057026198458 + 0.010818049931865557i }, { -0.003450593828689747 + -0.026065876552138822i, -0.018300828044749785 + 0.005223523312781576i, 0.0004950889152516582 + 0.0036235305817572654i, 0.008837885903229687 + -0.0018192940000679788i, 0.0020900286811830248 + -0.01924187832772423i, 0.1528583908677107 + -2.439454888092385e-18i, 0.0019635524668545497 + -0.010644711058642455i, -0.05064159759539889 + -0.0010497979763292552i }, { -0.003936832066476723 + 0.0004728943402320537i, -0.0012049192614081018 + -0.0036891650867224212i, 0.06257850649842552 + -0.014116272621488107i, 0.008086157040610685 + 0.02452277339581322i, -0.016391195197338865 + -0.001496863837817279i, 0.0019635524668545523 + 0.010644711058642455i, 0.21206728149833537 + -4.462169566135654e-18i, 0.002325208193999672 + 0.021407061806560424i }, { 0.00038473945146107636 + 0.003861831821570345i, 0.008113093976585118 + -0.0020638925445229245i, -0.002632433018824211 + -0.025687013199459888i, -0.01754657135010334 + 0.002988517523537939i, 0.00036770570261984383 + -0.010818049931865557i, -0.05064159759539889 + 0.0010497979763292621i, 0.002325208193999671 + -0.02140706180656042i, 0.14374424688418716 + -4.241940999849536e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.0819042497191465, 1.0e-7), DoubleNear(0.0577014634399724, 1.0e-7), DoubleNear(0.08148516319205328, 1.0e-7), DoubleNear(0.055968204415912104, 1.0e-7), DoubleNear(0.21427099998268215, 1.0e-7), DoubleNear(0.1528583908677107, 1.0e-7), DoubleNear(0.21206728149833537, 1.0e-7), DoubleNear(0.14374424688418716, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.17138197677812303 + -5.017823179534475e-18i, 0.0010654964629540162 + 0.009809508110279721i, -0.012712160854037906 + 0.008231150206230104i, -0.0034837237575091715 + 0.008799291329483216i, 0.005417575405750771 + 0.00043207662143023224i, 0.0029136493682576647 + -0.0017450143496289187i, -0.0488047115064291 + -0.037426292991749474i, 0.001838771398713997 + -0.003026151325222496i }, { 0.0010654964629540188 + -0.009809508110279721i, 0.1400738333148752 + -8.11118750290718e-18i, 0.005291726681387464 + -0.00784611291336318i, -0.039274996532448474 + -0.00577276610674412i, -0.0032203626377375286 + 0.0010787456618792624i, 0.009923748526370173 + 0.010220769679736239i, -0.002445617561457397 + 0.002560786371989205i, -0.039889042903167006 + -0.030589239456066303i }, { -0.012712160854037906 + -0.008231150206230104i, 0.005291726681387466 + 0.007846112913363183i, 0.15926388199980668 + -3.031530918223141e-18i, 0.0023587322580311642 + 0.021715701571627843i, -0.0453538228495141 + -0.03477995074385826i, 0.004070562000053148 + -0.006699112570206553i, 0.0018225481447886201 + 0.005120071458847984i, 0.00020649619844044552 + -0.0033899538406280405i }, { -0.0034837237575091728 + -0.008799291329483216i, -0.03927499653244848 + 0.005772766106744127i, 0.0023587322580311655 + -0.021715701571627843i, 0.08995578901835173 + -4.531626267810507e-18i, -0.00541396169164562 + 0.005668915507040994i, -0.025616849647251114 + -0.01964449109175284i, -0.0009295185261511496 + 0.0032665613465999574i, 0.012445054905786679 + 0.006932930553006054i }, { 0.005417575405750769 + -0.0004320766214302333i, -0.003220362637737531 + -0.0010787456618792642i, -0.04535382284951411 + 0.034779950743858264i, -0.005413961691645619 + -0.005668915507040993i, 0.1247932729237056 + 3.658335299191323e-18i, 0.0018482151429084766 + 0.017015618600588835i, -0.009960777917682082 + -0.006449624116052478i, 0.004146400826703712 + 0.006147923169351928i }, { 0.0029136493682576656 + 0.001745014349628921i, 0.009923748526370176 + -0.010220769679736244i, 0.004070562000053149 + 0.006699112570206555i, -0.02561684964725111 + 0.01964449109175285i, 0.0018482151429084774 + -0.017015618600588835i, 0.07048602099280787 + 3.0662592690605672e-18i, -0.0027297167706998825 + -0.006894798435320876i, -0.03077443108762968 + 0.004523325484961565i }, { -0.048804711506429115 + 0.037426292991749474i, -0.0024456175614574046 + -0.0025607863719892075i, 0.0018225481447886212 + -0.005120071458847984i, -0.0009295185261511503 + -0.0032665613465999582i, -0.009960777917682082 + 0.006449624116052478i, -0.002729716770699882 + 0.006894798435320874i, 0.13428856269058195 + -2.1057239068741906e-18i, 0.0008348835230628434 + 0.007686366849044439i }, { 0.001838771398714004 + 0.0030261513252224917i, -0.03988904290316703 + 0.030589239456066293i, 0.00020649619844044574 + 0.00338995384062804i, 0.01244505490578668 + -0.006932930553006056i, 0.004146400826703712 + -0.006147923169351926i, -0.030774431087629676 + -0.004523325484961564i, 0.000834883523062843 + -0.007686366849044441i, 0.10975666228174755 + -2.0481256664608982e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.17138197677812303, 1.0e-7), DoubleNear(0.1400738333148752, 1.0e-7), DoubleNear(0.15926388199980668, 1.0e-7), DoubleNear(0.08995578901835173, 1.0e-7), DoubleNear(0.1247932729237056, 1.0e-7), DoubleNear(0.07048602099280787, 1.0e-7), DoubleNear(0.13428856269058195, 1.0e-7), DoubleNear(0.10975666228174755, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.15195473045073174 + 1.7025362239811437e-19i, 0.0008737750785419618 + 0.008044422499305487i, -0.01209265918993084 + 0.0008930734412130381i, 0.00048806763272089034 + 0.009605273496331057i, 0.07316460419222541 + -0.030302554527578615i, 0.018253391060985988 + 0.02807893223168523i, -0.0033552235907977758 + 0.0018453729400444358i, -0.0032084044934689677 + -0.003927044213258417i }, { 0.0008737750785419635 + -0.008044422499305485i, 0.12628005534410672 + -2.5309344463958494e-18i, 0.0015856090495875007 + -0.009486059924715629i, -0.042558723284646535 + -0.0008583897182958051i, -0.011799034807234932 + -0.03134318902272891i, -0.021661572421775306 + 0.017655286473383436i, 0.00229042786391728 + 0.0045243204845357285i, 0.010131514757554715 + -0.006929696634799396i }, { -0.01209265918993084 + -0.0008930734412130386i, 0.0015856090495875027 + 0.009486059924715627i, 0.15047393380785867 + -9.325832749269847e-19i, 0.0010689482883198406 + 0.009841287388858816i, -0.004053554459971777 + 0.0007882312969548296i, -0.0030419595730875036 + -0.004003296275449685i, 0.07283258004413615 + -0.03014781446223986i, 0.017600811041486926 + 0.027549922481247872i }, { 0.0004880676327208886 + -0.009605273496331057i, -0.042558723284646535 + 0.0008583897182958105i, 0.0010689482883198419 + -0.009841287388858816i, 0.1190643632188337 + -3.564314642046096e-18i, 0.0021114929392972246 + 0.004563057821310837i, 0.009616684659220552 + -0.007435679054864842i, -0.011275254277627086 + -0.030686404465426503i, -0.020101298919092736 + 0.015932783336417837i }, { 0.07316460419222541 + 0.030302554527578615i, -0.011799034807234928 + 0.03134318902272891i, -0.004053554459971777 + -0.0007882312969548301i, 0.0021114929392972246 + -0.004563057821310838i, 0.1442205192510969 + -1.5297415027412664e-18i, 0.002039936527320531 + 0.018780704211563068i, -0.01058027958178915 + 0.0008884526489645884i, 0.00017460943647365067 + 0.005341941002504085i }, { 0.018253391060985984 + -0.028078932231685238i, -0.021661572421775306 + -0.017655286473383432i, -0.003041959573087503 + 0.004003296275449686i, 0.009616684659220553 + 0.0074356790548648416i, 0.0020399365273205323 + -0.018780704211563068i, 0.08427979896357635 + -2.5139937874507634e-18i, 0.0009764008611000799 + -0.005254851423968429i, -0.027490704335431618 + -0.00039105090348674944i }, { -0.0033552235907977753 + -0.001845372940044436i, 0.00229042786391728 + -0.004524320484535728i, 0.07283258004413615 + 0.030147814462239853i, -0.011275254277627083 + 0.0306864044654265i, -0.010580279581789148 + -0.0008884526489645889i, 0.0009764008611000811 + 0.005254851423968429i, 0.14307851088252999 + -4.204671550170347e-18i, 0.0021246674927741667 + 0.01956078103181347i }, { -0.0032084044934689677 + 0.003927044213258417i, 0.010131514757554715 + 0.006929696634799394i, 0.017600811041486926 + -0.02754992248124788i, -0.02010129891909274 + -0.015932783336417837i, 0.00017460943647364997 + -0.005341941002504085i, -0.027490704335431618 + 0.0003910509034867524i, 0.0021246674927741667 + -0.019560781031813468i, 0.08064808808126557 + -3.0154372922253092e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.15195473045073174, 1.0e-7), DoubleNear(0.12628005534410672, 1.0e-7), DoubleNear(0.15047393380785867, 1.0e-7), DoubleNear(0.1190643632188337, 1.0e-7), DoubleNear(0.1442205192510969, 1.0e-7), DoubleNear(0.08427979896357635, 1.0e-7), DoubleNear(0.14307851088252999, 1.0e-7), DoubleNear(0.08064808808126557, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.15327725923495483 + -6.369687763352339e-19i, 0.00194516636092384 + 0.017908201347214322i, -0.011535221375830192 + 0.0033167142738684497i, 0.00011437221224941011 + 0.007056624529092432i, 0.06083646093523011 + -0.015351096527064886i, 0.013896730742690613 + 0.004065630526068084i, 0.00251885792502856 + 0.0009538523161210376i, -0.0010973290938661115 + 0.0037120550434457267i }, { 0.0019451663609238391 + -0.01790820134721432i, 0.09612122952947272 + 3.012049160436292e-18i, 0.0014033833975701888 + -0.006916613751464528i, -0.03383379862433565 + 0.0012597025123172669i, -0.012699737391861775 + -0.006954505524268988i, 0.04325046189380494 + 0.027091706445882817i, 0.001868732922397748 + -0.0033898851087555523i, -0.008814460660003864 + -0.0037794071950651713i }, { -0.011535221375830192 + -0.0033167142738684497i, 0.001403383397570189 + 0.006916613751464528i, 0.15095937426494338 + -5.310049546337209e-18i, 0.0016185570074864607 + 0.014901267760072702i, -0.01183321727991216 + 0.00022197656013334496i, -0.0008162235313927194 + 0.002665886791946728i, 0.06029771850222858 + -0.01237389075132641i, 0.001248287881255381 + 0.005975055266154187i }, { 0.00011437221224941011 + -0.007056624529092434i, -0.03383379862433565 + -0.0012597025123172647i, 0.0016185570074864623 + -0.0149012677600727i, 0.1034003097765076 + -6.591610395532965e-18i, 0.0013695660729743475 + -0.0024284690676294107i, -0.019962820839610936 + -0.0032661195678614367i, 6.369400719922948e-05 + -0.006103724366444865i, 0.04102232969847823 + -0.010483508759808947i }, { 0.0608364609352301 + 0.01535109652706489i, -0.012699737391861768 + 0.006954505524268981i, -0.011833217279912161 + -0.0002219765601333454i, 0.0013695660729743466 + 0.0024284690676294116i, 0.1428979904668738 + -7.225191040079182e-19i, 0.0009685452449386528 + 0.008916925363654236i, -0.011137717395889797 + -0.0015351881836908235i, 0.0005483048569451309 + 0.00789058996974271i }, { 0.013896730742690606 + -0.00406563052606808i, 0.043250461893804944 + -0.027091706445882806i, -0.0008162235313927175 + -0.002665886791946729i, -0.019962820839610936 + 0.0032661195678614294i, 0.0009685452449386574 + -0.008916925363654238i, 0.11443862477821035 + -8.056977394282905e-18i, 0.0011586265131173922 + -0.007824297597219528i, -0.036215628995742516 + -0.0025091431340998217i }, { 0.0025188579250285605 + -0.0009538523161210357i, 0.001868732922397751 + 0.0033898851087555545i, 0.06029771850222858 + 0.01237389075132641i, 6.369400719922688e-05 + 0.006103724366444862i, -0.011137717395889798 + 0.0015351881836908221i, 0.0011586265131173948 + 0.007824297597219528i, 0.14259307042544528 + 1.7279472123987727e-19i, 0.0015750587736075466 + 0.014500800660599587i }, { -0.0010973290938661132 + -0.003712055043445729i, -0.00881446066000387 + 0.003779407195065183i, 0.0012482878812553784 + -0.005975055266154183i, 0.04102232969847823 + 0.010483508759808953i, 0.0005483048569451285 + -0.007890589969742708i, -0.0362156289957425 + 0.0025091431340998277i, 0.0015750587736075464 + -0.014500800660599585i, 0.09631214152359166 + 1.1858461261560205e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.15327725923495483, 1.0e-7), DoubleNear(0.09612122952947272, 1.0e-7), DoubleNear(0.15095937426494338, 1.0e-7), DoubleNear(0.1034003097765076, 1.0e-7), DoubleNear(0.1428979904668738, 1.0e-7), DoubleNear(0.11443862477821035, 1.0e-7), DoubleNear(0.14259307042544528, 1.0e-7), DoubleNear(0.09631214152359166, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.07409597279990932 + -1.122318655111948e-18i, -0.0008851937849787854 + -0.008149548980053909i, -0.006893122588059552 + 0.0003887378003006479i, 0.0006242365382892701 + 0.008849179063939233i, -0.0689366111482357 + 0.011517909893688442i, -0.02636040831273104 + -0.026104672574990006i, 0.003283672834433693 + 0.0004423033966041654i, 0.007591043738494785 + 0.003559091528723407i }, { -0.0008851937849787843 + 0.008149548980053909i, 0.1001061708404122 + -1.921070724372753e-18i, 0.001290278926148004 + -0.008776834375453043i, -0.03502082028919815 + -0.0006741366271048093i, 0.020140871174025993 + 0.03115558320771135i, 0.02243964761179547 + -0.06268911012346845i, -0.006649860978822975 + -0.005105920731063024i, -0.010544005571576639 + 0.02316802434631221i }, { -0.006893122588059552 + -0.00038873780030064764i, 0.0012902789261480057 + 0.008776834375453043i, 0.07323645514457455 + -1.3560997485541348e-18i, -0.0007291991270426893 + -0.0067133819767943165i, 0.0035924689564520848 + 0.0014432308202278095i, 0.007413542430022787 + 0.003364499570893335i, -0.06863247685159407 + 0.011719802674110612i, -0.025213489849607355 + -0.025629750666359703i }, { 0.0006242365382892688 + -0.008849179063939235i, -0.035020820289198146 + 0.0006741366271048141i, -0.0007291991270426889 + 0.0067133819767943165i, 0.09466296539260645 + -2.8528069663524835e-18i, -0.006518278914432495 + -0.004877756525079371i, -0.009560572634039317 + 0.02367571467430909i, 0.019122667731722127 + 0.030445488474290794i, 0.02085272526122431 + -0.0590321028526718i }, { -0.06893661114823571 + -0.011517909893688439i, 0.020140871174025986 + -0.031155583207711352i, 0.0035924689564520848 + -0.001443230820227809i, -0.006518278914432495 + 0.004877756525079373i, 0.2220792769019193 + -2.371692252312041e-19i, 0.003798905390841278 + 0.03497467569092247i, -0.015779816183660436 + 0.0013927882898769786i, 3.844053090527096e-05 + 0.006098035434895909i }, { -0.02636040831273104 + 0.02610467257499001i, 0.022439647611795475 + 0.06268911012346845i, 0.007413542430022788 + -0.003364499570893336i, -0.009560572634039319 + -0.023675714674309088i, 0.0037989053908412808 + -0.03497467569092246i, 0.11045368346727086 + -3.1238575094738597e-18i, 0.0012717309845395768 + -0.005964076973231015i, -0.03502860733088001 + -0.0005753039946777452i }, { 0.003283672834433693 + -0.00044230339660416564i, -0.0066498609788229746 + 0.005105920731063025i, -0.06863247685159407 + -0.011719802674110612i, 0.019122667731722123 + -0.030445488474290794i, -0.015779816183660436 + -0.0013927882898769801i, 0.0012717309845395783 + 0.005964076973231014i, 0.2203159895458141 + -3.781155076543197e-18i, 0.003922814908136696 + 0.03611545039746661i }, { 0.007591043738494785 + -0.0035590915287234074i, -0.010544005571576639 + -0.023168024346312203i, -0.025213489849607355 + 0.025629750666359707i, 0.020852725261224312 + 0.0590321028526718i, 3.8440530905269824e-05 + -0.006098035434895908i, -0.03502860733088001 + 0.0005753039946777488i, 0.003922814908136698 + -0.0361154503974666i, 0.10504948590749282 + -3.7269449679189215e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.07409597279990932, 1.0e-7), DoubleNear(0.1001061708404122, 1.0e-7), DoubleNear(0.07323645514457455, 1.0e-7), DoubleNear(0.09466296539260645, 1.0e-7), DoubleNear(0.2220792769019193, 1.0e-7), DoubleNear(0.11045368346727086, 1.0e-7), DoubleNear(0.2203159895458141, 1.0e-7), DoubleNear(0.10504948590749282, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.0874121573910783 + -3.0247546546451065e-18i, 0.0009052562188684116 + 0.008334254058667766i, 0.06694104964644546 + 0.02704331624053094i, -0.007967187324369032 + 0.028157362399208637i, 0.001577348482084392 + 0.002034451530774453i, 0.0012197933077909425 + -0.001177372508732672i, 0.0007704094360698555 + 0.001054424668542345i, -0.0011148832003045903 + 0.0010163386736502837i }, { 0.0009052562188684122 + -0.008334254058667768i, 0.060812452411530035 + -3.6845933205562065e-18i, 0.013826894799303178 + -0.025790116543958422i, -0.01914866001306679 + -0.007735810404091441i, -0.0014441336619076621 + 0.0008880201037117347i, 0.004873314370046647 + 0.006285562127010109i, 0.0013070954817847313 + -0.000753266388057083i, -0.002053536908760895 + -0.002810583402775643i }, { 0.06694104964644546 + -0.027043316240530944i, 0.01382689479930318 + 0.025790116543958422i, 0.24323370138685144 + -5.0245994431125096e-18i, 0.002518972502116769 + 0.0231909556232398i, 0.0012125796752854704 + 0.0007061586475962614i, -0.0006597460802644757 + 0.001480718815886348i, 0.005662775068454999 + 0.003517696549503763i, 0.001900352258907167 + -0.003957595681524286i }, { -0.007967187324369034 + -0.028157362399208637i, -0.01914866001306679 + 0.007735810404091446i, 0.002518972502116772 + -0.0231909556232398i, 0.16921716992169689 + -8.95822045016148e-18i, 0.0009622770397138556 + -0.0013045366997458323i, -0.003232147740446718 + -0.0018822755516562939i, -0.002705747501981015 + 0.003457286904767486i, 0.017495489062110205 + 0.010868138105732183i }, { 0.0015773484820843918 + -0.0020344515307744535i, -0.0014441336619076635 + -0.0008880201037117352i, 0.0012125796752854693 + -0.0007061586475962616i, 0.000962277039713856 + 0.0013045366997458327i, 0.0759772555201215 + -2.298000385900917e-18i, 0.000786834292905397 + 0.007244000938588421i, 0.05837646818244305 + 0.0016648352931836379i, 0.0018841604768550712 + 0.02359552735239007i }, { 0.0012197933077909432 + 0.001177372508732673i, 0.004873314370046648 + -0.006285562127010114i, -0.0006597460802644766 + -0.0014807188158863485i, -0.003232147740446719 + 0.0018822755516562965i, 0.0007868342929053956 + -0.007244000938588423i, 0.05285721544435447 + -1.2586909596198903e-18i, 0.003225843456091634 + -0.023449795430594306i, -0.016698739381786336 + -0.0004762304322280758i }, { 0.0007704094360698548 + -0.0010544246685423445i, 0.0013070954817847313 + 0.0007532663880570832i, 0.005662775068454997 + -0.003517696549503763i, -0.0027057475019810167 + -0.0034572869047674874i, 0.05837646818244306 + -0.0016648352931836283i, 0.0032258434560916292 + 0.023449795430594306i, 0.18310458009416605 + 3.850611778218049e-18i, 0.0018962643730659231 + 0.017457984511044855i }, { -0.0011148832003045907 + -0.0010163386736502837i, -0.002053536908760895 + 0.0028105834027756437i, 0.0019003522589071675 + 0.003957595681524288i, 0.01749548906211021 + -0.010868138105732186i, 0.0018841604768550756 + -0.023595527352390074i, -0.016698739381786332 + 0.00047623043222807236i, 0.0018962643730659244 + -0.01745798451104485i, 0.12738546783020094 + 2.2768245622195593e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.0874121573910783, 1.0e-7), DoubleNear(0.060812452411530035, 1.0e-7), DoubleNear(0.24323370138685144, 1.0e-7), DoubleNear(0.16921716992169689, 1.0e-7), DoubleNear(0.0759772555201215, 1.0e-7), DoubleNear(0.05285721544435447, 1.0e-7), DoubleNear(0.18310458009416605, 1.0e-7), DoubleNear(0.12738546783020094, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.07699413092035531 + -1.2095630486791409e-18i, 0.00153635394111725 + 0.014144464078150374i, 0.04932937958327047 + 0.07253980500200785i, -0.03210763135091795 + 0.022460017763176826i, 0.040449845659108995 + 0.0375622468095516i, -0.016537900792704292 + 0.018287794920886023i, 0.1192676166881565 + 0.02732222016736501i, -0.0026394335037863634 + 0.022455648240966762i }, { 0.0015363539411172504 + -0.014144464078150374i, 0.03185049011889404 + -2.0972535774016476e-18i, 0.03618111642866649 + -0.015042579661213267i, -0.010517489760607259 + -0.03643578726893941i, 0.020078691745646863 + -0.014310546582189177i, -0.011570782743894916 + -0.020870730636312576i, 0.007399205989199726 + -0.021365263814714167i, 0.04933794305386309 + 0.01130249920434962i }, { 0.04932937958327047 + -0.07253980500200784i, 0.03618111642866649 + 0.015042579661213265i, 0.2254345333382351 + 4.472333961502706e-19i, 0.0004063694257445522 + 0.003741245810013928i, 0.13383045243809696 + -0.03065832275472021i, 0.0007500400366738172 + 0.002165746335285915i, 0.10554733857725256 + -0.09801261579937007i, 0.052392102895177206 + 0.037341059792047084i }, { -0.032107631350917945 + -0.02246001776317682i, -0.010517489760607259 + 0.03643578726893941i, 0.0004063694257445548 + -0.003741245810013928i, 0.21349392844404635 + -3.9979955110402976e-18i, -0.0002675531408191669 + -0.0022762760294515773i, 0.12674184657230347 + -0.029034441473925608i, -0.04315298083050888 + -0.047719046905966234i, -0.03019208859697313 + 0.05445880044611385i }, { 0.040449845659108995 + -0.0375622468095516i, 0.020078691745646863 + 0.014310546582189172i, 0.13383045243809696 + 0.03065832275472022i, -0.0002675531408191734 + 0.002276276029451574i, 0.08639528199084445 + -4.1131919918668824e-18i, 0.00015573657065655832 + 0.001433790919105813i, 0.07598813824561804 + -0.043831653468293263i, 0.026024604503403992 + 0.029292871988421888i }, { -0.016537900792704292 + -0.018287794920886023i, -0.011570782743894913 + 0.02087073063631258i, 0.0007500400366738224 + -0.0021657463352859133i, 0.1267418465723035 + 0.029034441473925594i, 0.00015573657065655767 + -0.0014337909191058148i, 0.08181917773699046 + -2.846030702774449e-18i, -0.01912837817327168 + -0.034197332313339456i, -0.02532990963424587 + 0.028223746432619896i }, { 0.11926761668815647 + -0.027322220167365005i, 0.007399205989199723 + 0.02136526381471417i, 0.10554733857725256 + 0.09801261579937007i, -0.04315298083050888 + 0.047719046905966234i, 0.07598813824561804 + 0.04383165346829328i, -0.019128378173271683 + 0.034197332313339456i, 0.20090374814278245 + -1.6212210610447308e-18i, 0.00400886744943814 + 0.036907694324270726i }, { -0.0026394335037863616 + -0.022455648240966766i, 0.049337943053863076 + -0.01130249920434962i, 0.052392102895177206 + -0.037341059792047084i, -0.03019208859697313 + -0.05445880044611385i, 0.026024604503403992 + -0.029292871988421895i, -0.025329909634245865 + -0.028223746432619892i, 0.004008867449438142 + -0.036907694324270726i, 0.08310870930785144 + -2.6834003769016235e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.07699413092035531, 1.0e-7), DoubleNear(0.03185049011889404, 1.0e-7), DoubleNear(0.2254345333382351, 1.0e-7), DoubleNear(0.21349392844404635, 1.0e-7), DoubleNear(0.08639528199084445, 1.0e-7), DoubleNear(0.08181917773699046, 1.0e-7), DoubleNear(0.20090374814278245, 1.0e-7), DoubleNear(0.08310870930785144, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.08319234293414449 + -3.4567414577447997e-18i, 0.000927545457710986 + 0.008539460248270672i, 0.06398676518498894 + 0.01828921048145267i, -0.003716952563559723 + 0.026189218518768514i, 0.03356132440441735 + -0.0044300543050379655i, 0.002567074307041185 + 0.0029588020943216928i, 0.037381340060808635 + 0.0019685714656957403i, -0.0003243021598992881 + 0.012628373867881362i }, { 0.0009275454577109862 + -0.008539460248270674i, 0.05593769942440614 + -3.376273327755641e-18i, 0.00925321028128796 + -0.024780415704217483i, -0.017350882053931357 + -0.0024086529854546604i, -0.001871939933577938 + -0.0034409622515089743i, 0.023348542172234053 + 0.002653751178290254i, 0.0030281065842571514 + -0.01226423943635653i, -0.0023424411799416677 + -0.003381222465332668i }, { 0.06398676518498894 + -0.018289210481452666i, 0.009253210281287956 + 0.024780415704217476i, 0.22104429056575375 + -2.490276864927643e-18i, 0.0026361779106993145 + 0.024270008859016347i, 0.014100843447586688 + -0.00982513743511056i, 0.003977396041350155 + 0.007964202908571458i, 0.08757285503304132 + -0.02329493297335333i, 0.01257794431690481 + 0.007081883697900577i }, { -0.0037169525635597214 + -0.026189218518768514i, -0.017350882053931357 + 0.0024086529854546587i, 0.0026361779106993145 + -0.024270008859016347i, 0.14358383988157414 + -2.0328790734103208e-19i, -0.0021746900789815955 + -0.008632434783942763i, -0.012384170278038707 + -7.601597010786602e-06i, -0.010764103451084608 + -0.009617267639204879i, 0.060924249420049106 + 0.013954446507783616i }, { 0.03356132440441735 + 0.004430054305037975i, -0.001871939933577937 + 0.0034409622515089756i, 0.014100843447586709 + 0.009825137435110556i, -0.002174690078981595 + 0.008632434783942768i, 0.0801970699770553 + -1.8660135828012236e-18i, 0.0007645450540628225 + 0.007038794748985515i, 0.06133075264389956 + 0.010418941052261908i, -0.002366074283954238 + 0.02556367123283019i }, { 0.0025670743070411854 + -0.0029588020943216936i, 0.023348542172234053 + -0.0026537511782902473i, 0.003977396041350156 + -0.007964202908571461i, -0.012384170278038707 + 7.601597010788337e-06i, 0.0007645450540628219 + -0.007038794748985515i, 0.05773196843147835 + -1.5670109524204556e-18i, 0.007799527974106853 + -0.02445949627033525i, -0.018496517340921774 + -0.005803387850864856i }, { 0.03738134006080863 + -0.0019685714656957542i, 0.003028106584257154 + 0.012264239436356527i, 0.08757285503304132 + 0.023294932973353322i, -0.0107641034510846 + 0.009617267639204868i, 0.061330752643899575 + -0.010418941052261897i, 0.007799527974106849 + 0.024459496270335248i, 0.2052939909152638 + 1.3162892000331827e-18i, 0.0017790589644833769 + 0.016378931275268307i }, { -0.00032430215989929243 + -0.012628373867881366i, -0.0023424411799416655 + 0.0033812224653326697i, 0.0125779443169048 + -0.00708188369790057i, 0.06092424942004912 + -0.013954446507783607i, -0.002366074283954237 + -0.02556367123283019i, -0.018496517340921767 + 0.005803387850864858i, 0.001779058964483382 + -0.016378931275268307i, 0.1530187978703237 + -6.478107980600889e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.08319234293414449, 1.0e-7), DoubleNear(0.05593769942440614, 1.0e-7), DoubleNear(0.22104429056575375, 1.0e-7), DoubleNear(0.14358383988157414, 1.0e-7), DoubleNear(0.0801970699770553, 1.0e-7), DoubleNear(0.05773196843147835, 1.0e-7), DoubleNear(0.2052939909152638, 1.0e-7), DoubleNear(0.1530187978703237, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.040819787053481396 + -1.2095630486791409e-18i, -0.0004472822162015663 + -0.004117909988409014i, -0.030775655990437967 + -0.0070501890799443715i, 0.0018662805508086154 + -0.0158778539060738i, -0.03811476506319898 + 0.006438219283164135i, -0.014289016816432703 + -0.014333491747263635i, -0.02692504891307005 + -0.020845243646323074i, 0.016274929948918604 + -0.007166256110707725i }, { -0.00044728221620156616 + 0.004117909988409014i, 0.05396255784651918 + -1.5890338090490674e-18i, -0.00523180228229305 + 0.01510686905470299i, 0.018669950288658706 + 0.004276973972190954i, 0.010878319996889228 + 0.01706713629448279i, 0.011994545032424723 + -0.03372396737702392i, -0.017434010293455933 + 0.0035048333161700864i, -0.00989606056166982 + 0.03294768486944841i }, { -0.030775655990437963 + 0.007050189079944372i, -0.005231802282293051 + -0.01510686905470299i, 0.10651264089100247 + -1.268855354986942e-18i, -0.0011671106958199085 + -0.010745020968439213i, -0.03331433145284597 + -0.007045407120649959i, 0.011532290985187443 + -0.013536426268385169i, -0.09945432293663078 + 0.016799493284634925i, -0.03728488134590569 + -0.037400931494086076i }, { 0.0018662805508086163 + 0.015877853906073804i, 0.018669950288658706 + -0.004276973972190956i, -0.0011671106958199072 + 0.010745020968439212i, 0.14080657838649946 + -3.1848438816761693e-18i, -0.01416967761577314 + 0.010744710687194924i, 0.005433652172318516 + 0.03396994814489676i, 0.028385218908858888 + 0.04453393538751936i, 0.03129782784059506 + -0.08799724559911633i }, { -0.03811476506319898 + -0.006438219283164133i, 0.010878319996889228 + -0.01706713629448279i, -0.03331433145284597 + 0.007045407120649952i, -0.01416967761577314 + -0.01074471068719492i, 0.12256962585771838 + -4.1131919918668824e-18i, 0.002139372727975375 + 0.0196961649856652i, 0.15609317381932647 + 0.03575834061365895i, -0.007949307398322576 + 0.0676307436576725i }, { -0.0142890168164327 + 0.01433349174726364i, 0.011994545032424723 + 0.03372396737702392i, 0.011532290985187443 + 0.013536426268385169i, 0.005433652172318511 + -0.03396994814489676i, 0.002139372727975374 + -0.019696164985665204i, 0.059707110009365315 + -3.3542504711270293e-18i, 0.02228454053768786 + -0.06434678102925573i, -0.05451734968351184 + -0.01248901480851047i }, { -0.02692504891307005 + 0.02084524364632307i, -0.017434010293455933 + -0.0035048333161700864i, -0.09945432293663078 + -0.016799493284634925i, 0.028385218908858884 + -0.04453393538751936i, 0.15609317381932647 + -0.035758340613658936i, 0.022284540537687858 + 0.06434678102925571i, 0.31982564059001506 + 9.486769009248164e-20i, 0.0055823475710026 + 0.051393961102723866i }, { 0.016274929948918607 + 0.007166256110707727i, -0.00989606056166982 + -0.03294768486944841i, -0.03728488134590569 + 0.037400931494086076i, 0.031297827840595066 + 0.08799724559911633i, -0.007949307398322576 + -0.0676307436576725i, -0.05451734968351183 + 0.012489014808510474i, 0.005582347571002604 + -0.051393961102723866i, 0.15579605936539836 + -3.496552006265752e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.040819787053481396, 1.0e-7), DoubleNear(0.05396255784651918, 1.0e-7), DoubleNear(0.10651264089100247, 1.0e-7), DoubleNear(0.14080657838649946, 1.0e-7), DoubleNear(0.12256962585771838, 1.0e-7), DoubleNear(0.059707110009365315, 1.0e-7), DoubleNear(0.31982564059001506, 1.0e-7), DoubleNear(0.15579605936539836, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.16980578372156868 + -3.2958051977664826e-18i, 0.001053779384867548 + 0.009701634666759005i, 0.003925652824627678 + 0.002887021181678901i, 0.001778432793549718 + -0.0034595296106200817i, 0.08185704151259623 + -0.03582243910133684i, 0.021042984756656315 + 0.031087588427627592i, 0.0013761177208446275 + 0.0003749851736083123i, 0.00022437956819133006 + 0.0017455506385595137i }, { 0.0010537793848675505 + -0.009701634666759003i, 0.1388419304314521 + -7.49454751730605e-18i, -0.002479734333515564 + 0.002997012839998237i, 0.01422904189612848 + 0.009682229759208938i, -0.013877600876948587 + -0.03488061862430984i, -0.023415417981624526 + 0.01990404037890505i, 0.00015563057505579478 + -0.001753018067934571i, -0.004206919152541643 + 0.0004846952281718853i }, { 0.003925652824627677 + -0.002887021181678901i, -0.0024797343335155654 + -0.002997012839998238i, 0.13262288053702173 + 2.5334755452376123e-18i, 0.0008889439819942547 + 0.008184075221405301i, 0.000989718882260473 + -0.0014392760144073691i, 0.0022231491108224903 + 0.0007377829050236524i, 0.06414014272376532 + -0.024627929888481632i, 0.014811217345816599 + 0.02454126628530553i }, { 0.0017784327935497185 + 0.003459529610620083i, 0.014229041896128483 + -0.00968222975920894i, 0.000888943981994255 + -0.008184075221405298i, 0.1065024881314883 + 1.3992984288641042e-18i, -0.0020128979854487756 + -0.0011978970256546378i, -0.002099250732082285 + 0.0053206332856397896i, -0.009196688207913431 + -0.027148974863845567i, -0.018347453359243517 + 0.013684029430896222i }, { 0.08185704151259623 + 0.03582243910133684i, -0.013877600876948584 + 0.034880618624309856i, 0.000989718882260474 + 0.0014392760144073702i, -0.002012897985448775 + 0.001197897025654638i, 0.16084007505636105 + -4.7535488999911335e-18i, 0.002370449336117633 + 0.02182357501514856i, 0.0033144707259117126 + 0.002665126898599315i, 0.0013417127731483913 + -0.0016754385796368767i }, { 0.02104298475665631 + -0.031087588427627592i, -0.02341541798162454 + -0.019904040378905044i, 0.0022231491108224894 + -0.0007377829050236519i, -0.002099250732082284 + -0.005320633285639788i, 0.002370449336117634 + -0.021823575015148564i, 0.09118769190177481 + -5.1482662534116375e-18i, -0.001670146830373114 + 0.0013482941684809832i, 0.008139761536028372 + 0.007471470473533355i }, { 0.0013761177208446269 + -0.0003749851736083133i, 0.00015563057505579457 + 0.0017530180679345708i, 0.06414014272376532 + 0.024627929888481632i, -0.009196688207913431 + 0.02714897486384556i, 0.0033144707259117126 + -0.002665126898599316i, -0.0016701468303731148 + -0.0013482941684809843i, 0.12645895507726582 + -9.808641529204798e-19i, 0.0017941546839770652 + 0.01651791022822798i }, { 0.00022437956819133028 + -0.0017455506385595132i, -0.004206919152541644 + -0.00048469522817188573i, 0.014811217345816597 + -0.02454126628530552i, -0.01834745335924351 + -0.013684029430896222i, 0.0013417127731483933 + 0.001675438579636878i, 0.008139761536028373 + -0.007471470473533359i, 0.0017941546839770652 + -0.01651791022822798i, 0.0737401951430671 + -3.8116482626443515e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.16980578372156868, 1.0e-7), DoubleNear(0.1388419304314521, 1.0e-7), DoubleNear(0.13262288053702173, 1.0e-7), DoubleNear(0.1065024881314883, 1.0e-7), DoubleNear(0.16084007505636105, 1.0e-7), DoubleNear(0.09118769190177481, 1.0e-7), DoubleNear(0.12645895507726582, 1.0e-7), DoubleNear(0.0737401951430671, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.20862783092408416 + -4.561272420964407e-18i, 0.004068733116543477 + 0.03745884842699668i, 0.0065079405099986035 + -0.0009897835227530055i, 0.010497240900901107 + 0.00286298099202143i, 0.06791696433510237 + -0.12809721733095916i, 0.0648815096056903 + -0.0004954522051975174i, 0.010085021594469416 + 0.0077337814602799464i, 0.0019616785161917626 + -0.0032284252656888364i }, { 0.004068733116543478 + -0.03745884842699668i, 0.08907372205990075 + -4.7027269231558755e-18i, -0.009637740937911624 + -0.0050500174560024575i, -0.006119669755982719 + 0.03114174096107079i, -0.06347478870630907 + -0.013446447868873782i, 0.047249687970583626 + 0.0767345314573569i, -0.002609087476826995 + 0.00273195439846475i, 0.01959663112284083 + 0.015027837178344182i }, { 0.006507940509998603 + 0.000989783522753006i, -0.009637740937911626 + 0.005050017456002456i, 0.09560880257581404 + -1.3857459017080354e-18i, -0.0005050097481331762 + -0.004649379319709658i, 0.007538829033002846 + -0.005781212827509571i, -0.007492519939621874 + -0.007845357040128148i, 0.053217215102356316 + 0.10037223005256787i, -0.0497364909817443 + 0.010536137997419788i }, { 0.010497240900901109 + -0.002862980992021428i, -0.006119669755982713 + -0.031141740961070793i, -0.0005050097481331772 + 0.004649379319709658i, 0.11044781724607955 + 1.1231656880592022e-18i, 0.005633354775658704 + 0.00927107308267403i, 0.0348533306287444 + -0.026727562228861232i, 0.05083874532164652 + 0.0003882179781599291i, 0.03702310362169954 + -0.06012633377128303i }, { 0.06791696433510236 + 0.12809721733095916i, -0.06347478870630906 + 0.013446447868873775i, 0.007538829033002848 + 0.005781212827509571i, 0.005633354775658702 + -0.009271073082674032i, 0.12201802785384555 + -3.488081676793209e-18i, -0.0006445043955582966 + -0.0059336387450891126i, 0.0007321830405407871 + 0.006541931603031221i, -0.007377095334202997 + -0.007997949182278388i }, { 0.06488150960569028 + 0.0004954522051975221i, 0.047249687970583626 + -0.0767345314573569i, -0.007492519939621873 + 0.007845357040128152i, 0.034853330628744406 + 0.026727562228861232i, -0.0006445043955582935 + 0.005933638745089113i, 0.14095590027332616 + -7.940086847561811e-18i, 0.005487859774022946 + 0.009395324464481679i, 0.02848847318813957 + -0.013988040728328498i }, { 0.010085021594469414 + -0.007733781460279945i, -0.0026090874768269945 + -0.00273195439846475i, 0.05321721510235633 + -0.10037223005256787i, 0.05083874532164652 + -0.0003882179781599317i, 0.0007321830405407868 + -0.006541931603031223i, 0.005487859774022946 + -0.009395324464481679i, 0.1634730330384735 + 2.938357294025168e-18i, 0.003188108414104496 + 0.029351364769342934i }, { 0.001961678516191763 + 0.003228425265688835i, 0.019596631122840828 + -0.01502783717834418i, -0.049736490981744305 + -0.010536137997419787i, 0.037023103621699555 + 0.060126333771283035i, -0.007377095334202997 + 0.00799794918227839i, 0.028488473188139567 + 0.013988040728328495i, 0.003188108414104497 + -0.029351364769342934i, 0.06979486602847584 + -1.0503208545953324e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.20862783092408416, 1.0e-7), DoubleNear(0.08907372205990075, 1.0e-7), DoubleNear(0.09560880257581404, 1.0e-7), DoubleNear(0.11044781724607955, 1.0e-7), DoubleNear(0.12201802785384555, 1.0e-7), DoubleNear(0.14095590027332616, 1.0e-7), DoubleNear(0.1634730330384735, 1.0e-7), DoubleNear(0.06979486602847584, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.08260567992104834 + -2.8384074062491604e-18i, -0.0009051505226500822 + -0.008333280964952785i, 0.002201172935235647 + 0.0016879875048290416i, 0.0018524486178057849 + -0.0030486605586753156i, -0.07713161460032764 + 0.013028815673873519i, -0.02891622016494689 + -0.029006222640851967i, -0.0008670104773492308 + -0.0011429673641880635i, -0.0015479743353774382 + -0.0029426123496610478i }, { -0.00090515052265008 + 0.008333280964952785i, 0.10920227916305218 + -6.218915898741073e-18i, -0.002463808646671271 + 0.0025798341102134695i, 0.011183158402530993 + 0.008575896671187876i, 0.022014103566106953 + 0.03453821050226941i, 0.024272971989023957 + -0.06824609964683102i, 0.0008800823229833214 + 0.003206344817410819i, 0.008945532158418232 + -0.005017674706403899i }, { 0.002201172935235647 + -0.001687987504829042i, -0.002463808646671273 + -0.0025798341102134708i, 0.0647267480234355 + 3.5998900258307764e-19i, -0.0007092423893713925 + -0.006529649991895441i, -0.0013287399993880883 + 0.0005408618839024392i, -0.003243422967749515 + 0.0007317099395524637i, -0.06043747339950213 + 0.010208896893925543i, -0.022657677997391507 + -0.022728200600497746i }, { 0.0018524486178057853 + 0.0030486605586753177i, 0.011183158402530997 + -0.008575896671187877i, -0.0007092423893713932 + 0.006529649991895442i, 0.08556685706996647 + 1.4450382080158364e-18i, 0.0033248846959755404 + -1.8268602370717646e-05i, -0.0025255602436306396 + -0.009940882783353429i, 0.017249435339641166 + 0.02706286117973273i, 0.019019400883995823 + -0.05347511332930922i }, { -0.07713161460032764 + -0.013028815673873513i, 0.022014103566106946 + -0.03453821050226942i, -0.0013287399993880881 + -0.000540861883902439i, 0.0033248846959755395 + 1.826860237071678e-05i, 0.2480401788568814 + -5.210946691508456e-18i, 0.0043293792436352625 + 0.039858490646860346i, 0.005038950615303744 + 0.003864160575449174i, 0.0012676969488923245 + -0.002086307631581642i }, { -0.028916220164946882 + 0.029006222640851967i, 0.024272971989023968 + 0.06824609964683102i, -0.0032434229677495135 + -0.0007317099395524624i, -0.002525560243630636 + 0.009940882783353424i, 0.004329379243635264 + -0.03985849064686035i, 0.12082734317017474 + -6.423897871976614e-18i, -0.0016860725172174072 + 0.001765472898265751i, 0.011185645029625857 + 0.008577803561554416i }, { -0.0008670104773492304 + 0.0011429673641880638i, 0.0008800823229833206 + -0.0032063448174108194i, -0.06043747339950213 + -0.010208896893925543i, 0.017249435339641166 + -0.027062861179732736i, 0.005038950615303742 + -0.0038641605754491746i, -0.0016860725172174072 + -0.0017654728982657514i, 0.19435508759085202 + 1.1926223897340549e-18i, 0.0033923410553427123 + 0.031231635441528717i }, { -0.0015479743353774386 + 0.0029426123496610486i, 0.008945532158418234 + 0.005017674706403899i, -0.022657677997391507 + 0.022728200600497746i, 0.019019400883995823 + 0.05347511332930922i, 0.0012676969488923263 + 0.0020863076315816437i, 0.011185645029625857 + -0.008577803561554421i, 0.003392341055342713 + -0.031231635441528717i, 0.09467582620458892 + -4.2690460541616737e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.08260567992104834, 1.0e-7), DoubleNear(0.10920227916305218, 1.0e-7), DoubleNear(0.0647267480234355, 1.0e-7), DoubleNear(0.08556685706996647, 1.0e-7), DoubleNear(0.2480401788568814, 1.0e-7), DoubleNear(0.12082734317017474, 1.0e-7), DoubleNear(0.19435508759085202, 1.0e-7), DoubleNear(0.09467582620458892, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.1559254255195181 + -2.4131968667275017e-18i, 0.0012635764651594548 + 0.011633134425031904i, 0.07574573776505955 + -0.03203502357424449i, 0.018172763018298392 + 0.028282989599184197i, 0.062120955877927826 + -0.013935557696267278i, 0.008356977543250993 + 0.0028094692708494637i, 0.024635280288434803 + -0.02054306766307889i, 0.008750724433758263 + 0.010699878969711675i }, { 0.0012635764651594546 + -0.011633134425031904i, 0.11879697448898412 + -1.0198276684941776e-18i, -0.011676475069988462 + -0.03152517638851103i, -0.019696491343975546 + 0.015598569151847996i, -0.007558879698579416 + -0.004538229714839611i, 0.05039545387606678 + 0.011463062513120145i, -0.006249338358359455 + -0.012329166969620825i, -0.012114609001874922 + 0.0033941222843566167i }, { 0.07574573776505958 + 0.032035023574244495i, -0.011676475069988462 + 0.03152517638851103i, 0.1483112079803801 + -3.533821455944941e-18i, 0.0023001469032508464 + 0.021176334682255115i, 0.03534239849728964 + 0.004290786720578834i, -0.00322990130081283 + 0.013153454855595593i, 0.059013223559530856 + -0.013789429582124018i, 0.006788041080695008 + 0.007231216521372806i }, { 0.018172763018298392 + -0.028282989599184197i, -0.01969649134397554 + -0.015598569151847992i, 0.0023001469032508464 + -0.021176334682255115i, 0.08072456481699619 + -2.5597335666024956e-18i, 0.005978681671356066 + -0.012153230127162679i, -0.005042160805390121 + -0.010404325080376975i, -0.005077163686083131 + -0.008520000175874242i, 0.03387733771621639 + 0.005145135172953728i }, { 0.062120955877927826 + 0.013935557696267278i, -0.007558879698579414 + 0.004538229714839605i, 0.03534239849728962 + -0.004290786720578823i, 0.005978681671356064 + 0.012153230127162677i, 0.14650323873907228 + 1.6508672141986314e-18i, 0.0006791469017023478 + 0.0062525754631323986i, 0.07025144647130199 + -0.028415345415573987i, 0.01768143908417452 + 0.027345865113748914i }, { 0.008356977543250984 + -0.0028094692708494594i, 0.05039545387606679 + -0.011463062513120134i, -0.0032299013008128333 + -0.01315345485559559i, -0.005042160805390124 + 0.010404325080376978i, 0.0006791469017023511 + -0.006252575463132397i, 0.1265474440739563 + -5.075421419947768e-18i, -0.011397814014873556 + -0.03050441709964438i, -0.022066379996892503 + 0.01798950065795328i }, { 0.02463528028843481 + 0.02054306766307888i, -0.006249338358359455 + 0.012329166969620829i, 0.05901322355953085 + 0.013789429582124016i, -0.00507716368608312 + 0.008520000175874239i, 0.07025144647130199 + 0.02841534541557398i, -0.011397814014873553 + 0.03050441709964437i, 0.13898782215324673 + -2.2005915969666723e-18i, 0.0018644571168438518 + 0.017165150561121424i }, { 0.008750724433758267 + -0.010699878969711677i, -0.012114609001874924 + -0.003394122284356626i, 0.006788041080695003 + -0.007231216521372805i, 0.03387733771621639 + -0.005145135172953721i, 0.017681439084174515 + -0.027345865113748914i, -0.02206637999689251 + -0.017989500657953277i, 0.0018644571168438527 + -0.017165150561121424i, 0.08420332222784573 + -2.969697513073577e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1559254255195181, 1.0e-7), DoubleNear(0.11879697448898412, 1.0e-7), DoubleNear(0.1483112079803801, 1.0e-7), DoubleNear(0.08072456481699619, 1.0e-7), DoubleNear(0.14650323873907228, 1.0e-7), DoubleNear(0.1265474440739563, 1.0e-7), DoubleNear(0.13898782215324673, 1.0e-7), DoubleNear(0.08420332222784573, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.06547193848288782 + -8.097634975751111e-19i, -0.002188105210201685 + -0.02014482126586264i, -0.035854198163786814 + -0.019674312984579993i, 0.010261207147570206 + -0.019376383226380498i, -0.051255382118660146 + 0.04455543576603804i, -0.04405072413331386 + -0.017683244766552017i, -0.012262788113107534 + 0.032942967814289424i, 0.011384998253549399 + -0.009747891512121125i }, { -0.002188105210201684 + 0.020144821265862645i, 0.12976639108364446 + -2.9984966332802232e-18i, -0.014182101087984199 + 0.016721381754840198i, 0.0217508311623187 + 0.01933246453942096i, 0.03922675012249607 + 0.026728739532016203i, 0.019617528137154967 + -0.08833925589161998i, -0.013212404800115372 + 0.007076152454780332i, 0.014585121905732476 + 0.07219565077096379i }, { -0.035854198163786814 + 0.01967431298458i, -0.014182101087984199 + -0.016721381754840198i, 0.08186048946159603 + -1.6686549060909717e-18i, 0.0005737122981802104 + 0.0052818903090144165i, -0.05791718405627026 + -0.06543608249645003i, 0.02101091915810254 + -0.014371109453205525i, -0.08631370588116963 + -0.021317723198238978i, -0.0075231740290245324 + -0.034051178474797696i }, { 0.010261207147570207 + 0.019376383226380495i, 0.0217508311623187 + -0.01933246453942096i, 0.0005737122981802108 + -0.0052818903090144165i, 0.06500274514937421 + -1.7753810574450135e-18i, -0.02360646558744147 + 0.009524825103553056i, -0.019783908723769998 + 0.005764607021537973i, 3.678878325204639e-05 + 0.03487233214998594i, 0.023674844735864814 + -0.033381957084520256i }, { -0.051255382118660146 + -0.04455543576603803i, 0.03922675012249607 + -0.026728739532016207i, -0.05791718405627026 + 0.06543608249645004i, -0.02360646558744147 + -0.009524825103553054i, 0.2369567257757026 + 4.743384504624082e-20i, 0.004130828577063488 + 0.03803053115402694i, 0.18185138240014836 + -0.04077605600523848i, 0.025592994954902706 + 0.0750052379393136i }, { -0.04405072413331386 + 0.017683244766552017i, 0.019617528137154974 + 0.08833925589161999i, 0.021010919158102537 + 0.014371109453205522i, -0.01978390872377 + -0.005764607021537968i, 0.0041308285770634895 + -0.03803053115402694i, 0.11557802747929596 + -3.096752455161722e-18i, -0.00889218799687782 + -0.0787509752429956i, -0.06351370250318675 + 0.014255605270380315i }, { -0.012262788113107539 + -0.03294296781428942i, -0.013212404800115374 + -0.007076152454780331i, -0.08631370588116963 + 0.021317723198238978i, 3.6788783252045525e-05 + -0.034872332149985946i, 0.1818513824001484 + 0.04077605600523847i, -0.008892187996877816 + 0.0787509752429956i, 0.20543854067203082 + -4.065758146820642e-18i, 0.0035908917219144875 + 0.03305959493436213i }, { 0.011384998253549402 + 0.009747891512121125i, 0.01458512190573247 + -0.07219565077096379i, -0.007523174029024532 + 0.034051178474797696i, 0.023674844735864814 + 0.033381957084520256i, 0.025592994954902703 + -0.0750052379393136i, -0.06351370250318675 + -0.01425560527038031i, 0.003590891721914488 + -0.03305959493436213i, 0.0999251418954677 + -3.754050022231059e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.06547193848288782, 1.0e-7), DoubleNear(0.12976639108364446, 1.0e-7), DoubleNear(0.08186048946159603, 1.0e-7), DoubleNear(0.06500274514937421, 1.0e-7), DoubleNear(0.2369567257757026, 1.0e-7), DoubleNear(0.11557802747929596, 1.0e-7), DoubleNear(0.20543854067203082, 1.0e-7), DoubleNear(0.0999251418954677, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.07573310827114571 + -1.7863924857593194e-18i, -0.0006327042433926142 + -0.005825000478894665i, 0.03026310775853414 + -0.006113936270980357i, 0.004420364825718373 + -0.0035691029065046597i, -0.07138483486521863 + 0.012398722687758774i, -0.02537256996496397 + -0.02636015542647096i, -0.025950781104616953 + 0.012464927707984118i, -0.012051780992903216 + -0.011852357219132765i }, { -0.0006327042433926141 + 0.005825000478894664i, 0.0943242495002978 + -6.318865786517081e-19i, -0.005083579941938802 + 0.0025367963504360947i, 0.04000693832370352 + 0.009052515650333721i, 0.01912121683532635 + 0.03119301472238828i, 0.020458858392802672 + -0.058604728489720134i, 0.009225969080263073 + 0.014163519734898582i, 0.01556551098884023 + -0.021490233161281395i }, { 0.030263107758534136 + 0.006113936270980355i, -0.005083579941938799 + -0.002536796350436098i, 0.07159931967333813 + -6.920259179067634e-19i, -0.0009816886686288607 + -0.00903793047795356i, -0.03056451824212115 + -0.0029185514035613754i, -0.009135495418541396 + -0.009400865132819892i, -0.06618425313461114 + 0.010838989880040286i, -0.026201328197374425 + -0.02537426781487875i }, { 0.00442036482571837 + 0.0035691029065046623i, 0.04000693832370353 + -0.009052515650333716i, -0.000981688668628859 + 0.009037930477953562i, 0.10044488673272085 + -4.141991112073529e-18i, 0.006904040116813226 + 0.011143059357873561i, 0.002219599372234091 + -0.028514538173708776i, 0.020142322070421763 + 0.030408056959613863i, 0.02283351448021711 + -0.0631164844864201i }, { -0.07138483486521863 + -0.012398722687758771i, 0.019121216835326346 + -0.031193014722388283i, -0.030564518242121155 + 0.002918551403561377i, 0.006904040116813225 + -0.011143059357873561i, 0.2285035252287525 + -4.160625836913123e-18i, 0.004196427611802915 + 0.038634469586181684i, 0.09087107167892454 + -0.02161105100741094i, 0.010724653798227627 + 0.01360978869872693i }, { -0.02537256996496397 + 0.026360155426470962i, 0.020458858392802676 + 0.05860472848972015i, -0.009135495418541395 + 0.00940086513281989i, 0.002219599372234091 + 0.02851453817370877i, 0.004196427611802915 + -0.038634469586181684i, 0.10519728980568249 + -2.947674656444965e-18i, -0.007552463442723745 + -0.015595026241149949i, 0.04426585326857965 + 0.0075556820357401515i }, { -0.025950781104616946 + -0.012464927707984113i, 0.009225969080263071 + -0.014163519734898582i, -0.06618425313461115 + -0.010838989880040286i, 0.020142322070421763 + -0.030408056959613867i, 0.09087107167892454 + 0.02161105100741094i, -0.007552463442723735 + 0.015595026241149942i, 0.2138917412189809 + 1.4230153513872246e-19i, 0.00352529268717506 + 0.032455656502207386i }, { -0.012051780992903213 + 0.011852357219132763i, 0.015565510988840223 + 0.0214902331612814i, -0.02620132819737442 + 0.025374267814878754i, 0.022833514480217115 + 0.0631164844864201i, 0.010724653798227617 + -0.013609788698726926i, 0.04426585326857965 + -0.007555682035740139i, 0.0035252926871750627 + -0.032455656502207386i, 0.11030587956908117 + -3.903127820947816e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.07573310827114571, 1.0e-7), DoubleNear(0.0943242495002978, 1.0e-7), DoubleNear(0.07159931967333813, 1.0e-7), DoubleNear(0.10044488673272085, 1.0e-7), DoubleNear(0.2285035252287525, 1.0e-7), DoubleNear(0.10519728980568249, 1.0e-7), DoubleNear(0.2138917412189809, 1.0e-7), DoubleNear(0.11030587956908117, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.08233892416750328 + -4.258881658794622e-18i, -0.01374373657839877 + 0.0006499178868479958i, 0.02157580279989125 + 0.00871634462474812i, 0.0016358820463960914 + 0.004095859177299837i, 0.003422051061376072 + 0.004007486400924565i, -0.019323007116076037 + -0.02492266094206269i, 0.00027505599570249297 + -0.0015478024036933973i, -0.004893210905181895 + -0.006697117201893114i }, { -0.01374373657839877 + -0.0006499178868479955i, 0.06588568563510505 + -2.450466316406691e-18i, 0.0040218559612967605 + -0.001810206368504453i, 0.02621658683348741 + 0.010591161211691381i, -0.015461819367287058 + -0.01994253168378315i, 0.003028611790754967 + 0.004312527256859999i, -0.005945701755807442 + -0.008137613987571216i, -0.0015581834683935326 + -0.00020835633053990082i }, { 0.02157580279989125 + -0.008716344624748122i, 0.004021855961296758 + 0.001810206368504453i, 0.22911688592549495 + -8.870129023647033e-18i, -0.03824342080808762 + 0.00180846621263799i, -0.0003959147163042102 + -0.0016421635865234603i, -0.00770162956567263 + -0.004485125744089678i, 0.011919272870744874 + 0.006645359900241907i, -0.06937074729352008 + -0.04309287150575308i }, { 0.0016358820463960922 + -0.0040958591772998374i, 0.026216586833487418 + -0.010591161211691376i, -0.03824342080808762 + -0.0018084662126379818i, 0.18333398538305334 + -5.112690869626957e-18i, -0.009358188992570344 + -0.005449840713673458i, -0.0016236533488570375 + 0.0004660466824634279i, -0.055508853129478154 + -0.03448191015182795i, 0.011238991259820332 + 0.00774047475499404i }, { 0.0034220510613760715 + -0.0040074864009245655i, -0.015461819367287072 + 0.01994253168378317i, -0.00039591471630421107 + 0.0016421635865234618i, -0.00935818899257034 + 0.005449840713673454i, 0.05726678899161562 + -2.9942614685439517e-18i, -0.011945837020661626 + -0.000564898279940947i, 0.022862380485821954 + 0.0006520109746967618i, 0.0025403798637123037 + -0.002504860973008966i }, { -0.019323007116076034 + 0.024922660942062684i, 0.003028611790754968 + -0.00431252725686i, -0.007701629565672636 + 0.004485125744089695i, -0.0016236533488570384 + -0.00046604668246342596i, -0.011945837020661624 + 0.0005648982799409483i, 0.07156768197286034 + -5.624298769768554e-19i, 0.0023934950088072386 + 0.002645569879793993i, 0.018815348314834758 + 0.0005365938862588004i }, { 0.0002750559957024932 + 0.0015478024036933986i, -0.0059457017558074456 + 0.008137613987571209i, 0.011919272870744874 + -0.0066453599002419105i, -0.05550885312947815 + 0.034481910151827944i, 0.02286238048582196 + -0.0006520109746967627i, 0.0023934950088072395 + -0.0026455698797939924i, 0.13801250492489783 + 9.718856036795842e-18i, -0.02878937198465014 + -0.0013614003511499663i }, { -0.0048932109051818915 + 0.006697117201893121i, -0.001558183468393533 + 0.0002083563305399004i, -0.06937074729352011 + 0.04309287150575307i, 0.011238991259820336 + -0.007740474754994039i, 0.0025403798637123037 + 0.002504860973008967i, 0.018815348314834755 + -0.0005365938862587926i, -0.028789371984650133 + 0.0013614003511499646i, 0.17247754299946916 + -3.5914196963582334e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.08233892416750328, 1.0e-7), DoubleNear(0.06588568563510505, 1.0e-7), DoubleNear(0.22911688592549495, 1.0e-7), DoubleNear(0.18333398538305334, 1.0e-7), DoubleNear(0.05726678899161562, 1.0e-7), DoubleNear(0.07156768197286034, 1.0e-7), DoubleNear(0.13801250492489783, 1.0e-7), DoubleNear(0.17247754299946916, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.054730100144136845 + -2.30647071537346e-18i, -0.0076934781043172815 + 9.684002216057905e-05i, 0.02008262425460452 + 0.017333703223640702i, 0.0005792223976077999 + 0.005803142950299589i, 0.014341403164772493 + 0.008161678568620677i, 0.0015669305980303787 + 0.0037697872954709577i, 0.08476837103123189 + 0.020691994690628247i, -0.012351643422236302 + -0.002583626712775014i }, { -0.00769347810431728 + -9.684002216057863e-05i, 0.054114520895112525 + -1.0003459107073287e-18i, 0.002129714275904494 + 0.006702304416375048i, 0.018729265568058692 + 0.018770314509427732i, 0.0018518181428328856 + 0.0035200225465909615i, 0.014537659750441585 + 0.008529837604618343i, -0.01148349275180816 + -0.002876605128438906i, 0.08383718871078769 + 0.01793272468108638i }, { 0.020082624254604515 + -0.017333703223640706i, 0.0021297142759044924 + -0.0067023044163750465i, 0.2235046856507016 + -5.421010862427522e-20i, -0.046957904370260095 + -6.215629924334544e-05i, 0.13144847719368655 + -0.03329057973458104i, -0.02792980236240175 + 0.006368233159023972i, 0.0371616286056776 + -0.020808946622815856i, 0.00520936056872656 + -0.008854110990225919i }, { 0.0005792223976077999 + -0.005803142950299588i, 0.0187292655680587 + -0.01877031450942773i, -0.046957904370260095 + 6.215629924335065e-05i, 0.21542377613157984 + -3.496552006265752e-18i, -0.02782383479653238 + 0.006403994473986569i, 0.12912382181671392 + -0.026402184494064774i, 0.00371131205641589 + -0.010167470304500974i, 0.03819362137460181 + -0.022744868730440362i }, { 0.014341403164772488 + -0.008161678568620675i, 0.0018518181428328858 + -0.003520022546590962i, 0.13144847719368655 + 0.033290579734581036i, -0.027823834796532387 + -0.0064039944739865675i, 0.08487561301498206 + -4.946672411965114e-18i, -0.01799609549474311 + -1.1820415253530324e-05i, 0.024355559031108694 + -0.007965347624195818i, 0.0035970395125005956 + -0.004212144746008718i }, { 0.001566930598030378 + -0.0037697872954709577i, 0.01453765975044159 + -0.008529837604618345i, -0.027929802362401758 + -0.006368233159023972i, 0.12912382181671392 + 0.026402184494064784i, -0.01799609549474311 + 1.1820415253531382e-05i, 0.08333884671285285 + -2.0125502826762176e-18i, 0.004285636694199505 + -0.005866940905085508i, 0.02630266958026348 + -0.007642559411477552i }, { 0.08476837103123189 + -0.020691994690628254i, -0.01148349275180816 + 0.0028766051284389057i, 0.037161628605677614 + 0.020808946622815856i, 0.003711312056415892 + 0.010167470304500973i, 0.024355559031108694 + 0.00796534762419582i, 0.004285636694199504 + 0.005866940905085507i, 0.14362470519969117 + 9.029371217730842e-19i, -0.020074888422477653 + 0.0005092221607313691i }, { -0.0123516434222363 + 0.002583626712775015i, 0.08383718871078769 + -0.017932724681086375i, 0.00520936056872656 + 0.008854110990225917i, 0.03819362137460182 + 0.02274486873044036i, 0.003597039512500596 + 0.004212144746008718i, 0.026302669580263477 + 0.007642559411477561i, -0.020074888422477653 + -0.0005092221607313678i, 0.1403877522509427 + -5.2075585597194385e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.054730100144136845, 1.0e-7), DoubleNear(0.054114520895112525, 1.0e-7), DoubleNear(0.2235046856507016, 1.0e-7), DoubleNear(0.21542377613157984, 1.0e-7), DoubleNear(0.08487561301498206, 1.0e-7), DoubleNear(0.08333884671285285, 1.0e-7), DoubleNear(0.14362470519969117, 1.0e-7), DoubleNear(0.1403877522509427, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.06848282460271163 + -3.5405977195229754e-18i, -0.01268625338732611 + 0.001236738076059663i, 0.024324446602086314 + 0.007765007036862269i, 0.001873604354207289 + 0.0007245600543025193i, 0.028675986678461596 + 0.003904694781143028i, -0.0017442539066270003 + -0.0004514830405474503i, 0.01824109931834998 + -0.004303378528100802i, 0.000647993445641262 + 0.0009613783394784545i }, { -0.01268625338732611 + -0.0012367380760596612i, 0.07064721775583903 + -3.2924170659774654e-18i, 0.00314727336346828 + -0.0003260451989795987i, 0.02231143652897126 + 0.008115550459135744i, -0.008809381093430244 + -0.00048641028041328374i, 0.02823387989818981 + -0.005680997907890743i, -0.0008822091666441966 + 0.0003502608033903859i, 0.01679779956251699 + 0.0028907275284638756i }, { 0.024324446602086314 + -0.00776500703686227i, 0.003147273363468277 + 0.0003260451989796i, 0.18091566416171595 + 5.9156781036240336e-18i, -0.032682766612839725 + 0.0033396787101260543i, 1.4725935215726196e-05 + -0.008152029622523798i, 0.0035177247883677533 + 7.081826264877626e-06i, 0.07541093615057345 + 0.007835915137674898i, -0.004551348828348303 + -0.002374071838396683i }, { 0.0018736043542072897 + -0.0007245600543025188i, 0.022311436528971267 + -0.00811555045913574i, -0.032682766612839725 + -0.003339678710126053i, 0.18371246628561194 + -8.609242875892709e-18i, 0.0010676731727232388 + 0.0003077740953641632i, 0.0017019472343322616 + -0.0016807094095975502i, -0.02298665702609285 + -0.0025577327273148083i, 0.07308616830251699 + -0.01717640160324462i }, { 0.0286759866784616 + -0.0039046947811430207i, -0.008809381093430244 + 0.0004864102804132834i, 1.4725935215727497e-05 + 0.008152029622523798i, 0.0010676731727232386 + -0.0003077740953641643i, 0.07112288855640729 + -3.7125454078155984e-18i, -0.013003320211734283 + -0.0011517184691526143i, 0.02011373668362689 + 0.0016033485625826128i, 0.0023026575559011065 + 0.0008664381499883514i }, { -0.001744253906627002 + 0.0004514830405474543i, 0.02823387989818981 + 0.005680997907890748i, 0.003517724788367755 + -7.08182626487871e-06i, 0.0017019472343322742 + 0.001680709409597547i, -0.013003320211734282 + 0.0011517184691526138i, 0.06680614985212635 + 2.795208725939191e-19i, 0.00326807760663572 + 0.0011614087102691387i, 0.022720498619350906 + 0.003012204638814436i }, { 0.018241099318349985 + 0.0043033785281007975i, -0.000882209166644197 + -0.00035026080339038506i, 0.07541093615057344 + -0.007835915137674893i, -0.022986657026092858 + 0.002557732727314801i, 0.020113736683626898 + -0.0016033485625826151i, 0.0032680776066357194 + -0.00116140871026914i, 0.18621372668867683 + -5.066951090475225e-18i, -0.03435002617989802 + -0.0028926128486380306i }, { 0.000647993445641263 + -0.0009613783394784585i, 0.016797799562516987 + -0.0028907275284638808i, -0.0045513488283483085 + 0.0023740718383966934i, 0.073086168302517 + 0.01717640160324461i, 0.0023026575559011065 + -0.0008664381499883522i, 0.022720498619350906 + -0.003012204638814427i, -0.03435002617989802 + 0.002892612848638036i, 0.1720990620969106 + -9.486769009248164e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.06848282460271163, 1.0e-7), DoubleNear(0.07064721775583903, 1.0e-7), DoubleNear(0.18091566416171595, 1.0e-7), DoubleNear(0.18371246628561194, 1.0e-7), DoubleNear(0.07112288855640729, 1.0e-7), DoubleNear(0.06680614985212635, 1.0e-7), DoubleNear(0.18621372668867683, 1.0e-7), DoubleNear(0.1720990620969106, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.047894714712006875 + -1.5610817217896755e-18i, -0.011612638484897103 + -4.560262872769496e-05i, -0.005891496875376259 + -0.0009084791634214099i, -0.0029557990175542656 + -0.0008751868008632488i, -0.012957624472585976 + -0.013951172417150194i, -0.001935769027799297 + 0.0066299161127825485i, -0.019317157556556948 + 0.00627173633430568i, 0.002742331120092448 + -0.006079686878520814i }, { -0.011612638484897103 + 4.560262872769599e-05i, 0.046887630187993704 + -1.2375151359385328e-18i, -0.0036549781702178985 + -0.000639231905716313i, -0.006214208826403002 + -0.0018647359443320084i, -0.0017292894052516718 + 0.006870971536834342i, -0.013162595558188276 + -0.013334575676709596i, 0.0021337311339137883 + -0.0066485680522965825i, -0.017503951918182922 + 0.005830704888819649i }, { -0.00589149687537626 + 0.0009084791634214094i, -0.0036549781702178976 + 0.000639231905716313i, 0.12630742892831465 + -1.4823076576950256e-18i, -0.0303013043923606 + -0.00023979619807646616i, -0.013085507797446355 + 0.013836193467075587i, -0.0006452620574717133 + -0.007201455600491309i, -0.03353933906385425 + -0.03722002781262981i, -0.005324563709343649 + 0.016980411630133824i }, { -0.0029557990175542656 + 0.0008751868008632499i, -0.006214208826403002 + 0.0018647359443320062i, -0.0303013043923606 + 0.00023979619807647072i, 0.1210117903491873 + -2.9713915789680856e-18i, -0.0005058209660680686 + -0.006380129894646592i, -0.014795171483081097 + 0.013088347557171209i, -0.00423881427233556 + 0.018247973957702557i, -0.03461715603218149 + -0.03397772450185159i }, { -0.01295762447258598 + 0.013951172417150196i, -0.0017292894052516725 + -0.006870971536834343i, -0.013085507797446362 + -0.013836193467075587i, -0.0005058209660680668 + 0.006380129894646593i, 0.09171099844711203 + -5.692061405548898e-18i, -0.014076935114163292 + 0.00013062223563474365i, 0.05032968016108946 + 0.010276834762866293i, 0.007132060927662661 + 0.0024661850051541194i }, { -0.0019357690277992975 + -0.006629916112782548i, -0.013162595558188276 + 0.013334575676709592i, -0.0006452620574717138 + 0.00720145560049131i, -0.014795171483081094 + -0.013088347557171216i, -0.014076935114163289 + -0.00013062223563474332i, 0.09056573741997168 + -1.7753810574450135e-18i, 0.0100703291403219 + 0.001474595417005853i, 0.05124614397472517 + 0.012992491042282188i }, { -0.019317157556556948 + -0.00627173633430568i, 0.002133731133913788 + 0.006648568052296581i, -0.03353933906385425 + 0.037220027812629806i, -0.0042388142723355626 + -0.018247973957702557i, 0.05032968016108947 + -0.010276834762866295i, 0.010070329140321894 + -0.001474595417005853i, 0.24082196192207814 + 2.3310346708438345e-18i, -0.036731488400377155 + 0.00068686205956449i }, { 0.0027423311200924488 + 0.006079686878520814i, -0.017503951918182922 + -0.005830704888819649i, -0.00532456370934365 + -0.016980411630133824i, -0.03461715603218148 + 0.03397772450185159i, 0.007132060927662661 + -0.002466185005154121i, 0.051246143974725177 + -0.012992491042282173i, -0.036731488400377155 + -0.0006868620595644878i, 0.23479973803333523 + -5.732718987017105e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.047894714712006875, 1.0e-7), DoubleNear(0.046887630187993704, 1.0e-7), DoubleNear(0.12630742892831465, 1.0e-7), DoubleNear(0.1210117903491873, 1.0e-7), DoubleNear(0.09171099844711203, 1.0e-7), DoubleNear(0.09056573741997168, 1.0e-7), DoubleNear(0.24082196192207814, 1.0e-7), DoubleNear(0.23479973803333523, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.1730211083018105 + -8.372073650661505e-18i, -0.030906289132585904 + 0.000488843014823552i, 0.009254126915405808 + 0.006187027683774942i, -0.050243441872895644 + -0.036148558620165534i, 0.02638338351110795 + -0.005450777772970444i, 0.005400263574798035 + 0.0001349555352318458i, -0.0012886788155156107 + -0.0008387711384298545i, -0.008188009893401045 + -0.003903003839088831i }, { -0.030906289132585904 + -0.0004888430148235455i, 0.13562660585121028 + -2.4182790644110275e-18i, -0.03924178887297104 + -0.02857602945180328i, 0.00890056780535035 + 0.006382223257112895i, 0.001518147436220505 + -0.00708711605032608i, 0.03205824001986373 + -0.010467620949461347i, -0.010425101974348582 + -0.003431653226488099i, -0.0015421226161814053 + 0.0016984515402100522i }, { 0.009254126915405808 + -0.006187027683774946i, -0.03924178887297104 + 0.028576029451803285i, 0.10521367749302796 + 6.0113928266637695e-18i, -0.023745093341991475 + -0.00045415929190631833i, 0.0008956638230792486 + 0.002728707830138709i, -0.007833447553282153 + 0.010570065114485144i, 0.025119648259342146 + -0.007196490281224735i, 0.0013760275919589044 + -0.005219279229986806i }, { -0.05024344187289567 + 0.03614855862016553i, 0.00890056780535035 + -0.006382223257112898i, -0.02374509334199147 + 0.0004541592919063177i, 0.13391169117548207 + -2.078618852562053e-18i, -0.006838464243842875 + 0.007620171000687709i, -0.0020051956729010604 + 0.001152649441093711i, 0.004044982763028271 + 0.0004396682924160673i, 0.020673041105179667 + -0.003747410176360674i }, { 0.026383383511107958 + 0.0054507777729704485i, 0.0015181474362205077 + 0.0070871160503260784i, 0.0008956638230792498 + -0.0027287078301387073i, -0.006838464243842884 + -0.0076201710006877175i, 0.13843470179118772 + -4.756937031780151e-18i, -0.02108086825390048 + 0.0019695410846624333i, 0.006087197016715136 + 0.004465818617391528i, -0.038450312536700476 + -0.03186697382765024i }, { 0.005400263574798036 + -0.00013495553523184666i, 0.032058240019863744 + 0.010467620949461342i, -0.007833447553282155 + -0.010570065114485149i, -0.0020051956729010595 + -0.0011526494410937108i, -0.02108086825390048 + -0.001969541084662432i, 0.11359306516694812 + -5.14487812162262e-18i, -0.03172888362379417 + -0.02584841238380782i, 0.005367035245224949 + 0.005670778754741142i }, { -0.0012886788155156135 + 0.0008387711384298534i, -0.01042510197434858 + 0.0034316532264881067i, 0.02511964825934214 + 0.007196490281224735i, 0.004044982763028271 + -0.00043966829241606775i, 0.006087197016715136 + -0.00446581861739153i, -0.03172888362379418 + 0.025848412383807827i, 0.09006561642348548 + 7.132017415881209e-19i, -0.016990115663320288 + -0.0014721393391845948i }, { -0.008188009893401047 + 0.0039030038390888283i, -0.001542122616181404 + -0.0016984515402100528i, 0.0013760275919589022 + 0.005219279229986806i, 0.020673041105179667 + 0.003747410176360673i, -0.03845031253670047 + 0.03186697382765023i, 0.005367035245224951 + -0.005670778754741143i, -0.016990115663320284 + 0.0014721393391845957i, 0.11013353379684743 + -2.075230720773036e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.1730211083018105, 1.0e-7), DoubleNear(0.13562660585121028, 1.0e-7), DoubleNear(0.10521367749302796, 1.0e-7), DoubleNear(0.13391169117548207, 1.0e-7), DoubleNear(0.13843470179118772, 1.0e-7), DoubleNear(0.11359306516694812, 1.0e-7), DoubleNear(0.09006561642348548, 1.0e-7), DoubleNear(0.11013353379684743, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.16113089714585327 + -2.5614276324970042e-18i, -0.02140950645416681 + 0.0036459130951105117i, -0.00449285580471934 + 0.010925834277726063i, -0.05284266123701771 + -0.02292907646949347i, 0.06397519456081732 + -0.015982215145487443i, -0.0035297900923169923 + -0.013054856032008287i, 0.016778911284576425 + 0.008853503831018045i, -0.11169410517123429 + -0.0856535399259397i }, { -0.02140950645416681 + -0.0036459130951105104i, 0.13657065583813163 + -6.7025717116232786e-18i, -0.0542927941337936 + -0.002686881032577115i, 0.004881126558735225 + 0.01922612316059172i, -0.017827258970092293 + -0.01406479449501449i, 0.05119145774486868 + -0.035380470728114836i, -0.09466922524908986 + -0.07259787123232199i, 0.01290274143273382 + 0.013908114807606082i }, { -0.00449285580471934 + -0.010925834277726067i, -0.05429279413379359 + 0.002686881032577129i, 0.08826759161857427 + 4.936508016598062e-18i, -0.023959513545999032 + 0.0009305036910752052i, 0.0205648162802967 + -0.01707756912079525i, -0.07808701603370723 + 0.059881668198038196i, 0.04011172826821773 + 0.027722825064305366i, -0.0027658126426583114 + 0.010229301153064155i }, { -0.05284266123701771 + 0.022929076469493458i, 0.00488112655873523 + -0.019226123160591725i, -0.023959513545999025 + -0.0009305036910752036i, 0.11778902820331934 + -5.1990882302468955e-18i, -0.10420351983379464 + 0.0799093231717481i, 0.02182734338145055 + -0.015431205935575554i, -0.013968779149430802 + 0.011020651487286398i, 0.05012859045583813 + 0.012523071216979481i }, { 0.06397519456081731 + 0.015982215145487443i, -0.0178272589700923 + 0.014064794495014486i, 0.0205648162802967 + 0.017077569120795243i, -0.10420351983379464 + -0.07990932317174806i, 0.15032491294714495 + -1.0567583049944651e-17i, -0.030577650932319577 + -0.0011875289956245264i, 0.019834179736840284 + -0.0002729879765595918i, -0.03585109317257841 + -0.0450864559783223i }, { -0.0035297900923169975 + 0.013054856032008294i, 0.051191457744868676 + 0.03538047072811484i, -0.07808701603370724 + -0.0598816681980382i, 0.02182734338145055 + 0.015431205935575561i, -0.030577650932319577 + 0.001187528995624533i, 0.11264901518002679 + -8.605854744103691e-19i, -0.016677878362971618 + -0.05173756080303399i, 0.009386476491840073 + -0.007173121148737685i }, { 0.016778911284576425 + -0.008853503831018046i, -0.09466922524908986 + 0.072597871232322i, 0.04011172826821774 + -0.027722825064305356i, -0.013968779149430802 + -0.011020651487286402i, 0.019834179736840284 + 0.00027298797655958985i, -0.016677878362971618 + 0.05173756080303399i, 0.10701170229793919 + 1.788086551653828e-18i, -0.01677569545931273 + -0.0028568023221661183i }, { -0.11169410517123429 + 0.08565353992593971i, 0.012902741432733816 + -0.013908114807606078i, -0.002765812642658313 + -0.010229301153064148i, 0.050128590455838146 + -0.012523071216979483i, -0.035851093172578424 + 0.045086455978322296i, 0.009386476491840073 + 0.007173121148737681i, -0.01677569545931273 + 0.0028568023221661166i, 0.12625619676901018 + 1.0452386569118066e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.16113089714585327, 1.0e-7), DoubleNear(0.13657065583813163, 1.0e-7), DoubleNear(0.08826759161857427, 1.0e-7), DoubleNear(0.11778902820331934, 1.0e-7), DoubleNear(0.15032491294714495, 1.0e-7), DoubleNear(0.11264901518002679, 1.0e-7), DoubleNear(0.10701170229793919, 1.0e-7), DoubleNear(0.12625619676901018, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.11046415378150076 + -4.9907181252223376e-18i, -0.023500120087972004 + -0.0013186226264430938i, 0.006404205652955269 + 0.005507448299800618i, -0.03145704850917643 + -0.024123095451655797i, -0.023465901007496452 + -0.03652324226304396i, -0.006693660320713097 + 0.010175535788937737i, 0.004128291422237612 + -0.001435945604541593i, -0.0012935026261427802 + 0.015525249727945i }, { -0.023500120087972007 + 0.0013186226264430981i, 0.08134380530259977 + -4.066605179767896e-18i, -0.023164401678994324 + -0.017763811268557736i, 0.0069801256848113745 + 0.004756435876216297i, -0.0007231996304640895 + 0.017145772927668394i, -0.02939274160380723 + -0.01869404170991355i, 0.00428782306014003 + 0.01174230050013779i, 0.003950230258831388 + -0.004724696466050369i }, { 0.00640420565295527 + -0.005507448299800622i, -0.02316440167899432 + 0.017763811268557743i, 0.06373798985882076 + 1.9473287457376365e-18i, -0.018413822789285696 + 0.0010332237996389325i, -0.003538336896531673 + -0.005040560266551582i, 0.012452610226074037 + -0.0010952379595691054i, -0.023031062528943776 + -0.014647957966736045i, -0.0005666724164298481 + 0.013434791953978635i }, { -0.03145704850917644 + 0.02412309545165579i, 0.006980125684811377 + -0.004756435876216302i, -0.018413822789285692 + -0.0010332237996389312i, 0.08655561523458123 + -1.4230153513872246e-19i, 0.014658344722601534 + 0.005276311036346728i, -0.0003159633464870533 + -0.0043594606328994055i, -0.005244904047123142 + 0.007973172566868504i, -0.018387009986562536 + -0.028618258468647635i }, { -0.02346590100749645 + 0.03652324226304396i, -0.0007231996304640918 + -0.01714577292766839i, -0.003538336896531673 + 0.005040560266551579i, 0.014658344722601538 + -0.005276311036346726i, 0.20099165631149746 + -8.138292557219318e-18i, -0.02848703729851438 + 0.0037770067259290793i, 0.008937118279165676 + 0.005145398001365852i, -0.057236705900419696 + -0.043892436996159974i }, { -0.006693660320713101 + -0.010175535788937741i, -0.02939274160380722 + 0.018694041709913546i, 0.012452610226074037 + 0.0010952379595690984i, -0.0003159633464870524 + 0.0043594606328994055i, -0.02848703729851438 + -0.0037770067259290754i, 0.16787586571555863 + -3.496552006265752e-18i, -0.04780627081777089 + -0.03666063056705336i, 0.007287477365763925 + 0.00729656613563774i }, { 0.004128291422237616 + 0.0014359456045415905i, 0.004287823060140025 + -0.01174230050013779i, -0.023031062528943783 + 0.014647957966736048i, -0.005244904047123143 + -0.007973172566868511i, 0.008937118279165674 + -0.005145398001365854i, -0.04780627081777089 + 0.03666063056705337i, 0.13154130405769268 + 4.777265822514254e-18i, -0.022321386216026067 + -0.002959522430729846i }, { -0.001293502626142775 + -0.015525249727945004i, 0.0039502302588313885 + 0.004724696466050371i, -0.0005666724164298477 + -0.013434791953978632i, -0.018387009986562536 + 0.028618258468647635i, -0.057236705900419696 + 0.04389243699615997i, 0.007287477365763926 + -0.007296566135637741i, -0.022321386216026064 + 0.002959522430729844i, 0.15748960973774828 + -4.0115480381963664e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.11046415378150076, 1.0e-7), DoubleNear(0.08134380530259977, 1.0e-7), DoubleNear(0.06373798985882076, 1.0e-7), DoubleNear(0.08655561523458123, 1.0e-7), DoubleNear(0.20099165631149746, 1.0e-7), DoubleNear(0.16787586571555863, 1.0e-7), DoubleNear(0.13154130405769268, 1.0e-7), DoubleNear(0.15748960973774828, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.135855195751153 + 7.623296525288703e-19i, -0.02661300231938435 + 0.0023924392783533695i, 0.029063090445072357 + -0.008700991143145355i, 0.00318928600614397 + -0.00187862787615775i, 0.05715136458522685 + 0.009649678489230783i, -0.004200164458222683 + -0.0021010312413431167i, 0.0035467870174483995 + -0.012393575404908994i, 0.0033546511341796545 + -0.0004561228453434441i }, { -0.02661300231938435 + -0.002392439278353368i, 0.13886720425734922 + -4.1953541877505496e-18i, 0.0024117005226292013 + -0.0034440000380355474i, 0.026986155976011658 + -0.007735463279251139i, -0.018251385415159038 + -0.0021152797982800526i, 0.05536504516876777 + -0.01212217367237792i, 0.0007869251828251874 + -0.0002713614282799071i, 0.008973884269111481 + -0.004755369973813274i }, { 0.029063090445072364 + 0.008700991143145358i, 0.0024117005226291996 + 0.003444000038035547i, 0.11354329301327454 + 1.6127507315721878e-18i, -0.018756017680781494 + 0.0021839775078323475i, 0.01761137649218505 + -0.007197901359282081i, 0.0014984862645183682 + 0.002459502789781582i, 0.046935558243808205 + 0.0020909314295871452i, -0.0020954382767526206 + -0.000724523637601016i }, { 0.0031892860061439703 + 0.001878627876157748i, 0.026986155976011665 + 0.007735463279251137i, -0.01875601768078149 + -0.0021839775078323466i, 0.11549247978410176 + -7.706305754119624e-18i, -0.0005708562474213799 + 0.0016325882144052834i, 0.012688861199714463 + 0.0010843629994839437i, -0.013544652704364056 + -0.0009288632094480392i, 0.04595500303193904 + -0.01073522583875744i }, { 0.05715136458522684 + -0.009649678489230765i, -0.018251385415159044 + 0.0021152797982800457i, 0.01761137649218504 + 0.007197901359282101i, -0.0005708562474213781 + -0.0016325882144052823i, 0.14237959004368544 + -3.1230104765266054e-18i, -0.02803838015519303 + -0.002357755555436136i, 0.022439941325377744 + -0.003946276911049825i, 0.00358700516061297 + -0.0032056958185972114i }, { -0.004200164458222688 + 0.002101031241343124i, 0.05536504516876778 + 0.012122173672377917i, 0.001498486264518367 + -0.0024595027897815844i, 0.012688861199714461 + -0.0010843629994839472i, -0.02803838015519303 + 0.00235775555543614i, 0.13067109276934313 + -3.015437292225309e-19i, 0.0031514296766195745 + -0.003203447719874465i, 0.025745125149031742 + -0.006479567846570883i }, { 0.00354678701744841 + 0.012393575404908982i, 0.000786925182825184 + 0.00027136142827990754i, 0.046935558243808205 + -0.0020909314295871483i, -0.013544652704364057 + 0.0009288632094480384i, 0.022439941325377733 + 0.003946276911049826i, 0.0031514296766195784 + 0.003203447719874463i, 0.11495702520139871 + -5.656486021764218e-18i, -0.019314966236439274 + -0.0016865757623545088i }, { 0.003354651134179658 + 0.0004561228453434439i, 0.00897388426911148 + 0.004755369973813277i, -0.0020954382767526232 + 0.0007245236376010222i, 0.04595500303193904 + 0.010735225838757445i, 0.0035870051606129686 + 0.0032056958185972106i, 0.025745125149031742 + 0.006479567846570877i, -0.019314966236439274 + 0.0016865757623545103i, 0.10823411917969379 + 4.861969117239684e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.135855195751153, 1.0e-7), DoubleNear(0.13886720425734922, 1.0e-7), DoubleNear(0.11354329301327454, 1.0e-7), DoubleNear(0.11549247978410176, 1.0e-7), DoubleNear(0.14237959004368544, 1.0e-7), DoubleNear(0.13067109276934313, 1.0e-7), DoubleNear(0.11495702520139871, 1.0e-7), DoubleNear(0.10823411917969379, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.09997708639419502 + -1.7101595205064324e-18i, -0.027406835078671983 + -0.0004174612600470924i, -0.006717898656820912 + 0.00028826159078894614i, -0.0035952965065955576 + -0.0038601914541497155i, -0.015538229129502833 + -0.02350667777033058i, -0.0038900609095481363 + 0.016988708007644522i, 0.0015371267826989419 + 0.05401701043187976i, -0.0026011428254635633 + -0.015300709653660477i }, { -0.027406835078671983 + 0.00041746126004709675i, 0.09526124317233726 + -2.098100610348902e-18i, -0.004106378979401173 + -0.003372089494513044i, -0.0073854683446472075 + -0.0006301100359479813i, -0.0024559520915992572 + 0.017497929505219674i, -0.016099624852002344 + -0.020277142355251375i, -0.0029370306528244895 + -0.015084423981177628i, 0.000785207009926001 + 0.05112160815337346i }, { -0.006717898656820914 + -0.00028826159078894505i, -0.004106378979401172 + 0.003372089494513045i, 0.07422505724612652 + -1.3332298589782687e-18i, -0.01450710779858572 + 0.0001320624332429313i, -0.03933360096076392 + -0.030053768759943103i, 0.00525623372837508 + -0.00028611771794430493i, -0.030958734406937395 + -0.027664522459449423i, -0.003370271827594809 + 0.006621619735271856i }, { -0.0035952965065955563 + 0.003860191454149715i, -0.0073854683446472075 + 0.0006301100359479813i, -0.014507107798585718 + -0.00013206243324292999i, 0.07263817736484374 + -2.1108061045577164e-18i, 0.004621608204961675 + 1.9809427940879754e-05i, -0.03836749181927634 + -0.029617706714968953i, -0.003512151585987974 + 0.007621015989317224i, -0.03168012673836742 + -0.027035157823309813i }, { -0.015538229129502831 + 0.023506677770330584i, -0.00245595209159926 + -0.017497929505219677i, -0.03933360096076392 + 0.03005376875994311i, 0.004621608204961677 + -1.980942794087997e-05i, 0.17825769940064345 + -6.505213034913027e-19i, -0.027244547395905396 + 0.0004521449829643263i, 0.058220930427271014 + -0.012935529644984126i, 0.010371587673352497 + -0.0012241322406052458i }, { -0.003890060909548138 + -0.01698870800764452i, -0.016099624852002344 + 0.020277142355251368i, 0.005256233728375081 + 0.00028611771794430536i, -0.03836749181927633 + 0.029617706714968956i, -0.027244547395905396 + -0.00045214498296432455i, 0.1742770538543551 + -2.3987973066241786e-18i, 0.009669509178649949 + -0.0032753582633969686i, 0.0601167494696906 + -0.01358492108987404i }, { 0.0015371267826989371 + -0.05401701043187975i, -0.0029370306528244874 + 0.015084423981177628i, -0.0309587344069374 + 0.02766452245944942i, -0.003512151585987975 + -0.007621015989317224i, 0.058220930427271014 + 0.01293552964498413i, 0.00966950917864995 + 0.0032753582633969656i, 0.1542752609685467 + -2.710505431213761e-18i, -0.02356387611863505 + 0.00036533931223490753i }, { -0.002601142825463561 + 0.015300709653660477i, 0.0007852070099259919 + -0.05112160815337346i, -0.0033702718275948093 + -0.006621619735271854i, -0.03168012673836742 + 0.027035157823309813i, 0.010371587673352495 + 0.0012241322406052431i, 0.06011674946969062 + 0.013584921089874032i, -0.023563876118635047 + -0.00036533931223490623i, 0.1510884215989518 + -5.10930273783794e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.09997708639419502, 1.0e-7), DoubleNear(0.09526124317233726, 1.0e-7), DoubleNear(0.07422505724612652, 1.0e-7), DoubleNear(0.07263817736484374, 1.0e-7), DoubleNear(0.17825769940064345, 1.0e-7), DoubleNear(0.1742770538543551, 1.0e-7), DoubleNear(0.1542752609685467, 1.0e-7), DoubleNear(0.1510884215989518, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.08334510101555753 + 1.3857459017080354e-18i, -0.02036791836360877 + 0.0013688270360083174i, 0.03578233467204647 + 0.011110276005495908i, -0.004138274788536704 + -0.0018010598405239274i, -0.026486938372894106 + -0.021610948070709016i, -0.00286794534578656 + 0.010983685057764488i, 0.002206341328686995 + -0.0009314679988298054i, -0.00392128230030246 + 0.002595052912441565i }, { -0.02036791836360877 + -0.0013688270360083154i, 0.08671225675588601 + -3.804024966119063e-18i, -0.01308055731212556 + -0.001683814023425363i, 0.03448771141019119 + -0.008171696626142543i, -0.003181239909039657 + 0.012439432312979662i, -0.024439038099521845 + -0.024595057731252347i, -0.0015809733589396621 + 0.00574289482545738i, -0.01259161144446372 + -0.008093837454467475i }, { 0.03578233467204647 + -0.011110276005495903i, -0.013080557312125561 + 0.0016838140234253604i, 0.090857042624764 + -4.4291352811927365e-18i, -0.021546024513648933 + -0.0016542258628124784i, -0.021307942212888085 + -0.020090374487481286i, 0.0009386363878932458 + 0.007104398900942305i, -0.020010025163546122 + -0.029560252159070988i, -0.004392387391356384 + 0.012626642685151889i }, { -0.004138274788536708 + 0.0018010598405239343i, 0.0344877114101912 + 0.008171696626142543i, -0.021546024513648933 + 0.001654225862812482i, 0.081187163781295 + -4.0488174878755556e-19i, -0.0008708068394696579 + 0.004576318193530639i, -0.007036976656998972 + -0.011342715089788867i, -0.002786863768547574 + 0.012679513181557236i, -0.023340713490847917 + -0.022717242447308838i }, { -0.026486938372894113 + 0.02161094807070902i, -0.0031812399090396567 + -0.012439432312979663i, -0.021307942212888085 + 0.02009037448748129i, -0.0008708068394696587 + -0.0045763181935306345i, 0.16605338774887002 + 9.893344823930228e-19i, -0.025001101636557072 + 0.0032075897501774i, 0.06830458815698859 + 0.0006303339133220207i, -0.0021573279464386 + -0.0010244950384202052i }, { -0.0028679453457865606 + -0.010983685057764484i, -0.024439038099521842 + 0.024595057731252354i, 0.0009386363878932467 + -0.007104398900942307i, -0.007036976656998975 + 0.011342715089788858i, -0.02500110163655707 + -0.0032075897501773988i, 0.16764742728556498 + -8.097634975751111e-18i, -0.018715480807397534 + -0.0013603289843027288i, 0.06683233679051562 + -0.014685702884992817i }, { 0.0022063413286869905 + 0.0009314679988298123i, -0.0015809733589396582 + -0.005742894825457381i, -0.020010025163546115 + 0.029560252159070984i, -0.0027868637685475785 + -0.012679513181557238i, 0.06830458815698857 + -0.0006303339133220103i, -0.018715480807397537 + 0.0013603289843027236i, 0.16647957262032015 + -4.3503612170980865e-18i, -0.025807321877983375 + -0.0023901054549781663i }, { -0.003921282300302465 + -0.0025950529124415663i, -0.01259161144446372 + 0.008093837454467475i, -0.004392387391356387 + -0.012626642685151887i, -0.023340713490847917 + 0.022717242447308827i, -0.002157327946438603 + 0.001024495038420212i, 0.06683233679051562 + 0.014685702884992817i, -0.025807321877983375 + 0.002390105454978168i, 0.15771804816774193 + 5.89534931288993e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.08334510101555753, 1.0e-7), DoubleNear(0.08671225675588601, 1.0e-7), DoubleNear(0.090857042624764, 1.0e-7), DoubleNear(0.081187163781295, 1.0e-7), DoubleNear(0.16605338774887002, 1.0e-7), DoubleNear(0.16764742728556498, 1.0e-7), DoubleNear(0.16647957262032015, 1.0e-7), DoubleNear(0.15771804816774193, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.05823108716735563 + -2.2793656610613222e-18i, 0.01831652024622296 + 0.02346527178338039i, 0.0019318356227219812 + 0.002491666226259491i, 0.0012307679550738783 + -0.0022460879556450465i, 0.015450090356977517 + 0.008929840757943541i, 0.09006428902277087 + 0.03638480518135562i, 0.0007512410004843918 + -0.0014688476917064219i, 0.0028875222674901195 + 0.003952021570944052i }, { 0.01831652024622297 + -0.02346527178338039i, 0.25041662698566514 + -8.51098705401121e-18i, -0.0022637031170915393 + 0.0015651075560704966i, 0.016222859098034177 + 0.010077584714628347i, 0.13919030241534713 + -0.05623107772755468i, 0.04299153317399417 + -0.02484823948037533i, 0.010630889402418662 + 0.006191011309331114i, -0.0035820424321814084 + 0.0023285280934866193i }, { 0.0019318356227219814 + -0.002491666226259492i, -0.002263703117091543 + -0.0015651075560704966i, 0.05061353387189373 + -1.0274509650194663e-18i, 0.020495369576440246 + 0.012638745949688042i, -0.0016096902627276176 + -0.0003616266587517726i, 0.0045447922228917985 + -0.0026467080020681744i, 0.013428972558236562 + 0.00776167541529548i, 0.0785412707192487 + 0.002239914190359012i }, { 0.0012307679550738794 + 0.002246087955645048i, 0.01622285909803418 + -0.01007758471462835i, 0.020495369576440246 + -0.012638745949688042i, 0.18851183479661632 + 4.960224939121183e-18i, 0.006754308748833526 + -0.009244317930544777i, 0.0005001584129058056 + 0.0042429839299841935i, 0.12138199659505333 + -0.003461686501091141i, 0.032363716806285255 + -0.01870557587288089i }, { 0.015450090356977517 + -0.00892984075794354i, 0.13919030241534713 + 0.05623107772755466i, -0.0016096902627276163 + 0.0003616266587517724i, 0.006754308748833524 + 0.009244317930544772i, 0.08999352263525269 + -4.429982314139991e-18i, 0.0294758693871557 + -0.004157765946940891i, 0.004518827229409057 + 0.005828347431525072i, -0.0025138954277649185 + 0.0004899292214117484i }, { 0.09006428902277087 + -0.036384805181355624i, 0.04299153317399418 + 0.02484823948037533i, 0.004544792222891796 + 0.002646708002068173i, 0.0005001584129058064 + -0.004242983929984191i, 0.029475869387155698 + 0.0041577659469408945i, 0.16203424432288316 + -5.47183283926278e-18i, 0.00024413505193029094 + -0.002741224460130529i, 0.006935405032531027 + 0.004308249940607599i }, { 0.0007512410004843918 + 0.001468847691706423i, 0.010630889402418665 + -0.006191011309331123i, 0.013428972558236558 + -0.007761675415295479i, 0.12138199659505332 + 0.003461686501091153i, 0.004518827229409058 + -0.005828347431525075i, 0.00024413505193029332 + 0.002741224460130532i, 0.07822093709258222 + -2.529240380501341e-18i, 0.02118235922421647 + -0.011450141088732478i }, { 0.00288752226749012 + -0.0039520215709440525i, -0.00358204243218141 + -0.002328528093486622i, 0.07854127071924868 + -0.002239914190359004i, 0.03236371680628524 + 0.018705575872880888i, -0.0025138954277649193 + -0.0004899292214117492i, 0.006935405032531028 + -0.0043082499406076i, 0.021182359224216477 + 0.011450141088732485i, 0.1219782131277507 + 1.1672114013164259e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.05823108716735563, 1.0e-7), DoubleNear(0.25041662698566514, 1.0e-7), DoubleNear(0.05061353387189373, 1.0e-7), DoubleNear(0.18851183479661632, 1.0e-7), DoubleNear(0.08999352263525269, 1.0e-7), DoubleNear(0.16203424432288316, 1.0e-7), DoubleNear(0.07822093709258222, 1.0e-7), DoubleNear(0.1219782131277507, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.07870273984735451 + -4.72729087862625e-18i, 0.038753096877076953 + 0.015655748747321493i, -0.0020571367210980643 + 0.008255603596644118i, 0.004161129951122038 + -0.0043871404179104765i, 0.030446368131619175 + -0.013578646344478338i, 0.027570976409998844 + -0.03998127238013667i, 0.006466507033007388 + 0.008340449356302602i, -0.0003754063592433986 + -0.0005138017622593302i }, { 0.03875309687707696 + -0.01565574874732149i, 0.21899881313663042 + -4.536708465494033e-18i, 0.0022066275142486194 + -0.006111116595288084i, 0.0024454074751139488 + 0.02189635384167367i, -0.007937196424267753 + -0.04791306496414087i, 0.08472028417406682 + -0.03778403952912395i, -0.0005908677903968258 + -0.00034409813085196624i, 0.023215145684302857 + 0.014421169282321525i }, { -0.0020571367210980634 + -0.008255603596644122i, 0.0022066275142486186 + 0.006111116595288086i, 0.06042730251119613 + -2.1057239068741906e-18i, 0.00788278625398062 + 0.00022480874867651809i, 0.009235644699703309 + -0.011912061101533483i, -0.004325148581970655 + 0.00251879619586915i, 0.026463498445032235 + 0.011802343217730622i, 0.007467922470868126 + 0.03856862138049974i }, { 0.004161129951122038 + 0.0043871404179104765i, 0.002445407475113952 + -0.02189635384167367i, 0.00788278625398062 + -0.00022480874867652156i, 0.14562931731069748 + 1.8431436932253575e-18i, -0.0027479722346244032 + 0.0037610257312511402i, 0.03315651496204394 + -0.020596713954837323i, 0.00965386959381574 + 0.03808032593201953i, 0.06377682027902362 + 0.02844355306355423i }, { 0.030446368131619165 + 0.013578646344478341i, -0.007937196424267745 + 0.04791306496414086i, 0.00923564469970331 + 0.011912061101533481i, -0.0027479722346244037 + -0.00376102573125114i, 0.0695218699552538 + -1.9820570965750628e-18i, 0.009039292756301708 + 0.0036517570891180053i, 0.008507799573229103 + 6.441006114044458e-05i, -0.005444257423813079 + 0.0026309816836771784i }, { 0.027570976409998844 + 0.03998127238013666i, 0.08472028417406681 + 0.037784039529123944i, -0.004325148581970655 + -0.002518796195869147i, 0.03315651496204394 + 0.02059671395483732i, 0.009039292756301706 + -0.003651757089118008i, 0.1934520581719179 + -9.446111427779957e-18i, -0.0042261955794098685 + 0.004934999691228051i, 0.020712856655451257 + -0.007510519186437721i }, { 0.006466507033007387 + -0.0083404493563026i, -0.0005908677903968271 + 0.0003440981308519671i, 0.026463498445032242 + -0.011802343217730615i, 0.009653869593815747 + -0.03808032593201952i, 0.008507799573229103 + -6.441006114044578e-05i, -0.004226195579409868 + -0.004934999691228051i, 0.06840716845327982 + -1.4509674386466165e-18i, 0.033794942546676095 + 0.0009637961122790457i }, { -0.0003754063592433984 + 0.0005138017622593309i, 0.023215145684302853 + -0.014421169282321527i, 0.007467922470868121 + -0.03856862138049974i, 0.06377682027902364 + -0.02844355306355422i, -0.0054442574238130785 + -0.002630981683677178i, 0.020712856655451257 + 0.007510519186437718i, 0.0337949425466761 + -0.0009637961122790344i, 0.16486073061366951 + 4.284292647212251e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.07870273984735451, 1.0e-7), DoubleNear(0.21899881313663042, 1.0e-7), DoubleNear(0.06042730251119613, 1.0e-7), DoubleNear(0.14562931731069748, 1.0e-7), DoubleNear(0.0695218699552538, 1.0e-7), DoubleNear(0.1934520581719179, 1.0e-7), DoubleNear(0.06840716845327982, 1.0e-7), DoubleNear(0.16486073061366951, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.050707870863072296 + -2.0540548970916783e-18i, -0.006466523279646825 + -0.0026123915736587225i, 0.0029159384604380057 + 0.003760954241793735i, 0.0008008666783240262 + 0.0010961101231395766i, -0.01397412931314308 + -0.014597678420021392i, -0.0214919061972823 + 0.0034422810014222704i, 0.002646397095648408 + -0.0011015429663395796i, -0.00240680431879221 + 0.0012848479523400748i }, { -0.006466523279646822 + 0.002612391573658723i, 0.14110008822102824 + -7.003268407898555e-18i, 0.0012605176043833496 + 0.0007340758095529432i, 0.010468392877328639 + 0.006502929934223182i, -0.013069946992262249 + 0.01740482163381714i, -0.0388845132981606 + -0.04061960555293612i, -0.0018158847760189108 + 0.0023015145584959285i, 0.0054321245854205905 + -0.005059099104252382i }, { 0.002915938460438006 + -0.0037609542417937373i, 0.0012605176043833494 + -0.000734075809552944i, 0.04407447403692828 + -7.4454196063653e-19i, -0.005639182422132437 + -0.00016082353409469603i, -0.0017260993649832268 + -0.0022885356621108266i, 0.0011056200427511978 + 0.002715144766640043i, -0.012146090717631177 + -0.012688069673838396i, -0.01532920327745757 + 0.008660160221703057i }, { 0.0008008666783240275 + -0.0010961101231395775i, 0.01046839287732864 + -0.006502929934223186i, -0.00563918242213244 + 0.00016082353409469256i, 0.10621913105647371 + 2.549569171235444e-18i, 0.001955539413260733 + 0.0019024738875404274i, -0.0021282008780355004 + -0.007111485237340162i, -0.014810732288265203 + 0.009519719390429662i, -0.029271981797875136 + -0.030578146761545286i }, { -0.013974129313143078 + 0.014597678420021395i, -0.01306994699226225 + -0.017404821633817135i, -0.001726099364983225 + 0.002288535662110826i, 0.0019555394132607317 + -0.001902473887540427i, 0.09751673893953602 + -4.655293078109635e-18i, 0.05425891291302549 + 0.02191989741009822i, 0.0035347243916930334 + 0.004559059415990828i, -0.0020839941510150664 + -0.0028522688573728748i }, { -0.0214919061972823 + -0.003442281001422274i, -0.038884513298160596 + 0.04061960555293612i, 0.0011056200427511948 + -0.0027151447666400423i, -0.0021282008780354987 + 0.007111485237340159i, 0.05425891291302549 + -0.02191989741009822i, 0.2713507830875201 + -6.979551485375435e-18i, -0.0032800856695445984 + -0.0019101927136129758i, 0.012689871253236567 + 0.007882904721012765i }, { 0.00264639709564841 + 0.0011015429663395783i, -0.0018158847760189152 + -0.0023015145584959276i, -0.012146090717631177 + 0.012688069673838396i, -0.0148107322882652 + -0.009519719390429667i, 0.0035347243916930334 + -0.00455905941599083i, -0.003280085669544599 + 0.0019101927136129793i, 0.08475999692754768 + -2.812149384884277e-18i, 0.04731691122278915 + 0.0013494283950502598i }, { -0.002406804318792211 + -0.0012848479523400735i, 0.005432124585420592 + 0.005059099104252382i, -0.015329203277457574 + -0.008660160221703054i, -0.029271981797875136 + 0.030578146761545286i, -0.0020839941510150672 + 0.002852268857372876i, 0.012689871253236567 + -0.007882904721012763i, 0.04731691122278916 + -0.0013494283950502485i, 0.20427091686789328 + 3.577867169202165e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.050707870863072296, 1.0e-7), DoubleNear(0.14110008822102824, 1.0e-7), DoubleNear(0.04407447403692828, 1.0e-7), DoubleNear(0.10621913105647371, 1.0e-7), DoubleNear(0.09751673893953602, 1.0e-7), DoubleNear(0.2713507830875201, 1.0e-7), DoubleNear(0.08475999692754768, 1.0e-7), DoubleNear(0.20427091686789328, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.05496754351368353 + -2.6469779601696886e-18i, 0.017192959183232603 + 0.021935824907270075i, 0.015067822895192512 + 0.009051496185695252i, 0.0851275499154763 + 0.02175630991826655i, 0.022357443920552337 + -0.0016128157982145327i, 0.01946067883514654 + 0.013962096091428466i, 0.008019555625662707 + 0.0015700485758277974i, 0.04186203652864047 + 0.005494091708079206i }, { 0.01719295918323261 + -0.021935824907270075i, 0.2197548564948187 + -7.860465750519907e-19i, 0.13036975449677662 + -0.03009411957758868i, 0.0409814235258915 + -0.025487950608091746i, -0.003516213378319911 + -0.0008699377576788878i, 0.09015896583344228 + -0.0008596793849326052i, 0.05279055171428937 + -0.012508616003368398i, 0.004501115660897172 + -0.018718993954550067i }, { 0.015067822895192508 + -0.009051496185695252i, 0.13036975449677662 + 0.030094119577588688i, 0.08416249884486712 + -4.186036825330752e-18i, 0.029442923947824967 + -0.006055267411272061i, 0.0038443660535202413 + -0.005287058982250154i, 0.05425618163367579 + 0.012014003781828937i, 0.03455242265609908 + -0.00016348732853318192i, 0.01557822004572043 + -0.015374747091065392i }, { 0.08512754991547632 + -0.021756309918266555i, 0.040981423525891514 + 0.02548795060809175i, 0.029442923947824978 + 0.006055267411272065i, 0.14487327395250918 + -1.9075181972166844e-18i, 0.02740347812212439 + -0.010373481517956184i, 0.026455871638379272 + -0.0008264793775479926i, 0.005232886547867897 + -0.008962801274442461i, 0.05833813861964817 + -0.008480807080637115i }, { 0.022357443920552333 + 0.0016128157982145336i, -0.003516213378319902 + 0.0008699377576788878i, 0.0038443660535202396 + 0.005287058982250159i, 0.0274034781221244 + 0.0103734815179562i, 0.05387707752556585 + -6.598386659111e-19i, 0.021618930639430604 + 0.01416819282579836i, 0.013811240020021565 + 0.007640019987543769i, 0.08347800982654326 + 0.016868409453448075i }, { 0.019460678835146534 + -0.013962096091428466i, 0.0901589658334423 + 0.0008596793849326156i, 0.05425618163367578 + -0.012014003781828953i, 0.026455871638379258 + 0.0008264793775479909i, 0.021618930639430604 + -0.014168192825798356i, 0.21917360528746277 + -2.7647155398380363e-18i, 0.1302025445136238 + -0.02959864465105714i, 0.03437382645438792 + -0.01806586474516448i }, { 0.008019555625662707 + -0.001570048575827797i, 0.05279055171428937 + 0.012508616003368405i, 0.03455242265609908 + 0.00016348732853319232i, 0.005232886547867905 + 0.008962801274442454i, 0.013811240020021565 + -0.007640019987543768i, 0.13020254451362384 + 0.029598644651057132i, 0.0840519608829678 + -2.7731858693105793e-18i, 0.021215304663547197 + -0.009552639624401308i }, { 0.04186203652864047 + -0.0054940917080792216i, 0.004501115660897179 + 0.018718993954550046i, 0.015578220045720431 + 0.015374747091065386i, 0.058338138619648164 + 0.008480807080637105i, 0.08347800982654327 + -0.01686840945344807i, 0.034373826454387905 + 0.018065864745164473i, 0.021215304663547197 + 0.009552639624401315i, 0.13913918349812468 + -2.39710324072967e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.05496754351368353, 1.0e-7), DoubleNear(0.2197548564948187, 1.0e-7), DoubleNear(0.08416249884486712, 1.0e-7), DoubleNear(0.14487327395250918, 1.0e-7), DoubleNear(0.05387707752556585, 1.0e-7), DoubleNear(0.21917360528746277, 1.0e-7), DoubleNear(0.0840519608829678, 1.0e-7), DoubleNear(0.13913918349812468, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.032361675636983625 + -1.1384122811097797e-18i, -0.006128230845688379 + -0.001057565706790034i, -0.003907465897147588 + 0.0002124155052004382i, 0.0501297940391169 + 0.011483899047489091i, -0.022691709473675367 + -0.017034286210447898i, -0.03875290508849772 + -0.08208933414805071i, -0.03530439618264085 + -0.044905755677045064i, -0.029105745626087684 + -0.03443933412613748i }, { -0.006128230845688375 + 0.0010575657067900279i, 0.16287665392954864 + -2.6698478497455547e-18i, 0.09669262275043727 + -0.022150665878190187i, -0.010195901104320533 + -0.0005542639503594736i, 0.042742835391427696 + 0.08395756311714112i, -0.008946144507829813 + -0.026749533915134054i, -0.008948772761186441 + -0.014663363202121i, 0.037626729975265796 + 0.15004437426229827i }, { -0.003907465897147588 + -0.00021241550520043864i, 0.09669262275043727 + 0.022150665878190177i, 0.062420669263016954 + -1.6601845766184287e-18i, -0.005977474856090884 + -0.0017156494009633845i, 0.014420026508223962 + 0.05750284055230166i, -0.0016730831659453448 + -0.01709665309493348i, -0.0034285105570988897 + -0.010251461883411892i, 0.0019317956137578514 + 0.09419177537117604i }, { 0.05012979403911691 + -0.011483899047489091i, -0.010195901104320533 + 0.0005542639503594753i, -0.005977474856090886 + 0.0017156494009633876i, 0.0844425653479533 + -1.7838513869175565e-18i, -0.04119535590345296 + -0.018334525232197973i, -0.09212111928826422 + -0.11717431602721372i, -0.07062351467195516 + -0.05703302209289432i, -0.05921035058820592 + -0.044448218399347345i }, { -0.022691709473675367 + 0.017034286210447898i, 0.0427428353914277 + -0.08395756311714113i, 0.014420026508223958 + -0.05750284055230166i, -0.04119535590345296 + 0.01833452523219797i, 0.07648294540226575 + -2.168404344971009e-18i, 0.04494012066835158 + 0.03716158343985847i, 0.032786528812361666 + 0.016479100668038583i, 0.11847576570290266 + 0.02714082032422554i }, { -0.03875290508849773 + 0.08208933414805072i, -0.008946144507829806 + 0.026749533915134058i, -0.0016730831659453388 + 0.017096653094933488i, -0.0921211192882642 + 0.11717431602721373i, 0.04494012066835159 + -0.03716158343985846i, 0.2760518078527328 + -8.809142651444724e-19i, 0.1638796762599632 + -0.03754209835045563i, 0.08555115108459996 + -0.042999551402896755i }, { -0.03530439618264085 + 0.044905755677045064i, -0.008948772761186432 + 0.014663363202121i, -0.003428510557098889 + 0.010251461883411896i, -0.07062351467195516 + 0.05703302209289433i, 0.03278652881236166 + -0.01647910066803858i, 0.1638796762599632 + 0.03754209835045564i, 0.10579379046481796 + -5.299038118022903e-18i, 0.05663570346746305 + -0.013892257634709984i }, { -0.029105745626087698 + 0.03443933412613748i, 0.03762672997526578 + -0.15004437426229827i, 0.0019317956137578493 + -0.09419177537117604i, -0.05921035058820593 + 0.04444821839934734i, 0.11847576570290266 + -0.02714082032422554i, 0.08555115108459996 + 0.04299955140289674i, 0.056635703467463064 + 0.013892257634709993i, 0.19956989210268056 + -2.520770051028798e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.032361675636983625, 1.0e-7), DoubleNear(0.16287665392954864, 1.0e-7), DoubleNear(0.062420669263016954, 1.0e-7), DoubleNear(0.0844425653479533, 1.0e-7), DoubleNear(0.07648294540226575, 1.0e-7), DoubleNear(0.2760518078527328, 1.0e-7), DoubleNear(0.10579379046481796, 1.0e-7), DoubleNear(0.19956989210268056, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.04723243752870247 + -1.974433800049774e-18i, -0.006636028100680673 + -0.003114666540529167i, 0.019468954373005425 + 0.00046954273051538764i, -0.007598247440531271 + 0.0011554124306758055i, -0.013665317054265911 + -0.013157805742913625i, -0.01708276681935736 + 0.00451745701088338i, -0.003930428466036567 + -0.003814462019299884i, -0.012100231999507216 + -0.0014417112975611546i }, { -0.00663602810068067 + 0.00311466654052917i, 0.12282492024274107 + -4.438452643612534e-19i, 0.002625054759771364 + 0.0022946878612709037i, 0.050801091709232235 + 0.0024690366488379738i, -0.015925976698226527 + 0.013877838812206195i, -0.037260659418150044 + -0.03304820005904774i, -0.004497622195989093 + 0.01140406329623337i, -0.00645484164974016 + -0.005210843433997395i }, { 0.019468954373005425 + -0.00046954273051537983i, 0.0026250547597713655 + -0.0022946878612709037i, 0.04754990737129812 + -8.241630576784342e-19i, -0.005469677601098589 + 0.0003414514327757484i, -0.006800122092266891 + -0.007394903717180702i, -0.003026393134814482 + 0.006413562884976479i, -0.012454902976508343 + -0.014127942350946165i, -0.019738342655382508 + 0.007584984212241956i }, { -0.007598247440531269 + -0.0011554124306758038i, 0.05080109170923224 + -0.0024690366488379807i, -0.005469677601098592 + -0.00034145143277575446i, 0.12449429903476089 + -4.009853972301858e-18i, -0.006956149566540554 + -0.00034308645992024364i, -0.021544796777620164 + -0.024038185860089448i, -0.011954702582300934 + 0.0130467022120406i, -0.030895835677885695 + -0.038149552255433664i }, { -0.013665317054265914 + 0.013157805742913625i, -0.015925976698226527 + -0.013877838812206195i, -0.006800122092266891 + 0.007394903717180704i, -0.006956149566540554 + 0.0003430864599202471i, 0.09189760482984818 + -4.858580985450667e-18i, 0.053271911231738245 + 0.01899522403652718i, 0.03744091220364598 + -0.0022458458572631023i, 0.04263714632139824 + -0.0025680634303127323i }, { -0.017082766819357362 + -0.00451745701088338i, -0.037260659418150044 + 0.03304820005904775i, -0.0030263931348144765 + -0.006413562884976475i, -0.021544796777620168 + 0.024038185860089448i, 0.05327191123173826 + -0.01899522403652718i, 0.24180321020458684 + -2.2497195079074217e-18i, -0.0009083815902233778 + -0.012127426893392253i, 0.09769601274385822 + -0.011809523114407694i }, { -0.003930428466036573 + 0.003814462019299883i, -0.0044976221959891 + -0.011404063296233368i, -0.012454902976508342 + 0.014127942350946169i, -0.01195470258230093 + -0.013046702212040608i, 0.03744091220364598 + 0.0022458458572631058i, -0.000908381590223363 + 0.012127426893392246i, 0.09037913103723554 + -2.608861477543245e-18i, 0.04830391290407639 + 0.004274101768621303i }, { -0.012100231999507213 + 0.0014417112975611546i, -0.006454841649740157 + 0.0052108434339973985i, -0.01973834265538251 + -0.007584984212241942i, -0.030895835677885692 + 0.03814955225543365i, 0.042637146321398235 + 0.0025680634303127253i, 0.09769601274385821 + 0.011809523114407701i, 0.048303912904076395 + -0.004274101768621287i, 0.23381848975082656 + -1.1519648082658485e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.04723243752870247, 1.0e-7), DoubleNear(0.12282492024274107, 1.0e-7), DoubleNear(0.04754990737129812, 1.0e-7), DoubleNear(0.12449429903476089, 1.0e-7), DoubleNear(0.09189760482984818, 1.0e-7), DoubleNear(0.24180321020458684, 1.0e-7), DoubleNear(0.09037913103723554, 1.0e-7), DoubleNear(0.23381848975082656, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.15966743341754924 + -4.307162536788117e-18i, 0.0006335602483889212 + 0.01908770912256804i, 0.0473881702865858 + -0.017576177407519197i, -0.0015517274134340363 + -0.006507691481823118i, 0.06339839207942563 + -0.01580646152324149i, 0.017767760011883096 + 0.012443454717416827i, -0.01644299701657898 + -0.057009349748166516i, -0.0011000358063029433 + 0.0010002265839978634i }, { 0.0006335602483889236 + -0.01908770912256804i, 0.11505496659095299 + 8.74138001566438e-19i, 0.007845157988344655 + 0.0057790599776050035i, 0.008661076134498217 + 0.0011397229851227032i, 0.026424252142678697 + -0.01815251502469059i, 0.049118017674568984 + 0.013333966340094355i, -0.0026480206322857655 + 0.007563685994932119i, 0.02896366830313886 + 0.03986040436944424i }, { 0.047388170286585804 + 0.017576177407519197i, 0.007845157988344655 + -0.0057790599776050035i, 0.1380341195664357 + -4.9568368073321656e-18i, -0.0002452894943730362 + 0.011064248315749746i, 0.04045163075969376 + -0.05046984961772964i, -5.279288991246107e-05 + -0.001884282717557235i, 0.05176826022626037 + -0.03555622435036079i, 0.01191389270542715 + 0.010318163921207301i }, { -0.0015517274134340371 + 0.006507691481823119i, 0.008661076134498218 + -0.0011397229851226986i, -0.0002452894943730346 + -0.01106424831574975i, 0.09100165323094062 + -1.136718215215271e-18i, -0.005790678314804293 + -0.0010924005490309408i, -0.01015139306779425 + 0.044356311257931505i, 0.015967907519068552 + -0.014356260031680215i, 0.04112230104948687 + 0.026911929941190495i }, { 0.06339839207942562 + 0.015806461523241503i, 0.026424252142678697 + 0.01815251502469059i, 0.04045163075969375 + 0.05046984961772964i, -0.005790678314804295 + 0.0010924005490309443i, 0.14898028073547154 + -6.483190178284415e-18i, 0.01752113447236724 + -0.006518458181680201i, 0.011053453244385886 + 0.0016577786850874056i, -0.0012790740182629804 + 0.007367371883603316i }, { 0.017767760011883092 + -0.012443454717416827i, 0.049118017674569 + -0.013333966340094351i, -5.2792889912459335e-05 + 0.0018842827175572347i, -0.010151393067794251 + -0.0443563112579315i, 0.017521134472367236 + 0.0065184581816801965i, 0.12407040207755704 + 3.0586359725352785e-18i, -0.008954689838166467 + -0.001897702706372583i, 0.037131613230023605 + -0.012083623442708117i }, { -0.01644299701657897 + 0.0570093497481665i, -0.0026480206322857655 + -0.007563685994932116i, 0.05176826022626037 + 0.03555622435036078i, 0.015967907519068555 + 0.01435626003168021i, 0.01105345324438589 + -0.0016577786850874047i, -0.008954689838166463 + 0.001897702706372584i, 0.11399364739170018 + -4.944978346070605e-18i, 0.01169952175631312 + -0.0009276509436170755i }, { -0.001100035806302944 + -0.0010002265839978632i, 0.02896366830313886 + -0.03986040436944425i, 0.01191389270542715 + -0.0103181639212073i, 0.04112230104948688 + -0.026911929941190484i, -0.0012790740182629812 + -0.007367371883603318i, 0.03713161323002359 + 0.01208362344270811i, 0.01169952175631312 + 0.0009276509436170747i, 0.10919749698939231 + -2.253107639696439e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.15966743341754924, 1.0e-7), DoubleNear(0.11505496659095299, 1.0e-7), DoubleNear(0.1380341195664357, 1.0e-7), DoubleNear(0.09100165323094062, 1.0e-7), DoubleNear(0.14898028073547154, 1.0e-7), DoubleNear(0.12407040207755704, 1.0e-7), DoubleNear(0.11399364739170018, 1.0e-7), DoubleNear(0.10919749698939231, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.11023734029753944 + -5.389670643379113e-18i, 0.009298681370848562 + 0.006078257325706616i, -0.007907412078835352 + -0.0002025768463160063i, 0.0006991283811394384 + 0.00240434584718505i, -0.017243838158374738 + -0.024374313211868188i, 0.004727610478318635 + -0.005145245382996717i, 0.002579132750828054 + 0.06157877420280168i, -0.0017701963815830264 + 0.005789653418824862i }, { 0.009298681370848563 + -0.006078257325706621i, 0.08500098926899283 + 1.5814105125237787e-18i, 0.001760238824241443 + 0.0005183599502955726i, -0.006195954922632767 + -0.0001392715988430297i, -0.0027238867144866417 + -0.00672558409365351i, -0.014394015823130438 + -0.019409506913713764i, 0.004192261963871226 + 0.005190093885738784i, -0.00025679895820311226 + 0.04355984438245153i }, { -0.007907412078835352 + 0.00020257684631600544i, 0.0017602388242414421 + -0.0005183599502955718i, 0.08157061878656109 + -3.6676526616111205e-18i, 0.004085649966918082 + 0.0041856268503103i, -0.04484215471165909 + -0.036086461864661336i, -0.002675656056283492 + -0.0014270574040761818i, -0.035614804452928944 + -0.03084297076108932i, 0.003350911202750364 + -0.0010153966875952446i }, { 0.0006991283811394397 + -0.0024043458471850517i, -0.006195954922632767 + 0.00013927159884303143i, 0.004085649966918084 + -0.004185626850310303i, 0.06529261582440915 + 2.236166980751353e-19i, -0.001132190879682641 + 0.00023519991707942494i, -0.03285893806838118 + -0.023585013610250723i, -0.0011304135285320838 + -0.002674436805797479i, -0.02702405669237587 + -0.02385670952166992i }, { -0.017243838158374734 + 0.024374313211868188i, -0.0027238867144866417 + 0.006725584093653506i, -0.044842154711659074 + 0.03608646186466134i, -0.0011321908796826413 + -0.00023519991707942407i, 0.19841037385548135 + -5.400682071693419e-18i, 0.008856013349907599 + 0.0064909936151812215i, 0.06634903560980704 + -0.015715821876115785i, -0.003529929812836455 + -0.0015446654454048525i }, { 0.004727610478318636 + 0.005145245382996717i, -0.014394015823130437 + 0.019409506913713768i, -0.002675656056283493 + 0.0014270574040761803i, -0.03285893806838118 + 0.023585013610250727i, 0.008856013349907599 + -0.006490993615181222i, 0.15412437939951718 + 2.3513634615779377e-18i, -0.0028697706740632564 + 0.003362997320936848i, 0.051988644287154585 + -0.010804628858742383i }, { 0.00257913275082804 + -0.06157877420280168i, 0.004192261963871227 + -0.005190093885738781i, -0.03561480445292894 + 0.03084297076108932i, -0.0011304135285320842 + 0.0026744368057974787i, 0.06634903560980704 + 0.015715821876115785i, -0.002869770674063252 + -0.003362997320936848i, 0.17045714817157476 + -6.2341624917916505e-18i, 0.007368582295022002 + 0.005950970521822371i }, { -0.0017701963815830246 + -0.005789653418824863i, -0.0002567989582031114 + -0.043559844382451536i, 0.0033509112027503662 + 0.0010153966875952438i, -0.027024056692375877 + 0.023856709521669912i, -0.003529929812836458 + 0.0015446654454048525i, 0.05198864428715457 + 0.01080462885874238i, 0.007368582295022002 + -0.0059509705218223725i, 0.13490653439592376 + -1.5856456772600502e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.11023734029753944, 1.0e-7), DoubleNear(0.08500098926899283, 1.0e-7), DoubleNear(0.08157061878656109, 1.0e-7), DoubleNear(0.06529261582440915, 1.0e-7), DoubleNear(0.19841037385548135, 1.0e-7), DoubleNear(0.15412437939951718, 1.0e-7), DoubleNear(0.17045714817157476, 1.0e-7), DoubleNear(0.13490653439592376, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.09131408056758938 + -4.737455273993302e-18i, -0.0018668120260431637 + 0.016293037772342825i, 0.03939869189486177 + 0.013577060924196898i, 0.012516864904050079 + 0.009598660432106304i, -0.043929182989360396 + -0.013582651404541802i, 0.008854006928994384 + 0.009112832434299807i, 0.03063177354694321 + 0.040423108663972224i, 0.005710284941683363 + -0.005870406284504558i }, { -0.00186681202604316 + -0.016293037772342832i, 0.07874327720385416 + 2.3191762095822743e-18i, 0.020063166997176522 + -0.015385604037016205i, 0.030871354187375893 + -0.010638481544843537i, -0.014951860036257368 + -0.0032128308821814124i, -0.006996793483055552 + -0.03262335439741956i, -0.005193813416322664 + -0.015843897364027103i, -0.041017043662719944 + -0.0494484141172695i }, { 0.03939869189486177 + -0.013577060924196901i, 0.020063166997176522 + 0.015385604037016205i, 0.10049387851651115 + -4.319868030996932e-18i, 0.015251143363809807 + -0.00602915359632591i, -0.05234684089000628 + -0.06310713876272085i, 0.01395438768498048 + -0.009125779189891855i, -0.00892945962194328 + -0.04163463256841571i, -0.0007754852479253849 + -0.01527347450489177i }, { 0.012516864904050077 + -0.009598660432106308i, 0.0308713541873759 + 0.01063848154484354i, 0.015251143363809807 + 0.006029153596325907i, 0.07155032788954785 + -5.141489989833603e-19i, -0.004188293295286076 + -0.0070375580518407125i, 0.024001922020119228 + 0.031674049185450706i, 0.011097559793238641 + -0.006187190017269577i, -0.034421279032450756 + -0.010642862037964121i }, { -0.0439291829893604 + 0.013582651404541807i, -0.014951860036257366 + 0.0032128308821814094i, -0.05234684089000628 + 0.06310713876272087i, -0.004188293295286076 + 0.007037558051840713i, 0.20638747241639555 + -4.526544070126981e-18i, 0.002255082780059049 + 0.013858919665974958i, 0.07576796041082423 + -0.06493974679779918i, 0.01716478781326017 + 0.013162958206517823i }, { 0.008854006928994386 + -0.00911283243429981i, -0.006996793483055553 + 0.03262335439741956i, 0.013954387684980484 + 0.009125779189891853i, 0.024001922020119228 + -0.031674049185450706i, 0.002255082780059049 + -0.01385891966597496i, 0.12731334261803945 + -2.5817564232311074e-18i, 0.022328992664570724 + -0.0171231710193546i, 0.05936896453667997 + 0.05088437782612838i }, { 0.03063177354694321 + -0.040423108663972224i, -0.00519381341632266 + 0.015843897364027103i, -0.00892945962194327 + 0.0416346325684157i, 0.011097559793238641 + 0.006187190017269575i, 0.07576796041082422 + 0.06493974679779918i, 0.02232899266457073 + 0.017123171019354594i, 0.1624800496106606 + -7.108300493358088e-18i, 0.013969512864870554 + -0.0014169555289713664i }, { 0.005710284941683362 + 0.005870406284504557i, -0.041017043662719944 + 0.0494484141172695i, -0.000775485247925384 + 0.01527347450489177i, -0.03442127903245076 + 0.010642862037964114i, 0.017164787813260165 + -0.013162958206517819i, 0.059368964536679975 + -0.050884377826128376i, 0.013969512864870552 + 0.0014169555289713649i, 0.1617175711774015 + 3.347474207548995e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.09131408056758938, 1.0e-7), DoubleNear(0.07874327720385416, 1.0e-7), DoubleNear(0.10049387851651115, 1.0e-7), DoubleNear(0.07155032788954785, 1.0e-7), DoubleNear(0.20638747241639555, 1.0e-7), DoubleNear(0.12731334261803945, 1.0e-7), DoubleNear(0.1624800496106606, 1.0e-7), DoubleNear(0.1617175711774015, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.09582571113966934 + 2.0582900618279498e-19i, -0.0082580538201858 + -0.0014175129418855835i, 0.0401033139051679 + 0.0053050904865932814i, -0.006584377286154571 + 0.003498262084012509i, -0.017087702552202863 + -0.01844327229775705i, 0.0006610759525688733 + 0.051923247815891235i, 0.003702539760250083 + -0.005240425128415355i, -0.0014340459700330419 + 0.023075489420700854i }, { -0.0082580538201858 + 0.0014175129418855818i, 0.0742316466317742 + -2.6241080705938225e-18i, 0.0007905174919698044 + 0.0036386981913552018i, 0.03016673217706976 + -0.00236651110723992i, -0.03971129796728058 + -0.03150280189915159i, -0.03383827392021309 + -0.027762733504204315i, -0.020891572664347647 + -0.009710807659633364i, -0.014087809876026815 + -0.0037848803248819243i }, { 0.04010331390516791 + -0.0053050904865932814i, 0.0007905174919698062 + -0.0036386981913551966i, 0.09941261842686294 + -4.014089137038129e-18i, -0.0058453131812823194 + 0.0010756644967265475i, -0.016699811272694563 + -0.01274657861579833i, 0.002388093070159251 + 0.02011692094299554i, -0.014550151429302313 + -0.025340547827824904i, 0.0016612578400560683 + 0.053215370769361975i }, { -0.006584377286154565 + -0.0034982620840125073i, 0.030166732177069756 + 0.00236651110723992i, -0.005845313181282319 + -0.001075664496726545i, 0.07263158797919606 + -8.199278929421627e-19i, -0.011029119562950405 + -0.014803066408721071i, -0.01164510759719249 + -0.01868651096147182i, -0.037989794812759686 + -0.02816867357576047i, -0.028800587225091726 + -0.026936946778554925i }, { -0.017087702552202867 + 0.01844327229775706i, -0.03971129796728057 + 0.0315028018991516i, -0.016699811272694563 + 0.012746578615798327i, -0.011029119562950404 + 0.01480306640872108i, 0.1788966888688329 + -3.638853541404474e-18i, 0.06430730024126982 + -0.01501894148051091i, 0.07241309584882671 + -0.007777585669740416i, 0.01910504857271445 + -0.020647207462734782i }, { 0.0006610759525688664 + -0.05192324781589124i, -0.03383827392021309 + 0.027762733504204315i, 0.0023880930701592543 + -0.02011692094299554i, -0.011645107597192492 + 0.018686510961471826i, 0.06430730024126982 + 0.015018941480510915i, 0.1548041261656021 + -3.469446951953614e-18i, 0.029509720199929708 + -0.009752236551153343i, 0.06272382909867749 + -0.006277783301930379i }, { 0.003702539760250083 + 0.005240425128415358i, -0.020891572664347637 + 0.009710807659633357i, -0.014550151429302306 + 0.025340547827824897i, -0.037989794812759686 + 0.02816867357576047i, 0.07241309584882671 + 0.007777585669740433i, 0.029509720199929694 + 0.009752236551153343i, 0.17363806438616564 + 5.89534931288993e-19i, 0.05403037965569181 + -0.011501509254347259i }, { -0.0014340459700330488 + -0.023075489420700847i, -0.014087809876026817 + 0.003784880324881921i, 0.0016612578400560622 + -0.053215370769361975i, -0.028800587225091726 + 0.026936946778554918i, 0.01910504857271445 + 0.02064720746273476i, 0.06272382909867749 + 0.006277783301930379i, 0.054030379655691796 + 0.01150150925434725i, 0.15055955640189644 + -4.3503612170980865e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.09582571113966934, 1.0e-7), DoubleNear(0.0742316466317742, 1.0e-7), DoubleNear(0.09941261842686294, 1.0e-7), DoubleNear(0.07263158797919606, 1.0e-7), DoubleNear(0.1788966888688329, 1.0e-7), DoubleNear(0.1548041261656021, 1.0e-7), DoubleNear(0.17363806438616564, 1.0e-7), DoubleNear(0.15055955640189644, 1.0e-7) }));


}
}

}
