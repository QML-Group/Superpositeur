#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { 0.1143495133180632 + -0.11267760471866657i, -0.058151973249211675 + -0.13290126893937257i, -0.0768165082204705 + 0.0031140554766238976i, 0.06800067266972167 + -0.01822801846189099i }, { 0.027830411706897748 + -0.09223625791558568i, 0.025892891453469652 + 0.06806599873157641i, -0.05371464854921242 + 0.01831061003933583i, 0.04663767771549934 + -0.23064023020928037i }, { -0.00840631226586597 + -0.03533748750970634i, -0.1099649522529542 + 0.12818780913022876i, 0.02412594565618769 + -0.03206477077643638i, 0.10562415595944406 + -0.10595119697088257i }, { -0.10420655001596721 + 0.08032829787429756i, 0.0303493781992506 + -0.14636877476047178i, 0.053115715754616065 + -0.06533063084941473i, 0.15097197517985753 + -0.13061211120036081i } }), Matrix({ { 0.021012978687018145 + 0.0008998345384476241i, 0.008128958962196372 + 0.011696647826035973i, 0.07603095928128174 + -0.03383081250180294i, -0.09374593238110143 + 0.18242425771118354i }, { 0.03325954120808795 + 0.12104641674166834i, -0.03311095039042644 + -0.013013752534287758i, -0.029955205616800866 + 0.05722818509315259i, 0.014462942132997425 + 0.02107105733288571i }, { -0.06953497728009303 + -0.06935079260736338i, -0.03653933939051897 + 0.009038109661355705i, 0.02294121444641354 + -0.030679457921865577i, -0.0853036442610245 + -0.057955135849111904i }, { 0.021673353552689883 + 0.022240991044624462i, -0.10502212114754676 + -0.0299537868154412i, 0.04065933803571599 + 0.0024515956049261244i, -0.12556667406406022 + -0.06586066680926078i } }), Matrix({ { -0.0716163617672928 + 0.10081704702875292i, -0.11795179729285456 + -0.008236368611216993i, 0.009555901864176281 + -0.08523019006023987i, 0.02584319157681401 + -0.010896523910568211i }, { 0.10916413862220484 + 0.09685982012620666i, 0.1856387175108823 + 0.026656903557691146i, -0.042039490910460386 + 0.047489495640446334i, 0.09187105497528221 + -0.035357136141329154i }, { -0.060357571768389504 + -0.18786314068027132i, -0.014921977404554587 + 0.19819865544709117i, -0.04967639855134041 + -0.07323450205559519i, 0.021472876759552555 + -0.002346942885497211i }, { -0.04430767231983621 + -0.01616613884552296i, 0.09236724633060402 + -0.04152003688679932i, -0.16549997676947073 + 0.23536248994484973i, 0.10541780551179859 + 0.06569789367268766i } }), Matrix({ { 0.00011013917212772222 + 0.1304131996404469i, -0.06195355839338845 + -0.001936191805851064i, 0.10100843784426192 + -0.1945447216346388i, 0.10901470356672911 + 0.13041061699822384i }, { -0.22957612973043598 + -0.1702430072337997i, 0.10670836886158507 + 0.10098215411735852i, 0.17562424185270345 + -0.017078680052386826i, 0.0370906543443773 + 0.06259195964259816i }, { -0.2581477203935244 + 0.01295813233923313i, -0.008076197842211178 + -0.01570691643243967i, 0.027830304889464322 + -0.00226961398435051i, 0.08447028952617566 + 0.04655052580040784i }, { -0.002801519156208689 + 0.0108123121263079i, 0.03674785080565725 + -0.07047412683323746i, -0.025782966291697948 + -0.0015991868848982936i, 0.04423765469441781 + -0.04367997886474234i } }), Matrix({ { -0.16756693074397525 + 0.25219387491182715i, -0.059619354936000755 + -0.11662772511289515i, 0.15102255896083722 + 0.06586353435318618i, -0.05761326155161447 + -0.010255087470301022i }, { 0.05430278502975819 + -0.0274630524754061i, -0.028113343536784338 + -0.09676212411860942i, -0.16399073300659472 + -0.05304092208019458i, 0.08670662510200351 + 0.007247991924638543i }, { -0.04701068897930941 + 0.07087739758831141i, -0.10310196594891101 + 0.06706871003909819i, -0.1229569826886568 + 0.14569485382157366i, 0.05932052647094512 + -0.006159059989650091i }, { -0.015839271198835464 + -0.06895913888949039i, 0.0809023689425461 + 0.018810554598797696i, -0.00897646117098721 + 0.06446910581360372i, -0.04522458896478363 + 0.031907880852278185i } }), Matrix({ { 0.1157968921998164 + 0.09770437649099599i, -0.013048049036779951 + -0.02762420119307603i, -0.05781744847518181 + 0.08481556576269318i, 0.006688126751643705 + 0.031518504050300995i }, { 0.05971712108956023 + -0.09345802030131699i, -0.03662492901297131 + -0.23124743779374995i, -0.004328070490185151 + 0.07323756903880857i, -0.10016504047728338 + -0.031090605800766797i }, { 0.11200239419957707 + 0.06804984298897883i, 0.026622555373988915 + 0.030933776864044447i, 0.038397600015722906 + -0.08893115980649072i, 0.015144346801746334 + 0.029954000348825446i }, { -0.031066382321792034 + -0.13165600027561045i, -0.027988372539057723 + 0.01655507017266369i, 0.09508049081252853 + 0.09012923661512019i, -0.17419211636437032 + -0.10513983082715242i } }), Matrix({ { 0.030136231430746944 + -0.11130537328833862i, 0.008379162583191551 + -0.07910688380986852i, 0.03013820623223283 + 0.06376317966896473i, 0.10832127724317925 + 0.06610374472209515i }, { -0.1497196254065342 + 0.056492261805678325i, -0.13096583273634457 + -0.05387436883058247i, -0.11546494944420645 + -0.09720558071226064i, 0.10389538541381256 + 0.08271069094964141i }, { 0.031842761792578826 + -0.012338353485932372i, 0.06833887134322741 + 0.09658919338714157i, -0.1959972327366686 + 0.12387686646961929i, 0.16041039686104416 + 0.006545889640992717i }, { -0.2068205701236208 + 0.023873354839647545i, -0.09318158964312273 + -0.08048272261578852i, -0.14526522077805817 + -0.07183193702458866i, -0.1260524968373127 + -0.0644256441478028i } }), Matrix({ { -0.002183621023613252 + 0.102853014751932i, -0.2203724418296314 + -0.0779529604284864i, -0.017089861889171807 + -0.06465093613750658i, 0.006097325529776451 + -0.07029901019399272i }, { -0.007889864468551566 + -0.0833040767583927i, -0.0025161985839019184 + 0.10072987261822873i, -0.053297472066327206 + 0.011001579435549549i, -0.08090808125417549 + 0.12857782373862142i }, { -0.12557035525512072 + -0.16921089004699053i, 0.013990764143074238 + -0.03153393177354961i, -0.053320706514714857 + -0.11944760330068585i, 0.010056928204855167 + 0.009505169957641673i }, { 0.025231488721766025 + -0.11752255283733018i, -0.025930883634409093 + -0.053559481350176644i, -0.10994019828053551 + -0.13925002264842565i, 0.12565823845704616 + -0.04761751864868959i } }), Matrix({ { -0.07386722208117032 + -0.05008496113864113i, -0.01895296007354048 + -0.08180316399925858i, 0.00042128666714649337 + -0.19420407553081026i, -0.0208690848318453 + -0.14391989269598637i }, { 0.033612700723580705 + -0.08234877599919821i, -0.022009614591327362 + -0.10838227830427646i, -0.13864826011989148 + 0.022892495082578363i, -0.11863973052996873 + -0.04580023202218045i }, { -0.05734553847087909 + 0.03325528704742766i, 0.07449538088074507 + 0.03977270273249829i, -0.021048408054090067 + 0.012798656611038628i, 0.03607071436067144 + 0.00021226475046960116i }, { 0.05139244585557944 + 0.033907289938191046i, 0.16961517647134935 + -0.11507352197312161i, -0.08346468809335805 + -0.06654958862237369i, -0.10650925805614311 + 0.010435440029486293i } }), Matrix({ { 0.0010039195115296006 + -0.14142185216669004i, -0.042829512967059294 + -0.020620951176849502i, 0.022520733831805053 + -0.022264751175007605i, -0.0156765271255083 + -0.0314321324103514i }, { 0.05277043528495769 + 0.007588102034920985i, 0.02448988878359678 + -0.16707758489233793i, -0.018572389956178218 + -0.002297787791865221i, -0.055737366106298716 + -0.05401566001342826i }, { 0.015229761210658818 + 0.05543160285014893i, -0.03689905658495195 + 0.027431931881499397i, 0.08001325995247542 + -0.13741749970830888i, -0.011541037202285291 + -0.08743401659428811i }, { -0.10144105944604694 + 0.11026482092840109i, 0.003650412228849369 + 0.04999528413544029i, -0.08943235200689126 + 0.029869642197283212i, 0.10368914849237243 + -0.14730106426483142i } }), Matrix({ { 0.09726284366408192 + 0.020438447183732885i, 0.03385625179532607 + 0.00974428055355167i, -0.015993414349838368 + 0.16261110905819898i, -0.05274035318938479 + 0.21701122350552074i }, { 0.0228057549824418 + 0.0669609855339854i, -0.007369124591996885 + -0.044189621090285174i, 0.12781874694088444 + 0.1452074884969652i, 0.10719255404738812 + 0.10775417468805439i }, { -0.05522940109600606 + -0.0007279019667222244i, -0.017833277266449444 + -0.21535473426835028i, 0.03712860886127376 + 0.09639155153175115i, -0.19607815005250911 + 0.01057091440524497i }, { 0.033232073380808955 + 0.0809123983759577i, 0.02222935763562463 + -0.028702664749875467i, 0.004775558651606273 + 0.013636270083988484i, 0.05978540049651944 + -0.13913923742868858i } }), Matrix({ { 0.10911317525927017 + 0.05642665510429135i, 0.0036159782961382066 + -0.09901252215663371i, -0.08285253674806628 + -0.12205666144075185i, -0.02236054739245566 + 0.15109200104467774i }, { 0.002476565387791084 + 0.1989999923616408i, 0.20278424978034879 + -0.037120571712377065i, 0.006176076158188693 + -0.051425950454670424i, -0.044667566889654786 + 0.06531662737308985i }, { -0.000856646890667198 + 0.07237416584996384i, 0.06380003009352733 + -0.18604712688587968i, -0.020237473936571878 + -0.10626087498817072i, -0.1157532223600348 + -0.127885631096267i }, { -0.10890577268887654 + 0.029303486724767146i, -0.038203754535741485 + -0.11028323035366729i, -0.032675324468180805 + 0.07793590360668103i, 0.14823548135455525 + 0.018261170741565996i } }), Matrix({ { 0.041759670552967615 + 0.15922047073022577i, -0.1799146251641127 + 0.08052294027700221i, 0.05790841201450372 + 0.09240889932098986i, -0.0096812715938034 + -0.10352317822861982i }, { -0.02905193979935323 + 0.011424123870922783i, -0.1183403700373954 + 0.07870198620869119i, -0.025789152882819258 + -0.06902719507424085i, -0.165591352941055 + 0.12046588036185375i }, { 0.04205905663131106 + 0.022564970538798187i, 0.10646592729146939 + 0.004357446652400453i, 0.028071556043282892 + -0.09015325145709416i, -0.04198113794130592 + -0.05021269757277758i }, { -0.033327225193663206 + 0.07892106675564721i, 0.04980494596974367 + 0.0006346065071800203i, 0.0018413415924735928 + 0.05894083346325818i, -0.04237847660712247 + 0.09872154208174069i } }), Matrix({ { -0.004996249285425578 + 0.0314383129927447i, 0.1418505096698135 + 0.00990716131119235i, 0.037506448110341824 + 0.06879325269142136i, -0.07595019166425067 + 0.06086286594762333i }, { -0.1348811321008995 + 0.06219789653742946i, -0.04487649741093443 + 0.10650188782447585i, 0.14740634603992642 + -0.16511468324005044i, 0.044659465539566054 + -0.08726010372387491i }, { 0.02722537603237015 + -0.065154075420012i, 0.000936568703986648 + -0.054999613505990544i, 0.018827058193036046 + -0.07423524446455536i, 0.044555165263669545 + 0.049358847559022596i }, { 0.057916209367490756 + -0.08964123694651273i, -0.08714811220667933 + -0.03731469432244548i, 0.02498082053434184 + -0.06680651178112529i, -0.08727161717598286 + -0.07768677521526145i } }), Matrix({ { -0.08848174655513569 + 0.023937494472274487i, 0.07136296036714701 + 0.18798166724114143i, -0.17861555014906627 + 0.14483604941115671i, -0.04558338275936064 + -0.1283914292340507i }, { -0.029095895520633453 + -0.040919773576271024i, -0.1360538040568259 + 0.024689662806970172i, 0.16047345345860808 + 0.047368576498279164i, -0.061723051938187556 + 0.09812503968178259i }, { -0.0265325750683391 + -0.01294641571870673i, -0.1237661996745022 + 0.18456614188389484i, -0.04334737152147551 + 0.08591714717293823i, 0.0500902777867608 + -0.022857560044169684i }, { 0.025527227551838057 + 0.03102947578444375i, 0.004505840451277623 + -0.07686164675864393i, 0.06283763251608594 + 0.08675857202046217i, 0.1815869399323568 + 0.01450821532062203i } }), Matrix({ { -0.022265992946114713 + 0.07787651096577501i, 0.08241551621971674 + 0.07628281615566877i, 0.025187449711586044 + -0.15408055887275218i, -0.16500416396780068 + 0.0899801083205835i }, { 0.1302646445724375 + 0.06335945251060054i, -0.055388387325023485 + 0.12476388424897321i, 0.16784430406254802 + 0.050747476180995i, 0.05588752189345702 + 0.012805875846402774i }, { 0.16728346615745324 + 0.09342141681224607i, -0.07721924108806005 + 0.09261955292010564i, 0.04766518117602145 + 0.011586340910114358i, 0.007616255482195589 + -0.06074204546746952i }, { -0.05897713378109176 + -0.09352238960675541i, 0.07024329735092211 + -0.018907459074780676i, 0.028924287646210627 + -0.050596290653855416i, -0.028706549416730995 + 0.037633915853279964i } }) }, { QubitIndex{ 6 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.25923749102476057 + -0.34787854851223204i, -0.28686185562246064 + -0.1568314258205987i }, { 0.11837787451501211 + 0.12923209864496402i, -0.007518718770961284 + 0.41262625430380684i } }), Matrix({ { 0.13672769394734616 + -0.05038506887751505i, 0.5125420825361747 + -0.33686500051478097i }, { -0.36032346481398736 + 0.03205608083627913i, 0.08187455626443467 + -0.2168642058771738i } }), Matrix({ { -0.020452620677115473 + -0.2901491671293489i, 0.04970004304452633 + 0.16025953444753316i }, { -0.0923137645598578 + 0.31405705469534134i, -0.2062311157475597 + -0.01295647693636282i } }), Matrix({ { 0.38560677558167133 + -0.5195836907753345i, -0.16118900676245054 + 0.090711157869262i }, { 0.13381088240193204 + -0.02539311348196878i, 0.43237234201023667 + -0.029625543692457214i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.100135434564655 + -0.03660684389429187i, -0.056370450864048856 + 0.13285390999984747i, 0.010920141557840532 + -0.10875264608199804i, -0.051305879815402064 + -0.04848250772286309i }, { 0.10428901007529398 + 0.04586657055011487i, -0.04923237470176072 + 0.0012654049159676027i, 0.014771968538186324 + 0.14128300580711106i, 0.15277876122027056 + 0.1126822488448331i }, { 0.10560783150375234 + -0.12757626100782885i, -0.1244953757273635 + 0.05938040247164393i, -0.04373604866733733 + -0.05908602027102285i, 0.03397352687752932 + 0.07661140628685696i }, { 0.08266049128227738 + -0.16478365424001393i, -0.05400463682250204 + -0.03406118563702007i, -0.12013324830548186 + 0.06911978370285858i, -0.07974281038706031 + -0.0892251333899605i } }), Matrix({ { -0.19141065858385042 + -0.04102497211878007i, -0.10674945382265685 + -0.021298833944263545i, 0.028522398134526637 + -0.015125318450589339i, 0.012993421928129117 + -0.05085340813211964i }, { 0.032504447539984355 + -0.12324206642296902i, -0.06267685683394005 + 0.15476891674543294i, 0.1154960212872838 + -0.0791563511298997i, -0.11114533398543827 + 0.002639491833671067i }, { 0.14233151542953335 + -0.01255930606041633i, -0.0657975657117816 + -0.13835299632808354i, -0.0806364014990638 + -0.11299045467289348i, 0.19489838444544472 + -0.11060652070183258i }, { 0.0363563042318067 + 0.005767224123018632i, 0.12510704019875757 + -0.15640373232689525i, 0.08534801006551078 + 0.12262609610189505i, -0.06471586723504588 + -0.07635475970213744i } }), Matrix({ { -0.1040820697533336 + -0.07692774168816974i, -0.07898247074645026 + -0.248205260926773i, -0.015822803655089045 + -0.10302032129886021i, 0.07885597166510244 + -0.09926233807525953i }, { -0.018626865607267416 + 0.15123636760785406i, 0.036687611862228284 + 0.08725645592279309i, 0.10075104210818694 + -0.08864737575892709i, 0.11460437497237073 + 0.12425623852082332i }, { -0.04734443172753529 + -0.047827898420900135i, 0.12443769903544476 + -0.04060457878203728i, 0.012277671635138395 + -0.09898786281670177i, 0.07445987555679201 + 0.14109480250012676i }, { 0.0027690182586162728 + -0.07075819122165865i, -0.13311122059853286 + -0.1295230845762356i, -0.1500990486142595 + 0.14613987409380075i, 0.05790972191824735 + 0.15552754880741987i } }), Matrix({ { -0.07529428120163643 + -0.015142477415676139i, 0.09782836078021356 + -0.08711572947235258i, -0.039420318366397755 + -0.019613802558723088i, 0.06441787430450949 + -0.03913102940361784i }, { -0.08113565415350846 + 0.06956326368342657i, 0.10941527281598516 + 0.116542054892474i, -0.0009178959599875082 + 0.012260231241203302i, 0.09909562769294634 + 0.058895220584588466i }, { 0.04124896319677899 + 0.006519463320873038i, -0.11998887655114683 + 0.05667993226952794i, -0.058319610000490046 + -0.05318284797180901i, -0.05067199083026182 + 0.022068505311129447i }, { 0.2316287524994307 + 0.0808553728031562i, -0.07989224778979374 + 0.1104324054548255i, 0.15398878186035603 + 0.0533562025265889i, -0.009911202432361802 + -0.0826747773701689i } }), Matrix({ { -0.14557066200449295 + -0.07264152783157685i, -0.10215108571352693 + -0.04241471174677635i, -0.1680929540144095 + -0.0033995096332332378i, -0.046650674757526545 + 0.03060434936798162i }, { -0.08981356300947697 + 0.010391327461238711i, -0.09311533640156859 + -0.009754064199983292i, -0.13214250886832762 + 0.004077215594229323i, -0.1713807557408929 + -0.18030653130495644i }, { -0.00739635518545382 + -0.06434544831480113i, 0.017515276893343635 + 0.05613559961003277i, 0.1189906615833458 + -0.06507109663191239i, -0.13612679300345068 + -0.02541296869696366i }, { -0.11360163679310163 + -0.06998864228432326i, -0.010232297159872823 + 0.10357642254865432i, -0.06872776708326113 + 0.15773656627808766i, 0.1463883698438461 + 0.016244567373822585i } }), Matrix({ { -0.045271779767581004 + -0.25777811623559094i, -0.0058900707800280516 + 0.09371709011611934i, -0.09427904238352162 + -0.07942711625954256i, 0.07996528329253126 + 0.015661782223599964i }, { 0.06839323829799458 + 0.17439428014852776i, -0.03730046916191408 + 0.0678685711049353i, 0.04313525543813856 + -0.13644255137423783i, -0.02673210435774684 + 0.014692969151423409i }, { 0.007700495030790003 + 0.15301853947394864i, 0.01486275135555843 + 0.019818703056768538i, 0.01652235921156059 + 0.07110621401698804i, -0.025544104387797716 + 0.03778192210235703i }, { -0.04608182252230075 + -0.06143882562961442i, 0.11238579182882709 + -0.1790561647544241i, 0.009509732682152536 + 0.03323102191540832i, -0.05156613314060405 + -0.015174285145036956i } }), Matrix({ { 0.02809248817734811 + -0.040481389838538176i, 0.019906399593183376 + 0.036922803371250285i, 0.2010255583677713 + 0.05854524361210456i, 0.09767826327003926 + -0.039131163517837235i }, { 0.06849374868895859 + -0.02951974428858311i, -0.08124096686391978 + 0.01655556830632116i, 0.2198460643148041 + -0.03274256115326114i, 0.061792105378643915 + 0.07059705516463774i }, { -0.019628784263338833 + -0.017312402172042888i, -0.07746855601369064 + 0.03806149178783176i, 0.11482980594619203 + 0.051297332556269996i, 0.2450598798430912 + 0.008766370993270805i }, { 0.1371213358171291 + 0.08553338884593933i, -0.006864510592903287 + 0.15910546831273675i, -0.03964975541318784 + 0.10011836788832687i, 0.011698110746512435 + -0.14671938211462365i } }), Matrix({ { 0.08570131257186844 + 0.040594936084315976i, -0.10490973107804033 + -0.08270934891177609i, 0.02870356947777653 + -0.09855233951168257i, -0.11795726537463228 + -0.0587629606340265i }, { 0.09411445771101287 + 0.07429579238954075i, -0.07797643760802503 + -0.0920492580494051i, 0.0956593392861759 + 0.0319570142984378i, -0.07810994422722303 + 0.07399650914719681i }, { 0.12117961351551948 + -0.048893101609875i, 0.07083226707051887 + -0.10675875999467536i, -0.05638920850703208 + 0.006065969543756117i, -0.01088550902334213 + -0.16663406834257294i }, { 0.12067415322057745 + -0.16238750785367564i, 0.007793351844189643 + -0.02813643975714532i, -0.116530123365116 + -0.049625285231452335i, -0.01681209520617699 + -0.0506590323969348i } }), Matrix({ { 0.04747001297721512 + 0.05581174013965152i, 0.07522426686173879 + -0.07715475388334093i, -0.036882883950160296 + -0.04998470472762135i, -0.03767413525978459 + -0.07478623338055222i }, { -0.012614060690236014 + 0.03375723311875931i, -0.07002435808883649 + -0.06095814954971228i, 0.042414432790974746 + -0.0021911975134848386i, -0.05665125414125042 + 0.05809263775821209i }, { -0.01026775690400059 + 0.013818581071348505i, 0.10751042027627644 + 0.11107735219052885i, 0.04821271959786493 + 0.021013588206999546i, -0.030845994816899595 + -0.14259713810119537i }, { 0.03947449385060702 + 0.13141221995447536i, 0.028067368158489873 + 0.0916217739074746i, 0.06572241697280541 + -0.09700588872085764i, -0.0915682196484572 + -0.015658813872765423i } }), Matrix({ { -0.0047266028763543145 + 0.09816250246220144i, 0.03740753301742245 + -0.004375716386048088i, -0.03354471010170486 + -0.15827478212909976i, -0.0028741387233073195 + 0.04606685359848714i }, { 0.08342435635064664 + 0.10136932029264399i, 0.01449522697281772 + -0.07747786242177625i, 0.09817043353240154 + 0.0379602546130662i, 0.1018494410517839 + -0.12164956517734649i }, { 0.08117376328117161 + -0.0725929464605967i, -0.12133511361245995 + -0.11310182697404249i, 0.12898727642995061 + 0.1395426991178079i, 0.04929050729232106 + 0.06398520022338824i }, { -0.019250043596280384 + -0.16981288860540084i, 0.06809741704418573 + 0.08434919701206156i, 0.026433933741716563 + 0.07483160380754704i, 0.008738061197415433 + -0.10839597048964725i } }), Matrix({ { -0.01892844729133167 + -0.034758130223529034i, -0.06278891038664237 + -0.055712207162205964i, 0.055400625562191455 + -0.07960930292438785i, 0.05248323245778138 + 0.07222344256444922i }, { -0.054821209182470555 + -0.19216085627500148i, 0.042798447897208027 + -0.1018766507966076i, -0.015467497465840684 + 0.09346434048195942i, 0.04719156123654056 + -0.10507436882703589i }, { -0.06783713195398286 + -0.011524220840437834i, -0.09529227601404822 + 0.20353206404554267i, -0.07753242626912259 + -0.10363591916693696i, -0.038604222357198334 + -0.05102830011320646i }, { -0.013573122074428382 + -0.013071443824262407i, 0.09704803537108529 + 0.030183982953848342i, -0.023622612762512027 + 0.17291166003992217i, 0.03402202189382182 + -0.21577663458902313i } }), Matrix({ { -0.09641000497925094 + 0.06260819351367361i, -0.011726046757200063 + 0.022687738379025664i, -0.08178569564392117 + -0.12512415855319486i, 0.03342827798040677 + -0.030795752741064133i }, { -0.16191509341839866 + 0.04886546276645049i, 0.0947469771164653 + -0.07806682380304986i, 0.20154633351487564 + 0.07961402609496177i, 0.15558679698860264 + 0.050523604362773124i }, { 0.001076152827620387 + 0.036409530090966306i, 0.06470416102049215 + -0.024348794725690057i, -0.18773710673817218 + -0.00923141683353359i, 0.13238186670415975 + 0.02652043934216256i }, { 0.03788188345721919 + -0.0574052537507292i, -0.0943327659431716 + 0.07230651057931833i, -0.033462698212494764 + -0.012673194273086415i, 0.032364995605519684 + -0.12468919309739782i } }), Matrix({ { -0.04770898417322942 + 0.03750308497842876i, -0.06121904130605153 + -0.05019263116229068i, -0.03338408485731821 + 0.027468937323954272i, -0.10621017741038846 + 0.001294912897089007i }, { 0.01763415225507338 + 0.07411685125537154i, -0.08800790268338342 + 0.07318564105932025i, -0.10622427908739944 + -0.07094207147271507i, 0.018588065392468545 + 0.1089934395021152i }, { 0.03295448484590366 + 0.04930442652170926i, -0.09273133733865473 + 0.02670298343934887i, -0.07733075489617125 + 0.09116761621140776i, -0.027081112330653953 + -0.07693377372683105i }, { -0.1638235740999498 + 0.12492966372342652i, 0.03781071691386808 + 0.03171867362566441i, -0.07213580898072708 + -0.1658525767220692i, -0.009370391272600804 + -0.1658063135253929i } }), Matrix({ { 0.010998148928284813 + 0.07119903103030452i, 0.056698844000890466 + -0.013376037738621846i, 0.009908258428919391 + 0.023079380487122568i, 0.048408632280275886 + -0.11471414207768883i }, { 0.03640797862340331 + -0.02327146842527538i, -0.0021779192125903866 + -0.04696736811809375i, 0.03537684089592806 + -0.06833838397912975i, 0.09117055676121531 + 0.07379781186068685i }, { 0.10372425072165888 + 0.09511107122682103i, -0.22296589056303961 + 0.12718181785254612i, -0.03349133683664407 + 0.16264879785362416i, 0.10890390633755583 + -0.02957911691803379i }, { 0.2227057706277312 + 0.012456888805249663i, -0.014947888083217389 + 0.13936345501570768i, -0.059682267957351 + -0.018511727313077316i, 0.09753412821737868 + -0.04047096620894683i } }), Matrix({ { 0.06314954081727049 + -0.07323094865525362i, 0.05214780581954628 + 0.08412696499713156i, 0.04861360013818829 + 0.0012940711240438502i, -0.1287394599534142 + 0.17512935681347624i }, { -0.06471015742868247 + 0.0257796666305832i, 0.11708716735516465 + 0.08302433517882805i, -0.0470504757162491 + -0.01693423920561313i, -0.012078895450949359 + 0.10969737253532402i }, { 0.09390876743917899 + -0.009927129831671324i, -0.029512777637183563 + -0.019520698103154616i, 0.038118910911084915 + -0.058425355166621125i, -0.060704049356824476 + -0.04622477147733795i }, { -0.04319058792431474 + 0.1530811907148263i, 0.044157222557129186 + -0.002156808008776981i, -0.06561221059823 + 0.02916147662796451i, -0.12970233558401695 + -0.10838688706554742i } }), Matrix({ { 0.013335029296894186 + -0.12320692693406263i, -0.1766637342725456 + -0.05059197743114695i, -0.08637841238432449 + 0.10535300926469847i, -0.031100380064761637 + 0.02321288179477583i }, { -0.027315171353595066 + 0.01640758020223484i, 0.006257112978708192 + 0.055249907702046464i, 0.031266095779785334 + -0.05399678015064316i, -0.059362436017864124 + -0.05441589607118718i }, { 0.03027024361386511 + 0.026582607561255873i, 0.04022367299211366 + 0.07794390413284248i, -0.21928153517657037 + 0.026520571901643013i, 0.06263721511406928 + -0.040445868232289295i }, { 0.11021566066305165 + -0.0672102808763935i, 0.1941709926304696 + -0.05852080074022633i, 0.006131950858346762 + 0.06448386017248472i, -0.01552639811709275 + 0.10760622878060397i } }) }, { QubitIndex{ 6 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.05412269399983849 + 0.02375683143000473i, 0.06219708953146796 + 0.1339142417019124i, -0.07101151139755058 + 0.0677085634136791i, -0.09471783782507665 + 0.030673257615269883i }, { -0.03240718552195914 + -0.19646356141441312i, -0.010624997884297625 + -0.003767651925636436i, 0.031571136295680896 + -0.053916511490021087i, -0.15973848464257362 + -0.11162485585512157i }, { 0.046615168718975475 + 0.07089383830248487i, -0.06491648120768537 + 0.0022394586478155206i, -0.019409196398031913 + 0.10788166302850882i, 0.045590015234511824 + 0.045501119362737395i }, { -0.07626439455137113 + -0.12680163739697559i, 0.030108328213748918 + -0.0466476700308158i, 0.11089282915468039 + 0.03028041013957926i, 0.039128731805299896 + -0.0538266774207537i } }), Matrix({ { -0.018216507795919545 + -0.027600788336105065i, 0.06802740581974538 + 0.0752117661498719i, 0.028889261956715945 + 0.06202892862314829i, -0.04876105662022579 + 0.035050299268469004i }, { 0.03509963424853961 + 0.14276999535453708i, -0.10429596633584723 + 0.12990094198822916i, -0.011656907764629345 + 0.2888079603389891i, 0.13705952185146733 + 0.049149215537947634i }, { -0.11625744811229102 + 0.04373114436800656i, -0.04789621510912601 + -0.05887751919829308i, -0.02346044128173761 + -0.025333688965132946i, -0.047454461615179216 + 0.04175993706199177i }, { 0.0854394740628835 + -0.0010208467434987757i, -0.04054471117071771 + 0.04556233812522398i, -0.11653793124542551 + -0.026698772982472464i, -0.05879852398003488 + 0.09071828889275507i } }), Matrix({ { -0.12690713333890277 + -0.02377472159173218i, 0.0779654706831799 + 0.10058735500051691i, 0.08145918103614012 + 0.016044024990691828i, 0.09196889459080168 + 0.19960374912180961i }, { -0.05796198957957815 + -0.1812539406661853i, 0.016850917726295454 + 0.14008226555729453i, 0.01838688625787157 + -0.029085239819075556i, -0.06328602425990565 + 0.05645417290507357i }, { 0.031429631081267596 + -0.051276581329528254i, 0.08573654132917358 + 0.021441381061592005i, -0.02101482351866736 + 0.026399732750614125i, -0.24490852787873213 + 0.10731649650441333i }, { -0.05358305112966226 + -0.12745552622047027i, -0.06344632293238626 + -0.16378748516032085i, -0.05647067525858411 + -0.03510743477051951i, 0.0806117019834452 + -0.014074342286944878i } }), Matrix({ { -0.010669981803688304 + -0.05790991519407469i, -0.12792595322135328 + -0.0004683580479436511i, 0.10619028660526855 + 0.11669507732649463i, -0.019937236733507016 + 0.04891511857191749i }, { 0.09211965997850534 + 0.14055735012420947i, 0.028779534628879003 + 0.10661465421401263i, -0.06354033120124851 + 0.008458091514854882i, 0.00730397103578519 + -0.04006599907835732i }, { 0.11846340772975919 + 0.16066478750356228i, -0.0036274834151781093 + 0.07059637111776873i, -0.042841850669959484 + -0.03451805889275359i, 0.08165202102987765 + 0.034711928880076126i }, { 0.03084578417330429 + 0.014215882495526301i, 0.03434740960677556 + 0.07372108340757694i, -0.04149180524466793 + 0.01693862807783656i, 0.034487786658343636 + 0.037660792579356485i } }), Matrix({ { 0.0347325325089155 + 0.060060207565141646i, -0.17365264674448544 + 0.20709310884852702i, 0.1699868772505615 + 0.09366263776679208i, 0.0719365446914993 + -0.17141958298227178i }, { 0.017769418201255154 + 0.21160699152296042i, 0.12609446528715143 + -0.1639145219417108i, 0.029798557143259036 + 0.16988004763749134i, 0.053504811485616977 + 0.03760654980516601i }, { -0.07685667021392172 + 0.029115245118248777i, 0.018456782006576425 + -0.05435922940107308i, 0.07724684624403487 + 0.24004647931356596i, -0.0948797406881668 + -0.14478952875233783i }, { -0.0995861208943125 + 0.018456517084700714i, -0.06318807938908352 + -0.05636718427166683i, 0.10970164344663677 + -0.09652446052512571i, 0.05836917649114703 + -0.1749019670909243i } }), Matrix({ { 0.034484733087649044 + -0.07244721601554673i, -0.0708389662626961 + 0.05816853115800511i, -0.06900808891781181 + -0.02460473961363643i, -0.06273567237343082 + 0.059218908379228205i }, { -0.01648333875572453 + 0.03948841321259415i, 0.005787292094629857 + 0.00278634513993931i, -0.04914556728724848 + -0.144040797349161i, -0.03429741198342383 + 0.08743234683479963i }, { -0.10333415776107392 + -0.12235894860947359i, -0.1542559013141283 + -0.021350968983020677i, -0.13341138082079 + -0.114866233723718i, -0.1105038583381309 + -0.15417541125280632i }, { 0.051431603082721315 + 0.013483720866880695i, -0.1116945204386703 + 0.05673537029390664i, -0.18101483791108589 + -0.08383986790398437i, -0.0754451835159582 + 0.0036218438604778006i } }), Matrix({ { -0.13564608368662068 + -0.012726536998487676i, -0.023906037853109848 + -0.08992946568464427i, 0.1271327544441142 + 0.014463923939353179i, -0.16514524391296562 + -0.03235645369152417i }, { 0.0360393258239208 + -0.07066907037835994i, 0.005069720692226982 + 0.12972986065079584i, -0.0705677495079445 + 0.0360804664009785i, 0.022344331936584753 + 0.04104030051429093i }, { 0.08742746379446834 + 0.07065721891686663i, -0.012039398543775453 + 0.03638396608492368i, 0.03937655614333539 + -0.0538575344061654i, -0.009122062868744066 + -0.15423224891241663i }, { -0.05939988623909747 + 0.2047828648968728i, -0.07045282486788394 + -0.15615479427156123i, 4.7487482243085425e-05 + -0.015715475290008895i, -0.227056941202822 + 0.05212557952678991i } }), Matrix({ { -0.06033234407796107 + -0.11212685385346272i, -0.03931886439212344 + -0.14061646550641302i, 0.09900621903396054 + -0.032167633382256346i, -0.06111911153090734 + -0.045488836961811545i }, { -0.09785867870399556 + -0.007396625682326907i, -0.022541395428023463 + -0.1174465885782982i, 0.19860306523038612 + 0.08996401155586602i, -0.0620176556569883 + 0.14929388911932395i }, { 0.09581211438094651 + -0.05136529595641991i, -0.1285429867351763 + 0.029226262576014597i, 0.15521139418169624 + 0.02571030418105875i, -0.06299467956156429 + 0.19853900464365357i }, { -0.06756730787320775 + 0.18794102434398915i, -0.019047733603275406 + -0.16148489495371213i, 0.033948130446817326 + -0.016090288910326236i, 0.047187371361642895 + -0.14081537700938365i } }), Matrix({ { -0.14650391114627329 + 0.08558172452934112i, 0.21309229592658174 + 0.12627932448794887i, -0.02865103928373214 + 0.018906876692670414i, 0.03454885570610152 + 0.047504106206395155i }, { 0.09131049300872526 + 0.12138743477923603i, 0.06975049165852394 + -0.03994673681629158i, -0.012573308945523451 + 0.19369761470567942i, -0.032845559396937465 + -0.08271217159866144i }, { 0.021804631033904353 + -0.03673530184508547i, 0.009701723919408198 + 0.020851399490595012i, -0.07711835213452248 + -0.0751490972903952i, -0.11812774169275735 + -0.07421819672601919i }, { -0.032623184818727884 + 0.02887309480258503i, 0.021675193748644787 + 0.012488042452125989i, 0.1003470494297579 + -0.002375180662644062i, -0.004405034542929973 + -0.03543607361935522i } }), Matrix({ { -0.03321868902983631 + 0.1693948496841874i, 0.023924093907655014 + -0.08991854344417251i, -0.02430235823160541 + -0.0844698391803354i, -0.06716434145340465 + 0.05581827789969931i }, { -0.0436985184078408 + 0.03114974614767737i, -0.15268277759309634 + 4.2434393018486476e-05i, -0.12742472105288344 + 0.12680366127672837i, 0.004587726450133619 + -0.0511468779315252i }, { -0.01561940683137401 + -0.10046707384466216i, -0.12911434023854762 + 0.17980753863918228i, 0.01614977788042309 + -0.005487925408090013i, -0.08190327733500204 + -0.0011369762771495074i }, { -0.009247617406065337 + 0.08579074259964242i, 0.020997634744398044 + 0.044089963159487704i, 0.04236258085746757 + 0.052120601224093066i, -0.0030933953149503823 + -0.0353402694771876i } }), Matrix({ { -0.05222032310242799 + 0.009923706415955275i, -0.05856058772928919 + 0.15600265719341738i, -0.013051648701101107 + 0.06745754046758917i, -0.011493970131513159 + -0.14957075963062685i }, { 0.14023038192502174 + 0.042139941014707506i, -0.08645051111195962 + -0.0026970327826456634i, 0.038030819748036036 + -0.06339871552071234i, -0.00872116461481808 + 0.08158823307376871i }, { -0.11373496420285638 + 0.1239722727701781i, -0.0501184419771196 + 0.09719157691780689i, -0.13218749806519264 + 0.00218920722140645i, 0.05373810354251175 + -0.0896984334790305i }, { -0.05215185192272738 + -0.018357882696798774i, -0.09772872874973519 + 0.14589711649547976i, 0.039672485420547715 + 0.051935878974050005i, 0.02401609019352176 + -0.07015216493683327i } }), Matrix({ { 0.0007436420142040614 + 0.0060748799331549865i, 0.05731397970493259 + 0.10331024162955967i, 0.03894402957939053 + 0.004286411520722517i, -0.13099434409649804 + -0.07053228189412344i }, { 0.05476656700050874 + 0.04321090875863557i, -0.07701841982846866 + 0.0015076087450561929i, -0.13199033779749764 + -0.024303369956132255i, -0.03626827382347438 + 0.0019744767699736245i }, { 0.013520752495126579 + 0.1068646794458194i, -0.012132648316404296 + 0.1268513860511916i, -0.04216964901641267 + 0.09002630909865944i, -0.09367329020156309 + -0.13277639856346496i }, { 0.0405041706546477 + 0.001057732498974749i, -0.05892358183694731 + -0.05517622026914983i, -0.17632509913607286 + 0.08228871411427632i, 0.01888125664574653 + -0.06669675710291852i } }), Matrix({ { -0.05636316303519868 + 0.010414077499406676i, 0.04197582711567539 + 0.05750647082175503i, 0.06470875760399918 + -0.04986178697424264i, 0.0589180007753449 + -0.009812384560103884i }, { 0.07459929685120979 + 0.02966333532713733i, -0.01683941627927013 + 0.1608841107597731i, 0.01424045813519934 + -0.14009011582105835i, 0.12427589622176183 + -0.10403156448979263i }, { -0.28094332966641006 + -0.05103678610071513i, 0.008551697159324302 + 0.11568220069523301i, 0.03817417542320839 + 0.13329150867228273i, 0.10780384459920271 + -0.04237923672263781i }, { 0.06741524375264327 + 0.12212063274192082i, 0.18273108205077435 + 0.01586278913538126i, -0.1951941734916174 + 0.017427338093386903i, 0.0633345783550015 + 0.08275507261646971i } }), Matrix({ { 0.189771162068877 + -0.035749631262411645i, 0.10472768306041008 + 0.0959731329625677i, 0.07670403069963525 + 0.016273404826922803i, -0.05352963395162991 + 0.02062425429860041i }, { -0.012928553560597189 + 0.10892541291453772i, 0.16966795578471142 + -0.005172218539999252i, 0.04594581890190804 + -0.009051933416825666i, -0.06445046920687246 + 0.11248910641259778i }, { 0.11667601553452255 + 0.07715334195317812i, 0.04328945072359503 + 0.06931292209169665i, -0.1610873390784688 + -0.012444351887552286i, 0.04154846200689117 + -0.06725912994311276i }, { -0.04851649477997602 + -0.07932157275676734i, 0.03646086861765361 + -0.043283390925524697i, 0.0038827517809737564 + -0.06036899831551267i, -0.08111528668827703 + -0.05848544298646719i } }), Matrix({ { -0.049248441290158866 + -0.02869875331165099i, -0.02800397923846254 + -0.06596933443622426i, -0.02635140734792742 + 0.14938790236394117i, -0.13510649805364955 + -0.06090617916905769i }, { -0.04341350339965195 + 0.16962721713281864i, -0.0031019324471025416 + -0.038524041525605845i, 0.06062445715915926 + 0.10664123683916434i, 0.11850919378260377 + -0.09636116724205186i }, { 0.1063602844767393 + 0.1194003170277235i, -0.09696647231227393 + 0.07757592294993829i, 0.03325599800757667 + -0.06593544638151148i, -0.05123318133800035 + 0.13016492808284735i }, { -0.10553243079909858 + 0.09780412507892558i, 0.04440997588196805 + 0.07658705751768238i, 0.06657703529644281 + 0.018279879483818016i, -0.07075483354128695 + -0.08808162314236424i } }), Matrix({ { 0.01911518545226668 + 0.035118443543574344i, -0.08299077904975449 + -0.0006666579662814233i, 0.014886338175918336 + 0.10132237101316305i, -0.038324770568787386 + 0.073705213777424i }, { -0.09557198316458565 + -0.050872454413668035i, -0.11269726887670017 + -0.08339849104523582i, 0.016790550828097165 + 0.10872593852532808i, -0.024080708115077416 + -0.08010219551667523i }, { -0.07095901806137014 + -0.045793349258481095i, -0.06626963091864098 + 0.05679655080847431i, 0.04663935325427267 + 0.05683701762564761i, -0.05224158647044569 + -0.004220582698461181i }, { -0.02870057485138134 + -0.017260781386239328i, -0.1523372850209053 + -0.0200570721819545i, 0.11239986789540989 + 0.17477238586261865i, 0.02148829686392225 + 0.2275728294877965i } }) }, { QubitIndex{ 5 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.08866890729310994 + 0.2914606677455805i, -0.4253897755347834 + 0.014328381883154162i }, { -0.3239404518243701 + 0.3866498219821593i, 0.45115971274311717 + 0.28600284754499367i } }), Matrix({ { -0.05320241355304407 + -0.2819072327584782i, 0.3693577572988567 + 0.02338502035278077i }, { 0.0062366033685089806 + -0.34473544604459316i, -0.15571456039950266 + -0.3107927869293503i } }), Matrix({ { 0.012791023553107801 + 0.28403615084597233i, -0.09644041087492648 + -0.0492686021411084i }, { -0.17525200067503394 + -0.2725491713663673i, -0.020804707363059144 + 0.25771598531776807i } }), Matrix({ { 0.30327309491239024 + 0.1439556050872352i, 0.14311084944696592 + 0.3254370208612548i }, { -0.37851757119932194 + 0.09879067433087022i, 0.206375338700708 + -0.16770529273570833i } }) }, { QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.20119415205385272 + 0.4129968257392787i, -0.29624218538814867 + 0.5034185536124842i }, { 0.2460968988513073 + 0.23417047457474963i, 0.028948049383153984 + 0.07209620972380656i } }), Matrix({ { 0.02421186051169546 + 0.006922133189073403i, -0.08336458617253364 + 0.23797253291552153i }, { 0.030320038736078962 + 0.15156728284904727i, 0.24622478619493263 + -0.2594192771945163i } }), Matrix({ { -0.2534807297247886 + 0.10554775641394316i, 0.10067845308229251 + -0.07701571307197158i }, { -0.13935670147793205 + -0.1645362768432492i, -0.46735705024546564 + -0.05260584656455287i } }), Matrix({ { 0.049252237353656955 + 0.3314096642607805i, 0.029159922262314675 + -0.44065466015813975i }, { 0.43328853242541343 + -0.4765989693380196i, -0.15634367764238621 + -0.06738807374162642i } }) }, { QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.1563611972368717 + -0.008112318665580083i, 0.2789774664315548 + 0.013669240108477655i }, { 0.2823605479153906 + -0.24068644640017559i, -0.10237864342754387 + 0.1880726753987976i } }), Matrix({ { -0.16190599783916107 + 0.07284475008260485i, 0.3579055364694611 + 0.3997470585194999i }, { 0.5988655824640202 + 0.08132678521718299i, 0.09726522478054433 + 0.041780648462863265i } }), Matrix({ { 0.1602765351419044 + 0.009959244912150545i, -0.3107801686973608 + 0.04202291011548763i }, { 0.48793864139949017 + -0.12627485432068744i, -0.17834137494043428 + -0.1314805588496527i } }), Matrix({ { 0.30097227239416724 + -0.1014234900086055i, 0.14975286595410336 + 0.42102437098813683i }, { -0.2421470157677656 + 0.041599987721129376i, -0.4457372838417518 + 0.17669065406310397i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.0938687004596166 + 0.000878957968346801i, 0.09233000155833956 + -0.03308140446364747i, 0.06966634744587125 + -0.1356783979189423i, 0.0297844528824411 + -0.06001796039055287i }, { -0.06699601042728717 + -0.07818734730807073i, 0.030113892475189363 + -0.1235086767902425i, -0.11228196613878537 + 0.05016934007840284i, -0.15112603153570808 + 0.03439844061997159i }, { -0.011850060237484973 + -0.05590175129567641i, -0.06336117980880684 + 0.018876448163030274i, 0.08663821151000271 + -0.025171994053623727i, -0.02901071793864307 + -0.01310694538457665i }, { -0.08099429262175366 + 0.0936721986704333i, -0.0073272119326173385 + 0.0015649327621650058i, -0.12677937934876526 + -0.03215386347397959i, -0.05399968101558132 + 0.009668108764372267i } }), Matrix({ { 0.08699770592356235 + 0.019714235188199696i, 0.012060411512445057 + -0.06485200167479424i, 0.06033887020642375 + 0.1403255906660274i, 0.2218965579956167 + -0.056584413818253826i }, { 0.06790957727914533 + -0.12211513617729594i, -0.1723293258679716 + -0.02660122696952669i, -0.0616374466953365 + -0.10779808064104926i, 0.06450648094675941 + 0.00044211127482339383i }, { -0.20357086694642046 + 0.16884792293351525i, 0.09292738794677281 + -0.18006072016671262i, 0.09409366700323316 + -0.05155188078826547i, -0.013371659254961575 + -0.11718860464066767i }, { -0.012831972788518045 + -0.12635675565984816i, -0.001740671410130018 + -0.10703916056455044i, -0.016774106977400886 + -0.047645562155043224i, -0.09844620214638665 + 0.027040321392072058i } }), Matrix({ { -0.018688375248735706 + 0.12010920038645782i, 0.001221366959663647 + 0.02026987074961704i, 0.0671530110600733 + 0.1307559254065297i, 0.1404849776400462 + 0.046595450108216085i }, { -0.06466754484302722 + -0.024140489797774375i, 0.04376886213686024 + -0.04124414249732528i, 0.18213565953521813 + -0.06460525310514696i, 0.07707309563178336 + 0.11402915160252186i }, { -0.09113918011938127 + -0.07909189282482751i, 0.013953740556607218 + 0.05828420000640098i, 0.02457394699556015 + 0.053470481121059336i, 0.058436708647729575 + 0.03347407921153839i }, { 0.06149696332051372 + 0.0849252729907936i, -0.0644986805626069 + 0.12464184462070434i, 0.12724926476847406 + 0.08240633578153772i, 0.009346257391640755 + -0.11730485441746376i } }), Matrix({ { -0.12649769518945359 + -0.13902821728927023i, 0.043334319261976444 + -0.015157338398954617i, -0.12839819027570235 + -0.014964893200011204i, 0.09827296622216368 + -0.21197058568271884i }, { 0.018176621491701975 + -0.054068863517301724i, -0.029053049985715302 + 0.055606348079835624i, -0.039934381327329634 + 0.12702379338975486i, 0.02619946808156201 + 0.03980184352278126i }, { 0.08758117809385153 + 0.03322918402790135i, 0.040305468250182275 + -0.009944120194857716i, -0.03378267455245927 + 0.042582392389140696i, -0.05661942735238345 + -0.064820978023076i }, { 0.18946182643976975 + 0.06608115307114035i, -0.014568165360357318 + -0.07585936722901i, -0.09371692557235943 + 0.0032442937844605574i, -0.05529730357814593 + -0.14766239092817057i } }), Matrix({ { -0.011383341738954075 + 0.12982948820516155i, 0.08029769448796599 + 0.1907989961640216i, 0.1058095816627719 + 0.06886230291433396i, 0.03835983665878712 + 0.014767165000821503i }, { -0.11271063463542802 + 0.06778296523715374i, -0.060632451651502675 + -0.061502147077391156i, 0.07672560867006814 + 0.05287723741842035i, -0.06131033044454563 + 0.007298330415786419i }, { 0.017005140689699445 + 0.11825385730476508i, 0.012448849347163919 + 0.09778360888774915i, -0.23887345283005473 + 0.038427371900573735i, -0.07424632807616523 + -0.15250721424887229i }, { -0.09932439785758908 + 0.021636403794967153i, -0.049572509400551384 + -0.007508394777392164i, -0.0582557582347795 + 0.13058599689119396i, -0.053540069361045765 + -0.08368998964276719i } }), Matrix({ { 0.042976850401518996 + -0.0869735434192397i, -0.11710834993071835 + -0.06468410537194572i, -0.04030136894690571 + 0.06300549122237212i, -0.09237130317950379 + 0.04651389267030128i }, { 0.0004496978102606018 + -0.030783851644819806i, -0.057462791000444255 + -0.020647921174476076i, -0.03324705813355107 + 0.22135393356899222i, 0.15889004149205707 + 0.09617116811478403i }, { 0.11405624289850634 + 0.22762935219291777i, -0.10047266351901184 + -0.005422065752745974i, 0.11454456792493749 + 0.042724713268104106i, -0.002189787836697995 + 0.025932741998213986i }, { -0.04263277454104958 + 0.19754863504762887i, 0.027437532634256995 + -0.029166391678309526i, -0.07972414147203775 + -0.040524841892216786i, 0.08316155980711833 + 0.07774431681806211i } }), Matrix({ { 0.10639603811715485 + 0.024927390386514665i, -0.0455157537280908 + -0.058752365709164214i, -0.0766966238865326 + 0.027792559118593494i, -0.05617586732491716 + 0.033546667214613565i }, { 0.060286692963988406 + -0.006622297997705195i, -0.13026146772359748 + 0.035728437752467215i, 0.006343509596911336 + -0.04643037789257976i, -0.00447209396166077 + -0.03980995357480992i }, { 0.07848935698285803 + 0.10566560893828411i, -0.09709475905044739 + 0.007460319245809114i, -0.0858587612643911 + 0.06352873122008293i, 0.05696971587126739 + 0.07638373739443247i }, { 0.10776887702796785 + 0.023318486972252486i, -0.08166068858262908 + 0.06705342569772967i, 0.0268742089232579 + -0.14598242358846647i, 0.07991917159979614 + -0.09336497359719244i } }), Matrix({ { -0.0001802157070884871 + -0.09553158784591573i, -0.04477418059761428 + -0.13030953354216915i, 0.019698649441886776 + 0.08501186192217006i, 0.07433712582825491 + -0.04172175434690622i }, { 0.0994533116060895 + 0.025268897835616044i, 0.11251712106461076 + -0.02688440924415617i, -0.04753061530759198 + -0.03817516531964896i, 0.1373026549274843 + 0.07327469944762553i }, { 0.07418426199828847 + 0.13154678886861246i, 0.040623154492771194 + 0.08214301481608595i, -0.06478435876525647 + -0.0016526130446295052i, -0.11044546291698928 + -0.034643356273180964i }, { -0.08887296985075678 + -0.09682965169762177i, 0.08497321865296203 + 0.04635503673806554i, 0.13080465350888573 + -0.1378145241456452i, -0.11154623313332916 + 0.23266513093359267i } }), Matrix({ { 0.02830736558704062 + -0.08735742664153037i, 0.04569802655204794 + -0.1274097753772977i, -0.06402938040350903 + -0.10184524777364562i, 0.01146306540628476 + -0.00758946144609614i }, { -0.10809809951293275 + 0.012213953064663588i, 0.0862793719890984 + 0.03539335152804076i, 0.003066697393829812 + 0.0350399974828474i, -0.007697683998978405 + 0.041177591022726154i }, { -0.031630504856137207 + 0.02516553440937249i, -0.10887292447284624 + 0.1497297042604465i, 0.12778234762824422 + -0.021939253198303022i, -0.09192808932186117 + 0.050848264100319354i }, { -0.020169304496852645 + 0.08806845509890975i, 0.04727237946761635 + 0.12683719125756213i, 0.06390833565892552 + -0.19686313974648628i, -0.05620888751018489 + -0.13561249753590518i } }), Matrix({ { -0.05034814351278406 + -0.1659713326578031i, 0.16608701052217678 + 0.10083503997276684i, -0.1368260254708493 + -0.0679956192698686i, -0.04457380997007834 + 0.008543334473393501i }, { 0.10070071479201397 + -0.13405394588214634i, 0.12878880929699457 + -0.17748534286295858i, 0.15897999668751864 + -0.017739260729405213i, 0.07354425700163847 + 0.023651147143522046i }, { 0.10105418480512406 + 0.05811161514974213i, -0.03859912746321734 + -0.07153530399068639i, 0.01584728324668189 + -0.11273929729332154i, 0.002672945549310981 + -0.04173191703281538i }, { -0.0038980762887936 + 0.034706824979696356i, 0.10878918810909789 + 0.054482281883737486i, -0.18202337974814806 + 0.09772019603528945i, -0.002919787374414782 + -0.040234262706641766i } }), Matrix({ { -0.021190889777180377 + 0.07352366162359078i, -0.015305835094764122 + 0.17617899489739014i, -0.013269008432816403 + 0.020199454426501635i, 0.24011976669252202 + -0.07468247251859975i }, { 0.11396691264598921 + -0.16886303336830272i, -0.07337439661792598 + 0.019023865867247455i, -0.0182927455798658 + 0.06014114955956423i, 0.12955411950609588 + 0.07039707177969853i }, { -0.08111907179600239 + -0.03748829694629509i, 0.05696092601616493 + -0.018453277846175353i, 0.056375233175626496 + -0.04456477400301757i, 0.04357748959799022 + -0.018618556428617115i }, { 0.030014862768917582 + 0.03487614539144411i, 0.11723110552727012 + 0.06295963122383126i, 0.006337135866452488 + 0.03424927532348382i, 0.0727178428776415 + 0.04577698894784927i } }), Matrix({ { 0.0445594423246238 + -0.11328225186466531i, -0.06122917133780088 + -0.09034074505943637i, 0.08154030682163203 + -0.03881888708996015i, -0.1463838562920237 + 0.09247259430052618i }, { 0.059525970963102276 + -0.04298920507008932i, -0.1498584324822618 + 0.07533340541386417i, -0.09867572274516044 + 0.0528434635192456i, -0.05822849575494112 + 0.06596155348278822i }, { 0.007290683296458415 + -0.0064019150714048605i, -0.040070819154189405 + 0.013288561934115413i, -0.04543558446958519 + 0.10310201668273176i, 0.0890727426161965 + 0.02661402939838055i }, { 0.02455122411690733 + -0.08238642711247676i, 0.00019454080449178202 + -0.05420168207960164i, -0.0402590832378815 + 0.005024630632204472i, -0.039357995824129806 + -0.020981768721055765i } }), Matrix({ { 0.061711674516733275 + 0.08330315922866774i, -0.007847995743090879 + 0.008493154080062659i, 0.04933795493384271 + 0.12328545806766994i, -0.0375443613694318 + -0.06642202019685427i }, { 0.0035500036782214577 + -0.268103829911094i, 0.1184662994564747 + -0.08413802966850722i, 0.08434103417088043 + 0.04954478675523269i, 0.023350110636750028 + 0.008011827196494325i }, { -0.054903921501789604 + 0.07258917934398942i, 0.08968851147783556 + -0.1669480234929526i, 0.07256540982067305 + -0.033474100397789i, -0.03994297517111197 + -0.031502071651284755i }, { -0.1055828174201385 + -0.11902086451255504i, -0.14362582140067354 + 0.033473929261904616i, 0.034720996140972904 + 0.07385555373190185i, 0.0255430149726043 + -0.2893087741565926i } }), Matrix({ { 0.04381642920428358 + -0.02902793249367075i, -0.09379390845109034 + 0.025751690384031356i, 0.09844633537134269 + -0.15088976082140276i, 0.038139456860760125 + 0.04197531173759937i }, { 0.0024443882429017413 + 0.004394806019498867i, 0.1654042080160375 + 0.018328801896710985i, -0.02407666873480253 + 0.08475366175555922i, 0.1659677208970256 + -0.023479988351842233i }, { 0.07501380150276883 + -0.12326791658738738i, -0.01972611438610823 + 0.059140491552277484i, 0.05195326924429704 + 0.11643565888279407i, -0.11905174239185595 + -0.03795546510232506i }, { 0.06646533675351049 + -0.025075013139625586i, 0.11911471050437669 + 0.005969040875992931i, -0.005652040778277544 + 0.08148339062237869i, 0.09727908631841457 + 0.0012095717614266507i } }), Matrix({ { -0.010777132389680352 + 0.08200432122838167i, 0.0056474143357664285 + -0.019987259944346903i, -0.0554933360106593 + -0.008296128053004396i, 0.07871417295784472 + -0.1292798413295172i }, { 0.02588210079675757 + 0.06760251545552895i, 0.08291315643892419 + 0.15792743777180632i, -0.04433979859701351 + 0.025650918665193995i, 0.042013796971312106 + 0.052930571853163716i }, { 0.11165392729911533 + -0.1282499781579186i, -0.15207987954274757 + -0.15343171974107833i, -0.0765502728741411 + 0.03774386953506462i, 0.02807435035363527 + -0.01354889008884265i }, { 0.10027856704979138 + -0.10362294693602357i, 0.08474652367624157 + 0.04856983723938471i, 0.06849089340116585 + -0.2316133757072353i, -0.026914230927571847 + 0.04640902098881524i } }), Matrix({ { -0.04126765143233722 + -0.019158411062760308i, -0.07717625999360726 + 0.03205829081112272i, -0.02122932992180826 + 0.15310379473379435i, 0.17171136381814642 + -0.06914166457090618i }, { 0.05480000086782156 + -0.07158389064995532i, 0.25711641124677953 + 0.1613440015991507i, -0.09396199069849608 + 0.034851847320862744i, 0.01611854056208758 + -0.0175524114333511i }, { -0.038626958482824776 + 0.09085485837962128i, 0.03738547919836422 + -0.11448724249680917i, 0.14589569963160104 + 0.13195765876372062i, -0.13463935976166214 + 0.24711645756895617i }, { -0.0814273506290185 + -0.12029622725841548i, -0.02026052806789977 + 0.15623058142017227i, -0.014705855471497428 + -0.04774745579147206i, -0.09476543657479845 + 0.026007635089288276i } }) }, { QubitIndex{ 6 }, QubitIndex{ 1 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_8_2_100_0_0) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.3686516122573694 + -2.1731728707288087e-20i, 0.05804008045095752 + -0.2109729849230077i }, { 0.058040080450957515 + 0.2109729849230077i, 0.6313483877426304 + 6.598920020132526e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3686516122573694, 1.0e-7), DoubleNear(0.6313483877426304, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.4883487191341235 + -4.579113655662085e-20i, 0.002146247086087134 + -0.02010581698672857i }, { 0.0021462470860871335 + 0.02010581698672857i, 0.5116512808658763 + 9.00486080506581e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4883487191341235, 1.0e-7), DoubleNear(0.5116512808658763, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.39933055268432655 + 4.811753223970612e-20i, 0.029356921775722182 + 0.16171767133453335i }, { 0.02935692177572218 + -0.16171767133453335i, 0.6006694473156733 + -3.860060745668876e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.39933055268432655, 1.0e-7), DoubleNear(0.6006694473156733, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.9999999999999998 + 4.425747149403724e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.44671531562478106 + 6.90522129997e-20i, 0.03003436338112858 + -0.026469431220230426i }, { 0.03003436338112858 + 0.02646943122023042i, 0.5532846843752186 + -2.479474150566279e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.44671531562478106, 1.0e-7), DoubleNear(0.5532846843752186, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.5057913024970013 + 1.2303904550269222e-20i, 0.08266016941235191 + -0.0033611891869239664i }, { 0.08266016941235191 + 0.0033611891869239664i, 0.49420869750299845 + 3.1953566943768043e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5057913024970013, 1.0e-7), DoubleNear(0.49420869750299845, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.45471316074072177 + 1.9226901212661014e-20i, 0.001634664015165778 + -0.07704927868532481i }, { 0.0016346640151657763 + 0.07704927868532481i, 0.545286839259278 + 2.5030570281376227e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.45471316074072177, 1.0e-7), DoubleNear(0.545286839259278, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.31531531353834796 + 2.2339868067357253e-19i, -0.0161906546799152 + 0.025978287103837032i }, { -0.0161906546799152 + -0.025978287103837032i, 0.6846846864616518 + -1.7914120917953529e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.31531531353834796, 1.0e-7), DoubleNear(0.6846846864616518, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.18003054265261592 + -2.6219293826608384e-21i, 0.028343798946666592 + -0.10302838695905359i, 0.0007912174485887036 + -0.007412041847909095i, -0.004117215870461709 + -0.0016197433895760649i }, { 0.028343798946666592 + 0.10302838695905359i, 0.3083181764815076 + -4.3169207173960055e-20i, 0.004366352577549969 + -0.0007141430813078452i, 0.0013550296374984301 + -0.012693775138819474i }, { 0.0007912174485887036 + 0.007412041847909095i, 0.00436635257754997 + 0.0007141430813078449i, 0.18862106960475344 + -1.9109799324627242e-20i, 0.029696281504290926 + -0.10794459796395411i }, { -0.00411721587046171 + 0.0016197433895760646i, 0.0013550296374984306 + 0.012693775138819478i, 0.029696281504290926 + 0.10794459796395411i, 0.3230302112611228 + 1.0915840737528533e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.18003054265261592, 1.0e-7), DoubleNear(0.3083181764815076, 1.0e-7), DoubleNear(0.18862106960475344, 1.0e-7), DoubleNear(0.3230302112611228, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.14721385207070337 + 1.839490044157148e-21i, 0.02317717740432365 + -0.08424795867076676i, 0.010822476543533462 + 0.05961748026798311i, 0.03582193793789981 + 0.003192589239422473i }, { 0.02317717740432365 + 0.08424795867076676i, 0.2521167006136231 + 4.627804219554895e-20i, -0.03241418173458904 + 0.01557962406977318i, 0.018534445232188723 + 0.10210019106655024i }, { 0.010822476543533462 + -0.05961748026798311i, -0.03241418173458904 + -0.01557962406977318i, 0.22143776018666603 + -2.3571218751445246e-20i, 0.03486290304663388 + -0.1267250262522409i }, { 0.03582193793789981 + -0.003192589239422473i, 0.018534445232188723 + -0.10210019106655024i, 0.03486290304663387 + 0.1267250262522409i, 0.3792316871290073 + 1.9711158005776343e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.14721385207070337, 1.0e-7), DoubleNear(0.2521167006136231, 1.0e-7), DoubleNear(0.22143776018666603, 1.0e-7), DoubleNear(0.3792316871290073, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.3686516122573694 + -2.1731728707288087e-20i, 0.05804008045095752 + -0.2109729849230077i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.058040080450957515 + 0.2109729849230077i, 0.6313483877426304 + 6.598920020132526e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3686516122573694, 1.0e-7), DoubleNear(0.6313483877426304, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.16468232132513524 + -4.338710352045614e-20i, 0.02592739285753718 + -0.0942448635481836i, 0.01107221648357675 + -0.009757998494873497i, -0.0038411380468122676 + -0.007872727210292238i }, { 0.02592739285753718 + 0.0942448635481836i, 0.2820329942996459 + 1.1243931652015612e-19i, 0.007327531780680258 + 0.004800151375265714i, 0.01896214689755183 + -0.016711432725356926i }, { 0.01107221648357675 + 0.009757998494873495i, 0.007327531780680258 + -0.004800151375265715i, 0.20396929093223415 + 2.1655374813168036e-20i, 0.03211268759342034 + -0.11672812137482409i }, { -0.003841138046812267 + 0.007872727210292238i, 0.01896214689755183 + 0.016711432725356922i, 0.03211268759342034 + 0.11672812137482409i, 0.3493153934429845 + -4.645011631883085e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.16468232132513524, 1.0e-7), DoubleNear(0.2820329942996459, 1.0e-7), DoubleNear(0.20396929093223415, 1.0e-7), DoubleNear(0.3493153934429845, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.1864607791312744 + -1.8461408669164326e-20i, 0.029356167888320555 + -0.1067083008358883i, 0.030472804723330825 + -0.001239107812861559i, 0.004088482767126399 + -0.01763414636598534i }, { 0.02935616788832055 + 0.1067083008358883i, 0.3193305233657269 + 3.076531321943349e-20i, 0.005506722998438971 + 0.017243978984345428i, 0.052187364689021076 + -0.0021220813740624126i }, { 0.030472804723330825 + 0.001239107812861559i, 0.00550672299843897 + -0.017243978984345428i, 0.182190833126095 + -3.270320038123771e-21i, 0.028683912562636967 + -0.10426468408711938i }, { 0.004088482767126399 + 0.01763414636598534i, 0.052187364689021076 + 0.0021220813740624126i, 0.028683912562636967 + 0.10426468408711938i, 0.3120178643769035 + 3.522388698189178e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1864607791312744, 1.0e-7), DoubleNear(0.3193305233657269, 1.0e-7), DoubleNear(0.182190833126095, 1.0e-7), DoubleNear(0.3120178643769035, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.1676307398217115 + -6.799091556042592e-21i, 0.026391588431500676 + -0.09593219280524548i, 0.0006026215246899685 + -0.028404340810612362i, -0.016160440279457147 + -0.004816816280210252i }, { 0.026391588431500676 + 0.09593219280524548i, 0.28708242091901026 + 2.602599276870357e-20i, 0.01635019234135816 + -0.004127076386958747i, 0.0010320424904758092 + -0.04864493787471244i }, { 0.0006026215246899682 + 0.028404340810612362i, 0.016350192341358157 + 0.004127076386958747i, 0.2010208724356579 + -1.4932637151245494e-20i, 0.031648492019456846 + -0.11504079211776219i }, { -0.016160440279457147 + 0.004816816280210252i, 0.0010320424904758086 + 0.04864493787471244i, 0.03164849201945684 + 0.11504079211776219i, 0.3442659668236201 + 3.99632074326217e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1676307398217115, 1.0e-7), DoubleNear(0.28708242091901026, 1.0e-7), DoubleNear(0.2010208724356579, 1.0e-7), DoubleNear(0.3442659668236201, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.11624149870534993 + 8.505478744834317e-20i, 0.01830092616518461 + -0.06652301288911933i, -0.005968710951253063 + 0.009576937424514351i, 0.004541009873307425 + 0.004923572619164147i }, { 0.01830092616518461 + 0.06652301288911933i, 0.19907381483299802 + 1.383438932252293e-19i, -0.006420423673659326 + -0.0019080088721946003i, -0.010221943728662137 + 0.016401349679322684i }, { -0.005968710951253064 + -0.009576937424514351i, -0.006420423673659326 + 0.0019080088721946i, 0.2524101135520195 + -1.0678651615563126e-19i, 0.03973915428577291 + -0.14444997203388837i }, { 0.004541009873307426 + -0.004923572619164146i, -0.010221943728662137 + -0.01640134967932268i, 0.039739154285772904 + 0.14444997203388837i, 0.43227457290963234 + -7.235469302390405e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11624149870534993, 1.0e-7), DoubleNear(0.19907381483299802, 1.0e-7), DoubleNear(0.2524101135520195, 1.0e-7), DoubleNear(0.43227457290963234, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.19501256391451252 + 3.751595670875222e-20i, 0.0008570620350843013 + -0.008028867009480245i, 0.014336415146894588 + 0.07897461765757255i, 0.0033144731111896817 + -0.0002431588156458375i }, { 0.0008570620350843011 + 0.008028867009480243i, 0.204317988769814 + 1.0601575530953875e-20i, -0.0031884586955544187 + 0.0009373309773869164i, 0.015020506628827592 + 0.08274305367696082i }, { 0.014336415146894588 + -0.07897461765757255i, -0.0031884586955544187 + -0.0009373309773869165i, 0.293336155219611 + -8.330709326537308e-20i, 0.0012891850510028321 + -0.012076949977248327i }, { 0.0033144731111896817 + 0.0002431588156458378i, 0.015020506628827594 + -0.08274305367696082i, 0.0012891850510028326 + 0.012076949977248327i, 0.3073332920960623 + 7.944703251970422e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.19501256391451252, 1.0e-7), DoubleNear(0.204317988769814, 1.0e-7), DoubleNear(0.293336155219611, 1.0e-7), DoubleNear(0.3073332920960623, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.4883487191341235 + -4.579113655662085e-20i, 0.002146247086087134 + -0.02010581698672857i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0021462470860871335 + 0.02010581698672857i, 0.5116512808658763 + 9.00486080506581e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4883487191341235, 1.0e-7), DoubleNear(0.5116512808658763, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.21834540546426764 + -1.4227998924316614e-20i, 0.0008693846623815289 + -0.00927809948306265i, 0.014219230864407075 + -0.01292587991784115i, 0.0004271802643540171 + -0.0017504578638890497i }, { 0.000869384662381529 + 0.00927809948306265i, 0.22836991016051345 + 8.32802119240166e-20i, 0.0026211807607637297 + 0.00033289295338263157i, 0.01581513251672151 + -0.01354355130238927i }, { 0.014219230864407075 + 0.01292587991784115i, 0.00262118076076373 + -0.0003328929533826314i, 0.27000331366985586 + -3.156313763230425e-20i, 0.0012768624237056048 + -0.010827717503665919i }, { 0.00042718026435401707 + 0.0017504578638890497i, 0.01581513251672151 + 0.01354355130238927i, 0.0012768624237056037 + 0.010827717503665919i, 0.2832813707053628 + 6.7683961266414844e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21834540546426764, 1.0e-7), DoubleNear(0.22836991016051345, 1.0e-7), DoubleNear(0.27000331366985586, 1.0e-7), DoubleNear(0.2832813707053628, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.24684406534155529 + -6.571626451725261e-20i, 0.0013028162013625044 + -0.009999703824276559i, 0.04029561439611411 + -0.001732049060482902i, 0.0010156567916376424 + -0.0008864572846560234i }, { 0.001302816201362504 + 0.009999703824276559i, 0.258947237155446 + 7.802016906752186e-20i, -0.0002120057196068857 + 0.002563459130804304i, 0.0423645550162378 + -0.001629140126441067i }, { 0.04029561439611411 + 0.001732049060482902i, -0.00021200571960688555 + -0.0025634591308043046i, 0.2415046537925682 + 1.992512796063178e-20i, 0.000843430884724629 + -0.01010611316245201i }, { 0.0010156567916376428 + 0.0008864572846560234i, 0.0423645550162378 + 0.001629140126441067i, 0.000843430884724629 + 0.01010611316245201i, 0.2527040437104302 + 1.2028438983136252e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24684406534155529, 1.0e-7), DoubleNear(0.258947237155446, 1.0e-7), DoubleNear(0.2415046537925682, 1.0e-7), DoubleNear(0.2527040437104302, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.21968212418878233 + -7.651154333889246e-20i, -0.005552220895845642 + 0.0005585482195636187i, -0.028045753292531166 + -0.04760862004991827i, 0.00485403618682337 + -0.005905373720894076i }, { -0.0055522208958456425 + -0.0005585482195636182i, 0.23503103655193944 + 9.57384445515535e-20i, -0.022321790904407633 + 0.03884671593497582i, 0.029680417307696945 + -0.029440658635406534i }, { -0.028045753292531166 + 0.04760862004991827i, -0.02232179090440763 + -0.03884671593497582i, 0.2686665949453412 + 3.0720406782271607e-20i, 0.007698467981932775 + -0.02066436520629219i }, { 0.00485403618682337 + 0.0059053737208940756i, 0.02968041730769694 + 0.029440658635406534i, 0.007698467981932775 + 0.02066436520629219i, 0.27662024431393684 + -5.6898365008953795e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.21968212418878233, 1.0e-7), DoubleNear(0.23503103655193944, 1.0e-7), DoubleNear(0.2686665949453412, 1.0e-7), DoubleNear(0.27662024431393684, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.15398382948982678 + 1.099164539440387e-19i, 0.0006767445728803304 + -0.006339671987114962i, -0.007906685474879492 + 0.012686463232457337i, 0.00048756554070982855 + 0.0003812821628878418i }, { 0.0006767445728803302 + 0.006339671987114962i, 0.16133148404852113 + 1.1348222672953382e-19i, -0.0005570638315670509 + -0.00026977051689155i, -0.008283969205035708 + 0.013291823871379695i }, { -0.007906685474879492 + -0.012686463232457337i, -0.000557063831567051 + 0.00026977051689155i, 0.3343648896442967 + -1.5570759050065956e-19i, 0.0014695025132068036 + -0.013766144999613606i }, { 0.0004875655407098286 + -0.0003812821628878419i, -0.008283969205035708 + -0.013291823871379695i, 0.0014695025132068031 + 0.013766144999613608i, 0.35031979681735514 + -2.3433618678875716e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.15398382948982678, 1.0e-7), DoubleNear(0.16133148404852113, 1.0e-7), DoubleNear(0.3343648896442967, 1.0e-7), DoubleNear(0.35031979681735514, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.39933055268432655 + 4.811753223970612e-20i, 0.029356921775722182 + 0.16171767133453335i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02935692177572218 + -0.16171767133453335i, 0.6006694473156733 + -3.860060745668876e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.39933055268432655, 1.0e-7), DoubleNear(0.6006694473156733, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.17838707388099723 + -3.930975703553823e-20i, 0.013114186576813746 + 0.0722417605923107i, 0.011993638928507976 + -0.010570052598414384i, 0.005162291234848668 + 0.004080026284231134i }, { 0.013114186576813746 + -0.0722417605923107i, 0.26832824174378384 + 1.0836197003523824e-19i, -0.0033988583221218546 + -0.005634148327791461i, 0.018040724452620605 + -0.01589937862181604i }, { 0.011993638928507976 + 0.010570052598414382i, -0.0033988583221218538 + 0.005634148327791461i, 0.22094347880332926 + 8.742728927524435e-20i, 0.016242735198908436 + 0.08947591074222266i }, { 0.005162291234848668 + -0.004080026284231134i, 0.01804072445262061 + 0.015899378621816035i, 0.016242735198908436 + -0.08947591074222266i, 0.3323412055718894 + -1.1222203078090712e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.17838707388099723, 1.0e-7), DoubleNear(0.26832824174378384, 1.0e-7), DoubleNear(0.22094347880332926, 1.0e-7), DoubleNear(0.3323412055718894, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.20197792036905296 + -9.516212811627818e-20i, 0.01484847570224511 + 0.08179539162107562i, 0.03300873113641455 + -0.0013422255356909294i, 0.002970211815630518 + 0.013268935941449646i }, { 0.014848475702245106 + -0.08179539162107562i, 0.3038133821279484 + 1.0746603266654742e-19i, 0.0018830844391822007 + -0.013466284277517506i, 0.04965143827593735 + -0.002018963651233039i }, { 0.03300873113641455 + 0.0013422255356909298i, 0.0018830844391822007 + 0.013466284277517506i, 0.19735263231527359 + 1.4327966035598433e-19i, 0.014508446073477075 + 0.07992227971345775i }, { 0.002970211815630517 + -0.013268935941449646i, 0.04965143827593735 + 0.002018963651233039i, 0.014508446073477075 + -0.07992227971345775i, 0.2968560651877249 + -1.1132609341221628e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.20197792036905296, 1.0e-7), DoubleNear(0.3038133821279484, 1.0e-7), DoubleNear(0.19735263231527359, 1.0e-7), DoubleNear(0.2968560651877249, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.1815808577914295 + 4.306798999935448e-20i, 0.013348978690256759 + 0.07353515348015491i, 0.000652771284629329 + -0.030768131041339464i, 0.012508218630619036 + -0.0019975755892939315i }, { 0.013348978690256759 + -0.07353515348015491i, 0.2731323029492923 + -2.3841088786693475e-20i, -0.012412241223373416 + -0.002526283705187867i, 0.0009818927305364489 + -0.046281147643985346i }, { 0.000652771284629329 + 0.030768131041339464i, -0.012412241223373416 + 0.002526283705187867i, 0.21774969489289706 + 5.049542240351643e-21i, 0.016007943085465423 + 0.08818251785437846i }, { 0.012508218630619034 + 0.001997575589293931i, 0.0009818927305364474 + 0.046281147643985346i, 0.016007943085465423 + -0.08818251785437846i, 0.327537144366381 + 1.99810280410246e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1815808577914295, 1.0e-7), DoubleNear(0.2731323029492923, 1.0e-7), DoubleNear(0.21774969489289706, 1.0e-7), DoubleNear(0.327537144366381, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.1259150384251002 + 2.441306482031883e-19i, 0.009256686994232596 + 0.050992058241539906i, -0.006465423081651616 + 0.010373923746967358i, -0.004676455878628466 + -0.0018556724298428552i }, { 0.009256686994232596 + -0.050992058241539906i, 0.1894002751132477 + -2.0731967529615773e-20i, 0.0037258403127564646 + 0.0033809575145920473i, -0.009725231598263584 + 0.015604363356869676i }, { -0.006465423081651616 + -0.010373923746967356i, 0.0037258403127564638 + -0.003380957514592048i, 0.27341551425922633 + -1.9601311596348218e-19i, 0.020100234781489586 + 0.11072561309299346i }, { -0.0046764558786284655 + 0.001855672429842855i, -0.009725231598263585 + -0.015604363356869676i, 0.020100234781489583 + -0.11072561309299346i, 0.41126917220242554 + 1.6871906783946897e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1259150384251002, 1.0e-7), DoubleNear(0.1894002751132477, 1.0e-7), DoubleNear(0.27341551425922633, 1.0e-7), DoubleNear(0.41126917220242554, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.44671531562478106 + 6.90522129997e-20i, 0.0 + 0.0i, 0.03003436338112858 + -0.026469431220230426i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03003436338112858 + 0.02646943122023042i, 0.0 + 0.0i, 0.5532846843752186 + -2.479474150566279e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.44671531562478106, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5532846843752186, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.5057913024970013 + 1.2303904550269222e-20i, 0.0 + 0.0i, 0.08266016941235191 + -0.0033611891869239664i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08266016941235191 + 0.0033611891869239664i, 0.0 + 0.0i, 0.49420869750299845 + 3.1953566943768043e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5057913024970013, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.49420869750299845, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.45471316074072177 + 1.9226901212661014e-20i, 0.0 + 0.0i, 0.001634664015165778 + -0.07704927868532481i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016346640151657763 + 0.07704927868532481i, 0.0 + 0.0i, 0.545286839259278 + 2.5030570281376227e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.45471316074072177, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.545286839259278, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.31531531353834796 + 2.2339868067357253e-19i, 0.0 + 0.0i, -0.0161906546799152 + 0.025978287103837032i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0161906546799152 + -0.025978287103837032i, 0.0 + 0.0i, 0.6846846864616518 + -1.7914120917953529e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.31531531353834796, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6846846864616518, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.17596721740420987 + 5.1144351577315e-20i, 0.03195616115612743 + -0.020346350352186997i, 0.02217484562627893 + -0.05150556832468223i, 0.0017540861589437936 + 0.0566921903820163i }, { 0.03195616115612743 + 0.020346350352186994i, 0.32982408509279143 + -3.884044702704579e-20i, 0.03008610876658107 + -0.01571133075541493i, 0.06048532378607298 + 0.048144379137758264i }, { 0.02217484562627893 + 0.05150556832468223i, 0.030086108766581077 + 0.015711330755414935i, 0.2707480982205712 + 1.7907861422385004e-20i, -0.0019217977749988412 + -0.006123080868043425i }, { 0.001754086158943794 + -0.0566921903820163i, 0.06048532378607298 + -0.048144379137758264i, -0.0019217977749988412 + 0.006123080868043425i, 0.22346059928242723 + 1.4045705521383027e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.17596721740420987, 1.0e-7), DoubleNear(0.32982408509279143, 1.0e-7), DoubleNear(0.2707480982205712, 1.0e-7), DoubleNear(0.22346059928242723, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.20326009829178904 + 7.559871453159032e-20i, 0.013045715558388293 + -0.011887812065175078i, 0.0008670561640322644 + -0.03407724210226882i, -0.0021730248403955235 + -0.0021793989401319106i }, { 0.013045715558388293 + 0.011887812065175075i, 0.25145306244893273 + -5.637181331892932e-20i, 0.0010285419127219811 + -0.002382992830951534i, 0.0007676078511335135 + -0.042972036583055984i }, { 0.0008670561640322631 + 0.03407724210226882i, 0.0010285419127219813 + 0.0023829928309515346i, 0.24345521733299202 + -6.546501531890311e-21i, 0.016988647822740288 + -0.014581619155055344i }, { -0.002173024840395523 + 0.0021793989401319106i, 0.0007676078511335133 + 0.042972036583055984i, 0.016988647822740288 + 0.014581619155055344i, 0.30183162192628593 + 3.157707181326655e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.20326009829178904, 1.0e-7), DoubleNear(0.25145306244893273, 1.0e-7), DoubleNear(0.24345521733299202, 1.0e-7), DoubleNear(0.30183162192628593, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.14085617980860993 + 5.642045081871415e-20i, 0.009470294706445238 + -0.008346217004388692i, -0.00723261341551016 + 0.011604898722981743i, 0.00020135447767947052 + 0.001208798735356444i }, { 0.009470294706445238 + 0.008346217004388692i, 0.17445913372973798 + 1.6697822985485837e-19i, -0.0011739064897493563 + 0.0003516838944354096i, -0.00895804126440504 + 0.014373388380855293i }, { -0.00723261341551016 + -0.011604898722981741i, -0.0011739064897493558 + -0.0003516838944354096i, 0.30585913581617113 + 1.263176218098585e-20i, 0.020564068674683345 + -0.018123214215841732i }, { 0.00020135447767947033 + -0.0012087987353564438i, -0.008958041264405041 + -0.014373388380855289i, 0.020564068674683345 + 0.018123214215841725i, 0.3788255506454807 + -1.9177297136052116e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.14085617980860993, 1.0e-7), DoubleNear(0.17445913372973798, 1.0e-7), DoubleNear(0.30585913581617113, 1.0e-7), DoubleNear(0.3788255506454807, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.22987025015005358 + -9.113058821031406e-20i, 0.03749098507322972 + -0.0018277198133503734i, 0.0007123887337193874 + -0.03913642673305461i, -0.0005557460645337644 + -0.006691718317178915i }, { 0.03749098507322972 + 0.0018277198133503734i, 0.2248429105906682 + 1.1035748942297508e-19i, 0.000631250660962064 + -0.006046807650558428i, 0.0009222752814463905 + -0.03791285195227019i }, { 0.0007123887337193861 + 0.03913642673305461i, 0.0006312506609620636 + 0.006046807650558428i, 0.27592105234694775 + 1.0343449276058327e-19i, 0.04516918433912219 + -0.001533469373573593i }, { -0.0005557460645337646 + 0.006691718317178915i, 0.0009222752814463902 + 0.03791285195227019i, 0.04516918433912219 + 0.001533469373573593i, 0.2693657869123302 + -7.840392247920703e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.22987025015005358, 1.0e-7), DoubleNear(0.2248429105906682, 1.0e-7), DoubleNear(0.27592105234694775, 1.0e-7), DoubleNear(0.2693657869123302, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.1594837431318114 + 2.526941934115835e-19i, 0.026064017235388703 + -0.0010598344223366352i, -0.008189092318833479 + 0.01313959167089079i, -0.0012510043210304544 + 0.002201789466485236i }, { 0.026064017235388703 + 0.0010598344223366352i, 0.15583157040653653 + -2.929551273801099e-20i, -0.0014256401964469032 + 0.002092949759606533i, -0.008001562361081719 + 0.012838695432946245i }, { -0.00818909231883348 + -0.013139591670890788i, -0.0014256401964469032 + -0.0020929497596065333i, 0.3463075593651899 + -2.403902888613143e-19i, 0.056596152176963205 + -0.002301354764587331i }, { -0.001251004321030454 + -0.002201789466485236i, -0.00800156236108172 + -0.012838695432946244i, 0.056596152176963205 + 0.002301354764587331i, 0.3383771270964619 + 6.124907968177904e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1594837431318114, 1.0e-7), DoubleNear(0.15583157040653653, 1.0e-7), DoubleNear(0.3463075593651899, 1.0e-7), DoubleNear(0.3383771270964619, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.14337802284897394 + 7.278890123238014e-20i, 0.0005154345964718524 + -0.024294817466566747i, -0.0073621037639658 + 0.011812669039615671i, 0.001975142002243686 + 0.0012899440356349318i }, { 0.0005154345964718518 + 0.024294817466566747i, 0.171937290689374 + 1.5060977944119239e-19i, -0.0020280745634181515 + -0.0012050124934263572i, -0.008828550915949397 + 0.014165618064221362i }, { -0.007362103763965802 + -0.01181266903961567i, -0.002028074563418151 + 0.0012050124934263572i, 0.3113351378917478 + -5.356200001971913e-20i, 0.0011192294186939255 + -0.05275446121875806i }, { 0.001975142002243686 + -0.001289944035634932i, -0.008828550915949399 + -0.014165618064221362i, 0.0011192294186939246 + 0.05275446121875806i, 0.373349548569904 + -1.2557920915981616e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.14337802284897394, 1.0e-7), DoubleNear(0.171937290689374, 1.0e-7), DoubleNear(0.3113351378917478, 1.0e-7), DoubleNear(0.373349548569904, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.07189169609752835 + 1.330611885522195e-20i, 0.011318544898545805 + -0.04114238270653353i, 0.00031595730103841 + -0.002959854767644897i, -0.0016441300890721556 + -0.0006468130229661943i, 0.005285142557893663 + 0.029114120126873443i, 0.01749359750887544 + 0.0015590968657933507i, 0.001221885856223776 + -8.964088942243063e-05i, 0.0001410723448788388 + -0.0007133772429371791i }, { 0.011318544898545805 + 0.04114238270653353i, 0.12312086781698417 + 2.4209837853530265e-20i, 0.0017436179880076634 + -0.00028517915135434983i, 0.0005411047340458911 + -0.005069012241835347i, -0.015829424131867265 + 0.0076082894590648945i, 0.009051272589000927 + 0.0498604975306991i, 0.00024367222717313039 + 0.0006851513284922913i, 0.002092587254965906 + -0.00015351792622340693i }, { 0.0003159573010384099 + 0.002959854767644897i, 0.0017436179880076634 + 0.0002851791513543497i, 0.07532215597317504 + -1.1466628811064796e-20i, 0.011858632505777842 + -0.043105575964233235i, -0.0011754304387321653 + 0.0003455485760324625i, 1.2693114955584367e-05 + 0.0007270814136415464i, 0.005537333985639797 + 0.030503360141109673i, 0.01832834042902437 + 0.0016334923736291223i }, { -0.0016441300890721552 + 0.0006468130229661943i, 0.0005411047340458913 + 0.005069012241835346i, 0.011858632505777844 + 0.043105575964233235i, 0.12899583279663895 + 2.206820434201867e-20i, -0.0003828099133646515 + -0.000618275882968124i, -0.002013028256822253 + 0.0005917824013544537i, -0.01658475760272178 + 0.007971334610708286i, 0.009483172643187796 + 0.052239693535851145i }, { 0.005285142557893663 + -0.029114120126873443i, -0.015829424131867265 + -0.0076082894590648945i, -0.0011754304387321653 + -0.0003455485760324626i, -0.00038280991336465167 + 0.0006182758829681239i, 0.10813884655508757 + -1.592804823788279e-20i, 0.01702525404812079 + -0.06188600425252005i, 0.0004752601475502934 + -0.004452187080264198i, -0.0024730857813895545 + -0.0009729303666098707i }, { 0.01749359750887544 + -0.0015590968657933505i, 0.009051272589000927 + -0.0498604975306991i, 1.2693114955584326e-05 + -0.0007270814136415464i, -0.002013028256822253 + -0.0005917824013544537i, 0.01702525404812079 + 0.06188600425252005i, 0.18519730866452339 + -6.737904502749033e-20i, 0.002622734589542306 + -0.00042896392995349527i, 0.0008139249034525384 + -0.007624762896984128i }, { 0.001221885856223776 + 8.964088942243073e-05i, 0.0002436722271731304 + -0.0006851513284922913i, 0.005537333985639798 + -0.030503360141109673i, -0.01658475760272178 + -0.007971334610708286i, 0.0004752601475502931 + 0.004452187080264198i, 0.0026227345895423063 + 0.0004289639299534952i, 0.11329891363157842 + -7.643170513562452e-21i, 0.017837648998513086 + -0.06483902199972089i }, { 0.00014107234487883882 + 0.0007133772429371792i, 0.002092587254965906 + 0.00015351792622340701i, 0.01832834042902437 + -0.0016334923736291223i, 0.009483172643187794 + -0.052239693535851145i, -0.002473085781389554 + 0.0009729303666098705i, 0.0008139249034525385 + 0.007624762896984128i, 0.017837648998513086 + 0.06483902199972089i, 0.19403437846448382 + 8.709020303326668e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.07189169609752835, 1.0e-7), DoubleNear(0.12312086781698417, 1.0e-7), DoubleNear(0.07532215597317504, 1.0e-7), DoubleNear(0.12899583279663895, 1.0e-7), DoubleNear(0.10813884655508757, 1.0e-7), DoubleNear(0.18519730866452339, 1.0e-7), DoubleNear(0.11329891363157842, 1.0e-7), DoubleNear(0.19403437846448382, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.18003054265261592 + -2.6219293826608384e-21i, 0.028343798946666592 + -0.10302838695905359i, 0.0007912174485887036 + -0.007412041847909095i, -0.004117215870461709 + -0.0016197433895760649i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.028343798946666592 + 0.10302838695905359i, 0.3083181764815076 + -4.3169207173960055e-20i, 0.004366352577549969 + -0.0007141430813078452i, 0.0013550296374984301 + -0.012693775138819474i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0007912174485887036 + 0.007412041847909095i, 0.00436635257754997 + 0.0007141430813078449i, 0.18862106960475344 + -1.9109799324627242e-20i, 0.029696281504290926 + -0.10794459796395411i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00411721587046171 + 0.0016197433895760646i, 0.0013550296374984306 + 0.012693775138819478i, 0.029696281504290926 + 0.10794459796395411i, 0.3230302112611228 + 1.0915840737528533e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.18003054265261592, 1.0e-7), DoubleNear(0.3083181764815076, 1.0e-7), DoubleNear(0.18862106960475344, 1.0e-7), DoubleNear(0.3230302112611228, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.08049338575339132 + -2.3819906931706154e-20i, 0.012672784899243037 + -0.04606498193502094i, 0.00032050005745877963 + -0.003420386333115313i, -0.00190696918660689 + -0.000721918317697856i, 0.005241942383223418 + -0.0047651464715572946i, -0.0019017261657023848 + -0.0037500926891042364i, 0.00015748069317863774 + -0.0006453091137112894i, -0.0003445057436164564 + -0.00019172021071709824i }, { 0.012672784899243037 + 0.04606498193502094i, 0.1378520197108763 + 9.591908007389537e-21i, 0.002007887498101795 + -0.00035508496316003163i, 0.0005488846049227494 + -0.005857713149947337i, 0.0035522967723442345 + 0.0022496544684424023i, 0.008977288481183655 + -0.008160733446283855i, 0.0003940928974367933 + -1.1473219775165176e-05i, 0.00026969957117537943 + -0.0011051487501777604i }, { 0.0003205000574587797 + 0.003420386333115313i, 0.0020078874981017945 + 0.0003550849631600314i, 0.08418893557174392 + -1.9567196588749984e-20i, 0.013254607958294147 + -0.04817988161316264i, 0.0009663025134735474 + 0.00012272152397362453i, 0.00022236496226619843 + -0.0005336771953251996i, 0.005830274100353333 + -0.004992852023316201i, -0.0019394118811098828 + -0.004122634521188i }, { -0.00190696918660689 + 0.0007219183176978559i, 0.0005488846049227496 + 0.005857713149947337i, 0.013254607958294147 + 0.04817988161316264i, 0.14418097458876955 + 1.0284740851276658e-19i, 8.19021221962595e-05 + 0.0005723194629169692i, 0.0016548782472901825 + 0.00021017142940900707i, 0.003775235008336024 + 0.002550496906823311i, 0.009984858416368175 + -0.008550699279073069i }, { 0.005241942383223418 + 0.0047651464715572946i, 0.0035522967723442345 + -0.0022496544684424023i, 0.0009663025134735475 + -0.00012272152397362448i, 8.19021221962595e-05 + -0.000572319462916969i, 0.0995371568992246 + 2.119797754904533e-20i, 0.015671014047423555 + -0.05696340502403263i, 0.00047071739112992397 + -0.003991655514793781i, -0.00221024668385482 + -0.0008978250718782088i }, { -0.0019017261657023844 + 0.0037500926891042364i, 0.008977288481183657 + 0.008160733446283853i, 0.00022236496226619843 + 0.0005336771953251996i, 0.0016548782472901825 + -0.00021017142940900693i, 0.015671014047423555 + 0.05696340502403263i, 0.17046615677063126 + -5.276111518134961e-20i, 0.0023584650794481747 + -0.0003590581181478135i, 0.0008061450325756805 + -0.006836061988872138i }, { 0.0001574806931786377 + 0.0006453091137112894i, 0.00039409289743679325 + 1.147321977516515e-05i, 0.005830274100353333 + 0.0049928520233162i, 0.003775235008336024 + -0.0025504969068233115i, 0.00047071739112992364 + 0.003991655514793781i, 0.002358465079448175 + 0.00035905811814781346i, 0.10443213403300955 + 4.573972641227419e-22i, 0.016441673545996783 + -0.059764716350791475i }, { -0.0003445057436164564 + 0.00019172021071709827i, 0.00026969957117537943 + 0.0011051487501777604i, -0.0019394118811098824 + 0.004122634521188i, 0.009984858416368175 + 0.008550699279073069i, -0.0022102466838548195 + 0.0008978250718782088i, 0.0008061450325756803 + 0.006836061988872138i, 0.016441673545996783 + 0.059764716350791475i, 0.17884923667235325 + 6.3109988625187546e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.08049338575339132, 1.0e-7), DoubleNear(0.1378520197108763, 1.0e-7), DoubleNear(0.08418893557174392, 1.0e-7), DoubleNear(0.14418097458876955, 1.0e-7), DoubleNear(0.0995371568992246, 1.0e-7), DoubleNear(0.17046615677063126, 1.0e-7), DoubleNear(0.10443213403300955, 1.0e-7), DoubleNear(0.17884923667235325, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.09099946266432782 + -1.7351004046056452e-20i, 0.014326849411265287 + -0.05207742927563788i, 0.00048028529310730915 + -0.0036864069369157365i, -0.002034051807013751 + -0.0008552426372542608i, 0.014855043214028734 + -0.0006385226786558835i, 0.0019733451410480583 + -0.00860181431527015i, 0.00037442351373736415 + -0.0003267939071857329i, -0.0001280697374534155 + -0.0002657261971068916i }, { 0.014326849411265287 + 0.05207742927563788i, 0.15584460267722744 + -4.836526047119623e-20i, 0.0021852829212935312 + -0.0003055245916392577i, 0.0008225309082551953 + -0.006313296887360823i, 0.0027041762616943944 + 0.008400757781639283i, 0.025440571182085377 + -0.0010935263818270175i, 0.00024596734124783585 + 0.00016282609287134573i, 0.0006412332779002783 + -0.0005596633774702904i }, { 0.0004802852931073088 + 0.003686406936915737i, 0.0021852829212935317 + 0.0003055245916392577i, 0.0954613164669466 + -1.1104046231078618e-21i, 0.01502931847705527 + -0.05463087156025043i, -7.815625034086229e-05 + 0.000945023341526882i, 0.0005285157955318761 + 0.00019351085367083835i, 0.015617761509302093 + -0.0006005851342056755i, 0.002115137626078341 + -0.009032332050715191i }, { -0.002034051807013751 + 0.0008552426372542607i, 0.0008225309082551956 + 0.006313296887360823i, 0.015029318477055267 + 0.05463087156025043i, 0.16348592068849943 + 7.913057369062971e-20i, -0.0005531254535759698 + 0.00010405589469840848i, -0.00013384946926602346 + 0.001618435789277422i, 0.0028025467367445763 + 0.008843221202706145i, 0.0267467935069357 + -0.0010285549922353933i }, { 0.014855043214028734 + 0.0006385226786558835i, 0.002704176261694394 + -0.008400757781639283i, -7.815625034086227e-05 + -0.000945023341526882i, -0.0005531254535759698 + -0.00010405589469840865i, 0.08903107998828813 + 1.4729074663395614e-20i, 0.014016949535401307 + -0.050950957683415704i, 0.00031093215548139456 + -0.0037256349109933582i, -0.002083164063447959 + -0.000764500752321804i }, { 0.0019733451410480583 + 0.00860181431527015i, 0.025440571182085377 + 0.001093526381827018i, 0.0005285157955318761 + -0.00019351085367083832i, -0.00013384946926602338 + -0.0016184357892774222i, 0.014016949535401307 + 0.050950957683415704i, 0.15247357380428012 + 5.1960532972361595e-21i, 0.0021810696562564384 + -0.00040861848966858733i, 0.0005324987292432345 + -0.006380478251458651i }, { 0.00037442351373736426 + 0.0003267939071857329i, 0.0002459673412478359 + -0.0001628260928713457i, 0.015617761509302094 + 0.0006005851342056755i, 0.0028025467367445763 + -0.008843221202706145i, 0.00031093215548139456 + 0.0037256349109933574i, 0.002181069656256438 + 0.00040861848966858717i, 0.09315975313780687 + -1.799939470151938e-20i, 0.01466696302723566 + -0.05331372640370369i }, { -0.0001280697374534155 + 0.00026572619710689166i, 0.0006412332779002785 + 0.0005596633774702904i, 0.002115137626078341 + 0.009032332050715191i, 0.0267467935069357 + 0.0010285549922353933i, -0.002083164063447959 + 0.0007645007523218039i, 0.0005324987292432344 + 0.006380478251458653i, 0.014666963027235662 + 0.05331372640370369i, 0.15954429057262337 + 3.0027833684655627e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.09099946266432782, 1.0e-7), DoubleNear(0.15584460267722744, 1.0e-7), DoubleNear(0.0954613164669466, 1.0e-7), DoubleNear(0.16348592068849943, 1.0e-7), DoubleNear(0.08903107998828813, 1.0e-7), DoubleNear(0.15247357380428012, 1.0e-7), DoubleNear(0.09315975313780687, 1.0e-7), DoubleNear(0.15954429057262337, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.08098616926631827 + 1.1205319278958279e-20i, 0.01275036816155417 + -0.04634699347433429i, -0.0020468351848625522 + 0.0002059097016656106i, -0.0002044127623716007 + 0.0012037867989476627i, -0.010339112168264043 + -0.0175509945387509i, -0.011671910457402826 + 0.003153688148683246i, 0.0017894482662280493 + -0.0021770255431899023i, -0.0009641456701878245 + -0.0013668188691120832i }, { 0.01275036816155417 + 0.04634699347433429i, 0.13869595492246406 + -8.771686261785077e-20i, -0.00044008993258113656 + -0.00113895043174924i, -0.0035053857109830894 + 0.00035263851789800807i, 0.008416354902590396 + -0.008680104424395898i, -0.017706641124267123 + -0.03005762551116737i, 0.0015276029717779995 + 0.0006813221374047581i, 0.003064587920595321 + -0.0037283481777041737i }, { -0.0020468351848625522 + -0.0002059097016656104i, -0.00044008993258113656 + 0.00113895043174924i, 0.08664457055539322 + -1.8004410835000874e-20i, 0.013641220269946507 + -0.049585199330911205i, -0.00822896420538176 + 0.014320904460332882i, 0.006900049075356748 + 0.006963961374051614i, 0.010941733692954012 + -0.010853346271861467i, -0.0044885298220543185 + -0.007970504428893497i }, { -0.00020441276237160043 + -0.001203786798947663i, -0.0035053857109830894 + -0.0003526385178980078i, 0.013641220269946507 + 0.049585199330911205i, 0.14838646599654623 + 1.1374285538655436e-19i, -0.00949116615515929 + -0.002454628337808632i, -0.014092826699025873 + 0.02452581147464294i, 0.007933837438767764 + 0.004553028037437152i, 0.01873868361474293 + -0.01858731236354507i }, { -0.010339112168264043 + 0.0175509945387509i, 0.008416354902590396 + 0.008680104424395898i, -0.00822896420538176 + -0.014320904460332882i, -0.00949116615515929 + 0.002454628337808632i, 0.09904437338629767 + -1.3827248661619118e-20i, 0.015593430785112421 + -0.05668139348471929i, 0.0028380526334512556 + -0.007617951549574705i, -0.003912803108090109 + -0.0028235301885237273i }, { -0.011671910457402826 + -0.0031536881486832454i, -0.017706641124267123 + 0.03005762551116737i, 0.006900049075356748 + -0.006963961374051614i, -0.014092826699025873 + -0.02452581147464294i, 0.015593430785112421 + 0.05668139348471929i, 0.16962222155904352 + 4.454765544389072e-20i, 0.004806442510131106 + 0.0004248073504413949i, 0.0048604153484815196 + -0.013046413656717482i }, { 0.001789448266228049 + 0.0021770255431899023i, 0.0015276029717779995 + -0.0006813221374047581i, 0.010941733692954012 + 0.010853346271861467i, 0.007933837438767764 + -0.004553028037437152i, 0.0028380526334512556 + 0.007617951549574705i, 0.004806442510131107 + -0.0004248073504413951i, 0.10197649904936024 + -1.1053884896263647e-21i, 0.01605506123434442 + -0.05835939863304291i }, { -0.0009641456701878243 + 0.0013668188691120834i, 0.003064587920595321 + 0.0037283481777041737i, -0.0044885298220543185 + 0.007970504428893497i, 0.01873868361474293 + 0.01858731236354507i, -0.003912803108090109 + 0.0028235301885237273i, 0.0048604153484815196 + 0.013046413656717484i, 0.01605506123434442 + 0.05835939863304291i, 0.17464374526457654 + -4.584448011269015e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.08098616926631827, 1.0e-7), DoubleNear(0.13869595492246406, 1.0e-7), DoubleNear(0.08664457055539322, 1.0e-7), DoubleNear(0.14838646599654623, 1.0e-7), DoubleNear(0.09904437338629767, 1.0e-7), DoubleNear(0.16962222155904352, 1.0e-7), DoubleNear(0.10197649904936024, 1.0e-7), DoubleNear(0.17464374526457654, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.05676638700298853 + 4.358292811956661e-20i, 0.008937233851736073 + -0.032486428137344224i, 0.00024948297787875896 + -0.0023371302992328128i, -0.001298221213099696 + -0.0005107298947358431i, -0.0029148123479262496 + 0.004676885124489235i, 0.0022175963552050902 + 0.0024044203821326536i, 0.00017974182266381443 + 0.00014056028407357976i, 0.0001087385792102613 + -8.07335100606274e-05i }, { 0.008937233851736073 + 0.032486428137344224i, 0.09721744248683828 + 6.633352582447209e-20i, 0.0013767778320091424 + -0.00022518024959382492i, 0.0004272615950015714 + -0.004002541687882149i, -0.0031354056773299365 + -0.0009317736888327767i, -0.004991873126953242 + 0.008009578107968101i, -5.2141892794435184e-05 + 0.000124992804877678i, 0.0003078237180460141 + 0.00024072187881426198i }, { 0.00024948297787875896 + 0.0023371302992328123i, 0.0013767778320091426 + 0.00022518024959382492i, 0.0594751117023614 + 4.147185932877657e-20i, 0.009363692313448538 + -0.03403658475177511i, -0.00020536247963746105 + -9.945133599157375e-05i, -8.924632079330311e-05 + 0.00010186791683466627i, -0.0030538986033268128 + 0.004900052300025115i, 0.0023234135181023348 + 0.002519152237031494i }, { -0.0012982212130996963 + 0.0005107298947358431i, 0.0004272615950015714 + 0.00400254168788215i, 0.009363692313448538 + 0.03403658475177511i, 0.10185637234615973 + 7.201036740075725e-20i, 2.458226159236278e-05 + -0.0001331829218420301i, -0.00035170135192959 + -0.00017031918089997623i, -0.00328501799632939 + -0.0009762351833618234i, -0.005230070601708894 + 0.008391771571354581i }, { -0.00291481234792625 + -0.004676885124489236i, -0.003135405677329936 + 0.0009317736888327766i, -0.00020536247963746102 + 9.945133599157378e-05i, 2.4582261592362825e-05 + 0.0001331829218420301i, 0.12326415564962741 + -4.620485750222745e-20i, 0.01940656509493052 + -0.07054195882170936i, 0.0005417344707099446 + -0.005074911548676282i, -0.0028189946573620134 + -0.0011090134948402218i }, { 0.0022175963552050907 + -0.0024044203821326536i, -0.004991873126953242 + -0.0080095781079681i, -8.924632079330329e-05 + -0.00010186791683466626i, -0.00035170135192959 + 0.00017031918089997623i, 0.01940656509493052 + 0.07054195882170936i, 0.2111007339946693 + -1.0950273299843215e-19i, 0.002989574745540827 + -0.0004889628317140203i, 0.0009277680424968587 + -0.008691233450937325i }, { 0.00017974182266381443 + -0.00014056028407357976i, -5.214189279443524e-05 + -0.00012499280487767797i, -0.003053898603326813 + -0.004900052300025115i, -0.0032850179963293895 + 0.0009762351833618232i, 0.0005417344707099446 + 0.005074911548676282i, 0.0029895747455408275 + 0.0004889628317140199i, 0.12914595790239206 + -6.058165865340381e-20i, 0.02033258919084239 + -0.073908013212179i }, { 0.00010873857921026135 + 8.073351006062724e-05i, 0.0003078237180460142 + -0.00024072187881426203i, 0.0023234135181023356 + -0.002519152237031494i, -0.005230070601708894 + -0.00839177157135458i, -0.0028189946573620134 + 0.0011090134948402216i, 0.0009277680424968592 + 0.008691233450937327i, 0.02033258919084239 + 0.073908013212179i, 0.22117383891496306 + 3.7148039974528085e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.05676638700298853, 1.0e-7), DoubleNear(0.09721744248683828, 1.0e-7), DoubleNear(0.0594751117023614, 1.0e-7), DoubleNear(0.10185637234615973, 1.0e-7), DoubleNear(0.12326415564962741, 1.0e-7), DoubleNear(0.2111007339946693, 1.0e-7), DoubleNear(0.12914595790239206, 1.0e-7), DoubleNear(0.22117383891496306, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.14721385207070337 + 1.839490044157148e-21i, 0.02317717740432365 + -0.08424795867076676i, 0.010822476543533462 + 0.05961748026798311i, 0.03582193793789981 + 0.003192589239422473i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02317717740432365 + 0.08424795867076676i, 0.2521167006136231 + 4.627804219554895e-20i, -0.03241418173458904 + 0.01557962406977318i, 0.018534445232188723 + 0.10210019106655024i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010822476543533462 + -0.05961748026798311i, -0.03241418173458904 + -0.01557962406977318i, 0.22143776018666603 + -2.3571218751445246e-20i, 0.03486290304663388 + -0.1267250262522409i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03582193793789981 + -0.003192589239422473i, 0.018534445232188723 + -0.10210019106655024i, 0.03486290304663387 + 0.1267250262522409i, 0.3792316871290073 + 1.9711158005776343e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.14721385207070337, 1.0e-7), DoubleNear(0.2521167006136231, 1.0e-7), DoubleNear(0.22143776018666603, 1.0e-7), DoubleNear(0.3792316871290073, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.06576268239210412 + -2.4644869054485226e-20i, 0.010353600119463985 + -0.0376348534483551i, 0.004834566024986341 + 0.026632041514666242i, 0.01600220831222024 + 0.0014261785097488902i, 0.004421474327827215 + -0.0038966669320506606i, -0.0015338837791703378 + -0.003143820508018936i, 0.0019030869866690486 + 0.0015041082677342524i, 0.0011603951223304598 + -0.0008522989370791066i }, { 0.010353600119463985 + 0.0376348534483551i, 0.11262439148889312 + -1.4664887981053015e-20i, -0.014479911424285966 + 0.0069596566836441645i, 0.008279620551827406 + 0.04560971907764447i, 0.002926107315791015 + 0.001916847101653288i, 0.007572164600680761 + -0.006673385666363723i, -0.0005611555251666806 + 0.0013259090446366994i, 0.003259204248179619 + 0.002575918016496882i }, { 0.004834566024986341 + -0.026632041514666242i, -0.014479911424285966 + -0.0069596566836441645i, 0.09891963893303111 + -1.8742234465970912e-20i, 0.015573792738073198 + -0.056610010099828495i, -0.0012529946002845995 + -0.002077037864737484i, -0.001385923100670496 + 0.0003900608633308091i, 0.006650742155749536 + -0.005861331562822836i, -0.0023072542676419302 + -0.004728906702273301i }, { 0.01600220831222024 + -0.0014261785097488902i, 0.008279620551827406 + -0.04560971907764447i, 0.015573792738073198 + 0.056610010099828495i, 0.1694086028107527 + 1.2710420450120914e-19i, 0.000991383079755778 + -0.0010440737077660974i, -0.0021458637218372554 + -0.003557110463053976i, 0.004401424464889243 + 0.002883304273612426i, 0.01138998229687107 + -0.010038047058993202i }, { 0.004421474327827215 + 0.0038966669320506598i, 0.002926107315791015 + -0.0019168471016532882i, -0.001252994600284599 + 0.002077037864737484i, 0.0009913830797557781 + 0.0010440737077660974i, 0.08145116967859928 + 2.6484359098642383e-20i, 0.012823577284859661 + -0.04661310522241167i, 0.005987910518547119 + 0.03298543875331687i, 0.019819729625679572 + 0.0017664107296735828i }, { -0.0015338837791703374 + 0.003143820508018936i, 0.007572164600680761 + 0.006673385666363723i, -0.0013859231006704959 + -0.00039006086333080904i, -0.0021458637218372545 + 0.003557110463053976i, 0.012823577284859661 + 0.04661310522241167i, 0.13949230912472999 + 6.094293017660194e-20i, -0.017934270310303084 + 0.008619967386129015i, 0.010254824680361315 + 0.05649047198890579i }, { 0.001903086986669048 + -0.0015041082677342524i, -0.0005611555251666808 + -0.0013259090446366992i, 0.006650742155749536 + 0.005861331562822835i, 0.004401424464889243 + -0.0028833042736124263i, 0.005987910518547119 + -0.03298543875331687i, -0.017934270310303084 + -0.008619967386129015i, 0.12251812125363488 + -4.828984285474335e-21i, 0.019289110308560675 + -0.07011501615241243i }, { 0.0011603951223304598 + 0.0008522989370791065i, 0.003259204248179619 + -0.002575918016496883i, -0.0023072542676419294 + 0.004728906702273301i, 0.01138998229687107 + 0.0100380470589932i, 0.019819729625679572 + -0.0017664107296735828i, 0.010254824680361315 + -0.05649047198890579i, 0.019289110308560675 + 0.07011501615241243i, 0.2098230843182545 + -1.0739304649543279e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.06576268239210412, 1.0e-7), DoubleNear(0.11262439148889312, 1.0e-7), DoubleNear(0.09891963893303111, 1.0e-7), DoubleNear(0.1694086028107527, 1.0e-7), DoubleNear(0.08145116967859928, 1.0e-7), DoubleNear(0.13949230912472999, 1.0e-7), DoubleNear(0.12251812125363488, 1.0e-7), DoubleNear(0.2098230843182545, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.07445948598444196 + -2.4994210502257464e-20i, 0.01172281474753693 + -0.04261188474880066i, 0.005473914507197035 + 0.03015400299633246i, 0.018118424647577097 + 0.0016147838697454036i, 0.012168721952009257 + -0.0004948136077454737i, 0.0016326560830369295 + -0.007041853414445234i, 0.0010949733745780788 + 0.004891614627755169i, 0.0029717783550553918 + 0.00014349565694318312i }, { 0.01172281474753693 + 0.04261188474880066i, 0.127518434384611 + -7.016791761402074e-20i, -0.016394811198912305 + 0.00788003835066421i, 0.009374561195048071 + 0.05164138862474316i, 0.0021990027384461265 + 0.006886047658295572i, 0.020840009184405296 + -0.0008474119279454563i, -0.0026269956895842318 + 0.0013967645621374958i, 0.001875238441052439 + 0.008377321313694477i }, { 0.005473914507197035 + -0.03015400299633246i, -0.016394811198912305 + -0.007880038350664212i, 0.11200129314683244 + 6.532801833093144e-21i, 0.017633353140783625 + -0.06409641608708763i, 0.0006942021145212829 + -0.004964367410022895i, -0.002731727817503556 + -0.0011788641678389176i, 0.01830408277132157 + -0.0007442942051160851i, 0.00245582668408947 + -0.010592292951540103i }, { 0.018118424647577097 + -0.0016147838697454036i, 0.009374561195048071 + -0.05164138862474316i, 0.017633353140783625 + 0.06409641608708763i, 0.1918120889811159 + 1.0093323083345424e-19i, 0.0029503165621957185 + -0.0003843042778462435i, 0.001188882324660918 + -0.00850191686749461i, 0.003307720259992844 + 0.010357931326049855i, 0.03134735550461578 + -0.0012746694461169546i }, { 0.012168721952009257 + 0.0004948136077454737i, 0.002199002738446126 + -0.006886047658295572i, 0.000694202114521283 + 0.004964367410022895i, 0.0029503165621957185 + 0.0003843042778462433i, 0.07275436608626143 + 2.6833700546414624e-20i, 0.01145436265678672 + -0.041636073921966096i, 0.005348562036336426 + 0.02946347727165065i, 0.017703513290322718 + 0.0015778053696770692i }, { 0.0016326560830369295 + 0.007041853414445235i, 0.020840009184405296 + 0.0008474119279454565i, -0.002731727817503556 + 0.0011788641678389178i, 0.0011888823246609184 + 0.00850191686749461i, 0.01145436265678672 + 0.041636073921966096i, 0.12459826622901213 + 1.164459598095697e-19i, -0.016019370535676737 + 0.0076995857191089695i, 0.00915988403714065 + 0.050458802441807095i }, { 0.0010949733745780786 + -0.004891614627755169i, -0.0026269956895842318 + -0.0013967645621374958i, 0.01830408277132157 + 0.0007442942051160851i, 0.003307720259992844 + -0.010357931326049855i, 0.005348562036336426 + -0.02946347727165065i, -0.016019370535676737 + -0.0076995857191089695i, 0.10943646703983358 + -3.010402058453839e-20i, 0.01722954990585025 + -0.06262861016515328i }, { 0.0029717783550553918 + -0.00014349565694318312i, 0.001875238441052439 + -0.008377321313694477i, 0.00245582668408947 + 0.010592292951540103i, 0.03134735550461578 + 0.0012746694461169546i, 0.017703513290322714 + -0.0015778053696770692i, 0.009159884037140648 + -0.050458802441807095i, 0.01722954990585025 + 0.06262861016515328i, 0.18741959814789133 + -8.12220728276779e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.07445948598444196, 1.0e-7), DoubleNear(0.127518434384611, 1.0e-7), DoubleNear(0.11200129314683244, 1.0e-7), DoubleNear(0.1918120889811159, 1.0e-7), DoubleNear(0.07275436608626143, 1.0e-7), DoubleNear(0.12459826622901213, 1.0e-7), DoubleNear(0.10943646703983358, 1.0e-7), DoubleNear(0.18741959814789133, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.0669400759798866 + 2.868440126458796e-21i, 0.010538967594568446 + -0.03830865557313806i, 0.004921122516152423 + 0.02710885288805222i, 0.0162887066236004 + 0.00145171234400461i, 0.00024064518651391659 + -0.011342721114535808i, -0.006453357548417676 + -0.0019235019073552224i, 0.004611174964645374 + -0.0007364094615991729i, 0.0003045435309366179 + -0.0027548356684807635i }, { 0.010538967594568446 + 0.03830865557313806i, 0.11464078181154289 + 4.019954987289566e-20i, -0.014739155029359161 + 0.007084260103918791i, 0.008427856174104336 + 0.04642630059210268i, 0.006529131344169598 + -0.0016480676945746702i, 0.00041212609811541246 + -0.019425409926803652i, 0.0011474125003019717 + 0.0025229567726617855i, 0.007897043665973661 + -0.0012611661276947586i }, { 0.004921122516152423 + -0.02710885288805222i, -0.014739155029359161 + -0.007084260103918792i, 0.10069066384182489 + -9.667531682501391e-21i, 0.01585262083693223 + -0.05762353723210742i, -0.004575792738723995 + -0.0009313185609370283i, -0.001253385093227125 + 0.002472021870988448i, 0.00036197633817605185 + -0.017061619696076558i, -0.009707082731039469 + -0.00289331437285503i }, { 0.0162887066236004 + -0.00145171234400461i, 0.008427856174104336 + -0.04642630059210268i, 0.01585262083693223 + 0.05762353723210742i, 0.1724416391074674 + -1.4173557104192075e-20i, -0.00018742986513544473 + -0.002765273289970542i, -0.00783644848464942 + -0.0015949651442508388i, 0.00982106099718856 + -0.0024790086923840763i, 0.0006199163923603968 + -0.02921952794790879i }, { 0.00024064518651391648 + 0.011342721114535808i, 0.006529131344169598 + 0.0016480676945746704i, -0.004575792738723995 + 0.0009313185609370282i, -0.00018742986513544475 + 0.002765273289970542i, 0.08027377609081679 + -1.0289500823016421e-21i, 0.012638209809755201 + -0.0459393030976287i, 0.0059013540273810386 + 0.03250862737993089i, 0.01953323131429941 + 0.0017408768954178628i }, { -0.006453357548417676 + 0.0019235019073552224i, 0.00041212609811541246 + 0.019425409926803652i, -0.001253385093227125 + -0.0024720218709884476i, -0.007836448484649422 + 0.001594965144250839i, 0.012638209809755201 + 0.0459393030976287i, 0.13747591880208027 + 6.078492322653279e-21i, -0.017675026705229885 + 0.008495363965854388i, 0.010106589058084385 + 0.05567389047444757i }, { 0.004611174964645374 + 0.0007364094615991729i, 0.0011474125003019717 + -0.0025229567726617855i, 0.00036197633817605174 + 0.017061619696076558i, 0.00982106099718856 + 0.002479008692384076i, 0.0059013540273810386 + -0.03250862737993089i, -0.017675026705229885 + -0.008495363965854388i, 0.12074709634484113 + -1.3903687068943855e-20i, 0.01901028220970164 + -0.0691014890201335i }, { 0.0003045435309366179 + 0.002754835668480763i, 0.007897043665973661 + 0.0012611661276947586i, -0.009707082731039469 + 0.00289331437285503i, 0.0006199163923603961 + 0.02921952794790879i, 0.01953323131429941 + -0.001740876895417863i, 0.010106589058084384 + -0.05567389047444757i, 0.01901028220970164 + 0.0691014890201335i, 0.20679004802153983 + 3.388471510996842e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.0669400759798866, 1.0e-7), DoubleNear(0.11464078181154289, 1.0e-7), DoubleNear(0.10069066384182489, 1.0e-7), DoubleNear(0.1724416391074674, 1.0e-7), DoubleNear(0.08027377609081679, 1.0e-7), DoubleNear(0.13747591880208027, 1.0e-7), DoubleNear(0.12074709634484113, 1.0e-7), DoubleNear(0.20679004802153983, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.04641878192286182 + 6.0143998676297e-20i, 0.007308118960178226 + -0.0265646715032386i, 0.0034124925845856703 + 0.01879830448306537i, 0.01129520559244012 + 0.001006672277027653i, -0.002383488642976878 + 0.0038243637147545276i, 0.0018133639824528375 + 0.0019661329751922366i, -0.0017239829993068376 + -0.0006840966330831188i, -0.0006629186269842273 + 0.0008789024784562906i }, { 0.007308118960178226 + 0.0265646715032386i, 0.07949625650223839 + 1.839866495268913e-19i, -0.010220687876730937 + 0.004912494048370123i, 0.005844194409646926 + 0.03219375375847453i, -0.0025638713340699133 + -0.0007619262374600684i, -0.004081934438674738 + 0.00654956003221283i, 0.00012007487614232835 + -0.0010943092326936971i, -0.002952472879321629 + -0.001171575796759736i }, { 0.0034124925845856703 + -0.01879830448306537i, -0.010220687876730937 + -0.004912494048370124i, 0.06982271678248811 + 2.4910788772046167e-20i, 0.010992807205006387 + -0.039958341385880725i, 0.0013735370383111721 + 0.0012463954387280272i, 0.0009295387702511636 + -0.0005898206059805121i, -0.003585222308276185 + 0.005752573709759823i, 0.002727645890854588 + 0.0029574396439719106i }, { 0.01129520559244012 + -0.001006672277027653i, 0.005844194409646926 + -0.03219375375847453i, 0.010992807205006387 + 0.039958341385880725i, 0.1195775583307596 + -4.5642756301661964e-20i, -0.0004970426272515516 + 0.0009822826982768956i, 0.002352303274445292 + 0.0021345620758640204i, -0.003856552339589413 + -0.001146082634734532i, -0.006140009289987399 + 0.009851789647109853i }, { -0.002383488642976878 + -0.0038243637147545276i, -0.0025638713340699133 + 0.0007619262374600684i, 0.0013735370383111721 + -0.0012463954387280272i, -0.0004970426272515518 + -0.0009822826982768956i, 0.10079507014784156 + -5.830450863213985e-20i, 0.015869058444145424 + -0.05768328716752816i, 0.007409983958947791 + 0.04081917578491774i, 0.02452673234545969 + 0.00218591696239482i }, { 0.001813363982452838 + -0.0019661329751922366i, -0.004081934438674738 + -0.006549560032212827i, 0.0009295387702511637 + 0.0005898206059805119i, 0.0023523032744452916 + -0.002134562075864021i, 0.015869058444145424 + 0.05768328716752816i, 0.17262044411138475 + -1.3770860733134235e-19i, -0.022193493857858106 + 0.010667130021403057i, 0.012690250822541795 + 0.06990643730807572i }, { -0.0017239829993068371 + 0.0006840966330831188i, 0.00012007487614232838 + 0.0010943092326936971i, -0.0035852223082761853 + -0.005752573709759824i, -0.003856552339589413 + 0.0011460826347345315i, 0.007409983958947791 + -0.04081917578491774i, -0.022193493857858106 + -0.010667130021403057i, 0.15161504340417792 + -4.8482007523491413e-20i, 0.023870095841627487 + -0.08676668486636019i }, { -0.0006629186269842273 + -0.0008789024784562906i, -0.002952472879321628 + 0.001171575796759736i, 0.002727645890854588 + -0.0029574396439719106i, -0.0061400092899874 + -0.009851789647109851i, 0.02452673234545969 + -0.00218591696239482i, 0.012690250822541795 + -0.06990643730807572i, 0.023870095841627484 + 0.08676668486636019i, 0.2596541287982477 + 6.535391430743831e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.04641878192286182, 1.0e-7), DoubleNear(0.07949625650223839, 1.0e-7), DoubleNear(0.06982271678248811, 1.0e-7), DoubleNear(0.1195775583307596, 1.0e-7), DoubleNear(0.10079507014784156, 1.0e-7), DoubleNear(0.17262044411138475, 1.0e-7), DoubleNear(0.15161504340417792, 1.0e-7), DoubleNear(0.2596541287982477, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.16468232132513524 + -4.338710352045614e-20i, 0.02592739285753718 + -0.0942448635481836i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01107221648357675 + -0.009757998494873497i, -0.0038411380468122676 + -0.007872727210292238i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02592739285753718 + 0.0942448635481836i, 0.2820329942996459 + 1.1243931652015612e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.007327531780680258 + 0.004800151375265714i, 0.01896214689755183 + -0.016711432725356926i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01107221648357675 + 0.009757998494873495i, 0.007327531780680258 + -0.004800151375265715i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20396929093223415 + 2.1655374813168036e-20i, 0.03211268759342034 + -0.11672812137482409i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003841138046812267 + 0.007872727210292238i, 0.01896214689755183 + 0.016711432725356922i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03211268759342034 + 0.11672812137482409i, 0.3493153934429845 + -4.645011631883085e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.16468232132513524, 1.0e-7), DoubleNear(0.2820329942996459, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20396929093223415, 1.0e-7), DoubleNear(0.3493153934429845, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.1864607791312744 + -1.8461408669164326e-20i, 0.029356167888320555 + -0.1067083008358883i, 0.0 + 0.0i, 0.0 + 0.0i, 0.030472804723330825 + -0.001239107812861559i, 0.004088482767126399 + -0.01763414636598534i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02935616788832055 + 0.1067083008358883i, 0.3193305233657269 + 3.076531321943349e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.005506722998438971 + 0.017243978984345428i, 0.052187364689021076 + -0.0021220813740624126i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.030472804723330825 + 0.001239107812861559i, 0.00550672299843897 + -0.017243978984345428i, 0.0 + 0.0i, 0.0 + 0.0i, 0.182190833126095 + -3.270320038123771e-21i, 0.028683912562636967 + -0.10426468408711938i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004088482767126399 + 0.01763414636598534i, 0.052187364689021076 + 0.0021220813740624126i, 0.0 + 0.0i, 0.0 + 0.0i, 0.028683912562636967 + 0.10426468408711938i, 0.3120178643769035 + 3.522388698189178e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1864607791312744, 1.0e-7), DoubleNear(0.3193305233657269, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.182190833126095, 1.0e-7), DoubleNear(0.3120178643769035, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.1676307398217115 + -6.799091556042592e-21i, 0.026391588431500676 + -0.09593219280524548i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0006026215246899685 + -0.028404340810612362i, -0.016160440279457147 + -0.004816816280210252i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026391588431500676 + 0.09593219280524548i, 0.28708242091901026 + 2.602599276870357e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01635019234135816 + -0.004127076386958747i, 0.0010320424904758092 + -0.04864493787471244i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0006026215246899682 + 0.028404340810612362i, 0.016350192341358157 + 0.004127076386958747i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2010208724356579 + -1.4932637151245494e-20i, 0.031648492019456846 + -0.11504079211776219i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.016160440279457147 + 0.004816816280210252i, 0.0010320424904758086 + 0.04864493787471244i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03164849201945684 + 0.11504079211776219i, 0.3442659668236201 + 3.99632074326217e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1676307398217115, 1.0e-7), DoubleNear(0.28708242091901026, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2010208724356579, 1.0e-7), DoubleNear(0.3442659668236201, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.11624149870534993 + 8.505478744834317e-20i, 0.01830092616518461 + -0.06652301288911933i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005968710951253063 + 0.009576937424514351i, 0.004541009873307425 + 0.004923572619164147i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01830092616518461 + 0.06652301288911933i, 0.19907381483299802 + 1.383438932252293e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.006420423673659326 + -0.0019080088721946003i, -0.010221943728662137 + 0.016401349679322684i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005968710951253064 + -0.009576937424514351i, -0.006420423673659326 + 0.0019080088721946i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2524101135520195 + -1.0678651615563126e-19i, 0.03973915428577291 + -0.14444997203388837i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004541009873307426 + -0.004923572619164146i, -0.010221943728662137 + -0.01640134967932268i, 0.0 + 0.0i, 0.0 + 0.0i, 0.039739154285772904 + 0.14444997203388837i, 0.43227457290963234 + -7.235469302390405e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11624149870534993, 1.0e-7), DoubleNear(0.19907381483299802, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2524101135520195, 1.0e-7), DoubleNear(0.43227457290963234, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.06487059840050502 + -3.3874484401754614e-20i, 0.010213151454871477 + -0.037124329104361996i, 0.011780690331762699 + -0.007500714860887034i, -0.0024377921016847806 + -0.007922790517113178i, 0.008174792591686006 + -0.018987610803126206i, -0.009579253665477336 + -0.007667680701219816i, 0.000646646690532966 + 0.020899667386732046i, 0.012062327928500417 + 0.0029203544979487213i }, { 0.010213151454871477 + 0.037124329104361996i, 0.11109661900370485 + 8.501883597906961e-20i, 0.006147268430495579 + 0.005560982894464574i, 0.020175470824364723 + -0.012845635491299964i, 0.012153313313750922 + 0.0016889060427461215i, 0.014000053034592924 + -0.03251795752155603i, -0.011858713324934397 + 0.0036604840834777324i, 0.0011074394684108275 + 0.03579252299528425i }, { 0.011780690331762699 + 0.007500714860887034i, 0.006147268430495579 + -0.005560982894464574i, 0.12159018073076938 + 1.54130757325903e-20i, 0.01914301643344908 + -0.0695839717315263i, 0.011091292503350692 + -0.005792007413692509i, -0.0015684661733139174 + -0.007259243072239765i, 0.02229801213164482 + 0.017748502990264647i, 0.013667736432603734 + -0.009966465664765525i }, { -0.0024377921016847806 + 0.007922790517113178i, 0.020175470824364723 + 0.012845635491299962i, 0.019143016433449074 + 0.0695839717315263i, 0.20823390436202205 + -5.425352275963612e-20i, 0.005060866519851166 + 0.005435469270167994i, 0.01899481626323038 + -0.009919323341722422i, -0.00664659031531195 + 0.015555072941599305i, 0.03818731165442815 + 0.030395876147493613i }, { 0.008174792591686006 + 0.018987610803126206i, 0.012153313313750922 + -0.0016889060427461215i, 0.011091292503350692 + 0.005792007413692509i, 0.005060866519851167 + -0.005435469270167993i, 0.09981172292463021 + -9.512619118701524e-21i, 0.015714241402665707 + -0.05712053444382159i, -0.0007084738481859483 + -0.002257283633986462i, -0.0014033459451274865 + 5.006330682094094e-05i }, { -0.009579253665477336 + 0.007667680701219815i, 0.014000053034592924 + 0.03251795752155603i, -0.0015684661733139178 + 0.0072592430722397665i, 0.01899481626323038 + 0.009919323341722422i, 0.015714241402665703 + 0.05712053444382159i, 0.170936375295941 + 2.7420480541086514e-20i, 0.0011802633501846788 + -0.0007608315191988597i, -0.001213323926812893 + -0.003865797234056963i }, { 0.0006466466905329661 + -0.020899667386732046i, -0.011858713324934397 + -0.0036604840834777324i, 0.02229801213164482 + -0.017748502990264647i, -0.006646590315311951 + -0.015555072941599305i, -0.0007084738481859482 + 0.002257283633986462i, 0.0011802633501846785 + 0.0007608315191988595i, 0.08237911020146478 + 6.242299080577746e-21i, 0.012969671159971259 + -0.0471441496432978i }, { 0.012062327928500417 + -0.0029203544979487213i, 0.001107439468410828 + -0.03579252299528425i, 0.013667736432603734 + 0.009966465664765525i, 0.03818731165442815 + -0.030395876147493613i, -0.0014033459451274865 + -5.0063306820941014e-05i, -0.001213323926812893 + 0.0038657972340569624i, 0.012969671159971262 + 0.0471441496432978i, 0.14108148908096246 + 7.803406440805278e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.06487059840050502, 1.0e-7), DoubleNear(0.11109661900370485, 1.0e-7), DoubleNear(0.12159018073076938, 1.0e-7), DoubleNear(0.20823390436202205, 1.0e-7), DoubleNear(0.09981172292463021, 1.0e-7), DoubleNear(0.170936375295941, 1.0e-7), DoubleNear(0.08237911020146478, 1.0e-7), DoubleNear(0.14108148908096246, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.07493216294285943 + -7.154879184377905e-21i, 0.011797232457324973 + -0.042882389652362685i, 0.004809324073650894 + -0.004382461084039401i, -0.001750832815044566 + -0.003442263120458326i, 0.00031964165278818436 + -0.01256263024228611i, -0.007139053474743713 + -0.0021607713001842196i, -0.0008010891108871229 + -0.0008034389330316312i, -0.000585916836296154 + 0.0003319570470700984i }, { 0.011797232457324973 + 0.042882389652362685i, 0.1283279353489296 + 8.275359371596822e-20i, 0.0032651815761428962 + 0.002062323983161075i, 0.0082363914847374 + -0.007505350981135676i, 0.007239701493775576 + -0.0017949204461406596i, 0.0005474145112440799 + -0.021514611859982706i, 0.0003336717631791831 + -0.0005849420267100738i, -0.0013719357295084006 + -0.0013759600071002794i }, { 0.004809324073650894 + 0.004382461084039401i, 0.003265181576142896 + -0.0020623239831610756i, 0.09269857687885207 + 3.557876283353065e-22i, 0.014594355974175705 + -0.0530498031528828i, 0.00037917363439923693 + -0.0008784941491280364i, -0.00044305045523440796 + -0.0003553036530678582i, 0.00028297987190178405 + -0.01584171056832625i, -0.009021386804713432 + -0.0026560449800260327i }, { -0.001750832815044566 + 0.003442263120458326i, 0.0082363914847374 + 0.007505350981135675i, 0.014594355974175705 + 0.0530498031528828i, 0.15875448557008068 + -5.672760094726464e-20i, 0.0005624437659575391 + 7.868546182289398e-05i, 0.0006493682783227442 + -0.0015044986818234978i, 0.009110490847582583 + -0.002332155940818087i, 0.0004846279792317293 + -0.027130326014729738i }, { 0.00031964165278818414 + 0.01256263024228611i, 0.007239701493775575 + 0.0017949204461406598i, 0.00037917363439923715 + 0.0008784941491280363i, 0.0005624437659575391 + -7.8685461822894e-05i, 0.0897501583822758 + -3.6232224336078236e-20i, 0.01413016040021221 + -0.05136247389582091i, 0.006262892409925857 + -0.005375537410834095i, -0.0020903052317677016 + -0.0044304640898339106i }, { -0.007139053474743714 + 0.0021607713001842196i, 0.0005474145112440794 + 0.021514611859982706i, -0.00044305045523440785 + 0.00035530365306785816i, 0.0006493682783227444 + 0.0015044986818234982i, 0.01413016040021221 + 0.05136247389582091i, 0.15370505895071623 + 2.968572280418791e-20i, 0.004062350204537362 + 0.0027378273921046387i, 0.01072575541281443 + -0.00920608174422125i }, { -0.0008010891108871226 + 0.000803438933031631i, 0.0003336717631791832 + 0.0005849420267100736i, 0.00028297987190178405 + 0.01584171056832625i, 0.009110490847582583 + 0.0023321559408180864i, 0.006262892409925856 + 0.005375537410834094i, 0.004062350204537362 + -0.0027378273921046395i, 0.1112707140533821 + 2.1299587184832736e-20i, 0.017518331619244633 + -0.06367831822194128i }, { -0.000585916836296154 + -0.0003319570470700984i, -0.0013719357295084004 + 0.0013759600071002794i, -0.009021386804713432 + 0.0026560449800260323i, 0.0004846279792317292 + 0.027130326014729735i, -0.002090305231767701 + 0.0044304640898339106i, 0.01072575541281443 + 0.009206081744221249i, 0.017518331619244633 + 0.06367831822194128i, 0.19056090787290386 + 1.027748462843379e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.07493216294285943, 1.0e-7), DoubleNear(0.1283279353489296, 1.0e-7), DoubleNear(0.09269857687885207, 1.0e-7), DoubleNear(0.15875448557008068, 1.0e-7), DoubleNear(0.0897501583822758, 1.0e-7), DoubleNear(0.15370505895071623, 1.0e-7), DoubleNear(0.1112707140533821, 1.0e-7), DoubleNear(0.19056090787290386, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.051926857782857994 + -2.4147406015673973e-20i, 0.008175304008106262 + -0.02971684869907433i, 0.003491239412083468 + -0.0030768463549177647i, -0.0012111696475746877 + -0.002482391448715181i, -0.0026663145964621006 + 0.004278164624310707i, 0.0020285386588097744 + 0.0021994352965714423i, 7.422965283177736e-05 + 0.0004456256026838224i, 0.0002667105074529828 + 2.7678420665452726e-05i }, { 0.008175304008106262 + 0.02971684869907433i, 0.08892932202575196 + 8.056785683438812e-20i, 0.002310482980887405 + 0.0015135612359234414i, 0.005979055294361769 + -0.005269370649470929i, -0.0028681015878235425 + -0.0008523367855572941i, -0.004566298819048058 + 0.007326734098671034i, -0.00024333724728562862 + 0.00011263913103275468i, 0.00012712482484769318 + 0.0007631731326726216i }, { 0.003491239412083468 + 0.003076846354917764i, 0.002310482980887405 + -0.0015135612359234417i, 0.06431464092249194 + 1.0920219346401715e-19i, 0.010125622157078351 + -0.036806164190044996i, -0.0004327625200854893 + 0.00012964883468856444i, 6.062173851432454e-06 + 0.000268074317689249i, -0.003302396354790962 + 0.005298772800203643i, 0.0025124712144976506 + 0.002724137322592705i }, { -0.0012111696475746877 + 0.002482391448715181i, 0.005979055294361769 + 0.005269370649470928i, 0.010125622157078351 + 0.036806164190044996i, 0.11014449280724604 + 5.777603639084121e-20i, -0.00014232942806534013 + -0.00022725079463657455i, -0.0007411439696638668 + 0.0002220350597468452i, -0.003552322085835783 + -0.0010556720866373064i, -0.005655644909614078 + 0.00907461558065165i }, { -0.0026663145964621006 + -0.004278164624310708i, -0.002868101587823542 + 0.000852336785557294i, -0.00043276252008548943 + -0.0001296488346885643i, -0.00014232942806534 + 0.0002272507946365746i, 0.11275546354227725 + -1.9239697504782168e-20i, 0.01775208884943092 + -0.06452801484910926i, 0.007580977071493283 + -0.006681152139955732i, -0.00262996839923758 + -0.005390335761577056i }, { 0.0020285386588097744 + -0.0021994352965714423i, -0.004566298819048058 + -0.007326734098671033i, 6.0621738514323894e-06 + -0.000268074317689249i, -0.0007411439696638667 + -0.00022203505974684526i, 0.01775208884943092 + 0.06452801484910926i, 0.1931036722738939 + 3.1871459685768007e-20i, 0.005017048799792853 + 0.003286590139342273i, 0.012983091603190063 + -0.011442062075885998i }, { 7.422965283177728e-05 + -0.00044562560268382234i, -0.0002433372472856288 + -0.00011263913103275465i, -0.0033023963547909626 + -0.005298772800203643i, -0.003552322085835784 + 0.001055672086637306i, 0.007580977071493282 + 0.006681152139955731i, 0.005017048799792853 + -0.0032865901393422732i, 0.13965465000974223 + -8.754681865084912e-20i, 0.02198706543634199 + -0.0799219571847791i }, { 0.0002667105074529828 + -2.7678420665452753e-05i, 0.00012712482484769305 + -0.0007631731326726215i, 0.0025124712144976515 + -0.002724137322592704i, -0.005655644909614078 + -0.009074615580651646i, -0.0026299683992375795 + 0.005390335761577056i, 0.012983091603190063 + 0.011442062075885995i, 0.021987065436341987 + 0.0799219571847791i, 0.23917090063573848 + -1.0422615270967206e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.051926857782857994, 1.0e-7), DoubleNear(0.08892932202575196, 1.0e-7), DoubleNear(0.06431464092249194, 1.0e-7), DoubleNear(0.11014449280724604, 1.0e-7), DoubleNear(0.11275546354227725, 1.0e-7), DoubleNear(0.1931036722738939, 1.0e-7), DoubleNear(0.13965465000974223, 1.0e-7), DoubleNear(0.23917090063573848, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.08474203832782207 + -4.167130675217953e-20i, 0.013341687811990842 + -0.048496412819155274i, 0.013821112092363107 + -0.0006737918559463546i, 0.0017903802852104506 + -0.008015666033611864i, 0.0002626232552396372 + -0.014427706813133i, -0.0082153816676757 + -0.002421776133727796i, -0.0002048766826960606 + -0.0024669127464001786i, -0.001444027333935045 + -0.00027114046339030796i }, { 0.01334168781199084 + 0.048496412819155274i, 0.1451282118222315 + -4.945928145813456e-20i, 0.0025615792944613516 + 0.007803504023594535i, 0.023669872980866605 + -0.0011539279574040206i, 0.008298075866510556 + -0.002121186578571194i, 0.0004497654784797497 + -0.024708719919921615i, 0.0013795162413433593 + -0.000505635275578113i, -0.00035086938183770356 + -0.004224805570778737i }, { 0.013821112092363107 + 0.0006737918559463546i, 0.0025615792944613516 + -0.007803504023594535i, 0.08288870149388941 + 3.4872215196136934e-20i, 0.013049900619509835 + -0.04743577998609022i, 0.0002327115739021949 + -0.002229165389388561i, -0.0012390752201466328 + -0.00048413403868766456i, 0.00033999826945033124 + -0.013976633997479362i, -0.007945058611781446 + -0.0023950401464824566i }, { 0.0017903802852104506 + 0.008015666033611864i, 0.023669872980866605 + 0.0011539279574040206i, 0.013049900619509835 + 0.04743577998609022i, 0.1419542090967788 + 7.548527422683813e-20i, 0.0013123508984405493 + -0.0002177803663320891i, 0.0003985390870598687 + -0.003817642261169867i, 0.008052116474847602 + -0.0020058898083875525i, 0.0005822770119960595 + -0.023936217954790825i }, { 0.00026262325523963707 + 0.014427706813133i, 0.008298075866510556 + 0.002121186578571194i, 0.0002327115739021949 + 0.002229165389388561i, 0.0013123508984405493 + 0.000217780366332089i, 0.1017187408034523 + 2.32098980830152e-20i, 0.01601448007632971 + -0.058211888016733035i, 0.016651692630967718 + -0.0005653159569152045i, 0.0022981024819159483 + -0.009618480332373475i }, { -0.0082153816676757 + 0.002421776133727796i, 0.0004497654784797492 + 0.024708719919921615i, -0.0012390752201466328 + 0.0004841340386876645i, 0.0003985390870598684 + 0.003817642261169867i, 0.01601448007632971 + 0.058211888016733035i, 0.17420231154349541 + 8.022459467756805e-20i, 0.002945143703977619 + 0.009440474960750893i, 0.028517491708154468 + -0.0009681534166583921i }, { -0.00020487668269606076 + 0.0024669127464001786i, 0.0013795162413433593 + 0.000505635275578113i, 0.0003399982694503311 + 0.013976633997479362i, 0.008052116474847602 + 0.002005889808387552i, 0.016651692630967718 + 0.0005653159569152045i, 0.0029451437039776183 + -0.009440474960750893i, 0.09930213163220558 + -3.81425352342607e-20i, 0.01563401194312713 + -0.05682890410102916i }, { -0.0014440273339350446 + 0.00027114046339030796i, -0.0003508693818377038 + 0.004224805570778737i, -0.007945058611781446 + 0.0023950401464824566i, 0.0005822770119960594 + 0.023936217954790825i, 0.0022981024819159483 + 0.009618480332373475i, 0.028517491708154468 + 0.0009681534166583921i, 0.01563401194312713 + 0.05682890410102916i, 0.17006365528012465 + -4.026138724494635e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.08474203832782207, 1.0e-7), DoubleNear(0.1451282118222315, 1.0e-7), DoubleNear(0.08288870149388941, 1.0e-7), DoubleNear(0.1419542090967788, 1.0e-7), DoubleNear(0.1017187408034523, 1.0e-7), DoubleNear(0.17420231154349541, 1.0e-7), DoubleNear(0.09930213163220558, 1.0e-7), DoubleNear(0.17006365528012465, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.058793939034382445 + 7.89644059354462e-20i, 0.009256449281990178 + -0.03364676133521248i, 0.009608541975729912 + -0.0003907096685202586i, 0.0012891612256125933 + -0.005560316390371788i, -0.003018922086262403 + 0.0048439316538773924i, 0.0022968032984719057 + 0.002490300207985607i, -0.0004611847598888129 + 0.0008116932366710758i, 0.0003919097044793239 + 0.0003917201535302496i }, { 0.009256449281990178 + 0.03364676133521248i, 0.10068980409742895 + 1.737297874761373e-19i, 0.0017363540888216153 + 0.005437290640097563i, 0.01645547525965879 + -0.0006691247538163775i, -0.0032473944524827325 + -0.0009650542926431414i, -0.005170170232571077 + 0.008295660017013397i, -0.0005371264873535302 + -0.00013613607798850172i, -0.0007898195611416415 + 0.0013900962298141603i }, { 0.009608541975729912 + 0.0003907096685202586i, 0.001736354088821615 + -0.005437290640097563i, 0.057447559670967485 + 6.090381512896969e-21i, 0.009044476883194433 + -0.032876251553906846i, -0.0005255645569190638 + 0.0007715693032526225i, 0.0003588115863821848 + 0.00042224654009800173i, -0.00294978886499066 + 0.004733005770636958i, 0.00224420657483552 + 0.00243327241117854i }, { 0.0012891612256125933 + 0.005560316390371786i, 0.016455475259658788 + 0.0006691247538163775i, 0.009044476883194433 + 0.032876251553906846i, 0.09838401073556904 + -3.538589425090798e-20i, -0.0005243001297739792 + -0.00017929659524325067i, -0.0009000756395278392 + 0.0013213804563539106i, -0.0031730292211765935 + -0.0009429545795514589i, -0.00505177349609106 + 0.008105689662309287i }, { -0.003018922086262403 + -0.0048439316538773924i, -0.0032473944524827334 + 0.0009650542926431414i, -0.0005255645569190637 + -0.0007715693032526226i, -0.000524300129773979 + 0.0001792965952432506i, 0.12766684009689194 + -9.742581460461052e-20i, 0.020099718606330377 + -0.07306153950067582i, 0.020864262747600913 + -0.0008483981443413004i, 0.0027993215415138056 + -0.012073829975613551i }, { 0.002296803298471906 + -0.002490300207985606i, -0.005170170232571077 + -0.008295660017013394i, 0.0003588115863821849 + -0.0004222465400980015i, -0.0009000756395278394 + -0.0013213804563539106i, 0.020099718606330374 + 0.07306153950067582i, 0.21864071926829798 + -1.4296447425670382e-19i, 0.0037703689096173555 + 0.011806688344247866i, 0.035731889429362285 + -0.0014529566202460351i }, { -0.0004611847598888128 + -0.0008116932366710758i, -0.0005371264873535302 + 0.00013613607798850161i, -0.0029497888649906608 + -0.00473300577063696i, -0.003173029221176593 + 0.0009429545795514586i, 0.020864262747600913 + 0.0008483981443413004i, 0.003770368909617355 + -0.011806688344247866i, 0.1247432734551275 + -9.36070155102074e-21i, 0.019639435679442534 + -0.07138843253321253i }, { 0.000391909704479324 + -0.00039172015353024974i, -0.0007898195611416414 + -0.0013900962298141603i, 0.00224420657483552 + -0.0024332724111785406i, -0.00505177349609106 + -0.008105689662309285i, 0.0027993215415138056 + 0.012073829975613553i, 0.035731889429362285 + 0.0014529566202460351i, 0.019639435679442534 + 0.07138843253321253i, 0.21363385364133441 + 7.060978123279976e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.058793939034382445, 1.0e-7), DoubleNear(0.10068980409742895, 1.0e-7), DoubleNear(0.057447559670967485, 1.0e-7), DoubleNear(0.09838401073556904, 1.0e-7), DoubleNear(0.12766684009689194, 1.0e-7), DoubleNear(0.21864071926829798, 1.0e-7), DoubleNear(0.1247432734551275, 1.0e-7), DoubleNear(0.21363385364133441, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.05285653928554819 + 2.9927049896771426e-20i, 0.008321671981053673 + -0.03024888945280723i, 0.0001900157950025749 + -0.00895632362854833i, -0.005095634293634778 + -0.0015188159356511145i, -0.002714051422192041 + 0.0043547594865170295i, 0.002064856952446444 + 0.002238813267796604i, 0.0007281392835643837 + 0.0004755399484585954i, 0.0003867807442938211 + -0.0003418331482546721i }, { 0.008321671981053673 + 0.03024888945280723i, 0.09052148356342572 + 4.2861851335608703e-20i, 0.005155466024527644 + -0.0013013303849506099i, 0.0003254188014692777 + -0.015338493838018415i, -0.002919451141944189 + -0.0008675967449969467i, -0.00464805234177376 + 0.007457909553098642i, -0.00015750594286924343 + 0.0004915700594656408i, 0.0012470027186793024 + 0.0008144040871763365i }, { 0.0001900157950025748 + 0.00895632362854833i, 0.005155466024527643 + 0.0013013303849506096i, 0.06338495941980174 + 5.512773755157175e-20i, 0.00997925418413094 + -0.036274123436312096i, -0.0007476529575822622 + -0.0004442297984918995i, -0.00037193469342900495 + 0.00035792992222787837i, -0.0032546595290610216 + 0.005222177937997321i, 0.002476152920860981 + 0.0026847593513675432i }, { -0.005095634293634778 + 0.0015188159356511147i, 0.0003254188014692775 + 0.015338493838018413i, 0.00997925418413094 + 0.036274123436312096i, 0.10855233126957228 + 9.548204188962062e-20i, 0.00013651547178634472 + -0.0004978079663536279i, -0.0012804216058358892 + -0.0007607826949344576i, -0.003500972531715137 + -0.0010404121271976536i, -0.0055738913868883765 + 0.008943440126224042i }, { -0.002714051422192041 + -0.0043547594865170295i, -0.002919451141944189 + 0.0008675967449969466i, -0.0007476529575822623 + 0.00044422979849189953i, 0.0001365154717863447 + 0.0004978079663536279i, 0.1147742005361633 + -3.672614145281402e-20i, 0.018069916450447004 + -0.06568330335243826i, 0.00041260572968739354 + -0.019448017182064032i, -0.011064805985822369 + -0.0032980003445591374i }, { 0.0020648569524464445 + -0.0022388132677966036i, -0.00464805234177376 + -0.007457909553098641i, -0.00037193469342900484 + -0.0003579299222278785i, -0.0012804216058358887 + 0.0007607826949344578i, 0.018069916450447004 + 0.06568330335243826i, 0.19656093735558455 + -1.6835858566905133e-20i, 0.011194726316830515 + -0.002825746002008137i, 0.0007066236890065315 + -0.03330644403669403i }, { 0.0007281392835643836 + -0.0004755399484585955i, -0.0001575059428692434 + -0.0004915700594656408i, -0.0032546595290610224 + -0.005222177937997322i, -0.003500972531715137 + 0.0010404121271976533i, 0.00041260572968739343 + 0.019448017182064032i, 0.011194726316830515 + 0.002825746002008137i, 0.13763591301585615 + -7.006037470281724e-20i, 0.021669237835325907 + -0.0787666686814501i }, { 0.0003867807442938211 + 0.0003418331482546722i, 0.0012470027186793021 + -0.0008144040871763366i, 0.0024761529208609813 + -0.0026847593513675432i, -0.0055738913868883765 + -0.008943440126224039i, -0.011064805985822369 + 0.0032980003445591374i, 0.0007066236890065311 + 0.03330644403669403i, 0.021669237835325903 + 0.0787666686814501i, 0.23571363555404778 + -5.551883445699892e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.05285653928554819, 1.0e-7), DoubleNear(0.09052148356342572, 1.0e-7), DoubleNear(0.06338495941980174, 1.0e-7), DoubleNear(0.10855233126957228, 1.0e-7), DoubleNear(0.1147742005361633, 1.0e-7), DoubleNear(0.19656093735558455, 1.0e-7), DoubleNear(0.13763591301585615, 1.0e-7), DoubleNear(0.23571363555404778, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.19501256391451252 + 3.751595670875222e-20i, 0.0008570620350843013 + -0.008028867009480245i, 0.014336415146894588 + 0.07897461765757255i, 0.0033144731111896817 + -0.0002431588156458375i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0008570620350843011 + 0.008028867009480243i, 0.204317988769814 + 1.0601575530953875e-20i, -0.0031884586955544187 + 0.0009373309773869164i, 0.015020506628827592 + 0.08274305367696082i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.014336415146894588 + -0.07897461765757255i, -0.0031884586955544187 + -0.0009373309773869165i, 0.293336155219611 + -8.330709326537308e-20i, 0.0012891850510028321 + -0.012076949977248327i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0033144731111896817 + 0.0002431588156458378i, 0.015020506628827594 + -0.08274305367696082i, 0.0012891850510028326 + 0.012076949977248327i, 0.3073332920960623 + 7.944703251970422e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.19501256391451252, 1.0e-7), DoubleNear(0.204317988769814, 1.0e-7), DoubleNear(0.293336155219611, 1.0e-7), DoubleNear(0.3073332920960623, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.08719199144012937 + -1.7371218495111454e-20i, 0.000347171857724093 + -0.0037050285944315734i, 0.006409948988302849 + 0.03531031051827587i, 0.0015259551003375775 + -0.00013178157765733817i, 0.005678173319829711 + -0.005161698771522744i, 0.00017058613106032643 + -0.0006990113062374401i, 0.002507776048460414 + 0.0019200368579295956i, 0.000295620667122132 + 1.7694543009513477e-05i }, { 0.0003471718577240932 + 0.003705028594431574i, 0.09119508244086785 + -2.193853854042679e-20i, -0.0014749101852844831 + 0.00041297130384593923i, 0.006704237588510898 + 0.03693145007403483i, 0.001046717561881304 + 0.00013293432705900412i, 0.006315465608678265 + -0.00540835382689164i, 2.3115125329054187e-05 + 0.0004336639611697341i, 0.002654515186388254 + 0.0021599894263015385i }, { 0.006409948988302849 + -0.03531031051827587i, -0.0014749101852844831 + -0.00041297130384593923i, 0.13115341402413824 + 3.1432195707948545e-21i, 0.0005222128046574358 + -0.005573070888631077i, -0.001672910352065748 + -0.0026789649491904778i, -0.0002705392719125856 + -0.00012047065217329062i, 0.008541057544577362 + -0.007764181146318406i, 0.00025659413329369066 + -0.0010514465576516095i }, { 0.0015259551003375775 + 0.00013178157765733812i, 0.006704237588510897 + -0.03693145007403483i, 0.0005222128046574359 + 0.005573070888631077i, 0.13717482771964562 + 1.052187504644434e-19i, 0.00013078447177848336 + -0.0004141185363854481i, -0.0017259479700561067 + -0.0029551833786009823i, 0.001574463198882426 + 0.00019995862632362748i, 0.009499666908043243 + -0.008135197475497633i }, { 0.005678173319829711 + 0.005161698771522744i, 0.001046717561881304 + -0.00013293432705900404i, -0.0016729103520657478 + 0.0026789649491904778i, 0.00013078447177848336 + 0.0004141185363854481i, 0.10782057247438315 + 5.488717520386368e-20i, 0.0005098901773602079 + -0.004323838415048669i, 0.00792646615859174 + 0.04366430713929668i, 0.0017885180108521037 + -0.00011137723798849953i }, { 0.00017058613106032646 + 0.0006990113062374401i, 0.006315465608678265 + 0.005408353826891639i, -0.0002705392719125855 + 0.00012047065217329066i, -0.0017259479700561064 + 0.0029551833786009823i, 0.0005098901773602079 + 0.004323838415048669i, 0.11312290632894614 + 3.2540114071380674e-20i, -0.0017135485102699357 + 0.0005243596735409772i, 0.008316269040316696 + 0.045811603602925986i }, { 0.0025077760484604134 + -0.0019200368579295958i, 2.311512532905424e-05 + -0.0004336639611697341i, 0.008541057544577364 + 0.007764181146318405i, 0.001574463198882426 + -0.00019995862632362737i, 0.00792646615859174 + -0.04366430713929668i, -0.0017135485102699353 + -0.0005243596735409772i, 0.1621827411954727 + -8.645031283616795e-20i, 0.0007669722463453961 + -0.006503879088617249i }, { 0.000295620667122132 + -1.769454300951347e-05i, 0.002654515186388254 + -0.0021599894263015385i, 0.00025659413329369066 + 0.00105144655765161i, 0.009499666908043243 + 0.008135197475497631i, 0.0017885180108521037 + 0.00011137723798849958i, 0.008316269040316696 + -0.045811603602925986i, 0.000766972246345396 + 0.0065038790886172496i, 0.17015846437641666 + -2.5771717944739153e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.08719199144012937, 1.0e-7), DoubleNear(0.09119508244086785, 1.0e-7), DoubleNear(0.13115341402413824, 1.0e-7), DoubleNear(0.13717482771964562, 1.0e-7), DoubleNear(0.10782057247438315, 1.0e-7), DoubleNear(0.11312290632894614, 1.0e-7), DoubleNear(0.1621827411954727, 1.0e-7), DoubleNear(0.17015846437641666, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.0985723770396893 + -7.568775263206019e-20i, 0.0005202543137361842 + -0.0039931872548279335i, 0.007246581917033295 + 0.03991904742978572i, 0.001655375489808576 + -8.28721206884302e-05i, 0.016091269967554753 + -0.0006916601085990037i, 0.0004055827879422497 + -0.00035398947741273736i, 0.0014630581404298485 + 0.006465665296353566i, 0.00017317236479519292 + 0.0001382259940555769i }, { 0.0005202543137361842 + 0.0039931872548279335i, 0.10340554332936366 + -1.947437548421803e-20i, -0.0015788821431854912 + 0.0005042489252109238i, 0.0076018937852118116 + 0.041876344191289896i, -8.466036118285597e-05 + 0.001023667551487766i, 0.0169174611688598 + -0.0006505654270919251i, -0.0004207804765214241 + 4.097019789385511e-05i, 0.001507153675200669 + 0.006803270645096082i }, { 0.007246581917033295 + -0.03991904742978572i, -0.001578882143185491 + -0.000504248925210924i, 0.148271688301866 + 9.971488114807534e-21i, 0.0007825618876263201 + -0.006006516569448625i, 0.0009028522590329255 + -0.006567360553914183i, -0.00011353925082901846 + -0.00019027330838190882i, 0.024204344428559354 + -0.001040388951883897i, 0.0006100740036953927 + -0.0005324678072432859i }, { 0.001655375489808576 + 8.287212068843028e-05i, 0.0076018937852118116 + -0.041876344191289896i, 0.00078256188762632 + 0.006006516569448625i, 0.15554169382608238 + 9.749454455173988e-20i, 0.000408332805868414 + 0.00010954034046271028i, 0.0009802321801492754 + -0.006898923723603323i, -0.00012734535842402978 + 0.0015397915793165379i, 0.025447093847377998 + -0.0009785746993491431i }, { 0.016091269967554753 + 0.0006916601085990039i, -8.466036118285591e-05 + -0.0010236675514877663i, 0.0009028522590329259 + 0.006567360553914183i, 0.0004083328058684141 + -0.0001095403404627103i, 0.09644018687482322 + 1.132037093408124e-19i, 0.0003368077213481168 + -0.004035679754652309i, 0.0070898332298612934 + 0.03905557022778683i, 0.0016590976213811054 + -0.00016028669495740734i }, { 0.0004055827879422498 + 0.0003539894774127374i, 0.0169174611688598 + 0.0006505654270919251i, -0.00011353925082901847 + 0.00019027330838190885i, 0.0009802321801492754 + 0.006898923723603323i, 0.0003368077213481168 + 0.004035679754652309i, 0.10091244544045033 + 3.0075951015171904e-20i, -0.0016095765523689272 + 0.0004330820521759925i, 0.007418612843615781 + 0.04086670948567092i }, { 0.001463058140429848 + -0.006465665296353566i, -0.0004207804765214241 + -4.097019789385517e-05i, 0.024204344428559354 + 0.0010403889518838967i, -0.00012734535842402972 + -0.001539791579316538i, 0.0070898332298612934 + -0.03905557022778683i, -0.0016095765523689274 + -0.00043308205217599253i, 0.145064466917745 + -9.327858138018062e-20i, 0.0005066231633765119 + -0.0060704334077997i }, { 0.00017317236479519294 + -0.00013822599405557688i, 0.001507153675200669 + -0.006803270645096082i, 0.0006100740036953929 + 0.0005324678072432861i, 0.025447093847377998 + 0.0009785746993491431i, 0.0016590976213811054 + 0.00016028669495740747i, 0.007418612843615781 + -0.04086670948567092i, 0.0005066231633765121 + 0.0060704334077997i, 0.1517915982699799 + -1.8047512032035646e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.0985723770396893, 1.0e-7), DoubleNear(0.10340554332936366, 1.0e-7), DoubleNear(0.148271688301866, 1.0e-7), DoubleNear(0.15554169382608238, 1.0e-7), DoubleNear(0.09644018687482322, 1.0e-7), DoubleNear(0.10091244544045033, 1.0e-7), DoubleNear(0.145064466917745, 1.0e-7), DoubleNear(0.1517915982699799, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.08772578406717332 + 3.1637092938982495e-20i, -0.002217171438963507 + 0.0002230453692191859i, 0.00644919093533457 + 0.035526481557633646i, -0.00025332323191674857 + -0.000881494977621396i, -0.011199526162754743 + -0.019011576557071974i, 0.0019383649532338971 + -0.0023581961517721295i, 0.006875818184373319 + -0.005933136447946493i, 0.0010975028471362374 + 0.0006116198343259405i }, { -0.002217171438963507 + -0.00022304536921918577i, 0.09385507372425617 + 1.1430897060371958e-20i, -7.266899712499283e-05 + -0.0009142894904007922i, 0.006899787754922188 + 0.038008671922521255i, -0.008913773098761074 + 0.015512680544284932i, 0.011852297447384074 + -0.011756554484267483i, -0.006937499509473123 + -0.002469408044130385i, 0.005632400446245717 + 0.003935560858652561i }, { 0.00644919093533457 + -0.035526481557633646i, -7.266899712499278e-05 + 0.000914289490400792i, 0.131956340121609 + -1.0814863627787498e-19i, -0.003335049456882135 + 0.0003355028503444328i, -0.008522492155473401 + 0.0031378513786354334i, -0.0008125037258700403 + -0.0009583470230873262i, -0.01684622712977642 + -0.028597043492846294i, 0.0029156712335894727 + -0.0035471775691219465i }, { -0.00025332323191674857 + 0.0008814949776213962i, 0.006899787754922189 + -0.038008671922521255i, -0.0033350494568821346 + -0.00033550285034443246i, 0.1411759628276833 + 8.430754749118151e-20i, 0.00562690137052368 + 0.004750248046023956i, -0.003889749067900016 + -0.0056641350838233006i, -0.013408017805646558 + 0.023334035390690892i, 0.01782811986031287 + -0.017684104151139052i }, { -0.011199526162754743 + 0.019011576557071974i, -0.008913773098761074 + -0.015512680544284932i, -0.008522492155473401 + -0.0031378513786354334i, 0.00562690137052368 + -0.004750248046023956i, 0.1072867798473392 + 5.878863769769726e-21i, 0.003074233474047808 + -0.00825191237869943i, 0.00788722421156002 + 0.043448136099938896i, 0.00356779634310643 + 0.0006383361619755585i }, { 0.0019383649532338971 + 0.0023581961517721295i, 0.011852297447384074 + 0.011756554484267483i, -0.0008125037258700403 + 0.0009583470230873262i, -0.0038897490679000164 + 0.0056641350838233006i, 0.0030742334740478084 + 0.00825191237869943i, 0.11046291504555783 + -8.293215294180953e-22i, -0.0031157896984294257 + 0.0018516204677877087i, 0.008120718873905404 + 0.04473438175443956i }, { 0.006875818184373319 + 0.005933136447946493i, -0.006937499509473123 + 0.002469408044130385i, -0.016846227129776424 + 0.028597043492846294i, -0.013408017805646558 + -0.023334035390690892i, 0.007887224211560018 + -0.043448136099938896i, -0.0031157896984294257 + -0.0018516204677877085i, 0.16137981509800198 + 2.4841543012501887e-20i, 0.004624234507884967 + -0.012412452827592759i }, { 0.0010975028471362374 + -0.0006116198343259405i, 0.005632400446245717 + -0.003935560858652562i, 0.0029156712335894723 + 0.003547177569121947i, 0.01782811986031287 + 0.017684104151139052i, 0.00356779634310643 + -0.0006383361619755584i, 0.008120718873905404 + -0.04473438175443956i, 0.004624234507884967 + 0.012412452827592759i, 0.16615732926837895 + -4.86051497147729e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.08772578406717332, 1.0e-7), DoubleNear(0.09385507372425617, 1.0e-7), DoubleNear(0.131956340121609, 1.0e-7), DoubleNear(0.1411759628276833, 1.0e-7), DoubleNear(0.1072867798473392, 1.0e-7), DoubleNear(0.11046291504555783, 1.0e-7), DoubleNear(0.16137981509800198, 1.0e-7), DoubleNear(0.16615732926837895, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.061490447734621645 + 1.0990442422443392e-19i, 0.0002702447843144206 + -0.002531624718451961i, 0.0045204912370589885 + 0.024901906328268643i, 0.0010451041282691978 + -7.66716981949808e-05i, -0.0031573810805847645 + 0.005066092374226577i, 0.00019469981684148833 + 0.00015225761683467724i, -0.002283741238415454 + -0.0009062152542462651i, -4.7346640064459974e-05 + 9.004123449693271e-05i }, { 0.0002702447843144207 + 0.002531624718451961i, 0.06442459069047857 + 1.3422622397875438e-19i, -0.0010053698532928135 + 0.0002955548110239616i, 0.004736195757173607 + 0.026090151913271256i, -0.0002224526077401191 + -0.00010772760960823914i, -0.0033080420010668504 + 0.00530783137274078i, 2.7272980459016878e-05 + -9.800669758749773e-05i, -0.0023927146402130117 + -0.0009494571755965899i }, { 0.0045204912370589885 + -0.024901906328268643i, -0.0010053698532928135 + -0.0002955548110239616i, 0.09249338175520515 + 1.202971960478735e-23i, 0.00040649978856590946 + -0.003808047268663001i, 0.0018195093444329019 + 0.0016510862716979167i, 7.597348694277214e-05 + -6.765469323617953e-05i, -0.004749304394294727 + 0.00762037085823076i, 0.0002928657238683402 + 0.00022902454605316447i }, { 0.0010451041282691978 + 7.667169819498083e-05i, 0.004736195757173607 + -0.026090151913271256i, 0.00040649978856590946 + 0.003808047268663001i, 0.09690689335804256 + -2.0743997249220562e-20i, -5.998033911381293e-05 + 8.21674336639348e-05i, 0.0019063309683235623 + 0.001729871242894131i, -0.00033461122382693194 + -0.0001620429072833108i, -0.004975927203968856 + 0.007983992498638915i }, { -0.0031573810805847645 + -0.005066092374226576i, -0.00022245260774011915 + 0.00010772760960823917i, 0.0018195093444329019 + -0.0016510862716979167i, -5.99803391138129e-05 + -8.21674336639348e-05i, 0.13352211617989088 + -7.23884675156817e-20i, 0.0005868172507698807 + -0.005497242291028283i, 0.0098159239098356 + 0.054072711329303906i, 0.0022693689829204836 + -0.0001664871174508567i }, { 0.00019469981684148838 + -0.00015225761683467735i, -0.0033080420010668504 + -0.005307831372740779i, 7.597348694277218e-05 + 6.765469323617955e-05i, 0.001906330968323562 + -0.001729871242894131i, 0.0005868172507698804 + 0.0054972422910282825i, 0.13989339807933543 + -1.236246484478005e-19i, -0.002183088842261605 + 0.0006417761663629548i, 0.010284310871653985 + 0.05665290176368956i }, { -0.0022837412384154538 + 0.000906215254246265i, 2.7272980459016885e-05 + 9.800669758749768e-05i, -0.004749304394294727 + -0.00762037085823076i, -0.00033461122382693183 + 0.0001620429072833108i, 0.0098159239098356 + -0.054072711329303906i, -0.002183088842261605 + -0.0006417761663629549i, 0.20084277346440582 + -8.331912298497787e-20i, 0.0008826852624369227 + -0.008268902708585326i }, { -4.7346640064459954e-05 + -9.004123449693271e-05i, -0.0023927146402130117 + 0.0009494571755965899i, 0.0002928657238683403 + -0.00022902454605316455i, -0.004975927203968857 + -0.007983992498638915i, 0.0022693689829204836 + 0.00016648711745085698i, 0.010284310871653986 + -0.05665290176368956i, 0.0008826852624369231 + 0.008268902708585326i, 0.21042639873801972 + 1.0019102976892479e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.061490447734621645, 1.0e-7), DoubleNear(0.06442459069047857, 1.0e-7), DoubleNear(0.09249338175520515, 1.0e-7), DoubleNear(0.09690689335804256, 1.0e-7), DoubleNear(0.13352211617989088, 1.0e-7), DoubleNear(0.13989339807933543, 1.0e-7), DoubleNear(0.20084277346440582, 1.0e-7), DoubleNear(0.21042639873801972, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.21834540546426764 + -1.4227998924316614e-20i, 0.0008693846623815289 + -0.00927809948306265i, 0.0 + 0.0i, 0.0 + 0.0i, 0.014219230864407075 + -0.01292587991784115i, 0.0004271802643540171 + -0.0017504578638890497i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.000869384662381529 + 0.00927809948306265i, 0.22836991016051345 + 8.32802119240166e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0026211807607637297 + 0.00033289295338263157i, 0.01581513251672151 + -0.01354355130238927i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.014219230864407075 + 0.01292587991784115i, 0.00262118076076373 + -0.0003328929533826314i, 0.0 + 0.0i, 0.0 + 0.0i, 0.27000331366985586 + -3.156313763230425e-20i, 0.0012768624237056048 + -0.010827717503665919i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00042718026435401707 + 0.0017504578638890497i, 0.01581513251672151 + 0.01354355130238927i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0012768624237056037 + 0.010827717503665919i, 0.2832813707053628 + 6.7683961266414844e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21834540546426764, 1.0e-7), DoubleNear(0.22836991016051345, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27000331366985586, 1.0e-7), DoubleNear(0.2832813707053628, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.24684406534155529 + -6.571626451725261e-20i, 0.0013028162013625044 + -0.009999703824276559i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04029561439611411 + -0.001732049060482902i, 0.0010156567916376424 + -0.0008864572846560234i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001302816201362504 + 0.009999703824276559i, 0.258947237155446 + 7.802016906752186e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0002120057196068857 + 0.002563459130804304i, 0.0423645550162378 + -0.001629140126441067i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04029561439611411 + 0.001732049060482902i, -0.00021200571960688555 + -0.0025634591308043046i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2415046537925682 + 1.992512796063178e-20i, 0.000843430884724629 + -0.01010611316245201i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010156567916376428 + 0.0008864572846560234i, 0.0423645550162378 + 0.001629140126441067i, 0.0 + 0.0i, 0.0 + 0.0i, 0.000843430884724629 + 0.01010611316245201i, 0.2527040437104302 + 1.2028438983136252e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24684406534155529, 1.0e-7), DoubleNear(0.258947237155446, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2415046537925682, 1.0e-7), DoubleNear(0.2527040437104302, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.21968212418878233 + -7.651154333889246e-20i, -0.005552220895845642 + 0.0005585482195636187i, 0.0 + 0.0i, 0.0 + 0.0i, -0.028045753292531166 + -0.04760862004991827i, 0.00485403618682337 + -0.005905373720894076i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0055522208958456425 + -0.0005585482195636182i, 0.23503103655193944 + 9.57384445515535e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.022321790904407633 + 0.03884671593497582i, 0.029680417307696945 + -0.029440658635406534i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.028045753292531166 + 0.04760862004991827i, -0.02232179090440763 + -0.03884671593497582i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2686665949453412 + 3.0720406782271607e-20i, 0.007698467981932775 + -0.02066436520629219i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00485403618682337 + 0.0059053737208940756i, 0.02968041730769694 + 0.029440658635406534i, 0.0 + 0.0i, 0.0 + 0.0i, 0.007698467981932775 + 0.02066436520629219i, 0.27662024431393684 + -5.6898365008953795e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.21968212418878233, 1.0e-7), DoubleNear(0.23503103655193944, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2686665949453412, 1.0e-7), DoubleNear(0.27662024431393684, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.15398382948982678 + 1.099164539440387e-19i, 0.0006767445728803304 + -0.006339671987114962i, 0.0 + 0.0i, 0.0 + 0.0i, -0.007906685474879492 + 0.012686463232457337i, 0.00048756554070982855 + 0.0003812821628878418i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0006767445728803302 + 0.006339671987114962i, 0.16133148404852113 + 1.1348222672953382e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0005570638315670509 + -0.00026977051689155i, -0.008283969205035708 + 0.013291823871379695i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007906685474879492 + -0.012686463232457337i, -0.000557063831567051 + 0.00026977051689155i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3343648896442967 + -1.5570759050065956e-19i, 0.0014695025132068036 + -0.013766144999613606i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0004875655407098286 + -0.0003812821628878419i, -0.008283969205035708 + -0.013291823871379695i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0014695025132068031 + 0.013766144999613608i, 0.35031979681735514 + -2.3433618678875716e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.15398382948982678, 1.0e-7), DoubleNear(0.16133148404852113, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3343648896442967, 1.0e-7), DoubleNear(0.35031979681735514, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.08594655012693023 + 3.931224760218535e-21i, 0.00014098475239464076 + -0.0033721112119642106i, 0.015379414477024737 + -0.009864080097550978i, 0.0003582746408799536 + -0.0007677385336424809i, 0.010668178135641845 + -0.025053993490673297i, -0.0002601163212332442 + -9.144328603417047e-05i, 0.0009152489835318022 + 0.027667123371738198i, 0.0014153682311882647 + -0.0009476522952368669i }, { 0.00014098475239464093 + 0.0033721112119642098i, 0.09002066727727964 + 4.721312681709647e-20i, 0.0009246016760614563 + 0.0006158139309344308i, 0.016576746679102687 + -0.010482270254636019i, 0.0007901909458583841 + 0.000508436283307806i, 0.011506667490637086 + -0.026451574834008937i, -0.00018864520554184283 + 0.000525085063137723i, 0.0008388371754119912 + 0.0290250670102781i }, { 0.015379414477024737 + 0.009864080097550977i, 0.0009246016760614564 + -0.0006158139309344307i, 0.16089751521462506 + -6.964748927747114e-20i, 0.0011618314489678636 + -0.006627592612312348i, 0.014620147563348188 + -0.007861869811046317i, -0.0002737544017698246 + 0.00033816974917822107i, 0.029627436260472262 + 0.023321944430190394i, 0.0012757731128708867 + -0.0007950139986218528i }, { 0.0003582746408799536 + 0.0007677385336424811i, 0.016576746679102687 + 0.010482270254636019i, 0.0011618314489678632 + 0.00662759261231235i, 0.1689265698781664 + 3.080704225042535e-20i, -8.355864651934822e-05 + 0.0008251028118211143i, 0.015465961203232886 + -0.007849460944368612i, -0.0010021966654652696 + 0.002055022847496498i, 0.030857887525600713 + 0.02482243470756787i }, { 0.010668178135641844 + 0.025053993490673297i, 0.0007901909458583841 + -0.0005084362833078061i, 0.014620147563348188 + 0.007861869811046321i, -8.355864651934825e-05 + -0.0008251028118211143i, 0.13239885533733742 + -1.8159223684535155e-20i, 0.0007283999099868882 + -0.005905988271098441i, -0.0011601836126176627 + -0.003061799820290173i, 6.890562347406353e-05 + -0.0009827193302465688i }, { -0.000260116321233244 + 9.14432860341705e-05i, 0.011506667490637085 + 0.026451574834008937i, -0.00027375440176982446 + -0.0003381697491782211i, 0.015465961203232886 + 0.007849460944368614i, 0.0007283999099868882 + 0.00590598827109844i, 0.1383492428832338 + 3.6067085106920136e-20i, 0.0016965790847022735 + -0.00028292097755179926i, -0.0007616141623811785 + -0.003061281047753252i }, { 0.0009152489835318025 + -0.027667123371738198i, -0.00018864520554184272 + -0.000525085063137723i, 0.029627436260472262 + -0.023321944430190394i, -0.0010021966654652696 + -0.0020550228474964984i, -0.0011601836126176627 + 0.003061799820290173i, 0.0016965790847022735 + 0.0002829209775517993i, 0.10910579845523082 + 3.808435164516692e-20i, 0.00011503097473774084 + -0.0042001248913535695i }, { 0.0014153682311882645 + 0.000947652295236867i, 0.0008388371754119915 + -0.0290250670102781i, 0.0012757731128708867 + 0.0007950139986218528i, 0.030857887525600713 + -0.02482243470756787i, 6.890562347406352e-05 + 0.0009827193302465688i, -0.0007616141623811785 + 0.0030612810477532518i, 0.00011503097473774062 + 0.0042001248913535695i, 0.11435480082719642 + -2.4038646123783877e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.08594655012693023, 1.0e-7), DoubleNear(0.09002066727727964, 1.0e-7), DoubleNear(0.16089751521462506, 1.0e-7), DoubleNear(0.1689265698781664, 1.0e-7), DoubleNear(0.13239885533733742, 1.0e-7), DoubleNear(0.1383492428832338, 1.0e-7), DoubleNear(0.10910579845523082, 1.0e-7), DoubleNear(0.11435480082719642, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.09840760191763964 + 7.219102535477624e-20i, -0.002533539631078624 + 0.00019515084485148817i, 0.005240914553946544 + -0.005444719230271075i, 0.00032398283775830327 + -0.0006545480856187832i, -0.012569161320169456 + -0.021511931329940857i, 0.0020796378687651974 + -0.0026873997389480417i, -0.0023916222135793425 + 0.000192120449608559i, -5.8247875837712786e-05 + -0.0006103875523770508i }, { -0.002533539631078624 + -0.00019515084485148817i, 0.10485249637414942 + 3.407689176814079e-21i, 0.0009156250068058915 + 0.0002490142553472531i, 0.00780480100444175 + -0.006443092834904001i, -0.01013732535119917 + 0.017233715620451576i, 0.01343621748420172 + -0.01256531077232796i, 0.00013170509046955776 + 0.0022453427871166774i, 0.00021859737318381868 + -0.0023715193897404694i }, { 0.005240914553946544 + 0.005444719230271075i, 0.0009156250068058916 + -0.00024901425534725304i, 0.12127452227114269 + -1.487025686936687e-19i, -0.003018681264767018 + 0.00036339737471213047i, -4.204260986649104e-06 + -0.0017527015217312072i, 0.0007368434295397822 + -0.0003155210326581711i, -0.015476591972361708 + -0.02609668871997741i, 0.0027743983180581726 + -0.0032179739819460347i }, { 0.0003239828377583032 + 0.0006545480856187834i, 0.007804801004441749 + 0.006443092834904i, -0.0030186812647670187 + -0.00036339737471213004i, 0.13017854017779004 + 9.23307553747394e-20i, -0.001825431188337692 + 0.0004370061895809975i, 0.0010327461737086301 + -0.000630291309220327i, -0.012184465553208462 + 0.021613000314524247i, 0.016244199823495224 + -0.016875347863078576i }, { -0.012569161320169456 + 0.021511931329940857i, -0.01013732535119917 + -0.017233715620451576i, -4.204260986648833e-06 + 0.0017527015217312075i, -0.001825431188337692 + -0.00043700618958099753i, 0.11993780354662799 + -8.641902427909285e-20i, 0.0034029242934601528 + -0.00947325032791414i, 0.00897831631046053 + -0.007481160687570074i, 0.00010319742659571384 + -0.0010959097782702663i }, { 0.0020796378687651974 + 0.0026873997389480412i, 0.01343621748420172 + 0.01256531077232796i, 0.000736843429539782 + 0.0003155210326581711i, 0.0010327461737086306 + 0.000630291309220327i, 0.0034029242934601528 + 0.00947325032791414i, 0.12351741378636402 + 7.987252274720252e-20i, 0.0017055557539578385 + 8.387869803537847e-05i, 0.008010331512279758 + -0.007100458467485271i }, { -0.0023916222135793425 + -0.00019212044960855904i, 0.0001317050904695576 + -0.0022453427871166774i, -0.015476591972361708 + 0.02609668871997741i, -0.012184465553208462 + -0.021613000314524247i, 0.00897831631046053 + 0.0074811606875700735i, 0.0017055557539578385 + -8.387869803537837e-05i, 0.1487287913987132 + 1.1713943106136445e-19i, 0.004295543688472623 + -0.01119111487837805i }, { -5.8247875837712915e-05 + 0.0006103875523770508i, 0.00021859737318381903 + 0.0023715193897404694i, 0.0027743983180581726 + 0.0032179739819460347i, 0.016244199823495224 + 0.016875347863078576i, 0.00010319742659571388 + 0.0010959097782702663i, 0.008010331512279758 + 0.00710045846748527i, 0.004295543688472622 + 0.01119111487837805i, 0.15310283052757276 + -8.556235924809792e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.09840760191763964, 1.0e-7), DoubleNear(0.10485249637414942, 1.0e-7), DoubleNear(0.12127452227114269, 1.0e-7), DoubleNear(0.13017854017779004, 1.0e-7), DoubleNear(0.11993780354662799, 1.0e-7), DoubleNear(0.12351741378636402, 1.0e-7), DoubleNear(0.1487287913987132, 1.0e-7), DoubleNear(0.15310283052757276, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.06884764998362328 + 2.130523198566339e-20i, 0.0002741302974042623 + -0.0029255268475418834i, 0.004483541238284672 + -0.004075727879053118i, 0.00013469647899218133 + -0.0005519461701878428i, -0.0035351550608180276 + 0.005672239630954453i, 0.00022695322529633018 + 0.00017280362917918758i, 0.000105573562835792 + 0.000578669719975124i, 3.855756880504815e-05 + 3.9438470358451214e-05i }, { 0.0002741302974042624 + 0.0029255268475418834i, 0.07200852982498666 + 3.511521883305076e-20i, 0.0008264984334209011 + 0.00010496624597055123i, 0.004986753468160566 + -0.004270489125335574i, -0.0002551050390015984 + -0.0001276333804531471i, -0.0036974583546921314 + 0.005932659092027289i, -5.1086621268981144e-05 + 6.270403150057883e-05i, 9.578091484367852e-05 + 0.00063012901538132i }, { 0.004483541238284672 + 0.004075727879053118i, 0.0008264984334209012 + -0.00010496624597055122i, 0.08513617950620353 + 8.861122195837532e-20i, 0.0004026142754760679 + -0.003414145139573078i, -0.0005660108763150057 + 0.00016011280360749057i, -3.3790643833344806e-05 + 7.348354120776936e-05i, -0.004371530414061464 + 0.007014223601502885i, 0.0002606123154134984 + 0.00020847853370865413i }, { 0.00013469647899218135 + 0.0005519461701878428i, 0.004986753468160566 + 0.004270489125335574i, 0.00040261427547606777 + 0.003414145139573078i, 0.08932295422353446 + 7.836700789648307e-20i, -5.239022509750969e-05 + -1.724364725348799e-05i, -0.0006078956134343504 + 0.0001915710908279191i, -0.00030195879256545257 + -0.00014213713643840286i, -0.004586510850343575 + 0.007359164779352407i }, { -0.003535155060818027 + -0.005672239630954453i, -0.00025510503900159855 + 0.00012763338045314706i, -0.0005660108763150056 + -0.00016011280360749054i, -5.23902250975097e-05 + 1.724364725348796e-05i, 0.14949775548064437 + -3.5533230909980005e-20i, 0.0005952543649772666 + -0.006352572635520767i, 0.009735689626122403 + -0.008850152038788032i, 0.0002924837853618358 + -0.001198511693701207i }, { 0.00022695322529633026 + -0.0001728036291791877i, -0.003697458354692132 + -0.005932659092027288i, -3.3790643833344806e-05 + -7.348354120776938e-05i, -0.0006078956134343503 + -0.00019157109082791905i, 0.0005952543649772666 + 0.006352572635520767i, 0.15636138033552677 + 4.816499309096584e-20i, 0.0017946823273428288 + 0.00022792670741208034i, 0.010828379048560943 + -0.009273062177053697i }, { 0.00010557356283579189 + -0.000578669719975124i, -5.108662126898106e-05 + -6.27040315005788e-05i, -0.004371530414061464 + -0.007014223601502884i, -0.00030195879256545246 + 0.00014213713643840292i, 0.009735689626122403 + 0.008850152038788032i, 0.0017946823273428288 + -0.00022792670741208018i, 0.18486713416365236 + -1.2017435959067957e-19i, 0.0008742481482295369 + -0.00741357236409284i }, { 3.855756880504813e-05 + -3.9438470358451173e-05i, 9.578091484367844e-05 + -0.00063012901538132i, 0.00026061231541349834 + -0.0002084785337086542i, -0.004586510850343576 + -0.007359164779352407i, 0.00029248378536183574 + 0.001198511693701207i, 0.010828379048560943 + 0.009273062177053697i, 0.0008742481482295361 + 0.00741357236409284i, 0.19395841648182832 + -7.159861176984158e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.06884764998362328, 1.0e-7), DoubleNear(0.07200852982498666, 1.0e-7), DoubleNear(0.08513617950620353, 1.0e-7), DoubleNear(0.08932295422353446, 1.0e-7), DoubleNear(0.14949775548064437, 1.0e-7), DoubleNear(0.15636138033552677, 1.0e-7), DoubleNear(0.18486713416365236, 1.0e-7), DoubleNear(0.19395841648182832, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.11082466427663742 + -2.1779023992294043e-19i, -0.0026766607588227984 + 0.00025664587988773457i, 0.017947265504793725 + -0.0013636656255067107i, 1.6219731400406062e-05 + 0.0004239754093417596i, -0.014192605285841908 + -0.02380920081775829i, 0.0025913414614901755 + -0.003075493564018663i, -0.0025928226531401703 + -0.004027845589163905i, 0.0004989227761771121 + -0.0006268437143417859i }, { -0.002676660758822799 + -0.0002566458798877342i, 0.11904558587341614 + 1.2665965171262638e-19i, -0.0006923584633034964 + 0.0004731473279797029i, 0.019543719568435987 + -0.00046405418784366357i, -0.011271302944435856 + 0.019745664227085614i, 0.014904994019561297 + -0.015327225915296325i, -0.0017090062944576613 + 0.0031248967247298615i, 0.002037076588606406 + -0.00266387272801501i }, { 0.017947265504793725 + 0.0013636656255067107i, -0.0006923584633034964 + -0.0004731473279797029i, 0.1088574599121449 + 1.4127869658404797e-19i, -0.0028755601370228433 + 0.0003019023396758841i, -0.00215138681862345 + -0.0036381880653733375i, 0.0003639933581418006 + -0.000433449316283672i, -0.013853148006689256 + -0.02379941923215998i, 0.0022626947253331945 + -0.0028298801568754136i }, { 1.6219731400406197e-05 + -0.00042397540934175954i, 0.019543719568435987 + 0.00046405418784366357i, -0.0028755601370228433 + -0.00030190233967588404i, 0.1159854506785233 + -3.0921207161072895e-20i, -0.002029018806165848 + 0.003353958470640103i, 0.0027826374795855147 + -0.0024086195851850904i, -0.011050487959971773 + 0.019101051707890213i, 0.014775423288135647 + -0.01411343272011021i }, { -0.014192605285841908 + 0.02380920081775829i, -0.011271302944435856 + -0.01974566422708561i, -0.0021513868186234506 + 0.003638188065373338i, -0.0020290188061658477 + -0.003353958470640103i, 0.13601940106491786 + 1.5207397540568782e-19i, 0.003979476960185303 + -0.010256349704164294i, 0.022348348891320383 + -0.00036838343497619126i, 0.0009994370602372364 + -0.001310432693997783i }, { 0.0025913414614901755 + 0.003075493564018663i, 0.014904994019561295 + 0.015327225915296326i, 0.0003639933581418006 + 0.0004334493162836719i, 0.0027826374795855142 + 0.0024086195851850904i, 0.003979476960185303 + 0.010256349704164294i, 0.13990165128202986 + -4.8639482645104526e-20i, 0.0004803527436966108 + 0.002090311802824601i, 0.02282083544780181 + -0.0011650859385974035i }, { -0.0025928226531401703 + 0.004027845589163905i, -0.0017090062944576617 + -0.0031248967247298615i, -0.013853148006689256 + 0.02379941923215998i, -0.011050487959971773 + -0.019101051707890213i, 0.022348348891320383 + 0.00036838343497619126i, 0.0004803527436966108 + -0.0020903118028246016i, 0.1326471938804233 + -1.213535686234162e-19i, 0.0037189910217474724 + -0.010408015502127894i }, { 0.0004989227761771123 + 0.0006268437143417859i, 0.002037076588606406 + 0.00266387272801501i, 0.0022626947253331945 + 0.002829880156875413i, 0.014775423288135647 + 0.01411343272011021i, 0.0009994370602372364 + 0.001310432693997783i, 0.022820835447801807 + 0.0011650859385974035i, 0.0037189910217474724 + 0.010408015502127894i, 0.13671859303190692 + 4.2949646144209147e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.11082466427663742, 1.0e-7), DoubleNear(0.11904558587341614, 1.0e-7), DoubleNear(0.1088574599121449, 1.0e-7), DoubleNear(0.1159854506785233, 1.0e-7), DoubleNear(0.13601940106491786, 1.0e-7), DoubleNear(0.13990165128202986, 1.0e-7), DoubleNear(0.1326471938804233, 1.0e-7), DoubleNear(0.13671859303190692, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.07783371385825297 + 1.089521765102989e-19i, 0.00041079789901545764 + -0.0031530597466423805i, 0.01270582428753109 + -0.000546141592569967i, 0.0003202521397025758 + -0.0002795135566496665i, -0.003996567021731547 + 0.0064125859993212336i, 0.00023868172967273508 + 0.00019574668484281533i, -0.0006074167100313468 + 0.0010748540480347108i, 6.584493459366349e-06 + 4.073734751648568e-05i }, { 0.00041079789901545753 + 0.0031530597466423805i, 0.08165002927355842 + 1.4374201690128465e-19i, -6.684864994976834e-05 + 0.0008082979195723001i, 0.013358192947857613 + -0.0005136928297666682i, -0.0002808686241280537 + -0.00012805681819776354i, -0.004192525297101934 + 0.0067270056715695555i, -6.31617658826648e-05 + -4.701162702453131e-05i, -0.0006435876109991076 + 0.001126935418450525i }, { 0.01270582428753109 + 0.000546141592569967i, -6.684864994976832e-05 + -0.0008082979195723001i, 0.07615011563157383 + 9.642774337398298e-22i, 0.0002659466738648726 + -0.003186612240472581i, -0.0006974080455736596 + 0.0010187680315808098i, 7.002678867530883e-05 + 3.5996536121324905e-05i, -0.003910118453147946 + 0.006273877233136104i, 0.0002488838110370935 + 0.00018553547804502643i }, { 0.0003202521397025758 + 0.0002795135566496665i, 0.013358192947857613 + 0.0005136928297666682i, 0.0002659466738648726 + 0.003186612240472581i, 0.07968145477496269 + -3.025979017175082e-20i, -3.9472790232797714e-05 + 1.2032699947763753e-05i, -0.0007282321508732433 + 0.0010741817280257233i, -0.0002761952074389973 + -0.00014171369869378644i, -0.0040914439079337735 + 0.006564818199810141i }, { -0.003996567021731547 + -0.006412585999321232i, -0.00028086862412805364 + 0.00012805681819776354i, -0.0006974080455736596 + -0.00101876803158081i, -3.9472790232797714e-05 + -1.2032699947763692e-05i, 0.16901035148330232 + -1.746684410275515e-19i, 0.0008920183023470468 + -0.006846644077634178i, 0.02758979010858302 + -0.001185907467912935i, 0.0006954046519350666 + -0.0006069437280063568i }, { 0.00023868172967273513 + -0.00019574668484281538i, -0.004192525297101934 + -0.006727005671569555i, 7.002678867530885e-05 + -3.599653612132493e-05i, -0.0007282321508732433 + -0.0010741817280257233i, 0.0008920183023470463 + 0.006846644077634178i, 0.17729720788188758 + -6.572184783376279e-20i, -0.00014515706965711735 + 0.001755161211232004i, 0.029006362068380184 + -0.001115447296674399i }, { -0.0006074167100313467 + -0.0010748540480347108i, -6.316176588266482e-05 + 4.701162702453127e-05i, -0.003910118453147946 + -0.006273877233136104i, -0.00027619520743899737 + 0.00014171369869378647i, 0.02758979010858302 + 0.001185907467912935i, -0.00014515706965711724 + -0.0017551612112320044i, 0.16535453816099438 + 1.896085052689195e-20i, 0.0005774842108597564 + -0.006919500921979428i }, { 6.584493459366379e-06 + -4.073734751648572e-05i, -0.0006435876109991074 + -0.001126935418450525i, 0.0002488838110370935 + -0.00018553547804502654i, -0.0040914439079337735 + -0.006564818199810141i, 0.0006954046519350669 + 0.0006069437280063568i, 0.029006362068380184 + 0.001115447296674399i, 0.0005774842108597564 + 0.006919500921979429i, 0.17302258893546751 + 4.2288229154887074e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.07783371385825297, 1.0e-7), DoubleNear(0.08165002927355842, 1.0e-7), DoubleNear(0.07615011563157383, 1.0e-7), DoubleNear(0.07968145477496269, 1.0e-7), DoubleNear(0.16901035148330232, 1.0e-7), DoubleNear(0.17729720788188758, 1.0e-7), DoubleNear(0.16535453816099438, 1.0e-7), DoubleNear(0.17302258893546751, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.0692691378673562 + 3.6205201177998845e-20i, -0.0017507002726077359 + 0.0001761188069779884i, -0.00884325549285362 + -0.01501172695816806i, 0.0015305519421746979 + -0.0018620547663648365i, -0.0035567974120908215 + 0.005706965293756971i, 7.538396522208584e-05 + -0.00015328044984123696i, 0.0016908695070717368 + 4.22340959387561e-05i, 7.482147027217109e-05 + 0.00022171141234455336i }, { -0.001750700272607736 + -0.00017611880697798838i, 0.07410888498161772 + 3.6583700054381296e-20i, -0.007038402497760736 + 0.01224896441497204i, 0.009358690089325472 + -0.009283090508398685i, 0.00010440421724040641 + -0.00013519392715116523i, -0.0038053063518749797 + 0.0061057037458587i, -0.0006477667312294668 + -0.0012088356559384725i, 0.00028427249517194914 + 0.0012477099396961755i }, { -0.00884325549285362 + 0.01501172695816806i, -0.007038402497760736 + -0.01224896441497204i, 0.08471469162247058 + 7.371125276603987e-20i, 0.0024274448454880662 + -0.00651579079409295i, -0.0007827112934768028 + -0.0014993953580922721i, 0.0013705755479705391 + 4.907187036543276e-05i, -0.004349888062788671 + 0.006979497938700367i, 0.0004121815754877427 + 0.0005345626127290788i }, { 0.0015305519421746983 + 0.0018620547663648363i, 0.00935869008932547 + 0.009283090508398685i, 0.0024274448454880662 + 0.00651579079409295i, 0.08722259906690341 + 7.689852667515253e-20i, -0.00023200151768151004 + 3.048767900286944e-05i, -0.0012453632699413486 + 0.00029438286466591487i, -0.0006614680488074573 + -0.00013457658974038472i, -0.004478662853160727 + 0.007186120125520995i }, { -0.0035567974120908215 + -0.00570696529375697i, 0.00010440421724040643 + 0.00013519392715116517i, -0.0007827112934768027 + 0.0014993953580922721i, -0.00023200151768150998 + -3.0487679002869557e-05i, 0.15041298632142613 + -1.127167445168913e-19i, -0.003801520623237906 + 0.00038242941258563026i, -0.019202497799677545 + -0.032596893091750206i, 0.003323484244648672 + -0.00404331895452924i }, { 7.538396522208593e-05 + 0.00015328044984123696i, -0.0038053063518749797 + -0.0061057037458587i, 0.001370575547970539 + -4.907187036543281e-05i, -0.0012453632699413486 + -0.00029438286466591487i, -0.0038015206232379062 + -0.0003824294125856298i, 0.16092215157032172 + 5.915474449717219e-20i, -0.015283388406646895 + 0.026597751520003782i, 0.02032172721837147 + -0.02015756812700785i }, { 0.0016908695070717368 + -4.2234095938756304e-05i, -0.0006477667312294668 + 0.0012088356559384727i, -0.004349888062788671 + -0.006979497938700366i, -0.0006614680488074574 + 0.00013457658974038483i, -0.019202497799677545 + 0.032596893091750206i, -0.015283388406646893 + -0.026597751520003782i, 0.1839519033228706 + -4.299084598376826e-20i, 0.005271023136444709 + -0.014148574412199237i }, { 7.48214702721712e-05 + -0.00022171141234455323i, 0.00028427249517194893 + -0.0012477099396961757i, 0.0004121815754877427 + -0.0005345626127290789i, -0.004478662853160728 + -0.0071861201255209945i, 0.003323484244648672 + 0.004043318954529239i, 0.02032172721837147 + 0.02015756812700785i, 0.005271023136444709 + 0.014148574412199237i, 0.1893976452470334 + -8.258836317604791e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.0692691378673562, 1.0e-7), DoubleNear(0.07410888498161772, 1.0e-7), DoubleNear(0.08471469162247058, 1.0e-7), DoubleNear(0.08722259906690341, 1.0e-7), DoubleNear(0.15041298632142613, 1.0e-7), DoubleNear(0.16092215157032172, 1.0e-7), DoubleNear(0.1839519033228706, 1.0e-7), DoubleNear(0.1893976452470334, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.17838707388099723 + -3.930975703553823e-20i, 0.013114186576813746 + 0.0722417605923107i, 0.0 + 0.0i, 0.0 + 0.0i, 0.011993638928507976 + -0.010570052598414384i, 0.005162291234848668 + 0.004080026284231134i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013114186576813746 + -0.0722417605923107i, 0.26832824174378384 + 1.0836197003523824e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0033988583221218546 + -0.005634148327791461i, 0.018040724452620605 + -0.01589937862181604i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.011993638928507976 + 0.010570052598414382i, -0.0033988583221218538 + 0.005634148327791461i, 0.0 + 0.0i, 0.0 + 0.0i, 0.22094347880332926 + 8.742728927524435e-20i, 0.016242735198908436 + 0.08947591074222266i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.005162291234848668 + -0.004080026284231134i, 0.01804072445262061 + 0.015899378621816035i, 0.0 + 0.0i, 0.0 + 0.0i, 0.016242735198908436 + -0.08947591074222266i, 0.3323412055718894 + -1.1222203078090712e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.17838707388099723, 1.0e-7), DoubleNear(0.26832824174378384, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22094347880332926, 1.0e-7), DoubleNear(0.3323412055718894, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.20197792036905296 + -9.516212811627818e-20i, 0.01484847570224511 + 0.08179539162107562i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03300873113641455 + -0.0013422255356909294i, 0.002970211815630518 + 0.013268935941449646i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.014848475702245106 + -0.08179539162107562i, 0.3038133821279484 + 1.0746603266654742e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0018830844391822007 + -0.013466284277517506i, 0.04965143827593735 + -0.002018963651233039i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03300873113641455 + 0.0013422255356909298i, 0.0018830844391822007 + 0.013466284277517506i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19735263231527359 + 1.4327966035598433e-19i, 0.014508446073477075 + 0.07992227971345775i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002970211815630517 + -0.013268935941449646i, 0.04965143827593735 + 0.002018963651233039i, 0.0 + 0.0i, 0.0 + 0.0i, 0.014508446073477075 + -0.07992227971345775i, 0.2968560651877249 + -1.1132609341221628e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.20197792036905296, 1.0e-7), DoubleNear(0.3038133821279484, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19735263231527359, 1.0e-7), DoubleNear(0.2968560651877249, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.1815808577914295 + 4.306798999935448e-20i, 0.013348978690256759 + 0.07353515348015491i, 0.0 + 0.0i, 0.0 + 0.0i, 0.000652771284629329 + -0.030768131041339464i, 0.012508218630619036 + -0.0019975755892939315i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013348978690256759 + -0.07353515348015491i, 0.2731323029492923 + -2.3841088786693475e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.012412241223373416 + -0.002526283705187867i, 0.0009818927305364489 + -0.046281147643985346i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.000652771284629329 + 0.030768131041339464i, -0.012412241223373416 + 0.002526283705187867i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21774969489289706 + 5.049542240351643e-21i, 0.016007943085465423 + 0.08818251785437846i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.012508218630619034 + 0.001997575589293931i, 0.0009818927305364474 + 0.046281147643985346i, 0.0 + 0.0i, 0.0 + 0.0i, 0.016007943085465423 + -0.08818251785437846i, 0.327537144366381 + 1.99810280410246e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1815808577914295, 1.0e-7), DoubleNear(0.2731323029492923, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21774969489289706, 1.0e-7), DoubleNear(0.327537144366381, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.1259150384251002 + 2.441306482031883e-19i, 0.009256686994232596 + 0.050992058241539906i, 0.0 + 0.0i, 0.0 + 0.0i, -0.006465423081651616 + 0.010373923746967358i, -0.004676455878628466 + -0.0018556724298428552i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.009256686994232596 + -0.050992058241539906i, 0.1894002751132477 + -2.0731967529615773e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0037258403127564646 + 0.0033809575145920473i, -0.009725231598263584 + 0.015604363356869676i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006465423081651616 + -0.010373923746967356i, 0.0037258403127564638 + -0.003380957514592048i, 0.0 + 0.0i, 0.0 + 0.0i, 0.27341551425922633 + -1.9601311596348218e-19i, 0.020100234781489586 + 0.11072561309299346i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0046764558786284655 + 0.001855672429842855i, -0.009725231598263585 + -0.015604363356869676i, 0.0 + 0.0i, 0.0 + 0.0i, 0.020100234781489583 + -0.11072561309299346i, 0.41126917220242554 + 1.6871906783946897e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1259150384251002, 1.0e-7), DoubleNear(0.1894002751132477, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27341551425922633, 1.0e-7), DoubleNear(0.41126917220242554, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.07026908618034619 + -1.9964305920594586e-20i, 0.00516585583642689 + 0.028457008629826395i, 0.012761071496145773 + -0.008124919331247777i, 0.00422849892242505 + 0.0045705697512494065i, 0.008855093359631586 + -0.020567747065415698i, 0.008980345778668703 + 0.0020740194565627805i, 0.0007004601953069527 + 0.022638923718135633i, -0.009116634441277718 + 0.0019479749272837286i }, { 0.005165855836426889 + -0.028457008629826395i, 0.10569813122386369 + 7.110865749790959e-20i, -0.0023522298757994407 + -0.0057651821826705885i, 0.01919508965998165 + -0.01222143102093922i, -0.007678375361789929 + -0.005098109337206402i, 0.013319752266647344 + -0.03093782125926653i, 0.009219623581589696 + 0.0013806414693946756i, 0.0010536259636368408 + 0.03405326666388066i }, { 0.012761071496145773 + 0.008124919331247775i, -0.00235222987579944 + 0.0057651821826705885i, 0.13170883418870677 + -7.51978221956836e-20i, 0.00968261986581822 + 0.053338382991249225i, 0.012014302441879586 + -0.006274014393966102i, 0.0034240353649287285 + 0.004404219141269768i, 0.024153637776782966 + 0.01922552152972477i, -0.006010133963038185 + 0.011194916484886866i }, { 0.00422849892242505 + -0.0045705697512494065i, 0.01919508965998165 + 0.012221431020939219i, 0.009682619865818217 + -0.053338382991249225i, 0.19811525090408466 + 3.635737516863781e-20i, -0.0016575642817359482 + -0.0053266917572281965i, 0.01807180632470149 + -0.009437316361448827i, 0.00956145980097213 + -0.008368174940311104i, 0.03633168600929001 + 0.028918857608033494i }, { 0.008855093359631586 + 0.020567747065415698i, -0.007678375361789929 + 0.005098109337206402i, 0.012014302441879586 + 0.006274014393966104i, -0.0016575642817359484 + 0.0053266917572281965i, 0.10811798770065106 + -1.9345451114943645e-20i, 0.007948330740386858 + 0.04378475196248431i, -0.0007674325676377963 + -0.002445133267166607i, 0.0009337923124236182 + -0.0004905434670182721i }, { 0.008980345778668703 + -0.0020740194565627805i, 0.013319752266647344 + 0.03093782125926653i, 0.003424035364928729 + -0.004404219141269768i, 0.01807180632470149 + 0.00943731636144883i, 0.007948330740386858 + -0.04378475196248431i, 0.16263011051992016 + 3.7253312537328644e-20i, -0.001046628446322414 + 0.00013103385487912825i, -0.0011543652073610449 + -0.003677947600876818i }, { 0.0007004601953069528 + -0.022638923718135633i, 0.009219623581589696 + -0.0013806414693946756i, 0.024153637776782966 + -0.01922552152972477i, 0.00956145980097213 + 0.008368174940311106i, -0.0007674325676377965 + 0.002445133267166607i, -0.0010466284463224139 + -0.0001310338548791283i, 0.08923464461462251 + 1.6262511147092798e-19i, 0.006560115333090219 + 0.03613752775097344i }, { -0.009116634441277718 + -0.0019479749272837286i, 0.0010536259636368412 + -0.03405326666388066i, -0.006010133963038185 + -0.011194916484886866i, 0.03633168600929001 + -0.028918857608033494i, 0.0009337923124236179 + 0.0004905434670182721i, -0.0011543652073610449 + 0.003677947600876817i, 0.006560115333090219 + -0.03613752775097344i, 0.13422595466780474 + -1.4857940594954493e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.07026908618034619, 1.0e-7), DoubleNear(0.10569813122386369, 1.0e-7), DoubleNear(0.13170883418870677, 1.0e-7), DoubleNear(0.19811525090408466, 1.0e-7), DoubleNear(0.10811798770065106, 1.0e-7), DoubleNear(0.16263011051992016, 1.0e-7), DoubleNear(0.08923464461462251, 1.0e-7), DoubleNear(0.13422595466780474, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.08116796738953067 + 5.8535815709517605e-21i, 0.005967090805677654 + 0.032870749770976496i, 0.005209552804093715 + -0.0047471665621937695i, 0.002305451335598611 + 0.001760733172113416i, 0.0003462420171913555 + -0.01360808392265661i, 0.005536346338264686 + -0.0008601846269651014i, -0.000867755210511915 + -0.0008703005832825113i, 0.0002886540012508902 + -0.0004153969611444045i }, { 0.005967090805677654 + -0.032870749770976496i, 0.12209213090225837 + 6.974513296063856e-20i, -0.001539487233286757 + -0.002458712309877078i, 0.007836162754294579 + -0.007140645502981308i, -0.005485438138299379 + -0.0011406212344922033i, 0.0005208141468409089 + -0.020469158179612208i, -0.0004162406417632753 + 0.0002874360727373159i, -0.0013052696298836086 + -0.0013090983568493993i }, { 0.005209552804093715 + 0.0047471665621937695i, -0.0015394872332867569 + 0.002458712309877078i, 0.1004128904018988 + 3.7214408428402705e-20i, 0.007381887884579105 + 0.04066440370917841i, 0.0004107282104662632 + -0.0009516018442266641i, 0.0004155668759032005 + 9.637606886501474e-05i, 0.0003065292674379735 + -0.01716004711868285i, 0.00697187229235435 + -0.0011373909623288302i }, { 0.0023054513355986106 + -0.001760733172113416i, 0.007836162754294579 + 0.007140645502981307i, 0.007381887884579105 + -0.04066440370917841i, 0.15104017204703393 + -9.358622174733203e-20i, -0.0003551772269535387 + -0.00023629073712571664i, 0.0006178137022557178 + -0.00143139098672487i, -0.006926803085074038 + -0.0013856624706956636i, 0.00046107858369554 + -0.025811989464373138i }, { 0.0003462420171913555 + 0.01360808392265661i, -0.005485438138299379 + 0.0011406212344922035i, 0.00041072821046626325 + 0.0009516018442266643i, -0.0003551772269535387 + 0.00023629073712571678i, 0.09721910649146656 + -4.516333860648999e-20i, 0.0071470957711360925 + 0.03937101082133421i, 0.006784086124414261 + -0.005822886036220614i, 0.0028568398992500567 + 0.0023192931121177184i }, { 0.005536346338264686 + 0.0008601846269651015i, 0.0005208141468409076 + 0.020469158179612208i, 0.00041556687590320036 + -9.63760688650148e-05i, 0.0006178137022557182 + 0.00143139098672487i, 0.0071470957711360925 + -0.03937101082133421i, 0.14623611084152546 + 3.861683707459968e-20i, -0.0018593710888350976 + -0.003175436017914383i, 0.010204561698326028 + -0.008758733118834731i }, { -0.0008677552105119148 + 0.0008703005832825111i, -0.00041624064176327524 + -0.0002874360727373158i, 0.0003065292674379735 + 0.01716004711868285i, -0.006926803085074038 + 0.0013856624706956636i, 0.006784086124414261 + 0.0058228860362206135i, -0.0018593710888350971 + 0.003175436017914383i, 0.12053058840143047 + 5.021288084684165e-20i, 0.008860847314329331 + 0.04881150703304426i }, { 0.0002886540012508902 + 0.00041539696114440447i, -0.0013052696298836083 + 0.001309098356849399i, 0.0069718722923543495 + 0.0011373909623288297i, 0.0004610785836955398 + 0.025811989464373138i, 0.0028568398992500567 + -0.002319293112117719i, 0.010204561698326028 + 0.00875873311883473i, 0.008860847314329331 + -0.04881150703304426i, 0.18130103352485546 + -1.8635809033575088e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.08116796738953067, 1.0e-7), DoubleNear(0.12209213090225837, 1.0e-7), DoubleNear(0.1004128904018988, 1.0e-7), DoubleNear(0.15104017204703393, 1.0e-7), DoubleNear(0.09721910649146656, 1.0e-7), DoubleNear(0.14623611084152546, 1.0e-7), DoubleNear(0.12053058840143047, 1.0e-7), DoubleNear(0.18130103352485546, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.056248176131975094 + -1.5219474486697317e-20i, 0.004135103852268421 + 0.02277893339172672i, 0.0037817780192082287 + -0.0033328994491858607i, 0.0016277494792925735 + 0.0012864947670570412i, -0.0028882035125677467 + 0.004634190620893935i, -0.0020890444638268784 + -0.0008289572951934558i, 8.040699485720678e-05 + 0.00048271026707400377i, -0.00018957296894354545 + 6.804918715955628e-05i }, { 0.004135103852268421 + -0.02277893339172672i, 0.08460800367663485 + 7.163992530541147e-20i, -0.001071712077512276 + -0.001776533246499124i, 0.005688516687237008 + -0.005013317555202831i, 0.001664389931280537 + 0.0015103255032449623i, -0.004344409902942412 + 0.006970708102087808i, 0.0002013952642444006 + 2.924032673345796e-06i, 0.00012094748282226374 + 0.0007260884682824401i }, { 0.0037817780192082287 + 0.0033328994491858607i, -0.0010717120775122757 + 0.001776533246499124i, 0.06966686229312512 + 2.5935012268988562e-19i, 0.0051215831419641755 + 0.02821312484981318i, -0.0004687767273513281 + 0.00014043812393506848i, -9.133578144553879e-05 + -0.00017951706730804048i, -0.0035772195690838685 + 0.005739733126073423i, -0.002587411414801588 + -0.0010267151346493994i }, { 0.0016277494792925735 + -0.0012864947670570412i, 0.005688516687237008 + 0.005013317555202831i, 0.0051215831419641755 + -0.02821312484981318i, 0.10479227143661286 + -9.237189283502725e-20i, 2.241121946236985e-05 + 0.00020016578046548378i, -0.000705129762398028 + 0.0002112457705003412i, 0.0020614503814759275 + 0.0018706320113470853i, -0.005380821695321171 + 0.00863365525478187i }, { -0.0028882035125677467 + -0.004634190620893933i, 0.001664389931280537 + -0.0015103255032449623i, -0.0004687767273513281 + -0.00014043812393506845i, 2.2411219462369826e-05 + -0.00020016578046548378i, 0.12213889774902215 + -2.4090282548840915e-20i, 0.008979082724545326 + 0.04946282720058398i, 0.008211860909299748 + -0.007237153149228523i, 0.0035345417555560942 + 0.0027935315171740928i }, { -0.0020890444638268784 + 0.0008289572951934557i, -0.004344409902942412 + -0.006970708102087808i, -9.133578144553874e-05 + 0.00017951706730804054i, -0.0007051297623980278 + -0.00021124577050034114i, 0.008979082724545326 + -0.04946282720058398i, 0.183720238067149 + 3.6722044729826766e-20i, -0.0023271462446095787 + -0.0038576150812923366i, 0.012352207765383597 + -0.010886061066613207i }, { 8.040699485720682e-05 + -0.0004827102670740037i, 0.0002013952642444006 + -2.9240326733458212e-06i, -0.003577219569083869 + -0.005739733126073421i, 0.0020614503814759266 + -0.0018706320113470855i, 0.008211860909299748 + 0.0072371531492285215i, -0.0023271462446095782 + 0.0038576150812923366i, 0.15127661651020416 + -1.7192283341464127e-19i, 0.01112115205694426 + 0.06126278589240949i }, { -0.00018957296894354535 + -6.804918715955626e-05i, 0.00012094748282226353 + -0.0007260884682824401i, -0.0025874114148015876 + 0.0010267151346493994i, -0.005380821695321172 + -0.00863365525478187i, 0.003534541755556094 + -0.002793531517174093i, 0.012352207765383599 + 0.010886061066613205i, 0.01112115205694426 + -0.06126278589240949i, 0.22754893413527655 + -1.9850137945879868e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.056248176131975094, 1.0e-7), DoubleNear(0.08460800367663485, 1.0e-7), DoubleNear(0.06966686229312512, 1.0e-7), DoubleNear(0.10479227143661286, 1.0e-7), DoubleNear(0.12213889774902215, 1.0e-7), DoubleNear(0.183720238067149, 1.0e-7), DoubleNear(0.15127661651020416, 1.0e-7), DoubleNear(0.22754893413527655, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.09179421403810531 + -7.27245214886732e-20i, 0.006748282952220815 + 0.03717408156335334i, 0.01497129578997266 + -0.0007298643632172985i, 0.001396194508156584 + 0.006009298574491995i, 0.0002844785867622495 + -0.015628370917400353i, 0.006349965335953879 + -0.001033719171081511i, -0.00022192638310240766 + -0.002672207574006888i, 0.0010658541097371336 + -0.00028632221059232053i }, { 0.006748282952220815 + -0.03717408156335334i, 0.13807603611194827 + -1.8406066721640868e-20i, 0.0008050453240225624 + -0.0061166110296689245i, 0.022519689283257052 + -0.0010978554501330758i, -0.0063081382552944675 + -0.001264130865285623i, 0.00042791014695713796 + -0.02350805581565426i, -0.0010984840972245 + -0.00010657429177285733i, -0.00033381968143135715 + -0.004019510743172027i }, { 0.01497129578997266 + 0.0007298643632172989i, 0.0008050453240225624 + 0.0061166110296689245i, 0.08978664375332418 + 1.1579251148802767e-19i, 0.006600695738035944 + 0.03636107191680156i, 0.00025207767532432746 + -0.0024146750410733112i, 0.000996407228530886 + -7.543127227111252e-05i, 0.00036829269786707954 + -0.015139760123939106i, 0.0061582532946651575 + -0.0009638564182124206i }, { 0.001396194508156584 + -0.006009298574491995i, 0.022519689283257052 + 0.0010978554501330758i, 0.006600695738035944 + -0.03636107191680156i, 0.13505626683734404 + -5.4350220650526074e-21i, -0.0009593440759814138 + -0.00027960004610945216i, 0.00037917298563773657 + -0.0036321326094851166i, -0.006104102968078949 + -0.001262152839902244i, 0.0005539825835793109 + -0.022773091828331087i }, { 0.0002844785867622495 + 0.015628370917400353i, -0.0063081382552944675 + 0.0012641308652856231i, 0.000252077675324327 + 0.0024146750410733112i, -0.0009593440759814139 + 0.00027960004610945216i, 0.11018370633094765 + -2.243760662760499e-20i, 0.008100192750024292 + 0.04462131005772228i, 0.018037435346441894 + -0.0006123611724736309i, 0.001574017307473934 + 0.007259637366957651i }, { 0.006349965335953878 + 0.0010337191710815107i, 0.00042791014695713666 + 0.02350805581565426i, 0.0009964072285308862 + 7.543127227111252e-05i, 0.00037917298563773657 + 0.0036321326094851166i, 0.008100192750024292 + -0.04462131005772228i, 0.1657373460160001 + 1.2587209938818828e-19i, 0.0010780391151596384 + -0.007349673247848581i, 0.0271317489926803 + -0.0009211082010999634i }, { -0.00022192638310240776 + 0.0026722075740068883i, -0.0010984840972245 + 0.0001065742917728573i, 0.00036829269786707954 + 0.015139760123939106i, -0.006104102968078949 + 0.001262152839902244i, 0.018037435346441894 + 0.0006123611724736309i, 0.0010780391151596384 + 0.007349673247848581i, 0.1075659885619494 + 2.7487148867956646e-20i, 0.007907750335441131 + 0.04356120779665618i }, { 0.0010658541097371336 + 0.0002863222105923205i, -0.00033381968143135715 + 0.004019510743172027i, 0.0061582532946651575 + 0.0009638564182124207i, 0.0005539825835793107 + 0.022773091828331087i, 0.0015740173074739333 + -0.007259637366957651i, 0.0271317489926803 + 0.0009211082010999634i, 0.007907750335441131 + -0.04356120779665618i, 0.16179979835038086 + -1.0589107134716368e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.09179421403810531, 1.0e-7), DoubleNear(0.13807603611194827, 1.0e-7), DoubleNear(0.08978664375332418, 1.0e-7), DoubleNear(0.13505626683734404, 1.0e-7), DoubleNear(0.11018370633094765, 1.0e-7), DoubleNear(0.1657373460160001, 1.0e-7), DoubleNear(0.1075659885619494, 1.0e-7), DoubleNear(0.16179979835038086, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.06368673128899141 + 1.4146278229871363e-19i, 0.004681951771619958 + 0.025791339554991424i, 0.010408158407781583 + -0.0004232242656255626i, 0.0009365532699208422 + 0.00418389869669845i, -0.003270154761662747 + 0.005247040403983194i, -0.0023653107099212514 + -0.000938582975297993i, -0.0004995642469275722 + 0.0008792418045460782i, -0.00039279390128247867 + -0.00013767174449226787i }, { 0.004681951771619958 + -0.025791339554991424i, 0.09579701184281997 + 1.112314111128699e-19i, 0.0005937653603599199 + -0.0042461256491619585i, 0.015655858827607116 + -0.0006366101567110731i, 0.0018844976246849274 + 0.0017100589049925366i, -0.004918937557170733 + 0.007892551266907594i, 0.00031934262929531553 + 0.00026694726676070035i, -0.0007514400741028822 + 0.0013225476619391579i }, { 0.010408158407781583 + 0.00042322426562556303i, 0.0005937653603599199 + 0.0042461256491619585i, 0.062228307136108794 + 1.0266786590447467e-19i, 0.004574735222612638 + 0.025200718686548478i, -0.000569301687576134 + 0.0008357787842442051i, -0.00038031936907115705 + -0.00016910865035701413i, -0.003195268319988868 + 0.005126883342984163i, -0.0023111451687072146 + -0.0009170894545448621i }, { 0.000936553269920842 + -0.00418389869669845i, 0.015655858827607116 + 0.0006366101567110731i, 0.004574735222612638 + -0.025200718686548478i, 0.09360326327042774 + -1.3196337864248566e-19i, 0.00029661455361632325 + 0.0002919937751035854i, -0.000856338508870769 + 0.001257170975362328i, 0.001841342688071537 + 0.0016708986095995111i, -0.0048062940410928505 + 0.0077118120899620805i }, { -0.003270154761662747 + -0.005247040403983193i, 0.0018844976246849268 + -0.0017100589049925366i, -0.0005693016875761338 + -0.0008357787842442053i, 0.0002966145536163232 + -0.00029199377510358553i, 0.13829118908006155 + -2.366249104149918e-19i, 0.01016652393062515 + 0.05600405206608419i, 0.02260057272863297 + -0.0009190012700653668i, 0.0020336585457096756 + 0.009085037244751196i }, { -0.002365310709921251 + 0.0009385829752979931i, -0.004918937557170733 + -0.007892551266907594i, -0.00038031936907115705 + 0.00016910865035701418i, -0.0008563385088707692 + -0.001257170975362328i, 0.010166523930625148 + -0.05600405206608419i, 0.2080163702851284 + -3.765378446322475e-21i, 0.0012893190788222809 + -0.009220158628355547i, 0.03399557944833023 + -0.0013823534945219661i }, { -0.0004995642469275721 + -0.0008792418045460782i, 0.00031934262929531553 + -0.0002669472667607003i, -0.003195268319988868 + -0.005126883342984162i, 0.001841342688071537 + -0.0016708986095995114i, 0.02260057272863297 + 0.0009190012700653668i, 0.0012893190788222809 + 0.009220158628355547i, 0.13512432517916478 + 4.061179445150966e-20i, 0.009933710850864436 + 0.05472156102690927i }, { -0.0003927939012824787 + 0.00013767174449226782i, -0.0007514400741028822 + -0.0013225476619391579i, -0.0023111451687072146 + 0.0009170894545448619i, -0.004806294041092852 + -0.007711812089962081i, 0.002033658545709675 + -0.009085037244751196i, 0.03399557944833023 + 0.0013823534945219661i, 0.009933710850864436 + -0.05472156102690927i, 0.20325280191729717 + 2.0637285230269372e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.06368673128899141, 1.0e-7), DoubleNear(0.09579701184281997, 1.0e-7), DoubleNear(0.062228307136108794, 1.0e-7), DoubleNear(0.09360326327042774, 1.0e-7), DoubleNear(0.13829118908006155, 1.0e-7), DoubleNear(0.2080163702851284, 1.0e-7), DoubleNear(0.13512432517916478, 1.0e-7), DoubleNear(0.20325280191729717, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.057255225107066765 + 9.899470821227411e-20i, 0.004209137401135037 + 0.023186759975685586i, 0.00020582878228172727 + -0.00970166288628893i, 0.003944032879319848 + -0.0006298661732547662i, -0.0029399129649838244 + 0.00471715965626676i, -0.0021264460336356795 + -0.0008437986758732601i, 0.0007887345473859986 + 0.000515114064681948i, -0.00015062265633894033 + 0.00035728415130707074i }, { 0.004209137401135037 + -0.023186759975685586i, 0.08612279774190715 + -2.6205806979893972e-20i, -0.003913769733061597 + -0.0007965759385881318i, 0.00030960581419012517 + -0.014593154580277816i, 0.0016941886250286917 + 0.0015373658777902452i, -0.004422190798981976 + 0.0070955093833489115i, 0.00026659083485056274 + -0.0002815465790086826i, 0.0011864074548576873 + 0.0007748299709529839i }, { 0.00020582878228172727 + 0.00970166288628893i, -0.003913769733061597 + 0.0007965759385881318i, 0.06865981331803345 + 1.451359399909142e-19i, 0.00504754959309756 + 0.027805298265854317i, -0.0008098721362947948 + -0.0004811983049914656i, 0.00013533378805233163 + -0.0003633509531970694i, -0.003525510116667791 + 0.005656764090700598i, -0.0025500098449927865 + -0.001011873753969595i }, { 0.003944032879319847 + 0.0006298661732547662i, 0.0003096058141901245 + 0.014593154580277816i, 0.00504754959309756 + -0.027805298265854317i, 0.10327747737134056 + 5.473839450278199e-21i, -0.0002544098406795288 + 0.00029260003818049843i, -0.0012182024271233565 + -0.0007238141884348915i, 0.002031651687727773 + 0.0018435916368018024i, -0.005303040799281607 + 0.008508853973520764i }, { -0.0029399129649838244 + -0.004717159656266759i, 0.0016941886250286912 + -0.0015373658777902454i, -0.0008098721362947947 + 0.00048119830499146563i, -0.00025440984067952885 + -0.0002926000381804984i, 0.12432563268436272 + -5.592671821291963e-20i, 0.009139841289121722 + 0.05034839350446932i, 0.00044694250234760175 + -0.021066468155050533i, 0.008564185751299188 + -0.0013677094160391653i }, { -0.002126446033635679 + 0.0008437986758732601i, -0.004422190798981977 + -0.0070955093833489115i, 0.00013533378805233163 + 0.00036335095319706937i, -0.0012182024271233565 + 0.0007238141884348917i, 0.009139841289121722 + -0.05034839350446932i, 0.18700950520738516 + 2.364718193200497e-21i, -0.00849847149031182 + -0.0017297077665997351i, 0.0006722869163463237 + -0.03168799306370753i }, { 0.0007887345473859984 + -0.0005151140646819481i, 0.00026659083485056274 + 0.00028154657900868256i, -0.003525510116667791 + -0.005656764090700596i, 0.0020316516877277725 + -0.0018435916368018026i, 0.00044694250234760175 + 0.021066468155050533i, -0.00849847149031182 + 0.0017297077665997351i, 0.1490898815748636 + -1.4008639775056255e-19i, 0.010960393492367864 + 0.06037721958852414i }, { -0.00015062265633894033 + -0.0003572841513070707i, 0.0011864074548576875 + -0.000774829970952984i, -0.0025500098449927865 + 0.0010118737539695948i, -0.005303040799281608 + -0.008508853973520764i, 0.008564185751299188 + 0.001367709416039165i, 0.0006722869163463228 + 0.03168799306370753i, 0.010960393492367862 + -0.06037721958852414i, 0.2242596669950404 + 1.45071885907464e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.057255225107066765, 1.0e-7), DoubleNear(0.08612279774190715, 1.0e-7), DoubleNear(0.06865981331803345, 1.0e-7), DoubleNear(0.10327747737134056, 1.0e-7), DoubleNear(0.12432563268436272, 1.0e-7), DoubleNear(0.18700950520738516, 1.0e-7), DoubleNear(0.1490898815748636, 1.0e-7), DoubleNear(0.2242596669950404, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.17596721740420987 + 5.1144351577315e-20i, 0.0 + 0.0i, 0.03195616115612743 + -0.020346350352186997i, 0.0 + 0.0i, 0.02217484562627893 + -0.05150556832468223i, 0.0 + 0.0i, 0.0017540861589437936 + 0.0566921903820163i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03195616115612743 + 0.020346350352186994i, 0.0 + 0.0i, 0.32982408509279143 + -3.884044702704579e-20i, 0.0 + 0.0i, 0.03008610876658107 + -0.01571133075541493i, 0.0 + 0.0i, 0.06048532378607298 + 0.048144379137758264i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02217484562627893 + 0.05150556832468223i, 0.0 + 0.0i, 0.030086108766581077 + 0.015711330755414935i, 0.0 + 0.0i, 0.2707480982205712 + 1.7907861422385004e-20i, 0.0 + 0.0i, -0.0019217977749988412 + -0.006123080868043425i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001754086158943794 + -0.0566921903820163i, 0.0 + 0.0i, 0.06048532378607298 + -0.048144379137758264i, 0.0 + 0.0i, -0.0019217977749988412 + 0.006123080868043425i, 0.0 + 0.0i, 0.22346059928242723 + 1.4045705521383027e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.17596721740420987, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.32982408509279143, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2707480982205712, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22346059928242723, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.20326009829178904 + 7.559871453159032e-20i, 0.0 + 0.0i, 0.013045715558388293 + -0.011887812065175078i, 0.0 + 0.0i, 0.0008670561640322644 + -0.03407724210226882i, 0.0 + 0.0i, -0.0021730248403955235 + -0.0021793989401319106i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013045715558388293 + 0.011887812065175075i, 0.0 + 0.0i, 0.25145306244893273 + -5.637181331892932e-20i, 0.0 + 0.0i, 0.0010285419127219811 + -0.002382992830951534i, 0.0 + 0.0i, 0.0007676078511335135 + -0.042972036583055984i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0008670561640322631 + 0.03407724210226882i, 0.0 + 0.0i, 0.0010285419127219813 + 0.0023829928309515346i, 0.0 + 0.0i, 0.24345521733299202 + -6.546501531890311e-21i, 0.0 + 0.0i, 0.016988647822740288 + -0.014581619155055344i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002173024840395523 + 0.0021793989401319106i, 0.0 + 0.0i, 0.0007676078511335133 + 0.042972036583055984i, 0.0 + 0.0i, 0.016988647822740288 + 0.014581619155055344i, 0.0 + 0.0i, 0.30183162192628593 + 3.157707181326655e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.20326009829178904, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25145306244893273, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24345521733299202, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.30183162192628593, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.14085617980860993 + 5.642045081871415e-20i, 0.0 + 0.0i, 0.009470294706445238 + -0.008346217004388692i, 0.0 + 0.0i, -0.00723261341551016 + 0.011604898722981743i, 0.0 + 0.0i, 0.00020135447767947052 + 0.001208798735356444i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.009470294706445238 + 0.008346217004388692i, 0.0 + 0.0i, 0.17445913372973798 + 1.6697822985485837e-19i, 0.0 + 0.0i, -0.0011739064897493563 + 0.0003516838944354096i, 0.0 + 0.0i, -0.00895804126440504 + 0.014373388380855293i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00723261341551016 + -0.011604898722981741i, 0.0 + 0.0i, -0.0011739064897493558 + -0.0003516838944354096i, 0.0 + 0.0i, 0.30585913581617113 + 1.263176218098585e-20i, 0.0 + 0.0i, 0.020564068674683345 + -0.018123214215841732i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00020135447767947033 + -0.0012087987353564438i, 0.0 + 0.0i, -0.008958041264405041 + -0.014373388380855289i, 0.0 + 0.0i, 0.020564068674683345 + 0.018123214215841725i, 0.0 + 0.0i, 0.3788255506454807 + -1.9177297136052116e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.14085617980860993, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17445913372973798, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.30585913581617113, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3788255506454807, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.22987025015005358 + -9.113058821031406e-20i, 0.0 + 0.0i, 0.03749098507322972 + -0.0018277198133503734i, 0.0 + 0.0i, 0.0007123887337193874 + -0.03913642673305461i, 0.0 + 0.0i, -0.0005557460645337644 + -0.006691718317178915i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03749098507322972 + 0.0018277198133503734i, 0.0 + 0.0i, 0.2248429105906682 + 1.1035748942297508e-19i, 0.0 + 0.0i, 0.000631250660962064 + -0.006046807650558428i, 0.0 + 0.0i, 0.0009222752814463905 + -0.03791285195227019i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0007123887337193861 + 0.03913642673305461i, 0.0 + 0.0i, 0.0006312506609620636 + 0.006046807650558428i, 0.0 + 0.0i, 0.27592105234694775 + 1.0343449276058327e-19i, 0.0 + 0.0i, 0.04516918433912219 + -0.001533469373573593i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005557460645337646 + 0.006691718317178915i, 0.0 + 0.0i, 0.0009222752814463902 + 0.03791285195227019i, 0.0 + 0.0i, 0.04516918433912219 + 0.001533469373573593i, 0.0 + 0.0i, 0.2693657869123302 + -7.840392247920703e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.22987025015005358, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2248429105906682, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27592105234694775, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2693657869123302, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.1594837431318114 + 2.526941934115835e-19i, 0.0 + 0.0i, 0.026064017235388703 + -0.0010598344223366352i, 0.0 + 0.0i, -0.008189092318833479 + 0.01313959167089079i, 0.0 + 0.0i, -0.0012510043210304544 + 0.002201789466485236i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026064017235388703 + 0.0010598344223366352i, 0.0 + 0.0i, 0.15583157040653653 + -2.929551273801099e-20i, 0.0 + 0.0i, -0.0014256401964469032 + 0.002092949759606533i, 0.0 + 0.0i, -0.008001562361081719 + 0.012838695432946245i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00818909231883348 + -0.013139591670890788i, 0.0 + 0.0i, -0.0014256401964469032 + -0.0020929497596065333i, 0.0 + 0.0i, 0.3463075593651899 + -2.403902888613143e-19i, 0.0 + 0.0i, 0.056596152176963205 + -0.002301354764587331i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001251004321030454 + -0.002201789466485236i, 0.0 + 0.0i, -0.00800156236108172 + -0.012838695432946244i, 0.0 + 0.0i, 0.056596152176963205 + 0.002301354764587331i, 0.0 + 0.0i, 0.3383771270964619 + 6.124907968177904e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1594837431318114, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.15583157040653653, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3463075593651899, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3383771270964619, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.14337802284897394 + 7.278890123238014e-20i, 0.0 + 0.0i, 0.0005154345964718524 + -0.024294817466566747i, 0.0 + 0.0i, -0.0073621037639658 + 0.011812669039615671i, 0.0 + 0.0i, 0.001975142002243686 + 0.0012899440356349318i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0005154345964718518 + 0.024294817466566747i, 0.0 + 0.0i, 0.171937290689374 + 1.5060977944119239e-19i, 0.0 + 0.0i, -0.0020280745634181515 + -0.0012050124934263572i, 0.0 + 0.0i, -0.008828550915949397 + 0.014165618064221362i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007362103763965802 + -0.01181266903961567i, 0.0 + 0.0i, -0.002028074563418151 + 0.0012050124934263572i, 0.0 + 0.0i, 0.3113351378917478 + -5.356200001971913e-20i, 0.0 + 0.0i, 0.0011192294186939255 + -0.05275446121875806i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001975142002243686 + -0.001289944035634932i, 0.0 + 0.0i, -0.008828550915949399 + -0.014165618064221362i, 0.0 + 0.0i, 0.0011192294186939246 + 0.05275446121875806i, 0.0 + 0.0i, 0.373349548569904 + -1.2557920915981616e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.14337802284897394, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.171937290689374, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3113351378917478, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.373349548569904, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.08006989959799776 + 1.3809412701681816e-20i, 0.014272228535252967 + -0.009208512837978798i, 0.009949578520933372 + -0.023453463397052076i, 0.0006678591100884811 + 0.02584925814543629i, 0.000339912645188818 + -0.013695400463420786i, -0.0018987497288811992 + -0.002536320161883628i, -0.004470516755583898 + -0.002009839190444551i, 0.0044943380424894925 + 0.0005397286105839574i }, { 0.014272228535252967 + 0.009208512837978796i, 0.14980035055205582 + -1.0494000091199587e-19i, 0.01369779743199259 + -0.007418387868161339i, 0.027541406552296345 + 0.0216257435837017i, 0.0014833965284708176 + -0.002554904254201221i, 0.00037247608853056943 + -0.025441026269633828i, -0.0011445778787406496 + -0.0029395444829334637i, 0.0039147706910501335 + -0.004681879126734364i }, { 0.009949578520933372 + 0.023453463397052076i, 0.013697797431992592 + 0.007418387868161342i, 0.12319019869379129 + 6.17893018299085e-20i, -0.0012265129768646724 + -0.00267929922719628i, 0.004277333846306401 + -0.0017694573840519971i, 0.001274833599892933 + -0.0023195182110327182i, 0.0005271435188434464 + -0.020381841638848035i, -0.0002742751115143243 + 0.00035692122175171726i }, { 0.0006678591100884813 + -0.02584925814543629i, 0.027541406552296345 + -0.0216257435837017i, -0.0012265129768646724 + 0.0026792992271962796i, 0.10165271189687691 + 4.856818759306657e-20i, -0.004757945989516466 + 0.0002131362256504175i, -0.003646083185344337 + -0.004277350266506431i, -0.00045485461574883645 + 0.00017191142324968678i, 0.00039513176260294407 + -0.01753101031342216i }, { 0.0003399126451888167 + 0.013695400463420786i, 0.001483396528470818 + 0.002554904254201221i, 0.004277333846306401 + 0.0017694573840519971i, -0.004757945989516466 + -0.00021313622565041746i, 0.0958973178062121 + 3.7334938875633186e-20i, 0.01768393262087446 + -0.0111378375142082i, 0.012225267105345557 + -0.028052104927630155i, 0.0010862270488553125 + 0.030842932236580002i }, { -0.0018987497288811988 + 0.002536320161883628i, 0.00037247608853056943 + 0.025441026269633828i, 0.0012748335998929328 + 0.0023195182110327182i, -0.0036460831853443376 + 0.004277350266506431i, 0.01768393262087446 + 0.011137837514208198i, 0.1800237345407356 + 6.609955388495008e-20i, 0.016388311334588485 + -0.008292942887253591i, 0.03294391723377663 + 0.02651863555405656i }, { -0.004470516755583898 + 0.002009839190444551i, -0.0011445778787406498 + 0.0029395444829334637i, 0.0005271435188434464 + 0.020381841638848035i, -0.00045485461574883645 + -0.00017191142324968675i, 0.012225267105345558 + 0.028052104927630155i, 0.016388311334588485 + 0.008292942887253591i, 0.1475578995267799 + -4.38814404075235e-20i, -0.0006952847981341688 + -0.003443781640847145i }, { 0.0044943380424894925 + -0.0005397286105839576i, 0.0039147706910501335 + 0.004681879126734364i, -0.0002742751115143243 + -0.00035692122175171726i, 0.00039513176260294386 + 0.01753101031342216i, 0.0010862270488553127 + -0.030842932236580002i, 0.03294391723377663 + -0.02651863555405656i, -0.0006952847981341688 + 0.003443781640847145i, 0.12180788738555032 + -3.452248207168353e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.08006989959799776, 1.0e-7), DoubleNear(0.14980035055205582, 1.0e-7), DoubleNear(0.12319019869379129, 1.0e-7), DoubleNear(0.10165271189687691, 1.0e-7), DoubleNear(0.0958973178062121, 1.0e-7), DoubleNear(0.1800237345407356, 1.0e-7), DoubleNear(0.1475578995267799, 1.0e-7), DoubleNear(0.12180788738555032, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.055485158328279084 + -2.5774458722840235e-20i, 0.010076266974426297 + -0.0064155158406609195i, 0.006992068401314605 + -0.01624049442526798i, 0.0005530902271806389 + 0.017875915785481186i, -0.002849024451977126 + 0.004571326894589874i, 1.1172160789790894e-05 + 0.0011595870617991933i, 0.0009790011732693795 + 0.001409973377000447i, -0.0015011658015676847 + -0.0008723155236813268i }, { 0.010076266974426297 + 0.0064155158406609195i, 0.1039985848035323 + 2.7846865213442377e-19i, 0.009486610818883351 + -0.004954023183248348i, 0.019071948834074096 + 0.015180660002931348i, -0.001045954501138948 + 0.0005007455967015321i, -0.005340067866856354 + 0.008568264776300915i, -7.896033655456944e-05 + 0.0010359623021983662i, -0.002230005494299834 + 0.000791816089484789i }, { 0.006992068401314605 + 0.01624049442526798i, 0.009486610818883351 + 0.004954023183248349i, 0.08537102148033085 + 8.219490954155439e-20i, -0.0006059722679810583 + -0.0019307011637277722i, -0.0016970517095003996 + -0.00025784436467497015i, -0.0008952672588495982 + 0.000527208840552657i, -0.004383588963533033 + 0.007033571828391868i, 0.00019018231688967965 + 4.921167355725073e-05i }, { 0.0005530902271806389 + -0.017875915785481186i, 0.019071948834074096 + -0.015180660002931348i, -0.0006059722679810583 + 0.0019307011637277722i, 0.07046054892620568 + -1.114904222795654e-19i, 0.001444366195011129 + 0.0009634518313651442i, 0.00027141151305349654 + 0.0023507941242815033i, -0.00012795198861040806 + -0.00014906170226612237i, -0.0036179733975486863 + 0.005805123604554376i }, { -0.0028490244519771266 + -0.004571326894589873i, -0.001045954501138948 + -0.0005007455967015319i, -0.0016970517095003998 + 0.00025784436467497004i, 0.001444366195011129 + -0.0009634518313651442i, 0.12048205907593079 + 7.691881030015524e-20i, 0.02187989418170113 + -0.013930834511526078i, 0.015182777224964323 + -0.035265073899414245i, 0.0012009959317631548 + 0.03881627459653511i }, { 1.1172160789790623e-05 + -0.001159587061799193i, -0.0053400678668563545 + -0.008568264776300913i, -0.0008952672588495979 + -0.0005272088405526569i, 0.00027141151305349676 + -0.0023507941242815033i, 0.02187989418170113 + 0.013930834511526075i, 0.22582550028925913 + -3.1730909916146956e-19i, 0.02059949794769772 + -0.010757307572166582i, 0.04141337495199888 + 0.032963719134826916i }, { 0.00097900117326938 + -0.0014099733770004466i, -7.896033655456926e-05 + -0.0010359623021983662i, -0.004383588963533033 + -0.007033571828391867i, -0.000127951988610408 + 0.0001490617022661223i, 0.015182777224964326 + 0.035265073899414245i, 0.020599497947697724 + 0.010757307572166586i, 0.18537707674024034 + -6.428704811916939e-20i, -0.0013158255070177829 + -0.004192379704315652i }, { -0.0015011658015676847 + 0.0008723155236813268i, -0.002230005494299834 + -0.0007918160894847892i, 0.0001901823168896797 + -4.921167355725075e-05i, -0.003617973397548687 + -0.005805123604554377i, 0.0012009959317631552 + -0.03881627459653511i, 0.04141337495199888 + -0.032963719134826916i, -0.0013158255070177829 + 0.004192379704315652i, 0.15300005035622155 + 1.2553612780094842e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.055485158328279084, 1.0e-7), DoubleNear(0.1039985848035323, 1.0e-7), DoubleNear(0.08537102148033085, 1.0e-7), DoubleNear(0.07046054892620568, 1.0e-7), DoubleNear(0.12048205907593079, 1.0e-7), DoubleNear(0.22582550028925913, 1.0e-7), DoubleNear(0.18537707674024034, 1.0e-7), DoubleNear(0.15300005035622155, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.0640910216227109 + 1.4623910970579885e-20i, 0.00411351389162531 + -0.0037484091886156356i, 0.000273396086217191 + -0.010745076277999087i, -0.0006851880088759332 + -0.0006871978601328366i, -0.0032909140616479786 + 0.005280349190178233i, 9.760631920731423e-05 + 0.0005313768042977835i, 0.0008712301720997638 + 0.0005742574932860835i, 9.179974618226663e-05 + -2.1165567538115623e-05i }, { 0.00411351389162531 + 0.003748409188615635i, 0.07928700122626303 + 5.816499026180026e-20i, 0.00032431501569726357 + -0.0007513941316511186i, 0.00024203851025466142 + -0.013549741188567659i, -0.0005200436705238378 + 0.00014643388420382502i, -0.004071189702317822 + 0.00653231984943744i, 4.525330499614323e-05 + 6.530197113767115e-05i, 0.0011039118301439223 + 0.0007156865423488482i }, { 0.0002733960862171906 + 0.010745076277999087i, 0.0003243150156972636 + 0.0007513941316511187i, 0.07676515818589905 + 4.179653984813427e-20i, 0.005356780814819928 + -0.0045978078157730565i, -0.0008993065859796404 + -0.0005292082253573202i, -7.855883886154537e-05 + -1.1862456923628488e-05i, -0.003941699353862181 + 0.00632454953280351i, 0.0001037481584721563 + 0.0006774219310586605i }, { -0.000685188008875933 + 0.0006871978601328366i, 0.0002420385102546612 + 0.013549741188567659i, 0.005356780814819928 + 0.0045978078157730565i, 0.09517213250347495 + 1.0881323959305813e-19i, -2.143435657882312e-05 + -9.173735883701345e-05i, -0.0011287679774385111 + -0.0006758042680690369i, -0.0006538628192255184 + 0.00020525001023158462i, -0.004886851562087218 + 0.007841068531417852i }, { -0.0032909140616479786 + -0.005280349190178231i, -0.0005200436705238378 + -0.000146433884203825i, -0.0008993065859796401 + 0.0005292082253573202i, -2.143435657882312e-05 + 9.173735883701345e-05i, 0.13916907666907816 + 6.097480356101043e-20i, 0.008932201666762984 + -0.008139402876559442i, 0.0005936600778150734 + -0.02333216582426973i, -0.0014878368315195904 + -0.0014922010799990738i }, { 9.760631920731412e-05 + -0.0005313768042977835i, -0.004071189702317823 + -0.006532319849437439i, -7.85588388615454e-05 + 1.1862456923628468e-05i, -0.001128767977438511 + 0.000675804268069037i, 0.008932201666762984 + 0.00813940287655944i, 0.1721660612226697 + -1.1453680358072957e-19i, 0.0007042268970247175 + -0.0016315986993004157i, 0.0005255693408788521 + -0.02942229539448833i }, { 0.0008712301720997637 + -0.0005742574932860835i, 4.525330499614322e-05 + -6.530197113767112e-05i, -0.003941699353862181 + -0.00632454953280351i, -0.0006538628192255181 + -0.0002052500102315846i, 0.0005936600778150725 + 0.02333216582426973i, 0.0007042268970247178 + 0.0016315986993004157i, 0.16669005914709298 + -4.834304138002458e-20i, 0.011631867007920361 + -0.009983811339282288i }, { 9.179974618226662e-05 + 2.116556753811561e-05i, 0.0011039118301439223 + -0.0007156865423488485i, 0.00010374815847215621 + -0.0006774219310586604i, -0.004886851562087218 + -0.00784106853141785i, -0.0014878368315195901 + 0.0014922010799990738i, 0.0005255693408788521 + 0.02942229539448833i, 0.011631867007920361 + 0.009983811339282287i, 0.20665948942281098 + -7.723616777979158e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.0640910216227109, 1.0e-7), DoubleNear(0.07928700122626303, 1.0e-7), DoubleNear(0.07676515818589905, 1.0e-7), DoubleNear(0.09517213250347495, 1.0e-7), DoubleNear(0.13916907666907816, 1.0e-7), DoubleNear(0.1721660612226697, 1.0e-7), DoubleNear(0.16669005914709298, 1.0e-7), DoubleNear(0.20665948942281098, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.07248160999920264 + 8.05072922664447e-20i, 0.011821481713226951 + -0.0005763080460068244i, 0.00022462707693391554 + -0.0123403146661037i, -0.00017523524458616657 + -0.0021100012592915763i, -0.003721749841365243 + 0.005971635355028931i, -0.0005595225628739298 + 0.0010035435543876248i, 0.0010051632899040629 + 0.0006521510096947899i, 0.00018283727228226703 + 9.390596966742127e-05i }, { 0.011821481713226951 + 0.0005763080460068244i, 0.07089641284977129 + -7.718391034064563e-21i, 0.00019904300008254236 + -0.0019066510502419123i, 0.0002908075195379369 + -0.011954502800463045i, -0.0006544846229871055 + 0.0009443595936884343i, -0.003640353922600558 + 0.00584103368458674i, 0.0001468653437397799 + 0.00011430058549102024i, 0.0009699787123396231 + 0.0006377930259401419i }, { 0.0002246270769339151 + 0.0123403146661037i, 0.00019904300008254236 + 0.0019066510502419123i, 0.08700213313260875 + 1.7218690114513883e-19i, 0.014242535522161752 + -0.0004835263763298108i, -0.0010282313698750881 + -0.0006151377315865879i, -0.00016730606667599 + -8.150296368110142e-05i, -0.004467342477468237 + 0.007167956315861859i, -0.0006914817581565246 + 0.0011982459120976113i }, { -0.0001752352445861668 + 0.0021100012592915763i, 0.0002908075195379367 + 0.011954502800463045i, 0.01424253552216175 + 0.0004835263763298108i, 0.08493515755676524 + -2.1577121703946428e-20i, -0.00016484148704109082 + -0.00012278063130999282i, -0.0009998431935430633 + -0.0005898747618397692i, -0.0007711555734597976 + 0.0011485901659180986i, -0.004361208438481161 + 0.006997661748359504i }, { -0.0037217498413652434 + -0.005971635355028931i, -0.0006544846229871055 + -0.0009443595936884344i, -0.001028231369875088 + 0.000615137731586588i, -0.00016484148704109082 + 0.00012278063130999277i, 0.15738864015085094 + -1.7163788047675876e-19i, 0.025669503360002763 + -0.001251411767343549i, 0.0004877616567854719 + -0.026796112066950914i, -0.0003805108199475978 + -0.004581717057887339i }, { -0.0005595225628739296 + -0.0010035435543876248i, -0.0036403539226005583 + -0.0058410336845867395i, -0.00016730606667598997 + 8.150296368110142e-05i, -0.0009998431935430633 + 0.0005898747618397692i, 0.025669503360002763 + 0.001251411767343549i, 0.15394649774089691 + 1.1807588045703964e-19i, 0.00043220766087952167 + -0.004140156600316516i, 0.0006314677619084536 + -0.02595834915180715i }, { 0.0010051632899040629 + -0.00065215100969479i, 0.00014686534373977992 + -0.00011430058549102024i, -0.004467342477468238 + -0.007167956315861857i, -0.0007711555734597976 + -0.0011485901659180988i, 0.00048776165678547103 + 0.026796112066950914i, 0.00043220766087952124 + 0.004140156600316516i, 0.18891891921433898 + -6.875240838455556e-20i, 0.030926648816960438 + -0.0010499429972437822i }, { 0.00018283727228226703 + -9.390596966742126e-05i, 0.0009699787123396231 + -0.000637793025940142i, -0.0006914817581565245 + -0.001198245912097611i, -0.004361208438481161 + -0.006997661748359504i, -0.0003805108199475978 + 0.004581717057887339i, 0.0006314677619084536 + 0.02595834915180715i, 0.030926648816960438 + 0.0010499429972437822i, 0.18443062935556498 + -5.68268007752606e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.07248160999920264, 1.0e-7), DoubleNear(0.07089641284977129, 1.0e-7), DoubleNear(0.08700213313260875, 1.0e-7), DoubleNear(0.08493515755676524, 1.0e-7), DoubleNear(0.15738864015085094, 1.0e-7), DoubleNear(0.15394649774089691, 1.0e-7), DoubleNear(0.18891891921433898, 1.0e-7), DoubleNear(0.18443062935556498, 1.0e-7) }));


}
}

}
