#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { 0.1460007351472461 + 0.21616666531681228i, 0.004286070827523099 + 0.025714142316682315i, 0.016824822007177317 + -0.02211914133717495i, 0.06255168689919038 + -0.0655828886798023i }, { -0.16659652186972163 + -0.16714190541794i, 0.046850399091430406 + 0.05013534332518145i, 0.046966810664755075 + 0.04477411345948089i, 0.02648887269655878 + -0.01199389515962545i }, { -0.0751365980098814 + 0.060000518696587936i, -0.01633064772832403 + 0.042718528704599086i, -0.07038209270945317 + 0.08420773232549701i, -0.12084575310614874 + -0.14939806207038275i }, { 0.030876899572438075 + -0.0009934322377642994i, 0.13465489030495104 + -0.04819643828756692i, -0.059991824140908916 + 0.07648603430574505i, 0.03441734743023042 + 0.02062093433626125i } }), Matrix({ { -0.17721675623192173 + 0.1537515295765166i, -0.04610460420444918 + -0.03476368107521172i, -0.24406816001375176 + -0.13044550835888885i, 0.05499118840556671 + -0.11040819344501776i }, { -0.05060054871947898 + -0.1612516620703067i, 0.06449136731550763 + 0.007956350019852643i, -0.07110469803249529 + -0.06170688635405706i, -0.01064911860828815 + 0.037223229590247375i }, { -0.01423624598225147 + 0.08443726068307675i, -0.04292213404987327 + 0.03756313645334346i, -0.0372084232739028 + 0.06480444045499124i, -0.021249441832905478 + -0.011732642196891i }, { -0.07874284343313863 + -0.04171900944442532i, 0.22335507979889765 + 0.007970546876142943i, -0.014437482382209385 + 0.013648957794117178i, -0.13711643374388255 + 0.013222367326204297i } }), Matrix({ { 0.03745340123335699 + 0.08951149284874303i, 0.13008778838379834 + -0.11386412447028947i, 0.045926487724003054 + 0.005710368872665254i, 0.06931353329878247 + -0.07099125234342235i }, { 0.26436483559143936 + 0.15865389242932693i, 0.17592295702402702 + -0.02572377468827471i, -0.045853128017968606 + -0.0061171919475988415i, 0.10999090909960665 + -0.03094899786842041i }, { 0.03955977427084694 + 0.08772067892765739i, -0.07339470833278124 + -0.02342970647317783i, -0.062442979317461324 + -0.21141217797021142i, -0.1558865863415157 + 0.18290751785707285i }, { -0.04780387816533878 + -0.005824931662567709i, -0.05628490538103842 + 0.035657852464351256i, 0.031018166640935062 + 0.08136175192039968i, 0.010852185187486653 + -0.10084489931448198i } }), Matrix({ { 0.07073096640906881 + -0.0559121331886296i, -0.12589724577613387 + 0.05211262632635919i, -0.12307378327040928 + -0.1619624644210116i, 0.17726385246472154 + -0.00918220224210386i }, { -0.0982047848798448 + 0.04760162128925452i, -0.060588070330720424 + -0.03240180840628789i, 0.03796566395734053 + 0.0305952031979733i, 0.05339554960738047 + -0.014922256420552123i }, { 0.1326979289218052 + 0.041339173107520485i, 0.12904954559376894 + 0.03223800189840317i, 0.015674154882210436 + -0.09415894895032949i, 0.1549904831383691 + -0.03246559621750674i }, { -0.07137167512724488 + -0.031050885529034677i, -0.0859307459464323 + -0.06461265468179368i, -0.033046663848592416 + -0.059927042365204526i, 0.14635731299574956 + 0.07190545702284969i } }), Matrix({ { 0.07432202462704124 + 0.006690138990005945i, 0.05816566710921479 + 0.07804077930684022i, -0.13387961224204553 + -0.03339470697679791i, 0.018148959555092808 + -0.13122367743269514i }, { -0.06434231683260969 + 0.07515518609068289i, 0.02925610481864607 + 0.010973185177465733i, 0.12059773585675224 + -0.023774709529389124i, 0.0115921748482756 + -0.0041328157406830554i }, { 0.18478825238242394 + 0.04796180118172011i, -0.11571003214744686 + -0.16323099168628627i, 0.11129854046710325 + -0.04398867666757626i, 0.003147009171135757 + 0.05543748082671256i }, { 0.1259212408044975 + 0.02369849585135657i, -0.00968722523578592 + -0.057230966402240735i, 0.06112373389691911 + 0.01628953691359232i, 0.036278962201472316 + -0.08499409440411604i } }), Matrix({ { -0.0005706228453000615 + -0.002388410616120675i, 0.018635687689826066 + 0.13360342291162547i, 0.07837393007064969 + -0.12292526856272935i, 0.023731599232569546 + -0.10447520397921004i }, { -0.15788851288532252 + -0.019407730216205045i, -0.09518786723424742 + -0.03871779981650143i, 0.03185645142763105 + 0.0531253821870885i, 0.06815069857902822 + 0.029765838641186277i }, { 0.025852039682527424 + -0.03486457689815967i, -0.021879052837755503 + 0.17628769778104164i, -0.00833848559341834 + 0.2709244065305418i, 0.048338822954022226 + 0.20589592137764823i }, { -0.036354568148776495 + -0.15282916304724295i, 0.13902119359227466 + -0.13765841415727034i, 0.054794024463891214 + -0.04882191885508167i, 0.13742124110273274 + 0.02340733742606223i } }), Matrix({ { -0.030017364981926968 + -0.05310758398120383i, -0.043297991561688426 + 0.09478368781283365i, 0.009230831425928138 + 0.005682376812907067i, 0.1570151927897836 + 0.027719585371104045i }, { -0.12192338111913142 + -0.030683962869344047i, 0.0847888247330859 + 0.1315092894781758i, 0.12918330914439435 + 0.09026364457422614i, -0.06321568335621727 + -0.015579840706208119i }, { -0.009595309090626423 + -0.012844946124963523i, 4.808177543101051e-05 + 0.017255751558732126i, -0.023264005883793813 + 0.07890822638102943i, -0.24029556992359355 + -0.06434743708858622i }, { 0.16461685440576967 + -0.005092277608074916i, -0.006281732603940882 + 0.12849535778046117i, -0.04492960598275567 + -0.04068083923376867i, 0.0378680175847781 + 0.14486613411402388i } }), Matrix({ { 0.041930932298823456 + -0.13639624762891017i, -0.05104868756674992 + -0.03156213338003731i, -0.04640619613285117 + -0.025887910925441883i, -0.23613121749395302 + -0.01365821986683486i }, { 0.11604053928537932 + 0.05480224271324174i, -0.03721902262565042 + -0.0760936365996212i, 0.01438157157001945 + -0.036160450401062486i, -0.0043012659722792045 + 0.12887686309713012i }, { -0.010803266715912061 + 0.08412371185530322i, -0.030627406045495315 + -0.10842150126606195i, -0.03999484318707481 + 0.046621026432079056i, 0.0793580881649107 + 0.046911352983380464i }, { 0.17936914139612248 + -0.10992869003737055i, 0.0044561868301716615 + -0.15745806891164i, 0.07998444821842829 + 0.0837056564416588i, 0.0302302537826335 + -0.07417626166850874i } }), Matrix({ { -0.011250031298105447 + -0.02688790429476174i, -0.07388113656737463 + 0.10515879755335318i, -0.11468352602778983 + 0.042671315321458285i, 0.08019200290468526 + 0.06272468262177988i }, { -0.116230749034234 + 0.07470075720326777i, -0.013862985036240854 + 0.049873108211840184i, 0.07797618827705237 + 0.1332462934305952i, 0.053898984186618 + -0.18264153566917077i }, { -0.06306264016464533 + 0.12224189118497955i, -0.00046981854873327236 + 0.1684687295616482i, -0.048384674536811396 + 0.06288099358221486i, -0.10175330181727012 + 0.15219683441730453i }, { 0.06269223494068976 + -0.015373670002024616i, -0.027240913663736266 + 0.02294346734941364i, 0.1541850503780753 + -0.12141183957312406i, 0.05242314738308631 + -0.14115587166745794i } }), Matrix({ { -0.04987481679151587 + -0.0836104228708069i, 0.06929241420940119 + -0.0085562575073423i, -0.07476579809147864 + -0.14186092533191122i, -0.07650512288453012 + -0.05369018682405096i }, { -0.05053578852276261 + -0.09956644628796554i, 0.020489395080265323 + 0.17799394892222323i, -0.018072572166655143 + -0.05453571290355018i, -0.0006443076453964025 + 0.03491690164273739i }, { -0.0335134876410778 + -0.14737729172711142i, -0.011709682380568185 + 0.14378326302011796i, 0.0876106408106026 + 0.07509323787017358i, -0.002129619046664392 + -0.06733445925589415i }, { 0.036500172826904626 + -0.016329115803673862i, -0.056127744115765384 + 0.02531600932211809i, -0.12955664936451936 + -0.011367081665142319i, 0.023982149394780973 + 0.09803567305501326i } }), Matrix({ { -0.06845748965761249 + 0.00574475935084778i, -0.19781649443801413 + 0.05769349036338568i, 0.06442390642222033 + 0.11145458896891376i, 0.05373084830901011 + 0.02098650135052482i }, { 0.006045902197281183 + 0.0766246473564329i, 0.006554969537447259 + -0.09449755949207442i, -0.024771977876749424 + 0.10314672178760606i, 0.06206514852110358 + 0.12881678452242581i }, { -0.06084905909932503 + -0.1719592128092575i, 0.09324719707669181 + -0.08367385976258118i, 0.004675912750682538 + 0.09666400174415431i, -0.035805601261376364 + 0.014011272454279841i }, { -0.07423674543669816 + -0.049974612045641596i, 0.028398704841288997 + -0.0339750218043131i, 0.08806675637018153 + -0.08820417507706448i, -0.07051899474794633 + 0.07562285435639662i } }), Matrix({ { -0.12244146400184151 + 0.08509946109944878i, 0.1636942066335957 + -0.05261675403707667i, -0.08850919739039134 + -0.024192310201156676i, 0.0718885970045501 + -0.10122697735105644i }, { -0.059318132807733175 + 0.009911387744333987i, -0.16938078355115133 + 0.06610539598814814i, 0.0262687246720319 + 0.011141442869213066i, -0.13536965005233326 + -0.003190996527014034i }, { 0.09734331609022875 + 0.012766599471652297i, 0.11918353129723999 + -0.11393943351285625i, 0.03720184290378005 + -0.05358346514831658i, -0.0012167115957725165 + -0.06468123870078589i }, { -0.14871335760105023 + 0.009552685724931082i, 0.10547598359512456 + -0.07011786364809762i, -0.04523511119803853 + -0.04089256275936775i, 0.11960614408429417 + 0.08219189244922444i } }), Matrix({ { -0.0030022030673786996 + 0.024933595652934074i, -0.04147027205996147 + -0.03639415924575681i, 0.04997088702618817 + -0.0342548158350323i, 0.1451133202908999 + -0.02868486419326327i }, { -0.006228551537384929 + -0.026848845525453236i, -0.056733662219278676 + -0.04769566881959358i, -0.19609222082670258 + -0.17867955864473517i, 0.00013060559511177664 + -0.025702394150408217i }, { -0.019688075282432195 + 0.019138015638778236i, -0.08673486347174499 + 0.09467726173515296i, 0.049768145073941644 + -0.04366311734787165i, -0.004456319876961301 + -0.08664292541825537i }, { 0.07094897160144371 + -0.016535392598381552i, -0.026885042123206568 + -0.051384135869611915i, -0.01833012631160819 + 0.07843475484598048i, 0.1547815212881382 + 0.11107172194391737i } }), Matrix({ { -0.0783412498921482 + -0.057270790438452894i, -0.035973451914015596 + -0.16013841873320406i, -0.03781441385420523 + -0.02293899337630388i, -0.11480485751560202 + -0.06613340504820728i }, { 0.02326241698139583 + -0.07067653385195222i, 0.01899635900949626 + 0.06550438156223429i, 0.14219565736568163 + 0.031289731243529684i, -0.0334899733705904 + 0.0918778163254244i }, { -0.05657604762724938 + -0.10317772011761397i, 0.18309501698574301 + -0.0704936101072805i, -0.1782617826251341 + -0.08262582297609766i, 0.05672509987629996 + 0.1351455833073547i }, { -0.023768866191672868 + 0.09226866331104364i, 0.09171085482243813 + -0.03158345471706228i, 0.08678538805501687 + -0.13397261730487622i, -0.08571053293536202 + 0.08948044977417521i } }), Matrix({ { 0.14265332807238526 + -0.03336970032789018i, 0.03660551055980348 + 0.07382795532732904i, -0.008213058712616276 + -0.020823355893890033i, 0.037497888112195406 + 0.014743150777501785i }, { -0.06800415531876336 + 0.047942818347117666i, -0.057901147195341826 + -0.1716855465161355i, 0.2225627139040681 + 0.08128769621731026i, 0.07766687108877691 + 0.093436969260496i }, { 0.01649306662026243 + 0.12419797751069182i, -0.027160278872796147 + 0.14882299953015368i, -0.061753428842021896 + -0.001234575181371342i, 0.05751578776125395 + -0.12614145677621322i }, { -0.08888538240191049 + -0.12323290229634366i, 0.07461577782344905 + 0.03466284929919348i, -0.07326118147693529 + 0.05664739917855189i, 0.15314491211300157 + -0.05277031457208671i } }), Matrix({ { -0.1573074357649969 + 0.027532377059216424i, 0.07408019591644294 + 0.06570581562196409i, 0.0030235467846752946 + -0.23844464786672506i, 0.03226752509035547 + -0.01879844290339334i }, { 0.028233425607224395 + -0.06586428867777237i, -0.01979050510238213 + -0.06306903256214108i, 0.15024325368367517 + 0.08659887149972142i, -0.06748953535383022 + 0.028837302504345987i }, { -0.04312577639981839 + -0.011578501557574982i, 0.0996971187713349 + -0.13993139740654517i, -0.009740414432697535 + 0.09168388095312768i, -0.033267440101551346 + -0.04442793954228342i }, { -0.02369020196118505 + -0.07559635351860323i, -0.0022627457745188696 + -0.16659798409206325i, -0.004361131179668283 + -0.03623270183908128i, 0.03182061090464004 + 0.03901950289940739i } }) }, { QubitIndex{ 3 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.13927879819122754 + 0.06279411972154143i, -0.29447749022798286 + -0.24678261535868215i }, { 0.10234897992951222 + 0.11922911075746741i, -0.02146721125114863 + 0.0178159311695926i } }), Matrix({ { -0.01798539548519944 + -0.0988015273165656i, -0.11515238806931107 + 0.11687490408191585i }, { -0.5709713102722538 + -0.14185264890820024i, -0.11818032619782766 + -0.38559803364884887i } }), Matrix({ { 0.14502386982310939 + -0.08891218190124937i, 0.12944855737131897 + 0.2425758725595751i }, { 0.44461495560248737 + 0.013229089435236098i, -0.15498076548150133 + 0.22143285171729105i } }), Matrix({ { -0.4444868284275593 + 0.12941784225469782i, 0.06005753953315098 + 0.5334855438455667i }, { -0.2384656733240196 + -0.3126877525521496i, -0.1299333731984251 + 0.456380222782466i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.05432129056650803 + -0.011289036650630014i, -0.02102111636472443 + 0.039157357393789484i, -0.04711756335335962 + -0.0808935254274677i, -0.20198591328706936 + -0.02701947083775354i }, { 0.012680336595776415 + -0.16630701911885304i, -0.1352727052321841 + 0.010035406840455324i, 0.03484257792920284 + 0.06345308941521668i, -0.01674791558951009 + -0.09665299974189827i }, { 0.009549779915023196 + 0.053797606801150574i, 0.05436778553640592 + -0.03195007046135843i, -0.059390699065097294 + -0.0749662834268788i, -0.08517038660329479 + -0.011664018580781834i }, { 0.12140254777615633 + -0.12854072874994935i, 0.07730299535216213 + -0.09583654798802266i, -0.039934154031858515 + 0.01512897588242247i, 0.09730076620408434 + -0.13060390368991437i } }), Matrix({ { 0.0981273218582809 + -0.10414707425524576i, -0.08236372234886302 + 0.04405826404066728i, 0.030536416129345118 + 0.07266366876127497i, -0.04686934782700183 + 0.042945405852182074i }, { -0.1493113707205755 + -0.06398281735011484i, -0.08910426248449092 + -0.04932435561575596i, -0.10877458756625889 + 0.10444028094314611i, 0.0417877853568395 + -0.0445777005942543i }, { 0.07766439362368172 + -0.07152348237687847i, 0.17934979819568528 + -0.008563600827167431i, 0.030792092582968375 + -0.021659465778670544i, 0.09043930897739816 + 0.0677661781113306i }, { -0.09781095287436486 + -0.08326086419577945i, 0.11965648931972418 + -0.04361858799092029i, 0.0957322022445136 + 0.020693047908163963i, -0.005900111067492145 + 0.21168118341346726i } }), Matrix({ { 0.07084518835452763 + -0.141655070212668i, -0.06312500392384336 + -0.04447664645464647i, 0.0259988550652283 + 0.14245833672771666i, -0.028575173281983335 + -0.007194848941116253i }, { -0.05848835796027857 + -0.00019715487978110209i, -0.017256030268295 + 0.08551278545262855i, -0.13339074699425546 + -0.0014210812331867757i, -0.0016381707277576666 + 0.026136591363899855i }, { -0.03332494927748736 + -0.09291065387222057i, -0.11780925492186217 + -0.0100595378334943i, 0.17000138084605612 + -0.09879111251608419i, 0.19371432142744277 + -0.04419479357439076i }, { 0.06903236789887963 + -0.027886264804089303i, -0.14326772781845315 + -0.09835807036309469i, -0.049995075913490034 + 0.0881802306644336i, 0.12298997140642605 + 0.0638432532620892i } }), Matrix({ { -0.12207251588580276 + 0.0751424448467721i, 0.007054070440450649 + 0.21720169833059522i, 0.07269605996940888 + 0.10944796482954058i, 0.13281614734364305 + -0.0039968095141838375i }, { 0.05368651343413837 + 0.0013154702619847093i, -0.01364850967545953 + 0.012981694612069439i, -0.1216711517826051 + -0.022360748411063537i, -0.04530935162610647 + -0.05179770121308494i }, { -0.10768359434758361 + -0.16827340893099266i, 0.029016983653109802 + -0.024512506916418153i, -0.007344159912686911 + -0.056998542070594925i, -0.06782896194778673 + 0.0699054126603923i }, { 0.10954682684416538 + -0.22123686475538948i, 0.00831587834135651 + -0.02337751011875418i, -0.04710212834704161 + -0.09636638096785771i, 0.05697910175284618 + -0.06459550223959923i } }), Matrix({ { 0.018739229788491022 + 0.09693793017119953i, -0.12001039914547526 + -0.03724136263584558i, 0.06181879700482518 + 0.08309981216674601i, 0.03773237981943471 + 0.1217429587332629i }, { 0.05929031413576986 + 0.02505120690111255i, 0.03954954499875218 + -0.04013989598459088i, -0.129726013540465 + -0.15363944075769073i, -0.0611224237570507 + -0.07968115366329016i }, { 0.07772609697409348 + 0.008200694472056996i, -0.04966663193222377 + 0.0159444457339371i, -0.06608623727721469 + 0.014154138665643938i, 0.12054437259718451 + 0.04473799265971153i }, { 0.04114801740675567 + -0.054565188034486435i, 0.06065421836669682 + -0.09972049606361105i, 0.07629066652792789 + 0.02130796235692347i, 0.04479999451378644 + -0.01980750223772888i } }), Matrix({ { 0.0016282217385584104 + -0.11667746983289276i, 0.0892446402001419 + 0.17582270475796205i, -0.07494813827149892 + -0.06147789111718407i, 0.15958097322445194 + 0.008702111185821612i }, { 0.00253743866466036 + 0.03194738530100975i, -0.09672850516128698 + 0.05245300435361818i, -0.022350347915605157 + -0.07688846757588957i, 0.014235016254614622 + 0.11864259495630866i }, { -0.13466904270901237 + 0.10625072885646421i, -0.09030069896473217 + -0.07423760803089063i, -0.05986691572946933 + 0.013642450839378267i, 0.12635456636547657 + -0.10144417769492418i }, { 0.02083436741397239 + -0.02086943004902811i, 0.08451836385556243 + 0.050999676794685755i, -0.13750338952541985 + -0.2466501200705594i, -0.10634406766512748 + -0.04725841425856512i } }), Matrix({ { -0.1356713618198 + -0.10351999246876206i, 0.0875064887734637 + 0.04208234140289164i, -0.0036952359574850906 + -0.034837633067274575i, 0.01876708828134339 + 0.062105491463019635i }, { -0.08620495469415147 + 0.06161312083763539i, 0.032379455114459645 + 0.14079454246131579i, 0.08763599475671977 + -0.0403252353854024i, 0.07731451450514001 + -0.06088197158894202i }, { 0.06884751910568189 + 0.1732546175574957i, -0.054054330226392444 + 0.038222637473610786i, 0.0740408999412919 + -0.024648791955951547i, 0.04299276177379548 + 0.16692881339322937i }, { 0.028405156819273428 + 0.08508875245285187i, -0.026674927643945273 + -0.04835731901221587i, 0.04602174883445453 + 0.04864144672694059i, 0.06892477866221886 + -0.06831235715006054i } }), Matrix({ { -0.12065862330369614 + 0.12786470699221275i, -0.13054218531280656 + -0.12502208874527937i, 0.133071196276391 + -0.0808441553843157i, 0.025355827983801198 + 0.008401674014885726i }, { 0.041141110413093936 + -0.07403515135706257i, -0.085965857192174 + 0.013472945139704456i, -0.08878436304718035 + 0.17956727364213912i, -0.005996054749149947 + 0.030390405923374938i }, { 0.059544170431784185 + 0.01252372296179108i, 0.11660608215520474 + -0.020075829293376292i, 0.11572107865600499 + 0.057203205736903295i, 0.10625707864839712 + 0.05475523436578524i }, { 0.0375872718635591 + 0.0308150253752511i, 0.016404293293665783 + 0.07097410808680997i, -0.08638150692989305 + -0.047893699592242774i, 0.1498934759090378 + 0.05731166183708909i } }), Matrix({ { 0.20826583051330244 + 0.04621111869867104i, 0.048263582837684144 + -0.05199227985379276i, 0.10429131449126054 + 0.20173819084524702i, 0.05564406662649549 + -0.08177210569291604i }, { 0.07128736672933698 + -0.0929111991766609i, 0.16959737237767805 + 0.013205130549382047i, -0.02739068513897686 + 0.006134294912820415i, 0.035238953070555946 + 0.16379657644004966i }, { -0.038107935601901295 + 0.005717036757998432i, 0.07901254435886657 + -0.01686433786114963i, -0.02722437205725081 + -0.06008998025015542i, 0.01339536943527975 + -0.12008167517576798i }, { -0.1555632048944927 + 0.021273087956671956i, 0.12381394179995033 + -0.023518597124653377i, -0.05590309757055821 + 0.13076400452595668i, -0.004537660078769488 + 0.146530200011248i } }), Matrix({ { 0.035875509580695845 + -0.04744313310535964i, -0.01691709188007724 + 0.23364416249440428i, -0.12294090199700528 + 0.03984357675631819i, 0.08808444757680575 + 0.02537738054684454i }, { 0.07552951827619571 + -0.022830315942133434i, 0.00996507246217893 + 0.03644592954411902i, 0.08969224438282977 + 0.0739112118995266i, 0.08136446275438639 + -0.0747471780990329i }, { 0.043173646186747565 + -0.08514130693449454i, 0.08679124870620483 + -0.08490965448577499i, 0.04951568029172192 + -0.027138743291885148i, 0.06866590163467326 + 0.12802729207105573i }, { -0.036768204196918654 + -0.007768153197856488i, -0.24511720522066416 + -0.03304463145611409i, -0.07266056068578118 + 0.06751699088128418i, -0.1578505052286999 + -0.112337820487264i } }), Matrix({ { 0.05494472419354025 + -0.055754521612103224i, 0.018675661934390877 + 0.028731997068559497i, -0.047647203247044835 + 0.07664704578042199i, -0.13116958612461085 + 0.02881579664789138i }, { 0.057680447903130955 + 0.02528083249583149i, 0.02017331260505534 + 0.07907647418262742i, 0.016953056128476002 + 0.11177130950818095i, 0.014021884339333929 + 0.089745457385667i }, { -0.0018464386290784102 + 0.02669039030268348i, 0.032740313167663196 + -0.1294390538953429i, 0.11569348554870329 + -0.040607096050984295i, -0.030413986212836298 + 0.06982545272871864i }, { 0.16030257722391397 + 0.04066826955548272i, 0.01850794807983628 + 0.019270585097703692i, 0.06415665798072986 + -0.027207980075897607i, -0.1170760114185257 + 0.06772802164204544i } }), Matrix({ { 0.06813867606393958 + -0.03212686056266894i, -0.037819022702668154 + 0.022439505679566894i, -0.11953141305767381 + 0.08185254054429808i, 0.1239375157184015 + -0.03647780729952876i }, { 0.044867720686006 + 0.06247666723173225i, 0.09634162995152011 + 0.04078724168296816i, -0.09875632376371113 + 0.005252067780005189i, -0.08006798900435222 + -0.025900379335554252i }, { 0.11090336337117503 + -0.01406864442812515i, 0.03784084304333995 + -0.15453394032633777i, -0.1587336132959252 + -0.19360536614021456i, -0.002943814957895711 + 0.21918385604958748i }, { -0.11319496407078242 + 0.08746944507015225i, -0.0011729562993129789 + -0.06994483950809316i, 0.15966085550399498 + 0.10394126837339648i, 0.13218960945588046 + -0.031783407613950286i } }), Matrix({ { -0.10586364173602829 + 0.12162531728241982i, 0.08398351318841979 + -0.053298958181533115i, 0.02789208559617749 + -0.013795286926199204i, 0.04581585825479437 + -0.038306279654056155i }, { -0.09241157971577328 + 0.14022266000763461i, 0.059225280417900074 + -0.185953432654823i, 0.007341576264136677 + -0.02671608028936168i, 0.00551073316577103 + 0.08171069072334362i }, { -0.03159997484749868 + -0.11655489914709073i, -0.09211284653143377 + 0.130214240648159i, -0.01220433025706262 + 0.019873020522347126i, 0.1703521626572937 + -0.046808726656733475i }, { -0.04119605573796232 + 0.18651300886610597i, -0.06782104152772685 + 0.04397944397210773i, -0.053919693637461304 + -0.03856887075650841i, 0.19101087266713684 + 0.05166296782783483i } }), Matrix({ { 0.24858844842966843 + 0.036542340225607005i, 0.08512457194526596 + -0.0868414243703377i, 0.03355525978077629 + 0.23657188102603854i, 0.012443820458515005 + -0.05279568255651967i }, { -0.1765874936626561 + 0.10134021675641355i, 0.08903557098518826 + -0.16057685698197466i, -0.1624188233687476 + 0.11437788725795446i, 0.04326611572223871 + -0.19167084821810493i }, { -0.02768062809413541 + 0.05434045503829883i, 0.11302254740962202 + -0.020137256225837234i, -0.18288617740785382 + -0.10704196364131525i, 0.09480947712200574 + -0.11095190451841953i }, { 0.002700409668472669 + 0.07680500632620928i, -0.04571631542843512 + -0.0244113985006788i, -0.060339848955167585 + 0.06075967472304513i, -0.03904594846931409 + 0.10313942602693811i } }), Matrix({ { 0.002703772290641098 + -0.047417221945984196i, -0.08913470521346405 + 0.047513440780337535i, -0.13295149698666867 + -0.04447839740173986i, -0.009115687439784708 + -0.008489321448293133i }, { -0.08451405109440326 + -0.019943727482641803i, -0.07586875882179353 + -0.215637574386899i, 0.07705153661116909 + 0.011893668478305915i, -0.06947888823603866 + 0.0581120230262706i }, { 0.001152211524282559 + -0.16193281894102932i, -0.0844888066298009 + -0.03544307983854786i, 0.01749578731510847 + 0.09460375621548868i, -0.023712847066353494 + -0.12713583780282797i }, { 0.038965097241480055 + -0.005964834946197625i, -0.06993086762729575 + 0.14111681851474478i, -0.017130893424376747 + -0.06801151629970369i, -0.04820022880186953 + -0.011958786574192427i } }), Matrix({ { 0.03723376500414522 + 0.03674614001528958i, 0.18600162058367384 + -0.06349111697194518i, 0.11053963843052299 + -0.10475275843068063i, -0.018246482632428358 + -0.05313709758630755i }, { 0.049591493530121995 + 0.023141995229671277i, 0.13334648432587273 + -0.050653683890666296i, 0.09204365917460232 + 0.01957211101558924i, -0.07756359834041147 + 0.16184980843609556i }, { -0.020427207191057995 + 0.20777726148900047i, 0.052818174571759226 + 0.05650929984409058i, 0.03550236345062436 + 0.03931319654849467i, 0.02449773114098996 + 0.06088347970822726i }, { -0.024842922455111587 + -0.000253566610519067i, -0.008672264591614263 + -0.12441795576692864i, 0.05214006392739121 + -0.05553885478877384i, -0.11314914719280725 + 0.02870215609102676i } }) }, { QubitIndex{ 5 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.14668422444773577 + -0.028365252052464564i, -0.027370311579575514 + 0.22661651202396443i }, { -0.5577330859301449 + -0.28184313938578726i, -0.4243862961973954 + -0.06667409283507172i } }), Matrix({ { -0.20852521257024312 + -0.21994957167327317i, -0.07242675349229533 + -0.08660990095126686i }, { -0.13132313161938824 + -0.35236879646296526i, 0.34844270049354387 + 0.3111684869451879i } }), Matrix({ { -0.07971598925233274 + -0.14432190951280563i, 0.43313897003189344 + -0.3313149795959114i }, { -0.15884700780745747 + 0.22602205533566372i, 0.052105440290457605 + -0.28970023734140243i } }), Matrix({ { 0.12409046324189668 + 0.2975958160205613i, 0.12778569625397848 + -0.2905451665061941i }, { -0.16756627418356895 + 0.34404262165991634i, 0.18705434397756787 + 0.11227828851043578i } }) }, { QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.10902235920972947 + 0.16163121829444851i, -0.1108267245766746 + 0.2393338414310714i }, { -0.2473811579654302 + 0.11158777996932423i, -0.050341945067488326 + 0.3081155806354139i } }), Matrix({ { -0.24428054975457875 + -0.17538609546936204i, -0.20423499519609817 + -0.12986458128614195i }, { 0.5874542448238429 + 0.15153171846475594i, -0.1309071435238792 + 0.22108013120429207i } }), Matrix({ { -0.07423111749248097 + -0.14147286226810274i, -0.24269725489461486 + -0.15097335915613147i }, { 0.2603563532203063 + -0.16162775836477117i, 0.2544910760964715 + -0.04508734525499498i } }), Matrix({ { 0.32792469007340413 + -0.43099973502474587i, -0.5397668427993774 + 0.13926585240442427i }, { -0.09255482410143573 + 0.09245010362935988i, -0.4490145130054493 + -0.21800604414442706i } }) }, { QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.31935288247054294 + 0.504708700692361i, -0.19813547024467199 + -0.07269349888549478i }, { -0.10003589362782479 + 0.0008274909587750109i, -0.031953843024710105 + 0.15145075512796866i } }), Matrix({ { 0.1369318740708526 + 0.02810739079925717i, 0.13919623335771186 + -0.38178143340440074i }, { -0.07493097829949988 + -0.16288736485889133i, -0.07903140369440947 + -0.349620586352112i } }), Matrix({ { 0.04971513280354113 + -0.31970571874282494i, 0.24876320193848103 + -0.11245638523253769i }, { -0.08840525878082578 + 0.5214574303278166i, 0.021698103572326807 + 0.27341265043797025i } }), Matrix({ { 0.06178800009012412 + 0.09859886409479975i, -0.11861221136508013 + -0.18359836272371566i }, { 0.004490452482899365 + -0.42849895085534434i, -0.24922402497859023 + 0.6150136221668209i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.19722744066045236 + 0.4731943480701708i, -0.21077466294213232 + -0.26094577054803103i }, { 0.17642396925121123 + -0.04126195407707602i, -0.308664526066934 + -0.17553554212693495i } }), Matrix({ { 0.2515034751887654 + 0.003874026040996389i, 0.008578263336274601 + 0.3251277495196151i }, { -0.2284361193275893 + 0.5084194782358223i, -0.07359133103048654 + 0.26454857059315123i } }), Matrix({ { 0.23484121661207125 + 0.13326805974482633i, 0.12933195627096378 + 0.4465243375162917i }, { 0.29006262975263114 + 0.0533649797863254i, -0.25537477159369115 + -0.41328346349075634i } }), Matrix({ { 0.2393485185945855 + 0.10344221331067441i, -0.07392611844137789 + -0.16302725661793033i }, { 0.25270905172062513 + 0.196655166642956i, 0.2678588834287472 + 0.15585245230336672i } }) }, { QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.09408018559708185 + -0.15481737656372963i, -0.02992532541389822 + -0.0901954154513214i, -0.03379287621628068 + -0.17774356452551354i, 0.07920951897788654 + 0.052385282469236044i }, { 0.0555520446327928 + 0.027542805432440594i, -0.06749895371533551 + -0.0313146832559342i, -0.0426175107879518 + 0.07400404484421985i, -0.07739581391001812 + -0.08560393419944233i }, { 0.04326358196429886 + 0.038019274149715045i, 0.04480754742553842 + 0.03265409684297804i, -0.03574353628262077 + -0.17275766043803537i, 0.17774425558914272 + -0.1091451367902531i }, { -0.022465426406311474 + -0.045837247949705145i, -0.15096114856169043 + -0.06603848578014317i, -0.07512315398466887 + 0.019149584588495167i, -0.005474984797423172 + 0.004613636538455731i } }), Matrix({ { -0.01348168225564393 + 0.18213984770283942i, 0.036468576009326785 + -0.06187607262583657i, -0.12251776032493032 + -0.05536541268125984i, -0.022749624349886248 + -0.031752774292471315i }, { -0.07644425908580105 + -0.017119827870656124i, -0.047007188001234 + 0.012290505799982884i, -0.25362665141439 + 0.20381659569814078i, 0.039104015754296485 + -0.08262424432618344i }, { 0.009099348812736812 + 0.16709028647928986i, 0.006111179044410501 + 0.13480732649644503i, 0.008618941068985479 + -0.012056871612974916i, 0.07606560071818998 + -0.20651924926874227i }, { 0.012596738263555092 + 0.15809495749077107i, -0.021853105209462025 + -0.02849943184921514i, -0.0739081114385184 + 0.07733224000673913i, -0.1208776441814797 + 0.01873063483675404i } }), Matrix({ { 0.011244281677369064 + -1.8917095678074423e-05i, 0.04454654433828236 + 0.03122064932148263i, 0.08943049132906017 + 0.004505240074939902i, -0.07858767589225331 + -0.1478246165930565i }, { -0.18230601551276576 + 0.029189867285328647i, -0.003664979347367447 + 0.045435610062857845i, -0.1376836896881202 + 0.10379911537357045i, 0.14300842015782378 + -0.13406913091636175i }, { 0.01640508652068904 + 0.027458878701752183i, 0.123662317337236 + -0.11553357103376762i, 0.05883256041859252 + 0.1171407874725479i, -0.03949920808677163 + 0.0394676833780335i }, { -0.029294545816143353 + -0.21495143235762051i, -0.002776040746302992 + 0.09153743776385993i, 0.027073793965176472 + 0.009939205152512285i, -0.2055272957526485 + -0.08218178176701764i } }), Matrix({ { 0.15619121641910746 + 0.0032666199505393605i, 0.19091045068546053 + -0.041112542028968475i, 0.04450465765102902 + -0.06582301161031576i, 0.01824128464603556 + -0.05033943001231966i }, { -0.1090155060556749 + -0.004817393231957402i, 0.03689829945142036 + 0.1063025673842005i, 0.03538989203424177 + 0.0718278104936164i, -0.020476722557978718 + 0.056608175908483944i }, { 0.009254919496236217 + 0.2023217424748957i, 0.01711949997963125 + -0.20037241766030572i, -0.022635295808572327 + 0.04821870451374604i, 0.1063123935509749 + 0.11034690830966587i }, { -0.027170039999104917 + -0.0522264186839685i, -0.11981634251504346 + -0.1153220952548928i, -0.005323650480868002 + -0.0323592023746721i, 0.040856437206701506 + -0.14403526943226982i } }), Matrix({ { -0.018804380330740136 + -0.009687452014644684i, 0.053999720609337554 + 0.10968244171379411i, 0.0011949178019176859 + 0.07280022022513982i, -0.13037993304896844 + 0.018535105765762568i }, { -0.0975519994835174 + -0.09174523702855457i, -0.19387364314912764 + -0.07002542153153714i, -0.0593982736242181 + 0.11959672786182242i, 0.05957902311331911 + -0.011882775213691686i }, { 0.07733554586898345 + 0.04935270439753756i, 0.09743188648872039 + -0.0025256013749178565i, 0.011744294553678017 + 0.0925878436711391i, 0.1777963078177209 + 0.12012608272460741i }, { 0.025767734198911707 + -0.16223830888626678i, 0.11754423815856557 + 0.009754600339475573i, -0.07180744516343492 + 0.11698422767207123i, 0.1241914500364071 + -0.03615710246704374i } }), Matrix({ { 0.033750222250052954 + -0.08008197549083575i, 0.03241344957209332 + 0.11608244338957313i, 0.01264016319478913 + -0.0636646499206953i, -0.04349231297989902 + 0.12090932709515646i }, { 0.0008829660934227024 + -0.026011722226112723i, -0.06775235061180558 + 0.2048925080986238i, -0.018888960819160864 + -0.1152513684043395i, 0.1629770666043709 + 0.03166359916820332i }, { -0.021081112381843847 + 0.015291679327364178i, -0.0410540272055155 + 0.06673862913523226i, 0.05857791743167009 + 0.07050316198741398i, 0.043938478208142784 + 0.022276043596907557i }, { -0.14932659340975232 + -0.11246563404323033i, 0.023926640967271033 + 0.01475678813589933i, -0.017705721843217052 + -0.014641380294367852i, 0.017679008196287496 + 0.1186981855624244i } }), Matrix({ { -0.0898708602191743 + 0.0718451474909588i, 0.017362427268051546 + -0.06376832148738894i, -0.10059421394715479 + -0.04751344644455251i, -0.17576296140584197 + 0.07943919371852633i }, { 0.04982739159027454 + 0.020124607754702175i, -0.009329631897846536 + -0.04050506160199224i, -0.1317779178129998 + 0.0843979168155461i, -0.05245082818428621 + -0.08993151664916516i }, { -0.003511411548402159 + -0.03785301898592155i, -0.10607898052228332 + 0.0008052037159412694i, -0.009903277500816612 + 0.031211789203501168i, -0.08908359527302413 + 0.012611245941430675i }, { 0.08483071145225786 + -0.08125652123437821i, 0.15090571959721155 + -0.12075399814914656i, -0.13778826154149407 + 0.05850228304648931i, -0.006903910603488742 + 0.03716870009176388i } }), Matrix({ { -0.0890174341508929 + 0.042446812062630096i, 0.05336530560712657 + 0.017198739011631336i, -0.09660774447876995 + 0.09384017201663561i, 0.011594049325267745 + -0.0636788642705045i }, { 0.02642947031094082 + 0.06422557267976035i, 0.06519800943609215 + -0.06891619645553665i, 0.027105342556392173 + -0.01567559694922752i, -0.003900921274267085 + -0.03543236382230686i }, { 0.06522833063307301 + -0.08581579603832425i, 0.10123127433819434 + 0.20720053732429797i, -0.14818854726716957 + -0.06015415299631064i, -0.08030866446792084 + 0.029334195156514482i }, { 0.08879953873650206 + 0.034539195226355825i, -0.10302483534493534 + -0.11904465064481624i, 0.034010534834471626 + -0.11113169467664485i, -0.08860576006879603 + -0.04946454400222852i } }), Matrix({ { -0.09798058420504983 + 0.05407535542544852i, -0.005225203744574252 + 0.06846312473757096i, 0.096081272985644 + -0.09216195744125047i, 0.10194772414960161 + 0.06724730045212522i }, { -0.10573242160330482 + -0.0012370096035568994i, -0.03177728239941077 + -0.040773786509276044i, 0.17779241346635258 + -0.08099126576320723i, 0.011434386510871301 + -0.09159660842908704i }, { -0.10157386129805256 + -0.026888824954360818i, 0.13438575153109394 + -0.1243591107598222i, -0.0002980388581479722 + -0.052098417239061i, -0.06279400071669433 + -0.028731019664181612i }, { -0.19208047164969916 + 0.07232208293105423i, -0.040420767166764834 + -0.04443621363092655i, -0.14631316162643984 + -0.00041207739209811874i, -0.0653047248791905 + 0.0916136697863247i } }), Matrix({ { -0.07787400961285246 + -0.019529896096263665i, 0.02446227019133385 + 0.16700850994123778i, -0.007334853244335568 + -0.08477230927576233i, 0.08462373071299349 + -0.0305413240548748i }, { 0.07187359890503787 + 0.08055819523151218i, -0.04579058076661275 + 0.0028939633109256926i, -0.2347054011098151 + 0.0699400720839951i, -0.01956693675055139 + 0.04938118585543837i }, { 0.18742660058067986 + 0.04259602140991125i, -0.07593982739776492 + -0.007652748929253724i, -0.12028345819067035 + 0.04659934983382119i, 0.0422322997497068 + 0.023223500407828675i }, { 0.0639862488219906 + 0.21293614779951897i, 0.06918798571939783 + -0.12263491477610342i, 0.11081388184692757 + -0.026540156217085442i, 0.09579556708341148 + -0.05270135149136718i } }), Matrix({ { 0.010110599575596171 + -0.17199403456691803i, 0.19234717295605883 + -0.1042674564657633i, -0.099943403393143 + -0.0065700459719718225i, 0.06761269378917859 + -0.1196490347698367i }, { -0.13309603318133287 + 0.138146117761311i, -0.0038056914862469367 + 0.12221675282333731i, -0.028863434026877494 + -0.08735086747507048i, -0.05021878032139792 + 0.12973372855351298i }, { 0.014017788186485988 + -0.043954591092315566i, -0.08305005363965003 + -0.05938303519227624i, -0.006946724143668025 + 0.12086915387484079i, 0.2251222426579863 + 0.057520482416954816i }, { -0.02458296878032517 + -0.04329774518301727i, -0.07976725341807596 + -0.10945107070854397i, 0.03350871345195725 + -0.08375548907138014i, -0.03867269975731879 + -0.020195134310573418i } }), Matrix({ { 0.047461095079659496 + -0.029636596670922558i, -0.08296698724118179 + 0.07742011174033814i, 0.02390645840084735 + -0.07243180511338984i, -0.12071329124977247 + -0.011753035134633025i }, { 0.017877943386524035 + 0.06673072176461327i, 0.09877299584143182 + 0.04937009471978915i, 0.0074578813605411486 + -0.07712668451416979i, -0.17369601829344355 + -0.19886687620032412i }, { 0.09076683438569075 + -0.1791847521491332i, 0.08047334744070105 + 0.14106091247972571i, 0.14257684960825198 + 0.012106553489730271i, -0.06922829202512476 + -0.02382611924838896i }, { -0.05242035192070554 + -0.05048236420967878i, -0.09604702529170984 + 0.008489057388180647i, -0.0034873520339260776 + -0.05042970003454465i, -0.012341266136391426 + -0.01885819009691427i } }), Matrix({ { -0.126916212905274 + -0.05122768419112556i, 0.07204243808798327 + -0.04010740427159356i, 0.06407897320187383 + -0.03954881968024622i, 0.13464565981917362 + -0.07509929998601195i }, { -0.0009840393489351834 + 0.06564237451383509i, 0.009177507589249434 + -0.03784665335708228i, -0.038763695001525836 + 0.21554370457759178i, -0.07376278765127879 + -0.04586056512019237i }, { 0.11623311050547967 + 0.11245391577718353i, 0.03898565149431389 + 0.09959341712437209i, -0.03999518056880037 + -0.04315559959235922i, -0.09910618617040323 + 0.02061902928689877i }, { 0.033983520402132476 + 0.04647334073040522i, -0.0028889746455370746 + -0.021918945809442893i, -0.047690219446587905 + -0.04173456861800795i, -0.12300079012953011 + -0.09995554226413057i } }), Matrix({ { -0.1288958671600253 + 0.050985228860503516i, 0.01060977976616388 + -0.19015569555745732i, -0.03761677726970194 + -0.15229309235281355i, 0.01958928997558064 + -0.08630699428065886i }, { -0.003147568443093297 + -0.03058975224072669i, 0.054311660878191684 + 0.014398612676740625i, -0.15001624900544844 + 0.10953998015879039i, 0.030544698178664124 + 0.009039822235926958i }, { 0.157799001221182 + 0.11430841777202468i, 0.18963861378748675 + -0.015569541763401631i, 0.015761881219406273 + -0.10172150397852918i, -0.03467608604920507 + -0.01000272091823948i }, { 0.038556195035370944 + -0.0675059403139374i, 0.06496887967648514 + 0.0776260891568324i, 0.04640771075914031 + 0.20666433578441948i, 0.06743313515871947 + -0.054541322343582326i } }), Matrix({ { -0.08928745030223809 + 0.018620131875399144i, -0.00852461352403273 + 0.07407962867506422i, -0.11639195856511568 + 0.0768367732000667i, 0.07921032197785384 + -0.08036105175243421i }, { -0.0581434468482069 + 0.16298870849731925i, 0.016702169088939043 + -0.06812084070754433i, 0.031770050737100666 + -0.07335917835225615i, 0.1004939019769818 + 0.12094235874344582i }, { 0.12236396913631255 + 0.09779992290324731i, -0.04906732141890162 + 0.033550244057143006i, 0.030418489249665625 + 0.048803554993947396i, -0.05977542998097178 + 0.09835327097871152i }, { 0.015905828655824145 + -0.03344877671707219i, -0.023353031649952033 + -0.26146703899925305i, 0.13195409781481118 + 0.0645727049903073i, 0.023922360152304846 + -0.004030638324866024i } }), Matrix({ { 0.03818599648928065 + -0.12231826193780607i, -0.0156278777523751 + 0.08629408710025552i, -0.1645456373440268 + -0.00785091089234747i, 0.06244620039529038 + -0.20058975203884044i }, { -0.04530191295838924 + -0.033252871842137544i, -0.08715232368003735 + 0.09420737538052586i, 0.05796459324389203 + -0.026987021601647163i, -0.0011374532801240974 + 0.07517127668862061i }, { -0.09111604628822705 + 0.13250754469993242i, -0.06498514526732084 + -0.0014219883505333399i, 0.01971933228700352 + -0.002553584445832037i, 0.037926431719988475 + -0.08591239686643522i }, { -0.06682478354622805 + 0.02574914992577888i, -0.031339273412199845 + -0.045052582769269725i, -0.08757240609617346 + 0.010495178481337459i, -0.047583711421923226 + 0.1324019395738459i } }) }, { QubitIndex{ 1 }, QubitIndex{ 0 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_8_2_100_0_0) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.4428147524330631 + 1.3552527156068805e-20i, 0.0065721145037468225 + 0.07643671872272312i }, { 0.0065721145037468225 + -0.07643671872272312i, 0.5571852475669363 + 6.945670167485263e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4428147524330631, 1.0e-7), DoubleNear(0.5571852475669363, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.5550969620165758 + 5.421010862427522e-20i, 0.07584977172254284 + 0.0030513108674548707i }, { 0.07584977172254284 + -0.0030513108674548716i, 0.4449030379834237 + 2.879912020664621e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5550969620165758, 1.0e-7), DoubleNear(0.4449030379834237, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.9999999999999996 + 8.300922883092143e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999996, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.5418931730184378 + 3.049318610115481e-20i, 0.060291197262758056 + 0.01258412168679942i }, { 0.060291197262758056 + -0.012584121686799416i, 0.4581068269815618 + 5.251604272976662e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5418931730184378, 1.0e-7), DoubleNear(0.4581068269815618, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.47249078371798425 + -1.6940658945086007e-21i, -0.09345000440511893 + -0.0481947048778382i }, { -0.09345000440511893 + 0.0481947048778382i, 0.5275092162820152 + 8.470329472543003e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.47249078371798425, 1.0e-7), DoubleNear(0.5275092162820152, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.4296194149160215 + 6.776263578034403e-21i, -0.0119875974232546 + -0.05406194667004125i }, { -0.011987597423254602 + 0.05406194667004125i, 0.570380585083978 + 7.623296525288703e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4296194149160215, 1.0e-7), DoubleNear(0.570380585083978, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.44726399852104165 + -1.0164395367051604e-20i, -0.2456717945882317 + -0.1574218702889204i }, { -0.2456717945882317 + 0.1574218702889204i, 0.5527360014789579 + 9.317362419797304e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.44726399852104165, 1.0e-7), DoubleNear(0.5527360014789579, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.9999999999999996 + 8.300922883092143e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.9999999999999996, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.22424851031038107 + 0.0i, -0.009621658989024971 + 0.055198351508114724i, 0.027554420724782088 + 0.0005482600302032547i, -0.010712704883158425 + 0.06214769502930803i }, { -0.009621658989024971 + -0.055198351508114724i, 0.3308484517061947 + 5.421010862427522e-20i, 0.006615365125579027 + 0.025569387744086257i, 0.04829535099776075 + 0.0025030508372516167i }, { 0.02755442072478209 + -0.0005482600302032546i, 0.006615365125579026 + -0.025569387744086257i, 0.21856624212268205 + 1.3552527156068805e-20i, 0.016193773492771794 + 0.021238367214608384i }, { -0.010712704883158425 + -0.06214769502930803i, 0.04829535099776075 + -0.002503050837251617i, 0.016193773492771794 + -0.021238367214608384i, 0.22633679586074165 + 1.5246593050577406e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.22424851031038107, 1.0e-7), DoubleNear(0.3308484517061947, 1.0e-7), DoubleNear(0.21856624212268205, 1.0e-7), DoubleNear(0.22633679586074165, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.4428147524330631 + 1.3552527156068805e-20i, 0.0065721145037468225 + 0.07643671872272312i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0065721145037468225 + -0.07643671872272312i, 0.5571852475669363 + 6.945670167485263e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4428147524330631, 1.0e-7), DoubleNear(0.5571852475669363, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.23995829125532664 + 0.0i, 0.0035613839818758627 + 0.04142053604377427i, 0.0266978315898012 + 0.005572434729327629i, -0.0005656483177675745 + 0.004691165575284382i }, { 0.003561383981875862 + -0.04142053604377427i, 0.301934881763111 + 3.049318610115481e-20i, 0.0013581296217252408 + -0.004525756997974924i, 0.03359336567295686 + 0.007011686957471791i }, { 0.026697831589801196 + -0.005572434729327628i, 0.0013581296217252408 + 0.004525756997974924i, 0.20285646117773648 + 1.3552527156068805e-20i, 0.003010730521870961 + 0.035016182678948835i }, { -0.0005656483177675742 + -0.004691165575284382i, 0.03359336567295686 + -0.007011686957471789i, 0.00301073052187096 + -0.035016182678948835i, 0.2552503658038253 + 3.8963515573697816e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.23995829125532664, 1.0e-7), DoubleNear(0.301934881763111, 1.0e-7), DoubleNear(0.20285646117773648, 1.0e-7), DoubleNear(0.2552503658038253, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.2092258894189833 + -1.3552527156068805e-20i, 0.0031052635325596696 + 0.03611564513413058i, -0.041381040565521415 + -0.021341326309064476i, 0.003069680971345885 + -0.007459752820282753i }, { 0.003105263532559669 + -0.03611564513413058i, 0.26326489429900096 + 1.1858461261560205e-20i, -0.004298009229998059 + 0.006826270582419877i, -0.05206896383959751 + -0.026853378568773727i }, { -0.041381040565521415 + 0.021341326309064476i, -0.00429800922999806 + -0.006826270582419876i, 0.23358886301407983 + 2.710505431213761e-20i, 0.0034668509711871538 + 0.04032107358859252i }, { 0.0030696809713458848 + 0.007459752820282753i, -0.05206896383959751 + 0.026853378568773727i, 0.003466850971187153 + -0.04032107358859253i, 0.29392035326793536 + 5.759824041329242e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2092258894189833, 1.0e-7), DoubleNear(0.26326489429900096, 1.0e-7), DoubleNear(0.23358886301407983, 1.0e-7), DoubleNear(0.29392035326793536, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.19024181485647557 + 1.3552527156068805e-20i, 0.00282350798786081 + 0.03283869837575683i, -0.005308284985245714 + -0.023939427530743792i, 0.004053533948330353 + -0.0012715939162135184i }, { 0.0028235079878608095 + -0.03283869837575683i, 0.2393776000595459 + -6.776263578034403e-21i, -0.004211101674111252 + 0.0005609913085915872i, -0.006679312438008886 + -0.030122519139297463i }, { -0.005308284985245715 + 0.023939427530743795i, -0.004211101674111252 + -0.0005609913085915872i, 0.25257293757658755 + 0.0i, 0.0037486065158860125 + 0.04359802034696629i }, { 0.004053533948330353 + 0.0012715939162135184i, -0.006679312438008887 + 0.03012251913929746i, 0.0037486065158860125 + -0.04359802034696629i, 0.31780764750739043 + 7.623296525288703e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.19024181485647557, 1.0e-7), DoubleNear(0.2393776000595459, 1.0e-7), DoubleNear(0.25257293757658755, 1.0e-7), DoubleNear(0.31780764750739043, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.19805509677731709 + -1.3552527156068805e-20i, 0.0029394702116839365 + 0.03418739244975333i, -0.10878709490037422 + -0.0697087265195381i, 0.010418228055704387 + -0.019812940417980054i }, { 0.0029394702116839365 + -0.03418739244975333i, 0.24920890174372456 + 3.3881317890172014e-21i, -0.013647394384454045 + 0.017743751304114524i, -0.1368846996878575 + -0.0877131437693823i }, { -0.10878709490037422 + 0.06970872651953809i, -0.013647394384454045 + -0.017743751304114524i, 0.24475965565574603 + 2.710505431213761e-20i, 0.003632644292062886 + 0.04224932627296979i }, { 0.010418228055704389 + 0.019812940417980054i, -0.1368846996878575 + 0.0877131437693823i, 0.0036326442920628856 + -0.04224932627296979i, 0.30797634582321176 + 6.606856988583543e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.19805509677731709, 1.0e-7), DoubleNear(0.24920890174372456, 1.0e-7), DoubleNear(0.24475965565574603, 1.0e-7), DoubleNear(0.30797634582321176, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.4428147524330631 + 1.3552527156068805e-20i, 0.0065721145037468225 + 0.07643671872272312i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0065721145037468225 + -0.07643671872272312i, 0.5571852475669363 + 6.945670167485263e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.4428147524330631, 1.0e-7), DoubleNear(0.5571852475669363, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.5550969620165758 + 5.421010862427522e-20i, 0.07584977172254284 + 0.0030513108674548707i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07584977172254284 + -0.0030513108674548716i, 0.4449030379834237 + 2.879912020664621e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5550969620165758, 1.0e-7), DoubleNear(0.4449030379834237, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.3008032540800576 + 2.710505431213761e-20i, 0.04110247347145293 + 0.0016534845278307626i, 0.033467460436899105 + 0.0069854077179892695i, 0.0045346754819986955 + 0.0011384699426921566i }, { 0.04110247347145293 + -0.0016534845278307632i, 0.2410899189383801 + 3.3881317890172014e-21i, 0.004611471616519307 + 0.0007705355718527181i, 0.02682373682585895 + 0.005598713968810152i }, { 0.033467460436899105 + -0.006985407717989268i, 0.004611471616519306 + -0.0007705355718527179i, 0.2542937079365182 + 2.710505431213761e-20i, 0.03474729825108991 + 0.0013978263396241084i }, { 0.004534675481998695 + -0.0011384699426921563i, 0.02682373682585895 + -0.00559871396881015i, 0.03474729825108991 + -0.0013978263396241084i, 0.2038131190450436 + 2.541098841762901e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3008032540800576, 1.0e-7), DoubleNear(0.2410899189383801, 1.0e-7), DoubleNear(0.2542937079365182, 1.0e-7), DoubleNear(0.2038131190450436, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.2622781986226842 + -1.3552527156068805e-20i, 0.03583831808601448 + 0.001441716263130955i, -0.05187381354571717 + -0.026752734262973445i, -0.006941104474851369 + -0.003940702377224397i }, { 0.03583831808601449 + -0.001441716263130955i, 0.2102125850953001 + 1.1858461261560205e-20i, -0.007235218528346426 + -0.0033704123492143065i, -0.041576190859401764 + -0.021441970614864757i }, { -0.051873813545717164 + 0.02675273426297345i, -0.0072352185283464255 + 0.0033704123492143065i, 0.29281876339389157 + 6.776263578034403e-20i, 0.04001145363652835 + 0.0016095946043239158i }, { -0.00694110447485137 + 0.003940702377224397i, -0.041576190859401764 + 0.02144197061486476i, 0.04001145363652835 + -0.0016095946043239164i, 0.2346904528881236 + 1.6940658945086007e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2622781986226842, 1.0e-7), DoubleNear(0.2102125850953001, 1.0e-7), DoubleNear(0.29281876339389157, 1.0e-7), DoubleNear(0.2346904528881236, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.2384804320432224 + -1.3552527156068805e-20i, 0.03258653454895266 + 0.001310902389602861i, -0.006654278911526364 + -0.030009622357242048i, -0.0007442967226655422 + -0.004137164200091166i }, { 0.03258653454895266 + -0.001310902389602861i, 0.19113898287279907 + 2.0328790734103208e-20i, -0.0010742163334456676 + -0.004064008427506666i, -0.005333318511728236 + -0.024052324312799203i }, { -0.006654278911526364 + 0.03000962235724205i, -0.0010742163334456676 + 0.004064008427506666i, 0.3166165299733533 + 6.776263578034403e-20i, 0.04326323717359017 + 0.00174040847785201i }, { -0.0007442967226655422 + 0.004137164200091166i, -0.005333318511728237 + 0.024052324312799203i, 0.04326323717359018 + -0.0017404084778520105i, 0.2537640551106246 + 8.470329472543003e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2384804320432224, 1.0e-7), DoubleNear(0.19113898287279907, 1.0e-7), DoubleNear(0.3166165299733533, 1.0e-7), DoubleNear(0.2537640551106246, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.24827488679841658 + 0.0i, 0.03392487218753276 + 0.001364741499308575i, -0.13637166682908775 + -0.08738440195234722i, -0.01815380647459717 + -0.012690033942204582i }, { 0.03392487218753276 + -0.0013647414993085754i, 0.19898911172262507 + -1.0164395367051604e-20i, -0.019114492601772476 + -0.011190791908896155i, -0.109300127759144 + -0.07003746833657318i }, { -0.13637166682908775 + 0.08738440195234722i, -0.019114492601772476 + 0.011190791908896155i, 0.3068220752181592 + 5.421010862427522e-20i, 0.04192489953501007 + 0.0016865693681462957i }, { -0.01815380647459717 + 0.01269003394220458i, -0.10930012775914398 + 0.07003746833657319i, 0.04192489953501008 + -0.0016865693681462962i, 0.24591392626079864 + 3.8963515573697816e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24827488679841658, 1.0e-7), DoubleNear(0.19898911172262507, 1.0e-7), DoubleNear(0.3068220752181592, 1.0e-7), DoubleNear(0.24591392626079864, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.5550969620165758 + 5.421010862427522e-20i, 0.07584977172254284 + 0.0030513108674548707i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07584977172254284 + -0.0030513108674548716i, 0.4449030379834237 + 2.879912020664621e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5550969620165758, 1.0e-7), DoubleNear(0.4449030379834237, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.5418931730184378 + 3.049318610115481e-20i, 0.0 + 0.0i, 0.060291197262758056 + 0.01258412168679942i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.060291197262758056 + -0.012584121686799416i, 0.0 + 0.0i, 0.4581068269815618 + 5.251604272976662e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5418931730184378, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4581068269815618, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.47249078371798425 + -1.6940658945086007e-21i, 0.0 + 0.0i, -0.09345000440511893 + -0.0481947048778382i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09345000440511893 + 0.0481947048778382i, 0.0 + 0.0i, 0.5275092162820152 + 8.470329472543003e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.47249078371798425, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5275092162820152, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.4296194149160215 + 6.776263578034403e-21i, 0.0 + 0.0i, -0.0119875974232546 + -0.05406194667004125i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011987597423254602 + 0.05406194667004125i, 0.0 + 0.0i, 0.570380585083978 + 7.623296525288703e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4296194149160215, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.570380585083978, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.44726399852104165 + -1.0164395367051604e-20i, 0.0 + 0.0i, -0.2456717945882317 + -0.1574218702889204i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.2456717945882317 + 0.1574218702889204i, 0.0 + 0.0i, 0.5527360014789579 + 9.317362419797304e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.44726399852104165, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5527360014789579, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.9999999999999996 + 8.300922883092143e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.9999999999999996, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.25731071662704424 + 3.3881317890172014e-21i, 0.02990616014854959 + 0.010448179457098437i, -0.05054430255266425 + -0.026028019443583572i, 0.00038075969200261454 + 0.011233730361787448i }, { 0.02990616014854959 + -0.010448179457098434i, 0.21518006709094006 + -5.082197683525802e-21i, -0.014012148971117237 + 0.00423523807039383i, -0.04290570185245468 + -0.02216668543425463i }, { -0.05054430255266425 + 0.026028019443583572i, -0.014012148971117237 + -0.00423523807039383i, 0.28458245639139346 + 2.710505431213761e-20i, 0.030385037114208462 + 0.002135942229700983i }, { 0.00038075969200261476 + -0.011233730361787448i, -0.04290570185245468 + 0.02216668543425463i, 0.030385037114208462 + -0.0021359422297009822i, 0.2429267598906217 + 5.759824041329242e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.25731071662704424, 1.0e-7), DoubleNear(0.21518006709094006, 1.0e-7), DoubleNear(0.28458245639139346, 1.0e-7), DoubleNear(0.2429267598906217, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.22918910829328643 + 2.236166980751353e-19i, 0.023774256457138335 + 0.00611833153351424i, -0.008345440397903584 + -0.031519582110664426i, -0.0004661720049773532 + -0.004271256262828727i }, { 0.023774256457138335 + -0.006118331533514238i, 0.2004303066227351 + -2.168404344971009e-19i, -0.002799361291099155 + -0.004266569715349997i, -0.003642157025351017 + -0.02254236455937683i }, { -0.008345440397903584 + 0.031519582110664426i, -0.0027993612910991554 + 0.004266569715349997i, 0.3127040647251513 + -1.9312351197398048e-19i, 0.03651694080561972 + 0.0064657901532851805i }, { -0.0004661720049773536 + 0.004271256262828727i, -0.003642157025351017 + 0.02254236455937683i, 0.03651694080561972 + -0.006465790153285179i, 0.2576765203588267 + 2.693564772268675e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.22918910829328643, 1.0e-7), DoubleNear(0.2004303066227351, 1.0e-7), DoubleNear(0.3127040647251513, 1.0e-7), DoubleNear(0.2576765203588267, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.24236930733548123 + 3.3881317890172014e-21i, 0.026966081963362063 + 0.005628424583513267i, -0.13312786829055082 + -0.08530583679336005i, -0.012830830657535534 + -0.012582716793174319i }, { 0.026966081963362063 + -0.005628424583513265i, 0.20489469118556045 + -1.3552527156068805e-20i, -0.016792862601294194 + -0.006399589276948916i, -0.11254392629768091 + -0.07211603349556035i }, { -0.13312786829055082 + 0.08530583679336005i, -0.016792862601294194 + 0.006399589276948914i, 0.29952386568295647 + 2.710505431213761e-20i, 0.03332511529939599 + 0.0069556971032861525i }, { -0.012830830657535534 + 0.012582716793174315i, -0.1125439262976809 + 0.07211603349556035i, 0.03332511529939599 + -0.006955697103286151i, 0.2532121357960013 + 6.606856988583543e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24236930733548123, 1.0e-7), DoubleNear(0.20489469118556045, 1.0e-7), DoubleNear(0.29952386568295647, 1.0e-7), DoubleNear(0.2532121357960013, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.5418931730184378 + 3.049318610115481e-20i, 0.060291197262758056 + 0.01258412168679942i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.060291197262758056 + -0.012584121686799416i, 0.4581068269815618 + 5.251604272976662e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5418931730184378, 1.0e-7), DoubleNear(0.4581068269815618, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.201967585675362 + -8.809142651444724e-20i, -0.04081588648651027 + -0.020718417179588867i, -0.005980669116525191 + -0.025322238151425452i, -0.0013619810085313258 + 0.0052980757290828516i }, { -0.04081588648651027 + 0.020718417179588867i, 0.2276518292406595 + 9.486769009248164e-20i, 0.0033854934755258746 + 0.004718958761437263i, -0.006006928306729409 + -0.028739708518615802i }, { -0.0059806691165251915 + 0.025322238151425452i, 0.003385493475525875 + -0.004718958761437263i, 0.27052319804262226 + 8.639736061993863e-20i, -0.052634117918608656 + -0.027476287698249332i }, { -0.0013619810085313258 + -0.005298075729082852i, -0.006006928306729411 + 0.028739708518615802i, -0.052634117918608656 + 0.027476287698249335i, 0.29985738704135567 + -1.0164395367051604e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.201967585675362, 1.0e-7), DoubleNear(0.2276518292406595, 1.0e-7), DoubleNear(0.27052319804262226, 1.0e-7), DoubleNear(0.29985738704135567, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.21132811719004643 + -1.0164395367051604e-20i, -0.04179682263204247 + -0.021555756411203476i, -0.11607765876239731 + -0.0743803828671629i, 0.01537112970659189 + 0.0265511541089504i }, { -0.04179682263204247 + 0.021555756411203476i, 0.23593588133099522 + 0.0i, 0.030544930866375584 + 0.0028709948349729545i, -0.1295941358258344 + -0.0830414874217575i }, { -0.11607765876239731 + 0.0743803828671629i, 0.030544930866375584 + -0.0028709948349729558i, 0.26116266652793785 + 8.470329472543003e-21i, -0.051653181773076456 + -0.026638948466634726i }, { 0.01537112970659189 + -0.0265511541089504i, -0.1295941358258344 + 0.0830414874217575i, -0.051653181773076456 + 0.026638948466634726i, 0.29157333495102 + 8.470329472543003e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.21132811719004643, 1.0e-7), DoubleNear(0.23593588133099522, 1.0e-7), DoubleNear(0.26116266652793785, 1.0e-7), DoubleNear(0.29157333495102, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.47249078371798425 + -1.6940658945086007e-21i, -0.09345000440511893 + -0.0481947048778382i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09345000440511893 + 0.0481947048778382i, 0.5275092162820152 + 8.470329472543003e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.47249078371798425, 1.0e-7), DoubleNear(0.5275092162820152, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.19215329735761033 + -6.268043809681823e-20i, -0.005361620756185392 + -0.024179962435473976i, -0.10554537265236519 + -0.06763149180851184i, -0.005565518184485549 + 0.015168605464001702i }, { -0.005361620756185392 + 0.024179962435473976i, 0.2551107011634313 + 5.251604272976662e-20i, 0.011455547328029992 + -0.011394385450722938i, -0.14012642193586652 + -0.08979037848040856i }, { -0.10554537265236519 + 0.06763149180851184i, 0.011455547328029992 + 0.011394385450722938i, 0.23746611755841118 + 6.945670167485263e-20i, -0.006625976667069208 + -0.029881984234567276i }, { -0.0055655181844855494 + -0.015168605464001703i, -0.14012642193586652 + 0.08979037848040856i, -0.00662597666706921 + 0.029881984234567276i, 0.31526988392054667 + 2.371692252312041e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.19215329735761033, 1.0e-7), DoubleNear(0.2551107011634313, 1.0e-7), DoubleNear(0.23746611755841118, 1.0e-7), DoubleNear(0.31526988392054667, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.4296194149160215 + 6.776263578034403e-21i, -0.0119875974232546 + -0.05406194667004125i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011987597423254602 + 0.05406194667004125i, 0.570380585083978 + 7.623296525288703e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.4296194149160215, 1.0e-7), DoubleNear(0.570380585083978, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.44726399852104165 + -1.0164395367051604e-20i, -0.2456717945882317 + -0.1574218702889204i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.2456717945882317 + 0.1574218702889204i, 0.5527360014789579 + 9.317362419797304e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.44726399852104165, 1.0e-7), DoubleNear(0.5527360014789579, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.22424851031038107 + 0.0i, -0.009621658989024971 + 0.055198351508114724i, 0.027554420724782088 + 0.0005482600302032547i, -0.010712704883158425 + 0.06214769502930803i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009621658989024971 + -0.055198351508114724i, 0.3308484517061947 + 5.421010862427522e-20i, 0.006615365125579027 + 0.025569387744086257i, 0.04829535099776075 + 0.0025030508372516167i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02755442072478209 + -0.0005482600302032546i, 0.006615365125579026 + -0.025569387744086257i, 0.21856624212268205 + 1.3552527156068805e-20i, 0.016193773492771794 + 0.021238367214608384i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010712704883158425 + -0.06214769502930803i, 0.04829535099776075 + -0.002503050837251617i, 0.016193773492771794 + -0.021238367214608384i, 0.22633679586074165 + 1.5246593050577406e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.22424851031038107, 1.0e-7), DoubleNear(0.3308484517061947, 1.0e-7), DoubleNear(0.21856624212268205, 1.0e-7), DoubleNear(0.22633679586074165, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.1215187367967503 + 0.0i, -0.0052139113192641185 + 0.02991160984411937i, 0.014931552477237174 + 0.0002970983674060262i, -0.005805141640744835 + 0.033677411655213936i, 0.013520211171002825 + 0.0028219705418293314i, -0.0012747241123911384 + 0.003206894571808027i, 0.0016543896444427804 + 0.000379803437042196i, -0.0014279559601311285 + 0.0036121489585933053i }, { -0.005213911319264118 + -0.029911609844119374i, 0.1792845172833073 + 2.710505431213761e-20i, 0.0035848211985755364 + 0.01385587665678166i, 0.02617092099421576 + 0.0013563861604247364i, 0.00011452143218655028 + -0.0034490548269015832i, 0.019947249265896277 + 0.004163437176159938i, 7.70799969229162e-05 + 0.001624857560109549i, 0.002880285837555914 + 0.0007586665056499606i }, { 0.014931552477237174 + -0.00029709836740602616i, 0.003584821198575536 + -0.01385587665678166i, 0.11843955445857636 + 0.0i, 0.00877529530113998 + 0.011508926199654903i, 0.0016681883863149528 + 0.00031369292977765576i, 0.0007206165705799948 + -0.0014583604406237577i, 0.013177620418798369 + 0.0027504641874982975i, 0.000709075794623564 + 0.0014842710034763552i }, { -0.005805141640744835 + -0.033677411655213936i, 0.02617092099421576 + -0.001356386160424737i, 0.00877529530113998 + -0.011508926199654903i, 0.12265036447980375 + 3.3881317890172014e-21i, 0.00013619235347469563 + -0.003881768922282177i, 0.0029432832302043535 + 0.00045684264207506234i, 0.0012436081895386905 + -0.0010767021710733407i, 0.013646116407060583 + 0.0028482497813118535i }, { 0.013520211171002825 + -0.0028219705418293306i, 0.00011452143218655011 + 0.003449054826901583i, 0.0016681883863149524 + -0.00031369292977765555i, 0.00013619235347469552 + 0.0038817689222821767i, 0.10272977351363077 + 0.0i, -0.0044077476697608545 + 0.025286741663995353i, 0.012622868247544914 + 0.0002511616627972284i, -0.004907563242413591 + 0.028470283374094095i }, { -0.0012747241123911384 + -0.003206894571808027i, 0.019947249265896274 + -0.004163437176159936i, 0.0007206165705799947 + 0.0014583604406237577i, 0.0029432832302043535 + -0.00045684264207506234i, -0.0044077476697608545 + -0.025286741663995353i, 0.1515639344228874 + 2.710505431213761e-20i, 0.0030305439270034906 + 0.011713511087304593i, 0.02212443000354499 + 0.00114666467682688i }, { 0.0016543896444427804 + -0.0003798034370421959i, 7.707999692291627e-05 + -0.001624857560109549i, 0.013177620418798369 + -0.0027504641874982975i, 0.0012436081895386905 + 0.0010767021710733407i, 0.012622868247544914 + -0.0002511616627972284i, 0.0030305439270034906 + -0.011713511087304593i, 0.1001266876641057 + 1.3552527156068805e-20i, 0.007418478191631815 + 0.009729441014953481i }, { -0.0014279559601311285 + -0.0036121489585933045i, 0.002880285837555914 + -0.0007586665056499603i, 0.0007090757946235641 + -0.0014842710034763552i, 0.013646116407060583 + -0.002848249781311853i, -0.004907563242413591 + -0.02847028337409409i, 0.02212443000354499 + -0.00114666467682688i, 0.007418478191631814 + -0.009729441014953481i, 0.10368643138093789 + 1.1858461261560205e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1215187367967503, 1.0e-7), DoubleNear(0.1792845172833073, 1.0e-7), DoubleNear(0.11843955445857636, 1.0e-7), DoubleNear(0.12265036447980375, 1.0e-7), DoubleNear(0.10272977351363077, 1.0e-7), DoubleNear(0.1515639344228874, 1.0e-7), DoubleNear(0.1001266876641057, 1.0e-7), DoubleNear(0.10368643138093789, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.10595535438414248 + -2.710505431213761e-20i, -0.004546145196391601 + 0.02608071236400992i, 0.013019209843147365 + 0.0002590478113519818i, -0.005061654325983005 + 0.029364213130664042i, -0.020956024276346477 + -0.01080759077370368i, 0.003559412335585702 + -0.004694573176177369i, -0.0025485375077594274 + -0.001379212077148307i, 0.003996292139297289 + -0.005291406723969629i }, { -0.004546145196391601 + -0.02608071236400992i, 0.1563228442385417 + 1.3552527156068805e-20i, 0.003125699052765458 + 0.012081300054392343i, 0.022819108242867123 + 0.0011826684517789734i, -0.0017611241857678297 + 0.005621999206999885i, -0.03091778926937069 + -0.015945143489269765i, 0.0006141031961064207 + -0.00270828496720748i, -0.004392566967091942 + -0.0025614903000760894i }, { 0.013019209843147365 + -0.00025904781135198184i, 0.003125699052765457 + -0.012081300054392343i, 0.10327053503484082 + 1.3552527156068805e-20i, 0.007651408728951269 + 0.010034932770120662i, -0.0026013839684633482 + -0.0012767422726730174i, -0.0018505149963600814 + 0.0020706338274346313i, -0.020425016289174938 + -0.010533735535360796i, -0.0004897313642398168 + -0.002765179644105384i }, { -0.005061654325983005 + -0.029364213130664042i, 0.022819108242867123 + -0.0011826684517789732i, 0.007651408728951269 + -0.010034932770120662i, 0.10694205006045929 + -1.6940658945086007e-21i, -0.0019940875022534995 + 0.006323998024544024i, -0.004633834559883077 + -0.002093670076541289i, -0.002536885044230229 + 0.0012042713754199916i, -0.021151174570226822 + -0.010908235079503961i }, { -0.020956024276346477 + 0.01080759077370368i, -0.00176112418576783 + -0.005621999206999885i, -0.0026013839684633487 + 0.0012767422726730174i, -0.0019940875022535004 + -0.006323998024544023i, 0.11829315592623858 + 2.710505431213761e-20i, -0.005075513792633372 + 0.029117639144104805i, 0.014535210881634723 + 0.00028921221885127283i, -0.005651050557175422 + 0.03278348189864399i }, { 0.003559412335585702 + 0.004694573176177369i, -0.030917789269370687 + 0.015945143489269765i, -0.0018505149963600814 + -0.0020706338274346313i, -0.004633834559883077 + 0.002093670076541289i, -0.005075513792633372 + -0.029117639144104805i, 0.174525607467653 + 4.0657581468206416e-20i, 0.003489666072813569 + 0.013488087689693912i, 0.025476242754893626 + 0.001320382385472643i }, { -0.0025485375077594274 + 0.001379212077148307i, 0.0006141031961064206 + 0.0027082849672074804i, -0.020425016289174938 + 0.010533735535360796i, -0.0025368850442302297 + -0.0012042713754199913i, 0.014535210881634723 + -0.0002892122188512728i, 0.003489666072813569 + -0.013488087689693912i, 0.11529570708784125 + 0.0i, 0.008542364763820526 + 0.011203434444487721i }, { 0.003996292139297289 + 0.005291406723969629i, -0.004392566967091942 + 0.0025614903000760903i, -0.000489731364239817 + 0.002765179644105384i, -0.021151174570226822 + 0.010908235079503961i, -0.005651050557175422 + -0.03278348189864399i, 0.025476242754893626 + -0.0013203823854726435i, 0.008542364763820524 + -0.011203434444487721i, 0.11939474580028234 + 1.6940658945086007e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.10595535438414248, 1.0e-7), DoubleNear(0.1563228442385417, 1.0e-7), DoubleNear(0.10327053503484082, 1.0e-7), DoubleNear(0.10694205006045929, 1.0e-7), DoubleNear(0.11829315592623858, 1.0e-7), DoubleNear(0.174525607467653, 1.0e-7), DoubleNear(0.11529570708784125, 1.0e-7), DoubleNear(0.11939474580028234, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.09634151379533537 + 0.0i, -0.004133651505386389 + 0.023714283479245153i, 0.011837914110130784 + 0.0002355431533977627i, -0.004602386004070532 + 0.026699856376870668i, -0.002688200864365408 + -0.012123311005236025i, 0.0030994709100101614 + -0.00014153000116458677i, -0.00030067129836550767 + -0.0014962179442723875i, 0.0034882449677938777 + -0.00016585186870934443i }, { -0.004133651505386389 + -0.023714283479245153i, 0.14213891824788705 + -1.3552527156068805e-20i, 0.002842089294707116 + 0.010985105402375232i, 0.02074862043882188 + 0.0010753592362050981i, -0.002868789761001621 + 0.0011818612314485697i, -0.003966078047160955 + -0.017886311352006024i, 0.0013030285426731186 + -0.0006641550432571104i, -0.0004436254243000344 + -0.0026409462558187797i }, { 0.011837914110130784 + -0.0002355431533977626i, 0.0028420892947071154 + -0.010985105402375234i, 0.09390030106114021 + 1.3552527156068805e-20i, 0.0069571594932472 + 0.009124414896511671i, -0.00035995130739383473 + -0.0014830733032217117i, -0.0014616332105396776 + -5.112398998669815e-05i, -0.0026200841208803057 + -0.011816116525507767i, 0.0009540630383201916 + -0.0011300639150489315i }, { -0.004602386004070532 + -0.026699856376870668i, 0.02074862043882188 + -0.0010753592362050984i, 0.006957159493247199 + -0.009124414896511671i, 0.09723868181165887 + 6.776263578034403e-21i, -0.0032314057808870036 + 0.0013241512288797476i, -0.0007142650260518326 + -0.002580935124284954i, -0.0013423119131096314 + -0.0006208699228569824i, -0.0027132343908479305 + -0.012236207787291436i }, { -0.0026882008643654086 + 0.012123311005236025i, -0.0028687897610016207 + -0.0011818612314485693i, -0.0003599513073938348 + 0.0014830733032217115i, -0.003231405780887003 + -0.001324151228879748i, 0.1279069965150457 + 0.0i, -0.005488007483638582 + 0.03148406802886957i, 0.015716506614651304 + 0.0003127168768054919i, -0.0061103188790878945 + 0.03544783865243736i }, { 0.0030994709100101614 + 0.00014153000116458685i, -0.003966078047160956 + 0.017886311352006027i, -0.0014616332105396776 + 5.1123989986698005e-05i, -0.0007142650260518328 + 0.002580935124284954i, -0.005488007483638582 + -0.03148406802886957i, 0.18870953345830765 + 6.776263578034403e-20i, 0.003773275830871911 + 0.014584282341711021i, 0.027546730558938873 + 0.0014276916010465181i }, { -0.0003006712983655076 + 0.0014962179442723875i, 0.0013030285426731186 + 0.0006641550432571106i, -0.0026200841208803066 + 0.011816116525507767i, -0.0013423119131096314 + 0.0006208699228569824i, 0.015716506614651307 + -0.00031271687680549203i, 0.0037732758308719107 + -0.014584282341711021i, 0.12466594106154186 + 0.0i, 0.009236613999524594 + 0.012113952318096713i }, { 0.0034882449677938777 + 0.0001658518687093445i, -0.00044362542430003457 + 0.0026409462558187793i, 0.0009540630383201919 + 0.0011300639150489313i, -0.002713234390847931 + 0.012236207787291436i, -0.0061103188790878945 + -0.03544783865243736i, 0.027546730558938873 + -0.0014276916010465186i, 0.009236613999524594 + -0.012113952318096713i, 0.12909811404908278 + 8.470329472543003e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.09634151379533537, 1.0e-7), DoubleNear(0.14213891824788705, 1.0e-7), DoubleNear(0.09390030106114021, 1.0e-7), DoubleNear(0.09723868181165887, 1.0e-7), DoubleNear(0.1279069965150457, 1.0e-7), DoubleNear(0.18870953345830765, 1.0e-7), DoubleNear(0.12466594106154186, 1.0e-7), DoubleNear(0.12909811404908278, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.10029828538380813 + 0.0i, -0.004303421671837234 + 0.024688235407289375i, 0.012324100390297103 + 0.0002452169733379748i, -0.004791407221017329 + 0.02779642657767459i, -0.055091533961688935 + -0.03530161990256446i, 0.011053197962022431 + -0.012046018519976064i, -0.0066830358689371275 + -0.00447236047074402i, 0.012415215819198763 + -0.01358152172881219i }, { -0.004303421671837234 + -0.024688235407289375i, 0.14797660141460844 + 0.0i, 0.0029588146577431296 + 0.011436266602154941i, 0.021600771797235664 + 0.0011195245259706004i, -0.006325657500522917 + 0.015075337626645095i, -0.08128013286739882 + -0.052082782049782755i, 0.002399972218559256 + -0.007323080524324761i, -0.01147077060566004 + -0.008217673471460562i }, { 0.012324100390297105 + -0.0002452169733379748i, 0.0029588146577431296 + -0.011436266602154941i, 0.09775681139350895 + -1.3552527156068805e-20i, 0.007242891883521171 + 0.00949915704246395i, -0.00685565210765564 + -0.004202976419701957i, -0.005650389463074062 + 0.005240274222899261i, -0.0536955609386853 + -0.034407106616973646i, -0.0006349699063180438 + -0.007766921898003988i }, { -0.004791407221017329 + -0.02779642657767459i, 0.021600771797235664 + -0.0011195245259706006i, 0.007242891883521171 + -0.00949915704246395i, 0.10123230032911612 + 3.3881317890172014e-21i, -0.0071515969521194715 + 0.016954349805932294i, -0.012258840494116836 + -0.006987815489194199i, -0.007321736883931128 + 0.0026684136774694283i, -0.05560456682045869 + -0.035630361719599546i }, { -0.055091533961688935 + 0.03530161990256446i, -0.0063256575005229175 + -0.015075337626645095i, -0.00685565210765564 + 0.004202976419701956i, -0.007151596952119472 + -0.016954349805932294i, 0.12395022492657294 + 0.0i, -0.005318237317187738 + 0.03051011610082535i, 0.015230320334484985 + 0.0003030430568652798i, -0.005921297662141097 + 0.03435126845163344i }, { 0.011053197962022431 + 0.012046018519976064i, -0.08128013286739881 + 0.052082782049782755i, -0.005650389463074061 + -0.005240274222899261i, -0.012258840494116836 + 0.006987815489194198i, -0.005318237317187738 + -0.03051011610082535i, 0.18287185029158623 + 5.421010862427522e-20i, 0.0036565504678358974 + 0.014133121141931314i, 0.02669457920052509 + 0.001383526311281016i }, { -0.0066830358689371275 + 0.00447236047074402i, 0.002399972218559256 + 0.007323080524324761i, -0.0536955609386853 + 0.034407106616973646i, -0.0073217368839311285 + -0.0026684136774694283i, 0.015230320334484987 + -0.00030304305686527976i, 0.0036565504678358965 + -0.014133121141931314i, 0.1208094307291731 + 2.710505431213761e-20i, 0.008950881609250623 + 0.011739210172144434i }, { 0.012415215819198761 + 0.01358152172881219i, -0.01147077060566004 + 0.00821767347146056i, -0.0006349699063180437 + 0.007766921898003988i, -0.05560456682045869 + 0.035630361719599546i, -0.005921297662141097 + -0.03435126845163344i, 0.02669457920052509 + -0.0013835263112810165i, 0.008950881609250623 + -0.011739210172144434i, 0.12510449553162553 + 1.1858461261560205e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.10029828538380813, 1.0e-7), DoubleNear(0.14797660141460844, 1.0e-7), DoubleNear(0.09775681139350895, 1.0e-7), DoubleNear(0.10123230032911612, 1.0e-7), DoubleNear(0.12395022492657294, 1.0e-7), DoubleNear(0.18287185029158623, 1.0e-7), DoubleNear(0.1208094307291731, 1.0e-7), DoubleNear(0.12510449553162553, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.22424851031038107 + 0.0i, -0.009621658989024971 + 0.055198351508114724i, 0.027554420724782088 + 0.0005482600302032547i, -0.010712704883158425 + 0.06214769502930803i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009621658989024971 + -0.055198351508114724i, 0.3308484517061947 + 5.421010862427522e-20i, 0.006615365125579027 + 0.025569387744086257i, 0.04829535099776075 + 0.0025030508372516167i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02755442072478209 + -0.0005482600302032546i, 0.006615365125579026 + -0.025569387744086257i, 0.21856624212268205 + 1.3552527156068805e-20i, 0.016193773492771794 + 0.021238367214608384i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010712704883158425 + -0.06214769502930803i, 0.04829535099776075 + -0.002503050837251617i, 0.016193773492771794 + -0.021238367214608384i, 0.22633679586074165 + 1.5246593050577406e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.22424851031038107, 1.0e-7), DoubleNear(0.3308484517061947, 1.0e-7), DoubleNear(0.21856624212268205, 1.0e-7), DoubleNear(0.22633679586074165, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.23995829125532664 + 0.0i, 0.0035613839818758627 + 0.04142053604377427i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0266978315898012 + 0.005572434729327629i, -0.0005656483177675745 + 0.004691165575284382i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003561383981875862 + -0.04142053604377427i, 0.301934881763111 + 3.049318610115481e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0013581296217252408 + -0.004525756997974924i, 0.03359336567295686 + 0.007011686957471791i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026697831589801196 + -0.005572434729327628i, 0.0013581296217252408 + 0.004525756997974924i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20285646117773648 + 1.3552527156068805e-20i, 0.003010730521870961 + 0.035016182678948835i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005656483177675742 + -0.004691165575284382i, 0.03359336567295686 + -0.007011686957471789i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00301073052187096 + -0.035016182678948835i, 0.2552503658038253 + 3.8963515573697816e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.23995829125532664, 1.0e-7), DoubleNear(0.301934881763111, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20285646117773648, 1.0e-7), DoubleNear(0.2552503658038253, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.2092258894189833 + -1.3552527156068805e-20i, 0.0031052635325596696 + 0.03611564513413058i, 0.0 + 0.0i, 0.0 + 0.0i, -0.041381040565521415 + -0.021341326309064476i, 0.003069680971345885 + -0.007459752820282753i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003105263532559669 + -0.03611564513413058i, 0.26326489429900096 + 1.1858461261560205e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004298009229998059 + 0.006826270582419877i, -0.05206896383959751 + -0.026853378568773727i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.041381040565521415 + 0.021341326309064476i, -0.00429800922999806 + -0.006826270582419876i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23358886301407983 + 2.710505431213761e-20i, 0.0034668509711871538 + 0.04032107358859252i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0030696809713458848 + 0.007459752820282753i, -0.05206896383959751 + 0.026853378568773727i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003466850971187153 + -0.04032107358859253i, 0.29392035326793536 + 5.759824041329242e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2092258894189833, 1.0e-7), DoubleNear(0.26326489429900096, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23358886301407983, 1.0e-7), DoubleNear(0.29392035326793536, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.19024181485647557 + 1.3552527156068805e-20i, 0.00282350798786081 + 0.03283869837575683i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005308284985245714 + -0.023939427530743792i, 0.004053533948330353 + -0.0012715939162135184i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0028235079878608095 + -0.03283869837575683i, 0.2393776000595459 + -6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004211101674111252 + 0.0005609913085915872i, -0.006679312438008886 + -0.030122519139297463i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005308284985245715 + 0.023939427530743795i, -0.004211101674111252 + -0.0005609913085915872i, 0.0 + 0.0i, 0.0 + 0.0i, 0.25257293757658755 + 0.0i, 0.0037486065158860125 + 0.04359802034696629i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004053533948330353 + 0.0012715939162135184i, -0.006679312438008887 + 0.03012251913929746i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0037486065158860125 + -0.04359802034696629i, 0.31780764750739043 + 7.623296525288703e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.19024181485647557, 1.0e-7), DoubleNear(0.2393776000595459, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25257293757658755, 1.0e-7), DoubleNear(0.31780764750739043, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.19805509677731709 + -1.3552527156068805e-20i, 0.0029394702116839365 + 0.03418739244975333i, 0.0 + 0.0i, 0.0 + 0.0i, -0.10878709490037422 + -0.0697087265195381i, 0.010418228055704387 + -0.019812940417980054i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0029394702116839365 + -0.03418739244975333i, 0.24920890174372456 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, -0.013647394384454045 + 0.017743751304114524i, -0.1368846996878575 + -0.0877131437693823i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.10878709490037422 + 0.06970872651953809i, -0.013647394384454045 + -0.017743751304114524i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24475965565574603 + 2.710505431213761e-20i, 0.003632644292062886 + 0.04224932627296979i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010418228055704389 + 0.019812940417980054i, -0.1368846996878575 + 0.0877131437693823i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0036326442920628856 + -0.04224932627296979i, 0.30797634582321176 + 6.606856988583543e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.19805509677731709, 1.0e-7), DoubleNear(0.24920890174372456, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24475965565574603, 1.0e-7), DoubleNear(0.30797634582321176, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.4428147524330631 + 1.3552527156068805e-20i, 0.0065721145037468225 + 0.07643671872272312i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0065721145037468225 + -0.07643671872272312i, 0.5571852475669363 + 6.945670167485263e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.4428147524330631, 1.0e-7), DoubleNear(0.5571852475669363, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.1139409812815787 + 0.0i, 0.0016910754927140868 + 0.019667986871163702i, 0.013242888902403533 + 0.004626607999671262i, -0.0006020778454631094 + 0.0023545953830991437i, -0.022381762821759868 + -0.01152559098623342i, 0.001657313457230634 + -0.004034499761343195i, 0.00016860600875062725 + 0.004974461529054695i, -0.0008561670915766095 + 0.00010293338372043891i }, { 0.0016910754927140868 + -0.019667986871163702i, 0.1433697353454655 + 3.3881317890172014e-21i, 0.0009951712631904256 + -0.002217262119603651i, 0.01666327124614606 + 0.005821571457427174i, -0.002321679345006899 + 0.003692381513165235i, -0.02816253973090438 + -0.014502428457350152i, 0.0008611718841651147 + 4.472534076332978e-05i, 0.00021215368325198732 + 0.006259268832732752i }, { 0.013242888902403532 + -0.004626607999671262i, 0.0009951712631904256 + 0.002217262119603651i, 0.09528490813740459 + -1.3552527156068805e-20i, 0.0014141880398455828 + 0.01644765826296688i, -0.006204786277700483 + 0.001875425897636529i, -0.00041581714859220274 + -0.0010432082200569268i, -0.018999277743761547 + -0.009815735322831056i, 0.0014123675141152511 + -0.0034252530589395586i }, { -0.0006020778454631092 + -0.0023545953830991437i, 0.016663271246146055 + -0.005821571457427174i, 0.0014141880398455824 + -0.01644765826296688i, 0.11989515895353547 + 8.470329472543003e-21i, 0.00023163825362872118 + 0.0010988771591554387i, -0.0078073626934167546 + 0.0023598121727573013i, -0.00197632988499116 + 0.003133889069254642i, -0.023906424108693133 + -0.012350950111423575i }, { -0.022381762821759868 + 0.01152559098623342i, -0.0023216793450068995 + -0.0036923815131652345i, -0.006204786277700483 + -0.0018754258976365285i, 0.0002316382536287211 + -0.0010988771591554389i, 0.12601730997374794 + 0.0i, 0.001870308489161776 + 0.02175254917261057i, 0.013454942687397664 + 0.0009458267296563663i, 3.642952769553496e-05 + 0.0023365701921852387i }, { 0.001657313457230634 + 0.004034499761343195i, -0.02816253973090438 + 0.014502428457350154i, -0.00041581714859220264 + 0.001043208220056927i, -0.0078073626934167546 + -0.002359812172757301i, 0.0018703084891617755 + -0.02175254917261057i, 0.15856514641764552 + 2.710505431213761e-20i, 0.0003629583585348152 + -0.0023084948783712723i, 0.0169300944268108 + 0.001190115500044617i }, { 0.00016860600875062728 + -0.004974461529054695i, 0.0008611718841651147 + -4.472534076332978e-05i, -0.018999277743761547 + 0.009815735322831058i, -0.00197632988499116 + -0.003133889069254642i, 0.013454942687397664 + -0.0009458267296563658i, 0.00036295835853481504 + 0.0023084948783712728i, 0.10757155304033188 + 2.710505431213761e-20i, 0.001596542482025378 + 0.018568524415981953i }, { -0.0008561670915766095 + -0.00010293338372043893i, 0.00021215368325198746 + -0.006259268832732752i, 0.0014123675141152511 + 0.0034252530589395586i, -0.023906424108693133 + 0.012350950111423575i, 3.6429527695535e-05 + -0.0023365701921852387i, 0.0169300944268108 + -0.0011901155000446162i, 0.0015965424820253778 + -0.018568524415981953i, 0.13535520685028984 + 3.049318610115481e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1139409812815787, 1.0e-7), DoubleNear(0.1433697353454655, 1.0e-7), DoubleNear(0.09528490813740459, 1.0e-7), DoubleNear(0.11989515895353547, 1.0e-7), DoubleNear(0.12601730997374794, 1.0e-7), DoubleNear(0.15856514641764552, 1.0e-7), DoubleNear(0.10757155304033188, 1.0e-7), DoubleNear(0.13535520685028984, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.10148831824924617 + 1.0842021724855044e-19i, 0.0015062570627151094 + 0.017518463404925667i, 0.010527591487347871 + 0.002709287463316513i, -0.00031141805080183983 + 0.001857436529066308i, -0.0036954841237425602 + -0.013957335949127481i, 0.0023544062421714165 + -0.0008450483830533436i, -0.00020642784097527146 + -0.0018913752846026744i, 0.0003234170777593567 + -6.370384365501798e-05i }, { 0.001506257062715109 + -0.017518463404925667i, 0.12770079004404022 + 1.1519648082658485e-19i, 0.0006239123221573508 + -0.0017770157782460271i, 0.013246664969790465 + 0.003409044070197727i, -0.00246410062192985 + 0.0004307477775702703i, -0.004649956274161022 + -0.017562246161536947i, -0.0003295445493496615 + 7.561473186705689e-06i, -0.0002597441640020818 + -0.002379880978226053i }, { 0.010527591487347871 + -0.0027092874633165127i, 0.0006239123221573508 + 0.0017770157782460271i, 0.08875349660722942 + -9.486769009248164e-20i, 0.0013172509251457008 + 0.015320234970831155i, -0.001239598477088773 + -0.0018893000122411144i, 0.0003077248663006365 + -0.0002420143763185239i, -0.001612800861503153 + -0.009982091581616313i, 0.0016991277061589366 + -0.00042654553316017455i }, { -0.00031141805080183967 + -0.001857436529066308i, 0.013246664969790465 + -0.003409044070197726i, 0.0013172509251457003 + -0.015320234970831155i, 0.11167681001550567 + -1.2197274440461925e-19i, -0.0003445203121855569 + 0.0001859336069035265i, -0.001559762814010382 + -0.0023772697031088823i, -0.0017470010521814022 + 0.00013024353102131686i, -0.002029356163847864 + -0.012560272977760516i }, { -0.003695484123742562 + 0.013957335949127483i, -0.00246410062192985 + -0.0004307477775702703i, -0.001239598477088773 + 0.0018893000122411144i, -0.0003445203121855569 + -0.00018593360690352656i, 0.1384699730060805 + -1.0842021724855044e-19i, 0.002055126919160753 + 0.023902072638848602i, 0.016170240102453326 + 0.002863147266011116i, -0.0002542302669657346 + 0.0028337290462180746i }, { 0.0023544062421714165 + 0.0008450483830533436i, -0.004649956274161023 + 0.017562246161536947i, 0.0003077248663006365 + 0.00024201437631852393i, -0.0015597628140103822 + 0.0023772697031088823i, 0.002055126919160753 + -0.023902072638848602i, 0.17423409171907078 + -8.470329472543003e-20i, 0.0007342172995678899 + -0.0027487412197288964i, 0.020346700703166392 + 0.003602642887274064i }, { -0.0002064278409752716 + 0.0018913752846026744i, -0.00032954454934966155 + -7.561473186705718e-06i, -0.001612800861503153 + 0.009982091581616313i, -0.0017470010521814022 + -0.00013024353102131684i, 0.016170240102453326 + -0.0028631472660111154i, 0.0007342172995678899 + 0.002748741219728897i, 0.11410296457050706 + 1.0842021724855044e-19i, 0.0016934795967252598 + 0.01969594770811768i }, { 0.0003234170777593567 + 6.3703843655018e-05i, -0.00025974416400208195 + 0.002379880978226053i, 0.0016991277061589366 + 0.0004265455331601746i, -0.0020293561638478636 + 0.012560272977760516i, -0.0002542302669657345 + -0.0028337290462180746i, 0.020346700703166392 + -0.0036026428872740633i, 0.0016934795967252596 + -0.01969594770811768i, 0.14357355578831965 + 1.6093625997831706e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10148831824924617, 1.0e-7), DoubleNear(0.12770079004404022, 1.0e-7), DoubleNear(0.08875349660722942, 1.0e-7), DoubleNear(0.11167681001550567, 1.0e-7), DoubleNear(0.1384699730060805, 1.0e-7), DoubleNear(0.17423409171907078, 1.0e-7), DoubleNear(0.11410296457050706, 1.0e-7), DoubleNear(0.14357355578831965, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.10732470482513415 + 0.0i, 0.0015928788400025877 + 0.01852591457182342i, 0.011940978908695868 + 0.002492349438536595i, -0.0002529941283614263 + 0.0020981894729259565i, -0.05895098403902173 + -0.03777468300074704i, 0.005645566658335363 + -0.010736497149924468i, -0.005681681101127157 + -0.005571812621704834i, 0.0008774558960280416 + -0.001063441649481896i }, { 0.0015928788400025877 + -0.01852591457182342i, 0.13504460251034706 + 3.3881317890172014e-21i, 0.0006074424851227013 + -0.0020242081712488515i, 0.015025103054666195 + 0.0031360751449766716i, -0.007395429846425815 + 0.009615217695436665i, -0.0741768842515291 + -0.04753115379261301i, -0.001046107272547059 + 0.0008980515384159768i, -0.0071491495564083764 + -0.007010904171469484i }, { 0.011940978908695866 + -0.0024923494385365947i, 0.0006074424851227013 + 0.0020242081712488515i, 0.09073039195218292 + -1.3552527156068805e-20i, 0.0013465913716813492 + 0.01566147787792991i, -0.007436127295434536 + -0.002833832541345421i, 0.0003787989896417063 + -0.0013256501487095198i, -0.0498361108613525 + -0.03193404351879106i, 0.004772661397369026 + -0.009076443268055585i }, { -0.0002529941283614261 + -0.0020981894729259565i, 0.015025103054666195 + -0.003136075144976671i, 0.0013465913716813487 + -0.01566147787792991i, 0.11416429923337752 + 0.0i, -0.0005995282213644927 + 0.0012415324816994026i, -0.009356735305859655 + -0.0035657567356034946i, -0.00625196453802823 + 0.008128533608677855i, -0.06270781543632842 + -0.04018198997676929i }, { -0.05895098403902173 + 0.03777468300074704i, -0.007395429846425815 + -0.009615217695436665i, -0.007436127295434536 + 0.0028338325413454204i, -0.0005995282213644926 + -0.0012415324816994024i, 0.1326335864301925 + 0.0i, 0.001968505141873275 + 0.022894621471950854i, 0.01475685268110533 + 0.003080085290791034i, -0.0003126541894061482 + 0.002592976102358426i }, { 0.005645566658335363 + 0.010736497149924468i, -0.07417688425152909 + 0.04753115379261301i, 0.00037879898964170616 + 0.0013256501487095198i, -0.009356735305859655 + 0.0035657567356034937i, 0.001968505141873274 + -0.022894621471950854i, 0.16689027925276398 + 2.710505431213761e-20i, 0.0007506871366025395 + -0.0025015488267260723i, 0.018568262618290664 + 0.003875611812495119i }, { -0.005681681101127157 + 0.005571812621704832i, -0.0010461072725470588 + -0.0008980515384159768i, -0.0498361108613525 + 0.03193404351879106i, -0.00625196453802823 + -0.008128533608677855i, 0.01475685268110533 + -0.0030800852907910334i, 0.0007506871366025395 + 0.0025015488267260727i, 0.11212606922555356 + 2.710505431213761e-20i, 0.0016641391501896116 + 0.01935470480101893i }, { 0.0008774558960280413 + 0.0010634416494818963i, -0.0071491495564083764 + 0.007010904171469481i, 0.004772661397369026 + 0.009076443268055585i, -0.06270781543632842 + 0.04018198997676929i, -0.00031265418940614804 + -0.002592976102358426i, 0.018568262618290664 + -0.0038756118124951182i, 0.0016641391501896112 + -0.01935470480101893i, 0.14108606657044778 + 3.8963515573697816e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.10732470482513415, 1.0e-7), DoubleNear(0.13504460251034706, 1.0e-7), DoubleNear(0.09073039195218292, 1.0e-7), DoubleNear(0.11416429923337752, 1.0e-7), DoubleNear(0.1326335864301925, 1.0e-7), DoubleNear(0.16689027925276398, 1.0e-7), DoubleNear(0.11212606922555356, 1.0e-7), DoubleNear(0.14108606657044778, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.23995829125532664 + 0.0i, 0.0035613839818758627 + 0.04142053604377427i, 0.0266978315898012 + 0.005572434729327629i, -0.0005656483177675745 + 0.004691165575284382i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003561383981875862 + -0.04142053604377427i, 0.301934881763111 + 3.049318610115481e-20i, 0.0013581296217252408 + -0.004525756997974924i, 0.03359336567295686 + 0.007011686957471791i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026697831589801196 + -0.005572434729327628i, 0.0013581296217252408 + 0.004525756997974924i, 0.20285646117773648 + 1.3552527156068805e-20i, 0.003010730521870961 + 0.035016182678948835i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005656483177675742 + -0.004691165575284382i, 0.03359336567295686 + -0.007011686957471789i, 0.00301073052187096 + -0.035016182678948835i, 0.2552503658038253 + 3.8963515573697816e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.23995829125532664, 1.0e-7), DoubleNear(0.301934881763111, 1.0e-7), DoubleNear(0.20285646117773648, 1.0e-7), DoubleNear(0.2552503658038253, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.08943422645033894 + -4.0657581468206416e-20i, 0.0013273540991037762 + 0.015437739537375135i, -0.018073876669860062 + -0.009174420774184573i, 0.0013154011467749914 + -0.003255996244828636i, -0.00264832851421817 + -0.011213060618074533i, 0.0018962431527674902 + -0.0006235633716558276i, -0.000603105283111333 + 0.0023460660923454446i, -0.0004139186194155888 + -6.928579891374527e-05i }, { 0.0013273540991037762 + -0.015437739537375135i, 0.11253335922502306 + -4.743384504624082e-20i, -0.0018518945058975476 + 0.002983668624747329i, -0.022742009816650206 + -0.011543996405404298i, -0.0019748544372531424 + 0.0002907220744111988i, -0.0033323406023070207 + -0.01410917753335092i, 0.0003960164291355959 + 0.00013892491959585418i, -0.0007588757254199927 + 0.002952009636737407i }, { -0.018073876669860062 + 0.009174420774184573i, -0.0018518945058975478 + -0.002983668624747329i, 0.10080758840613663 + 5.421010862427522e-20i, 0.0014961538887570337 + 0.01740095883838169i, 0.0014991464552287417 + 0.002089624555687677i, -0.0003384518727392662 + 0.0002897895498450107i, -0.002659956471027544 + -0.012726366912669259i, 0.002157290795562863 + -0.0006480305445576906i }, { 0.0013154011467749914 + 0.003255996244828636i, -0.022742009816650206 + 0.011543996405404298i, 0.0014961538887570333 + -0.01740095883838169i, 0.12684424083452284 + 4.0657581468206416e-20i, 0.0003829515742849539 + -0.0002277624752077608i, 0.0018863470202971334 + 0.002629334205749586i, -0.0022362472368581097 + 0.00027026923418038836i, -0.003346971835701865 + -0.016013341605946543i }, { -0.0026483285142181704 + 0.011213060618074533i, -0.001974854437253142 + -0.00029072207441119876i, 0.0014991464552287417 + -0.0020896245556876764i, 0.0003829515742849539 + 0.00022776247520776073i, 0.11979166296864435 + 2.710505431213761e-20i, 0.001777909433455893 + 0.020677905596755447i, -0.023307163895661356 + -0.012166905534879903i, 0.0017542798245708939 + -0.004203756575454118i }, { 0.0018962431527674904 + 0.0006235633716558276i, -0.0033323406023070207 + 0.014109177533350918i, -0.0003384518727392662 + -0.0002897895498450107i, 0.0018863470202971336 + -0.0026293342057495854i, 0.001777909433455893 + -0.020677905596755447i, 0.1507315350739779 + 5.929230630780102e-20i, -0.002446114724100511 + 0.0038426019576725473i, -0.029326954022947303 + -0.01530938216336943i }, { -0.000603105283111333 + -0.0023460660923454446i, 0.0003960164291355959 + -0.00013892491959585423i, -0.0026599564710275444 + 0.01272636691266926i, -0.0022362472368581097 + -0.0002702692341803884i, -0.023307163895661356 + 0.012166905534879905i, -0.002446114724100512 + -0.0038426019576725473i, 0.1327812746079432 + -2.710505431213761e-20i, 0.00197069708243012 + 0.022920114750210836i }, { -0.0004139186194155888 + 6.928579891374527e-05i, -0.0007588757254199927 + -0.002952009636737407i, 0.002157290795562863 + 0.0006480305445576906i, -0.003346971835701866 + 0.016013341605946543i, 0.0017542798245708939 + 0.004203756575454118i, -0.029326954022947303 + 0.01530938216336943i, 0.0019706970824301196 + -0.022920114750210836i, 0.16707611243341253 + 1.6940658945086007e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.08943422645033894, 1.0e-7), DoubleNear(0.11253335922502306, 1.0e-7), DoubleNear(0.10080758840613663, 1.0e-7), DoubleNear(0.12684424083452284, 1.0e-7), DoubleNear(0.11979166296864435, 1.0e-7), DoubleNear(0.1507315350739779, 1.0e-7), DoubleNear(0.1327812746079432, 1.0e-7), DoubleNear(0.16707611243341253, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.09357920789565582 + -1.3552527156068805e-20i, 0.0013888725840342133 + 0.016153227851858257i, -0.018508249666296547 + -0.009545206938734487i, 0.0013729577854281164 + -0.0033364788743782837i, -0.051400899727880575 + -0.032936730825199205i, 0.004922516738992461 + -0.009361431745849125i, 0.006806562995640994 + 0.011757242733566986i, -0.0019284622739058504 + 0.0013494159428439085i }, { 0.0013888725840342131 + -0.016153227851858257i, 0.11774890929439061 + 3.3881317890172014e-21i, -0.0019223447938892758 + 0.003053145075679676i, -0.023288572965745928 + -0.01201054947246899i, -0.0064482680684191124 + 0.008383758959778081i, -0.06467675903451675 + -0.041443652041963694i, 0.002130503922873183 + -0.0010004214928226083i, 0.008564566710950896 + 0.014793911375383415i }, { -0.018508249666296547 + 0.009545206938734487i, -0.0019223447938892765 + -0.0030531450756796754i, 0.10447588888166126 + 0.0i, 0.0015505976276497233 + 0.01803416459789507i, 0.01352574599967914 + 0.0012713188670851526i, -1.8704641492367705e-05 + 0.002353622795833283i, -0.057386195172493645 + -0.036771995694338894i, 0.005495711316711928 + -0.010451508672130926i }, { 0.0013729577854281164 + 0.0033364788743782837i, -0.023288572965745928 + 0.01201054947246899i, 0.0015505976276497233 + -0.01803416459789507i, 0.13145999244933396 + 0.0i, 0.0004201942078180699 + -0.002315885782243067i, 0.017019184866696447 + 0.001599675967887802i, -0.007199126316034932 + 0.009359992344336442i, -0.07220794065334075 + -0.04626949172741861i }, { -0.051400899727880575 + 0.03293673082519921i, -0.0064482680684191124 + -0.008383758959778081i, 0.01352574599967914 + -0.0012713188670851528i, 0.00042019420781806997 + 0.002315885782243067i, 0.11564668152332747 + 0.0i, 0.001716390948525456 + 0.019962417282272327i, -0.022872790899224872 + -0.01179611937032999i, 0.0016967231859177688 + -0.0041232739459044696i }, { 0.004922516738992461 + 0.009361431745849125i, -0.06467675903451675 + 0.041443652041963694i, -1.8704641492367746e-05 + -0.002353622795833283i, 0.017019184866696447 + -0.0015996759678878027i, 0.001716390948525456 + -0.019962417282272327i, 0.14551598500461035 + 8.470329472543003e-21i, -0.0023756644361087828 + 0.0037731255067402006i, -0.028780390873851584 + -0.014842829096304737i }, { 0.006806562995640994 + -0.011757242733566986i, 0.002130503922873183 + 0.0010004214928226083i, -0.057386195172493645 + 0.036771995694338894i, -0.007199126316034933 + -0.009359992344336442i, -0.022872790899224872 + 0.011796119370329991i, -0.002375664436108783 + -0.0037731255067402006i, 0.12911297413241857 + 2.710505431213761e-20i, 0.0019162533435374304 + 0.022286908990697456i }, { -0.0019284622739058506 + -0.0013494159428439085i, 0.008564566710950896 + -0.014793911375383419i, 0.005495711316711928 + 0.010451508672130926i, -0.07220794065334074 + 0.04626949172741861i, 0.0016967231859177686 + 0.0041232739459044696i, -0.028780390873851584 + 0.014842829096304739i, 0.0019162533435374295 + -0.02228690899069746i, 0.1624603608186014 + 5.759824041329242e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.09357920789565582, 1.0e-7), DoubleNear(0.11774890929439061, 1.0e-7), DoubleNear(0.10447588888166126, 1.0e-7), DoubleNear(0.13145999244933396, 1.0e-7), DoubleNear(0.11564668152332747, 1.0e-7), DoubleNear(0.14551598500461035, 1.0e-7), DoubleNear(0.12911297413241857, 1.0e-7), DoubleNear(0.1624603608186014, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.2092258894189833 + -1.3552527156068805e-20i, 0.0031052635325596696 + 0.03611564513413058i, -0.041381040565521415 + -0.021341326309064476i, 0.003069680971345885 + -0.007459752820282753i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003105263532559669 + -0.03611564513413058i, 0.26326489429900096 + 1.1858461261560205e-20i, -0.004298009229998059 + 0.006826270582419877i, -0.05206896383959751 + -0.026853378568773727i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.041381040565521415 + 0.021341326309064476i, -0.00429800922999806 + -0.006826270582419876i, 0.23358886301407983 + 2.710505431213761e-20i, 0.0034668509711871538 + 0.04032107358859252i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0030696809713458848 + 0.007459752820282753i, -0.05206896383959751 + 0.026853378568773727i, 0.003466850971187153 + -0.04032107358859253i, 0.29392035326793536 + 5.759824041329242e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2092258894189833, 1.0e-7), DoubleNear(0.26326489429900096, 1.0e-7), DoubleNear(0.23358886301407983, 1.0e-7), DoubleNear(0.29392035326793536, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.08508831479860701 + -1.3552527156068805e-20i, 0.0012628534725067269 + 0.014687567541767442i, -0.0023742047677902086 + -0.010707244079705181i, 0.0018129998018710201 + -0.000568738179460689i, -0.04673704806151251 + -0.029948222301864925i, 0.004475873041753401 + -0.008512023870138588i, -0.0024644935570246806 + 0.006716882273296726i, -0.0011960156520489837 + -0.00032572013604214374i }, { 0.0012628534725067269 + -0.014687567541767442i, 0.10706498255900329 + -4.912791094074942e-20i, -0.001883474172941652 + 0.00025091121581622506i, -0.0029874159883951836 + -0.013472718355768796i, -0.0058631855905773465 + 0.0076230600536890784i, -0.05880832459085268 + -0.03768326950664692i, 0.0011228612064867354 + 0.0005250997599853017i, -0.0031010246274608684 + 0.008451723190704977i }, { -0.0023742047677902086 + 0.010707244079705181i, -0.0018834741729416523 + -0.00025091121581622506i, 0.11296678197871006 + 0.0i, 0.0016766167391772096 + 0.019499824907985883i, 0.005072685354046841 + -0.005045601972488776i, 0.0009462366044581023 + 0.0008007392430454933i, -0.06205004683886172 + -0.03976050421767317i, 0.005942355013950987 + -0.011300916547841464i }, { 0.0018129998018710204 + 0.000568738179460689i, -0.0029874159883951836 + 0.013472718355768794i, 0.0016766167391772096 + -0.019499824907985883i, 0.14214391918472127 + 5.251604272976662e-20i, -0.000795662266972294 + -0.0009505096548094493i, 0.006382861973983151 + -0.006348783478234161i, -0.007784208793876698 + 0.010120691250425445i, -0.07807637509700482 + -0.050029874262735384i }, { -0.04673704806151251 + 0.029948222301864922i, -0.005863185590577347 + -0.0076230600536890784i, 0.005072685354046841 + 0.005045601972488776i, -0.000795662266972294 + 0.0009505096548094493i, 0.10515350005786855 + 2.710505431213761e-20i, 0.001560654515354083 + 0.018151130833989382i, -0.0029340802174555054 + -0.01323218345103861i, 0.002240534146459333 + -0.0007028557367528293i }, { 0.004475873041753402 + 0.008512023870138588i, -0.05880832459085268 + 0.03768326950664692i, 0.0009462366044581023 + -0.0008007392430454932i, 0.00638286197398315 + 0.006348783478234161i, 0.0015606545153540826 + -0.018151130833989386i, 0.1323126175005426 + 4.2351647362715017e-20i, -0.0023276275011696003 + 0.0003100800927753621i, -0.0036918964496137027 + -0.016649800783528665i }, { -0.002464493557024681 + -0.006716882273296726i, 0.0011228612064867354 + -0.0005250997599853017i, -0.06205004683886172 + 0.03976050421767317i, -0.007784208793876699 + -0.010120691250425445i, -0.0029340802174555062 + 0.013232183451038613i, -0.0023276275011696 + -0.00031008009277536217i, 0.13960615559787748 + 0.0i, 0.002071989776708803 + 0.024098195438980403i }, { -0.0011960156520489837 + 0.0003257201360421438i, -0.003101024627460869 + -0.008451723190704976i, 0.005942355013950987 + 0.011300916547841464i, -0.07807637509700481 + 0.050029874262735384i, 0.002240534146459333 + 0.0007028557367528293i, -0.003691896449613703 + 0.016649800783528665i, 0.002071989776708803 + -0.024098195438980403i, 0.17566372832266916 + 2.371692252312041e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.08508831479860701, 1.0e-7), DoubleNear(0.10706498255900329, 1.0e-7), DoubleNear(0.11296678197871006, 1.0e-7), DoubleNear(0.14214391918472127, 1.0e-7), DoubleNear(0.10515350005786855, 1.0e-7), DoubleNear(0.1323126175005426, 1.0e-7), DoubleNear(0.13960615559787748, 1.0e-7), DoubleNear(0.17566372832266916, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.19024181485647557 + 1.3552527156068805e-20i, 0.00282350798786081 + 0.03283869837575683i, -0.005308284985245714 + -0.023939427530743792i, 0.004053533948330353 + -0.0012715939162135184i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0028235079878608095 + -0.03283869837575683i, 0.2393776000595459 + -6.776263578034403e-21i, -0.004211101674111252 + 0.0005609913085915872i, -0.006679312438008886 + -0.030122519139297463i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005308284985245715 + 0.023939427530743795i, -0.004211101674111252 + -0.0005609913085915872i, 0.25257293757658755 + 0.0i, 0.0037486065158860125 + 0.04359802034696629i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004053533948330353 + 0.0012715939162135184i, -0.006679312438008887 + 0.03012251913929746i, 0.0037486065158860125 + -0.04359802034696629i, 0.31780764750739043 + 7.623296525288703e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.19024181485647557, 1.0e-7), DoubleNear(0.2393776000595459, 1.0e-7), DoubleNear(0.25257293757658755, 1.0e-7), DoubleNear(0.31780764750739043, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.19805509677731709 + -1.3552527156068805e-20i, 0.0029394702116839365 + 0.03418739244975333i, -0.10878709490037422 + -0.0697087265195381i, 0.010418228055704387 + -0.019812940417980054i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0029394702116839365 + -0.03418739244975333i, 0.24920890174372456 + 3.3881317890172014e-21i, -0.013647394384454045 + 0.017743751304114524i, -0.1368846996878575 + -0.0877131437693823i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.10878709490037422 + 0.06970872651953809i, -0.013647394384454045 + -0.017743751304114524i, 0.24475965565574603 + 2.710505431213761e-20i, 0.003632644292062886 + 0.04224932627296979i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010418228055704389 + 0.019812940417980054i, -0.1368846996878575 + 0.0877131437693823i, 0.0036326442920628856 + -0.04224932627296979i, 0.30797634582321176 + 6.606856988583543e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.19805509677731709, 1.0e-7), DoubleNear(0.24920890174372456, 1.0e-7), DoubleNear(0.24475965565574603, 1.0e-7), DoubleNear(0.30797634582321176, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.3008032540800576 + 2.710505431213761e-20i, 0.04110247347145293 + 0.0016534845278307626i, 0.0 + 0.0i, 0.0 + 0.0i, 0.033467460436899105 + 0.0069854077179892695i, 0.0045346754819986955 + 0.0011384699426921566i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04110247347145293 + -0.0016534845278307632i, 0.2410899189383801 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.004611471616519307 + 0.0007705355718527181i, 0.02682373682585895 + 0.005598713968810152i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.033467460436899105 + -0.006985407717989268i, 0.004611471616519306 + -0.0007705355718527179i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2542937079365182 + 2.710505431213761e-20i, 0.03474729825108991 + 0.0013978263396241084i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004534675481998695 + -0.0011384699426921563i, 0.02682373682585895 + -0.00559871396881015i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03474729825108991 + -0.0013978263396241084i, 0.2038131190450436 + 2.541098841762901e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3008032540800576, 1.0e-7), DoubleNear(0.2410899189383801, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2542937079365182, 1.0e-7), DoubleNear(0.2038131190450436, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.2622781986226842 + -1.3552527156068805e-20i, 0.03583831808601448 + 0.001441716263130955i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05187381354571717 + -0.026752734262973445i, -0.006941104474851369 + -0.003940702377224397i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03583831808601449 + -0.001441716263130955i, 0.2102125850953001 + 1.1858461261560205e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.007235218528346426 + -0.0033704123492143065i, -0.041576190859401764 + -0.021441970614864757i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.051873813545717164 + 0.02675273426297345i, -0.0072352185283464255 + 0.0033704123492143065i, 0.0 + 0.0i, 0.0 + 0.0i, 0.29281876339389157 + 6.776263578034403e-20i, 0.04001145363652835 + 0.0016095946043239158i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00694110447485137 + 0.003940702377224397i, -0.041576190859401764 + 0.02144197061486476i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04001145363652835 + -0.0016095946043239164i, 0.2346904528881236 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2622781986226842, 1.0e-7), DoubleNear(0.2102125850953001, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29281876339389157, 1.0e-7), DoubleNear(0.2346904528881236, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.2384804320432224 + -1.3552527156068805e-20i, 0.03258653454895266 + 0.001310902389602861i, 0.0 + 0.0i, 0.0 + 0.0i, -0.006654278911526364 + -0.030009622357242048i, -0.0007442967226655422 + -0.004137164200091166i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03258653454895266 + -0.001310902389602861i, 0.19113898287279907 + 2.0328790734103208e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0010742163334456676 + -0.004064008427506666i, -0.005333318511728236 + -0.024052324312799203i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006654278911526364 + 0.03000962235724205i, -0.0010742163334456676 + 0.004064008427506666i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3166165299733533 + 6.776263578034403e-20i, 0.04326323717359017 + 0.00174040847785201i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0007442967226655422 + 0.004137164200091166i, -0.005333318511728237 + 0.024052324312799203i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04326323717359018 + -0.0017404084778520105i, 0.2537640551106246 + 8.470329472543003e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2384804320432224, 1.0e-7), DoubleNear(0.19113898287279907, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3166165299733533, 1.0e-7), DoubleNear(0.2537640551106246, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.24827488679841658 + 0.0i, 0.03392487218753276 + 0.001364741499308575i, 0.0 + 0.0i, 0.0 + 0.0i, -0.13637166682908775 + -0.08738440195234722i, -0.01815380647459717 + -0.012690033942204582i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03392487218753276 + -0.0013647414993085754i, 0.19898911172262507 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.019114492601772476 + -0.011190791908896155i, -0.109300127759144 + -0.07003746833657318i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13637166682908775 + 0.08738440195234722i, -0.019114492601772476 + 0.011190791908896155i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3068220752181592 + 5.421010862427522e-20i, 0.04192489953501007 + 0.0016865693681462957i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01815380647459717 + 0.01269003394220458i, -0.10930012775914398 + 0.07003746833657319i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04192489953501008 + -0.0016865693681462962i, 0.24591392626079864 + 3.8963515573697816e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24827488679841658, 1.0e-7), DoubleNear(0.19898911172262507, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3068220752181592, 1.0e-7), DoubleNear(0.24591392626079864, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.5550969620165758 + 5.421010862427522e-20i, 0.07584977172254284 + 0.0030513108674548707i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07584977172254284 + -0.0030513108674548716i, 0.4449030379834237 + 2.879912020664621e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5550969620165758, 1.0e-7), DoubleNear(0.4449030379834237, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.14283239709398032 + 0.0i, 0.01951695911792522 + 0.000785134985956701i, 0.016600818644041074 + 0.005799752675239341i, 0.0022364947768427324 + 0.0008837450182021937i, -0.028056988794230596 + -0.014448074520441612i, -0.003754354231908191 + -0.0021284457128525934i, 0.00021135854828901852 + 0.006235809595941584i, -5.397067815435765e-06 + 0.0008532376997202734i }, { 0.019516959117925222 + -0.0007851349859567013i, 0.1144783195330639 + 3.3881317890172014e-21i, 0.0023002560638878586 + 0.0007012390352719633i, 0.013305341504508518 + 0.0046484267818590955i, -0.003913193389081258 + -0.00181999295351885i, -0.02248731375843365 + -0.01157994492314196i, 6.315813925452384e-05 + 0.0008509140673480806i, 0.00016940114371359602 + 0.004997920765845864i }, { 0.01660081864404107 + -0.00579975267523934i, 0.0023002560638878586 + -0.000701239035271963i, 0.11944580152870385 + -1.3552527156068805e-20i, 0.016321358968089263 + 0.0006565812771742542i, -0.00777810132519087 + 0.0023509677862925613i, -0.001075741328751958 + 0.00027848641839802845i, -0.023816824751486575 + -0.012304659742531834i, -0.003186750242943178 + -0.0018122566643718034i }, { 0.002236494776842732 + -0.0008837450182021937i, 0.013305341504508517 + -0.0046484267818590955i, 0.016321358968089263 + -0.0006565812771742539i, 0.09573426556223623 + 8.470329472543003e-21i, -0.0010498952728510552 + 0.0003639972632619616i, -0.0062340476459263675 + 0.0018842702841012694i, -0.003322025139265168 + -0.0015504193956954564i, -0.019088877100968106 + -0.009862025691722799i }, { -0.028056988794230592 + 0.014448074520441615i, -0.003913193389081257 + 0.0018199929535188501i, -0.00777810132519087 + -0.0023509677862925604i, -0.0010498952728510555 + -0.0003639972632619616i, 0.15797085698607727 + 2.710505431213761e-20i, 0.02158551435352771 + 0.0008683495418740617i, 0.016866641792858027 + 0.0011856550427499276i, 0.0022981807051559626 + 0.0002547249244899628i }, { -0.0037543542319081907 + 0.0021284457128525934i, -0.02248731375843365 + 0.01157994492314196i, -0.001075741328751958 + -0.00027848641839802834i, -0.0062340476459263675 + -0.001884270284101269i, 0.02158551435352771 + -0.0008683495418740619i, 0.12661159940531622 + 0.0i, 0.0023112155526314477 + 6.929653658075487e-05i, 0.013518395321350435 + 0.0009502871869510559i }, { 0.0002113585482890186 + -0.006235809595941584i, 6.315813925452384e-05 + -0.0008509140673480806i, -0.023816824751486575 + 0.012304659742531834i, -0.003322025139265168 + 0.0015504193956954566i, 0.016866641792858027 + -0.0011856550427499267i, 0.0023112155526314473 + -6.929653658075487e-05i, 0.13484790640781433 + 4.0657581468206416e-20i, 0.018425939283000643 + 0.0007412450624498543i }, { -5.3970678154357106e-06 + -0.0008532376997202734i, 0.00016940114371359613 + -0.004997920765845864i, -0.003186750242943178 + 0.0018122566643718036i, -0.019088877100968106 + 0.009862025691722799i, 0.0022981807051559626 + -0.0002547249244899627i, 0.013518395321350435 + -0.0009502871869510553i, 0.018425939283000643 + -0.0007412450624498545i, 0.10807885348280737 + 1.6940658945086007e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.14283239709398032, 1.0e-7), DoubleNear(0.1144783195330639, 1.0e-7), DoubleNear(0.11944580152870385, 1.0e-7), DoubleNear(0.09573426556223623, 1.0e-7), DoubleNear(0.15797085698607727, 1.0e-7), DoubleNear(0.12661159940531622, 1.0e-7), DoubleNear(0.13484790640781433, 1.0e-7), DoubleNear(0.10807885348280737, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.12722217774089134 + 1.0842021724855044e-19i, 0.017383941545338934 + 0.0006993272168375967i, 0.013197017533560458 + 0.0033962672468639734i, 0.00178460299364823 + 0.0005366166972332162i, -0.004632528611566685 + -0.01749642427366184i, -0.0005368237056731678 + -0.002416217640863663i, -0.00025877066374010494 + -0.0023709613754905007i, -2.2326109508518372e-05 + -0.0003253962482089312i }, { 0.017383941545338934 + -0.0006993272168375969i, 0.10196693055239507 + 1.1519648082658485e-19i, 0.0018219408566460377 + 0.00039153140304656544i, 0.010577238923577878 + 0.0027220642866502666i, -0.0007291757925369808 + -0.002365288574904023i, -0.003712911786336898 + -0.014023157837002585i, -4.8391970813426344e-05 + -0.00032255137679915i, -0.00020740134123724827 + -0.0019002948873382266i }, { 0.013197017533560458 + -0.003396267246863973i, 0.0018219408566460377 + -0.0003915314030465653i, 0.11125825430233108 + -1.2197274440461925e-19i, 0.015202593003613731 + 0.0006115751727652642i, -0.0015539169482759409 + -0.0023683598872227107i, -0.0001993122843595925 + -0.00033216006047707535i, -0.002021750299959679 + -0.012513198083580208i, -0.00020747301699237437 + -0.0017209465592275038i }, { 0.0017846029936482303 + -0.0005366166972332161i, 0.010577238923577878 + -0.0027220642866502658i, 0.015202593003613731 + -0.0006115751727652641i, 0.08917205232040401 + -9.486769009248164e-20i, -0.0002253495454379951 + -0.00031507661741814863i, -0.001245444342823214 + -0.0018982098281272858i, -0.00034504054090868656 + -0.0016987198526026428i, -0.0016204067253913377 + -0.010029166475796618i }, { -0.0046325286115666865 + 0.017496424273661843i, -0.000729175792536981 + 0.002365288574904023i, -0.001553916948275941 + 0.0023683598872227107i, -0.00022534954543799513 + 0.00031507661741814863i, 0.17358107633916625 + -8.131516293641283e-20i, 0.023718531926113996 + 0.0009541573109931659i, 0.020270442903338647 + 0.0035891404711252957i, 0.002750072488350465 + 0.0006018532454589402i }, { -0.0005368237056731678 + 0.002416217640863663i, -0.0037129117863368994 + 0.014023157837002585i, -0.00019931228435959253 + 0.00033216006047707535i, -0.0012454443428232143 + 0.0018982098281272858i, 0.023718531926114 + -0.0009541573109931663i, 0.13912298838598502 + -1.1180834903756764e-19i, 0.0027895307598732686 + 0.0003790041688061526i, 0.016246497902281075 + 0.0028766496821598852i }, { -0.0002587706637401051 + 0.0023709613754905002i, -4.839197081342636e-05 + 0.00032255137679915i, -0.0020217502999596796 + 0.012513198083580208i, -0.0003450405409086866 + 0.0016987198526026426i, 0.020270442903338643 + -0.0035891404711252944i, 0.002789530759873268 + -0.0003790041688061526i, 0.1430354536341871 + 1.4907779871675686e-19i, 0.019544705247476177 + 0.0007862511668588442i }, { -2.232610950851838e-05 + 0.0003253962482089312i, -0.00020740134123724843 + 0.0019002948873382266i, -0.00020747301699237437 + 0.0017209465592275038i, -0.001620406725391338 + 0.010029166475796618i, 0.0027500724883504643 + -0.0006018532454589401i, 0.016246497902281075 + -0.0028766496821598844i, 0.019544705247476177 + -0.0007862511668588444i, 0.11464106672463958 + 1.2027867851011065e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.12722217774089134, 1.0e-7), DoubleNear(0.10196693055239507, 1.0e-7), DoubleNear(0.11125825430233108, 1.0e-7), DoubleNear(0.08917205232040401, 1.0e-7), DoubleNear(0.17358107633916625, 1.0e-7), DoubleNear(0.13912298838598502, 1.0e-7), DoubleNear(0.1430354536341871, 1.0e-7), DoubleNear(0.11464106672463958, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.13453846618798745 + 0.0i, 0.018383656633947087 + 0.0007395441014102643i, 0.014968790175352267 + 0.003124321387247627i, 0.0020281970880740696 + 0.0005091966187645153i, -0.07389887524782762 + -0.04735301084627602i, -0.009837423792882122 + -0.006876642758652918i, -0.007122355118147121 + -0.006984627865806017i, -0.0009348217958915551 + -0.00099354704943549i }, { 0.018383656633947087 + -0.0007395441014102644i, 0.10783084114749375 + 3.3881317890172014e-21i, 0.0020625452342707177 + 0.0003446328208695443i, 0.011997291788009797 + 0.0025041031962656406i, -0.010358013046611946 + -0.0060642137361008i, -0.05922899304272319 + -0.03795282594708403i, -0.0010116093568777946 + -0.0009152453433878675i, -0.005708475539388412 + -0.0055980889273682995i }, { 0.014968790175352267 + -0.0031243213872476265i, 0.0020625452342707177 + -0.00034463282086954426i, 0.11373642061042913 + 0.0i, 0.015541215553585678 + 0.000625197397898311i, -0.009321667013540183 + -0.0035523925657881994i, -0.0012542076585681902 + -0.000536647629925614i, -0.062472791581260116 + -0.04003139110607119i, -0.008316382681715046 + -0.005813391183551663i }, { 0.002028197088074069 + -0.0005091966187645153i, 0.011997291788009795 + -0.0025041031962656397i, 0.015541215553585678 + -0.000625197397898311i, 0.09115827057513132 + -1.3552527156068805e-20i, -0.001293261931184194 + -0.000434167141623603i, -0.00747119558775401 + -0.002847196711160716i, -0.00875647955516053 + -0.005126578172795355i, -0.050071134716420794 + -0.03208464238948916i }, { -0.07389887524782762 + 0.04735301084627602i, -0.010358013046611946 + 0.0060642137361008i, -0.009321667013540183 + 0.003552392565788199i, -0.001293261931184194 + 0.000434167141623603i, 0.1662647878920701 + 2.710505431213761e-20i, 0.022718816837505842 + 0.0009139404264204983i, 0.018498670261546835 + 0.003861086330741642i, 0.002506478393924626 + 0.0006292733239276412i }, { -0.009837423792882122 + 0.006876642758652918i, -0.05922899304272319 + 0.03795282594708403i, -0.0012542076585681902 + 0.000536647629925614i, -0.00747119558775401 + 0.0028471967111607156i, 0.022718816837505845 + -0.0009139404264204988i, 0.13325907779088636 + 0.0i, 0.0025489263822485887 + 0.00042590275098317373i, 0.014826445037849157 + 0.0030946107725445112i }, { -0.007122355118147122 + 0.006984627865806016i, -0.0010116093568777946 + 0.0009152453433878673i, -0.062472791581260116 + 0.04003139110607119i, -0.00875647955516053 + 0.005126578172795355i, 0.018498670261546835 + -0.003861086330741641i, 0.0025489263822485882 + -0.00042590275098317357i, 0.14055728732608905 + 2.710505431213761e-20i, 0.01920608269750423 + 0.0007726289417257975i }, { -0.0009348217958915553 + 0.00099354704943549i, -0.005708475539388412 + 0.005598088927368299i, -0.008316382681715044 + 0.005813391183551663i, -0.050071134716420794 + 0.03208464238948916i, 0.002506478393924626 + -0.0006292733239276411i, 0.014826445037849157 + -0.0030946107725445104i, 0.01920608269750423 + -0.0007726289417257974i, 0.11265484846991228 + 3.8963515573697816e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.13453846618798745, 1.0e-7), DoubleNear(0.10783084114749375, 1.0e-7), DoubleNear(0.11373642061042913, 1.0e-7), DoubleNear(0.09115827057513132, 1.0e-7), DoubleNear(0.1662647878920701, 1.0e-7), DoubleNear(0.13325907779088636, 1.0e-7), DoubleNear(0.14055728732608905, 1.0e-7), DoubleNear(0.11265484846991228, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.3008032540800576 + 2.710505431213761e-20i, 0.04110247347145293 + 0.0016534845278307626i, 0.033467460436899105 + 0.0069854077179892695i, 0.0045346754819986955 + 0.0011384699426921566i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04110247347145293 + -0.0016534845278307632i, 0.2410899189383801 + 3.3881317890172014e-21i, 0.004611471616519307 + 0.0007705355718527181i, 0.02682373682585895 + 0.005598713968810152i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.033467460436899105 + -0.006985407717989268i, 0.004611471616519306 + -0.0007705355718527179i, 0.2542937079365182 + 2.710505431213761e-20i, 0.03474729825108991 + 0.0013978263396241084i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004534675481998695 + -0.0011384699426921563i, 0.02682373682585895 + -0.00559871396881015i, 0.03474729825108991 + -0.0013978263396241084i, 0.2038131190450436 + 2.541098841762901e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.3008032540800576, 1.0e-7), DoubleNear(0.2410899189383801, 1.0e-7), DoubleNear(0.2542937079365182, 1.0e-7), DoubleNear(0.2038131190450436, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.112111593234216 + -4.0657581468206416e-20i, 0.01531919526882933 + 0.0006162658890448553i, -0.02265677459067527 + -0.01150073043418182i, -0.0030326573411584836 + -0.0016960291715253197i, -0.0033198512574094934 + -0.014056297469316506i, -0.00037636636677677317 + -0.0019389348639593917i, -0.0007560315201600113 + 0.002940945741747647i, -0.0001194720246362892 + 0.00039770200716708045i }, { 0.01531919526882933 + -0.0006162658890448554i, 0.089855992441146 + -4.743384504624082e-20i, -0.00315909400415157 + -0.001446945255523133i, -0.018159111895835002 + -0.009217686745407051i, -0.0005308984076962228 + -0.0019024371026195815i, -0.002660817859115697 + -0.011265940682108944i, -8.713987253879037e-05 + 0.000406013662072278i, -0.0006059494883713145 + 0.0023571299873352044i }, { -0.02265677459067527 + 0.01150073043418182i, -0.00315909400415157 + 0.001446945255523133i, 0.1263688388090064 + 2.710505431213761e-20i, 0.017267339280123334 + 0.0006946365005580056i, 0.0018792771431913526 + 0.002619479672355329i, 0.00024238989713495102 + 0.00036826213785667974i, -0.0033344276541168705 + -0.015953324887925543i, -0.00036793035588876896 + -0.0021982293361317755i }, { -0.0030326573411584836 + 0.00169602917152532i, -0.018159111895835002 + 0.009217686745407051i, 0.017267339280123334 + -0.0006946365005580056i, 0.10128299043165306 + 6.776263578034403e-20i, 0.0002711879174386409 + 0.00034760175178954035i, 0.0015062163323345222 + 0.0020994790890819337i, -0.0005433179257494446 + -0.002161571324887084i, -0.0026725006526125386 + -0.012786383630690259i }, { -0.003319851257409494 + 0.014056297469316508i, -0.0005308984076962229 + 0.0019024371026195815i, 0.0018792771431913528 + -0.002619479672355329i, 0.00027118791743864084 + -0.00034760175178954035i, 0.15016660538846816 + 2.710505431213761e-20i, 0.020519122817185157 + 0.0008254503740860999i, -0.029217038955041897 + -0.015252003828791626i, -0.0039084471336928855 + -0.002244673205699077i }, { -0.00037636636677677317 + 0.0019389348639593917i, -0.0026608178591156976 + 0.011265940682108944i, 0.00024238989713495102 + -0.00036826213785667974i, 0.0015062163323345222 + -0.0020994790890819337i, 0.02051912281718516 + -0.0008254503740860997i, 0.12035659265415409 + 5.929230630780102e-20i, -0.004076124524194856 + -0.0019234670936911734i, -0.023417078963566762 + -0.012224283869457708i }, { -0.0007560315201600112 + -0.002940945741747647i, -8.713987253879035e-05 + -0.00040601366207227807i, -0.003334427654116871 + 0.015953324887925543i, -0.0005433179257494447 + 0.002161571324887084i, -0.029217038955041894 + 0.015252003828791626i, -0.0040761245241948555 + 0.0019234670936911734i, 0.16644992458488517 + 4.0657581468206416e-20i, 0.02274411435640502 + 0.0009149581037659101i }, { -0.00011947202463628921 + -0.0003977020071670805i, -0.0006059494883713145 + -0.0023571299873352044i, -0.000367930355888769 + 0.0021982293361317755i, -0.0026725006526125395 + 0.012786383630690259i, -0.0039084471336928855 + 0.002244673205699077i, -0.023417078963566762 + 0.012224283869457708i, 0.02274411435640502 + -0.0009149581037659108i, 0.13340746245647053 + -5.082197683525802e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.112111593234216, 1.0e-7), DoubleNear(0.089855992441146, 1.0e-7), DoubleNear(0.1263688388090064, 1.0e-7), DoubleNear(0.10128299043165306, 1.0e-7), DoubleNear(0.15016660538846816, 1.0e-7), DoubleNear(0.12035659265415409, 1.0e-7), DoubleNear(0.16644992458488517, 1.0e-7), DoubleNear(0.13340746245647053, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.11730759584087774 + 0.0i, 0.016029189447419812 + 0.0006448277805807659i, -0.023201289264992448 + -0.011965534897828381i, -0.0031045061415743203 + -0.001762534302218759i, -0.06443435573700354 + -0.04128832456319191i, -0.008577506248647037 + -0.005995924082760067i, 0.008532467402891902 + 0.014738464983912299i, 0.001084880854286483 + 0.002060801073252727i }, { 0.016029189447419812 + -0.0006448277805807659i, 0.09402052134916869 + -1.0164395367051604e-20i, -0.0032360527691617513 + -0.0015074641039742888i, -0.018595533367050027 + -0.009590221513375095i, -0.009031421589783095 + -0.005287546039459225i, -0.05164330302539378 + -0.03309205830397099i, 0.001246912504438702 + 0.0019669968830151622i, 0.006838662303699988 + 0.011812689125038103i }, { -0.023201289264992448 + 0.011965534897828383i, -0.003236052769161751 + 0.0015074641039742888i, 0.13096729095753884 + 0.0i, 0.017895682740112953 + 0.0007199137187278092i, 0.016955398328931434 + 0.0015936805108587684i, 0.0023080657357550825 + 0.00031096638234752796i, -0.0719373110920842 + -0.046096077389155304i, -0.00957630022595013 + -0.006694109859444514i }, { -0.0031045061415743208 + 0.0017625343022187592i, -0.018595533367050027 + 0.009590221513375095i, 0.017895682740112953 + -0.0007199137187278094i, 0.10496859037345638 + 0.0i, 0.002325586331235802 + 0.00012456222335106864i, 0.013589532537444157 + 0.0012773143241141863i, -0.01008307101198938 + -0.00590324586943693i, -0.05765682473375021 + -0.0369454100326022i }, { -0.06443435573700354 + 0.04128832456319191i, -0.009031421589783095 + 0.005287546039459225i, 0.016955398328931434 + -0.0015936805108587686i, 0.002325586331235802 + -0.00012456222335106875i, 0.14497060278180643 + -1.3552527156068805e-20i, 0.019809128638594672 + 0.0007968884825501892i, -0.02867252428072472 + -0.014787199365145064i, -0.003836598333277049 + -0.002178168075005638i }, { -0.008577506248647037 + 0.005995924082760067i, -0.05164330302539378 + 0.033092058303970995i, 0.0023080657357550825 + -0.000310966382347528i, 0.013589532537444157 + -0.0012773143241141868i, 0.019809128638594676 + -0.0007968884825501892i, 0.1161920637461314 + 2.202285662861181e-20i, -0.003999165759184675 + -0.0018629482452400177i, -0.022980657492351737 + -0.011851749101489662i }, { 0.008532467402891902 + -0.014738464983912299i, 0.001246912504438702 + -0.0019669968830151627i, -0.0719373110920842 + 0.046096077389155304i, -0.01008307101198938 + 0.00590324586943693i, -0.028672524280724716 + 0.014787199365145064i, -0.003999165759184674 + 0.0018629482452400177i, 0.16185147243635273 + 6.776263578034403e-20i, 0.0221157708964154 + 0.0008896808855961065i }, { 0.001084880854286483 + -0.002060801073252727i, 0.006838662303699988 + -0.011812689125038103i, -0.00957630022595013 + 0.006694109859444514i, -0.0576568247337502 + 0.0369454100326022i, -0.003836598333277049 + 0.002178168075005638i, -0.022980657492351737 + 0.011851749101489664i, 0.0221157708964154 + -0.000889680885596107i, 0.12972186251466722 + 1.6940658945086007e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.11730759584087774, 1.0e-7), DoubleNear(0.09402052134916869, 1.0e-7), DoubleNear(0.13096729095753884, 1.0e-7), DoubleNear(0.10496859037345638, 1.0e-7), DoubleNear(0.14497060278180643, 1.0e-7), DoubleNear(0.1161920637461314, 1.0e-7), DoubleNear(0.16185147243635273, 1.0e-7), DoubleNear(0.12972186251466722, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.2622781986226842 + -1.3552527156068805e-20i, 0.03583831808601448 + 0.001441716263130955i, -0.05187381354571717 + -0.026752734262973445i, -0.006941104474851369 + -0.003940702377224397i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03583831808601449 + -0.001441716263130955i, 0.2102125850953001 + 1.1858461261560205e-20i, -0.007235218528346426 + -0.0033704123492143065i, -0.041576190859401764 + -0.021441970614864757i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.051873813545717164 + 0.02675273426297345i, -0.0072352185283464255 + 0.0033704123492143065i, 0.29281876339389157 + 6.776263578034403e-20i, 0.04001145363652835 + 0.0016095946043239158i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00694110447485137 + 0.003940702377224397i, -0.041576190859401764 + 0.02144197061486476i, 0.04001145363652835 + -0.0016095946043239164i, 0.2346904528881236 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2622781986226842, 1.0e-7), DoubleNear(0.2102125850953001, 1.0e-7), DoubleNear(0.29281876339389157, 1.0e-7), DoubleNear(0.2346904528881236, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.10666371160467726 + -2.710505431213761e-20i, 0.014574783740308645 + 0.0005863194444445645i, -0.0029762193932435285 + -0.013422223689606534i, -0.0003328971282654974 + -0.0018504046026708832i, -0.05858791571423532 + -0.037542035639553877i, -0.007799227716115121 + -0.005451884957514389i, -0.003089402236255938 + 0.00842004681109538i, -0.000468427414507334 + 0.0011335531356745073i }, { 0.014574783740308645 + -0.0005863194444445645i, 0.08548958575293306 + -3.5575383784680614e-20i, -0.00048045829257352217 + -0.0018176846593098432i, -0.0023854013629418637 + -0.010757738745867444i, -0.008211957127990117 + -0.004807781472346916i, -0.04695745693812987 + -0.030089456168957966i, -0.00037585915311444634 + 0.001167517387913184i, -0.0024761159482296112 + 0.006748558652906321i }, { -0.0029762193932435285 + 0.013422223689606536i, -0.00048045829257352217 + 0.0018176846593098432i, 0.14161117519373934 + 2.710505431213761e-20i, 0.01935008844722412 + 0.0007784220548640107i, 0.006358939520026554 + -0.006324988747742177i, 0.0009036684619416216 + -0.0008293070993013372i, -0.07778375111485242 + -0.04984236631279334i, -0.010354578758482046 + -0.007238148984690192i }, { -0.00033289712826549737 + 0.0018504046026708832i, -0.0023854013629418637 + 0.010757738745867444i, 0.01935008844722412 + -0.0007784220548640109i, 0.11349952596969201 + 2.541098841762901e-20i, 0.0008341328376341003 + -0.0008992159714106603i, 0.005096607808003438 + -0.005069396702980761i, -0.010902535473782358 + -0.006383010436549239i, -0.06234267082101412 + -0.03994801216761522i }, { -0.05858791571423532 + 0.037542035639553877i, -0.008211957127990117 + 0.004807781472346916i, 0.006358939520026554 + 0.006324988747742177i, 0.0008341328376341003 + 0.0008992159714106602i, 0.13181672043854514 + 1.3552527156068805e-20i, 0.01801175080864402 + 0.0007245829451582964i, -0.0036780595182828355 + -0.016587398667635516i, -0.0004113995944000447 + -0.0022867595974202836i }, { -0.007799227716115121 + 0.005451884957514388i, -0.04695745693812987 + 0.03008945616895797i, 0.0009036684619416216 + 0.0008293070993013372i, 0.005096607808003438 + 0.005069396702980759i, 0.01801175080864402 + -0.0007245829451582966i, 0.10564939711986601 + 5.590417451878382e-20i, -0.0005937580408721453 + -0.0022463237681968227i, -0.0029479171487863725 + -0.01329458556693176i }, { -0.003089402236255938 + -0.00842004681109538i, -0.00037585915311444645 + -0.001167517387913184i, -0.07778375111485242 + 0.04984236631279334i, -0.010902535473782358 + 0.006383010436549239i, -0.0036780595182828364 + 0.016587398667635516i, -0.0005937580408721455 + 0.0022463237681968227i, 0.17500535477961401 + 4.0657581468206416e-20i, 0.023913148726366053 + 0.0009619864229879994i }, { -0.00046842741450733394 + -0.0011335531356745075i, -0.0024761159482296112 + -0.006748558652906321i, -0.010354578758482046 + 0.007238148984690192i, -0.062342670821014114 + 0.03994801216761522i, -0.0004113995944000448 + 0.0022867595974202836i, -0.0029479171487863734 + 0.01329458556693176i, 0.023913148726366056 + -0.0009619864229879996i, 0.14026452914093263 + -1.6940658945086007e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.10666371160467726, 1.0e-7), DoubleNear(0.08548958575293306, 1.0e-7), DoubleNear(0.14161117519373934, 1.0e-7), DoubleNear(0.11349952596969201, 1.0e-7), DoubleNear(0.13181672043854514, 1.0e-7), DoubleNear(0.10564939711986601, 1.0e-7), DoubleNear(0.17500535477961401, 1.0e-7), DoubleNear(0.14026452914093263, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.2384804320432224 + -1.3552527156068805e-20i, 0.03258653454895266 + 0.001310902389602861i, -0.006654278911526364 + -0.030009622357242048i, -0.0007442967226655422 + -0.004137164200091166i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03258653454895266 + -0.001310902389602861i, 0.19113898287279907 + 2.0328790734103208e-20i, -0.0010742163334456676 + -0.004064008427506666i, -0.005333318511728236 + -0.024052324312799203i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006654278911526364 + 0.03000962235724205i, -0.0010742163334456676 + 0.004064008427506666i, 0.3166165299733533 + 6.776263578034403e-20i, 0.04326323717359017 + 0.00174040847785201i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0007442967226655422 + 0.004137164200091166i, -0.005333318511728237 + 0.024052324312799203i, 0.04326323717359018 + -0.0017404084778520105i, 0.2537640551106246 + 8.470329472543003e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.2384804320432224, 1.0e-7), DoubleNear(0.19113898287279907, 1.0e-7), DoubleNear(0.3166165299733533, 1.0e-7), DoubleNear(0.2537640551106246, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.24827488679841658 + 0.0i, 0.03392487218753276 + 0.001364741499308575i, -0.13637166682908775 + -0.08738440195234722i, -0.01815380647459717 + -0.012690033942204582i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03392487218753276 + -0.0013647414993085754i, 0.19898911172262507 + -1.0164395367051604e-20i, -0.019114492601772476 + -0.011190791908896155i, -0.109300127759144 + -0.07003746833657318i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13637166682908775 + 0.08738440195234722i, -0.019114492601772476 + 0.011190791908896155i, 0.3068220752181592 + 5.421010862427522e-20i, 0.04192489953501007 + 0.0016865693681462957i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01815380647459717 + 0.01269003394220458i, -0.10930012775914398 + 0.07003746833657319i, 0.04192489953501008 + -0.0016865693681462962i, 0.24591392626079864 + 3.8963515573697816e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.24827488679841658, 1.0e-7), DoubleNear(0.19898911172262507, 1.0e-7), DoubleNear(0.3068220752181592, 1.0e-7), DoubleNear(0.24591392626079864, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.25731071662704424 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.02990616014854959 + 0.010448179457098437i, 0.0 + 0.0i, -0.05054430255266425 + -0.026028019443583572i, 0.0 + 0.0i, 0.00038075969200261454 + 0.011233730361787448i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02990616014854959 + -0.010448179457098434i, 0.0 + 0.0i, 0.21518006709094006 + -5.082197683525802e-21i, 0.0 + 0.0i, -0.014012148971117237 + 0.00423523807039383i, 0.0 + 0.0i, -0.04290570185245468 + -0.02216668543425463i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05054430255266425 + 0.026028019443583572i, 0.0 + 0.0i, -0.014012148971117237 + -0.00423523807039383i, 0.0 + 0.0i, 0.28458245639139346 + 2.710505431213761e-20i, 0.0 + 0.0i, 0.030385037114208462 + 0.002135942229700983i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00038075969200261476 + -0.011233730361787448i, 0.0 + 0.0i, -0.04290570185245468 + 0.02216668543425463i, 0.0 + 0.0i, 0.030385037114208462 + -0.0021359422297009822i, 0.0 + 0.0i, 0.2429267598906217 + 5.759824041329242e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.25731071662704424, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21518006709094006, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28458245639139346, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2429267598906217, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.22918910829328643 + 2.236166980751353e-19i, 0.0 + 0.0i, 0.023774256457138335 + 0.00611833153351424i, 0.0 + 0.0i, -0.008345440397903584 + -0.031519582110664426i, 0.0 + 0.0i, -0.0004661720049773532 + -0.004271256262828727i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.023774256457138335 + -0.006118331533514238i, 0.0 + 0.0i, 0.2004303066227351 + -2.168404344971009e-19i, 0.0 + 0.0i, -0.002799361291099155 + -0.004266569715349997i, 0.0 + 0.0i, -0.003642157025351017 + -0.02254236455937683i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008345440397903584 + 0.031519582110664426i, 0.0 + 0.0i, -0.0027993612910991554 + 0.004266569715349997i, 0.0 + 0.0i, 0.3127040647251513 + -1.9312351197398048e-19i, 0.0 + 0.0i, 0.03651694080561972 + 0.0064657901532851805i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004661720049773536 + 0.004271256262828727i, 0.0 + 0.0i, -0.003642157025351017 + 0.02254236455937683i, 0.0 + 0.0i, 0.03651694080561972 + -0.006465790153285179i, 0.0 + 0.0i, 0.2576765203588267 + 2.693564772268675e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.22918910829328643, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2004303066227351, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3127040647251513, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2576765203588267, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.24236930733548123 + 3.3881317890172014e-21i, 0.0 + 0.0i, 0.026966081963362063 + 0.005628424583513267i, 0.0 + 0.0i, -0.13312786829055082 + -0.08530583679336005i, 0.0 + 0.0i, -0.012830830657535534 + -0.012582716793174319i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026966081963362063 + -0.005628424583513265i, 0.0 + 0.0i, 0.20489469118556045 + -1.3552527156068805e-20i, 0.0 + 0.0i, -0.016792862601294194 + -0.006399589276948916i, 0.0 + 0.0i, -0.11254392629768091 + -0.07211603349556035i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13312786829055082 + 0.08530583679336005i, 0.0 + 0.0i, -0.016792862601294194 + 0.006399589276948914i, 0.0 + 0.0i, 0.29952386568295647 + 2.710505431213761e-20i, 0.0 + 0.0i, 0.03332511529939599 + 0.0069556971032861525i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012830830657535534 + 0.012582716793174315i, 0.0 + 0.0i, -0.1125439262976809 + 0.07211603349556035i, 0.0 + 0.0i, 0.03332511529939599 + -0.006955697103286151i, 0.0 + 0.0i, 0.2532121357960013 + 6.606856988583543e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24236930733548123, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20489469118556045, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29952386568295647, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2532121357960013, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.5418931730184378 + 3.049318610115481e-20i, 0.0 + 0.0i, 0.060291197262758056 + 0.01258412168679942i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.060291197262758056 + -0.012584121686799416i, 0.0 + 0.0i, 0.4581068269815618 + 5.251604272976662e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5418931730184378, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4581068269815618, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.201967585675362 + -8.809142651444724e-20i, 0.0 + 0.0i, -0.04081588648651027 + -0.020718417179588867i, 0.0 + 0.0i, -0.005980669116525191 + -0.025322238151425452i, 0.0 + 0.0i, -0.0013619810085313258 + 0.0052980757290828516i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04081588648651027 + 0.020718417179588867i, 0.0 + 0.0i, 0.2276518292406595 + 9.486769009248164e-20i, 0.0 + 0.0i, 0.0033854934755258746 + 0.004718958761437263i, 0.0 + 0.0i, -0.006006928306729409 + -0.028739708518615802i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0059806691165251915 + 0.025322238151425452i, 0.0 + 0.0i, 0.003385493475525875 + -0.004718958761437263i, 0.0 + 0.0i, 0.27052319804262226 + 8.639736061993863e-20i, 0.0 + 0.0i, -0.052634117918608656 + -0.027476287698249332i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0013619810085313258 + -0.005298075729082852i, 0.0 + 0.0i, -0.006006928306729411 + 0.028739708518615802i, 0.0 + 0.0i, -0.052634117918608656 + 0.027476287698249335i, 0.0 + 0.0i, 0.29985738704135567 + -1.0164395367051604e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.201967585675362, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2276518292406595, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27052319804262226, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29985738704135567, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.21132811719004643 + -1.0164395367051604e-20i, 0.0 + 0.0i, -0.04179682263204247 + -0.021555756411203476i, 0.0 + 0.0i, -0.11607765876239731 + -0.0743803828671629i, 0.0 + 0.0i, 0.01537112970659189 + 0.0265511541089504i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04179682263204247 + 0.021555756411203476i, 0.0 + 0.0i, 0.23593588133099522 + 0.0i, 0.0 + 0.0i, 0.030544930866375584 + 0.0028709948349729545i, 0.0 + 0.0i, -0.1295941358258344 + -0.0830414874217575i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11607765876239731 + 0.0743803828671629i, 0.0 + 0.0i, 0.030544930866375584 + -0.0028709948349729558i, 0.0 + 0.0i, 0.26116266652793785 + 8.470329472543003e-21i, 0.0 + 0.0i, -0.051653181773076456 + -0.026638948466634726i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01537112970659189 + -0.0265511541089504i, 0.0 + 0.0i, -0.1295941358258344 + 0.0830414874217575i, 0.0 + 0.0i, -0.051653181773076456 + 0.026638948466634726i, 0.0 + 0.0i, 0.29157333495102 + 8.470329472543003e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.21132811719004643, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23593588133099522, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26116266652793785, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29157333495102, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.47249078371798425 + -1.6940658945086007e-21i, 0.0 + 0.0i, -0.09345000440511893 + -0.0481947048778382i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09345000440511893 + 0.0481947048778382i, 0.0 + 0.0i, 0.5275092162820152 + 8.470329472543003e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.47249078371798425, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5275092162820152, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.19215329735761033 + -6.268043809681823e-20i, 0.0 + 0.0i, -0.005361620756185392 + -0.024179962435473976i, 0.0 + 0.0i, -0.10554537265236519 + -0.06763149180851184i, 0.0 + 0.0i, -0.005565518184485549 + 0.015168605464001702i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005361620756185392 + 0.024179962435473976i, 0.0 + 0.0i, 0.2551107011634313 + 5.251604272976662e-20i, 0.0 + 0.0i, 0.011455547328029992 + -0.011394385450722938i, 0.0 + 0.0i, -0.14012642193586652 + -0.08979037848040856i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.10554537265236519 + 0.06763149180851184i, 0.0 + 0.0i, 0.011455547328029992 + 0.011394385450722938i, 0.0 + 0.0i, 0.23746611755841118 + 6.945670167485263e-20i, 0.0 + 0.0i, -0.006625976667069208 + -0.029881984234567276i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0055655181844855494 + -0.015168605464001703i, 0.0 + 0.0i, -0.14012642193586652 + 0.08979037848040856i, 0.0 + 0.0i, -0.00662597666706921 + 0.029881984234567276i, 0.0 + 0.0i, 0.31526988392054667 + 2.371692252312041e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.19215329735761033, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2551107011634313, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23746611755841118, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.31526988392054667, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.4296194149160215 + 6.776263578034403e-21i, 0.0 + 0.0i, -0.0119875974232546 + -0.05406194667004125i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011987597423254602 + 0.05406194667004125i, 0.0 + 0.0i, 0.570380585083978 + 7.623296525288703e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.4296194149160215, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.570380585083978, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.44726399852104165 + -1.0164395367051604e-20i, 0.0 + 0.0i, -0.2456717945882317 + -0.1574218702889204i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.2456717945882317 + 0.1574218702889204i, 0.0 + 0.0i, 0.5527360014789579 + 9.317362419797304e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.44726399852104165, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5527360014789579, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.10829650587837336 + 0.0i, 0.01181149240312711 + 0.004989152662509924i, -0.02168548032003545 + -0.011176943533835495i, 0.0009747769344844264 + 0.005066582159144122i, -0.004122096748256709 + -0.01440339917090724i, -8.838192267147292e-05 + -0.001877387507557253i, -0.0007921331523736647 + 0.0033649514941832314i, 0.0005005885397121736 + 0.00034081019628536354i }, { 0.01181149240312711 + -0.004989152662509924i, 0.09367107979698865 + -8.809142651444724e-20i, -0.006420362411333402 + 0.0016762393969804615i, -0.01913040616647482 + -0.009541473645753374i, -0.0016772465412799146 + -0.0020543437820038177i, -0.0018585723682684816 + -0.01091883898051821i, 0.0004114417995633172 + 0.0005017759134801082i, -0.0005698478561576611 + 0.0019331242348996202i }, { -0.021685480320035453 + 0.011176943533835495i, -0.006420362411333401 + -0.001676239396980461i, 0.12089260241491305 + 2.236166980751353e-19i, 0.011962764054011225 + 0.0011291788710043155i, 0.0022958976607623935 + 0.003059744079080277i, -0.00022064146706570373 + 0.0008753023069867931i, -0.004223343649646874 + -0.017116182939757186i, -0.0003777900823058803 + -0.0023938687552714742i }, { 0.0009747769344844265 + -0.005066582159144122i, -0.01913040616647482 + 0.009541473645753374i, 0.011962764054011225 + -0.001129178871004315i, 0.10675922682574643 + -1.2874900798265365e-19i, -0.0002625317202144218 + 0.00038392920101226757i, 0.0010895958147634811 + 0.0016592146823569856i, -0.0011221147498192403 + -0.002212225933346179i, -0.0017835846570825355 + -0.011623525578858616i }, { -0.0041220967482567105 + 0.01440339917090724i, -0.0016772465412799148 + 0.0020543437820038177i, 0.002295897660762394 + -0.003059744079080277i, -0.00026253172021442156 + -0.00038392920101226773i, 0.14901421074867086 + 3.3881317890172014e-21i, 0.018094667745422482 + 0.005459026794588513i, -0.028858822232628797 + -0.014851075909748077i, -0.0005940172424818118 + 0.006167148202643325i }, { -8.838192267147306e-05 + 0.0018773875075572535i, -0.0018585723682684816 + 0.01091883898051821i, -0.00022064146706570387 + -0.0008753023069867931i, 0.0010895958147634811 + -0.0016592146823569854i, 0.01809466774542248 + -0.005459026794588512i, 0.1215089872939514 + 8.300922883092143e-20i, -0.007591786559783835 + 0.0025589986734133687i, -0.02377529568597986 + -0.012625211788501256i }, { -0.0007921331523736648 + -0.003364951494183232i, 0.00041144179956331705 + -0.0005017759134801083i, -0.004223343649646875 + 0.01711618293975719i, -0.0011221147498192403 + 0.002212225933346179i, -0.02885882223262879 + 0.014851075909748077i, -0.007591786559783835 + -0.0025589986734133683i, 0.16368985397648045 + -1.9651164376299768e-19i, 0.01842227306019724 + 0.0010067633586966678i }, { 0.0005005885397121737 + -0.00034081019628536344i, -0.0005698478561576611 + -0.0019331242348996202i, -0.0003777900823058805 + 0.002393868755271474i, -0.0017835846570825355 + 0.011623525578858616i, -0.0005940172424818117 + -0.006167148202643325i, -0.023775295685979865 + 0.012625211788501258i, 0.01842227306019724 + -0.0010067633586966671i, 0.13616753306487528 + 1.8634724839594607e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.10829650587837336, 1.0e-7), DoubleNear(0.09367107979698865, 1.0e-7), DoubleNear(0.12089260241491305, 1.0e-7), DoubleNear(0.10675922682574643, 1.0e-7), DoubleNear(0.14901421074867086, 1.0e-7), DoubleNear(0.1215089872939514, 1.0e-7), DoubleNear(0.16368985397648045, 1.0e-7), DoubleNear(0.13616753306487528, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.11508581998092653 + 3.3881317890172014e-21i, 0.013375948768450927 + 0.004673094521247256i, -0.022606646862161916 + -0.011641396049920613i, 0.00017030010232072987 + 0.0050244431599202844i, -0.06321398552054994 + -0.04050633425681173i, -0.005702328081686526 + -0.007274706661149928i, 0.008319930013598261 + 0.01435112888657203i, 0.0016748929270328664 + -0.0028197506007463144i }, { 0.013375948768450925 + -0.004673094521247255i, 0.0962422972091199 + -1.3552527156068805e-20i, -0.006267129776694398 + 0.0018942695140528865i, -0.019190175769880555 + -0.009914360361282865i, -0.008991871984187955 + -0.0021410606663393858i, -0.052863673241847375 + -0.03387404861035117i, 0.004109108881932254 + 0.001165340160538196i, 0.0070511996929936305 + 0.012200025222378372i }, { -0.02260664686216192 + 0.011641396049920615i, -0.006267129776694398 + -0.0018942695140528863i, 0.1272834873545547 + 0.0i, 0.013590133194911137 + 0.0009553300622660115i, 0.016514689015048885 + 0.001562428394006894i, 0.0027756706856117822 + 0.0032462972350623003i, -0.06991388277000088 + -0.044799502536548325i, -0.007128502575849007 + -0.00530801013202439i }, { 0.00017030010232072992 + -0.0050244431599202844i, -0.01919017576988056 + 0.009914360361282865i, 0.013590133194911137 + -0.000955330062266011i, 0.10865239397644053 + 0.0i, -0.0018619767607151562 + 0.002699870795054944i, 0.0140302418513267 + 0.0013085664409660607i, -0.007800990617106238 + -0.004258528610609529i, -0.059680253055833535 + -0.038241984885209176i }, { -0.06321398552054994 + 0.04050633425681173i, -0.008991871984187955 + 0.0021410606663393858i, 0.016514689015048885 + -0.001562428394006895i, -0.0018619767607151558 + -0.002699870795054944i, 0.1422248966461177 + 0.0i, 0.016530211380098664 + 0.005775084935851181i, -0.02793765569050233 + -0.01438662339366296i, 0.00021045958968188467 + 0.006209287201867163i }, { -0.005702328081686527 + 0.007274706661149925i, -0.052863673241847375 + 0.033874048610351176i, 0.0027756706856117827 + -0.0032462972350623003i, 0.0140302418513267 + -0.0013085664409660607i, 0.016530211380098664 + -0.00577508493585118i, 0.11893776988182014 + 8.470329472543003e-21i, -0.0077450191944228395 + 0.0023409685563409435i, -0.023715526082574125 + -0.012252325072971765i }, { 0.00831993001359826 + -0.014351128886572032i, 0.004109108881932253 + -0.001165340160538196i, -0.06991388277000088 + 0.044799502536548325i, -0.007800990617106238 + 0.004258528610609529i, -0.027937655690502328 + 0.01438662339366296i, -0.007745019194422839 + -0.0023409685563409435i, 0.1572989690368388 + 2.710505431213761e-20i, 0.016794903919297326 + 0.0011806121674349719i }, { 0.0016748929270328664 + 0.0028197506007463144i, 0.0070511996929936305 + -0.012200025222378372i, -0.007128502575849007 + 0.005308010132024388i, -0.05968025305583352 + 0.038241984885209176i, 0.00021045958968188484 + -0.006209287201867163i, -0.023715526082574125 + 0.012252325072971767i, 0.016794903919297326 + -0.001180612167434971i, 0.13427436591418118 + 5.759824041329242e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.11508581998092653, 1.0e-7), DoubleNear(0.0962422972091199, 1.0e-7), DoubleNear(0.1272834873545547, 1.0e-7), DoubleNear(0.10865239397644053, 1.0e-7), DoubleNear(0.1422248966461177, 1.0e-7), DoubleNear(0.11893776988182014, 1.0e-7), DoubleNear(0.1572989690368388, 1.0e-7), DoubleNear(0.13427436591418118, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.25731071662704424 + 3.3881317890172014e-21i, 0.02990616014854959 + 0.010448179457098437i, -0.05054430255266425 + -0.026028019443583572i, 0.00038075969200261454 + 0.011233730361787448i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02990616014854959 + -0.010448179457098434i, 0.21518006709094006 + -5.082197683525802e-21i, -0.014012148971117237 + 0.00423523807039383i, -0.04290570185245468 + -0.02216668543425463i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05054430255266425 + 0.026028019443583572i, -0.014012148971117237 + -0.00423523807039383i, 0.28458245639139346 + 2.710505431213761e-20i, 0.030385037114208462 + 0.002135942229700983i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00038075969200261476 + -0.011233730361787448i, -0.04290570185245468 + 0.02216668543425463i, 0.030385037114208462 + -0.0021359422297009822i, 0.2429267598906217 + 5.759824041329242e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.25731071662704424, 1.0e-7), DoubleNear(0.21518006709094006, 1.0e-7), DoubleNear(0.28458245639139346, 1.0e-7), DoubleNear(0.2429267598906217, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.10250803699272736 + 0.0i, 0.010633369004884392 + 0.002736509425956957i, -0.003732615041785392 + -0.014097574326528072i, -0.00020850195494474198 + -0.0019103791548208187i, -0.05630529953448829 + -0.036079378077379085i, -0.004877505055772543 + -0.005245689403935374i, -0.0029116322474038924 + 0.009057227137620753i, -0.0005578638363281825 + 0.001122712860135229i }, { 0.010633369004884392 + -0.0027365094259569566i, 0.08964526036488296 + -6.268043809681823e-20i, -0.0012520535243620342 + -0.0019082830308562232i, -0.0016290057144000007 + -0.010082388108945906i, -0.006803823441879525 + -0.0022394864284869496i, -0.0492400731178769 + -0.03155211373113276i, 1.6072727776695697e-05 + 0.0014888565287650714i, -0.0026538859370816566 + 0.006111378326380949i }, { -0.003732615041785392 + 0.014097574326528074i, -0.0012520535243620346 + 0.0019082830308562232i, 0.13986127034275386 + 3.3881317890172014e-21i, 0.01633271295847767 + 0.0028919151575563106i, 0.007012110885768095 + -0.006429717465975364i, 0.0013593754963936227 + -0.0006074951486465991i, -0.07682256875606253 + -0.04922645871598097i, -0.00795332560176299 + -0.0073370273892389435i }, { -0.0002085019549447423 + 0.0019103791548208187i, -0.0016290057144000003 + 0.010082388108945906i, 0.01633271295847767 + -0.0028919151575563093i, 0.11524943082067748 + 4.912791094074942e-20i, 0.0007869144624273437 + -0.0009759415223354868i, 0.0044434364422618975 + -0.004964667984747574i, -0.009989039159414669 + -0.004160102848461966i, -0.06330385317980401 + -0.040563919764427595i }, { -0.05630529953448829 + 0.036079378077379085i, -0.006803823441879525 + 0.002239486428486949i, 0.0070121108857680945 + 0.006429717465975364i, 0.0007869144624273439 + 0.0009759415223354871i, 0.12668107130055906 + 2.236166980751353e-19i, 0.013140887452253943 + 0.003381822107557283i, -0.0046128253561181914 + -0.017422007784136356i, -0.00025767005003261124 + -0.002360877108007908i }, { -0.0048775050557725436 + 0.0052456894039353726i, -0.0492400731178769 + 0.03155211373113276i, 0.0013593754963936227 + 0.000607495148646599i, 0.0044434364422618975 + 0.004964667984747573i, 0.013140887452253943 + -0.0033818221075572817i, 0.11078504625785211 + -1.5415999640028266e-19i, -0.0015473077667371208 + -0.0023582866844937735i, -0.002013151310951016 + -0.012459976450430923i }, { -0.0029116322474038933 + -0.009057227137620753i, 1.607272777669567e-05 + -0.0014888565287650714i, -0.07682256875606253 + 0.04922645871598097i, -0.009989039159414669 + 0.004160102848461965i, -0.004612825356118193 + 0.017422007784136356i, -0.0015473077667371208 + 0.0023582866844937735i, 0.1728427943823974 + -1.9651164376299768e-19i, 0.020184227847142047 + 0.00357387499572887i }, { -0.0005578638363281825 + -0.001122712860135229i, -0.002653885937081656 + -0.006111378326380948i, -0.00795332560176299 + 0.007337027389238942i, -0.063303853179804 + 0.040563919764427595i, -0.0002576700500326113 + 0.002360877108007908i, -0.0020131513109510166 + 0.012459976450430923i, 0.020184227847142047 + -0.0035738749957288695i, 0.1424270895381492 + 2.202285662861181e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.10250803699272736, 1.0e-7), DoubleNear(0.08964526036488296, 1.0e-7), DoubleNear(0.13986127034275386, 1.0e-7), DoubleNear(0.11524943082067748, 1.0e-7), DoubleNear(0.12668107130055906, 1.0e-7), DoubleNear(0.11078504625785211, 1.0e-7), DoubleNear(0.1728427943823974, 1.0e-7), DoubleNear(0.1424270895381492, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.22918910829328643 + 2.236166980751353e-19i, 0.023774256457138335 + 0.00611833153351424i, -0.008345440397903584 + -0.031519582110664426i, -0.0004661720049773532 + -0.004271256262828727i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.023774256457138335 + -0.006118331533514238i, 0.2004303066227351 + -2.168404344971009e-19i, -0.002799361291099155 + -0.004266569715349997i, -0.003642157025351017 + -0.02254236455937683i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008345440397903584 + 0.031519582110664426i, -0.0027993612910991554 + 0.004266569715349997i, 0.3127040647251513 + -1.9312351197398048e-19i, 0.03651694080561972 + 0.0064657901532851805i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004661720049773536 + 0.004271256262828727i, -0.003642157025351017 + 0.02254236455937683i, 0.03651694080561972 + -0.006465790153285179i, 0.2576765203588267 + 2.693564772268675e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.22918910829328643, 1.0e-7), DoubleNear(0.2004303066227351, 1.0e-7), DoubleNear(0.3127040647251513, 1.0e-7), DoubleNear(0.2576765203588267, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.24236930733548123 + 3.3881317890172014e-21i, 0.026966081963362063 + 0.005628424583513267i, -0.13312786829055082 + -0.08530583679336005i, -0.012830830657535534 + -0.012582716793174319i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026966081963362063 + -0.005628424583513265i, 0.20489469118556045 + -1.3552527156068805e-20i, -0.016792862601294194 + -0.006399589276948916i, -0.11254392629768091 + -0.07211603349556035i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13312786829055082 + 0.08530583679336005i, -0.016792862601294194 + 0.006399589276948914i, 0.29952386568295647 + 2.710505431213761e-20i, 0.03332511529939599 + 0.0069556971032861525i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012830830657535534 + 0.012582716793174315i, -0.1125439262976809 + 0.07211603349556035i, 0.03332511529939599 + -0.006955697103286151i, 0.2532121357960013 + 6.606856988583543e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.24236930733548123, 1.0e-7), DoubleNear(0.20489469118556045, 1.0e-7), DoubleNear(0.29952386568295647, 1.0e-7), DoubleNear(0.2532121357960013, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.09033282994080351 + -4.2351647362715017e-20i, -0.018255476593137546 + -0.009266602110769965i, -0.002674937982888364 + -0.011325725487108624i, -0.0006091650717854418 + 0.0023696385350568806i, -0.04961773922151866 + -0.03179411507475327i, 0.0067657800990135585 + 0.011515243917743972i, -0.0025169923750036913 + 0.007162447807553861i, 0.0011686333087655395 + -0.0010871821745671478i }, { -0.018255476593137546 + 0.009266602110769965i, 0.10182046741680681 + -2.0328790734103208e-20i, 0.0015142093488306019 + 0.002110620364496334i, -0.002686682773297028 + -0.012854236948365353i, 0.01328884406268752 + 0.0013353824586694709i, -0.05592763343084653 + -0.03583737673375857i, -8.88529436574503e-05 + -0.001692265782278373i, -0.0030485258094818577 + 0.00800615765644784i }, { -0.002674937982888364 + 0.011325725487108623i, 0.001514209348830602 + -0.002110620364496334i, 0.12099528724924292 + 3.218725199566341e-20i, -0.023541346038904926 + -0.012289154300433511i, 0.0054555558043940106 + -0.005279471571748701i, -0.0015745875717409336 + 0.0006263643527419312i, -0.06645991954087865 + -0.042586267792409635i, 0.008605349607578331 + 0.015035910191206429i }, { -0.000609165071785442 + -0.002369638535056881i, -0.002686682773297028 + 0.012854236948365353i, -0.02354134603890493 + 0.012289154300433511i, 0.1341154139141884 + 2.0328790734103208e-20i, -0.0004994326716435775 + 0.0015159933698891304i, 0.005999991523635982 + -0.006114913878974237i, 0.017256086803688064 + 0.0015356123763034838i, -0.07366650239498787 + -0.04720411068799893i }, { -0.04961773922151866 + 0.03179411507475327i, 0.01328884406268752 + -0.0013353824586694713i, 0.005455555804394009 + 0.0052794715717487005i, -0.0004994326716435777 + -0.0015159933698891304i, 0.1116347557345585 + -4.573977915173222e-20i, -0.022560409893372727 + -0.011451815068818904i, -0.0033057311336368266 + -0.013996512664316826i, -0.000752815936745884 + 0.002928437194025971i }, { 0.0067657800990135585 + -0.011515243917743972i, -0.05592763343084653 + 0.03583737673375857i, -0.0015745875717409334 + -0.0006263643527419311i, 0.005999991523635982 + 0.006114913878974237i, -0.022560409893372727 + 0.011451815068818904i, 0.12583136182385268 + 1.1519648082658485e-19i, 0.001871284126695273 + 0.002608338396940929i, -0.003320245533432381 + -0.01588547157025045i }, { -0.002516992375003692 + -0.007162447807553862i, -8.885294365745025e-05 + 0.001692265782278373i, -0.06645991954087865 + 0.042586267792409635i, 0.017256086803688064 + -0.0015356123763034845i, -0.0033057311336368274 + 0.013996512664316828i, 0.001871284126695273 + -0.002608338396940929i, 0.14952791079337935 + 5.421010862427522e-20i, -0.02909277187970373 + -0.01518713339781582i }, { 0.0011686333087655393 + 0.0010871821745671478i, -0.0030485258094818573 + -0.00800615765644784i, 0.008605349607578331 + -0.015035910191206429i, -0.07366650239498787 + 0.04720411068799893i, -0.0007528159367458839 + -0.002928437194025971i, -0.0033202455334323828 + 0.01588547157025045i, -0.029092771879703726 + 0.015187133397815822i, 0.1657419731271673 + -3.049318610115481e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.09033282994080351, 1.0e-7), DoubleNear(0.10182046741680681, 1.0e-7), DoubleNear(0.12099528724924292, 1.0e-7), DoubleNear(0.1341154139141884, 1.0e-7), DoubleNear(0.1116347557345585, 1.0e-7), DoubleNear(0.12583136182385268, 1.0e-7), DoubleNear(0.14952791079337935, 1.0e-7), DoubleNear(0.1657419731271673, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.201967585675362 + -8.809142651444724e-20i, -0.04081588648651027 + -0.020718417179588867i, -0.005980669116525191 + -0.025322238151425452i, -0.0013619810085313258 + 0.0052980757290828516i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04081588648651027 + 0.020718417179588867i, 0.2276518292406595 + 9.486769009248164e-20i, 0.0033854934755258746 + 0.004718958761437263i, -0.006006928306729409 + -0.028739708518615802i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0059806691165251915 + 0.025322238151425452i, 0.003385493475525875 + -0.004718958761437263i, 0.27052319804262226 + 8.639736061993863e-20i, -0.052634117918608656 + -0.027476287698249332i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0013619810085313258 + -0.005298075729082852i, -0.006006928306729411 + 0.028739708518615802i, -0.052634117918608656 + 0.027476287698249335i, 0.29985738704135567 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.201967585675362, 1.0e-7), DoubleNear(0.2276518292406595, 1.0e-7), DoubleNear(0.27052319804262226, 1.0e-7), DoubleNear(0.29985738704135567, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.21132811719004643 + -1.0164395367051604e-20i, -0.04179682263204247 + -0.021555756411203476i, -0.11607765876239731 + -0.0743803828671629i, 0.01537112970659189 + 0.0265511541089504i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04179682263204247 + 0.021555756411203476i, 0.23593588133099522 + 0.0i, 0.030544930866375584 + 0.0028709948349729545i, -0.1295941358258344 + -0.0830414874217575i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11607765876239731 + 0.0743803828671629i, 0.030544930866375584 + -0.0028709948349729558i, 0.26116266652793785 + 8.470329472543003e-21i, -0.051653181773076456 + -0.026638948466634726i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01537112970659189 + -0.0265511541089504i, -0.1295941358258344 + 0.0830414874217575i, -0.051653181773076456 + 0.026638948466634726i, 0.29157333495102 + 8.470329472543003e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.21132811719004643, 1.0e-7), DoubleNear(0.23593588133099522, 1.0e-7), DoubleNear(0.26116266652793785, 1.0e-7), DoubleNear(0.29157333495102, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.19215329735761033 + -6.268043809681823e-20i, -0.005361620756185392 + -0.024179962435473976i, -0.10554537265236519 + -0.06763149180851184i, -0.005565518184485549 + 0.015168605464001702i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005361620756185392 + 0.024179962435473976i, 0.2551107011634313 + 5.251604272976662e-20i, 0.011455547328029992 + -0.011394385450722938i, -0.14012642193586652 + -0.08979037848040856i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.10554537265236519 + 0.06763149180851184i, 0.011455547328029992 + 0.011394385450722938i, 0.23746611755841118 + 6.945670167485263e-20i, -0.006625976667069208 + -0.029881984234567276i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0055655181844855494 + -0.015168605464001703i, -0.14012642193586652 + 0.08979037848040856i, -0.00662597666706921 + 0.029881984234567276i, 0.31526988392054667 + 2.371692252312041e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.19215329735761033, 1.0e-7), DoubleNear(0.2551107011634313, 1.0e-7), DoubleNear(0.23746611755841118, 1.0e-7), DoubleNear(0.31526988392054667, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));


}
}

}
