#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { 0.022171617020099618 + -0.13368047038212325i, -0.034937799925011434 + -0.008031756400278i, -0.12090246628250327 + 0.10403656078608478i, -0.03897186867887724 + -0.016809773496716862i }, { 0.016842975894957514 + 0.015683853606309084i, 0.061655108746504976 + -0.03256720359935303i, 0.13449907332573238 + -0.03500681757819095i, 0.013912530749436157 + -0.02798400595321158i }, { 0.06156171949950984 + -0.02341820070803714i, -0.00878222401370987 + 0.06451145376714118i, -0.039572278110690806 + 0.061667603773478345i, 0.12261734070945579 + 0.13765368013285056i }, { 0.05321856455646034 + -0.10647064705452151i, -0.07004371841908247 + 0.03268459744245755i, -0.06210322654781816 + -0.09555792180094425i, 0.09623374374321882 + -0.04559858213459029i } }), Matrix({ { -0.024295917952959257 + 0.11102980489257401i, -0.045208789201891385 + -0.08506161382404788i, -0.08287155311213874 + 0.07478279968218854i, 0.06102453478083186 + 0.052425609886798376i }, { -0.034580083263261285 + -0.1713882274599647i, -0.04072227305850767 + -0.10181316300465246i, 0.11471864217745201 + 0.009239333955925723i, 0.025678225796138897 + -0.05191240003255846i }, { -0.17059268304473663 + -0.02030909645093587i, -0.024187512558022775 + 0.0641439162861208i, -0.04263024932833566 + 0.05541097834419985i, 0.0343867763161121 + -0.020724684788336743i }, { -0.08290022097567197 + -0.08222527974379094i, 0.06358706787238116 + -0.033626371889622454i, 0.009835922431549947 + 0.06077007798568094i, 0.10454627432470937 + -0.020557932727095836i } }), Matrix({ { 0.17370745548235353 + -0.011287735072269132i, 0.01309680951584106 + -0.04633398307457139i, -0.05104670389584804 + -0.06274257408763062i, 0.15855628352216242 + -0.0714223074091486i }, { -0.11590612882839563 + -0.08741707159644758i, 0.019493661100895635 + 0.06355073682786753i, 0.008009076375503726 + -0.04912381239524561i, 0.004127609490055098 + -0.1468706565373205i }, { 0.053252340071010575 + -0.09476573394098073i, -0.07100015779487992 + 0.08529098483744912i, -0.12887869176654862 + -0.04237139209096979i, -0.12254281464438631 + 0.10242259919027459i }, { 0.07391886979683596 + 0.06752829197802125i, -0.02339057790704541 + -0.11392304882168966i, -0.012116312630320324 + 0.12267035653157952i, 0.048151356647354406 + 0.025549002106539424i } }), Matrix({ { 0.04759446590765097 + -0.033120582696968735i, -0.022861414707795444 + 0.03555719316537286i, 0.2352690618910292 + -0.05969628332552065i, 0.016354888832886532 + 0.00752209249653245i }, { 0.10069135916253973 + -0.0016919046305108856i, -0.01161879057667061 + 0.002893278668404297i, 0.0628979992464739 + -0.16121207805073468i, 0.04929439233026812 + 0.07951798702120941i }, { 0.023081873034808353 + 0.06895597632401532i, 0.02102918032745185 + 0.09436047642965677i, 0.06089750262220267 + 0.03796728109366031i, -0.018754346215318428 + 0.11032491693483086i }, { 0.026386365837382963 + -0.04605988040810514i, -0.13420255302976575 + 0.008604701020577553i, 0.06173144353054639 + -0.0010729791409327403i, -0.02601074153856226 + 0.07798892826754047i } }), Matrix({ { -0.006814459249824719 + -0.03484064445989844i, -0.08002290628153655 + 0.0038543566463604723i, 0.0404170405109726 + -0.06164665766450007i, -0.0652117655695641 + -0.00752214533007528i }, { -0.02115983681142156 + -0.06628730404384588i, -0.10362032443302031 + 0.1212295835096733i, 0.04285323021778704 + 0.06725511892913791i, 0.02354629397096907 + -0.03672874062981262i }, { 0.12844979294926098 + 0.019354403316357904i, -0.14130138957335545 + 0.11361715062561814i, 0.1375950961784768 + 0.15556109304876817i, 0.12356498953981797 + 0.04215946187688904i }, { -0.038125954649485455 + -0.054981746666598774i, -0.11869023227940857 + 0.01870274174809996i, 0.005987638079667306 + -0.15703329764093837i, 0.16356974981849604 + -0.0940294153552165i } }), Matrix({ { 0.09097433145455126 + -0.08161383717874829i, -0.12617980600276285 + -0.17146582464460436i, 0.07075268427057367 + 0.0239055250896616i, -0.1491440419394691 + 0.1128082163881698i }, { -0.06486444302620578 + 0.07557661937094944i, -0.014863985418266688 + 0.07485757061502732i, 0.016751259464797157 + -0.11470887060749381i, -0.09799283782529315 + -0.08779514834915712i }, { 0.04466329306002942 + -0.002317666373705367i, 0.05031372258882429 + 0.07699090033441325i, -0.005542245066504446 + 0.06751420926256275i, -0.050773803708871926 + 0.034306080343953535i }, { -0.07182028153395148 + 0.07651297545910588i, 0.2036931576421388 + 0.0656541619896498i, -0.0888789626676983 + -0.06015861588497011i, 0.17433008577668666 + 0.04632359999925104i } }), Matrix({ { -0.18459030120117786 + 0.025361129462149155i, -0.06851955818778638 + 0.052982594084208294i, 0.07737737530643918 + 0.12023093661746893i, -0.08581449748093249 + 0.14946043114792357i }, { -0.06790112364966393 + -0.015661509466848324i, -0.12015752753794971 + 0.001333283906420635i, -0.15322436058260558 + -0.10675625408685467i, -0.10571539137001194 + 0.07685346469055165i }, { -0.047185374510438007 + -0.013732888630569567i, -0.06410649153760031 + 0.10607811062213418i, -0.0871400671825168 + -0.0002916976257649592i, 0.01983013768972215 + -0.015103374175556879i }, { 0.137901689228277 + -0.026420982510643985i, -0.12181496446995517 + -0.04625310949060834i, 0.01335266197708616 + 0.1203340966396019i, -0.10899825244118444 + 0.04792784901393059i } }), Matrix({ { -0.07889607869838434 + 0.16255408303028984i, -0.04465461216011241 + 0.08221749764433152i, -0.022641373039248576 + 0.23258820540058744i, 0.11610885671648129 + -0.13857591341051992i }, { 0.16097623345914125 + 0.06032812868439707i, 0.028432389070251068 + -0.14273995485759122i, -0.006293221297627904 + -0.10866259161217073i, 0.02845492674142296 + -0.06671760097492412i }, { 0.01851754997648453 + -0.053625219440052524i, 0.1322108962572775 + 0.05240507102002491i, 0.0606814135773774 + -0.023185984787895388i, -0.15648114354919473 + 0.0355560743095367i }, { 0.09598351716541435 + -0.05074135796070752i, 0.11342761121749277 + -0.08724271136390414i, 0.015515966653627986 + 0.05519873541873944i, 0.21799343283574008 + 0.023309044374843435i } }), Matrix({ { -0.09731497275032744 + 0.04171990451948878i, -0.0856816110732861 + -0.089716778374974i, 0.0460671061672393 + -0.031235059683216427i, -0.027008585677793618 + 0.03448897694420363i }, { -0.13164392239933476 + -0.07910403566095377i, 0.0051720066377807985 + 0.09686713977977537i, 0.0840797483753024 + -0.09720922024172554i, 0.07716491076846353 + -0.02857343372214757i }, { -0.11353878946906261 + -0.04352273156477807i, -0.20333092713468426 + -0.14640519750160708i, 0.012830601206488016 + -0.06081164431826232i, 0.29939124952121277 + -0.017882825332439286i }, { -0.10386980192620394 + -0.08639864280379732i, -0.12228052571521345 + -0.20069693049359355i, 0.1277529798139231 + 0.01640270393262906i, -0.011367765820795012 + -0.04335778213970013i } }), Matrix({ { -0.13908808121784 + 0.07523179665792301i, 0.0545243210191678 + 0.06339969032091906i, 0.07898914496553368 + 0.11929441530331318i, 0.011030248009274556 + -0.01314103955022459i }, { 0.08085854506558872 + -0.14905252736749308i, 0.10834739492646768 + 0.024915873857802716i, 0.043297938871319185 + 0.15052171635354i, 0.03915655491245294 + -0.13941702278393864i }, { -0.030982219372188702 + -0.015892920672302857i, -0.07007038240278222 + 0.07706299625218051i, -0.11898185490945838 + 0.06863026092661875i, 0.10874986194435327 + -0.022411450271393577i }, { 0.1413137879367164 + -0.07615510761881748i, 0.11704358773595483 + 0.04862357488787325i, -0.08874094206691263 + 0.12555323518662104i, 0.053848788736891855 + 0.10544609555803264i } }), Matrix({ { 0.06122597831458468 + -0.1060979869405074i, 0.038428321417459374 + -0.037873034574249245i, -0.08751310923796926 + -0.016736278165258578i, 0.03606957537503036 + -0.07526698799488468i }, { 0.09737086139956334 + 0.04260704044909871i, 0.036798658695889094 + 0.07345747861904717i, 0.07338287292219692 + -0.1234225576988774i, 0.0649143258746153 + 0.10014979960586769i }, { -0.031860185609365585 + -0.04527280717983741i, 0.05727056006666821 + 0.07502132856393698i, -0.03044634996879215 + -0.09414069323492531i, 0.052304374389851624 + -0.05381932771376656i }, { -0.15201498555710652 + 0.03462808118602282i, 0.0951617898264918 + 0.0647623699913823i, -0.030466805508295877 + 0.03307225138364707i, 0.04295838679062341 + -0.020341471138053298i } }), Matrix({ { 0.029579222866311587 + -0.06131924115170672i, -0.06167101365910798 + 0.06996829837186966i, -0.014111365380652144 + 0.016881070115401128i, 0.03794903653661654 + 0.025915609148487895i }, { 0.0936822920528858 + -0.0018534230410488307i, 0.05850870660718303 + 0.11159458811147553i, 0.18350816292042169 + 0.0098588366462432i, 0.027144645859603682 + -0.09360291794596265i }, { -0.05960948424544168 + -0.0158801832688967i, -0.12911495450217741 + -0.19917619430247144i, 0.173097510508515 + -0.09904763495500839i, -0.01796508668581673 + -0.02160001969248004i }, { 0.038942506423885394 + -0.13792646209100753i, -0.14398774725733304 + -0.013401356200459017i, -0.046209279603641844 + 0.09822350621241227i, -0.08478840176588807 + 0.15292678213576963i } }), Matrix({ { -0.030419055864748485 + -0.1189322543708434i, 0.11644531770240978 + -0.14488592003260553i, -0.033209891936869906 + 0.142285773988904i, 0.003265288930584972 + 0.02379616524140027i }, { -0.07040828056835954 + 0.14584658086386937i, -0.15858319218158665 + -0.12284871797058966i, 0.009821702861282634 + 0.03308942137455211i, 0.22647261283434528 + 0.07287680722868425i }, { -0.1868404220734645 + -0.04893220540282898i, 0.1452231258843501 + 0.0426906200840505i, -0.04859775490757378 + 0.011442697727684222i, -0.05780919052796288 + -0.12447630350614046i }, { -0.08306200138554261 + 0.07570834854261253i, 0.07356191922379321 + -0.06188289558376798i, 0.07998752201978973 + -0.12737424347943332i, 0.04261080389494533 + -0.01502938297905881i } }), Matrix({ { 0.1902929212982704 + -0.01011045877592559i, 0.06697779390881378 + -0.010036120633194914i, 0.06486097939185477 + -0.11797842364642283i, 0.051096441841763714 + -0.08187485618349433i }, { -0.14023527215179754 + 0.0771919896790613i, -0.19300705060537984 + 0.11453099835663157i, 0.07361644994296647 + 0.11798663369819457i, -0.048103641991169434 + 0.027066921992969374i }, { 0.16182798925899614 + 0.046114138690394345i, -0.019559356626994144 + 0.049438034384776945i, -0.060208265458263174 + 0.007579010235121946i, 0.008728619527514444 + 0.02180655576345014i }, { 0.037875720001626194 + 0.08183129976349272i, -0.07748892167053986 + -0.06481638952177894i, -0.1080703167459363 + 0.06302575480659228i, 0.18488434765743106 + -0.06623009139037651i } }), Matrix({ { -0.06111864063968428 + 0.11494928084492506i, -0.01982614396320271 + -0.10919695454848324i, 0.08954778662596723 + -0.032954469345576394i, -0.06736878575992969 + 0.05706437560740318i }, { 0.07371670004899507 + 0.15243456019036272i, -0.06329787503060881 + -0.04806217843481121i, -0.1296020523985665 + 0.003603712961733635i, -0.13498523374338647 + -0.0537609760005139i }, { 0.004592932995836185 + -0.003111962015969944i, -0.09279825445593219 + -0.042537175931807836i, 0.02547903207399375 + -0.01977924561758902i, -0.15107602061478267 + -0.0774342948951421i }, { -0.015643914781880965 + -0.19060253284764667i, 0.11368368880710591 + 0.13046878426194128i, -0.05648276574459154 + 0.009054198284398383i, -0.16633751757844079 + 0.13793073347860818i } }), Matrix({ { -0.11384258861201839 + -0.06262367416253735i, 0.04635842543633931 + 0.01951053263355796i, 0.10424681040364606 + -0.1280529823772058i, 0.015690134036508204 + 0.02941151574533128i }, { 0.16155909464055104 + -0.009174894308581188i, -0.07989661201798075 + -0.054227628600582084i, 0.034519551909013256 + -0.027357895272243738i, 0.09466984502284559 + 0.08350814607088596i }, { 0.00833774647194011 + 0.12562233097561462i, -0.10076169740150046 + -0.02234625864596656i, 0.04998016702813795 + 0.19193367419856094i, -0.05436136033479998 + -0.13325793337213107i }, { 0.0778114092287652 + 0.008938754025654446i, -0.03759145979725837 + 0.021301104147020238i, -0.10526856445922878 + 0.16649495476098683i, 0.02742241414484833 + -0.08281483691846109i } }) }, { QubitIndex{ 8 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 8 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 8 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.08208448908922938 + -0.019861372549847694i, -0.055961784861781556 + -0.11404580123160642i, -0.008845218607295754 + -0.17095570783678946i, -0.23285295037276024 + -0.13056589972616067i }, { -0.11602956803139482 + -0.04914443928725281i, -0.03517345737182567 + -0.011812748174723471i, -0.1446360476632841 + -0.06277846398477852i, 0.0634194826045536 + -0.07671042173867151i }, { -0.0499435809116732 + 0.05671679341909145i, -0.0096211587708531 + 0.1625360306759881i, -0.1003745077976717 + -0.04078592607221089i, -0.056492911826832 + 0.0019041033494089385i }, { -0.1258550119626907 + 0.049292686070819616i, -0.16865001262677043 + -0.035926567372931865i, 0.02445992164778059 + -0.15383792702205865i, -0.03561165819555465 + 0.12262090988871427i } }), Matrix({ { 0.03441392076556781 + -0.12210828676057621i, 0.008051385568910803 + -0.08622490588065065i, 0.19834133464644102 + 0.13851052312142928i, 0.05232495449162142 + 0.12092550901881742i }, { 0.16603250565711697 + 0.057988324813253896i, -0.15842520054111278 + 0.021908334974479096i, 0.11506960337927645 + 0.03628042814219383i, 0.12590459039301097 + -0.09630144497169502i }, { -0.05871607752154533 + -0.13540000779854722i, 0.15072318227221737 + 0.006160115452467211i, -0.06299882831206281 + 0.04934258502581429i, 0.06417515157986049 + 0.006028951750619679i }, { 0.18314962581893773 + -0.002067685798187757i, 0.01238596638997828 + 0.03609621402933582i, 0.08142026476085489 + -0.07711902304646541i, -0.08745768789392266 + 0.0057736311810263514i } }), Matrix({ { -0.030350396696877505 + 0.0901664228957032i, 0.03981774337448523 + -0.18151134827995416i, -0.13582639208268013 + -0.0578012922301319i, 0.009432761997962764 + 0.03820528706503975i }, { 0.01413442452948182 + -0.10450803502549084i, 0.018484837685092466 + 0.007507563526569723i, -0.12780772616167244 + 0.06585487822232414i, -0.10479640675926165 + 0.13382610551543458i }, { 0.07741110632917819 + 0.0614367731895896i, 0.13604297876201593 + -0.017725847963486963i, -0.03254104543414663 + -0.04353888282035215i, -0.056566470668761644 + -0.019503944345611122i }, { 0.27895182165168403 + -0.026672708125898635i, -0.16450227166105358 + 0.0020373951677012995i, 0.08750255245843298 + 0.1619208963243419i, -0.05666782313204166 + 0.026346476381976833i } }), Matrix({ { 0.14281934447102246 + -0.06674749803911936i, 0.16830752508966615 + -0.0002688351182516721i, 0.06407683134856876 + -0.06057121822099414i, 0.24332581119503718 + 0.09636744320719687i }, { 0.01513310927895923 + -0.09998597514124834i, -0.019722466830193883 + 0.0193200081757493i, -0.09546129995854488 + -0.13040994855112759i, -0.09800490014220013 + 0.04801256603642235i }, { -0.05181801975240881 + 0.058980542948566056i, -0.011215080690160691 + -0.0543572115699912i, -0.2783138243856102 + 0.07900186370815859i, -0.13373654899217502 + 0.011235968057952659i }, { -0.04915588320951304 + -0.08237972630457902i, -0.03291193094951242 + 0.008292589935924683i, 0.05818037893364962 + 0.06815088773498715i, -0.11054873595982417 + -0.004851611037788236i } }), Matrix({ { -0.07055381093605122 + 0.06693533248686671i, -0.2336237411745896 + -0.030801085861661453i, -0.018212951441753823 + -0.015942289304366905i, 0.010743768761949614 + 0.07584067670455814i }, { 0.034659851584585996 + 0.00806997094765336i, 0.04060035974545811 + 0.02574990644914388i, 0.14794112888476726 + 0.004394787828252255i, -0.12939867837217206 + 0.09229290628889968i }, { -0.058575616821669285 + 0.09933156874781446i, -0.13836943574372557 + -0.006754521206178362i, -0.07551827035146524 + -0.10741890892535402i, 0.028306661209383303 + 0.015118366373504798i }, { 0.12995451391547155 + -0.07105547096176033i, 0.04585969175755366 + 0.0429368961379i, -0.05021084516268991 + -0.01944039797189686i, -0.1269091099328598 + -0.17727785591091683i } }), Matrix({ { -0.2325490377282572 + 0.07079521638449145i, 0.18167689872393208 + -0.025684363297663892i, -0.025031255705919967 + -0.016683873573315883i, 0.07576504949604868 + -0.0820116335058208i }, { -0.10303574294278244 + 0.08435791815997193i, 0.007661861905624235 + 0.24221230787564496i, 0.038818895196707726 + 0.04299789941407968i, 0.21351507943796685 + 0.07472484171718394i }, { 0.2230503695401323 + 0.016744157948887357i, -0.006819244887275167 + 0.026614741017504433i, -0.09197320521148873 + -0.02273213511837301i, 0.05325163568651647 + -0.0369651017714186i }, { -0.06761217169189279 + -0.0981750091289805i, -0.04781970743933453 + -0.1216319499102467i, 0.12344408870541955 + -0.08810471345032515i, 0.10819096950729795 + 0.11270062970337769i } }), Matrix({ { -0.13921686825138155 + 0.04749643072505044i, 0.11292824009402613 + 0.058725532825994804i, 0.08191618406811803 + 0.04937326121357808i, -0.03860918382424508 + 0.07472637194803619i }, { -0.0010008675298823744 + -0.09285060443017139i, -0.016756816459783604 + -0.002159139178797395i, -0.07204546889153016 + 0.02201224727955813i, -0.01435618238366042 + -0.04858420269594784i }, { 0.13078806390101064 + 0.027095913723666085i, -0.02001379748059235 + -0.06137329395223039i, -0.08325044700466289 + -0.030847386292511998i, -0.03925894959940143 + 0.11118930895261528i }, { 0.06460006040098647 + -0.05699856251567343i, 0.054414022089740374 + -0.017516807488605853i, -0.06301448689758957 + -0.010135219855999963i, -0.09207783222687761 + 0.01123810051050409i } }), Matrix({ { 0.06650891510489629 + -0.12365679190921318i, -0.12554439083877 + -0.17815770663358588i, 0.07155204492219948 + 0.0390368614054073i, 0.08721128140476778 + -0.09970137316400783i }, { -0.18245110202694376 + 0.0738021554537786i, -0.1633325645838372 + -0.016390854214907654i, -0.054484687024775415 + 0.08855647176001419i, -0.07139530527298536 + 0.08334858893074039i }, { 0.04628540319518227 + 0.16927452901728732i, -0.09354411886300834 + -0.027982972332068916i, 0.07306771136076387 + -0.09410891052173287i, -0.16416285581900758 + 0.07985909118100636i }, { -0.011945987331178317 + 0.052773577260943824i, -0.04343576624481239 + 0.1937242732806573i, -0.02237665445121451 + -0.022443254189546298i, -0.032627529137338095 + -0.1410926378687256i } }), Matrix({ { 0.0053972323914221075 + -0.002616297819177207i, -0.059100630292725935 + -0.04732077440034048i, -0.024920671284666917 + -0.027798192768198865i, 0.03788607280784773 + -0.11642071078411657i }, { 0.053032884122407975 + 0.01926042205357622i, -0.13868298465198284 + 0.0873288948866297i, -0.13762364075230094 + 0.022047358940799677i, -0.027934063068403528 + 0.12421089534826282i }, { -0.08655252478149938 + 0.017830963207167233i, -0.17930082917872797 + 0.00204095843092886i, 0.24882493428243435 + 0.018506508165822253i, -0.04857086497364154 + 0.002623903583587527i }, { -0.013942279790007577 + 0.04775437348439303i, -0.006206297569083332 + -0.0247074366371051i, -0.01573125514221963 + -0.11754251431958504i, 0.02916782265746704 + -0.057646799865773805i } }), Matrix({ { -0.09353889571766912 + -0.21672320256809566i, -0.033032162753751385 + 0.026367154051004742i, -0.027834139686756305 + -0.020097082286331967i, -0.07414876680173363 + 0.051955976146535514i }, { -0.06146680355272467 + 0.08710532494463219i, -0.08236518465462352 + -0.15028178087174218i, 0.03863959836552055 + 0.05058278252146528i, -0.012956098954847919 + -0.0051177586603019295i }, { 0.028002462293106854 + 0.1323443991207348i, 0.019162741188743785 + -0.07949871902756929i, 0.00814074627604186 + 0.018842032380608692i, 0.1058894070835301 + -0.05504442826589643i }, { -0.03680283001970953 + -0.0729599043815597i, -0.0646328559615253 + 0.026461784609163243i, -0.11918720438668912 + 0.08521446302905632i, 0.08666579399795604 + -0.02558027431253364i } }), Matrix({ { -0.06487545351150749 + -0.0022925461388585587i, -0.06128660290335372 + 0.02624641002180395i, -0.13254610146532925 + -0.04314292795806103i, 0.11194894611923964 + 0.05026932914403977i }, { 0.02636386921673792 + -0.06230041222651847i, 0.03690423013725834 + 0.16626752243966i, -0.10092526665752997 + 0.10034568031076546i, 0.015573338546787312 + -0.06494865971346514i }, { -0.0223478958646893 + 0.18274635705892361i, 0.26251820054511044 + -0.023828622564652856i, 0.08952911075808034 + -0.1384804007609794i, -0.11218521869263849 + 0.03487161520887145i }, { -0.07574308412735622 + 0.017139466903764014i, -0.06446008486978101 + 0.21884896564792547i, 0.08265270648739749 + 0.07303519168930167i, -0.0945472537294156 + 0.08043667480180633i } }), Matrix({ { 0.03473165974366568 + -0.003560110186259735i, -0.08969709581403959 + -0.050465215913080445i, -0.0028743150072124213 + -0.06936184155146546i, 0.05368947231995272 + -0.08133685137358804i }, { 0.009751505570359859 + 0.14815580143419402i, -0.013030895398810902 + -0.007449652114894766i, 0.008483706504182672 + 0.054283271157509624i, -0.047101061320538554 + -0.0009325071580507719i }, { 0.03679727912334215 + -0.13709370691166536i, -0.07431696161716674 + -0.0578789585038784i, 0.08558289705407558 + -0.1497654911921581i, -0.09739195515699786 + 0.023952656709364004i }, { 0.006603670616784135 + -0.21487058223670455i, 0.0444780728204668 + -0.06227571651565685i, 0.011036514315650366 + 0.050779848070245104i, 0.04894348458260949 + 0.027004533174904265i } }), Matrix({ { 0.052462614200579585 + -0.056005706193933635i, -0.028828768478862104 + 0.06560768394498234i, -0.014898837164307212 + -0.0703044523960619i, 0.10108233032872072 + -0.015708623170623243i }, { -0.04744093304384487 + 0.03653291070827766i, 0.030135876612596407 + -0.017265108209442485i, -0.04374991522815351 + -0.08384125598196394i, 0.11341390860760157 + -0.0034979987263551652i }, { 0.08752431056128633 + -0.0781710371040896i, 0.056616921999029526 + 0.002384146983793416i, -0.011762682469321694 + -0.03186852588731464i, -0.23374961406571731 + 0.0775278017481423i }, { 0.03221854542577133 + -0.1079551656663798i, -0.04415078785860097 + -0.03473032605874803i, -0.08774219422236479 + 0.03926303857011458i, 0.0025010962339765373 + 0.12887292197315386i } }), Matrix({ { -0.04818304883753633 + 0.029562168098115415i, 0.018706308029820727 + -0.03434369509940549i, -0.04104825114681833 + 0.05654929979183727i, -0.027126152437487176 + 0.010144750043773442i }, { 0.02229525650800089 + 0.06328621900123957i, -0.01806774418345619 + 0.014484951410534156i, 0.0476466794963249 + 0.0724739619907941i, -0.13738994198590407 + -0.05711717901027116i }, { -0.07867916477651692 + -0.05223804625020115i, -0.008438601459955782 + -0.062405977040160585i, 0.11679068465645089 + -0.06807549172773214i, -0.021807727769068398 + -0.003340603423085995i }, { 0.08989476908942369 + -0.045184363427405755i, -0.19769966458838645 + -0.08030789180580841i, 0.014184337745266472 + -0.011030079951537873i, 0.1937050562768628 + -0.10217159390772328i } }), Matrix({ { 0.020386361514613417 + 0.0393544245466765i, -0.01530631325491865 + 0.022677176093118225i, -0.0722646381551154 + -0.003036109497093452i, 0.10135647252176247 + 0.028688593328709995i }, { 0.04088523592096657 + -0.04250357990745124i, -0.029202878199058934 + 0.051779359407300295i, -0.07089000779628889 + -0.11618791639725401i, 0.058278090110563126 + -0.026633526152605457i }, { -0.02162940577742477 + 0.07637348436854641i, -0.13660400258126393 + 0.03625893499481782i, 0.1390745792694259 + 0.15771373571577746i, -0.08664588419932694 + 0.05864536854508654i }, { -0.05442787769080444 + 0.11760177953143328i, -0.04524897422253351 + -0.08223277876477751i, 0.11878741033772029 + -0.11473345807597861i, -0.0462774048171562 + -0.02638735953195043i } }), Matrix({ { 0.027502888447769536 + 0.07697073480587016i, 0.0565534368340657 + -0.09562807603638238i, -0.12726921185810064 + 0.011240948350250623i, 0.07479686749452348 + 0.01117466616305455i }, { 0.027504531444695186 + 0.11621027911284341i, -0.0015480652372291174 + -0.06127114377411035i, 0.1135705873498383 + 0.11701905135736024i, -0.03184900544737101 + 0.008056023981614339i }, { -0.0033059139093945403 + -0.027785440367632846i, -0.025136192969773975 + 0.02233404985800351i, -0.04472999622267501 + 0.10697349195046786i, 0.09099886369050687 + -0.1855611222184549i }, { -0.010193913805368892 + -0.008744208590792144i, -0.07156942129873416 + -0.08914619963453328i, 0.05689424118350871 + 0.14356452292423952i, 0.10766415880110627 + 0.06441300494277402i } }) }, { QubitIndex{ 2 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.14575407366662674 + -0.02142493183741603i, -0.1106950783449506 + 0.11042927754312443i, 0.1631660106727298 + -0.015703481487596895i, 0.11964868514288332 + 0.05411452349680358i }, { 0.12132568072762177 + 0.04414579719349785i, 0.12842673208900784 + 0.0038486263074416997i, 0.13642276328796324 + -0.10655007339450635i, 0.0031417335276590504 + -0.0487724872725985i }, { 0.017558236984218805 + 0.07835349457450765i, 0.15925387721823928 + -0.08750974189523451i, 0.030048605710471174 + 0.007273208084564143i, 0.10965215926081341 + 0.11075142293017808i }, { 0.20069992645254459 + -0.008552119735113824i, 0.03899225233045493 + 0.12068223124776581i, -0.003179692584269752 + 0.001279199352445167i, -0.015920668962449227 + -0.21027494377334688i } }), Matrix({ { -0.20447853603453783 + 0.10405415069007701i, -0.03849386058748858 + -0.01545373394408886i, 0.11380168583258539 + -0.17019213934336516i, 0.022689555563624095 + -0.013781370369322072i }, { 0.06098871685364121 + -0.14051303106567578i, -0.11923234752243143 + 0.004431035607166465i, 0.14089955154797415 + 0.013438817540799201i, 0.08956822930800286 + -0.03275476464368273i }, { -0.06747670957031303 + 0.020859439939452086i, -0.02320343152507612 + 0.16958264743873774i, 0.09595448846537517 + 0.005283449704379552i, -0.03737352419821084 + 0.14555796300587284i }, { 0.044481537861808404 + -0.05986277932631339i, -0.04504253840238109 + 0.10018680563366338i, 0.035136093322050234 + -0.053626778182116835i, 0.11591250479981563 + -0.061964178064733706i } }), Matrix({ { 0.16887334614226532 + -0.005019669949585223i, 0.01688054372081018 + -0.11617386117296849i, -0.022935811245435592 + 0.014039547884761621i, 0.04041545515950297 + 0.04949390154090801i }, { -0.15521543556134837 + 0.09303452513389879i, 0.045444138048805593 + 0.017914385440114634i, 0.047322627945962856 + 0.009844643467140226i, -0.1434757276015824 + -0.043860639542866106i }, { 0.13315270432096413 + -0.03411342233277472i, 0.19518649106474317 + 0.030576455978015796i, 0.007007726096904253 + 0.15101630238996036i, 0.08997793777461509 + 0.07542031715619338i }, { -0.052557469521419896 + 0.0674623797661181i, -0.09858812842614448 + 0.0049518169960296584i, -0.11640926961620285 + -0.018496644372341695i, 0.011808520973716376 + 0.15410889027095276i } }), Matrix({ { -0.15838096617154582 + 0.052935175731921934i, -0.051032404684681724 + -0.029028181102999102i, 0.04021692668849458 + 0.16683835310942244i, -0.026681172306683352 + -0.037768321570053685i }, { 0.0015595165383335142 + -0.0005319115748111784i, -0.050908496904247154 + 0.10473943559396137i, 0.01887657851185907 + 0.025480315817856505i, 0.22293955960872464 + 0.008800229452875594i }, { 0.06721759630525669 + -0.061553957656943874i, 0.002108614969892884 + 0.15556453248120125i, 0.09155440847847558 + 0.008285382028914127i, -0.030163011481831745 + 0.05470554652447816i }, { 0.024984855604083565 + 0.1245679243067713i, 0.08177263211473504 + -0.12204976908458466i, -0.14229346481622263 + 0.09120105580694536i, -0.017435891600599617 + -0.09287862800437832i } }), Matrix({ { 0.016961837749114944 + -0.005591726140999724i, -0.10960894892962068 + -0.05976327449246253i, -0.1039458843400124 + -0.009094204710937607i, 0.006893545153830025 + 0.17339604865177732i }, { -0.010833597332540386 + -0.13671963526056286i, 0.11626719281542643 + -0.02600357749613216i, -0.21397417987961373 + -0.0025349478015807723i, -0.02026006390091414 + 0.05072073307655601i }, { -0.07953197823677258 + 0.02240090270745048i, 0.086533618271529 + -0.0246120873863651i, -0.001974221693587655 + -0.07018769647407444i, 0.0921111176284224 + -0.0015536311078810246i }, { -0.13197177244126418 + 0.10695224192475779i, -0.026045345377767537 + -0.08307088387927888i, 0.04851930562825214 + 0.042364846135323875i, 0.04016584948785063 + -0.13494950196421224i } }), Matrix({ { -0.04537048551203473 + 0.00615868723265141i, 0.2876085710302912 + -0.050126887267756805i, 0.10420070951619109 + -0.06376901485260505i, -0.08422768225545166 + 0.00478417391850808i }, { -0.08022661621426426 + -0.04264986824112981i, 0.016670054804693166 + 0.009231445601025219i, -0.18211842042795254 + 0.006566885019363881i, 0.15644495424269014 + -0.10580042845546087i }, { -0.025675453287374046 + -0.08856592843785004i, 0.007362857228328651 + 0.07709633467993494i, -0.090140235249195 + -0.05105779926468003i, 0.12332287045668297 + -0.05229241738437305i }, { -0.07240729869378172 + -0.014980559241700102i, -0.1091103738198316 + -0.12766009434105333i, -0.19712880472986177 + -0.09130249507437513i, 0.06992761619128182 + 0.0001713516012398306i } }), Matrix({ { 0.04101928201294244 + 0.007185210036224002i, -0.08757479546882425 + 0.054236274799696955i, -0.05116396122772848 + 0.01966856475797909i, 0.10398209527630493 + -0.1846257717596457i }, { -0.09792277641091646 + -0.02209151129688881i, 0.02274131909080296 + 0.068296397788155i, 0.06505669066470687 + 0.02727680516394518i, -0.06949877354805807 + 0.0017949911428959964i }, { 0.03192061012108467 + 0.11245130635818602i, -0.16785197055432285 + -0.1897884920298517i, 0.07782638831368247 + -0.061869596694255125i, 0.040963626300154946 + 0.021248231727257885i }, { -0.05376817874112669 + -0.11315192186096203i, 0.14410795505156757 + 0.030415099021385332i, 0.036094709717285685 + 0.0022647780736522994i, -0.10766348116255653 + 0.09028162442862035i } }), Matrix({ { 0.12192169528316105 + 0.14606419843794144i, 0.08048504041058847 + 0.00847314734829438i, -0.00023056712123744054 + -0.04323819496569541i, -0.00821467482982817 + -0.049949900676819044i }, { 0.10416461478981678 + 0.17113492783219852i, 0.14752996868467774 + -0.07580099184901026i, -0.10951935611737333 + 0.05491508006334695i, -0.007472311018598548 + -0.0935476269560121i }, { 0.09437115866565966 + 0.04085560988457336i, 0.020409361736676495 + 0.08496110434581201i, 0.05110707819666343 + -0.09570220874106418i, -0.03494532143290006 + 0.0029648561838250117i }, { 0.011931693955868343 + -0.02963277352052738i, 0.019021003284322 + -0.026133845426123577i, 0.02080171445124383 + -0.05615976085653349i, 0.018601664413498274 + 0.0559147847131617i } }), Matrix({ { -0.011290922187992684 + 0.16658529764867272i, -0.07814919528911451 + 0.04961144798252912i, 0.15395974396572085 + -0.052306817911543686i, 0.02377884724070456 + -0.06528453227458858i }, { -0.11094009651441938 + 0.002521113356329628i, -0.07478264842491085 + 0.25166952982528734i, -0.07263671405383158 + 0.13025408371584843i, 0.018078060288515347 + 0.18385046784491807i }, { -0.0690268340492654 + -0.14676665455333804i, -0.023846604325720566 + 0.024142637931945373i, -0.12715502961791228 + -0.0793812802893878i, -0.04777018923506982 + 0.06322056489495564i }, { -0.011752060761998633 + 0.03114394994992629i, 0.04216222960431767 + 0.10237180608025737i, -0.05115970509937279 + 0.13890061765817335i, -0.1086245277527188 + 0.1345846153550885i } }), Matrix({ { 0.09170243055978518 + -0.013977107854859998i, 0.05153531922168971 + -0.06617546196514784i, -0.07261164051174954 + 0.15689911289352781i, 0.050989394516010214 + 0.00308771945241111i }, { -0.09275862170666012 + 0.19579601437501307i, 0.024479612543749574 + -0.005343560981369199i, 0.06812816813459177 + 0.02641223770139321i, -0.016596771692145077 + -0.016108922185285084i }, { 0.06270978390319444 + 0.1799535251815427i, -0.04322423797447869 + 0.044824802028804296i, -0.08546544109915963 + 0.10692310398858644i, -0.27578076098788334 + -0.1282983681360009i }, { -0.002468793902105136 + -0.1598838358385506i, 0.021956790280790436 + 0.04423997308291416i, -0.004994963687990136 + -0.17220942192937158i, 0.07931843597333257 + -0.10864749750621143i } }), Matrix({ { -0.09098079949022166 + -0.01880507536493362i, -0.09731416235703652 + -0.04338633275829506i, 0.12080574035432794 + -0.13838415011416222i, 0.06318401320860094 + -0.02549051612925652i }, { 0.12643220638269964 + -0.036362873117211376i, 0.0490571613337588 + 0.08739912655126622i, -0.03878643575714253 + -0.028817514854413865i, 0.04872972336103835 + -0.0667063130649086i }, { -0.02048165921945497 + -0.0643640529418037i, 0.05720259476723948 + -0.04533273248731678i, 0.020474455979910305 + -0.08004121272577489i, 0.07549062204526263 + 0.03502105977188062i }, { -0.0012131020778713103 + -0.029333570572302348i, -0.06475268186297911 + -0.05665870329657746i, 0.006576141744485123 + -0.1783648155592047i, -0.11305121836043996 + 0.013040406035709974i } }), Matrix({ { -0.003422231093567161 + 0.017676315892176286i, -0.11146510330912594 + 0.16270362702128024i, 0.111983425292586 + -0.12485402226319377i, 0.007800576386384434 + -0.03763883142086851i }, { 0.17873535789233716 + 0.019511635161672102i, -0.015114060810795776 + 0.044801957562937395i, 0.03898455845517047 + 0.02440092298762665i, -0.048425012594657015 + 0.002941166675071392i }, { 0.015698264263476962 + 0.06404547541217062i, 0.054260818351951845 + -0.04162540953279525i, 0.030912672408948245 + -0.1487220390713363i, 0.07963469331087893 + 0.07439916315309071i }, { 0.033241985845182356 + -0.015509616996453252i, 0.10054619407662979 + 0.05947776559358283i, 0.14415306011773057 + 0.036429743932450506i, -0.017072399688572836 + 0.1329595788752442i } }), Matrix({ { -0.017410246723293405 + 0.09064991676415603i, 0.09182244319757304 + -0.08298665260627175i, 0.06367860364553936 + 0.024495273813703363i, -0.05770988269299789 + -0.020374778333525495i }, { -0.0040080952450662595 + 0.1052693068472222i, -0.21830969821989485 + 0.050602943472980895i, 0.009540277862890467 + -0.101455565366211i, -0.05984173833469971 + 0.015224645935041605i }, { -0.023803989331967257 + -0.05312152161667084i, -0.026752907359907704 + -0.145811480270287i, 0.06863934879436065 + 0.08136876535198327i, -0.1271588946229058 + -0.06345781783466478i }, { -0.05488178274601766 + 0.004314164802287393i, 0.020921123604588004 + -0.01307565214251756i, 0.11096943687181944 + -0.12081327522756664i, -0.24020750394256252 + -0.04465852008499318i } }), Matrix({ { 0.03248473840437032 + -0.0683666421854399i, -0.11856603163830391 + 0.05327250177564953i, 0.04122826691117316 + 0.06628871992170372i, 0.07346407453046311 + -0.03678425922544912i }, { 0.05058435735997191 + 0.1316389680715621i, 0.10417569797367304 + -0.07674745304630726i, 0.09604325190154397 + -0.00972038003946731i, 0.029809904122379643 + -0.08565295602123128i }, { -0.0041958376361896175 + 0.13203749060624212i, 0.05767640478622337 + -0.03634089396889855i, -0.0027521728713733066 + -0.049998140779542705i, -0.0905811066681558 + 0.07225001929010541i }, { -0.15751780426914533 + -0.05998932049138464i, -0.008909911817282326 + -0.046266240509186554i, 0.14521028710027314 + 0.08054844412379046i, 0.09843186314099937 + 0.0551125180653659i } }), Matrix({ { 0.10049670598676448 + -0.01129727451364997i, 0.05243776801611086 + 0.05332380165245089i, -0.05840400601620642 + 0.0250222316205319i, 0.16905255389415236 + -0.02329508781879267i }, { 0.01474195571515417 + 0.0044421267576752466i, -0.08197883706242345 + -0.09370145415333314i, -0.13419695371898566 + -0.04477818383566822i, 0.10843452378622741 + -0.07151088102439039i }, { 0.025243690900499736 + -0.14337797610872655i, 0.01813473194886146 + 0.038672782661645325i, 0.009742700996905627 + -0.013816708748070393i, -0.14233716623229292 + -0.17134414917569266i }, { -0.10229851369143088 + -0.08295026926148533i, 0.1459188919178495 + 0.05548388993331277i, -0.11735013600193347 + -0.027933029037048928i, 0.090170626334617 + -0.02914447641142656i } }), Matrix({ { 0.05113725477187745 + -0.026029785228756562i, -0.058679468135501074 + -0.045507362741314186i, -0.12443575827491786 + -0.09363786730728692i, -0.07632857428385581 + 0.039756022643526887i }, { 0.16147740007713768 + 0.20642478183358062i, 0.015367467865328218 + -0.021719676214090537i, -0.03752234978512206 + 0.15814691375856058i, 0.11627951218666396 + 0.06842806476104808i }, { 0.021772098227649528 + -0.0669314067901037i, 0.008156703050872986 + -0.03134010288933817i, 0.10246368554192685 + -0.06461845823151557i, 0.016281836288524493 + -0.027386211370753186i }, { -0.024232420349934426 + -0.03633055747599748i, 0.0873479555754175 + -0.1610027811777472i, -0.04698017250047695 + 0.06540642299177628i, 0.057441093162930786 + 0.03487893454638032i } }) }, { QubitIndex{ 6 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 9 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 8 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.05716326365116875 + -0.05768721170873295i, 0.1368385110247511 + -0.006696901982283168i, 0.04475332930773315 + -0.03415327947124491i, 0.009795462554952611 + 0.15009501804057043i }, { 0.09159441839376337 + -0.08926520554572086i, 0.009156430566043965 + -0.0021188225444737255i, -0.10070685293575735 + 0.057596418453826945i, -0.046620766891515515 + 0.021717346347276907i }, { 0.1400328599376607 + -0.12022952073811131i, -0.1148997370336575 + 0.007500286039399654i, -0.12485212737565458 + -0.048074061854704545i, -0.1149209044001758 + 0.06054271663055911i }, { 0.02034895319459576 + 0.05938618699827711i, -0.12355570098402131 + -0.11648136811246072i, 0.01711147290027275 + -0.03140950408084848i, -0.2572307152523578 + -0.05386736285033973i } }), Matrix({ { -0.011570554932872571 + 0.124079424558911i, 0.10812069987822519 + 0.1739761151487473i, -0.000754019274746451 + 0.1355410511722858i, -0.05908276424344153 + -0.1883959878728958i }, { 0.10656636694639635 + -0.06276003810485285i, -0.10246035271286534 + -0.14103427992257944i, -0.15645865695707262 + -0.008658068897840787i, 0.08960410511914049 + 0.07504382853276731i }, { -0.06586041198411838 + -0.020224294911184593i, -0.18889698891895967 + 0.12760672510231358i, 0.025223591227075758 + -0.10875294630210801i, -0.11502001886890766 + 0.07795617053324837i }, { -0.055654257377921235 + 0.07600805785232757i, -0.03361868439997823 + 0.02758263459310357i, 0.10747448357359157 + -0.004715258647026606i, 0.021209210796390134 + 0.037534134983545554i } }), Matrix({ { 0.011985529201813155 + 0.06391633299049666i, 0.05114665221969212 + -0.10226251716359416i, -0.05970484721626846 + -0.030613227372034917i, -0.029348563787788724 + 0.02096230846438528i }, { -0.015355524471024506 + 0.032012382952037205i, -0.00040682595348785555 + -0.06317595221636763i, -0.013822735526870175 + -0.09440625528056225i, -0.015763590315398326 + 0.1413837455601478i }, { 0.05202022816183103 + 0.06840749334318211i, -0.11477090348471632 + 0.10260215315115906i, -0.010393613531087382 + -0.046701680753587646i, -0.08673150448300064 + -0.05806489989547552i }, { -0.08534547543469863 + 0.03734209876173382i, -0.0411555161201705 + 0.07583767624968811i, -0.060845873021905014 + -0.02684517238623438i, -0.1580745332584617 + -0.11283028177023881i } }), Matrix({ { 0.0061059338543214235 + 0.11187168104921696i, 0.20183551307066 + -0.06795087387616945i, 0.047271494936346914 + -0.049989370797682106i, -0.06776693100346548 + -0.03976294436625871i }, { -0.15596028630378903 + -0.01765671738578862i, -0.08240408372596521 + -0.01312475207702311i, -0.06545572043706054 + 0.045541021254134284i, -0.15732865887375427 + 0.06121698832704514i }, { 0.03627223561957741 + 0.05752723091857949i, -0.03985577134534775 + -0.17156130284132914i, 0.0320118460723093 + -0.033087462436356546i, 0.06142152270193654 + -0.012599558255605927i }, { 0.06927621609646886 + -0.04308363579894238i, -0.01993363149016748 + 0.022795141506339614i, -0.07029014981734512 + -0.09593585729885307i, -0.13759970779466002 + 0.004505160423503902i } }), Matrix({ { 0.07742331617532174 + 0.023284770849487334i, -0.1382723435653954 + 0.07464807663145685i, 0.08247554908585152 + 0.008224106587769729i, 0.03311448020643644 + -0.1654269607389917i }, { 0.09447068093096503 + -0.05790116009434472i, -0.04384393581641346 + -0.08361683837294856i, 0.04595701420128158 + 0.15430903803753937i, -0.16449953376151308 + 0.06972955207342899i }, { -0.12027935532677232 + 0.009914357048686508i, -0.029615681875195872 + -0.19814817220336034i, -0.01117220573918668 + 0.1510721422475148i, 0.01870472509254277 + -0.021815896549330548i }, { -0.11688115872418417 + -0.12845746048072604i, -0.043248240553707844 + -0.008420422200002392i, -0.10432861017244144 + -0.015243604016460433i, 0.08790352091860641 + 0.03686469157921898i } }), Matrix({ { 0.053912861677682326 + 0.07500579891929618i, 0.1545436853789107 + -0.049726610866479164i, 0.040074766694111606 + -0.10344318071590526i, -0.006875308627193708 + 0.048594531434007986i }, { 0.0004181210563292192 + -0.017883794656601462i, 0.14758315394640625 + -0.12331584089669446i, -0.0698117104816147 + 0.0333801437313243i, -0.005822470156693474 + -0.028155497952835406i }, { -0.1091181170451966 + -0.16512294652872211i, -0.044323524914736775 + -0.024328216471691935i, -0.12997171034146315 + 0.15839627374517504i, 0.12899640117467073 + 0.026406751653906227i }, { -0.1296790621945319 + 0.038485891810197265i, 0.021142296408795308 + -0.04830901863762631i, -0.2237770795924807 + 0.037250379515308595i, 0.042650358726314494 + 0.12332373284607935i } }), Matrix({ { -0.014099823992845454 + -0.004143084721645436i, 0.055613849421933675 + 0.055318281302455787i, -0.06253159125760753 + -0.11352707107131443i, 0.06787789848981253 + 0.06166320028964723i }, { -0.036516021488293686 + -0.022729815263233852i, -0.00567124212892933 + 0.013279027789101002i, -0.14667327483995102 + 0.08362902518676203i, -0.061505015822895956 + 0.030142329855571606i }, { -0.08132211570899199 + -0.020261676034447753i, 0.012866819860779108 + 0.01026326437093316i, -0.041299706907968754 + -0.01753896900147454i, -0.11571803730580299 + -0.20643412556773683i }, { -0.09024034531164114 + 0.05337830195776903i, 0.08678603042552274 + -0.039353492918854094i, -0.09409123205013006 + 0.0639504261787251i, 0.05185379157702829 + 0.17914828099098867i } }), Matrix({ { -0.0779655853778571 + 0.0013340543382114609i, -0.056421143415275536 + 0.07047664631850153i, -0.24281591371214217 + -0.06191239588324193i, -0.10594946736837724 + -0.10688129020397452i }, { 0.018978712621262894 + 0.06973280959819866i, 0.102315176990339 + 0.13081505311490493i, -0.09881085973027029 + 0.025152132979793646i, 0.10940827658770545 + 0.0024352782367962466i }, { -0.08257583408649175 + 0.20080281194257454i, 0.0018436995070512784 + -0.005771787657850823i, 0.024931960550384807 + 0.040144798524157095i, 0.025055650028911608 + 0.031905844607806565i }, { 0.028925762452874676 + 0.035674420401304495i, -0.002569601188268976 + 0.08222849031086853i, 0.06462310063545915 + 0.042224922081793445i, 0.008717400337894966 + 0.00867863762051092i } }), Matrix({ { -0.0356427729270287 + -0.12513487855461897i, -0.03740572919522171 + 0.0802961609108756i, -0.11140918183460503 + 0.017364831874739244i, 0.022665105341899607 + -0.11383536607202514i }, { 0.0691104611046166 + -0.0902677173249826i, 0.10866501248135736 + 0.04742473874241337i, 0.017977415683050457 + -0.062431918590811666i, 0.09968272802359424 + -0.1449630677145526i }, { 0.07176023334215738 + -0.02346114225089904i, 0.024109033256743427 + -0.1152835763209299i, 0.0533991470745808 + -0.06164066850476124i, -0.2404578157367217 + -0.025116544139193415i }, { -0.004454781615741796 + -0.05032904847883523i, -0.089003192811795 + 0.0309992330738651i, 0.050650970246723666 + 0.0202899603843175i, -0.09547669793162857 + -0.098050304671874i } }), Matrix({ { 0.039678996952850806 + 0.04018417376467881i, 0.06148722322015988 + 0.09603394002553914i, 0.004674479835949618 + -0.11366753122449265i, -0.07242371541025251 + -0.12593448640675498i }, { -0.1125178201009742 + -0.11446152796256129i, 0.020613425584894714 + -0.09648206192665383i, -0.12388659455212886 + -0.10546416784976288i, 0.023529152315531956 + -0.017076347744907502i }, { 0.005535206429120254 + -0.015388957625238748i, -0.054273182617255604 + -0.00100434678926973i, -0.021023770416534842 + -0.003931274657053747i, 0.010283124412545917 + -0.04887514445378785i }, { 0.18406856870180394 + 0.15807840400611198i, -0.1649982839817789 + 0.04104089695944863i, -0.15974288143247298 + -0.09315422534801944i, 0.04367023037401716 + -0.04801663459864313i } }), Matrix({ { 0.0006103718642294197 + 0.016931258643197288i, -0.032049040803118656 + -0.08022009451000056i, 0.12121831593669384 + 0.11231492527681584i, -0.05592929342075215 + -0.04703552347919036i }, { 0.07357388337708543 + 0.049367656632245516i, -0.039809465495274074 + 0.13803650434523584i, -0.11226853276758032 + 0.06330092831154593i, 0.06617380478975914 + -0.04146516746451537i }, { -0.09249140573452148 + -0.05139412327769319i, 0.08160668253163887 + -0.016799276963649072i, -0.13529891112774395 + 0.004570518104844036i, -0.0590679724735053 + 0.0014147769590851238i }, { -0.06623514647408124 + -0.09641287626932377i, 0.03571778522963931 + -0.025975062269871424i, -0.04601467950653336 + -0.03689626455087261i, 0.010391186520300024 + -0.06157145785083894i } }), Matrix({ { -0.12320407229710587 + 0.08658304664922137i, -0.12319282139591073 + -0.08329530527878784i, -0.017190229510273044 + 0.0013692778786362622i, -0.0422123674979201 + 0.029234671296958614i }, { 0.21788790522623605 + -0.06928002413575621i, 0.0959826965826512 + -0.13860080319657261i, -0.17081544027169804 + 0.01844368760857675i, 0.06611880484640341 + 0.0439301990330872i }, { -0.05428551598107328 + 0.03331511017575313i, 0.2136011369911136 + 0.14999501549135527i, -0.1311241125364387 + 0.036623955955225315i, -0.21747578110346966 + 0.011522345954960185i }, { -0.07131997305966582 + 0.12181023355827526i, 0.038846357229744284 + -0.09623014087627112i, -0.26247635772874367 + 0.0062124642257832i, 0.0038646954731573428 + -0.05380609939350181i } }), Matrix({ { 0.09646251325096553 + -0.10900228124044678i, 0.050649772315491344 + 0.010421079597746543i, 0.24781926270046375 + 0.0618983278030916i, -0.011151404129283522 + 0.099241549720098i }, { 0.048580744821668985 + 0.0284898033304839i, -0.10921617691980995 + -0.03437989918571175i, 0.07442192731698555 + -0.02777194100979029i, 0.05422402187548114 + 0.04499047390366309i }, { -0.03566588823537002 + 0.08306850037628818i, 0.021447263084997652 + 0.0883465600097256i, -0.008316330826600106 + -0.08599729049262494i, 0.26417597697235123 + -0.04507251217910123i }, { 0.1576762303887138 + -0.03395259355024056i, 0.02954460495776054 + 0.08303897782097515i, 0.01135682869570582 + -0.06201019868015093i, 0.023952930838573652 + 0.10335237697108961i } }), Matrix({ { -0.14164582688729482 + 0.10864546732983398i, 0.12406770228361215 + -0.01611581273172873i, -0.05334401021714614 + -0.060004238397256326i, 0.06343478502645146 + 0.018565120458005038i }, { 0.1317119131976424 + -0.15267406486128995i, 0.011336339384772194 + -0.05727595903972012i, 0.046671196477362176 + 0.11383170978342963i, -0.044541367734487 + 0.017350560159533835i }, { -0.030378744892953922 + 0.02677756549820896i, -0.011400341170294634 + 0.007669919368634755i, -0.0658928912406192 + -0.0637849707683222i, 0.1238022388825096 + 0.050013868765411335i }, { 0.2408405591391776 + -0.1745270311335082i, 0.0710066862592672 + 0.14266416891439507i, 0.0007197836448496674 + 0.142995704638728i, 0.13406223957156202 + -0.04010438134011074i } }), Matrix({ { -0.033907533006269926 + -0.06793167885677369i, -0.03235204846830864 + -0.05783293895511607i, -0.06423065013881173 + 0.03737891949764449i, -0.12378868007744723 + 0.044159055658795264i }, { -0.11191646279239752 + -0.034895100161602084i, 0.15563735969380935 + 0.06908061014262737i, 0.09343726676759931 + -0.07054315840043368i, 0.09795699613886842 + 0.05477835975971559i }, { -0.09160453238859773 + -0.026815791915815977i, -0.013174306314592578 + 0.11254093434378555i, 0.14011637533302645 + 0.05767528742275682i, 0.022869988849864763 + 0.008862766815394428i }, { 0.006069566182207823 + -0.02958057201309277i, -0.10428206893477947 + -0.050422310698174176i, -0.03423053104777898 + -0.10172059350013188i, 0.08990973702142971 + -0.03228986984164229i } }), Matrix({ { 0.0946906896759922 + 0.03192553551862942i, -0.07147142634076116 + 0.04996048482005382i, -0.13832082032875095 + 0.02192901376131734i, 0.010703839287894366 + 0.02821508278154283i }, { 0.12422366440950432 + -0.07771560952011794i, -0.02089403862385387 + -0.23748859362956967i, 0.07951986157157265 + -0.08228357454866023i, 0.013486030947425925 + -0.1268336355204386i }, { -0.13199579295962682 + -0.13148746815947837i, -0.0396542652124558 + -0.016127490799206428i, 0.11733208760848735 + -0.04469745531780695i, -0.013675065701037083 + -0.04252161852101477i }, { 0.18100530330998646 + 0.07934769139070563i, -0.04404262479624783 + 0.08814647402285697i, 0.04852028800612806 + -0.08781215881528076i, -0.04198831599922161 + 0.08990290446882866i } }) }, { QubitIndex{ 2 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.020718767074614286 + -0.07972333351900097i, 0.17634716047268745 + 0.06309867356625176i, 0.012194651930885026 + 0.17333161571297612i, 0.17606596353146095 + -0.0032001658861536848i }, { 0.057039527777704 + -0.07243195227796391i, -0.07757741193852832 + 0.06693539731447405i, 0.046445067837463085 + 0.08245168887935782i, -0.13605786148920046 + -0.014266179520147181i }, { -0.05403951629448361 + -0.022754512883516678i, 0.06434983294165174 + -0.06379221402104726i, -0.09115053343171779 + 0.01622802061141287i, 0.056734728084438864 + 0.06924009664966628i }, { -0.08785316454091095 + 0.038371128430407096i, -0.0411720040681134 + 0.06766599607470243i, -0.018541966901369764 + 0.10608447301709988i, 0.08733661040781689 + -0.029296581189935528i } }), Matrix({ { 0.021023965047400006 + -0.17056095211414546i, 0.10989965696685143 + 0.03687463884693109i, -0.034350007405547285 + -0.028276351353245226i, -0.0006112356394071998 + 0.19130005258281274i }, { -0.01612728549983306 + -0.21683442554522367i, 0.14257470413871387 + 0.01410499103503419i, 0.021418231417578957 + 0.040845421793406625i, -0.12508328757132225 + 0.0744888115046513i }, { 0.1360683760963204 + 0.0262697482231062i, 0.15910748125228347 + 0.1479621456362669i, 0.05470601176097162 + -0.057842091197571006i, 0.03699045120007282 + 0.012593302187739698i }, { -0.07611491204027804 + -0.157366805185906i, -0.049603292852226394 + -0.005480993173220543i, -0.010569038761401915 + 0.02087685737509309i, -0.0686304392736794 + -0.06375282296933092i } }), Matrix({ { -0.13546136657064958 + 0.05920770810798132i, -0.1270554406875755 + 0.013743550481252882i, -0.059831127348230165 + -0.05347371512332643i, 0.11012130182413703 + 0.10785420478953893i }, { 0.04380620982479215 + 0.1537099174403146i, 0.06572544030427524 + 0.007131465967291215i, -0.038272996382013466 + 0.05050172912834955i, -0.019792400307819254 + 0.04260273070103422i }, { -0.11376183585760742 + -0.002535296830455262i, -0.11137280799548992 + -0.09730546246679593i, 0.06746965246474049 + -0.10404714275956277i, -0.09497388826369602 + -0.007861049833448298i }, { -0.05957837608783192 + 0.0902583124380762i, 0.03432907248654245 + 0.03537396489408101i, -0.090646980122076 + -0.03205523921653651i, 0.14527535387824989 + 0.0702005340028022i } }), Matrix({ { 0.06721933032975781 + 0.09297568287059056i, 0.10671968722726323 + 0.04111394571104968i, 0.049123367709971125 + -0.005368455271116836i, -0.06068374929132736 + 0.08828567353676325i }, { 0.06772842972326902 + 0.07531342775120833i, -0.002968223023412332 + 0.08715278152823809i, 0.0882846518537977 + 0.024533886378968427i, 0.0674097090460067 + 0.012427545634111418i }, { 0.04972410985332048 + 0.006171257919113464i, -0.04581341544812105 + 0.03516420872597163i, 0.07202082037947619 + 0.08042876575576983i, -0.13836087874043274 + 0.04691162590300063i }, { 0.09449072397540433 + -0.008501616894285021i, -0.06182673234267303 + -0.07957747975934967i, -0.10869544522000299 + 0.11741554002046692i, -0.07157930794513277 + -0.04203094172753407i } }), Matrix({ { 0.10153597119768674 + 0.030621707528633642i, 0.09016319275764541 + 0.005793919422560307i, -0.07506667137700107 + 0.1319816297255975i, -0.11119298420294167 + 0.06625356569993962i }, { -0.1486815919239597 + 0.02090705909161907i, -0.042825972684328854 + 0.07474228232053974i, 0.05901792258971792 + 0.06500975308615796i, 0.10421972088464672 + -0.0315753215454146i }, { -0.025652104827982962 + -0.1869113272223074i, 0.008256558702748643 + 0.04011911471397823i, -0.07107712437206183 + 0.018702913926158426i, -0.06027340894192378 + -0.10909480945363584i }, { 0.15419965355386875 + 0.00015804127479748624i, -0.3111156313338518 + -0.16430961254719972i, 0.15170942289208225 + 0.020624286503003086i, 0.02310090398054114 + -0.06576076259239394i } }), Matrix({ { -0.060246039994545156 + 0.2505899979282447i, 0.03183296713599456 + -0.0766596251788015i, -0.038488384946136676 + -0.09060308145607844i, -0.004851032189766186 + 0.14215810922518415i }, { 0.014537506851424452 + 0.16129807965137327i, 0.028268795390937535 + -0.0378515630132791i, -0.01087106696541013 + -0.09673695776358164i, 0.14763083865840462 + 0.03191186553210691i }, { 0.05672027316318167 + 0.0030877573037892845i, -0.06884482203108129 + -0.11686739188952643i, 0.217786940671093 + 0.01853637977827535i, -0.06348127198287766 + 0.034019317716694523i }, { 0.07716167974981131 + -0.09211560614445978i, 0.05249735504978427 + 0.06669526935319357i, 0.031189659403827206 + 0.1150161580314632i, 0.00166444488798888 + 0.09032361931190748i } }), Matrix({ { -0.021145355208089897 + 0.12144865657265373i, 0.10361389531922789 + 0.00024319898337671952i, -0.20709561548724167 + 0.058137177665813014i, 0.043035987872617004 + 0.08879316497859029i }, { -0.008951141042344825 + -0.09272853581048571i, 0.03721357514633343 + -0.13976520400419284i, 0.09630619250129474 + -0.0837668742184287i, 0.01847816930617626 + -0.06682249444569588i }, { -0.02361343309071801 + 0.05584277999302861i, 0.05796172216309874 + -0.15330358457993407i, -0.00022397230208182187 + -0.1484742357220603i, -0.11392510124192314 + 0.005382262441233028i }, { -0.0724879688870008 + -0.11265941299215226i, 0.06944271528516055 + 0.04261478415219792i, 0.007295970153727825 + -0.1765310445815667i, 0.029450123446151766 + -0.06522301894102196i } }), Matrix({ { 0.06928952045411275 + 0.0813027829932957i, 0.07868921536649225 + 0.05264878280860266i, -0.0427058195459152 + 0.08605465145399549i, -0.016956919468593037 + 0.0692291073772585i }, { 0.028200638356207425 + 0.03912579040498616i, -0.08680062539248444 + 0.07405020678546631i, 0.14239237941644325 + -0.04287989230165642i, -0.0546500464974724 + -0.03431992172640776i }, { -0.03591380813251238 + 0.0780056222124933i, -0.0951825554030705 + -0.011491786059986015i, -0.061198214291247714 + 0.12315007066422343i, -0.017368177415885026 + -0.015109316106053216i }, { -0.0046605132278210015 + 0.06360050570005499i, -0.017586258550419613 + 0.15813945447223282i, 0.0673726499470674 + -0.004016818017548136i, 0.06567614438515924 + -0.08328692419948197i } }), Matrix({ { 0.08332139439165372 + -0.003433250162166452i, 0.023734860978911865 + -0.15866452446217613i, -0.05319352529191641 + 0.10062719603656438i, 0.07704769403732296 + 0.11856009878519339i }, { -0.049966387605527275 + -0.1055314955698876i, -0.05520845663989002 + 0.041827690612943835i, 0.03584379104679446 + -0.20481471195627332i, 0.008822341555914336 + 0.07602943829935935i }, { 0.0012850582390746068 + -0.05172116432581859i, 0.02023351447136998 + -0.004084876635500971i, -0.0015983399963720754 + -0.0010762449429616802i, 0.04668427547615925 + -0.07854575112903457i }, { -0.03790243686441767 + -0.11018687076229652i, -0.0182105482147051 + 0.1434436618845352i, 0.0445269000831155 + 0.16045115791168124i, -0.22623928758399983 + -0.057432127879810474i } }), Matrix({ { -0.16480242503743026 + -0.053009407009822096i, -0.11636403413299726 + 0.10731281899253628i, -0.16945857545821022 + 0.04182876725894017i, -0.01371032043438374 + 0.08325999418949298i }, { -0.15059384699004916 + 0.13842692085427957i, 0.02897953872136175 + 0.003146364789622904i, 0.2461319304895069 + -0.05963693351625192i, 0.06280747087786284 + -0.02027749026625193i }, { -0.13860043934937089 + -0.0970635049268207i, 0.004410000596417267 + 0.030262030839615338i, 0.0031926592165565128 + 0.07374732848316187i, -0.052515161605197015 + -0.06415044778719367i }, { 0.1135648693818305 + 0.09304261179824756i, 0.10904733712420198 + 0.035499565477315455i, -0.0771187049609608 + -0.12297568663635824i, -0.0370812342528441 + 0.002558880945794744i } }), Matrix({ { -0.13211722908878967 + 0.041752409891889386i, 0.043412706831057926 + -0.04388194882779611i, -0.0319064897494823 + -0.13029713167969476i, -0.025781592417371588 + -0.03228541182461528i }, { 0.004266664504717216 + -0.05982714366568006i, -0.18511133281762907 + 0.06466677574675658i, -0.18855170715175976 + 0.12176055127408592i, 0.1714289741465581 + 0.16680365998835828i }, { 0.028138755762602934 + -0.02993897015351765i, -0.038759533503434314 + 0.19672569114287805i, -0.005624932858233414 + 0.06374210227920957i, -0.17000365450133187 + -0.027731054676047227i }, { -0.06585639505359901 + 0.12407563505634121i, -0.019538560334580405 + -0.17527591457153943i, -0.04827614014332579 + 0.10743614655439429i, -0.0529243237696132 + -0.07203758599730734i } }), Matrix({ { -0.01136949384484191 + 0.04700200261771072i, -0.0357308540407073 + 0.11013034834358083i, -0.11761708717027787 + 0.021588228215720352i, -0.007721606166194895 + -0.08252569024102444i }, { -0.08738355232822152 + 0.008531132937870674i, -0.032211585972755676 + -0.08455242707887309i, 0.04771343751111835 + -0.03752490867229729i, -0.1627567851430265 + -0.20197760666639905i }, { -0.08676369038117256 + -0.1067078516135437i, -0.09466792101164984 + -0.15423927910730648i, -0.12509867773588415 + 0.1866801000924108i, -0.2083660791235041 + -0.14582916565503956i }, { 0.042022464866737615 + -0.027214862610305417i, -0.012619635555219631 + -0.017280013061713853i, -0.10625574537263076 + 0.05094833800110891i, 0.08915833412543753 + 0.15841787672682742i } }), Matrix({ { 0.10277907662242235 + 0.10952539722387733i, -0.12441843021860165 + -0.021064433899267678i, 0.09598152066647339 + -0.031204268772248692i, 0.09504574362642852 + 0.16883032398989142i }, { -0.05313877054440974 + -0.12481616621561188i, 0.09584580880796695 + -0.0775259869221335i, -0.05454382532488734 + 0.183814740670123i, 0.043006659924411154 + 0.1709476732447525i }, { 0.009488532726537534 + -0.010290601441407886i, -0.018244249615431328 + 0.16357187633372416i, 0.0869316389380787 + 0.0727642957427097i, 0.06329929144791528 + 0.017888209197574688i }, { -0.01565553289560126 + -0.09175425421084354i, -0.05022392245411595 + -0.09764682981390249i, -0.0369147488332045 + -0.059889159773503356i, -0.09767417842680577 + -0.03947190621505973i } }), Matrix({ { 0.04122697186524648 + 0.009189331039149833i, -0.048904453804119744 + -0.08361905146915585i, 0.08482322245341611 + 0.07282921717716045i, -0.043724486689290236 + 0.09279958823074241i }, { -0.06796031240807689 + -0.243091154160991i, 0.08384733869358532 + -0.033752113897554545i, -0.07513175928205887 + -0.0416003285721152i, 0.07424039445333973 + -0.05237380512875915i }, { 0.01608181738155753 + -0.0324264476767136i, 0.017505618018704656 + -0.04243920646059871i, -0.013225163883684853 + -0.013953487669538425i, 0.0070806667511108074 + -0.017554799453780807i }, { -0.07129408261961684 + 0.009471908550433894i, 0.08904360499330058 + 0.06570877977057415i, -0.06479109431728601 + 0.0805861244574864i, -0.03162793063925001 + 0.11200610216531384i } }), Matrix({ { -0.003011527782760607 + 0.11034936328123418i, -0.02683821205918248 + 0.12532169526407977i, 0.03113101728862294 + 0.001621730261657452i, 0.05462105858800308 + 0.004006654581039741i }, { -0.12543948226079635 + 0.06380340309147779i, 0.07331013765520794 + 0.05300273706003144i, 0.10337097032285888 + -0.010366705089633273i, 0.029206183715196555 + -0.09993764316102553i }, { -0.016572224546739123 + -0.046260925165635104i, 0.020365644263348342 + 0.07135863464022404i, -0.007337366989425791 + 0.007902395443921316i, 0.11161479659790367 + -0.02589302228868133i }, { -0.02018850092339735 + 0.00595057000324099i, -0.019683068833965565 + -0.0759731965089333i, 0.047650456587140025 + 0.06635234770150555i, 0.05273672242997179 + 0.05766435095639419i } }), Matrix({ { 0.083215917988655 + -0.16889074444484156i, -0.12710573512232842 + -0.05226581929441216i, 0.07618638947550985 + -0.06922209276290772i, 0.026443334225235055 + 0.14668633569450207i }, { -0.05559710297331927 + 0.08081276716430981i, -0.03317352018538124 + -0.014095877907474021i, -0.08191043145791749 + -0.08564770848065151i, 0.015618605741797274 + -0.0747115623275565i }, { -0.06886598678321833 + 0.14587058246726994i, 0.003506006220591565 + -0.018806280693585888i, -0.007471170268003558 + 0.10643285830704285i, -0.021241805346335838 + -0.09304256476874541i }, { 0.04500110133060552 + -0.00937102410130082i, 0.24580608011224905 + -0.004789074050285622i, 0.06417646136672674 + 0.0836724887354003i, -0.1812267953790004 + 0.06661092485240062i } }) }, { QubitIndex{ 1 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.07149451441763398 + 0.09242827173126801i, -0.09021151222022422 + -0.0007900662710471984i, 0.0468057215146685 + 0.04187953302572977i, -0.040217481350855164 + -0.024873475494486496i }, { -0.0348418742855278 + -0.05663856056270902i, -0.09884720654219159 + -0.01421592092956789i, 0.06423012488554847 + -0.03148011136172045i, 0.08276851716941172 + -0.07428906674585051i }, { 0.15599561076610627 + -0.04414722605052792i, -0.027177317919177362 + -0.01572055398216749i, 0.05709039667909509 + -0.07734959580007546i, 0.012002554267299402 + -0.16157056389298585i }, { 0.09091755336708496 + -0.09240559414424705i, 0.012271693080849227 + 0.11732530852319165i, -0.10867219927014615 + 0.09651921541084767i, 0.06841614816580406 + 0.11128971030128368i } }), Matrix({ { -0.10622088704835712 + 0.05982086982497455i, 0.02092511461118174 + -0.10845822170318008i, -0.017356724027422773 + -0.0429416920926908i, 0.16591127035712172 + 0.049402287641283335i }, { -0.08956095210959382 + -0.10688833554516684i, -0.17251446608846607 + 0.081903349968871i, -0.0416116402885742 + 0.0388812362242792i, -0.07786437043396419 + 0.02637542587655162i }, { 0.145177679305047 + 0.06796914572985348i, 0.02611427058354457 + -0.029350063517706602i, 0.09593968800222054 + -0.12605740896356957i, 0.07353031851060063 + 0.012328782505871714i }, { 0.07374244044537084 + 0.16255619950563027i, -0.06980896871962436 + -0.009257185827228448i, -0.08642611573811057 + -0.002205422265461864i, -0.1658371082138961 + 0.12199991659436528i } }), Matrix({ { 0.036981130545054815 + 0.09857515535505192i, -0.0736108122497372 + 0.08952698007175361i, 0.18339241315636148 + 0.055906152386375245i, 0.09753054363280757 + -0.05232778332694759i }, { 0.014342507902900257 + 0.0310778732098975i, 0.06622872727178793 + 0.02168820769317351i, 0.0616960372206058 + -0.08696927150181931i, -0.13535142286927032 + -0.03724197754360259i }, { -0.06560014216051818 + -0.017592498904950845i, 0.023111718882447594 + 0.0647978955932252i, -0.0174372872565417 + -0.021499192898312078i, -0.05485004899012848 + 0.0028442744126246527i }, { 0.06937044688957782 + 0.1861384290985394i, 0.03639144292955572 + 0.09634063341198035i, 0.0923828185480422 + -0.08641823041513341i, 0.07148069208292156 + 0.06077300114847727i } }), Matrix({ { 0.05715558751264925 + -0.08641489719328085i, -0.05958305780037323 + 0.08328102798508166i, -0.027349225507675278 + -0.06197834431748853i, -0.19306774443705052 + 0.0712149000638544i }, { 0.02411734992631998 + 0.08232529745939805i, -0.06443784174594032 + -0.04132141973673823i, -0.02412207633121271 + 0.018482879522454636i, -0.0149392951775547 + 0.22299433494060725i }, { 0.11260795310465486 + 0.016506085396773295i, 0.0444818792908888 + 0.07835629710583766i, 0.024136498454580206 + -0.16194224118597136i, 0.005630418923128788 + 0.014173273127549554i }, { 0.008074323140787319 + 0.12859751094784763i, 0.21988829169813723 + -0.07157302718353843i, 0.1162832874798932 + 0.11621650072419282i, -0.12987964132804458 + 0.03981704401545336i } }), Matrix({ { 0.06387097552320907 + -0.05747070468160152i, -0.004672199060918157 + 0.0495407727679641i, 0.013814376122954579 + 0.01919276115798216i, 0.09824416391708714 + 0.07115742786659132i }, { -0.09560720730522236 + 0.04293112211835931i, -0.0015564877744499675 + -0.14232889193324424i, 0.05139459341804386 + -0.09397932859923173i, -0.09588528375407138 + 0.04455191293287351i }, { -0.06509222051057888 + -0.03664793009897697i, -0.2559920905261044 + 0.14864193686324895i, 0.01589119091710435 + 0.07631811421322526i, 0.07394169594864121 + -0.0747722368985519i }, { 0.11132805952169547 + -0.045734025391924275i, 0.06675338545544424 + -0.0880304321126072i, 0.029505499472247825 + 0.022900024902673823i, -0.10378026305036606 + -0.016336262157278483i } }), Matrix({ { -0.026682093874444812 + -0.0063037522302571815i, -0.06354950349425376 + -0.02611042117459894i, -0.022279251785494412 + 0.05846031051184328i, 0.08819874351065635 + -0.001728852217235352i }, { -0.04659435593426966 + 0.09881062738800037i, 0.03617206416080302 + 0.03309113138496059i, 0.11124001971892436 + 0.020477006901949056i, 0.15333960057425855 + 0.06683106653260601i }, { 0.05718207839171855 + 0.1423439053699696i, 0.08756773357108202 + 0.03026911370073117i, -0.05300230186115758 + 0.08336794698677635i, 0.03696951918650815 + -0.015099387119057043i }, { 0.11570175555735633 + -0.08303930751697726i, 0.13181663313227687 + -0.03671872400013535i, -0.007288527800934783 + -0.17119210066490348i, 0.007482404680152253 + 0.025196796400359607i } }), Matrix({ { 0.00963836009370503 + 0.041441286952578815i, -0.05190709229716876 + -0.047127558492411036i, 0.010340296700898756 + -0.0773725513413801i, 0.06702725037400055 + 0.02962703524320541i }, { 0.05790494207881262 + -0.029045044163466514i, -0.1353798181543632 + -0.13006409084305418i, -0.057290078772679234 + -0.005532871476954207i, 0.029945208061616425 + 0.09149186691310367i }, { -0.06269027378996364 + 0.026853651051413917i, 0.07010266157425785 + 0.12174087780098058i, -0.07521223167357122 + 0.13908657641259928i, -0.07839125655142436 + 0.19249495931635915i }, { 0.04867346863053109 + -0.10376619120100598i, 0.0691173176129126 + -0.04371814054313271i, -0.19754772929027017 + -0.01148669669893306i, 0.04255873007045901 + 0.00037120128085467587i } }), Matrix({ { 0.007486277293783238 + -0.12102971407430833i, -0.006368239631100351 + 0.017319979791004015i, 0.01412027167954684 + 0.024782325828447024i, -0.02633515357985276 + -0.03408627733681988i }, { -0.10467924492801609 + -0.051891992373754525i, 0.21428375009757286 + 0.16155004654698527i, -0.019003725301604976 + -0.15200947572417484i, -0.01021479190667711 + -0.015184930878416216i }, { -0.30779011730453376 + -0.006925522059510899i, -0.05906538185134798 + -0.026091130567300835i, 0.040869596246605584 + -0.06162508562753093i, 0.10542173188119168 + -0.05081311033345575i }, { -0.0033157353126567965 + -0.0157680611242341i, -0.03745632719415872 + 0.11103357334370006i, 0.012153406182875307 + 0.057343710123600955i, -0.01897850062597843 + -0.1107951971778467i } }), Matrix({ { -0.06408642449504766 + -0.11987484939936653i, -0.1041911095571248 + -0.13786250090546084i, 0.09307245245451914 + 0.054603737179131986i, -0.07242555523008884 + -0.11068920676167424i }, { -0.097876481535058 + 0.04886004999722046i, -0.04045758093674969 + -0.19137111656686256i, -0.08795537228459938 + -0.06663391031174473i, -0.15723452527588969 + 0.07361823406735966i }, { 0.006041577553886326 + -0.026236206968424262i, -0.09529303814134428 + 0.09406956190497469i, 0.0993011772964431 + -0.054481037593569724i, -0.041457388559213576 + 0.08535435132990465i }, { -0.07006263141424987 + 0.12016207989586605i, 0.11389895925100578 + -0.03373217490449131i, -0.16836706065591706 + -0.009717852709735816i, 0.04888278930110586 + -0.040929620240289094i } }), Matrix({ { -0.040657110378609744 + 0.020324521190722426i, -0.14519850695390293 + 0.028245949081930562i, 0.050535912873413615 + -0.029224937898180016i, 0.0379460517984046 + 0.15837192277733325i }, { -0.09988335505104426 + 0.04102165807567991i, 0.20557015717217522 + -0.05270670054280812i, -0.0832045449501248 + -0.02934271457604906i, -0.05419240593943462 + 0.16655595037551302i }, { -0.10247934809650104 + -0.014644234060736349i, 0.010366347814741812 + -0.04490355548748652i, 0.05623416371060423 + -0.012983958158407713i, 0.16826845740412097 + -0.12122744201649413i }, { -0.1385762588838012 + 0.06671852245720193i, 0.04793555706020426 + 0.1349868363180838i, 0.05803925102709753 + -0.10972605204484147i, 0.13057555331966483 + 0.06384795918897539i } }), Matrix({ { 0.06636836644290688 + 0.03841821511657791i, 0.05654361319999089 + -0.12850700787853925i, 0.12028310053588617 + -0.027025701516741576i, 0.033626304480163904 + -0.03810267262597451i }, { -0.24559213163104057 + 0.10137648580244762i, 0.12590077467799507 + -0.07352416458360969i, 0.015809649019354544 + 0.05709079214344006i, 0.04865612540851466 + -0.028869638510694292i }, { 0.09500782412677776 + -0.06544278637292954i, -0.05544539408926586 + 0.1368947488488597i, -0.023633574965071923 + 0.07594301003541645i, -0.15715338742931306 + -0.07841225859902225i }, { -0.0443216173357278 + -0.03883858102602327i, -0.006442722677371286 + -0.013269949232714809i, -0.12608860596723173 + 0.02065832540644031i, -0.04178263397492783 + 0.12016205638184348i } }), Matrix({ { -0.08673304752996829 + -0.014578165847650863i, -0.006301046780794385 + -0.10773353465361506i, 0.03657139228088849 + 0.03039067188567729i, -0.15417102423432985 + 0.019692941072316072i }, { -0.015509346587488931 + 0.04356863198374816i, -0.05742919627289834 + -0.0690762666621586i, -0.04004706006320346 + -0.15525195173860126i, 0.07447055344761243 + 0.09291952658593008i }, { -0.04870077377956537 + 0.050276653267383106i, -0.028075201003348708 + 0.03426929194722949i, 0.07194792159557768 + -0.08698306029190325i, 0.010914366304302892 + 0.06254743782328004i }, { 0.015926438576597163 + 0.15332092098565048i, 0.0073136956871541585 + -0.02939852334942465i, 0.25369456755654063 + 0.1910264473615613i, -0.07394079643146792 + 0.002605295678817589i } }), Matrix({ { -0.13947935109826337 + 0.10170008757796638i, 0.01010475625287495 + 0.0806991013720372i, -0.025519840941457612 + 0.07855076940780108i, -0.00251412756342826 + -0.03325835968537724i }, { -0.08108030853815848 + 0.004981425246154344i, 0.07272493827381488 + 0.04162606571918626i, -0.04376666179222952 + -0.28304257031508556i, 0.02619355479545337 + 0.05358287235028698i }, { -0.0366067403519827 + 0.0013920285281917699i, 0.13160532262211155 + -0.17066168088578726i, 0.06435673432408325 + 0.011179097688583299i, -0.08661674979736923 + 0.04879802678763674i }, { -0.03146557575249775 + -0.02393020134616378i, -0.01697582968189584 + -0.0845358606573353i, 0.07989966185990396 + -0.1045903982332605i, 0.02073559585203736 + 0.0539965652585364i } }), Matrix({ { -0.004482612501785333 + 0.0701412258323558i, -0.047599776035863225 + 0.07297385806701202i, 0.02363299343453105 + 0.06319106163877226i, -0.19434023067597586 + 0.08079655680740189i }, { 0.1547683469458034 + 0.0022662522011583793i, 0.06193303021988449 + -0.08855815549327034i, 0.09885198613229174 + 0.03351559299909376i, -0.09707391983282733 + 0.01601910864157951i }, { -0.11801388844805688 + 0.014189565700947615i, -0.02772704433578533 + -0.0769874804093131i, 0.05614515473662663 + -0.03629414591179361i, -0.2235861909191865 + -0.05047014181967239i }, { -0.06507731284693329 + -0.11451824306938854i, 0.08012309986628033 + 0.10082682700613467i, 0.14283602621672753 + -0.05777356729099585i, 0.09400296927171932 + -0.0692317383906194i } }), Matrix({ { -0.00981208256171588 + 0.1250254450694483i, -0.09127961748624329 + -0.017047931930705695i, 0.09748755708290253 + -0.2748024607220253i, -0.034035146909538655 + -0.012026306891776951i }, { 0.029488618937190122 + 0.08981042321404957i, -0.0015569190763161634 + -0.009823259657393205i, 0.07410190397749385 + 0.046014153525802966i, -0.0846673433767969 + -0.1445314753776109i }, { 0.04456836089341929 + 0.10544764383917388i, -0.10759842418721781 + -0.061995732554361235i, 0.04977055950136946 + 0.01871575243406491i, 0.06260885109945641 + -0.10478595172021306i }, { -0.138463969066011 + 0.11949390682517212i, -0.10587252408207513 + 0.11097494742314121i, -0.029177339938260806 + -0.01940528579800326i, -0.051023836870982414 + 0.005848361333962575i } }), Matrix({ { -0.07022074704938573 + 0.11400031326861901i, 0.08193865049409678 + -0.03474654053782129i, -0.14490493269207216 + -0.13845328793279396i, 0.1269201805041928 + -0.06086322846331559i }, { -0.007858988726966193 + -0.14669508692601052i, 0.0016110801952151893 + -0.060149187908354114i, 0.12214423652634229 + -0.08616467340990988i, 0.11449125929415618 + -0.12718717938698063i }, { 0.08272979939257692 + 0.18369936570206777i, -0.10086122057827095 + 0.172877066554994i, -0.13828579465599572 + -0.03297028735411295i, -0.05737489170089676 + -0.08702100619291309i }, { 0.13675036122856646 + -0.027717499761046187i, 0.02277551395162869 + 0.03513314254428198i, -0.048848863194034656 + 0.049545221466337226i, -0.021542454127778353 + -0.019323388263245835i } }) }, { QubitIndex{ 0 }, QubitIndex{ 9 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.3291488223804997 + 0.08799075970104112i, -0.2563068166928524 + 0.04905983717506292i }, { 0.345310850006919 + 0.08504896059991175i, -0.27924937290413754 + -0.047650392995911464i } }), Matrix({ { -0.03308864244119418 + -0.22880964193065118i, -0.029054913883542585 + -0.19130240067550824i }, { 0.02603396100633739 + -0.24521173282154857i, 0.5069391340522057 + -0.048069739538444164i } }), Matrix({ { -0.28113695172774295 + -0.4921364525234288i, -0.24969765647454806 + 0.4807292420246927i }, { 0.26366419604443614 + -0.33758271895056824i, 0.04380031049802659 + 0.16794380730106592i } }), Matrix({ { -0.11293640731091634 + -0.2302190076130946i, -0.15222109398189318 + -0.3006657456577175i }, { 0.17707222403448658 + 0.20337976432519933i, -0.014286843688764574 + 0.34287317551926766i } }) }, { QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 0 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 9 }, QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.07139221941285445 + 0.10021265274305284i, -0.6041057433099546 + -0.189377406838168i }, { -0.22480141432443837 + 0.07643739165867997i, 0.12794908336300675 + -0.1661537890392369i } }), Matrix({ { -0.13446444900400045 + 0.06784131389848214i, 0.04752755047132182 + -0.04110642831627473i }, { 0.5770614498135609 + 0.004104220450820789i, -0.306974482958552 + 0.06106868492815104i } }), Matrix({ { -0.14472935907281193 + -0.19423115356845086i, -0.015995318029406055 + 0.2985936159176301i }, { -0.07090706639524808 + -0.4123535774634438i, -0.02994855758240529 + -0.4839364671981157i } }), Matrix({ { 0.23537524323834635 + -0.41071167605538433i, -0.20773895497588912 + -0.27444548417143066i }, { -0.2831832113866776 + 0.18646286657925615i, -0.03904671319318584 + -0.09379346515380138i } }) }, { QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.06092683710595859 + -0.11281424502228915i, 0.6145075884823342 + 0.06921584060379266i }, { -0.30142679446823795 + -0.056047693585745614i, -0.46605316128640684 + -0.016729389941199692i } }), Matrix({ { 0.547562519309034 + 0.2336109632772326i, -0.1309564017844984 + -0.0498649815200779i }, { 0.013363282761520892 + 0.3312215937300271i, 0.28926915126918545 + 0.16849736142348834i } }), Matrix({ { 0.12154723322721352 + -0.28281051788183525i, 0.32190552684300927 + -0.0829486842025399i }, { -0.3545828728808082 + -0.029269359295949048i, 0.1179242686188158 + -0.1469551813368455i } }), Matrix({ { 0.2124702924929785 + 0.21994247821794702i, 0.05248072245296963 + -0.07223145755643526i }, { 0.02736318239258133 + 0.3311615970110373i, 0.1670953168172139 + -0.29411223329720815i } }) }, { QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.14145229070956056 + 0.39895882285822204i, -0.0018866655996712467 + -0.026534237108044166i }, { -0.031593846483173746 + 0.19377584433553413i, -0.10280908716305834 + 0.013874230645390256i } }), Matrix({ { 0.05359060623751626 + 0.2175539761843537i, -0.18347805282510293 + -0.33746519655698004i }, { 0.28885482728500256 + 0.5105287764908094i, -0.289814222556874 + -0.13062081262328726i } }), Matrix({ { -0.03614443090005972 + 0.13553906067486426i, -0.4638467173625205 + -0.2547798394493779i }, { -0.02085304306588695 + -0.39993179914752497i, -0.48814829676063154 + -0.25177025665857633i } }), Matrix({ { 0.16598691158217233 + 0.05472477653923204i, 0.04714158718203198 + 0.19907033661453508i }, { 0.3980562843031443 + 0.13763944909142153i, 0.33644288480101975 + -0.0560395268644854i } }) }, { QubitIndex{ 6 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 10_20_2_70_0_50) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false, false}), Matrix({ { 0.4423148449329799 + 2.1969917069408425e-19i, -1.0587168777441728e-05 + -2.5957478657705983e-05i }, { -1.058716877744162e-05 + 2.595747865770555e-05i, 0.5576851550670199 + 9.466916674546894e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4423148449329799, 1.0e-7), DoubleNear(0.5576851550670199, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false, false}), Matrix({ { 0.542840546700402 + 1.540541172818759e-19i, 0.03787726887830122 + -0.01618880335891866i }, { 0.03787726887830122 + 0.01618880335891866i, 0.45715945329959784 + 1.6031422015767719e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.542840546700402, 1.0e-7), DoubleNear(0.45715945329959784, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false, false}), Matrix({ { 0.5352990369122881 + 6.225705782929805e-20i, -0.061289398351792944 + -0.035149792831493096i }, { -0.061289398351792944 + 0.035149792831493096i, 0.46470096308771175 + 2.521112796102551e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5352990369122881, 1.0e-7), DoubleNear(0.46470096308771175, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false, false}), Matrix({ { 0.9999999999999998 + 3.1436833743955316e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false, false}), Matrix({ { 0.5565217286580375 + 1.8215362943006502e-19i, -0.02573853156966379 + -0.1981547658452578i }, { -0.02573853156966379 + 0.1981547658452578i, 0.44347827134196227 + 1.322147080094881e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5565217286580375, 1.0e-7), DoubleNear(0.44347827134196227, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false, false}), Matrix({ { 0.4905371606761533 + 2.580406464471422e-19i, 0.003641432293825837 + 0.017393086999944796i }, { 0.003641432293825837 + -0.017393086999944796i, 0.5094628393238465 + 5.632769099241098e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4905371606761533, 1.0e-7), DoubleNear(0.5094628393238465, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false, false}), Matrix({ { 0.3722637829203394 + 2.402084015039154e-19i, 0.30982595838819393 + 0.0920975523578844i }, { 0.30982595838819393 + -0.0920975523578844i, 0.6277362170796603 + 7.415993593563773e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3722637829203394, 1.0e-7), DoubleNear(0.6277362170796603, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false, false}), Matrix({ { 0.9999999999999998 + 3.1436833743955316e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true, false}), Matrix({ { 0.46730641682289076 + 9.83549455168054e-20i, -0.13995156539916512 + -0.04604987601741041i }, { -0.13995156539916512 + 0.04604987601741041i, 0.532693583177109 + 2.1601339192274777e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.46730641682289076, 1.0e-7), DoubleNear(0.532693583177109, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, false, true}), Matrix({ { 0.43425919637513044 + 4.681180522560093e-20i, -2.927345865710862e-18 + -5.421010862427522e-18i }, { -3.0357660829594124e-18 + 4.9873299934333204e-18i, 0.5657408036248693 + 2.675565322139522e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.43425919637513044, 1.0e-7), DoubleNear(0.5657408036248693, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false, false}), Matrix({ { 0.24005290671643523 + 8.6714997975159e-20i, -0.0035746326422132027 + -0.0020847409809872514i, 0.016746192929114362 + -0.0072516595398672695i, -0.0024824797428907985 + 0.00045853291505830386i }, { -0.0035746326422132027 + 0.0020847409809872505i, 0.3027876399839668 + 6.73391193067169e-20i, -0.0008138803274118562 + 0.002404107196623107i, 0.021131075949186864 + -0.008937143819051394i }, { 0.01674619292911436 + 0.0072516595398672695i, -0.0008138803274118562 + -0.0024041071966231075i, 0.20226193821654476 + 1.329841727189252e-19i, 0.003564045473435761 + 0.002058783502329545i }, { -0.002482479742890798 + -0.0004585329150583041i, 0.021131075949186864 + 0.008937143819051393i, 0.0035640454734357607 + -0.002058783502329545i, 0.2548975150830531 + 2.7330047438752034e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24005290671643523, 1.0e-7), DoubleNear(0.3027876399839668, 1.0e-7), DoubleNear(0.20226193821654476, 1.0e-7), DoubleNear(0.2548975150830531, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false, false}), Matrix({ { 0.2367736959646447 + 5.598865950828063e-20i, -6.99529554923367e-06 + -1.4847079539544671e-05i, -0.027117368976204502 + -0.015531870260491219i, -5.730906238664211e-06 + -2.8307853375479343e-06i }, { -6.995295549233778e-06 + 1.4847079539544346e-05i, 0.2985253409476434 + 6.268398321017413e-21i, -2.6710959202545564e-06 + 3.1235820390190225e-06i, -0.03417202937558845 + -0.019617922571001874i }, { -0.027117368976204502 + 0.015531870260491219i, -2.6710959202545327e-06 + -3.1235820390189547e-06i, 0.20554114896833525 + 1.6371051118580357e-19i, -3.591873228208221e-06 + -1.111039911816142e-05i }, { -5.730906238664255e-06 + 2.83078533754788e-06i, -0.03417202937558845 + 0.019617922571001874i, -3.59187322820795e-06 + 1.1110399118161854e-05i, 0.2591598141193765 + 8.840076842445151e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2367736959646447, 1.0e-7), DoubleNear(0.2985253409476434, 1.0e-7), DoubleNear(0.20554114896833525, 1.0e-7), DoubleNear(0.2591598141193765, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false, false}), Matrix({ { 0.4423148449329799 + 2.1969917069408425e-19i, -1.0587168777441728e-05 + -2.5957478657705983e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.058716877744162e-05 + 2.595747865770555e-05i, 0.5576851550670199 + 9.466916674546894e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4423148449329799, 1.0e-7), DoubleNear(0.5576851550670199, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false, false}), Matrix({ { 0.24615782211321385 + 1.254943759072753e-19i, -5.891989469616269e-06 + -1.4445900894190819e-05i, -0.011384534600038451 + -0.08764679452757615i, -4.871099927539592e-06 + 2.7660053339584746e-06i }, { -5.8919894696160525e-06 + 1.4445900894190602e-05i, 0.3103639065448237 + 5.665925352278969e-20i, 5.4160962831625175e-06 + 1.4297905661579777e-06i, -0.01435399696962534 + -0.11050797131768161i }, { -0.011384534600038451 + 0.08764679452757615i, 5.416096283162653e-06 + -1.4297905661580184e-06i, 0.19615702281976607 + 9.420479478680887e-20i, -4.695179307825567e-06 + -1.1511577763515489e-05i }, { -4.871099927539538e-06 + -2.7660053339585694e-06i, -0.01435399696962534 + 0.11050797131768161i, -4.695179307825459e-06 + 1.1511577763515597e-05i, 0.24732124852219617 + 3.800991322267924e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24615782211321385, 1.0e-7), DoubleNear(0.3103639065448237, 1.0e-7), DoubleNear(0.19615702281976607, 1.0e-7), DoubleNear(0.24732124852219617, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false, false}), Matrix({ { 0.21697639786746575 + 1.2440796412797539e-19i, 1.0758292757779317e-05 + -6.406428402972201e-06i, 0.0016521890926782137 + 0.007703187500675593i, 4.007140473386979e-06 + -6.23705035784781e-06i }, { 1.0758292757779317e-05 + 6.40642840297231e-06i, 0.2735607628086875 + 1.3363268231916678e-19i, -1.3206909951594958e-06 + 6.006357802637009e-06i, 0.0019892432011476228 + 0.0096898994992692i }, { 0.0016521890926782137 + -0.007703187500675593i, -1.3206909951595433e-06 + -6.006357802637089e-06i, 0.22533844706551415 + 9.529120656610881e-20i, -2.134546153522099e-05 + -1.9551050254734215e-05i }, { 4.0071404733869855e-06 + 6.237050357847793e-06i, 0.001989243201147623 + -0.0096898994992692i, -2.134546153522099e-05 + 1.955105025473389e-05i, 0.2841243922583323 + -3.896351557369783e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21697639786746575, 1.0e-7), DoubleNear(0.2735607628086875, 1.0e-7), DoubleNear(0.22533844706551415, 1.0e-7), DoubleNear(0.2841243922583323, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false, false}), Matrix({ { 0.17716715963050533 + 1.2802401693922902e-19i, -0.0029476537232210943 + -0.0022187481618581974i, 0.13993433882979206 + 0.0454065061204291i, 0.002006876698174529 + -0.0052089417069541115i }, { -0.0029476537232210943 + 0.0022187481618581965i, 0.19509662328983407 + 1.1218438456468639e-19i, -0.003548716318194772 + -0.0030802285300077594i, 0.16989161955840187 + 0.04669104623745529i }, { 0.13993433882979206 + -0.0454065061204291i, -0.003548716318194772 + 0.0030802285300077594i, 0.26514768530247457 + 9.167515375485516e-20i, 0.0029370665544436528 + 0.002192790683200491i }, { 0.002006876698174528 + 0.0052089417069541115i, 0.16989161955840187 + -0.04669104623745529i, 0.0029370665544436528 + -0.002192790683200491i, 0.3625885317771858 + -1.751521781921745e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.17716715963050533, 1.0e-7), DoubleNear(0.19509662328983407, 1.0e-7), DoubleNear(0.26514768530247457, 1.0e-7), DoubleNear(0.3625885317771858, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false, false}), Matrix({ { 0.4423148449329799 + 2.1969917069408425e-19i, -1.0587168777441728e-05 + -2.5957478657705983e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.058716877744162e-05 + 2.595747865770555e-05i, 0.5576851550670199 + 9.466916674546894e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4423148449329799, 1.0e-7), DoubleNear(0.5576851550670199, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true, false}), Matrix({ { 0.20660713346120338 + 7.025141319657135e-20i, -1.8059850147517662e-05 + -0.0001527162361072323i, -0.061882259154960664 + -0.020310523901213i, -8.793001805293245e-05 + 4.4689164258852985e-05i }, { -1.8059850147517553e-05 + 0.0001527162361072323i, 0.26069928336168735 + 2.810353232023402e-20i, 9.687421776297045e-05 + -2.6700468183762103e-05i, -0.07806930624420444 + -0.02573935211619741i }, { -0.061882259154960664 + 0.020310523901212997i, 9.687421776297045e-05 + 2.6700468183762103e-05i, 0.23570771147177652 + 1.4944775749751286e-19i, 7.4726813700759336e-06 + 0.0001267587574495263i }, { -8.793001805293239e-05 + -4.468916425885315e-05i, -0.07806930624420444 + 0.02573935211619741i, 7.4726813700759336e-06 + -0.00012675875744952675i, 0.2969858717053325 + 6.656563442523492e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.20660713346120338, 1.0e-7), DoubleNear(0.26069928336168735, 1.0e-7), DoubleNear(0.23570771147177652, 1.0e-7), DoubleNear(0.2969858717053325, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false, true}), Matrix({ { 0.19862951872973084 + -3.726944967918924e-20i, 0.00011756395579407268 + -2.5900774131623963e-05i, -3.469446951953614e-18 + -1.5720931501039814e-18i, 1.3552527156068805e-20 + 7.453889935837843e-20i }, { 0.00011756395579407247 + 2.590077413162353e-05i, 0.23562967764539958 + 8.408125490479018e-20i, 6.776263578034403e-21 + 4.743384504624082e-20i, 5.421010862427522e-19 + -3.577867169202165e-18i }, { -3.577867169202165e-18 + 1.6263032587282567e-18i, 1.3552527156068805e-20 + -4.743384504624082e-20i, 0.24368532620324906 + 2.5696862037327346e-19i, -0.0001281511245715144 + -5.6704526082019396e-08i }, { 6.776263578034403e-21 + -3.3881317890172014e-20i, 5.421010862427522e-19 + 3.469446951953614e-18i, -0.0001281511245715141 + 5.6704526082019396e-08i, 0.32205547742162033 + 1.058791184067876e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.19862951872973084, 1.0e-7), DoubleNear(0.23562967764539958, 1.0e-7), DoubleNear(0.24368532620324906, 1.0e-7), DoubleNear(0.32205547742162033, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false, false}), Matrix({ { 0.29061664421988725 + 4.225442427943428e-20i, 0.02024154204251971 + -0.008661356705489339i, -0.03318147366060007 + -0.019047692184936238i, -0.002898575238719961 + -0.0003022142889591721i }, { 0.020241542042519708 + 0.008661356705489339i, 0.24468239269240086 + 2.0002633549863764e-20i, -0.001820149757404931 + -0.00247126916212679i, -0.028107924691192877 + -0.01610210064655686i }, { -0.03318147366060008 + 0.019047692184936238i, -0.0018201497574049314 + 0.00247126916212679i, 0.2522239024805148 + 1.1179969300244166e-19i, 0.017635726835781514 + -0.007527446653429323i }, { -0.002898575238719961 + 0.0003022142889591721i, -0.028107924691192877 + 0.016102100646556858i, 0.017635726835781514 + 0.007527446653429323i, 0.21247706060719695 + 1.4031158660781344e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.29061664421988725, 1.0e-7), DoubleNear(0.24468239269240086, 1.0e-7), DoubleNear(0.2522239024805148, 1.0e-7), DoubleNear(0.21247706060719695, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false, false}), Matrix({ { 0.542840546700402 + 1.540541172818759e-19i, 0.03787726887830122 + -0.01618880335891866i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03787726887830122 + 0.01618880335891866i, 0.45715945329959784 + 1.6031422015767719e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.542840546700402, 1.0e-7), DoubleNear(0.45715945329959784, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false, false}), Matrix({ { 0.302102559435382 + 9.304196558532208e-20i, 0.021079523152997486 + -0.00900942083021046i, -0.01397191854854185 + -0.1075664414227299i, -0.004182793819698251 + -0.007088885319109042i }, { 0.021079523152997486 + 0.00900942083021046i, 0.2544191692226556 + 8.911166384474291e-20i, 0.002232983258104651 + -0.007922237371766259i, -0.01176661302112194 + -0.09058832442252789i }, { -0.01397191854854185 + 0.1075664414227299i, 0.0022329832581046505 + 0.007922237371766259i, 0.24073798726502008 + 6.101215169655384e-20i, 0.016797745725303733 + -0.007179382528708203i }, { -0.004182793819698251 + 0.007088885319109043i, -0.01176661302112194 + 0.09058832442252789i, 0.016797745725303733 + 0.007179382528708203i, 0.20274028407694217 + 7.120255631293429e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.302102559435382, 1.0e-7), DoubleNear(0.2544191692226556, 1.0e-7), DoubleNear(0.24073798726502008, 1.0e-7), DoubleNear(0.20274028407694217, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false, false}), Matrix({ { 0.2659166968815523 + 1.3584290891590847e-19i, 0.018596870665380006 + -0.00860242212850164i, 0.002148121649827093 + 0.009410364115143365i, 0.00029651611687187983 + 0.0010783133882080395i }, { 0.018596870665380006 + 0.008602422128501642i, 0.22462046379460102 + 1.221977375312337e-19i, -0.00010017762280332661 + 0.00038888819476636297i, 0.001493310643998744 + 0.007982722884801431i }, { 0.0021481216498270925 + -0.009410364115143366i, -0.00010017762280332664 + -0.00038888819476636297i, 0.2769238498188497 + 1.8211208365967457e-20i, 0.019280398212921216 + -0.007586381230417022i }, { 0.0002965161168718797 + -0.00107831338820804i, 0.0014933106439987442 + -0.007982722884801431i, 0.019280398212921213 + 0.007586381230417022i, 0.2325389895049968 + 3.8116482626443515e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2659166968815523, 1.0e-7), DoubleNear(0.22462046379460102, 1.0e-7), DoubleNear(0.2769238498188497, 1.0e-7), DoubleNear(0.2325389895049968, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false, false}), Matrix({ { 0.21281709388631642 + 3.2037198063761587e-19i, 0.01891576078371003 + -0.008790706125001563i, 0.17170268724412052 + 0.06383939559212887i, 0.0196696931608212 + 0.0038112713521323894i }, { 0.01891576078371003 + 0.008790706125001563i, 0.15944668903402295 + -8.016357913370049e-20i, 0.006915402686445872 + 0.016002956416345145i, 0.13812327114407336 + 0.028258156765755528i }, { 0.17170268724412052 + -0.06383939559212887i, 0.006915402686445872 + -0.016002956416345145i, 0.33002345281408557 + -1.6631786335573997e-19i, 0.01896150809459119 + -0.0073980972339170985i }, { 0.0196696931608212 + -0.00381127135213239i, 0.13812327114407336 + -0.028258156765755528i, 0.01896150809459119 + 0.007398097233917099i, 0.2977127642655748 + 2.404777992913777e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21281709388631642, 1.0e-7), DoubleNear(0.15944668903402295, 1.0e-7), DoubleNear(0.33002345281408557, 1.0e-7), DoubleNear(0.2977127642655748, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false, false}), Matrix({ { 0.542840546700402 + 1.540541172818759e-19i, 0.03787726887830122 + -0.01618880335891866i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03787726887830122 + 0.01618880335891866i, 0.45715945329959784 + 1.6031422015767719e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.542840546700402, 1.0e-7), DoubleNear(0.45715945329959784, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true, false}), Matrix({ { 0.253505827119292 + 4.8114685699116865e-20i, 0.017729003301162644 + -0.007823992882384435i, -0.07593328835224611 + -0.02488936848749876i, -0.006220962622622495 + 0.0005618130835818438i }, { 0.017729003301162644 + 0.007823992882384435i, 0.21380058970359878 + 5.0240259817688494e-20i, -0.004394099849347338 + -0.004087555248466971i, -0.06401827704691901 + -0.02116050752991165i }, { -0.07593328835224611 + 0.02488936848749876i, -0.004394099849347339 + 0.00408755524846697i, 0.28933471958111 + 1.0593943158275905e-19i, 0.02014826557713858 + -0.008364810476534229i }, { -0.006220962622622495 + -0.0005618130835818438i, -0.06401827704691901 + 0.02116050752991165i, 0.02014826557713858 + 0.008364810476534229i, 0.243358863595999 + 1.1007396033998872e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.253505827119292, 1.0e-7), DoubleNear(0.21380058970359878, 1.0e-7), DoubleNear(0.28933471958111, 1.0e-7), DoubleNear(0.243358863595999, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false, true}), Matrix({ { 0.23570361494981606 + -2.541098841762925e-21i, 0.016457262079624897 + -0.0070859849544665215i, -1.6263032587282567e-18 + -2.927345865710862e-18i, -1.8973538018496328e-19 + -1.7618285302889447e-19i }, { 0.016457262079624897 + 0.0070859849544665215i, 0.1985555814253144 + 4.935290406736383e-20i, -4.0657581468206416e-20 + -2.473336205982557e-19i, -1.3552527156068805e-18 + -2.3852447794681098e-18i }, { -1.734723475976807e-18 + 2.8189256484623115e-18i, -5.421010862427522e-20 + 2.473336205982557e-19i, 0.307136931750586 + 1.5659521612363882e-19i, 0.021420006798676325 + -0.00910281840445214i }, { -1.7618285302889447e-19 + 1.4907779871675686e-19i, -1.328147661294743e-18 + 2.3852447794681098e-18i, 0.021420006798676325 + 0.00910281840445214i, 0.2586038718742834 + 1.1096131609031337e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.23570361494981606, 1.0e-7), DoubleNear(0.1985555814253144, 1.0e-7), DoubleNear(0.307136931750586, 1.0e-7), DoubleNear(0.2586038718742834, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false, false}), Matrix({ { 0.5352990369122881 + 6.225705782929805e-20i, -0.061289398351792944 + -0.035149792831493096i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.061289398351792944 + 0.035149792831493096i, 0.46470096308771175 + 2.521112796102551e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5352990369122881, 1.0e-7), DoubleNear(0.46470096308771175, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false, false}), Matrix({ { 0.29790554537140923 + 3.1140846206778634e-20i, -0.034108881919150895 + -0.01956162346855444i, -0.013777811160777552 + -0.10607205531654647i, -0.005387599853670513 + 0.013049490431656787i }, { -0.0341088819191509 + 0.019561623468554435i, 0.2586161832866283 + 1.510127832232864e-19i, 0.008542598082397159 + 0.011240082326735734i, -0.011960720408886238 + -0.09208271052871131i }, { -0.013777811160777552 + 0.10607205531654647i, 0.008542598082397159 + -0.011240082326735734i, 0.2373934915408788 + 3.111621162251941e-20i, -0.027180516432642052 + -0.015588169362938659i }, { -0.005387599853670513 + -0.013049490431656789i, -0.011960720408886238 + 0.09208271052871131i, -0.027180516432642052 + 0.01558816936293866i, 0.20608477980108347 + 1.0109849638696871e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.29790554537140923, 1.0e-7), DoubleNear(0.2586161832866283, 1.0e-7), DoubleNear(0.2373934915408788, 1.0e-7), DoubleNear(0.20608477980108347, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false, false}), Matrix({ { 0.26351423094319776 + 6.496012460103871e-20i, -0.030993630376826946 + -0.01969694084414167i, 0.0036386359496747055 + 0.018009845062802413i, -0.039711115029846915 + -0.0016148616205680156i }, { -0.030993630376826946 + 0.019696940844141666i, 0.22702292973295557 + 1.9308052184610345e-19i, 0.011304653995480153 + -0.01021507976084856i, 2.7963441511317513e-06 + -0.000616758062857621i }, { 0.003638635949674705 + -0.01800984506280242i, 0.011304653995480154 + 0.01021507976084856i, 0.2717848059690903 + -2.703066771740654e-21i, -0.030295767974966 + -0.015452851987351428i }, { -0.039711115029846915 + 0.0016148616205680154i, 2.7963441511313176e-06 + 0.000616758062857621i, -0.030295767974966005 + 0.015452851987351428i, 0.23767803335475618 + 5.903075776415165e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.26351423094319776, 1.0e-7), DoubleNear(0.22702292973295557, 1.0e-7), DoubleNear(0.2717848059690903, 1.0e-7), DoubleNear(0.23767803335475618, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false, false}), Matrix({ { 0.19927602820143508 + 2.5402071812354694e-20i, -0.022800916764334406 + -0.013083900421445038i, 0.1658506509827553 + 0.04930500234579478i, -0.01575018919004928 + -0.016516711014447513i }, { -0.022800916764334406 + 0.013083900421445038i, 0.17298775471890435 + 2.1480632969156073e-19i, -0.022219396723645042 + 0.00526317187508836i, 0.1439753074054386 + 0.04279255001208961i }, { 0.1658506509827553 + -0.04930500234579478i, -0.022219396723645042 + -0.00526317187508836i, 0.336023008710853 + 3.6854986016943346e-20i, -0.038488481587458545 + -0.022065892410048058i }, { -0.01575018919004928 + 0.01651671101444751i, 0.1439753074054386 + -0.04279255001208961i, -0.038488481587458545 + 0.022065892410048058i, 0.2917132083688074 + 3.7304949918694387e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.19927602820143508, 1.0e-7), DoubleNear(0.17298775471890435, 1.0e-7), DoubleNear(0.336023008710853, 1.0e-7), DoubleNear(0.2917132083688074, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false, false}), Matrix({ { 0.5352990369122881 + 6.225705782929805e-20i, -0.061289398351792944 + -0.035149792831493096i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.061289398351792944 + 0.035149792831493096i, 0.46470096308771175 + 2.521112796102551e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5352990369122881, 1.0e-7), DoubleNear(0.46470096308771175, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true, false}), Matrix({ { 0.2502156290933485 + -1.103195789503255e-20i, -0.028640853047462864 + -0.0159921602027427i, -0.07512890623865907 + -0.02483551747998282i, 0.007119375090028661 + 0.00797597682367785i }, { -0.028640853047462864 + 0.0159921602027427i, 0.2170907877295423 + 1.0938690341183794e-19i, 0.010190402902110391 + -0.002197064596534297i, -0.06482265916050606 + -0.021214358537427595i }, { -0.07512890623865907 + 0.02483551747998282i, 0.010190402902110391 + 0.002197064596534297i, 0.2850834078189396 + 7.32890157243306e-20i, -0.03264854530433008 + -0.019157632628750396i }, { 0.007119375090028662 + -0.00797597682367785i, -0.06482265916050606 + 0.021214358537427598i, -0.03264854530433008 + 0.019157632628750396i, 0.24761017535816945 + 1.4272437619841717e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2502156290933485, 1.0e-7), DoubleNear(0.2170907877295423, 1.0e-7), DoubleNear(0.2850834078189396, 1.0e-7), DoubleNear(0.24761017535816945, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false, true}), Matrix({ { 0.2324583820723797 + -4.237909797701799e-20i, -0.026616124059718756 + -0.015265009678581035i, 4.6426848952857414e-05 + 8.159164464946488e-05i, 9.266342334625575e-05 + -0.00010415016065451425i }, { -0.026616124059718756 + 0.015265009678581035i, 0.20180081430275076 + 8.919090320261891e-20i, -0.00014453831735784228 + 2.4371857805781303e-05i, -4.642684895286034e-05 + -8.15916446494702e-05i }, { 4.642684895285736e-05 + -8.159164464946488e-05i, -0.0001445383173578423 + -2.4371857805781303e-05i, 0.3028406548399084 + 1.0463615580631604e-19i, -0.03467327429207419 + -0.01988478315291206i }, { 9.26634233462558e-05 + 0.0001041501606545143i, -4.642684895286042e-05 + 8.159164464947003e-05i, -0.03467327429207419 + 0.01988478315291206i, 0.262900148784961 + 1.6292037640763618e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2324583820723797, 1.0e-7), DoubleNear(0.20180081430275076, 1.0e-7), DoubleNear(0.3028406548399084, 1.0e-7), DoubleNear(0.262900148784961, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false, false}), Matrix({ { 0.5565217286580375 + 1.8215362943006502e-19i, 0.0 + 0.0i, -0.02573853156966379 + -0.1981547658452578i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02573853156966379 + 0.1981547658452578i, 0.0 + 0.0i, 0.44347827134196227 + 1.322147080094881e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5565217286580375, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.44347827134196227, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false, false}), Matrix({ { 0.4905371606761533 + 2.580406464471422e-19i, 0.0 + 0.0i, 0.003641432293825837 + 0.017393086999944796i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003641432293825837 + -0.017393086999944796i, 0.0 + 0.0i, 0.5094628393238465 + 5.632769099241098e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4905371606761533, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5094628393238465, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false, false}), Matrix({ { 0.3722637829203394 + 2.402084015039154e-19i, 0.0 + 0.0i, 0.30982595838819393 + 0.0920975523578844i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.30982595838819393 + -0.0920975523578844i, 0.0 + 0.0i, 0.6277362170796603 + 7.415993593563773e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3722637829203394, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6277362170796603, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false, false}), Matrix({ { 0.9999999999999998 + 3.1436833743955316e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true, false}), Matrix({ { 0.46730641682289076 + 9.83549455168054e-20i, 0.0 + 0.0i, -0.13995156539916512 + -0.04604987601741041i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13995156539916512 + 0.04604987601741041i, 0.0 + 0.0i, 0.532693583177109 + 2.1601339192274777e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.46730641682289076, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.532693583177109, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false, true}), Matrix({ { 0.43425919637513044 + 4.681180522560093e-20i, 0.0 + 0.0i, -2.927345865710862e-18 + -5.421010862427522e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -3.0357660829594124e-18 + 4.9873299934333204e-18i, 0.0 + 0.0i, 0.5657408036248693 + 2.675565322139522e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.43425919637513044, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5657408036248693, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false, false}), Matrix({ { 0.2729945886304984 + 1.3580067184005703e-19i, -0.012625706196156414 + -0.09720227621218076i, 0.002026536194951158 + 0.00967963084390892i, 0.003352797961746829 + -0.0011692396823664067i }, { -0.012625706196156414 + 0.09720227621218076i, 0.21754257204565491 + 1.2223997460708516e-19i, -0.0035402482018536885 + 0.0002738946446824307i, 0.0016148960988746788 + 0.007713456156035876i }, { 0.0020265361949511574 + -0.00967963084390892i, -0.0035402482018536885 + -0.00027389464468243076i, 0.28352714002753915 + 4.635295759000802e-20i, -0.013112825373507376 + -0.10095248963307701i }, { 0.003352797961746829 + 0.0011692396823664067i, 0.001614896098874679 + -0.0077134561560358765i, -0.013112825373507376 + 0.100952489633077i, 0.22593569929630736 + 9.974733402402968e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2729945886304984, 1.0e-7), DoubleNear(0.21754257204565491, 1.0e-7), DoubleNear(0.28352714002753915, 1.0e-7), DoubleNear(0.22593569929630736, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false, false}), Matrix({ { 0.20717288398760775 + 1.8172402463966337e-19i, -0.009581523128937626 + -0.07376584273724973i, 0.1724248779453309 + 0.05125428904338396i, 0.010275103711322084 + -0.06376394599604732i }, { -0.009581523128937626 + 0.07376584273724973i, 0.16509089893273166 + 5.848437686425205e-20i, -0.026224034133473826 + 0.059023034478342985i, 0.137401080442863 + 0.040843263314500444i }, { 0.1724248779453309 + -0.05125428904338396i, -0.026224034133473826 + -0.059023034478342985i, 0.34934884467042976 + 4.29604790401674e-22i, -0.016157008440726164 + -0.12438892310800805i }, { 0.010275103711322082 + 0.06376394599604732i, 0.13740108044286298 + -0.040843263314500444i, -0.016157008440726164 + 0.12438892310800805i, 0.2783873724092306 + 7.373033114523606e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.20717288398760775, 1.0e-7), DoubleNear(0.16509089893273166, 1.0e-7), DoubleNear(0.34934884467042976, 1.0e-7), DoubleNear(0.2783873724092306, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false, false}), Matrix({ { 0.5565217286580375 + 1.8215362943006502e-19i, -0.02573853156966379 + -0.1981547658452578i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02573853156966379 + 0.1981547658452578i, 0.44347827134196227 + 1.322147080094881e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5565217286580375, 1.0e-7), DoubleNear(0.44347827134196227, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true, false}), Matrix({ { 0.2600661749032686 + 6.273928513820445e-20i, -0.012027780962102441 + -0.09259899360352636i, -0.07788608710434178 + -0.025627756605697553i, -0.005522854615182834 + 0.028917325859002068i }, { -0.012027780962102441 + 0.09259899360352636i, 0.2072402419196221 + 3.5615660378600936e-20i, 0.012727150183683393 + -0.026546813483695628i, -0.06206547829482334 + -0.020422119411712857i }, { -0.07788608710434178 + 0.025627756605697553i, 0.012727150183683393 + 0.026546813483695628i, 0.2964555537547689 + 1.1941434429186058e-19i, -0.01371075060756135 + -0.1055557722417314i }, { -0.005522854615182834 + -0.028917325859002068i, -0.06206547829482334 + 0.020422119411712857i, -0.01371075060756135 + 0.1055557722417314i, 0.23623802942234012 + 9.659904763088717e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2600661749032686, 1.0e-7), DoubleNear(0.2072402419196221, 1.0e-7), DoubleNear(0.2964555537547689, 1.0e-7), DoubleNear(0.23623802942234012, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false, true}), Matrix({ { 0.24167467865233783 + 2.920341795723606e-20i, -0.011177194035318125 + -0.08605052937386382i, -1.6263032587282567e-18 + -2.927345865710862e-18i, -9.486769009248164e-19 + 7.453889935837843e-19i }, { -0.011177194035318125 + 0.08605052937386382i, 0.19258451772279261 + 1.7608387268364863e-20i, 1.0570971181733668e-18 + -4.336808689942018e-19i, -1.3010426069826053e-18 + -2.2768245622195593e-18i }, { -1.6805133673525319e-18 + 2.8189256484623115e-18i, 1.0842021724855044e-18 + 4.743384504624082e-19i, 0.3148470500056997 + 1.5295021147282896e-19i, -0.014561337534345666 + -0.11210423647139398i }, { -9.215718466126788e-19 + -7.589415207398531e-19i, -1.328147661294743e-18 + 2.2768245622195593e-18i, -0.014561337534345666 + 0.11210423647139398i, 0.25089375361916966 + 1.1460632074112325e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.24167467865233783, 1.0e-7), DoubleNear(0.19258451772279261, 1.0e-7), DoubleNear(0.3148470500056997, 1.0e-7), DoubleNear(0.25089375361916966, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false, false}), Matrix({ { 0.18253076048915307 + 2.033581582222406e-19i, 0.001362136761914583 + 0.006475776918604776i, 0.1519611184268011 + 0.04510133339096957i, -0.0004711429392626772 + 0.00571885198375593i }, { 0.001362136761914583 + -0.006475776918604777i, 0.18973302243118637 + 3.6850243281674833e-20i, 0.002723821788730364 + -0.005057408114016233i, 0.15786483996139283 + 0.04699621896691482i }, { 0.1519611184268011 + -0.04510133339096957i, 0.002723821788730364 + 0.005057408114016233i, 0.3080064001870003 + 5.468248822490158e-20i, 0.002279295531911254 + 0.010917310081340018i }, { -0.0004711429392626773 + -0.00571885198375593i, 0.15786483996139283 + -0.04699621896691482i, 0.0022792955319112535 + -0.01091731008134002i, 0.3197298168926601 + 1.9477447710736145e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.18253076048915307, 1.0e-7), DoubleNear(0.18973302243118637, 1.0e-7), DoubleNear(0.3080064001870003, 1.0e-7), DoubleNear(0.3197298168926601, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false, false}), Matrix({ { 0.4905371606761533 + 2.580406464471422e-19i, 0.003641432293825837 + 0.017393086999944796i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003641432293825837 + -0.017393086999944796i, 0.5094628393238465 + 5.632769099241098e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4905371606761533, 1.0e-7), DoubleNear(0.5094628393238465, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true, false}), Matrix({ { 0.22951357076512918 + 1.032604866208458e-19i, 0.0015459324363036448 + 0.008044637558073654i, -0.06969695588873132 + -0.02359974006245685i, -5.8718037160784143e-05 + -0.0030319040641344076i }, { 0.001545932436303645 + -0.008044637558073654i, 0.23779284605776155 + -4.905541104040412e-21i, -0.0017280904642887308 + 0.002209177678476826i, -0.0702546095104338 + -0.02245013595495356i }, { -0.06969695588873132 + 0.02359974006245685i, -0.0017280904642887306 + -0.002209177678476826i, 0.26102358991102415 + 1.5478015982629636e-19i, 0.0020954998575221924 + 0.009348449441871142i }, { -5.871803716078425e-05 + 0.003031904064134408i, -0.0702546095104338 + 0.02245013595495356i, 0.002095499857522192 + -0.009348449441871142i, 0.2716699932660849 + 6.12332320964514e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.22951357076512918, 1.0e-7), DoubleNear(0.23779284605776155, 1.0e-7), DoubleNear(0.26102358991102415, 1.0e-7), DoubleNear(0.2716699932660849, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false, true}), Matrix({ { 0.2130311206687594 + 7.815202427401005e-20i, 0.0015878462796724436 + 0.007557545950532647i, 0.0002944523034601787 + 0.0004896388916237921i, 3.7225486329135644e-05 + 0.0002434689429631651i }, { 0.0015878462796724436 + -0.007557545950532647i, 0.22122807570637104 + -3.1340219048409125e-20i, 0.00015058243412440083 + 0.00015068178713620618i, -0.00029445230346018163 + -0.0004896388916237973i }, { 0.0002944523034601786 + -0.0004896388916237922i, 0.00015058243412440072 + -0.0001506817871362062i, 0.27750604000739393 + 1.798886221731321e-19i, 0.0020535860141533933 + 0.009835541049412148i }, { 3.722548632913565e-05 + -0.00024346894296316515i, -0.0002944523034601817 + 0.0004896388916237973i, 0.0020535860141533933 + -0.00983554104941215i, 0.2882347636174754 + 8.766791004082011e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2130311206687594, 1.0e-7), DoubleNear(0.22122807570637104, 1.0e-7), DoubleNear(0.27750604000739393, 1.0e-7), DoubleNear(0.2882347636174754, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false, false}), Matrix({ { 0.3722637829203394 + 2.402084015039154e-19i, 0.30982595838819393 + 0.0920975523578844i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.30982595838819393 + -0.0920975523578844i, 0.6277362170796603 + 7.415993593563773e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.3722637829203394, 1.0e-7), DoubleNear(0.6277362170796603, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true, false}), Matrix({ { 0.1739053582397584 + 7.953071999833134e-20i, 0.144771871670844 + 0.042995997185826924i, -0.0520861514771707 + -0.017106437739533627i, -0.03914396415072896 + -0.027139468456719437i }, { 0.144771871670844 + -0.042995997185826924i, 0.29340105858313237 + 1.8824225518474048e-20i, -0.047571915425741705 + -0.001380131879747947i, -0.08786541392199441 + -0.028943438277876786i }, { -0.0520861514771707 + 0.017106437739533624i, -0.04757191542574171 + 0.001380131879747947i, 0.198358424680581 + 1.6067768150558407e-19i, 0.16505408671734995 + 0.04910155517205747i }, { -0.03914396415072896 + 0.027139468456719433i, -0.08786541392199441 + 0.028943438277876786i, 0.16505408671734992 + -0.04910155517205747i, 0.33433515849652806 + 5.533571041716368e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.1739053582397584, 1.0e-7), DoubleNear(0.29340105858313237, 1.0e-7), DoubleNear(0.198358424680581, 1.0e-7), DoubleNear(0.33433515849652806, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false, true}), Matrix({ { 0.1620020165487956 + 2.2514919562151125e-20i, 0.13462113914612314 + 0.040120347760987135i, -1.1655173354219173e-18 + -1.951563910473908e-18i, -4.811147140404426e-19 + -1.8973538018496328e-18i }, { 0.13462113914612314 + -0.040120347760987135i, 0.27225717982633485 + 2.4296885663449805e-20i, -1.4094628242311558e-18 + -1.2468324983583301e-18i, -1.7076184216646695e-18 + -3.3610267347050637e-18i }, { -1.2739375526704677e-18 + 1.8431436932253575e-18i, -1.463672932855431e-18 + 1.2468324983583301e-18i, 0.2102617663715438 + 2.176934819417643e-19i, 0.17520481924207076 + 0.05197720459689727i }, { -5.285485590866834e-19 + 1.8973538018496328e-18i, -1.81603863891322e-18 + 3.144186300207963e-18i, 0.17520481924207076 + -0.05197720459689727i, 0.3554790372533255 + 4.986305027218793e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.1620020165487956, 1.0e-7), DoubleNear(0.27225717982633485, 1.0e-7), DoubleNear(0.2102617663715438, 1.0e-7), DoubleNear(0.3554790372533255, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true, false}), Matrix({ { 0.46730641682289076 + 9.83549455168054e-20i, 0.0 + 0.0i, -0.13995156539916512 + -0.04604987601741041i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13995156539916512 + 0.04604987601741041i, 0.0 + 0.0i, 0.532693583177109 + 2.1601339192274777e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.46730641682289076, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.532693583177109, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false, true}), Matrix({ { 0.43425919637513044 + 4.681180522560093e-20i, 0.0 + 0.0i, -2.927345865710862e-18 + -5.421010862427522e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -3.0357660829594124e-18 + 4.9873299934333204e-18i, 0.0 + 0.0i, 0.5657408036248693 + 2.675565322139522e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.43425919637513044, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5657408036248693, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true, true}), Matrix({ { 0.20023282734609205 + -4.413931767676548e-20i, -0.06015965707360279 + -0.018246393955097858i, -0.0004470499795925383 + -0.0010465250421788027i, 9.548959615208747e-05 + -0.005269353191268403i }, { -0.06015965707360279 + 0.018246393955097858i, 0.2340263690290384 + 9.095112290236641e-20i, -0.004744709833976157 + -0.002313900453001616i, 0.0004470499795925354 + 0.0010465250421787973i }, { -0.0004470499795925383 + 0.0010465250421788025i, -0.004744709833976157 + 0.002313900453001616i, 0.2670735894767987 + 1.4249426319357088e-19i, -0.07979190832556232 + -0.027803482062312555i }, { 9.548959615208736e-05 + 0.005269353191268405i, 0.00044704997959253527 + -0.0010465250421787975i, -0.07979190832556232 + 0.027803482062312555i, 0.2986672141480706 + 1.2506226902038136e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.20023282734609205, 1.0e-7), DoubleNear(0.2340263690290384, 1.0e-7), DoubleNear(0.2670735894767987, 1.0e-7), DoubleNear(0.2986672141480706, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false, false, false}), Matrix({ { 0.1285168269154729 + 2.5854245034055932e-20i, -0.0019138116817885569 + -0.001116360892450936i, 0.00894931143618449 + -0.0038800311630088186i, -0.0013286942344349127 + 0.0002471556061977066i, -0.014677916379493157 + -0.008415469773798246i, 0.00013994673819356932 + 0.0002508128993683974i, -0.0012832921588877568 + -0.00012678682977206458i, 0.00016139708178792723 + 5.9571062065717274e-05i }, { -0.0019138116817885569 + 0.001116360892450936i, 0.1620998173044143 + 1.6400179245378327e-20i, -0.0004343827609753744 + 0.0012879187556702394i, 0.01129223060633522 + -0.004781325542480521i, 0.0002881541779661718 + 4.459683967086289e-06i, -0.018503557281106916 + -0.010632222411137992i, 0.00013088988035090375 + -0.0001120093810483601i, -0.0016152830798322041 + -0.00017542745918710755i }, { 0.00894931143618449 + 0.003880031163008819i, -0.0004343827609753745 + -0.0012879187556702394i, 0.10825686904917178 + 3.0134414474224675e-20i, 0.0019068163862393233 + 0.0011015138129113911i, -0.0008028387337670907 + -0.00109852140329536i, -3.5917281299174006e-05 + 0.00017804646733145463i, -0.012439452596711344 + -0.007116400486692975i, -0.00014567764443223352 + -0.00025364368470594533i }, { -0.0013286942344349125 + -0.0002471556061977066i, 0.01129223060633522 + 0.004781325542480521i, 0.0019068163862393233 + -0.0011015138129113913i, 0.13642552364322907 + -1.0131780924360908e-20i, 0.0001383397939125014 + 0.00011770438535420691i, -0.0010173110236378405 + -0.0013727477588314305i, -0.0002908252738864264 + -1.3361019280672527e-06i, -0.015668472094481533 + -0.008985700159863882i }, { -0.014677916379493157 + 0.008415469773798244i, 0.0002881541779661718 + -4.4596839670862074e-06i, -0.0008028387337670909 + 0.00109852140329536i, 0.00013833979391250143 + -0.00011770438535420683i, 0.11153607980096229 + 6.086075294110306e-20i, -0.0016608209604246455 + -0.0009683800885363155i, 0.00779688149292987 + -0.0033716283768584505i, -0.0011537855084558857 + 0.00021137730886059704i }, { 0.00013994673819356932 + -0.00025081289936839735i, -0.018503557281106916 + 0.010632222411137992i, -3.5917281299174006e-05 + -0.00017804646733145463i, -0.0010173110236378403 + 0.0013727477588314303i, -0.0016608209604246455 + 0.0009683800885363155i, 0.1406878226795525 + 5.0938940061338556e-20i, -0.0003794975664364813 + 0.001116188440952868i, 0.009838845342851643 + -0.0041558182765708725i }, { -0.0012832921588877568 + 0.00012678682977206458i, 0.0001308898803509038 + 0.0001120093810483601i, -0.012439452596711344 + 0.007116400486692975i, -0.0002908252738864262 + 1.3361019280673612e-06i, 0.007796881492929869 + 0.003371628376858451i, -0.0003794975664364813 + -0.001116188440952868i, 0.09400506916737295 + 1.028497582447005e-19i, 0.0016572290871964377 + 0.0009572696894181536i }, { 0.0001613970817879272 + -5.957106206571722e-05i, -0.0016152830798322041 + 0.00017542745918710758i, -0.00014567764443223355 + 0.0002536436847059453i, -0.015668472094481536 + 0.008985700159863884i, -0.0011537855084558857 + -0.00021137730886059704i, 0.009838845342851643 + 0.0041558182765708725i, 0.0016572290871964377 + -0.000957269689418153i, 0.11847199143982401 + 3.746182836311294e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1285168269154729, 1.0e-7), DoubleNear(0.1620998173044143, 1.0e-7), DoubleNear(0.10825686904917178, 1.0e-7), DoubleNear(0.13642552364322907, 1.0e-7), DoubleNear(0.11153607980096229, 1.0e-7), DoubleNear(0.1406878226795525, 1.0e-7), DoubleNear(0.09400506916737295, 1.0e-7), DoubleNear(0.11847199143982401, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false, false, false}), Matrix({ { 0.24005290671643523 + 8.6714997975159e-20i, -0.0035746326422132027 + -0.0020847409809872514i, 0.016746192929114362 + -0.0072516595398672695i, -0.0024824797428907985 + 0.00045853291505830386i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0035746326422132027 + 0.0020847409809872505i, 0.3027876399839668 + 6.73391193067169e-20i, -0.0008138803274118562 + 0.002404107196623107i, 0.021131075949186864 + -0.008937143819051394i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01674619292911436 + 0.0072516595398672695i, -0.0008138803274118562 + -0.0024041071966231075i, 0.20226193821654476 + 1.329841727189252e-19i, 0.003564045473435761 + 0.002058783502329545i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002482479742890798 + -0.0004585329150583041i, 0.021131075949186864 + 0.008937143819051393i, 0.0035640454734357607 + -0.002058783502329545i, 0.2548975150830531 + 2.7330047438752034e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24005290671643523, 1.0e-7), DoubleNear(0.3027876399839668, 1.0e-7), DoubleNear(0.20226193821654476, 1.0e-7), DoubleNear(0.2548975150830531, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false, false, false}), Matrix({ { 0.1335946586152172 + 5.12556208944737e-20i, -0.00198936073736194 + -0.0011602036545432784i, 0.009319620237351731 + -0.004035706102766483i, -0.001381553917872148 + 0.00025518353053485625i, -0.006178609317910526 + -0.04756762752086873i, -0.0003210955658239865 + 0.0007619886657542845i, -0.0018679733134896194 + -0.0031316908706688403i, 0.00015475586564916727 + 0.0004801132282581639i }, { -0.00198936073736194 + 0.0011602036545432784i, 0.16850790082016476 + 4.178634469084835e-20i, -0.0004529420867320157 + 0.0013379378929439204i, 0.011759902915645756 + -0.004973714727443978i, 0.000505107156047097 + 0.0006546723226468601i, -0.007793309230631325 + -0.05999881390186116i, 0.0004973333831147694 + 9.939607672721824e-05i, -0.002314820506208631 + -0.0039571944484402015i }, { 0.00931962023735173 + 0.004035706102766483i, -0.0004529420867320157 + -0.0013379378929439204i, 0.1125631634979967 + 7.42387550128016e-20i, 0.001983468747892324 + 0.0011457577536490874i, 0.0010059284827342383 + -0.003504985006667495i, -0.0004554372141127327 + 0.00022315245468149778i, -0.0052059252821279245 + -0.040079167006707425i, 0.0003162244658964469 + -0.0007592226604203261i }, { -0.0013815539178721479 + -0.00025518353053485636i, 0.011759902915645756 + 0.004973714727443978i, 0.001983468747892324 + -0.0011457577536490874i, 0.14185600572465892 + 1.487290883194134e-20i, -2.696509918227605e-05 + 0.00050371715607808i, 0.0012270547753704124 + -0.004417252365098762i, -0.0004996910597639345 + -0.000653242532080702i, -0.006560687738994014 + -0.050509157415820446i }, { -0.006178609317910526 + 0.04756762752086873i, 0.000505107156047097 + -0.0006546723226468601i, 0.0010059284827342383 + 0.003504985006667495i, -2.6965099182276104e-05 + -0.0005037171560780799i, 0.10645824810121804 + 3.5459377080685295e-20i, -0.0015852719048512624 + -0.0009245373264439726i, 0.007426572691762629 + -0.0032159534371007867i, -0.0011009258250186504 + 0.0002033493845234475i }, { -0.0003210955658239864 + -0.0007619886657542845i, -0.007793309230631326 + 0.05999881390186116i, -0.0004554372141127326 + -0.0002231524546814978i, 0.0012270547753704124 + 0.004417252365098762i, -0.0015852719048512626 + 0.000924537326443973i, 0.13427973916380204 + 2.5552774615868536e-20i, -0.0003609382406798402 + 0.0010661693036791869i, 0.009371173033541107 + -0.003963429091607415i }, { -0.0018679733134896194 + 0.0031316908706688403i, 0.0004973333831147694 + -9.93960767272183e-05i, -0.0052059252821279245 + 0.040079167006707425i, -0.0004996910597639346 + 0.0006532425320807023i, 0.007426572691762629 + 0.0032159534371007867i, -0.0003609382406798402 + -0.0010661693036791869i, 0.08969877471854806 + 5.874541770612359e-20i, 0.0015805767255434367 + 0.0009130257486804575i }, { 0.00015475586564916727 + -0.0004801132282581638i, -0.0023148205062086314 + 0.003957194448440202i, 0.000316224465896447 + 0.0007592226604203261i, -0.006560687738994014 + 0.050509157415820446i, -0.0011009258250186504 + -0.0002033493845234475i, 0.009371173033541107 + 0.003963429091607415i, 0.001580576725543437 + -0.0009130257486804579i, 0.11304150935839415 + 1.2457138606810697e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1335946586152172, 1.0e-7), DoubleNear(0.16850790082016476, 1.0e-7), DoubleNear(0.1125631634979967, 1.0e-7), DoubleNear(0.14185600572465892, 1.0e-7), DoubleNear(0.10645824810121804, 1.0e-7), DoubleNear(0.13427973916380204, 1.0e-7), DoubleNear(0.08969877471854806, 1.0e-7), DoubleNear(0.11304150935839415, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false, false, false}), Matrix({ { 0.1175961296927388 + 5.664532834763135e-20i, -0.0017265467673470078 + -0.0010063459261088334i, 0.008222797142006827 + -0.0038471717316195184i, -0.0011983803215965567 + 0.00023636405465942822i, 0.0009696524098136417 + 0.00416677477610795i, 1.7519265331962218e-05 + -8.062305454457791e-05i, 0.00013797605156073316 + 0.00047192102656926495i, -2.262864232388225e-05 + -4.4294903607040395e-05i }, { -0.0017265467673470078 + 0.0010063459261088334i, 0.14832056718881348 + 7.91975805682771e-20i, -0.0003810642438224767 + 0.0011697745976399611i, 0.010374073523373183 + -0.0047552503968821234i, -6.2020025381267e-05 + -5.256835129047498e-05i, 0.001178469240013451 + 0.005243589339035414i, -5.235894027494257e-05 + -4.846028892931065e-06i, 0.00015854006531114666 + 0.0006063923616387748i }, { 0.008222797142006827 + 0.003847171731619518i, -0.0003810642438224767 + -0.0011697745976399611i, 0.09938026817472696 + 6.776263578034405e-20i, 0.001737305060104787 + 0.000999939497705861i, -4.468879359498482e-05 + 0.00017772867337452047i, 2.8631086452374357e-05 + -3.481613665178238e-05i, 0.000682536682864572 + 0.003536412724567643i, -1.3512124858575236e-05 + 7.438600418673008e-05i }, { -0.0011983803215965567 + -0.00023636405465942833i, 0.010374073523373183 + 0.0047552503968821234i, 0.0017373050601047872 + -0.000999939497705861i, 0.12524019561987407 + 5.443510175088965e-20i, -1.589961823920391e-05 + -4.86554906323567e-05i, -5.548882920834178e-05 + 0.0002111595213918425i, 6.0699334386107504e-05 + 5.8574709093111985e-05i, 0.0008107739611341719 + 0.0044463101602337865i }, { 0.0009696524098136418 + -0.00416677477610795i, -6.202002538126704e-05 + 5.256835129047497e-05i, -4.4688793594984815e-05 + -0.0001777286733745205i, -1.5899618239203956e-05 + 4.8655490632356704e-05i, 0.1224567770236964 + 3.006966962752765e-20i, -0.0018480858748661949 + -0.0010783950548784176i, 0.008523395787107533 + -0.0034044878082477516i, -0.0012840994212942414 + 0.00022216886039887543i }, { 1.7519265331962245e-05 + 8.062305454457791e-05i, 0.001178469240013451 + -0.005243589339035415i, 2.863108645237439e-05 + 3.4816136651782385e-05i, -5.548882920834182e-05 + -0.00021115952139184256i, -0.0018480858748661949 + 0.001078395054878418i, 0.15446707279515332 + -1.185846126156021e-20i, -0.0004328160835893795 + 0.0012343325989831464i, 0.010757002425813683 + -0.00418189342216927i }, { 0.00013797605156073316 + -0.00047192102656926505i, -5.23589402749426e-05 + 4.846028892931051e-06i, 0.0006825366828645719 + -0.003536412724567643i, 6.06993343861075e-05 + -5.857470909311205e-05i, 0.008523395787107533 + 0.003404487808247751i, -0.00043281608358937927 + -0.0012343325989831466i, 0.10288167004181778 + 6.522153693858114e-20i, 0.001826740413330974 + 0.0010588440046236836i }, { -2.2628642323882245e-05 + 4.4294903607040395e-05i, 0.00015854006531114656 + -0.0006063923616387748i, -1.351212485857525e-05 + -7.438600418673013e-05i, 0.0008107739611341721 + -0.0044463101602337865i, -0.0012840994212942412 + -0.00022216886039887554i, 0.010757002425813681 + 0.00418189342216927i, 0.0018267404133309737 + -0.0010588440046236836i, 0.129657319463179 + -2.7105054312137617e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1175961296927388, 1.0e-7), DoubleNear(0.14832056718881348, 1.0e-7), DoubleNear(0.09938026817472696, 1.0e-7), DoubleNear(0.12524019561987407, 1.0e-7), DoubleNear(0.1224567770236964, 1.0e-7), DoubleNear(0.15446707279515332, 1.0e-7), DoubleNear(0.10288167004181778, 1.0e-7), DoubleNear(0.129657319463179, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false, false, false}), Matrix({ { 0.09707657444439147 + 1.197086310041855e-19i, -0.002936141806240069 + -0.0019836552348176774i, 0.008288811517994168 + -0.008878530240983881i, -0.001278934150181651 + 4.349738374337462e-05i, 0.07607537733321149 + 0.029098200395275615i, 8.209256773595392e-05 + -0.0037237491647247713i, 0.010407729998149548 + 0.0007506777884077123i, -0.0009666817832165771 + -0.0005514418097752515i }, { -0.002936141806240069 + 0.0019836552348176774i, 0.11574051944192498 + 2.006633496334304e-19i, -0.00019506508463386493 + 0.0009171358206306765i, 0.010626949265715863 + 8.782411598231658e-05i, -0.0032400161392922653 + -0.0014746510365298714i, 0.09562730991090906 + 0.03474119519685325i, -0.0004012470045263085 + 0.0006187540617607554i, 0.00926196316267165 + 0.003060593563724677i }, { 0.008288811517994167 + 0.00887853024098388i, -0.00019506508463386493 + -0.0009171358206306767i, 0.0800905851861139 + 8.315385935043524e-21i, -1.1511916981025419e-05 + -0.00023509292704051922i, 0.0012753915004054825 + 0.007922264408321509i, 0.0002357327350593131 + -0.0007384777997499393i, 0.06385896149658057 + 0.016308305725153488i, 0.0019247841304385741 + -0.0014851925422293415i }, { -0.0012789341501816508 + -4.349738374337462e-05i, 0.010626949265715863 + -8.78241159823167e-05i, -1.1511916981025527e-05 + 0.00023509292704051925i, 0.07935610384790909 + -8.8478965068744e-20i, -0.0010718242875111434 + -0.0005949833940276246i, 0.005640011186040389 + 0.008080692008023634i, -0.00030870017890250703 + -0.0016055774934778883i, 0.0742643096474928 + 0.011949851040602042i }, { 0.07607537733321149 + -0.029098200395275615i, -0.003240016139292266 + 0.0014746510365298705i, 0.0012753915004054825 + -0.00792226440832151i, -0.0010718242875111432 + 0.0005949833940276246i, 0.14297633227204373 + -3.29936330290265e-20i, -0.0006384908359731336 + -0.00010108574616957334i, 0.008457381411120192 + 0.0016268707011166113i, -0.0012035455927091473 + 0.000415035531314929i }, { 8.209256773595349e-05 + 0.003723749164724771i, 0.09562730991090906 + -0.034741195196853245i, 0.0002357327350593131 + 0.0007384777997499393i, 0.005640011186040389 + -0.008080692008023634i, -0.0006384908359731336 + 0.0001010857461695734i, 0.1870471205420418 + -1.333242303267135e-19i, -0.0006188152427779911 + 0.001486971375992431i, 0.010504126683471001 + -0.00902496793503371i }, { 0.010407729998149548 + -0.0007506777884077123i, -0.00040124700452630856 + -0.0006187540617607554i, 0.06385896149658057 + -0.016308305725153488i, -0.00030870017890250703 + 0.0016055774934778883i, 0.008457381411120192 + -0.001626870701116611i, -0.0006188152427779911 + -0.001486971375992431i, 0.12217135303043086 + 1.2466878678388166e-19i, 0.003575557390416786 + 0.0022938764293700645i }, { -0.000966681783216577 + 0.0005514418097752516i, 0.009261963162671649 + -0.0030605935637246775i, 0.0019247841304385737 + 0.0014851925422293413i, 0.0742643096474928 + -0.011949851040602042i, -0.0012035455927091473 + -0.00041503553131492913i, 0.010504126683471001 + 0.00902496793503371i, 0.0035755573904167866 + -0.0022938764293700645i, 0.175541411235144 + 1.1580901250749602e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.09707657444439147, 1.0e-7), DoubleNear(0.11574051944192498, 1.0e-7), DoubleNear(0.0800905851861139, 1.0e-7), DoubleNear(0.07935610384790909, 1.0e-7), DoubleNear(0.14297633227204373, 1.0e-7), DoubleNear(0.1870471205420418, 1.0e-7), DoubleNear(0.12217135303043086, 1.0e-7), DoubleNear(0.175541411235144, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true, false, false}), Matrix({ { 0.24005290671643523 + 8.6714997975159e-20i, -0.0035746326422132027 + -0.0020847409809872514i, 0.016746192929114362 + -0.0072516595398672695i, -0.0024824797428907985 + 0.00045853291505830386i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0035746326422132027 + 0.0020847409809872505i, 0.3027876399839668 + 6.73391193067169e-20i, -0.0008138803274118562 + 0.002404107196623107i, 0.021131075949186864 + -0.008937143819051394i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01674619292911436 + 0.0072516595398672695i, -0.0008138803274118562 + -0.0024041071966231075i, 0.20226193821654476 + 1.329841727189252e-19i, 0.003564045473435761 + 0.002058783502329545i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002482479742890798 + -0.0004585329150583041i, 0.021131075949186864 + 0.008937143819051393i, 0.0035640454734357607 + -0.002058783502329545i, 0.2548975150830531 + 2.7330047438752034e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24005290671643523, 1.0e-7), DoubleNear(0.3027876399839668, 1.0e-7), DoubleNear(0.20226193821654476, 1.0e-7), DoubleNear(0.2548975150830531, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, true, false}), Matrix({ { 0.11207150508463837 + 1.7067466633707024e-20i, -0.0016712215163897275 + -0.0011335200174480433i, 0.007832942567463743 + -0.003472616311256598i, -0.001147437083992468 + 9.720785936464214e-05i, -0.0335714327439499 + -0.010985145794485451i, 0.0003010973458468198 + 0.0004932070206648736i, -0.0027336788026411755 + 0.0002580868384396718i, 0.000289710447905741 + 6.864246804057618e-05i }, { -0.0016712215163897273 + 0.0011335200174480433i, 0.14143432203465361 + 3.104721906540984e-20i, -0.000400863508901744 + 0.0012227185337799625i, 0.009896060733698902 + -0.0043513765711278365i, 0.0006998059860317531 + -0.00016298158747378823i, -0.04236185560829621 + -0.013904222693013306i, 0.0002936936605222699 + -0.00030829718528851437i, -0.0034872838199813193 + 0.000303726245142172i }, { 0.007832942567463743 + 0.0034726163112565986i, -0.000400863508901744 + -0.0012227185337799627i, 0.09453562837656503 + 5.318394656286432e-20i, 0.0016531616662422098 + 0.0009808037813408106i, -0.001956980557173108 + -0.0018099297662981914i, -5.6520962859281246e-05 + 0.00040989608808385345i, -0.02831082641101077 + -0.00932537810672755i, -0.00038902736389975214 + -0.0004485178564060207i }, { -0.0011474370839924678 + -9.720785936464214e-05i, 0.009896060733698902 + 0.0043513765711278365i, 0.0016531616662422098 + -0.0009808037813408106i, 0.11926496132703375 + -2.9436867451758188e-21i, 0.00039937731296610314 + 0.00014359051289338187i, -0.0024371192921742307 + -0.0022776254821687786i, -0.0006029317682687825 + 0.00013628111929002646i, -0.03570745063590824 + -0.011835129423184106i }, { -0.0335714327439499 + 0.010985145794485451i, 0.0006998059860317531 + 0.00016298158747378834i, -0.001956980557173108 + 0.0018099297662981914i, 0.00039937731296610303 + -0.00014359051289338193i, 0.12798140163179683 + 6.964753134145197e-20i, -0.0019034111258234752 + -0.0009512209635392081i, 0.008913250361650617 + -0.0037790432286106714i, -0.0013350426588983303 + 0.0003613250556936616i }, { 0.0003010973458468198 + -0.0004932070206648737i, -0.04236185560829621 + 0.013904222693013306i, -5.6520962859281246e-05 + -0.0004098960880838535i, -0.0024371192921742307 + 0.002277625482168778i, -0.0019034111258234754 + 0.0009512209635392076i, 0.16135331794931318 + 3.6291900241307066e-20i, -0.000413016818510112 + 0.0011813886628431448i, 0.011235015215487962 + -0.004585767247923558i }, { -0.0027336788026411755 + -0.0002580868384396718i, 0.00029369366052226994 + 0.00030829718528851437i, -0.02831082641101077 + 0.00932537810672755i, -0.0006029317682687827 + -0.00013628111929002624i, 0.008913250361650615 + 0.003779043228610671i, -0.0004130168185101121 + -0.0011813886628431448i, 0.10772630983997972 + 7.980022615606087e-20i, 0.001910883807193551 + 0.0010779797209887348i }, { 0.000289710447905741 + -6.864246804057618e-05i, -0.0034872838199813193 + -0.00030372624514217195i, -0.00038902736389975225 + 0.0004485178564060207i, -0.03570745063590824 + 0.011835129423184106i, -0.0013350426588983303 + -0.00036132505569366194i, 0.011235015215487962 + 0.004585767247923558i, 0.001910883807193551 + -0.0010779797209887348i, 0.13563255375601932 + 3.027373418392785e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.11207150508463837, 1.0e-7), DoubleNear(0.14143432203465361, 1.0e-7), DoubleNear(0.09453562837656503, 1.0e-7), DoubleNear(0.11926496132703375, 1.0e-7), DoubleNear(0.12798140163179683, 1.0e-7), DoubleNear(0.16135331794931318, 1.0e-7), DoubleNear(0.10772630983997972, 1.0e-7), DoubleNear(0.13563255375601932, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false, true}), Matrix({ { 0.10776647453188332 + -3.388131789017204e-20i, -0.0019988241572270003 + -0.00507795266905671i, 0.007533221284633235 + -0.003312835788197223i, -0.002915789553183639 + -0.0014535199579521641i, -1.8431436932253575e-18 + -8.944667923005412e-19i, 2.913793338554793e-19 + -4.87890977618477e-19i, -1.4907779871675686e-19 + 1.3552527156068805e-20i, -6.098637220230962e-20 + -3.3881317890172014e-19i }, { -0.0019988241572270003 + 0.0050779526690567095i, 0.12793714041793275 + 3.1340219048409125e-20i, 0.0011500670830464103 + 0.0032402221280283675i, 0.008924040794991664 + -0.003773149166269299i, 2.1345230270808369e-19 + -3.1170812458958252e-19i, 2.439454888092385e-19 + -1.8973538018496328e-18i, -2.0328790734103208e-20 + -2.303929616531697e-19i, -4.404571325722362e-20 + -1.7618285302889447e-19i }, { 0.007533221284633233 + 0.003312835788197223i, 0.0011500670830464103 + -0.003240222128028368i, 0.09086304419784758 + -3.388131789017212e-21i, 0.002116388113021073 + 0.0050520518949250855i, -1.2197274440461925e-19 + -1.4060746924421386e-19i, 3.8963515573697816e-19 + -1.0842021724855044e-19i, -1.6263032587282567e-18 + -6.776263578034403e-19i, -2.913793338554793e-19 + 5.285485590866834e-19i }, { -0.0029157895531836384 + 0.0014535199579521641i, 0.008924040794991664 + 0.003773149166269299i, 0.002116388113021073 + -0.0050520518949250855i, 0.10769253722746686 + 5.2741035856381045e-20i, 2.439454888092385e-19 + -7.792703114739563e-20i, 8.300922883092143e-20 + -1.0842021724855044e-19i, -2.1006417091906648e-19 + 3.6591823321385775e-19i, 2.981555974335137e-19 + -1.6263032587282567e-18i }, { -1.951563910473908e-18 + 8.944667923005412e-19i, 2.168404344971009e-19 + 2.981555974335137e-19i, -1.3891340334970526e-19 + 1.4568966692773966e-19i, 2.473336205982557e-19 + 7.453889935837843e-20i, 0.1322864321845519 + 1.2059631586533103e-19i, -0.0015758084849862024 + 0.002993211688069459i, 0.009212971644481125 + -0.003938823751670047i, 0.0004333098102928405 + 0.001912052873010468i }, { 3.1170812458958252e-19 + 4.87890977618477e-19i, 2.574980159653073e-19 + 1.8973538018496328e-18i, 3.7269449679189215e-19 + 1.0842021724855044e-19i, 8.639736061993863e-20 + 1.0164395367051604e-19i, -0.0015758084849862024 + -0.002993211688069459i, 0.17485049956603405 + 3.599890025830778e-20i, -0.0019639474104582665 + -0.0008361149314052603i, 0.0122070351541952 + -0.005163994652782096i }, { -1.4907779871675686e-19 + -1.3552527156068805e-20i, -6.776263578034403e-21 + 2.303929616531697e-19i, -1.6805133673525319e-18 + 7.589415207398531e-19i, -2.0328790734103208e-19 + -3.6591823321385775e-19i, 0.009212971644481125 + 0.003938823751670047i, -0.0019639474104582665 + 0.0008361149314052604i, 0.11139889401869718 + 1.363723045079424e-19i, 0.0014476573604146883 + -0.0029932683925955406i }, { -8.131516293641283e-20 + 3.5236570605778894e-19i, -4.2351647362715017e-20 + 1.6263032587282567e-19i, -3.049318610115481e-19 + -5.285485590866834e-19i, 2.710505431213761e-19 + 1.5178830414797062e-18i, 0.0004333098102928405 + -0.0019120528730104682i, 0.0122070351541952 + 0.005163994652782094i, 0.0014476573604146879 + 0.0029932683925955406i, 0.14720497785558623 + -2.5410988417629013e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.10776647453188332, 1.0e-7), DoubleNear(0.12793714041793275, 1.0e-7), DoubleNear(0.09086304419784758, 1.0e-7), DoubleNear(0.10769253722746686, 1.0e-7), DoubleNear(0.1322864321845519, 1.0e-7), DoubleNear(0.17485049956603405, 1.0e-7), DoubleNear(0.11139889401869718, 1.0e-7), DoubleNear(0.14720497785558623, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false, false, false}), Matrix({ { 0.2367736959646447 + 5.598865950828063e-20i, -6.99529554923367e-06 + -1.4847079539544671e-05i, -0.027117368976204502 + -0.015531870260491219i, -5.730906238664211e-06 + -2.8307853375479343e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -6.995295549233778e-06 + 1.4847079539544346e-05i, 0.2985253409476434 + 6.268398321017413e-21i, -2.6710959202545564e-06 + 3.1235820390190225e-06i, -0.03417202937558845 + -0.019617922571001874i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.027117368976204502 + 0.015531870260491219i, -2.6710959202545327e-06 + -3.1235820390189547e-06i, 0.20554114896833525 + 1.6371051118580357e-19i, -3.591873228208221e-06 + -1.111039911816142e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -5.730906238664255e-06 + 2.83078533754788e-06i, -0.03417202937558845 + 0.019617922571001874i, -3.59187322820795e-06 + 1.1110399118161854e-05i, 0.2591598141193765 + 8.840076842445151e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2367736959646447, 1.0e-7), DoubleNear(0.2985253409476434, 1.0e-7), DoubleNear(0.20554114896833525, 1.0e-7), DoubleNear(0.2591598141193765, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false, false, false}), Matrix({ { 0.13176970657899673 + 3.0407577929748747e-20i, -3.893033971533335e-06 + -8.262722370870677e-06i, -0.015091405059295172 + -0.00864382328666094i, -3.1893738467185708e-06 + -1.5753935495119937e-06i, -0.0060942072484519855 + -0.04691783628219043i, -2.7619709343112996e-06 + 1.7682931770227528e-06i, -0.0023797528571263002 + 0.005773203432854836i, -4.1342849457331717e-07 + 1.208466641581029e-06i }, { -3.893033971533335e-06 + 8.26272237087084e-06i, 0.16613583879241256 + 7.332682770298726e-22i, -1.486522918951514e-06 + 1.738341275960077e-06i, -0.019017476859855727 + -0.010917800181893499i, 3.1220682049773663e-06 + 1.0040091261308872e-06i, -0.007683603912325567 + -0.059154219034356026i, 6.877027542093161e-07 + 4.4889397170653506e-07i, -0.003007846996544213 + 0.0072762869988019525i }, { -0.015091405059295172 + 0.00864382328666094i, -1.4865229189515073e-06 + -1.7383412759600228e-06i, 0.11438811553421716 + 9.508679797752656e-20i, -1.9989554980829076e-06 + -6.183178523319979e-06i, 0.0037756753720868223 + 0.0049736683667836856i, -5.502025808711724e-07 + 6.096868015499634e-07i, -0.005290327351586466 + -0.04072895824538572i, -2.109128993228252e-06 + 9.977121569357624e-07i }, { -3.189373846718598e-06 + 1.5753935495119802e-06i, -0.019017476859855727 + 0.010917800181893499i, -1.998955498082799e-06 + 6.183178523319979e-06i, 0.14422806775241112 + 5.592598524575982e-20i, 7.08438716866608e-07 + 1.0627461260262121e-06i, 0.004766922710310337 + 0.006266413959952049i, 2.2940280781851648e-06 + 4.257814400270837e-07i, -0.006670393057299773 + -0.05135375228332559i }, { -0.0060942072484519855 + 0.04691783628219043i, 3.1220682049775154e-06 + -1.0040091261309008e-06i, 0.0037756753720868223 + -0.0049736683667836856i, 7.084387168666088e-07 + -1.0627461260262087e-06i, 0.105003989385648 + 2.5581081578531872e-20i, -3.102261577700335e-06 + -6.58435716867394e-06i, -0.01202596391690933 + -0.00688804697383028i, -2.5415323919456534e-06 + -1.2553917880359101e-06i }, { -2.7619709343112996e-06 + -1.7682931770227392e-06i, -0.007683603912325567 + 0.059154219034356026i, -5.502025808711622e-07 + -6.096868015499816e-07i, 0.004766922710310337 + -0.0062664139599520495i, -3.102261577700362e-06 + 6.584357168673831e-06i, 0.13238950215523082 + 5.535130043987549e-21i, -1.1845730013030704e-06 + 1.3852407630589116e-06i, -0.01515455251573272 + -0.008700122389108379i }, { -0.0023797528571263 + -0.005773203432854836i, 6.877027542093262e-07 + -4.48893971706527e-07i, -0.005290327351586466 + 0.04072895824538572i, 2.2940280781852325e-06 + -4.2578144002709725e-07i, -0.01202596391690933 + 0.00688804697383028i, -1.1845730013030255e-06 + -1.385240763058898e-06i, 0.09115303343411807 + 6.862371320827701e-20i, -1.5929177301252052e-06 + -4.927220594841685e-06i }, { -4.134284945733087e-07 + -1.2084666415810375e-06i, -0.0030078469965442133 + -0.0072762869988019525i, -2.109128993228184e-06 + -9.97712156935776e-07i, -0.006670393057299773 + 0.05135375228332559i, -2.5415323919456467e-06 + 1.255391788035883e-06i, -0.01515455251573272 + 0.008700122389108377i, -1.5929177301251239e-06 + 4.927220594841739e-06i, 0.11493174636696538 + 3.24747831786917e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.13176970657899673, 1.0e-7), DoubleNear(0.16613583879241256, 1.0e-7), DoubleNear(0.11438811553421716, 1.0e-7), DoubleNear(0.14422806775241112, 1.0e-7), DoubleNear(0.105003989385648, 1.0e-7), DoubleNear(0.13238950215523082, 1.0e-7), DoubleNear(0.09115303343411807, 1.0e-7), DoubleNear(0.11493174636696538, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false, false, false}), Matrix({ { 0.11656396121214105 + 7.778121321936995e-21i, 1.214952140228892e-05 + -4.6543791771609016e-07i, -0.013711700548378957 + -0.008708368809710937i, -1.6073504929290945e-05 + 7.86276714637998e-06i, 0.0016305419945693708 + 0.007972984396427574i, 7.596117941530619e-07 + -7.398217734583435e-06i, -0.017582270899428935 + -0.0007200326136516655i, 4.969855554399251e-07 + -2.45680668684212e-06i }, { 1.214952140228892e-05 + 4.654379177157649e-07i, 0.1469502697310567 + 5.718200327910169e-20i, -5.877996341329866e-07 + 1.88172500477832e-05i, -0.01728192982844799 + -0.010988572034430731i, -5.547673129958328e-06 + 3.3564314000516793e-06i, 0.002008093955105334 + 0.010036860666374842i, -4.030803041329899e-06 + -3.5267446127769953e-06i, -0.022128844130417977 + -0.0008948290069163499i }, { -0.013711700548378959 + 0.008708368809710937i, -5.877996341329561e-07 + -1.881725004778318e-05i, 0.10041243665532475 + 1.1662984280603839e-19i, -1.3912286445097119e-06 + -5.9409904852562195e-06i, 0.004996664457360222 + -0.004524422087974516i, -6.575321818794241e-07 + -3.1257862139380183e-06i, 2.1647098108842954e-05 + -0.00026979689575198115i, 3.2475286792339227e-06 + 1.1611673767356276e-06i }, { -1.6073504929290948e-05 + -7.862767146379984e-06i, -0.01728192982844799 + 0.01098857203443073i, -1.3912286445095763e-06 + 5.940990485256382e-06i, 0.12661049307763084 + 7.645067904006506e-20i, -1.2310997978902434e-06 + -1.9508910340251176e-06i, 0.006307989538119929 + -0.005690657672874044i, 4.226982134798837e-06 + 2.649926402585324e-06i, -1.8850753957711284e-05 + -0.0003469611671056398i }, { 0.001630541994569371 + -0.007972984396427575i, -5.5476731299583615e-06 + -3.35643140005172e-06i, 0.004996664457360222 + 0.004524422087974516i, -1.2310997978902333e-06 + 1.9508910340251244e-06i, 0.12020973475250367 + 4.821053818634363e-20i, -1.914481695152259e-05 + -1.4381641621828635e-05i, -0.013405668427825541 + -0.006823501450780283i, 1.034259869062673e-05 + -1.069355248392789e-05i }, { 7.596117941530687e-07 + 7.398217734583429e-06i, 0.0020080939551053345 + -0.010036860666374842i, -6.575321818794495e-07 + 3.1257862139380285e-06i, 0.0063079895381199305 + 0.005690657672874044i, -1.9144816951522617e-05 + 1.4381641621828635e-05i, 0.15157507121658664 + -5.091360495808428e-20i, -2.08329628612159e-06 + -1.5693668008764203e-05i, -0.01689009954714046 + -0.008629350536571146i }, { -0.017582270899428935 + 0.0007200326136516655i, -4.0308030413298955e-06 + 3.5267446127770156e-06i, 2.1647098108842845e-05 + 0.0002697968957519813i, 4.226982134798822e-06 + -2.6499264025853663e-06i, -0.013405668427825541 + 0.006823501450780283i, -2.0832962861215834e-06 + 1.5693668008764244e-05i, 0.1051287123130105 + 4.708066837976517e-20i, -2.200644583698401e-06 + -5.169408632905309e-06i }, { 4.969855554399318e-07 + 2.456806686842093e-06i, -0.022128844130417977 + 0.0008948290069163499i, 3.2475286792339147e-06 + -1.1611673767356378e-06i, -1.8850753957711555e-05 + 0.0003469611671056398i, 1.0342598690626693e-05 + 1.069355248392786e-05i, -0.01689009954714046 + 0.008629350536571146i, -2.2006445836983467e-06 + 5.169408632905309e-06i, 0.13254932104174566 + 1.1950089384386456e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.11656396121214105, 1.0e-7), DoubleNear(0.1469502697310567, 1.0e-7), DoubleNear(0.10041243665532475, 1.0e-7), DoubleNear(0.12661049307763084, 1.0e-7), DoubleNear(0.12020973475250367, 1.0e-7), DoubleNear(0.15157507121658664, 1.0e-7), DoubleNear(0.1051287123130105, 1.0e-7), DoubleNear(0.13254932104174566, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false, false, false}), Matrix({ { 0.09484320877735061 + 3.3100588901076076e-20i, -0.0015784226736494508 + -0.001188276997330812i, -0.010869045672430584 + -0.006208034261831702i, 0.00010312013597974927 + 0.00023870507604554345i, 0.07490920883819505 + 0.02430993894330153i, 0.0010742650015504599 + -0.0027890706389645044i, -0.006990139868855155 + -0.0076909825982447565i, -0.0003062810648614972 + 0.0002512555970931633i }, { -0.0015784226736494508 + 0.001188276997330812i, 0.10443281942408444 + -7.69851708872137e-21i, 0.00025465486636838956 + -3.122671118067276e-05i, -0.011931871091903822 + -0.006875866159613336i, -0.0019003492471459653 + -0.001648604404718254i, 0.09094144214456026 + 0.02499506340249326i, 0.00010653390783394768 + 0.00031179596231662533i, -0.008760049321194124 + -0.008825728416202758i }, { -0.010869045672430584 + 0.006208034261831702i, 0.00025465486636838956 + 3.1226711180672785e-05i, 0.08232395085315473 + 9.492342803815296e-20i, -0.0013692310495716435 + -0.0010304711645273848i, -0.0101673679333367 + 0.0021301805676097515i, 5.6912957971679955e-05 + 0.00038550110099780876i, 0.06502512999159701 + 0.021096567177127573i, 0.0009326116966240682 + -0.002419871067989608i }, { 0.00010312013597974927 + -0.00023870507604554342i, -0.011931871091903822 + 0.006875866159613336i, -0.0013692310495716435 + 0.001030471164527385i, 0.09066380386574963 + 1.1988290165340775e-19i, 0.000324702352780865 + 6.687351673736168e-05i, -0.012052028790308339 + 0.003132991307478608i, -0.0016483670710488074 + -0.0014316241252895054i, 0.07895017741384158 + 0.021695982834962033i }, { 0.07490920883819505 + -0.02430993894330153i, -0.0019003492471459658 + 0.001648604404718254i, -0.0101673679333367 + -0.0021301805676097515i, 0.0003247023527808651 + -6.68735167373617e-05i, 0.1419304871872941 + 2.2888070607204542e-20i, 0.0015714273781002172 + 0.0011734299177912676i, -0.016248323303773914 + -0.009323835998659519i, -0.00010885104221841349 + -0.00024153586138309145i }, { 0.001074265001550459 + 0.0027890706389645044i, 0.09094144214456026 + -0.02499506340249326i, 5.6912957971680064e-05 + -0.00038550110099780876i, -0.012052028790308339 + -0.003132991307478608i, 0.0015714273781002172 + -0.0011734299177912676i, 0.19409252152355894 + 1.3966915409738786e-20i, -0.0002573259622886441 + 3.435029321969177e-05i, -0.022240158283684627 + -0.01274205641138854i }, { -0.006990139868855156 + 0.007690982598244755i, 0.00010653390783394774 + -0.0003117959623166253i, 0.06502512999159701 + -0.021096567177127573i, -0.0016483670710488074 + 0.0014316241252895052i, -0.016248323303773914 + 0.009323835998659519i, -0.00025732596228864404 + -3.435029321969174e-05i, 0.1232171981151805 + 6.878708314765062e-20i, 0.0013656391763434354 + 0.001019360765409223i }, { -0.0003062810648614972 + -0.00025125559709316325i, -0.008760049321194124 + 0.008825728416202756i, 0.0009326116966240682 + 0.0024198710679896075i, 0.07895017741384158 + -0.021695982834962033i, -0.00010885104221841352 + 0.00024153586138309134i, -0.022240158283684627 + 0.01274205641138854i, 0.0013656391763434356 + -0.001019360765409223i, 0.16849601025362687 + -3.1482133228956236e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.09484320877735061, 1.0e-7), DoubleNear(0.10443281942408444, 1.0e-7), DoubleNear(0.08232395085315473, 1.0e-7), DoubleNear(0.09066380386574963, 1.0e-7), DoubleNear(0.1419304871872941, 1.0e-7), DoubleNear(0.19409252152355894, 1.0e-7), DoubleNear(0.1232171981151805, 1.0e-7), DoubleNear(0.16849601025362687, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true, false, false}), Matrix({ { 0.2367736959646447 + 5.598865950828063e-20i, -6.99529554923367e-06 + -1.4847079539544671e-05i, -0.027117368976204502 + -0.015531870260491219i, -5.730906238664211e-06 + -2.8307853375479343e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -6.995295549233778e-06 + 1.4847079539544346e-05i, 0.2985253409476434 + 6.268398321017413e-21i, -2.6710959202545564e-06 + 3.1235820390190225e-06i, -0.03417202937558845 + -0.019617922571001874i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.027117368976204502 + 0.015531870260491219i, -2.6710959202545327e-06 + -3.1235820390189547e-06i, 0.20554114896833525 + 1.6371051118580357e-19i, -3.591873228208221e-06 + -1.111039911816142e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -5.730906238664255e-06 + 2.83078533754788e-06i, -0.03417202937558845 + 0.019617922571001874i, -3.59187322820795e-06 + 1.1110399118161854e-05i, 0.2591598141193765 + 8.840076842445151e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2367736959646447, 1.0e-7), DoubleNear(0.2985253409476434, 1.0e-7), DoubleNear(0.20554114896833525, 1.0e-7), DoubleNear(0.2591598141193765, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, true, false}), Matrix({ { 0.11061445519971506 + -1.0449439716584221e-20i, -1.0609339530940059e-05 + -8.414170582820148e-05i, -0.012664479728113534 + -0.0071028438832193026i, -3.0789322563752055e-07 + 2.8202226578890712e-06i, -0.03321596787052838 + -0.010945938274638673i, -4.7572717044375486e-05 + 2.5606356742728252e-05i, 0.003126600643807615 + 0.0035292349489823675i, 7.628883548382829e-07 + 5.034128059606945e-07i }, { -1.060933953093995e-05 + 8.414170582820137e-05i, 0.1396011738936334 + -5.825181784483378e-22i, -1.8587127643408874e-06 + -4.014138887200412e-06i, -0.015976373319349334 + -0.008889316319523395i, 5.3854238667957315e-05 + -1.4995266332260216e-05i, -0.04191293836813069 + -0.013889579205344144i, -6.176187304183468e-07 + 1.724722252772508e-07i, 0.0039927744462210455 + 0.004446741874695483i }, { -0.012664479728113534 + 0.0071028438832193026i, -1.8587127643408806e-06 + 4.0141388872004795e-06i, 0.09599267826148833 + 8.070085291315557e-20i, -7.450510616577766e-06 + -6.857453027903082e-05i, 0.004530519213262198 + -0.0009822805658374072i, 7.463244301538188e-06 + 3.3253141893875395e-07i, -0.02866629128443229 + -0.009364585626574325i, -4.0357301008556954e-05 + 1.908280751612476e-05i }, { -3.078932256375138e-07 + -2.8202226578890645e-06i, -0.015976373319349334 + 0.008889316319523395i, -7.450510616577549e-06 + 6.857453027903104e-05i, 0.12109810946805397 + 2.8686050498682366e-20i, -4.5827464214891445e-06 + -2.7081985331329624e-06i, 0.005659883688848192 + -0.00121478403069689i, 4.301997909501317e-05 + -1.1705201851501724e-05i, -0.036156367876073764 + -0.01184977291085327i }, { -0.03321596787052838 + 0.010945938274638673i, 5.38542386679573e-05 + 1.4995266332260297e-05i, 0.004530519213262198 + 0.000982280565837407i, -4.582746421489137e-06 + 2.708198533132993e-06i, 0.12615924076492963 + 6.643809922486484e-20i, 3.614043981706389e-06 + 6.92946262886568e-05i, -0.014452889248090966 + -0.008429026377271918i, -5.42301301302669e-06 + -5.6510079954370055e-06i }, { -4.757271704437547e-05 + -2.5606356742728225e-05i, -0.04191293836813069 + 0.013889579205344144i, 7.4632443015381815e-06 + -3.3253141893874717e-07i, 0.005659883688848191 + 0.00121478403069689i, 3.614043981706172e-06 + -6.929462628865702e-05i, 0.15892416705400997 + 6.850916499465751e-21i, -8.123831559136691e-07 + 7.137720926219434e-06i, -0.018195656056239115 + -0.01072860625147848i }, { 0.0031266006438076155 + -0.0035292349489823675i, -6.176187304183612e-07 + -1.7247222527726944e-07i, -0.02866629128443229 + 0.009364585626574325i, 4.301997909501315e-05 + 1.1705201851501778e-05i, -0.014452889248090966 + 0.008429026377271918i, -8.123831559136521e-07 + -7.137720926219434e-06i, 0.10954847070684692 + 8.300965827264801e-20i, 3.858637388369545e-06 + 5.74641311608694e-05i }, { 7.628883548382558e-07 + -5.03412805960708e-07i, 0.0039927744462210455 + -0.004446741874695483i, -4.0357301008556934e-05 + -1.9082807516124787e-05i, -0.036156367876073764 + 0.01184977291085327i, -5.423013013026741e-06 + 5.6510079954369446e-06i, -0.018195656056239115 + 0.010728606251478479i, 3.858637388369599e-06 + -5.7464131160869184e-05i, 0.13806170465132253 + 5.971471792576915e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.11061445519971506, 1.0e-7), DoubleNear(0.1396011738936334, 1.0e-7), DoubleNear(0.09599267826148833, 1.0e-7), DoubleNear(0.12109810946805397, 1.0e-7), DoubleNear(0.12615924076492963, 1.0e-7), DoubleNear(0.15892416705400997, 1.0e-7), DoubleNear(0.10954847070684692, 1.0e-7), DoubleNear(0.13806170465132253, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false, true}), Matrix({ { 0.10632691257071208 + -5.59800034731546e-20i, 6.243529527035136e-05 + -1.5858778047610168e-05i, -0.01218047031047454 + -0.006985898080937206i, -1.116813346932517e-05 + -9.64100788717286e-06i, 5.728420389120698e-05 + 2.685925950043081e-05i, -4.271821167118963e-07 + 5.1736929023997496e-06i, 1.11043904924693e-05 + -9.010676905291684e-05i, -6.721947571982988e-06 + -1.1088106393822732e-06i }, { 6.243529527035125e-05 + 1.585877804760995e-05i, 0.1261314695016676 + 1.3600905496136594e-20i, -9.164807684104801e-06 + 2.9730540987166904e-06i, -0.014435653749244215 + -0.008279111597643827i, -9.80216113525937e-07 + 3.979372738212342e-06i, -1.0857354938349485e-05 + 5.4732385149034075e-05i, -4.097985491494352e-06 + 1.9418794246862694e-06i, 8.155903285378645e-05 + -1.404339160159741e-05i }, { -0.01218047031047454 + 0.006985898080937206i, -9.164807684104774e-06 + -2.9730540987166497e-06i, 0.09230260615901878 + 1.8710553793965347e-20i, 5.512866052372127e-05 + -1.0041996084014012e-05i, -6.673977649632127e-05 + 6.649740955125959e-05i, 8.219431841483776e-06 + 4.052627191475342e-06i, -5.7284203891210396e-05 + -2.685925950043249e-05i, 4.271821167118997e-07 + -5.173692902399678e-06i }, { -1.1168133469325187e-05 + 9.641007887172779e-06i, -0.014435653749244215 + 0.008279111597643827i, 5.5128660523721376e-05 + 1.0041996084014446e-05i, 0.10949820814373198 + 7.048034940865356e-20i, 5.5282885506929765e-06 + 5.541113465408604e-07i, -7.779854086152102e-05 + -4.2125551745478306e-05i, 9.802161135259506e-07 + -3.979372738212295e-06i, 1.0857354938350068e-05 + -5.473238514903765e-05i }, { 5.728420389120687e-05 + -2.6859259500430755e-05i, -9.80216113525937e-07 + -3.979372738212346e-06i, -6.673977649632127e-05 + -6.649740955125959e-05i, 5.528288550692966e-06 + -5.541113465408642e-07i, 0.13044678339393262 + 1.1196866298143523e-19i, -6.943059081958503e-05 + 1.011698508065497e-06i, -0.01493689866572996 + -0.008545972179554013i, 5.437227230660959e-06 + 6.810222549624926e-06i }, { -4.271821167118895e-07 + -5.173692902399753e-06i, -1.0857354938349512e-05 + -5.473238514903413e-05i, 8.219431841483764e-06 + -4.052627191475348e-06i, -7.779854086152103e-05 + 4.2125551745478286e-05i, -6.943059081958503e-05 + -1.0116985080656053e-06i, 0.17239387144597576 + -7.332507175119181e-21i, 6.493711763850245e-06 + 1.505279403023321e-07i, -0.019736375626344234 + -0.011338810973358048i }, { 1.1104390492469286e-05 + 9.010676905291687e-05i, -4.097985491494353e-06 + -1.9418794246862736e-06i, -5.728420389121045e-05 + 2.685925950043241e-05i, 9.802161135259472e-07 + 3.979372738212305e-06i, -0.014936898665729961 + 0.008545972179554013i, 6.493711763850241e-06 + -1.50527940302305e-07i, 0.11323854280931646 + 1.4499995739183823e-19i, -5.872053375192949e-05 + -1.0684030341474079e-06i }, { -6.7219475719829985e-06 + 1.1088106393822766e-06i, 8.155903285378651e-05 + 1.404339160159745e-05i, 4.2718211671190985e-07 + 5.173692902399716e-06i, 1.085735493835004e-05 + 5.47323851490376e-05i, 5.437227230660932e-06 + -6.8102225496248985e-06i, -0.019736375626344234 + 0.011338810973358048i, -5.8720533751929326e-05 + 1.0684030341474079e-06i, 0.1496616059756445 + 1.792041901579795e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.10632691257071208, 1.0e-7), DoubleNear(0.1261314695016676, 1.0e-7), DoubleNear(0.09230260615901878, 1.0e-7), DoubleNear(0.10949820814373198, 1.0e-7), DoubleNear(0.13044678339393262, 1.0e-7), DoubleNear(0.17239387144597576, 1.0e-7), DoubleNear(0.11323854280931646, 1.0e-7), DoubleNear(0.1496616059756445, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false, false, false}), Matrix({ { 0.24615782211321385 + 1.254943759072753e-19i, -5.891989469616269e-06 + -1.4445900894190819e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -0.011384534600038451 + -0.08764679452757615i, -4.871099927539592e-06 + 2.7660053339584746e-06i, 0.0 + 0.0i, 0.0 + 0.0i }, { -5.8919894696160525e-06 + 1.4445900894190602e-05i, 0.3103639065448237 + 5.665925352278969e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 5.4160962831625175e-06 + 1.4297905661579777e-06i, -0.01435399696962534 + -0.11050797131768161i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011384534600038451 + 0.08764679452757615i, 5.416096283162653e-06 + -1.4297905661580184e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19615702281976607 + 9.420479478680887e-20i, -4.695179307825567e-06 + -1.1511577763515489e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.871099927539538e-06 + -2.7660053339585694e-06i, -0.01435399696962534 + 0.11050797131768161i, 0.0 + 0.0i, 0.0 + 0.0i, -4.695179307825459e-06 + 1.1511577763515597e-05i, 0.24732124852219617 + 3.800991322267924e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24615782211321385, 1.0e-7), DoubleNear(0.3103639065448237, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19615702281976607, 1.0e-7), DoubleNear(0.24732124852219617, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false, false, false}), Matrix({ { 0.21697639786746575 + 1.2440796412797539e-19i, 1.0758292757779317e-05 + -6.406428402972201e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0016521890926782137 + 0.007703187500675593i, 4.007140473386979e-06 + -6.23705035784781e-06i, 0.0 + 0.0i, 0.0 + 0.0i }, { 1.0758292757779317e-05 + 6.40642840297231e-06i, 0.2735607628086875 + 1.3363268231916678e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -1.3206909951594958e-06 + 6.006357802637009e-06i, 0.0019892432011476228 + 0.0096898994992692i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016521890926782137 + -0.007703187500675593i, -1.3206909951595433e-06 + -6.006357802637089e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.22533844706551415 + 9.529120656610881e-20i, -2.134546153522099e-05 + -1.9551050254734215e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.0071404733869855e-06 + 6.237050357847793e-06i, 0.001989243201147623 + -0.0096898994992692i, 0.0 + 0.0i, 0.0 + 0.0i, -2.134546153522099e-05 + 1.955105025473389e-05i, 0.2841243922583323 + -3.896351557369783e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21697639786746575, 1.0e-7), DoubleNear(0.2735607628086875, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22533844706551415, 1.0e-7), DoubleNear(0.2841243922583323, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false, false, false}), Matrix({ { 0.17716715963050533 + 1.2802401693922902e-19i, -0.0029476537232210943 + -0.0022187481618581974i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13993433882979206 + 0.0454065061204291i, 0.002006876698174529 + -0.0052089417069541115i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0029476537232210943 + 0.0022187481618581965i, 0.19509662328983407 + 1.1218438456468639e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.003548716318194772 + -0.0030802285300077594i, 0.16989161955840187 + 0.04669104623745529i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13993433882979206 + -0.0454065061204291i, -0.003548716318194772 + 0.0030802285300077594i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26514768530247457 + 9.167515375485516e-20i, 0.0029370665544436528 + 0.002192790683200491i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002006876698174528 + 0.0052089417069541115i, 0.16989161955840187 + -0.04669104623745529i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0029370665544436528 + -0.002192790683200491i, 0.3625885317771858 + -1.751521781921745e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.17716715963050533, 1.0e-7), DoubleNear(0.19509662328983407, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26514768530247457, 1.0e-7), DoubleNear(0.3625885317771858, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true, false, false}), Matrix({ { 0.4423148449329799 + 2.1969917069408425e-19i, -1.0587168777441728e-05 + -2.5957478657705983e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.058716877744162e-05 + 2.595747865770555e-05i, 0.5576851550670199 + 9.466916674546894e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4423148449329799, 1.0e-7), DoubleNear(0.5576851550670199, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, true, false}), Matrix({ { 0.20660713346120338 + 7.025141319657135e-20i, -1.8059850147517662e-05 + -0.0001527162361072323i, 0.0 + 0.0i, 0.0 + 0.0i, -0.061882259154960664 + -0.020310523901213i, -8.793001805293245e-05 + 4.4689164258852985e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.8059850147517553e-05 + 0.0001527162361072323i, 0.26069928336168735 + 2.810353232023402e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 9.687421776297045e-05 + -2.6700468183762103e-05i, -0.07806930624420444 + -0.02573935211619741i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.061882259154960664 + 0.020310523901212997i, 9.687421776297045e-05 + 2.6700468183762103e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23570771147177652 + 1.4944775749751286e-19i, 7.4726813700759336e-06 + 0.0001267587574495263i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.793001805293239e-05 + -4.468916425885315e-05i, -0.07806930624420444 + 0.02573935211619741i, 0.0 + 0.0i, 0.0 + 0.0i, 7.4726813700759336e-06 + -0.00012675875744952675i, 0.2969858717053325 + 6.656563442523492e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.20660713346120338, 1.0e-7), DoubleNear(0.26069928336168735, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23570771147177652, 1.0e-7), DoubleNear(0.2969858717053325, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false, true}), Matrix({ { 0.19862951872973084 + -3.726944967918924e-20i, 0.00011756395579407268 + -2.5900774131623963e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -3.469446951953614e-18 + -1.5720931501039814e-18i, 1.3552527156068805e-20 + 7.453889935837843e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00011756395579407247 + 2.590077413162353e-05i, 0.23562967764539958 + 8.408125490479018e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 6.776263578034403e-21 + 4.743384504624082e-20i, 5.421010862427522e-19 + -3.577867169202165e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -3.577867169202165e-18 + 1.6263032587282567e-18i, 1.3552527156068805e-20 + -4.743384504624082e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24368532620324906 + 2.5696862037327346e-19i, -0.0001281511245715144 + -5.6704526082019396e-08i, 0.0 + 0.0i, 0.0 + 0.0i }, { 6.776263578034403e-21 + -3.3881317890172014e-20i, 5.421010862427522e-19 + 3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0001281511245715141 + 5.6704526082019396e-08i, 0.32205547742162033 + 1.058791184067876e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.19862951872973084, 1.0e-7), DoubleNear(0.23562967764539958, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24368532620324906, 1.0e-7), DoubleNear(0.32205547742162033, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false, false, false}), Matrix({ { 0.12075208001919621 + 5.948841263595896e-20i, 5.987223682968627e-06 + -3.5653166093459155e-06i, -0.005584653866383699 + -0.04299490731337517i, -1.5463669778772332e-06 + -1.966914922613746e-06i, 0.0009194791299272339 + 0.004286991224052969i, 2.230060743224914e-06 + -3.4710540468767113e-06i, 0.0014838983943375366 + -0.0005256578774649189i, -1.3390391648027585e-06 + -6.335014646760045e-07i }, { 5.9872236829686815e-06 + 3.565316609346024e-06i, 0.1522425086113022 + 7.631225920409804e-20i, 9.925616623135755e-07 + -2.2966990420111047e-06i, -0.007041052329772714 + -0.05420736889880559i, -7.349932356492837e-07 + 3.342668627262244e-06i, 0.001107057065023924 + 0.005392639619855949i, 1.2241810708370547e-06 + 1.071063849778975e-07i, 0.0018688995674092923 + -0.000643581804901488i }, { -0.005584653866383699 + 0.04299490731337517i, 9.925616623136297e-07 + 2.2966990420111115e-06i, 0.09622431784826957 + 6.491955149201644e-20i, 4.771069074810608e-06 + -2.8411117936262857e-06i, -0.0015689482365794415 + 0.00012912040811856226i, 1.1327633416460683e-06 + 9.545664997500958e-07i, 0.0007327099627509797 + 0.003416196276622624i, 1.7770797301620665e-06 + -2.7659963109710994e-06i }, { -1.546366977877179e-06 + 1.9669149226137324e-06i, -0.007041052329772714 + 0.05420736889880559i, 4.771069074810635e-06 + 2.8411117936262315e-06i, 0.12131825419738534 + 5.732042311506871e-20i, -1.1561957770916973e-06 + -4.1629604482163994e-07i, -0.001971299965274247 + 0.00014477423656386845i, -5.856977595102173e-07 + 2.6636891753747628e-06i, 0.0008821861361236991 + 0.004297259879413252i }, { 0.0009194791299272339 + -0.00428699122405297i, -7.349932356493057e-07 + -3.3426686272622706e-06i, -0.0015689482365794413 + -0.00012912040811856223i, -1.1561957770916948e-06 + 4.162960448216611e-07i, 0.12540574209401764 + 6.600596327131637e-20i, -1.1879213152584842e-05 + -1.0880584284844849e-05i, -0.00579988073365475 + -0.04465188721420098i, -3.324732949662305e-06 + 4.7329202565722206e-06i }, { 2.230060743224919e-06 + 3.4710540468766914e-06i, 0.0011070570650239236 + -0.005392639619855949i, 1.132763341646063e-06 + -9.545664997500983e-07i, -0.001971299965274247 + -0.00014477423656386853i, -1.1879213152584815e-05 + 1.088058428484474e-05i, 0.15812139793352148 + -1.9653005681308342e-20i, 4.423534620848956e-06 + 3.726489608169096e-06i, -0.007312944639852627 + -0.05630060241887602i }, { 0.0014838983943375366 + 0.000525657877464919i, 1.224181070837059e-06 + -1.0710638497790512e-07i, 0.0007327099627509797 + -0.0034161962766226235i, -5.85697759510241e-07 + -2.6636891753748157e-06i, -0.00579988073365475 + 0.04465188721420098i, 4.423534620849064e-06 + -3.7264896081691366e-06i, 0.0999327049714965 + 2.928524329479245e-20i, -9.466248382636148e-06 + -8.670465969889203e-06i }, { -1.3390391648027598e-06 + 6.335014646760167e-07i, 0.0018688995674092925 + 0.000643581804901488i, 1.7770797301620665e-06 + 2.7659963109711e-06i, 0.0008821861361236993 + -0.004297259879413252i, -3.3247329496623862e-06 + -4.7329202565722815e-06i, -0.007312944639852627 + 0.05630060241887602i, -9.466248382636121e-06 + 8.670465969889257e-06i, 0.12600299432481082 + -1.9310509892389483e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12075208001919621, 1.0e-7), DoubleNear(0.1522425086113022, 1.0e-7), DoubleNear(0.09622431784826957, 1.0e-7), DoubleNear(0.12131825419738534, 1.0e-7), DoubleNear(0.12540574209401764, 1.0e-7), DoubleNear(0.15812139793352148, 1.0e-7), DoubleNear(0.0999327049714965, 1.0e-7), DoubleNear(0.12600299432481082, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false, false, false}), Matrix({ { 0.09859737393900334 + 9.010354251103487e-20i, -0.0016404333455323043 + -0.0012347815624941672i, -0.004560022531257427 + -0.0351065170320522i, -0.00036378724407104405 + 0.000641198952926899i, 0.07787650014417544 + 0.02526970727846297i, 0.0011168704892716235 + -0.0028988892432330517i, 0.005395811190494261 + -0.02889735293577721i, -0.0010838306834954773 + -0.00026360167163810085i }, { -0.0016404333455323041 + 0.0012347815624941666i, 0.10857551004860441 + 9.162048212862847e-20i, 0.0005155238008941703 + 0.0005269843137086577i, -0.005021500597680199 + -0.038659325705197534i, -0.0019749377399187417 + -0.0017142141061817246i, 0.09454837780115549 + 0.025984581764920984i, -0.0005190232161259329 + 0.0007824756103445145i, 0.004879292520827822 + -0.03486659306027012i }, { -0.004560022531257427 + 0.0351065170320522i, 0.0005155238008941704 + -0.0005269843137086577i, 0.078569785691502 + 3.792047442819416e-20i, -0.00130722037768879 + -0.00098396659936403i, -0.012599219985795527 + 0.026559959353279615i, 0.000980522564990702 + 0.0005317426927760545i, 0.062057838685616616 + 0.020136798841966133i, 0.0008900062089029048 + -0.00231005246372106i }, { -0.00036378724407104416 + -0.000641198952926899i, -0.005021500597680199 + 0.038659325705197534i, -0.00130722037768879 + 0.00098396659936403i, 0.08652111324122964 + 2.0563902436057903e-20i, 0.0007017007101012075 + -0.0006239144918217468i, -0.013624814147678296 + 0.03246307512506336i, -0.0015737785782760309 + -0.0013660144238260348i, 0.07534324175724638 + 0.02070646447253431i }, { 0.07787650014417544 + -0.02526970727846297i, -0.0019749377399187417 + 0.0017142141061817244i, -0.012599219985795527 + -0.026559959353279615i, 0.0007017007101012074 + 0.0006239144918217468i, 0.14756044817421052 + 3.539083339624045e-20i, 0.001634541356062688 + 0.0012203356615999765i, -0.006824512068781024 + -0.05254027749552396i, 0.00035891614414350446 + -0.0006384329475929405i }, { 0.001116870489271623 + 0.0028988892432330517i, 0.09454837780115549 + -0.025984581764920984i, 0.0009805225649907017 + -0.0005317426927760543i, -0.013624814147678296 + -0.03246307512506336i, 0.0016345413560626882 + -0.0012203356615999763i, 0.20178839649621927 + -3.496122860583879e-20i, -0.0005101077046110079 + -0.0005255545231424996i, -0.00933249637194514 + -0.07184864561248408i }, { 0.005395811190494262 + 0.028897352935777214i, -0.000519023216125933 + -0.0007824756103445147i, 0.062057838685616616 + -0.020136798841966133i, -0.0015737785782760313 + 0.001366014423826035i, -0.006824512068781024 + 0.05254027749552396i, -0.0005101077046110079 + 0.0005255545231424996i, 0.11758723712826408 + 5.628432035861472e-20i, 0.0013025251983809646 + 0.0009724550216005145i }, { -0.0010838306834954773 + 0.00026360167163810085i, 0.004879292520827822 + 0.03486659306027012i, 0.0008900062089029046 + 0.00231005246372106i, 0.07534324175724637 + -0.020706464472534308i, 0.00035891614414350456 + 0.0006384329475929405i, -0.00933249637194514 + 0.07184864561248408i, 0.0013025251983809646 + -0.000972455021600514i, 0.16080013528096654 + 1.744601078662133e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.09859737393900334, 1.0e-7), DoubleNear(0.10857551004860441, 1.0e-7), DoubleNear(0.078569785691502, 1.0e-7), DoubleNear(0.08652111324122964, 1.0e-7), DoubleNear(0.14756044817421052, 1.0e-7), DoubleNear(0.20178839649621927, 1.0e-7), DoubleNear(0.11758723712826408, 1.0e-7), DoubleNear(0.16080013528096654, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true, false, false}), Matrix({ { 0.24615782211321385 + 1.254943759072753e-19i, -5.891989469616269e-06 + -1.4445900894190819e-05i, -0.011384534600038451 + -0.08764679452757615i, -4.871099927539592e-06 + 2.7660053339584746e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -5.8919894696160525e-06 + 1.4445900894190602e-05i, 0.3103639065448237 + 5.665925352278969e-20i, 5.4160962831625175e-06 + 1.4297905661579777e-06i, -0.01435399696962534 + -0.11050797131768161i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011384534600038451 + 0.08764679452757615i, 5.416096283162653e-06 + -1.4297905661580184e-06i, 0.19615702281976607 + 9.420479478680887e-20i, -4.695179307825567e-06 + -1.1511577763515489e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.871099927539538e-06 + -2.7660053339585694e-06i, -0.01435399696962534 + 0.11050797131768161i, -4.695179307825459e-06 + 1.1511577763515597e-05i, 0.24732124852219617 + 3.800991322267924e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24615782211321385, 1.0e-7), DoubleNear(0.3103639065448237, 1.0e-7), DoubleNear(0.19615702281976607, 1.0e-7), DoubleNear(0.24732124852219617, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, true, false}), Matrix({ { 0.1149813590669108 + 3.807815770867694e-20i, -1.0050699023401554e-05 + -8.498990371254593e-05i, -0.0053177642271089245 + -0.040940188152964685i, -2.979661598343262e-05 + 7.50933704142805e-06i, -0.03443882183818339 + -0.01130324787145345i, -4.8934965647750444e-05 + 2.4870490945619875e-05i, -0.0024318686269773028 + 0.012785027633454574i, 1.11185604251098e-05 + 1.627351867294975e-05i }, { -1.00506990234015e-05 + 8.498990371254604e-05i, 0.14508481583635785 + 2.466112742952748e-20i, 3.0726284029763024e-05 + -3.5204628706439066e-07i, -0.0067100167349935175 + -0.05165880545056167i, 5.391260713184351e-05 + -1.4859390709606285e-05i, -0.04344726526615839 + -0.014324508734244104i, -7.784225133090805e-06 + -1.8508857093991367e-05i, -0.0030909859882055322 + 0.016132298225547494i }, { -0.0053177642271089245 + 0.040940188152964685i, 3.072628402976305e-05 + 3.5204628706441777e-07i, 0.09162577439429258 + 3.217325548789441e-20i, -8.009151124116216e-06 + -6.772633239468648e-05i, 0.005617385588701446 + -0.01173950151219901i, -6.592181333956796e-06 + -1.8573985603146477e-05i, -0.02744343731677728 + -0.00900727602975955i, -3.899505240518203e-05 + 1.9818673313233136e-05i }, { -2.9796615983432512e-05 + -7.5093370414280365e-06i, -0.0067100167349935175 + 0.05165880545056167i, -8.009151124115945e-06 + 6.772633239468659e-05i, 0.11561446752532951 + 3.4424048907065276e-21i, 2.7974249087333957e-06 + 1.9883318780536486e-05i, 0.007109764594981947 + -0.014807311971496616i, 4.2961610631126945e-05 + -1.1841077474155818e-05i, -0.034622040978046054 + -0.011414843381953307i }, { -0.03443882183818339 + 0.01130324787145345i, 5.391260713184345e-05 + 1.4859390709606312e-05i, 0.005617385588701446 + 0.011739501512199012i, 2.7974249087334228e-06 + -1.9883318780536496e-05i, 0.13117646304630304 + 8.741621819859838e-20i, 4.158709553785285e-06 + 7.054400281835511e-05i, -0.006066770372929526 + -0.046706606374611465i, 2.492551605589303e-05 + -4.7433317074695755e-06i }, { -4.893496564775045e-05 + -2.4870490945619875e-05i, -0.04344726526615839 + 0.014324508734244104i, -6.592181333956782e-06 + 1.8573985603146488e-05i, 0.007109764594981947 + 0.014807311971496616i, 4.158709553785448e-06 + -7.054400281835543e-05i, 0.16527909070846583 + 3.199812609326221e-20i, -2.5310187746600506e-05 + 1.7818368532223684e-06i, -0.0076439802346318225 + -0.05884916586711994i }, { -0.0024318686269773028 + -0.012785027633454574i, -7.784225133090832e-06 + 1.850885709399137e-05i, -0.027443437316777283 + 0.00900727602975955i, 4.296161063112698e-05 + 1.1841077474155872e-05i, -0.006066770372929526 + 0.046706606374611465i, -2.5310187746600398e-05 + -1.7818368532224361e-06i, 0.10453124842547348 + 6.203153929891447e-20i, 3.3139718162906485e-06 + 5.621475463117099e-05i }, { 1.1118560425109786e-05 + -1.6273518672949715e-05i, -0.0030909859882055322 + -0.016132298225547494i, -3.8995052405182e-05 + -1.981867331323315e-05i, -0.034622040978046054 + 0.011414843381953307i, 2.4925516055892974e-05 + 4.743331707469467e-06i, -0.0076439802346318225 + 0.05884916586711994i, 3.313971816290486e-06 + -5.621475463117099e-05i, 0.13170678099686667 + 3.456750833197271e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1149813590669108, 1.0e-7), DoubleNear(0.14508481583635785, 1.0e-7), DoubleNear(0.09162577439429258, 1.0e-7), DoubleNear(0.11561446752532951, 1.0e-7), DoubleNear(0.13117646304630304, 1.0e-7), DoubleNear(0.16527909070846583, 1.0e-7), DoubleNear(0.10453124842547348, 1.0e-7), DoubleNear(0.13170678099686667, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false, true}), Matrix({ { 0.11054164312598388 + -2.1940914883357842e-20i, 6.542689590639453e-05 + -1.441434359331301e-05i, -0.005112432138492304 + -0.03935938577384607i, -8.158285420923196e-06 + -2.2629210239551113e-05i, -1.8973538018496328e-18 + -9.75781955236954e-19i, 6.776263578034403e-21 + 4.0657581468206416e-20i, -2.168404344971009e-19 + 7.589415207398531e-19i, 1.1858461261560205e-20 + 3.3881317890172014e-21i }, { 6.542689590639447e-05 + 1.4414343593312793e-05i, 0.13113303552635394 + 5.11443328405939e-20i, 2.106438245602605e-06 + -2.3962506024882192e-05i, -0.00606476189682582 + -0.046691143600017734i, 1.0164395367051604e-20 + 3.3881317890172014e-20i, 2.846030702774449e-19 + -1.951563910473908e-18i, 1.1858461261560205e-20 + -6.776263578034403e-21i, -7.047314121155779e-19 + -1.6940658945086007e-20i }, { -0.005112432138492304 + 0.03935938577384607i, 2.1064382456026593e-06 + 2.396250602488218e-05i, 0.08808787560374698 + -1.5328534795831403e-20i, 5.21370598876781e-05 + -1.1486430538311387e-05i, 4.2012834183813297e-19 + -6.776263578034403e-19i, -3.3881317890172014e-21 + -5.082197683525802e-21i, -1.6263032587282567e-18 + -7.047314121155779e-19i, -3.3881317890172014e-21 + 4.0657581468206416e-20i }, { -8.15828542092325e-06 + 2.262921023955106e-05i, -0.00606476189682582 + 0.046691143600017734i, 5.2137059887678156e-05 + 1.1486430538311604e-05i, 0.10449664211904564 + 3.293692206419627e-20i, 1.6940658945086007e-21 + -5.082197683525802e-21i, 6.505213034913027e-19 + 2.303929616531697e-19i, 0.0 + 1.3552527156068805e-20i, 2.710505431213761e-19 + -1.5720931501039814e-18i }, { -2.0599841277224584e-18 + 9.215718466126788e-19i, 6.776263578034403e-21 + -1.6940658945086007e-20i, 4.336808689942018e-19 + 6.505213034913027e-19i, -3.3881317890172014e-21 + 3.3881317890172014e-21i, 0.13561617898722997 + 1.4743529079063314e-19i, -7.13188853760108e-05 + -3.155730087780941e-08i, -0.006272102461546147 + -0.04828740875373008i, 3.2871854933836037e-06 + 2.5395215573509588e-05i }, { 6.776263578034403e-21 + -6.776263578034403e-21i, 2.710505431213761e-19 + 1.951563910473908e-18i, -8.470329472543003e-21 + -5.082197683525802e-21i, 6.776263578034403e-19 + -1.9651164376299768e-19i, -7.131888537601053e-05 + 3.155730087780941e-08i, 0.17923087101846974 + 5.514920682195794e-21i, 3.3096580375599125e-06 + 2.539229659104017e-05i, -0.008289235072799519 + -0.06381682771766388i }, { -2.168404344971009e-19 + -7.318364664277155e-19i, 1.3552527156068805e-20 + 3.3881317890172014e-21i, -1.6263032587282567e-18 + 7.047314121155779e-19i, 3.3881317890172014e-21 + -4.0657581468206416e-20i, -0.006272102461546147 + 0.04828740875373008i, 3.3096580375599938e-06 + -2.5392296591040197e-05i, 0.1080691472160191 + 1.0953332958264027e-19i, -5.683223919550367e-05 + -2.5147225204101564e-08i }, { 6.776263578034403e-21 + -1.6940658945086007e-21i, -7.047314121155779e-19 + -3.3881317890172014e-21i, 3.3881317890172014e-21 + -3.049318610115481e-20i, 2.574980159653073e-19 + 1.5178830414797062e-18i, 3.287185493383712e-06 + -2.539521557350963e-05i, -0.008289235072799519 + 0.06381682771766388i, -5.6832239195503615e-05 + 2.5147225203993144e-08i, 0.14282460640315053 + 5.072991158482965e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11054164312598388, 1.0e-7), DoubleNear(0.13113303552635394, 1.0e-7), DoubleNear(0.08808787560374698, 1.0e-7), DoubleNear(0.10449664211904564, 1.0e-7), DoubleNear(0.13561617898722997, 1.0e-7), DoubleNear(0.17923087101846974, 1.0e-7), DoubleNear(0.1080691472160191, 1.0e-7), DoubleNear(0.14282460640315053, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false, false, false}), Matrix({ { 0.08699366685929105 + 9.995925631536912e-20i, -0.0014389787195302913 + -0.0010873847534589318i, 0.0006231939710498759 + 0.0030638310321618603i, 2.621897627235991e-05 + -5.958743979004674e-05i, 0.06865242584845485 + 0.022280839799881623i, 0.0009879435711904962 + -0.002555141628037076i, -0.00025912791072973674 + 0.0025887677318413645i, 9.689954232621902e-05 + 1.2775365248113071e-05i }, { -0.0014389787195302913 + 0.0010873847534589314i, 0.09553709362986201 + 1.0339890190687146e-19i, -5.3018197907150696e-05 + -4.426977755448471e-05i, 0.000738942790864707 + 0.0034119458864429156i, -0.0017320321024197494 + -0.0015078992144351342i, 0.08330869257834625 + 0.022820493591087947i, 4.1350553087746814e-05 + -7.758314076733649e-05i, -0.0002120150285329404 + 0.0031300842519145647i }, { 0.0006231939710498759 + -0.003063831032161861i, -5.3018197907150696e-05 + 4.426977755448471e-05i, 0.0901734927712143 + 2.806476062385991e-20i, -0.001508675003690803 + -0.0011313634083992654i, 0.001303484352520993 + -0.0022763139264574163i, -8.67024666412229e-05 + -5.817539579950579e-05i, 0.07128191298133721 + 0.02312566632054748i, 0.0010189331269840323 + -0.002653800078917036i }, { 2.6218976272359936e-05 + 5.958743979004672e-05i, 0.0007389427908647069 + -0.003411945886442916i, -0.001508675003690803 + 0.0011313634083992654i, 0.09955952965997206 + 8.785482657814928e-21i, -6.734655367365784e-05 + 4.8355762358964037e-05i, 0.001420337436209371 + -0.002781094187558817i, -0.0018166842157750231 + -0.0015723293155726257i, 0.0865829269800556 + 0.023870552646367345i }, { 0.06865242584845485 + -0.022280839799881623i, -0.0017320321024197494 + 0.0015078992144351338i, 0.001303484352520993 + 0.0022763139264574163i, -6.734655367365787e-05 + -4.8355762358964016e-05i, 0.12998273100817473 + 2.444870781260627e-20i, 0.0014497370122880703 + 0.0010809783250559598i, 0.0010289951216283376 + 0.004639356468513734i, -2.2211835798972927e-05 + 5.335038943219893e-05i }, { 0.0009879435711904949 + 0.002555141628037076i, 0.08330869257834625 + -0.022820493591087947i, -8.670246664122285e-05 + 5.8175395799505764e-05i, 0.001420337436209371 + 0.002781094187558817i, 0.0014497370122880705 + -0.0010809783250559592i, 0.17802366917882556 + 3.02337804122953e-20i, 5.169750691199119e-05 + 5.027613535712173e-05i, 0.001250300410282916 + 0.0062779536128262856i }, { -0.0002591279107297368 + -0.0025887677318413645i, 4.135055308774681e-05 + 7.758314076733649e-05i, 0.07128191298133721 + -0.02312566632054748i, -0.0018166842157750231 + 0.0015723293155726257i, 0.0010289951216283376 + -0.004639356468513733i, 5.169750691199116e-05 + -5.0276135357121796e-05i, 0.13516495429429987 + 6.72264459422489e-20i, 0.001487329542155582 + 0.0011118123581445314i }, { 9.6899542326219e-05 + -1.2775365248113098e-05i, -0.0002120150285329405 + -0.0031300842519145643i, 0.0010189331269840323 + 0.002653800078917036i, 0.0865829269800556 + -0.023870552646367345i, -2.221183579897294e-05 + -5.335038943219893e-05i, 0.001250300410282916 + -0.0062779536128262856i, 0.001487329542155582 + -0.0011118123581445316i, 0.18456486259836025 + -4.774899823151275e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.08699366685929105, 1.0e-7), DoubleNear(0.09553709362986201, 1.0e-7), DoubleNear(0.0901734927712143, 1.0e-7), DoubleNear(0.09955952965997206, 1.0e-7), DoubleNear(0.12998273100817473, 1.0e-7), DoubleNear(0.17802366917882556, 1.0e-7), DoubleNear(0.13516495429429987, 1.0e-7), DoubleNear(0.18456486259836025, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true, false, false}), Matrix({ { 0.21697639786746575 + 1.2440796412797539e-19i, 1.0758292757779317e-05 + -6.406428402972201e-06i, 0.0016521890926782137 + 0.007703187500675593i, 4.007140473386979e-06 + -6.23705035784781e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 1.0758292757779317e-05 + 6.40642840297231e-06i, 0.2735607628086875 + 1.3363268231916678e-19i, -1.3206909951594958e-06 + 6.006357802637009e-06i, 0.0019892432011476228 + 0.0096898994992692i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016521890926782137 + -0.007703187500675593i, -1.3206909951595433e-06 + -6.006357802637089e-06i, 0.22533844706551415 + 9.529120656610881e-20i, -2.134546153522099e-05 + -1.9551050254734215e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.0071404733869855e-06 + 6.237050357847793e-06i, 0.001989243201147623 + -0.0096898994992692i, -2.134546153522099e-05 + 1.955105025473389e-05i, 0.2841243922583323 + -3.896351557369783e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.21697639786746575, 1.0e-7), DoubleNear(0.2735607628086875, 1.0e-7), DoubleNear(0.22533844706551415, 1.0e-7), DoubleNear(0.2841243922583323, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, true, false}), Matrix({ { 0.10141814914428485 + 6.147638318858632e-20i, 2.2450712859947968e-07 + -6.041626227283419e-05i, 0.0006986800975201766 + 0.0035689550568446284i, -7.157236328653136e-06 + -6.128417640579543e-06i, -0.03081411504684426 + -0.010369759959253898i, -3.870821886939594e-05 + 1.4708472644916527e-05i, -2.5016264267582995e-05 + -0.0013397746074720585i, 5.2609651681333314e-06 + 1.8460015318502707e-07i }, { 2.245071285996423e-07 + 6.041626227283419e-05i, 0.1280954216208443 + 4.178410343225947e-20i, 5.726059302617747e-06 + 5.849260007758781e-06i, 0.0008472523387834681 + 0.004475682501229025i, 4.176347621412229e-05 + -4.2580620403130035e-06i, -0.03888284084188705 + -0.01322998010320295i, -5.247188055886685e-06 + -4.987816059593588e-06i, -3.370177289320119e-05 + -0.0016921294566623491i }, { 0.0006986800975201766 + -0.0035689550568446284i, 5.726059302617717e-06 + -5.8492600077588224e-06i, 0.10518898431691853 + 8.775030007985021e-21i, -1.8284357276117196e-05 + -9.229997383439843e-05i, -0.000776149181496832 + 0.0009787130079750473i, -1.014455593329933e-05 + -1.9846034366971054e-06i, -0.03106814410811641 + -0.0099407639419591i, -4.922179918353653e-05 + 2.9980691613936512e-05i }, { -7.157236328653112e-06 + 6.128417640579546e-06i, 0.0008472523387834683 + -0.004475682501229026i, -1.8284357276117196e-05 + 9.229997383439843e-05i, 0.13260386174084304 + -1.368057111202545e-20i, 5.636154901013708e-06 + 4.941401668062528e-06i, -0.0009519412827918988 + 0.0012304646705017788i, 5.511074154884817e-05 + -2.2442406143449018e-05i, -0.039186465402317405 + -0.012509372012994461i }, { -0.030814115046844264 + 0.010369759959253898i, 4.176347621412234e-05 + 4.258062040313058e-06i, -0.000776149181496832 + -0.0009787130079750473i, 5.636154901013711e-06 + -4.941401668062533e-06i, 0.11555824872318092 + 6.293158093938905e-20i, 1.0533785629179837e-05 + 5.4009833869861986e-05i, 0.0009535089951580371 + 0.004134232443830965i, 1.1164376802040114e-05 + -1.086327172682673e-07i }, { -3.870821886939591e-05 + -1.4708472644916527e-05i, -0.03888284084188705 + 0.01322998010320295i, -1.0144555933299334e-05 + 1.9846034366971155e-06i, -0.0009519412827918987 + -0.0012304646705017786i, 1.0533785629179674e-05 + -5.400983386986188e-05i, 0.1454653411878432 + 9.184857888690729e-20i, -7.046750297777243e-06 + 1.570977948782283e-07i, 0.0011419908623641548 + 0.005214216998040176i }, { -2.5016264267583025e-05 + 0.0013397746074720585i, -5.247188055886685e-06 + 4.987816059593589e-06i, -0.03106814410811641 + 0.0099407639419591i, 5.5110741548848117e-05 + 2.2442406143448963e-05i, 0.000953508995158037 + -0.004134232443830965i, -7.04675029777726e-06 + -1.5709779487826643e-07i, 0.12014946274859563 + 8.651617655812379e-20i, -3.061104259103795e-06 + 7.274892357966422e-05i }, { 5.260965168133333e-06 + -1.846001531850224e-07i, -3.370177289320122e-05 + 0.0016921294566623493i, -4.922179918353649e-05 + -2.9980691613936566e-05i, -0.039186465402317405 + 0.012509372012994461i, 1.1164376802040097e-05 + 1.0863271726824697e-07i, 0.0011419908623641548 + -0.0052142169980401755i, -3.061104259103795e-06 + -7.274892357966454e-05i, 0.15152053051748926 + -2.5282944461672377e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.10141814914428485, 1.0e-7), DoubleNear(0.1280954216208443, 1.0e-7), DoubleNear(0.10518898431691853, 1.0e-7), DoubleNear(0.13260386174084304, 1.0e-7), DoubleNear(0.11555824872318092, 1.0e-7), DoubleNear(0.1454653411878432, 1.0e-7), DoubleNear(0.12014946274859563, 1.0e-7), DoubleNear(0.15152053051748926, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false, true}), Matrix({ { 0.09747543090842191 + -4.235164736271517e-21i, 6.495399087121464e-05 + 8.250865098312224e-06i, 0.0007541024786917795 + 0.00345747804001818i, 2.9155507217441226e-06 + -2.4325886796134343e-06i, 0.00032063567335820263 + 0.00016601664675858078i, -2.295534260410112e-05 + 3.7204607536384006e-05i, 0.0001179360681804557 + 0.00011037739684953799i, 3.543639451780031e-05 + -1.4764018074678093e-05i }, { 6.495399087121453e-05 + -8.250865098312224e-06i, 0.11555568976033749 + 8.238718901028157e-20i, -2.300173835332754e-07 + 1.607679512010655e-06i, 0.0008337438009806642 + 0.004100067910514466i, -1.9066482228102763e-05 + 2.4130868800009736e-05i, -2.618336989802393e-05 + 0.0003236222448652113i, 1.9481055371168288e-05 + -7.160129384611905e-06i, -8.071058185132006e-05 + 0.00013309154611362712i }, { 0.0007541024786917795 + -0.00345747804001818i, -2.3001738353331606e-07 + -1.6076795120107074e-06i, 0.10115408782130894 + -3.303428494291773e-20i, 5.2609964922858043e-05 + -3.415163922993662e-05i, 0.00014670851756245747 + 9.010521807575624e-06i, -1.3911533617587108e-05 + -3.391410717037425e-05i, -0.0003206356733582061 + -0.00016601664675858235i, 2.295534260410112e-05 + -3.7204607536383924e-05i }, { 2.915550721744116e-06 + 2.432588679613414e-06i, 0.0008337438009806641 + -0.0041000679105144665i, 5.260996492285799e-05 + 3.4151639229936404e-05i, 0.1200739878850621 + 1.6940658945086067e-21i, -1.5724804439770473e-05 + -2.394353288958669e-05i, 3.873916561943357e-06 + 0.00014167126532863057i, 1.906648222810277e-05 + -2.4130868800009685e-05i, 2.6183369898024472e-05 + -0.0003236222448652149i }, { 0.0003206356733582025 + -0.00016601664675858078i, -1.906648222810275e-05 + -2.4130868800009732e-05i, 0.00014670851756245747 + -9.010521807575624e-06i, -1.5724804439770484e-05 + 2.3943532889586686e-05i, 0.11950096695904386 + 1.2864312886424691e-19i, -5.4195698113435325e-05 + -1.4657293501284425e-05i, 0.0008980866139864343 + 0.0042457094606574135i, 1.0915897516428561e-06 + -3.8044616782343756e-06i }, { -2.2955342604101094e-05 + -3.7204607536384e-05i, -2.618336989802393e-05 + -0.0003236222448652114i, -1.3911533617587105e-05 + 3.391410717037425e-05i, 3.8739165619432725e-06 + -0.00014167126532863057i, -5.4195698113435216e-05 + 1.4657293501284534e-05i, 0.15800507304835004 + 5.1245493308885195e-20i, -1.0906736116262204e-06 + 4.398678290626354e-06i, 0.0011554994001669588 + 0.005589831588754736i }, { 0.00011793606818045567 + -0.00011037739684953802i, 1.9481055371168288e-05 + 7.160129384611905e-06i, -0.0003206356733582062 + 0.0001660166467585824i, 1.9066482228102766e-05 + 2.413086880000967e-05i, 0.0008980866139864342 + -0.0042457094606574135i, -1.0906736116262272e-06 + -4.3986782906263814e-06i, 0.12418435924420522 + 1.2832549150902655e-19i, -7.395542645807903e-05 + 1.4600588975202406e-05i }, { 3.543639451780033e-05 + 1.4764018074678096e-05i, -8.071058185132003e-05 + -0.00013309154611362712i, 2.2955342604101115e-05 + 3.7204607536383965e-05i, 2.6183369898024486e-05 + 0.0003236222448652149i, 1.0915897516428697e-06 + 3.804461678234379e-06i, 0.001155499400166959 + -0.005589831588754735i, -7.395542645807898e-05 + -1.4600588975202515e-05i, 0.16405040437327023 + -4.0657581468206434e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.09747543090842191, 1.0e-7), DoubleNear(0.11555568976033749, 1.0e-7), DoubleNear(0.10115408782130894, 1.0e-7), DoubleNear(0.1200739878850621, 1.0e-7), DoubleNear(0.11950096695904386, 1.0e-7), DoubleNear(0.15800507304835004, 1.0e-7), DoubleNear(0.12418435924420522, 1.0e-7), DoubleNear(0.16405040437327023, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true, false, false}), Matrix({ { 0.17716715963050533 + 1.2802401693922902e-19i, -0.0029476537232210943 + -0.0022187481618581974i, 0.13993433882979206 + 0.0454065061204291i, 0.002006876698174529 + -0.0052089417069541115i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0029476537232210943 + 0.0022187481618581965i, 0.19509662328983407 + 1.1218438456468639e-19i, -0.003548716318194772 + -0.0030802285300077594i, 0.16989161955840187 + 0.04669104623745529i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13993433882979206 + -0.0454065061204291i, -0.003548716318194772 + 0.0030802285300077594i, 0.26514768530247457 + 9.167515375485516e-20i, 0.0029370665544436528 + 0.002192790683200491i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002006876698174528 + 0.0052089417069541115i, 0.16989161955840187 + -0.04669104623745529i, 0.0029370665544436528 + -0.002192790683200491i, 0.3625885317771858 + -1.751521781921745e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.17716715963050533, 1.0e-7), DoubleNear(0.19509662328983407, 1.0e-7), DoubleNear(0.26514768530247457, 1.0e-7), DoubleNear(0.3625885317771858, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, true, false}), Matrix({ { 0.08277833100226763 + 2.306800315673145e-20i, -0.0014090311382857924 + -0.0010370143884703685i, 0.0653656428606823 + 0.021208543480705066i, 0.0008443337262489803 + -0.0024635535385489323i, -0.024791852095055397 + -0.008150079165727367i, 0.00031744013236987417 + 0.0004667809602829625i, -0.017493628560154868 + -0.012779103868749444i, -0.0005184764237303573 + 0.0007039382496154866i }, { -0.0014090311382857924 + 0.0010370143884703685i, 0.09112702723749078 + 5.646271684159988e-20i, -0.00164221635780249 + -0.0014234847715359844i, 0.07940622881016168 + 0.02178745370512186i, 0.0005220187195992566 + -0.00015433530366132354i, -0.027294299382115302 + -0.008956358573806257i, 0.0003614596129006142 + 0.0005804096923733692i, -0.02165033559057409 + -0.014360364587969989i }, { 0.0653656428606823 + -0.021208543480705066i, -0.0016422163578024903 + 0.0014234847715359842i, 0.12382880245893575 + 4.7183410039839903e-20i, 0.0013909712881382747 + 0.0008842981523631362i, -0.021662311160864492 + -7.433680182037381e-05i, 0.000624483845010977 + -0.00027449185833072624i, -0.03709040705990527 + -0.012160444735485632i, -0.00040537015042280665 + -0.0004220917960241095i }, { 0.0008443337262489803 + 0.0024635535385489323i, 0.07940622881016168 + -0.02178745370512186i, 0.001390971288138275 + -0.0008842981523631362i, 0.1695722561241966 + -2.835918452136586e-20i, -6.108522632938557e-07 + -0.0007674623820362263i, -0.025909604264877217 + -0.0013057950779275733i, -0.0004251445018362861 + 0.00012763483547756143i, -0.05077500686208915 + -0.016782993542391152i }, { -0.0247918520950554 + 0.008150079165727367i, 0.0005220187195992564 + 0.00015433530366132364i, -0.021662311160864492 + 7.433680182037368e-05i, -6.108522632938557e-07 + 0.0007674623820362262i, 0.09438882862823772 + 1.0495601378249758e-19i, -0.001538622584935302 + -0.0011817337733878287i, 0.07456869596910974 + 0.024197962639724038i, 0.0011625429719255486 + -0.00274538816840518i }, { 0.0003174401323698742 + -0.0004667809602829626i, -0.027294299382115302 + 0.008956358573806257i, 0.000624483845010977 + 0.00027449185833072624i, -0.025909604264877217 + 0.001305795077927573i, -0.001538622584935302 + 0.0011817337733878283i, 0.1039695960523433 + 5.572166772308652e-20i, -0.0019064999603922825 + -0.0016567437584717752i, 0.09048539074824018 + 0.024903592532333433i }, { -0.01749362856015487 + 0.012779103868749444i, 0.0003614596129006142 + -0.0005804096923733692i, -0.03709040705990527 + 0.012160444735485632i, -0.00042514450183628603 + -0.00012763483547756154i, 0.07456869596910974 + -0.024197962639724038i, -0.0019064999603922825 + 0.001656743758471775i, 0.14131888284353883 + 4.449174371501527e-20i, 0.0015460952663053779 + 0.001308492530837355i }, { -0.0005184764237303571 + -0.0007039382496154866i, -0.021650335590574086 + 0.014360364587969989i, -0.0004053701504228066 + 0.00042209179602410946i, -0.05077500686208915 + 0.016782993542391152i, 0.0011625429719255478 + 0.00274538816840518i, 0.09048539074824018 + -0.024903592532333433i, 0.0015460952663053779 + -0.001308492530837355i, 0.19301627565298923 + 1.0843966702148405e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.08277833100226763, 1.0e-7), DoubleNear(0.09112702723749078, 1.0e-7), DoubleNear(0.12382880245893575, 1.0e-7), DoubleNear(0.1695722561241966, 1.0e-7), DoubleNear(0.09438882862823772, 1.0e-7), DoubleNear(0.1039695960523433, 1.0e-7), DoubleNear(0.14131888284353883, 1.0e-7), DoubleNear(0.19301627565298923, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false, true}), Matrix({ { 0.079570553834966 + 6.395973311598913e-21i, -0.0013389224625444873 + -0.004764792886341295i, 0.06283961920632822 + 0.02039213064089921i, 0.006381384044449354 + -0.00399074854617358i, -1.463672932855431e-18 + -6.505213034913027e-19i, 3.2526065174565133e-19 + -4.336808689942018e-19i, -1.0028870095490916e-18 + -8.402566836762659e-19i, 7.860465750519907e-19 + 2.846030702774449e-19i }, { -0.0013389224625444873 + 0.004764792886341294i, 0.0824314627138296 + 1.6118946250552208e-20i, -0.00625464110355237 + -0.00042626090740040647i, 0.07178151993979492 + 0.019728217120087925i, 1.5585406229479126e-19 + -3.2526065174565133e-19i, 2.0328790734103208e-19 + -1.2468324983583301e-18i, 4.607859233063394e-19 + 1.0842021724855044e-19i, 4.607859233063394e-19 + -1.0299920638612292e-18i }, { 0.06283961920632822 + -0.02039213064089921i, -0.00625464110355237 + 0.00042626090740040636i, 0.11905896489476486 + -4.366542299078815e-20i, 0.0014564864183385599 + 0.004738892112209671i, -1.3010426069826053e-18 + -1.3552527156068805e-19i, -4.607859233063394e-19 + -5.014435047745458e-19i, -2.0599841277224584e-18 + -9.215718466126788e-19i, -3.1170812458958252e-19 + 5.082197683525802e-19i }, { 0.006381384044449354 + 0.00399074854617358i, 0.07178151993979492 + -0.019728217120087925i, 0.0014564864183385599 + -0.004738892112209671i, 0.15319821493157 + 6.796230865423797e-20i, -4.2012834183813297e-19 + -3.3881317890172014e-19i, -1.2874900798265365e-19 + -1.0842021724855044e-18i, -1.4907779871675686e-19 + 3.7269449679189215e-19i, 3.2526065174565133e-19 + -2.3310346708438345e-18i }, { -1.463672932855431e-18 + 6.505213034913027e-19i, 1.4907779871675686e-19 + 3.2526065174565133e-19i, -1.3010426069826053e-18 + 1.4907779871675686e-19i, -4.2012834183813297e-19 + 3.3881317890172014e-19i, 0.09759660579553935 + 1.216280436276301e-19i, -0.001608731260676607 + 0.0025460447244830976i, 0.07709471962346383 + 0.025014375479529893i, -0.004374507346274825 + -0.001218193160780532i }, { 3.049318610115481e-19 + 4.607859233063394e-19i, 1.6263032587282567e-19 + 1.1926223897340549e-18i, -4.472333961502706e-19 + 5.149960319306146e-19i, -1.0842021724855044e-19 + 1.111307226797642e-18i, -0.001608731260676607 + -0.0025460447244830976i, 0.11266516057600445 + 9.606543831413418e-20i, 0.0027059247853575977 + -0.002653967622607353i, 0.09811009961860694 + 0.026962829117367366i }, { -9.75781955236954e-19 + 8.673617379884035e-19i, 4.607859233063394e-19 + -1.0503208545953324e-19i, -2.168404344971009e-18 + 9.75781955236954e-19i, -1.3552527156068805e-19 + -3.7269449679189215e-19i, 0.07709471962346383 + -0.025014375479529893i, 0.0027059247853575977 + 0.002653967622607353i, 0.1460887204077097 + 1.353405767456433e-19i, 0.0014805801361050927 + -0.00254610142900918i }, { 8.131516293641283e-19 + -2.574980159653073e-19i, 4.607859233063394e-19 + 1.0299920638612292e-18i, -2.981555974335137e-19 + -4.946672411965114e-19i, 3.7947076036992655e-19 + 2.2768245622195593e-18i, -0.004374507346274826 + 0.001218193160780532i, 0.09811009961860694 + -0.026962829117367366i, 0.001480580136105093 + 0.00254610142900918i, 0.20939031684561582 + -8.547752647345542e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.079570553834966, 1.0e-7), DoubleNear(0.0824314627138296, 1.0e-7), DoubleNear(0.11905896489476486, 1.0e-7), DoubleNear(0.15319821493157, 1.0e-7), DoubleNear(0.09759660579553935, 1.0e-7), DoubleNear(0.11266516057600445, 1.0e-7), DoubleNear(0.1460887204077097, 1.0e-7), DoubleNear(0.20939031684561582, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, true, false}), Matrix({ { 0.20660713346120338 + 7.025141319657135e-20i, -1.8059850147517662e-05 + -0.0001527162361072323i, 0.0 + 0.0i, 0.0 + 0.0i, -0.061882259154960664 + -0.020310523901213i, -8.793001805293245e-05 + 4.4689164258852985e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.8059850147517553e-05 + 0.0001527162361072323i, 0.26069928336168735 + 2.810353232023402e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 9.687421776297045e-05 + -2.6700468183762103e-05i, -0.07806930624420444 + -0.02573935211619741i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.061882259154960664 + 0.020310523901212997i, 9.687421776297045e-05 + 2.6700468183762103e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23570771147177652 + 1.4944775749751286e-19i, 7.4726813700759336e-06 + 0.0001267587574495263i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.793001805293239e-05 + -4.468916425885315e-05i, -0.07806930624420444 + 0.02573935211619741i, 0.0 + 0.0i, 0.0 + 0.0i, 7.4726813700759336e-06 + -0.00012675875744952675i, 0.2969858717053325 + 6.656563442523492e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.20660713346120338, 1.0e-7), DoubleNear(0.26069928336168735, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23570771147177652, 1.0e-7), DoubleNear(0.2969858717053325, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false, true}), Matrix({ { 0.19862951872973084 + -3.726944967918924e-20i, 0.00011756395579407268 + -2.5900774131623963e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -3.469446951953614e-18 + -1.5720931501039814e-18i, 1.3552527156068805e-20 + 7.453889935837843e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00011756395579407247 + 2.590077413162353e-05i, 0.23562967764539958 + 8.408125490479018e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 6.776263578034403e-21 + 4.743384504624082e-20i, 5.421010862427522e-19 + -3.577867169202165e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -3.577867169202165e-18 + 1.6263032587282567e-18i, 1.3552527156068805e-20 + -4.743384504624082e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24368532620324906 + 2.5696862037327346e-19i, -0.0001281511245715144 + -5.6704526082019396e-08i, 0.0 + 0.0i, 0.0 + 0.0i }, { 6.776263578034403e-21 + -3.3881317890172014e-20i, 5.421010862427522e-19 + 3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0001281511245715141 + 5.6704526082019396e-08i, 0.32205547742162033 + 1.058791184067876e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.19862951872973084, 1.0e-7), DoubleNear(0.23562967764539958, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24368532620324906, 1.0e-7), DoubleNear(0.32205547742162033, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true, true}), Matrix({ { 0.09155462201164687 + -3.687427937979e-20i, 1.7274155414925244e-05 + -0.00010299411358738117i, -0.02750973686595547 + -0.008325386464607606i, -6.802249995156384e-05 + 4.337458817633803e-05i, -0.0006632957857693952 + -0.000469340564956938i, -5.9393884562494926e-05 + -3.5581196027326536e-05i, -0.001942175119588859 + -0.002828473437029559i, 4.497083376882815e-05 + 6.949802536790418e-05i }, { 1.7274155414925244e-05 + 0.00010299411358738117i, 0.10867820533444517 + -7.26503829697548e-21i, 5.22953657257039e-05 + -5.332038762270014e-06i, -0.032649920207647315 + -0.009921007490490252i, -3.868531718147428e-05 + -2.40459462077797e-05i, 0.00021624580617685696 + -0.0005771844772218647i, 2.27970289534145e-05 + 4.816886366402286e-05i, 0.0020376647157409463 + -0.002440879754238845i }, { -0.02750973686595547 + 0.008325386464607606i, 5.22953657257039e-05 + 5.332038762270014e-06i, 0.10707489671808398 + -3.951702993992393e-22i, 0.00010028980037914744 + 7.70933394557572e-05i, -0.003392273226717428 + 0.000571864955120676i, 8.218731646495701e-05 + -6.9075421034748554e-06i, 0.0006632957857693918 + 0.00046934056495693643i, 5.939388456249494e-05 + 3.558119602732661e-05i }, { -6.802249995156373e-05 + -4.337458817633814e-05i, -0.032649920207647315 + 0.009921007490490252i, 0.00010028980037914722 + -7.709333945575764e-05i, 0.1269514723109544 + 9.134629320176566e-20i, 5.330450535264508e-05 + 2.6357641656275495e-06i, -0.0013524366072587288 + -0.0028857654081222922i, 3.868531718147429e-05 + 2.404594620777975e-05i, -0.00021624580617685642 + 0.0005771844772218611i }, { -0.0006632957857693952 + 0.00046934056495693795i, -3.8685317181474275e-05 + 2.4045946207779695e-05i, -0.003392273226717428 + -0.000571864955120676i, 5.330450535264504e-05 + -2.635764165627441e-06i, 0.11505251144955651 + 1.0712569257636135e-19i, -3.5334005562442906e-05 + -4.9722122519851126e-05i, -0.0343725222890052 + -0.011985137436605394i, -1.9907518101368608e-05 + 1.3145760825149515e-06i }, { -5.939388456249493e-05 + 3.558119602732652e-05i, 0.000216245806176857 + 0.0005771844772218647i, 8.218731646495704e-05 + 6.9075421034748554e-06i, -0.0013524366072587288 + 0.0028857654081222922i, -3.53340055624428e-05 + 4.9722122519851126e-05i, 0.1520210780272422 + 3.53685706172095e-20i, 4.457885203726655e-05 + -2.1368429421492088e-05i, -0.04541938603655713 + -0.015818344625707158i }, { -0.001942175119588859 + 0.002828473437029559i, 2.2797028953414528e-05 + -4.816886366402283e-05i, 0.0006632957857693917 + -0.0004693405649569363i, 3.868531718147429e-05 + -2.4045946207779742e-05i, -0.0343725222890052 + 0.011985137436605392i, 4.457885203726655e-05 + 2.1368429421492088e-05i, 0.12863281475369254 + 1.4984292779691209e-19i, -9.281711900907151e-05 + 4.966541799376911e-05i }, { 4.497083376882804e-05 + -6.94980253679042e-05i, 0.0020376647157409463 + 0.002440879754238845i, 5.939388456249494e-05 + -3.558119602732656e-05i, -0.00021624580617685645 + -0.0005771844772218612i, -1.9907518101368663e-05 + -1.3145760825150057e-06i, -0.04541938603655713 + 0.015818344625707158i, -9.281711900907129e-05 + -4.966541799376911e-05i, 0.1700343993943781 + -2.478065877653074e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.09155462201164687, 1.0e-7), DoubleNear(0.10867820533444517, 1.0e-7), DoubleNear(0.10707489671808398, 1.0e-7), DoubleNear(0.1269514723109544, 1.0e-7), DoubleNear(0.11505251144955651, 1.0e-7), DoubleNear(0.1520210780272422, 1.0e-7), DoubleNear(0.12863281475369254, 1.0e-7), DoubleNear(0.1700343993943781, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false, false, false}), Matrix({ { 0.29061664421988725 + 4.225442427943428e-20i, 0.02024154204251971 + -0.008661356705489339i, -0.03318147366060007 + -0.019047692184936238i, -0.002898575238719961 + -0.0003022142889591721i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020241542042519708 + 0.008661356705489339i, 0.24468239269240086 + 2.0002633549863764e-20i, -0.001820149757404931 + -0.00247126916212679i, -0.028107924691192877 + -0.01610210064655686i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03318147366060008 + 0.019047692184936238i, -0.0018201497574049314 + 0.00247126916212679i, 0.2522239024805148 + 1.1179969300244166e-19i, 0.017635726835781514 + -0.007527446653429323i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002898575238719961 + 0.0003022142889591721i, -0.028107924691192877 + 0.016102100646556858i, 0.017635726835781514 + 0.007527446653429323i, 0.21247706060719695 + 1.4031158660781344e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.29061664421988725, 1.0e-7), DoubleNear(0.24468239269240086, 1.0e-7), DoubleNear(0.2522239024805148, 1.0e-7), DoubleNear(0.21247706060719695, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false, false, false}), Matrix({ { 0.16173447721804954 + 4.202136530604726e-20i, 0.011264857968207415 + -0.0048202332062628125i, -0.0184662110810183 + -0.010600454581706909i, -0.0016131201024978167 + -0.0001681888185167182i, -0.007480045671923319 + -0.057587073086126345i, -0.002237276678758564 + -0.003788027420782078i, -0.002920348577457265 + 0.007065326770248017i, 1.4719868625043701e-05 + 0.0005821450497305952i }, { 0.011264857968207415 + 0.004820233206262813i, 0.13617106815335972 + -1.0880519099268614e-20i, -0.0010129528894075 + -0.001375314986086102i, -0.0156426708381326 + -0.008961168886847528i, 0.0011953015409984233 + -0.0042338886267827905i, -0.0062977654888542334 + -0.04848498223042011i, -0.0004428457801693579 + 0.0004242781883284139i, -0.0024672512762132486 + 0.005984163661408772i }, { -0.0184662110810183 + 0.010600454581706909i, -0.0010129528894075 + 0.0013753149860861015i, 0.1403680822173324 + 5.1020600279274835e-20i, 0.009814665184790072 + -0.0041891876239476475i, 0.00462843339213991 + 0.006084807516985577i, 0.0005365417441543233 + 0.0002970645096353399i, -0.006491872876618532 + -0.04997936833660355i, -0.0019455171409396867 + -0.0033008578983269644i }, { -0.0016131201024978167 + 0.00016818881851671819i, -0.015642670838132602 + 0.008961168886847528i, 0.009814665184790072 + 0.0041891876239476475i, 0.11824810106929588 + 9.999218294401154e-20i, 0.0001344902719526353 + 0.0005665879456962369i, 0.003914164690257249 + 0.005155274809750157i, 0.0010376817171062276 + -0.003688348744983466i, -0.005468847532267706 + -0.04210334219210776i }, { -0.007480045671923319 + 0.057587073086126345i, 0.0011953015409984233 + 0.0042338886267827905i, 0.00462843339213991 + -0.006084807516985577i, 0.00013449027195263524 + -0.0005665879456962369i, 0.1288821670018377 + 2.3305897338702704e-22i, 0.008976684074312295 + -0.003841123499226526i, -0.014715262579581773 + -0.008447237603229327i, -0.001285455136222144 + -0.0001340254704424539i }, { -0.002237276678758564 + 0.003788027420782078i, -0.006297765488854233 + 0.04848498223042011i, 0.0005365417441543234 + -0.00029706450963533994i, 0.003914164690257249 + -0.005155274809750157i, 0.008976684074312295 + 0.0038411234992265265i, 0.10851132453904114 + 3.0883152649132373e-20i, -0.0008071968679974309 + -0.0010959541760406886i, -0.012465253853060278 + -0.007140931759709331i }, { -0.002920348577457265 + -0.007065326770248017i, -0.0004428457801693579 + -0.0004242781883284139i, -0.006491872876618532 + 0.04997936833660355i, 0.0010376817171062276 + 0.003688348744983466i, -0.014715262579581773 + 0.008447237603229327i, -0.0008071968679974311 + 0.0010959541760406886i, 0.11185582026318239 + 6.077909272316679e-20i, 0.00782106165099144 + -0.003338259029481676i }, { 1.471986862504366e-05 + -0.0005821450497305954i, -0.0024672512762132486 + -0.005984163661408772i, -0.0019455171409396865 + 0.003300857898326965i, -0.005468847532267706 + 0.04210334219210777i, -0.0012854551362221443 + 0.0001340254704424539i, -0.012465253853060278 + 0.007140931759709331i, 0.00782106165099144 + 0.0033382590294816755i, 0.09422895953790106 + 4.0319403663801905e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.16173447721804954, 1.0e-7), DoubleNear(0.13617106815335972, 1.0e-7), DoubleNear(0.1403680822173324, 1.0e-7), DoubleNear(0.11824810106929588, 1.0e-7), DoubleNear(0.1288821670018377, 1.0e-7), DoubleNear(0.10851132453904114, 1.0e-7), DoubleNear(0.11185582026318239, 1.0e-7), DoubleNear(0.09422895953790106, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false, false, false}), Matrix({ { 0.14272637333487564 + 2.683319574725199e-20i, 0.010028361483470869 + -0.004769667512521992i, -0.016615431947692445 + -0.01099493221781664i, -0.0011811248982510855 + 0.0001325560557658892i, 0.002134468542048344 + 0.00980960546064454i, 0.00029179025386561017 + 0.0009595749682961886i, -0.02156506700106253 + -0.0008409885251140393i, -0.0016193481598015896 + 0.0005372109554143133i }, { 0.010028361483470869 + 0.004769667512521992i, 0.12078785760832211 + 3.812692885378672e-20i, -0.0013166394618920722 + -0.0014169484564480566i, -0.0143781984291345 + -0.008702008626325027i, -8.652156591076036e-05 + 0.0004381625947085126i, 0.0015041674076263613 + 0.008200239602157874i, -0.001395759598421176 + -0.000624852159704737i, -0.018146048028784383 + -0.0007738730954539762i }, { -0.016615431947692445 + 0.01099493221781664i, -0.0013166394618920722 + 0.0014169484564480563i, 0.12319032354667667 + 1.090097131686565e-19i, 0.008568509181909139 + -0.003832754615979649i, 0.006110808822168547 + -0.005490263548488223i, 0.00024880778649901834 + -0.0007849794555617538i, 1.3653107778748924e-05 + -0.0003992413455011757i, 4.725863006269632e-06 + 0.00011873841991185105i }, { -0.0011811248982510855 + -0.00013255605576588923i, -0.0143781984291345 + 0.008702008626325027i, 0.008568509181909139 + 0.003832754615979649i, 0.1038326061862789 + 8.407080867744696e-20i, 0.0005245064128579747 + -0.00011555938923911328i, 0.0051938451733116045 + -0.004724816212360336i, -1.3656056892566253e-05 + -4.9274399942149605e-05i, -1.0856763627617173e-05 + -0.0002175167173564452i }, { 0.002134468542048344 + -0.00980960546064454i, -8.652156591076036e-05 + -0.0004381625947085126i, 0.00611080882216855 + 0.005490263548488224i, 0.0005245064128579748 + 0.00011555938923911339i, 0.14789027088501158 + 1.5421228532182295e-20i, 0.01021318055904884 + -0.003891689192967347i, -0.016566041712907625 + -0.008052759967119596i, -0.0017174503404688755 + -0.00043477034472506134i }, { 0.0002917902538656101 + -0.0009595749682961887i, 0.0015041674076263613 + -0.008200239602157875i, 0.00024880778649901845 + 0.0007849794555617538i, 0.0051938451733116045 + 0.004724816212360336i, 0.01021318055904884 + 0.0038916891929673472i, 0.12389453508407874 + -1.8124295303922955e-20i, -0.000503510295512859 + -0.0010543207056787338i, -0.013729726262058376 + -0.007400092020231831i }, { -0.02156506700106253 + 0.0008409885251140395i, -0.001395759598421176 + 0.000624852159704737i, 1.365310777874849e-05 + 0.0003992413455011759i, -1.3656056892566294e-05 + 4.927439994214958e-05i, -0.016566041712907625 + 0.008052759967119596i, -0.0005035102955128591 + 0.0010543207056787338i, 0.12903357893383813 + 2.7899798337851533e-21i, 0.009067217653872375 + -0.0036946920374496743i }, { -0.0016193481598015896 + -0.0005372109554143132i, -0.018146048028784383 + 0.0007738730954539761i, 4.725863006269618e-06 + -0.0001187384199118511i, -1.0856763627617281e-05 + 0.00021751671735644514i, -0.0017174503404688755 + 0.0004347703447250614i, -0.013729726262058376 + 0.007400092020231832i, 0.009067217653872375 + 0.0036946920374496743i, 0.10864445442091804 + 5.624077793036648e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.14272637333487564, 1.0e-7), DoubleNear(0.12078785760832211, 1.0e-7), DoubleNear(0.12319032354667667, 1.0e-7), DoubleNear(0.1038326061862789, 1.0e-7), DoubleNear(0.14789027088501158, 1.0e-7), DoubleNear(0.12389453508407874, 1.0e-7), DoubleNear(0.12903357893383813, 1.0e-7), DoubleNear(0.10864445442091804, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false, false, false}), Matrix({ { 0.11393422331262025 + 8.085323847198964e-20i, 0.010110743089603195 + -0.004707863053118995i, -0.012996909916532228 + -0.007473272725359615i, -0.0014572905879565487 + -0.00012326812196517662i, 0.09192336014170549 + 0.03417769693896473i, 0.010522535888324414 + 0.0020349404738874005i, -0.008245523167067106 + -0.009912394372893645i, -0.0010601091668975449 + -0.0009001033745781851i }, { 0.010110743089603195 + 0.004707863053118995i, 0.08534180488881482 + -5.545116665963492e-20i, -0.0008755015633684607 + -0.0012624813146222482i, -0.009804006847802178 + -0.005610627696085424i, 0.003686007202503702 + 0.00856028979552962i, 0.07392729084104982 + 0.015127305406830056i, 0.0001366855659974082 + -0.0012772277395622822i, -0.007504666022982173 + -0.006604316641553866i }, { -0.01299690991653223 + 0.007473272725359615i, -0.0008755015633684608 + 0.0012624813146222482i, 0.09888287057369621 + 2.3951874216562624e-19i, 0.008805017694106836 + -0.0040828430718825685i, -0.012739145615133122 + 0.002140087639384382i, -0.0013782198559574156 + 0.0004981875721050504i, 0.07977932710241505 + 0.029661698653164134i, 0.009147157272496785 + 0.001776330878244989i }, { -0.0014572905879565484 + 0.0001232681219651766i, -0.009804006847802178 + 0.005610627696085424i, 0.008805017694106836 + 0.0040828430718825685i, 0.07410488414520813 + -2.4712412474065555e-20i, -0.0009948430747589083 + -0.0007287301043322897i, -0.00948025110851192 + 0.003123084235703978i, 0.0032293954839421697 + 0.007442666620815523i, 0.06419598030302356 + 0.013130851358925473i }, { 0.09192336014170549 + -0.03417769693896473i, 0.003686007202503702 + -0.00856028979552962i, -0.012739145615133122 + -0.002140087639384382i, -0.0009948430747589083 + 0.0007287301043322897i, 0.176682420907267 + -3.859881419255534e-20i, 0.010130798952916516 + -0.003953493652370344i, -0.02018456374406784 + -0.011574419459576622i, -0.001441284650763412 + -0.00017894616699399549i }, { 0.010522535888324414 + -0.0020349404738874005i, 0.07392729084104982 + -0.015127305406830056i, -0.0013782198559574156 + -0.0004981875721050504i, -0.00948025110851192 + -0.003123084235703978i, 0.010130798952916516 + 0.003953493652370344i, 0.15934058780358604 + 7.545380020949869e-20i, -0.0009446481940364702 + -0.0012087878475045423i, -0.0183039178433907 + -0.010491472950471436i }, { -0.008245523167067106 + 0.009912394372893646i, 0.00013668556599740815 + 0.0012772277395622822i, 0.07977932710241505 + -0.029661698653164134i, 0.0032293954839421697 + -0.007442666620815523i, -0.020184563744067845 + 0.011574419459576622i, -0.0009446481940364705 + 0.001208787847504542i, 0.15334103190681858 + -1.2771904916318463e-19i, 0.008830709141674676 + -0.0034446035815467544i }, { -0.0010601091668975449 + 0.0009001033745781851i, -0.007504666022982173 + 0.006604316641553866i, 0.009147157272496785 + -0.001776330878244989i, 0.06419598030302356 + -0.013130851358925473i, -0.0014412846507634123 + 0.00017894616699399554i, -0.0183039178433907 + 0.010491472950471436i, 0.008830709141674678 + 0.0034446035815467553i, 0.1383721764619888 + 1.6502399908187898e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.11393422331262025, 1.0e-7), DoubleNear(0.08534180488881482, 1.0e-7), DoubleNear(0.09888287057369621, 1.0e-7), DoubleNear(0.07410488414520813, 1.0e-7), DoubleNear(0.176682420907267, 1.0e-7), DoubleNear(0.15934058780358604, 1.0e-7), DoubleNear(0.15334103190681858, 1.0e-7), DoubleNear(0.1383721764619888, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true, false, false}), Matrix({ { 0.29061664421988725 + 4.225442427943428e-20i, 0.02024154204251971 + -0.008661356705489339i, -0.03318147366060007 + -0.019047692184936238i, -0.002898575238719961 + -0.0003022142889591721i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020241542042519708 + 0.008661356705489339i, 0.24468239269240086 + 2.0002633549863764e-20i, -0.001820149757404931 + -0.00247126916212679i, -0.028107924691192877 + -0.01610210064655686i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03318147366060008 + 0.019047692184936238i, -0.0018201497574049314 + 0.00247126916212679i, 0.2522239024805148 + 1.1179969300244166e-19i, 0.017635726835781514 + -0.007527446653429323i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002898575238719961 + 0.0003022142889591721i, -0.028107924691192877 + 0.016102100646556858i, 0.017635726835781514 + 0.007527446653429323i, 0.21247706060719695 + 1.4031158660781344e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.29061664421988725, 1.0e-7), DoubleNear(0.24468239269240086, 1.0e-7), DoubleNear(0.2522239024805148, 1.0e-7), DoubleNear(0.21247706060719695, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, true, false}), Matrix({ { 0.1357550492848522 + 1.2674873974348711e-20i, 0.009476445664177189 + -0.004182494644123081i, -0.01549583417574564 + -0.008663300984565293i, -0.0013587592347972487 + -0.00010612691145529068i, -0.040759857367168334 + -0.013419709482392022i, -0.003350392692657371 + 0.0003111437288179985i, 0.003847786250494223 + 0.0043231868488461805i, 0.0004116118780538857 + 0.00017632012438470376i }, { 0.009476445664177189 + 0.004182494644123082i, 0.11446057980849628 + -2.3706831869381273e-20i, -0.0008501766980539146 + -0.0011569294201183708i, -0.013145018871717226 + -0.0073288592181774085i, -0.0023455208838517386 + -0.0022146694863867267i, -0.03436904887149074 + -0.011415807997590795i, 0.00015232408754454346 + 0.00043560929520169045i, 0.003271588839534438 + 0.0036527899748316694i }, { -0.015495834175745644 + 0.008663300984565291i, -0.0008501766980539147 + 0.0011569294201183708i, 0.1177507778344398 + 3.5439811724768166e-20i, 0.008252557636985455 + -0.003641498238261353i, 0.005518752204304634 + -0.0012047613451404288i, 0.00037677181470194987 + -0.0002538060988991204i, -0.035173430985077775 + -0.011469659005106738i, -0.002870569929965124 + 0.0002506693547638453i }, { -0.0013587592347972487 + 0.00010612691145529074i, -0.013145018871717226 + 0.007328859218177407i, 0.008252557636985455 + 0.003641498238261353i, 0.0993400098951025 + 7.394709168706976e-20i, 0.0004079567004245533 + 9.694267586050117e-05i, 0.004671650697805755 + -0.0009923032513938688i, -0.0020485789654956007 + -0.001872885762080243i, -0.02964922817542827 + -0.00974469953232086i }, { -0.040759857367168334 + 0.013419709482392022i, -0.0023455208838517386 + 0.0022146694863867267i, 0.005518752204304634 + 0.0012047613451404283i, 0.00040795670042455327 + -9.694267586050119e-05i, 0.15486159493503504 + 2.957955030508558e-20i, 0.010765096378342519 + -0.004478862061366258i, -0.01768563948485443 + -0.010384391200370945i, -0.0015398160039227123 + -0.00019608737750388143i }, { -0.003350392692657371 + -0.0003111437288179985i, -0.03436904887149074 + 0.011415807997590795i, 0.0003767718147019498 + 0.0002538060988991204i, 0.004671650697805755 + 0.0009923032513938685i, 0.010765096378342519 + 0.004478862061366258i, 0.13022181288390455 + 4.3709465419245037e-20i, -0.0009699730593510166 + -0.0013143397420084196i, -0.014962905819475653 + -0.008773241428379451i }, { 0.003847786250494223 + -0.0043231868488461805i, 0.0001523240875445434 + -0.00043560929520169045i, -0.035173430985077775 + 0.011469659005106738i, -0.0020485789654956007 + 0.001872885762080243i, -0.01768563948485443 + 0.010384391200370945i, -0.0009699730593510166 + 0.0013143397420084194i, 0.134473124646075 + 7.635988127767349e-20i, 0.00938316919879606 + -0.003885948415167971i }, { 0.00041161187805388577 + -0.00017632012438470373i, 0.0032715888395344382 + -0.00365278997483167i, -0.002870569929965124 + -0.0002506693547638452i, -0.02964922817542827 + 0.00974469953232086i, -0.0015398160039227123 + 0.00019608737750388138i, -0.014962905819475653 + 0.008773241428379451i, 0.00938316919879606 + 0.003885948415167971i, 0.11313705071209444 + 6.636449492074367e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1357550492848522, 1.0e-7), DoubleNear(0.11446057980849628, 1.0e-7), DoubleNear(0.1177507778344398, 1.0e-7), DoubleNear(0.0993400098951025, 1.0e-7), DoubleNear(0.15486159493503504, 1.0e-7), DoubleNear(0.13022181288390455, 1.0e-7), DoubleNear(0.134473124646075, 1.0e-7), DoubleNear(0.11313705071209444, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false, true}), Matrix({ { 0.12618675187831108 + -3.8201812244534635e-20i, 0.008794780886549818 + -0.003791453193130869i, -0.014407726159208368 + -0.008271375562361884i, -0.0012607040103320153 + -0.00012811834173339563i, 2.4284408002157382e-05 + 4.013587451616305e-05i, 1.0256013467856582e-05 + 1.8499558708796228e-06i, 5.5829431788018315e-05 + -5.835152701893343e-05i, 4.042187995877469e-06 + -3.334312548338297e-06i }, { 0.008794780886549817 + 0.003791453193130869i, 0.10627163019406863 + -4.177285732483362e-21i, -0.0007897622472867257 + -0.0010767815701331058i, -0.012208397900510384 + -0.006993634116219151i, -6.446811615631709e-06 + 8.752933694883405e-06i, 2.2142440950700005e-05 + 4.1455770133301886e-05i, -8.694953194062277e-06 + -4.753409012348802e-06i, 3.6833991558237425e-05 + -4.5798633635580824e-05i }, { -0.01440772615920837 + 0.008271375562361884i, -0.0007897622472867257 + 0.0010767815701331058i, 0.10951686307150499 + 3.566071340277172e-20i, 0.007662481193075081 + -0.003294531761335653i, -8.384951009712325e-05 + 1.445482512851988e-05i, -5.132907825613298e-06 + -5.507605436634093e-06i, -2.428440800215901e-05 + -4.013587451616587e-05i, -1.0256013467856768e-05 + -1.8499558708797922e-06i }, { -0.0012607040103320153 + 0.0001281183417333956i, -0.012208397900510384 + 0.006993634116219151i, 0.007662481193075081 + 0.003294531761335653i, 0.09228395123124578 + 5.3530189799847194e-20i, 2.148588421800642e-06 + 1.766420654341048e-06i, -6.068880726071906e-05 + 9.91703267726141e-06i, 6.446811615631672e-06 + -8.752933694883649e-06i, -2.214244095070136e-05 + -4.145577013330422e-05i }, { 2.4284408002157382e-05 + -4.0135874516163106e-05i, -6.446811615631716e-06 + -8.752933694883396e-06i, -8.38495100971232e-05 + -1.4454825128519846e-05i, 2.1485884218006468e-06 + -1.7664206543410497e-06i, 0.16442989234157618 + 8.045623652396892e-20i, 0.011446761155969891 + -0.00486990351235847i, -0.018773747501391703 + -0.010776316622574354i, -0.0016378712283879457 + -0.00017409594722577647i }, { 1.0256013467856582e-05 + -1.8499558708796364e-06i, 2.2142440950700018e-05 + -4.145577013330194e-05i, -5.132907825613301e-06 + 5.507605436634103e-06i, -6.068880726071909e-05 + -9.917032677261452e-06i, 0.011446761155969891 + 0.004869903512358471i, 0.13841076249833223 + 2.4179919282347126e-20i, -0.0010303875101182053 + -0.0013944875919936846i, -0.015899526790682492 + -0.00910846653033771i }, { 5.582943178801834e-05 + 5.8351527018933496e-05i, -8.69495319406227e-06 + 4.753409012348802e-06i, -2.428440800215901e-05 + 4.013587451616579e-05i, 6.446811615631665e-06 + 8.75293369488365e-06i, -0.018773747501391706 + 0.010776316622574353i, -0.0010303875101182057 + 0.0013944875919936846i, 0.1427070394090098 + 7.613897959966993e-20i, 0.009973245642706434 + -0.004232914892093671i }, { 4.042187995877466e-06 + 3.3343125483383005e-06i, 3.683399155823746e-05 + 4.579863363558084e-05i, -1.0256013467856772e-05 + 1.849955870879799e-06i, -2.21424409507014e-05 + 4.145577013330419e-05i, -0.0016378712283879457 + 0.00017409594722577653i, -0.015899526790682492 + 0.009108466530337709i, 0.009973245642706434 + 0.004232914892093671i, 0.12019310937595117 + 8.678139680796624e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12618675187831108, 1.0e-7), DoubleNear(0.10627163019406863, 1.0e-7), DoubleNear(0.10951686307150499, 1.0e-7), DoubleNear(0.09228395123124578, 1.0e-7), DoubleNear(0.16442989234157618, 1.0e-7), DoubleNear(0.13841076249833223, 1.0e-7), DoubleNear(0.1427070394090098, 1.0e-7), DoubleNear(0.12019310937595117, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false, false, false}), Matrix({ { 0.302102559435382 + 9.304196558532208e-20i, 0.021079523152997486 + -0.00900942083021046i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01397191854854185 + -0.1075664414227299i, -0.004182793819698251 + -0.007088885319109042i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.021079523152997486 + 0.00900942083021046i, 0.2544191692226556 + 8.911166384474291e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.002232983258104651 + -0.007922237371766259i, -0.01176661302112194 + -0.09058832442252789i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01397191854854185 + 0.1075664414227299i, 0.0022329832581046505 + 0.007922237371766259i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24073798726502008 + 6.101215169655384e-20i, 0.016797745725303733 + -0.007179382528708203i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004182793819698251 + 0.007088885319109043i, -0.01176661302112194 + 0.09058832442252789i, 0.0 + 0.0i, 0.0 + 0.0i, 0.016797745725303733 + 0.007179382528708203i, 0.20274028407694217 + 7.120255631293429e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.302102559435382, 1.0e-7), DoubleNear(0.2544191692226556, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24073798726502008, 1.0e-7), DoubleNear(0.20274028407694217, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false, false, false}), Matrix({ { 0.2659166968815523 + 1.3584290891590847e-19i, 0.018596870665380006 + -0.00860242212850164i, 0.0 + 0.0i, 0.0 + 0.0i, 0.002148121649827093 + 0.009410364115143365i, 0.00029651611687187983 + 0.0010783133882080395i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.018596870665380006 + 0.008602422128501642i, 0.22462046379460102 + 1.221977375312337e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00010017762280332661 + 0.00038888819476636297i, 0.001493310643998744 + 0.007982722884801431i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0021481216498270925 + -0.009410364115143366i, -0.00010017762280332664 + -0.00038888819476636297i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2769238498188497 + 1.8211208365967457e-20i, 0.019280398212921216 + -0.007586381230417022i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0002965161168718797 + -0.00107831338820804i, 0.0014933106439987442 + -0.007982722884801431i, 0.0 + 0.0i, 0.0 + 0.0i, 0.019280398212921213 + 0.007586381230417022i, 0.2325389895049968 + 3.8116482626443515e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2659166968815523, 1.0e-7), DoubleNear(0.22462046379460102, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2769238498188497, 1.0e-7), DoubleNear(0.2325389895049968, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false, false, false}), Matrix({ { 0.21281709388631642 + 3.2037198063761587e-19i, 0.01891576078371003 + -0.008790706125001563i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17170268724412052 + 0.06383939559212887i, 0.0196696931608212 + 0.0038112713521323894i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01891576078371003 + 0.008790706125001563i, 0.15944668903402295 + -8.016357913370049e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006915402686445872 + 0.016002956416345145i, 0.13812327114407336 + 0.028258156765755528i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.17170268724412052 + -0.06383939559212887i, 0.006915402686445872 + -0.016002956416345145i, 0.0 + 0.0i, 0.0 + 0.0i, 0.33002345281408557 + -1.6631786335573997e-19i, 0.01896150809459119 + -0.0073980972339170985i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0196696931608212 + -0.00381127135213239i, 0.13812327114407336 + -0.028258156765755528i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01896150809459119 + 0.007398097233917099i, 0.2977127642655748 + 2.404777992913777e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21281709388631642, 1.0e-7), DoubleNear(0.15944668903402295, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.33002345281408557, 1.0e-7), DoubleNear(0.2977127642655748, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true, false, false}), Matrix({ { 0.542840546700402 + 1.540541172818759e-19i, 0.03787726887830122 + -0.01618880335891866i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03787726887830122 + 0.01618880335891866i, 0.45715945329959784 + 1.6031422015767719e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.542840546700402, 1.0e-7), DoubleNear(0.45715945329959784, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, true, false}), Matrix({ { 0.253505827119292 + 4.8114685699116865e-20i, 0.017729003301162644 + -0.007823992882384435i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07593328835224611 + -0.02488936848749876i, -0.006220962622622495 + 0.0005618130835818438i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.017729003301162644 + 0.007823992882384435i, 0.21380058970359878 + 5.0240259817688494e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004394099849347338 + -0.004087555248466971i, -0.06401827704691901 + -0.02116050752991165i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07593328835224611 + 0.02488936848749876i, -0.004394099849347339 + 0.00408755524846697i, 0.0 + 0.0i, 0.0 + 0.0i, 0.28933471958111 + 1.0593943158275905e-19i, 0.02014826557713858 + -0.008364810476534229i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006220962622622495 + -0.0005618130835818438i, -0.06401827704691901 + 0.02116050752991165i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02014826557713858 + 0.008364810476534229i, 0.243358863595999 + 1.1007396033998872e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.253505827119292, 1.0e-7), DoubleNear(0.21380058970359878, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28933471958111, 1.0e-7), DoubleNear(0.243358863595999, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false, true}), Matrix({ { 0.23570361494981606 + -2.541098841762925e-21i, 0.016457262079624897 + -0.0070859849544665215i, 0.0 + 0.0i, 0.0 + 0.0i, -1.6263032587282567e-18 + -2.927345865710862e-18i, -1.8973538018496328e-19 + -1.7618285302889447e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.016457262079624897 + 0.0070859849544665215i, 0.1985555814253144 + 4.935290406736383e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -4.0657581468206416e-20 + -2.473336205982557e-19i, -1.3552527156068805e-18 + -2.3852447794681098e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.734723475976807e-18 + 2.8189256484623115e-18i, -5.421010862427522e-20 + 2.473336205982557e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.307136931750586 + 1.5659521612363882e-19i, 0.021420006798676325 + -0.00910281840445214i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.7618285302889447e-19 + 1.4907779871675686e-19i, -1.328147661294743e-18 + 2.3852447794681098e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.021420006798676325 + 0.00910281840445214i, 0.2586038718742834 + 1.1096131609031337e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.23570361494981606, 1.0e-7), DoubleNear(0.1985555814253144, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.307136931750586, 1.0e-7), DoubleNear(0.2586038718742834, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false, false, false}), Matrix({ { 0.1479884198275569 + 7.291940876496534e-20i, 0.010349562610327233 + -0.004787434833599889i, -0.006844305297586551 + -0.05269266080490839i, -0.002183267085293145 + -0.0034636448386229047i, 0.0011954763739295297 + 0.00523707210466115i, 0.00016501766193650723 + 0.0006001048308406439i, 0.0018094190008552976 + -0.0006678694963882653i, 0.00020604104751314968 + -8.651028489247621e-05i }, { 0.010349562610327233 + 0.004787434833599889i, 0.12500616880294152 + 6.288126307509166e-20i, 0.0012259547998574693 + -0.003906472265682933i, -0.005781400898569862 + -0.04450961540727237i, -5.575102381536015e-05 + 0.00021642473040607997i, 0.0008310598210216284 + 0.004442558739247769i, 7.963847408101095e-05 + 9.841262311464138e-06i, 0.0015433789608915317 + -0.0005013701859781415i }, { -0.006844305297586553 + 0.05269266080490839i, 0.0012259547998574693 + 0.003906472265682933i, 0.1179282770539954 + 6.292350015094313e-20i, 0.008247308055052773 + -0.003814987294901752i, -0.0019199979946544034 + 0.0001834515886689678i, -0.00022130482638319166 + 3.100187852370868e-05i, 0.0009526452758975633 + 0.004173292010482214i, 0.00013149845493537257 + 0.0004782085573673959i }, { -0.002183267085293145 + 0.0034636448386229047i, -0.0057814008985698625 + 0.04450961540727237i, 0.008247308055052773 + 0.003814987294901752i, 0.0996142949916595 + 5.931647445614202e-20i, -7.448162426681639e-05 + -2.9860084467591327e-05i, -0.0016202502071992848 + 9.044305601346293e-05i, -4.442659898796646e-05 + 0.000172463464360283i, 0.0006622508229771158 + 0.0035401641455536604i }, { 0.0011954763739295293 + -0.005237072104661151i, -5.5751023815360175e-05 + -0.00021642473040608i, -0.001919997994654403 + -0.0001834515886689677i, -7.44816242668164e-05 + 2.9860084467591344e-05i, 0.15411413960782505 + 2.012255682035674e-20i, 0.010729960542670254 + -0.004221985996610571i, -0.007127613250955299 + -0.0548737806178215i, -0.001999526734405106 + -0.0036252404804861375i }, { 0.0001650176619365072 + -0.0006001048308406441i, 0.0008310598210216284 + -0.004442558739247769i, -0.0002213048263831917 + -3.1001878523708666e-05i, -0.0016202502071992848 + -9.044305601346302e-05i, 0.010729960542670254 + 0.004221985996610571i, 0.12941300041971407 + 2.6230400769651267e-20i, 0.0010070284582471816 + -0.004015765106083324i, -0.005985212122552077 + -0.0460787090152555i }, { 0.0018094190008552974 + 0.0006678694963882653i, 7.963847408101098e-05 + -9.841262311464153e-06i, 0.0009526452758975632 + -0.004173292010482215i, -4.442659898796647e-05 + -0.00017246346436028306i, -0.007127613250955299 + 0.0548737806178215i, 0.0010070284582471816 + 0.004015765106083324i, 0.12280971021102466 + -1.9113484543892925e-21i, 0.00855043767025096 + -0.00336439523380645i }, { 0.0002060410475131497 + 8.651028489247617e-05i, 0.0015433789608915315 + 0.0005013701859781415i, 0.00013149845493537252 + -0.0004782085573673959i, 0.0006622508229771158 + -0.0035401641455536613i, -0.001999526734405106 + 0.003625240480486137i, -0.005985212122552078 + 0.0460787090152555i, 0.00855043767025096 + 0.00336439523380645i, 0.1031259890852827 + 1.188608185679226e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1479884198275569, 1.0e-7), DoubleNear(0.12500616880294152, 1.0e-7), DoubleNear(0.1179282770539954, 1.0e-7), DoubleNear(0.0996142949916595, 1.0e-7), DoubleNear(0.15411413960782505, 1.0e-7), DoubleNear(0.12941300041971407, 1.0e-7), DoubleNear(0.12280971021102466, 1.0e-7), DoubleNear(0.1031259890852827, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false, false, false}), Matrix({ { 0.11843733697759273 + 2.103705847385919e-19i, 0.010527031890232224 + -0.00489221896881067i, -0.0054775994895570595 + -0.042170721406911284i, -0.0022287842199098873 + -0.003521988281762981i, 0.09555627632032836 + 0.03552801079141586i, 0.010946611640033393 + 0.002121055321273574i, 0.008230705449032174 + -0.035666838084696506i, 0.00024895256396913624 + -0.003995739970548008i }, { 0.010527031890232222 + 0.00489221896881067i, 0.08873554701001503 + -2.8646560098928555e-20i, 0.0012550564077184296 + -0.0039745080159989616i, -0.0041039236393805665 + -0.031595121330338455i, 0.0038485718574272944 + 0.008905992968463635i, 0.07686860162500256 + 0.01572627825196809i, 0.0029930697711507133 + -0.0017822125989884019i, 0.0020443982622899096 + -0.02809710791135082i }, { -0.0054775994895570595 + 0.042170721406911284i, 0.0012550564077184296 + 0.0039745080159989616i, 0.09437975690872372 + 1.10001395899024e-19i, 0.008388728893477807 + -0.0038984871561908944i, -0.017069455521489987 + 0.03238057348702397i, -0.0012614906007399292 + 0.003799546914513179i, 0.07614641092379218 + 0.028311384800713i, 0.008723081520787804 + 0.0016902160308588153i }, { -0.0022287842199098873 + 0.003521988281762982i, -0.0041039236393805665 + 0.031595121330338455i, 0.008388728893477807 + 0.0038984871561908944i, 0.07071114202400793 + -5.151701903477194e-20i, -0.0033490543918747633 + 0.000958427401128295i, -0.009154578611983839 + 0.026642460991319006i, 0.0030668308290185777 + 0.007096963447881509i, 0.061254669519070805 + 0.01253187851378744i }, { 0.09555627632032836 + -0.03552801079141586i, 0.0038485718574272944 + -0.008905992968463635i, -0.017069455521489987 + -0.03238057348702397i, -0.0033490543918747624 + -0.000958427401128295i, 0.1836652224577892 + -1.1732861915326983e-19i, 0.010552491262765265 + -0.004117201861399791i, -0.008494319058984791 + -0.06539572001581861i, -0.001954009599788363 + -0.0035668970373460606i }, { 0.010946611640033393 + -0.002121055321273574i, 0.07686860162500256 + -0.01572627825196809i, -0.001261490600739929 + -0.0037995469145131787i, -0.009154578611983839 + -0.026642460991319006i, 0.010552491262765265 + 0.004117201861399791i, 0.16568362221264057 + 1.1775822394367148e-19i, 0.0009779268503862211 + -0.003947729355767296i, -0.007662689381741373 + -0.058993203092189424i }, { 0.008230705449032174 + 0.035666838084696506i, 0.0029930697711507133 + 0.0017822125989884019i, 0.07614641092379218 + -0.028311384800713i, 0.0030668308290185777 + -0.007096963447881509i, -0.008494319058984791 + 0.06539572001581861i, 0.0009779268503862211 + 0.003947729355767296i, 0.14635823035629636 + -4.8989244202470145e-20i, 0.00840901683182593 + -0.0032808953725173076i }, { 0.00024895256396913624 + 0.003995739970548008i, 0.0020443982622899096 + 0.02809710791135082i, 0.008723081520787804 + -0.0016902160308588155i, 0.061254669519070805 + -0.01253187851378744i, -0.001954009599788363 + 0.0035668970373460606i, -0.007662689381741374 + 0.058993203092189424i, 0.00840901683182593 + 0.0032808953725173085i, 0.13202914205293426 + 1.227195753477062e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.11843733697759273, 1.0e-7), DoubleNear(0.08873554701001503, 1.0e-7), DoubleNear(0.09437975690872372, 1.0e-7), DoubleNear(0.07071114202400793, 1.0e-7), DoubleNear(0.1836652224577892, 1.0e-7), DoubleNear(0.16568362221264057, 1.0e-7), DoubleNear(0.14635823035629636, 1.0e-7), DoubleNear(0.13202914205293426, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true, false, false}), Matrix({ { 0.302102559435382 + 9.304196558532208e-20i, 0.021079523152997486 + -0.00900942083021046i, -0.01397191854854185 + -0.1075664414227299i, -0.004182793819698251 + -0.007088885319109042i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.021079523152997486 + 0.00900942083021046i, 0.2544191692226556 + 8.911166384474291e-20i, 0.002232983258104651 + -0.007922237371766259i, -0.01176661302112194 + -0.09058832442252789i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01397191854854185 + 0.1075664414227299i, 0.0022329832581046505 + 0.007922237371766259i, 0.24073798726502008 + 6.101215169655384e-20i, 0.016797745725303733 + -0.007179382528708203i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004182793819698251 + 0.007088885319109043i, -0.01176661302112194 + 0.09058832442252789i, 0.016797745725303733 + 0.007179382528708203i, 0.20274028407694217 + 7.120255631293429e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.302102559435382, 1.0e-7), DoubleNear(0.2544191692226556, 1.0e-7), DoubleNear(0.24073798726502008, 1.0e-7), DoubleNear(0.20274028407694217, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, true, false}), Matrix({ { 0.14108150113331402 + 2.995508334986687e-20i, 0.00986657556454709 + -0.004354222043912768i, -0.006524867734403628 + -0.05023338781323171i, -0.0020066799887494997 + -0.00331170841000761i, -0.04225852489648124 + -0.013851474375869696i, -0.00346210087265891 + 0.00031266118845767036i, -0.002977535645233984 + 0.015687158769864252i, 0.0002714443828820301 + 0.0012182531480298398i }, { 0.00986657556454709 + 0.004354222043912769i, 0.11898467376995464 + 3.278420178833755e-20i, 0.001094042966418203 + -0.0037144645856157636i, -0.005502913227698814 + -0.04236560579029466i, -0.002445412044054804 + -0.0022748133128620727i, -0.03562756220786054 + -0.011776282229827857i, -0.0006968708754468457 + 0.0009759194965535167i, -0.002545318969948851 + 0.013230167089137818i }, { -0.006524867734403628 + 0.05023338781323171i, 0.0010940429664182032 + 0.0037144645856157636i, 0.11242432598597796 + 1.8159602349250003e-20i, 0.007862427736615553 + -0.0034697708384716663i, 0.0068863583241193255 + -0.014405927176735289i, 4.879250283010506e-05 + -0.0012471736356058829i, -0.03367476345576487 + -0.01103789411162906i, -0.0027588617499635848 + 0.00024915189512417343i }, { -0.0020066799887494997 + 0.0033117084100076103i, -0.005502913227698814 + 0.042365605790294664i, 0.007862427736615553 + 0.0034697708384716667i, 0.09481591593364413 + 1.7456058029350938e-20i, 0.0009230662308322084 + -0.0007655041569426925i, 0.005840791859564067 + -0.012140886306960339i, -0.001948687805292535 + -0.001812741935604897i, -0.028390714839058466 + -0.009384225300083798i }, { -0.04225852489648124 + 0.013851474375869697i, -0.002445412044054804 + 0.0022748133128620727i, 0.0068863583241193255 + 0.014405927176735289i, 0.0009230662308322084 + 0.0007655041569426925i, 0.16102105830206795 + 6.30868822354552e-20i, 0.011212947588450397 + -0.004655198786297692i, -0.0074470508141382214 + -0.05733305360949819i, -0.002176113830948751 + -0.0037771769091014323i }, { -0.00346210087265891 + -0.00031266118845767036i, -0.03562756220786054 + 0.011776282229827855i, 4.8792502830105065e-05 + 0.0012471736356058829i, 0.005840791859564067 + 0.012140886306960339i, 0.011212947588450395 + 0.004655198786297692i, 0.13543449545270095 + 5.632746205640536e-20i, 0.0011389402916864477 + -0.004207772786150494i, -0.006263699793423125 + -0.04822271863223322i }, { -0.002977535645233984 + -0.015687158769864252i, -0.0006968708754468455 + -0.0009759194965535167i, -0.03367476345576487 + 0.01103789411162906i, -0.001948687805292535 + 0.001812741935604897i, -0.0074470508141382214 + 0.05733305360949819i, 0.0011389402916864477 + 0.004207772786150494i, 0.1283136612790421 + 4.2852549347303834e-20i, 0.008935317988688182 + -0.003709611690236536i }, { 0.0002714443828820301 + -0.0012182531480298398i, -0.002545318969948851 + -0.013230167089137818i, -0.0027588617499635843 + -0.00024915189512417343i, -0.028390714839058466 + 0.009384225300083798i, -0.002176113830948751 + 0.0037771769091014323i, -0.006263699793423127 + 0.04822271863223322i, 0.008935317988688182 + 0.003709611690236536i, 0.10792436814329805 + 5.3746498283583346e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.14108150113331402, 1.0e-7), DoubleNear(0.11898467376995464, 1.0e-7), DoubleNear(0.11242432598597796, 1.0e-7), DoubleNear(0.09481591593364413, 1.0e-7), DoubleNear(0.16102105830206795, 1.0e-7), DoubleNear(0.13543449545270095, 1.0e-7), DoubleNear(0.1283136612790421, 1.0e-7), DoubleNear(0.10792436814329805, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false, true}), Matrix({ { 0.13117418324282012 + 2.3293446853632513e-22i, 0.009158823941531221 + -0.003943504596104554i, -0.00606666493446972 + -0.04670579462926161i, -0.0018277074490219898 + -0.003078702066389413i, -8.944667923005412e-19 + -1.5178830414797062e-18i, -1.0842021724855044e-19 + -1.0842021724855044e-19i, -5.149960319306146e-19 + 4.0657581468206416e-19i, -2.710505431213761e-20 + 4.2351647362715017e-20i }, { 0.00915882394153122 + 0.003943504596104555i, 0.11050049540951773 + 2.897048348869973e-20i, 0.0009805359298486775 + -0.0034434677612948114i, -0.005110529100848405 + -0.039344734744602206i, -2.371692252312041e-20 + -1.3213713977167085e-19i, -7.860465750519907e-19 + -1.3010426069826053e-18i, -4.828087799349512e-20 + 1.5246593050577406e-20i, -4.2012834183813297e-19 + 3.5236570605778894e-19i }, { -0.00606666493446972 + 0.04670579462926161i, 0.000980535929848677 + 0.0034434677612948114i, 0.10452943170699594 + -2.7740333102992502e-21i, 0.007298438138093677 + -0.0031424803583619673i, 5.827586677109586e-19 + -2.168404344971009e-19i, 3.7269449679189215e-20 + -3.5575383784680614e-20i, -7.318364664277155e-19 + -1.2739375526704677e-18i, -8.131516293641283e-20 + -8.131516293641283e-20i }, { -0.0018277074490219898 + 0.003078702066389413i, -0.005110529100848406 + 0.039344734744602206i, 0.007298438138093677 + 0.0031424803583619673i, 0.08805508601579667 + 2.0382420578664104e-20i, 5.082197683525802e-20 + 0.0i, 5.014435047745458e-19 + -2.168404344971009e-19i, -1.6940658945086007e-20 + -1.1011428314305904e-19i, -5.692061405548898e-19 + -1.0299920638612292e-18i }, { -9.75781955236954e-19 + 1.5178830414797062e-18i, -3.049318610115481e-20 + 1.3383120566617945e-19i, 5.692061405548898e-19 + 2.303929616531697e-19i, 5.082197683525802e-20 + 2.541098841762901e-21i, 0.17092837619256185 + 9.280903111678576e-20i, 0.011920699211466266 + -0.005065916234105906i, -0.007905253614072131 + -0.060860646793468295i, -0.0023550863706762607 + -0.004010183252719629i }, { -9.486769009248164e-20 + 8.131516293641283e-20i, -7.724940478959219e-19 + 1.3010426069826053e-18i, 3.7269449679189215e-20 + 3.218725199566341e-20i, 5.149960319306146e-19 + 2.202285662861181e-19i, 0.011920699211466266 + 0.005065916234105906i, 0.14391867381313786 + 6.014118035604318e-20i, 0.0012524473282559735 + -0.0044787696104714465i, -0.006656083920273534 + -0.05124358967792568i }, { -5.149960319306146e-19 + -4.2012834183813297e-19i, -5.039846036163087e-20 + -1.8634724839594607e-20i, -7.318364664277155e-19 + 1.1926223897340549e-18i, -2.0328790734103208e-20 + 1.1180834903756764e-19i, -0.007905253614072131 + 0.060860646793468295i, 0.0012524473282559735 + 0.0044787696104714465i, 0.13620855555802414 + 6.378618500685309e-20i, 0.009499307587210057 + -0.004036902170346236i }, { -2.371692252312041e-20 + -4.0657581468206416e-20i, -4.2012834183813297e-19 + -3.5236570605778894e-19i, -8.809142651444724e-20 + 6.776263578034403e-20i, -6.098637220230962e-19 + 1.0299920638612292e-18i, -0.0023550863706762607 + 0.00401018325271963i, -0.006656083920273535 + 0.05124358967792568i, 0.009499307587210057 + 0.004036902170346236i, 0.11468519806114551 + 5.082013573427018e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.13117418324282012, 1.0e-7), DoubleNear(0.11050049540951773, 1.0e-7), DoubleNear(0.10452943170699594, 1.0e-7), DoubleNear(0.08805508601579667, 1.0e-7), DoubleNear(0.17092837619256185, 1.0e-7), DoubleNear(0.14391867381313786, 1.0e-7), DoubleNear(0.13620855555802414, 1.0e-7), DoubleNear(0.11468519806114551, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false, false, false}), Matrix({ { 0.10417134335417073 + 2.4723294882828587e-19i, 0.009214843016418929 + -0.004556716352161249i, 0.0008578602774966406 + 0.003698851700386902i, 0.00020201015570451729 + 0.0004781448341079534i, 0.08409312769377646 + 0.03117069586524284i, 0.00969403376408692 + 0.0015870825332591322i, -0.0004369564159698413 + 0.00325050608053815i, -7.179452557060166e-05 + 0.0005204457950798084i }, { 0.009214843016418929 + 0.004556716352161249i, 0.07835941713498232 + -4.387479060604528e-20i, -2.6376010080293018e-05 + 0.0002653167051113111i, 0.0005042764844179423 + 0.002776925218217874i, 0.003312572368898075 + 0.007969799368041704i, 0.06786799073302463 + 0.013930637525726732i, -0.0002275413271962815 + 0.00013810225134553523i, -3.418652329283592e-05 + 0.0024683459032177786i }, { 0.0008578602774966405 + -0.0036988517003869025i, -2.637601008029305e-05 + -0.0002653167051113111i, 0.10864575053214573 + 7.313903180933003e-20i, 0.0097009177672911 + -0.004233989772840316i, 0.0017978670193811168 + -0.0027053806663163067i, 0.00016331258452086155 + -0.0001822680404933742i, 0.08760955955034408 + 0.03266869972688603i, 0.009975659396734279 + 0.002224188818873257i }, { 0.00020201015570451729 + -0.00047814483410795345i, 0.0005042764844179423 + -0.002776925218217874i, 0.009700917767291102 + 0.004233989772840316i, 0.08108727189904064 + -3.6288788527655205e-20i, 0.00032207398433973725 + -0.00019496029264596615i, 0.0009259547693492473 + -0.002352027447699926i, 0.003602830317547797 + 0.00803315704830344i, 0.07025528041104873 + 0.014327519240028798i }, { 0.08409312769377646 + -0.03117069586524284i, 0.003312572368898075 + -0.007969799368041706i, 0.0017978670193811168 + 0.0027053806663163062i, 0.00032207398433973725 + 0.0001949602926459661i, 0.16174535352738156 + -1.1139003991237738e-19i, 0.009382027648961077 + -0.004045705776340393i, 0.0012902613723304523 + 0.005711512414756463i, 9.450596116736249e-05 + 0.0006001685541000862i }, { 0.00969403376408692 + -0.0015870825332591322i, 0.06786799073302463 + -0.013930637525726732i, 0.00016331258452086155 + 0.00018226804049337414i, 0.0009259547693492475 + 0.002352027447699926i, 0.009382027648961077 + 0.004045705776340393i, 0.1462610466596187 + 1.6607252813727897e-19i, -7.380161272303359e-05 + 0.00012357148965505186i, 0.0009890341595808017 + 0.005205797666583556i }, { -0.0004369564159698414 + -0.00325050608053815i, -0.00022754132719628157 + -0.0001381022513455352i, 0.08760955955034408 + -0.03266869972688603i, 0.003602830317547797 + -0.008033157048303438i, 0.0012902613723304519 + -0.005711512414756464i, -7.38016127230336e-05 + -0.0001235714896550519i, 0.168278099286704 + -5.492782344336258e-20i, 0.009579480445630116 + -0.0033523914575767054i }, { -7.179452557060169e-05 + -0.0005204457950798084i, -3.418652329283586e-05 + -0.0024683459032177786i, 0.009975659396734279 + -0.0022241888188732576i, 0.07025528041104873 + -0.014327519240028798i, 9.450596116736245e-05 + -0.0006001685541000864i, 0.0009890341595808019 + -0.005205797666583556i, 0.009579480445630116 + 0.0033523914575767063i, 0.15145171760595616 + 7.440527115409873e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.10417134335417073, 1.0e-7), DoubleNear(0.07835941713498232, 1.0e-7), DoubleNear(0.10864575053214573, 1.0e-7), DoubleNear(0.08108727189904064, 1.0e-7), DoubleNear(0.16174535352738156, 1.0e-7), DoubleNear(0.1462610466596187, 1.0e-7), DoubleNear(0.168278099286704, 1.0e-7), DoubleNear(0.15145171760595616, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true, false, false}), Matrix({ { 0.2659166968815523 + 1.3584290891590847e-19i, 0.018596870665380006 + -0.00860242212850164i, 0.002148121649827093 + 0.009410364115143365i, 0.00029651611687187983 + 0.0010783133882080395i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.018596870665380006 + 0.008602422128501642i, 0.22462046379460102 + 1.221977375312337e-19i, -0.00010017762280332661 + 0.00038888819476636297i, 0.001493310643998744 + 0.007982722884801431i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0021481216498270925 + -0.009410364115143366i, -0.00010017762280332664 + -0.00038888819476636297i, 0.2769238498188497 + 1.8211208365967457e-20i, 0.019280398212921216 + -0.007586381230417022i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0002965161168718797 + -0.00107831338820804i, 0.0014933106439987442 + -0.007982722884801431i, 0.019280398212921213 + 0.007586381230417022i, 0.2325389895049968 + 3.8116482626443515e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2659166968815523, 1.0e-7), DoubleNear(0.22462046379460102, 1.0e-7), DoubleNear(0.2769238498188497, 1.0e-7), DoubleNear(0.2325389895049968, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, true, false}), Matrix({ { 0.12433525152905181 + 6.080172387238836e-20i, 0.008719898440139477 + -0.0041436276406809835i, 0.000914811769840507 + 0.004362373260798596i, 0.00013676231094799052 + 0.00048397809841936227i, -0.03780314989814842 + -0.012766395520310723i, -0.003111447894874715 + 0.00036171340177019225i, -3.8223040028358615e-05 + -0.0016562177499069898i, 1.2535061259391283e-05 + -0.00015712319157102495i }, { 0.008719898440139477 + 0.004143627640680984i, 0.10517831923607737 + 4.245876274845742e-20i, -5.273119277232753e-05 + 0.00017684883755746648i, 0.0006311206664631378 + 0.003682264297275057i, -0.00212727964342234 + -0.0021363259144353735i, -0.03189380599058289 + -0.010833344542146125i, -3.1913564016603174e-05 + -8.210404984888042e-05i, -2.0494997132425563e-05 + -0.0013756863142274176i }, { 0.0009148117698405071 + -0.004362373260798597i, -5.2731192772327534e-05 + -0.00017684883755746654i, 0.12917057559024017 + -1.2687038173271503e-20i, 0.009009104861023166 + -0.0036803652417034503i, -0.0009573783461226364 + 0.0012086539230379573i, -5.3665941370073454e-05 + 1.9589099659339234e-05i, -0.03813013845409769 + -0.012122972967188034i, -0.0031095147277477803 + 0.00020009968181165154i }, { 0.00013676231094799046 + -0.0004839780984193623i, 0.0006311206664631379 + -0.003682264297275057i, 0.009009104861023166 + 0.0036803652417034503i, 0.10862227046752143 + 7.781497069231076e-21i, -7.958001243445479e-05 + 0.00013863332140495022i, -0.0007707121181660943 + 0.0010005237554388687i, -0.0022668202059249985 + -0.0019512293340315965i, -0.03212447105633612 + -0.01032716298776553i }, { -0.03780314989814842 + 0.012766395520310725i, -0.0021272796434223403 + 0.0021363259144353735i, -0.0009573783461226362 + -0.001208653923037957i, -7.958001243445481e-05 + -0.00013863332140495017i, 0.1415814453525005 + 7.504118504352009e-20i, 0.009876972225240529 + -0.004458794487820657i, 0.001233309879986586 + 0.005047990854344769i, 0.0001597538059238893 + 0.0005943352897886774i }, { -0.0031114478948747145 + -0.00036171340177019225i, -0.03189380599058289 + 0.010833344542146125i, -5.366594137007346e-05 + -1.958909965933924e-05i, -0.0007707121181660943 + -0.0010005237554388687i, 0.009876972225240529 + 0.004458794487820657i, 0.11944214455852364 + 7.973897478277627e-20i, -4.744643003099908e-05 + 0.0002120393572088965i, 0.0008621899775356062 + 0.004300458587526373i }, { -3.822304002835855e-05 + 0.00165621774990699i, -3.191356401660317e-05 + 8.210404984888042e-05i, -0.03813013845409769 + 0.012122972967188034i, -0.002266820205924999 + 0.0019512293340315965i, 0.0012333098799865855 + -0.005047990854344769i, -4.744643003099911e-05 + -0.0002120393572088965i, 0.14775327422860957 + 3.089824653923896e-20i, 0.01027129335189805 + -0.0039060159887135707i }, { 1.2535061259391322e-05 + 0.00015712319157102497i, -2.0494997132425698e-05 + 0.0013756863142274178i, -0.0031095147277477803 + -0.0002000996818116515i, -0.03212447105633612 + 0.01032716298776553i, 0.00015975380592388926 + -0.0005943352897886775i, 0.0008621899775356062 + -0.004300458587526373i, 0.010271293351898048 + 0.0039060159887135707i, 0.12391671903747536 + 3.033498555721244e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12433525152905181, 1.0e-7), DoubleNear(0.10517831923607737, 1.0e-7), DoubleNear(0.12917057559024017, 1.0e-7), DoubleNear(0.10862227046752143, 1.0e-7), DoubleNear(0.1415814453525005, 1.0e-7), DoubleNear(0.11944214455852364, 1.0e-7), DoubleNear(0.14775327422860957, 1.0e-7), DoubleNear(0.12391671903747536, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false, true}), Matrix({ { 0.11546811904643264 + 2.7105054312137605e-20i, 0.008080691811941671 + -0.0037631514650371505i, 0.0009373660733561794 + 0.0040889412076009005i, 0.0001281752586794833 + 0.0004685320147359773i, 0.00017531331435113396 + 0.00028306579209219575i, 1.0410178578577764e-05 + 1.1892401014370989e-05i, 1.1154293390695472e-05 + 0.00013075805122421608i, -1.8878348295636005e-06 + 4.522343100434666e-07i }, { 0.008080691811941671 + 0.0037631514650371513i, 0.09756300162232676 + 5.1046969961872444e-20i, -4.413550270944787e-05 + 0.00016858042310956918i, 0.0006504802063162644 + 0.0034686047429317458i, -9.634437147550363e-06 + 1.5323196495226695e-06i, 0.00011913898910904477 + 0.00020657309953159633i, 1.845306314823423e-05 + 2.537534748018786e-05i, 2.6071192938440172e-05 + 0.00011271089173894902i }, { 0.0009373660733561792 + -0.004088941207600902i, -4.413550270944788e-05 + -0.00016858042310956918i, 0.1202354959033834 + -2.9646153153900524e-20i, 0.008376570267683228 + -0.0033228334894293706i, 7.88180317808999e-05 + 8.465059463376855e-05i, 1.4132500292639933e-05 + 2.9016951665634753e-05i, -0.00017531331435113558 + -0.00028306579209219857i, -1.0410178578577961e-05 + -1.1892401014371158e-05i }, { 0.00012817525867948323 + -0.00046853201473597743i, 0.0006504802063162644 + -0.0034686047429317458i, 0.008376570267683226 + 0.0033228334894293706i, 0.10099257980298766 + -1.6940658945086112e-21i, 5.7257542410280984e-06 + -2.1382986717703888e-05i, 7.176440234350094e-05 + 6.603119250243763e-05i, 9.634437147550322e-06 + -1.5323196495229168e-06i, -0.00011913898910904613 + -0.0002065730995315987i }, { 0.0001753133143511339 + -0.00028306579209219586i, -9.634437147550373e-06 + -1.5323196495226627e-06i, 7.881803178089987e-05 + -8.465059463376856e-05i, 5.7257542410280925e-06 + 2.1382986717703895e-05i, 0.15044857783511967 + 1.0873785460377085e-19i, 0.010516178853438335 + -0.00483927066346449i, 0.0012107555764709135 + 0.005321422907542464i, 0.0001683408581923965 + 0.0006097813734720623i }, { 1.041017857857777e-05 + -1.1892401014370989e-05i, 0.00011913898910904473 + -0.00020657309953159633i, 1.4132500292639938e-05 + -2.901695166563474e-05i, 7.176440234350087e-05 + -6.603119250243763e-05i, 0.010516178853438335 + 0.0048392706634644905i, 0.12705746217227426 + 7.115076756936125e-20i, -5.604212009387873e-05 + 0.00022030777165679382i, 0.0008428304376824797 + 0.0045141181418696845i }, { 1.1154293390695475e-05 + -0.00013075805122421606i, 1.845306314823425e-05 + -2.537534748018786e-05i, -0.00017531331435113556 + 0.00028306579209219857i, 9.634437147550322e-06 + 1.5323196495229117e-06i, 0.0012107555764709133 + -0.005321422907542464i, -5.604212009387877e-05 + -0.00022030777165679382i, 0.15668835391546632 + 4.785736151986798e-20i, 0.010903827945237988 + -0.004263547740987651i }, { -1.8878348295636047e-06 + -4.522343100434687e-07i, 2.607119293844017e-05 + -0.00011271089173894904i, -1.0410178578577947e-05 + 1.1892401014371152e-05i, -0.00011913898910904608 + 0.00020657309953159872i, 0.00016834085819239652 + -0.0006097813734720624i, 0.0008428304376824798 + -0.0045141181418696845i, 0.010903827945237988 + 0.004263547740987651i, 0.13154640970200912 + 3.981054852095213e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11546811904643264, 1.0e-7), DoubleNear(0.09756300162232676, 1.0e-7), DoubleNear(0.1202354959033834, 1.0e-7), DoubleNear(0.10099257980298766, 1.0e-7), DoubleNear(0.15044857783511967, 1.0e-7), DoubleNear(0.12705746217227426, 1.0e-7), DoubleNear(0.15668835391546632, 1.0e-7), DoubleNear(0.13154640970200912, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true, false, false}), Matrix({ { 0.21281709388631642 + 3.2037198063761587e-19i, 0.01891576078371003 + -0.008790706125001563i, 0.17170268724412052 + 0.06383939559212887i, 0.0196696931608212 + 0.0038112713521323894i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01891576078371003 + 0.008790706125001563i, 0.15944668903402295 + -8.016357913370049e-20i, 0.006915402686445872 + 0.016002956416345145i, 0.13812327114407336 + 0.028258156765755528i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.17170268724412052 + -0.06383939559212887i, 0.006915402686445872 + -0.016002956416345145i, 0.33002345281408557 + -1.6631786335573997e-19i, 0.01896150809459119 + -0.0073980972339170985i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0196696931608212 + -0.00381127135213239i, 0.13812327114407336 + -0.028258156765755528i, 0.01896150809459119 + 0.007398097233917099i, 0.2977127642655748 + 2.404777992913777e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.21281709388631642, 1.0e-7), DoubleNear(0.15944668903402295, 1.0e-7), DoubleNear(0.33002345281408557, 1.0e-7), DoubleNear(0.2977127642655748, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, true, false}), Matrix({ { 0.09935173296638415 + 1.274521658826445e-19i, 0.008815277577581167 + -0.004194970363453906i, 0.08018257614620856 + 0.029773417728155182i, 0.009208262678094024 + 0.001674450242959447i, -0.029761493703174446 + -0.009735934141252905i, -0.0031030402562867046 + 0.0003947359756341324i, -0.021116045355801215 + -0.01679201701107692i, -0.0026502019983136553 + -0.0014255707430811187i }, { 0.008815277577581167 + 0.004194970363453905i, 0.07455362527337425 + -4.7921445884313155e-20i, 0.0032113356075860657 + 0.007521635333759186i, 0.06458929552463542 + 0.01322257945767174i, -0.002180511983785816 + -0.0021055003167481648i, -0.022324657773996254 + -0.007370503598280721i, -0.00019813853081791972 + -0.0025548243159006336i, -0.01802791879492774 + -0.010347451445642515i }, { 0.08018257614620856 + -0.029773417728155185i, 0.0032113356075860657 + -0.007521635333759185i, 0.15415409415290782 + -7.933748018352762e-20i, 0.008913725723581479 + -0.0036290225189305287i, -0.026918900512247074 + 0.0010498541133009617i, -0.0017282558548179757 + 0.0019442265664257395i, -0.04617179464907166 + -0.015153434346245854i, -0.0031179223663357902 + 0.00016707710794771144i }, { 0.009208262678094024 + -0.001674450242959447i, 0.06458929552463542 + -0.01322257945767174i, 0.008913725723581479 + 0.0036290225189305296i, 0.13924696443022455 + 9.816170570200166e-20i, -0.002862927580787331 + -0.0004073977555498112i, -0.020653014913494635 + -0.0024299859930489087i, -0.002213587865561523 + -0.001982054931718805i, -0.041693619272922755 + -0.013790003931630934i }, { -0.029761493703174446 + 0.009735934141252905i, -0.0021805119837858163 + 0.0021055003167481648i, -0.026918900512247074 + -0.0010498541133009617i, -0.002862927580787331 + 0.0004073977555498112i, 0.11346536091993228 + 1.929198147549714e-19i, 0.010100483206128864 + -0.004595735761547658i, 0.09152011109791197 + 0.03406597786397368i, 0.010461430482727175 + 0.0021368211091729425i }, { -0.003103040256286704 + -0.0003947359756341324i, -0.022324657773996254 + 0.007370503598280721i, -0.0017282558548179752 + -0.0019442265664257395i, -0.02065301491349464 + 0.0024299859930489087i, 0.010100483206128864 + 0.004595735761547658i, 0.0848930637606487 + -3.2242133249387326e-20i, 0.003704067078859807 + 0.008481321082585959i, 0.07353397561943795 + 0.015035577308083789i }, { -0.021116045355801215 + 0.01679201701107692i, -0.00019813853081791978 + 0.0025548243159006336i, -0.04617179464907166 + 0.015153434346245854i, -0.002213587865561523 + 0.001982054931718805i, 0.09152011109791197 + -0.03406597786397368i, 0.003704067078859807 + -0.008481321082585959i, 0.17586935866117775 + -8.698038317221235e-20i, 0.010047782371009714 + -0.00376907471498657i }, { -0.0026502019983136553 + 0.001425570743081119i, -0.01802791879492774 + 0.010347451445642515i, -0.0031179223663357902 + -0.00016707710794771144i, -0.041693619272922755 + 0.013790003931630932i, 0.010461430482727175 + -0.002136821109172943i, 0.07353397561943795 + -0.015035577308083789i, 0.010047782371009714 + 0.00376907471498657i, 0.1584657998353503 + 1.4231609358937604e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.09935173296638415, 1.0e-7), DoubleNear(0.07455362527337425, 1.0e-7), DoubleNear(0.15415409415290782, 1.0e-7), DoubleNear(0.13924696443022455, 1.0e-7), DoubleNear(0.11346536091993228, 1.0e-7), DoubleNear(0.0848930637606487, 1.0e-7), DoubleNear(0.17586935866117775, 1.0e-7), DoubleNear(0.1584657998353503, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false, true}), Matrix({ { 0.09247966932928828 + 1.1041147503706377e-19i, 0.008220281509224766 + -0.003973015064388094i, 0.07455228387858986 + 0.02773573449716544i, 0.00859592048741326 + 0.0016121322746997166i, -6.776263578034403e-19 + -1.111307226797642e-18i, -9.486769009248164e-20 + -2.710505431213761e-20i, -1.8295911660692887e-19 + -1.0842021724855044e-18i, -4.743384504624082e-20 + -1.0164395367051604e-19i }, { 0.008220281509224766 + 0.003973015064388094i, 0.06952234721950731 + -8.789655547491267e-20i, 0.0029546493832594127 + 0.006988759731087833i, 0.060068855267533264 + 0.012384613263821696i, -3.8963515573697816e-20 + -1.7110065534536867e-19i, -5.692061405548898e-19 + -7.860465750519907e-19i, 7.115076756936123e-20 + -1.0799670077492329e-19i, -3.1170812458958252e-19 + -8.131516293641283e-19i }, { 0.07455228387858986 + -0.02773573449716544i, 0.0029546493832594127 + -0.006988759731087833i, 0.14322394562052776 + -1.129525738788267e-19i, 0.008236980570400133 + -0.003112969890078428i, -8.402566836762659e-19 + -6.911788849595091e-19i, -9.486769009248164e-20 + 1.3552527156068805e-20i, -9.486769009248164e-19 + -1.7889335846010823e-18i, -1.0164395367051604e-19 + -1.4907779871675686e-19i }, { 0.00859592048741326 + -0.0016121322746997166i, 0.060068855267533264 + -0.012384613263821696i, 0.008236980570400133 + 0.0031129698900784286i, 0.1290332342058071 + 1.372494595422765e-19i, -1.0545560193316039e-19 + -8.597384414631148e-20i, -5.692061405548898e-19 + -5.963111948670274e-19i, -3.3881317890172014e-21 + -7.453889935837843e-20i, -7.860465750519907e-19 + -1.5720931501039814e-18i }, { -6.776263578034403e-19 + 1.0842021724855044e-18i, -4.404571325722362e-20 + 1.6771252355635147e-19i, -8.402566836762659e-19 + 6.505213034913027e-19i, -1.1434944787933055e-19 + 8.597384414631148e-20i, 0.12033742455702816 + 2.099605056005521e-19i, 0.010695479274485265 + -0.004817691060613471i, 0.09715040336553067 + 0.03610366109496342i, 0.011073772673407938 + 0.002199139077432673i }, { -8.131516293641283e-20 + 1.3552527156068805e-20i, -5.692061405548898e-19 + 7.860465750519907e-19i, -8.809142651444724e-20 + -1.5246593050577406e-20i, -5.827586677109586e-19 + 5.692061405548898e-19i, 0.010695479274485265 + 0.004817691060613471i, 0.08992434181451564 + 7.732976341212182e-21i, 0.0039607533031864595 + 0.009014196685257311i, 0.0780544158765401 + 0.01587354350193383i }, { -2.1006417091906648e-19 + 1.0842021724855044e-18i, 6.776263578034403e-20 + 1.1350241493207625e-19i, -1.0299920638612292e-18 + 1.6805133673525319e-18i, -6.776263578034403e-21 + 8.131516293641283e-20i, 0.09715040336553067 + -0.03610366109496343i, 0.0039607533031864595 + -0.009014196685257311i, 0.1867995071935578 + -5.3365289476913276e-20i, 0.01072452752419106 + -0.004285127343838671i }, { -4.743384504624082e-20 + 1.0164395367051604e-19i, -3.1170812458958252e-19 + 8.131516293641283e-19i, -9.486769009248164e-20 + 1.3552527156068805e-19i, -7.724940478959219e-19 + 1.6263032587282567e-18i, 0.011073772673407938 + -0.0021991390774326732i, 0.07805441587654009 + -0.01587354350193383i, 0.01072452752419106 + 0.004285127343838671i, 0.16867953005976774 + 1.0322833974910119e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.09247966932928828, 1.0e-7), DoubleNear(0.06952234721950731, 1.0e-7), DoubleNear(0.14322394562052776, 1.0e-7), DoubleNear(0.1290332342058071, 1.0e-7), DoubleNear(0.12033742455702816, 1.0e-7), DoubleNear(0.08992434181451564, 1.0e-7), DoubleNear(0.1867995071935578, 1.0e-7), DoubleNear(0.16867953005976774, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, true, false}), Matrix({ { 0.253505827119292 + 4.8114685699116865e-20i, 0.017729003301162644 + -0.007823992882384435i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07593328835224611 + -0.02488936848749876i, -0.006220962622622495 + 0.0005618130835818438i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.017729003301162644 + 0.007823992882384435i, 0.21380058970359878 + 5.0240259817688494e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004394099849347338 + -0.004087555248466971i, -0.06401827704691901 + -0.02116050752991165i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07593328835224611 + 0.02488936848749876i, -0.004394099849347339 + 0.00408755524846697i, 0.0 + 0.0i, 0.0 + 0.0i, 0.28933471958111 + 1.0593943158275905e-19i, 0.02014826557713858 + -0.008364810476534229i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006220962622622495 + -0.0005618130835818438i, -0.06401827704691901 + 0.02116050752991165i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02014826557713858 + 0.008364810476534229i, 0.243358863595999 + 1.1007396033998872e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.253505827119292, 1.0e-7), DoubleNear(0.21380058970359878, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28933471958111, 1.0e-7), DoubleNear(0.243358863595999, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false, true}), Matrix({ { 0.23570361494981606 + -2.541098841762925e-21i, 0.016457262079624897 + -0.0070859849544665215i, 0.0 + 0.0i, 0.0 + 0.0i, -1.6263032587282567e-18 + -2.927345865710862e-18i, -1.8973538018496328e-19 + -1.7618285302889447e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.016457262079624897 + 0.0070859849544665215i, 0.1985555814253144 + 4.935290406736383e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -4.0657581468206416e-20 + -2.473336205982557e-19i, -1.3552527156068805e-18 + -2.3852447794681098e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.734723475976807e-18 + 2.8189256484623115e-18i, -5.421010862427522e-20 + 2.473336205982557e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.307136931750586 + 1.5659521612363882e-19i, 0.021420006798676325 + -0.00910281840445214i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.7618285302889447e-19 + 1.4907779871675686e-19i, -1.328147661294743e-18 + 2.3852447794681098e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.021420006798676325 + 0.00910281840445214i, 0.2586038718742834 + 1.1096131609031337e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.23570361494981606, 1.0e-7), DoubleNear(0.1985555814253144, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.307136931750586, 1.0e-7), DoubleNear(0.2586038718742834, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true, true}), Matrix({ { 0.10923669824685094 + -3.572930138019397e-20i, 0.007490218285606158 + -0.0024020093806342794i, -0.032779757774682006 + -0.01026432503416325i, -0.0019939037938005062 + 0.0001564508573998737i, -0.0002895260224512295 + -0.0005456848289434621i, -5.798499323178567e-05 + -0.00011129321731135833i, 9.752250566393662e-05 + -0.0028758693754826854i, -6.169805832770728e-05 + -0.00012953641555216898i }, { 0.007490218285606158 + 0.00240200938063428i, 0.09099612909924112 + -8.410016296571542e-21i, -0.0025211446365213906 + -0.0014121815393375683i, -0.027379899298920783 + -0.007982068920934608i, 4.0891924505310914e-05 + 2.3772882841625883e-05i, -0.00015752395714130888 + -0.0005008402132353406i, 5.6713910850594314e-05 + -0.00026803687092965845i, -2.0329095118491183e-06 + -0.002393483815785718i }, { -0.032779757774682006 + 0.01026432503416325i, -0.0025211446365213915 + 0.0014121815393375683i, 0.12646691670296512 + 3.318820253843104e-20i, 0.00896704379401874 + -0.004683975573832242i, -0.002567517111911605 + -0.0013025080950868767i, -0.00014678885276034294 + 5.341339222811948e-06i, 0.00028952602245122785 + 0.0005456848289434592i, 5.798499323178548e-05 + 0.00011129321731135815i }, { -0.0019939037938005062 + -0.00015645085739987376i, -0.027379899298920783 + 0.007982068920934608i, 0.00896704379401874 + 0.004683975573832242i, 0.10755945232607328 + 5.776292036393537e-20i, -0.00021730912130805903 + -0.00016943080198232786i, -0.002177192722064552 + -0.0010113923579147394i, -4.0891924505310955e-05 + -2.377288284162613e-05i, 0.00015752395714130753 + 0.0005008402132353383i }, { -0.0002895260224512295 + 0.0005456848289434621i, 4.08919245053109e-05 + -2.3772882841625887e-05i, -0.002567517111911605 + 0.0013025080950868771i, -0.00021730912130805903 + 0.00016943080198232786i, 0.14426912887244103 + 8.384398707931083e-20i, 0.010238785015556487 + -0.005421983501750155i, -0.0431535305775641 + -0.014625043453335509i, -0.004227058828821989 + 0.0004053622261819701i }, { -5.798499323178565e-05 + 0.00011129321731135833i, -0.00015752395714130883 + 0.0005008402132353406i, -0.0001467888527603429 + -5.341339222811948e-06i, -0.002177192722064552 + 0.0010113923579147391i, 0.010238785015556487 + 0.005421983501750155i, 0.12280446060435767 + 5.865027611426004e-20i, -0.0018729552128259478 + -0.002675373709129402i, -0.036638377747998226 + -0.013178438608977045i }, { 9.752250566393662e-05 + 0.0028758693754826854i, 5.6713910850594334e-05 + 0.00026803687092965845i, 0.00028952602245122775 + -0.0005456848289434593i, -4.0891924505310955e-05 + 2.3772882841626134e-05i, -0.0431535305775641 + 0.014625043453335509i, -0.001872955212825948 + 0.0026753737091294015i, 0.16286780287814492 + 7.2751229044328e-20i, 0.011181221783119838 + -0.003680834902701986i }, { -6.16980583277073e-05 + 0.00012953641555216898i, -2.032909511849213e-06 + 0.002393483815785718i, 5.798499323178547e-05 + -0.00011129321731135818i, 0.0001575239571413075 + -0.0005008402132353383i, -0.004227058828821989 + -0.00040536222618197006i, -0.036638377747998226 + 0.013178438608977045i, 0.011181221783119838 + 0.003680834902701986i, 0.13579941126992573 + 5.231103997605334e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.10923669824685094, 1.0e-7), DoubleNear(0.09099612909924112, 1.0e-7), DoubleNear(0.12646691670296512, 1.0e-7), DoubleNear(0.10755945232607328, 1.0e-7), DoubleNear(0.14426912887244103, 1.0e-7), DoubleNear(0.12280446060435767, 1.0e-7), DoubleNear(0.16286780287814492, 1.0e-7), DoubleNear(0.13579941126992573, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false, false, false}), Matrix({ { 0.29790554537140923 + 3.1140846206778634e-20i, -0.034108881919150895 + -0.01956162346855444i, 0.0 + 0.0i, 0.0 + 0.0i, -0.013777811160777552 + -0.10607205531654647i, -0.005387599853670513 + 0.013049490431656787i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0341088819191509 + 0.019561623468554435i, 0.2586161832866283 + 1.510127832232864e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.008542598082397159 + 0.011240082326735734i, -0.011960720408886238 + -0.09208271052871131i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013777811160777552 + 0.10607205531654647i, 0.008542598082397159 + -0.011240082326735734i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2373934915408788 + 3.111621162251941e-20i, -0.027180516432642052 + -0.015588169362938659i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005387599853670513 + -0.013049490431656789i, -0.011960720408886238 + 0.09208271052871131i, 0.0 + 0.0i, 0.0 + 0.0i, -0.027180516432642052 + 0.01558816936293866i, 0.20608477980108347 + 1.0109849638696871e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.29790554537140923, 1.0e-7), DoubleNear(0.2586161832866283, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2373934915408788, 1.0e-7), DoubleNear(0.20608477980108347, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false, false, false}), Matrix({ { 0.26351423094319776 + 6.496012460103871e-20i, -0.030993630376826946 + -0.01969694084414167i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0036386359496747055 + 0.018009845062802413i, -0.039711115029846915 + -0.0016148616205680156i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.030993630376826946 + 0.019696940844141666i, 0.22702292973295557 + 1.9308052184610345e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.011304653995480153 + -0.01021507976084856i, 2.7963441511317513e-06 + -0.000616758062857621i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003638635949674705 + -0.01800984506280242i, 0.011304653995480154 + 0.01021507976084856i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2717848059690903 + -2.703066771740654e-21i, -0.030295767974966 + -0.015452851987351428i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.039711115029846915 + 0.0016148616205680154i, 2.7963441511313176e-06 + 0.000616758062857621i, 0.0 + 0.0i, 0.0 + 0.0i, -0.030295767974966005 + 0.015452851987351428i, 0.23767803335475618 + 5.903075776415165e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.26351423094319776, 1.0e-7), DoubleNear(0.22702292973295557, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2717848059690903, 1.0e-7), DoubleNear(0.23767803335475618, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false, false, false}), Matrix({ { 0.19927602820143508 + 2.5402071812354694e-20i, -0.022800916764334406 + -0.013083900421445038i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1658506509827553 + 0.04930500234579478i, -0.01575018919004928 + -0.016516711014447513i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.022800916764334406 + 0.013083900421445038i, 0.17298775471890435 + 2.1480632969156073e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.022219396723645042 + 0.00526317187508836i, 0.1439753074054386 + 0.04279255001208961i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.1658506509827553 + -0.04930500234579478i, -0.022219396723645042 + -0.00526317187508836i, 0.0 + 0.0i, 0.0 + 0.0i, 0.336023008710853 + 3.6854986016943346e-20i, -0.038488481587458545 + -0.022065892410048058i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01575018919004928 + 0.01651671101444751i, 0.1439753074054386 + -0.04279255001208961i, 0.0 + 0.0i, 0.0 + 0.0i, -0.038488481587458545 + 0.022065892410048058i, 0.2917132083688074 + 3.7304949918694387e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.19927602820143508, 1.0e-7), DoubleNear(0.17298775471890435, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.336023008710853, 1.0e-7), DoubleNear(0.2917132083688074, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true, false, false}), Matrix({ { 0.5352990369122881 + 6.225705782929805e-20i, -0.061289398351792944 + -0.035149792831493096i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.061289398351792944 + 0.035149792831493096i, 0.46470096308771175 + 2.521112796102551e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5352990369122881, 1.0e-7), DoubleNear(0.46470096308771175, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, true, false}), Matrix({ { 0.2502156290933485 + -1.103195789503255e-20i, -0.028640853047462864 + -0.0159921602027427i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07512890623865907 + -0.02483551747998282i, 0.007119375090028661 + 0.00797597682367785i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.028640853047462864 + 0.0159921602027427i, 0.2170907877295423 + 1.0938690341183794e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.010190402902110391 + -0.002197064596534297i, -0.06482265916050606 + -0.021214358537427595i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07512890623865907 + 0.02483551747998282i, 0.010190402902110391 + 0.002197064596534297i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2850834078189396 + 7.32890157243306e-20i, -0.03264854530433008 + -0.019157632628750396i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007119375090028662 + -0.00797597682367785i, -0.06482265916050606 + 0.021214358537427598i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03264854530433008 + 0.019157632628750396i, 0.24761017535816945 + 1.4272437619841717e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2502156290933485, 1.0e-7), DoubleNear(0.2170907877295423, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2850834078189396, 1.0e-7), DoubleNear(0.24761017535816945, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false, true}), Matrix({ { 0.2324583820723797 + -4.237909797701799e-20i, -0.026616124059718756 + -0.015265009678581035i, 0.0 + 0.0i, 0.0 + 0.0i, 4.6426848952857414e-05 + 8.159164464946488e-05i, 9.266342334625575e-05 + -0.00010415016065451425i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.026616124059718756 + 0.015265009678581035i, 0.20180081430275076 + 8.919090320261891e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00014453831735784228 + 2.4371857805781303e-05i, -4.642684895286034e-05 + -8.15916446494702e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.642684895285736e-05 + -8.159164464946488e-05i, -0.0001445383173578423 + -2.4371857805781303e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3028406548399084 + 1.0463615580631604e-19i, -0.03467327429207419 + -0.01988478315291206i, 0.0 + 0.0i, 0.0 + 0.0i }, { 9.26634233462558e-05 + 0.0001041501606545143i, -4.642684895286042e-05 + 8.159164464947003e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03467327429207419 + 0.01988478315291206i, 0.262900148784961 + 1.6292037640763618e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2324583820723797, 1.0e-7), DoubleNear(0.20180081430275076, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3028406548399084, 1.0e-7), DoubleNear(0.262900148784961, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false, false, false}), Matrix({ { 0.14665139533050175 + 2.005360174229188e-20i, -0.0172486287547 + -0.010961775567856828i, -0.006782469352187171 + -0.052216600729442536i, -0.0031053121669263354 + 0.006648505903757353i, 0.002024979968670247 + 0.010022870107214225i, -0.022100098383348584 + -0.000898705580622032i, 0.0034750834850677693 + -0.001184560020317622i, 0.0007021132615661165 + 0.00791051086699504i }, { -0.0172486287547 + 0.010961775567856828i, 0.12634319329999666 + 1.1574707009776516e-19i, 0.004700773234751238 + 0.005634565236271872i, -0.0058432368439692425 + -0.04498567548273823i, 0.006291285583445605 + -0.005684913846887175i, 1.5562262809107265e-06 + -0.00034323926330530563i, -0.00231513193184837 + -0.0019771499125247932i, -0.00012228552332094016 + 1.5320337951215348e-05i }, { -0.006782469352187171 + 0.05221660072944254i, 0.004700773234751238 + -0.005634565236271873i, 0.11686283561269598 + 4.4906522858746824e-20i, -0.013745001622126947 + -0.00873516527628484i, -0.003662389777590201 + 0.0002574660888902349i, 0.001342098314158414 + -0.007827382533391783i, 0.001613655981004458 + 0.00798697495558819i, -0.017611016646498327 + -0.0007161560399459834i }, { -0.0031053121669263354 + -0.0066485059037573535i, -0.0058432368439692425 + 0.04498567548273823i, -0.013745001622126947 + 0.008735165276284838i, 0.10067973643295892 + 7.733345174833832e-20i, 0.0017332015443547867 + 0.002502992218347262i, 0.00012214157573651297 + 1.642855579219578e-05i, 0.005013368412034546 + -0.004530165913961385i, 1.2401178702209435e-06 + -0.00027351879955231535i }, { 0.0020249799686702474 + -0.010022870107214225i, 0.006291285583445607 + 0.005684913846887175i, -0.0036623897775902013 + -0.00025746608889023494i, 0.0017332015443547865 + -0.002502992218347262i, 0.1512541500409075 + 1.1087244464486758e-20i, -0.016860253164450896 + -0.00859984790069761i, -0.006995341808590379 + -0.05385545458710392i, -0.002282287686744177 + 0.006400984527899435i }, { -0.022100098383348584 + 0.000898705580622032i, 1.5562262809102386e-06 + 0.0003432392633053057i, 0.001342098314158414 + 0.007827382533391783i, 0.0001221415757365131 + -1.6428555792195835e-05i, -0.016860253164450896 + 0.00859984790069761i, 0.13227298998663162 + 3.5265713125521265e-20i, 0.003841824847645921 + 0.005605517090463862i, -0.006117483564916997 + -0.04709703504597309i }, { 0.0034750834850677693 + 0.0011845600203176222i, -0.0023151319318483704 + 0.0019771499125247937i, 0.001613655981004458 + -0.007986974955588191i, 0.005013368412034546 + 0.004530165913961385i, -0.006995341808590379 + 0.05385545458710392i, 0.003841824847645921 + -0.005605517090463861i, 0.12053065592818284 + -1.379031123622741e-20i, -0.013435514810515106 + -0.006853004086653819i }, { 0.0007021132615661165 + -0.007910510866995043i, -0.0001222855233209402 + -1.5320337951215307e-05i, -0.017611016646498327 + 0.0007161560399459834i, 1.2401178702209164e-06 + 0.00027351879955231535i, -0.002282287686744177 + -0.006400984527899436i, -0.006117483564916997 + 0.04709703504597308i, -0.013435514810515106 + 0.00685300408665382i, 0.10540504336812452 + 2.3765044638630374e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.14665139533050175, 1.0e-7), DoubleNear(0.12634319329999666, 1.0e-7), DoubleNear(0.11686283561269598, 1.0e-7), DoubleNear(0.10067973643295892, 1.0e-7), DoubleNear(0.1512541500409075, 1.0e-7), DoubleNear(0.13227298998663162, 1.0e-7), DoubleNear(0.12053065592818284, 1.0e-7), DoubleNear(0.10540504336812452, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false, false, false}), Matrix({ { 0.11090143969477051 + 3.7169722964296236e-20i, -0.012689205612675414 + -0.00728147488013222i, -0.0051290723429398485 + -0.03948749470682836i, -0.002005775108398014 + 0.004854870706545599i, 0.09229949098398385 + 0.027439305136970314i, -0.008765322514737363 + -0.00919190856550558i, 0.005501268978661914 + -0.034133135270191045i, -0.002867478261905377 + 0.0035460909388450967i }, { -0.012689205612675416 + 0.00728147488013222i, 0.09627144429283727 + 1.4455430167536713e-19i, 0.0031794993403102094 + 0.004181349938442196i, -0.0044524507859977774 + -0.03427834803042139i, -0.012365577074381677 + 0.002929069510148539i, 0.08012538696134706 + 0.02381498390641364i, 0.0016148172345419026 + 0.004267413039533243i, 0.00477383473266017 + -0.029630810725856282i }, { -0.0051290723429398485 + 0.03948749470682836i, 0.0031794993403102094 + -0.004181349938442196i, 0.08837458850666456 + -1.176765115194153e-20i, -0.010111711151658992 + -0.005802425541312819i, -0.014038773410999792 + 0.03159505855135187i, 0.0036782517452978985 + -0.0026958591631003545i, 0.07355115999877146 + 0.02186569720882447i, -0.006984866675311915 + -0.007324802448941932i }, { -0.002005775108398014 + -0.004854870706545599i, -0.0044524507859977774 + 0.03427834803042139i, -0.010111711151658992 + 0.005802425541312819i, 0.07671631042606708 + 7.025202801619359e-20i, -0.0004710279464810582 + -0.0045383456704603i, -0.012185260722474032 + 0.02742797592699111i, -0.009853819649263365 + 0.0023341023649398208i, 0.06384992044409153 + 0.01897756610567597i }, { 0.09229949098398385 + -0.027439305136970314i, -0.012365577074381677 + -0.002929069510148539i, -0.014038773410999792 + -0.03159505855135187i, -0.0004710279464810583 + 0.0045383456704603i, 0.18700410567663878 + -6.028876757517602e-21i, -0.021419676306475482 + -0.012280148588422218i, -0.008648738817837703 + -0.06658456060971811i, -0.003381824745272499 + 0.00819461972511119i }, { -0.008765322514737363 + 0.00919190856550558i, 0.08012538696134705 + -0.023814983906413636i, 0.0036782517452978985 + 0.0026958591631003545i, -0.012185260722474032 + -0.02742797592699111i, -0.021419676306475482 + 0.012280148588422217i, 0.162344738993791 + 6.45848154791927e-21i, 0.005363098742086949 + 0.007058732388293538i, -0.007508269622888461 + -0.05780436249828993i }, { 0.005501268978661914 + 0.034133135270191045i, 0.0016148172345419026 + -0.004267413039533243i, 0.07355115999877146 + -0.021865697208824475i, -0.009853819649263365 + -0.0023341023649398208i, -0.008648738817837703 + 0.06658456060971811i, 0.005363098742086949 + -0.007058732388293538i, 0.14901890303421428 + 4.2883862774460936e-20i, -0.01706880528098306 + -0.00978574382162584i }, { -0.0028674782619053764 + -0.0035460909388450967i, 0.00477383473266017 + 0.029630810725856282i, -0.006984866675311916 + 0.007324802448941932i, 0.06384992044409153 + -0.01897756610567597i, -0.003381824745272499 + -0.00819461972511119i, -0.007508269622888461 + 0.05780436249828993i, -0.01706880528098306 + 0.00978574382162584i, 0.12936846937501637 + 3.0846468370775117e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.11090143969477051, 1.0e-7), DoubleNear(0.09627144429283727, 1.0e-7), DoubleNear(0.08837458850666456, 1.0e-7), DoubleNear(0.07671631042606708, 1.0e-7), DoubleNear(0.18700410567663878, 1.0e-7), DoubleNear(0.162344738993791, 1.0e-7), DoubleNear(0.14901890303421428, 1.0e-7), DoubleNear(0.12936846937501637, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true, false, false}), Matrix({ { 0.29790554537140923 + 3.1140846206778634e-20i, -0.034108881919150895 + -0.01956162346855444i, -0.013777811160777552 + -0.10607205531654647i, -0.005387599853670513 + 0.013049490431656787i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0341088819191509 + 0.019561623468554435i, 0.2586161832866283 + 1.510127832232864e-19i, 0.008542598082397159 + 0.011240082326735734i, -0.011960720408886238 + -0.09208271052871131i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013777811160777552 + 0.10607205531654647i, 0.008542598082397159 + -0.011240082326735734i, 0.2373934915408788 + 3.111621162251941e-20i, -0.027180516432642052 + -0.015588169362938659i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005387599853670513 + -0.013049490431656789i, -0.011960720408886238 + 0.09208271052871131i, -0.027180516432642052 + 0.01558816936293866i, 0.20608477980108347 + 1.0109849638696871e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.29790554537140923, 1.0e-7), DoubleNear(0.2586161832866283, 1.0e-7), DoubleNear(0.2373934915408788, 1.0e-7), DoubleNear(0.20608477980108347, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, true, false}), Matrix({ { 0.13925043444028867 + -5.418994179643038e-21i, -0.015939257048214858 + -0.00889998464100664i, -0.006440182868642437 + -0.04958141939381634i, -0.0024317492599901054 + 0.006086936249473857i, -0.04181086877212617 + -0.01382150512007695i, 0.0039620869320677226 + 0.004438804409649642i, -0.0029875684258737645 + 0.01552638057463929i, 0.001397235559372107 + -0.0016160280352043297i }, { -0.01593925704821486 + 0.00889998464100664i, 0.12081574046297999 + 6.815827931784747e-20i, 0.003906096260678555 + 0.005263706808983029i, -0.005587598093460006 + -0.043017574209710016i, 0.005671180638804358 + -0.001222714187236641i, -0.03607521833221561 + -0.011806251485620606i, -0.0006976448274767211 + -0.001962727684458031i, -0.0025352861893090696 + 0.013390945284362778i }, { -0.006440182868642437 + 0.04958141939381634i, 0.0039060962606785547 + -0.00526370680898303i, 0.1109651946530598 + -5.612963715389524e-21i, -0.012701595999248007 + -0.007092175561736059i, 0.00685498387590984 + -0.014247921073224342i, -0.0017637200803940682 + 0.0012054481726540517i, -0.03331803746653289 + -0.011014012359905867i, 0.0031572881579609384 + 0.0035371724140282087i }, { -0.0024317492599901054 + -0.006086936249473858i, -0.005587598093460006 + 0.04301757420971002i, -0.012701595999248007 + 0.007092175561736058i, 0.0962750472665623 + 4.1228624093990466e-20i, 0.00017307281386959745 + 0.0020758261174150085i, 0.005872166307773552 + -0.012298892410471286i, 0.004519222263306033 + -0.000974350409297656i, -0.028747440828290442 + -0.00940810705180699i }, { -0.04181086877212617 + 0.013821505120076948i, 0.005671180638804358 + 0.0012227141872366409i, 0.00685498387590984 + 0.014247921073224342i, 0.00017307281386959756 + -0.0020758261174150085i, 0.1586551109311206 + 3.655984038642167e-20i, -0.018169624870936034 + -0.010661638827547797i, -0.007337628292135115 + -0.056490635922730126i, -0.0029558505936804072 + 0.006962554182182931i }, { 0.003962086932067723 + -0.004438804409649642i, -0.03607521833221561 + 0.011806251485620606i, -0.0017637200803940684 + -0.0012054481726540515i, 0.005872166307773552 + 0.012298892410471286i, -0.018169624870936034 + 0.010661638827547795i, 0.13780044282364828 + 8.285450390543892e-20i, 0.004636501821718604 + 0.005976375517752704i, -0.006373122315426232 + -0.04906513631900129i }, { -0.0029875684258737645 + -0.01552638057463929i, -0.0006976448274767213 + 0.001962727684458031i, -0.03331803746653289 + 0.011014012359905869i, 0.004519222263306033 + 0.0009743504092976561i, -0.007337628292135115 + 0.056490635922730126i, 0.004636501821718604 + -0.005976375517752704i, 0.126428296887819 + 3.6729175337908937e-20i, -0.014478920433394046 + -0.008495993801202601i }, { 0.0013972355593721067 + 0.00161602803520433i, -0.00253528618930907 + -0.013390945284362778i, 0.0031572881579609384 + -0.0035371724140282087i, -0.028747440828290442 + 0.00940810705180699i, -0.0029558505936804072 + -0.006962554182182931i, -0.006373122315426232 + 0.04906513631900129i, -0.014478920433394046 + 0.008495993801202601i, 0.10980973253452114 + 5.986987229297824e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.13925043444028867, 1.0e-7), DoubleNear(0.12081574046297999, 1.0e-7), DoubleNear(0.1109651946530598, 1.0e-7), DoubleNear(0.0962750472665623, 1.0e-7), DoubleNear(0.1586551109311206, 1.0e-7), DoubleNear(0.13780044282364828, 1.0e-7), DoubleNear(0.126428296887819, 1.0e-7), DoubleNear(0.10980973253452114, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false, true}), Matrix({ { 0.12936814063197133 + -2.7953913222184396e-20i, -0.01481245137189147 + -0.008495309574305592i, -0.005983137405602914 + -0.04606273626831987i, -0.0023397744691116594 + 0.005667010764285284i, 2.583755023538982e-05 + 4.540752312437251e-05i, 5.156920854402983e-05 + -5.796182744746261e-05i, 1.4972814322991056e-05 + -1.1299750504817623e-05i, -2.3022871144391972e-05 + -1.5681026757605532e-05i }, { -0.01481245137189147 + 0.008495309574305592i, 0.11230653802036651 + 5.715733117942046e-20i, 0.0037098943678579785 + 0.004881212897238521i, -0.005194056629715211 + -0.03998779310554393i, -8.043871423331044e-05 + 1.3563468436681286e-05i, -2.583755023539142e-05 + -4.540752312437541e-05i, 8.549603821059419e-06 + 2.801366060016534e-05i, -1.4972814322992018e-05 + 1.1299750504818395e-05i }, { -0.005983137405602914 + 0.04606273626831987i, 0.0037098943678579785 + -0.004881212897238521i, 0.10309024144040836 + -1.4425184754833602e-20i, -0.011803672687827286 + -0.006769700104275441i, -1.7362732157897366e-05 + 7.099652261555573e-06i, 1.825283025009052e-05 + 2.1042371153589067e-05i, 2.0589298717467607e-05 + 3.618412152509235e-05i, 4.1094214802225916e-05 + -4.618833320705166e-05i }, { -0.0023397744691116594 + -0.0056670107642852845i, -0.005194056629715211 + 0.03998779310554393i, -0.011803672687827286 + 0.006769700104275442i, 0.08949427628238427 + 3.203357202319846e-20i, -1.1091957323775993e-06 + -2.926825226325627e-05i, 1.7362732157898437e-05 + -7.099652261556003e-06i, -6.409960312453187e-05 + 1.08083893691e-05i, -2.0589298717468894e-05 + -3.6184121525094707e-05i }, { 2.583755023538978e-05 + -4.540752312437251e-05i, -8.043871423331044e-05 + -1.3563468436681313e-05i, -1.736273215789734e-05 + -7.099652261555573e-06i, -1.109195732377601e-06 + 2.9268252263256255e-05i, 0.16853740473943793 + 5.909475942896303e-20i, -0.019296430547259425 + -0.011066313894248846i, -0.007794673755174638 + -0.060009319048226595i, -0.003047825384558853 + 0.007382479667371504i }, { 5.1569208544029844e-05 + 5.796182744746262e-05i, -2.5837550235391487e-05 + 4.540752312437541e-05i, 1.8252830250090534e-05 + -2.104237115358907e-05i, 1.7362732157898437e-05 + 7.09965226155603e-06i, -0.01929643054725943 + 0.011066313894248843i, 0.14630964526626178 + 9.385545204386593e-20i, 0.00483270371453918 + 0.0063588694294972135i, -0.006766663779171027 + -0.05209491742316738i }, { 1.497281432299107e-05 + 1.1299750504817643e-05i, 8.549603821059424e-06 + -2.8013660600165333e-05i, 2.0589298717467566e-05 + -3.618412152509243e-05i, -6.409960312453185e-05 + -1.0808389369099987e-05i, -0.007794673755174638 + 0.060009319048226595i, 0.00483270371453918 + -0.0063588694294972135i, 0.13430325010047045 + 4.5541396377353015e-20i, -0.015376843744814767 + -0.008818469258663218i }, { -2.302287114439199e-05 + 1.5681026757605545e-05i, -1.4972814322992018e-05 + -1.1299750504818395e-05i, 4.109421480222595e-05 + 4.618833320705167e-05i, -2.0589298717468935e-05 + 3.618412152509465e-05i, -0.003047825384558853 + -0.007382479667371504i, -0.006766663779171027 + 0.05209491742316738i, -0.015376843744814767 + 0.008818469258663218i, 0.11659050351869919 + 6.906492436377025e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12936814063197133, 1.0e-7), DoubleNear(0.11230653802036651, 1.0e-7), DoubleNear(0.10309024144040836, 1.0e-7), DoubleNear(0.08949427628238427, 1.0e-7), DoubleNear(0.16853740473943793, 1.0e-7), DoubleNear(0.14630964526626178, 1.0e-7), DoubleNear(0.13430325010047045, 1.0e-7), DoubleNear(0.11659050351869919, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false, false, false}), Matrix({ { 0.09803040471075936 + 5.89612910036008e-20i, -0.011504380665755508 + -0.007384704464462359i, 0.0013706111306698253 + 0.006712053789747671i, -0.014779664470309675 + -0.0005897444078596754i, 0.08162600500352896 + 0.024201228402754495i, -0.007723404193253115 + -0.008935180315478344i, -0.0005344153557121398 + 0.005926905352654736i, -0.01216421718486813 + -0.0041468622723078805i }, { -0.011504380665755508 + 0.007384704464462359i, 0.08450035577839368 + 1.4439686721863979e-19i, 0.004202860663888059 + -0.003795512266708618i, -8.474368755242393e-06 + -0.00023627687114289453i, -0.011464407264771765 + 0.003298000451566081i, 0.07033511342327214 + 0.02090010498821508i, 0.004430591400213889 + -0.0021214680934671074i, 6.327241644946263e-05 + -0.00020805336889880707i }, { 0.0013706111306698253 + -0.006712053789747671i, 0.00420286066388806 + 0.003795512266708618i, 0.1012456234906757 + -3.3559219191246104e-20i, -0.011296536098578898 + -0.0056991959569826795i, 0.002793606546096673 + -0.005235830452127123i, 0.0025735080108676804 + 0.004202790591126052i, 0.08422464597922637 + 0.02510377394304029i, -0.008026784996796165 + -0.007581530698969168i }, { -0.014779664470309675 + 0.0005897444078596752i, -8.474368755242583e-06 + 0.00023627687114289464i, -0.011296536098578898 + 0.0056991959569826795i, 0.08848739894051066 + 7.040946247292093e-20i, -0.012438965353633735 + -0.0031523218365885064i, -6.978475736630858e-05 + 0.00017842233811088976i, -0.010754989458873276 + 0.0019651714235222784i, 0.07364019398216645 + 0.02189244502387453i }, { 0.08162600500352896 + -0.024201228402754495i, -0.011464407264771765 + -0.003298000451566081i, 0.002793606546096673 + 0.0052358304521271225i, -0.012438965353633735 + 0.0031523218365885064i, 0.1654838262324384 + 5.9988335974378965e-21i, -0.019489249711071438 + -0.01231223637967931i, 0.00226802481900488 + 0.011297791273054745i, -0.024931450559537237 + -0.0010251172127083404i }, { -0.007723404193253115 + 0.008935180315478344i, 0.07033511342327214 + -0.02090010498821508i, 0.0025735080108676804 + -0.004202790591126052i, -6.978475736630838e-05 + -0.00017842233811088973i, -0.019489249711071438 + 0.012312236379679308i, 0.1425225739545619 + 4.868365462746369e-20i, 0.007101793331592092 + -0.006419567494139942i, 1.1270712906374144e-05 + -0.00038048119171472646i }, { -0.0005344153557121399 + -0.005926905352654737i, 0.00443059140021389 + 0.002121468093467107i, 0.08422464597922637 + -0.02510377394304029i, -0.010754989458873276 + -0.001965171423522279i, 0.00226802481900488 + -0.011297791273054745i, 0.0071017933315920935 + 0.006419567494139942i, 0.1705391824784146 + 3.0856152419505456e-20i, -0.018999231876387107 + -0.009753656030368749i }, { -0.01216421718486813 + 0.0041468622723078805i, 6.327241644946257e-05 + 0.00020805336889880718i, -0.008026784996796165 + 0.007581530698969168i, 0.07364019398216645 + -0.02189244502387453i, -0.024931450559537237 + 0.0010251172127083404i, 1.1270712906373819e-05 + 0.00038048119171472646i, -0.018999231876387107 + 0.009753656030368749i, 0.14919063441424552 + -1.1378704708769299e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.09803040471075936, 1.0e-7), DoubleNear(0.08450035577839368, 1.0e-7), DoubleNear(0.1012456234906757, 1.0e-7), DoubleNear(0.08848739894051066, 1.0e-7), DoubleNear(0.1654838262324384, 1.0e-7), DoubleNear(0.1425225739545619, 1.0e-7), DoubleNear(0.1705391824784146, 1.0e-7), DoubleNear(0.14919063441424552, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true, false, false}), Matrix({ { 0.26351423094319776 + 6.496012460103871e-20i, -0.030993630376826946 + -0.01969694084414167i, 0.0036386359496747055 + 0.018009845062802413i, -0.039711115029846915 + -0.0016148616205680156i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.030993630376826946 + 0.019696940844141666i, 0.22702292973295557 + 1.9308052184610345e-19i, 0.011304653995480153 + -0.01021507976084856i, 2.7963441511317513e-06 + -0.000616758062857621i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003638635949674705 + -0.01800984506280242i, 0.011304653995480154 + 0.01021507976084856i, 0.2717848059690903 + -2.703066771740654e-21i, -0.030295767974966 + -0.015452851987351428i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.039711115029846915 + 0.0016148616205680154i, 2.7963441511313176e-06 + 0.000616758062857621i, -0.030295767974966005 + 0.015452851987351428i, 0.23767803335475618 + 5.903075776415165e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.26351423094319776, 1.0e-7), DoubleNear(0.22702292973295557, 1.0e-7), DoubleNear(0.2717848059690903, 1.0e-7), DoubleNear(0.23767803335475618, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, true, false}), Matrix({ { 0.12354617091150023 + -1.563192496338154e-21i, -0.014651468986683503 + -0.008665393371294475i, 0.0014302051412186253 + 0.008403307612011373i, -0.018846841585045442 + -0.0008715290628706987i, -0.0376204055360179 + -0.012919359642020099i, 0.003950423429178502 + 0.004206243640965051i, 8.75322905464405e-05 + -0.002953663915958558i, 0.005063287749281508 + 0.00254466416219002i }, { -0.014651468986683503 + 0.008665393371294475i, 0.10596739985362895 + 1.0482367911718395e-19i, 0.005409279668434521 + -0.00458078543313342i, 0.00011572729508501972 + -0.00035867005393771953i, 0.005043815014712765 + -0.0009229783743959773i, -0.03207655035271341 + -0.010680380420436751i, -0.0027509227520963846 + 0.0004368604609740536i, -0.00014625032770722464 + -7.824014817584977e-05i }, { 0.0014302051412186253 + -0.008403307612011374i, 0.005409279668434522 + 0.00458078543313342i, 0.12666945818184824 + -9.468765398694399e-21i, -0.013989384060779363 + -0.007326766831448225i, -0.00168703982564013 + 0.002371779922011868i, -0.0018025621041133997 + -0.002619050907785458i, -0.03750850070264117 + -0.011916157837962717i, 0.003168951660850159 + 0.0037697331827127993i }, { -0.018846841585045442 + 0.0008715290628706987i, 0.00011572729508501961 + 0.0003586700539377194i, -0.013989384060779365 + 0.007326766831448223i, 0.11112338787591335 + 4.563224294653981e-21i, 0.005925323355370496 + 0.001240058286843297i, -4.105063864860046e-05 + -0.00016260224353504207i, 0.005146587887397625 + -0.0012740862221383201i, -0.03274610880779264 + -0.010533978116990843i }, { -0.0376204055360179 + 0.012919359642020099i, 0.005043815014712765 + 0.0009229783743959768i, -0.00168703982564013 + -0.002371779922011868i, 0.005925323355370497 + -0.0012400582868432966i, 0.13996806003169754 + 6.652331709737686e-20i, -0.016342161390143443 + -0.011031547472847193i, 0.00220843080845608 + 0.009606537450791042i, -0.020864273444801473 + -0.0007433325576973169i }, { 0.003950423429178503 + -0.004206243640965051i, -0.03207655035271341 + 0.010680380420436751i, -0.0018025621041133997 + 0.002619050907785458i, -4.105063864860048e-05 + 0.00016260224353504215i, -0.016342161390143443 + 0.011031547472847191i, 0.12105552987932662 + 8.825684272891951e-20i, 0.005895374327045631 + -0.0056342943277151395i, -0.00011293095093388797 + -0.00025808800891990145i }, { 8.753229054644042e-05 + 0.0029536639159585586i, -0.0027509227520963846 + -0.0004368604609740535i, -0.03750850070264117 + 0.011916157837962718i, 0.005146587887397625 + 0.0012740862221383201i, 0.00220843080845608 + -0.009606537450791043i, 0.005895374327045632 + 0.0056342943277151395i, 0.14511534778724208 + 6.765698626953748e-21i, -0.01630638391418664 + -0.008126085155903205i }, { 0.005063287749281508 + -0.00254466416219002i, -0.00014625032770722464 + 7.824014817584977e-05i, 0.003168951660850159 + -0.0037697331827127993i, -0.03274610880779264 + 0.010533978116990843i, -0.020864273444801473 + 0.0007433325576973167i, -0.00011293095093388829 + 0.00025808800891990167i, -0.01630638391418664 + 0.008126085155903205i, 0.12655464547884282 + 5.446753346949765e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12354617091150023, 1.0e-7), DoubleNear(0.10596739985362895, 1.0e-7), DoubleNear(0.12666945818184824, 1.0e-7), DoubleNear(0.11112338787591335, 1.0e-7), DoubleNear(0.13996806003169754, 1.0e-7), DoubleNear(0.12105552987932662, 1.0e-7), DoubleNear(0.14511534778724208, 1.0e-7), DoubleNear(0.12655464547884282, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false, true}), Matrix({ { 0.1144414652380197 + 1.6355346018666462e-20i, -0.013461852279015647 + -0.008549198575098775i, 0.0015828343006543527 + 0.007822614973620648i, -0.01724512402936927 + -0.0007014147903760049i, 0.00018514831668468634 + 0.00030859679806744434i, -5.103563573690538e-05 + -5.340562441037903e-05i, 4.961117607053157e-05 + 0.0002008686289854749i, 0.00020908737142977382 + -2.664199627890509e-05i }, { -0.013461852279015647 + 0.008549198575098775i, 0.09858965543073972 + 6.179667825534359e-20i, 0.004908631659428106 + -0.00443845606524689i, 5.011979018090958e-06 + -0.000265069023088002i, -3.0391656706555063e-05 + -7.700558198931096e-05i, 0.00010930398677549238 + 0.00018104209355634775i, 0.00024277702831808885 + 0.00023382995943587668i, -1.238568974139593e-05 + 4.260031397769017e-05i }, { 0.0015828343006543525 + -0.00782261497362065i, 0.004908631659428107 + 0.00443845606524689i, 0.11801691683436 + -5.873444399568445e-20i, -0.013154271780703108 + -0.006715811103482258i, 0.00013226106708217074 + 0.00014341597899036884i, 8.579287733810585e-05 + 0.00033316365186070857i, -0.00013872146773182895 + -0.0002270051534179794i, 0.00014369905908316114 + -5.074453624413522e-05i }, { -0.01724512402936927 + 0.0007014147903760047i, 5.011979018090741e-06 + 0.00026506902308800204i, -0.013154271780703108 + 0.006715811103482258i, 0.10321115887201104 + 2.739422494727532e-20i, -0.00011562923013489577 + 0.00017288373121918604i, 1.8321367042230095e-05 + 7.265808145837345e-06i, -0.0001141466606512872 + 0.00010137743979509226i, -0.00015573083572835273 + -0.00026263373820581784i }, { 0.00018514831668468628 + -0.00030859679806744444i, -3.039165670655505e-05 + 7.700558198931098e-05i, 0.00013226106708217066 + -0.00014341597899036881i, -0.00011562923013489576 + -0.00017288373121918604i, 0.14907276570517808 + 4.8604778582372245e-20i, -0.0175317780978113 + -0.011147742269042893i, 0.0020558016490203525 + 0.010187230089181766i, -0.022465991000477643 + -0.0009134468301920107i }, { -5.103563573690537e-05 + 5.340562441037908e-05i, 0.00010930398677549233 + -0.0001810420935563478i, 8.579287733810583e-05 + -0.00033316365186070857i, 1.8321367042230054e-05 + -7.265808145837345e-06i, -0.0175317780978113 + 0.01114774226904289i, 0.12843327430221585 + 1.3128384359075987e-19i, 0.006396022336052047 + -0.00577662369560167i, -2.215634866959207e-06 + -0.000351689039769619i }, { 4.961117607053158e-05 + -0.00020086862898547494i, 0.00024277702831808888 + -0.00023382995943587668i, -0.00013872146773182892 + 0.0002270051534179794i, -0.00011414666065128726 + -0.00010137743979509229i, 0.0020558016490203525 + -0.010187230089181768i, 0.006396022336052047 + 0.00577662369560167i, 0.15376788913473033 + 5.603137722394379e-20i, -0.017141496194262893 + -0.00873704088386917i }, { 0.0002090873714297738 + 2.6641996278905116e-05i, -1.2385689741395927e-05 + -4.260031397769021e-05i, 0.00014369905908316117 + 5.074453624413522e-05i, -0.0001557308357283527 + 0.00026263373820581784i, -0.022465991000477643 + 0.0009134468301920107i, -2.2156348669594237e-06 + 0.000351689039769619i, -0.017141496194262897 + 0.00873704088386917i, 0.13446687448274514 + 3.163653281687632e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1144414652380197, 1.0e-7), DoubleNear(0.09858965543073972, 1.0e-7), DoubleNear(0.11801691683436, 1.0e-7), DoubleNear(0.10321115887201104, 1.0e-7), DoubleNear(0.14907276570517808, 1.0e-7), DoubleNear(0.12843327430221585, 1.0e-7), DoubleNear(0.15376788913473033, 1.0e-7), DoubleNear(0.13446687448274514, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true, false, false}), Matrix({ { 0.19927602820143508 + 2.5402071812354694e-20i, -0.022800916764334406 + -0.013083900421445038i, 0.1658506509827553 + 0.04930500234579478i, -0.01575018919004928 + -0.016516711014447513i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.022800916764334406 + 0.013083900421445038i, 0.17298775471890435 + 2.1480632969156073e-19i, -0.022219396723645042 + 0.00526317187508836i, 0.1439753074054386 + 0.04279255001208961i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.1658506509827553 + -0.04930500234579478i, -0.022219396723645042 + -0.00526317187508836i, 0.336023008710853 + 3.6854986016943346e-20i, -0.038488481587458545 + -0.022065892410048058i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01575018919004928 + 0.01651671101444751i, 0.1439753074054386 + -0.04279255001208961i, -0.038488481587458545 + 0.022065892410048058i, 0.2917132083688074 + 3.7304949918694387e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.19927602820143508, 1.0e-7), DoubleNear(0.17298775471890435, 1.0e-7), DoubleNear(0.336023008710853, 1.0e-7), DoubleNear(0.2917132083688074, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, true, false}), Matrix({ { 0.09311667032535018 + -2.0635635071415933e-20i, -0.010652443083948516 + -0.005954696501394973i, 0.07751711279844165 + 0.023023350860445768i, -0.0073983963329445675 + -0.0075830947924143185i, -0.02796137461079956 + -0.009225614305751115i, 0.0026481144993768407 + 0.0029667312351718744i, -0.021002635713585353 + -0.014605897165682589i, 0.0014732150984623957 + 0.0031243763859200944i }, { -0.010652443083948516 + 0.005954696501394973i, 0.08078868791440824 + 1.0016635506974726e-19i, -0.010344199245965784 + 0.0023273675061612656i, 0.06725475887240234 + 0.01997264632538116i, 0.0037919632733112623 + -0.0008197243156562896i, -0.02412477686637114 + -0.00788082343378251i, 0.0033603326813139204 + 0.0002548719555340598i, -0.018141328437143604 + -0.012533571291036848i }, { 0.07751711279844165 + -0.023023350860445768i, -0.010344199245965784 + -0.002327367506161266i, 0.1570989587679983 + 9.60367717638338e-21i, -0.01798840996351435 + -0.010037463701347726i, -0.025548760119493225 + -0.0007753186951598727i, 0.0029373574226360744 + 0.0018169233444777797i, -0.047167531627859506 + -0.015609903174231702i, 0.00447126059065182 + 0.0050092455885059756i }, { -0.0073983963329445675 + 0.0075830947924143185i, 0.06725475887240234 + -0.01997264632538116i, -0.017988409963514352 + 0.010037463701347726i, 0.13630209981513405 + 9.220548342090674e-21i, 0.0029534521973371185 + -0.0016169556082417011i, -0.022023155306248487 + -0.0006048131845880743i, 0.006398439628799128 + -0.0013773402808780076i, -0.040697882294134916 + -0.013333535103645086i }, { -0.02796137461079956 + 0.009225614305751115i, 0.0037919632733112623 + 0.0008197243156562895i, -0.025548760119493225 + 0.0007753186951598727i, 0.0029534521973371185 + 0.0016169556082417011i, 0.1061593578760849 + 4.6037706883770633e-20i, -0.01214847368038589 + -0.0071292039200500645i, 0.08833353818431368 + 0.02628165148534902i, -0.008351792857104714 + -0.008933616222033194i }, { 0.0026481144993768407 + -0.002966731235171875i, -0.02412477686637114 + 0.007880823433782512i, 0.0029373574226360744 + -0.0018169233444777799i, -0.022023155306248487 + 0.0006048131845880744i, -0.01214847368038589 + 0.0071292039200500645i, 0.0921990668044961 + 1.1463997462181346e-19i, -0.011875197477679256 + 0.002935804368927094i, 0.07672054853303625 + 0.02281990368670845i }, { -0.021002635713585353 + 0.014605897165682589i, 0.0033603326813139204 + -0.0002548719555340599i, -0.047167531627859506 + 0.015609903174231702i, 0.006398439628799128 + 0.0013773402808780074i, 0.08833353818431368 + -0.02628165148534902i, -0.011875197477679256 + -0.002935804368927094i, 0.1789240499428547 + 2.725130884055997e-20i, -0.020500071623944193 + -0.012028428708700332i }, { 0.001473215098462396 + -0.0031243763859200944i, -0.018141328437143604 + 0.012533571291036846i, 0.004471260590651821 + -0.0050092455885059756i, -0.040697882294134916 + 0.013333535103645086i, -0.008351792857104714 + 0.008933616222033192i, 0.07672054853303625 + -0.02281990368670845i, -0.020500071623944193 + 0.012028428708700332i, 0.15541110855367335 + 2.808440157660371e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.09311667032535018, 1.0e-7), DoubleNear(0.08078868791440824, 1.0e-7), DoubleNear(0.1570989587679983, 1.0e-7), DoubleNear(0.13630209981513405, 1.0e-7), DoubleNear(0.1061593578760849, 1.0e-7), DoubleNear(0.0921990668044961, 1.0e-7), DoubleNear(0.1789240499428547, 1.0e-7), DoubleNear(0.15541110855367335, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false, true}), Matrix({ { 0.08672114504816543 + -4.204940070007777e-20i, -0.009922975008953568 + -0.00569477064357176i, 0.0720630616039031 + 0.021478727340529927i, -0.006839786316645124 + -0.00718329238747315i, 2.0061070668177104e-05 + 2.966394627940274e-05i, 3.341986019155062e-05 + -4.174900379533304e-05i, 7.093339653078539e-06 + 3.058617467312512e-05i, 3.8222117230026116e-05 + -2.4809326446934527e-05i }, { -0.009922975008953568 + 0.00569477064357176i, 0.07528087150063018 + 6.456432026222889e-20i, -0.00965846194257499 + 0.0022808045516081446i, 0.06255807754222004 + 0.01864162042045721i, -5.286886246019323e-05 + 1.1551092014898483e-05i, -2.0061070668178323e-05 + -2.9663946279404638e-05i, -4.6853851346763e-05 + -4.677899681430131e-06i, -7.093339653079033e-06 + -3.058617467312702e-05i }, { 0.0720630616039031 + -0.021478727340529927i, -0.00965846194257499 + -0.0022808045516081446i, 0.14573723702421426 + -3.2969727694022226e-22i, -0.016693149050765188 + -0.009570239035009273i, 2.194293259385349e-05 + 2.0179022688285032e-05i, 1.7887551042994333e-05 + -4.1169400106226835e-05i, 2.6365778284680297e-05 + 5.19276983700622e-05i, 5.9243563154705135e-05 + -6.24011568591812e-05i }, { -0.006839786316645124 + 0.00718329238747315i, 0.06255807754222004 + -0.01864162042045721i, -0.016693149050765188 + 0.009570239035009274i, 0.1265199428021206 + 2.4626582940390027e-20i, -4.2396902555223415e-05 + 2.1500679777790614e-05i, -2.194293259385491e-05 + -2.0179022688286347e-05i, -9.166945489764904e-05 + 1.2820765790882817e-05i, -2.6365778284682018e-05 + -5.1927698370065505e-05i }, { 2.006107066817709e-05 + -2.9663946279402713e-05i, -5.286886246019324e-05 + -1.155109201489848e-05i, 2.194293259385349e-05 + -2.0179022688285086e-05i, -4.23969025552234e-05 + -2.150067977779061e-05i, 0.11255488315326964 + 6.745147251243247e-20i, -0.012877941755380836 + -0.007389129777873277i, 0.0937875893788522 + 0.02782627500526486i, -0.008910402873404156 + -0.009333418626974363i }, { 3.341986019155063e-05 + 4.174900379533305e-05i, -2.0061070668178337e-05 + 2.966394627940461e-05i, 1.788755104299436e-05 + 4.1169400106226835e-05i, -2.194293259385491e-05 + 2.017902268828632e-05i, -0.012877941755380836 + 0.007389129777873277i, 0.09770688321827417 + 1.5024200942933183e-19i, -0.01256093478107005 + 0.002982367323480215i, 0.08141722986321856 + 0.024150929591632404i }, { 7.0933396530785116e-06 + -3.058617467312512e-05i, -4.685385134676299e-05 + 4.677899681430131e-06i, 2.6365778284680256e-05 + -5.192769837006225e-05i, -9.166945489764907e-05 + -1.2820765790882823e-05i, 0.0937875893788522 + -0.02782627500526486i, -0.01256093478107005 + -0.0029823673234802154i, 0.19028577168663874 + 3.718468329388357e-20i, -0.021795332536693357 + -0.012495653375038785i }, { 3.822211723002612e-05 + 2.4809326446934527e-05i, -7.09333965307904e-06 + 3.058617467312702e-05i, 5.924356315470517e-05 + 6.240115685918126e-05i, -2.636577828468206e-05 + 5.19276983700654e-05i, -0.008910402873404156 + 0.009333418626974361i, 0.08141722986321856 + -0.024150929591632404i, -0.021795332536693357 + 0.012495653375038784i, 0.1651932655666868 + 1.267836697830436e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.08672114504816543, 1.0e-7), DoubleNear(0.07528087150063018, 1.0e-7), DoubleNear(0.14573723702421426, 1.0e-7), DoubleNear(0.1265199428021206, 1.0e-7), DoubleNear(0.11255488315326964, 1.0e-7), DoubleNear(0.09770688321827417, 1.0e-7), DoubleNear(0.19028577168663874, 1.0e-7), DoubleNear(0.1651932655666868, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, true, false}), Matrix({ { 0.2502156290933485 + -1.103195789503255e-20i, -0.028640853047462864 + -0.0159921602027427i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07512890623865907 + -0.02483551747998282i, 0.007119375090028661 + 0.00797597682367785i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.028640853047462864 + 0.0159921602027427i, 0.2170907877295423 + 1.0938690341183794e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.010190402902110391 + -0.002197064596534297i, -0.06482265916050606 + -0.021214358537427595i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07512890623865907 + 0.02483551747998282i, 0.010190402902110391 + 0.002197064596534297i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2850834078189396 + 7.32890157243306e-20i, -0.03264854530433008 + -0.019157632628750396i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007119375090028662 + -0.00797597682367785i, -0.06482265916050606 + 0.021214358537427598i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03264854530433008 + 0.019157632628750396i, 0.24761017535816945 + 1.4272437619841717e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.2502156290933485, 1.0e-7), DoubleNear(0.2170907877295423, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2850834078189396, 1.0e-7), DoubleNear(0.24761017535816945, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false, true}), Matrix({ { 0.2324583820723797 + -4.237909797701799e-20i, -0.026616124059718756 + -0.015265009678581035i, 0.0 + 0.0i, 0.0 + 0.0i, 4.6426848952857414e-05 + 8.159164464946488e-05i, 9.266342334625575e-05 + -0.00010415016065451425i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.026616124059718756 + 0.015265009678581035i, 0.20180081430275076 + 8.919090320261891e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00014453831735784228 + 2.4371857805781303e-05i, -4.642684895286034e-05 + -8.15916446494702e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.642684895285736e-05 + -8.159164464946488e-05i, -0.0001445383173578423 + -2.4371857805781303e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3028406548399084 + 1.0463615580631604e-19i, -0.03467327429207419 + -0.01988478315291206i, 0.0 + 0.0i, 0.0 + 0.0i }, { 9.26634233462558e-05 + 0.0001041501606545143i, -4.642684895286042e-05 + 8.159164464947003e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03467327429207419 + 0.01988478315291206i, 0.262900148784961 + 1.6292037640763618e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.2324583820723797, 1.0e-7), DoubleNear(0.20180081430275076, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3028406548399084, 1.0e-7), DoubleNear(0.262900148784961, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true, true}), Matrix({ { 0.10679127279315795 + -6.691689319446218e-20i, -0.01220029429999912 + -0.00823744138154452i, -0.03217072460110586 + -0.009582857384531358i, 0.0022243243458836414 + 0.0035826456699764113i, -0.0001963827746087973 + -0.0005335951046012317i, 7.87619750676837e-05 + 0.00014419331123734564i, 2.330790693502575e-05 + -0.0028319626218528604i, -0.00019407883496728353 + 0.0002190863113509651i }, { -0.01220029429999912 + 0.00823744138154452i, 0.09344155455293411 + 2.27775755176967e-20i, 0.005242750734372732 + -0.0013999468247670418i, -0.027988932472496935 + -0.0086635365705665i, -7.560847532427222e-05 + -3.544968766057537e-05i, -0.000250667204983741 + -0.000512929937577571i, 0.00021268576948071949 + 0.00044100325622193834i, 7.218168921706175e-05 + -0.002437390569415543i }, { -0.03217072460110586 + 0.009582857384531358i, 0.005242750734372732 + 0.0013999468247670416i, 0.12566710927922176 + 2.4537795217444188e-20i, -0.014415829759719636 + -0.007027568297036514i, -0.0025647295790869233 + -0.0012274905007553776i, 0.00010520036437259444 + 0.0002626580772365287i, 0.0002428096235616547 + 0.0006151867492506966i, 1.3901448278572047e-05 + -0.0002483434718918599i }, { 0.0022243243458836414 + -0.0035826456699764113i, -0.027988932472496935 + 0.0086635365705665i, -0.014415829759719636 + 0.007027568297036515i, 0.10835925974981667 + 6.641332768492221e-20i, 0.0004920892598969044 + 2.8466248564856382e-06i, -0.002179980254889234 + -0.0010864099522462389i, -6.892984203357006e-05 + 5.9821545466356676e-05i, 0.00020424035603088068 + 0.0004313382929281008i }, { -0.0001963827746087973 + 0.0005335951046012317i, -7.560847532427222e-05 + 3.544968766057538e-05i, -0.0025647295790869233 + 0.0012274905007553776i, 0.0004920892598969044 + -2.8466248564856315e-06i, 0.14342435630019051 + 5.588493529942963e-20i, -0.016440558747463745 + -0.0077547188211981805i, -0.04295818163755322 + -0.015252660095451459i, 0.00489505074414502 + 0.004393331153701439i }, { 7.876197506768371e-05 + -0.00014419331123734564i, -0.000250667204983741 + 0.0005129299375775709i, 0.00010520036437259443 + -0.0002626580772365287i, -0.002179980254889234 + 0.0010864099522462389i, -0.016440558747463745 + 0.0077547188211981805i, 0.12364923317660818 + 8.660932789414124e-20i, 0.004947652167737658 + -0.0007971177717672554i, -0.03683372668800912 + -0.012550821966861095i }, { 2.330790693502566e-05 + 0.0028319626218528604i, 0.00021268576948071954 + -0.00044100325622193834i, 0.00024280962356165465 + -0.0006151867492506966i, -6.892984203357008e-05 + -5.982154546635668e-05i, -0.04295818163755322 + 0.015252660095451459i, 0.004947652167737658 + 0.0007971177717672553i, 0.15941629853971787 + 4.8751220506886415e-20i, -0.018232715544610447 + -0.012130064331713881i }, { -0.00019407883496728345 + -0.0002190863113509651i, 7.218168921706172e-05 + 0.0024373905694155436i, 1.3901448278572084e-05 + 0.00024834347189185994i, 0.0002042403560308806 + -0.00043133829292810085i, 0.0048950507441450205 + -0.004393331153701439i, -0.03683372668800912 + 0.012550821966861097i, -0.018232715544610447 + 0.012130064331713881i, 0.1392509156083528 + 7.631104851349496e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.10679127279315795, 1.0e-7), DoubleNear(0.09344155455293411, 1.0e-7), DoubleNear(0.12566710927922176, 1.0e-7), DoubleNear(0.10835925974981667, 1.0e-7), DoubleNear(0.14342435630019051, 1.0e-7), DoubleNear(0.12364923317660818, 1.0e-7), DoubleNear(0.15941629853971787, 1.0e-7), DoubleNear(0.1392509156083528, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false, false, false}), Matrix({ { 0.2729945886304984 + 1.3580067184005703e-19i, 0.0 + 0.0i, -0.012625706196156414 + -0.09720227621218076i, 0.0 + 0.0i, 0.002026536194951158 + 0.00967963084390892i, 0.0 + 0.0i, 0.003352797961746829 + -0.0011692396823664067i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012625706196156414 + 0.09720227621218076i, 0.0 + 0.0i, 0.21754257204565491 + 1.2223997460708516e-19i, 0.0 + 0.0i, -0.0035402482018536885 + 0.0002738946446824307i, 0.0 + 0.0i, 0.0016148960988746788 + 0.007713456156035876i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0020265361949511574 + -0.00967963084390892i, 0.0 + 0.0i, -0.0035402482018536885 + -0.00027389464468243076i, 0.0 + 0.0i, 0.28352714002753915 + 4.635295759000802e-20i, 0.0 + 0.0i, -0.013112825373507376 + -0.10095248963307701i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003352797961746829 + 0.0011692396823664067i, 0.0 + 0.0i, 0.001614896098874679 + -0.0077134561560358765i, 0.0 + 0.0i, -0.013112825373507376 + 0.100952489633077i, 0.0 + 0.0i, 0.22593569929630736 + 9.974733402402968e-21i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2729945886304984, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21754257204565491, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28352714002753915, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22593569929630736, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false, false, false}), Matrix({ { 0.20717288398760775 + 1.8172402463966337e-19i, 0.0 + 0.0i, -0.009581523128937626 + -0.07376584273724973i, 0.0 + 0.0i, 0.1724248779453309 + 0.05125428904338396i, 0.0 + 0.0i, 0.010275103711322084 + -0.06376394599604732i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009581523128937626 + 0.07376584273724973i, 0.0 + 0.0i, 0.16509089893273166 + 5.848437686425205e-20i, 0.0 + 0.0i, -0.026224034133473826 + 0.059023034478342985i, 0.0 + 0.0i, 0.137401080442863 + 0.040843263314500444i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.1724248779453309 + -0.05125428904338396i, 0.0 + 0.0i, -0.026224034133473826 + -0.059023034478342985i, 0.0 + 0.0i, 0.34934884467042976 + 4.29604790401674e-22i, 0.0 + 0.0i, -0.016157008440726164 + -0.12438892310800805i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010275103711322082 + 0.06376394599604732i, 0.0 + 0.0i, 0.13740108044286298 + -0.040843263314500444i, 0.0 + 0.0i, -0.016157008440726164 + 0.12438892310800805i, 0.0 + 0.0i, 0.2783873724092306 + 7.373033114523606e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.20717288398760775, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.16509089893273166, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.34934884467042976, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2783873724092306, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true, false, false}), Matrix({ { 0.5565217286580375 + 1.8215362943006502e-19i, 0.0 + 0.0i, -0.02573853156966379 + -0.1981547658452578i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02573853156966379 + 0.1981547658452578i, 0.0 + 0.0i, 0.44347827134196227 + 1.322147080094881e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5565217286580375, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.44347827134196227, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, true, false}), Matrix({ { 0.2600661749032686 + 6.273928513820445e-20i, 0.0 + 0.0i, -0.012027780962102441 + -0.09259899360352636i, 0.0 + 0.0i, -0.07788608710434178 + -0.025627756605697553i, 0.0 + 0.0i, -0.005522854615182834 + 0.028917325859002068i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012027780962102441 + 0.09259899360352636i, 0.0 + 0.0i, 0.2072402419196221 + 3.5615660378600936e-20i, 0.0 + 0.0i, 0.012727150183683393 + -0.026546813483695628i, 0.0 + 0.0i, -0.06206547829482334 + -0.020422119411712857i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07788608710434178 + 0.025627756605697553i, 0.0 + 0.0i, 0.012727150183683393 + 0.026546813483695628i, 0.0 + 0.0i, 0.2964555537547689 + 1.1941434429186058e-19i, 0.0 + 0.0i, -0.01371075060756135 + -0.1055557722417314i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005522854615182834 + -0.028917325859002068i, 0.0 + 0.0i, -0.06206547829482334 + 0.020422119411712857i, 0.0 + 0.0i, -0.01371075060756135 + 0.1055557722417314i, 0.0 + 0.0i, 0.23623802942234012 + 9.659904763088717e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2600661749032686, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2072402419196221, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2964555537547689, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23623802942234012, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false, true}), Matrix({ { 0.24167467865233783 + 2.920341795723606e-20i, 0.0 + 0.0i, -0.011177194035318125 + -0.08605052937386382i, 0.0 + 0.0i, -1.6263032587282567e-18 + -2.927345865710862e-18i, 0.0 + 0.0i, -9.486769009248164e-19 + 7.453889935837843e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011177194035318125 + 0.08605052937386382i, 0.0 + 0.0i, 0.19258451772279261 + 1.7608387268364863e-20i, 0.0 + 0.0i, 1.0570971181733668e-18 + -4.336808689942018e-19i, 0.0 + 0.0i, -1.3010426069826053e-18 + -2.2768245622195593e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.6805133673525319e-18 + 2.8189256484623115e-18i, 0.0 + 0.0i, 1.0842021724855044e-18 + 4.743384504624082e-19i, 0.0 + 0.0i, 0.3148470500056997 + 1.5295021147282896e-19i, 0.0 + 0.0i, -0.014561337534345666 + -0.11210423647139398i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -9.215718466126788e-19 + -7.589415207398531e-19i, 0.0 + 0.0i, -1.328147661294743e-18 + 2.2768245622195593e-18i, 0.0 + 0.0i, -0.014561337534345666 + 0.11210423647139398i, 0.0 + 0.0i, 0.25089375361916966 + 1.1460632074112325e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.24167467865233783, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19258451772279261, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3148470500056997, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25089375361916966, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false, false, false}), Matrix({ { 0.18253076048915307 + 2.033581582222406e-19i, 0.0 + 0.0i, 0.001362136761914583 + 0.006475776918604776i, 0.0 + 0.0i, 0.1519611184268011 + 0.04510133339096957i, 0.0 + 0.0i, -0.0004711429392626772 + 0.00571885198375593i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001362136761914583 + -0.006475776918604777i, 0.0 + 0.0i, 0.18973302243118637 + 3.6850243281674833e-20i, 0.0 + 0.0i, 0.002723821788730364 + -0.005057408114016233i, 0.0 + 0.0i, 0.15786483996139283 + 0.04699621896691482i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.1519611184268011 + -0.04510133339096957i, 0.0 + 0.0i, 0.002723821788730364 + 0.005057408114016233i, 0.0 + 0.0i, 0.3080064001870003 + 5.468248822490158e-20i, 0.0 + 0.0i, 0.002279295531911254 + 0.010917310081340018i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004711429392626773 + -0.00571885198375593i, 0.0 + 0.0i, 0.15786483996139283 + -0.04699621896691482i, 0.0 + 0.0i, 0.0022792955319112535 + -0.01091731008134002i, 0.0 + 0.0i, 0.3197298168926601 + 1.9477447710736145e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.18253076048915307, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18973302243118637, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3080064001870003, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3197298168926601, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true, false, false}), Matrix({ { 0.4905371606761533 + 2.580406464471422e-19i, 0.0 + 0.0i, 0.003641432293825837 + 0.017393086999944796i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003641432293825837 + -0.017393086999944796i, 0.0 + 0.0i, 0.5094628393238465 + 5.632769099241098e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4905371606761533, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5094628393238465, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, true, false}), Matrix({ { 0.22951357076512918 + 1.032604866208458e-19i, 0.0 + 0.0i, 0.0015459324363036448 + 0.008044637558073654i, 0.0 + 0.0i, -0.06969695588873132 + -0.02359974006245685i, 0.0 + 0.0i, -5.8718037160784143e-05 + -0.0030319040641344076i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001545932436303645 + -0.008044637558073654i, 0.0 + 0.0i, 0.23779284605776155 + -4.905541104040412e-21i, 0.0 + 0.0i, -0.0017280904642887308 + 0.002209177678476826i, 0.0 + 0.0i, -0.0702546095104338 + -0.02245013595495356i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06969695588873132 + 0.02359974006245685i, 0.0 + 0.0i, -0.0017280904642887306 + -0.002209177678476826i, 0.0 + 0.0i, 0.26102358991102415 + 1.5478015982629636e-19i, 0.0 + 0.0i, 0.0020954998575221924 + 0.009348449441871142i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -5.871803716078425e-05 + 0.003031904064134408i, 0.0 + 0.0i, -0.0702546095104338 + 0.02245013595495356i, 0.0 + 0.0i, 0.002095499857522192 + -0.009348449441871142i, 0.0 + 0.0i, 0.2716699932660849 + 6.12332320964514e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.22951357076512918, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23779284605776155, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26102358991102415, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2716699932660849, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false, true}), Matrix({ { 0.2130311206687594 + 7.815202427401005e-20i, 0.0 + 0.0i, 0.0015878462796724436 + 0.007557545950532647i, 0.0 + 0.0i, 0.0002944523034601787 + 0.0004896388916237921i, 0.0 + 0.0i, 3.7225486329135644e-05 + 0.0002434689429631651i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0015878462796724436 + -0.007557545950532647i, 0.0 + 0.0i, 0.22122807570637104 + -3.1340219048409125e-20i, 0.0 + 0.0i, 0.00015058243412440083 + 0.00015068178713620618i, 0.0 + 0.0i, -0.00029445230346018163 + -0.0004896388916237973i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0002944523034601786 + -0.0004896388916237922i, 0.0 + 0.0i, 0.00015058243412440072 + -0.0001506817871362062i, 0.0 + 0.0i, 0.27750604000739393 + 1.798886221731321e-19i, 0.0 + 0.0i, 0.0020535860141533933 + 0.009835541049412148i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 3.722548632913565e-05 + -0.00024346894296316515i, 0.0 + 0.0i, -0.0002944523034601817 + 0.0004896388916237973i, 0.0 + 0.0i, 0.0020535860141533933 + -0.00983554104941215i, 0.0 + 0.0i, 0.2882347636174754 + 8.766791004082011e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2130311206687594, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22122807570637104, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27750604000739393, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2882347636174754, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true, false, false}), Matrix({ { 0.3722637829203394 + 2.402084015039154e-19i, 0.0 + 0.0i, 0.30982595838819393 + 0.0920975523578844i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.30982595838819393 + -0.0920975523578844i, 0.0 + 0.0i, 0.6277362170796603 + 7.415993593563773e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.3722637829203394, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6277362170796603, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, true, false}), Matrix({ { 0.1739053582397584 + 7.953071999833134e-20i, 0.0 + 0.0i, 0.144771871670844 + 0.042995997185826924i, 0.0 + 0.0i, -0.0520861514771707 + -0.017106437739533627i, 0.0 + 0.0i, -0.03914396415072896 + -0.027139468456719437i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.144771871670844 + -0.042995997185826924i, 0.0 + 0.0i, 0.29340105858313237 + 1.8824225518474048e-20i, 0.0 + 0.0i, -0.047571915425741705 + -0.001380131879747947i, 0.0 + 0.0i, -0.08786541392199441 + -0.028943438277876786i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0520861514771707 + 0.017106437739533624i, 0.0 + 0.0i, -0.04757191542574171 + 0.001380131879747947i, 0.0 + 0.0i, 0.198358424680581 + 1.6067768150558407e-19i, 0.0 + 0.0i, 0.16505408671734995 + 0.04910155517205747i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03914396415072896 + 0.027139468456719433i, 0.0 + 0.0i, -0.08786541392199441 + 0.028943438277876786i, 0.0 + 0.0i, 0.16505408671734992 + -0.04910155517205747i, 0.0 + 0.0i, 0.33433515849652806 + 5.533571041716368e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.1739053582397584, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29340105858313237, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.198358424680581, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.33433515849652806, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false, true}), Matrix({ { 0.1620020165487956 + 2.2514919562151125e-20i, 0.0 + 0.0i, 0.13462113914612314 + 0.040120347760987135i, 0.0 + 0.0i, -1.1655173354219173e-18 + -1.951563910473908e-18i, 0.0 + 0.0i, -4.811147140404426e-19 + -1.8973538018496328e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13462113914612314 + -0.040120347760987135i, 0.0 + 0.0i, 0.27225717982633485 + 2.4296885663449805e-20i, 0.0 + 0.0i, -1.4094628242311558e-18 + -1.2468324983583301e-18i, 0.0 + 0.0i, -1.7076184216646695e-18 + -3.3610267347050637e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.2739375526704677e-18 + 1.8431436932253575e-18i, 0.0 + 0.0i, -1.463672932855431e-18 + 1.2468324983583301e-18i, 0.0 + 0.0i, 0.2102617663715438 + 2.176934819417643e-19i, 0.0 + 0.0i, 0.17520481924207076 + 0.05197720459689727i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -5.285485590866834e-19 + 1.8973538018496328e-18i, 0.0 + 0.0i, -1.81603863891322e-18 + 3.144186300207963e-18i, 0.0 + 0.0i, 0.17520481924207076 + -0.05197720459689727i, 0.0 + 0.0i, 0.3554790372533255 + 4.986305027218793e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.1620020165487956, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27225717982633485, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2102617663715438, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3554790372533255, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, true, false}), Matrix({ { 0.46730641682289076 + 9.83549455168054e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.13995156539916512 + -0.04604987601741041i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.13995156539916512 + 0.04604987601741041i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.532693583177109 + 2.1601339192274777e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.46730641682289076, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.532693583177109, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false, true}), Matrix({ { 0.43425919637513044 + 4.681180522560093e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -2.927345865710862e-18 + -5.421010862427522e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -3.0357660829594124e-18 + 4.9873299934333204e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.5657408036248693 + 2.675565322139522e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.43425919637513044, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5657408036248693, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true, true}), Matrix({ { 0.20023282734609205 + -4.413931767676548e-20i, 0.0 + 0.0i, -0.06015965707360279 + -0.018246393955097858i, 0.0 + 0.0i, -0.0004470499795925383 + -0.0010465250421788027i, 0.0 + 0.0i, 9.548959615208747e-05 + -0.005269353191268403i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06015965707360279 + 0.018246393955097858i, 0.0 + 0.0i, 0.2340263690290384 + 9.095112290236641e-20i, 0.0 + 0.0i, -0.004744709833976157 + -0.002313900453001616i, 0.0 + 0.0i, 0.0004470499795925354 + 0.0010465250421787973i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004470499795925383 + 0.0010465250421788025i, 0.0 + 0.0i, -0.004744709833976157 + 0.002313900453001616i, 0.0 + 0.0i, 0.2670735894767987 + 1.4249426319357088e-19i, 0.0 + 0.0i, -0.07979190832556232 + -0.027803482062312555i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 9.548959615208736e-05 + 0.005269353191268405i, 0.0 + 0.0i, 0.00044704997959253527 + -0.0010465250421787975i, 0.0 + 0.0i, -0.07979190832556232 + 0.027803482062312555i, 0.0 + 0.0i, 0.2986672141480706 + 1.2506226902038136e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.20023282734609205, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2340263690290384, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2670735894767987, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2986672141480706, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false, false, false}), Matrix({ { 0.1015823343606897 + 1.66302165837148e-19i, -0.004698073741284807 + -0.03616934010428496i, 0.0007580587054093655 + 0.00360391056514575i, 0.0012481466589235163 + -0.00043659087976401104i, 0.08456966431569213 + 0.025099872023524865i, 0.0050257881134068445 + -0.031272661932763665i, -0.000262201283003494 + 0.0031826653919392973i, 0.001145344303160881 + -5.38356335168941e-05i }, { -0.004698073741284807 + 0.03616934010428496i, 0.08094842612846335 + 3.7055992385092584e-20i, -0.0013182654590209928 + 0.00010323690244879271i, 0.0006040780565052175 + 0.0028718663534590258i, -0.012848300201386121 + 0.028950977746128863i, 0.06739145411110897 + 0.02000146136744471i, -0.0011210912483288074 + -0.0002405540711353787i, -0.00020894165625918318 + 0.0025361865918166315i }, { 0.0007580587054093653 + -0.003603910565145751i, -0.0013182654590209928 + -0.00010323690244879275i, 0.10559054962691808 + 1.542185880251536e-20i, -0.004883449387652819 + -0.03759650263296478i, 0.0015158660104206503 + -0.0028145575061415003i, -0.0010722566937161682 + -0.00040956801034679603i, 0.08785521362963879 + 0.026154417019859093i, 0.00524931559791524 + -0.032491284063283665i }, { 0.0012481466589235163 + 0.0004365908797640111i, 0.0006040780565052175 + -0.0028718663534590258i, -0.004883449387652819 + 0.03759650263296478i, 0.08414247280426829 + 2.142838447915948e-20i, 0.000932042347517419 + 0.0006699085271533573i, 0.0012079557783097137 + -0.002242850607874733i, -0.013375733932087703 + 0.030072056732214122i, 0.07000962633175403 + 0.02084180194705573i }, { 0.08456966431569213 + -0.025099872023524865i, -0.012848300201386121 + -0.028950977746128863i, 0.0015158660104206503 + 0.0028145575061415i, 0.0009320423475174189 + -0.0006699085271533573i, 0.17141225426980872 + -3.050149399709099e-20i, -0.007927632454871606 + -0.06103293610789581i, 0.0012684774895417924 + 0.0060757202787631685i, 0.0021046513028233124 + -0.0007326488026023958i }, { 0.0050257881134068445 + 0.031272661932763665i, 0.06739145411110897 + -0.02000146136744471i, -0.0010722566937161682 + 0.0004095680103467959i, 0.0012079557783097137 + 0.0022428506078747325i, -0.007927632454871606 + 0.06103293610789581i, 0.13659414591719155 + 8.518398222199257e-20i, -0.0022219827428326955 + 0.00017065774223363797i, 0.0010108180423694614 + 0.00484158980257685i }, { -0.00026220128300349417 + -0.0031826653919392973i, -0.0011210912483288077 + 0.00024055407113537868i, 0.08785521362963879 + -0.026154417019859093i, -0.013375733932087703 + -0.030072056732214122i, 0.0012684774895417921 + -0.006075720278763169i, -0.0022219827428326955 + -0.000170657742233638i, 0.17793659040062107 + 3.093109878749266e-20i, -0.008229375985854558 + -0.06335598700011222i }, { 0.001145344303160881 + 5.383563351689411e-05i, -0.00020894165625918315 + -0.002536186591816632i, 0.00524931559791524 + 0.032491284063283665i, 0.07000962633175403 + -0.02084180194705573i, 0.0021046513028233124 + 0.0007326488026023957i, 0.0010108180423694616 + -0.004841589802576851i, -0.008229375985854558 + 0.06335598700011222i, 0.14179322649203907 + -1.1453651076756515e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1015823343606897, 1.0e-7), DoubleNear(0.08094842612846335, 1.0e-7), DoubleNear(0.10559054962691808, 1.0e-7), DoubleNear(0.08414247280426829, 1.0e-7), DoubleNear(0.17141225426980872, 1.0e-7), DoubleNear(0.13659414591719155, 1.0e-7), DoubleNear(0.17793659040062107, 1.0e-7), DoubleNear(0.14179322649203907, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true, false, false}), Matrix({ { 0.2729945886304984 + 1.3580067184005703e-19i, -0.012625706196156414 + -0.09720227621218076i, 0.002026536194951158 + 0.00967963084390892i, 0.003352797961746829 + -0.0011692396823664067i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012625706196156414 + 0.09720227621218076i, 0.21754257204565491 + 1.2223997460708516e-19i, -0.0035402482018536885 + 0.0002738946446824307i, 0.0016148960988746788 + 0.007713456156035876i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0020265361949511574 + -0.00967963084390892i, -0.0035402482018536885 + -0.00027389464468243076i, 0.28352714002753915 + 4.635295759000802e-20i, -0.013112825373507376 + -0.10095248963307701i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003352797961746829 + 0.0011692396823664067i, 0.001614896098874679 + -0.0077134561560358765i, -0.013112825373507376 + 0.100952489633077i, 0.22593569929630736 + 9.974733402402968e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2729945886304984, 1.0e-7), DoubleNear(0.21754257204565491, 1.0e-7), DoubleNear(0.28352714002753915, 1.0e-7), DoubleNear(0.22593569929630736, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, true, false}), Matrix({ { 0.12772928915268855 + 5.613723183049492e-20i, -0.005907342286804543 + -0.04547920787327318i, 0.000860344991840236 + 0.004477015600246524i, 0.0015542932408136828 + -0.0005133910376833195i, -0.038787870373399744 + -0.013133768135438833i, -0.002882503666633511 + 0.014418206628892219i, -3.2677863544126484e-05 + -0.0016873204908974104i, -0.0005992749238406676 + 8.967201737540375e-05i }, { -0.005907342286804543 + 0.045479207873273184i, 0.10178428161244063 + 4.7123254790350877e-20i, -0.00163387330244642 + 9.927672217335584e-05i, 0.0006855874444634087 + 0.0035676219578271292i, 0.006470298265536662 + -0.01320336131962541i, -0.03090908551533156 + -0.010465971927018019i, 0.0006022975559470107 + 6.640149956642705e-05i, -2.604017361665766e-05 + -0.0013445835732369975i }, { 0.0008603449918402361 + -0.004477015600246525i, -0.00163387330244642 + -9.927672217335598e-05i, 0.1323368857505801 + 6.60205330770952e-21i, -0.0061204386752979 + -0.04711978573025318i, -0.0009617198924634353 + 0.0012294553805386734i, 0.0004822375965594761 + 0.000285568371890084i, -0.039098216730942034 + -0.012493988470258722i, -0.0026403509485493234 + 0.014499119230109849i }, { 0.0015542932408136828 + 0.0005133910376833195i, 0.0006855874444634089 + -0.0035676219578271297i, -0.0061204386752979 + 0.04711978573025318i, 0.10545596030718148 + -1.150759441174993e-20i, -0.0003932805746188153 + -0.0003992903507310287i, -0.0007663705718252954 + 0.0009797222979381522i, 0.0062568519181467296 + -0.013343452164070218i, -0.031156392779491775 + -0.009956147484694842i }, { -0.038787870373399744 + 0.013133768135438833i, 0.006470298265536662 + 0.01320336131962541i, -0.0009617198924634352 + -0.0012294553805386737i, -0.00039328057461881523 + 0.00039929035073102865i, 0.14526529947780986 + 7.966344000956208e-20i, -0.006718363909351871 + -0.05172306833890759i, 0.0011661912031109218 + 0.005202615243662395i, 0.0017985047209331463 + -0.0006558486446830872i }, { -0.002882503666633511 + -0.014418206628892219i, -0.030909085515331565 + 0.010465971927018019i, 0.0004822375965594761 + -0.0002855683718900839i, -0.0007663705718252954 + -0.0009797222979381522i, -0.006718363909351871 + 0.05172306833890759i, 0.11575829043321427 + 7.511671981673428e-20i, -0.0019063748994072682 + 0.00017461792250907484i, 0.0009293086544112702 + 0.0041458341982087464i }, { -3.2677863544126565e-05 + 0.0016873204908974106i, 0.0006022975559470107 + -6.640149956642706e-05i, -0.039098216730942034 + 0.012493988470258722i, 0.0062568519181467296 + 0.013343452164070218i, 0.0011661912031109213 + -0.005202615243662395i, -0.001906374899407268 + -0.0001746179225090748i, 0.15119025427695904 + 3.97509042822985e-20i, -0.006992386698209476 + -0.053832703902823825i }, { -0.0005992749238406676 + -8.967201737540375e-05i, -2.6040173616657687e-05 + 0.0013445835732369975i, -0.002640350948549323 + -0.014499119230109849i, -0.031156392779491775 + 0.009956147484694842i, 0.0017985047209331463 + 0.0006558486446830873i, 0.0009293086544112702 + -0.0041458341982087464i, -0.006992386698209476 + 0.053832703902823825i, 0.1204797389891259 + 2.1482327814152897e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12772928915268855, 1.0e-7), DoubleNear(0.10178428161244063, 1.0e-7), DoubleNear(0.1323368857505801, 1.0e-7), DoubleNear(0.10545596030718148, 1.0e-7), DoubleNear(0.14526529947780986, 1.0e-7), DoubleNear(0.11575829043321427, 1.0e-7), DoubleNear(0.15119025427695904, 1.0e-7), DoubleNear(0.1204797389891259, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false, true}), Matrix({ { 0.118556447532537 + 3.930152348768934e-20i, -0.005483108224653721 + -0.042213131833870876i, 0.0008836709564065421 + 0.004205938536802982i, 0.0014566949165954505 + -0.0005091594427837263i, 0.00016386910492899976 + 0.00027249468238467836i, 8.944551001007403e-05 + -7.094971331454265e-05i, 2.0716792002026722e-05 + 0.00013549575701240582i, 4.728640202837986e-05 + -1.3642940601715818e-05i }, { -0.005483108224653721 + 0.042213131833870876i, 0.0944746731362224 + 3.885050078632072e-20i, -0.0015384325797896956 + 0.00012011917270978733i, 0.0007041753232659015 + 0.003351607413729666i, -0.00010460304982681413 + 4.5744541174954345e-05i, 0.00013058319853117897 + 0.00021714420923911378i, -4.920266073853696e-05 + 1.1098744523356159e-06i, 1.6508694327108922e-05 + 0.00010797318595075927i }, { 0.0008836709564065422 + -0.004205938536802982i, -0.0015384325797896956 + -0.00012011917270978746i, 0.12311823111980086 + -1.0098105530453274e-20i, -0.005694085810664403 + -0.043837397539992926i, 8.380239654444663e-05 + 8.385768865432392e-05i, 2.5982543512572215e-05 + -3.371695490950822e-05i, -0.0001638691049290014 + -0.00027249468238468123i, -8.9445510010075e-05 + 7.094971331454339e-05i }, { 0.0014566949165954505 + 0.0005091594427837263i, 0.0007041753232659015 + -0.0033516074137296663i, -0.005694085810664403 + 0.043837397539992926i, 0.09810984458657021 + -2.1242113517955854e-20i, -3.373408498166763e-05 + 2.5960299039150995e-05i, 6.67800375799542e-05 + 6.682409848188226e-05i, 0.0001046030498268152 + -4.574454117495479e-05i, -0.0001305831985311803 + -0.0002171442092391161i }, { 0.00016386910492899968 + -0.00027249468238467836i, -0.0001046030498268141 + -4.574454117495434e-05i, 8.380239654444658e-05 + -8.385768865432393e-05i, -3.3734084981667624e-05 + -2.5960299039150988e-05i, 0.1544381410979614 + 9.649914835236768e-20i, -0.007142597971502692 + -0.05498914437830989i, 0.0011428652385446158 + 0.005473692307105938i, 0.0018961030451513786 + -0.0006600802395826805i }, { 8.944551001007408e-05 + 7.094971331454263e-05i, 0.00013058319853117894 + -0.00021714420923911383i, 2.598254351257221e-05 + 3.37169549095082e-05i, 6.678003757995416e-05 + -6.682409848188225e-05i, -0.007142597971502692 + 0.05498914437830989i, 0.1230678989094325 + 8.338947382076444e-20i, -0.002001815622063993 + 0.00015377547197264335i, 0.0009107207756087774 + 0.004361848742306209i }, { 2.0716792002026715e-05 + -0.00013549575701240585i, -4.9202660738536964e-05 + -1.1098744523356184e-06i, -0.0001638691049290014 + 0.00027249468238468123i, 0.00010460304982681521 + 4.574454117495479e-05i, 0.0011428652385446153 + -0.005473692307105938i, -0.002001815622063993 + -0.0001537754719726433i, 0.1604089089077383 + 5.645106312046129e-20i, -0.0074187395628429725 + -0.05711509209308408i }, { 4.7286402028379867e-05 + 1.3642940601715825e-05i, 1.6508694327108936e-05 + -0.00010797318595075931i, -8.944551001007499e-05 + -7.094971331454339e-05i, -0.0001305831985311803 + 0.000217144209239116i, 0.0018961030451513786 + 0.0006600802395826806i, 0.0009107207756087776 + -0.00436184874230621i, -0.0074187395628429725 + 0.057115092093084074i, 0.12782585470973715 + 3.121684692035882e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.118556447532537, 1.0e-7), DoubleNear(0.0944746731362224, 1.0e-7), DoubleNear(0.12311823111980086, 1.0e-7), DoubleNear(0.09810984458657021, 1.0e-7), DoubleNear(0.1544381410979614, 1.0e-7), DoubleNear(0.1230678989094325, 1.0e-7), DoubleNear(0.1604089089077383, 1.0e-7), DoubleNear(0.12782585470973715, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true, false, false}), Matrix({ { 0.20717288398760775 + 1.8172402463966337e-19i, -0.009581523128937626 + -0.07376584273724973i, 0.1724248779453309 + 0.05125428904338396i, 0.010275103711322084 + -0.06376394599604732i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009581523128937626 + 0.07376584273724973i, 0.16509089893273166 + 5.848437686425205e-20i, -0.026224034133473826 + 0.059023034478342985i, 0.137401080442863 + 0.040843263314500444i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.1724248779453309 + -0.05125428904338396i, -0.026224034133473826 + -0.059023034478342985i, 0.34934884467042976 + 4.29604790401674e-22i, -0.016157008440726164 + -0.12438892310800805i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010275103711322082 + 0.06376394599604732i, 0.13740108044286298 + -0.040843263314500444i, -0.016157008440726164 + 0.12438892310800805i, 0.2783873724092306 + 7.373033114523606e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.20717288398760775, 1.0e-7), DoubleNear(0.16509089893273166, 1.0e-7), DoubleNear(0.34934884467042976, 1.0e-7), DoubleNear(0.2783873724092306, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, true, false}), Matrix({ { 0.09678211059048566 + 6.039570828368315e-20i, -0.004476068553187714 + -0.034460175541235i, 0.08056869228331769 + 0.02392820667923252i, 0.004793646365241565 + -0.029793890162852384i, -0.02898707505921944 + -0.009520104301986347i, -0.002049101110586318 + 0.010761413737542863i, -0.021784466595691936 + -0.015103703900393787i, -0.004370306860150675 + 0.00845509311620003i }, { -0.004476068553187714 + 0.034460175541235004i, 0.07712324764927275 + 1.9135011714648193e-20i, -0.01224607714404023 + 0.02758058250097922i, 0.0642031793875263 + 0.019067790506594403i, 0.004730343218861215 + -0.009880824561935914i, -0.02309907641795126 + -0.007586333437547279i, 0.006385323174261326 + -0.007058032984885694i, -0.017359497555037025 + -0.01203576455632565i }, { 0.08056869228331769 + -0.02392820667923252i, -0.012246077144040232 + -0.02758058250097922i, 0.16328406431278297 + 2.3435768545213023e-21i, -0.007551712408914729 + -0.05813881806229136i, -0.026474804608307742 + -0.0007680733794933945i, 0.0009509515375477993 + 0.009462124329955447i, -0.04889901204512234 + -0.016107652303711206i, -0.003473753504596516 + 0.018155912121459204i }, { 0.004793646365241565 + 0.029793890162852384i, 0.0642031793875263 + -0.019067790506594403i, -0.007551712408914729 + 0.05813881806229136i, 0.13011699427034937 + 1.6480648663952743e-20i, 0.0014979109564818589 + -0.009391079194041065i, -0.021097110817433963 + -0.0006120585002545524i, 0.007996806964822177 + -0.016665988921759713i, -0.03896640187687207 + -0.01283578597416558i }, { -0.02898707505921944 + 0.009520104301986347i, 0.004730343218861215 + 0.009880824561935914i, -0.026474804608307742 + 0.0007680733794933945i, 0.001497910956481859 + 0.009391079194041065i, 0.1103907733971221 + 1.213283163559802e-19i, -0.005105454575749913 + -0.039305667196014735i, 0.09185618566201323 + 0.027326082364151433i, 0.005481457346080519 + -0.03397005583319494i }, { -0.002049101110586318 + -0.010761413737542863i, -0.02309907641795126 + 0.007586333437547279i, 0.000950951537547799 + -0.009462124329955447i, -0.021097110817433963 + 0.0006120585002545524i, -0.005105454575749913 + 0.039305667196014735i, 0.0879676512834589 + 3.934936514960386e-20i, -0.013977956989433594 + 0.03144245197736376i, 0.07319790105533669 + 0.021775472807906038i }, { -0.021784466595691936 + 0.015103703900393783i, 0.006385323174261325 + 0.007058032984885694i, -0.04889901204512234 + 0.016107652303711206i, 0.007996806964822177 + 0.016665988921759713i, 0.09185618566201323 + -0.027326082364151433i, -0.013977956989433594 + -0.03144245197736376i, 0.1860647803576468 + -1.9139720641196283e-21i, -0.008605296031811436 + -0.06625010504571667i }, { -0.004370306860150675 + -0.00845509311620003i, -0.017359497555037025 + 0.01203576455632565i, -0.0034737535045965165 + -0.018155912121459204i, -0.03896640187687207 + 0.01283578597416558i, 0.005481457346080519 + 0.03397005583319494i, 0.07319790105533669 + -0.021775472807906038i, -0.008605296031811436 + 0.06625010504571667i, 0.14827037813888125 + 5.724968248128331e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.09678211059048566, 1.0e-7), DoubleNear(0.07712324764927275, 1.0e-7), DoubleNear(0.16328406431278297, 1.0e-7), DoubleNear(0.13011699427034937, 1.0e-7), DoubleNear(0.1103907733971221, 1.0e-7), DoubleNear(0.0879676512834589, 1.0e-7), DoubleNear(0.1860647803576468, 1.0e-7), DoubleNear(0.14827037813888125, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false, true}), Matrix({ { 0.09015764229582375 + 3.944481003533081e-20i, -0.004169694017290372 + -0.03210147165568617i, 0.07491958907151468 + 0.02232784529030619i, 0.004485087676352126 + -0.02770845914275396i, -6.505213034913027e-19 + -1.0842021724855044e-18i, -3.5236570605778894e-19 + 2.981555974335137e-19i, -2.608861477543245e-19 + -1.0842021724855044e-18i, -3.6591823321385775e-19 + 1.5246593050577406e-19i }, { -0.004169694017290372 + 0.03210147165568617i, 0.07184437425297185 + -1.6929890473179696e-20i, -0.011414988556065313 + 0.025643181467889846i, 0.05970155007460847 + 0.017792502470680947i, 3.9302328752599536e-19 + -1.9651164376299768e-19i, -5.421010862427522e-19 + -8.402566836762659e-19i, 3.9302328752599536e-19 + -4.573977915173222e-20i, -2.270048298641525e-19 + -8.131516293641283e-19i }, { 0.07491958907151468 + -0.02232784529030619i, -0.011414988556065313 + -0.025643181467889846i, 0.1515170363565141 + -1.0241392078094745e-20i, -0.007007500018027753 + -0.05394905771817764i, -7.860465750519907e-19 + -7.589415207398531e-19i, -2.168404344971009e-19 + 3.1170812458958252e-19i, -9.75781955236954e-19 + -1.8431436932253575e-18i, -6.098637220230962e-19 + 4.472333961502706e-19i }, { 0.004485087676352126 + 0.02770845914275396i, 0.059701550074608464 + -0.017792502470680947i, -0.007007500018027753 + 0.05394905771817764i, 0.12074014346982076 + 3.4538277741544555e-20i, 2.913793338554793e-19 + -2.439454888092385e-19i, -6.505213034913027e-19 + -5.55653613398821e-19i, 6.776263578034403e-19 + -2.439454888092385e-19i, -7.453889935837843e-19 + -1.4094628242311558e-18i }, { -6.911788849595091e-19 + 1.0842021724855044e-18i, 4.0657581468206416e-19 + 1.9651164376299768e-19i, -8.131516293641283e-19 + 7.318364664277155e-19i, 2.846030702774449e-19 + 2.507217523872729e-19i, 0.11701524169178401 + 1.4227921460433256e-19i, -0.005411829111647254 + -0.04166437108156357i, 0.09750528887381624 + 0.028926443753077763i, 0.005790016034969958 + -0.036055486853293364i }, { -3.2526065174565133e-19 + -3.049318610115481e-19i, -5.55653613398821e-19 + 8.402566836762659e-19i, -1.9651164376299768e-19 + -3.2526065174565133e-19i, -6.369687763352339e-19 + 5.285485590866834e-19i, -0.005411829111647254 + 0.04166437108156357i, 0.0932465246797598 + 7.541426733743174e-20i, -0.014809045577408513 + 0.03337985301045314i, 0.07769953036825453 + 0.023050760843819497i }, { -2.846030702774449e-19 + 1.0842021724855044e-18i, 3.9302328752599536e-19 + 4.743384504624082e-20i, -1.0299920638612292e-18 + 1.734723475976807e-18i, 6.776263578034403e-19 + 2.710505431213761e-19i, 0.09750528887381624 + -0.028926443753077763i, -0.014809045577408513 + -0.03337985301045314i, 0.19783180831391567 + 1.0670996868496419e-20i, -0.009149508422698412 + -0.07043986538983041i }, { -3.7947076036992655e-19 + -1.6263032587282567e-19i, -2.270048298641525e-19 + 8.131516293641283e-19i, -5.692061405548898e-19 + -4.472333961502706e-19i, -7.860465750519907e-19 + 1.4094628242311558e-18i, 0.005790016034969957 + 0.036055486853293364i, 0.07769953036825453 + -0.023050760843819497i, -0.009149508422698412 + 0.07043986538983041i, 0.15764722893940986 + 3.91920534036915e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.09015764229582375, 1.0e-7), DoubleNear(0.07184437425297185, 1.0e-7), DoubleNear(0.1515170363565141, 1.0e-7), DoubleNear(0.12074014346982076, 1.0e-7), DoubleNear(0.11701524169178401, 1.0e-7), DoubleNear(0.0932465246797598, 1.0e-7), DoubleNear(0.19783180831391567, 1.0e-7), DoubleNear(0.15764722893940986, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, true, false}), Matrix({ { 0.2600661749032686 + 6.273928513820445e-20i, -0.012027780962102441 + -0.09259899360352636i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07788608710434178 + -0.025627756605697553i, -0.005522854615182834 + 0.028917325859002068i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012027780962102441 + 0.09259899360352636i, 0.2072402419196221 + 3.5615660378600936e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.012727150183683393 + -0.026546813483695628i, -0.06206547829482334 + -0.020422119411712857i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07788608710434178 + 0.025627756605697553i, 0.012727150183683393 + 0.026546813483695628i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2964555537547689 + 1.1941434429186058e-19i, -0.01371075060756135 + -0.1055557722417314i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005522854615182834 + -0.028917325859002068i, -0.06206547829482334 + 0.020422119411712857i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01371075060756135 + 0.1055557722417314i, 0.23623802942234012 + 9.659904763088717e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.2600661749032686, 1.0e-7), DoubleNear(0.2072402419196221, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2964555537547689, 1.0e-7), DoubleNear(0.23623802942234012, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false, true}), Matrix({ { 0.24167467865233783 + 2.920341795723606e-20i, -0.011177194035318125 + -0.08605052937386382i, 0.0 + 0.0i, 0.0 + 0.0i, -1.6263032587282567e-18 + -2.927345865710862e-18i, -9.486769009248164e-19 + 7.453889935837843e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011177194035318125 + 0.08605052937386382i, 0.19258451772279261 + 1.7608387268364863e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 1.0570971181733668e-18 + -4.336808689942018e-19i, -1.3010426069826053e-18 + -2.2768245622195593e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.6805133673525319e-18 + 2.8189256484623115e-18i, 1.0842021724855044e-18 + 4.743384504624082e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3148470500056997 + 1.5295021147282896e-19i, -0.014561337534345666 + -0.11210423647139398i, 0.0 + 0.0i, 0.0 + 0.0i }, { -9.215718466126788e-19 + -7.589415207398531e-19i, -1.328147661294743e-18 + 2.2768245622195593e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014561337534345666 + 0.11210423647139398i, 0.25089375361916966 + 1.1460632074112325e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.24167467865233783, 1.0e-7), DoubleNear(0.19258451772279261, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3148470500056997, 1.0e-7), DoubleNear(0.25089375361916966, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true, true}), Matrix({ { 0.11143391920873354 + -1.9099285560460998e-20i, -0.00515369894793043 + -0.03967708901729881i, -0.033480156350076166 + -0.01015451470566663i, -0.00206718868888367 + 0.012390558147596577i, -0.0002487930274393799 + -0.000582413925557273i, -0.0001958675146711791 + 0.0001155211018638496i, 5.314203511941762e-05 + -0.0029325095469144393i, -0.0010466052097568876 + 0.00011670369489899534i }, { -0.00515369894793043 + 0.03967708901729881i, 0.0887989081373585 + -2.5040032116304485e-20i, 0.005164031154501817 + -0.01145128737390496i, -0.026679500723526622 + -0.008091879249431229i, 0.00021888033469709926 + -6.164906619072387e-05i, -0.0001982569521531584 + -0.0004641111166215296i, 0.0010416896857866178 + 0.0001545471320313456i, 4.2347561032669865e-05 + -0.002336843644353964i }, { -0.033480156350076166 + 0.01015451470566663i, 0.005164031154501817 + 0.01145128737390496i, 0.1302407594436043 + 4.830270351769706e-20i, -0.0060234950873876945 + -0.046373440356565i, -0.002640534118785202 + -0.001287735880047076i, -0.0003363885386030817 + 0.0009997432660138789i, 0.00024879302743937827 + 0.0005824139255572701i, 0.00019586751467117814 + -0.00011552110186384885i }, { -0.0020671886888836703 + -0.012390558147596577i, -0.026679500723526622 + 0.008091879249431229i, -0.0060234950873876945 + 0.046373440356565i, 0.1037856095854341 + 4.264841938466935e-20i, 0.0005806322663044609 + -0.000880630466296596i, -0.0021041757151909553 + -0.0010261645729545401i, -0.0002188803346970982 + 6.164906619072344e-05i, 0.0001982569521531571 + 0.00046411111662152734i }, { -0.00024879302743937984 + 0.0005824139255572729i, 0.0002188803346970993 + 6.164906619072386e-05i, -0.0026405341187852017 + 0.001287735880047076i, 0.0005806322663044609 + 0.000880630466296596i, 0.1486322556945351 + 8.183857069866545e-20i, -0.006874082014172012 + -0.05292190458622756i, -0.04440593075426562 + -0.015473241900030923i, -0.0034556659262991642 + 0.01652676771140549i }, { -0.00019586751467117906 + -0.00011552110186384954i, -0.0001982569521531584 + 0.0004641111166215296i, -0.00033638853860308164 + -0.0009997432660138789i, -0.0021041757151909553 + 0.0010261645729545403i, -0.006874082014172012 + 0.05292190458622756i, 0.1184413337822636 + 6.065569249490542e-20i, 0.007563119029181576 + -0.015095526109790668i, -0.03538597757129672 + -0.012330240162281628i }, { 5.314203511941758e-05 + 0.0029325095469144393i, 0.0010416896857866178 + -0.0001545471320313456i, 0.00024879302743937816 + -0.0005824139255572701i, -0.0002188803346970982 + -6.164906619072339e-05i, -0.04440593075426562 + 0.015473241900030923i, 0.007563119029181576 + 0.015095526109790668i, 0.1662147943111646 + 7.111164077416351e-20i, -0.007687255520173654 + -0.05918233188516641i }, { -0.0010466052097568876 + -0.00011670369489899534i, 4.234756103266979e-05 + 0.002336843644353964i, 0.00019586751467117814 + 0.00011552110186384878i, 0.00019825695215315708 + -0.00046411111662152734i, -0.0034556659262991642 + -0.01652676771140549i, -0.03538597757129672 + 0.012330240162281628i, -0.007687255520173654 + 0.05918233188516641i, 0.13245241983690603 + 5.3950628246217826e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.11143391920873354, 1.0e-7), DoubleNear(0.0887989081373585, 1.0e-7), DoubleNear(0.1302407594436043, 1.0e-7), DoubleNear(0.1037856095854341, 1.0e-7), DoubleNear(0.1486322556945351, 1.0e-7), DoubleNear(0.1184413337822636, 1.0e-7), DoubleNear(0.1662147943111646, 1.0e-7), DoubleNear(0.13245241983690603, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true, false, false}), Matrix({ { 0.18253076048915307 + 2.033581582222406e-19i, 0.001362136761914583 + 0.006475776918604776i, 0.1519611184268011 + 0.04510133339096957i, -0.0004711429392626772 + 0.00571885198375593i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001362136761914583 + -0.006475776918604777i, 0.18973302243118637 + 3.6850243281674833e-20i, 0.002723821788730364 + -0.005057408114016233i, 0.15786483996139283 + 0.04699621896691482i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.1519611184268011 + -0.04510133339096957i, 0.002723821788730364 + 0.005057408114016233i, 0.3080064001870003 + 5.468248822490158e-20i, 0.002279295531911254 + 0.010917310081340018i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004711429392626773 + -0.00571885198375593i, 0.15786483996139283 + -0.04699621896691482i, 0.0022792955319112535 + -0.01091731008134002i, 0.3197298168926601 + 1.9477447710736145e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.18253076048915307, 1.0e-7), DoubleNear(0.18973302243118637, 1.0e-7), DoubleNear(0.3080064001870003, 1.0e-7), DoubleNear(0.3197298168926601, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, true, false}), Matrix({ { 0.0853735057640482 + 9.379669121267371e-20i, 0.0005783742134844432 + 0.0029974660845117863i, 0.07109339990128327 + 0.021080635340438976i, -0.00026358047569606893 + 0.002633405201811576i, -0.025938750239147636 + -0.00876856063071903i, -2.181246185279148e-05 + -0.0011234700202744884i, -0.019428704114704643 + -0.013725637658124939i, 0.0002524891840422086 + -0.0009409803059908376i }, { 0.0005783742134844433 + -0.0029974660845117863i, 0.08853185247571022 + -1.4265971214342374e-20i, 0.00122022522982772 + -0.002352133413017919i, 0.07367847176956072 + 0.02191536184538795i, -0.0006389929934607038 + 0.0008216625316018186i, -0.026147401238023064 + -0.008337877108814595i, -0.0007351352047481983 + 0.0005328548875045758i, -0.019715260036024314 + -0.013413830798594496i }, { 0.07109339990128327 + -0.021080635340438976i, 0.00122022522982772 + 0.0023521334130179187i, 0.14414006500108098 + 9.463795408172086e-21i, 0.0009675582228192015 + 0.005047171473561867i, -0.02375750993523776 + -0.0008918917283517425i, -0.00028870921511916993 + -0.0009330647804753335i, -0.04375820564958367 + -0.014831179431737819i, -3.6905575307992665e-05 + -0.0019084340438599193i }, { -0.0002635804756960689 + -0.002633405201811576i, 0.07367847176956072 + -0.02191536184538795i, 0.0009675582228192015 + -0.005047171473561868i, 0.14926099358205136 + 9.360430110301962e-21i, -0.00033158580846433765 + 0.0008347289612207459i, -0.023814405490503947 + -0.0004882401513962044i, -0.001089097470828027 + 0.0013875151468750074i, -0.04410720827241074 + -0.014112258846138967i }, { -0.025938750239147636 + 0.00876856063071903i, -0.0006389929934607037 + -0.0008216625316018186i, -0.023757509935237762 + 0.0008918917283517425i, -0.0003315858084643377 + -0.0008347289612207459i, 0.09715725472510485 + 1.0956146700956688e-19i, 0.0007837625484301398 + 0.00347831083409299i, 0.08086771852551783 + 0.024020698050530594i, -0.00020756246356660828 + 0.003085446781944354i }, { -2.181246185279152e-05 + 0.0011234700202744884i, -0.026147401238023064 + 0.008337877108814595i, -0.00028870921511916993 + 0.0009330647804753335i, -0.023814405490503947 + 0.00048824015139620436i, 0.0007837625484301395 + -0.0034783108340929905i, 0.10120116995547615 + 5.111621449601721e-20i, 0.001503596558902644 + -0.0027052747009983142i, 0.0841863681918321 + 0.025080857121526877i }, { -0.019428704114704643 + 0.013725637658124937i, -0.0007351352047481983 + -0.0005328548875045758i, -0.04375820564958367 + 0.014831179431737819i, -0.001089097470828027 + -0.0013875151468750071i, 0.08086771852551783 + -0.024020698050530597i, 0.0015035965589026445 + 0.002705274700998314i, 0.1638663351859193 + 4.5218692816729496e-20i, 0.0013117373090920524 + 0.005870138607778151i }, { 0.00025248918404220856 + 0.0009409803059908377i, -0.019715260036024314 + 0.013413830798594496i, -3.690557530799273e-05 + 0.0019084340438599195i, -0.04410720827241074 + 0.014112258846138967i, -0.0002075624635666084 + -0.0030854467819443534i, 0.0841863681918321 + -0.025080857121526877i, 0.0013117373090920522 + -0.005870138607778151i, 0.17046882331060875 + 1.0117017600434183e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.0853735057640482, 1.0e-7), DoubleNear(0.08853185247571022, 1.0e-7), DoubleNear(0.14414006500108098, 1.0e-7), DoubleNear(0.14926099358205136, 1.0e-7), DoubleNear(0.09715725472510485, 1.0e-7), DoubleNear(0.10120116995547615, 1.0e-7), DoubleNear(0.1638663351859193, 1.0e-7), DoubleNear(0.17046882331060875, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false, true}), Matrix({ { 0.07944440199413084 + 6.116926904766608e-20i, 0.0005945095682840956 + 0.00281857909043677i, 0.06603233781195131 + 0.019650828772829428i, -0.0002040240530496963 + 0.002487173379875914i, 0.00012147853047923036 + 0.00018428387582007525i, 1.9950857637651303e-05 + 8.932090400516306e-05i, 4.355301622999272e-05 + 0.00018587058594727386i, -6.204873584353282e-06 + 8.1683390238735e-05i }, { 0.0005945095682840956 + -0.00281857909043677i, 0.08255761455466476 + -3.8654349485514954e-20i, 0.00118772328787375 + -0.0021976280311636386i, 0.06858880133417183 + 0.020469518988157704i, 5.5040035485815676e-05 + 5.29612584094912e-05i, -0.00012147853047923154 + -0.00018428387582007717i, 3.2550781715613795e-05 + 5.340361031365869e-05i, -4.35530162299932e-05 + -0.00018587058594727576i }, { 0.06603233781195131 + -0.019650828772829428i, 0.00118772328787375 + 0.0021976280311636386i, 0.13358671867462857 + 1.6982755226343976e-20i, 0.000993336711388348 + 0.004738966860095877i, 0.000144292324199611 + 0.00011923571623947857i, 3.404082088778209e-05 + 6.90339116786344e-05i, 0.00017297377298094839 + 0.00030535501580371683i, 1.7274628691484337e-05 + 0.00015414803895800203i }, { -0.0002040240530496963 + -0.0024871733798759134i, 0.06858880133417183 + -0.020469518988157704i, 0.000993336711388348 + -0.004738966860095877i, 0.13867046115170628 + 7.314130437105829e-21i, 5.909833634100493e-05 + 3.651570942506176e-05i, -0.00014429232419961243 + -0.00011923571623947984i, 9.554239863858516e-05 + 9.772052872671499e-05i, -0.00017297377298095007 + -0.00030535501580372014i }, { 0.0001214785304792303 + -0.00018428387582007527i, 5.504003548581563e-05 + -5.29612584094912e-05i, 0.000144292324199611 + -0.00011923571623947857i, 5.9098336341004895e-05 + -3.6515709425061765e-05i, 0.1030863584950222 + 1.4218888917457451e-19i, 0.0007676271936304874 + 0.0036571978281680064i, 0.08592878061484979 + 0.025450504618140142i, -0.0002671188862129809 + 0.003231678603880016i }, { 1.995085763765131e-05 + -8.932090400516309e-05i, -0.00012147853047923156 + 0.00018428387582007714i, 3.4040820887782085e-05 + -6.903391167863442e-05i, -0.00014429232419961243 + 0.00011923571623947983i, 0.0007676271936304873 + -0.0036571978281680073i, 0.1071754078765216 + 7.550459276718979e-20i, 0.001536098500856614 + -0.0028597800828525947i, 0.08927603862722099 + 0.026526699978757118i }, { 4.3553016229992686e-05 + -0.00018587058594727386i, 3.2550781715613754e-05 + -5.340361031365867e-05i, 0.0001729737729809483 + -0.000305355015803717i, 9.55423986385851e-05 + -9.772052872671499e-05i, 0.08592878061484979 + -0.025450504618140146i, 0.001536098500856614 + 0.0028597800828525943i, 0.17441968151237172 + 3.7699732998557606e-20i, 0.001285958820522906 + 0.006178343221244141i }, { -6.204873584353279e-06 + -8.168339023873503e-05i, -4.3553016229993215e-05 + 0.00018587058594727576i, 1.727462869148434e-05 + -0.00015414803895800206i, -0.00017297377298095012 + 0.0003053550158037201i, -0.000267118886212981 + -0.003231678603880016i, 0.08927603862722099 + -0.026526699978757118i, 0.0012859588205229057 + -0.006178343221244142i, 0.18105935574095383 + 1.2163317273630316e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.07944440199413084, 1.0e-7), DoubleNear(0.08255761455466476, 1.0e-7), DoubleNear(0.13358671867462857, 1.0e-7), DoubleNear(0.13867046115170628, 1.0e-7), DoubleNear(0.1030863584950222, 1.0e-7), DoubleNear(0.1071754078765216, 1.0e-7), DoubleNear(0.17441968151237172, 1.0e-7), DoubleNear(0.18105935574095383, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, true, false}), Matrix({ { 0.22951357076512918 + 1.032604866208458e-19i, 0.0015459324363036448 + 0.008044637558073654i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06969695588873132 + -0.02359974006245685i, -5.8718037160784143e-05 + -0.0030319040641344076i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001545932436303645 + -0.008044637558073654i, 0.23779284605776155 + -4.905541104040412e-21i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0017280904642887308 + 0.002209177678476826i, -0.0702546095104338 + -0.02245013595495356i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06969695588873132 + 0.02359974006245685i, -0.0017280904642887306 + -0.002209177678476826i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26102358991102415 + 1.5478015982629636e-19i, 0.0020954998575221924 + 0.009348449441871142i, 0.0 + 0.0i, 0.0 + 0.0i }, { -5.871803716078425e-05 + 0.003031904064134408i, -0.0702546095104338 + 0.02245013595495356i, 0.0 + 0.0i, 0.0 + 0.0i, 0.002095499857522192 + -0.009348449441871142i, 0.2716699932660849 + 6.12332320964514e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.22951357076512918, 1.0e-7), DoubleNear(0.23779284605776155, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26102358991102415, 1.0e-7), DoubleNear(0.2716699932660849, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false, true}), Matrix({ { 0.2130311206687594 + 7.815202427401005e-20i, 0.0015878462796724436 + 0.007557545950532647i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0002944523034601787 + 0.0004896388916237921i, 3.7225486329135644e-05 + 0.0002434689429631651i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0015878462796724436 + -0.007557545950532647i, 0.22122807570637104 + -3.1340219048409125e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00015058243412440083 + 0.00015068178713620618i, -0.00029445230346018163 + -0.0004896388916237973i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0002944523034601786 + -0.0004896388916237922i, 0.00015058243412440072 + -0.0001506817871362062i, 0.0 + 0.0i, 0.0 + 0.0i, 0.27750604000739393 + 1.798886221731321e-19i, 0.0020535860141533933 + 0.009835541049412148i, 0.0 + 0.0i, 0.0 + 0.0i }, { 3.722548632913565e-05 + -0.00024346894296316515i, -0.0002944523034601817 + 0.0004896388916237973i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0020535860141533933 + -0.00983554104941215i, 0.2882347636174754 + 8.766791004082011e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.2130311206687594, 1.0e-7), DoubleNear(0.22122807570637104, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27750604000739393, 1.0e-7), DoubleNear(0.2882347636174754, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true, true}), Matrix({ { 0.09634524492447939 + -2.6495653241253587e-20i, 0.0008329473201548175 + 0.003638941094048726i, -0.02980316280731992 + -0.007997304538052329i, 1.3199006019063544e-05 + -0.0011906264226045566i, 0.00014999043909274157 + -0.00041273147750021114i, -1.2670337228825025e-05 + 1.3089540452698034e-05i, -0.00018762348253733275 + -0.0026957123273191963i, 6.929332732979569e-05 + 2.0220266618930973e-05i }, { 0.0008329473201548175 + -0.003638941094048726i, 0.10388758242161264 + -1.7643664435511893e-20i, -0.001043325754974356 + 0.0006818081574660005i, -0.03035649426628287 + -0.01024908941704553i, 0.00011087784458625745 + 0.00015310134334327826i, -0.0005970404186852799 + -0.0006337935646785915i, -8.52720869572388e-05 + -0.00011906296642737323i, 0.0002831130786894202 + -0.0025736408639492076i }, { -0.02980316280731992 + 0.007997304538052329i, -0.001043325754974356 + -0.0006818081574660005i, 0.11668587574428002 + 1.0464767751526364e-19i, 0.0007548989595176262 + 0.003918604856483921i, -0.0024757147722574984 + -0.0009875010723532237i, 9.212521973875129e-05 + -0.00010060184753890343i, 0.00014446186436743713 + 0.0009023703691240033i, 4.989582355796067e-05 + 0.00023037940251046705i }, { 1.3199006019063408e-05 + 0.001190626422604557i, -0.03035649426628287 + 0.01024908941704553i, 0.0007548989595176261 + -0.003918604856483921i, 0.1173404932847584 + -1.3696554612897235e-20i, -0.00014353729085501006 + 5.305124626140032e-05i, -0.0022689950617186586 + -0.0013263993806483924i, 3.9704589538143385e-05 + -2.419556207072064e-06i, 0.00030258811522509825 + 0.0001441546730547942i }, { 0.00014999043909274157 + 0.0004127314775002111i, 0.0001108778445862574 + -0.00015310134334327826i, -0.002475714772257499 + 0.000987501072353224i, -0.00014353729085501003 + -5.305124626140033e-05i, 0.13316832584064978 + 1.297561398620994e-19i, 0.0007129851161488273 + 0.004405696464024928i, -0.03989379308141139 + -0.015602435524404521i, -7.191704317984769e-05 + -0.001841277641529851i }, { -1.2670337228825035e-05 + -1.308954045269804e-05i, -0.0005970404186852799 + 0.0006337935646785915i, 9.212521973875127e-05 + 0.00010060184753890345i, -0.002268995061718658 + 0.0013263993806483924i, 0.0007129851161488275 + -0.0044056964640249285i, 0.1339052636361489 + 1.2738123331471481e-20i, -0.0006847647093143748 + 0.0015273695210108254i, -0.03989811524415094 + -0.01220104653790803i }, { -0.00018762348253733275 + 0.0026957123273191963i, -8.52720869572388e-05 + 0.00011906296642737319i, 0.00014446186436743705 + -0.0009023703691240033i, 3.970458953814333e-05 + 2.419556207072061e-06i, -0.03989379308141139 + 0.015602435524404521i, -0.0006847647093143746 + -0.0015273695210108254i, 0.14433771416674415 + 5.013248231103272e-20i, 0.001340600898004566 + 0.00542984458538722i }, { 6.929332732979568e-05 + -2.0220266618930963e-05i, 0.0002831130786894201 + 0.0025736408639492076i, 4.989582355796069e-05 + -0.0002303794025104671i, 0.0003025881152250982 + -0.00014415467305479423i, -7.191704317984766e-05 + 0.001841277641529851i, -0.03989811524415094 + 0.01220104653790803i, 0.0013406008980045656 + -0.005429844585387221i, 0.1543294999813265 + 7.492978670934863e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.09634524492447939, 1.0e-7), DoubleNear(0.10388758242161264, 1.0e-7), DoubleNear(0.11668587574428002, 1.0e-7), DoubleNear(0.1173404932847584, 1.0e-7), DoubleNear(0.13316832584064978, 1.0e-7), DoubleNear(0.1339052636361489, 1.0e-7), DoubleNear(0.14433771416674415, 1.0e-7), DoubleNear(0.1543294999813265, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, true, false}), Matrix({ { 0.1739053582397584 + 7.953071999833134e-20i, 0.144771871670844 + 0.042995997185826924i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0520861514771707 + -0.017106437739533627i, -0.03914396415072896 + -0.027139468456719437i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.144771871670844 + -0.042995997185826924i, 0.29340105858313237 + 1.8824225518474048e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.047571915425741705 + -0.001380131879747947i, -0.08786541392199441 + -0.028943438277876786i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0520861514771707 + 0.017106437739533624i, -0.04757191542574171 + 0.001380131879747947i, 0.0 + 0.0i, 0.0 + 0.0i, 0.198358424680581 + 1.6067768150558407e-19i, 0.16505408671734995 + 0.04910155517205747i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03914396415072896 + 0.027139468456719433i, -0.08786541392199441 + 0.028943438277876786i, 0.0 + 0.0i, 0.0 + 0.0i, 0.16505408671734992 + -0.04910155517205747i, 0.33433515849652806 + 5.533571041716368e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.1739053582397584, 1.0e-7), DoubleNear(0.29340105858313237, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.198358424680581, 1.0e-7), DoubleNear(0.33433515849652806, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false, true}), Matrix({ { 0.1620020165487956 + 2.2514919562151125e-20i, 0.13462113914612314 + 0.040120347760987135i, 0.0 + 0.0i, 0.0 + 0.0i, -1.1655173354219173e-18 + -1.951563910473908e-18i, -4.811147140404426e-19 + -1.8973538018496328e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13462113914612314 + -0.040120347760987135i, 0.27225717982633485 + 2.4296885663449805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -1.4094628242311558e-18 + -1.2468324983583301e-18i, -1.7076184216646695e-18 + -3.3610267347050637e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.2739375526704677e-18 + 1.8431436932253575e-18i, -1.463672932855431e-18 + 1.2468324983583301e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2102617663715438 + 2.176934819417643e-19i, 0.17520481924207076 + 0.05197720459689727i, 0.0 + 0.0i, 0.0 + 0.0i }, { -5.285485590866834e-19 + 1.8973538018496328e-18i, -1.81603863891322e-18 + 3.144186300207963e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17520481924207076 + -0.05197720459689727i, 0.3554790372533255 + 4.986305027218793e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.1620020165487956, 1.0e-7), DoubleNear(0.27225717982633485, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2102617663715438, 1.0e-7), DoubleNear(0.3554790372533255, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true, true}), Matrix({ { 0.07479522643761272 + -3.311685080003897e-20i, 0.06209948248686256 + 0.018607061412757423i, -0.02246504852784044 + -0.0068702186002070125i, -0.016899967551277838 + -0.011256544476056212i, -0.00020641016048961067 + -0.00040520227598934695i, -4.9130364891280425e-05 + -0.00038713746709763863i, -7.090250089096585e-05 + -0.0019720512178300694i, 0.0004989237006653386 + -0.0016607290325998509i }, { 0.06209948248686256 + -0.018607061412757423i, 0.12543760090847933 + -1.102246687672651e-20i, -0.02041152725403504 + -9.124455417501223e-05i, -0.03769460854576235 + -0.011376175354890845i, -0.0002454366405479954 + -0.00026427045521811834i, -0.0002406398191029276 + -0.0006413227661894558i, -0.00048545801344300954 + -0.0016129611375624215i, 0.00016639209704305332 + -0.003297301973438334i }, { -0.02246504852784044 + 0.006870218600207013i, -0.02041152725403504 + 9.124455417501223e-05i, 0.08720679011118289 + 5.56317703621901e-20i, 0.07252165665926058 + 0.02151328634822971i, -0.001821289248290426 + -0.0007676956305774445i, -0.0012979049932135603 + -0.0011545384287692325i, 0.0002064101604896095 + 0.000405202275989345i, 4.9130364891279944e-05 + 0.00038713746709763674i }, { -0.016899967551277838 + 0.011256544476056212i, -0.03769460854576235 + 0.011376175354890845i, 0.07252165665926058 + -0.02151328634822971i, 0.14681957891785552 + 3.5319352540176315e-20i, -0.0016692400742651919 + -0.0002408813337632621i, -0.002923420585685731 + -0.0015462048224241715i, 0.000245436640547994 + 0.0002642704552181171i, 0.0002406398191029259 + 0.0006413227661894524i }, { -0.00020641016048961072 + 0.00040520227598934684i, -0.0002454366405479954 + 0.00026427045521811834i, -0.0018212892482904258 + 0.0007676956305774446i, -0.0016692400742651919 + 0.0002408813337632621i, 0.09911013180214569 + 1.126475707983703e-19i, 0.08267238918398143 + 0.0243889357730695i, -0.02962110294933026 + -0.010236219139326614i, -0.02224399659945112 + -0.015882923980663224i }, { -4.913036489128045e-05 + 0.00038713746709763863i, -0.0002406398191029276 + 0.0006413227661894557i, -0.0012979049932135601 + 0.0011545384287692325i, -0.002923420585685731 + 0.0015462048224241715i, 0.08267238918398143 + -0.0243889357730695i, 0.167963457674653 + 2.984669239520056e-20i, -0.027160388171706667 + -0.0012888873255729348i, -0.050170805376232065 + -0.01756726292298594i }, { -7.090250089096585e-05 + 0.00197205121783007i, -0.00048545801344300954 + 0.0016129611375624215i, 0.00020641016048960945 + -0.000405202275989345i, 0.00024543664054799396 + -0.0002642704552181171i, -0.029621102949330264 + 0.010236219139326612i, -0.02716038817170667 + 0.0012888873255729348i, 0.11115163456939811 + 1.0504591114339399e-19i, 0.09253243005808935 + 0.027588268823827762i }, { 0.0004989237006653386 + 0.0016607290325998509i, 0.00016639209704305321 + 0.0032973019734383346i, 4.9130364891279924e-05 + -0.00038713746709763674i, 0.0002406398191029258 + -0.0006413227661894525i, -0.022243996599451123 + 0.01588292398066322i, -0.050170805376232065 + 0.01756726292298594i, 0.09253243005808934 + -0.027588268823827762i, 0.18751557957867254 + 2.0016357876987367e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.07479522643761272, 1.0e-7), DoubleNear(0.12543760090847933, 1.0e-7), DoubleNear(0.08720679011118289, 1.0e-7), DoubleNear(0.14681957891785552, 1.0e-7), DoubleNear(0.09911013180214569, 1.0e-7), DoubleNear(0.167963457674653, 1.0e-7), DoubleNear(0.11115163456939811, 1.0e-7), DoubleNear(0.18751557957867254, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true, true}), Matrix({ { 0.20023282734609205 + -4.413931767676548e-20i, 0.0 + 0.0i, -0.06015965707360279 + -0.018246393955097858i, 0.0 + 0.0i, -0.0004470499795925383 + -0.0010465250421788027i, 0.0 + 0.0i, 9.548959615208747e-05 + -0.005269353191268403i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06015965707360279 + 0.018246393955097858i, 0.0 + 0.0i, 0.2340263690290384 + 9.095112290236641e-20i, 0.0 + 0.0i, -0.004744709833976157 + -0.002313900453001616i, 0.0 + 0.0i, 0.0004470499795925354 + 0.0010465250421787973i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004470499795925383 + 0.0010465250421788025i, 0.0 + 0.0i, -0.004744709833976157 + 0.002313900453001616i, 0.0 + 0.0i, 0.2670735894767987 + 1.4249426319357088e-19i, 0.0 + 0.0i, -0.07979190832556232 + -0.027803482062312555i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 9.548959615208736e-05 + 0.005269353191268405i, 0.0 + 0.0i, 0.00044704997959253527 + -0.0010465250421787975i, 0.0 + 0.0i, -0.07979190832556232 + 0.027803482062312555i, 0.0 + 0.0i, 0.2986672141480706 + 1.2506226902038136e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.20023282734609205, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2340263690290384, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2670735894767987, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2986672141480706, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));


}
}

}
