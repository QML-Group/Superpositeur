#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { -0.27518409024599566 + 0.05457699597048214i, 0.04728298687231921 + -0.08575034416801015i }, { -0.20715117562828236 + -0.11505304036190911i, 0.505276869472286 + 0.23831414810814372i } }), Matrix({ { -0.3728532494074838 + 0.14054515429838071i, -0.14081289985885012 + 0.17294696506861998i }, { 0.3369814131725827 + -0.45042996853326267i, 0.32579713346487055 + -0.09881393168063356i } }), Matrix({ { 0.2779078623754204 + -0.12205415479551664i, -0.43388603576881324 + -0.27733618531149884i }, { 0.20542576669891421 + -0.4438919544118147i, 0.03335183928697048 + -0.04392660099779429i } }), Matrix({ { -0.04542820415294873 + -0.1588986114682334i, -0.1667130762068038 + -0.2009075980369032i }, { 0.08520555794155131 + 0.15488012754047847i, -0.378312464807118 + -0.18213781024536255i } }) }, { QubitIndex{ 9 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.30212824499030844 + 0.11813316924339907i, 0.2638184912239296 + -0.22719358675535772i }, { 0.26110235170221696 + -0.21580003417535473i, 0.30206671887372444 + 0.362589782537899i } }), Matrix({ { -0.1427040141957855 + -0.17186098553282936i, -0.07181790306642773 + -0.07179277019593418i }, { 0.10446391814438276 + -0.40972929091826704i, 0.5515836898081476 + -0.26074652877321647i } }), Matrix({ { -0.043818306861620075 + 0.4197335713692337i, 0.20095708489538955 + -0.2846942018988008i }, { 0.17914673372306386 + -0.3700472734735573i, -0.20546393985373884 + 0.039280142487098435i } }), Matrix({ { 0.0957020536065859 + -0.32012137314355726i, -0.25352803480390057 + 0.13708645755032434i }, { -0.07157616463162961 + -0.295707580782181i, -0.15833485218563412 + 0.013780680690070476i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 9 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.04897230296300692 + -0.09493722731019741i, -0.027078103887447986 + -0.16653182449574677i, 0.034694199391695255 + 0.16213294384637134i, 0.08566226381946383 + 0.022878514602679215i }, { 0.08413457111084555 + -0.13663305398836847i, -0.07493802762622512 + -0.028755036491864863i, 0.03730297779728856 + -0.03227319458996026i, 0.1938683481121141 + -0.10967618032397362i }, { -0.14342859789947282 + 0.01738956963023719i, 0.05466451516399283 + 0.0021201696318753406i, 0.09630047055783443 + 0.17474385160333175i, 0.02402276071775902 + 0.017091806633040923i }, { 0.07278899183706299 + 0.09409189423189605i, -0.08537311236575396 + -0.024417077042035103i, -0.1838327583348717 + 0.03694218038966286i, -0.15281851415857017 + 0.12929658396805682i } }), Matrix({ { 0.1799810709219363 + 0.12478770882156894i, -0.17494088592764662 + -0.20032743829975602i, -0.01507779481403499 + -0.008863232118851289i, 0.036127172017138026 + 0.02434014686156757i }, { -0.1076018003674966 + -0.0874708860354898i, 0.011752370654051526 + 0.0108688011415072i, -0.04649933489849819 + -0.022553939059147782i, 0.024959408543283684 + -0.16259819867892034i }, { -0.03842976940514589 + -0.07533554199441772i, -0.04518879615210352 + 0.032931524173427054i, -0.0029985770413149013 + 0.07645271856192588i, 0.12304543440735506 + 0.010310329282035426i }, { -0.14224077764617363 + -0.14896187995763244i, -0.09129166856361398 + -0.07060795171300416i, 0.02304031864488532 + -0.03358574307521081i, 0.06595207563819148 + -0.05183269454858275i } }), Matrix({ { -0.05001876761103771 + 0.1172859577953549i, -0.07300621930638068 + -0.09827119727646326i, -0.025335932709214325 + 0.04289688459644818i, -0.01563771733102126 + 0.0666502418884829i }, { 0.14808638085013592 + -0.01927900439274554i, -0.05206282218328277 + 0.12742611577724564i, 0.06064046715130615 + 0.12138369573530286i, -0.19288346783438626 + -0.007366947063259251i }, { 0.020598185923125383 + 0.038404151687861994i, -0.10815520467584402 + 0.12870901113815586i, 0.09960683130106673 + 0.0032154475088252664i, -0.00449554016155682 + -0.0507693882052299i }, { -0.03888108259381232 + -0.03693411078110952i, -0.04949531210298512 + -0.08017737782110113i, -0.043771854198287524 + -0.2705058926829144i, -0.1049500800520899 + -0.01917142555422099i } }), Matrix({ { 0.06485682431665825 + -0.011715224095250304i, 0.0548342468057107 + -0.0634261642737122i, -0.12321976960142708 + 0.030847387019520053i, 0.08547766284709052 + 0.024328658263211497i }, { -0.009989764766048324 + -0.0746010481645351i, -0.012197514271956311 + -0.05360164951535175i, 0.03659398742003297 + -0.01658913405362818i, -0.08603833119411976 + 0.15733831063215406i }, { -0.007514141731641931 + 0.1712456361044621i, -0.13913867252149006 + -0.2218129301914436i, 0.04709510242301183 + -0.09251426777761336i, -0.07597136492960126 + 0.03774466709025665i }, { -0.046001429766569554 + -0.034697359321295376i, -0.047725744339796365 + 0.019813608388445605i, -0.028658229376341843 + 0.061269392679118746i, -0.11389922577218504 + 0.13952575146224613i } }), Matrix({ { -0.06943422260860016 + -0.17500384018013385i, -0.07078109455082533 + -0.08745078746152758i, 0.06040034110984345 + -0.08976927006866026i, 0.0008628396416659339 + -0.07422287786382081i }, { 0.04652094348328374 + -0.13858913226062758i, -0.09513634507743783 + 0.06061447340402648i, 0.0019981940391470584 + -0.058623611014388885i, 0.035988966069688946 + -0.0540569229162705i }, { -0.013046926664056597 + 0.024716594020902802i, -0.034957305379933225 + -0.10039946036274673i, -0.025294389112202515 + 0.12462515746696778i, -0.08576967293228595 + 0.04973059180296551i }, { -0.000415616011411539 + -0.2301206005431979i, 0.04423768097422524 + -0.08048552786507494i, 0.0346231029593368 + -0.036149078528760197i, -0.06622199628947815 + 0.011500847140318878i } }), Matrix({ { -0.11453784004887238 + 0.03543337788595563i, 0.06387406882557545 + -0.0004677373522149995i, -0.014420828253717688 + -0.012783055314629229i, 0.0322554450177131 + 0.0638634843383623i }, { -0.03965316452688885 + -0.1445977537795324i, 0.11187647472911262 + 0.06720614771199453i, 0.04651647078228383 + 0.024688534427076685i, -0.12036443693049667 + 0.06167377011931738i }, { 0.06792956842173001 + -0.13424446762527611i, 0.02174470816597509 + 0.01715032252177248i, -0.07118194707979911 + 0.105160443366294i, -0.14347749148919225 + -0.0648761922589196i }, { -0.10634910523644879 + -0.09610472936323991i, -0.06602333766217153 + -0.1061509338068556i, 0.050566706836807085 + -0.253070737047044i, -0.08655687883589898 + 0.009583548436951965i } }), Matrix({ { -0.06383982892791813 + -0.028569649516033i, 0.03789657675370303 + -0.11661731030458539i, 0.024774237163512923 + 0.09451570743589958i, 0.01116203992934076 + -0.10052959364233163i }, { -0.018001921885366468 + 0.014974721185504756i, -0.05886403389904345 + 0.003728110334483392i, -0.03673071659119986 + -0.16096719289470027i, 0.057747822993399735 + -0.03688411443597587i }, { -0.02290450886898419 + -0.019753143305038974i, 0.014485067555496667 + 0.117795684618687i, 0.10720871458457558 + 0.0521485296659837i, -0.0067215277662366025 + -0.0787181507305576i }, { 0.024263998801723436 + 0.010639232600008512i, 0.046556821128000636 + -0.11736793458557583i, -0.023533038570485828 + -0.02425172763312241i, -0.0068814921744725106 + 0.030846540532680294i } }), Matrix({ { 0.11793981145296842 + -0.06711540098770738i, -0.05090544377112806 + -0.10514639418247038i, 0.11118740203858597 + 0.007430476277282408i, -0.10555972368497847 + -0.00017941720552937005i }, { 0.024073376025988878 + -0.10654437812434744i, -0.0022780772004507804 + 0.12960215781657125i, 0.19956393782609874 + 0.04155582721765461i, 0.03131279087833566 + -0.06404040618848354i }, { -0.004598359781305463 + 0.06477655864377649i, 0.1698118867935743 + -0.012756710865141472i, 0.09999770144086877 + 0.03671057286389971i, -0.010941073871033795 + 0.018930387418538475i }, { -0.04358416936032861 + -0.20295416188279064i, 0.048081892695748 + -0.04078017212422144i, -0.05331640045474003 + -0.034746659010436595i, 0.04130138205997742 + -0.01576886284941614i } }), Matrix({ { 0.05448056885722543 + 0.12408880871252481i, 0.04702453699692444 + 0.06660348186771368i, -0.04130771415530611 + 0.20126005731232008i, -0.034281416428188514 + -0.08026746409084884i }, { -0.019699245680130813 + 0.043009195412788054i, -0.18906385274605939 + -0.08835269098991591i, -0.009670172673256474 + -0.058980307233245696i, -0.05425201725964214 + -0.10874834939414495i }, { 0.011578230043076442 + -0.13344167697119447i, 0.05480297910146894 + 0.05973623491113241i, 0.04434827899026091 + -0.14462868472961535i, -0.0936627834911178 + 0.04297783747149774i }, { -0.017763142470017094 + -0.04025594301645381i, -0.021732474069846373 + -0.027947241413261454i, -0.05314599759181242 + -0.015537883603053342i, 0.12614132205810594 + 0.07264441837094403i } }), Matrix({ { 0.029951585623830813 + 0.12837943688126627i, 0.026408563758716298 + 0.0526423253084954i, 0.1688384119802022 + -0.04566329651542664i, 0.0712469099029016 + -0.0997601741236579i }, { 0.0012557878218779402 + 0.057507037662839836i, 0.07047299023523705 + 0.08514844808698747i, 0.013367927511388144 + -0.04094996914246562i, 0.0839758258696709 + 0.08641133813973792i }, { -0.17990801561287234 + 0.11926078040066397i, 0.07793566380595988 + 0.07470454997229378i, -0.07896631746383698 + -0.014387360967635529i, 0.026488673799373297 + 0.2427592747436979i }, { -0.20907505863106401 + -0.006443461423024727i, 0.01582595577863327 + 0.07256279447527733i, 0.09296204946054791 + -0.017719922084658966i, 0.1889422353687866 + 0.06539602383749574i } }), Matrix({ { -0.0941854993120178 + 0.07001126852102811i, -0.08797866748924367 + 0.026956538209797355i, 0.07123702047678919 + -0.023357437134751295i, -0.10507218619183895 + 0.04004144567360492i }, { -0.012264639949788178 + -0.0012907290975389778i, 0.02430936715012214 + -0.0023527582531584585i, -0.03975847895660317 + 0.13450982506521708i, 0.10635451449667127 + -0.12035814568737484i }, { 0.029096776931576605 + 0.1136444688900396i, -0.06964649589045618 + -0.13563430685971306i, -0.0947821531755804 + 0.1610113947477694i, -0.050316034964037894 + -0.12813610245604665i }, { 0.023619154377686427 + 0.12305818221757778i, 0.11171200848398381 + 0.0005244765379936252i, 0.03994310712013327 + -0.11391714133990152i, -0.05031118874389282 + 0.0704418096967244i } }), Matrix({ { -0.07744068738509678 + -0.168603651016015i, -0.0285305484094844 + -0.02319862988212631i, -0.08040979620016397 + 0.05171871646551624i, 0.07195712598092395 + -0.016401543064859574i }, { 0.0576477830929648 + -0.03805579191135376i, -0.006625996110826405 + -0.08340036636296028i, -0.05852595463538313 + -0.0899695744925193i, 0.10552779304817393 + 0.052918164287419286i }, { 0.0019336394932345227 + -0.09183758456549458i, 0.024461675155511748 + -0.12030176161900533i, -0.035998662288117066 + 0.10885914976386522i, -0.17388407433715666 + 0.06919146897685757i }, { -0.036381557878986254 + -0.10569175328493897i, -0.05295221720320207 + -0.07886505750791645i, -0.06458760685445707 + 0.11343485175445399i, 0.004652188807053844 + 0.05681901227760712i } }), Matrix({ { -0.05684284147462173 + 0.11047028114112648i, -0.01713821843667105 + 0.12305610107734395i, 0.05232021416388943 + 0.09527834351903039i, -0.06147827710725976 + -0.03636827176027511i }, { 0.06853757382019471 + 0.04464436890642292i, -0.15066388751775384 + 0.14544484617856762i, 0.04111387390770117 + 0.033251870960852685i, 0.099532844603824 + -0.02618193255528848i }, { -0.0232830071872721 + -0.01999091595717433i, 0.07232671065324635 + 0.0172168028531246i, 0.04282193099759561 + 0.2465934038317026i, -0.13968917704859637 + 0.14181416779466935i }, { -0.092618118052872 + 0.000563437694445534i, 0.12403372857961775 + 0.04532769022839375i, 0.006016294998878336 + 0.06004742501180374i, 0.12161309237058762 + -0.038575557936075554i } }), Matrix({ { 0.021606597896637127 + -0.0409948127577054i, 0.03294073409875686 + -0.19203024026533583i, 0.08477690764726999 + 0.08479915495711741i, -0.055357662665260245 + -0.05483630680396219i }, { -0.11862575980171089 + 0.00903186009820433i, 0.09876285675401633 + -0.13991436200355736i, 0.01618994340828648 + 0.0012792720535299757i, -0.02469394275547828 + -0.15755592600301266i }, { 0.015611233747702557 + 0.10374047695468701i, -0.04931299323827425 + 0.010714182013324665i, 0.10404165262704912 + -0.04385038049956846i, -0.08113131304930711 + -0.06456831462061208i }, { 0.0730970099090791 + 0.012042777364842732i, 0.22490363041109346 + 0.02693485450919331i, -0.10948520540789088 + -0.08064223123586556i, -0.047031407563064044 + 0.06742860727527589i } }), Matrix({ { 0.08814248549915424 + -0.03807594896956166i, 0.019891621130320964 + -0.02590326440980615i, -0.04219769210162712 + 0.03313006129252378i, -0.16838033546659126 + 0.03293208031198669i }, { -0.046265620875942486 + -0.03398716979861666i, -0.09091174510406548 + 0.09142515074759343i, 0.08415167266151159 + 0.02782314482068347i, -0.03900110110761301 + 0.05892563299705311i }, { -0.07338656554177497 + -0.14877446448766588i, 0.18572077383976526 + -0.1139471636917902i, 0.03902584949836909 + 0.033808944587340975i, 0.04934571580633784 + -0.10647754895842357i }, { -0.14777137461306286 + -0.0609505338169785i, -0.030302314508830693 + 0.11969128231265115i, 9.873508052688596e-05 + -0.015898368185913576i, -0.051989356184775425 + -0.1522994058857673i } }), Matrix({ { 0.08522364365640897 + -0.09609504790316716i, 0.037340060558075046 + 0.03796395055674369i, -0.15401830709872175 + 0.020160854211793904i, -0.008399580235216522 + -0.16971508821876555i }, { -0.11790245150371575 + -0.007520236633495129i, -0.15380722158352453 + 0.058535366266838085i, 0.07018645698997775 + 0.1667613550602651i, 0.01959955006333013 + -0.09189872117055815i }, { 0.10190520425477452 + 0.08273930390074595i, 0.11971890672358212 + -0.0330766322890705i, 0.002369448247861211 + 0.0674610239232243i, -0.04515006520171763 + -0.18144406722530296i }, { -0.11191594080336298 + 0.06660672829998804i, 0.13121870465667534 + 0.07302201894571908i, -0.14644901378821729 + 0.189423814221674i, -0.13121176228035458 + 0.05959722281258861i } }) }, { QubitIndex{ 1 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 9 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.20539147565711824 + -0.04745596554250106i, -0.19123119267398758 + 0.14905817864381476i }, { 0.10118864164075066 + -0.29124700858552605i, 0.006906983980909647 + -0.10663009413276073i } }), Matrix({ { -0.25526719980677764 + -0.053136856539010895i, 0.2777914441928137 + -0.1241633425179943i }, { 0.16975997508564775 + 0.14148736325805947i, -0.5525992845516314 + 0.039082366463144544i } }), Matrix({ { -0.2785227594111386 + 0.1684645635260361i, 0.2391033781522193 + -0.26353747129658767i }, { 0.3429913620964198 + 0.2461739788464544i, 0.035194594585257644 + -0.23366540458442286i } }), Matrix({ { -0.3033437951441371 + -0.6009355326684922i, -0.36154422024901434 + -0.38427001511996284i }, { -0.07946994442846313 + -0.004465017415790303i, 0.22145841791608778 + -0.1429492238090414i } }) }, { QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 8 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.07348231263493399 + -0.18853949000479242i, 0.06114505384860913 + 0.015505645827340849i, 0.04771760975021836 + -0.1582576135421655i, 0.018289914440465457 + 0.07978610575050486i }, { 0.11666822164650316 + 0.09056407859288468i, 0.001070921146742669 + 0.031714546605216706i, -0.24028390067322797 + -0.057734638897289844i, 0.014369417288748874 + -0.1562908349661732i }, { -0.1931674510969226 + 0.054153517877702034i, 0.03900118400725663 + 0.08038902927525254i, -0.15102534374963747 + 0.04470148339951046i, -0.06183649832547003 + 0.02268805677177488i }, { 0.06041722940707628 + -0.006612287034694708i, -0.02402322058915746 + -0.17194551329999563i, 0.008091214369508942 + 0.030216598905377413i, 0.01563920804785044 + -0.01684915645538565i } }), Matrix({ { 0.06392519916661916 + -0.01790354235612877i, 0.006469195800793147 + -0.12231046985382084i, 0.15408998443453273 + 0.023225348638218266i, -0.07567086502564846 + 0.09036882137900687i }, { 0.020374374411454284 + 0.012135657436453357i, -0.1744314790156025 + -0.14058295081039848i, -0.03864404668956486 + 0.03502750893314723i, -0.21629646032478825 + -0.10888266648863615i }, { 0.05749081942012821 + -0.01778404824198089i, 0.015265592817119313 + -0.021531985502303664i, 0.039219366205908504 + 0.09714629481910217i, 0.31680939596442065 + -0.003192505400574417i }, { 0.040929763946948125 + 0.05432019759795305i, -0.0012205713569006882 + -0.14490447345934662i, -0.06595686270707389 + -0.11940981443214355i, 0.04789092637188105 + 0.06308993650943594i } }), Matrix({ { -0.17831520327449576 + 0.05949402590525593i, 0.05334029159679941 + -0.012874182848837101i, -0.07285756480116441 + 0.01908180327334353i, -0.00350901034836835 + 0.058742212239454264i }, { -0.02711676270942564 + -0.13917027140501345i, -0.03859486092620511 + -0.024666488323715426i, 0.022697284504363424 + -0.010838075736949093i, -0.060651879618066916 + 0.06632876000000962i }, { 0.037783576060252524 + 0.13237748302158633i, 0.08407735282556077 + 0.028532902796776928i, 0.02041636030167432 + -0.1080210983192339i, 0.009119252455601239 + 0.07516407109851121i }, { -0.10979448538559458 + 0.12322823398246611i, 0.07963955092198652 + -0.13105038609282885i, 0.07334352502770837 + -0.046135123887017196i, 0.08706355215126327 + -0.009802601833844259i } }), Matrix({ { -0.008530898327800743 + 0.08223882350404448i, -0.09607335890670873 + -0.0806473442068627i, 0.040073544835917616 + -0.01751070832209285i, -0.08465940654432227 + -0.11692032487352698i }, { -0.011950679569292145 + -0.11000305148180266i, 0.16660334363587023 + 0.07071729725752657i, 0.01913004191533679 + 0.12353183567851313i, 0.027361218619011952 + -0.12487963336133198i }, { -0.07385918688494494 + 0.08850010753026426i, 0.09356908527112223 + 0.059007499663225986i, -0.028459686632059212 + 0.17041203838549193i, -0.09656220499022156 + -0.06216894125114656i }, { -0.018170332501997673 + -0.054704368310753385i, 0.029931275089035016 + -0.06956104450893855i, 0.058503908376527976 + -0.18082949382411134i, 0.03346388461835601 + 0.06444456012953208i } }), Matrix({ { -0.13539378914901723 + -0.01782887570074037i, 0.019277129120837518 + -0.0022916240456535954i, 0.05852184425677382 + 0.023535859473519737i, 0.11014774311065542 + -0.07566716271200838i }, { 0.07335182929361078 + -0.12708248068174766i, 0.04507609126987322 + 0.01734572749025654i, 0.04130199392698042 + -0.0050146591464625846i, 0.0695253581322084 + 0.038769162287234066i }, { 0.04779920197787027 + 0.02406510140406237i, 0.03689417872366844 + 0.020829550999811614i, 0.02917116921988464 + -0.0011575685229339987i, 0.05422416313357322 + -0.03288933180978329i }, { -0.11211720813931544 + -0.11796510715232464i, 0.11806817745631193 + -0.039506389374970245i, 0.20626438179286744 + 0.03645290086304542i, 0.01828529638182743 + 0.02671433209970009i } }), Matrix({ { 0.03861976897465803 + -0.019057517383209495i, 0.1525956346951868 + 0.030767748335074414i, -0.2426530578169907 + -0.12389669833188471i, -0.026756210437351647 + 0.11099126479896772i }, { -0.11235936931837837 + -0.16429073687468732i, 0.029456618012475923 + -0.03422750032765648i, -0.007318665119238708 + -0.09202810950813362i, -0.07743985690531453 + 0.0751375039997956i }, { 0.07023899815180205 + -0.019500786637928213i, -0.15564084834617153 + 0.04482227975884858i, 0.12205008581771845 + -0.03795856409418882i, -0.024840641857523847 + -0.09523725035457006i }, { -0.07962662827799674 + -0.040084530274688675i, -0.19407084776681705 + -0.016204628040004467i, 0.1212532864486024 + 0.010472855963968256i, 0.19266183296533695 + -0.11542106977463364i } }), Matrix({ { -0.06804114449949096 + 0.05323738658448344i, 0.15905483812089266 + 0.11883818407062877i, -0.061310659914133266 + -0.01772997406364595i, -0.09269790095886807 + -0.03636044555573197i }, { -0.11236147767215224 + 0.07325161923521745i, -0.054370041789039245 + 0.033050194280945626i, 0.04749437972246438 + 0.010225985505100139i, 0.0644254090292062 + 0.021032634082905607i }, { -0.07348576708080515 + -0.12105288263326039i, 0.025684593994047277 + 0.004035523380080059i, 0.0003740262144238559 + 0.020319275271410035i, 0.015977922655238435 + -0.08440312982862429i }, { 0.031296111785536325 + 0.043202615028941835i, 0.09457276762441395 + -0.19430149371238933i, 0.0277911356474156 + -0.12198346479222014i, 0.027936461883646235 + -0.019453128439911295i } }), Matrix({ { -0.10852636968772592 + -0.11634733722642963i, -0.06321195201921544 + -0.08041896219104308i, -0.04832126937306504 + -0.011180888305695377i, -0.0962184827824002 + 0.05769953320814836i }, { -0.1325558106382409 + -0.05892382230538002i, -0.05154069172768142 + 0.032630326873430766i, 0.13755589022215042 + 0.11775211031475123i, 0.23846374555442984 + -0.056787159926480806i }, { -0.030072367324978616 + 0.019216116269390095i, -0.12627493595214528 + -0.047757219968588525i, -0.03991765937005856 + 0.05561511023113015i, -0.038204371604427405 + 0.013268666485055872i }, { 0.002898749444445509 + -0.012949335392362961i, 0.14135455623667145 + -0.15387145688565576i, -0.12872675511878626 + -0.04353287958871501i, -0.035826618474792474 + 0.028453346949307696i } }), Matrix({ { -0.017705018706618066 + -0.06001374795312754i, 0.08913805504957092 + 0.13841388798950227i, -0.025776836914825314 + 0.027911010433005125i, -0.06483823945592734 + -0.1517138419285347i }, { -0.11954395543793557 + 0.006657666163179416i, -0.05837174236029997 + -0.0403872425821049i, -0.07619312011465566 + -0.2191892961768747i, -0.07512724177476232 + 0.04291518602526036i }, { -0.027690785239783484 + -0.05013748788346029i, 0.011136621363964837 + 0.055226979199942385i, -0.01750552862692059 + 0.06103352197469036i, 0.09063039883909667 + 0.09422919140515314i }, { 0.16094952490784464 + 0.06543536581705706i, -0.037727293190932105 + -0.0960759404576971i, 0.0011867709227524402 + 0.14234567018593058i, 0.12044305496960032 + 0.06570604041502022i } }), Matrix({ { -0.05578999527152482 + -0.05786995537955969i, 0.06397886959505436 + 0.05336290807113469i, 0.10135200521860897 + -0.053951616993928954i, 0.08765661107660036 + -0.08737823880158604i }, { -0.22099542675541048 + 0.0035106160167246436i, 0.12394697442568116 + -0.061229565186968246i, -0.013922655294275369 + -0.08369742236828896i, 0.03182857174747016 + 0.04374986718108505i }, { 0.11577191922434782 + 0.045832028453863236i, -0.02072591620931164 + -0.11793903554004988i, -0.12078236407521864 + -0.0379367181063273i, 0.13331172717031944 + -0.22529601943462035i }, { 0.1718623107246564 + -0.045513842089987114i, 0.0684718392110334 + -0.012667740420048626i, -0.061230382783519964 + -0.0013438999641149025i, 0.005296578763543824 + -0.005832845072225423i } }), Matrix({ { -0.02474536451550864 + 0.07108545510934632i, 0.046781575429611956 + 0.06152734930453939i, -0.11170392249596299 + -0.09409839249075337i, -0.02740188802875586 + -0.03429208733798784i }, { -0.0317663924969816 + 0.03406468163561693i, -0.009888337838458624 + 0.08131025732342183i, -0.06890909763009395 + 0.14735175306488119i, -0.0682002274786746 + -0.053942299255784615i }, { 0.1303420074750278 + 0.128559899464815i, -0.1653797315444504 + 0.08853392171144345i, 0.04321543558816475 + 0.017987164951347015i, -0.11654238413941344 + -0.006818005945483472i }, { 0.04017795474611096 + -0.046946094428710436i, 0.21817915637647067 + 0.10574507341419062i, -0.006147160831643981 + 0.09902611862301829i, 0.1260726846916196 + -0.1416438115190812i } }), Matrix({ { -0.14523772663712908 + -0.09505426647758729i, -0.042929401760078686 + -0.09603515225041455i, 0.005147376547629553 + 0.017570528655090747i, -0.041147425757181416 + -0.05959097884455067i }, { -0.01205736457008329 + 0.11216311373131133i, 0.06589074733516853 + -0.04469460725336185i, 0.03591296665668263 + -0.06805768418638207i, -0.01825641384157174 + 0.12679002996832725i }, { -0.08381128293518794 + -0.16588231872288128i, 0.032515282737346704 + -0.1344655793443577i, -0.18347767075369803 + 0.10954152398829937i, -0.04996600660017764 + 0.0051513362908988825i }, { 0.09190319193081378 + 0.08881933349564142i, 0.08134702864268349 + 0.0886825739672744i, -0.002197682722440027 + 0.13428113852352558i, -0.1521364049445505 + -0.005637800776865977i } }), Matrix({ { -0.04678461155698786 + -0.08022818453047632i, 0.13611288509874842 + -0.11354318166706757i, 0.006988293381364993 + -0.025941146302046924i, -0.14316451809345643 + -0.02999186360568658i }, { 0.13868519587880868 + 0.05219654785131113i, 0.055318974035863486 + -0.0637847566416737i, -0.005914233193890412 + 0.034399076824993075i, 0.04481738204022246 + -0.1335358967474179i }, { 0.008756423121057904 + -0.061947022450618186i, -0.008292149334953756 + 0.016819539629165884i, -0.1989631688463788 + 0.03544614363629268i, -0.044272864290846856 + -0.062299685758248485i }, { 0.09026251378792152 + 0.06375518712049344i, 0.0076398244594415325 + -0.056094412196146415i, -0.034964375211792055 + -0.1007817707731227i, -0.036495218601463264 + 0.036105831239372124i } }), Matrix({ { -0.04326949992330977 + 0.08485968149281671i, -0.08842436479450196 + -0.16509631109213804i, 0.047536131623386144 + 0.14640128216587225i, 0.02548716773551499 + 0.13075283194179277i }, { -0.16356448623418052 + -0.1195136614847291i, -0.13768339533399376 + 0.020976833352234863i, -0.010181608993780301 + 0.06047343460372259i, -0.006867268703998207 + 0.019836732815014434i }, { -0.09727323521191987 + -0.041120751269680976i, 0.00491964159983518 + 0.030285713872412186i, -0.015820985701798924 + -0.007872180311668656i, 0.144809953974028 + -0.006031419614723974i }, { 0.03752344214259652 + 0.054177183505106134i, 0.035996814189008804 + -0.019144893240239536i, -0.07411209555371157 + -0.02789469691582294i, -0.15973241286797843 + -0.04820771272040797i } }), Matrix({ { -0.10096171230709186 + 0.03479868083167435i, -0.036233383115411584 + 0.059423425414869536i, -0.12747533981310727 + 0.09573325118850735i, -0.041837479218134715 + 0.04017194800531593i }, { -0.0635210345383945 + -0.06841717651128357i, -0.08289012771895969 + -0.035819024939260175i, 0.04637876774783278 + -0.05311555608978078i, -0.15323142863425038 + -0.06330639146748507i }, { -0.15353412168272476 + 0.0199640165425157i, 0.04121587085668056 + -0.0031692166700159345i, 0.14240962028202805 + -0.09273932699201452i, -0.06112944635624836 + 0.12769080136287508i }, { 0.05431257007345476 + -0.041953180371594116i, -0.25365441979770725 + 0.05474925203236811i, 0.06994888499947369 + -0.11052011544128557i, -0.07667584362695842 + 0.0965231710316054i } }), Matrix({ { -0.03050699090528656 + -0.0765739559265901i, 0.11666417141756696 + 0.05151236630343856i, -0.013319035583782541 + 0.05628187801321745i, 0.11336109896964261 + 0.08283796456444943i }, { 0.019347568711028384 + 0.055210960508987175i, 0.06241883974967059 + 0.01082311956404592i, -0.053255668336669726 + 0.02932881043938992i, 0.03110725114579662 + -0.05449948449114927i }, { -0.09036403814945064 + -0.16705205340697665i, -0.007370945205568656 + -0.04247986197808625i, -0.2004123171128922 + -0.02697599121461244i, 0.10272017578621484 + -0.06752085280635821i }, { 0.02337646932165465 + -0.1460917802442887i, -0.12533574793915545 + -0.14737782417670192i, -0.06558925379289397 + -0.09079886065611514i, 0.06502313207582246 + 0.02806340892466491i } }) }, { QubitIndex{ 4 }, QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.09015230074006818 + 0.3127930166601399i, -0.0411886781042015 + -0.4088985562715128i }, { 0.48524117563038327 + 0.36001680462926106i, -0.02694579920341164 + 0.18229721737069715i } }), Matrix({ { -0.13596783560209447 + -0.30675266234649506i, -0.0619693794548417 + -0.07352401958846226i }, { -0.04295293456550786 + 0.23844940183818758i, -0.42859238980946335 + -0.1966511109680688i } }), Matrix({ { -0.08489818468935412 + -0.25823954150448825i, 0.06335647810801817 + -0.03211435474978182i }, { 0.44506749450278454 + 0.1804664607656015i, 0.31674914774295937 + -0.5174312767626896i } }), Matrix({ { 0.026932138947018923 + -0.046751982548513996i, -0.01771892083436915 + 0.09303506992255603i }, { 0.17767920504163343 + 0.13654634630261156i, -0.13786114298585786 + 0.4055272215541941i } }) }, { QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.06930623465619212 + -0.0447459029374247i, -0.17114827487602224 + 0.1788693025782952i, 0.1040408385324589 + -0.06954465703171277i, -0.02136210247385066 + 0.04156102264737097i }, { -0.03266080990999585 + -0.2479964077849295i, 0.10283185312495204 + 0.07392905308191954i, -0.04024682083658593 + 0.008922116781513067i, 0.07660587177922999 + -0.13181991158736586i }, { -0.0482594797790357 + -0.027364588179052476i, -0.08348071880509755 + -0.02054482390158984i, 0.11464903424420878 + 0.07052222531328513i, 0.12326974145104434 + -0.012163956301694603i }, { 0.0009146685893617688 + -0.02702663149440455i, -0.04663122651895641 + -0.008788399354063078i, -0.14788911257946744 + 0.09859414828184873i, -0.07046235797834663 + -0.11513172976926923i } }), Matrix({ { -0.2166105995004152 + -0.07192859151998153i, -0.07258403415935248 + 0.14401024092714665i, -0.04502974984562376 + -0.06287980968339212i, 0.025394991768577634 + -0.08367956829024473i }, { -0.06100318417148993 + 0.18183388912613216i, 0.11522812397605589 + -0.07292645335284736i, 0.1342339644853382 + 0.01936165055180116i, 0.1585793727811004 + -0.024105245427246007i }, { -0.08772677620762902 + -0.025011223684448927i, 0.05191507641430226 + 0.030033928566814406i, 0.17438337616118202 + -0.05271469746100633i, -0.13756721632561003 + -0.04398770787627779i }, { -0.11662725074442969 + -0.10946546569004374i, 0.04245924848699251 + 0.023808309665739033i, -0.0873390992763424 + -0.11297705569593706i, -0.041994275368222554 + 0.06093307371106558i } }), Matrix({ { 0.04248677543608634 + -0.13773951544816215i, 0.07206447774372966 + 0.021842611466718984i, -0.09268193285173364 + -0.0003751432909325193i, 0.08380737101918083 + -0.09905276776103634i }, { 0.060362519310324825 + -0.00037551840551947177i, -0.10198400910395114 + -0.10559474184079418i, -0.036041409307222494 + -0.11725034199286068i, -0.03516942545006573 + -0.24149822856035189i }, { 0.009031617892527512 + 0.09903016283607353i, 0.06750050406182853 + 0.005207389379959157i, 0.07151133680564503 + 0.016441768684227726i, -0.0049827562457505845 + 0.023082682147568267i }, { 0.1315518716393105 + -0.10329685732377729i, 0.017754773031151496 + 0.05454672503308736i, -0.16549882398984178 + -0.12249628068427129i, 0.058382903688768556 + -0.014658093821615177i } }), Matrix({ { -0.11284362143944417 + -0.05405125683927087i, 0.06758780238936886 + -0.039970370863901365i, -0.043278479759130066 + 0.0009739202217075123i, 0.08908171887198507 + 0.04244139744221158i }, { 0.0019451329905979399 + 0.06668627106049783i, -0.09169346334878423 + -0.016488393169425443i, -0.1706728974637191 + -0.1707356130430443i, -0.054578793447014204 + -0.029165780819911384i }, { -0.01304143368273578 + -0.0975183645641654i, 0.09358244670740452 + -0.02187544736618462i, 0.0397378463239756 + -0.006758726308054949i, 0.07588491598442244 + 0.060018631521504114i }, { 0.07199190056235082 + -0.11583546041912957i, 0.034053237832670294 + -0.08411752373912224i, -0.13449242383032076 + -0.08132682268070673i, -0.09244134972801635 + -0.05120623606297688i } }), Matrix({ { -0.13164289218245565 + -0.04578613347728644i, -0.04687399642742927 + -0.054501633320922484i, 0.011439984872899996 + 0.1212101105855324i, 0.001848884921566608 + -0.042617126343022706i }, { 0.019759769230106992 + -0.033695742133494584i, -0.05472721349169846 + -0.01905747973961385i, 0.030003581791524757 + 0.0562795606236467i, -0.005770200151133278 + -0.09258280231224748i }, { -0.05721449348415764 + -0.07847112199095402i, -0.019840318290628566 + 0.04273755612415051i, 0.08520305579568811 + 0.0672788539641528i, 0.018245476973035104 + 0.09918005055117467i }, { 0.05958334062793834 + 0.02379308149380305i, -0.070209240569171 + -0.011212567281586322i, 0.15741770125969687 + 0.21530395620662118i, 0.09311848064849484 + 0.016314097865722924i } }), Matrix({ { -0.12657860702939067 + -0.05392661706651228i, -0.09793003424451098 + -0.03388697274065375i, -0.01740825260299528 + -0.05182347890597175i, 0.19079766636851078 + -0.05928624322437842i }, { 0.037964713331693316 + -0.12833611096058528i, -0.0034942691366404125 + 0.007308675507706157i, 0.13788490923184343 + -0.03845197650847244i, 0.010648827606384728 + 0.004993422197727095i }, { 0.13580590341277937 + 0.15105435265773598i, 0.011338157128259774 + -0.08213901593625232i, -0.04024002984105287 + -0.09120136259923488i, 0.00951642798220614 + -0.07603675590441979i }, { -0.07993671242767722 + -0.07341276755640548i, 0.0907608293239197 + -0.085682089569213i, 0.13736816728791457 + -0.11693106258805738i, 0.2418255927117611 + 0.01567094403358467i } }), Matrix({ { 0.029233836198360157 + 0.021002394301233566i, -0.046559091249695116 + -0.040433613573115736i, -0.20052693647568023 + 0.02808094934913538i, -0.09193011098516096 + 0.05012364573940899i }, { -0.03132851911035954 + -0.07038818132851717i, 0.013695273990122664 + 0.02932624433904575i, 0.03387825779092289 + 0.0015296114938001244i, -0.07228333870789336 + -0.027329989858996855i }, { 0.03545239485774476 + 0.021893346743797715i, -0.0018072261024531754 + -0.17076121490370755i, 0.03220325369371561 + 0.059002411939574805i, -0.16898415944275993 + 0.016532905461992414i }, { -0.05669364820128924 + 0.1183922900449296i, -0.01149299891295866 + -0.044612825000455034i, 0.10353074666990232 + -0.045537630917558886i, -0.19481629874412176 + 0.11941177691422449i } }), Matrix({ { 0.011296209458954806 + -0.1603762496545491i, -0.0869537999828465 + 0.12332849367110153i, 0.15266026214951214 + 0.11655867931837577i, 0.09142987927490258 + 0.02119254826640136i }, { -0.015426395608656517 + -0.09515793674613736i, 0.1364792687053172 + -0.04923396139126934i, -0.03419339052881857 + -0.13921667173771962i, -0.05335963407347952 + 0.0010234614920427289i }, { 0.16313278922671362 + -0.13275642997344922i, -0.0725683741346005 + -0.04275665699855414i, -0.04257696350760215 + -0.06500090763182234i, -0.07950463166601932 + 0.11825276576586145i }, { -0.11690351696644632 + 0.040075679347059544i, 0.11973432154042674 + -0.02094350972914421i, -0.1283262206375021 + -0.04191454318924584i, -0.05474441757078931 + 0.023625639471577448i } }), Matrix({ { 0.04700683474142113 + 0.014705346311408928i, -0.11928510272793348 + -0.0752358648565767i, 0.08019887071729505 + 0.01704313295145926i, -0.020035155141894873 + 0.09700625340040044i }, { 0.05882540791971788 + -0.1821696036266886i, -0.029500049779244256 + 0.08120049866577961i, 0.02480922405124148 + 0.0557373877922619i, 0.038905517222217495 + -0.026609752312273388i }, { -0.07498909974197578 + -0.011040790406718742i, -0.056672349572649924 + -0.14187202769005183i, 0.10463499500834417 + -0.1678524775174835i, 0.04237510603522429 + -0.015408042042719677i }, { -0.004653819822864398 + -0.00994980388630167i, 0.0418434650331246 + -0.047419891841467283i, -0.09617775679624198 + 0.05588333826567771i, -0.07951598098328548 + -0.06130739286679129i } }), Matrix({ { 0.06497919332716294 + 0.018003849631752722i, -0.16745592333839035 + -0.0862700845184327i, 0.03994191577435259 + 0.20023455416779407i, -0.017786830039236555 + -0.15699327212239025i }, { -0.08782506652863768 + -0.3117567044653042i, -0.0429181894038109 + -0.04556219567268576i, -0.03926598566901356 + -0.05083868063047718i, -0.03457219314452451 + 0.03727629171111649i }, { -0.03788801852763244 + 0.021543249644229066i, -0.12732526977490247 + 0.029679365309911773i, 0.07427724555287525 + 0.0729830420081836i, -0.012630336543499638 + -0.030195171397571646i }, { -0.013525399968664146 + 0.012689948487909768i, 0.2010019739702448 + -0.03374656230833178i, 0.020826451868567172 + 0.01792248943981604i, -0.2177914822686047 + -0.026239451784613288i } }), Matrix({ { 0.08235697573446824 + 0.1164156577297498i, -0.010525773063276922 + -0.2226000170742458i, 0.07230018187970966 + -0.022770202397764484i, -0.026961010732353644 + 0.02248362777430227i }, { 0.08932522086358265 + 0.05506834095781346i, 0.10641701191778381 + -0.010966252156378697i, 0.011764110343124254 + 0.1461691155877419i, 0.0854563001524306 + -0.0686152349111153i }, { -0.2795962899124903 + 0.09683830158649118i, -0.19148767424521287 + -0.03727260846815315i, -0.04226630406646616 + 0.045726672401958005i, 0.029006379396958753 + -0.0576746555482276i }, { -0.033744256217006045 + -0.0835946105170121i, -0.04517521812579226 + -0.0761755103503924i, 0.17032195441948642 + -0.03714999532266221i, 0.057551210078559456 + 0.025527902756447052i } }), Matrix({ { -0.03327334096969869 + -0.017639733477038934i, 0.022027809130015875 + -0.04746520369253607i, -0.024003074338218657 + -0.038507549143432865i, -0.12105036975357307 + 0.1030816263997604i }, { -0.025107166695621325 + 0.08003703241514995i, -0.17436243029673465 + -0.025981595491950695i, 0.08653609543107033 + 0.04328007781415044i, -0.04408279609649314 + -0.04553466638617601i }, { 0.06742797860014338 + 0.07317811751755493i, 0.05495227535503867 + 0.12421266740441646i, 0.011451463448883098 + -0.03968084608580883i, -0.021491087741654678 + 0.04967169881246828i }, { -0.052838428370042184 + 0.15320026764474517i, 0.019940867913293726 + 0.02614902514611876i, -0.05357992831332687 + -0.17552672209965584i, 0.15156670300426112 + 0.09998086006122009i } }), Matrix({ { -0.00927201968448225 + 0.11736922445208449i, -0.03803423038212725 + 0.3239549918201465i, -0.21865461195657843 + 0.012169238465154279i, 0.11534620324852995 + 0.062384516898456484i }, { -0.055991679299719814 + 0.04407680943407563i, 0.060491923992833596 + 0.02384647526782874i, -0.048610142208071826 + -0.0012327269980451502i, -0.0015110923368978086 + 0.1521802629276145i }, { -0.03884843734709007 + 0.08718400515553465i, 0.016095775644801004 + -0.14875679603397735i, 0.0675144804972641 + -0.08439753099243706i, -0.03820784540158057 + -0.04445121938472649i }, { 0.09715445468528844 + -0.031013941530661393i, -0.056157935104124306 + -0.13592507112583554i, -0.038681818568615516 + 0.04509295414189414i, -0.0011442737886071485 + 0.09921230423243103i } }), Matrix({ { 0.032696841727233306 + 0.03702605688254905i, -0.0438354322831792 + -0.04301447416487649i, -0.08871934486942126 + -0.12079211321433689i, -0.020736844732415247 + -0.03956289840335351i }, { -0.08044411895631855 + -0.03960604373291441i, 0.008402453496805797 + -0.13750666829217922i, -0.0388487957568871 + 0.08107980771366764i, -0.01165779626903648 + -0.046403159863290556i }, { -0.12814065374171843 + -0.06185891903902031i, -0.07427067636441582 + -0.047883932327391736i, -0.05958900989071539 + 4.101331935918864e-05i, -0.1401894680996743 + 0.0829869480780013i }, { 0.05392331658672556 + -0.04577443182683304i, -0.09178011896327722 + -0.1467189024336109i, -0.02416556225785767 + -0.12194919294989388i, -0.03207291126985852 + -0.13207075629971018i } }), Matrix({ { 0.051149319805307576 + 0.06036831673991538i, -0.11310658152518178 + -0.04573699185030195i, -0.013013599482061981 + -0.000744169926523283i, 0.21631354326876895 + -0.013607635437862559i }, { 0.030542007734194066 + 0.008417464304685474i, -0.004245129390147105 + 0.0925289658807501i, 0.04718524047409473 + -0.054775715544925434i, -0.07339635506116995 + -0.05792095987135295i }, { 0.013434188375718817 + -0.08915128954697116i, 0.08764940707487572 + -0.18223859450883842i, -0.08005788467731058 + -0.05927522108250457i, 0.022607763109940185 + 0.14361370596272255i }, { -0.057537415456328206 + 0.08880224615655277i, 0.037277170416433664 + 0.14923647303936993i, -0.037638968037699935 + 0.055486189649527645i, -0.09955778019652789 + -0.09247579485767801i } }), Matrix({ { 0.07267895813280598 + 0.014874272824446607i, 0.018600578863050214 + 0.061365236132847334i, 0.02657630984196069 + 0.03924096321735613i, -0.0553896488280696 + 0.011738298145345128i }, { -0.08419745208701991 + -0.029822753371808196i, 0.03504464681019242 + -0.0775160576962227i, 0.06062939092750265 + 0.0006200264436939456i, -0.11862902908690601 + 0.10318177480988738i }, { -0.030527702886851735 + -0.01809395650760147i, -0.04809046519672842 + 0.01803807694975686i, 0.06573123633783588 + -0.056450279272650464i, -0.2814422636558266 + -0.03344231708626601i }, { 0.048521108947787384 + 0.04457495887295966i, 0.028160189727007342 + 0.11461949717141369i, 0.03488044357286125 + -0.10448504639732843i, -0.003567023920896098 + 0.07052178521262792i } }) }, { QubitIndex{ 2 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 8 }, QubitIndex{ 4 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 10_15_2_70_0_50) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false, false}), Matrix({ { 0.9999999999999998 + 2.24251972785576e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false, false}), Matrix({ { 0.5614512404283585 + 2.3568691757350907e-19i, -0.007168395661623327 + -0.00467810552931978i }, { -0.007168395661623325 + 0.004678105529319779i, 0.4385487595716413 + -1.1434944787933055e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5614512404283585, 1.0e-7), DoubleNear(0.4385487595716413, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false, false}), Matrix({ { 0.5266562360541849 + 1.7618285302889447e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.47334376394581473 + 4.8069119756681544e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5266562360541849, 1.0e-7), DoubleNear(0.47334376394581473, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false, false}), Matrix({ { 0.9999999999999998 + 2.24251972785576e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false, false}), Matrix({ { 0.48974374759092576 + -1.8740603958001395e-19i, -0.02909599101228798 + -0.027394427784005883i }, { -0.029095991012287978 + 0.027394427784005887i, 0.5102562524090739 + 4.1165801236558996e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.48974374759092576, 1.0e-7), DoubleNear(0.5102562524090739, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false, false}), Matrix({ { 0.4995968283046447 + -3.8539999100070665e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.500403171695355 + 2.627919718856467e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4995968283046447, 1.0e-7), DoubleNear(0.500403171695355, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false, false}), Matrix({ { 0.9999999999999998 + 2.24251972785576e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false, false}), Matrix({ { 0.49243757268401184 + 1.6792428179316504e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.507562427315988 + 5.632769099241097e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.49243757268401184, 1.0e-7), DoubleNear(0.507562427315988, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true, false}), Matrix({ { 0.24235528565073491 + 7.009197638529335e-20i, -0.0005161818554078049 + -0.00681451339504183i }, { -0.0005161818554078052 + 0.006814513395041831i, 0.7576447143492648 + 1.5415999640028266e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24235528565073491, 1.0e-7), DoubleNear(0.7576447143492648, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, false, true}), Matrix({ { 0.35691990513617144 + 2.5622746654442585e-20i, -8.131516293641283e-19 + -1.734723475976807e-18i }, { -8.673617379884035e-19 + 1.951563910473908e-18i, 0.6430800948638283 + 1.9862922613113343e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.35691990513617144, 1.0e-7), DoubleNear(0.6430800948638283, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false, false}), Matrix({ { 0.5614512404283585 + 2.3568691757350907e-19i, 0.0 + 0.0i, -0.007168395661623327 + -0.00467810552931978i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007168395661623325 + 0.004678105529319779i, 0.0 + 0.0i, 0.4385487595716413 + -1.1434944787933055e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5614512404283585, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4385487595716413, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false, false}), Matrix({ { 0.5266562360541849 + 1.7618285302889447e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.47334376394581473 + 4.8069119756681544e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5266562360541849, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.47334376394581473, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false, false}), Matrix({ { 0.9999999999999998 + 2.24251972785576e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false, false}), Matrix({ { 0.48974374759092576 + -1.8740603958001395e-19i, 0.0 + 0.0i, -0.02909599101228798 + -0.027394427784005883i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.029095991012287978 + 0.027394427784005887i, 0.0 + 0.0i, 0.5102562524090739 + 4.1165801236558996e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.48974374759092576, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5102562524090739, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false, false}), Matrix({ { 0.4995968283046447 + -3.8539999100070665e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.500403171695355 + 2.627919718856467e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4995968283046447, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.500403171695355, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false, false}), Matrix({ { 0.9999999999999998 + 2.24251972785576e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false, false}), Matrix({ { 0.49243757268401184 + 1.6792428179316504e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.507562427315988 + 5.632769099241097e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.49243757268401184, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.507562427315988, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true, false}), Matrix({ { 0.24235528565073491 + 7.009197638529335e-20i, 0.0 + 0.0i, -0.0005161818554078049 + -0.00681451339504183i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005161818554078052 + 0.006814513395041831i, 0.0 + 0.0i, 0.7576447143492648 + 1.5415999640028266e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24235528565073491, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.7576447143492648, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false, true}), Matrix({ { 0.35691990513617144 + 2.5622746654442585e-20i, 0.0 + 0.0i, -8.131516293641283e-19 + -1.734723475976807e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.673617379884035e-19 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.6430800948638283 + 1.9862922613113343e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.35691990513617144, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6430800948638283, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false, false}), Matrix({ { 0.2956917970119526 + 2.168404344971009e-19i, -0.0037752802776976914 + -0.0024637534499358264i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003775280277697691 + 0.0024637534499358255i, 0.2309644390422324 + -4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.26575944341640584 + 1.8846483076408183e-20i, -0.0033931153839256347 + -0.0022143520793839536i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.003393115383925635 + 0.0022143520793839527i, 0.20758432052940892 + 2.922263668027336e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2956917970119526, 1.0e-7), DoubleNear(0.2309644390422324, 1.0e-7), DoubleNear(0.26575944341640584, 1.0e-7), DoubleNear(0.20758432052940892, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false, false}), Matrix({ { 0.5614512404283585 + 2.3568691757350907e-19i, -0.007168395661623327 + -0.00467810552931978i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007168395661623325 + 0.004678105529319779i, 0.4385487595716413 + -1.1434944787933055e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5614512404283585, 1.0e-7), DoubleNear(0.4385487595716413, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false, false}), Matrix({ { 0.2749672345769582 + -7.178604227980195e-20i, -0.0035106769555379425 + -0.002291072933554901i, -0.016335980245341455 + -0.015380635460155194i, 8.041755165420729e-05 + 0.0003324882137151443i }, { -0.0035106769555379416 + 0.0022910729335549i, 0.21477651301396755 + -1.15619997300212e-19i, 0.00033672559983202586 + 6.025998084389824e-05i, -0.012760010766946519 + -0.01201379232385069i }, { -0.01633598024534146 + 0.015380635460155192i, 0.0003367255998320257 + -6.025998084389838e-05i, 0.2864840058514002 + 3.07472959853311e-19i, -0.003657718706085385 + -0.002387032595764879i }, { 8.041755165420726e-05 + -0.00033248821371514425i, -0.012760010766946522 + 0.012013792323850688i, -0.0036577187060853845 + 0.002387032595764878i, 0.2237722465576738 + 1.0418505251227894e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2749672345769582, 1.0e-7), DoubleNear(0.21477651301396755, 1.0e-7), DoubleNear(0.2864840058514002, 1.0e-7), DoubleNear(0.2237722465576738, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false, false}), Matrix({ { 0.27857585719956757 + 1.3129010682441655e-20i, -0.004304808275989417 + -0.0013247007775804213i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004304808275989417 + 0.00132470077758042i, 0.22102097110507712 + -5.166900978251232e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2828753832287908 + 2.225579068910674e-19i, -0.002863587385633909 + -0.0033534047517393586i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0028635873856339093 + 0.003353404751739358i, 0.21752778846656423 + 4.0234064994579266e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.27857585719956757, 1.0e-7), DoubleNear(0.22102097110507712, 1.0e-7), DoubleNear(0.2828753832287908, 1.0e-7), DoubleNear(0.21752778846656423, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false, false}), Matrix({ { 0.5614512404283585 + 2.3568691757350907e-19i, -0.007168395661623327 + -0.00467810552931978i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007168395661623325 + 0.004678105529319779i, 0.4385487595716413 + -1.1434944787933055e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5614512404283585, 1.0e-7), DoubleNear(0.4385487595716413, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false, false}), Matrix({ { 0.2404017911063912 + 1.1413768964251697e-19i, -0.017100930720499122 + 0.016687489186303434i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01710093072049912 + -0.016687489186303434i, 0.25203578157762063 + 5.378659215064807e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.3210494493219672 + 1.215492279309921e-19i, 0.009932535058875796 + -0.021365594715623215i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.009932535058875796 + 0.021365594715623215i, 0.1865129779940207 + -6.522153693858113e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2404017911063912, 1.0e-7), DoubleNear(0.25203578157762063, 1.0e-7), DoubleNear(0.3210494493219672, 1.0e-7), DoubleNear(0.1865129779940207, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true, false}), Matrix({ { 0.13607067575297427 + -4.468098796766434e-20i, -0.0017372985782302106 + -0.0011337636018625772i, -0.0002898109430053236 + -0.0038260169985619005i, -2.8178817020054835e-05 + 5.126388144900962e-05i }, { -0.0017372985782302102 + 0.0011337636018625779i, 0.1062846098977606 + 1.147729643529577e-19i, 3.5579208565882914e-05 + 4.643437506517409e-05i, -0.00022637091240248114 + -0.0029884963964799303i }, { -0.0002898109430053237 + 0.003826016998561902i, 3.55792085658829e-05 + -4.643437506517412e-05i, 0.4253805646753841 + 2.803679055411734e-19i, -0.0054310970833931155 + -0.0035443419274572025i }, { -2.8178817020054842e-05 + -5.1263881449009675e-05i, -0.00022637091240248109 + 0.0029884963964799294i, -0.005431097083393115 + 0.0035443419274572008i, 0.33226414967388074 + -1.2620790914089075e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.13607067575297427, 1.0e-7), DoubleNear(0.1062846098977606, 1.0e-7), DoubleNear(0.4253805646753841, 1.0e-7), DoubleNear(0.33226414967388074, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false, true}), Matrix({ { 0.2003931234722755 + 5.1033735072071595e-20i, -0.0025585430995251424 + -0.0016697089817418159i, -3.7947076036992655e-19 + -1.0842021724855044e-18i, -6.776263578034403e-21 + -1.6940658945086007e-21i }, { -0.002558543099525143 + 0.0016697089817418144i, 0.15652678166389591 + -2.541098841762901e-20i, 1.6940658945086007e-20 + -1.0164395367051604e-20i, -4.87890977618477e-19 + -5.421010862427522e-19i }, { -4.336808689942018e-19 + 1.5178830414797062e-18i, 2.710505431213761e-20 + 1.0164395367051604e-20i, 0.3610581169560829 + 1.8465318250143747e-19i, -0.004609852562098184 + -0.003008396547577964i }, { -2.0328790734103208e-20 + -1.0164395367051604e-20i, -5.149960319306146e-19 + 2.168404344971009e-19i, -0.0046098525620981825 + 0.0030083965475779643i, 0.2820219779077454 + 1.3976043629695956e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2003931234722755, 1.0e-7), DoubleNear(0.15652678166389591, 1.0e-7), DoubleNear(0.3610581169560829, 1.0e-7), DoubleNear(0.2820219779077454, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false, false}), Matrix({ { 0.5266562360541849 + 1.7618285302889447e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.47334376394581473 + 4.8069119756681544e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5266562360541849, 1.0e-7), DoubleNear(0.47334376394581473, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false, false}), Matrix({ { 0.25098061571553076 + -1.2197274440461925e-19i, 0.0 + 0.0i, -0.01319559860659415 + -0.037582754308355906i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23876313187539502 + -6.54332951753947e-20i, 0.0 + 0.0i, -0.015900392405693825 + 0.010188326524350023i }, { -0.013195598606594151 + 0.037582754308355906i, 0.0 + 0.0i, 0.2756756203386542 + 2.981555974335137e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.015900392405693825 + -0.010188326524350023i, 0.0 + 0.0i, 0.23458063207041974 + 1.1350241493207625e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25098061571553076, 1.0e-7), DoubleNear(0.23876313187539502, 1.0e-7), DoubleNear(0.2756756203386542, 1.0e-7), DoubleNear(0.23458063207041974, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.038441052624529834 + -0.00783759744826558i }, { 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0396217410307316 + 0.008078323438004445i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0396217410307316 + -0.008078323438004444i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i }, { 0.038441052624529834 + 0.007837597448265577i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false, false}), Matrix({ { 0.5266562360541849 + 1.7618285302889447e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.47334376394581473 + 4.8069119756681544e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5266562360541849, 1.0e-7), DoubleNear(0.47334376394581473, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00402995502085195 + -0.0011810533245481744i }, { 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0041706598994815025 + 0.0004909383142239766i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0041706598994815025 + -0.0004909383142239766i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i }, { 0.00402995502085195 + 0.0011810533245481744i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true, false}), Matrix({ { 0.12737326441536706 + 9.486769009248164e-20i, 0.0 + 0.0i, -0.00017152051985770797 + -0.00362057117889916i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.11498202123536781 + -2.4775713707188285e-20i, 0.0 + 0.0i, -0.00034466133555009694 + -0.00319394221614267i }, { -0.00017152051985770797 + 0.0036205711788991606i, 0.0 + 0.0i, 0.3992829716388179 + 8.131516293641283e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0003446613355500972 + 0.00319394221614267i, 0.0 + 0.0i, 0.35836174271044696 + 7.284483346386983e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12737326441536706, 1.0e-7), DoubleNear(0.11498202123536781, 1.0e-7), DoubleNear(0.3992829716388179, 1.0e-7), DoubleNear(0.35836174271044696, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false, true}), Matrix({ { 0.18370133138605538 + 1.3552527156068805e-20i, 0.0 + 0.0i, -0.00024340855166309026 + -6.232676439789299e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.173218573750116 + 1.207021949837378e-20i, 0.0 + 0.0i, 0.00024340855166308945 + 6.232676439789147e-05i }, { -0.0002434085516630903 + 6.232676439789332e-05i, 0.0 + 0.0i, 0.34295490466812956 + 1.6263032587282567e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.00024340855166308937 + -6.232676439789147e-05i, 0.0 + 0.0i, 0.3001251901956987 + 3.5998900258307764e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.18370133138605538, 1.0e-7), DoubleNear(0.173218573750116, 1.0e-7), DoubleNear(0.34295490466812956, 1.0e-7), DoubleNear(0.3001251901956987, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false, false}), Matrix({ { 0.48974374759092576 + -1.8740603958001395e-19i, 0.0 + 0.0i, -0.02909599101228798 + -0.027394427784005883i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.029095991012287978 + 0.027394427784005887i, 0.0 + 0.0i, 0.5102562524090739 + 4.1165801236558996e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.48974374759092576, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5102562524090739, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false, false}), Matrix({ { 0.4995968283046447 + -3.8539999100070665e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.500403171695355 + 2.627919718856467e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4995968283046447, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.500403171695355, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false, false}), Matrix({ { 0.9999999999999998 + 2.24251972785576e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false, false}), Matrix({ { 0.49243757268401184 + 1.6792428179316504e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.507562427315988 + 5.632769099241097e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.49243757268401184, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.507562427315988, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true, false}), Matrix({ { 0.24235528565073491 + 7.009197638529335e-20i, 0.0 + 0.0i, -0.0005161818554078049 + -0.00681451339504183i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005161818554078052 + 0.006814513395041831i, 0.0 + 0.0i, 0.7576447143492648 + 1.5415999640028266e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24235528565073491, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.7576447143492648, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false, true}), Matrix({ { 0.35691990513617144 + 2.5622746654442585e-20i, 0.0 + 0.0i, -8.131516293641283e-19 + -1.734723475976807e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.673617379884035e-19 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.6430800948638283 + 1.9862922613113343e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.35691990513617144, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6430800948638283, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false, false}), Matrix({ { 0.24477947996193758 + -1.6728900708272432e-19i, -0.014568450312654416 + -0.013335948565399412i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014568450312654416 + 0.013335948565399412i, 0.2548173483427071 + 1.2874900798265365e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.24496426762898815 + -2.0117032497289633e-20i, -0.014527540699633563 + -0.014058479218606472i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.014527540699633563 + 0.014058479218606468i, 0.2554389040663669 + 2.829090043829363e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24477947996193758, 1.0e-7), DoubleNear(0.2548173483427071, 1.0e-7), DoubleNear(0.24496426762898815, 1.0e-7), DoubleNear(0.2554389040663669, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false, false}), Matrix({ { 0.48974374759092576 + -1.8740603958001395e-19i, -0.02909599101228798 + -0.027394427784005883i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.029095991012287978 + 0.027394427784005887i, 0.5102562524090739 + 4.1165801236558996e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.48974374759092576, 1.0e-7), DoubleNear(0.5102562524090739, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false, false}), Matrix({ { 0.2411682223008469 + -8.787966827763366e-20i, -0.01432795918892692 + -0.013490045523023313i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01432795918892692 + 0.013490045523023315i, 0.25126935038316495 + 2.558039500707987e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2485755252900788 + -9.952637130238029e-20i, -0.014768031823361057 + -0.013904382260982572i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.014768031823361057 + 0.013904382260982569i, 0.258986902025909 + 1.5585406229479126e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2411682223008469, 1.0e-7), DoubleNear(0.25126935038316495, 1.0e-7), DoubleNear(0.2485755252900788, 1.0e-7), DoubleNear(0.258986902025909, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true, false}), Matrix({ { 0.12607506001776414 + -2.4775713707188285e-20i, -0.006708604256184058 + 0.011239142287418262i, -0.0017610762768021791 + -0.0016631284824112885i, 0.014907815656265956 + 0.019993053339204803i }, { -0.006708604256184057 + -0.01123914228741826i, 0.11628022563297072 + 9.486769009248164e-20i, 0.013304214395385658 + 0.0202417033971825i, 0.0012448944213943746 + -0.0051513849126305425i }, { -0.0017610762768021796 + 0.0016631284824112887i, 0.013304214395385658 + -0.0202417033971825i, 0.3636686875731616 + -1.6263032587282567e-19i, -0.02238738675610392 + -0.03863357007142415i }, { 0.014907815656265956 + -0.0199930533392048i, 0.0012448944213943746 + 0.005151384912630542i, -0.02238738675610392 + 0.03863357007142415i, 0.3939760267761032 + 3.1679032227310833e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12607506001776414, 1.0e-7), DoubleNear(0.11628022563297072, 1.0e-7), DoubleNear(0.3636686875731616, 1.0e-7), DoubleNear(0.3939760267761032, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false, true}), Matrix({ { 0.17573308486176262 + -4.5528020914918643e-20i, -0.013036853468380329 + -0.005756365626324203i, -0.00015308491452703944 + 1.8498575363145838e-06i, 0.0010656357806666228 + -0.0010219487335940245i }, { -0.013036853468380329 + 0.005756365626324205i, 0.1811868202744088 + 7.115076756936123e-20i, 0.0008013008637348955 + -0.0011021197816143522i, 0.00015308491452703868 + -1.84985753631621e-06i }, { -0.00015308491452703938 + -1.849857536314367e-06i, 0.0008013008637348955 + 0.001102119781614352i, 0.31401066272916317 + -1.418780186650953e-19i, -0.016059137543907653 + -0.02163806215768168i }, { 0.0010656357806666228 + 0.0010219487335940245i, 0.00015308491452703857 + 1.8498575363163185e-06i, -0.01605913754390765 + 0.021638062157681683i, 0.32906943213466516 + 3.4050724479622874e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17573308486176262, 1.0e-7), DoubleNear(0.1811868202744088, 1.0e-7), DoubleNear(0.31401066272916317, 1.0e-7), DoubleNear(0.32906943213466516, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false, false}), Matrix({ { 0.4995968283046447 + -3.8539999100070665e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.500403171695355 + 2.627919718856467e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.4995968283046447, 1.0e-7), DoubleNear(0.500403171695355, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027663018353824387 + -0.002327955206080047i }, { 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.024862740310083793 + -0.002092300449718426i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.024862740310083793 + 0.0020923004497184297i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0 + 0.0i }, { 0.02766301835382439 + 0.002327955206080052i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2673109175327641 + 1.3552527156068805e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true, false}), Matrix({ { 0.12108393494946397 + -7.242131699024268e-20i, 0.0 + 0.0i, -0.00025940029253800686 + -0.003404030346999174i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.12127135070127092 + 1.4251329337553603e-19i, 0.0 + 0.0i, -0.00025678156286979795 + -0.0034104830480426564i }, { -0.0002594002925380074 + 0.0034040303469991743i, 0.0 + 0.0i, 0.37851289335518074 + 3.3881317890172014e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0002567815628697978 + 0.003410483048042657i, 0.0 + 0.0i, 0.37913182099408416 + 1.2027867851011065e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12108393494946397, 1.0e-7), DoubleNear(0.12127135070127092, 1.0e-7), DoubleNear(0.37851289335518074, 1.0e-7), DoubleNear(0.37913182099408416, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false, true}), Matrix({ { 0.17838067747539282 + -1.198551620364835e-19i, 0.0 + 0.0i, 3.6815189600836542e-06 + 9.426832511987612e-07i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.17853922766077862 + 1.4547790869092608e-19i, 0.0 + 0.0i, -3.6815189600844403e-06 + -9.426832512004959e-07i }, { 3.6815189600836813e-06 + -9.426832511985443e-07i, 0.0 + 0.0i, 0.32121615082925187 + 8.131516293641283e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -3.681518960084603e-06 + 9.426832512004959e-07i, 0.0 + 0.0i, 0.3218639440345764 + 1.173140631947206e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17838067747539282, 1.0e-7), DoubleNear(0.17853922766077862, 1.0e-7), DoubleNear(0.32121615082925187, 1.0e-7), DoubleNear(0.3218639440345764, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false, false}), Matrix({ { 0.49243757268401184 + 1.6792428179316504e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.507562427315988 + 5.632769099241097e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.49243757268401184, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.507562427315988, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true, false}), Matrix({ { 0.24235528565073491 + 7.009197638529335e-20i, 0.0 + 0.0i, -0.0005161818554078049 + -0.00681451339504183i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005161818554078052 + 0.006814513395041831i, 0.0 + 0.0i, 0.7576447143492648 + 1.5415999640028266e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.24235528565073491, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.7576447143492648, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false, true}), Matrix({ { 0.35691990513617144 + 2.5622746654442585e-20i, 0.0 + 0.0i, -8.131516293641283e-19 + -1.734723475976807e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.673617379884035e-19 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.6430800948638283 + 1.9862922613113343e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.35691990513617144, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6430800948638283, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true, false}), Matrix({ { 0.11934484859298825 + 7.4750657595192e-20i, 0.0 + 0.0i, -0.0002541873399405489 + -0.0033557224352770846i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.12301043705774664 + -4.658681209898652e-21i, 0.0 + 0.0i, -0.000261994515467256 + -0.0034587909597647458i }, { -0.0002541873399405491 + 0.003355722435277084i, 0.0 + 0.0i, 0.37309272409102356 + 9.317362419797304e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0002619945154672561 + 0.0034587909597647466i, 0.0 + 0.0i, 0.38455199025824127 + 6.098637220230962e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.11934484859298825, 1.0e-7), DoubleNear(0.12301043705774664, 1.0e-7), DoubleNear(0.37309272409102356, 1.0e-7), DoubleNear(0.38455199025824127, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false, true}), Matrix({ { 0.17576077172786408 + -1.1202010727438122e-19i, 0.0 + 0.0i, -3.7947076036992655e-19 + -9.75781955236954e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.18115913340830736 + 1.376428539288238e-19i, 0.0 + 0.0i, -4.0657581468206416e-19 + -7.589415207398531e-19i }, { -4.87890977618477e-19 + 7.589415207398531e-19i, 0.0 + 0.0i, 0.31667680095614775 + 2.7994438906754626e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -3.7947076036992655e-19 + 1.0842021724855044e-18i, 0.0 + 0.0i, 0.3264032939076806 + -8.131516293641283e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.17576077172786408, 1.0e-7), DoubleNear(0.18115913340830736, 1.0e-7), DoubleNear(0.31667680095614775, 1.0e-7), DoubleNear(0.3264032939076806, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true, true}), Matrix({ { 0.08998608446161596 + -4.870439446712227e-21i, -0.001185425211896573 + 0.0002715817033279701i, -0.00044943612301760494 + -0.0013716267491704483i, 0.0001242138411844168 + 0.0009601323166383209i }, { -0.001185425211896573 + -0.0002715817033279699i, 0.2669338206745555 + 3.049318610115481e-20i, -0.0007257330694235348 + -0.000994396808424427i, 0.00044943612301760413 + 0.0013716267491704465i }, { -0.00044943612301760505 + 0.0013716267491704483i, -0.000725733069423535 + 0.000994396808424427i, 0.15236920118911895 + 7.496241583200558e-20i, 0.000669243356488768 + -0.007086095098369801i }, { 0.0001242138411844168 + -0.0009601323166383209i, 0.0004494361230176042 + -0.0013716267491704463i, 0.0006692433564887677 + 0.007086095098369801i, 0.4907108936747094 + 1.2366681029912785e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.08998608446161596, 1.0e-7), DoubleNear(0.2669338206745555, 1.0e-7), DoubleNear(0.15236920118911895, 1.0e-7), DoubleNear(0.4907108936747094, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false, false, false}), Matrix({ { 0.2956917970119526 + 2.168404344971009e-19i, 0.0 + 0.0i, -0.0037752802776976914 + -0.0024637534499358264i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003775280277697691 + 0.0024637534499358255i, 0.0 + 0.0i, 0.2309644390422324 + -4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26575944341640584 + 1.8846483076408183e-20i, 0.0 + 0.0i, -0.0033931153839256347 + -0.0022143520793839536i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.003393115383925635 + 0.0022143520793839527i, 0.0 + 0.0i, 0.20758432052940892 + 2.922263668027336e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2956917970119526, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2309644390422324, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26575944341640584, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20758432052940892, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false, false, false}), Matrix({ { 0.5614512404283585 + 2.3568691757350907e-19i, 0.0 + 0.0i, -0.007168395661623327 + -0.00467810552931978i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007168395661623325 + 0.004678105529319779i, 0.0 + 0.0i, 0.4385487595716413 + -1.1434944787933055e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5614512404283585, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4385487595716413, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false, false, false}), Matrix({ { 0.2749672345769582 + -7.178604227980195e-20i, 0.0 + 0.0i, -0.0035106769555379425 + -0.002291072933554901i, 0.0 + 0.0i, -0.016335980245341455 + -0.015380635460155194i, 0.0 + 0.0i, 8.041755165420729e-05 + 0.0003324882137151443i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0035106769555379416 + 0.0022910729335549i, 0.0 + 0.0i, 0.21477651301396755 + -1.15619997300212e-19i, 0.0 + 0.0i, 0.00033672559983202586 + 6.025998084389824e-05i, 0.0 + 0.0i, -0.012760010766946519 + -0.01201379232385069i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01633598024534146 + 0.015380635460155192i, 0.0 + 0.0i, 0.0003367255998320257 + -6.025998084389838e-05i, 0.0 + 0.0i, 0.2864840058514002 + 3.07472959853311e-19i, 0.0 + 0.0i, -0.003657718706085385 + -0.002387032595764879i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 8.041755165420726e-05 + -0.00033248821371514425i, 0.0 + 0.0i, -0.012760010766946522 + 0.012013792323850688i, 0.0 + 0.0i, -0.0036577187060853845 + 0.002387032595764878i, 0.0 + 0.0i, 0.2237722465576738 + 1.0418505251227894e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2749672345769582, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21477651301396755, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2864840058514002, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2237722465576738, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false, false, false}), Matrix({ { 0.27857585719956757 + 1.3129010682441655e-20i, 0.0 + 0.0i, -0.004304808275989417 + -0.0013247007775804213i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004304808275989417 + 0.00132470077758042i, 0.0 + 0.0i, 0.22102097110507712 + -5.166900978251232e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2828753832287908 + 2.225579068910674e-19i, 0.0 + 0.0i, -0.002863587385633909 + -0.0033534047517393586i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0028635873856339093 + 0.003353404751739358i, 0.0 + 0.0i, 0.21752778846656423 + 4.0234064994579266e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.27857585719956757, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22102097110507712, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2828753832287908, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21752778846656423, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false, false, false}), Matrix({ { 0.5614512404283585 + 2.3568691757350907e-19i, 0.0 + 0.0i, -0.007168395661623327 + -0.00467810552931978i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007168395661623325 + 0.004678105529319779i, 0.0 + 0.0i, 0.4385487595716413 + -1.1434944787933055e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5614512404283585, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4385487595716413, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true, false, false}), Matrix({ { 0.2404017911063912 + 1.1413768964251697e-19i, 0.0 + 0.0i, -0.017100930720499122 + 0.016687489186303434i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01710093072049912 + -0.016687489186303434i, 0.0 + 0.0i, 0.25203578157762063 + 5.378659215064807e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3210494493219672 + 1.215492279309921e-19i, 0.0 + 0.0i, 0.009932535058875796 + -0.021365594715623215i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.009932535058875796 + 0.021365594715623215i, 0.0 + 0.0i, 0.1865129779940207 + -6.522153693858113e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2404017911063912, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25203578157762063, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3210494493219672, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1865129779940207, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, true, false}), Matrix({ { 0.13607067575297427 + -4.468098796766434e-20i, 0.0 + 0.0i, -0.0017372985782302106 + -0.0011337636018625772i, 0.0 + 0.0i, -0.0002898109430053236 + -0.0038260169985619005i, 0.0 + 0.0i, -2.8178817020054835e-05 + 5.126388144900962e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017372985782302102 + 0.0011337636018625779i, 0.0 + 0.0i, 0.1062846098977606 + 1.147729643529577e-19i, 0.0 + 0.0i, 3.5579208565882914e-05 + 4.643437506517409e-05i, 0.0 + 0.0i, -0.00022637091240248114 + -0.0029884963964799303i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002898109430053237 + 0.003826016998561902i, 0.0 + 0.0i, 3.55792085658829e-05 + -4.643437506517412e-05i, 0.0 + 0.0i, 0.4253805646753841 + 2.803679055411734e-19i, 0.0 + 0.0i, -0.0054310970833931155 + -0.0035443419274572025i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.8178817020054842e-05 + -5.1263881449009675e-05i, 0.0 + 0.0i, -0.00022637091240248109 + 0.0029884963964799294i, 0.0 + 0.0i, -0.005431097083393115 + 0.0035443419274572008i, 0.0 + 0.0i, 0.33226414967388074 + -1.2620790914089075e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.13607067575297427, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1062846098977606, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4253805646753841, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.33226414967388074, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false, true}), Matrix({ { 0.2003931234722755 + 5.1033735072071595e-20i, 0.0 + 0.0i, -0.0025585430995251424 + -0.0016697089817418159i, 0.0 + 0.0i, -3.7947076036992655e-19 + -1.0842021724855044e-18i, 0.0 + 0.0i, -6.776263578034403e-21 + -1.6940658945086007e-21i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002558543099525143 + 0.0016697089817418144i, 0.0 + 0.0i, 0.15652678166389591 + -2.541098841762901e-20i, 0.0 + 0.0i, 1.6940658945086007e-20 + -1.0164395367051604e-20i, 0.0 + 0.0i, -4.87890977618477e-19 + -5.421010862427522e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.336808689942018e-19 + 1.5178830414797062e-18i, 0.0 + 0.0i, 2.710505431213761e-20 + 1.0164395367051604e-20i, 0.0 + 0.0i, 0.3610581169560829 + 1.8465318250143747e-19i, 0.0 + 0.0i, -0.004609852562098184 + -0.003008396547577964i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.0328790734103208e-20 + -1.0164395367051604e-20i, 0.0 + 0.0i, -5.149960319306146e-19 + 2.168404344971009e-19i, 0.0 + 0.0i, -0.0046098525620981825 + 0.0030083965475779643i, 0.0 + 0.0i, 0.2820219779077454 + 1.3976043629695956e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2003931234722755, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.15652678166389591, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3610581169560829, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2820219779077454, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false, false, false}), Matrix({ { 0.5266562360541849 + 1.7618285302889447e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.47334376394581473 + 4.8069119756681544e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5266562360541849, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.47334376394581473, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false, false, false}), Matrix({ { 0.25098061571553076 + -1.2197274440461925e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01319559860659415 + -0.037582754308355906i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.23876313187539502 + -6.54332951753947e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.015900392405693825 + 0.010188326524350023i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013195598606594151 + 0.037582754308355906i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2756756203386542 + 2.981555974335137e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.015900392405693825 + -0.010188326524350023i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23458063207041974 + 1.1350241493207625e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25098061571553076, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23876313187539502, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2756756203386542, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23458063207041974, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.038441052624529834 + -0.00783759744826558i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0 + 0.0i, 0.0396217410307316 + 0.008078323438004445i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0396217410307316 + -0.008078323438004444i, 0.0 + 0.0i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.038441052624529834 + 0.007837597448265577i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false, false, false}), Matrix({ { 0.5266562360541849 + 1.7618285302889447e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.47334376394581473 + 4.8069119756681544e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5266562360541849, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.47334376394581473, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00402995502085195 + -0.0011810533245481744i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i, 0.0041706598994815025 + 0.0004909383142239766i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0041706598994815025 + -0.0004909383142239766i, 0.0 + 0.0i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00402995502085195 + 0.0011810533245481744i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, true, false}), Matrix({ { 0.12737326441536706 + 9.486769009248164e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00017152051985770797 + -0.00362057117889916i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.11498202123536781 + -2.4775713707188285e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00034466133555009694 + -0.00319394221614267i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00017152051985770797 + 0.0036205711788991606i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3992829716388179 + 8.131516293641283e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0003446613355500972 + 0.00319394221614267i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.35836174271044696 + 7.284483346386983e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12737326441536706, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11498202123536781, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3992829716388179, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.35836174271044696, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false, true}), Matrix({ { 0.18370133138605538 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00024340855166309026 + -6.232676439789299e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.173218573750116 + 1.207021949837378e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00024340855166308945 + 6.232676439789147e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002434085516630903 + 6.232676439789332e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.34295490466812956 + 1.6263032587282567e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.00024340855166308937 + -6.232676439789147e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3001251901956987 + 3.5998900258307764e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.18370133138605538, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.173218573750116, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.34295490466812956, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3001251901956987, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false, false, false}), Matrix({ { 0.48974374759092576 + -1.8740603958001395e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.02909599101228798 + -0.027394427784005883i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.029095991012287978 + 0.027394427784005887i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.5102562524090739 + 4.1165801236558996e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.48974374759092576, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5102562524090739, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false, false, false}), Matrix({ { 0.4995968283046447 + -3.8539999100070665e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.500403171695355 + 2.627919718856467e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4995968283046447, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.500403171695355, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false, false, false}), Matrix({ { 0.9999999999999998 + 2.24251972785576e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999998, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true, false, false}), Matrix({ { 0.49243757268401184 + 1.6792428179316504e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.507562427315988 + 5.632769099241097e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.49243757268401184, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.507562427315988, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, true, false}), Matrix({ { 0.24235528565073491 + 7.009197638529335e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0005161818554078049 + -0.00681451339504183i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005161818554078052 + 0.006814513395041831i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.7576447143492648 + 1.5415999640028266e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24235528565073491, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.7576447143492648, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false, true}), Matrix({ { 0.35691990513617144 + 2.5622746654442585e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -8.131516293641283e-19 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.673617379884035e-19 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.6430800948638283 + 1.9862922613113343e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.35691990513617144, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6430800948638283, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false, false, false}), Matrix({ { 0.24477947996193758 + -1.6728900708272432e-19i, 0.0 + 0.0i, -0.014568450312654416 + -0.013335948565399412i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014568450312654416 + 0.013335948565399412i, 0.0 + 0.0i, 0.2548173483427071 + 1.2874900798265365e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24496426762898815 + -2.0117032497289633e-20i, 0.0 + 0.0i, -0.014527540699633563 + -0.014058479218606472i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014527540699633563 + 0.014058479218606468i, 0.0 + 0.0i, 0.2554389040663669 + 2.829090043829363e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24477947996193758, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2548173483427071, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24496426762898815, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2554389040663669, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false, false, false}), Matrix({ { 0.48974374759092576 + -1.8740603958001395e-19i, 0.0 + 0.0i, -0.02909599101228798 + -0.027394427784005883i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.029095991012287978 + 0.027394427784005887i, 0.0 + 0.0i, 0.5102562524090739 + 4.1165801236558996e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.48974374759092576, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5102562524090739, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true, false, false}), Matrix({ { 0.2411682223008469 + -8.787966827763366e-20i, 0.0 + 0.0i, -0.01432795918892692 + -0.013490045523023313i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01432795918892692 + 0.013490045523023315i, 0.0 + 0.0i, 0.25126935038316495 + 2.558039500707987e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2485755252900788 + -9.952637130238029e-20i, 0.0 + 0.0i, -0.014768031823361057 + -0.013904382260982572i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014768031823361057 + 0.013904382260982569i, 0.0 + 0.0i, 0.258986902025909 + 1.5585406229479126e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2411682223008469, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25126935038316495, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2485755252900788, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.258986902025909, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, true, false}), Matrix({ { 0.12607506001776414 + -2.4775713707188285e-20i, 0.0 + 0.0i, -0.006708604256184058 + 0.011239142287418262i, 0.0 + 0.0i, -0.0017610762768021791 + -0.0016631284824112885i, 0.0 + 0.0i, 0.014907815656265956 + 0.019993053339204803i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006708604256184057 + -0.01123914228741826i, 0.0 + 0.0i, 0.11628022563297072 + 9.486769009248164e-20i, 0.0 + 0.0i, 0.013304214395385658 + 0.0202417033971825i, 0.0 + 0.0i, 0.0012448944213943746 + -0.0051513849126305425i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017610762768021796 + 0.0016631284824112887i, 0.0 + 0.0i, 0.013304214395385658 + -0.0202417033971825i, 0.0 + 0.0i, 0.3636686875731616 + -1.6263032587282567e-19i, 0.0 + 0.0i, -0.02238738675610392 + -0.03863357007142415i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.014907815656265956 + -0.0199930533392048i, 0.0 + 0.0i, 0.0012448944213943746 + 0.005151384912630542i, 0.0 + 0.0i, -0.02238738675610392 + 0.03863357007142415i, 0.0 + 0.0i, 0.3939760267761032 + 3.1679032227310833e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12607506001776414, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11628022563297072, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3636686875731616, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3939760267761032, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false, true}), Matrix({ { 0.17573308486176262 + -4.5528020914918643e-20i, 0.0 + 0.0i, -0.013036853468380329 + -0.005756365626324203i, 0.0 + 0.0i, -0.00015308491452703944 + 1.8498575363145838e-06i, 0.0 + 0.0i, 0.0010656357806666228 + -0.0010219487335940245i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013036853468380329 + 0.005756365626324205i, 0.0 + 0.0i, 0.1811868202744088 + 7.115076756936123e-20i, 0.0 + 0.0i, 0.0008013008637348955 + -0.0011021197816143522i, 0.0 + 0.0i, 0.00015308491452703868 + -1.84985753631621e-06i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00015308491452703938 + -1.849857536314367e-06i, 0.0 + 0.0i, 0.0008013008637348955 + 0.001102119781614352i, 0.0 + 0.0i, 0.31401066272916317 + -1.418780186650953e-19i, 0.0 + 0.0i, -0.016059137543907653 + -0.02163806215768168i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010656357806666228 + 0.0010219487335940245i, 0.0 + 0.0i, 0.00015308491452703857 + 1.8498575363163185e-06i, 0.0 + 0.0i, -0.01605913754390765 + 0.021638062157681683i, 0.0 + 0.0i, 0.32906943213466516 + 3.4050724479622874e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17573308486176262, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1811868202744088, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.31401066272916317, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.32906943213466516, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false, false, false}), Matrix({ { 0.4995968283046447 + -3.8539999100070665e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.500403171695355 + 2.627919718856467e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.4995968283046447, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.500403171695355, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027663018353824387 + -0.002327955206080047i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i, 0.024862740310083793 + -0.002092300449718426i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.024862740310083793 + 0.0020923004497184297i, 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02766301835382439 + 0.002327955206080052i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, true, false}), Matrix({ { 0.12108393494946397 + -7.242131699024268e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00025940029253800686 + -0.003404030346999174i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.12127135070127092 + 1.4251329337553603e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00025678156286979795 + -0.0034104830480426564i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002594002925380074 + 0.0034040303469991743i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.37851289335518074 + 3.3881317890172014e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0002567815628697978 + 0.003410483048042657i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.37913182099408416 + 1.2027867851011065e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12108393494946397, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12127135070127092, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.37851289335518074, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.37913182099408416, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false, true}), Matrix({ { 0.17838067747539282 + -1.198551620364835e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 3.6815189600836542e-06 + 9.426832511987612e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.17853922766077862 + 1.4547790869092608e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -3.6815189600844403e-06 + -9.426832512004959e-07i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 3.6815189600836813e-06 + -9.426832511985443e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.32121615082925187 + 8.131516293641283e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -3.681518960084603e-06 + 9.426832512004959e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3218639440345764 + 1.173140631947206e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17838067747539282, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17853922766077862, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.32121615082925187, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3218639440345764, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true, false, false}), Matrix({ { 0.49243757268401184 + 1.6792428179316504e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.507562427315988 + 5.632769099241097e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.49243757268401184, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.507562427315988, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, true, false}), Matrix({ { 0.24235528565073491 + 7.009197638529335e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0005161818554078049 + -0.00681451339504183i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005161818554078052 + 0.006814513395041831i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.7576447143492648 + 1.5415999640028266e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.24235528565073491, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.7576447143492648, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false, true}), Matrix({ { 0.35691990513617144 + 2.5622746654442585e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -8.131516293641283e-19 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.673617379884035e-19 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.6430800948638283 + 1.9862922613113343e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.35691990513617144, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6430800948638283, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, true, false}), Matrix({ { 0.11934484859298825 + 7.4750657595192e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0002541873399405489 + -0.0033557224352770846i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.12301043705774664 + -4.658681209898652e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.000261994515467256 + -0.0034587909597647458i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002541873399405491 + 0.003355722435277084i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.37309272409102356 + 9.317362419797304e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0002619945154672561 + 0.0034587909597647466i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.38455199025824127 + 6.098637220230962e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.11934484859298825, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12301043705774664, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.37309272409102356, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.38455199025824127, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false, true}), Matrix({ { 0.17576077172786408 + -1.1202010727438122e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -3.7947076036992655e-19 + -9.75781955236954e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.18115913340830736 + 1.376428539288238e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -4.0657581468206416e-19 + -7.589415207398531e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.87890977618477e-19 + 7.589415207398531e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.31667680095614775 + 2.7994438906754626e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -3.7947076036992655e-19 + 1.0842021724855044e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3264032939076806 + -8.131516293641283e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.17576077172786408, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18115913340830736, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.31667680095614775, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3264032939076806, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true, true}), Matrix({ { 0.08998608446161596 + -4.870439446712227e-21i, 0.0 + 0.0i, -0.001185425211896573 + 0.0002715817033279701i, 0.0 + 0.0i, -0.00044943612301760494 + -0.0013716267491704483i, 0.0 + 0.0i, 0.0001242138411844168 + 0.0009601323166383209i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001185425211896573 + -0.0002715817033279699i, 0.0 + 0.0i, 0.2669338206745555 + 3.049318610115481e-20i, 0.0 + 0.0i, -0.0007257330694235348 + -0.000994396808424427i, 0.0 + 0.0i, 0.00044943612301760413 + 0.0013716267491704465i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00044943612301760505 + 0.0013716267491704483i, 0.0 + 0.0i, -0.000725733069423535 + 0.000994396808424427i, 0.0 + 0.0i, 0.15236920118911895 + 7.496241583200558e-20i, 0.0 + 0.0i, 0.000669243356488768 + -0.007086095098369801i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0001242138411844168 + -0.0009601323166383209i, 0.0 + 0.0i, 0.0004494361230176042 + -0.0013716267491704463i, 0.0 + 0.0i, 0.0006692433564887677 + 0.007086095098369801i, 0.0 + 0.0i, 0.4907108936747094 + 1.2366681029912785e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.08998608446161596, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2669338206745555, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.15236920118911895, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4907108936747094, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false, false, false}), Matrix({ { 0.2956917970119526 + 2.168404344971009e-19i, -0.0037752802776976914 + -0.0024637534499358264i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003775280277697691 + 0.0024637534499358255i, 0.2309644390422324 + -4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.26575944341640584 + 1.8846483076408183e-20i, -0.0033931153839256347 + -0.0022143520793839536i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.003393115383925635 + 0.0022143520793839527i, 0.20758432052940892 + 2.922263668027336e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2956917970119526, 1.0e-7), DoubleNear(0.2309644390422324, 1.0e-7), DoubleNear(0.26575944341640584, 1.0e-7), DoubleNear(0.20758432052940892, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false, false, false}), Matrix({ { 0.1409133780169579 + 2.710505431213761e-20i, -0.0017991283568467619 + -0.0011741138061309073i, 0.0 + 0.0i, 0.0 + 0.0i, -0.007408685205867005 + -0.021100884025140664i, -8.122481893295405e-05 + 0.00033113845574006637i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017991283568467619 + 0.0011741138061309069i, 0.11006723769857281 + -1.4907779871675686e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0002704073625410189 + 0.00020767765013168123i, -0.005786913400727144 + -0.01648187028321525i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.13405385656000027 + -9.889109659193956e-20i, -0.00171154859869118 + -0.0011169591274239933i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008927295039474452 + 0.005720248564985466i, 0.0001616423705871613 + 1.3497579750779464e-06i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0017115485986911798 + 0.001116959127423993i, 0.10470927531539473 + 3.3457801416544863e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 6.631823729100692e-05 + -0.00014741766928778305i, -0.006973097366219377 + 0.0044680779593645565i }, { -0.007408685205867006 + 0.021100884025140657i, 0.000270407362541019 + -0.00020767765013168148i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15477841899499464 + 1.8973538018496328e-19i, -0.001976151920850929 + -0.001289639643804919i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.122481893295413e-05 + -0.00033113845574006626i, -0.005786913400727145 + 0.016481870283215242i, 0.0 + 0.0i, 0.0 + 0.0i, -0.001976151920850929 + 0.0012896396438049182i, 0.12089720134365961 + 1.0842021724855044e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.008927295039474452 + -0.005720248564985468i, 6.631823729100676e-05 + 0.0001474176692877831i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13170558685640554 + 1.1773757966834775e-19i, -0.0016815667852344547 + -0.0010973929519599598i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.00016164237058716136 + -1.3497579750779498e-06i, -0.006973097366219375 + -0.004468077959364556i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0016815667852344552 + 0.0010973929519599596i, 0.1028750452140142 + -4.235164736271502e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1409133780169579, 1.0e-7), DoubleNear(0.11006723769857281, 1.0e-7), DoubleNear(0.13405385656000027, 1.0e-7), DoubleNear(0.10470927531539473, 1.0e-7), DoubleNear(0.15477841899499464, 1.0e-7), DoubleNear(0.12089720134365961, 1.0e-7), DoubleNear(0.13170558685640554, 1.0e-7), DoubleNear(0.1028750452140142, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false, false, false}), Matrix({ { 0.1266091024447765 + 5.421010862427522e-20i, -0.009006311806281453 + 0.008788570244053483i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.018766435413493484 + -0.003826215888166936i, -0.0010693496684675526 + 0.0015748490854038605i }, { -0.009006311806281453 + -0.008788570244053485i, 0.1327362160766444 + -1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0016005431838269366 + -0.0010304949645457634i, 0.019674617211036347 + -0.0040113815600986424i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1519667547547911 + -4.1081097941833566e-20i, 0.004701503530292035 + -0.010113271021633903i, 0.025062016915556047 + 0.005109797635988988i, 0.0011154145499566396 + -0.0015097725694104688i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.004701503530292035 + 0.010113271021633903i, 0.0882847550284327 + -3.8116482626443515e-20i, 0.00043530831959270357 + 0.00182594345380481i, 0.01455972411517556 + 0.002968525802015457i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.025062016915556047 + -0.005109797635988987i, 0.00043530831959270346 + -0.00182594345380481i, 0.1690826945671761 + 1.6263032587282567e-19i, 0.005231031528583761 + -0.011252323693989309i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0011154145499566396 + 0.0015097725694104688i, 0.01455972411517556 + -0.0029685258020154563i, 0.005231031528583761 + 0.011252323693989309i, 0.098228222965588 + -2.710505431213761e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.018766435413493487 + 0.0038262158881669354i, -0.0016005431838269366 + 0.0010304949645457632i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11379268866161472 + 5.992758101824175e-20i, -0.00809461891421767 + 0.00789891894224995i }, { -0.0010693496684675524 + -0.0015748490854038608i, 0.019674617211036347 + 0.004011381560098644i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00809461891421767 + -0.00789891894224995i, 0.11929956550097622 + 6.733911930671688e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1266091024447765, 1.0e-7), DoubleNear(0.1327362160766444, 1.0e-7), DoubleNear(0.1519667547547911, 1.0e-7), DoubleNear(0.0882847550284327, 1.0e-7), DoubleNear(0.1690826945671761, 1.0e-7), DoubleNear(0.098228222965588, 1.0e-7), DoubleNear(0.11379268866161472, 1.0e-7), DoubleNear(0.11929956550097622, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false, false, false}), Matrix({ { 0.2956917970119526 + 2.168404344971009e-19i, -0.0037752802776976914 + -0.0024637534499358264i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003775280277697691 + 0.0024637534499358255i, 0.2309644390422324 + -4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.26575944341640584 + 1.8846483076408183e-20i, -0.0033931153839256347 + -0.0022143520793839536i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.003393115383925635 + 0.0022143520793839527i, 0.20758432052940892 + 2.922263668027336e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2956917970119526, 1.0e-7), DoubleNear(0.2309644390422324, 1.0e-7), DoubleNear(0.26575944341640584, 1.0e-7), DoubleNear(0.20758432052940892, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true, false, false}), Matrix({ { 0.1266091024447765 + 5.421010862427522e-20i, -0.009006311806281453 + 0.008788570244053483i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008657973269552024 + -0.0025519042580104847i, 0.00035615923536091553 + 0.0015469624546210214i }, { -0.009006311806281453 + -0.008788570244053485i, 0.1327362160766444 + -1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0006133709710638498 + 0.00015338154839623474i, 0.003164157693896748 + 0.0013708509334623103i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.11379268866161472 + 5.992758101824175e-20i, -0.00809461891421767 + 0.00789891894224995i, 0.0017957536077585331 + -0.0020092509384437344i, -0.0002779022485698549 + 0.0015629179687941996i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.00809461891421767 + -0.00789891894224995i, 0.11929956550097622 + 6.733911930671688e-20i, -0.0006244596450705888 + -9.899494537879616e-05i, 0.002374906291722969 + 0.0025001892526677113i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.001795753607758533 + 0.002009250938443735i, -0.0006244596450705887 + 9.899494537879614e-05i, 0.1690826945671761 + 1.6263032587282567e-19i, 0.005231031528583761 + -0.011252323693989309i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0002779022485698549 + -0.0015629179687941996i, 0.002374906291722969 + -0.0025001892526677113i, 0.005231031528583761 + 0.011252323693989309i, 0.098228222965588 + -2.710505431213761e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0008657973269552022 + 0.0025519042580104847i, -0.0006133709710638498 + -0.00015338154839623471i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1519667547547911 + -4.1081097941833566e-20i, 0.004701503530292035 + -0.010113271021633903i }, { 0.0003561592353609155 + -0.0015469624546210214i, 0.003164157693896748 + -0.0013708509334623103i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.004701503530292035 + 0.010113271021633903i, 0.0882847550284327 + -3.8116482626443515e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1266091024447765, 1.0e-7), DoubleNear(0.1327362160766444, 1.0e-7), DoubleNear(0.11379268866161472, 1.0e-7), DoubleNear(0.11929956550097622, 1.0e-7), DoubleNear(0.1690826945671761, 1.0e-7), DoubleNear(0.098228222965588, 1.0e-7), DoubleNear(0.1519667547547911, 1.0e-7), DoubleNear(0.0882847550284327, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, true, false}), Matrix({ { 0.07151387730341714 + 0.0i, -0.0009130619560419183 + -0.0005958655725490388i, 0.0 + 0.0i, 0.0 + 0.0i, -9.630040863302711e-05 + -0.002032774179452098i, -1.570788710087659e-05 + 2.675607782375729e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.000913061956041918 + 0.0005958655725490391i, 0.05585938711194993 + 9.486769009248164e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 1.8166941001731385e-05 + 2.5151295639081037e-05i, -7.52201112246807e-05 + -0.0015877969994470623i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.06455679844955711 + -4.468098796766434e-20i, -0.0008242366221882921 + -0.0005378980293135386i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00019351053437229648 + -0.0017932428191098024i, -1.2470929919178254e-05 + 2.4507803625252336e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0008242366221882921 + 0.0005378980293135386i, 0.050425222785810686 + 1.9905274260476058e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 1.7412267564151528e-05 + 2.1283079426093055e-05i, -0.0001511508011778004 + -0.0014006993970328676i }, { -9.630040863302695e-05 + 0.002032774179452099i, 1.816694100173138e-05 + -2.515129563908105e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.22417791970853543 + 2.168404344971009e-19i, -0.002862218321655773 + -0.0018678878773867877i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.5707887100876586e-05 + -2.6756077823757325e-05i, -7.522011122468075e-05 + 0.0015877969994470623i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002862218321655773 + 0.0018678878773867864i, 0.17510505193028247 + -1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0001935105343722968 + 0.0017932428191098026i, 1.7412267564151528e-05 + -2.1283079426093065e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20120264496684873 + 6.352747104407253e-20i, -0.0025688787617373426 + -0.0016764540500704148i }, { 0.0 + 0.0i, 0.0 + 0.0i, -1.2470929919178262e-05 + -2.450780362525235e-05i, -0.00015115080117780036 + 0.0014006993970328676i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002568878761737343 + 0.001676454050070414i, 0.1571590977435982 + 9.317362419797304e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.07151387730341714, 1.0e-7), DoubleNear(0.05585938711194993, 1.0e-7), DoubleNear(0.06455679844955711, 1.0e-7), DoubleNear(0.050425222785810686, 1.0e-7), DoubleNear(0.22417791970853543, 1.0e-7), DoubleNear(0.17510505193028247, 1.0e-7), DoubleNear(0.20120264496684873, 1.0e-7), DoubleNear(0.1571590977435982, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false, true}), Matrix({ { 0.10313934037504176 + 5.421010862427522e-20i, -0.0013168438269422298 + -0.0008593742141005117i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00013666203326211218 + -3.499343918308333e-05i, 1.453277624589309e-06 + 1.5854737989316858e-06i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00131684382694223 + 0.0008593742141005105i, 0.08056199101101365 + -4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 2.0364199868981014e-06 + -6.919079839059584e-07i, -0.00010674651840097808 + -2.733332521480977e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09725378309723375 + -3.1763735522036263e-21i, -0.0012416992725829126 + -0.0008103347676413038i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00013666203326211183 + 3.499343918308219e-05i, -1.453277624589321e-06 + -1.58547379893169e-06i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0012416992725829126 + 0.0008103347676413038i, 0.07596479065288228 + 1.5246593050577406e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -2.036419986898088e-06 + 6.919079839059449e-07i, 0.00010674651840097763 + 2.7333325214809337e-05i }, { -0.00013666203326211224 + 3.499343918308349e-05i, 2.036419986898121e-06 + 6.9190798390595e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1925524566369108 + 1.6263032587282567e-19i, -0.0024584364507554616 + -0.0016043792358353148i, 0.0 + 0.0i, 0.0 + 0.0i }, { 1.4532776245893057e-06 + -1.585473798931696e-06i, -0.00010674651840097805 + 2.733332521480977e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0024584364507554608 + 0.001604379235835315i, 0.15040244803121877 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.00013666203326211183 + -3.499343918308197e-05i, -2.0364199868980946e-06 + -6.919079839059432e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1685056603191721 + 2.202285662861181e-20i, -0.002151416111342722 + -0.0014040173117426495i }, { 0.0 + 0.0i, 0.0 + 0.0i, -1.4532776245893243e-06 + 1.5854737989316866e-06i, 0.00010674651840097755 + -2.7333325214809446e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0021514161113427225 + 0.0014040173117426486i, 0.13161952987652664 + 1.3976043629695956e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.10313934037504176, 1.0e-7), DoubleNear(0.08056199101101365, 1.0e-7), DoubleNear(0.09725378309723375, 1.0e-7), DoubleNear(0.07596479065288228, 1.0e-7), DoubleNear(0.1925524566369108, 1.0e-7), DoubleNear(0.15040244803121877, 1.0e-7), DoubleNear(0.1685056603191721, 1.0e-7), DoubleNear(0.13161952987652664, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false, false, false}), Matrix({ { 0.2749672345769582 + -7.178604227980195e-20i, -0.0035106769555379425 + -0.002291072933554901i, 0.0 + 0.0i, 0.0 + 0.0i, -0.016335980245341455 + -0.015380635460155194i, 8.041755165420729e-05 + 0.0003324882137151443i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0035106769555379416 + 0.0022910729335549i, 0.21477651301396755 + -1.15619997300212e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00033672559983202586 + 6.025998084389824e-05i, -0.012760010766946519 + -0.01201379232385069i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01633598024534146 + 0.015380635460155192i, 0.0003367255998320257 + -6.025998084389838e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2864840058514002 + 3.07472959853311e-19i, -0.003657718706085385 + -0.002387032595764879i, 0.0 + 0.0i, 0.0 + 0.0i }, { 8.041755165420726e-05 + -0.00033248821371514425i, -0.012760010766946522 + 0.012013792323850688i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0036577187060853845 + 0.002387032595764878i, 0.2237722465576738 + 1.0418505251227894e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2749672345769582, 1.0e-7), DoubleNear(0.21477651301396755, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2864840058514002, 1.0e-7), DoubleNear(0.2237722465576738, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false, false, false}), Matrix({ { 0.27857585719956757 + 1.3129010682441655e-20i, -0.004304808275989417 + -0.0013247007775804213i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004304808275989417 + 0.00132470077758042i, 0.22102097110507712 + -5.166900978251232e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2828753832287908 + 2.225579068910674e-19i, -0.002863587385633909 + -0.0033534047517393586i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0028635873856339093 + 0.003353404751739358i, 0.21752778846656423 + 4.0234064994579266e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.27857585719956757, 1.0e-7), DoubleNear(0.22102097110507712, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2828753832287908, 1.0e-7), DoubleNear(0.21752778846656423, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false, false, false}), Matrix({ { 0.5614512404283585 + 2.3568691757350907e-19i, -0.007168395661623327 + -0.00467810552931978i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007168395661623325 + 0.004678105529319779i, 0.4385487595716413 + -1.1434944787933055e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5614512404283585, 1.0e-7), DoubleNear(0.4385487595716413, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true, false, false}), Matrix({ { 0.2404017911063912 + 1.1413768964251697e-19i, -0.017100930720499122 + 0.016687489186303434i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01710093072049912 + -0.016687489186303434i, 0.25203578157762063 + 5.378659215064807e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3210494493219672 + 1.215492279309921e-19i, 0.009932535058875796 + -0.021365594715623215i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.009932535058875796 + 0.021365594715623215i, 0.1865129779940207 + -6.522153693858113e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2404017911063912, 1.0e-7), DoubleNear(0.25203578157762063, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3210494493219672, 1.0e-7), DoubleNear(0.1865129779940207, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, true, false}), Matrix({ { 0.13607067575297427 + -4.468098796766434e-20i, -0.0017372985782302106 + -0.0011337636018625772i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0002898109430053236 + -0.0038260169985619005i, -2.8178817020054835e-05 + 5.126388144900962e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017372985782302102 + 0.0011337636018625779i, 0.1062846098977606 + 1.147729643529577e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 3.5579208565882914e-05 + 4.643437506517409e-05i, -0.00022637091240248114 + -0.0029884963964799303i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002898109430053237 + 0.003826016998561902i, 3.55792085658829e-05 + -4.643437506517412e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4253805646753841 + 2.803679055411734e-19i, -0.0054310970833931155 + -0.0035443419274572025i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.8178817020054842e-05 + -5.1263881449009675e-05i, -0.00022637091240248109 + 0.0029884963964799294i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005431097083393115 + 0.0035443419274572008i, 0.33226414967388074 + -1.2620790914089075e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.13607067575297427, 1.0e-7), DoubleNear(0.1062846098977606, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4253805646753841, 1.0e-7), DoubleNear(0.33226414967388074, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false, true}), Matrix({ { 0.2003931234722755 + 5.1033735072071595e-20i, -0.0025585430995251424 + -0.0016697089817418159i, 0.0 + 0.0i, 0.0 + 0.0i, -3.7947076036992655e-19 + -1.0842021724855044e-18i, -6.776263578034403e-21 + -1.6940658945086007e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002558543099525143 + 0.0016697089817418144i, 0.15652678166389591 + -2.541098841762901e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 1.6940658945086007e-20 + -1.0164395367051604e-20i, -4.87890977618477e-19 + -5.421010862427522e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.336808689942018e-19 + 1.5178830414797062e-18i, 2.710505431213761e-20 + 1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3610581169560829 + 1.8465318250143747e-19i, -0.004609852562098184 + -0.003008396547577964i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.0328790734103208e-20 + -1.0164395367051604e-20i, -5.149960319306146e-19 + 2.168404344971009e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0046098525620981825 + 0.0030083965475779643i, 0.2820219779077454 + 1.3976043629695956e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2003931234722755, 1.0e-7), DoubleNear(0.15652678166389591, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3610581169560829, 1.0e-7), DoubleNear(0.2820219779077454, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false, false, false}), Matrix({ { 0.13699096155798232 + -9.020900888258299e-20i, -0.0019204789434201588 + -0.0009130799979578917i, -0.008277057765597428 + -0.005764004830285236i, 0.00091256727402933 + 0.0008634159190122025i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0019204789434201584 + 0.0009130799979578913i, 0.10778851840395529 + -7.707999820014133e-20i, -0.0007771156488944401 + 0.0006243760572020281i, -0.006291392547056986 + -0.007571943735114178i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008277057765597427 + 0.005764004830285235i, -0.0007771156488944401 + -0.0006243760572020282i, 0.14158489564158527 + 1.0333801956502464e-19i, -0.0023843293325692583 + -0.0004116207796225291i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0009125672740293298 + -0.0008634159190122022i, -0.006291392547056986 + 0.0075719437351141755i, -0.0023843293325692587 + 0.00041162077962252856i, 0.11323245270112184 + 2.541098841762901e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1379762730189759 + 1.8422966602781032e-20i, -0.0015901980121177833 + -0.001377992935597009i, -0.008058922479744029 + -0.00961663062986996i, -0.0008321497223751227 + -0.0005309277052970581i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.001590198012117783 + 0.0013779929355970087i, 0.10698799461001227 + -3.8539999100070665e-20i, 0.0011138412487264658 + -0.0005641160763581298i, -0.006468618219889534 + -0.004441848588736513i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008058922479744029 + 0.009616630629869958i, 0.001113841248726466 + 0.0005641160763581298i, 0.14489911020981494 + 2.0413494028828638e-19i, -0.0012733893735161258 + -0.0019754118161423497i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0008321497223751225 + 0.000530927705297058i, -0.006468618219889533 + 0.004441848588736513i, -0.0012733893735161258 + 0.0019754118161423497i, 0.11053979385655194 + 7.877406409464993e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.13699096155798232, 1.0e-7), DoubleNear(0.10778851840395529, 1.0e-7), DoubleNear(0.14158489564158527, 1.0e-7), DoubleNear(0.11323245270112184, 1.0e-7), DoubleNear(0.1379762730189759, 1.0e-7), DoubleNear(0.10698799461001227, 1.0e-7), DoubleNear(0.14489911020981494, 1.0e-7), DoubleNear(0.11053979385655194, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false, false, false}), Matrix({ { 0.2749672345769582 + -7.178604227980195e-20i, -0.0035106769555379425 + -0.002291072933554901i, -0.016335980245341455 + -0.015380635460155194i, 8.041755165420729e-05 + 0.0003324882137151443i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0035106769555379416 + 0.0022910729335549i, 0.21477651301396755 + -1.15619997300212e-19i, 0.00033672559983202586 + 6.025998084389824e-05i, -0.012760010766946519 + -0.01201379232385069i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01633598024534146 + 0.015380635460155192i, 0.0003367255998320257 + -6.025998084389838e-05i, 0.2864840058514002 + 3.07472959853311e-19i, -0.003657718706085385 + -0.002387032595764879i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 8.041755165420726e-05 + -0.00033248821371514425i, -0.012760010766946522 + 0.012013792323850688i, -0.0036577187060853845 + 0.002387032595764878i, 0.2237722465576738 + 1.0418505251227894e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2749672345769582, 1.0e-7), DoubleNear(0.21477651301396755, 1.0e-7), DoubleNear(0.2864840058514002, 1.0e-7), DoubleNear(0.2237722465576738, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true, false, false}), Matrix({ { 0.11773527410401496 + -8.682087709356578e-21i, -0.008375073898350033 + 0.008172593491983293i, -0.006994728353369493 + -0.006585669505609704i, 0.0009547127439559709 + -1.7068823720336535e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008375073898350032 + -0.008172593491983293i, 0.12343294819683195 + -7.919758056827708e-20i, 4.0424309134833134e-05 + 0.0009540092470443388i, -0.0073332308355574275 + -0.006904376017413612i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006994728353369492 + 0.006585669505609703i, 4.0424309134833134e-05 + -0.0009540092470443386i, 0.12266651700237625 + 1.2281977735187355e-19i, -0.00872585682214909 + 0.00851489569432014i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0009547127439559708 + 1.706882372033655e-05i, -0.0073332308355574275 + 0.006904376017413609i, -0.00872585682214909 + -0.008514895694320141i, 0.12860283338078868 + 1.3298417271892515e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15723196047294324 + -6.310395457044538e-20i, 0.0048643969428120905 + -0.010463666425538195i, -0.009341251891971963 + -0.008794965954545491i, -0.0008742951923017637 + 0.00034955703743548084i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00486439694281209 + 0.010463666425538195i, 0.09134356481713558 + -3.6422416731934915e-20i, 0.0002963012906971927 + -0.0008937492662004405i, -0.005426779931389093 + -0.00510941630643708i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.009341251891971965 + 0.00879496595454549i, 0.00029630129069719256 + 0.0008937492662004403i, 0.16381748884902395 + 1.8465318250143747e-19i, 0.005068138116063705 + -0.01090192829008502i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0008742951923017635 + -0.00034955703743548084i, -0.005426779931389092 + 0.005109416306437081i, 0.005068138116063706 + 0.010901928290085018i, 0.09516941317688511 + -2.879912020664621e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.11773527410401496, 1.0e-7), DoubleNear(0.12343294819683195, 1.0e-7), DoubleNear(0.12266651700237625, 1.0e-7), DoubleNear(0.12860283338078868, 1.0e-7), DoubleNear(0.15723196047294324, 1.0e-7), DoubleNear(0.09134356481713558, 1.0e-7), DoubleNear(0.16381748884902395, 1.0e-7), DoubleNear(0.09516941317688511, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, true, false}), Matrix({ { 0.07078499883405344 + -7.178604227980195e-20i, -0.0009037559132702412 + -0.0005897924353784256i, -0.0037665541811775054 + 0.006310230378621802i, 0.00010066782332516063 + -4.9183060148623515e-05i, -0.0009887584600995387 + -0.0009337655494415514i, 4.843800992879064e-06 + 2.0160463666101394e-05i, 0.008370011592287827 + 0.011225124597246873i, -1.3335507700537949e-05 + -0.00021305845167101728i }, { -0.0009037559132702413 + 0.0005897924353784256i, 0.05529006118371072 + 4.701032857261367e-20i, -4.4879640340055165e-06 + -0.00011195017747836922i, -0.002942050075006553 + 0.004928911908796459i, 2.040438209195396e-05 + 3.6834623299770877e-06i, -0.0007723178167026406 + -0.0007293629329697374i, -0.0002003947344487765 + -7.357778196770176e-05i, 0.006537804063978131 + 0.00876792874195793i }, { -0.0037665541811775054 + -0.006310230378621801i, -4.487964034005483e-06 + 0.00011195017747836914i, 0.06528567691892083 + 2.710505431213761e-20i, -0.0008335426649599691 + -0.000543971166484152i, 0.007469667675214102 + 0.011364729480731032i, -6.770481679789443e-07 + -0.00020733905774253863i, 0.0006989475170942152 + -0.0028922514491203487i, -3.3022618012933916e-05 + 3.110341778290825e-05i }, { 0.00010066782332516071 + 4.918306014862345e-05i, -0.0029420500750065525 + -0.004928911908796459i, -0.0008335426649599689 + 0.0005439711664841517i, 0.05099454871404989 + 6.776263578034403e-20i, -0.0001900626973383996 + -8.286201988991969e-05i, 0.0058345467201715556 + 0.008876973916451463i, 1.5174826473928956e-05 + 4.2750912735196996e-05i, 0.0005459469043001594 + -0.0022591334635101924i }, { -0.0009887584600995387 + 0.0009337655494415517i, 2.0404382091953963e-05 + -3.6834623299771215e-06i, 0.007469667675214102 + -0.011364729480731032i, -0.0001900626973383995 + 8.286201988991977e-05i, 0.20418223574290473 + 0.0i, -0.0026069210422677014 + -0.0017012804981764752i, -0.01256942606416395 + -0.021690865838776996i, -2.0250271670953343e-05 + 0.0003816712738637678i }, { 4.843800992879069e-06 + -2.0160463666101407e-05i, -0.0007723178167026404 + 0.0007293629329697371i, -6.770481679788088e-07 + 0.00020733905774253866i, 0.0058345467201715556 + -0.008876973916451463i, -0.0026069210422677005 + 0.0017012804981764744i, 0.15948645183025684 + -1.6263032587282567e-19i, 0.0003412135638660314 + 0.00017221015832226747i, -0.009817960691939968 + -0.01694270423264715i }, { 0.008370011592287825 + -0.011225124597246871i, -0.00020039473444877646 + 7.357778196770176e-05i, 0.000698947517094215 + 0.0028922514491203496i, 1.5174826473928922e-05 + -4.2750912735197e-05i, -0.012569426064163954 + 0.021690865838776992i, 0.00034121356386603117 + -0.00017221015832226752i, 0.22119832893247937 + 2.803679055411734e-19i, -0.002824176041125416 + -0.0018430614292807273i }, { -1.3335507700537949e-05 + 0.00021305845167101728i, 0.006537804063978131 + -0.00876792874195793i, -3.302261801293393e-05 + -3.1103417782908275e-05i, 0.0005459469043001593 + 0.0022591334635101924i, -2.025027167095345e-05 + -0.0003816712738637677i, -0.009817960691939968 + 0.016942704232647147i, -0.002824176041125416 + 0.001843061429280726i, 0.1727776978436239 + 3.6422416731934915e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.07078499883405344, 1.0e-7), DoubleNear(0.05529006118371072, 1.0e-7), DoubleNear(0.06528567691892083, 1.0e-7), DoubleNear(0.05099454871404989, 1.0e-7), DoubleNear(0.20418223574290473, 1.0e-7), DoubleNear(0.15948645183025684, 1.0e-7), DoubleNear(0.22119832893247937, 1.0e-7), DoubleNear(0.1727776978436239, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false, true}), Matrix({ { 0.09866555847993862 + -2.6046263128069735e-20i, -0.001259724283126744 + -0.0008220979159762345i, -0.007319557551104883 + -0.0032319186212588897i, 6.652443797866301e-05 + 0.00010225168267782201i, -8.594971515207543e-05 + 1.0386048083794574e-06i, 1.1060270659246893e-06 + 7.028868743664477e-07i, 0.0005983025309001176 + -0.0005737743841305553i, -1.2419682928308757e-05 + 2.340576230519324e-06i }, { -0.001259724283126744 + 0.0008220979159762342i, 0.077067526381824 + -1.9481757786848908e-20i, 0.00012038220970925028 + -1.9723869912901642e-05i, -0.005717295917275444 + -0.002524447005065314i, 1.0887194083865074e-06 + -7.294078958423401e-07i, -6.7135199374964e-05 + 8.112527279351806e-07i, -2.8581148856936458e-06 + 1.2310889506074387e-05i, 0.0004673332497665052 + -0.0004481743494634693i }, { -0.007319557551104884 + 0.0032319186212588897i, 0.00012038220970925021 + 1.9723869912901683e-05i, 0.10172756499233689 + 7.707999820014133e-20i, -0.0012988188163983987 + -0.0008476110657655817i, 0.0004498913639002722 + -0.0006187865184880094i, -1.0899874279595062e-05 + 4.15186065982664e-06i, 8.594971515207513e-05 + -1.0386048083805416e-06i, -1.1060270659246994e-06 + -7.028868743664494e-07i }, { 6.652443797866304e-05 + -0.00010225168267782202i, -0.005717295917275445 + 0.0025244470050653145i, -0.0012988188163983985 + 0.0008476110657655804i, 0.07945925528207193 + -5.929230630780102e-21i, -5.882089909094359e-07 + 1.1649000662400495e-05i, 0.00035140949983462324 + -0.0004833332631263424i, -1.0887194083864939e-06 + 7.294078958423257e-07i, 6.713519937496355e-05 + -8.112527279356414e-07i }, { -8.594971515207542e-05 + -1.0386048083791863e-06i, 1.0887194083865244e-06 + 7.294078958423333e-07i, 0.0004498913639002722 + 0.0006187865184880095i, -5.882089909094342e-07 + -1.1649000662400493e-05i, 0.17630167609701958 + -4.573977915173222e-20i, -0.0022509526724111984 + -0.0014689750175786664i, -0.009016422694236572 + -0.012148716838896303i, 1.3893113675544276e-05 + 0.0002302365310373223i }, { 1.1060270659246825e-06 + -7.028868743664477e-07i, -6.713519937496395e-05 + -8.112527279352348e-07i, -1.089987427959506e-05 + -4.151860659826639e-06i, 0.00035140949983462324 + 0.00048333326312634234i, -0.0022509526724111975 + 0.0014689750175786657i, 0.13770898663214354 + -9.613823951336309e-20i, 0.00021634339012277558 + 7.998385075679988e-05i, -0.007042714849671076 + -0.009489345318785376i }, { 0.0005983025309001177 + 0.0005737743841305551i, -2.858114885693649e-06 + -1.2310889506074387e-05i, 8.594971515207497e-05 + 1.0386048083807584e-06i, -1.0887194083865023e-06 + -7.294078958423257e-07i, -0.009016422694236574 + 0.012148716838896302i, 0.0002163433901227755 + -7.998385075680006e-05i, 0.18475644085906334 + 2.303929616531697e-19i, -0.002358899889686986 + -0.0015394215299992975i }, { -1.2419682928308755e-05 + -2.3405762305193223e-06i, 0.0004673332497665051 + 0.0004481743494634693i, -1.1060270659246994e-06 + 7.02886874366441e-07i, 6.713519937496349e-05 + 8.11252727935533e-07i, 1.3893113675544222e-05 + -0.00023023653103732225i, -0.007042714849671077 + 0.009489345318785375i, -0.0023588998896869858 + 0.0015394215299992973i, 0.14431299127560188 + 1.1011428314305904e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.09866555847993862, 1.0e-7), DoubleNear(0.077067526381824, 1.0e-7), DoubleNear(0.10172756499233689, 1.0e-7), DoubleNear(0.07945925528207193, 1.0e-7), DoubleNear(0.17630167609701958, 1.0e-7), DoubleNear(0.13770898663214354, 1.0e-7), DoubleNear(0.18475644085906334, 1.0e-7), DoubleNear(0.14431299127560188, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false, false, false}), Matrix({ { 0.27857585719956757 + 1.3129010682441655e-20i, -0.004304808275989417 + -0.0013247007775804213i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004304808275989417 + 0.00132470077758042i, 0.22102097110507712 + -5.166900978251232e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2828753832287908 + 2.225579068910674e-19i, -0.002863587385633909 + -0.0033534047517393586i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0028635873856339093 + 0.003353404751739358i, 0.21752778846656423 + 4.0234064994579266e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.27857585719956757, 1.0e-7), DoubleNear(0.22102097110507712, 1.0e-7), DoubleNear(0.2828753832287908, 1.0e-7), DoubleNear(0.21752778846656423, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true, false, false}), Matrix({ { 0.1266091024447765 + 5.421010862427522e-20i, -0.009006311806281453 + 0.008788570244053483i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.008978172133661255 + -0.01538608032933023i, 0.00026398318698618725 + 0.010490515658505804i }, { -0.009006311806281453 + -0.008788570244053485i, 0.1327362160766444 + -1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00417555651444494 + 0.00018346155893055746i, 0.018684846220163132 + 0.013058125123250183i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.11379268866161472 + 5.992758101824175e-20i, -0.00809461891421767 + 0.00789891894224995i, 0.00806932777050305 + -0.013828574840436392i, 0.00023726063946881236 + 0.009428579455800383i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.00809461891421767 + -0.00789891894224995i, 0.11929956550097622 + 6.733911930671688e-20i, -0.003752872370645366 + 0.00016489007230633532i, 0.016793412539580742 + 0.011736274390717966i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.00806932777050305 + 0.013828574840436394i, -0.0037528723706453664 + -0.00016489007230633535i, 0.1519667547547911 + -4.1081097941833566e-20i, 0.004701503530292035 + -0.010113271021633903i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.00023726063946881196 + -0.009428579455800383i, 0.016793412539580742 + -0.011736274390717966i, 0.004701503530292035 + 0.010113271021633903i, 0.0882847550284327 + -3.8116482626443515e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.008978172133661255 + 0.015386080329330235i, -0.004175556514444941 + -0.00018346155893055746i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1690826945671761 + 1.6263032587282567e-19i, 0.005231031528583761 + -0.011252323693989309i }, { 0.0002639831869861868 + -0.010490515658505806i, 0.018684846220163136 + -0.013058125123250183i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.005231031528583761 + 0.011252323693989309i, 0.098228222965588 + -2.710505431213761e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1266091024447765, 1.0e-7), DoubleNear(0.1327362160766444, 1.0e-7), DoubleNear(0.11379268866161472, 1.0e-7), DoubleNear(0.11929956550097622, 1.0e-7), DoubleNear(0.1519667547547911, 1.0e-7), DoubleNear(0.0882847550284327, 1.0e-7), DoubleNear(0.1690826945671761, 1.0e-7), DoubleNear(0.098228222965588, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, true, false}), Matrix({ { 0.0675356755040638 + -7.665648172651418e-20i, -0.0010361384133503165 + -0.0003311192927424447i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00015188717216622476 + -0.0018958051858943244i, -8.312432810661706e-06 + 3.469284145028397e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0010361384133503165 + 0.0003311192927424448i, 0.05354825944540016 + 4.235164736271502e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 7.332032267542481e-06 + 2.5689546271975694e-05i, -0.00010751312037178207 + -0.0015082251611048493i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.06853500024891046 + 3.197549375884984e-20i, -0.000701160164879894 + -0.0008026443091201326i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00013792377083909888 + -0.0019302118126675758i, -1.9866384209393137e-05 + 1.6571039998725663e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0007011601648798937 + 0.0008026443091201328i, 0.05273635045236045 + 1.105377996166862e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 2.8247176298340434e-05 + 2.07448287931984e-05i, -0.00011885779203069902 + -0.0014802712353750808i }, { -0.00015188717216622493 + 0.0018958051858943249i, 7.332032267542465e-06 + -2.5689546271975697e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2110401816955038 + 8.978549240895584e-20i, -0.003268669862639101 + -0.0009935814848379765i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.312432810661708e-06 + -3.4692841450284e-05i, -0.00010751312037178231 + 0.001508225161104849i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0032686698626391004 + 0.0009935814848379752i, 0.16747271165967695 + -5.590417451878382e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.00013792377083909882 + 0.0019302118126675763i, 2.8247176298340438e-05 + -2.074482879319841e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21434038297988034 + 1.9058241313221758e-19i, -0.0021624272207540146 + -0.002550760442619226i }, { 0.0 + 0.0i, 0.0 + 0.0i, -1.986638420939314e-05 + -1.657103999872568e-05i, -0.00011885779203069875 + 0.0014802712353750803i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0021624272207540155 + 0.002550760442619225i, 0.16479143801420376 + -7.030373462210693e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.0675356755040638, 1.0e-7), DoubleNear(0.05354825944540016, 1.0e-7), DoubleNear(0.06853500024891046, 1.0e-7), DoubleNear(0.05273635045236045, 1.0e-7), DoubleNear(0.2110401816955038, 1.0e-7), DoubleNear(0.16747271165967695, 1.0e-7), DoubleNear(0.21434038297988034, 1.0e-7), DoubleNear(0.16479143801420376, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false, true}), Matrix({ { 0.0997738568086478 + -3.8116482626443515e-21i, -0.0014209641846748956 + -0.0006354038629489258i, 0.0 + 0.0i, 0.0 + 0.0i, 1.963032968127306e-05 + 5.026507592843451e-06i, 8.951902346759963e-06 + -7.57753758639242e-06i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0014209641846748959 + 0.0006354038629489255i, 0.07860682066674503 + -1.1604351377383915e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 4.208451156822735e-06 + 1.0947354491371582e-05i, -1.5948810721189404e-05 + -4.083824341644636e-06i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.10061926666362772 + 5.484538333471595e-20i, -0.0011375789148502468 + -0.0010343051187928897i, 0.0 + 0.0i, 0.0 + 0.0i, -1.963032968127341e-05 + -5.026507592844481e-06i, -8.951902346759975e-06 + 7.577537586392416e-06i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.001137578914850247 + 0.0010343051187928888i, 0.07791996099715089 + 9.063252535621014e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -4.208451156822721e-06 + -1.0947354491371596e-05i, 1.594881072118893e-05 + 4.083824341644148e-06i }, { 1.963032968127306e-05 + -5.0265075928432345e-06i, 4.2084511568227475e-06 + -1.0947354491371589e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17880200039091979 + 1.6940658945086007e-20i, -0.002883844091314522 + -0.0006892969146314954i, 0.0 + 0.0i, 0.0 + 0.0i }, { 8.95190234675996e-06 + 7.577537586392407e-06i, -1.5948810721189363e-05 + 4.083824341644582e-06i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002883844091314521 + 0.0006892969146314945i, 0.14241415043833208 + 6.437450399132683e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -1.963032968127348e-05 + 5.026507592844752e-06i, -4.208451156822721e-06 + 1.0947354491371596e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1822561165651631 + 1.6771252355635147e-19i, -0.001726008470783662 + -0.002319099632946469i }, { 0.0 + 0.0i, 0.0 + 0.0i, -8.951902346759978e-06 + -7.577537586392416e-06i, 1.5948810721188876e-05 + -4.083824341644202e-06i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0017260084707836623 + 0.0023190996329464694i, 0.13960782746941333 + -5.039846036163087e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.0997738568086478, 1.0e-7), DoubleNear(0.07860682066674503, 1.0e-7), DoubleNear(0.10061926666362772, 1.0e-7), DoubleNear(0.07791996099715089, 1.0e-7), DoubleNear(0.17880200039091979, 1.0e-7), DoubleNear(0.14241415043833208, 1.0e-7), DoubleNear(0.1822561165651631, 1.0e-7), DoubleNear(0.13960782746941333, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true, false, false}), Matrix({ { 0.2404017911063912 + 1.1413768964251697e-19i, -0.017100930720499122 + 0.016687489186303434i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01710093072049912 + -0.016687489186303434i, 0.25203578157762063 + 5.378659215064807e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3210494493219672 + 1.215492279309921e-19i, 0.009932535058875796 + -0.021365594715623215i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.009932535058875796 + 0.021365594715623215i, 0.1865129779940207 + -6.522153693858113e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2404017911063912, 1.0e-7), DoubleNear(0.25203578157762063, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3210494493219672, 1.0e-7), DoubleNear(0.1865129779940207, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, true, false}), Matrix({ { 0.13607067575297427 + -4.468098796766434e-20i, -0.0017372985782302106 + -0.0011337636018625772i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0002898109430053236 + -0.0038260169985619005i, -2.8178817020054835e-05 + 5.126388144900962e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017372985782302102 + 0.0011337636018625779i, 0.1062846098977606 + 1.147729643529577e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 3.5579208565882914e-05 + 4.643437506517409e-05i, -0.00022637091240248114 + -0.0029884963964799303i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002898109430053237 + 0.003826016998561902i, 3.55792085658829e-05 + -4.643437506517412e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4253805646753841 + 2.803679055411734e-19i, -0.0054310970833931155 + -0.0035443419274572025i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.8178817020054842e-05 + -5.1263881449009675e-05i, -0.00022637091240248109 + 0.0029884963964799294i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005431097083393115 + 0.0035443419274572008i, 0.33226414967388074 + -1.2620790914089075e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.13607067575297427, 1.0e-7), DoubleNear(0.1062846098977606, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4253805646753841, 1.0e-7), DoubleNear(0.33226414967388074, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false, true}), Matrix({ { 0.2003931234722755 + 5.1033735072071595e-20i, -0.0025585430995251424 + -0.0016697089817418159i, 0.0 + 0.0i, 0.0 + 0.0i, -3.7947076036992655e-19 + -1.0842021724855044e-18i, -6.776263578034403e-21 + -1.6940658945086007e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002558543099525143 + 0.0016697089817418144i, 0.15652678166389591 + -2.541098841762901e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 1.6940658945086007e-20 + -1.0164395367051604e-20i, -4.87890977618477e-19 + -5.421010862427522e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.336808689942018e-19 + 1.5178830414797062e-18i, 2.710505431213761e-20 + 1.0164395367051604e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3610581169560829 + 1.8465318250143747e-19i, -0.004609852562098184 + -0.003008396547577964i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.0328790734103208e-20 + -1.0164395367051604e-20i, -5.149960319306146e-19 + 2.168404344971009e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0046098525620981825 + 0.0030083965475779643i, 0.2820219779077454 + 1.3976043629695956e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2003931234722755, 1.0e-7), DoubleNear(0.15652678166389591, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3610581169560829, 1.0e-7), DoubleNear(0.2820219779077454, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, true, false}), Matrix({ { 0.05826264475453775 + 3.197549375884984e-20i, -0.004144500949659994 + 0.004044301208540119i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00012409104257665648 + -0.0016382212256865513i, 0.00012254430873818808 + 0.00010792074233223982i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004144500949659994 + -0.0040443012085401185i, 0.061082203838450484 + 4.277516383634217e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00010488992844117292 + 0.00012514830059280743i, -0.00013009629736389228 + -0.0017175012095905333i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.07780803099843651 + -7.665648172651418e-20i, 0.0024072023714297825 + -0.005178064810402696i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00016571990042866716 + -0.0021877957728753494i, -0.00015072312575824292 + -5.66568608832302e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.002407202371429783 + 0.005178064810402697i, 0.04520240605931013 + 7.199780051661553e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00014046913700705585 + -7.871392552763332e-05i, -9.62746150385888e-05 + -0.0012709951868893966i }, { -0.00012409104257665642 + 0.0016382212256865513i, -0.00010488992844117293 + -0.00012514830059280743i, 0.0 + 0.0i, 0.0 + 0.0i, 0.18213914635185346 + 8.216219588366713e-20i, -0.01295642977083913 + 0.012643187977763315i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0001225443087381881 + -0.00010792074233223985i, -0.00013009629736389244 + 0.001717501209590533i, 0.0 + 0.0i, 0.0 + 0.0i, -0.012956429770839127 + -0.012643187977763315i, 0.19095357773917015 + 1.1011428314305904e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.00016571990042866733 + 0.00218779577287535i, 0.00014046913700705585 + 7.871392552763331e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2432414183235307 + 1.9820570965750628e-19i, 0.007525332687446014 + -0.016187529905220516i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.00015072312575824294 + 5.6656860883230175e-05i, -9.627461503858861e-05 + 0.0012709951868893966i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0075253326874460125 + 0.016187529905220516i, 0.14131057193471058 + -1.3721933745519665e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.05826264475453775, 1.0e-7), DoubleNear(0.061082203838450484, 1.0e-7), DoubleNear(0.07780803099843651, 1.0e-7), DoubleNear(0.04520240605931013, 1.0e-7), DoubleNear(0.18213914635185346, 1.0e-7), DoubleNear(0.19095357773917015, 1.0e-7), DoubleNear(0.2432414183235307, 1.0e-7), DoubleNear(0.14131057193471058, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false, true}), Matrix({ { 0.08580418447625887 + 6.352747104407253e-22i, -0.006103662570500788 + 0.005956097057336309i, 0.0 + 0.0i, 0.0 + 0.0i, -2.303929616531697e-19 + -5.421010862427522e-19i, 5.421010862427522e-20 + 1.6940658945086007e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006103662570500788 + -0.00595609705733631i, 0.08995658725160521 + -1.1265538198482195e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -1.3552527156068805e-20 + 2.0328790734103208e-20i, -1.6263032587282567e-19 + -3.2526065174565133e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.11458893899601663 + 5.039846036163087e-20i, 0.003545119470975646 + -0.007625806039078125i, 0.0 + 0.0i, 0.0 + 0.0i, -1.3552527156068805e-19 + -5.421010862427522e-19i, -6.098637220230962e-20 + -1.8634724839594607e-20i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0035451194709756454 + 0.007625806039078124i, 0.0665701944122907 + 8.724439356719293e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 3.049318610115481e-20 + -3.049318610115481e-20i, -3.2526065174565133e-19 + -1.6263032587282567e-19i }, { -1.8973538018496328e-19 + 5.963111948670274e-19i, -6.776263578034403e-21 + -2.0328790734103208e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15459760663013233 + 1.1350241493207625e-19i, -0.010997268149998334 + 0.010731392128967124i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.743384504624082e-20 + -2.0328790734103208e-20i, -3.1170812458958252e-19 + 1.6263032587282567e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.010997268149998332 + -0.010731392128967124i, 0.16207919432601542 + 1.6644197413547002e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -2.439454888092385e-19 + 9.215718466126788e-19i, 3.3881317890172014e-20 + 3.049318610115481e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20646051032595059 + 7.115076756936123e-20i, 0.006387415587900151 + -0.013739788676545088i }, { 0.0 + 0.0i, 0.0 + 0.0i, -6.776263578034403e-20 + 1.1858461261560205e-20i, -1.8973538018496328e-19 + 1.6263032587282567e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006387415587900151 + 0.01373978867654509i, 0.11994278358173 + -1.5246593050577406e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.08580418447625887, 1.0e-7), DoubleNear(0.08995658725160521, 1.0e-7), DoubleNear(0.11458893899601663, 1.0e-7), DoubleNear(0.0665701944122907, 1.0e-7), DoubleNear(0.15459760663013233, 1.0e-7), DoubleNear(0.16207919432601542, 1.0e-7), DoubleNear(0.20646051032595059, 1.0e-7), DoubleNear(0.11994278358173, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true, true}), Matrix({ { 0.05052279874226531 + 1.0587911840678754e-21i, -0.0006450558574611187 + -0.0004209643992817223i, -0.0006655584556543807 + 0.00015247988421113531i, 9.768084814138985e-06 + 3.5987391344559433e-06i, -0.0002523364687615466 + -0.0007701015397264652i, -3.1948787250409772e-06 + 1.1934872850284632e-05i, 6.974001521136192e-05 + 0.0005390674801519388i, 3.6011863390844026e-06 + -7.463693790437359e-06i }, { -0.0006450558574611189 + 0.0004209643992817225i, 0.039463285719350635 + -5.929230630780102e-21i, 7.227109078137656e-06 + -7.492349342280932e-06i, -0.0005198667562421923 + 0.00011910181911683474i, 9.638350633873395e-06 + 7.72985362595524e-06i, -0.00019709965425605838 + -0.000601525209443983i, -5.382014259604284e-06 + -6.301522875911623e-06i, 5.447382597305486e-05 + 0.0004210648364863821i }, { -0.0006655584556543807 + -0.0001524798842111351i, 7.227109078137643e-06 + 7.4923493422809234e-06i, 0.1498703247300102 + 4.997494388800372e-20i, -0.0019134872420640235 + -0.0012487445824600936i, -0.0004074637320477237 + -0.0005583053215678954i, 5.504485785239963e-07 + 1.052328565232219e-05i, 0.0002523364687615462 + 0.0007701015397264641i, 3.1948787250409705e-06 + -1.1934872850284634e-05i }, { 9.76808481413898e-06 + -3.5987391344559365e-06i, -0.0005198667562421923 + -0.00011910181911683478i, -0.001913487242064024 + 0.0012487445824600919i, 0.11706349594454528 + -1.9481757786848908e-20i, 9.854234994180498e-06 + 3.733173882561283e-06i, -0.00031826933737581114 + -0.00043609148685653154i, -9.638350633873378e-06 + -7.72985362595525e-06i, 0.0001970996542560579 + 0.0006015252094439824i }, { -0.00025233646876154665 + 0.0007701015397264653i, 9.638350633873402e-06 + -7.72985362595524e-06i, -0.0004074637320477237 + 0.0005583053215678954i, 9.854234994180503e-06 + -3.7331738825612864e-06i, 0.08554787701070896 + -4.573977915173222e-20i, -0.001092242720769092 + -0.0007127992025808549i, 0.00037574751264905705 + -0.003978496882773036i, -3.794690183419382e-05 + 4.766514231455368e-05i }, { -3.194878725040991e-06 + -1.1934872850284636e-05i, -0.00019709965425605846 + 0.0006015252094439829i, 5.504485785239963e-07 + -1.0523285652322198e-05i, -0.00031826933737581114 + 0.00043609148685653154i, -0.0010922427207690913 + 0.0007127992025808554i, 0.06682132417840997 + 1.207021949837378e-19i, 2.835209948774526e-05 + 5.392672440745503e-05i, 0.0002934958438397111 + -0.003107598215596765i }, { 6.974001521136192e-05 + -0.0005390674801519389i, -5.3820142596042806e-06 + 6.30152287591162e-06i, 0.0002523364687615462 + -0.0007701015397264637i, -9.638350633873375e-06 + 7.72985362595525e-06i, 0.00037574751264905695 + 0.003978496882773037i, 2.835209948774526e-05 + -5.392672440745504e-05i, 0.27551023994537394 + 2.303929616531697e-19i, -0.003517609841329092 + -0.002295597344997109i }, { 3.601186339084396e-06 + 7.46369379043736e-06i, 5.447382597305486e-05 + -0.00042106483648638197i, 3.1948787250409705e-06 + 1.1934872850284625e-05i, 0.00019709965425605795 + -0.0006015252094439827i, -3.794690183419382e-05 + -4.7665142314553735e-05i, 0.00029349584383971117 + 0.003107598215596764i, -0.003517609841329091 + 0.002295597344997109i, 0.21520065372933544 + -1.0672615135404184e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.05052279874226531, 1.0e-7), DoubleNear(0.039463285719350635, 1.0e-7), DoubleNear(0.1498703247300102, 1.0e-7), DoubleNear(0.11706349594454528, 1.0e-7), DoubleNear(0.08554787701070896, 1.0e-7), DoubleNear(0.06682132417840997, 1.0e-7), DoubleNear(0.27551023994537394, 1.0e-7), DoubleNear(0.21520065372933544, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false, false, false}), Matrix({ { 0.25098061571553076 + -1.2197274440461925e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01319559860659415 + -0.037582754308355906i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23876313187539502 + -6.54332951753947e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.015900392405693825 + 0.010188326524350023i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013195598606594151 + 0.037582754308355906i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2756756203386542 + 2.981555974335137e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.015900392405693825 + -0.010188326524350023i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23458063207041974 + 1.1350241493207625e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25098061571553076, 1.0e-7), DoubleNear(0.23876313187539502, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2756756203386542, 1.0e-7), DoubleNear(0.23458063207041974, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.038441052624529834 + -0.00783759744826558i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0396217410307316 + 0.008078323438004445i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0396217410307316 + -0.008078323438004444i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.038441052624529834 + 0.007837597448265577i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false, false, false}), Matrix({ { 0.5266562360541849 + 1.7618285302889447e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.47334376394581473 + 4.8069119756681544e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5266562360541849, 1.0e-7), DoubleNear(0.47334376394581473, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00402995502085195 + -0.0011810533245481744i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0041706598994815025 + 0.0004909383142239766i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0041706598994815025 + -0.0004909383142239766i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00402995502085195 + 0.0011810533245481744i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, true, false}), Matrix({ { 0.12737326441536706 + 9.486769009248164e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00017152051985770797 + -0.00362057117889916i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.11498202123536781 + -2.4775713707188285e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00034466133555009694 + -0.00319394221614267i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00017152051985770797 + 0.0036205711788991606i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3992829716388179 + 8.131516293641283e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0003446613355500972 + 0.00319394221614267i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.35836174271044696 + 7.284483346386983e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12737326441536706, 1.0e-7), DoubleNear(0.11498202123536781, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3992829716388179, 1.0e-7), DoubleNear(0.35836174271044696, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false, true}), Matrix({ { 0.18370133138605538 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00024340855166309026 + -6.232676439789299e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.173218573750116 + 1.207021949837378e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00024340855166308945 + 6.232676439789147e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002434085516630903 + 6.232676439789332e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.34295490466812956 + 1.6263032587282567e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.00024340855166308937 + -6.232676439789147e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3001251901956987 + 3.5998900258307764e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.18370133138605538, 1.0e-7), DoubleNear(0.173218573750116, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.34295490466812956, 1.0e-7), DoubleNear(0.3001251901956987, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false, false, false}), Matrix({ { 0.12359228519369475 + -9.486769009248164e-20i, 0.0 + 0.0i, -0.006498008547943754 + -0.018507160306386373i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01634425010526476 + 0.004059463897366972i, 0.0 + 0.0i, -0.01927104951804517 + -0.004216386961290114i }, { 0.0 + 0.0i, 0.12118719476824286 + -7.242131699024268e-20i, 0.0 + 0.0i, -0.00807044176471066 + 0.005171211740986962i, 0.01684625161900672 + -0.004184147318651785i, 0.0 + 0.0i, -0.0064883077675474835 + 0.0005728202438756468i, 0.0 + 0.0i }, { -0.006498008547943754 + 0.018507160306386373i, 0.0 + 0.0i, 0.13575303332772615 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.006294962660600508 + -0.0005557507713288179i, 0.0 + 0.0i, 0.022096802519265074 + -0.01189706134563255i }, { 0.0 + 0.0i, -0.00807044176471066 + -0.005171211740986962i, 0.0 + 0.0i, 0.11906431501498095 + -6.776263578034403e-21i, -0.019862945503920884 + 0.0043458901580386575i, 0.0 + 0.0i, 0.022775489411724886 + 0.012262470756656232i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.01684625161900672 + 0.004184147318651786i, 0.0 + 0.0i, -0.019862945503920884 + -0.0043458901580386575i, 0.12738833052183599 + -2.710505431213761e-20i, 0.0 + 0.0i, -0.006697590058650395 + -0.019075594001969533i, 0.0 + 0.0i }, { 0.01634425010526476 + -0.004059463897366972i, 0.0 + 0.0i, -0.006294962660600507 + 0.000555750771328817i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11757593710715215 + 6.988021814847978e-21i, 0.0 + 0.0i, -0.007829950640983168 + 0.0050171147833630615i }, { 0.0 + 0.0i, -0.006488307767547485 + -0.0005728202438756465i, 0.0 + 0.0i, 0.022775489411724886 + -0.012262470756656232i, -0.006697590058650397 + 0.019075594001969533i, 0.0 + 0.0i, 0.13992258701092808 + 1.6263032587282567e-19i, 0.0 + 0.0i }, { -0.01927104951804517 + 0.004216386961290115i, 0.0 + 0.0i, 0.022096802519265074 + 0.01189706134563255i, 0.0 + 0.0i, 0.0 + 0.0i, -0.007829950640983168 + -0.0050171147833630615i, 0.0 + 0.0i, 0.1155163170554388 + 1.2027867851011065e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12359228519369475, 1.0e-7), DoubleNear(0.12118719476824286, 1.0e-7), DoubleNear(0.13575303332772615, 1.0e-7), DoubleNear(0.11906431501498095, 1.0e-7), DoubleNear(0.12738833052183599, 1.0e-7), DoubleNear(0.11757593710715215, 1.0e-7), DoubleNear(0.13992258701092808, 1.0e-7), DoubleNear(0.1155163170554388, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false, false, false}), Matrix({ { 0.25098061571553076 + -1.2197274440461925e-19i, 0.0 + 0.0i, -0.01319559860659415 + -0.037582754308355906i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23876313187539502 + -6.54332951753947e-20i, 0.0 + 0.0i, -0.015900392405693825 + 0.010188326524350023i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013195598606594151 + 0.037582754308355906i, 0.0 + 0.0i, 0.2756756203386542 + 2.981555974335137e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.015900392405693825 + -0.010188326524350023i, 0.0 + 0.0i, 0.23458063207041974 + 1.1350241493207625e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.25098061571553076, 1.0e-7), DoubleNear(0.23876313187539502, 1.0e-7), DoubleNear(0.2756756203386542, 1.0e-7), DoubleNear(0.23458063207041974, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true, false, false}), Matrix({ { 0.12359228519369475 + -9.486769009248164e-20i, 0.0 + 0.0i, -0.006498008547943754 + -0.018507160306386373i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0017797951526049233 + 0.00028629143028618774i, 0.0 + 0.0i, -0.0020933902319416006 + -0.00027675783875353156i }, { 0.0 + 0.0i, 0.11757593710715215 + 6.988021814847978e-21i, 0.0 + 0.0i, -0.007829950640983168 + 0.0050171147833630615i, 0.0017069174144013018 + -0.000579712436217188i, 0.0 + 0.0i, -0.0006664624050314479 + 0.0001157843721893339i, 0.0 + 0.0i }, { -0.006498008547943754 + 0.018507160306386373i, 0.0 + 0.0i, 0.13575303332772615 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0006764395498573035 + -2.773725370088927e-06i, 0.0 + 0.0i, 0.002250159868247027 + -0.001467344754834362i }, { 0.0 + 0.0i, -0.007829950640983168 + -0.0050171147833630615i, 0.0 + 0.0i, 0.1155163170554388 + 1.2027867851011065e-19i, -0.002017695324215147 + 0.0006227223644132008i, 0.0 + 0.0i, 0.0024637424850802005 + 0.0010706507504411648i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0017069174144013018 + 0.000579712436217188i, 0.0 + 0.0i, -0.002017695324215147 + -0.000622722364413201i, 0.12738833052183599 + -2.710505431213761e-20i, 0.0 + 0.0i, -0.006697590058650395 + -0.019075594001969533i, 0.0 + 0.0i }, { 0.0017797951526049233 + -0.0002862914302861877i, 0.0 + 0.0i, -0.0006764395498573036 + 2.773725370088846e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12118719476824286 + -7.242131699024268e-20i, 0.0 + 0.0i, -0.00807044176471066 + 0.005171211740986962i }, { 0.0 + 0.0i, -0.0006664624050314479 + -0.00011578437218933384i, 0.0 + 0.0i, 0.0024637424850802005 + -0.0010706507504411645i, -0.006697590058650397 + 0.019075594001969533i, 0.0 + 0.0i, 0.13992258701092808 + 1.6263032587282567e-19i, 0.0 + 0.0i }, { -0.0020933902319416006 + 0.00027675783875353156i, 0.0 + 0.0i, 0.002250159868247027 + 0.001467344754834362i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00807044176471066 + -0.005171211740986962i, 0.0 + 0.0i, 0.11906431501498095 + -6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.12359228519369475, 1.0e-7), DoubleNear(0.11757593710715215, 1.0e-7), DoubleNear(0.13575303332772615, 1.0e-7), DoubleNear(0.1155163170554388, 1.0e-7), DoubleNear(0.12738833052183599, 1.0e-7), DoubleNear(0.12118719476824286, 1.0e-7), DoubleNear(0.13992258701092808, 1.0e-7), DoubleNear(0.11906431501498095, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, true, false}), Matrix({ { 0.06941578643643478 + 4.0657581468206416e-20i, 0.0 + 0.0i, -0.0027945143636805415 + 0.016712171655614647i, 0.0 + 0.0i, -0.0029984667176928626 + 0.00029688066896520595i, 0.0 + 0.0i, 0.008492915983488024 + 0.010268248038000149i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.056659273581329384 + -6.54332951753947e-20i, 0.0 + 0.0i, -0.003914089892503516 + -0.005473029368196385i, 0.0 + 0.0i, 0.0012373904408906834 + -0.001960009151376494i, 0.0 + 0.0i, 0.006414899672777933 + 0.009724805301204655i }, { -0.002794514363680542 + -0.016712171655614647i, 0.0 + 0.0i, 0.0579574779789323 + 5.421010862427522e-20i, 0.0 + 0.0i, 0.00654567633635507 + 0.010525640449305476i, 0.0 + 0.0i, 0.002826946197835155 + -0.003917451847864366i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.003914089892503516 + 0.005473029368196386i, 0.0 + 0.0i, 0.05832274765403843 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.006758538059030587 + 0.009716062947877021i, 0.0 + 0.0i, -0.0015820517764407803 + -0.0012339330647661755i }, { -0.002998466717692863 + -0.00029688066896520573i, 0.0 + 0.0i, 0.00654567633635507 + -0.010525640449305476i, 0.0 + 0.0i, 0.18156482927909595 + -1.6263032587282567e-19i, 0.0 + 0.0i, -0.010401084242913607 + -0.05429492596397055i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0012373904408906834 + 0.001960009151376495i, 0.0 + 0.0i, 0.006758538059030588 + -0.009716062947877021i, 0.0 + 0.0i, 0.18210385829406564 + 0.0i, 0.0 + 0.0i, -0.01198630251319031 + 0.015661355892546407i }, { 0.008492915983488024 + -0.010268248038000149i, 0.0 + 0.0i, 0.0028269461978351553 + 0.003917451847864366i, 0.0 + 0.0i, -0.010401084242913609 + 0.05429492596397056i, 0.0 + 0.0i, 0.21771814235972198 + 2.439454888092385e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.006414899672777934 + -0.009724805301204655i, 0.0 + 0.0i, -0.0015820517764407807 + 0.0012339330647661755i, 0.0 + 0.0i, -0.011986302513190312 + -0.015661355892546407i, 0.0 + 0.0i, 0.1762578844163813 + 7.284483346386983e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.06941578643643478, 1.0e-7), DoubleNear(0.056659273581329384, 1.0e-7), DoubleNear(0.0579574779789323, 1.0e-7), DoubleNear(0.05832274765403843, 1.0e-7), DoubleNear(0.18156482927909595, 1.0e-7), DoubleNear(0.18210385829406564, 1.0e-7), DoubleNear(0.21771814235972198, 1.0e-7), DoubleNear(0.1762578844163813, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false, true}), Matrix({ { 0.08885661429467542 + -6.776263578034403e-20i, 0.0 + 0.0i, -0.005121203657775232 + -0.011120012290428607i, 0.0 + 0.0i, -0.00026265220364649284 + 1.531487030198206e-05i, 0.0 + 0.0i, 0.0007841896420590922 + -0.0006983991229517156i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0868764705670872 + 2.2234614865425384e-20i, 0.0 + 0.0i, -0.007915649810605094 + 0.005363646664104403i, 0.0 + 0.0i, 0.00010956728911945341 + -1.3465012765667423e-05i, 0.0 + 0.0i, 0.0002814461386075305 + -0.000323549610642309i }, { -0.005121203657775233 + 0.011120012290428609i, 0.0 + 0.0i, 0.09484471709137998 + 8.131516293641283e-20i, 0.0 + 0.0i, 0.0003390443951418611 + -0.0007578676208114582i, 0.0 + 0.0i, 1.9243651983402656e-05 + -7.764163469987508e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.007915649810605094 + -0.005363646664104403i, 0.0 + 0.0i, 0.08634210318302882 + -1.0164395367051604e-20i, 0.0 + 0.0i, 0.0004622564685930344 + -0.00034425216080289386i, 0.0 + 0.0i, 0.00013384126254363605 + 7.579177716355884e-05i }, { -0.00026265220364649284 + -1.5314870301981736e-05i, 0.0 + 0.0i, 0.00033904439514186106 + 0.0007578676208114582i, 0.0 + 0.0i, 0.1621240014208553 + -5.421010862427522e-20i, 0.0 + 0.0i, -0.008074394948818916 + -0.026462742017927303i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.00010956728911945342 + 1.3465012765667423e-05i, 0.0 + 0.0i, 0.0004622564685930344 + 0.00034425216080289386i, 0.0 + 0.0i, 0.15188666130830783 + -8.766791004082009e-20i, 0.0 + 0.0i, -0.007984742595088733 + 0.0048246798602456205i }, { 0.0007841896420590922 + 0.0006983991229517155i, 0.0 + 0.0i, 1.9243651983402547e-05 + 7.764163469987512e-05i, 0.0 + 0.0i, -0.008074394948818918 + 0.0264627420179273i, 0.0 + 0.0i, 0.18083090324727427 + 2.168404344971009e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0002814461386075305 + 0.0003235496106423091i, 0.0 + 0.0i, 0.00013384126254363594 + -7.57917771635589e-05i, 0.0 + 0.0i, -0.007984742595088733 + -0.00482467986024562i, 0.0 + 0.0i, 0.14823852888739092 + 1.2366681029912785e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.08885661429467542, 1.0e-7), DoubleNear(0.0868764705670872, 1.0e-7), DoubleNear(0.09484471709137998, 1.0e-7), DoubleNear(0.08634210318302882, 1.0e-7), DoubleNear(0.1621240014208553, 1.0e-7), DoubleNear(0.15188666130830783, 1.0e-7), DoubleNear(0.18083090324727427, 1.0e-7), DoubleNear(0.14823852888739092, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.038441052624529834 + -0.00783759744826558i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0396217410307316 + 0.008078323438004445i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0396217410307316 + -0.008078323438004444i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.038441052624529834 + 0.007837597448265577i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.038441052624529834 + -0.00783759744826558i, 0.0 + 0.0i, 0.00402995502085195 + -0.0011810533245481744i, 0.027663018353824387 + -0.002327955206080047i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.038441052624529834 + 0.007837597448265577i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i, 0.024862740310083793 + -0.002092300449718426i, 0.0041706598994815025 + 0.0004909383142239766i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00402995502085195 + 0.0011810533245481744i, 0.0 + 0.0i, 0.0 + 0.0i, 0.024862740310083793 + 0.0020923004497184297i, 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0396217410307316 + 0.008078323438004445i, 0.0 + 0.0i }, { 0.02766301835382439 + 0.002327955206080052i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0041706598994815025 + -0.0004909383142239766i, 0.0 + 0.0i, 0.0396217410307316 + -0.008078323438004444i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, true, false}), Matrix({ { 0.0627233811535422 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.009108332202263925 + -0.0018221201501620679i, -8.446314846422942e-05 + -0.0017829052830667942i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0002482065506693383 + -0.0005184080716983395i }, { 0.0 + 0.0i, 0.05836055379592177 + -8.597384414631148e-20i, 0.00938808786702387 + 0.0018780852184711017i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00017493714407377744 + -0.0016211250639323795i, -0.001574352024430772 + -0.00047508026959300863i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.00938808786702387 + -0.001878085218471102i, 0.06464988326182487 + 8.131516293641283e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00025583003069162087 + -0.0005343305909361474i, -8.70573713934785e-05 + -0.0018376658958323662i, 0.0 + 0.0i }, { 0.009108332202263925 + 0.0018221201501620668i, 0.0 + 0.0i, 0.0 + 0.0i, 0.056621467439446044 + 6.11981304391232e-20i, -0.0015274379026842299 + -0.0004609233508980777i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00016972419147631945 + -0.0015728171522102904i }, { -8.446314846422969e-05 + 0.0017829052830667942i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0015274379026842299 + 0.00046092335089807787i, 0.1966219373678787 + 2.710505431213761e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02933272042226591 + -0.006015477298103511i }, { 0.0 + 0.0i, -0.0001749371440737777 + 0.00162112506393238i, -0.00025583003069162087 + 0.0005343305909361475i, 0.0 + 0.0i, 0.0 + 0.0i, 0.18189095598730204 + 6.776263578034403e-21i, 0.030233653163707734 + 0.006200238219533344i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0015743520244307719 + 0.0004750802695930087i, -8.705737139347834e-05 + 0.0018376658958323667i, 0.0 + 0.0i, 0.0 + 0.0i, 0.030233653163707734 + -0.006200238219533342i, 0.20266103427093923 + 5.421010862427522e-20i, 0.0 + 0.0i }, { -0.00024820655066933826 + 0.0005184080716983394i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00016972419147631945 + 0.00157281715221029i, 0.02933272042226591 + 0.0060154772981035115i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17647078672314492 + 6.606856988583543e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.0627233811535422, 1.0e-7), DoubleNear(0.05836055379592177, 1.0e-7), DoubleNear(0.06464988326182487, 1.0e-7), DoubleNear(0.056621467439446044, 1.0e-7), DoubleNear(0.1966219373678787, 1.0e-7), DoubleNear(0.18189095598730204, 1.0e-7), DoubleNear(0.20266103427093923, 1.0e-7), DoubleNear(0.17647078672314492, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false, true}), Matrix({ { 0.09046143772657043 + -1.2197274440461925e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01263720359529568 + -0.002832300199707572i, -0.00011986351635150309 + -3.069204057334679e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -3.869901030226199e-05 + 0.00026886566389981053i }, { 0.0 + 0.0i, 0.08791923974882238 + 2.117582368135751e-21i, 0.013025345926295635 + 0.0029192921986348794i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00012354503531158674 + 3.1634723824545605e-05i, -0.0002987531063894541 + 9.967812781886711e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.013025345926295635 + -0.00291929219863488i, 0.09323989365948497 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -3.988762168711807e-05 + 0.00027712367325488435i, -0.00012354503531158715 + -3.163472382454631e-05i, 0.0 + 0.0i }, { 0.01263720359529568 + 0.0028323001997075715i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08529933400129365 + 9.952637130238029e-21i, -0.00028985056147712437 + 9.670781892263887e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00011986351635150271 + 3.0692040573345814e-05i }, { -0.00011986351635150309 + 3.069204057334679e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00028985056147712437 + -9.670781892263888e-05i, 0.16888388079485045 + 1.6263032587282567e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.025803849029234154 + -0.005005297248558006i }, { 0.0 + 0.0i, 0.0001235450353115868 + -3.163472382454544e-05i, -3.988762168711806e-05 + -0.00027712367325488435i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15233227003440142 + -8.131516293641283e-20i, 0.02659639510443597 + 0.005159031239369566i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0002987531063894541 + -9.967812781886713e-05i, -0.00012354503531158717 + 3.1634723824546527e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02659639510443597 + -0.005159031239369565i, 0.1740710238732791 + 0.0i, 0.0 + 0.0i }, { -3.869901030226202e-05 + -0.0002688656638998106i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00011986351635150259 + -3.0692040573345976e-05i, 0.025803849029234154 + 0.005005297248558006i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1477929201612973 + 1.173140631947206e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.09046143772657043, 1.0e-7), DoubleNear(0.08791923974882238, 1.0e-7), DoubleNear(0.09323989365948497, 1.0e-7), DoubleNear(0.08529933400129365, 1.0e-7), DoubleNear(0.16888388079485045, 1.0e-7), DoubleNear(0.15233227003440142, 1.0e-7), DoubleNear(0.1740710238732791, 1.0e-7), DoubleNear(0.1477929201612973, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00402995502085195 + -0.0011810533245481744i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0041706598994815025 + 0.0004909383142239766i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0041706598994815025 + -0.0004909383142239766i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00402995502085195 + 0.0011810533245481744i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, true, false}), Matrix({ { 0.12737326441536706 + 9.486769009248164e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00017152051985770797 + -0.00362057117889916i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.11498202123536781 + -2.4775713707188285e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00034466133555009694 + -0.00319394221614267i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00017152051985770797 + 0.0036205711788991606i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3992829716388179 + 8.131516293641283e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0003446613355500972 + 0.00319394221614267i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.35836174271044696 + 7.284483346386983e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.12737326441536706, 1.0e-7), DoubleNear(0.11498202123536781, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3992829716388179, 1.0e-7), DoubleNear(0.35836174271044696, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false, true}), Matrix({ { 0.18370133138605538 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00024340855166309026 + -6.232676439789299e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.173218573750116 + 1.207021949837378e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00024340855166308945 + 6.232676439789147e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002434085516630903 + 6.232676439789332e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.34295490466812956 + 1.6263032587282567e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.00024340855166308937 + -6.232676439789147e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3001251901956987 + 3.5998900258307764e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.18370133138605538, 1.0e-7), DoubleNear(0.173218573750116, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.34295490466812956, 1.0e-7), DoubleNear(0.3001251901956987, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, true, false}), Matrix({ { 0.0627233811535422 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0009551826429973621 + -0.0002761149996230172i, -8.446314846422942e-05 + -0.0017829052830667942i, 0.0 + 0.0i, 0.0 + 0.0i, -3.1128277857934914e-05 + -5.3067926380214427e-05i }, { 0.0 + 0.0i, 0.056621467439446044 + 6.11981304391232e-20i, 0.0009878943504139956 + 0.00011259718877642966i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00016972419147631945 + -0.0015728171522102904i, -0.00016706124443510755 + -3.5453595810030376e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0009878943504139956 + -0.00011259718877642958i, 0.06464988326182487 + 8.131516293641283e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -2.182152980275924e-05 + -5.752386747919462e-05i, -8.70573713934785e-05 + -0.0018376658958323662i, 0.0 + 0.0i }, { 0.000955182642997362 + 0.0002761149996230172i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05836055379592177 + -8.597384414631148e-20i, -0.00015878649384046042 + -6.287500474688799e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00017493714407377744 + -0.0016211250639323795i }, { -8.446314846422969e-05 + 0.0017829052830667942i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00015878649384046042 + 6.287500474688794e-05i, 0.1966219373678787 + 2.710505431213761e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003074772377854588 + -0.000904938324925157i }, { 0.0 + 0.0i, -0.00016972419147631945 + 0.00157281715221029i, -2.1821529802759254e-05 + 5.752386747919463e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17647078672314492 + 6.606856988583543e-20i, 0.003182765549067507 + 0.00037834112544754696i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.00016706124443510758 + 3.545359581003032e-05i, -8.705737139347834e-05 + 0.0018376658958323667i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0031827655490675065 + -0.000378341125447547i, 0.20266103427093923 + 5.421010862427522e-20i, 0.0 + 0.0i }, { -3.112827785793486e-05 + 5.306792638021442e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0001749371440737777 + 0.00162112506393238i, 0.0030747723778545883 + 0.0009049383249251572i, 0.0 + 0.0i, 0.0 + 0.0i, 0.18189095598730204 + 6.776263578034403e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.0627233811535422, 1.0e-7), DoubleNear(0.056621467439446044, 1.0e-7), DoubleNear(0.06464988326182487, 1.0e-7), DoubleNear(0.05836055379592177, 1.0e-7), DoubleNear(0.1966219373678787, 1.0e-7), DoubleNear(0.17647078672314492, 1.0e-7), DoubleNear(0.20266103427093923, 1.0e-7), DoubleNear(0.18189095598730204, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false, true}), Matrix({ { 0.09046143772657043 + -1.2197274440461925e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0013225213740430777 + -0.00041554178391352726i, -0.00011986351635150309 + -3.069204057334679e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -1.7144100105198366e-06 + 2.902587716097592e-05i }, { 0.0 + 0.0i, 0.08529933400129365 + 9.952637130238029e-21i, 0.0013733683917003191 + 0.000188671724583482i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00011986351635150271 + 3.0692040573345814e-05i, -3.0048778115247593e-05 + 1.2917099535438433e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.001373368391700319 + -0.00018867172458348215i, 0.09323989365948497 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -6.541234921647253e-06 + 2.833113115193349e-05i, -0.00012354503531158715 + -3.163472382454631e-05i, 0.0 + 0.0i }, { 0.0013225213740430777 + 0.00041554178391352704i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08791923974882238 + 2.117582368135751e-21i, -3.178493029885456e-05 + 7.713542151616507e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00012354503531158674 + 3.1634723824545605e-05i }, { -0.00011986351635150309 + 3.069204057334679e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -3.178493029885456e-05 + -7.713542151616493e-06i, 0.16888388079485045 + 1.6263032587282567e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0027074336468088725 + -0.000765511540634647i }, { 0.0 + 0.0i, 0.00011986351635150259 + -3.0692040573345976e-05i, -6.541234921647243e-06 + -2.83311311519335e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1477929201612973 + 1.173140631947206e-19i, 0.0027972915077811833 + 0.0003022665896404946i, 0.0 + 0.0i }, { 0.0 + 0.0i, -3.0048778115247593e-05 + -1.2917099535438438e-05i, -0.00012354503531158717 + 3.1634723824546527e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0027972915077811833 + -0.00030226658964049445i, 0.1740710238732791 + 0.0i, 0.0 + 0.0i }, { -1.7144100105198433e-06 + -2.902587716097592e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0001235450353115868 + -3.163472382454544e-05i, 0.0027074336468088725 + 0.0007655115406346473i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15233227003440142 + -8.131516293641283e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.09046143772657043, 1.0e-7), DoubleNear(0.08529933400129365, 1.0e-7), DoubleNear(0.09323989365948497, 1.0e-7), DoubleNear(0.08791923974882238, 1.0e-7), DoubleNear(0.16888388079485045, 1.0e-7), DoubleNear(0.1477929201612973, 1.0e-7), DoubleNear(0.1740710238732791, 1.0e-7), DoubleNear(0.15233227003440142, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true, true}), Matrix({ { 0.04585890485298884 + -1.3552527156068805e-20i, 0.0 + 0.0i, -0.0005141012971790911 + 0.0002552458730117274i, 0.0 + 0.0i, -0.0003384228246646429 + -0.000696663932668437i, 0.0 + 0.0i, 5.307046476372945e-05 + 0.0007410545319040228i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.04412717960862711 + 8.682087709356578e-21i, 0.0 + 0.0i, -0.0006713239147174818 + 1.6335830316242708e-05i, 0.0 + 0.0i, -0.00011101329835296208 + -0.0006749628165020111i, 0.0 + 0.0i, 7.114337642068734e-05 + 0.000219077784734298i }, { -0.0005141012971790911 + -0.0002552458730117272i, 0.0 + 0.0i, 0.13784242653306655 + 2.710505431213761e-20i, 0.0 + 0.0i, -0.0005285356365596959 + -0.0007680785277852148i, 0.0 + 0.0i, 9.501427300155263e-05 + 0.000634337168270544i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0006713239147174818 + -1.6335830316242626e-05i, 0.0 + 0.0i, 0.1290913941414889 + 3.3881317890172014e-21i, 0.0 + 0.0i, -0.0001971974328638389 + -0.0002263182806392121i, 0.0 + 0.0i, 0.0003544218500160515 + 0.0007372895808999025i }, { -0.000338422824664643 + 0.0006966639326684371i, 0.0 + 0.0i, -0.0005285356365596959 + 0.0007680785277852149i, 0.0 + 0.0i, 0.08151435956237824 + 1.0842021724855044e-19i, 0.0 + 0.0i, 0.00034258077732138314 + -0.0038758170519108876i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0001110132983529621 + 0.0006749628165020111i, 0.0 + 0.0i, -0.0001971974328638389 + 0.00022631828063921205i, 0.0 + 0.0i, 0.0708548416267407 + -3.3457801416544863e-20i, 0.0 + 0.0i, 0.00032666257916738487 + -0.0032102780464589127i }, { 5.307046476372945e-05 + -0.0007410545319040229i, 0.0 + 0.0i, 9.501427300155272e-05 + -0.0006343371682705438i, 0.0 + 0.0i, 0.00034258077732138314 + 0.003875817051910888i, 0.0 + 0.0i, 0.2614405451057513 + 5.421010862427522e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 7.114337642068734e-05 + -0.000219077784734298i, 0.0 + 0.0i, 0.00035442185001605147 + -0.0007372895808999025i, 0.0 + 0.0i, 0.0003266625791673846 + 0.0032102780464589127i, 0.0 + 0.0i, 0.22927034856895803 + 6.945670167485263e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.04585890485298884, 1.0e-7), DoubleNear(0.04412717960862711, 1.0e-7), DoubleNear(0.13784242653306655, 1.0e-7), DoubleNear(0.1290913941414889, 1.0e-7), DoubleNear(0.08151435956237824, 1.0e-7), DoubleNear(0.0708548416267407, 1.0e-7), DoubleNear(0.2614405451057513, 1.0e-7), DoubleNear(0.22927034856895803, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false, false, false}), Matrix({ { 0.24477947996193758 + -1.6728900708272432e-19i, 0.0 + 0.0i, -0.014568450312654416 + -0.013335948565399412i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014568450312654416 + 0.013335948565399412i, 0.0 + 0.0i, 0.2548173483427071 + 1.2874900798265365e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24496426762898815 + -2.0117032497289633e-20i, 0.0 + 0.0i, -0.014527540699633563 + -0.014058479218606472i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014527540699633563 + 0.014058479218606468i, 0.0 + 0.0i, 0.2554389040663669 + 2.829090043829363e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24477947996193758, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2548173483427071, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24496426762898815, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2554389040663669, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false, false, false}), Matrix({ { 0.48974374759092576 + -1.8740603958001395e-19i, 0.0 + 0.0i, -0.02909599101228798 + -0.027394427784005883i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.029095991012287978 + 0.027394427784005887i, 0.0 + 0.0i, 0.5102562524090739 + 4.1165801236558996e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.48974374759092576, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5102562524090739, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true, false, false}), Matrix({ { 0.2411682223008469 + -8.787966827763366e-20i, 0.0 + 0.0i, -0.01432795918892692 + -0.013490045523023313i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01432795918892692 + 0.013490045523023315i, 0.0 + 0.0i, 0.25126935038316495 + 2.558039500707987e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2485755252900788 + -9.952637130238029e-20i, 0.0 + 0.0i, -0.014768031823361057 + -0.013904382260982572i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014768031823361057 + 0.013904382260982569i, 0.0 + 0.0i, 0.258986902025909 + 1.5585406229479126e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2411682223008469, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25126935038316495, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2485755252900788, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.258986902025909, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, true, false}), Matrix({ { 0.12607506001776414 + -2.4775713707188285e-20i, 0.0 + 0.0i, -0.006708604256184058 + 0.011239142287418262i, 0.0 + 0.0i, -0.0017610762768021791 + -0.0016631284824112885i, 0.0 + 0.0i, 0.014907815656265956 + 0.019993053339204803i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006708604256184057 + -0.01123914228741826i, 0.0 + 0.0i, 0.11628022563297072 + 9.486769009248164e-20i, 0.0 + 0.0i, 0.013304214395385658 + 0.0202417033971825i, 0.0 + 0.0i, 0.0012448944213943746 + -0.0051513849126305425i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017610762768021796 + 0.0016631284824112887i, 0.0 + 0.0i, 0.013304214395385658 + -0.0202417033971825i, 0.0 + 0.0i, 0.3636686875731616 + -1.6263032587282567e-19i, 0.0 + 0.0i, -0.02238738675610392 + -0.03863357007142415i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.014907815656265956 + -0.0199930533392048i, 0.0 + 0.0i, 0.0012448944213943746 + 0.005151384912630542i, 0.0 + 0.0i, -0.02238738675610392 + 0.03863357007142415i, 0.0 + 0.0i, 0.3939760267761032 + 3.1679032227310833e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12607506001776414, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11628022563297072, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3636686875731616, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3939760267761032, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false, true}), Matrix({ { 0.17573308486176262 + -4.5528020914918643e-20i, 0.0 + 0.0i, -0.013036853468380329 + -0.005756365626324203i, 0.0 + 0.0i, -0.00015308491452703944 + 1.8498575363145838e-06i, 0.0 + 0.0i, 0.0010656357806666228 + -0.0010219487335940245i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013036853468380329 + 0.005756365626324205i, 0.0 + 0.0i, 0.1811868202744088 + 7.115076756936123e-20i, 0.0 + 0.0i, 0.0008013008637348955 + -0.0011021197816143522i, 0.0 + 0.0i, 0.00015308491452703868 + -1.84985753631621e-06i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00015308491452703938 + -1.849857536314367e-06i, 0.0 + 0.0i, 0.0008013008637348955 + 0.001102119781614352i, 0.0 + 0.0i, 0.31401066272916317 + -1.418780186650953e-19i, 0.0 + 0.0i, -0.016059137543907653 + -0.02163806215768168i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010656357806666228 + 0.0010219487335940245i, 0.0 + 0.0i, 0.00015308491452703857 + 1.8498575363163185e-06i, 0.0 + 0.0i, -0.01605913754390765 + 0.021638062157681683i, 0.0 + 0.0i, 0.32906943213466516 + 3.4050724479622874e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17573308486176262, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1811868202744088, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.31401066272916317, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.32906943213466516, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false, false, false}), Matrix({ { 0.4995968283046447 + -3.8539999100070665e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.500403171695355 + 2.627919718856467e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.4995968283046447, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.500403171695355, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027663018353824387 + -0.002327955206080047i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i, 0.024862740310083793 + -0.002092300449718426i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.024862740310083793 + 0.0020923004497184297i, 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02766301835382439 + 0.002327955206080052i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, true, false}), Matrix({ { 0.12108393494946397 + -7.242131699024268e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00025940029253800686 + -0.003404030346999174i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.12127135070127092 + 1.4251329337553603e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00025678156286979795 + -0.0034104830480426564i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002594002925380074 + 0.0034040303469991743i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.37851289335518074 + 3.3881317890172014e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0002567815628697978 + 0.003410483048042657i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.37913182099408416 + 1.2027867851011065e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12108393494946397, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12127135070127092, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.37851289335518074, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.37913182099408416, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false, true}), Matrix({ { 0.17838067747539282 + -1.198551620364835e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 3.6815189600836542e-06 + 9.426832511987612e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.17853922766077862 + 1.4547790869092608e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -3.6815189600844403e-06 + -9.426832512004959e-07i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 3.6815189600836813e-06 + -9.426832511985443e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.32121615082925187 + 8.131516293641283e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -3.681518960084603e-06 + 9.426832512004959e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3218639440345764 + 1.173140631947206e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17838067747539282, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17853922766077862, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.32121615082925187, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3218639440345764, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true, false, false}), Matrix({ { 0.49243757268401184 + 1.6792428179316504e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.507562427315988 + 5.632769099241097e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.49243757268401184, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.507562427315988, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, true, false}), Matrix({ { 0.24235528565073491 + 7.009197638529335e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0005161818554078049 + -0.00681451339504183i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005161818554078052 + 0.006814513395041831i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.7576447143492648 + 1.5415999640028266e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.24235528565073491, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.7576447143492648, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false, true}), Matrix({ { 0.35691990513617144 + 2.5622746654442585e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -8.131516293641283e-19 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -8.673617379884035e-19 + 1.951563910473908e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.6430800948638283 + 1.9862922613113343e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.35691990513617144, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6430800948638283, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, true, false}), Matrix({ { 0.11934484859298825 + 7.4750657595192e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0002541873399405489 + -0.0033557224352770846i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.12301043705774664 + -4.658681209898652e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.000261994515467256 + -0.0034587909597647458i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002541873399405491 + 0.003355722435277084i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.37309272409102356 + 9.317362419797304e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0002619945154672561 + 0.0034587909597647466i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.38455199025824127 + 6.098637220230962e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.11934484859298825, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12301043705774664, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.37309272409102356, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.38455199025824127, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false, true}), Matrix({ { 0.17576077172786408 + -1.1202010727438122e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -3.7947076036992655e-19 + -9.75781955236954e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.18115913340830736 + 1.376428539288238e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -4.0657581468206416e-19 + -7.589415207398531e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.87890977618477e-19 + 7.589415207398531e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.31667680095614775 + 2.7994438906754626e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -3.7947076036992655e-19 + 1.0842021724855044e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3264032939076806 + -8.131516293641283e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.17576077172786408, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18115913340830736, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.31667680095614775, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3264032939076806, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true, true}), Matrix({ { 0.08998608446161596 + -4.870439446712227e-21i, 0.0 + 0.0i, -0.001185425211896573 + 0.0002715817033279701i, 0.0 + 0.0i, -0.00044943612301760494 + -0.0013716267491704483i, 0.0 + 0.0i, 0.0001242138411844168 + 0.0009601323166383209i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001185425211896573 + -0.0002715817033279699i, 0.0 + 0.0i, 0.2669338206745555 + 3.049318610115481e-20i, 0.0 + 0.0i, -0.0007257330694235348 + -0.000994396808424427i, 0.0 + 0.0i, 0.00044943612301760413 + 0.0013716267491704465i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00044943612301760505 + 0.0013716267491704483i, 0.0 + 0.0i, -0.000725733069423535 + 0.000994396808424427i, 0.0 + 0.0i, 0.15236920118911895 + 7.496241583200558e-20i, 0.0 + 0.0i, 0.000669243356488768 + -0.007086095098369801i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0001242138411844168 + -0.0009601323166383209i, 0.0 + 0.0i, 0.0004494361230176042 + -0.0013716267491704463i, 0.0 + 0.0i, 0.0006692433564887677 + 0.007086095098369801i, 0.0 + 0.0i, 0.4907108936747094 + 1.2366681029912785e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.08998608446161596, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2669338206745555, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.15236920118911895, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4907108936747094, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false, false, false}), Matrix({ { 0.24477947996193758 + -1.6728900708272432e-19i, -0.014568450312654416 + -0.013335948565399412i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014568450312654416 + 0.013335948565399412i, 0.2548173483427071 + 1.2874900798265365e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.24496426762898815 + -2.0117032497289633e-20i, -0.014527540699633563 + -0.014058479218606472i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.014527540699633563 + 0.014058479218606468i, 0.2554389040663669 + 2.829090043829363e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.24477947996193758, 1.0e-7), DoubleNear(0.2548173483427071, 1.0e-7), DoubleNear(0.24496426762898815, 1.0e-7), DoubleNear(0.2554389040663669, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true, false, false}), Matrix({ { 0.12359228519369475 + -9.486769009248164e-20i, -0.006498008547943754 + -0.018507160306386373i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.013182947250393052 + -0.0011093984861123576i, -0.0008592342101277624 + -0.0019157347633532145i }, { -0.006498008547943754 + 0.018507160306386373i, 0.13575303332772615 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0005269834455437724 + 0.002032390602098103i, 0.014480071103431334 + -0.0012185567199676894i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.11757593710715215 + 6.988021814847978e-21i, -0.007829950640983168 + 0.0050171147833630615i, 0.012541214642725883 + -0.0010553940840683717i, -0.0007901451662205332 + 0.0006054333796677873i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.007829950640983168 + -0.0050171147833630615i, 0.1155163170554388 + 1.2027867851011065e-19i, -0.0008802151821052925 + -0.0004648657807464206i, 0.01232152566735791 + -0.0010369063656500543i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.012541214642725885 + 0.001055394084068374i, -0.0008802151821052926 + 0.0004648657807464206i, 0.12118719476824286 + -7.242131699024268e-20i, -0.00807044176471066 + 0.005171211740986962i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.000790145166220533 + -0.0006054333796677873i, 0.01232152566735791 + 0.0010369063656500556i, -0.00807044176471066 + -0.005171211740986962i, 0.11906431501498095 + -6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013182947250393052 + 0.00110939848611236i, -0.0005269834455437726 + -0.0020323906020981025i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.12738833052183599 + -2.710505431213761e-20i, -0.006697590058650395 + -0.019075594001969533i }, { -0.0008592342101277624 + 0.0019157347633532143i, 0.014480071103431337 + 0.0012185567199676918i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.006697590058650397 + 0.019075594001969533i, 0.13992258701092808 + 1.6263032587282567e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.12359228519369475, 1.0e-7), DoubleNear(0.13575303332772615, 1.0e-7), DoubleNear(0.11757593710715215, 1.0e-7), DoubleNear(0.1155163170554388, 1.0e-7), DoubleNear(0.12118719476824286, 1.0e-7), DoubleNear(0.11906431501498095, 1.0e-7), DoubleNear(0.12738833052183599, 1.0e-7), DoubleNear(0.13992258701092808, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, true, false}), Matrix({ { 0.06294105980760989 + -5.886878983417387e-20i, -0.0033627688366535116 + 0.005451797173475977i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0008485047765183938 + -0.0008486318064321716i, 0.007438192980821795 + 0.009992416923404985i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0033627688366535116 + -0.005451797173475976i, 0.05814287514185408 + -1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006653716948998918 + 0.010114729327580035i, 0.0005891044839803868 + -0.002555398540567002i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.06313400021015428 + 3.409307612698559e-20i, -0.0033458354195305467 + 0.0057873451139422855i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0009125715002837855 + -0.0008144966759791169i, 0.007469622675444161 + 0.010000636415799822i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0033458354195305463 + -0.005787345113942285i, 0.05813735049111664 + 1.0842021724855044e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006650497446386739 + 0.010126974069602461i, 0.0006557899374139875 + -0.0025959863720635395i }, { -0.0008485047765183941 + 0.0008486318064321721i, 0.006653716948998919 + -0.010114729327580035i, 0.0 + 0.0i, 0.0 + 0.0i, 0.18183842015432772 + -1.0842021724855044e-19i, -0.011205681476000904 + -0.01878774573887539i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007438192980821795 + -0.009992416923404983i, 0.0005891044839803866 + 0.002555398540567002i, 0.0 + 0.0i, 0.0 + 0.0i, -0.011205681476000904 + 0.018787745738875386i, 0.19667447320085302 + 1.4230153513872246e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0009125715002837856 + 0.000814496675979117i, 0.006650497446386739 + -0.01012697406960246i, 0.0 + 0.0i, 0.0 + 0.0i, 0.18183026741883387 + -5.421010862427522e-20i, -0.011181705280103016 + -0.019845824332548757i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.007469622675444161 + -0.01000063641579982i, 0.0006557899374139877 + 0.0025959863720635395i, 0.0 + 0.0i, 0.0 + 0.0i, -0.011181705280103017 + 0.019845824332548754i, 0.19730155357525025 + 1.7448878713438587e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.06294105980760989, 1.0e-7), DoubleNear(0.05814287514185408, 1.0e-7), DoubleNear(0.06313400021015428, 1.0e-7), DoubleNear(0.05813735049111664, 1.0e-7), DoubleNear(0.18183842015432772, 1.0e-7), DoubleNear(0.19667447320085302, 1.0e-7), DoubleNear(0.18183026741883387, 1.0e-7), DoubleNear(0.19730155357525025, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false, true}), Matrix({ { 0.0878515677378662 + -8.766791004082009e-20i, -0.006539559530109381 + -0.002753526340416911i, 0.0 + 0.0i, 0.0 + 0.0i, -7.372757440388335e-05 + 7.072829942956051e-07i, 0.0005290159291298738 + -0.0005081395946057389i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006539559530109381 + 0.00275352634041691i, 0.09052910973752659 + -3.218725199566341e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00040158221421737435 + -0.0005479319539540922i, 7.740909336396702e-05 + 2.3540025690321027e-07i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.08788151712389641 + 4.213988912590144e-20i, -0.0064972939382709465 + -0.003002839285907292i, 0.0 + 0.0i, 0.0 + 0.0i, -7.935734012315607e-05 + 1.1425745420189787e-06i, 0.000536619851536749 + -0.0005138091389882856i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0064972939382709465 + 0.0030028392859072946i, 0.09065771053688222 + 1.0333801956502464e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0003997186495175211 + -0.0005541878276602597i, 7.567582116307163e-05 + -2.0852577932194746e-06i }, { -7.372757440388331e-05 + -7.072829942955509e-07i, 0.00040158221421737435 + 0.0005479319539540921i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15692791222407138 + -7.962109704190423e-20i, -0.008028890782545034 + -0.0105824222249825i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0005290159291298738 + 0.0005081395946057389i, 7.740909336396699e-05 + -2.3540025690315606e-07i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008028890782545034 + 0.010582422224982502i, 0.16428823860518052 + 1.6093625997831706e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -7.935734012315609e-05 + -1.1425745420189245e-06i, 0.0003997186495175211 + 0.0005541878276602599i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15708275050509174 + -6.225692162319107e-20i, -0.008030246761362617 + -0.01105563993269918i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.000536619851536749 + 0.0005138091389882856i, 7.56758211630715e-05 + 2.0852577932194746e-06i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008030246761362617 + 0.011055639932699174i, 0.16478119352948467 + 1.7957098481791167e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.0878515677378662, 1.0e-7), DoubleNear(0.09052910973752659, 1.0e-7), DoubleNear(0.08788151712389641, 1.0e-7), DoubleNear(0.09065771053688222, 1.0e-7), DoubleNear(0.15692791222407138, 1.0e-7), DoubleNear(0.16428823860518052, 1.0e-7), DoubleNear(0.15708275050509174, 1.0e-7), DoubleNear(0.16478119352948467, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true, false, false}), Matrix({ { 0.2411682223008469 + -8.787966827763366e-20i, -0.01432795918892692 + -0.013490045523023313i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01432795918892692 + 0.013490045523023315i, 0.25126935038316495 + 2.558039500707987e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2485755252900788 + -9.952637130238029e-20i, -0.014768031823361057 + -0.013904382260982572i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014768031823361057 + 0.013904382260982569i, 0.258986902025909 + 1.5585406229479126e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2411682223008469, 1.0e-7), DoubleNear(0.25126935038316495, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2485755252900788, 1.0e-7), DoubleNear(0.258986902025909, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, true, false}), Matrix({ { 0.12607506001776414 + -2.4775713707188285e-20i, -0.006708604256184058 + 0.011239142287418262i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0017610762768021791 + -0.0016631284824112885i, 0.014907815656265956 + 0.019993053339204803i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006708604256184057 + -0.01123914228741826i, 0.11628022563297072 + 9.486769009248164e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.013304214395385658 + 0.0202417033971825i, 0.0012448944213943746 + -0.0051513849126305425i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017610762768021796 + 0.0016631284824112887i, 0.013304214395385658 + -0.0202417033971825i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3636686875731616 + -1.6263032587282567e-19i, -0.02238738675610392 + -0.03863357007142415i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.014907815656265956 + -0.0199930533392048i, 0.0012448944213943746 + 0.005151384912630542i, 0.0 + 0.0i, 0.0 + 0.0i, -0.02238738675610392 + 0.03863357007142415i, 0.3939760267761032 + 3.1679032227310833e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.12607506001776414, 1.0e-7), DoubleNear(0.11628022563297072, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3636686875731616, 1.0e-7), DoubleNear(0.3939760267761032, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false, true}), Matrix({ { 0.17573308486176262 + -4.5528020914918643e-20i, -0.013036853468380329 + -0.005756365626324203i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00015308491452703944 + 1.8498575363145838e-06i, 0.0010656357806666228 + -0.0010219487335940245i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.013036853468380329 + 0.005756365626324205i, 0.1811868202744088 + 7.115076756936123e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0008013008637348955 + -0.0011021197816143522i, 0.00015308491452703868 + -1.84985753631621e-06i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00015308491452703938 + -1.849857536314367e-06i, 0.0008013008637348955 + 0.001102119781614352i, 0.0 + 0.0i, 0.0 + 0.0i, 0.31401066272916317 + -1.418780186650953e-19i, -0.016059137543907653 + -0.02163806215768168i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010656357806666228 + 0.0010219487335940245i, 0.00015308491452703857 + 1.8498575363163185e-06i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01605913754390765 + 0.021638062157681683i, 0.32906943213466516 + 3.4050724479622874e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.17573308486176262, 1.0e-7), DoubleNear(0.1811868202744088, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.31401066272916317, 1.0e-7), DoubleNear(0.32906943213466516, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, true, false}), Matrix({ { 0.062084096531138916 + 2.0540548970916783e-20i, -0.003303568796012909 + 0.005534575947066483i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0008672201270598622 + -0.0008189869529402595i, 0.007341168555792319 + 0.009845330656899996i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003303568796012909 + -0.0055345759470664824i, 0.05726075206184933 + 5.421010862427522e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006551495043331404 + 0.00996777528789827i, 0.0006130327871193133 + -0.002536735482336825i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.06399096348662524 + -4.531626267810507e-20i, -0.003405035460171149 + 0.005704566340351779i, 0.0 + 0.0i, 0.0 + 0.0i, -0.000893856149742317 + -0.000844141529471029i, 0.007566647100473638 + 0.010147722682304808i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0034050354601711484 + -0.005704566340351778i, 0.05901947357112139 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006752719352054255 + 0.010273928109284229i, 0.000631861634275061 + -0.0026146494302937166i }, { -0.0008672201270598624 + 0.0008189869529402594i, 0.006551495043331404 + -0.00996777528789827i, 0.0 + 0.0i, 0.0 + 0.0i, 0.179084125769708 + -1.0842021724855044e-19i, -0.011024390392914012 + -0.019024621470089795i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007341168555792319 + -0.009845330656899994i, 0.0006130327871193132 + 0.0025367354823368246i, 0.0 + 0.0i, 0.0 + 0.0i, -0.011024390392914012 + 0.019024621470089795i, 0.19400859832131562 + 2.0159384144652348e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0008938561497423171 + 0.0008441415294710295i, 0.0067527193520542554 + -0.010273928109284227i, 0.0 + 0.0i, 0.0 + 0.0i, 0.18458456180345362 + -5.421010862427522e-20i, -0.011362996363189909 + -0.01960894860133435i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.007566647100473637 + -0.010147722682304808i, 0.0006318616342750611 + 0.0026146494302937166i, 0.0 + 0.0i, 0.0 + 0.0i, -0.011362996363189909 + 0.019608948601334348i, 0.19996742845478765 + 1.1519648082658485e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.062084096531138916, 1.0e-7), DoubleNear(0.05726075206184933, 1.0e-7), DoubleNear(0.06399096348662524, 1.0e-7), DoubleNear(0.05901947357112139, 1.0e-7), DoubleNear(0.179084125769708, 1.0e-7), DoubleNear(0.19400859832131562, 1.0e-7), DoubleNear(0.18458456180345362, 1.0e-7), DoubleNear(0.19996742845478765, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false, true}), Matrix({ { 0.08653757374959987 + -7.983285527871781e-20i, -0.006419836477406352 + -0.0028346507165087735i, 0.0 + 0.0i, 0.0 + 0.0i, -7.538476372423477e-05 + 9.109393549939257e-07i, 0.0005247590971967039 + -0.0005032459537785414i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006419836477406352 + 0.0028346507165087735i, 0.08922319797826421 + -3.218725199566341e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0003945906523272141 + -0.000542725190065205i, 7.538476372423436e-05 + -9.109393549949015e-07i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.08919551111216274 + 3.4304834363799164e-20i, -0.0066170169909739755 + -0.0029217149098154293i, 0.0 + 0.0i, 0.0 + 0.0i, -7.770015080280467e-05 + 9.389181813206581e-07i, 0.0005408766834699189 + -0.000518702779815483i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0066170169909739755 + 0.002921714909815431i, 0.0919636222961446 + 1.0333801956502464e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0004067102114076814 + -0.0005593945915491471i, 7.770015080280426e-05 + -9.389181813213086e-07i }, { -7.538476372423477e-05 + -9.109393549939799e-07i, 0.00039459065232721406 + 0.0005427251900652048i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15463064855124703 + -8.046812998915853e-21i, -0.007908122711520568 + -0.01065539480651454i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0005247590971967039 + 0.0005032459537785415i, 7.538476372423425e-05 + 9.10939354994793e-07i, 0.0 + 0.0i, 0.0 + 0.0i, -0.007908122711520568 + 0.010655394806514541i, 0.16204615240490072 + 2.879912020664621e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -7.770015080280462e-05 + -9.38918181320387e-07i, 0.0004067102114076814 + 0.0005593945915491472i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15938001417791609 + -1.3383120566617945e-19i, -0.008151014832387081 + -0.010982667351167142i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0005408766834699189 + 0.000518702779815483i, 7.770015080280424e-05 + 9.389181813214712e-07i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008151014832387083 + 0.010982667351167139i, 0.16702327972976444 + 5.251604272976662e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.08653757374959987, 1.0e-7), DoubleNear(0.08922319797826421, 1.0e-7), DoubleNear(0.08919551111216274, 1.0e-7), DoubleNear(0.0919636222961446, 1.0e-7), DoubleNear(0.15463064855124703, 1.0e-7), DoubleNear(0.16204615240490072, 1.0e-7), DoubleNear(0.15938001417791609, 1.0e-7), DoubleNear(0.16702327972976444, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true, true}), Matrix({ { 0.0470312041012684 + 8.682087709356578e-21i, -0.003317669042105768 + 0.0011176585928652164i, -0.00035393615102352063 + 0.0007551671320273929i, 0.005743119047807002 + 0.004583147611116488i, 1.68742972073224e-06 + -0.0008553079878436218i, 0.00038211630203371883 + -0.0005111546842118636i, 0.00022487175568954357 + 0.00032491792785498965i, 0.00013537039392200255 + -0.000513684739819005i }, { -0.003317669042105768 + -0.0011176585928652158i, 0.04295488036034755 + -1.3552527156068805e-20i, 0.005722723270491494 + 0.0035798345048052606i, -0.0008314890608730522 + -0.0004835854286994227i, 0.00041738966917885827 + 0.00011776549228131988i, -0.0004511235527383372 + -0.0005163187613268262i, -6.172666009724439e-05 + -0.0005961844405812206i, -0.00010065791450512679 + 0.0006352143887833312i }, { -0.00035393615102352074 + -0.0007551671320273927i, 0.0057227232704914945 + -0.0035798345048052606i, 0.12870188076049421 + -5.421010862427522e-20i, -0.00971918442627456 + -0.0068740242191894195i, -0.00030095335852131644 + -0.0007444740851662548i, 0.0005592527948998617 + 0.0009260251727815007i, -0.0001547723442477717 + 0.0008571578453799364i, 0.000683519478632904 + -0.000510794049382161i }, { 0.005743119047807002 + -0.004583147611116488i, -0.0008314890608730522 + 0.00048358542869942283i, -0.00971918442627456 + 0.00687402421918942i, 0.13823193991406124 + 8.470329472543003e-20i, 0.0003720477809273858 + 0.0009929401737131262i, -0.0004247797109022183 + -0.0002499227232581722i, 0.0003839111945560372 + -0.001219885273895672i, 0.0006042084672653759 + 0.00051446890379051i }, { 1.6874297207322536e-06 + 0.0008553079878436219i, 0.00041738966917885827 + -0.0001177654922813199i, -0.00030095335852131644 + 0.0007444740851662549i, 0.0003720477809273858 + -0.0009929401737131262i, 0.07904385591649575 + -3.3457801416544863e-20i, -0.0033909352140782897 + 0.010121483694553046i, -0.0014071401257786586 + -0.0024182956144386814i, 0.009164696608458955 + 0.015409905728088315i }, { 0.00038211630203371883 + 0.0005111546842118635i, -0.0004511235527383373 + 0.0005163187613268263i, 0.0005592527948998617 + -0.0009260251727815007i, -0.0004247797109022184 + 0.0002499227232581722i, -0.0033909352140782893 + -0.010121483694553044i, 0.07332534527262317 + 1.0842021724855044e-19i, 0.0075814911248941646 + 0.016661868892377238i, 0.0020763834822674267 + -0.004667799483931119i }, { 0.00022487175568954357 + -0.00032491792785498965i, -6.172666009724439e-05 + 0.0005961844405812206i, -0.00015477234424777163 + -0.0008571578453799363i, 0.0003839111945560372 + 0.0012198852738956717i, -0.0014071401257786588 + 0.0024182956144386814i, 0.007581491124894164 + -0.016661868892377238i, 0.2349668068126674 + -1.0842021724855044e-19i, -0.012668202329829362 + -0.03175954585223473i }, { 0.00013537039392200257 + 0.000513684739819005i, -0.0001006579145051268 + -0.0006352143887833312i, 0.000683519478632904 + 0.0005107940493821611i, 0.0006042084672653759 + -0.00051446890379051i, 0.009164696608458953 + -0.015409905728088313i, 0.0020763834822674267 + 0.0046677994839311185i, -0.012668202329829362 + 0.03175954585223473i, 0.255744086862042 + 2.320870275476783e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.0470312041012684, 1.0e-7), DoubleNear(0.04295488036034755, 1.0e-7), DoubleNear(0.12870188076049421, 1.0e-7), DoubleNear(0.13823193991406124, 1.0e-7), DoubleNear(0.07904385591649575, 1.0e-7), DoubleNear(0.07332534527262317, 1.0e-7), DoubleNear(0.2349668068126674, 1.0e-7), DoubleNear(0.255744086862042, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true, false, false}), Matrix({ { 0.2593453185214209 + 4.0657581468206416e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.027663018353824387 + -0.002327955206080047i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23309225416259094 + 1.2726670032495863e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.024862740310083793 + -0.002092300449718426i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.024862740310083793 + 0.0020923004497184297i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2402515097832238 + -7.919758056827708e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02766301835382439 + 0.002327955206080052i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2673109175327641 + 1.3552527156068805e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2593453185214209, 1.0e-7), DoubleNear(0.23309225416259094, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2402515097832238, 1.0e-7), DoubleNear(0.2673109175327641, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, true, false}), Matrix({ { 0.12108393494946397 + -7.242131699024268e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00025940029253800686 + -0.003404030346999174i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.12127135070127092 + 1.4251329337553603e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00025678156286979795 + -0.0034104830480426564i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002594002925380074 + 0.0034040303469991743i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.37851289335518074 + 3.3881317890172014e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0002567815628697978 + 0.003410483048042657i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.37913182099408416 + 1.2027867851011065e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.12108393494946397, 1.0e-7), DoubleNear(0.12127135070127092, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.37851289335518074, 1.0e-7), DoubleNear(0.37913182099408416, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false, true}), Matrix({ { 0.17838067747539282 + -1.198551620364835e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 3.6815189600836542e-06 + 9.426832511987612e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.17853922766077862 + 1.4547790869092608e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -3.6815189600844403e-06 + -9.426832512004959e-07i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 3.6815189600836813e-06 + -9.426832511985443e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.32121615082925187 + 8.131516293641283e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -3.681518960084603e-06 + 9.426832512004959e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3218639440345764 + 1.173140631947206e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.17838067747539282, 1.0e-7), DoubleNear(0.17853922766077862, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.32121615082925187, 1.0e-7), DoubleNear(0.3218639440345764, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, true, false}), Matrix({ { 0.0627233811535422 + 1.3552527156068805e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0066903773469157365 + -0.0005630223924295411i, -8.446314846422942e-05 + -0.0017829052830667942i, 0.0 + 0.0i, 0.0 + 0.0i, -2.5013095662703974e-05 + -0.00018941508342037235i }, { 0.0 + 0.0i, 0.056621467439446044 + 6.11981304391232e-20i, 0.0060395178980972965 + -0.0005082499296807746i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00016972419147631945 + -0.0015728171522102904i, -3.222163927708283e-05 + -0.0001662407468137776i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.006039517898097297 + 0.0005082499296807754i, 0.05836055379592177 + -8.597384414631148e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -3.985556986686506e-06 + -0.00016928772924937837i, -0.00017493714407377744 + -0.0016211250639323795i, 0.0 + 0.0i }, { 0.0066903773469157365 + 0.0005630223924295421i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06464988326182487 + 8.131516293641283e-20i, 6.99460479879603e-06 + -0.00019093141251634544i, 0.0 + 0.0i, 0.0 + 0.0i, -8.70573713934785e-05 + -0.0018376658958323662i }, { -8.446314846422969e-05 + 0.0017829052830667942i, 0.0 + 0.0i, 0.0 + 0.0i, 6.994604798795881e-06 + 0.00019093141251634533i, 0.1966219373678787 + 2.710505431213761e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02097264100690865 + -0.001764932813650506i }, { 0.0 + 0.0i, -0.00016972419147631945 + 0.00157281715221029i, -3.985556986686533e-06 + 0.00016928772924937837i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17647078672314492 + 6.606856988583543e-20i, 0.018823222411986498 + -0.0015840505200376514i, 0.0 + 0.0i }, { 0.0 + 0.0i, -3.222163927708286e-05 + 0.0001662407468137776i, -0.0001749371440737777 + 0.00162112506393238i, 0.0 + 0.0i, 0.0 + 0.0i, 0.018823222411986498 + 0.0015840505200376543i, 0.18189095598730204 + 6.776263578034403e-21i, 0.0 + 0.0i }, { -2.5013095662704e-05 + 0.0001894150834203724i, 0.0 + 0.0i, 0.0 + 0.0i, -8.705737139347834e-05 + 0.0018376658958323667i, 0.020972641006908654 + 0.0017649328136505097i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20266103427093923 + 5.421010862427522e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.0627233811535422, 1.0e-7), DoubleNear(0.056621467439446044, 1.0e-7), DoubleNear(0.05836055379592177, 1.0e-7), DoubleNear(0.06464988326182487, 1.0e-7), DoubleNear(0.1966219373678787, 1.0e-7), DoubleNear(0.17647078672314492, 1.0e-7), DoubleNear(0.18189095598730204, 1.0e-7), DoubleNear(0.20266103427093923, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false, true}), Matrix({ { 0.09046143772657043 + -1.2197274440461925e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.009649051798622573 + -0.0008120068490369219i, -0.00011986351635150309 + -3.069204057334679e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -1.306071907422432e-05 + -2.197832557907509e-06i }, { 0.0 + 0.0i, 0.08529933400129365 + 9.952637130238029e-21i, 0.009098437000904978 + -0.0007656703803082969i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00011986351635150271 + 3.0692040573345814e-05i, 1.3060719074224234e-05 + 2.197832557907428e-06i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.009098437000904978 + 0.0007656703803082971i, 0.08791923974882238 + 2.117582368135751e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 1.250971860854945e-05 + 4.349688612224393e-06i, 0.00012354503531158674 + 3.1634723824545605e-05i, 0.0 + 0.0i }, { 0.009649051798622573 + 0.0008120068490369222i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09323989365948497 + 1.3552527156068805e-19i, -1.2509718608549494e-05 + -4.3496886122245084e-06i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00012354503531158715 + -3.163472382454631e-05i }, { -0.00011986351635150309 + 3.069204057334679e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -1.2509718608549494e-05 + 4.349688612224515e-06i, 0.16888388079485045 + 1.6263032587282567e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.018013966555201814 + -0.0015159483570431251i }, { 0.0 + 0.0i, 0.00011986351635150259 + -3.0692040573345976e-05i, 1.2509718608549451e-05 + -4.3496886122243865e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1477929201612973 + 1.173140631947206e-19i, 0.015764303309178815 + -0.0013266300694101292i, 0.0 + 0.0i }, { 0.0 + 0.0i, 1.3060719074224247e-05 + -2.197832557907428e-06i, 0.0001235450353115868 + -3.163472382454544e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.015764303309178815 + 0.0013266300694101327i, 0.15233227003440142 + -8.131516293641283e-20i, 0.0 + 0.0i }, { -1.3060719074224322e-05 + 2.197832557907509e-06i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00012354503531158717 + 3.1634723824546527e-05i, 0.018013966555201818 + 0.0015159483570431295i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1740710238732791 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.09046143772657043, 1.0e-7), DoubleNear(0.08529933400129365, 1.0e-7), DoubleNear(0.08791923974882238, 1.0e-7), DoubleNear(0.09323989365948497, 1.0e-7), DoubleNear(0.16888388079485045, 1.0e-7), DoubleNear(0.1477929201612973, 1.0e-7), DoubleNear(0.15233227003440142, 1.0e-7), DoubleNear(0.1740710238732791, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true, true}), Matrix({ { 0.04497994618451623 + -4.701032857261367e-20i, 0.0 + 0.0i, -0.0005939015905658499 + 0.00013398411183104092i, 0.0 + 0.0i, -0.00022299829349510712 + -0.0006856492614715397i, 0.0 + 0.0i, 6.224359567300243e-05 + 0.0004761187471080535i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.04500613827709972 + 4.213988912590144e-20i, 0.0 + 0.0i, -0.0005915236213307229 + 0.00013759759149692917i, 0.0 + 0.0i, -0.00022643782952249782 + -0.0006859774876989085i, 0.0 + 0.0i, 6.197024551141437e-05 + 0.0004840135695302673i }, { -0.0005939015905658499 + -0.00013398411183104087i, 0.0 + 0.0i, 0.1334007312908766 + -7.284483346386983e-20i, 0.0 + 0.0i, -0.0003603608136293075 + -0.0004931013817204801i, 0.0 + 0.0i, 0.00022667981245519077 + 0.0006865919447227385i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.000591523621330723 + -0.00013759759149692898i, 0.0 + 0.0i, 0.13353308938367892 + 1.0333801956502464e-19i, 0.0 + 0.0i, -0.00036537225579422736 + -0.0005012954267039468i, 0.0 + 0.0i, 0.00022275631056241338 + 0.000685034804447708i }, { -0.0002229982934951072 + 0.0006856492614715397i, 0.0 + 0.0i, -0.0003603608136293075 + 0.0004931013817204801i, 0.0 + 0.0i, 0.07610398876494774 + -2.541098841762901e-20i, 0.0 + 0.0i, 0.00033450129802784303 + -0.0035380144588302146i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0002264378295224979 + 0.0006859774876989085i, 0.0 + 0.0i, -0.00036537225579422736 + 0.0005012954267039468i, 0.0 + 0.0i, 0.0762652124241712 + 1.0037340424963459e-19i, 0.0 + 0.0i, 0.00033474205846092497 + -0.0035480806395395857i }, { 6.224359567300243e-05 + -0.00047611874710805347i, 0.0 + 0.0i, 0.00022667981245519088 + -0.0006865919447227383i, 0.0 + 0.0i, 0.0003345012980278425 + 0.003538014458830215i, 0.0 + 0.0i, 0.24511216206430414 + 1.0672615135404184e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 6.197024551141437e-05 + -0.0004840135695302674i, 0.0 + 0.0i, 0.0002227563105624133 + -0.000685034804447708i, 0.0 + 0.0i, 0.00033474205846092524 + 0.0035480806395395857i, 0.0 + 0.0i, 0.24559873161040524 + 1.6940658945086007e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.04497994618451623, 1.0e-7), DoubleNear(0.04500613827709972, 1.0e-7), DoubleNear(0.1334007312908766, 1.0e-7), DoubleNear(0.13353308938367892, 1.0e-7), DoubleNear(0.07610398876494774, 1.0e-7), DoubleNear(0.0762652124241712, 1.0e-7), DoubleNear(0.24511216206430414, 1.0e-7), DoubleNear(0.24559873161040524, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, true, false}), Matrix({ { 0.11934484859298825 + 7.4750657595192e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0002541873399405489 + -0.0033557224352770846i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.12301043705774664 + -4.658681209898652e-21i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.000261994515467256 + -0.0034587909597647458i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0002541873399405491 + 0.003355722435277084i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.37309272409102356 + 9.317362419797304e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.0002619945154672561 + 0.0034587909597647466i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.38455199025824127 + 6.098637220230962e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.11934484859298825, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12301043705774664, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.37309272409102356, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.38455199025824127, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false, true}), Matrix({ { 0.17576077172786408 + -1.1202010727438122e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -3.7947076036992655e-19 + -9.75781955236954e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.18115913340830736 + 1.376428539288238e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -4.0657581468206416e-19 + -7.589415207398531e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.87890977618477e-19 + 7.589415207398531e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.31667680095614775 + 2.7994438906754626e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -3.7947076036992655e-19 + 1.0842021724855044e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3264032939076806 + -8.131516293641283e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.17576077172786408, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18115913340830736, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.31667680095614775, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3264032939076806, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true, true}), Matrix({ { 0.08998608446161596 + -4.870439446712227e-21i, 0.0 + 0.0i, -0.001185425211896573 + 0.0002715817033279701i, 0.0 + 0.0i, -0.00044943612301760494 + -0.0013716267491704483i, 0.0 + 0.0i, 0.0001242138411844168 + 0.0009601323166383209i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001185425211896573 + -0.0002715817033279699i, 0.0 + 0.0i, 0.2669338206745555 + 3.049318610115481e-20i, 0.0 + 0.0i, -0.0007257330694235348 + -0.000994396808424427i, 0.0 + 0.0i, 0.00044943612301760413 + 0.0013716267491704465i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00044943612301760505 + 0.0013716267491704483i, 0.0 + 0.0i, -0.000725733069423535 + 0.000994396808424427i, 0.0 + 0.0i, 0.15236920118911895 + 7.496241583200558e-20i, 0.0 + 0.0i, 0.000669243356488768 + -0.007086095098369801i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0001242138411844168 + -0.0009601323166383209i, 0.0 + 0.0i, 0.0004494361230176042 + -0.0013716267491704463i, 0.0 + 0.0i, 0.0006692433564887677 + 0.007086095098369801i, 0.0 + 0.0i, 0.4907108936747094 + 1.2366681029912785e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.08998608446161596, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2669338206745555, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.15236920118911895, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4907108936747094, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true, true}), Matrix({ { 0.044312529007616654 + -2.5622746654442585e-20i, 0.0 + 0.0i, -0.0005837479139447789 + 0.0001337370347722152i, 0.0 + 0.0i, -0.0002213192334953024 + -0.0006754405469899577i, 0.0 + 0.0i, 6.116756244661159e-05 + 0.0004728052274608519i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0456735554539993 + 2.0752307207730358e-20i, 0.0 + 0.0i, -0.000601677297951794 + 0.0001378446685557549i, 0.0 + 0.0i, -0.00022811688952230255 + -0.0006961862021804905i, 0.0 + 0.0i, 6.30462787378052e-05 + 0.0004873270891774689i }, { -0.0005837479139447789 + -0.00013373703477221507i, 0.0 + 0.0i, 0.13144824272024744 + -8.639736061993863e-20i, 0.0 + 0.0i, -0.0003573782311234431 + -0.0004896783506252532i, 0.0 + 0.0i, 0.00022131923349530202 + 0.0006754405469899567i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.000601677297951794 + -0.0001378446685557548i, 0.0 + 0.0i, 0.13548557795430805 + 1.1689054672109345e-19i, 0.0 + 0.0i, -0.00036835483830009177 + -0.0005047184577991737i, 0.0 + 0.0i, 0.00022811688952230214 + 0.0006961862021804897i }, { -0.00022131923349530245 + 0.0006754405469899576i, 0.0 + 0.0i, -0.0003573782311234431 + 0.0004896783506252532i, 0.0 + 0.0i, 0.0750323195853716 + 1.0037340424963459e-19i, 0.0 + 0.0i, 0.00032956057400423 + -0.0034894594700492997i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0002281168895223026 + 0.0006961862021804906i, 0.0 + 0.0i, -0.0003683548383000918 + 0.0005047184577991737i, 0.0 + 0.0i, 0.07733688160374734 + -2.541098841762901e-20i, 0.0 + 0.0i, 0.000339682782484538 + -0.0035966356283205006i }, { 6.116756244661159e-05 + -0.0004728052274608519i, 0.0 + 0.0i, 0.00022131923349530196 + -0.0006754405469899568i, 0.0 + 0.0i, 0.00032956057400422984 + 0.0034894594700492993i, 0.0 + 0.0i, 0.24164448137077615 + 1.7957098481791167e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 6.30462787378052e-05 + -0.000487327089177469i, 0.0 + 0.0i, 0.00022811688952230222 + -0.0006961862021804895i, 0.0 + 0.0i, 0.0003396827824845379 + 0.0035966356283205015i, 0.0 + 0.0i, 0.24906641230393323 + -5.590417451878382e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.044312529007616654, 1.0e-7), DoubleNear(0.0456735554539993, 1.0e-7), DoubleNear(0.13144824272024744, 1.0e-7), DoubleNear(0.13548557795430805, 1.0e-7), DoubleNear(0.0750323195853716, 1.0e-7), DoubleNear(0.07733688160374734, 1.0e-7), DoubleNear(0.24164448137077615, 1.0e-7), DoubleNear(0.24906641230393323, 1.0e-7) }));


}
}

}
