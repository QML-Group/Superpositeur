#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { -0.04546192752584033 + -0.16951567864226427i, -0.012079318744057342 + -0.20312938559944618i, 0.01611684987389469 + -0.0765294953436158i, 0.026183809477270455 + 0.10828251179725407i }, { 0.20495205967347493 + -0.027859924580933594i, 0.11287778371546661 + -0.10555348307042296i, 0.21835055103136092 + -0.035886648363240646i, -0.03511215835860988 + 0.10646650719629033i }, { 0.04253023941591634 + 0.038002438999461124i, 0.149112777396565 + -0.09421998770886973i, -0.10715139191640914 + 0.10001525948351866i, 0.005132771488428925 + -0.06475402761692849i }, { -0.008133826901966807 + -0.0930470669677274i, -0.006863379836166285 + 0.0298235980091656i, -0.10102813464975768 + 0.01948499861121249i, -0.0009642434335747602 + 0.05167672591670038i } }), Matrix({ { 0.013388685613103066 + 0.14111749827691228i, 0.10124223569046105 + -0.03660565404101184i, 0.12711589547226718 + 0.00691722601678556i, 0.11266686004237182 + 0.07083709426341511i }, { -0.060128216789001425 + 0.009891209923149801i, -0.0954943480334176 + -0.025985816892793893i, -0.031133140557593836 + 0.1044967423877279i, 0.09993950322920017 + -0.04815169416570226i }, { 0.019846541264093066 + 0.054362649625249344i, -0.03900939506661507 + 0.0883470212536144i, -0.05344605435763492 + 0.03573783103514069i, -0.031799386111660305 + -0.1807629912494778i }, { -0.05616683140084759 + -0.06739944621286399i, 0.16975195398351894 + -0.0070779599675313i, 0.1511468173027085 + 0.05101564275546664i, 0.08352796676595826 + -0.07214085311810016i } }), Matrix({ { 0.1285403974090989 + -0.10438226611447547i, -0.07865065388697134 + 0.08349577662000494i, -0.03832783470006968 + 0.20572342335170188i, 0.04946442131575778 + -0.11551916621454626i }, { -0.0771325150945243 + -0.07204149703362742i, 0.04939115678972839 + 0.10392566347742747i, -0.017560806213452074 + -0.10590086912734788i, -0.016995031745066804 + -0.07704117728744164i }, { -0.21146156045380463 + -0.12925747052090097i, 0.06351277442864282 + -0.041775092411647285i, -0.08392136456732024 + 0.07637276516721254i, 0.03339122789465822 + 0.009302731645293003i }, { -0.00479751124178868 + 0.14821389300199048i, 0.035479382996342186 + -0.004899232484237368i, 0.026438912649933866 + -0.12714234592947443i, 0.04290759399349135 + -0.14735833565822637i } }), Matrix({ { 0.017828520160841722 + -0.043106934534034115i, 0.08072712350479859 + 0.06821964319454794i, -0.12224821996973785 + -0.07565854788593958i, 0.019779174627630167 + -0.014907131470486477i }, { -0.03545690159991671 + -0.05485925091552951i, -0.09012289994786286 + 0.048961318560519926i, 0.14566414473743275 + -0.14912766390114215i, -0.028434582027564485 + -0.024895116277015145i }, { -0.022885434969520398 + -0.040860046605459464i, -0.1098253069100909 + -0.10656424776971915i, 0.038127507125500136 + 0.002826855408207834i, 0.007014618751219018 + -0.08433768057421688i }, { 0.016583943605220378 + -0.14908784099484754i, 0.1283071812311622 + 0.019170190695618133i, 0.0608053244183115 + 0.12700640640714045i, -0.16400803698465977 + -0.05595946081449362i } }), Matrix({ { 0.017590562855064593 + -0.1094408710125903i, 0.043844003821373156 + -0.051578802065632194i, -0.11661394275670563 + 0.0509882060806577i, -0.16478613823639182 + 0.06527868107570431i }, { 0.03564687551560088 + 0.0754762886298837i, -0.12386368080821121 + -0.05530878319946409i, -0.04287134971785686 + -0.07715972531776993i, 0.013563401156949125 + 0.04074848772945191i }, { -0.0979678358755835 + -0.043474450737605766i, -0.0927191398547794 + -0.030812339110977045i, -0.029831835815307232 + 0.08070300338847335i, -0.1385128184862713 + 0.0420704047729845i }, { 0.044630096045016776 + -0.042857345433910045i, 0.026953006044523276 + 0.02936035251624167i, -0.06829096383401485 + -0.08217414124007151i, 0.017418793218728638 + -0.0010735021206350651i } }), Matrix({ { 0.052709068418911265 + 0.12138680887055825i, 0.03918104261340591 + -0.03766524649544634i, -0.04525745778607364 + -0.12474232967200305i, -0.032676283288415924 + -0.04556053090002424i }, { -0.015432821901259514 + 0.02225681105688667i, 0.009503078129096244 + -0.02527960252300239i, 0.09805361835046877 + -0.08141227059199942i, -0.02647708279189273 + -0.08161194788251841i }, { -0.001333287539453827 + -0.03534434688998121i, 0.06220054012498909 + -0.06107608087184591i, 0.008349419804726858 + 0.12156377460474048i, -0.0007018786963051418 + -0.14106414642706636i }, { 0.023519360911386726 + 0.04070255769797507i, -0.16365618370433024 + -0.03651731323668375i, -0.0018685496723606458 + 0.04928560191972543i, -0.05850265799141806 + 0.14114391904230358i } }), Matrix({ { -0.058636571026338714 + 0.10525246794954925i, -0.10785874655674368 + -0.006064928381642462i, -0.06938796824455075 + 0.06859416325955589i, 0.08617871058150817 + -0.008470570986344137i }, { -0.03987608771715288 + -0.057232717875945055i, -0.12485844997650691 + 0.08197240121518343i, -0.015495345555824063 + -0.007735347302479043i, 0.028029189361652232 + -0.03181315352743777i }, { 0.03392485957343509 + 0.018842536503226072i, -0.1192358479368728 + 0.029588574590604936i, 0.1160595214696553 + 0.173768926340717i, -0.04288104417366677 + 0.05117860830567017i }, { -0.173888936501234 + 0.024309199193862263i, -0.05789844589692212 + 0.13679657548580865i, -0.05455808431203516 + 0.0009303419083292538i, -0.11522953026456394 + 0.13964288313780499i } }), Matrix({ { -0.2657329776013825 + 0.04564411936940894i, 0.0052198579107081665 + 0.011552330422190664i, 0.06960438833591233 + 0.06726212538619485i, -0.06659012954265406 + 0.0054677142440059i }, { 0.1873583923796512 + 0.1256126664661242i, -0.054686241265567134 + 0.11650764350335277i, 0.1462245350726306 + -0.004361078582010719i, -0.056265940430636124 + -0.0354975101306488i }, { 0.03432543078816591 + -0.0858700564660709i, -0.11048458789849012 + 0.016034698824539662i, 0.20189741921436247 + 0.041764877380387484i, 0.019271224635647042 + 0.0534275760228959i }, { 0.06246706215642124 + 0.1659719238393565i, 0.0755909058214366 + -0.08209058148666296i, -0.033009175332287824 + -0.031368053381194624i, 0.09363521061411553 + 0.058345345253303524i } }), Matrix({ { 0.11693170850920762 + 0.10155981913255434i, -0.11903766909104772 + -0.08007067734473668i, -0.008295859826008077 + -0.1780568683945411i, 0.12527659933660926 + -0.06646269977758451i }, { -0.11852586370730038 + -0.09914493942850174i, -0.07780966632090396 + 0.018635763694067636i, -0.03920293481160557 + 0.05290728882982873i, 0.09060782890804804 + -0.04593131965629771i }, { -0.036650960820123715 + 0.020972505426522767i, -0.14864265247650899 + -0.02926222824166444i, 0.03946473426455397 + 0.09467723447440834i, -0.07936535690954859 + -0.13881465318303277i }, { 6.740547250815108e-05 + -0.04237137195262137i, 0.10823863605913298 + 0.19859946030992992i, 0.024632616707962747 + 0.06699525817578812i, 0.07039094137891069 + -0.06223526980945191i } }), Matrix({ { 0.0666993763584195 + -0.05720323277621821i, -0.003936567572124093 + -0.056788929430468475i, 0.03833098702059985 + 0.22856632866427473i, -0.1427045806898928 + 0.2300331528963924i }, { -0.0231007670707365 + 0.028007389930333883i, -0.051799741914455515 + -0.00699800145851849i, -0.06236946206282478 + 0.08133680037989693i, -0.10813784883255485 + -0.068480491248592i }, { -0.06739713539396935 + -0.10067710108911311i, -0.05073287128235085 + 0.20796993014602175i, -0.040687637116486715 + 0.00801068772598681i, 0.05319040472381066 + -0.04726870763066408i }, { 0.019050697511233596 + -0.015060274158897038i, -0.00020285223504934945 + 0.030947398310928843i, 0.11829556341556298 + -0.00997309484968982i, -0.13777968789249942 + 0.08185284327315318i } }), Matrix({ { -0.0693334997510632 + 0.09481810696871247i, -0.013659309896106376 + -0.06036936142903929i, 0.09774451928504496 + 0.012592848797739805i, -0.12180380844043358 + -0.13873710805480002i }, { -0.1103924550486233 + 0.04308374081065865i, 0.1392270746060495 + -0.038298530057390756i, -0.11199139507029444 + -0.0008690419032583813i, -0.040756037268246975 + 0.06360800511347126i }, { 0.059417699886521264 + 0.05262395802277667i, 0.0035747856048915353 + 0.11013040021803565i, -0.0684479059709065 + 0.017304246678990495i, 0.019179279496094458 + 0.0499671418171278i }, { 0.07367956624184152 + -0.03660163878659167i, 0.011923459892965177 + -0.038664492508022674i, -0.007811721147551228 + 0.030506828540598857i, 0.1261567024591205 + 0.028020470954510716i } }), Matrix({ { 0.002685249780779381 + -0.04025770041240849i, -0.017796858501267557 + -0.03801345766622237i, -0.0036267808860518834 + -0.037618281153814555i, -0.15029973681161496 + -0.11845902926447335i }, { -0.04181399885278367 + 0.06574503787659638i, -0.0009601162459205962 + -0.046528920013462094i, 0.08029197115860626 + -0.1465725051390427i, -0.055464638984326305 + -0.19754790673455902i }, { -0.057543611874328805 + -0.21652847527266422i, 0.0402190672872449 + 0.021416112189240628i, 0.12758921483448965 + 0.04325197391831331i, -0.041349166264355044 + -0.024154960374623002i }, { -0.023760156403240727 + 0.09235343394097002i, -0.03375041679402156 + 0.09043302996173554i, -0.09716217558189438 + -0.01985492206085725i, 0.018078815808770358 + 0.015129937806043487i } }), Matrix({ { -0.054813683252814875 + 0.021513672707628415i, 0.05183932251930155 + 0.2065334861313837i, -0.018035456187969336 + 0.07615944140522343i, 0.15044011593707074 + 0.15239403307873778i }, { -0.002952614217773305 + -0.004702539689964144i, 0.008581213220240783 + 0.1815004782543616i, 0.02399151321635041 + -0.2980636160499224i, -0.0727001151654428 + 0.028540362031681834i }, { -0.1372561379797991 + -0.07236244332530667i, -0.0572977474515418 + -0.1594047212011358i, -6.823007589385618e-05 + 0.04437721001856597i, 0.05979459763653511 + 0.0003251214453383939i }, { 0.02748907652834809 + -0.021653346734703507i, 0.043758343719356114 + 0.07525502650482517i, -0.029456395249901558 + -0.036670002114250984i, 0.06593655575404721 + 0.09603533744669687i } }), Matrix({ { -0.1825594988296873 + -0.12349894241315335i, -0.020587031691134912 + -0.047747837036138684i, -0.005403678369433061 + -0.007659671147266842i, 0.028328003972487834 + 0.09948980993266568i }, { 0.04578148448747364 + -0.014504232328086302i, -0.020179926546359167 + 0.16290691695666862i, -0.04185704774605312 + -0.13111709083685857i, -0.1552345500455538 + -0.03174524295920488i }, { -0.11500088441501696 + -0.0030209309159052473i, -0.05621353873589427 + -0.07504832066745258i, -0.04822773655356419 + -0.05925131844672i, 0.02067275709136832 + -0.02934766628911732i }, { 0.18238697059570474 + 0.0439050980448124i, -0.16711431135514532 + -0.22728341847228936i, -0.03867143736856682 + -0.007932851701402108i, 0.08147056879752695 + 0.0012097507219048966i } }), Matrix({ { -0.07672715371763303 + 0.04650713366386957i, 0.07226443820768354 + 0.12910181031104775i, -0.028405066850039566 + 0.037588923464859314i, -0.18584754571721818 + 0.07723099487217573i }, { -0.030777256099093625 + -0.03921947570656117i, -0.053197835082725596 + 0.07325177548541435i, 0.03352996541145511 + 0.09224531150003568i, 0.0020347031462462158 + -0.06387250908644806i }, { 0.19754718584994863 + 0.08860010588059511i, 0.0007929850150656268 + -0.0765106414968409i, -0.09421035722289757 + 0.019713136048851002i, -0.07844187074760439 + 0.11170001600137737i }, { 0.12670400271302876 + 0.00943348856803042i, -0.06097474924826326 + 0.14585935298625288i, 0.028641529355215006 + -0.10518093926660023i, 0.01457914583353437 + 0.18613725917849716i } }), Matrix({ { -0.037105078096273364 + 0.13071998927730924i, 0.012007916313918105 + 0.03576534998024584i, -0.02172132956161423 + 0.06883034899676424i, 0.011894551077835155 + -0.03674336794519084i }, { -0.05950518349356757 + -0.047826715625630914i, 0.011061467318030375 + -0.09879443156426124i, 0.006128205258416674 + -0.19036583349787528i, -0.0283555959680497 + 0.10879254131151424i }, { 0.2072794211443406 + -0.046141975203728584i, 0.1360918242581454 + 0.04989737687551217i, 0.19865835419271838 + 0.019720559414616326i, 0.08063636938747754 + -0.027641058554616547i }, { -0.011762660145526415 + 0.008050853455645355i, -0.007660401997043715 + 0.1667186898353792i, 0.005609906097260871 + -0.03306572661608497i, 0.2598935954798749 + -0.03356443877113331i } }) }, { QubitIndex{ 8 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.05596956428978128 + -0.09688119787022163i, 0.021124110297611604 + -0.0018348412003273587i, -0.0948046740298801 + -0.10026657412855773i, -0.06047300756133549 + 0.02846824719567896i }, { 0.0814980112228923 + -0.05857715467898673i, -0.02528580475232626 + 0.005985857137602454i, 0.10030324719352268 + 0.062613731727647i, 0.09080055433792843 + -0.03999911130683186i }, { -0.003405096702283226 + -0.19404908950839891i, -0.16178719519214455 + -0.04423262550694013i, 0.00655689901681874 + -0.01124115257119198i, 0.07847026425954154 + 0.011494220690307498i }, { -0.0504686508627718 + -0.02817761286182804i, -0.058038934014283346 + -0.1324806147094652i, 0.03397283812068809 + -0.04697783569393492i, -0.06907966625915946 + -0.03161526752773872i } }), Matrix({ { -0.13483454568604378 + 0.043312199572521394i, 0.010302369512671774 + 0.00559680706336666i, -0.08784530386512616 + -0.01676931390738324i, -0.09943116536921619 + -0.14399505678474248i }, { -0.05810701797753723 + 0.11011678529300288i, 0.04361867368372723 + 0.03200456395012561i, 0.06874865891478582 + 0.016965051982788203i, -0.1467252202473106 + 0.07410330579693451i }, { -0.01668254344092148 + -0.08123705689181357i, 0.20433882750866195 + 0.05708501305539921i, -0.06290739732177036 + 0.0411644841476579i, 0.13095970589043088 + 0.002587012604606957i }, { 0.02487283898349413 + 0.01505103171704862i, 0.15308613996691461 + 0.07947072423819629i, -0.08275613956454758 + 0.08545758097715025i, 0.01682605692750564 + 0.1554095872851252i } }), Matrix({ { -0.001039636195107948 + 0.04405637457962305i, 0.022163007510658007 + -0.15924632288841659i, -0.08680030125578378 + 0.02238016088539061i, -0.007379333761948554 + -0.03799495983116139i }, { -0.030746464749000422 + 0.012066085404030244i, 0.15476319550121886 + 0.010833215980235147i, 0.014562186827695514 + 0.02678817454592509i, 0.01202029216821928 + -0.0869389818728058i }, { 0.006966286939012868 + -0.029220420328957802i, 0.03455943107552006 + 0.09995452353661342i, 0.045225880510604534 + 0.14956500263729613i, 0.08941472248919433 + -0.05784543949962674i }, { 0.13744558344741778 + 0.018787799138440774i, -0.04265869868150137 + -0.11611880503706766i, 0.03551850937777353 + -0.06379999917054119i, 0.08538745935035667 + 0.032053058487587806i } }), Matrix({ { -0.10092740117429261 + 0.0925927890365935i, -0.050933336576589786 + 0.04261903571223957i, 0.07823635910427275 + -0.08673424662552884i, -0.1573797156823958 + 0.16369786052281288i }, { 0.03890277779970282 + 0.06471190725064349i, -0.08557161803513971 + 0.07088142593292697i, -0.027124972254067074 + 0.07249380303359873i, -0.039752910280498065 + 0.03407870044710065i }, { 0.17033607479503754 + -0.10843217285433543i, -0.00960063857186701 + 0.044064948061001794i, -0.03149983321982847 + -0.04682586140612935i, -0.038952875323471615 + 0.026204448880114292i }, { 0.16250885447485494 + -0.09120164277335457i, -0.045072137574777064 + -0.0808722600125335i, -0.0021298017246544508 + 0.18123279341150617i, -0.08250319054621418 + -0.16836612488512492i } }), Matrix({ { 0.1503778078539146 + -0.029484245460074825i, -0.017310954833409782 + -0.007461626220405853i, -0.08207509778113849 + -0.1015815718695864i, 0.1112676360038194 + 0.013627362404576276i }, { -0.06579759926682362 + -0.027184636800965035i, -0.04899528750976635 + -0.09003865112928834i, 0.05067273061257478 + -0.08835379434692187i, 0.018888961113243705 + 0.06574137952510521i }, { -0.015217514734813089 + -0.03712107323891801i, -0.08168506097709491 + -0.00804978417071193i, -0.04777811763922197 + -0.015413299524105242i, -0.10696883119679562 + 0.004504725100058236i }, { 0.15122488770278777 + -0.05585868908490895i, -0.02192982178912885 + -0.13384186888676872i, 0.020254647203856557 + 0.1468387682899786i, 0.01784722298659242 + 0.0721478503846442i } }), Matrix({ { 0.030947721958799516 + -0.08965935093409126i, -0.04323987645230863 + -0.0335058581747297i, 0.13780362344284172 + 0.10751874763282765i, 0.10030179508296298 + -0.031067742250549882i }, { 0.030444519901333556 + -0.016796955403076592i, 0.11955442950453897 + -0.17116681063507563i, 0.11772249306318015 + -0.1387331257266213i, -0.193886175548759 + 0.11184005001135745i }, { 0.12209124433922149 + 0.10684359740660505i, -0.04948647277990681 + 0.04900934585033218i, -0.08995597793959843 + -0.14568193787173764i, -0.024455623592004067 + 0.0442425247508644i }, { 0.10085644233672943 + -0.029468121466875878i, -0.0479010412987751 + -0.04830463914394234i, -0.08093774041676788 + 0.1467691759011453i, -0.0529872346362207 + 0.08937104064603879i } }), Matrix({ { -0.0635192002457389 + -0.0040271941843318315i, 0.0548297833697752 + 0.01770381569267278i, 0.012583529726699447 + 0.11223712821413798i, -0.1121269484001516 + 0.0673982657316582i }, { 0.021248042842464978 + 0.0174372166902201i, 0.0601983128779732 + -0.15691339158783643i, -0.19070053252788968 + 0.012231763571359657i, -0.022809627553277634 + -0.05689565805484644i }, { -0.06064042886860553 + -0.051922578696471704i, -0.00977086053218828 + -0.009616521629593413i, 0.08935862981066588 + -0.02443486047749996i, 0.016631344552997886 + -0.015273007983397657i }, { 0.06318205716581717 + -0.10737312151269263i, 0.03386948263074592 + -0.04164073978104427i, 0.1332746973278259 + -0.06256937685451035i, 0.045386931460522556 + 0.014002259359606355i } }), Matrix({ { 0.16636563527014386 + 0.08699072852082217i, -0.032264157752230634 + 0.03172729423283094i, -0.023426598367271255 + -0.09845125242432409i, 0.13968048909525096 + -0.16740349225006423i }, { 0.14493254929236074 + 0.027287818707985564i, 0.08390685443822236 + -0.013065708551665637i, 0.03576403963675545 + 0.1585855834317782i, -0.11986792163911239 + -0.013313228595867975i }, { 0.08443421016360896 + -0.15725560513392906i, 0.13661883895093102 + -0.04121312165781956i, 0.003481430697333075 + -0.056706406618188696i, -0.17900019203382592 + 0.12700562307503668i }, { -0.05224270908785704 + 0.06749566263598937i, -0.05261915338596553 + -0.12486698327626515i, 0.1572812537443781 + 0.0014346545697081392i, -0.04380901676090782 + -0.059267796235607906i } }), Matrix({ { 0.022173746541098542 + -0.16784494817612458i, -0.044454432576859965 + 0.08836946386041789i, 0.07576335805439516 + -0.08689894351327784i, -0.025841582827736614 + -0.1381528149727755i }, { -0.07747597955762037 + 0.17387277985396307i, -0.005700781713788281 + -0.2004462441310927i, -0.08185299057929786 + -0.058214060443260156i, 0.04938008018641981 + 0.06662391922729027i }, { 0.12257431249254266 + -0.09019301514453253i, 0.04108829302748574 + 0.11542297087500264i, -0.021775045180959702 + -0.027306991938977947i, 0.07582105609584125 + -0.18220176518956174i }, { -0.032788584828879336 + -0.01316220027838254i, -0.24239261939484427 + -0.2143115694962333i, -0.037635131476803085 + 0.13935478456228687i, 0.04082759907420209 + -0.0536980978304457i } }), Matrix({ { 0.04691862962140107 + -0.013448096114914876i, 0.07551715923985668 + -0.01475935636620474i, 0.16255599513915422 + -0.18715456234609953i, 0.06660666976986819 + -0.0021402414212227795i }, { 0.014385100298298429 + -0.17866200998728796i, -0.1678691193071051 + 0.023194994338515136i, -0.11421565789214816 + -0.09843751300558595i, -0.1409260314360732 + 0.10556569802485774i }, { 0.03227396208684927 + 0.05725622266998301i, -0.12116190917364614 + 0.08209899327516361i, -0.14441475201816262 + -0.17623411151762833i, -0.17034532306206202 + -0.03347433671786039i }, { -0.06447875706592057 + -0.004178888322560867i, 0.013553643044882574 + -0.02147004010200014i, -0.06245053157675128 + 0.09242615448103216i, -0.004417975404375474 + 0.08687652345436703i } }), Matrix({ { 0.022710334963842067 + 0.12952754741564734i, 0.040196632437130744 + -0.19492025608997754i, -0.06776018139162106 + 0.05950696255459517i, -0.07026035653260163 + -0.016499831417235326i }, { 0.030575307035081007 + -0.06049956017974913i, -0.26685161848760836 + 0.04666127068728408i, -0.03784686681345687 + 0.04697195959823348i, 0.09806071920442316 + -0.07752743587320324i }, { -0.16057796548999478 + -0.01885888068370028i, 0.0031898275773214638 + -0.009505515508816986i, 0.051645681981029264 + 0.03594263612459484i, 0.12443830848079247 + -0.10558023969058636i }, { -0.2570193255349191 + -0.056399098193636i, -0.10766234805690429 + 0.014594453508284836i, -0.20966726281744816 + -0.08405308779041723i, -0.09791580582881233 + -0.03290634202069546i } }), Matrix({ { 0.047758661814828435 + 0.10587119516409434i, -0.09554717069043898 + 0.08902861224319474i, 0.04274102630475644 + 0.056745275942938864i, 0.033594248671238135 + -0.059190553851848224i }, { -0.08954019940265702 + -0.017080373791031937i, 0.1401410078268717 + 0.031668410063561456i, -0.04731866968642109 + -0.08564915552618944i, 0.03357656141283994 + 0.0570085492548427i }, { -0.14879385086502211 + 0.10578864886488253i, 0.013618382762869625 + -0.12428905880446596i, -0.024277802385343435 + 0.009182143495602002i, -0.06179089548255723 + -0.06614731926981686i }, { -0.008222727681524388 + -0.13592266177707207i, 0.10662931148580983 + 0.05271757621215213i, -0.15280941723738356 + 0.0899230893546683i, -0.029326345627117986 + 0.002963119182432016i } }), Matrix({ { 0.13351886306060592 + 0.0048241004669442224i, -0.0274861255797857 + -0.09189887657035524i, -0.14404754706834885 + -0.018179869591985198i, -0.010699492344242329 + -0.16001764111705294i }, { -0.058471213508469275 + 0.0742303806678331i, -0.08037283142769297 + 0.011529067032086952i, 0.09764994951267406 + -0.12180575166458626i, 0.009982405532574758 + 0.10526879084787447i }, { -0.03675530996531311 + 0.06833881196406438i, 0.07666824492515661 + -0.05392779455445368i, -0.13266825594809176 + 0.055589514420021975i, -0.04386106024374271 + -0.1857602005606858i }, { 0.059243331134714916 + 0.030533334379456517i, 0.05269123968254526 + 0.002787507496570586i, -0.08041057779288963 + -0.011113149487855915i, 0.008582970503538415 + -0.1308783869081205i } }), Matrix({ { -0.008406849541274259 + -0.02739882809665501i, -0.07134107808861975 + 0.1237381322206374i, -0.0044017498889830425 + 0.04983699141047359i, -0.057319570075309294 + -0.10797318308694773i }, { -0.0629218079503555 + -0.0021596749495826116i, 0.019447126283741126 + 0.06156206688106796i, -0.087547406049109 + -0.11310587029926131i, 0.1360921568041131 + -0.09586766477020808i }, { -0.17415339243915756 + 0.09250185437917315i, -0.16082090236756572 + 0.012627034283622877i, 0.03757278786722185 + 0.09423920154376936i, 0.04356469305796714 + -0.08205937101591465i }, { -0.05260784634409342 + -0.08625222098811823i, -0.03212245070153533 + -0.05260998779650847i, 0.04190779652654079 + -0.05249497370745879i, 0.04488513678523015 + 0.0901809375927803i } }), Matrix({ { 0.10696525711324185 + -0.09975183417384953i, 0.034573236765540194 + -0.011015464358362169i, -0.13493952433482742 + -0.06623659547878245i, -0.15815491098978032 + -0.02702142511756252i }, { 0.16240218461011516 + 0.10364815393710432i, 0.07930765961428234 + 0.10035463269348836i, 0.06744504587154809 + -0.05970833852769325i, -0.03384282150738045 + -0.009486625492363504i }, { -0.06069671078086643 + 0.04663038075386441i, 0.13252241561125272 + -0.13976639585391018i, -0.005576865754506444 + 0.014638395922422479i, 0.14268823440623318 + -0.17358168198741533i }, { -0.041231943786360935 + -0.01166981558593571i, 0.06248290599199601 + 0.023110445390895604i, 0.1111184036424486 + 0.13887108149063715i, 0.09648897587121241 + -0.049578004833304774i } }), Matrix({ { 0.010802478707847037 + -6.181275700393497e-05i, 0.002530390454926563 + -0.009108078087677702i, -0.0788637005689232 + 0.037746673113068174i, 0.048036750553022006 + -0.008719404352385612i }, { -0.15976262665886587 + 0.03495045521718583i, -0.046315236250640414 + -0.078714343704471i, 0.02808185734872603 + -0.058254859474298225i, -0.09599306063698324 + -0.12400144013212894i }, { -0.04650191011286692 + 0.11542865821689648i, -0.059796446062341496 + 0.040258300396883696i, -0.1145010897464179 + 0.00708195021206589i, 0.11659372630986645 + 0.027276357216713534i }, { -0.05413950341706152 + -0.1325435469939357i, -0.14104580742323833 + 0.016915531143437832i, -0.11641879471945324 + 0.0019037583429793675i, 0.04417617797620297 + -0.04336971081845275i } }) }, { QubitIndex{ 6 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.05730088740989281 + -0.05345906901170424i, 0.056339365057345284 + 0.015009176523776918i, -0.14212348096372826 + -0.14566256962913934i, 0.0700109527570667 + 0.036063670388082274i }, { -0.1126562683098977 + 0.0395078002501672i, -0.005497529350375167 + -0.07395267946167962i, -0.038261537999000915 + -0.05779321676040168i, -0.03765453689999639 + 0.03364929386805057i }, { -0.023828751403761908 + 0.05527643944580989i, -0.014876191909976775 + -0.10597995427077375i, 0.017520108931827347 + -0.029872261417242082i, 0.005631977031318445 + 0.12426642009962992i }, { -0.05597877649638225 + -0.1313108615046229i, 0.02290758778821978 + -0.07281170330127149i, -0.05585355244347077 + 0.18663116347765576i, 0.014004672005702299 + -0.1387570386274227i } }), Matrix({ { 0.13148795450816858 + 0.0788845700283015i, 0.07685336215050653 + 0.004878412954176515i, -0.1062514781493991 + -0.040899898079248605i, 0.01991741354285221 + -0.08400359760753266i }, { 0.17916035052283588 + 0.0626507618270066i, 0.0368661318753425 + 0.07668505119052262i, 0.07663915868915418 + -0.023572157352095773i, 0.09640416022870689 + 0.021996152750843326i }, { -0.19296767516813368 + -0.008632409832581081i, 0.010673243966182034 + -0.04200380040327751i, 0.02018036572767252 + 0.06452718716077577i, 0.0997076565790849 + 0.02388626524089052i }, { 0.05028314590906799 + 0.0050346626682721655i, 0.045979054215491734 + 0.025449611454434747i, -0.014029189157851684 + 0.0526209722899193i, -0.00795463492622567 + -0.02531565072615501i } }), Matrix({ { -0.021897496921453704 + 0.21136817063569854i, -0.12721944897133644 + -0.015244508657073441i, -0.24808728715700434 + 0.003448581190237496i, -0.05617722226594754 + 0.022838756503716678i }, { 0.018036338181793968 + -0.004390354487488848i, -0.06865663280821069 + 0.09570987022130899i, -0.005966242439218518 + -0.08307312067021157i, 0.053535898077124916 + -0.13263294871214362i }, { 0.08104716835975408 + -0.07319363311822158i, 0.0925931411465079 + -0.03278530424913586i, -0.0635603770381296 + 0.1509523977673417i, -0.059920282337319664 + 0.05371270735873177i }, { 0.15899951890277453 + -0.03388169550454459i, -0.07367985683099174 + -0.06951900088898462i, -0.0029422826024242356 + -0.02062041665453084i, -0.06508330486170306 + -0.03838921829550317i } }), Matrix({ { -0.028504440965320767 + -0.08130422509313101i, -0.1081946102806481 + 0.14992091435676996i, -0.01814737257676755 + -0.032800246927782065i, -0.0802101514367583 + 0.10662920039682772i }, { 0.01569901906323218 + 0.013642260668000296i, 0.012461412794707602 + -0.08900809991331875i, -0.022998899177530636 + 0.006891005836485759i, 0.07048785050854094 + 0.2032870676805739i }, { 0.017947078781580042 + -0.022105666570748916i, -0.10806393752206181 + -0.06305695890145421i, -0.014022588856259535 + 0.07443072867944421i, 0.2289365476615977 + 0.08901854780557339i }, { -0.20714540814425642 + -0.07935650269109584i, -0.10635263840385126 + -0.013705783889373298i, 0.04425137680700488 + -0.12906117035595244i, -0.03207718145387484 + -0.015581377801508083i } }), Matrix({ { -0.09949942829992493 + -0.09034552965494201i, -0.055927833722582886 + -0.12064875731384622i, -0.008403265261288491 + 0.16765777483426256i, -0.16842769024477505 + -0.18693589711135053i }, { 0.09428562215140705 + -0.0019429119469533437i, -0.09984422087848402 + 0.013377202654273114i, 0.05153854575792528 + -0.01796051451890321i, -0.08810084657296709 + -0.0012097492559096012i }, { -0.15957548418812995 + -0.0447956500165189i, -0.0572349095327922 + 0.08259201102477381i, -0.02445832521185309 + 0.07331790724704407i, -0.005281819332379749 + -0.15746832930094312i }, { 0.04664234357475949 + 0.06495857723377607i, 0.13311653148115168 + 0.0775439656033996i, 0.01870556380439833 + -0.05702795687435628i, 0.04847599516372008 + -0.0997804770064786i } }), Matrix({ { -0.04135313243736413 + -0.07842175462322803i, 0.06664900446959175 + -0.010004074513239638i, -0.02950314177736447 + 0.1039531195243806i, 0.08269802581108619 + 0.042970151424559073i }, { -0.10528093837962563 + -0.13187739369839085i, -0.014290894577900727 + 0.09515188902866749i, 0.0027406938247566785 + -0.04956627578866217i, 0.04111654991386403 + -0.19528697110517518i }, { -0.030658712952186477 + -0.11855726440658683i, 0.047452252732227376 + 0.013028882817207573i, 0.03491624430271516 + -0.029493695719979153i, -0.0710689647378703 + -0.015691709640889853i }, { -0.03766913617700851 + -0.06974433465974544i, 0.1870036567997412 + -0.16367758192672208i, 0.06998304391679372 + -0.09588099144160757i, -0.0433147713873543 + 0.1224876684430369i } }), Matrix({ { -0.09001586172169082 + -0.06496101137723746i, 0.08143704326612959 + 0.10487268536985149i, -0.05212564662100724 + -0.07477130607136541i, -0.049320916106088776 + 0.06686719387765702i }, { 0.043890110130537514 + -0.016880350581439014i, -0.003596729958091576 + -0.046484357310041864i, 0.08264996367224424 + -0.05113991556808822i, 0.22446510434114952 + 0.1282794827804189i }, { 0.011850033671613386 + 0.12084667012084804i, -0.08797321636725107 + -0.19767583586812895i, -0.05815065991448853 + 0.08561330755752009i, 0.10488725467580752 + -0.19728513416743274i }, { 0.0738291813314549 + 0.13586576003381656i, 0.1590825358503827 + -0.032428912381756214i, -0.004512696139113052 + 0.16938082251871453i, 0.0334072822295877 + -0.05375895589388282i } }), Matrix({ { 0.055827415284122606 + -0.00999795891852662i, 0.0975999696070979 + 0.001461567270400306i, 0.1739573875710849 + 0.018113603650089797i, -0.013659855411390457 + -0.010548498081025195i }, { 0.0006527821383379966 + -0.14038370984795i, -0.08211370410114016 + 0.11779353489393471i, 0.060660469444724315 + -0.02336705249227656i, -0.011200502690030322 + 0.1946931899234875i }, { -0.09488322563132777 + 0.013668351673252279i, -0.009082341963581085 + 0.03898820663407163i, -0.12573561071683062 + 0.037398994362222236i, 0.0953701365644809 + -0.07733859456437463i }, { -0.14906376041896133 + -0.02417532706627182i, -0.020153915124415903 + 0.07249444179284378i, -0.1406165002513056 + 0.0026742245087408418i, -0.06049855399396475 + 0.04901553005727436i } }), Matrix({ { -0.024867079887628225 + -0.033997756691639874i, 0.09090823634776196 + -0.0424952313052358i, 0.06794905738674448 + 0.06998679918922047i, -0.08635922303877806 + 0.09888007580000235i }, { -0.011830792127406741 + -0.09431070873817961i, -0.12553202197918042 + 0.021135673155566324i, -0.0047812392444293765 + 0.05818462956007117i, 0.04502778022443923 + 0.08072895553168116i }, { -0.09007752793226971 + 0.11802710661132546i, 0.09689700747182091 + -0.006456570887012399i, -0.02036815741016023 + -0.03170235983492944i, -0.07251074382845954 + 0.03362817165981356i }, { 0.041581344276287235 + -0.10393576405896453i, 0.021150104797452947 + -0.17012308933365275i, 0.0511309470664986 + 0.056470785530894865i, 0.09877119531399703 + 0.003438346456368171i } }), Matrix({ { 0.002673379951878902 + 0.06321611100987869i, 0.11110614694253847 + 0.06780009844655245i, -0.12169091532543004 + -0.13504125263315325i, -0.07251398415502393 + -0.0873872867221984i }, { -0.08722115765700555 + 0.15257861991045185i, -0.08085862815655638 + -0.06593938342808828i, -0.028937289775495794 + -0.0683166205060166i, 0.031865574042008925 + 0.09325156789945417i }, { 0.09368385948974424 + 0.026207576288794658i, 0.0709939328111612 + 0.020810447303700474i, -0.10636513882267391 + 0.10101320935599252i, -0.1192617455098738 + -0.052445992567657626i }, { 0.11481843739527195 + 0.09074193437311384i, -0.06913568286986015 + 0.20294816550370331i, -0.09825355070493642 + 0.1456627622136684i, 0.018610628043868125 + -0.005704241433841428i } }), Matrix({ { -0.03129680998979812 + -0.005163882533579841i, -0.0703056093765314 + -0.023110824562410818i, -0.06180224124887189 + -0.0422454443034477i, 0.12451684774106074 + 0.07514297703666052i }, { 0.019226078018479198 + -0.00199671094730733i, 0.10677688474500285 + -0.21534532773227233i, -0.013304230555372408 + 0.05340274480556009i, -0.10657855455761102 + 0.06011952644777989i }, { 0.04480745368500706 + 0.24435689993755622i, -0.03677683533662068 + -0.10231069681781553i, 0.036032250911798555 + 0.035664247391008944i, 0.06549000524906412 + 0.02583697333056869i }, { 0.05917801701162782 + 0.1010633113534921i, 0.09826186959190143 + 0.03934208526947669i, 0.11395272463346233 + 0.102029387526371i, 0.006662777347047129 + 0.0077202073082819934i } }), Matrix({ { 0.12977179267351424 + 0.021532848292239542i, 0.04725381709476007 + -0.0856165003496809i, 0.02015437414212274 + 0.02988186143836266i, 0.12025176286158185 + -0.08519185635629996i }, { -0.06324400775151313 + -0.054791908716731376i, 0.1607387429291443 + -0.025152556682869046i, 0.03422463110590484 + -0.06098734105760182i, 0.08811763126424374 + 0.004357542785934955i }, { -0.12004617294599182 + -0.023220891881457206i, -0.13199486633013727 + 0.07239432940636603i, 0.03158895507624768 + 0.07174175373761181i, 0.060995590299740374 + 0.14377913336929984i }, { -0.05461698756696082 + 0.13050008184732698i, 0.06796310032688051 + -0.08329960068779033i, -0.036097087363778826 + 0.024655104898229932i, 0.017757955332592546 + -0.02978387993670704i } }), Matrix({ { 0.060612847664952535 + -0.1181019411335359i, 0.03786966730668178 + 0.0493473431030907i, 0.017297346943322602 + -0.06415250977992962i, 0.14400287838543135 + -0.05272167797433109i }, { -0.07307707522203388 + 0.010944406096239713i, -0.05240444644115289 + 0.06864397392193884i, 0.025156525081967883 + 0.10207964580685022i, -0.00627227823337377 + 0.1746045354205779i }, { -0.007377751564203519 + 0.12438662820068748i, -0.018965860164769432 + 0.044662565545495254i, 0.04235566924904899 + -0.061807402636473836i, -0.13551174020569484 + 0.045769281515872874i }, { 0.0787229673313749 + 0.12932524280269492i, -0.030420091484757023 + 0.04427781196508831i, 0.19435477372423343 + 0.027640923300567718i, 0.06877643332413073 + -0.04920768769327657i } }), Matrix({ { 0.056129039505315725 + -0.09491995729854716i, 0.2557478511870909 + -0.020762835012423493i, -0.031760179787070186 + 0.11101692938283354i, 0.07259582489512653 + 0.04596571076664689i }, { -0.18443857161739421 + 0.19752035126575593i, -0.0015721152389597732 + -0.1772694555145703i, -0.02146963066588243 + 0.00920660665739294i, -0.07629903762889992 + -0.0760088482673067i }, { -0.04319929689585771 + -0.08343261978042156i, -0.005335399785271002 + 0.016995485780313423i, -0.11683555639988075 + 0.016175730813712975i, 0.05133468712206265 + 0.03910266381325976i }, { 0.03326017382320975 + 0.05135574076605038i, 0.10826308185688292 + -0.1382217461997672i, -0.07281640246784349 + -0.09805968167518697i, 0.049086593687060184 + -0.03596266501344621i } }), Matrix({ { 0.011213321304859063 + -0.11089741712688962i, -0.15823735827866198 + -0.009733513760755588i, -0.047502659502853664 + 0.319825953525632i, 0.08134337666183898 + 0.048452653173125595i }, { -0.024461895046990652 + 0.007298802034397114i, -0.06881922558104145 + -0.04257201565811854i, 0.08508651595668475 + 0.03791604442128108i, -0.09121158470928004 + 0.09488706018571487i }, { 0.10530247353040312 + -0.20822541597334857i, -0.13771072104354928 + 0.026238500628002925i, -0.22384358629247694 + -0.12929792994664047i, -0.07570186692269967 + 0.037918651974301824i }, { 0.050768745998757386 + 0.0016287613887697497i, -0.11806543397134613 + -0.03528662378539984i, -0.09821071348819047 + -0.08653779029290637i, -0.05774396465555292 + 0.016407138918418506i } }), Matrix({ { -0.020925330456822117 + -0.02195263498341198i, -0.10704424841753027 + -0.022035289989868853i, 0.038786182448179836 + -0.012136641878681836i, -0.16349074055948393 + -0.08555619317148193i }, { -0.05835922493298814 + -0.0032371335734380485i, -0.021910089130629803 + -0.07492442734708382i, 0.15331166493177073 + 0.09290666020212272i, 0.012379952079210768 + 0.0729111669405254i }, { -0.0570544902063852 + -0.045891966846015854i, -0.10822973370616247 + -0.08039864371199705i, 0.15320890541247525 + 0.004227163173622215i, 0.10821738688729758 + -0.01570458754994523i }, { -0.0120690752229292 + 0.0381430622726796i, -0.038387330197974086 + 0.12762365419337782i, 0.10581435868659643 + 0.1940718562432441i, -0.032149138254233295 + -0.15351586093687597i } }) }, { QubitIndex{ 4 }, QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.4353094897355527 + 0.48231500269153527i, 0.14987745589488283 + 0.26954913804483377i }, { 0.575000374607155 + -0.16605644757758775i, -0.15765746994915536 + 0.23994164856894679i } }), Matrix({ { -0.03058313449056843 + -0.025387585099269232i, -0.08944872315797837 + -0.0666239147921257i }, { 0.1778410785432677 + 0.030099779817326103i, 0.036375348583078504 + 0.2699898994468634i } }), Matrix({ { 0.049076562525649944 + -0.3403542993327484i, 0.22823681102545504 + -0.1128763871877024i }, { -0.07247009703083895 + 0.11724133261352679i, 0.07815610704924364 + -0.34210536782727574i } }), Matrix({ { 0.1358346955531304 + 0.007840346848739618i, 0.17079736226629666 + -0.673611839593157i }, { -0.054474242046106576 + -0.1638213248877026i, 0.15348912941031093 + -0.20330632862515718i } }) }, { QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.1121356048502884 + 0.03422200206044795i, 0.2235212222008719 + 0.18602023787663494i }, { -0.642428309868067 + 0.4703567289860919i, 0.2570718137608504 + -0.15290860078172075i } }), Matrix({ { -0.021090388421397658 + 0.23626673998652298i, -0.1327617258561958 + 0.4009446984364471i }, { -0.01732063455688377 + -0.1374100408967426i, -0.16095023038110046 + -0.4844450950721257i } }), Matrix({ { 0.09483061605706872 + 0.17191296741319373i, -0.08133844678022652 + 0.3539741472787224i }, { 0.31461477401061005 + -0.22888943895164726i, 0.03445407850440721 + 0.1871068058546858i } }), Matrix({ { -0.15682473317820106 + 0.0864147809317651i, -0.0972230853780367 + -0.056620729052624344i }, { 0.23299761216278905 + -0.024236961024326913i, 0.20406247419717444 + -0.4056895537152202i } }) }, { QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.06444898711337066 + -0.08169599398892792i, 0.09944965653216557 + -0.008721542365857845i, 0.07876360805487792 + -0.1257507638708259i, -0.003888731826184589 + -0.13149500456134455i }, { 0.03653166941119145 + -0.103915809619102i, 0.020841076746350204 + -0.061802103526391136i, 0.032839996614574846 + -0.012512255789214534i, -0.007377554860463678 + 0.05321637261442358i }, { 0.007124040418176268 + -0.02911853764338587i, 0.048934370733584316 + -0.16423113234612585i, 0.02564132405805155 + -0.05288952026180855i, -0.07886848756318979 + 0.007033175297116167i }, { -0.048568781317675974 + -0.025585418887641122i, -0.004605007118080448 + -0.09577548035203914i, -0.1488036503770569 + 0.051400938784624636i, -0.16374172214092855 + -0.12118625449101461i } }), Matrix({ { -0.09635431394974622 + 0.0035597636663011667i, 0.073016975596139 + 0.007657609008498216i, -0.09180832820746285 + -0.16263751028040074i, 0.02123788370798935 + 0.05499572906273593i }, { 0.09378150190736015 + -0.05795437083477849i, -0.04538449360626861 + -0.006544340991123763i, -0.11434535383365409 + -0.1027162536625555i, -0.08681918350007792 + 0.06344981314054773i }, { -0.03765521281010887 + -0.05624076838149205i, 0.04724651378559454 + 0.043109318865727234i, -0.07017419095181329 + -0.013043721952245103i, 0.034799489724724776 + -0.10904878554191749i }, { 0.017498811060247223 + 0.051032990116659446i, -0.10301166483774898 + -0.08408594535660184i, -0.09105504464981533 + 0.05506138350701628i, 0.13280233214676548 + 0.03150572678209959i } }), Matrix({ { -0.04180325196451021 + 0.03431066205119395i, -0.003105949328293818 + 0.009148759627530137i, 0.16448041185518833 + -0.05959131458023787i, -0.21888914259596426 + -0.013064792603120838i }, { -0.11336512678939209 + 0.17894625644410975i, 0.039520133298513394 + -0.15720346746789354i, -0.07799112806024014 + -0.12149476607032966i, -0.004065135734997372 + -0.10762272525452386i }, { -0.027694886793830035 + -0.09459042056385714i, -0.10472002948368367 + 0.07487812842379216i, -0.016733077185924233 + 0.07413243093280955i, -0.01609779777477592 + -0.0037584981556386637i }, { -0.08939024749902719 + -0.09649433562780357i, 0.026881164588587386 + 0.1213886478750305i, -0.03468824880995948 + -0.005563378388422378i, 0.054281186151836226 + -0.08779139897186658i } }), Matrix({ { -0.02007536888362334 + -0.09066735835255736i, 0.017462189830096345 + 0.002316965459918126i, -0.030745479552218315 + 0.05813260725828568i, -0.07697014290159956 + 0.04670902353274646i }, { -0.04474882518424395 + 0.03959000978706862i, 0.025468416698016267 + -0.07200775420884577i, -0.02617644126614695 + -0.11121336435089989i, -0.04504528806372243 + 0.04246207162284608i }, { -0.06086283347600007 + -0.04869124512728719i, -0.012451967453318983 + -0.037638115925390576i, 0.014138591842126257 + 0.0338936044566131i, -0.026592200140912133 + 0.014245455888710644i }, { -0.041969519823845225 + 0.0008773691982141168i, 0.12533778385769168 + -0.19109377097643082i, -0.09367234469463791 + 0.004804764465984017i, -0.00015102780937779482 + 0.10818250071796987i } }), Matrix({ { -0.09655661152005994 + 0.044761380172963355i, -0.10981728859862838 + 0.0028622569067309526i, 0.05228288005164493 + 0.04450749470795299i, -0.15886623027208638 + 0.03426495190761561i }, { -0.04337613675107192 + 0.09485910532361266i, 0.03510843169620274 + 0.08980720143123848i, 0.032784095981239346 + -0.01620601056608947i, -0.01932853666358194 + 0.1302507040645035i }, { -0.10810965645344707 + -0.04123308028384076i, 0.06824517726755706 + -0.07017040860361605i, -0.0656606996168407 + 0.004321630903552785i, 0.015958379220623375 + 0.041636050361958714i }, { -0.12537419836286184 + -0.02552085412461099i, -0.021706445621428955 + 0.003526676384187486i, 0.06787825379740978 + 0.03331136808828691i, -0.017720052503708762 + 0.09423210560167951i } }), Matrix({ { 0.03889278610363219 + 0.10766137155073541i, 0.09022328636428774 + -0.09188037698569547i, 0.044748464702210076 + 0.14577389339429425i, 0.010853457037979405 + -0.1381468918795817i }, { 0.09124324481250413 + 0.10506137642015013i, 0.12237423551052604 + -0.07347640470427792i, 0.00845301544866506 + -0.0764509853365905i, 0.13815321636239494 + 0.22009008585103726i }, { -0.036204168962902954 + -0.25026928071729715i, 0.09339157808686091 + -0.059899307015138736i, -0.11012611325617849 + -0.015606275510970555i, 0.1066935622256048 + -0.16243214315172438i }, { -0.020837301039253193 + 0.0028959236815509814i, 0.015790535188957983 + -0.022176230803440382i, 0.05864130844158306 + 0.04296130075725598i, -0.016793442954963714 + -0.06375458277622177i } }), Matrix({ { -0.06396259525586792 + 0.04509109318627018i, 0.028642488632499425 + 0.08226020966652046i, 0.04832230696550027 + -0.011569271867303506i, -0.08309540608764913 + 0.018660136328245563i }, { 0.19157049485519256 + 0.022065823924112292i, -0.011831731207909589 + 0.014019332108542467i, -0.002630497228299758 + 0.05172478511971636i, -0.065013010655794 + 0.13666299083872988i }, { 0.011447362390910217 + 0.03726460015527701i, 0.05829114075750518 + 0.031472317967462575i, -0.03175418092625027 + 0.007109660882644606i, -0.05938630200022744 + -0.045641266828787275i }, { 0.18003486715387096 + -0.09784311166794499i, -0.03977787113184688 + 0.12538540683971985i, -0.05638950917858234 + 0.06513463885577081i, -0.061237447972120655 + -0.15641657318491636i } }), Matrix({ { 0.04849935213562287 + -0.11766991880365628i, -0.0032238487593847414 + -0.044750286164464956i, -0.022402048274636023 + -0.06187307235552391i, 0.051091146867901324 + 0.08386659163550057i }, { -0.0855589661563248 + 0.055739498547183616i, -0.024604827816261773 + -0.10416888676656856i, -0.02077694976724231 + -0.060455782351915885i, -0.005594055011615612 + 0.037586644843772006i }, { 0.003888485385604804 + -0.05373927870395386i, -0.07629289741991156 + 0.09082624766447171i, 0.053255574647572516 + 0.010279029690760581i, 0.12825985568582363 + -0.012665574360405116i }, { -0.013590836181357896 + -0.006129953285019033i, 0.00349834685652371 + 0.10613979475000232i, 0.027039165671532327 + 0.03134108430766116i, -0.02679482531356506 + -0.035175914887945234i } }), Matrix({ { -0.09944145144127066 + 0.07130886630209218i, -0.028009048381201853 + -0.13505661412727i, -0.08422216896795802 + -0.08452161281601206i, 0.010583568761519562 + -0.038072780072852724i }, { 0.2081881776904278 + 0.05649207248167162i, 0.1802742021495046 + -0.005853629729049829i, 0.13104773825798266 + -0.136860201287943i, -0.018955712083825224 + -0.037690435089027995i }, { -0.16595013460685484 + -0.02983841302035946i, 0.032552440577378876 + 0.007280288998262259i, 0.12950160901098753 + -0.012004795015211308i, 0.06243519120726338 + 0.05338341934647396i }, { 0.09356519627995659 + -0.12122324195901762i, 0.06482669044645704 + 0.00354156525637025i, -0.01076217079402536 + -0.11099678878773575i, 0.07783782737414556 + 0.059369903827326646i } }), Matrix({ { -0.07756241453112477 + -0.0025912356702889544i, 0.2590290282842647 + -0.15455903368569907i, 0.0579100165618895 + 0.11870973029477146i, 0.10708370379386599 + -0.008792946331338718i }, { -0.058069221901698956 + 0.12589033742812522i, -0.07673019297044825 + -0.17110506298323427i, -0.2161709939980177 + -0.09580469480431948i, -0.043551384654182006 + 0.003741888177141623i }, { 0.13719893288893387 + -0.04016194976127706i, 0.08528966187511464 + -0.1278350605435741i, 0.3277452845357775 + -0.03923204343390517i, -0.09385632809525614 + 0.040028174462189446i }, { -0.07371014841283081 + 0.04764694455427405i, -0.016156758463929204 + 0.056474615389233915i, 0.030691879871620736 + 0.02906565362358078i, 0.003653204509496142 + -0.035482605613941134i } }), Matrix({ { 0.001375146900790435 + 0.006320716002223361i, 0.10415486660587059 + 0.10836007464903086i, -0.09638273334705287 + 0.05849488171606925i, 0.0030766122198103724 + 0.020876928068268005i }, { -0.04924753352481032 + -0.01944615590392629i, -0.0011757249869071699 + 0.01852357973606272i, -0.008647864540096297 + 0.08055541254524416i, -0.05757003253140449 + -0.003993108649613609i }, { 0.031095561481502536 + 0.12261976670016768i, 0.0818928823878404 + -0.035160785707396544i, 0.0774337303261739 + 0.2266180054154006i, 0.12265307055573818 + -0.16767105063293986i }, { -0.006358706699989683 + 0.05951763650214999i, -0.06854272985025943 + -0.01703343453803935i, 0.14807694325596604 + 0.04321074688551133i, 0.030765724985951703 + -0.018101078326457905i } }), Matrix({ { -0.12420486326159341 + 0.1137317304240369i, 0.040917553810714005 + 0.10117960631583417i, 0.03336218203772844 + -0.0571669374154992i, -0.013526193005018934 + 0.007183300510475106i }, { 0.0028528568705746098 + -0.05863196308589303i, -0.18010054327433206 + -0.06258256570251786i, 0.1610959868672294 + -0.04479051623498327i, -0.05845205345482888 + -0.11653122956624165i }, { -0.011446719461844763 + 0.29566627414853314i, -0.03570480691688465 + -0.0721391022629387i, 0.0552360145134268 + -0.0505896505923582i, -0.018829472162525358 + 0.031401458650730164i }, { 0.10076500080909034 + -0.09951452070755426i, 0.030845509862685673 + 0.07877554231221622i, 0.013000744163777916 + -0.08012234176746239i, -0.16658496415436186 + -0.11514925883972431i } }), Matrix({ { 0.055823451849619996 + -0.08582173570822375i, -0.07566025446383465 + -0.06071175953953663i, 0.01365805349684785 + 0.11345777040897746i, -0.13162867047658203 + 0.11079919325056029i }, { 0.01824999207786574 + 0.17836826247403742i, -0.06676265978334582 + -0.01487060553205996i, 0.04518103735047966 + -0.13155179205163386i, 0.10269340961621506 + 0.00789018644094991i }, { -0.06949630154887851 + 0.08627013991616574i, -0.11728748310441896 + 0.11644632836404908i, 0.024457863121638564 + 0.040306781358887024i, 0.04200972215871022 + -0.05550638307583747i }, { 0.05357111050578861 + 0.012640215721354979i, -0.04366704094367359 + -0.10929269274275463i, -0.042181951647916556 + -0.12921611186793705i, 0.17680333307805052 + -0.017445593086640405i } }), Matrix({ { -0.18858436056930594 + -0.2228279722059069i, -0.13696172425380684 + -0.08048087592961546i, 0.048103158708517564 + -0.020508715463199444i, 0.012003265815745514 + 0.010278412018395883i }, { -0.0032214062644230004 + -0.11067765318902248i, -0.17662373093749892 + -0.1467021070505946i, 0.18270721288011962 + 0.01740102160221706i, -0.03760005634864693 + 0.04296375215566997i }, { 0.11604265567059495 + -0.033906501262039195i, 0.09243716573741848 + -0.01347287231600055i, -0.12202118005352056 + 0.17934465892138765i, -0.10431846720379696 + 0.09677153912220621i }, { 0.02557156290497061 + 0.05615589889281396i, -0.057939584102482095 + 0.08805979843018563i, 0.024617593470567262 + 0.009396154153414564i, -0.12856717283811608 + 0.2037786745145542i } }), Matrix({ { 0.17098421493398724 + -0.07074671315134172i, -0.15459248314934598 + 0.019254195444531354i, -0.06267266929471108 + 0.07161002473371685i, 0.17273658690167815 + 0.03747526046454738i }, { -0.002469741675517657 + -0.02982260071185272i, -0.06760128795613912 + 0.17552649792437333i, 9.844512224805721e-05 + -0.1738903805721751i, 0.08161991887883607 + -0.07517050678370614i }, { 0.028832498209951606 + 0.07335818530679764i, 0.0744966875001847 + 0.21311827323416005i, -0.1553566352354772 + -0.08681467133563048i, -0.12708662965453177 + -0.07750768515950808i }, { 0.02076508531203382 + -0.02733367770828632i, 0.16522109510849792 + -0.02588132286374479i, 0.004315293188430863 + -0.046697125874238195i, 0.030365070435535477 + 0.11143070052665899i } }), Matrix({ { -0.05628756674470998 + 0.0870877271590868i, 0.09908621076916455 + 0.12696009693301294i, 0.1404826452248411 + 0.12347741004268153i, 0.22380206160412827 + 0.051991846199736215i }, { -0.10020678187223142 + 0.013043123051249182i, 0.05603249698187495 + 0.09095208310658734i, -0.020741990262389046 + -0.015603427743551073i, 0.22662026764683924 + 0.029237594882448755i }, { 0.035700239113954986 + -0.029051707324621475i, -0.005371464571465649 + 0.02389238638701442i, 0.01858312633906839 + -0.1712689779344243i, -0.04496908817049212 + -0.11797455775389962i }, { 0.055191118904363255 + -0.11336888283601149i, 0.07740455234583417 + 0.07937835401580016i, -0.0029917486573705085 + -0.11681577998411505i, -0.04085748344470116 + -0.0003531647404594848i } }) }, { QubitIndex{ 6 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.18664828621743523 + 0.108489031261332i, -0.3198352066362096 + 0.5686208967416864i }, { -0.07880838879216415 + 0.1763331709285281i, 0.16668376246902367 + 0.28453830505748534i } }), Matrix({ { 0.03234846843821114 + 0.27204536526543044i, -0.08806979427746062 + -0.430121873811734i }, { 0.23969981050940062 + 0.3113553896298059i, 0.3121731187904915 + 0.16080615609208132i } }), Matrix({ { 0.058725024845835756 + -0.04296129329939614i, 0.12084375304479067 + 0.1470717483199994i }, { -0.08027171777605632 + -0.3776215485200378i, 0.1339542022054746 + 0.02552060133930336i } }), Matrix({ { -0.564145132950419 + -0.23293955676304104i, -0.16062398458959465 + 0.07378522156072487i }, { 0.2313870874125662 + -0.32594275547633483i, -0.1901576407316131 + 0.16530519919548592i } }) }, { QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.5466484090077635 + 0.1545926875382347i, -0.2289309417277152 + -0.38482268969114247i }, { 0.06791316216324603 + 0.24054290516922186i, 0.14100181428608433 + -0.07298950282486852i } }), Matrix({ { -0.12884833356216896 + 0.02293559308390305i, -0.12146598120610762 + -0.039876482240057486i }, { 0.16998725129014552 + -0.36579190335123996i, 0.6293469343840398 + -0.12673975577271493i } }), Matrix({ { 0.0002981927568639197 + -0.08156107222124938i, -0.14328954325655607 + 0.20559325851214627i }, { 0.0861946604717748 + 0.21383296743076227i, -0.0072402394801543285 + 0.002648594096345998i } }), Matrix({ { -0.5246867583953171 + 0.09929913320576114i, 0.12777258251112772 + 0.17872553142374303i }, { -0.2696843065678783 + 0.13146757030415096i, -0.43761507657436316 + -0.20778107080686484i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.3249405454301688 + 0.13395264023420203i, -0.04624895063997162 + -0.08187798859253805i }, { 0.10128640479324551 + 0.40347660140279074i, -0.0029223000759820705 + -0.136265776908445i } }), Matrix({ { 0.13674371329737384 + -0.26165011859674797i, 0.10993285138007812 + 0.16702480095320582i }, { 0.11101144612446028 + 0.491377211141691i, 0.003256498412201988 + -0.09655547276437407i } }), Matrix({ { 0.12026332063765725 + -0.3200984884941748i, -0.2468448568061849 + -0.6877623950216671i }, { 0.005549598016095905 + -0.17084090784349767i, 0.4177653797174577 + 0.341229011914607i } }), Matrix({ { -0.24957916628440646 + -0.0038465463531513373i, 0.26814310723218854 + -0.029477859164414033i }, { -0.05073968408654498 + -0.38917926690024984i, 0.03254506206816759 + -0.1565903895630417i } }) }, { QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.06429988218002557 + 0.25184448455998626i, -0.5505234553665385 + 0.11913503210500859i }, { -0.0038576509212492126 + 0.06859833107389812i, -0.08865549998142472 + -0.02827354999665193i } }), Matrix({ { 0.19574887065086774 + 0.2408955338771304i, 0.008810214731480207 + 0.2153823746839834i }, { 0.11073829750465417 + -0.4428598586513391i, -0.008351520769999114 + 0.22261890275220214i } }), Matrix({ { 0.20334924070285396 + 0.20372412854503585i, -0.44938756666973856 + -0.339954943924422i }, { -0.1686530826358779 + 0.10455999275833967i, 0.020964038531915752 + 0.3577023865871036i } }), Matrix({ { 0.5011608743385624 + -0.007156864675728083i, 0.16971909851391787 + -0.31843752712132656i }, { 0.08612318388121078 + 0.49205836098369243i, 0.006836326865466931 + 0.042575383006456496i } }) }, { QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.3797828182100904 + 0.5589037682388684i, -0.04889466633123462 + 0.385189045914972i }, { 0.23658375290502628 + 0.01772548632348417i, -0.3599810554016071 + -0.10191066032615463i } }), Matrix({ { -0.04632283473499002 + 0.2933537802113913i, 0.3348450280864254 + -0.400895820079189i }, { -0.3137225051392068 + -0.17841848964613172i, 0.08773632230711247 + -0.12534321815860625i } }), Matrix({ { -0.14249154096285815 + -0.29151756048694477i, -0.37690854235065113 + -0.2937958804067509i }, { 0.18035229325315716 + 0.2856203530109247i, -0.12935392511641186 + -0.22561590261732892i } }), Matrix({ { 0.06027757657552337 + 0.1870559552952635i, 0.2342377446271344 + -0.08220565216483113i }, { -0.09560884128051242 + -0.0386222803820275i, 0.15715495174991664 + 0.17517283002997264i } }) }, { QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.15243626974314806 + 0.024946321079195508i, 0.003793283149221781 + -0.04829833803322662i, -0.017874264065183026 + 0.023149742726435028i, 0.15334399203009416 + 0.12751001987782218i }, { -0.0624405050106507 + 0.14301607502469937i, -0.10015409030127981 + -0.0447177406064673i, 0.12278105117247218 + 0.02665086170022689i, -0.005185607201127631 + 0.024116761169763117i }, { 0.027578478817711707 + 0.022401555501007173i, -0.0004292868666113303 + 0.13334473537301159i, 0.20904887049554663 + -0.05017909788099076i, 0.05259361490207656 + -0.06751064487445307i }, { -0.05722627138105612 + -0.10990867079160775i, 0.02785525147713746 + -0.15486029958400238i, -0.0893145642350879 + 0.04069522761621029i, -0.006849396441842645 + -0.2732581426732266i } }), Matrix({ { 0.16748312997490744 + -0.04047818545768876i, 0.07130221890124226 + -0.10647261128946853i, -0.10983138207234631 + 0.14941183362001123i, 0.013259992988467497 + 0.015715271328728957i }, { -0.17078944435840082 + -0.01293333669572748i, 0.0598680042038917 + 0.10089248385719261i, -0.013574461327379548 + 0.012261045890333158i, -0.03540346468323937 + 0.050515386752429i }, { -0.027173284171002163 + -0.1484796554605593i, 0.12142063749445539 + -0.010466619041002634i, 0.08394835803029219 + 0.07325484971488831i, -0.13871300541190934 + -0.049379207410705055i }, { 0.07660268381667003 + 0.09022388285055194i, 0.19145626720108738 + -0.02817858237422359i, -0.11705342629756749 + 0.10399323864939727i, -0.10936192372667249 + 0.03684793323239455i } }), Matrix({ { -0.23319008466837018 + -0.06240151948606654i, -0.008056869285460764 + 0.04353386425188256i, -0.06154747682498315 + -0.04820628685732247i, -0.1534107670563558 + 0.09526725287826263i }, { -0.17014112408077142 + -0.10902980087766835i, -0.02709829974302559 + -0.018514608926510478i, 0.11116202295648248 + 0.035304754585749505i, 0.00835710160779995 + 0.014789755579514171i }, { -0.05868876931122653 + -0.008549420235022103i, -0.020332348761804574 + -0.006214937762035103i, 0.09614273172685207 + -0.01919509116096717i, -0.22587343870417512 + 0.008554419285280739i }, { -0.10813436390552186 + -0.06932666260713942i, -0.09114986623878878 + 0.050322118522528866i, -0.040591320889824783 + 0.18326150714251815i, 0.02127431903041086 + -0.03237759036758734i } }), Matrix({ { -0.03651977125911322 + 0.025257724118962446i, -0.04066466259914339 + 0.016970564727575813i, -0.06003727491499561 + 0.09075662041568176i, 0.0488096068125812 + -0.18191429390640823i }, { 0.007146372898942527 + 0.1646539125568057i, 0.12603453846396712 + 0.22175914609194256i, 0.014422930687261777 + 0.028282826969548404i, 0.04610723264997629 + 0.03108255766910851i }, { 0.06266176605180944 + -0.027994043342006284i, 0.18954737432613047 + -0.04782084492270449i, 0.1395331751957565 + -0.02950657268857618i, 0.07383251341826706 + -0.12685059841484192i }, { 0.003680578134330698 + -0.0037929396061414876i, 0.08368491373737424 + -0.23251284891272206i, -0.1031180640258549 + -0.11753471092263537i, -0.1091592275406519 + 0.07444356077462785i } }), Matrix({ { 0.16210518933498 + 0.05902366787533689i, -0.045770468881769125 + -0.11713758284946882i, -0.06402573499263464 + -0.03068995324622748i, 0.047292785155695495 + 0.13756857256968147i }, { 0.13193382921060315 + 0.030836540987253833i, -0.03221902977645532 + -0.04793737270579926i, -0.12853383711501476 + -0.11875148029641967i, 0.07388854053000887 + -0.07089629317086497i }, { -0.01686401606071906 + -0.02792471123084294i, 0.07597859340753861 + 0.03106524020016687i, 0.00726358669814226 + -0.003421923020564148i, 0.04133533837395239 + -0.029430788690488225i }, { 0.14660618366986694 + 0.10662373263934372i, 0.07310609267530432 + -0.04466137919895646i, -0.06420713586940792 + 0.02748230949171708i, -0.1932198705941561 + -0.015044979255003773i } }), Matrix({ { 0.13534692875152682 + 0.10490501228185198i, 0.017813641033654057 + -0.15575872721209824i, 0.02630986664204161 + -0.0707614606843197i, 0.03021628721635005 + -0.05666913857057153i }, { 0.04427945591318898 + -0.03876802032485165i, 0.046146820462084154 + -0.0590696641989411i, 0.07946492403079049 + -0.15190232055521588i, -0.1193773980090744 + -0.11899574426886789i }, { 0.031001979217192555 + -0.10904073739291184i, 0.02402053856617448 + -0.018688452493758348i, 0.11539582173793544 + 0.005806122584972125i, 0.15391577820266186 + -0.0833886663492234i }, { 0.15633553523220517 + 0.0008137853450693486i, -0.08554254287585027 + 0.07724995694377508i, -0.03810800188824689 + -0.013496041923871414i, -0.015516177425201208 + 0.05162193886394924i } }), Matrix({ { 0.04113730230771599 + -0.0026316855107700746i, -0.053461209535738165 + -0.10814608730055385i, 0.0887420665695952 + 0.0558831515905897i, 0.016559502758766897 + 0.03694174805872557i }, { -0.08335283078529027 + 0.05397048639948246i, 0.09881530877379693 + -0.12930956156871687i, 0.0023475337001735994 + 0.0041800373527384705i, 0.014751233084381343 + 0.0356762855553635i }, { -0.05389272961316522 + 0.05963592523397031i, 0.10217218191314784 + -0.14338532385196717i, 0.014159010060034073 + 0.029005694770583075i, -0.10047473403403626 + 0.01794189989817992i }, { 0.04101405134155389 + -0.07043927066031722i, 0.12875608565908891 + -0.06770957700839274i, -0.024039633209154858 + -0.0834172794146407i, 0.0784832549823162 + -0.030284957535615935i } }), Matrix({ { -0.05583166564256264 + 0.10554216385033272i, 0.06312429702558006 + -0.07498127473981829i, -0.062307934247209054 + 0.09415050554463879i, 0.014169764004716616 + -0.08044429828991793i }, { -0.025023644114426067 + -0.09419276733467027i, 0.06508163869736255 + -0.01704549607474745i, -0.06838879048626885 + 0.0230238000117778i, 0.013341078285437189 + 0.03930381081776083i }, { 0.08569759144471349 + -0.0474039963513763i, 0.16468268132487288 + -0.08502594000142222i, -0.19586402384380647 + -0.19359447811357172i, 0.03485519313660993 + 0.031912084618524704i }, { -0.10564510053282916 + -0.03393607940407385i, 0.011268145005290673 + -0.05498787936050705i, -0.008775068229138025 + -0.07647779318939528i, 0.11025333601935072 + -0.18700212512416461i } }), Matrix({ { 0.12964924586628304 + -0.07112777612287169i, -0.1087604304568596 + 0.07050476216232952i, 0.10434340040052699 + -0.0829781826424626i, -0.0432961259823067 + 0.036746402680625075i }, { -0.08508053079726359 + -0.0491473181784185i, 0.01496004916281555 + 0.011635035739186244i, -0.04136045655327955 + 0.11531973316937916i, 0.05917266009995371 + 0.044419741573397044i }, { 0.04191808680914478 + 0.009854360748964971i, 0.030655161557770354 + 0.019285251081908747i, -0.05685363324549937 + 0.1984609000845614i, 0.083941530869514 + -0.03486782568500393i }, { -0.008912600853900767 + -0.06173048149795445i, -0.03570118991056795 + -0.15209900212811356i, 0.1107151679676173 + -0.05033295795914734i, 0.18301472191237447 + -0.008346234662183894i } }), Matrix({ { 0.19618694079911408 + -0.027008424801589843i, 0.007596836058923467 + 0.0744345591459575i, -0.09408381119996348 + -0.008457458518912164i, -0.03141831389186383 + 0.06402327685756641i }, { -0.0007945222690161373 + 0.021409888272821424i, -0.14537028838218016 + 0.043764644744382436i, -0.032297387024573465 + -0.14606854681925782i, 0.15261001494517176 + 0.11244094570880783i }, { 0.02692304370313897 + -0.07881733911374368i, 0.08582482327479343 + 0.007049374448025402i, 0.05698112028955271 + 0.08070604792843063i, 0.011500650484052159 + 0.012457266421169297i }, { -0.022207942635704317 + -0.04715936626810042i, -0.12791154449501602 + -0.03649564190077589i, -0.06882984811676027 + -0.10815426226271113i, 0.05683836720647941 + -0.014400098710880039i } }), Matrix({ { 0.14963566551277943 + -0.10743814670391433i, -0.030291515629281906 + 0.01967333921544789i, 0.1740300901936023 + -0.027724535177214887i, 0.06931890144044058 + 0.1056305048996551i }, { 0.07372683321623712 + 0.18398462313530858i, -0.15935848837578492 + 0.08183033427019593i, -0.10717533056941332 + -0.14988076123192332i, -0.007181027645313242 + -0.16266173940521317i }, { -0.034344959243976694 + -0.06376144283811558i, -0.09401083140047141 + -0.15082041997012335i, 0.022058390499022286 + 0.029495428655351003i, -0.10123700501471947 + 0.03462888998141844i }, { -0.021003415913317017 + -0.18585519929761854i, -0.0652771908332147 + 0.1374245405558311i, -0.08285187956017734 + 0.05629445307475893i, -0.04600103319020438 + 0.010900553413828864i } }), Matrix({ { 0.149297674945363 + 0.08240906966232779i, -0.013615881926825306 + 0.1365387867657804i, -0.026106333612618812 + 0.0495179042993099i, 0.0353337956372619 + -0.0792798817155494i }, { 0.01307367513148855 + -0.04089543056251915i, 0.053568344349296845 + 0.15168962048976972i, -0.092179985614745 + 0.06838289700960541i, -0.015027166248962116 + -0.026260212462117637i }, { -0.13843722167199915 + 0.0510580548214623i, -0.2102472136579168 + 0.012286681866293404i, 0.11218653695105586 + -0.09125977499332066i, -0.02750040957084668 + -0.10876598123083962i }, { 0.040068379376212694 + 0.0024114983414288034i, -0.03359950471506991 + -0.009683454792383809i, 0.11817976365431226 + -0.023676481374341193i, 0.06775347898217028 + -0.029241841382531976i } }), Matrix({ { -0.05101850261505224 + 0.07020675220228449i, 0.10678703792233721 + -0.03678554004585358i, -0.05241437548754758 + -0.10921464564636424i, 0.09301425621852476 + 0.20239350998651148i }, { -0.17416377435398953 + 0.08211914511628851i, 0.07895147087144545 + -0.08417530849440338i, -0.055505849334937254 + 0.07344200804896692i, -0.21522922310828513 + 0.06556046274324283i }, { 0.0639622100599601 + -0.018053321374126127i, -0.014718649047569345 + 0.01920144347117285i, 0.04330516997614244 + 0.0007148816553271167i, -0.09057355236443297 + 0.06274526653206769i }, { -0.04051741932510943 + 0.06949599185862146i, -0.11006995645697185 + 0.08012952461345987i, 0.0893500526779458 + 0.00907139260731081i, -0.00592022295933301 + 0.022351369676769282i } }), Matrix({ { -0.04634126448056413 + -0.010052709487175309i, 0.09370974907498418 + -0.006525555645785843i, 0.014128181438460534 + 0.08732021064571031i, 0.20673351870484769 + -0.032698209793477546i }, { 0.028778720029945484 + -0.10590768895968926i, -0.03173754525836656 + -0.12212371766308561i, -0.10643525163220324 + -0.056676526454148654i, 0.04470759113014076 + 0.015154752066168283i }, { -0.05427582484911995 + 0.056659836494539206i, 0.038944057903698315 + 0.0699970850170114i, -0.023226615275777254 + -0.052886249432843806i, 0.030856274233486525 + -0.04642588777409159i }, { 0.09284137243287446 + 0.09948983348200101i, -0.013618215606909564 + -0.08356980628289366i, -0.06268599061642316 + 0.11048021762869731i, -0.05290916996729038 + -0.210336151597025i } }), Matrix({ { -0.0460034548763618 + -0.061703980725814574i, -0.10222519342158846 + 0.02726275850576343i, -0.22771011427643947 + -0.008465276879576466i, 0.008052766283835309 + -0.0037200137598784955i }, { 0.24276264335788825 + 0.03555128754241717i, -0.1857116044219718 + -0.009720569915662874i, 0.0886293801617109 + 0.12062954815796419i, -0.036983554213745 + 0.05985354468861723i }, { -0.03196579476787127 + -0.006553522981056725i, 0.06505636212777556 + 0.06282471235160891i, 0.05555209594531658 + -0.05125177727925693i, 0.046786772567042986 + 0.007175474789632574i }, { 0.16137102889041305 + 0.002084167460393171i, -0.029681682659068842 + -0.12024113140449788i, 0.1187658062249623 + -0.0032915689599118995i, -0.0056539498085938986 + -0.0925257513297363i } }), Matrix({ { -0.006234190612483295 + -0.021112599674752926i, 0.03683049649562014 + -0.08581613348964878i, 0.009142575761636395 + -0.07739408341284744i, 0.04018397687698565 + 0.06385060156775724i }, { 0.062015309353226265 + -0.039428023135251566i, -0.0069414196604783915 + 0.01028732700645404i, -0.12656862136134694 + -0.011956220287106365i, -0.02313941616409207 + 0.07222747663914403i }, { -0.07788119038084701 + 0.0906885999594802i, -0.09450781520857805 + -0.05152423496256494i, -0.1175958303307902 + 0.09419082453481646i, 0.1899266524214559 + -0.018482779837334384i }, { 0.03976614479854879 + 0.010171964330413973i, 0.06821629325432571 + 0.06729410125355825i, 0.08733859409134269 + 0.16178060901065397i, 0.07599077885681502 + 0.05050549924388533i } }) }, { QubitIndex{ 5 }, QubitIndex{ 4 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 9_12_2_100_0_0) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false}), Matrix({ { 0.999999999999999 + 4.938149236158288e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.999999999999999, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false}), Matrix({ { 0.6316601263144725 + 7.665607706961272e-21i, 0.18115822482397714 + -0.12912045385740817i }, { 0.18115822482397714 + 0.12912045385740817i, 0.36833987368552634 + 4.1715884654621626e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.6316601263144725, 1.0e-7), DoubleNear(0.36833987368552634, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false}), Matrix({ { 0.5222751124167139 + 1.8453870826729017e-19i, 0.026113866616628643 + 0.03663796232796152i }, { 0.026113866616628643 + -0.036637962327961515i, 0.47772488758328513 + -1.3515721590570724e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5222751124167139, 1.0e-7), DoubleNear(0.47772488758328513, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false}), Matrix({ { 0.999999999999999 + 4.938149236158288e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.999999999999999, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false}), Matrix({ { 0.45574536997426585 + -6.04598800974408e-20i, 0.037359853837886633 + 0.03251513258959042i }, { 0.037359853837886633 + -0.03251513258959042i, 0.5442546300257332 + 1.0984137245902374e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.45574536997426585, 1.0e-7), DoubleNear(0.5442546300257332, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false}), Matrix({ { 0.5169839992319167 + -2.325707756587355e-19i, 0.003753084495369135 + 0.01603362758931811i }, { 0.0037530844953691357 + -0.016033627589318103i, 0.48301600076808215 + 2.819522680203184e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5169839992319167, 1.0e-7), DoubleNear(0.48301600076808215, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false}), Matrix({ { 0.5185362858195279 + 3.4909999811183815e-19i, 0.04884555382822805 + 0.028553074346039757i }, { 0.04884555382822805 + -0.028553074346039764i, 0.481463714180471 + -2.997185057502553e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5185362858195279, 1.0e-7), DoubleNear(0.481463714180471, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false}), Matrix({ { 0.6184504451393928 + -1.792565535205646e-19i, -0.1459684895813488 + -0.0007605079833470379i }, { -0.1459684895813488 + 0.0007605079833470374i, 0.38154955486060604 + 2.2863804588214745e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.6184504451393928, 1.0e-7), DoubleNear(0.38154955486060604, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true}), Matrix({ { 0.5307008584175106 + -6.666634928221394e-22i, -0.1739685502930765 + -0.10817887458046617i }, { -0.1739685502930765 + 0.10817887458046618i, 0.4692991415824884 + 5.004815585440502e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5307008584175106, 1.0e-7), DoubleNear(0.4692991415824884, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false}), Matrix({ { 0.6316601263144725 + 7.665607706961272e-21i, 0.0 + 0.0i, 0.18115822482397714 + -0.12912045385740817i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.18115822482397714 + 0.12912045385740817i, 0.0 + 0.0i, 0.36833987368552634 + 4.1715884654621626e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.6316601263144725, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36833987368552634, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false}), Matrix({ { 0.5222751124167139 + 1.8453870826729017e-19i, 0.0 + 0.0i, 0.026113866616628643 + 0.03663796232796152i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026113866616628643 + -0.036637962327961515i, 0.0 + 0.0i, 0.47772488758328513 + -1.3515721590570724e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5222751124167139, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.47772488758328513, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false}), Matrix({ { 0.999999999999999 + 4.938149236158288e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.999999999999999, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false}), Matrix({ { 0.45574536997426585 + -6.04598800974408e-20i, 0.0 + 0.0i, 0.037359853837886633 + 0.03251513258959042i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.037359853837886633 + -0.03251513258959042i, 0.0 + 0.0i, 0.5442546300257332 + 1.0984137245902374e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.45574536997426585, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5442546300257332, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false}), Matrix({ { 0.5169839992319167 + -2.325707756587355e-19i, 0.0 + 0.0i, 0.003753084495369135 + 0.01603362758931811i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0037530844953691357 + -0.016033627589318103i, 0.0 + 0.0i, 0.48301600076808215 + 2.819522680203184e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5169839992319167, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.48301600076808215, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false}), Matrix({ { 0.5185362858195279 + 3.4909999811183815e-19i, 0.0 + 0.0i, 0.04884555382822805 + 0.028553074346039757i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04884555382822805 + -0.028553074346039764i, 0.0 + 0.0i, 0.481463714180471 + -2.997185057502553e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5185362858195279, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.481463714180471, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false}), Matrix({ { 0.6184504451393928 + -1.792565535205646e-19i, 0.0 + 0.0i, -0.1459684895813488 + -0.0007605079833470379i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1459684895813488 + 0.0007605079833470374i, 0.0 + 0.0i, 0.38154955486060604 + 2.2863804588214745e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.6184504451393928, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.38154955486060604, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true}), Matrix({ { 0.5307008584175106 + -6.666634928221394e-22i, 0.0 + 0.0i, -0.1739685502930765 + -0.10817887458046617i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1739685502930765 + 0.10817887458046618i, 0.0 + 0.0i, 0.4692991415824884 + 5.004815585440502e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5307008584175106, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4692991415824884, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false}), Matrix({ { 0.32990036348004714 + 1.01266588569682e-19i, 0.09461443223515509 + -0.06743639955367503i, 0.016495088285618957 + 0.023142739911985087i, 0.009461452043755588 + 0.003265433906990352i }, { 0.09461443223515507 + 0.06743639955367503i, 0.19237474893666667 + 8.327211969760811e-20i, 3.139536154900084e-08 + 0.01000910252601218i, 0.00961877833100969 + 0.013495222415976437i }, { 0.01649508828561895 + -0.023142739911985084i, 3.139536154894663e-08 + -0.010009102526012179i, 0.3017597628344254 + -9.360098086272073e-20i, 0.08654379258882207 + -0.06168405430373314i }, { 0.009461452043755586 + -0.003265433906990352i, 0.00961877833100969 + -0.013495222415976435i, 0.08654379258882207 + 0.06168405430373314i, 0.17596512474885972 + -4.1556235042986505e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.32990036348004714, 1.0e-7), DoubleNear(0.19237474893666667, 1.0e-7), DoubleNear(0.3017597628344254, 1.0e-7), DoubleNear(0.17596512474885972, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false}), Matrix({ { 0.6316601263144725 + 7.665607706961272e-21i, 0.18115822482397714 + -0.12912045385740817i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.18115822482397714 + 0.12912045385740817i, 0.36833987368552634 + 4.1715884654621626e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.6316601263144725, 1.0e-7), DoubleNear(0.36833987368552634, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false}), Matrix({ { 0.28787617796518106 + -1.6873460631063216e-19i, 0.08256202219628478 + -0.05884604901448967i, 0.02359872999432973 + 0.020538512758672533i, 0.010966413478156523 + 0.0010664624162520942i }, { 0.08256202219628478 + 0.058846049014489664i, 0.16786919200908473 + 1.0827472621319136e-19i, 0.0025696761237530763 + 0.010714304983440816i, 0.013761123843556905 + 0.011976619830917891i }, { 0.02359872999432973 + -0.02053851275867253i, 0.0025696761237530767 + -0.010714304983440812i, 0.3437839483492915 + 1.7640021401759348e-19i, 0.09859620262769236 + -0.0702744048429185i }, { 0.010966413478156523 + -0.0010664624162520947i, 0.013761123843556908 + -0.011976619830917891i, 0.09859620262769236 + 0.0702744048429185i, 0.20047068167644166 + -6.655884155856974e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.28787617796518106, 1.0e-7), DoubleNear(0.16786919200908473, 1.0e-7), DoubleNear(0.3437839483492915, 1.0e-7), DoubleNear(0.20047068167644166, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false}), Matrix({ { 0.3265581782573941 + -1.4418672931090072e-19i, 0.0936559035632545 + -0.06675320861784312i, 0.002370673826413759 + 0.0101278032283479i, 0.002750171396108882 + 0.00242002353816235i }, { 0.0936559035632545 + 0.06675320861784312i, 0.1904258209745227 + -8.838404634783479e-20i, -0.0013903671465179514 + 0.00338922348497688i, 0.001382410668955376 + 0.005905824360970208i }, { 0.0023706738264137593 + -0.010127803228347897i, -0.0013903671465179518 + -0.0033892234849768796i, 0.30510194805707846 + 1.5185233701786202e-19i, 0.08750232126072265 + -0.06236724523956505i }, { 0.002750171396108882 + -0.00242002353816235i, 0.0013824106689553763 + -0.005905824360970209i, 0.08750232126072265 + 0.06236724523956505i, 0.1779140527110037 + 1.300999310024564e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3265581782573941, 1.0e-7), DoubleNear(0.1904258209745227, 1.0e-7), DoubleNear(0.30510194805707846, 1.0e-7), DoubleNear(0.1779140527110037, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false}), Matrix({ { 0.3275386957994008 + 1.5585128766735378e-19i, 0.0939371130458842 + -0.06695364056655224i, 0.03085378870103893 + 0.01803583854808602i, 0.0125355597406508 + -0.0011343358174216622i }, { 0.09393711304588423 + 0.06695364056655224i, 0.19099759002012714 + 1.9324871044448442e-19i, 0.005161987903480849 + 0.011479584341012884i, 0.017991765127189117 + 0.010517235797953741i }, { 0.03085378870103893 + -0.01803583854808602i, 0.005161987903480848 + -0.011479584341012884i, 0.30412143051507173 + -1.4818567996039253e-19i, 0.08722111177809294 + -0.062166813290855924i }, { 0.0125355597406508 + 0.0011343358174216622i, 0.017991765127189117 + -0.010517235797953741i, 0.08722111177809293 + 0.062166813290855924i, 0.17734228366539925 + -1.5153282578986281e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.3275386957994008, 1.0e-7), DoubleNear(0.19099759002012714, 1.0e-7), DoubleNear(0.30412143051507173, 1.0e-7), DoubleNear(0.17734228366539925, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false}), Matrix({ { 0.3906504862959911 + -1.175730505960508e-19i, 0.112037384783051 + -0.07985460216471461i, -0.09220247456688765 + -0.0004803825688241552i, -0.02654158958876633 + 0.01870974534739652i }, { 0.112037384783051 + 0.07985460216471461i, 0.2277999588434018 + -6.168350292451382e-20i, -0.026345195316822428 + -0.018985289899851744i, -0.053766015014461155 + -0.0002801254145228827i }, { -0.09220247456688767 + 0.0004803825688241549i, -0.02634519531682243 + 0.018985289899851744i, 0.2410096400184814 + 1.2523865830301206e-19i, 0.06912084004092614 + -0.049265851692693555i }, { -0.026541589588766335 + -0.01870974534739652i, -0.053766015014461155 + 0.0002801254145228825i, 0.06912084004092614 + 0.049265851692693555i, 0.14053991484212458 + 1.0339938757913544e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3906504862959911, 1.0e-7), DoubleNear(0.2277999588434018, 1.0e-7), DoubleNear(0.2410096400184814, 1.0e-7), DoubleNear(0.14053991484212458, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true}), Matrix({ { 0.3352225712632041 + -3.96460877630833e-20i, 0.09614082542347716 + -0.06852433570138515i, -0.10988899645287048 + -0.06833228158205482i, -0.045483939129908 + 0.0028654052883044607i }, { 0.09614082542347714 + 0.06852433570138515i, 0.19547828715430646 + 3.8979424270261175e-20i, -0.01754772836268112 + -0.04206039105321034i, -0.06407955384020601 + -0.03984659299841136i }, { -0.1098889964528705 + 0.06833228158205482i, -0.01754772836268112 + 0.04206039105321034i, 0.29643755505126845 + 4.7311695470044574e-20i, 0.08501739940049999 + -0.06059611815602302i }, { -0.045483939129908 + -0.0028654052883044607i, -0.06407955384020603 + 0.03984659299841136i, 0.08501739940049999 + 0.06059611815602302i, 0.1728615865312199 + 2.736460384360452e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.3352225712632041, 1.0e-7), DoubleNear(0.19547828715430646, 1.0e-7), DoubleNear(0.29643755505126845, 1.0e-7), DoubleNear(0.1728615865312199, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false}), Matrix({ { 0.5222751124167139 + 1.8453870826729017e-19i, 0.026113866616628643 + 0.03663796232796152i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026113866616628643 + -0.036637962327961515i, 0.47772488758328513 + -1.3515721590570724e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5222751124167139, 1.0e-7), DoubleNear(0.47772488758328513, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false}), Matrix({ { 0.2380244643367067 + -1.5421182710708967e-20i, 0.011901273802654062 + 0.016697581696260053i, 0.019512121863054257 + 0.01698184452847271i, -0.00021567796296677474 + 0.0022178847529572008i }, { 0.011901273802654062 + -0.016697581696260053i, 0.21772090563755905 + -4.503869738673182e-20i, 0.0021668984428454036 + -0.00051969308202408i, 0.017847731974832373 + 0.01553328806111771i }, { 0.01951212186305426 + -0.016981844528472713i, 0.0021668984428454036 + 0.0005196930820240803i, 0.2842506480800071 + 1.999598909779991e-19i, 0.01421259281397458 + 0.019940380631701466i }, { -0.00021567796296677457 + -0.0022178847529572008i, 0.017847731974832377 + -0.015533288061117713i, 0.014212592813974582 + -0.019940380631701466i, 0.26000398194572605 + -9.011851851897537e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2380244643367067, 1.0e-7), DoubleNear(0.21772090563755905, 1.0e-7), DoubleNear(0.2842506480800071, 1.0e-7), DoubleNear(0.26000398194572605, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false}), Matrix({ { 0.2700078763164919 + 8.664255744727418e-20i, 0.013500451198873532 + 0.01894124028801787i, 0.0019601426267283426 + 0.008373964651658848i, -0.0004894318956849951 + 0.0005562053806031414i }, { 0.013500451198873532 + -0.01894124028801787i, 0.24697612291542484 + -3.1921333310600967e-19i, 0.0006854469915110086 + 0.0002811946438931595i, 0.001792941868640792 + 0.00765966293765926i }, { 0.0019601426267283426 + -0.008373964651658846i, 0.0006854469915110086 + -0.00028119464389315957i, 0.25226723610022195 + 9.789615082001597e-20i, 0.012613415417755111 + 0.017696722039943647i }, { -0.0004894318956849952 + -0.0005562053806031412i, 0.0017929418686407927 + -0.0076596629376592595i, 0.012613415417755111 + -0.017696722039943644i, 0.2307487646678603 + 1.8405611720030246e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2700078763164919, 1.0e-7), DoubleNear(0.24697612291542484, 1.0e-7), DoubleNear(0.25226723610022195, 1.0e-7), DoubleNear(0.2307487646678603, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false}), Matrix({ { 0.24581492728014728 + 2.7855102764294225e-19i, -0.0004955543817090531 + 0.011530619774753014i, 0.005429757470295589 + 0.007755736182752226i, -0.03083185428328484 + 0.017398483846146853i }, { -0.000495554381709054 + -0.011530619774753014i, 0.27272135853938073 + 7.054897046889598e-20i, -0.033000156269729956 + 0.004334154921464746i, 0.043415796357932454 + 0.020797338163287535i }, { 0.005429757470295589 + -0.0077557361827522275i, -0.033000156269729956 + -0.004334154921464748i, 0.27646018513656656 + -9.401231937565209e-20i, 0.026609420998337692 + 0.025107342553208505i }, { -0.03083185428328484 + -0.017398483846146853i, 0.04341579635793246 + -0.020797338163287535i, 0.026609420998337695 + -0.025107342553208505i, 0.20500352904390445 + -2.057061863746032e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24581492728014728, 1.0e-7), DoubleNear(0.27272135853938073, 1.0e-7), DoubleNear(0.27646018513656656, 1.0e-7), DoubleNear(0.20500352904390445, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false}), Matrix({ { 0.3230012757593435 + -4.471433442841598e-20i, 0.016150132433364734 + 0.022658764110728136i, -0.07623570930539694 + -0.00039719439249638285i, -0.003783938204314112 + -0.005367847826388914i }, { 0.016150132433364734 + -0.022658764110728136i, 0.29544916938004945 + -1.3454221909214864e-19i, -0.003839665130002077 + 0.005328128218312902i, -0.06973278027595185 + -0.00036331359085065506i }, { -0.07623570930539697 + 0.00039719439249638307i, -0.0038396651300020767 + -0.005328128218312902i, 0.19927383665737036 + 2.2925304269570615e-19i, 0.009963734183263908 + 0.013979198217233386i }, { -0.003783938204314112 + 0.005367847826388914i, -0.06973278027595187 + 0.0003633135908506543i, 0.009963734183263908 + -0.013979198217233382i, 0.18227571820323568 + -6.149968135586004e-22i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3230012757593435, 1.0e-7), DoubleNear(0.29544916938004945, 1.0e-7), DoubleNear(0.19927383665737036, 1.0e-7), DoubleNear(0.18227571820323568, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true}), Matrix({ { 0.27717185048965215 + 1.4066653795553132e-19i, 0.013858651430045206 + 0.019443798058117613i, -0.09085944416128935 + -0.05649913388262662i, -0.0005795379862812575 + -0.00919882189341912i }, { 0.013858651430045206 + -0.019443798058117613i, 0.2535290079278584 + -1.4133320144835341e-19i, -0.008506445049402055 + 0.003548884490356527i, -0.08310910613178715 + -0.05167974069783956i }, { -0.09085944416128935 + 0.05649913388262662i, -0.008506445049402055 + -0.0035488844903565284i, 0.2451032619270617 + 4.387217031175884e-20i, 0.012255215186583436 + 0.01719416426984391i }, { -0.0005795379862812576 + 0.00919882189341912i, -0.08310910613178715 + 0.05167974069783956i, 0.012255215186583436 + -0.017194164269843906i, 0.22419587965542673 + 6.1759855426461816e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.27717185048965215, 1.0e-7), DoubleNear(0.2535290079278584, 1.0e-7), DoubleNear(0.2451032619270617, 1.0e-7), DoubleNear(0.22419587965542673, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false}), Matrix({ { 0.45574536997426585 + -6.04598800974408e-20i, 0.0 + 0.0i, 0.037359853837886633 + 0.03251513258959042i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.037359853837886633 + -0.03251513258959042i, 0.0 + 0.0i, 0.5442546300257332 + 1.0984137245902374e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.45574536997426585, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5442546300257332, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false}), Matrix({ { 0.5169839992319167 + -2.325707756587355e-19i, 0.0 + 0.0i, 0.003753084495369135 + 0.01603362758931811i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0037530844953691357 + -0.016033627589318103i, 0.0 + 0.0i, 0.48301600076808215 + 2.819522680203184e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5169839992319167, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.48301600076808215, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false}), Matrix({ { 0.5185362858195279 + 3.4909999811183815e-19i, 0.0 + 0.0i, 0.04884555382822805 + 0.028553074346039757i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04884555382822805 + -0.028553074346039764i, 0.0 + 0.0i, 0.481463714180471 + -2.997185057502553e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5185362858195279, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.481463714180471, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false}), Matrix({ { 0.6184504451393928 + -1.792565535205646e-19i, 0.0 + 0.0i, -0.1459684895813488 + -0.0007605079833470379i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1459684895813488 + 0.0007605079833470374i, 0.0 + 0.0i, 0.38154955486060604 + 2.2863804588214745e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.6184504451393928, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.38154955486060604, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true}), Matrix({ { 0.5307008584175106 + -6.666634928221394e-22i, 0.0 + 0.0i, -0.1739685502930765 + -0.10817887458046617i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1739685502930765 + 0.10817887458046618i, 0.0 + 0.0i, 0.4692991415824884 + 5.004815585440502e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5307008584175106, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4692991415824884, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false}), Matrix({ { 0.23697438432515866 + -1.261928020698778e-19i, 0.03868745050929094 + -0.007634841835899254i, 0.0008768424573133248 + -0.00816617195601732i, 0.020520208511779315 + -0.022797998031994497i }, { 0.03868745050929094 + 0.007634841835899255i, 0.2800096149067581 + -1.0637797358885776e-19i, 0.008332422299673105 + 0.021683225638854074i, 0.00287624203805581 + 0.02419979954533543i }, { 0.0008768424573133254 + 0.00816617195601732i, 0.008332422299673103 + -0.021683225638854074i, 0.21877098564910713 + 6.573292197243696e-20i, -0.0013275966714043066 + 0.040149974425489676i }, { 0.020520208511779315 + 0.022797998031994497i, 0.00287624203805581 + -0.024199799545335427i, -0.0013275966714043057 + -0.040149974425489676i, 0.264245015118975 + 2.1621934604788145e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.23697438432515866, 1.0e-7), DoubleNear(0.2800096149067581, 1.0e-7), DoubleNear(0.21877098564910713, 1.0e-7), DoubleNear(0.264245015118975, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false}), Matrix({ { 0.23632051142590266 + 1.3734548483760716e-20i, 0.01937243984785819 + 0.016860276085935724i, 0.02226113500104373 + 0.013012931431738622i, 0.0008964557534513092 + 0.00265495834332717i }, { 0.019372439847858195 + -0.016860276085935724i, 0.2822157743936253 + 3.353654496280775e-19i, 0.0027532697498551424 + -0.0005214809749464554i, 0.026584418827184316 + 0.015540142914301138i }, { 0.02226113500104373 + -0.013012931431738622i, 0.0027532697498551424 + 0.0005214809749464552i, 0.21942485854836313 + -7.419442858120151e-20i, 0.017987413990028442 + 0.015654856503654696i }, { 0.000896455753451309 + -0.00265495834332717i, 0.026584418827184316 + -0.01554014291430114i, 0.017987413990028442 + -0.015654856503654696i, 0.2620388556321078 + -2.255240771690538e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.23632051142590266, 1.0e-7), DoubleNear(0.2822157743936253, 1.0e-7), DoubleNear(0.21942485854836313, 1.0e-7), DoubleNear(0.2620388556321078, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false}), Matrix({ { 0.2816923679546847 + -1.162799675409962e-19i, 0.02259177002162708 + 0.01975047806109337i, -0.06657443970529783 + -0.0002862934905995811i, -0.0055999403425218384 + -0.005066018544895957i }, { 0.022591770021627083 + -0.01975047806109337i, 0.33675807718470824 + -6.297658597956837e-20i, -0.005992262204971364 + 0.004486492456658343i, -0.07939404987605098 + -0.0004742144927474568i }, { -0.06657443970529783 + 0.0002862934905995809i, -0.0059922622049713645 + -0.004486492456658344i, 0.17405300201958113 + 5.582008744355541e-20i, 0.01476808381625955 + 0.012764654528497052i }, { -0.0055999403425218384 + 0.0050660185448959585i, -0.07939404987605099 + 0.0004742144927474565i, 0.01476808381625955 + -0.012764654528497054i, 0.20749655284102492 + 1.7281795843859212e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2816923679546847, 1.0e-7), DoubleNear(0.33675807718470824, 1.0e-7), DoubleNear(0.17405300201958113, 1.0e-7), DoubleNear(0.20749655284102492, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true}), Matrix({ { 0.24127529617103566 + -5.616939742394435e-20i, 0.020295454231218122 + 0.0182636679599761i, -0.07889041012215173 + -0.04918340412885033i, -0.0024933900252786445 + -0.010784803004252197i }, { 0.020295454231218125 + -0.018263667959976103i, 0.28942556224647487 + 5.550273393112227e-20i, -0.010592653346335655 + 0.002163306620801489i, -0.09507814017092478 + -0.05899547045161585i }, { -0.07889041012215173 + 0.04918340412885032i, -0.010592653346335657 + -0.0021633066208014895i, 0.21447007380323016 + -4.2904826734964396e-21i, 0.017064399606668508 + 0.014251464629614323i }, { -0.002493390025278644 + 0.010784803004252198i, -0.09507814017092478 + 0.05899547045161586i, 0.017064399606668508 + -0.014251464629614321i, 0.2548290677792583 + 5.433863852790146e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.24127529617103566, 1.0e-7), DoubleNear(0.28942556224647487, 1.0e-7), DoubleNear(0.21447007380323016, 1.0e-7), DoubleNear(0.2548290677792583, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false}), Matrix({ { 0.2680749627898441 + -9.539578315098181e-21i, 0.001946110494595571 + 0.008314017698378532i, 0.025252369762815224 + 0.014761482565781896i, -0.00027448786985407323 + 0.0008903335200990448i }, { 0.0019461104945955707 + -0.00831401769837853i, 0.2504613230296839 + 3.586395764269364e-19i, 0.0006411308513349558 + -0.0006760093188525565i, 0.023593184065412824 + 0.013791591780257864i }, { 0.025252369762815224 + -0.014761482565781896i, 0.0006411308513349556 + 0.0006760093188525568i, 0.24890903644207266 + -2.230311973436373e-19i, 0.0018069740007735638 + 0.007719609890939577i }, { -0.00027448786985407323 + -0.0008903335200990451i, 0.023593184065412824 + -0.013791591780257866i, 0.001806974000773565 + -0.007719609890939575i, 0.23255467773839833 + -7.668730840661797e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2680749627898441, 1.0e-7), DoubleNear(0.2504613230296839, 1.0e-7), DoubleNear(0.24890903644207266, 1.0e-7), DoubleNear(0.23255467773839833, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false}), Matrix({ { 0.32038841694139597 + -2.8441890388102746e-19i, 0.0015573521691039692 + 0.01002897906472961i, -0.07512211264680319 + 0.00017225814460293778i, -0.001317634589261092 + -0.002194234693396413i }, { 0.0015573521691039705 + -0.010028979064729607i, 0.29806202819799693 + 1.0516235036046288e-19i, -0.0006368040061428065 + 0.00179999144996412i, -0.07084637693454562 + -0.0009327661279499757i }, { -0.07512211264680319 + -0.00017225814460293827i, -0.0006368040061428065 + -0.0017999914499641201i, 0.19659558229052077 + 5.184812822229195e-20i, 0.0021957323262651656 + 0.006004648524588499i }, { -0.0013176345892610918 + 0.002194234693396414i, -0.07084637693454562 + 0.0009327661279499757i, 0.0021957323262651648 + -0.006004648524588499i, 0.18495397257008525 + 1.7678991765985554e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.32038841694139597, 1.0e-7), DoubleNear(0.29806202819799693, 1.0e-7), DoubleNear(0.19659558229052077, 1.0e-7), DoubleNear(0.18495397257008525, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true}), Matrix({ { 0.2718823031684952 + -3.485044470493554e-19i, 0.0016891505791496316 + 0.007414762012390115i, -0.08845413149307679 + -0.054913304155411534i, 0.00134743234089123 + -0.003053819818355911i }, { 0.0016891505791496316 + -0.007414762012390113i, 0.2588185552490153 + 3.4783778355653327e-19i, -0.001676979625928528 + 0.0019939038154508917i, -0.08551441879999971 + -0.05326557042505464i }, { -0.08845413149307679 + 0.05491330415541154i, -0.001676979625928528 + -0.0019939038154508926i, 0.24510169606342155 + 1.1593367139061988e-19i, 0.0020639339162195035 + 0.008618865576927993i }, { 0.00134743234089123 + 0.003053819818355911i, -0.08551441879999971 + 0.05326557042505464i, 0.002063933916219504 + -0.008618865576927991i, 0.22419744551906687 + -6.588551553621485e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2718823031684952, 1.0e-7), DoubleNear(0.2588185552490153, 1.0e-7), DoubleNear(0.24510169606342155, 1.0e-7), DoubleNear(0.22419744551906687, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false}), Matrix({ { 0.32068899678601487 + 1.3387832622951386e-19i, 0.03020855450814785 + 0.017658661539406487i, -0.07568995843419915 + -0.0003943509850208731i, -0.007108196874081662 + -0.004204996568832761i }, { 0.03020855450814785 + -0.01765866153940649i, 0.29776144835337803 + -3.131348797500785e-19i, -0.007151626556060192 + 0.004130701701558012i, -0.07027853114714966 + -0.00036615699832616487i }, { -0.07568995843419915 + 0.0003943509850208724i, -0.007151626556060192 + -0.004130701701558014i, 0.1978472890335131 + 2.1522167188232432e-19i, 0.0186369993200802 + 0.010894412806633271i }, { -0.007108196874081661 + 0.004204996568832761i, -0.07027853114714966 + 0.000366156998326165i, 0.0186369993200802 + -0.01089441280663327i, 0.18370226582709295 + 1.3416373999823164e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.32068899678601487, 1.0e-7), DoubleNear(0.29776144835337803, 1.0e-7), DoubleNear(0.1978472890335131, 1.0e-7), DoubleNear(0.18370226582709295, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true}), Matrix({ { 0.27518765200505135 + 1.8973443196556469e-19i, 0.025922377346519372 + 0.015153141065902315i, -0.09020900591837974 + -0.05609467182909153i, -0.005408750739192311 + -0.010251393991788272i }, { 0.025922377346519372 + -0.015153141065902317i, 0.25551320641245917 + -1.9040109545838683e-19i, -0.011586429636326242 + -0.00031672009100632226i, -0.08375954437469676 + -0.05208420275137464i }, { -0.09020900591837974 + 0.056094671829091544i, -0.011586429636326242 + 0.00031672009100632215i, 0.24334863381447658 + 1.593655661462735e-19i, 0.022923176481708676 + 0.013399933280137444i }, { -0.005408750739192312 + 0.010251393991788272i, -0.08375954437469676 + 0.05208420275137464i, 0.022923176481708676 + -0.013399933280137447i, 0.22595050776801184 + -1.0931741029186847e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.27518765200505135, 1.0e-7), DoubleNear(0.25551320641245917, 1.0e-7), DoubleNear(0.24334863381447658, 1.0e-7), DoubleNear(0.22595050776801184, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true}), Matrix({ { 0.3278973142540643 + -1.629925937609234e-19i, -0.07756135921778687 + -0.00017400279200303957i, -0.10752658010631189 + -0.0669498392205524i, 0.024171925842656757 + 0.015299925160775635i }, { -0.07756135921778687 + 0.00017400279200303914i, 0.2028035441634462 + 1.6232593026810125e-19i, 0.025142744868936348 + 0.017369084973313624i, -0.06644197018676462 + -0.04122903535991376i }, { -0.10752658010631189 + 0.06694983922055242i, 0.025142744868936345 + -0.01736908497331362i, 0.2905531308853286 + -1.6263959759641204e-20i, -0.06840713036356194 + -0.0005865051913439983i }, { 0.02417192584265676 + -0.015299925160775635i, -0.06644197018676462 + 0.04122903535991376i, -0.06840713036356194 + 0.0005865051913439982i, 0.17874601069715984 + 6.631211561404622e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3278973142540643, 1.0e-7), DoubleNear(0.2028035441634462, 1.0e-7), DoubleNear(0.2905531308853286, 1.0e-7), DoubleNear(0.17874601069715984, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false, false}), Matrix({ { 0.32990036348004714 + 1.01266588569682e-19i, 0.0 + 0.0i, 0.09461443223515509 + -0.06743639955367503i, 0.0 + 0.0i, 0.016495088285618957 + 0.023142739911985087i, 0.0 + 0.0i, 0.009461452043755588 + 0.003265433906990352i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09461443223515507 + 0.06743639955367503i, 0.0 + 0.0i, 0.19237474893666667 + 8.327211969760811e-20i, 0.0 + 0.0i, 3.139536154900084e-08 + 0.01000910252601218i, 0.0 + 0.0i, 0.00961877833100969 + 0.013495222415976437i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01649508828561895 + -0.023142739911985084i, 0.0 + 0.0i, 3.139536154894663e-08 + -0.010009102526012179i, 0.0 + 0.0i, 0.3017597628344254 + -9.360098086272073e-20i, 0.0 + 0.0i, 0.08654379258882207 + -0.06168405430373314i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.009461452043755586 + -0.003265433906990352i, 0.0 + 0.0i, 0.00961877833100969 + -0.013495222415976435i, 0.0 + 0.0i, 0.08654379258882207 + 0.06168405430373314i, 0.0 + 0.0i, 0.17596512474885972 + -4.1556235042986505e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.32990036348004714, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19237474893666667, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3017597628344254, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17596512474885972, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false, false}), Matrix({ { 0.6316601263144725 + 7.665607706961272e-21i, 0.0 + 0.0i, 0.18115822482397714 + -0.12912045385740817i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.18115822482397714 + 0.12912045385740817i, 0.0 + 0.0i, 0.36833987368552634 + 4.1715884654621626e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.6316601263144725, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36833987368552634, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false, false}), Matrix({ { 0.28787617796518106 + -1.6873460631063216e-19i, 0.0 + 0.0i, 0.08256202219628478 + -0.05884604901448967i, 0.0 + 0.0i, 0.02359872999432973 + 0.020538512758672533i, 0.0 + 0.0i, 0.010966413478156523 + 0.0010664624162520942i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08256202219628478 + 0.058846049014489664i, 0.0 + 0.0i, 0.16786919200908473 + 1.0827472621319136e-19i, 0.0 + 0.0i, 0.0025696761237530763 + 0.010714304983440816i, 0.0 + 0.0i, 0.013761123843556905 + 0.011976619830917891i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02359872999432973 + -0.02053851275867253i, 0.0 + 0.0i, 0.0025696761237530767 + -0.010714304983440812i, 0.0 + 0.0i, 0.3437839483492915 + 1.7640021401759348e-19i, 0.0 + 0.0i, 0.09859620262769236 + -0.0702744048429185i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010966413478156523 + -0.0010664624162520947i, 0.0 + 0.0i, 0.013761123843556908 + -0.011976619830917891i, 0.0 + 0.0i, 0.09859620262769236 + 0.0702744048429185i, 0.0 + 0.0i, 0.20047068167644166 + -6.655884155856974e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.28787617796518106, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.16786919200908473, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3437839483492915, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20047068167644166, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false, false}), Matrix({ { 0.3265581782573941 + -1.4418672931090072e-19i, 0.0 + 0.0i, 0.0936559035632545 + -0.06675320861784312i, 0.0 + 0.0i, 0.002370673826413759 + 0.0101278032283479i, 0.0 + 0.0i, 0.002750171396108882 + 0.00242002353816235i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0936559035632545 + 0.06675320861784312i, 0.0 + 0.0i, 0.1904258209745227 + -8.838404634783479e-20i, 0.0 + 0.0i, -0.0013903671465179514 + 0.00338922348497688i, 0.0 + 0.0i, 0.001382410668955376 + 0.005905824360970208i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0023706738264137593 + -0.010127803228347897i, 0.0 + 0.0i, -0.0013903671465179518 + -0.0033892234849768796i, 0.0 + 0.0i, 0.30510194805707846 + 1.5185233701786202e-19i, 0.0 + 0.0i, 0.08750232126072265 + -0.06236724523956505i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002750171396108882 + -0.00242002353816235i, 0.0 + 0.0i, 0.0013824106689553763 + -0.005905824360970209i, 0.0 + 0.0i, 0.08750232126072265 + 0.06236724523956505i, 0.0 + 0.0i, 0.1779140527110037 + 1.300999310024564e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3265581782573941, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1904258209745227, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.30510194805707846, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1779140527110037, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false, false}), Matrix({ { 0.3275386957994008 + 1.5585128766735378e-19i, 0.0 + 0.0i, 0.0939371130458842 + -0.06695364056655224i, 0.0 + 0.0i, 0.03085378870103893 + 0.01803583854808602i, 0.0 + 0.0i, 0.0125355597406508 + -0.0011343358174216622i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09393711304588423 + 0.06695364056655224i, 0.0 + 0.0i, 0.19099759002012714 + 1.9324871044448442e-19i, 0.0 + 0.0i, 0.005161987903480849 + 0.011479584341012884i, 0.0 + 0.0i, 0.017991765127189117 + 0.010517235797953741i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03085378870103893 + -0.01803583854808602i, 0.0 + 0.0i, 0.005161987903480848 + -0.011479584341012884i, 0.0 + 0.0i, 0.30412143051507173 + -1.4818567996039253e-19i, 0.0 + 0.0i, 0.08722111177809294 + -0.062166813290855924i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0125355597406508 + 0.0011343358174216622i, 0.0 + 0.0i, 0.017991765127189117 + -0.010517235797953741i, 0.0 + 0.0i, 0.08722111177809293 + 0.062166813290855924i, 0.0 + 0.0i, 0.17734228366539925 + -1.5153282578986281e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.3275386957994008, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19099759002012714, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.30412143051507173, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17734228366539925, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true, false}), Matrix({ { 0.3906504862959911 + -1.175730505960508e-19i, 0.0 + 0.0i, 0.112037384783051 + -0.07985460216471461i, 0.0 + 0.0i, -0.09220247456688765 + -0.0004803825688241552i, 0.0 + 0.0i, -0.02654158958876633 + 0.01870974534739652i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.112037384783051 + 0.07985460216471461i, 0.0 + 0.0i, 0.2277999588434018 + -6.168350292451382e-20i, 0.0 + 0.0i, -0.026345195316822428 + -0.018985289899851744i, 0.0 + 0.0i, -0.053766015014461155 + -0.0002801254145228827i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09220247456688767 + 0.0004803825688241549i, 0.0 + 0.0i, -0.02634519531682243 + 0.018985289899851744i, 0.0 + 0.0i, 0.2410096400184814 + 1.2523865830301206e-19i, 0.0 + 0.0i, 0.06912084004092614 + -0.049265851692693555i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.026541589588766335 + -0.01870974534739652i, 0.0 + 0.0i, -0.053766015014461155 + 0.0002801254145228825i, 0.0 + 0.0i, 0.06912084004092614 + 0.049265851692693555i, 0.0 + 0.0i, 0.14053991484212458 + 1.0339938757913544e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3906504862959911, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2277999588434018, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2410096400184814, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.14053991484212458, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, true}), Matrix({ { 0.3352225712632041 + -3.96460877630833e-20i, 0.0 + 0.0i, 0.09614082542347716 + -0.06852433570138515i, 0.0 + 0.0i, -0.10988899645287048 + -0.06833228158205482i, 0.0 + 0.0i, -0.045483939129908 + 0.0028654052883044607i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09614082542347714 + 0.06852433570138515i, 0.0 + 0.0i, 0.19547828715430646 + 3.8979424270261175e-20i, 0.0 + 0.0i, -0.01754772836268112 + -0.04206039105321034i, 0.0 + 0.0i, -0.06407955384020601 + -0.03984659299841136i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1098889964528705 + 0.06833228158205482i, 0.0 + 0.0i, -0.01754772836268112 + 0.04206039105321034i, 0.0 + 0.0i, 0.29643755505126845 + 4.7311695470044574e-20i, 0.0 + 0.0i, 0.08501739940049999 + -0.06059611815602302i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.045483939129908 + -0.0028654052883044607i, 0.0 + 0.0i, -0.06407955384020603 + 0.03984659299841136i, 0.0 + 0.0i, 0.08501739940049999 + 0.06059611815602302i, 0.0 + 0.0i, 0.1728615865312199 + 2.736460384360452e-21i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.3352225712632041, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19547828715430646, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29643755505126845, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1728615865312199, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false, false}), Matrix({ { 0.5222751124167139 + 1.8453870826729017e-19i, 0.0 + 0.0i, 0.026113866616628643 + 0.03663796232796152i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026113866616628643 + -0.036637962327961515i, 0.0 + 0.0i, 0.47772488758328513 + -1.3515721590570724e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5222751124167139, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.47772488758328513, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false, false}), Matrix({ { 0.2380244643367067 + -1.5421182710708967e-20i, 0.0 + 0.0i, 0.011901273802654062 + 0.016697581696260053i, 0.0 + 0.0i, 0.019512121863054257 + 0.01698184452847271i, 0.0 + 0.0i, -0.00021567796296677474 + 0.0022178847529572008i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.011901273802654062 + -0.016697581696260053i, 0.0 + 0.0i, 0.21772090563755905 + -4.503869738673182e-20i, 0.0 + 0.0i, 0.0021668984428454036 + -0.00051969308202408i, 0.0 + 0.0i, 0.017847731974832373 + 0.01553328806111771i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01951212186305426 + -0.016981844528472713i, 0.0 + 0.0i, 0.0021668984428454036 + 0.0005196930820240803i, 0.0 + 0.0i, 0.2842506480800071 + 1.999598909779991e-19i, 0.0 + 0.0i, 0.01421259281397458 + 0.019940380631701466i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00021567796296677457 + -0.0022178847529572008i, 0.0 + 0.0i, 0.017847731974832377 + -0.015533288061117713i, 0.0 + 0.0i, 0.014212592813974582 + -0.019940380631701466i, 0.0 + 0.0i, 0.26000398194572605 + -9.011851851897537e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2380244643367067, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21772090563755905, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2842506480800071, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26000398194572605, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false, false}), Matrix({ { 0.2700078763164919 + 8.664255744727418e-20i, 0.0 + 0.0i, 0.013500451198873532 + 0.01894124028801787i, 0.0 + 0.0i, 0.0019601426267283426 + 0.008373964651658848i, 0.0 + 0.0i, -0.0004894318956849951 + 0.0005562053806031414i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013500451198873532 + -0.01894124028801787i, 0.0 + 0.0i, 0.24697612291542484 + -3.1921333310600967e-19i, 0.0 + 0.0i, 0.0006854469915110086 + 0.0002811946438931595i, 0.0 + 0.0i, 0.001792941868640792 + 0.00765966293765926i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0019601426267283426 + -0.008373964651658846i, 0.0 + 0.0i, 0.0006854469915110086 + -0.00028119464389315957i, 0.0 + 0.0i, 0.25226723610022195 + 9.789615082001597e-20i, 0.0 + 0.0i, 0.012613415417755111 + 0.017696722039943647i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004894318956849952 + -0.0005562053806031412i, 0.0 + 0.0i, 0.0017929418686407927 + -0.0076596629376592595i, 0.0 + 0.0i, 0.012613415417755111 + -0.017696722039943644i, 0.0 + 0.0i, 0.2307487646678603 + 1.8405611720030246e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2700078763164919, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24697612291542484, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25226723610022195, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2307487646678603, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false, false}), Matrix({ { 0.24581492728014728 + 2.7855102764294225e-19i, 0.0 + 0.0i, -0.0004955543817090531 + 0.011530619774753014i, 0.0 + 0.0i, 0.005429757470295589 + 0.007755736182752226i, 0.0 + 0.0i, -0.03083185428328484 + 0.017398483846146853i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.000495554381709054 + -0.011530619774753014i, 0.0 + 0.0i, 0.27272135853938073 + 7.054897046889598e-20i, 0.0 + 0.0i, -0.033000156269729956 + 0.004334154921464746i, 0.0 + 0.0i, 0.043415796357932454 + 0.020797338163287535i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.005429757470295589 + -0.0077557361827522275i, 0.0 + 0.0i, -0.033000156269729956 + -0.004334154921464748i, 0.0 + 0.0i, 0.27646018513656656 + -9.401231937565209e-20i, 0.0 + 0.0i, 0.026609420998337692 + 0.025107342553208505i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03083185428328484 + -0.017398483846146853i, 0.0 + 0.0i, 0.04341579635793246 + -0.020797338163287535i, 0.0 + 0.0i, 0.026609420998337695 + -0.025107342553208505i, 0.0 + 0.0i, 0.20500352904390445 + -2.057061863746032e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24581492728014728, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27272135853938073, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27646018513656656, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20500352904390445, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true, false}), Matrix({ { 0.3230012757593435 + -4.471433442841598e-20i, 0.0 + 0.0i, 0.016150132433364734 + 0.022658764110728136i, 0.0 + 0.0i, -0.07623570930539694 + -0.00039719439249638285i, 0.0 + 0.0i, -0.003783938204314112 + -0.005367847826388914i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.016150132433364734 + -0.022658764110728136i, 0.0 + 0.0i, 0.29544916938004945 + -1.3454221909214864e-19i, 0.0 + 0.0i, -0.003839665130002077 + 0.005328128218312902i, 0.0 + 0.0i, -0.06973278027595185 + -0.00036331359085065506i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07623570930539697 + 0.00039719439249638307i, 0.0 + 0.0i, -0.0038396651300020767 + -0.005328128218312902i, 0.0 + 0.0i, 0.19927383665737036 + 2.2925304269570615e-19i, 0.0 + 0.0i, 0.009963734183263908 + 0.013979198217233386i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003783938204314112 + 0.005367847826388914i, 0.0 + 0.0i, -0.06973278027595187 + 0.0003633135908506543i, 0.0 + 0.0i, 0.009963734183263908 + -0.013979198217233382i, 0.0 + 0.0i, 0.18227571820323568 + -6.149968135586004e-22i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3230012757593435, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29544916938004945, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19927383665737036, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18227571820323568, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, true}), Matrix({ { 0.27717185048965215 + 1.4066653795553132e-19i, 0.0 + 0.0i, 0.013858651430045206 + 0.019443798058117613i, 0.0 + 0.0i, -0.09085944416128935 + -0.05649913388262662i, 0.0 + 0.0i, -0.0005795379862812575 + -0.00919882189341912i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013858651430045206 + -0.019443798058117613i, 0.0 + 0.0i, 0.2535290079278584 + -1.4133320144835341e-19i, 0.0 + 0.0i, -0.008506445049402055 + 0.003548884490356527i, 0.0 + 0.0i, -0.08310910613178715 + -0.05167974069783956i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09085944416128935 + 0.05649913388262662i, 0.0 + 0.0i, -0.008506445049402055 + -0.0035488844903565284i, 0.0 + 0.0i, 0.2451032619270617 + 4.387217031175884e-20i, 0.0 + 0.0i, 0.012255215186583436 + 0.01719416426984391i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005795379862812576 + 0.00919882189341912i, 0.0 + 0.0i, -0.08310910613178715 + 0.05167974069783956i, 0.0 + 0.0i, 0.012255215186583436 + -0.017194164269843906i, 0.0 + 0.0i, 0.22419587965542673 + 6.1759855426461816e-21i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.27717185048965215, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2535290079278584, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2451032619270617, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22419587965542673, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false, false}), Matrix({ { 0.45574536997426585 + -6.04598800974408e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.037359853837886633 + 0.03251513258959042i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.037359853837886633 + -0.03251513258959042i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.5442546300257332 + 1.0984137245902374e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.45574536997426585, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5442546300257332, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false, false}), Matrix({ { 0.5169839992319167 + -2.325707756587355e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003753084495369135 + 0.01603362758931811i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0037530844953691357 + -0.016033627589318103i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.48301600076808215 + 2.819522680203184e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5169839992319167, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.48301600076808215, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false, false}), Matrix({ { 0.5185362858195279 + 3.4909999811183815e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04884555382822805 + 0.028553074346039757i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04884555382822805 + -0.028553074346039764i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.481463714180471 + -2.997185057502553e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5185362858195279, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.481463714180471, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true, false}), Matrix({ { 0.6184504451393928 + -1.792565535205646e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.1459684895813488 + -0.0007605079833470379i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1459684895813488 + 0.0007605079833470374i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.38154955486060604 + 2.2863804588214745e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.6184504451393928, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.38154955486060604, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, true}), Matrix({ { 0.5307008584175106 + -6.666634928221394e-22i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.1739685502930765 + -0.10817887458046617i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1739685502930765 + 0.10817887458046618i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4692991415824884 + 5.004815585440502e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5307008584175106, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4692991415824884, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false, false}), Matrix({ { 0.23697438432515866 + -1.261928020698778e-19i, 0.0 + 0.0i, 0.03868745050929094 + -0.007634841835899254i, 0.0 + 0.0i, 0.0008768424573133248 + -0.00816617195601732i, 0.0 + 0.0i, 0.020520208511779315 + -0.022797998031994497i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03868745050929094 + 0.007634841835899255i, 0.0 + 0.0i, 0.2800096149067581 + -1.0637797358885776e-19i, 0.0 + 0.0i, 0.008332422299673105 + 0.021683225638854074i, 0.0 + 0.0i, 0.00287624203805581 + 0.02419979954533543i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0008768424573133254 + 0.00816617195601732i, 0.0 + 0.0i, 0.008332422299673103 + -0.021683225638854074i, 0.0 + 0.0i, 0.21877098564910713 + 6.573292197243696e-20i, 0.0 + 0.0i, -0.0013275966714043066 + 0.040149974425489676i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020520208511779315 + 0.022797998031994497i, 0.0 + 0.0i, 0.00287624203805581 + -0.024199799545335427i, 0.0 + 0.0i, -0.0013275966714043057 + -0.040149974425489676i, 0.0 + 0.0i, 0.264245015118975 + 2.1621934604788145e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.23697438432515866, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2800096149067581, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21877098564910713, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.264245015118975, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false, false}), Matrix({ { 0.23632051142590266 + 1.3734548483760716e-20i, 0.0 + 0.0i, 0.01937243984785819 + 0.016860276085935724i, 0.0 + 0.0i, 0.02226113500104373 + 0.013012931431738622i, 0.0 + 0.0i, 0.0008964557534513092 + 0.00265495834332717i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.019372439847858195 + -0.016860276085935724i, 0.0 + 0.0i, 0.2822157743936253 + 3.353654496280775e-19i, 0.0 + 0.0i, 0.0027532697498551424 + -0.0005214809749464554i, 0.0 + 0.0i, 0.026584418827184316 + 0.015540142914301138i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02226113500104373 + -0.013012931431738622i, 0.0 + 0.0i, 0.0027532697498551424 + 0.0005214809749464552i, 0.0 + 0.0i, 0.21942485854836313 + -7.419442858120151e-20i, 0.0 + 0.0i, 0.017987413990028442 + 0.015654856503654696i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.000896455753451309 + -0.00265495834332717i, 0.0 + 0.0i, 0.026584418827184316 + -0.01554014291430114i, 0.0 + 0.0i, 0.017987413990028442 + -0.015654856503654696i, 0.0 + 0.0i, 0.2620388556321078 + -2.255240771690538e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.23632051142590266, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2822157743936253, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21942485854836313, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2620388556321078, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true, false}), Matrix({ { 0.2816923679546847 + -1.162799675409962e-19i, 0.0 + 0.0i, 0.02259177002162708 + 0.01975047806109337i, 0.0 + 0.0i, -0.06657443970529783 + -0.0002862934905995811i, 0.0 + 0.0i, -0.0055999403425218384 + -0.005066018544895957i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.022591770021627083 + -0.01975047806109337i, 0.0 + 0.0i, 0.33675807718470824 + -6.297658597956837e-20i, 0.0 + 0.0i, -0.005992262204971364 + 0.004486492456658343i, 0.0 + 0.0i, -0.07939404987605098 + -0.0004742144927474568i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06657443970529783 + 0.0002862934905995809i, 0.0 + 0.0i, -0.0059922622049713645 + -0.004486492456658344i, 0.0 + 0.0i, 0.17405300201958113 + 5.582008744355541e-20i, 0.0 + 0.0i, 0.01476808381625955 + 0.012764654528497052i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0055999403425218384 + 0.0050660185448959585i, 0.0 + 0.0i, -0.07939404987605099 + 0.0004742144927474565i, 0.0 + 0.0i, 0.01476808381625955 + -0.012764654528497054i, 0.0 + 0.0i, 0.20749655284102492 + 1.7281795843859212e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2816923679546847, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.33675807718470824, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17405300201958113, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20749655284102492, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, true}), Matrix({ { 0.24127529617103566 + -5.616939742394435e-20i, 0.0 + 0.0i, 0.020295454231218122 + 0.0182636679599761i, 0.0 + 0.0i, -0.07889041012215173 + -0.04918340412885033i, 0.0 + 0.0i, -0.0024933900252786445 + -0.010784803004252197i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020295454231218125 + -0.018263667959976103i, 0.0 + 0.0i, 0.28942556224647487 + 5.550273393112227e-20i, 0.0 + 0.0i, -0.010592653346335655 + 0.002163306620801489i, 0.0 + 0.0i, -0.09507814017092478 + -0.05899547045161585i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07889041012215173 + 0.04918340412885032i, 0.0 + 0.0i, -0.010592653346335657 + -0.0021633066208014895i, 0.0 + 0.0i, 0.21447007380323016 + -4.2904826734964396e-21i, 0.0 + 0.0i, 0.017064399606668508 + 0.014251464629614323i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002493390025278644 + 0.010784803004252198i, 0.0 + 0.0i, -0.09507814017092478 + 0.05899547045161586i, 0.0 + 0.0i, 0.017064399606668508 + -0.014251464629614321i, 0.0 + 0.0i, 0.2548290677792583 + 5.433863852790146e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.24127529617103566, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28942556224647487, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21447007380323016, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2548290677792583, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false, false}), Matrix({ { 0.2680749627898441 + -9.539578315098181e-21i, 0.0 + 0.0i, 0.001946110494595571 + 0.008314017698378532i, 0.0 + 0.0i, 0.025252369762815224 + 0.014761482565781896i, 0.0 + 0.0i, -0.00027448786985407323 + 0.0008903335200990448i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0019461104945955707 + -0.00831401769837853i, 0.0 + 0.0i, 0.2504613230296839 + 3.586395764269364e-19i, 0.0 + 0.0i, 0.0006411308513349558 + -0.0006760093188525565i, 0.0 + 0.0i, 0.023593184065412824 + 0.013791591780257864i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.025252369762815224 + -0.014761482565781896i, 0.0 + 0.0i, 0.0006411308513349556 + 0.0006760093188525568i, 0.0 + 0.0i, 0.24890903644207266 + -2.230311973436373e-19i, 0.0 + 0.0i, 0.0018069740007735638 + 0.007719609890939577i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00027448786985407323 + -0.0008903335200990451i, 0.0 + 0.0i, 0.023593184065412824 + -0.013791591780257866i, 0.0 + 0.0i, 0.001806974000773565 + -0.007719609890939575i, 0.0 + 0.0i, 0.23255467773839833 + -7.668730840661797e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2680749627898441, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2504613230296839, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24890903644207266, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23255467773839833, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true, false}), Matrix({ { 0.32038841694139597 + -2.8441890388102746e-19i, 0.0 + 0.0i, 0.0015573521691039692 + 0.01002897906472961i, 0.0 + 0.0i, -0.07512211264680319 + 0.00017225814460293778i, 0.0 + 0.0i, -0.001317634589261092 + -0.002194234693396413i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0015573521691039705 + -0.010028979064729607i, 0.0 + 0.0i, 0.29806202819799693 + 1.0516235036046288e-19i, 0.0 + 0.0i, -0.0006368040061428065 + 0.00179999144996412i, 0.0 + 0.0i, -0.07084637693454562 + -0.0009327661279499757i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07512211264680319 + -0.00017225814460293827i, 0.0 + 0.0i, -0.0006368040061428065 + -0.0017999914499641201i, 0.0 + 0.0i, 0.19659558229052077 + 5.184812822229195e-20i, 0.0 + 0.0i, 0.0021957323262651656 + 0.006004648524588499i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0013176345892610918 + 0.002194234693396414i, 0.0 + 0.0i, -0.07084637693454562 + 0.0009327661279499757i, 0.0 + 0.0i, 0.0021957323262651648 + -0.006004648524588499i, 0.0 + 0.0i, 0.18495397257008525 + 1.7678991765985554e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.32038841694139597, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29806202819799693, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19659558229052077, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18495397257008525, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, true}), Matrix({ { 0.2718823031684952 + -3.485044470493554e-19i, 0.0 + 0.0i, 0.0016891505791496316 + 0.007414762012390115i, 0.0 + 0.0i, -0.08845413149307679 + -0.054913304155411534i, 0.0 + 0.0i, 0.00134743234089123 + -0.003053819818355911i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016891505791496316 + -0.007414762012390113i, 0.0 + 0.0i, 0.2588185552490153 + 3.4783778355653327e-19i, 0.0 + 0.0i, -0.001676979625928528 + 0.0019939038154508917i, 0.0 + 0.0i, -0.08551441879999971 + -0.05326557042505464i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08845413149307679 + 0.05491330415541154i, 0.0 + 0.0i, -0.001676979625928528 + -0.0019939038154508926i, 0.0 + 0.0i, 0.24510169606342155 + 1.1593367139061988e-19i, 0.0 + 0.0i, 0.0020639339162195035 + 0.008618865576927993i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00134743234089123 + 0.003053819818355911i, 0.0 + 0.0i, -0.08551441879999971 + 0.05326557042505464i, 0.0 + 0.0i, 0.002063933916219504 + -0.008618865576927991i, 0.0 + 0.0i, 0.22419744551906687 + -6.588551553621485e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2718823031684952, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2588185552490153, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24510169606342155, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22419744551906687, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true, false}), Matrix({ { 0.32068899678601487 + 1.3387832622951386e-19i, 0.0 + 0.0i, 0.03020855450814785 + 0.017658661539406487i, 0.0 + 0.0i, -0.07568995843419915 + -0.0003943509850208731i, 0.0 + 0.0i, -0.007108196874081662 + -0.004204996568832761i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03020855450814785 + -0.01765866153940649i, 0.0 + 0.0i, 0.29776144835337803 + -3.131348797500785e-19i, 0.0 + 0.0i, -0.007151626556060192 + 0.004130701701558012i, 0.0 + 0.0i, -0.07027853114714966 + -0.00036615699832616487i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07568995843419915 + 0.0003943509850208724i, 0.0 + 0.0i, -0.007151626556060192 + -0.004130701701558014i, 0.0 + 0.0i, 0.1978472890335131 + 2.1522167188232432e-19i, 0.0 + 0.0i, 0.0186369993200802 + 0.010894412806633271i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007108196874081661 + 0.004204996568832761i, 0.0 + 0.0i, -0.07027853114714966 + 0.000366156998326165i, 0.0 + 0.0i, 0.0186369993200802 + -0.01089441280663327i, 0.0 + 0.0i, 0.18370226582709295 + 1.3416373999823164e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.32068899678601487, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29776144835337803, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1978472890335131, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18370226582709295, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, true}), Matrix({ { 0.27518765200505135 + 1.8973443196556469e-19i, 0.0 + 0.0i, 0.025922377346519372 + 0.015153141065902315i, 0.0 + 0.0i, -0.09020900591837974 + -0.05609467182909153i, 0.0 + 0.0i, -0.005408750739192311 + -0.010251393991788272i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.025922377346519372 + -0.015153141065902317i, 0.0 + 0.0i, 0.25551320641245917 + -1.9040109545838683e-19i, 0.0 + 0.0i, -0.011586429636326242 + -0.00031672009100632226i, 0.0 + 0.0i, -0.08375954437469676 + -0.05208420275137464i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09020900591837974 + 0.056094671829091544i, 0.0 + 0.0i, -0.011586429636326242 + 0.00031672009100632215i, 0.0 + 0.0i, 0.24334863381447658 + 1.593655661462735e-19i, 0.0 + 0.0i, 0.022923176481708676 + 0.013399933280137444i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005408750739192312 + 0.010251393991788272i, 0.0 + 0.0i, -0.08375954437469676 + 0.05208420275137464i, 0.0 + 0.0i, 0.022923176481708676 + -0.013399933280137447i, 0.0 + 0.0i, 0.22595050776801184 + -1.0931741029186847e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.27518765200505135, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25551320641245917, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24334863381447658, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22595050776801184, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, true}), Matrix({ { 0.3278973142540643 + -1.629925937609234e-19i, 0.0 + 0.0i, -0.07756135921778687 + -0.00017400279200303957i, 0.0 + 0.0i, -0.10752658010631189 + -0.0669498392205524i, 0.0 + 0.0i, 0.024171925842656757 + 0.015299925160775635i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07756135921778687 + 0.00017400279200303914i, 0.0 + 0.0i, 0.2028035441634462 + 1.6232593026810125e-19i, 0.0 + 0.0i, 0.025142744868936348 + 0.017369084973313624i, 0.0 + 0.0i, -0.06644197018676462 + -0.04122903535991376i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.10752658010631189 + 0.06694983922055242i, 0.0 + 0.0i, 0.025142744868936345 + -0.01736908497331362i, 0.0 + 0.0i, 0.2905531308853286 + -1.6263959759641204e-20i, 0.0 + 0.0i, -0.06840713036356194 + -0.0005865051913439983i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02417192584265676 + -0.015299925160775635i, 0.0 + 0.0i, -0.06644197018676462 + 0.04122903535991376i, 0.0 + 0.0i, -0.06840713036356194 + 0.0005865051913439982i, 0.0 + 0.0i, 0.17874601069715984 + 6.631211561404622e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3278973142540643, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2028035441634462, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2905531308853286, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17874601069715984, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false, false}), Matrix({ { 0.32990036348004714 + 1.01266588569682e-19i, 0.09461443223515509 + -0.06743639955367503i, 0.016495088285618957 + 0.023142739911985087i, 0.009461452043755588 + 0.003265433906990352i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09461443223515507 + 0.06743639955367503i, 0.19237474893666667 + 8.327211969760811e-20i, 3.139536154900084e-08 + 0.01000910252601218i, 0.00961877833100969 + 0.013495222415976437i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01649508828561895 + -0.023142739911985084i, 3.139536154894663e-08 + -0.010009102526012179i, 0.3017597628344254 + -9.360098086272073e-20i, 0.08654379258882207 + -0.06168405430373314i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.009461452043755586 + -0.003265433906990352i, 0.00961877833100969 + -0.013495222415976435i, 0.08654379258882207 + 0.06168405430373314i, 0.17596512474885972 + -4.1556235042986505e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.32990036348004714, 1.0e-7), DoubleNear(0.19237474893666667, 1.0e-7), DoubleNear(0.3017597628344254, 1.0e-7), DoubleNear(0.17596512474885972, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false, false}), Matrix({ { 0.150350563208859 + -7.904399653723472e-20i, 0.04312008942391589 + -0.03073382686432207i, 0.0075175601134875964 + 0.010547196563405862i, 0.004312012962175168 + 0.0014882063840678317i, 0.012325029360680246 + 0.010726754059907818i, 0.005727484832112368 + 0.0005569867783362637i, -0.00013623516933084122 + 0.0014009493632038898i, 0.00024730244900054727 + 0.0004296365011752033i }, { 0.043120089423915896 + 0.03073382686432207i, 0.08767390112784774 + 6.362281382652576e-20i, 1.4308290664484871e-08 + 0.004561602133827784i, 0.004383713689166466 + 0.0061503851328541925i, 0.0013420778864076852 + 0.005595814839693514i, 0.007187092502374011 + 0.006255090468564891i, -0.0003254461228099721 + 0.0003739396282445807i, -7.944279363593352e-05 + 0.0008169353897533112i }, { 0.0075175601134875964 + -0.010547196563405862i, 1.4308290664539081e-08 + -0.004561602133827784i, 0.13752561475632205 + -8.969060977339744e-20i, 0.039441932772368876 + -0.028112222150167593i, 0.0013687433441183627 + -0.00032826939783608836i, 0.0003254484686622094 + -0.0003739375865958938i, 0.011273700633649481 + 0.009811758698764713i, 0.005238928646044153 + 0.0005094756379158307i }, { 0.004312012962175168 + -0.0014882063840678317i, 0.004383713689166466 + -0.0061503851328541925i, 0.039441932772368876 + 0.028112222150167593i, 0.080195290881237 + 4.4651912386665607e-20i, 0.0004596544818972185 + 0.00018564423421032572i, 0.0007981550987270407 + -0.00019142368418799172i, 0.0012275982373453915 + 0.0051184901437473i, 0.0065740313411828954 + 0.005721529362352999i }, { 0.012325029360680247 + -0.010726754059907816i, 0.001342077886407685 + -0.005595814839693513i, 0.001368743344118363 + 0.00032826939783608847i, 0.0004596544818972186 + -0.00018564423421032572i, 0.17954980027118814 + 1.8031058510691675e-19i, 0.051494342811239185 + -0.03670257268935296i, 0.008977528172131356 + 0.012595543348579223i, 0.005149439081580419 + 0.00177722752292252i }, { 0.005727484832112368 + -0.0005569867783362637i, 0.007187092502374011 + -0.006255090468564892i, 0.0003254484686622094 + 0.0003739375865958939i, 0.0007981550987270407 + 0.00019142368418799182i, 0.05149434281123918 + 0.03670257268935295i, 0.10470084780881894 + 1.9649305871082386e-20i, 1.7087070884326235e-08 + 0.005447500392184396i, 0.005235064641843224 + 0.0073448372831222426i }, { -0.00013623516933084114 + -0.0014009493632038896i, -0.000325446122809972 + -0.0003739396282445807i, 0.011273700633649481 + -0.009811758698764713i, 0.0012275982373453915 + -0.0051184901437473i, 0.008977528172131356 + -0.012595543348579223i, 1.7087070884326235e-08 + -0.005447500392184395i, 0.16423414807810333 + -3.910371089323282e-21i, 0.04710185981645319 + -0.033571832153565545i }, { 0.0002473024490005472 + -0.00042963650117520323i, -7.944279363593346e-05 + -0.0008169353897533111i, 0.005238928646044154 + -0.0005094756379158314i, 0.0065740313411828954 + -0.0057215293623529995i, 0.005149439081580418 + -0.00177722752292252i, 0.005235064641843223 + -0.0073448372831222426i, 0.04710185981645319 + 0.033571832153565545i, 0.09576983386762274 + -8.620814742965211e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.150350563208859, 1.0e-7), DoubleNear(0.08767390112784774, 1.0e-7), DoubleNear(0.13752561475632205, 1.0e-7), DoubleNear(0.080195290881237, 1.0e-7), DoubleNear(0.17954980027118814, 1.0e-7), DoubleNear(0.10470084780881894, 1.0e-7), DoubleNear(0.16423414807810333, 1.0e-7), DoubleNear(0.09576983386762274, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false, false}), Matrix({ { 0.1705532092599779 + 8.290726099993703e-20i, 0.048914147561987704 + -0.0348635395350604i, 0.008527696709582838 + 0.01196442623288216i, 0.004891419316121761 + 0.001688177080463377i, 0.0012381439391936082 + 0.005289499569619762i, 0.0014363460750679985 + 0.0012639180654448363i, -0.00030915461305071606 + 0.0003513327609685699i, -1.684712221311766e-05 + 0.0001639568478907481i }, { 0.0489141475619877 + 0.0348635395350604i, 0.09945466705651396 + 3.735296447337159e-21i, 1.623089957087428e-08 + 0.005174545852620062i, 0.004972754489290696 + 0.006976814055135715i, -0.0007261541577481699 + 0.0017701070766216686i, 0.0007219986875347346 + 0.0030844650820390854i, -0.00016048210457593793 + 3.7565510884471436e-05i, -0.00018027728263427903 + 0.00020487261963457148i }, { 0.008527696709582835 + -0.011964426232882158i, 1.6230899570765858e-08 + -0.005174545852620062i, 0.15600496899741612 + -2.270939903108378e-19i, 0.0447417560012668 + -0.03188966908278272i, 0.00043296953323971926 + 0.0001776194442805064i, 0.00016048234023482722 + -3.756450412140126e-05i, 0.0011325298872201506 + 0.004838303658728137i, 0.0013138253210408833 + 0.0011561054727175137i }, { 0.00489141931612176 + -0.0016881770804633768i, 0.004972754489290696 + -0.006976814055135715i, 0.0447417560012668 + 0.03188966908278272i, 0.09097115391800872 + -9.211934279517194e-20i, 8.786638015131309e-05 + 0.00013944594915679171i, 0.00025247745827128927 + 0.00010357519961265308i, -0.0006642129887697817 + 0.0016191164083552113i, 0.0006604119814206414 + 0.002821359278931123i }, { 0.0012381439391936084 + -0.005289499569619761i, -0.0007261541577481701 + -0.0017701070766216684i, 0.00043296953323971926 + -0.00017761944428050644i, 8.786638015131306e-05 + -0.00013944594915679177i, 0.15934715422006923 + 1.8359327569744975e-20i, 0.04570028467316738 + -0.03257286001861463i, 0.007967391576036117 + 0.011178313679102927i, 0.004570032727633826 + 0.0015772568265269749i }, { 0.0014363460750679987 + -0.0012639180654448363i, 0.0007219986875347344 + -0.0030844650820390854i, 0.00016048234023482728 + 3.756450412140126e-05i, 0.00025247745827128927 + -0.0001035751996126531i, 0.04570028467316738 + 0.03257286001861463i, 0.09292008188015272 + 7.953682325027097e-20i, 1.5164461978018143e-08 + 0.0048345566733921175i, 0.004646023841718994 + 0.006518408360840722i }, { -0.00030915461305071616 + -0.00035133276096856983i, -0.00016048210457593793 + -3.756551088447143e-05i, 0.0011325298872201508 + -0.004838303658728137i, -0.0006642129887697817 + -0.0016191164083552115i, 0.007967391576036117 + -0.011178313679102925i, 1.5164461978099458e-08 + -0.0048345566733921175i, 0.14575479383700926 + 1.33493009448117e-19i, 0.04180203658755527 + -0.029794385220950417i }, { -1.684712221311768e-05 + -0.00016395684789074805i, -0.00018027728263427905 + -0.00020487261963457145i, 0.0013138253210408833 + -0.0011561054727175135i, 0.0006604119814206417 + -0.002821359278931123i, 0.004570032727633826 + -0.001577256826526975i, 0.004646023841718994 + -0.006518408360840721i, 0.04180203658755527 + 0.02979438522095042i, 0.084993970830851 + 5.056310775218544e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1705532092599779, 1.0e-7), DoubleNear(0.09945466705651396, 1.0e-7), DoubleNear(0.15600496899741612, 1.0e-7), DoubleNear(0.09097115391800872, 1.0e-7), DoubleNear(0.15934715422006923, 1.0e-7), DoubleNear(0.09292008188015272, 1.0e-7), DoubleNear(0.14575479383700926, 1.0e-7), DoubleNear(0.084993970830851, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false, false}), Matrix({ { 0.15527148801576088 + 9.131996749570335e-20i, 0.044531395861306555 + -0.03173973497533843i, -0.0003130219433460312 + 0.0072834327434046515i, 0.0013990651064791607 + 0.0021528528161918062i, 0.0034297612895438662 + 0.004898989296859001i, 0.0019850694004587693 + 0.0007039226501702639i, -0.01947525297108913 + 0.01098992850393744i, -0.003338943859346156 + 0.007132901466519825i }, { 0.044531395861306555 + 0.03173973497533843i, 0.0905434392643864 + 1.8723106014723887e-19i, -0.001578612610667472 + 0.002024880402837205i, -0.00018253243836302194 + 0.004247187031348363i, -1.7778951371812058e-05 + 0.002106108147970703i, 0.0019999961807517226 + 0.0028567468858932245i, -0.007831944120636692 + -0.0008291445701266078i, -0.011356601312195708 + 0.00640855534220941i }, { -0.00031302194334603174 + -0.007283432743404653i, -0.001578612610667472 + -0.002024880402837205i, 0.17226720778363994 + 6.453132017165043e-20i, 0.04940571718457766 + -0.035213905591213804i, -0.020844882877734977 + 0.0027377128451589175i, -0.005418621678190277 + 0.005046162966597588i, 0.027424027411495064 + 0.013136849251227017i, 0.01055049034019203 + -0.0018382584675919263i }, { 0.0013990651064791602 + -0.0021528528161918062i, -0.0001825324383630223 + -0.004247187031348363i, 0.04940571718457766 + 0.03521390559121381i, 0.10045415075574074 + 6.017650297245547e-21i, -0.006537877779285972 + -0.0034758273432282712i, -0.012155273391994978 + 0.0015964420763058293i, 0.005179766854852661 + 0.00937347619304218i, 0.015991768946437394 + 0.0076604889120605165i }, { 0.0034297612895438662 + -0.004898989296859002i, -1.7778951371812074e-05 + -0.002106108147970703i, -0.020844882877734977 + -0.002737712845158918i, -0.006537877779285972 + 0.0034758273432282712i, 0.1746288754642863 + 9.94662107397865e-21i, 0.05008303637384852 + -0.0356966645783366i, 0.016808110228964987 + 0.015859307168580434i, 0.008062386937276428 + 0.0011125810907985458i }, { 0.0019850694004587698 + -0.000703922650170264i, 0.001999996180751723 + -0.002856746885893225i, -0.005418621678190277 + -0.005046162966597588i, -0.012155273391994976 + -0.0015964420763058293i, 0.05008303637384852 + 0.0356966645783366i, 0.10183130967228028 + -1.0395894044963076e-19i, 0.001578644006029021 + 0.007984222123174975i, 0.009801310769372712 + 0.009248035384628074i }, { -0.01947525297108913 + -0.01098992850393744i, -0.007831944120636692 + 0.0008291445701266075i, 0.027424027411495064 + -0.013136849251227017i, 0.00517976685485266 + -0.009373476193042182i, 0.016808110228964987 + -0.01585930716858043i, 0.0015786440060290212 + -0.007984222123174973i, 0.12949255505078547 + -1.5813230103437115e-19i, 0.03713807540424441 + -0.026470148712519327i }, { -0.0033389438593461555 + -0.007132901466519825i, -0.011356601312195706 + -0.006408555342209408i, 0.010550490340192032 + 0.0018382584675919263i, 0.015991768946437397 + -0.007660488912060516i, 0.008062386937276426 + -0.0011125810907985458i, 0.009801310769372712 + -0.009248035384628074i, 0.03713807540424441 + 0.026470148712519327i, 0.07551097399311898 + -4.757388534023206e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.15527148801576088, 1.0e-7), DoubleNear(0.0905434392643864, 1.0e-7), DoubleNear(0.17226720778363994, 1.0e-7), DoubleNear(0.10045415075574074, 1.0e-7), DoubleNear(0.1746288754642863, 1.0e-7), DoubleNear(0.10183130967228028, 1.0e-7), DoubleNear(0.12949255505078547, 1.0e-7), DoubleNear(0.07551097399311898, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true, false}), Matrix({ { 0.2040270266458829 + -3.549819451408381e-20i, 0.05851433773244265 + -0.041706071322568324i, 0.01020139469285464 + 0.014312637800312387i, 0.0058514392281256685 + 0.0020195090533514522i, -0.0481550577695205 + -0.0002508918601356656i, -0.013862011686191233 + 0.009771634354599617i, -0.002390162884103213 + -0.003390655436053691i, -0.0013785904755180124 + -0.00048384596504443613i }, { 0.05851433773244264 + 0.04170607132256833i, 0.11897424911346058 + -9.21613991433216e-21i, 1.941647532550028e-08 + 0.006190133912658062i, 0.005948737740510097 + 0.008346126310415751i, -0.013759439845733731 + -0.009915544416708983i, -0.02808065153587645 + -0.00014630253236071726i, 7.607419643666208e-06 + -0.0014610136016632858i, -0.0013937753202108991 + -0.001977192390335222i }, { 0.010201394692854637 + -0.014312637800312385i, 1.9416475325283438e-08 + -0.006190133912658061i, 0.1866234596501082 + -8.207485608196698e-20i, 0.05352304705060836 + -0.03814853084214628i, -0.0024253633610223898 + 0.003365566143399237i, -7.616585110676289e-06 + 0.0014610135539104394i, -0.04404741679736715 + -0.00022949070868848967i, -0.012679577902575099 + 0.008938110992796905i }, { 0.005851439228125668 + -0.0020195090533514522i, 0.005948737740510097 + -0.00834612631041575i, 0.053523047050608355 + 0.03814853084214628i, 0.10882570972994121 + -5.2467363010181655e-20i, -0.0013835572526287284 + 0.0004694549454177737i, -0.0014143017689796868 + 0.0019625620749136653i, -0.012585755471088696 + -0.009069745483142762i, -0.025685363478584702 + -0.00013382288216216544i }, { -0.048155057769520504 + 0.00025089186013566576i, -0.013759439845733731 + 0.009915544416708983i, -0.0024253633610223898 + -0.0033655661433992365i, -0.0013835572526287286 + -0.00046945494541777364i, 0.12587333683416424 + 1.3676478308376581e-19i, 0.03610009450271243 + -0.0257303282311067i, 0.006293693592764315 + 0.008830102111672698i, 0.003610012815629919 + 0.0012459248536388996i }, { -0.013862011686191233 + -0.009771634354599615i, -0.028080651535876456 + 0.00014630253236071726i, -7.616585110676249e-06 + -0.0014610135539104392i, -0.0014143017689796865 + -0.001962562074913665i, 0.03610009450271243 + 0.025730328231106703i, 0.0734004998232061 + 9.248825961194029e-20i, 1.1978886223500563e-08 + 0.003818968613354118i, 0.0036700405904995935 + 0.005149096105560686i }, { -0.002390162884103213 + 0.003390655436053692i, 7.607419643666276e-06 + 0.0014610136016632858i, -0.04404741679736716 + 0.00022949070868848916i, -0.012585755471088696 + 0.009069745483142762i, 0.006293693592764315 + -0.008830102111672698i, 1.1978886223663193e-08 + -0.0038189686133541173i, 0.11513630318431718 + -1.152612478075375e-20i, 0.033020745538213714 + -0.02353552346158685i }, { -0.001378590475518012 + 0.0004838459650444362i, -0.001393775320210899 + 0.0019771923903352225i, -0.0126795779025751 + -0.008938110992796905i, -0.025685363478584702 + 0.00013382288216216517i, 0.003610012815629919 + -0.0012459248536388994i, 0.003670040590499593 + -0.005149096105560686i, 0.033020745538213714 + 0.02353552346158685i, 0.06713941501891851 + 1.0911127967195151e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2040270266458829, 1.0e-7), DoubleNear(0.11897424911346058, 1.0e-7), DoubleNear(0.1866234596501082, 1.0e-7), DoubleNear(0.10882570972994121, 1.0e-7), DoubleNear(0.12587333683416424, 1.0e-7), DoubleNear(0.0734004998232061, 1.0e-7), DoubleNear(0.11513630318431718, 1.0e-7), DoubleNear(0.06713941501891851, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, true}), Matrix({ { 0.17507840609110997 + 1.1380927623895453e-19i, 0.05021196040588224 + -0.0357885551317216i, 0.00875395751285061 + 0.012281871937423682i, 0.005021200721497205 + 0.001732968577545427i, -0.057392287975782864 + -0.035688250044958264i, -0.023755129422227697 + 0.0014965298690686596i, -0.00036607103761845445 + -0.005810528999141463i, -0.0012927441306445158 + -0.001591612036867501i }, { 0.05021196040588223 + 0.035788555131721606i, 0.10209344439854218 + 2.685726171657677e-20i, 1.6661545324252614e-08 + 0.005311839302543543i, 0.005104693917194597 + 0.007161926120693933i, -0.009164741803277247 + -0.0219670954656064i, -0.0334671561855065 + -0.020810883837668357i, 0.0010827679850189654 + -0.00174127245249999i, -0.00021346694866280304 + -0.0033882928942776565i }, { 0.008753957512850609 + -0.01228187193742368i, 1.6661545324415244e-08 + -0.005311839302543542i, 0.16014416517209412 + -1.534553640020378e-19i, 0.04592886501759491 + -0.032735780569663545i, -0.005373182154392427 + 0.0022416888254540787i, -0.0010827789086300342 + 0.001741265659870231i, -0.05249670847708763 + -0.032644031537096566i, -0.02172880970768031 + 0.0013688754192358009i }, { 0.005021200721497204 + -0.001732968577545427i, 0.005104693917194597 + -0.007161926120693933i, 0.04592886501759491 + 0.032735780569663545i, 0.09338484275576428 + 1.2122162553684396e-20i, -0.0019992460607947387 + -0.0004554464311135631i, -0.0031332628950096275 + 0.0013071956649024483i, -0.00838298655940387 + -0.020093295587603942i, -0.030612397654699516 + -0.019035709160743i }, { -0.057392287975782864 + 0.035688250044958264i, -0.009164741803277247 + 0.0219670954656064i, -0.005373182154392428 + -0.0022416888254540796i, -0.0019992460607947387 + 0.0004554464311135632i, 0.1548219573889372 + -1.2542687669272525e-20i, 0.044402471829272844 + -0.031647844421953425i, 0.007741130772768345 + 0.010860867974561404i, 0.004440251322258382 + 0.0015324653294449251i }, { -0.023755129422227697 + -0.0014965298690686596i, -0.0334671561855065 + 0.020810883837668357i, -0.0010827789086300344 + -0.0017412656598702312i, -0.0031332628950096275 + -0.0013071956649024488i, 0.044402471829272844 + 0.031647844421953425i, 0.0902813045381245 + 5.641485798103134e-20i, 1.4733816224748227e-08 + 0.004697263223468638i, 0.004514084413815093 + 0.006333296295282504i }, { -0.00036607103761845483 + 0.005810528999141463i, 0.0010827679850189654 + 0.0017412724524999898i, -0.05249670847708762 + 0.03264403153709656i, -0.00838298655940387 + 0.020093295587603942i, 0.007741130772768343 + -0.010860867974561404i, 1.4733816224531387e-08 + -0.004697263223468637i, 0.14161559766233128 + 5.985438313931707e-20i, 0.04061492757122716 + -0.02894827373406959i }, { -0.0012927441306445156 + 0.001591612036867501i, -0.00021346694866280298 + 0.0033882928942776565i, -0.02172880970768031 + -0.0013688754192358009i, -0.03061239765469952 + 0.019035709160743004i, 0.004440251322258382 + -0.0015324653294449251i, 0.004514084413815093 + -0.006333296295282502i, 0.04061492757122716 + 0.02894827373406959i, 0.08258028199309544 + -5.3678397596670905e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17507840609110997, 1.0e-7), DoubleNear(0.10209344439854218, 1.0e-7), DoubleNear(0.16014416517209412, 1.0e-7), DoubleNear(0.09338484275576428, 1.0e-7), DoubleNear(0.1548219573889372, 1.0e-7), DoubleNear(0.0902813045381245, 1.0e-7), DoubleNear(0.14161559766233128, 1.0e-7), DoubleNear(0.08258028199309544, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false, false}), Matrix({ { 0.28787617796518106 + -1.6873460631063216e-19i, 0.08256202219628478 + -0.05884604901448967i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02359872999432973 + 0.020538512758672533i, 0.010966413478156523 + 0.0010664624162520942i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08256202219628478 + 0.058846049014489664i, 0.16786919200908473 + 1.0827472621319136e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0025696761237530763 + 0.010714304983440816i, 0.013761123843556905 + 0.011976619830917891i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02359872999432973 + -0.02053851275867253i, 0.0025696761237530767 + -0.010714304983440812i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3437839483492915 + 1.7640021401759348e-19i, 0.09859620262769236 + -0.0702744048429185i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010966413478156523 + -0.0010664624162520947i, 0.013761123843556908 + -0.011976619830917891i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09859620262769236 + 0.0702744048429185i, 0.20047068167644166 + -6.655884155856974e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.28787617796518106, 1.0e-7), DoubleNear(0.16786919200908473, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3437839483492915, 1.0e-7), DoubleNear(0.20047068167644166, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false, false}), Matrix({ { 0.3265581782573941 + -1.4418672931090072e-19i, 0.0936559035632545 + -0.06675320861784312i, 0.0 + 0.0i, 0.0 + 0.0i, 0.002370673826413759 + 0.0101278032283479i, 0.002750171396108882 + 0.00242002353816235i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0936559035632545 + 0.06675320861784312i, 0.1904258209745227 + -8.838404634783479e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0013903671465179514 + 0.00338922348497688i, 0.001382410668955376 + 0.005905824360970208i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0023706738264137593 + -0.010127803228347897i, -0.0013903671465179518 + -0.0033892234849768796i, 0.0 + 0.0i, 0.0 + 0.0i, 0.30510194805707846 + 1.5185233701786202e-19i, 0.08750232126072265 + -0.06236724523956505i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002750171396108882 + -0.00242002353816235i, 0.0013824106689553763 + -0.005905824360970209i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08750232126072265 + 0.06236724523956505i, 0.1779140527110037 + 1.300999310024564e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3265581782573941, 1.0e-7), DoubleNear(0.1904258209745227, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.30510194805707846, 1.0e-7), DoubleNear(0.1779140527110037, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false, false}), Matrix({ { 0.3275386957994008 + 1.5585128766735378e-19i, 0.0939371130458842 + -0.06695364056655224i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03085378870103893 + 0.01803583854808602i, 0.0125355597406508 + -0.0011343358174216622i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09393711304588423 + 0.06695364056655224i, 0.19099759002012714 + 1.9324871044448442e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.005161987903480849 + 0.011479584341012884i, 0.017991765127189117 + 0.010517235797953741i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03085378870103893 + -0.01803583854808602i, 0.005161987903480848 + -0.011479584341012884i, 0.0 + 0.0i, 0.0 + 0.0i, 0.30412143051507173 + -1.4818567996039253e-19i, 0.08722111177809294 + -0.062166813290855924i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0125355597406508 + 0.0011343358174216622i, 0.017991765127189117 + -0.010517235797953741i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08722111177809293 + 0.062166813290855924i, 0.17734228366539925 + -1.5153282578986281e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.3275386957994008, 1.0e-7), DoubleNear(0.19099759002012714, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.30412143051507173, 1.0e-7), DoubleNear(0.17734228366539925, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true, false}), Matrix({ { 0.3906504862959911 + -1.175730505960508e-19i, 0.112037384783051 + -0.07985460216471461i, 0.0 + 0.0i, 0.0 + 0.0i, -0.09220247456688765 + -0.0004803825688241552i, -0.02654158958876633 + 0.01870974534739652i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.112037384783051 + 0.07985460216471461i, 0.2277999588434018 + -6.168350292451382e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.026345195316822428 + -0.018985289899851744i, -0.053766015014461155 + -0.0002801254145228827i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09220247456688767 + 0.0004803825688241549i, -0.02634519531682243 + 0.018985289899851744i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2410096400184814 + 1.2523865830301206e-19i, 0.06912084004092614 + -0.049265851692693555i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.026541589588766335 + -0.01870974534739652i, -0.053766015014461155 + 0.0002801254145228825i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06912084004092614 + 0.049265851692693555i, 0.14053991484212458 + 1.0339938757913544e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3906504862959911, 1.0e-7), DoubleNear(0.2277999588434018, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2410096400184814, 1.0e-7), DoubleNear(0.14053991484212458, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, true}), Matrix({ { 0.3352225712632041 + -3.96460877630833e-20i, 0.09614082542347716 + -0.06852433570138515i, 0.0 + 0.0i, 0.0 + 0.0i, -0.10988899645287048 + -0.06833228158205482i, -0.045483939129908 + 0.0028654052883044607i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09614082542347714 + 0.06852433570138515i, 0.19547828715430646 + 3.8979424270261175e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01754772836268112 + -0.04206039105321034i, -0.06407955384020601 + -0.03984659299841136i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1098889964528705 + 0.06833228158205482i, -0.01754772836268112 + 0.04206039105321034i, 0.0 + 0.0i, 0.0 + 0.0i, 0.29643755505126845 + 4.7311695470044574e-20i, 0.08501739940049999 + -0.06059611815602302i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.045483939129908 + -0.0028654052883044607i, -0.06407955384020603 + 0.03984659299841136i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08501739940049999 + 0.06059611815602302i, 0.1728615865312199 + 2.736460384360452e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.3352225712632041, 1.0e-7), DoubleNear(0.19547828715430646, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29643755505126845, 1.0e-7), DoubleNear(0.1728615865312199, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false, false}), Matrix({ { 0.14968726953612424 + -1.493692304632322e-19i, 0.042929858793100704 + -0.030598240056644393i, 0.024437319875483643 + -0.004822625158455147i, 0.006022735614247784 + -0.006378455562149013i, 0.0005538664173444278 + -0.005158245209243608i, -0.0008955726062214201 + -0.0015925875112091864i, 0.012961797500549852 + -0.014400586316606755i, 0.0007737166940803796 + -0.00677962348930625i }, { 0.042929858793100704 + 0.030598240056644393i, 0.08728711478903442 + 2.3176428393354404e-20i, 0.007994364100209464 + 0.0036122267745423227i, 0.014250130633807293 + -0.0028122166774441066i, 0.0012132670522557725 + -0.001366150919109703i, 0.000322976039968897 + -0.0030079267467737116i, 0.006661092399943241 + -0.001480466216727054i, 0.007558411011229464 + -0.008397411715387743i }, { 0.02443731987548365 + 0.004822625158455149i, 0.007994364100209466 + -0.003612226774542323i, 0.17687090872126982 + 5.182501152331457e-21i, 0.0507260447701538 + -0.03615496856119872i, 0.0052632589223170455 + 0.013696429045943787i, 0.004309234767873932 + 0.002852208516127175i, 0.001816807409069331 + 0.015286048437591508i, 0.003645744002330302 + 0.0040126110493715365i }, { 0.006022735614247784 + 0.006378455562149013i, 0.014250130633807295 + 0.0028122166774441066i, 0.0507260447701538 + 0.03615496856119872i, 0.10313870618548827 + -1.1156047474118922e-19i, -0.0012902611032889276 + 0.005003980814257937i, 0.0030691633773560576 + 0.007986796592910286i, -0.002603634198773724 + 0.004755374404086583i, 0.0010594346289864792 + 0.008913751107743919i }, { 0.0005538664173444286 + 0.005158245209243609i, 0.0012132670522557725 + 0.0013661509191097028i, 0.0052632589223170455 + -0.01369642904594379i, -0.0012902611032889278 + -0.005003980814257937i, 0.13818890842905682 + -1.9365375847399977e-20i, 0.039632163403184074 + -0.028247808957845275i, -0.0008385898811539188 + 0.025361137917127678i, 0.004943677863908737 + 0.007444917978401107i }, { -0.0008955726062214199 + 0.0015925875112091864i, 0.0003229760399688971 + 0.003007926746773711i, 0.004309234767873933 + -0.002852208516127175i, 0.0030691633773560576 + -0.007986796592910286i, 0.03963216340318407 + 0.02824780895784527i, 0.08058207722005031 + 8.509829781983695e-20i, -0.005424687976456388 + 0.00710207820889849i, -0.0004890067902503879 + 0.014788836508361998i }, { 0.012961797500549849 + 0.014400586316606755i, 0.006661092399943241 + 0.0014804662167270542i, 0.0018168074090693309 + -0.015286048437591506i, -0.002603634198773724 + -0.004755374404086583i, -0.0008385898811539181 + -0.025361137917127678i, -0.005424687976456388 + -0.00710207820889849i, 0.16691303962802168 + 1.71217712865262e-19i, 0.04787015785753858 + -0.034119436281719775i }, { 0.0007737166940803796 + 0.006779623489306249i, 0.007558411011229464 + 0.008397411715387743i, 0.003645744002330302 + -0.0040126110493715365i, 0.0010594346289864792 + -0.008913751107743919i, 0.0049436778639087384 + -0.007444917978401107i, -0.0004890067902503875 + -0.014788836508361998i, 0.04787015785753858 + 0.034119436281719775i, 0.09733197549095339 + 4.500163318261946e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.14968726953612424, 1.0e-7), DoubleNear(0.08728711478903442, 1.0e-7), DoubleNear(0.17687090872126982, 1.0e-7), DoubleNear(0.10313870618548827, 1.0e-7), DoubleNear(0.13818890842905682, 1.0e-7), DoubleNear(0.08058207722005031, 1.0e-7), DoubleNear(0.16691303962802168, 1.0e-7), DoubleNear(0.09733197549095339, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false, false}), Matrix({ { 0.1492742440979866 + -7.633773127178711e-20i, 0.04281140433941098 + -0.030513811691127393i, 0.012236797801317638 + 0.010649964122139052i, 0.0056864833137245 + 0.0005529994602894807i, 0.014061471346662824 + 0.008219749911893597i, 0.005713023311837416 + -0.0005169682967858973i, 0.0005662553544603902 + 0.0016770313225057045i, 0.0005052097591913972 + 0.00036521676671003993i }, { 0.04281140433941098 + 0.030513811691127393i, 0.08704626732791608 + 9.007227975554781e-20i, 0.0013324703129700434 + 0.005555755911251065i, 0.007135642046540552 + 0.006210311963796672i, 0.0023525520868745665 + 0.00523176741264571i, 0.008199663654380906 + 0.004793181519845025i, -0.00018040909333443678 + 0.0005967183142074758i, 0.0003302003989909187 + 0.0009779270208214652i }, { 0.012236797801317641 + -0.010649964122139052i, 0.0013324703129700434 + -0.005555755911251064i, 0.1782644517014142 + 2.321890189391409e-19i, 0.05112570870647323 + -0.036439828875424844i, 0.0017391307179713176 + -0.0003293987385052726i, 0.0004314436001822238 + -0.00044997400739394593i, 0.016792317354376106 + 0.009816088636192422i, 0.006822536428813383 + -0.0006173675206357651i }, { 0.0056864833137245 + -0.0005529994602894814i, 0.007135642046540554 + -0.006210311963796673i, 0.05112570870647323 + 0.036439828875424844i, 0.10395132269221107 + 1.0317643068893661e-19i, 0.0005661113205084039 + 0.00026103287199239216i, 0.001014139031883825 + -0.00019208223644118276i, 0.002809435816606282 + 0.006247816928367173i, 0.00979210147280821 + 0.005724054278108715i }, { 0.014061471346662824 + -0.008219749911893597i, 0.0023525520868745665 + -0.005231767412645711i, 0.0017391307179713171 + 0.0003293987385052724i, 0.0005661113205084039 + -0.00026103287199239216i, 0.13860193386719447 + -9.239687503884506e-20i, 0.039750617856873796 + -0.02833223732336227i, 0.011361932193012087 + 0.00988854863653348i, 0.005279930164432022 + 0.0005134629559626136i }, { 0.005713023311837417 + 0.0005169682967858973i, 0.008199663654380906 + -0.004793181519845025i, 0.0004314436001822237 + 0.000449974007393946i, 0.001014139031883825 + 0.00019208223644118276i, 0.039750617856873796 + 0.028332237323362267i, 0.08082292468116867 + 1.820244645764355e-20i, 0.001237205810783033 + 0.005158549072189749i, 0.006625481797016353 + 0.005766307867121219i }, { 0.0005662553544603902 + -0.0016770313225057047i, -0.00018040909333443678 + -0.0005967183142074758i, 0.016792317354376106 + -0.009816088636192422i, 0.0028094358166062816 + -0.006247816928367173i, 0.011361932193012087 + -0.00988854863653348i, 0.0012372058107830333 + -0.005158549072189749i, 0.16551949664787724 + -5.578880492154744e-20i, 0.04747049392121913 + -0.03383457596749366i }, { 0.0005052097591913973 + -0.00036521676671004i, 0.0003302003989909188 + -0.0009779270208214652i, 0.006822536428813384 + 0.000617367520635765i, 0.00979210147280821 + -0.005724054278108716i, 0.005279930164432022 + -0.0005134629559626132i, 0.006625481797016353 + -0.005766307867121219i, 0.04747049392121913 + 0.03383457596749366i, 0.09651935898423059 + -1.6973527224750636e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1492742440979866, 1.0e-7), DoubleNear(0.08704626732791608, 1.0e-7), DoubleNear(0.1782644517014142, 1.0e-7), DoubleNear(0.10395132269221107, 1.0e-7), DoubleNear(0.13860193386719447, 1.0e-7), DoubleNear(0.08082292468116867, 1.0e-7), DoubleNear(0.16551949664787724, 1.0e-7), DoubleNear(0.09651935898423059, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true, false}), Matrix({ { 0.1779338367240792 + -1.8630019833683554e-19i, 0.05103088932513332 + -0.03637224639847695i, 0.014270320305528491 + 0.01247558946684147i, 0.006642875643898672 + 0.0006609019463379046i, -0.04205241899356371 + -0.00018084018243514282i, -0.012097473661105307 + 0.00854425744951504i, -0.0035372590241108583 + -0.0032000019139804443i, -0.001668601865338445 + -0.00019468408791787012i }, { 0.05103088932513332 + 0.03637224639847695i, 0.1037585312306055 + 7.002023079583935e-20i, 0.0015424942616003492 + 0.006495021143607265i, 0.00832144971609859 + 0.007274888594251899i, -0.012023540970220027 + -0.008647986290586399i, -0.02452202071173412 + -0.00010545330816443828i, -0.0003603486378044184 + -0.0016408177651195308i, -0.0020626813184109792 + -0.0018660166309155135i }, { 0.014270320305528493 + -0.01247558946684147i, 0.0015424942616003492 + -0.006495021143607264i, 0.21271664957191191 + 6.872714774078478e-20i, 0.061006495457917684 + -0.04348235576623766i, -0.0037850731013016553 + 0.00283393839188174i, -0.0005062496415008605 + 0.0015864886246728872i, -0.05015005557332394 + -0.00029954238638901245i, -0.014444115927661025 + 0.010165487897881482i }, { 0.006642875643898672 + -0.0006609019463379048i, 0.008321449716098592 + -0.007274888594251899i, 0.061006495457917684 + 0.04348235576623766i, 0.12404142761279631 + -1.3170373372035318e-19i, -0.0016648455259639884 + 3.904139359589364e-05i, -0.0022071891036697083 + 0.001652554064776603i, -0.0143216543466024 + -0.010337303609265346i, -0.029243994302727026 + -0.00017467210635844441i }, { -0.04205241899356371 + 0.0001808401824351427i, -0.012023540970220029 + 0.008647986290586399i, -0.0037850731013016558 + -0.002833938391881741i, -0.0016648455259639888 + -3.9041393595893746e-05i, 0.10994234124110187 + 1.7565592026203396e-20i, 0.03153113287115146 + -0.022473802616012718i, 0.009328409688801234 + 0.00806292329183106i, 0.004323537834257851 + 0.0004055604699141896i }, { -0.012097473661105307 + -0.00854425744951504i, -0.02452202071173412 + 0.00010545330816443816i, -0.0005062496415008605 + -0.0015864886246728872i, -0.0022071891036697087 + -0.0016525540647766032i, 0.03153113287115145 + 0.022473802616012714i, 0.06411066077847925 + 3.825449541735201e-20i, 0.0010271818621527275 + 0.004219283839833549i, 0.005439674127458315 + 0.004701731236665992i }, { -0.003537259024110859 + 0.003200001913980445i, -0.0003603486378044187 + 0.0016408177651195308i, -0.05015005557332395 + 0.0002995423863890122i, -0.014321654346602401 + 0.010337303609265346i, 0.009328409688801236 + -0.00806292329183106i, 0.0010271818621527275 + -0.004219283839833549i, 0.13106729877737955 + 1.0767306627680868e-19i, 0.03758970716977468 + -0.02679204907668084i }, { -0.0016686018653384452 + 0.00019468408791787034i, -0.0020626813184109792 + 0.0018660166309155133i, -0.014444115927661025 + -0.010165487897881482i, -0.029243994302727033 + 0.0001746721063584443i, 0.004323537834257851 + -0.0004055604699141898i, 0.005439674127458317 + -0.004701731236665993i, 0.03758970716977468 + 0.02679204907668084i, 0.07642925406364534 + 6.514489216178342e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1779338367240792, 1.0e-7), DoubleNear(0.1037585312306055, 1.0e-7), DoubleNear(0.21271664957191191, 1.0e-7), DoubleNear(0.12404142761279631, 1.0e-7), DoubleNear(0.10994234124110187, 1.0e-7), DoubleNear(0.06411066077847925, 1.0e-7), DoubleNear(0.13106729877737955, 1.0e-7), DoubleNear(0.07642925406364534, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, true}), Matrix({ { 0.15240398405595834 + -1.2576364447419339e-19i, 0.0437090043482242 + -0.031153575746184735i, 0.012819829183300848 + 0.011536430810564102i, 0.006034901556616875 + 0.0006880554048266798i, -0.04983192642275895 + -0.03106719526460538i, -0.020642230116734026 + 0.0012763873771865057i, -0.0015749750583187562 + -0.006812330027942653i, -0.0018442367694450753 + -0.0016318081156191126i }, { 0.043709004348224195 + 0.031153575746184735i, 0.08887131211507734 + 6.959424705024903e-20i, 0.0013184753644306343 + 0.005929171927980964i, 0.007475625047917274 + 0.006727237149411999i, -0.007941063189995056 + -0.01909634374275211i, -0.029058483699392776 + -0.018116208864244948i, 0.0009408405478984934 + -0.0022757034190341386i, -0.0009184149669598879 + -0.003972472976309544i }, { 0.01281982918330085 + -0.0115364308105641i, 0.0013184753644306343 + -0.005929171927980963i, 0.18281858720724575 + 8.611755671111013e-20i, 0.052431821075252946 + -0.03737075995520041i, -0.006690956750751808 + 0.0013664745333524042i, -0.0016396191436873061 + 0.0017596289948074093i, -0.06005707003011153 + -0.03726508631744944i, -0.024841709013173983 + 0.0015890179111179546i }, { 0.0060349015566168755 + -0.0006880554048266799i, 0.007475625047917275 + -0.006727237149411999i, 0.052431821075252946 + 0.03737075995520041i, 0.10660697503922913 + -3.061482277998786e-20i, -0.0021982734091085553 + -0.0009758274204586999i, -0.0039016965955838484 + 0.0007968320874490845i, -0.009606665172686062 + -0.022964047310458226i, -0.035021070140813244 + -0.02173038413416641i }, { -0.04983192642275896 + 0.03106719526460538i, -0.007941063189995056 + 0.01909634374275211i, -0.0066909567507518085 + -0.0013664745333524047i, -0.0021982734091085553 + 0.0009758274204586999i, 0.13547219390922274 + -4.297096183643876e-20i, 0.03885301784806058 + -0.027692473268304933i, 0.010778900811028879 + 0.00900208194810843i, 0.004931511921539647 + 0.0003784070114254144i }, { -0.020642230116734026 + -0.001276387377186506i, -0.029058483699392772 + 0.018116208864244948i, -0.0016396191436873061 + -0.0017596289948074095i, -0.0039016965955838484 + -0.0007968320874490846i, 0.03885301784806058 + 0.02769247326830493i, 0.0789978798940074 + 3.868047916294233e-20i, 0.0012512007593224422 + 0.004785133055459851i, 0.006285498795639631 + 0.005249382681505892i }, { -0.0015749750583187558 + 0.006812330027942652i, 0.0009408405478984931 + 0.002275703419034139i, -0.06005707003011153 + 0.03726508631744944i, -0.009606665172686062 + 0.022964047310458226i, 0.010778900811028879 + -0.00900208194810843i, 0.0012512007593224424 + -0.004785133055459849i, 0.16096536114204574 + 9.028265730648335e-20i, 0.04616438155243942 + -0.03290364488771809i }, { -0.0018442367694450751 + 0.0016318081156191124i, -0.0009184149669598887 + 0.003972472976309545i, -0.024841709013173983 + -0.0015890179111179548i, -0.035021070140813244 + 0.021730384134166413i, 0.004931511921539647 + -0.00037840701142541474i, 0.006285498795639633 + -0.005249382681505892i, 0.04616438155243942 + 0.03290364488771808i, 0.09386370663721252 + -3.594401877858188e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.15240398405595834, 1.0e-7), DoubleNear(0.08887131211507734, 1.0e-7), DoubleNear(0.18281858720724575, 1.0e-7), DoubleNear(0.10660697503922913, 1.0e-7), DoubleNear(0.13547219390922274, 1.0e-7), DoubleNear(0.0789978798940074, 1.0e-7), DoubleNear(0.16096536114204574, 1.0e-7), DoubleNear(0.09386370663721252, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false, false}), Matrix({ { 0.16933226485758063 + -2.368910322710043e-20i, 0.04856398437876193 + -0.03461396086323251i, 0.00122928040083816 + 0.005251633469538549i, 0.0014260636611054067 + 0.0012548700170745388i, 0.01595091507411965 + 0.009324239942090687i, 0.006480683807332266 + -0.0005864334673626572i, -0.00017338304254381454 + 0.0005623881837677721i, 6.523453296117382e-05 + 0.00019673323833633706i }, { 0.048563984378761936 + 0.03461396086323251i, 0.09874269793226347 + 1.4149524912002237e-20i, -0.0007209558160809146 + 0.0017574353577122295i, 0.0007168300937574108 + 0.003062384228839982i, 0.0026686651503283094 + 0.005934761422136933i, 0.009301454688695575 + 0.005437242623691209i, -0.00016468600343813144 + 0.0001258492416685148i, -0.0001011048273102587 + 0.0003279453363312727i }, { 0.0012292804008381599 + -0.005251633469538548i, -0.0007209558160809144 + -0.0017574353577122297i, 0.1582064309418202 + 1.795403908944542e-19i, 0.04537312866712229 + -0.03233967970331973i, 0.000404976794538344 + -0.00042700813173616683i, 2.885949684564634e-05 + -0.0002052477546741512i, 0.014902873626919281 + 0.008711598605995331i, 0.006054875933318533 + -0.0005479023500590053i }, { 0.0014260636611054065 + -0.0012548700170745388i, 0.0007168300937574108 + -0.003062384228839982i, 0.04537312866712229 + 0.03233967970331973i, 0.09225489208786368 + 1.7909918553248219e-19i, 0.00020343275696980544 + -3.968154166143919e-05i, 0.00023615405679661182 + -0.0002490011871163897i, 0.002493322753152539 + 0.005544822918875949i, 0.008690310438493543 + 0.005079993174262531i }, { 0.01595091507411965 + -0.009324239942090687i, 0.0026686651503283094 + -0.005934761422136934i, 0.0004049767945383439 + 0.0004270081317361671i, 0.0002034327569698054 + 3.96815416614392e-05i, 0.15722591339981346 + -1.204976260838003e-19i, 0.04509191918449257 + -0.032139247754610606i, 0.0011413934255755985 + 0.00487616975880935i, 0.001324107735003475 + 0.001165153521087811i }, { 0.006480683807332267 + 0.0005864334673626572i, 0.009301454688695575 + -0.00543724262369121i, 2.8859496845646313e-05 + 0.00020524775467415133i, 0.0002361540567966118 + 0.00024900118711638976i, 0.04509191918449256 + 0.032139247754610606i, 0.09168312304225923 + -1.0253357125983703e-19i, -0.000669411330437037 + 0.0016317881272646501i, 0.0006655805751979652 + 0.0028434401321302265i }, { -0.0001733830425438146 + -0.0005623881837677724i, -0.0001646860034381315 + -0.00012584924166851482i, 0.014902873626919281 + -0.008711598605995335i, 0.0024933227531525387 + -0.005544822918875949i, 0.0011413934255755994 + -0.004876169758809348i, -0.0006694113304370373 + -0.0016317881272646501i, 0.1468955171152583 + -2.7688053876592197e-20i, 0.042129192593600366 + -0.030027565536245318i }, { 6.523453296117382e-05 + -0.00019673323833633715i, -0.00010110482731025864 + -0.0003279453363312727i, 0.006054875933318533 + 0.0005479023500590053i, 0.008690310438493543 + -0.005079993174262532i, 0.0013241077350034753 + -0.001165153521087811i, 0.0006655805751979655 + -0.0028434401321302265i, 0.04212919259360036 + 0.030027565536245318i, 0.08565916062314004 + -4.899925453002578e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.16933226485758063, 1.0e-7), DoubleNear(0.09874269793226347, 1.0e-7), DoubleNear(0.1582064309418202, 1.0e-7), DoubleNear(0.09225489208786368, 1.0e-7), DoubleNear(0.15722591339981346, 1.0e-7), DoubleNear(0.09168312304225923, 1.0e-7), DoubleNear(0.1468955171152583, 1.0e-7), DoubleNear(0.08565916062314004, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true, false}), Matrix({ { 0.20237658791489632 + -1.6590833866269418e-19i, 0.0580409968672676 + -0.04136869780612962i, 0.000983717267852332 + 0.006334906182832313i, 0.0015770734829449783 + 0.001615746025272724i, -0.04745164316348979 + 0.00010880860137858848i, -0.013586746522309956 + 0.00973100725937032i, -0.0008322972310889803 + -0.0013860105635943778i, -0.000522020922638226 + -0.0002273700857192664i }, { 0.0580409968672676 + 0.04136869780612962i, 0.11801182902649969 + -1.185105652183333e-19i, -0.0010128191741836873 + 0.002017918063053772i, 0.0005736349012516372 + 0.003694072881897296i, -0.013631230621933488 + -0.00966859529999484i, -0.027670469483313403 + 6.344954322434933e-05i, 4.462023632380604e-05 + -0.0005676372380864904i, -0.00048533735817211167 + -0.0008082241298020353i }, { 0.000983717267852333 + -0.006334906182832311i, -0.0010128191741836873 + -0.002017918063053772i, 0.18827389838109482 + 4.833528806664338e-20i, 0.0539963879157834 + -0.038485904358584996i, -0.00040224369895772773 + 0.0011369828266493075i, 0.00011705342964519357 + 0.000408307678065212i, -0.04475083140339787 + -0.0005891911702027437i, -0.012954843066456376 + 0.008978738088026201i }, { 0.0015770734829449783 + -0.001615746025272724i, 0.0005736349012516375 + -0.003694072881897296i, 0.0539963879157834 + 0.038485904358584996i, 0.10978812981690211 + 5.682706229381947e-20i, -0.0003477779962724496 + 0.00024385883348246204i, -0.00023456030718507867 + 0.0006630086233148122i, -0.01271396469488894 + -0.009316694599856906i, -0.026095545531147752 + -0.00034357495774723203i }, { -0.04745164316348979 + -0.00010880860137858878i, -0.013631230621933492 + 0.00966859529999484i, -0.0004022436989577278 + -0.001136982826649308i, -0.0003477779962724496 + -0.00024385883348246196i, 0.12418159034249775 + 2.1721609351793437e-20i, 0.035614906695986895 + -0.0253845108117135i, 0.0013869565585614267 + 0.0037928970455155865i, 0.0011730979131639033 + 0.0008042775128896259i }, { -0.013586746522309956 + -0.00973100725937032i, -0.027670469483313406 + -6.344954322434949e-05i, 0.00011705342964519355 + -0.00040830767806521217i, -0.0002345603071850788 + -0.0006630086233148122i, 0.035614906695986895 + 0.0253845108117135i, 0.072413991948023 + 3.0126518870498506e-20i, -0.0003775479723342642 + 0.0013713054219231082i, 0.000808775767703739 + 0.002211751479072912i }, { -0.0008322972310889803 + 0.0013860105635943778i, 4.462023632380603e-05 + 0.0005676372380864905i, -0.044750831403397875 + 0.0005891911702027436i, -0.01271396469488894 + 0.009316694599856906i, 0.0013869565585614262 + -0.003792897045515586i, -0.0003775479723342643 + -0.001371305421923108i, 0.11682804967598366 + 1.0351704895121864e-19i, 0.033505933344939245 + -0.023881340880980054i }, { -0.000522020922638226 + 0.00022737008571926628i, -0.0004853373581721116 + 0.0008082241298020356i, -0.012954843066456376 + -0.008978738088026201i, -0.026095545531147752 + 0.000343574957747232i, 0.0011730979131639035 + -0.0008042775128896259i, 0.0008087757677037388 + -0.002211751479072912i, 0.033505933344939245 + 0.023881340880980054i, 0.06812592289410159 + 7.327286870863694e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.20237658791489632, 1.0e-7), DoubleNear(0.11801182902649969, 1.0e-7), DoubleNear(0.18827389838109482, 1.0e-7), DoubleNear(0.10978812981690211, 1.0e-7), DoubleNear(0.12418159034249775, 1.0e-7), DoubleNear(0.072413991948023, 1.0e-7), DoubleNear(0.11682804967598366, 1.0e-7), DoubleNear(0.06812592289410159, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, true}), Matrix({ { 0.17173720996208158 + -2.479190064029477e-19i, 0.04925371540305902 + -0.03510556638091358i, 0.001066969068189822 + 0.004683609509338098i, 0.0012634009566636216 + 0.0011251412342435502i, -0.055872947871953904 + -0.034686544639152335i, -0.0231146241949891 + 0.001473240903935455i, 0.0008511192826475603 + -0.0019289762122043361i, -0.00015021214999859172 + -0.0007272056526236634i }, { 0.04925371540305902 + 0.03510556638091358i, 0.10014509320641363 + -1.0058544064640769e-19i, -0.0006513939159053408 + 0.0015613490130701594i, 0.0006221815109598095 + 0.0027311525030520164i, -0.008933762684275814 + -0.02136923430396244i, -0.03258118362112288 + -0.0202267595162592i, 0.000638409051891135 + -0.00037924350182761205i, 0.0004963130582436693 + -0.0011248436061515746i }, { 0.001066969068189822 + -0.004683609509338097i, -0.0006513939159053409 + -0.0015613490130701592i, 0.16348536130112248 + 2.0827291863986444e-19i, 0.04688711002041812 + -0.03341876932047157i, -0.0010592811623408118 + 0.0012594695359266204i, -4.6344886500152246e-05 + 0.0005777444460863574i, -0.05401604858091658 + -0.03364573694290248i, -0.022369314934918907 + 0.0013921643843690056i }, { 0.0012634009566636218 + -0.0011251412342435504i, 0.0006221815109598097 + -0.002731152503052017i, 0.04688711002041812 + 0.03341876932047157i, 0.09533319394789284 + 1.3956486491666885e-19i, -0.000561252417698227 + 0.00014467970526732077i, -0.000617698463587716 + 0.0007344342795242715i, -0.008613965678405304 + -0.020691156749247902i, -0.03149837021908314 + -0.01961983348215216i }, { -0.055872947871953904 + 0.034686544639152335i, -0.008933762684275814 + 0.02136923430396244i, -0.001059281162340812 + -0.0012594695359266208i, -0.0005612524176982271 + -0.00014467970526732072i, 0.15482096829531247 + 1.03732277092047e-19i, 0.04440218816019548 + -0.031647642236929535i, 0.001303704758223937 + 0.005444193719009802i, 0.00148677043944526 + 0.0012948823039187997i }, { -0.0231146241949891 + -0.0014732409039354551i, -0.03258118362112288 + 0.0202267595162592i, -4.6344886500152206e-05 + -0.0005777444460863574i, -0.000617698463587716 + -0.0007344342795242717i, 0.04440218816019548 + 0.031647642236929535i, 0.09028072776810907 + 1.2201394298572898e-20i, -0.0007389732306126106 + 0.0018278744719067205i, 0.0007602291579955666 + 0.003174671857918192i }, { 0.0008511192826475607 + 0.0019289762122043361i, 0.000638409051891135 + 0.000379243501827612i, -0.05401604858091658 + 0.03364573694290248i, -0.008613965678405304 + 0.020691156749247902i, 0.0013037047582239373 + -0.0054441937190097996i, -0.0007389732306126108 + -0.0018278744719067205i, 0.141616586755956 + -5.642058162200242e-20i, 0.040615211240304525 + -0.028948475919093487i }, { -0.0001502121499985918 + 0.0007272056526236634i, 0.0004963130582436692 + 0.0011248436061515746i, -0.022369314934918907 + -0.0013921643843690056i, -0.03149837021908314 + 0.01961983348215216i, 0.0014867704394452602 + -0.0012948823039187994i, 0.0007602291579955666 + -0.003174671857918192i, 0.040615211240304525 + 0.028948475919093483i, 0.08258085876311086 + -9.464933914212444e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.17173720996208158, 1.0e-7), DoubleNear(0.10014509320641363, 1.0e-7), DoubleNear(0.16348536130112248, 1.0e-7), DoubleNear(0.09533319394789284, 1.0e-7), DoubleNear(0.15482096829531247, 1.0e-7), DoubleNear(0.09028072776810907, 1.0e-7), DoubleNear(0.141616586755956, 1.0e-7), DoubleNear(0.08258085876311086, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true, false}), Matrix({ { 0.20256645221751585 + 5.305417641181843e-20i, 0.058095449378336626 + -0.0414075088120872i, 0.01908153935639432 + 0.011154272378526031i, 0.007752622501676948 + -0.0007015304912219848i, -0.047810328705283456 + -0.00024909579301052163i, -0.013762777285105159 + 0.009701681861068196i, -0.004489964535350566 + -0.002656128663820828i, -0.0018306593928445096 + 0.00015604389268857646i }, { 0.05809544937833663 + 0.0414075088120872i, 0.11812254456849902 + 8.082414981769546e-20i, 0.0031924337167118953 + 0.007099554045714629i, 0.011127015151753527 + 0.006504389160880456i, -0.013660939728775138 + -0.00984456170987613i, -0.027879629728915688 + -0.00014525519201035144i, -0.0007447572619714479 + -0.0016795833202898937i, -0.002618232338731096 + -0.0015488679050119328i }, { 0.01908153935639432 + -0.011154272378526035i, 0.0031924337167118953 + -0.00709955404571463i, 0.1880840340784753 + -1.7062722700786922e-19i, 0.053941935404714376 + -0.038447093352627415i, -0.0045173973337549215 + 0.0026091995585735433i, -0.0007622178930451399 + 0.001671731854268818i, -0.0443921458616042 + -0.00023128677581363359i, -0.012778812303661173 + 0.009008063486328325i }, { 0.007752622501676949 + 0.0007015304912219851i, 0.011127015151753527 + -0.006504389160880458i, 0.05394193540471437 + 0.038447093352627415i, 0.10967741427490278 + -1.4250765274220926e-19i, -0.0018289340499546185 + -0.00017511067920555377i, -0.0026342292223052698 + 0.0015215021429844685i, -0.01268425558804729 + -0.009140728189975614i, -0.025886385285545467 + -0.00013487022251253126i }, { -0.04781032870528347 + 0.0002490957930105211i, -0.013660939728775138 + 0.009844561709876132i, -0.004517397333754922 + -0.0026091995585735437i, -0.0018289340499546185 + 0.0001751106792055537i, 0.12497224358188495 + 1.0279711125553536e-19i, 0.03584166366754758 + -0.025546131754465046i, 0.011772249344644612 + 0.006881566169559986i, 0.004782937238973852 + -0.0004328053261996776i }, { -0.013762777285105162 + -0.009701681861068196i, -0.027879629728915688 + 0.0001452551920103513i, -0.0007622178930451397 + -0.0016717318542688183i, -0.0026342292223052706 + -0.0015215021429844692i, 0.03584166366754758 + 0.02554613175446505i, 0.07287504545162812 + 1.1242456062678897e-19i, 0.001969554186768953 + 0.004380030295298254i, 0.00686474997543559 + 0.004012846637073284i }, { -0.004489964535350566 + 0.002656128663820829i, -0.0007447572619714478 + 0.0016795833202898937i, -0.0443921458616042 + 0.0002312867758136338i, -0.012684255588047292 + 0.009140728189975614i, 0.011772249344644612 + -0.006881566169559986i, 0.001969554186768953 + -0.004380030295298253i, 0.11603739643659647 + 2.24415470474767e-20i, 0.03327917637337856 + -0.02371971993822851i }, { -0.0018306593928445096 + -0.00015604389268857635i, -0.0026182323387310955 + 0.001548867905011933i, -0.012778812303661173 + -0.009008063486328325i, -0.025886385285545467 + 0.00013487022251253115i, 0.004782937238973851 + 0.0004328053261996774i, 0.00686474997543559 + -0.004012846637073284i, 0.03327917637337856 + 0.023719719938228506i, 0.06766486939049647 + -9.025173047653534e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.20256645221751585, 1.0e-7), DoubleNear(0.11812254456849902, 1.0e-7), DoubleNear(0.1880840340784753, 1.0e-7), DoubleNear(0.10967741427490278, 1.0e-7), DoubleNear(0.12497224358188495, 1.0e-7), DoubleNear(0.07287504545162812, 1.0e-7), DoubleNear(0.11603739643659647, 1.0e-7), DoubleNear(0.06766486939049647, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, true}), Matrix({ { 0.17382506702569406 + 5.1163717891390106e-20i, 0.04985250653071353 + -0.03553235452284677i, 0.016374132149073864 + 0.009571634999748887i, 0.006652632315107373 + -0.0006019929920394055i, -0.05698143207310681 + -0.03543276749313288i, -0.023585072860864014 + 0.00148581661556503i, -0.003416492175121716 + -0.006475396823752412i, -0.0023035043273182646 + -0.0011587439872774467i }, { 0.04985250653071354 + 0.03553235452284677i, 0.10136258497935732 + 1.3857071407417458e-19i, 0.002739471411518095 + 0.006092225264051756i, 0.009548245197445505 + 0.005581506066153427i, -0.009099133889754665 + -0.021809838956848616i, -0.03322757384527293 + -0.02066190433595866i, 0.00034382496246335614 + -0.0025555046877696543i, -0.001992258564070595 + -0.003775997168035861i }, { 0.016374132149073864 + -0.009571634999748889i, 0.002739471411518095 + -0.006092225264051756i, 0.16139750423751004 + -9.080980565447341e-20i, 0.046288318892763615 + -0.03299198117853838i, -0.00731868560761559 + -0.0002000594526913849i, -0.0021398720668612792 + 0.0014386686037765764i, -0.052907564379763676 + -0.03289951408892194i, -0.02189886626904399 + 0.0013795886727394305i }, { 0.006652632315107372 + 0.0006019929920394055i, 0.009548245197445505 + -0.005581506066153428i, 0.04628831889276361 + 0.03299198117853838i, 0.09411570217494915 + -9.959128980391342e-20i, -0.002058081983068287 + -0.0015534215026821643i, -0.004267744028710652 + -0.00011666063831493732i, -0.008448594472926455 + -0.020250552096361722i, -0.030851979994933085 + -0.019184688662452702i }, { -0.056981432073106804 + 0.03543276749313288i, -0.009099133889754665 + 0.021809838956848616i, -0.007318685607615591 + 0.0002000594526913849i, -0.0020580819830682876 + 0.0015534215026821647i, 0.15371362877370676 + 1.0468756977596369e-19i, 0.044084606515170675 + -0.031421286043705476i, 0.014479656551965063 + 0.008464203548337133i, 0.005882927425543427 + -0.0005323428253822568i }, { -0.023585072860864014 + -0.00148581661556503i, -0.03322757384527293 + 0.02066190433595866i, -0.002139872066861279 + -0.0014386686037765764i, -0.004267744028710652 + 0.0001166606383149372i, 0.04408460651517068 + 0.031421286043705476i, 0.08963500504076982 + 5.467799637030984e-20i, 0.002422516491962754 + 0.005387359076961128i, 0.008443519929743612 + 0.004935729731800313i }, { -0.0034164921751217154 + 0.006475396823752411i, 0.0003438249624633561 + 0.002555504687769654i, -0.05290756437976369 + 0.03289951408892194i, -0.008448594472926455 + 0.020250552096361722i, 0.014479656551965063 + -0.008464203548337133i, 0.002422516491962753 + -0.005387359076961128i, 0.1427239262775617 + -5.737587430591911e-20i, 0.04093279288532932 + -0.029174832112317542i }, { -0.002303504327318265 + 0.0011587439872774467i, -0.0019922585640705956 + 0.003775997168035861i, -0.02189886626904399 + -0.0013795886727394305i, -0.030851979994933085 + 0.019184688662452702i, 0.005882927425543428 + 0.0005323428253822569i, 0.008443519929743612 + -0.004935729731800314i, 0.04093279288532932 + 0.029174832112317542i, 0.0832265814904501 + -5.1941535985949384e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.17382506702569406, 1.0e-7), DoubleNear(0.10136258497935732, 1.0e-7), DoubleNear(0.16139750423751004, 1.0e-7), DoubleNear(0.09411570217494915, 1.0e-7), DoubleNear(0.15371362877370676, 1.0e-7), DoubleNear(0.08963500504076982, 1.0e-7), DoubleNear(0.1427239262775617, 1.0e-7), DoubleNear(0.0832265814904501, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, true}), Matrix({ { 0.2071196589398988 + -1.0358911123077209e-19i, 0.05940129537481614 + -0.042338250035110034i, -0.048992417960629475 + -0.0001099106255757109i, -0.014073345470304989 + 0.009983235867084432i, -0.06792025317211628 + -0.04228954389878781i, -0.0281239179992909 + 0.001755366799615991i, 0.015268441731036645 + 0.009664352659657524i, 0.0063544764569762515 + -0.00034938275334563736i }, { 0.05940129537481614 + 0.042338250035110034i, 0.12077765531416554 + -5.94034825301513e-20i, -0.01402841083135321 + -0.010046279940911805i, -0.028568941257157386 + -6.409216642732865e-05i, -0.010834730747614416 + -0.026012394850507933i, -0.0396063269341956 + -0.024660295321764607i, 0.0024034098954887903 + 0.005892797317477277i, 0.00890348411162011 + 0.005635572501118111i }, { -0.04899241796062949 + 0.00010991062557571066i, -0.014028410831353212 + 0.010046279940911805i, 0.12810291232330526 + 6.394302346768879e-20i, 0.036739530048661005 + -0.026186085666275116i, 0.015881669399804905 + 0.010971358408210102i, 0.006797519162500819 + -9.989002811576928e-05i, -0.0419687432807542 + -0.02604273768326701i, -0.017360021130617107 + 0.0011100384886884695i }, { -0.01407334547030499 + -0.009983235867084432i, -0.028568941257157386 + 6.40921664273285e-05i, 0.036739530048661 + 0.02618608566627512i, 0.07470063184014092 + 9.838290680041248e-20i, 0.0023121108928165278 + 0.006392995229280401i, 0.00926107546913144 + 0.0063977265651035215i, -0.006712997615066703 + -0.016047996202702405i, -0.024473226906010417 + -0.015186297676646754i }, { -0.0679202531721163 + 0.04228954389878781i, -0.010834730747614416 + 0.026012394850507933i, 0.015881669399804905 + -0.0109713584082101i, 0.0023121108928165278 + -0.0063929952292804005i, 0.1835308273560923 + -1.3983939365278704e-20i, 0.05263608940823486 + -0.03751635212960458i, -0.04321005660625818 + -0.00037047194324844434i, -0.012468244118461343 + 0.008726509480312087i }, { -0.0281239179992909 + -0.001755366799615991i, -0.0396063269341956 + 0.024660295321764607i, 0.0067975191625008185 + 9.989002811576926e-05i, 0.00926107546913144 + -0.006397726565103521i, 0.05263608940823486 + 0.03751635212960458i, 0.10702230352923625 + -2.2800203943625125e-21i, -0.012316784485469218 + -0.008939009958939939i, -0.02519707375730377 + -0.00021603324809555405i }, { 0.015268441731036649 + -0.009664352659657524i, 0.002403409895488791 + -0.005892797317477279i, -0.0419687432807542 + 0.02604273768326701i, -0.006712997615066703 + 0.016047996202702405i, -0.04321005660625818 + 0.00037047194324844423i, -0.012316784485469218 + 0.008939009958939939i, 0.11290672769517617 + 6.129563483532328e-20i, 0.032381309992265135 + -0.02307976602641844i }, { 0.006354476456976252 + 0.0003493827533456376i, 0.008903484111620112 + -0.005635572501118111i, -0.017360021130617107 + -0.0011100384886884695i, -0.02447322690601042 + 0.015186297676646754i, -0.012468244118461345 + -0.008726509480312089i, -0.02519707375730377 + 0.00021603324809555397i, 0.032381309992265135 + 0.023079766026418435i, 0.06583928300198366 + 5.0164807787229644e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2071196589398988, 1.0e-7), DoubleNear(0.12077765531416554, 1.0e-7), DoubleNear(0.12810291232330526, 1.0e-7), DoubleNear(0.07470063184014092, 1.0e-7), DoubleNear(0.1835308273560923, 1.0e-7), DoubleNear(0.10702230352923625, 1.0e-7), DoubleNear(0.11290672769517617, 1.0e-7), DoubleNear(0.06583928300198366, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false, false}), Matrix({ { 0.2380244643367067 + -1.5421182710708967e-20i, 0.011901273802654062 + 0.016697581696260053i, 0.0 + 0.0i, 0.0 + 0.0i, 0.019512121863054257 + 0.01698184452847271i, -0.00021567796296677474 + 0.0022178847529572008i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.011901273802654062 + -0.016697581696260053i, 0.21772090563755905 + -4.503869738673182e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0021668984428454036 + -0.00051969308202408i, 0.017847731974832373 + 0.01553328806111771i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01951212186305426 + -0.016981844528472713i, 0.0021668984428454036 + 0.0005196930820240803i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2842506480800071 + 1.999598909779991e-19i, 0.01421259281397458 + 0.019940380631701466i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00021567796296677457 + -0.0022178847529572008i, 0.017847731974832377 + -0.015533288061117713i, 0.0 + 0.0i, 0.0 + 0.0i, 0.014212592813974582 + -0.019940380631701466i, 0.26000398194572605 + -9.011851851897537e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2380244643367067, 1.0e-7), DoubleNear(0.21772090563755905, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2842506480800071, 1.0e-7), DoubleNear(0.26000398194572605, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false, false}), Matrix({ { 0.2700078763164919 + 8.664255744727418e-20i, 0.013500451198873532 + 0.01894124028801787i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0019601426267283426 + 0.008373964651658848i, -0.0004894318956849951 + 0.0005562053806031414i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013500451198873532 + -0.01894124028801787i, 0.24697612291542484 + -3.1921333310600967e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0006854469915110086 + 0.0002811946438931595i, 0.001792941868640792 + 0.00765966293765926i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0019601426267283426 + -0.008373964651658846i, 0.0006854469915110086 + -0.00028119464389315957i, 0.0 + 0.0i, 0.0 + 0.0i, 0.25226723610022195 + 9.789615082001597e-20i, 0.012613415417755111 + 0.017696722039943647i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004894318956849952 + -0.0005562053806031412i, 0.0017929418686407927 + -0.0076596629376592595i, 0.0 + 0.0i, 0.0 + 0.0i, 0.012613415417755111 + -0.017696722039943644i, 0.2307487646678603 + 1.8405611720030246e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2700078763164919, 1.0e-7), DoubleNear(0.24697612291542484, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25226723610022195, 1.0e-7), DoubleNear(0.2307487646678603, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false, false}), Matrix({ { 0.24581492728014728 + 2.7855102764294225e-19i, -0.0004955543817090531 + 0.011530619774753014i, 0.0 + 0.0i, 0.0 + 0.0i, 0.005429757470295589 + 0.007755736182752226i, -0.03083185428328484 + 0.017398483846146853i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.000495554381709054 + -0.011530619774753014i, 0.27272135853938073 + 7.054897046889598e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.033000156269729956 + 0.004334154921464746i, 0.043415796357932454 + 0.020797338163287535i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.005429757470295589 + -0.0077557361827522275i, -0.033000156269729956 + -0.004334154921464748i, 0.0 + 0.0i, 0.0 + 0.0i, 0.27646018513656656 + -9.401231937565209e-20i, 0.026609420998337692 + 0.025107342553208505i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03083185428328484 + -0.017398483846146853i, 0.04341579635793246 + -0.020797338163287535i, 0.0 + 0.0i, 0.0 + 0.0i, 0.026609420998337695 + -0.025107342553208505i, 0.20500352904390445 + -2.057061863746032e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24581492728014728, 1.0e-7), DoubleNear(0.27272135853938073, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27646018513656656, 1.0e-7), DoubleNear(0.20500352904390445, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true, false}), Matrix({ { 0.3230012757593435 + -4.471433442841598e-20i, 0.016150132433364734 + 0.022658764110728136i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07623570930539694 + -0.00039719439249638285i, -0.003783938204314112 + -0.005367847826388914i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.016150132433364734 + -0.022658764110728136i, 0.29544916938004945 + -1.3454221909214864e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.003839665130002077 + 0.005328128218312902i, -0.06973278027595185 + -0.00036331359085065506i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07623570930539697 + 0.00039719439249638307i, -0.0038396651300020767 + -0.005328128218312902i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19927383665737036 + 2.2925304269570615e-19i, 0.009963734183263908 + 0.013979198217233386i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003783938204314112 + 0.005367847826388914i, -0.06973278027595187 + 0.0003633135908506543i, 0.0 + 0.0i, 0.0 + 0.0i, 0.009963734183263908 + -0.013979198217233382i, 0.18227571820323568 + -6.149968135586004e-22i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3230012757593435, 1.0e-7), DoubleNear(0.29544916938004945, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19927383665737036, 1.0e-7), DoubleNear(0.18227571820323568, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, true}), Matrix({ { 0.27717185048965215 + 1.4066653795553132e-19i, 0.013858651430045206 + 0.019443798058117613i, 0.0 + 0.0i, 0.0 + 0.0i, -0.09085944416128935 + -0.05649913388262662i, -0.0005795379862812575 + -0.00919882189341912i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013858651430045206 + -0.019443798058117613i, 0.2535290079278584 + -1.4133320144835341e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008506445049402055 + 0.003548884490356527i, -0.08310910613178715 + -0.05167974069783956i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09085944416128935 + 0.05649913388262662i, -0.008506445049402055 + -0.0035488844903565284i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2451032619270617 + 4.387217031175884e-20i, 0.012255215186583436 + 0.01719416426984391i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005795379862812576 + 0.00919882189341912i, -0.08310910613178715 + 0.05167974069783956i, 0.0 + 0.0i, 0.0 + 0.0i, 0.012255215186583436 + -0.017194164269843906i, 0.22419587965542673 + 6.1759855426461816e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.27717185048965215, 1.0e-7), DoubleNear(0.2535290079278584, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2451032619270617, 1.0e-7), DoubleNear(0.22419587965542673, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false, false}), Matrix({ { 0.1237658232133039 + 2.6608279589986248e-20i, 0.006188317463824893 + 0.008682258565597048i, 0.020205492563855995 + -0.003987487878128117i, 0.0012900039699006685 + 0.0012180541129825492i, 0.0004579529929650643 + -0.004264988376343166i, 0.00032208964746229603 + -0.0001811246043092872i, 0.010717194207303962 + -0.011906826985035958i, 0.0013711341810711695 + 0.0001564747466828194i }, { 0.006188317463824892 + -0.008682258565597047i, 0.11320856111185476 + -1.5280108165986402e-19i, 0.0007305538747734248 + -0.0016168045956660082i, 0.01848195794543494 + -0.0036473539577711375i, -0.0002762941535141416 + -0.0002453760461464928i, 0.00041888946434826067 + -0.0039011835796741545i, -0.0002994102050271429 + -0.001347162506150154i, 0.009803014304475353 + -0.01089117104695854i }, { 0.020205492563856 + 0.003987487878128117i, 0.0007305538747734249 + 0.0016168045956660082i, 0.14624205310318797 + 6.003427785728794e-20i, 0.00731213373504864 + 0.010258981722420827i, 0.004351816793265307 + 0.011324609108089495i, -0.00057683743957794 + 0.0008715158364673883i, 0.0015021896337632783 + 0.012638953028002014i, -0.000811521543147291 + 0.0007373299849124285i }, { 0.0012900039699006685 + -0.001218054112982549i, 0.01848195794543494 + 0.0036473539577711383i, 0.00731213373504864 + -0.010258981722420827i, 0.13376756180357008 + -1.664122514461457e-19i, 0.0010120209686321116 + 0.00026094988783520825i, 0.003980605506407796 + 0.01035861653076458i, 0.0009617411450251502 + 0.0005265706900396523i, 0.0013740524042925315 + 0.011560846517333415i }, { 0.00045795299296506474 + 0.004264988376343166i, -0.00027629415351414173 + 0.0002453760461464928i, 0.004351816793265307 + -0.011324609108089495i, 0.0010120209686321116 + -0.0002609498878352083i, 0.11425864112340284 + -4.2029462300695206e-20i, 0.0057129563388291695 + 0.008015323130663006i, -0.0006933707008017402 + 0.020969332406600826i, -0.001505681932867443 + 0.0009998306399746516i }, { 0.0003220896474622958 + 0.0001811246043092874i, 0.0004188894643482609 + 0.003901183579674155i, -0.00057683743957794 + -0.0008715158364673883i, 0.003980605506407796 + -0.010358616530764581i, 0.005712956338829169 + -0.008015323130663006i, 0.1045123445257043 + 1.0776238427313219e-19i, 0.0014363445680719788 + 0.001097111513641928i, -0.0006342259706025664 + 0.019180642018888847i }, { 0.01071719420730396 + 0.011906826985035958i, -0.00029941020502714295 + 0.001347162506150154i, 0.001502189633763278 + -0.012638953028002012i, 0.0009617411450251503 + -0.0005265706900396523i, -0.0006933707008017398 + -0.020969332406600826i, 0.0014363445680719788 + -0.001097111513641928i, 0.1380085949768191 + 1.3992561312071117e-19i, 0.006900459078925941 + 0.009681398909280641i }, { 0.0013711341810711693 + -0.00015647474668281956i, 0.009803014304475355 + 0.01089117104695854i, -0.000811521543147291 + -0.0007373299849124286i, 0.0013740524042925317 + -0.011560846517333415i, -0.001505681932867443 + -0.0009998306399746516i, -0.0006342259706025659 + -0.019180642018888854i, 0.006900459078925941 + -0.009681398909280641i, 0.12623642014215597 + 7.62937329271703e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1237658232133039, 1.0e-7), DoubleNear(0.11320856111185476, 1.0e-7), DoubleNear(0.14624205310318797, 1.0e-7), DoubleNear(0.13376756180357008, 1.0e-7), DoubleNear(0.11425864112340284, 1.0e-7), DoubleNear(0.1045123445257043, 1.0e-7), DoubleNear(0.1380085949768191, 1.0e-7), DoubleNear(0.12623642014215597, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false, false}), Matrix({ { 0.11202901497848808 + 3.503566387027239e-20i, -0.0002258466150343612 + 0.005255026575277403i, 0.009183609754357043 + 0.007992704953014525i, -0.00039343347008562245 + 0.000414669253018396i, 0.0024745868271704 + 0.0035346408560312167i, -0.014051474837328316 + 0.007929278457453491i, -4.93238448466564e-05 + 0.0004663024542688126i, -0.001717587578689854 + -0.0003524970165110603i }, { -0.0002258466150343616 + -0.005255026575277403i, 0.12429149644741458 + -2.1301115386511672e-20i, 0.00035640579154687336 + -0.0004468952858716408i, 0.010188830093501149 + 0.0088675711329212i, -0.01503966842835668 + 0.001975271038208738i, 0.01978654817387333 + 0.009478290575707406i, -0.001373806636799783 + -0.0009110810622107944i, 0.0009457795982979655 + 0.002188655889058357i }, { 0.009183609754357044 + -0.007992704953014525i, 0.0003564057915468734 + 0.0004468952858716408i, 0.1337859123016592 + 2.4351536377266986e-19i, -0.00026970776667469194 + 0.006275593199475611i, 0.0004550337357774893 + 0.00011320388611685206i, -0.0005861595604592292 + 0.0016525066434968177i, 0.0029551706431251894 + 0.004221095326721009i, -0.016780379445956523 + 0.009469205388693358i }, { -0.0003934334700856225 + -0.00041466925301839605i, 0.01018883009350115 + -0.008867571132921201i, -0.0002697077666746924 + -0.006275593199475611i, 0.1484298620919661 + 9.185008585540767e-20i, -0.0010919553929292787 + 0.0012349278509641546i, 0.002298236014077653 + -0.0006346848610633076i, -0.017960487841373274 + 0.002358883883256009i, 0.023629248184059128 + 0.01131904758758013i }, { 0.0024745868271703994 + -0.0035346408560312176i, -0.01503966842835668 + -0.0019752710382087385i, 0.00045503373577748937 + -0.00011320388611685212i, -0.0010919553929292784 + -0.0012349278509641546i, 0.12599544935821866 + -5.0456846580981355e-20i, 0.012127120417688424 + 0.011442555120982651i, 0.010328512108697216 + 0.008989139575458186i, 0.00017775550711884776 + 0.0018032154999388047i }, { -0.014051474837328316 + -0.007929278457453493i, 0.01978654817387333 + -0.009478290575707406i, -0.0005861595604592294 + -0.0016525066434968177i, 0.002298236014077653 + 0.0006346848610633074i, 0.012127120417688424 + -0.01144255512098265i, 0.09342940919014447 + -2.3737582000220153e-20i, 0.0018104926512985302 + -7.279779615243918e-05i, 0.007658901881331226 + 0.006665716928196511i }, { -4.9323844846656374e-05 + -0.0004663024542688127i, -0.001373806636799783 + 0.0009110810622107942i, 0.00295517064312519 + -0.004221095326721009i, -0.017960487841373274 + -0.002358883883256009i, 0.010328512108697216 + -0.008989139575458186i, 0.0018104926512985302 + 7.279779615243951e-05i, 0.15046473577834787 + -4.3555472794670734e-20i, 0.014482300580649272 + 0.013664787432225857i }, { -0.0017175875786898543 + 0.0003524970165110602i, 0.0009457795982979654 + -0.0021886558890583567i, -0.01678037944595652 + -0.009469205388693357i, 0.023629248184059128 + -0.011319047587580131i, 0.00017775550711884793 + -0.0018032154999388045i, 0.007658901881331227 + -0.006665716928196511i, 0.014482300580649273 + -0.013664787432225853i, 0.11157411985375996 + -1.8196860437438305e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.11202901497848808, 1.0e-7), DoubleNear(0.12429149644741458, 1.0e-7), DoubleNear(0.1337859123016592, 1.0e-7), DoubleNear(0.1484298620919661, 1.0e-7), DoubleNear(0.12599544935821866, 1.0e-7), DoubleNear(0.09342940919014447, 1.0e-7), DoubleNear(0.15046473577834787, 1.0e-7), DoubleNear(0.11157411985375996, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true, false}), Matrix({ { 0.14712091314046338 + -8.325499782298605e-20i, 0.007356076923690921 + 0.010320634365198023i, 0.011799119227737841 + 0.01031518314964139i, -0.0001336588021832502 + 0.0013434777686763876i, -0.034770172981164194 + -0.00014952396498706973i, -0.0017280268284176072 + -0.002446628043954577i, -0.002924709471917487 + -0.002645855405040696i, 3.93725014349596e-05 + -0.0003374637358669277i }, { 0.00735607692369092 + -0.010320634365198023i, 0.13457145481422128 + -3.302496971801013e-20i, 0.0013135757401398903 + -0.00031195506927230105i, 0.01079265079388924 + 0.00943529491145198i, -0.001749005248664263 + 0.002431675583901124i, -0.03180426672413363 + -0.00013676952561251138i, -0.0003318446917663459 + 7.2877070749367e-05i, -0.002675230870604351 + -0.0024201631398552614i }, { 0.011799119227737841 + -0.01031518314964139i, 0.0013135757401398903 + 0.00031195506927230126i, 0.17588036261888007 + 3.85406633945701e-20i, 0.008794055509673814 + 0.012338129745530111i, -0.0031296094167318476 + 0.002343183352157977i, -0.0003208570775642196 + -0.00010238461133532203i, -0.04146553632423275 + -0.0002476704275093131i, -0.002055911375896505 + -0.002921219782434337i }, { -0.0001336588021832501 + -0.0013434777686763873i, 0.010792650793889243 + -0.00943529491145198i, 0.008794055509673814 + -0.012338129745530111i, 0.16087771456582817 + -1.0151724937413847e-19i, 7.894805659244772e-06 + 0.00033670394251469535i, -0.0028626527882395164 + 0.002143309104500366i, -0.0020906598813378134 + 0.0028964526344117778i, -0.03792851355181822 + -0.0002265440652381437i }, { -0.0347701729811642 + 0.00014952396498706984i, -0.0017490052486642629 + -0.002431675583901124i, -0.0031296094167318485 + -0.0023431833521579777i, 7.894805659244779e-06 + -0.00033670394251469535i, 0.09090355119624334 + 6.783381511227709e-20i, 0.0045451968789631415 + 0.006376947331062029i, 0.007713002635316416 + 0.0066666613788313196i, -8.201916078352452e-05 + 0.0008744069842808132i }, { -0.0017280268284176072 + 0.002446628043954577i, -0.03180426672413363 + 0.00013676952561251103i, -0.0003208570775642195 + 0.00010238461133532211i, -0.0028626527882395164 + -0.002143309104500366i, 0.0045451968789631415 + -0.006376947331062029i, 0.08314945082333777 + -1.201372766872169e-20i, 0.0008533227027055132 + -0.00020773801275177897i, 0.007055081180943135 + 0.006097993149665732i }, { -0.002924709471917488 + 0.002645855405040696i, -0.00033184469176634584 + -7.2877070749367e-05i, -0.04146553632423276 + 0.0002476704275093132i, -0.0020906598813378134 + -0.0028964526344117778i, 0.007713002635316418 + -0.006666661378831321i, 0.0008533227027055135 + 0.00020773801275177905i, 0.108370285461127 + 1.61419227583429e-19i, 0.005418537304300766 + 0.007602250886171355i }, { 3.937250143495961e-05 + 0.00033746373586692765i, -0.002675230870604351 + 0.0024201631398552614i, -0.0020559113758965046 + 0.002921219782434337i, -0.03792851355181823 + 0.00022654406523814328i, -8.20191607835245e-05 + -0.0008744069842808132i, 0.007055081180943135 + -0.006097993149665732i, 0.005418537304300767 + -0.007602250886171355i, 0.09912626737989791 + 1.1398730855163094e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.14712091314046338, 1.0e-7), DoubleNear(0.13457145481422128, 1.0e-7), DoubleNear(0.17588036261888007, 1.0e-7), DoubleNear(0.16087771456582817, 1.0e-7), DoubleNear(0.09090355119624334, 1.0e-7), DoubleNear(0.08314945082333777, 1.0e-7), DoubleNear(0.108370285461127, 1.0e-7), DoubleNear(0.09912626737989791, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, true}), Matrix({ { 0.12601208243110368 + -7.50902383884963e-21i, 0.006300630902098004 + 0.008839835211782172i, 0.010599810640157725 + 0.00953865923693806i, -0.0001391507939700809 + 0.001220519076589448i, -0.041202497815147496 + -0.025687267920431998i, -0.000258153939627275 + -0.004174752729265374i, -0.0013022355557511182 + -0.005632634201437934i, 0.00033002115164091977 + -0.00037298563695473206i }, { 0.006300630902098004 + -0.008839835211782172i, 0.11526321373993195 + -4.866037358509473e-20i, 0.001199136363405925 + -0.00026664909851502696i, 0.009695643591060395 + 0.008725008723038039i, -0.00386211335489473 + 0.001606015018920291i, -0.03768791230700423 + -0.023496136208418332i, -0.00046024526072763753 + -0.00019028017732458397i, -0.0011911544695275258 + -0.005152168802814262i }, { 0.010599810640157727 + -0.009538659236938063i, 0.001199136363405925 + 0.0002666490985150271i, 0.15115976805854844 + 1.4817556179438094e-19i, 0.007558020527947204 + 0.01060396284633544i, -0.00553227921724874 + 0.00112984120857092i, -0.0003558742830791495 + -0.000331600933709722i, -0.04965694634614186 + -0.030811865962194616i, -0.0003213840466539827 + -0.005024069164153745i }, { -0.0001391507939700808 + -0.001220519076589448i, 0.009695643591060399 + -0.008725008723038039i, 0.007558020527947204 + -0.01060396284633544i, 0.13826579418792645 + -9.267282786325867e-20i, -0.00019735599012563987 + 0.00044458553480268147i, -0.005060374129086916 + 0.0010334654122305688i, -0.004644331694507325 + 0.0019428694714362362i, -0.04542119382478292 + -0.028183604489421234i }, { -0.041202497815147496 + 0.025687267920431998i, -0.0038621133548947303 + -0.0016060150189202915i, -0.00553227921724874 + -0.0011298412085709204i, -0.0001973559901256398 + -0.0004445855348026816i, 0.11201238190560305 + -7.912158871859337e-21i, 0.005600642900556059 + 0.00785774648447788i, 0.008912311222896532 + 0.007443185291534649i, -7.652716899669383e-05 + 0.0009973656763677527i }, { -0.000258153939627275 + 0.004174752729265374i, -0.03768791230700423 + 0.02349613620841833i, -0.0003558742830791495 + 0.0003316009337097219i, -0.005060374129086916 + -0.0010334654122305688i, 0.005600642900556058 + -0.00785774648447788i, 0.1024576918976271 + 3.62167619836291e-21i, 0.0009677620794394784 + -0.00025304398350905306i, 0.008152088383771978 + 0.006808279338079673i }, { -0.0013022355557511184 + 0.005632634201437934i, -0.00046024526072763753 + 0.00019028017732458397i, -0.049656946346141866 + 0.03081186596219462i, -0.004644331694507325 + -0.0019428694714362367i, 0.008912311222896532 + -0.007443185291534649i, 0.0009677620794394786 + 0.00025304398350905317i, 0.13309088002145864 + 5.1784329183618166e-20i, 0.006654572286027376 + 0.009336417785366025i }, { 0.00033002115164091977 + 0.00037298563695473206i, -0.0011911544695275258 + 0.005152168802814262i, -0.0003213840466539826 + 0.005024069164153745i, -0.04542119382478292 + 0.028183604489421234i, -7.652716899669378e-05 + -0.0009973656763677527i, 0.008152088383771978 + -0.006808279338079674i, 0.006654572286027377 + -0.009336417785366025i, 0.12173818775779963 + 2.554309344283293e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12601208243110368, 1.0e-7), DoubleNear(0.11526321373993195, 1.0e-7), DoubleNear(0.15115976805854844, 1.0e-7), DoubleNear(0.13826579418792645, 1.0e-7), DoubleNear(0.11201238190560305, 1.0e-7), DoubleNear(0.1024576918976271, 1.0e-7), DoubleNear(0.13309088002145864, 1.0e-7), DoubleNear(0.12173818775779963, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false, false}), Matrix({ { 0.12708238417619344 + 1.389680154902899e-19i, -0.0002561936860928463 + 0.005961145924774444i, 0.0009225641923054134 + 0.0039413049999051965i, -0.00018673752080902148 + 3.5329855892044636e-05i, 0.0028070977318527916 + 0.00400959150874693i, -0.015939575331108315 + 0.00899473775935291i, -0.00010397424705986774 + 0.00011616664239669843i, -0.0003946753648819626 + -0.0004290484895004079i }, { -0.00025619368609284686 + -0.005961145924774443i, 0.1409925786136506 + -1.485075938053881e-19i, 0.0001830178058758125 + -5.1220924705200135e-05i, 0.0010235463022901577 + 0.004372712698473334i, -0.017060552763603222 + 0.0022406887445895413i, 0.02244527203096243 + 0.010751891057034967i, -0.0001933446007658582 + -0.0005128457663818745i, -0.0001705136227942055 + 0.0007741668777023463i }, { 0.000922564192305413 + -0.0039413049999051965i, 0.00018301780587581253 + 5.1220924705200026e-05i, 0.11873254310395381 + 1.3958301215265233e-19i, -0.00023936069561620682 + 0.005569473849978572i, 0.00014473092421062993 + -5.7950775961376736e-05i, 0.00016324625633380903 + 0.000559644449432216i, 0.002622659738442797 + 0.003746144674005296i, -0.014892278952176524 + 0.008403746086793942i }, { -0.0001867375208090215 + -3.5329855892044575e-05i, 0.0010235463022901575 + -0.004372712698473334i, -0.0002393606956162072 + -0.005569473849978572i, 0.13172877992573007 + 2.1905656427428407e-19i, -5.436014891550599e-05 + 0.0005453786656544285i, 0.0004963999271243259 + -0.0006180585428911798i, -0.015939603506126734 + 0.0020934661768752054i, 0.020970524326970028 + 0.010045447106252568i }, { 0.002807097731852792 + -0.00400959150874693i, -0.017060552763603222 + -0.0022406887445895413i, 0.00014473092421062993 + 5.79507759613767e-05i, -5.4360148915505986e-05 + -0.0005453786656544287i, 0.14292549214029843 + -5.2325458043015723e-20i, 0.01375664488496638 + 0.012980094363243431i, 0.0010375784344229294 + 0.004432659651753651i, -0.00030269437487597363 + 0.0005208755247110967i }, { -0.015939575331108312 + -0.00899473775935291i, 0.022445272030962433 + -0.010751891057034967i, 0.00016324625633380913 + -0.0005596444494322159i, 0.0004963999271243258 + 0.00061805854289118i, 0.01375664488496638 + -0.01298009436324343i, 0.10598354430177423 + -1.7070573930062162e-19i, 0.0005024291856351961 + 0.00033241556859835966i, 0.0007693955663506346 + 0.0032869502391859257i }, { -0.00010397424705986774 + -0.00011616664239669846i, -0.00019334460076585817 + 0.0005128457663818742i, 0.0026226597384427968 + -0.0037461446740052967i, -0.015939603506126734 + -0.002093466176875206i, 0.0010375784344229299 + -0.0044326596517536496i, 0.000502429185635196 + -0.0003324155685983596i, 0.13353469299626813 + -4.168686133263637e-20i, 0.012852776113371317 + 0.012127248189965075i }, { -0.0003946753648819627 + 0.00042904848950040783i, -0.0001705136227942055 + -0.0007741668777023466i, -0.014892278952176524 + -0.008403746086793942i, 0.020970524326970028 + -0.010045447106252568i, -0.00030269437487597363 + -0.0005208755247110967i, 0.0007693955663506351 + -0.0032869502391859257i, 0.012852776113371317 + -0.012127248189965075i, 0.09901998474213022 + -3.5000447073981605e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.12708238417619344, 1.0e-7), DoubleNear(0.1409925786136506, 1.0e-7), DoubleNear(0.11873254310395381, 1.0e-7), DoubleNear(0.13172877992573007, 1.0e-7), DoubleNear(0.14292549214029843, 1.0e-7), DoubleNear(0.10598354430177423, 1.0e-7), DoubleNear(0.13353469299626813, 1.0e-7), DoubleNear(0.09901998474213022, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true, false}), Matrix({ { 0.16733089647508076 + -5.994097469042994e-21i, 0.008366580385520428 + 0.011738378750214107i, 0.0008133662791911897 + 0.005237886168456531i, -0.00032677287034238 + 0.0003189536317003106i, -0.039234409827590216 + 8.996614183719402e-05i, -0.0019680400170306194 + -0.0027478228069386713i, -0.000688167753230488 + -0.0011459941711622664i, 4.598375412194357e-05 + -0.0001055753985523i }, { 0.00836658038552043 + -0.011738378750214107i, 0.15305752046631524 + -2.7842480641198447e-19i, 0.0004081098439805771 + 0.00020483721149430978i, 0.0007439858899127795 + 0.004791092896273079i, -0.001955417642205325 + 0.0027568194593622494i, -0.035887702819212976 + 8.229200276574377e-05i, -0.00011480082194878453 + -9.024505665566032e-06i, -0.0006294668360306039 + -0.0010482405222341467i }, { 0.0008133662791911904 + -0.00523788616845653i, 0.00040810984398057686 + -0.00020483721149430984i, 0.15567037928426275 + -3.872023695937297e-20i, 0.007783552047844307 + 0.01092038536051403i, -0.00033258688389564835 + 0.0009400907368791353i, -8.257743381178643e-05 + 2.3673535448079892e-05i, -0.03700129947780673 + -0.0004871605343335769i, -0.0018158981872834928 + -0.0026200250194502424i }, { -0.00032677287034238006 + -0.0003189536317003105i, 0.0007439858899127801 + -0.004791092896273078i, 0.007783552047844307 + -0.010920385360514028i, 0.1423916489137342 + 1.4388258731983583e-19i, 4.931860405709031e-05 + 7.033593782279025e-05i, -0.000304217122247158 + 0.0008599007130849845i, -0.0018842474877967517 + 0.0025713087589506528i, -0.033845077456738884 + -0.0004456055936163989i }, { -0.039234409827590216 + -8.996614183719401e-05i, -0.0019554176422053246 + -0.0027568194593622494i, -0.00033258688389564846 + -0.0009400907368791354i, 4.931860405709031e-05 + -7.033593782279026e-05i, 0.10267697984141116 + 9.263665491631717e-20i, 0.005133870813353104 + 0.0072028615378037664i, 0.001146776347537153 + 0.003136078483202317i, -0.00016265902534261508 + 0.00023725174890283068i }, { -0.0019680400170306194 + 0.0027478228069386717i, -0.035887702819212976 + -8.229200276574429e-05i, -8.257743381178637e-05 + -2.3673535448079913e-05i, -0.0003042171222471581 + -0.0008599007130849845i, 0.005133870813353104 + -0.007202861537803765i, 0.09391860244910961 + -4.0788526694025235e-20i, 0.00027733714753043156 + 7.635743239884972e-05i, 0.0010489559787280126 + 0.0028685700413861818i }, { -0.000688167753230488 + 0.0011459941711622667i, -0.00011480082194878453 + 9.02450566556603e-06i, -0.03700129947780674 + 0.000487160534333577i, -0.0018842474877967517 + -0.0025713087589506523i, 0.0011467763475371524 + -0.0031360784832023163i, 0.00027733714753043167 + -7.635743239884973e-05i, 0.09659685681595918 + 1.3661638777938894e-19i, 0.004829863369910804 + 0.0067763366794296185i }, { 4.5983754121943626e-05 + 0.00010557539855230005i, -0.0006294668360306039 + 0.0010482405222341467i, -0.0018158981872834924 + 0.0026200250194502424i, -0.033845077456738884 + 0.0004456055936163986i, -0.0001626590253426151 + -0.0002372517489028307i, 0.0010489559787280126 + -0.0028685700413861818i, 0.004829863369910804 + -0.006776336679429618i, 0.08835711575412608 + 4.0173529880466635e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.16733089647508076, 1.0e-7), DoubleNear(0.15305752046631524, 1.0e-7), DoubleNear(0.15567037928426275, 1.0e-7), DoubleNear(0.1423916489137342, 1.0e-7), DoubleNear(0.10267697984141116, 1.0e-7), DoubleNear(0.09391860244910961, 1.0e-7), DoubleNear(0.09659685681595918, 1.0e-7), DoubleNear(0.08835711575412608, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, true}), Matrix({ { 0.14199736045144107 + 4.115644867833971e-21i, 0.007099898200363882 + 0.009961213581126753i, 0.0008822013086141321 + 0.0038725456635642307i, -0.00022755151836143485 + 0.00025551514147073914i, -0.046197391469269516 + -0.02867985210094079i, -0.00029796782255007726 + -0.004674777837588684i, 0.0007037303773128837 + -0.0015949340889322237i, 0.00014707240388627159 + -3.0379868062713472e-05i }, { 0.007099898200363883 + -0.009961213581126751i, 0.12988494271705414 + -3.5262009191718936e-19i, 0.00031577202420006396 + 0.00013174107090046199i, 0.0008069492705354993 + 0.003542216348825884i, -0.004321790960449804 + 0.0018067804372031275i, -0.04225674002380728 + -0.026233452054470748i, -7.669906703634095e-05 + -0.0001291142187528134i, 0.0006437019635783461 + -0.0014588857294236873i }, { 0.0008822013086141321 + -0.00387254566356423i, 0.000315772024200064 + -0.00013174107090046193i, 0.13517449003821108 + 1.3655089308769734e-19i, 0.006758753229681325 + 0.009482584476990862i, -0.0008758447226523615 + 0.0010413663393627306i, -0.00011684499514637007 + -9.37257807645694e-06i, -0.04466205269201985 + -0.027819281781685832i, -0.00028157016373118023 + -0.004524044055830435i }, { -0.00022755151836143488 + -0.00025551514147073914i, 0.0008069492705354995 + -0.003542216348825884i, 0.0067587532296813245 + -0.00948258447699086i, 0.12364406521080425 + 2.1128689046883595e-19i, 2.9260150605767204e-05 + 0.0001135096546426i, -0.0008011349032761663 + 0.0009525374760881613i, -0.004184654088952251 + 0.0017421040531533996i, -0.040852366107979876 + -0.025446288643368814i }, { -0.046197391469269516 + 0.02867985210094079i, -0.004321790960449804 + -0.0018067804372031279i, -0.0008758447226523618 + -0.0010413663393627308i, 2.9260150605767252e-05 + -0.0001135096546426i, 0.12801051586505086 + 8.252691257944021e-20i, 0.00640055299850965 + 0.00898002670689112i, 0.0010779413181142105 + 0.0045014189880946175i, -0.00026188037732356023 + 0.0003006902391324022i }, { -0.00029796782255007726 + 0.004674777837588684i, -0.04225674002380728 + 0.026233452054470748i, -0.00011684499514637002 + 9.372578076456962e-06i, -0.0008011349032761663 + -0.0009525374760881617i, 0.00640055299850965 + -0.00898002670689112i, 0.1170911801983707 + 3.340675881117967e-20i, 0.0003696749673109446 + 0.00014945357299269753i, 0.0009859925981052927 + 0.0041174465888333765i }, { 0.0007037303773128837 + 0.0015949340889322237i, -7.669906703634097e-05 + 0.00012911421875281341i, -0.04466205269201985 + 0.027819281781685832i, -0.004184654088952251 + -0.0017421040531534i, 0.0010779413181142108 + -0.004501418988094617i, 0.00036967496731094457 + -0.00014945357299269764i, 0.11709274606201084 + -3.8654742267681366e-20i, 0.005854662188073786 + 0.008214137562952785i }, { 0.00014707240388627153 + 3.0379868062713445e-05i, 0.000643701963578346 + 0.0014588857294236873i, -0.00028157016373118034 + 0.004524044055830435i, -0.040852366107979876 + 0.025446288643368814i, -0.0002618803773235603 + -0.0003006902391324021i, 0.0009859925981052931 + -0.004117446588833376i, 0.005854662188073786 + -0.008214137562952785i, 0.10710469945705604 + -2.7230773268533495e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.14199736045144107, 1.0e-7), DoubleNear(0.12988494271705414, 1.0e-7), DoubleNear(0.13517449003821108, 1.0e-7), DoubleNear(0.12364406521080425, 1.0e-7), DoubleNear(0.12801051586505086, 1.0e-7), DoubleNear(0.1170911801983707, 1.0e-7), DoubleNear(0.11709274606201084, 1.0e-7), DoubleNear(0.10710469945705604, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true, false}), Matrix({ { 0.15202435119831476 + 9.73582581759331e-20i, -0.0003064758279587409 + 0.0071311169324290965i, 0.0033580359245032544 + 0.004796538494606815i, -0.01906797400597043 + 0.01076010007940007i, -0.035881233651632226 + -0.00018694421462242376i, 8.110445299512904e-05 + -0.0016827302793940599i, -0.000786675197448377 + -0.0011362224700915565i, 0.004513710886586462 + -0.0025161825367037236i }, { -0.00030647582795874096 + -0.007131116932429097i, 0.16866464558770014 + 3.652006805358076e-20i, -0.02040896133468404 + 0.002680460040482966i, 0.026850518583644588 + 0.012862123044799674i, 6.356619621185116e-05 + 0.0016834840255210046i, -0.039808724782566925 + -0.00020740677039844934i, 0.004820279126059801 + -0.0006075531652029505i, -0.006321521676633284 + -0.0030687740987412043i }, { 0.003358035924503255 + -0.004796538494606815i, -0.02040896133468404 + -0.0026804600404829668i, 0.17097692456102875 + -1.4207259260434908e-19i, 0.016456608261323474 + 0.015527647178299039i, -0.0007984717960158106 + 0.001127963722283961i, 0.004813686807222127 + 0.0006577469297926095i, -0.040354475653764724 + -0.00021025017787395904i, -0.0038650426573092413 + -0.003685117546994854i }, { -0.019067974005970427 + -0.010760100079400068i, 0.02685051858364459 + -0.012862123044799676i, 0.016456608261323474 + -0.015527647178299039i, 0.1267845237923493 + -1.710622871457294e-19i, 0.004487247514860204 + 0.002563078279351385i, -0.006353154760044381 + 0.003002737979274051i, -0.0039032313262139283 + 0.0036446441927918977i, -0.029924055493384935 + -0.00015590682045220578i }, { -0.03588123365163223 + 0.00018694421462242387i, 6.356619621185129e-05 + -0.0016834840255210044i, -0.0007984717960158105 + -0.0011279637222839614i, 0.004487247514860204 + -0.0025630782793513857i, 0.09379057608183254 + 1.8119276946700916e-19i, -0.0001890785537503122 + 0.0043995028423239185i, 0.0020717215457923344 + 0.0029591976881454107i, -0.011763880277314412 + 0.006638383766746781i }, { 8.110445299512915e-05 + 0.0016827302793940599i, -0.03980872478256692 + 0.00020740677039844858i, 0.004813686807222128 + -0.000657746929792609i, -0.006353154760044383 + -0.0030027379792740517i, -0.00018907855375031304 + -0.004399502842323918i, 0.10405671295168054 + 3.402890241531521e-20i, -0.012591194935045916 + 0.0016536948809817808i, 0.016565277774287866 + 0.00793521511848786i }, { -0.000786675197448377 + 0.001136222470091557i, 0.004820279126059801 + 0.0006075531652029499i, -0.040354475653764724 + 0.00021025017787395917i, -0.003903231326213928 + -0.0036446441927918973i, 0.002071721545792334 + -0.0029591976881454115i, -0.012591194935045914 + -0.001653694880981781i, 0.10548326057553781 + 4.806027322869698e-20i, 0.01015281273701422 + 0.009579695374909467i }, { 0.004513710886586462 + 0.0025161825367037245i, -0.006321521676633284 + 0.0030687740987412047i, -0.003865042657309241 + 0.003685117546994854i, -0.029924055493384942 + 0.00015590682045220575i, -0.011763880277314412 + -0.006638383766746782i, 0.01656527777428787 + -0.007935215118487859i, 0.010152812737014221 + -0.009579695374909466i, 0.07821900525155515 + -3.464389922887381e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.15202435119831476, 1.0e-7), DoubleNear(0.16866464558770014, 1.0e-7), DoubleNear(0.17097692456102875, 1.0e-7), DoubleNear(0.1267845237923493, 1.0e-7), DoubleNear(0.09379057608183254, 1.0e-7), DoubleNear(0.10405671295168054, 1.0e-7), DoubleNear(0.10548326057553781, 1.0e-7), DoubleNear(0.07821900525155515, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, true}), Matrix({ { 0.13045419291941224 + 2.6967358304774085e-19i, -0.0002629911357655536 + 0.006119309812547354i, 0.0028815769504847624 + 0.0041159758498463565i, -0.016362491534742882 + 0.009233390312313334i, -0.042764066539325296 + -0.026591982188245492i, 0.001333580347825357 + -0.0019523566908877603i, -0.00010560022375718954 + -0.0019366392325504214i, 0.00724592139439304 + 0.0003085662855830029i }, { -0.00026299113576555414 + -0.006119309812547354i, 0.14473345908563914 + -7.993915108217613e-20i, -0.017513211260257698 + 0.0023001397373358214i, 0.023040800396034608 + 0.011037165216055958i, -0.0011611585930707447 + 0.002059573721501169i, -0.04744493937905445 + -0.02950268964084604i, 0.006209853347351351 + 0.002815913117806079i, -0.005303150515435121 + -0.008314754759237852i }, { 0.002881576950484763 + -0.004115975849846357i, -0.017513211260257698 + -0.0023001397373358223i, 0.1467176575702399 + -1.2900704509220953e-19i, 0.01412164256581076 + 0.013324488245570261i, -0.0017836138473434648 + 0.0007618691277875085i, 0.00527212534402846 + 0.004323926414671731i, -0.04809537762196407 + -0.029907151694381122i, -0.0019131183341066144 + -0.0072464652025313585i }, { -0.016362491534742882 + -0.009233390312313334i, 0.023040800396034608 + -0.011037165216055958i, 0.01412164256581076 + -0.01332448824557026i, 0.10879554884221926 + -6.13940503661773e-20i, 0.0034816245906278617 + 0.006362144309606364i, -0.009802815788982778 + -0.0010785892187938307i, -0.00734528645633131 + 0.0014893107688553585i, -0.0356641667527327 + -0.022177051056993517i }, { -0.04276406653932529 + 0.026591982188245492i, -0.0011611585930707447 + -0.002059573721501169i, -0.0017836138473434644 + -0.0007618691277875086i, 0.0034816245906278617 + -0.006362144309606364i, 0.11536073436073505 + 8.877444595201404e-21i, -0.00023256324594349954 + 0.00541130996220566i, 0.0025481805198108265 + 0.003639760332905869i, -0.014469362748541957 + 0.008165093533833517i }, { 0.0013335803478253573 + 0.0019523566908877601i, -0.04744493937905445 + 0.02950268964084604i, 0.005272125344028461 + -0.0043239264146717315i, -0.009802815788982778 + 0.0010785892187938307i, -0.00023256324594349986 + -0.005411309962205661i, 0.12798789945374156 + 1.504881215510721e-19i, -0.015486945009472258 + 0.002034015184128925i, 0.02037499596189785 + 0.009760172947231575i }, { -0.00010560022375718974 + 0.0019366392325504216i, 0.00620985334735135 + -0.0028159131178060793i, -0.04809537762196407 + 0.029907151694381122i, -0.007345286456331311 + -0.0014893107688553594i, 0.0025481805198108265 + -0.0036397603329058697i, -0.015486945009472257 + -0.0020340151841289258i, 0.12974252756632665 + 3.499472571655744e-20i, 0.012487778432526934 + 0.011782854307638245i }, { 0.00724592139439304 + -0.0003085662855830029i, -0.005303150515435121 + 0.00831475475923785i, -0.0019131183341066149 + 0.0072464652025313585i, -0.03566416675273269 + 0.022177051056993517i, -0.014469362748541957 + -0.008165093533833517i, 0.020374995961897853 + -0.009760172947231577i, 0.012487778432526936 + -0.011782854307638245i, 0.0962079802016852 + -1.443121360084259e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.13045419291941224, 1.0e-7), DoubleNear(0.14473345908563914, 1.0e-7), DoubleNear(0.1467176575702399, 1.0e-7), DoubleNear(0.10879554884221926, 1.0e-7), DoubleNear(0.11536073436073505, 1.0e-7), DoubleNear(0.12798789945374156, 1.0e-7), DoubleNear(0.12974252756632665, 1.0e-7), DoubleNear(0.0962079802016852, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, true}), Matrix({ { 0.1712526066631802 + -2.733371125081634e-20i, 0.00856266672838141 + 0.012013489447080184i, -0.0405083676046628 + -9.087732775420955e-05i, -0.0020190518814793418 + -0.002846234042828058i, -0.05615845671280888 + -0.034966234805194965i, -0.0003550290834127834 + -0.005687873962599837i, 0.012624395286802042 + 0.007990770133311412i, 7.066436566104936e-05 + 0.001285150313310435i }, { 0.00856266672838141 + -0.012013489447080184i, 0.15664470759088417 + -1.3565888251010705e-19i, -0.0020318020969560765 + 0.0028371462714254815i, -0.03705299161312406 + -8.312546424883003e-05i, -0.0052608404578641495 + 0.002191235619779355i, -0.05136812339350301 + -0.03198360441535745i, 0.001191780528983307 + -0.0004860699035246431i, 0.011547530555854715 + 0.007309155027464223i }, { -0.04050836760466281 + 9.087732775420968e-05i, -0.002031802096956076 + -0.0028371462714254815i, 0.10591924382647196 + 1.6800024920634766e-19i, 0.005295984701663795 + 0.00743030861103743i, 0.0131314299028885 + 0.009071440807012839i, 2.0206404959900888e-05 + 0.00137475290757564i, -0.034700987448480484 + -0.021532899077431653i, -0.0002245089028684741 + -0.0035109479308192823i }, { -0.0020190518814793418 + 0.0028462340428280584i, -0.037052991613124066 + 8.312546424882948e-05i, 0.005295984701663795 + -0.007430308611037429i, 0.09688430033697423 + -5.674318938246365e-21i, 0.0012929421668067564 + -0.0004676049710836376i, 0.012011314966047848 + 0.008297644166300785i, -0.0032456045915379055 + 0.001357648870577172i, -0.03174098273828414 + -0.01969613628248211i }, { -0.056158456712808884 + 0.034966234805194965i, -0.00526084045786415 + -0.002191235619779356i, 0.0131314299028885 + -0.009071440807012837i, 0.0012929421668067564 + 0.0004676049710836375i, 0.1517486690961633 + -1.738062317759964e-20i, 0.007587465704983322 + 0.010645274663647952i, -0.03572734170073415 + -0.0003063170647421733i, -0.0017648863228347704 + -0.0025216137835608558i }, { -0.0003550290834127834 + 0.005687873962599837i, -0.05136812339350301 + 0.03198360441535745i, 2.0206404959900834e-05 + -0.0013747529075756402i, 0.012011314966047846 + -0.008297644166300784i, 0.007587465704983324 + -0.010645274663647952i, 0.13880446178916528 + 1.1166634179584167e-21i, -0.0018078630330460007 + 0.0024909819468874207i, -0.032679788662827794 + -0.00028018812660182506i }, { 0.012624395286802044 + -0.007990770133311412i, 0.0011917805289833072 + 0.000486069903524643i, -0.03470098744848048 + 0.021532899077431653i, -0.003245604591537905 + -0.0013576488705771723i, -0.035727341700734154 + 0.0003063170647421734i, -0.0018078630330460004 + -0.0024909819468874207i, 0.09335459283089839 + 6.125279348935848e-20i, 0.004667749481600113 + 0.006548889606195955i }, { 7.06643656610493e-05 + -0.0012851503133104348i, 0.011547530555854717 + -0.007309155027464223i, -0.0002245089028684742 + 0.003510947930819282i, -0.03174098273828414 + 0.01969613628248211i, -0.0017648863228347702 + 0.0025216137835608558i, -0.032679788662827794 + 0.00028018812660182484i, 0.004667749481600113 + -0.006548889606195954i, 0.08539141786626145 + 5.059322124687765e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1712526066631802, 1.0e-7), DoubleNear(0.15664470759088417, 1.0e-7), DoubleNear(0.10591924382647196, 1.0e-7), DoubleNear(0.09688430033697423, 1.0e-7), DoubleNear(0.1517486690961633, 1.0e-7), DoubleNear(0.13880446178916528, 1.0e-7), DoubleNear(0.09335459283089839, 1.0e-7), DoubleNear(0.08539141786626145, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false, false}), Matrix({ { 0.23697438432515866 + -1.261928020698778e-19i, 0.0 + 0.0i, 0.03868745050929094 + -0.007634841835899254i, 0.0 + 0.0i, 0.0008768424573133248 + -0.00816617195601732i, 0.0 + 0.0i, 0.020520208511779315 + -0.022797998031994497i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03868745050929094 + 0.007634841835899255i, 0.0 + 0.0i, 0.2800096149067581 + -1.0637797358885776e-19i, 0.0 + 0.0i, 0.008332422299673105 + 0.021683225638854074i, 0.0 + 0.0i, 0.00287624203805581 + 0.02419979954533543i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0008768424573133254 + 0.00816617195601732i, 0.0 + 0.0i, 0.008332422299673103 + -0.021683225638854074i, 0.0 + 0.0i, 0.21877098564910713 + 6.573292197243696e-20i, 0.0 + 0.0i, -0.0013275966714043066 + 0.040149974425489676i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020520208511779315 + 0.022797998031994497i, 0.0 + 0.0i, 0.00287624203805581 + -0.024199799545335427i, 0.0 + 0.0i, -0.0013275966714043057 + -0.040149974425489676i, 0.0 + 0.0i, 0.264245015118975 + 2.1621934604788145e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.23697438432515866, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2800096149067581, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21877098564910713, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.264245015118975, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false, false}), Matrix({ { 0.23632051142590266 + 1.3734548483760716e-20i, 0.0 + 0.0i, 0.01937243984785819 + 0.016860276085935724i, 0.0 + 0.0i, 0.02226113500104373 + 0.013012931431738622i, 0.0 + 0.0i, 0.0008964557534513092 + 0.00265495834332717i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.019372439847858195 + -0.016860276085935724i, 0.0 + 0.0i, 0.2822157743936253 + 3.353654496280775e-19i, 0.0 + 0.0i, 0.0027532697498551424 + -0.0005214809749464554i, 0.0 + 0.0i, 0.026584418827184316 + 0.015540142914301138i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02226113500104373 + -0.013012931431738622i, 0.0 + 0.0i, 0.0027532697498551424 + 0.0005214809749464552i, 0.0 + 0.0i, 0.21942485854836313 + -7.419442858120151e-20i, 0.0 + 0.0i, 0.017987413990028442 + 0.015654856503654696i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.000896455753451309 + -0.00265495834332717i, 0.0 + 0.0i, 0.026584418827184316 + -0.01554014291430114i, 0.0 + 0.0i, 0.017987413990028442 + -0.015654856503654696i, 0.0 + 0.0i, 0.2620388556321078 + -2.255240771690538e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.23632051142590266, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2822157743936253, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21942485854836313, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2620388556321078, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true, false}), Matrix({ { 0.2816923679546847 + -1.162799675409962e-19i, 0.0 + 0.0i, 0.02259177002162708 + 0.01975047806109337i, 0.0 + 0.0i, -0.06657443970529783 + -0.0002862934905995811i, 0.0 + 0.0i, -0.0055999403425218384 + -0.005066018544895957i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.022591770021627083 + -0.01975047806109337i, 0.0 + 0.0i, 0.33675807718470824 + -6.297658597956837e-20i, 0.0 + 0.0i, -0.005992262204971364 + 0.004486492456658343i, 0.0 + 0.0i, -0.07939404987605098 + -0.0004742144927474568i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06657443970529783 + 0.0002862934905995809i, 0.0 + 0.0i, -0.0059922622049713645 + -0.004486492456658344i, 0.0 + 0.0i, 0.17405300201958113 + 5.582008744355541e-20i, 0.0 + 0.0i, 0.01476808381625955 + 0.012764654528497052i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0055999403425218384 + 0.0050660185448959585i, 0.0 + 0.0i, -0.07939404987605099 + 0.0004742144927474565i, 0.0 + 0.0i, 0.01476808381625955 + -0.012764654528497054i, 0.0 + 0.0i, 0.20749655284102492 + 1.7281795843859212e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2816923679546847, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.33675807718470824, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17405300201958113, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20749655284102492, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, true}), Matrix({ { 0.24127529617103566 + -5.616939742394435e-20i, 0.0 + 0.0i, 0.020295454231218122 + 0.0182636679599761i, 0.0 + 0.0i, -0.07889041012215173 + -0.04918340412885033i, 0.0 + 0.0i, -0.0024933900252786445 + -0.010784803004252197i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020295454231218125 + -0.018263667959976103i, 0.0 + 0.0i, 0.28942556224647487 + 5.550273393112227e-20i, 0.0 + 0.0i, -0.010592653346335655 + 0.002163306620801489i, 0.0 + 0.0i, -0.09507814017092478 + -0.05899547045161585i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07889041012215173 + 0.04918340412885032i, 0.0 + 0.0i, -0.010592653346335657 + -0.0021633066208014895i, 0.0 + 0.0i, 0.21447007380323016 + -4.2904826734964396e-21i, 0.0 + 0.0i, 0.017064399606668508 + 0.014251464629614323i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002493390025278644 + 0.010784803004252198i, 0.0 + 0.0i, -0.09507814017092478 + 0.05899547045161586i, 0.0 + 0.0i, 0.017064399606668508 + -0.014251464629614321i, 0.0 + 0.0i, 0.2548290677792583 + 5.433863852790146e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.24127529617103566, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28942556224647487, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21447007380323016, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2548290677792583, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false, false}), Matrix({ { 0.2680749627898441 + -9.539578315098181e-21i, 0.0 + 0.0i, 0.001946110494595571 + 0.008314017698378532i, 0.0 + 0.0i, 0.025252369762815224 + 0.014761482565781896i, 0.0 + 0.0i, -0.00027448786985407323 + 0.0008903335200990448i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0019461104945955707 + -0.00831401769837853i, 0.0 + 0.0i, 0.2504613230296839 + 3.586395764269364e-19i, 0.0 + 0.0i, 0.0006411308513349558 + -0.0006760093188525565i, 0.0 + 0.0i, 0.023593184065412824 + 0.013791591780257864i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.025252369762815224 + -0.014761482565781896i, 0.0 + 0.0i, 0.0006411308513349556 + 0.0006760093188525568i, 0.0 + 0.0i, 0.24890903644207266 + -2.230311973436373e-19i, 0.0 + 0.0i, 0.0018069740007735638 + 0.007719609890939577i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00027448786985407323 + -0.0008903335200990451i, 0.0 + 0.0i, 0.023593184065412824 + -0.013791591780257866i, 0.0 + 0.0i, 0.001806974000773565 + -0.007719609890939575i, 0.0 + 0.0i, 0.23255467773839833 + -7.668730840661797e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2680749627898441, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2504613230296839, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24890903644207266, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23255467773839833, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true, false}), Matrix({ { 0.32038841694139597 + -2.8441890388102746e-19i, 0.0 + 0.0i, 0.0015573521691039692 + 0.01002897906472961i, 0.0 + 0.0i, -0.07512211264680319 + 0.00017225814460293778i, 0.0 + 0.0i, -0.001317634589261092 + -0.002194234693396413i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0015573521691039705 + -0.010028979064729607i, 0.0 + 0.0i, 0.29806202819799693 + 1.0516235036046288e-19i, 0.0 + 0.0i, -0.0006368040061428065 + 0.00179999144996412i, 0.0 + 0.0i, -0.07084637693454562 + -0.0009327661279499757i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07512211264680319 + -0.00017225814460293827i, 0.0 + 0.0i, -0.0006368040061428065 + -0.0017999914499641201i, 0.0 + 0.0i, 0.19659558229052077 + 5.184812822229195e-20i, 0.0 + 0.0i, 0.0021957323262651656 + 0.006004648524588499i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0013176345892610918 + 0.002194234693396414i, 0.0 + 0.0i, -0.07084637693454562 + 0.0009327661279499757i, 0.0 + 0.0i, 0.0021957323262651648 + -0.006004648524588499i, 0.0 + 0.0i, 0.18495397257008525 + 1.7678991765985554e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.32038841694139597, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29806202819799693, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19659558229052077, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18495397257008525, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, true}), Matrix({ { 0.2718823031684952 + -3.485044470493554e-19i, 0.0 + 0.0i, 0.0016891505791496316 + 0.007414762012390115i, 0.0 + 0.0i, -0.08845413149307679 + -0.054913304155411534i, 0.0 + 0.0i, 0.00134743234089123 + -0.003053819818355911i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016891505791496316 + -0.007414762012390113i, 0.0 + 0.0i, 0.2588185552490153 + 3.4783778355653327e-19i, 0.0 + 0.0i, -0.001676979625928528 + 0.0019939038154508917i, 0.0 + 0.0i, -0.08551441879999971 + -0.05326557042505464i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08845413149307679 + 0.05491330415541154i, 0.0 + 0.0i, -0.001676979625928528 + -0.0019939038154508926i, 0.0 + 0.0i, 0.24510169606342155 + 1.1593367139061988e-19i, 0.0 + 0.0i, 0.0020639339162195035 + 0.008618865576927993i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00134743234089123 + 0.003053819818355911i, 0.0 + 0.0i, -0.08551441879999971 + 0.05326557042505464i, 0.0 + 0.0i, 0.002063933916219504 + -0.008618865576927991i, 0.0 + 0.0i, 0.22419744551906687 + -6.588551553621485e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2718823031684952, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2588185552490153, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24510169606342155, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22419744551906687, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true, false}), Matrix({ { 0.32068899678601487 + 1.3387832622951386e-19i, 0.0 + 0.0i, 0.03020855450814785 + 0.017658661539406487i, 0.0 + 0.0i, -0.07568995843419915 + -0.0003943509850208731i, 0.0 + 0.0i, -0.007108196874081662 + -0.004204996568832761i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03020855450814785 + -0.01765866153940649i, 0.0 + 0.0i, 0.29776144835337803 + -3.131348797500785e-19i, 0.0 + 0.0i, -0.007151626556060192 + 0.004130701701558012i, 0.0 + 0.0i, -0.07027853114714966 + -0.00036615699832616487i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07568995843419915 + 0.0003943509850208724i, 0.0 + 0.0i, -0.007151626556060192 + -0.004130701701558014i, 0.0 + 0.0i, 0.1978472890335131 + 2.1522167188232432e-19i, 0.0 + 0.0i, 0.0186369993200802 + 0.010894412806633271i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007108196874081661 + 0.004204996568832761i, 0.0 + 0.0i, -0.07027853114714966 + 0.000366156998326165i, 0.0 + 0.0i, 0.0186369993200802 + -0.01089441280663327i, 0.0 + 0.0i, 0.18370226582709295 + 1.3416373999823164e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.32068899678601487, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29776144835337803, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1978472890335131, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18370226582709295, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, true}), Matrix({ { 0.27518765200505135 + 1.8973443196556469e-19i, 0.0 + 0.0i, 0.025922377346519372 + 0.015153141065902315i, 0.0 + 0.0i, -0.09020900591837974 + -0.05609467182909153i, 0.0 + 0.0i, -0.005408750739192311 + -0.010251393991788272i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.025922377346519372 + -0.015153141065902317i, 0.0 + 0.0i, 0.25551320641245917 + -1.9040109545838683e-19i, 0.0 + 0.0i, -0.011586429636326242 + -0.00031672009100632226i, 0.0 + 0.0i, -0.08375954437469676 + -0.05208420275137464i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09020900591837974 + 0.056094671829091544i, 0.0 + 0.0i, -0.011586429636326242 + 0.00031672009100632215i, 0.0 + 0.0i, 0.24334863381447658 + 1.593655661462735e-19i, 0.0 + 0.0i, 0.022923176481708676 + 0.013399933280137444i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005408750739192312 + 0.010251393991788272i, 0.0 + 0.0i, -0.08375954437469676 + 0.05208420275137464i, 0.0 + 0.0i, 0.022923176481708676 + -0.013399933280137447i, 0.0 + 0.0i, 0.22595050776801184 + -1.0931741029186847e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.27518765200505135, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25551320641245917, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24334863381447658, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22595050776801184, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, true}), Matrix({ { 0.3278973142540643 + -1.629925937609234e-19i, 0.0 + 0.0i, -0.07756135921778687 + -0.00017400279200303957i, 0.0 + 0.0i, -0.10752658010631189 + -0.0669498392205524i, 0.0 + 0.0i, 0.024171925842656757 + 0.015299925160775635i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07756135921778687 + 0.00017400279200303914i, 0.0 + 0.0i, 0.2028035441634462 + 1.6232593026810125e-19i, 0.0 + 0.0i, 0.025142744868936348 + 0.017369084973313624i, 0.0 + 0.0i, -0.06644197018676462 + -0.04122903535991376i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.10752658010631189 + 0.06694983922055242i, 0.0 + 0.0i, 0.025142744868936345 + -0.01736908497331362i, 0.0 + 0.0i, 0.2905531308853286 + -1.6263959759641204e-20i, 0.0 + 0.0i, -0.06840713036356194 + -0.0005865051913439983i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02417192584265676 + -0.015299925160775635i, 0.0 + 0.0i, -0.06644197018676462 + 0.04122903535991376i, 0.0 + 0.0i, -0.06840713036356194 + 0.0005865051913439982i, 0.0 + 0.0i, 0.17874601069715984 + 6.631211561404622e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3278973142540643, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2028035441634462, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2905531308853286, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17874601069715984, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false, false}), Matrix({ { 0.12287981708233728 + -9.080398735011549e-20i, 0.020060846894914552 + -0.003958942528406749i, 0.0004546746310641203 + -0.004234456475436816i, 0.01064047270594032 + -0.011821589223631346i, 0.011575145045465751 + 0.006766347213743262i, 0.0021077081528891673 + 0.0007317175727850945i, 0.0002759991704302817 + -0.00037384464397477923i, 0.0016532738821769888 + -0.0005276658008145523i }, { 0.020060846894914552 + 0.00395894252840675i, 0.1451951457075068 + 8.126440903501732e-20i, 0.004320663311152306 + 0.011243539287358164i, 0.0014914358635314503 + 0.012548474173815348i, 0.001671711739767795 + 0.001477573728515944i, 0.013677224717349473 + 0.007995135352038635i, -0.00021212097176994576 + 0.0012970454385174285i, -0.000550487040284355 + 0.0012641781640738239i }, { 0.0004546746310641204 + 0.004234456475436816i, 0.004320663311152306 + -0.011243539287358165i, 0.11344069434356539 + 1.0453853583387621e-19i, -0.0006884070470563582 + 0.020819218614342473i, -0.0001903394595351341 + 0.00042391773972164245i, 0.0010261245356863674 + -0.0008212128917070962i, 0.010685989955577981 + 0.006246584217995361i, -0.0012112523994378586 + 0.0019232407705420751i }, { 0.010640472705940318 + 0.011821589223631346i, 0.00149143586353145 + -0.012548474173815346i, -0.0006884070470563575 + -0.020819218614342473i, 0.13702062868611847 + 2.5410104059306016e-19i, 0.0003513680166801731 + 0.0016994958792806985i, 0.0008314703108700899 + -0.001099927058574199i, 0.0010815580100873474 + -0.0019990547034623996i, 0.012907194109834843 + 0.007545007562262503i }, { 0.011575145045465751 + -0.006766347213743262i, 0.001671711739767795 + -0.001477573728515944i, -0.00019033945953513437 + -0.00042391773972164223i, 0.00035136801668017337 + -0.0016994958792806983i, 0.1140945672428214 + -3.5388814719762273e-20i, 0.01862660361437639 + -0.003675899307492505i, 0.00042216782624920446 + -0.003931715480580504i, 0.009879735805838997 + -0.01097640880836315i }, { 0.0021077081528891677 + -0.0007317175727850943i, 0.013677224717349473 + -0.007995135352038635i, 0.0010261245356863674 + 0.0008212128917070961i, 0.00083147031087009 + 0.001099927058574199i, 0.01862660361437639 + 0.0036758993074925052i, 0.13481446919925125 + -1.8764238262387506e-19i, 0.004011758988520798 + 0.010439686351495909i, 0.0013848061745243595 + 0.011651325371520081i }, { 0.00027599917043028157 + 0.00037384464397477885i, -0.00021212097176994592 + -0.0012970454385174282i, 0.01068598995557798 + -0.006246584217995361i, 0.0010815580100873474 + 0.0019990547034623996i, 0.0004221678262492051 + 0.003931715480580504i, 0.004011758988520798 + -0.01043968635149591i, 0.10533029130554177 + -3.880561386143924e-20i, -0.0006391896243479483 + 0.019330755811147203i }, { 0.0016532738821769888 + 0.0005276658008145523i, -0.0005504870402843547 + -0.0012641781640738239i, -0.0012112523994378586 + -0.0019232407705420753i, 0.012907194109834845 + -0.007545007562262505i, 0.009879735805838995 + 0.01097640880836315i, 0.00138480617452436 + -0.01165132537152008i, -0.0006391896243479481 + -0.019330755811147203i, 0.12722438643285658 + -3.7881694545178736e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.12287981708233728, 1.0e-7), DoubleNear(0.1451951457075068, 1.0e-7), DoubleNear(0.11344069434356539, 1.0e-7), DoubleNear(0.13702062868611847, 1.0e-7), DoubleNear(0.1140945672428214, 1.0e-7), DoubleNear(0.13481446919925125, 1.0e-7), DoubleNear(0.10533029130554177, 1.0e-7), DoubleNear(0.12722438643285658, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true, false}), Matrix({ { 0.14644258777340785 + -1.2066367245345455e-19i, 0.02359649643221938 + -0.004230036640080447i, 0.00013445719023067306 + -0.0048835590714428195i, 0.013100151841712537 + -0.014163599937428065i, -0.03454787075180691 + 0.00021171098520298648i, -0.006001150172913311 + 0.001280263173548631i, -0.0007684464443411549 + 0.0012207658948668538i, -0.00273062156920881 + 0.0035291203969171707i }, { 0.02359649643221938 + 0.004230036640080448i, 0.17394582916798812 + -1.637552314275729e-19i, 0.005034190938452297 + 0.013122842835164215i, 0.001422894978873296 + 0.014912538136172429i, -0.005836485881910729 + -0.0015640657393386384i, -0.04057424189499628 + -3.945284060004869e-05i, -0.0012308520823913179 + -0.0033462955619261822i, -0.0005491881449199371 + -0.0034150005882632667i }, { 0.00013445719023067392 + 0.0048835590714428195i, 0.005034190938452296 + -0.013122842835164216i, 0.13524978018127684 + 4.383704912458339e-21i, -0.0010047264105922987 + 0.023980514701173815i, -2.061945044756682e-05 + -0.001858347759956258i, -0.0013770597474925318 + 0.0033202517203607647i, -0.03202656895349092 + -0.0004980044758025675i, 0.00040120983039147306 + -0.006346281718444588i }, { 0.013100151841712536 + 0.014163599937428063i, 0.0014228949788732967 + -0.014912538136172427i, -0.0010047264105922983 + -0.023980514701173815i, 0.16281224801672012 + 1.0077864544800454e-19i, -0.002592927749486687 + -0.0028651655659061655i, -0.0006161845556952396 + 0.003658339209920378i, -0.0001557763230606351 + 0.006050558195996982i, -0.038819807981054694 + -0.0004347616521474081i }, { -0.03454787075180691 + -0.00021171098520298667i, -0.005836485881910729 + 0.0015640657393386386i, -2.0619450447566766e-05 + 0.0018583477599562583i, -0.0025929277494866876 + 0.0028651655659061655i, 0.09053179655175081 + -5.529129616423231e-21i, 0.01509095407707156 + -0.0034048051958188064i, 0.0007423852670826518 + -0.0032826128845745007i, 0.0074200566700667785 + -0.008634398094566433i }, { -0.0060011501729133115 + -0.0012802631735486308i, -0.04057424189499628 + 3.945284060004839e-05i, -0.0013770597474925318 + -0.0033202517203607647i, -0.0006161845556952399 + -0.0036583392099203784i, 0.01509095407707156 + 0.003404805195818807i, 0.10606378573876996 + 5.737725783871518e-20i, 0.003298231361220807 + 0.008560382803689858i, 0.0014533470591825137 + 0.009287261409163i }, { -0.0007684464443411548 + -0.0012207658948668538i, -0.0012308520823913179 + 0.0033462955619261827i, -0.03202656895349092 + 0.0004980044758025675i, -0.00015577632306063518 + -0.006050558195996983i, 0.0007423852670826516 + 0.0032826128845745003i, 0.003298231361220807 + -0.008560382803689858i, 0.08352120546783032 + 6.134921705997863e-20i, -0.0003228702608120078 + 0.016169459724315858i }, { -0.00273062156920881 + -0.0035291203969171716i, -0.0005491881449199371 + 0.0034150005882632676i, 0.0004012098303914731 + 0.006346281718444589i, -0.038819807981054694 + 0.0004347616521474081i, 0.0074200566700667785 + 0.008634398094566433i, 0.0014533470591825135 + -0.009287261409163i, -0.0003228702608120074 + -0.01616945972431586i, 0.10143276710225495 + 1.1544070059987692e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.14644258777340785, 1.0e-7), DoubleNear(0.17394582916798812, 1.0e-7), DoubleNear(0.13524978018127684, 1.0e-7), DoubleNear(0.16281224801672012, 1.0e-7), DoubleNear(0.09053179655175081, 1.0e-7), DoubleNear(0.10606378573876996, 1.0e-7), DoubleNear(0.08352120546783032, 1.0e-7), DoubleNear(0.10143276710225495, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, true}), Matrix({ { 0.12331228560853129 + -1.686440767581028e-19i, 0.02027954523768023 + -0.003422454032579618i, 0.0015908414335854986 + -0.005509751201471283i, 0.009810755252685845 + -0.012914809574224084i, -0.03968840138820266 + -0.02493800251046191i, -0.007049707432243864 + -0.003477839348449587i, -0.0018701809998063238 + 0.0012058068139416353i, -0.005917968570410526 + 0.002878313115302127i }, { 0.02027954523768023 + 0.003422454032579618i, 0.1485700175599639 + -1.7986037029125263e-19i, 0.004143634980327706 + 0.011260245777904476i, 9.830914556413259e-05 + 0.012924513213861398i, -0.00555683548459417 + -0.004819035406781386i, -0.04876573010487412 + -0.029975301644949624i, 0.001160713991313441 + -0.0043212284296081415i, 0.0032176133406975537 + -0.004259626632297547i }, { 0.001590841433585499 + 0.005509751201471283i, 0.004143634980327706 + -0.011260245777904476i, 0.11796301056250437 + 1.124746793341584e-19i, 1.5908993537894098e-05 + 0.021686121992555717i, 0.0004561793505770723 + -0.0023182346679679507i, -0.0035294436591462824 + 0.00265426320061206i, -0.039202008733949065 + -0.024245401618388417i, 0.004556317406965219 + -0.00730696365580261i }, { 0.009810755252685845 + 0.012914809574224084i, 9.830914556413248e-05 + -0.012924513213861396i, 1.5908993537895006e-05 + -0.02168612199255572i, 0.14085554468651096 + 2.3536310422237487e-19i, -0.0003821543234943502 + -0.0065023689306256995i, -0.0021331589765056004 + 0.004312138483418843i, -0.005035817861741487 + 0.006982342027582874i, -0.04631241006605065 + -0.029020168806666226i }, { -0.03968840138820266 + 0.02493800251046191i, -0.00555683548459417 + 0.004819035406781386i, 0.00045617935057707195 + 0.0023182346679679502i, -0.0003821543234943501 + 0.0065023689306256995i, 0.11366209871662737 + 4.2451274688225e-20i, 0.018407905271610712 + -0.004212387803319636i, -0.0007139989762721739 + -0.0026564207545460372i, 0.01070945325909347 + -0.009883188457770413i }, { -0.007049707432243864 + 0.003477839348449587i, -0.04876573010487412 + 0.029975301644949624i, -0.0035294436591462833 + -0.00265426320061206i, -0.0021331589765056 + -0.004312138483418843i, 0.018407905271610712 + 0.004212387803319637i, 0.13143959734679417 + 7.348239670239487e-20i, 0.004188787319345398 + 0.010422979860949599i, 0.0027779328924916772 + 0.011275286331474031i }, { -0.0018701809998063238 + -0.001205806813941635i, 0.001160713991313441 + 0.0043212284296081415i, -0.039202008733949065 + 0.024245401618388417i, -0.005035817861741487 + -0.006982342027582875i, -0.0007139989762721736 + 0.0026564207545460377i, 0.004188787319345397 + -0.010422979860949599i, 0.10080797508660277 + -4.6741757361721444e-20i, -0.0013435056649422007 + 0.018463852432933955i }, { -0.005917968570410526 + -0.0028783131153021276i, 0.0032176133406975537 + 0.004259626632297547i, 0.004556317406965219 + 0.00730696365580261i, -0.04631241006605066 + 0.029020168806666226i, 0.01070945325909347 + 0.009883188457770411i, 0.0027779328924916777 + -0.011275286331474031i, -0.0013435056649422007 + -0.01846385243293396i, 0.1233894704324641 + -1.9143758174493417e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.12331228560853129, 1.0e-7), DoubleNear(0.1485700175599639, 1.0e-7), DoubleNear(0.11796301056250437, 1.0e-7), DoubleNear(0.14085554468651096, 1.0e-7), DoubleNear(0.11366209871662737, 1.0e-7), DoubleNear(0.13143959734679417, 1.0e-7), DoubleNear(0.10080797508660277, 1.0e-7), DoubleNear(0.1233894704324641, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true, false}), Matrix({ { 0.1460677142229302 + -9.98095830016372e-20i, 0.011714652517103475 + 0.010241339536959437i, 0.013759419721931588 + 0.00804318312492211i, 0.0005395706502181089 + 0.0016097875283025255i, -0.034521262695301286 + -0.000148453563269815i, -0.0029037722660222114 + -0.002626914440163202i, -0.0032436908188873746 + -0.0019148890905570648i, -0.00012888178328468602 + -0.0004073479944629309i }, { 0.011714652517103477 + -0.010241339536959437i, 0.17462128256308468 + 2.336879092311511e-19i, 0.0016674443871145623 + -0.00031965855023022326i, 0.016449134786216256 + 0.00961547841448438i, -0.003107205387422589 + 0.0023264091348329493i, -0.041168695738897865 + -0.0002458974217510581i, -0.00042079851875369804 + 4.8047700552132725e-05i, -0.003864506055194287 + -0.0022901074782756964i }, { 0.013759419721931588 + -0.00804318312492211i, 0.0016674443871145623 + 0.000319658550230223i, 0.13562465373175453 + -1.647038453935901e-20i, 0.010877117504523606 + 0.009509138524133931i, -0.003260039937531129 + 0.0018869207623455591i, -0.0004181825915863473 + -8.755696859610378e-05i, -0.03205317700999655 + -0.0001378399273297661i, -0.0026961680764996266 + -0.0024391041047327556i }, { 0.0005395706502181086 + -0.0016097875283025255i, 0.016449134786216256 + -0.009615478414484381i, 0.010877117504523606 + -0.009509138524133931i, 0.16213679462162353 + -2.9666449521071945e-19i, -0.0001645922134178733 + 0.0003902427170311562i, -0.0038915866185290637 + 0.002243780939212453i, -0.0028850568175487748 + 0.0021600833218253937i, -0.03822535413715311 + -0.00022831707099639872i }, { -0.034521262695301286 + 0.00014845356326981466i, -0.003107205387422589 + -0.0023264091348329493i, -0.0032600399375311293 + -0.0018869207623455593i, -0.0001645922134178733 + -0.0003902427170311562i, 0.09025279720297248 + 1.1354413148539791e-19i, 0.007657787330754716 + 0.006618936548976287i, 0.008501715279112143 + 0.004969748306816513i, 0.00035688510323320024 + 0.0010451708150246443i }, { -0.0029037722660222123 + 0.0026269144401632025i, -0.04116869573889787 + 0.00024589742175105776i, -0.0004181825915863473 + 8.755696859610374e-05i, -0.0038915866185290633 + -0.0022437809392124534i, 0.007657787330754716 + -0.006618936548976287i, 0.1075944918305406 + 1.0167754039692643e-19i, 0.00108582536274058 + -0.00020182242471623217i, 0.010135284040968058 + 0.005924664499816758i }, { -0.003243690818887374 + 0.0019148890905570652i, -0.000420798518753698 + -4.8047700552132725e-05i, -0.032053177009996554 + 0.0001378399273297662i, -0.0028850568175487756 + -0.002160083321825394i, 0.008501715279112143 + -0.004969748306816513i, 0.00108582536274058 + 0.00020182242471623223i, 0.08380020481660863 + -5.77240440418425e-20i, 0.007110296485504835 + 0.006145717979520765i }, { -0.00012888178328468593 + 0.00040734799446293086i, -0.003864506055194287 + 0.0022901074782756964i, -0.0026961680764996266 + 0.002439104104732756i, -0.03822535413715311 + 0.00022831707099639874i, 0.0003568851032332004 + -0.0010451708150246443i, 0.010135284040968058 + -0.005924664499816758i, 0.007110296485504835 + -0.006145717979520767i, 0.09990206101048431 + 7.114041804166568e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1460677142229302, 1.0e-7), DoubleNear(0.17462128256308468, 1.0e-7), DoubleNear(0.13562465373175453, 1.0e-7), DoubleNear(0.16213679462162353, 1.0e-7), DoubleNear(0.09025279720297248, 1.0e-7), DoubleNear(0.1075944918305406, 1.0e-7), DoubleNear(0.08380020481660863, 1.0e-7), DoubleNear(0.09990206101048431, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, true}), Matrix({ { 0.12510999593653555 + -7.110107249338055e-21i, 0.010523929456076078 + 0.009470374549407131i, 0.011785225466544 + 0.00688915146943435i, 0.00046985883302672234 + 0.0014715965899905164i, -0.040907540251519894 + -0.025503379700934914i, -0.0012929132028074485 + -0.005592311693120227i, -0.0024491083794701695 + -0.004654954359238623i, 0.00018614826529329137 + -0.0005979836264364919i }, { 0.010523929456076081 + -0.009470374549407131i, 0.1500776560685158 + 1.9684453921490275e-19i, 0.001512826571211887 + -0.00031260136288927855i, 0.014137151879975371 + 0.008263989596467965i, -0.005492675123182691 + 0.0011217529802391992i, -0.04930146566685985 + -0.030591292128156623i, -0.0005791730739892239 + -0.00019678490852642787i, -0.0029596423597221416 + -0.00559643963254965i }, { 0.011785225466544 + -0.00688915146943435i, 0.001512826571211887 + 0.00031260136288927855i, 0.11616530023450013 + -4.9059290174606303e-20i, 0.009771524775142044 + 0.008793293410568968i, -0.005257783168834938 + -0.00014982686842388693i, -0.0004297302986823212 + -0.0004555957249055817i, -0.03798286987063184 + -0.023680024427915416i, -0.0012004768224711958 + -0.00519249131113197i }, { 0.00046985883302672234 + -0.0014715965899905164i, 0.014137151879975371 + -0.008263989596467965i, 0.009771524775142044 + -0.00879329341056897i, 0.13934790617795906 + -1.413418052837805e-19i, -0.0004556349644351737 + 0.00040812072851307055i, -0.006328646467491305 + -0.00016689322258243533i, -0.005099978223152965 + 0.0010415536405622898i, -0.04577667450406493 + -0.028404178323459227i }, { -0.040907540251519894 + 0.02550337970093491i, -0.00549267512318269 + -0.0011217529802391994i, -0.005257783168834938 + 0.00014982686842388688i, -0.0004556349644351738 + -0.0004081207285130706i, 0.11121051548936713 + 2.084465573309877e-20i, 0.008848510391782112 + 0.007389901536528592i, 0.010475909534499731 + 0.006123779962304271i, 0.0004265969204245868 + 0.0011833617533366534i }, { -0.0012929132028074485 + 0.005592311693120227i, -0.04930146566685985 + 0.030591292128156627i, -0.00042973029868232125 + 0.00045559572490558173i, -0.006328646467491305 + 0.00016689322258243527i, 0.008848510391782114 + -0.007389901536528593i, 0.13213811832510947 + 1.3852091041317474e-19i, 0.0012404431786432555 + -0.0002088796120571769i, 0.012447266947208945 + 0.0072761533178331735i }, { -0.00244910837947017 + 0.0046549543592386226i, -0.0005791730739892239 + 0.0001967849085264279i, -0.03798286987063184 + 0.023680024427915412i, -0.005099978223152966 + -0.0010415536405622902i, 0.010475909534499731 + -0.006123779962304271i, 0.0012404431786432553 + 0.00020887961205717667i, 0.10325955831386302 + -2.513513840659521e-20i, 0.008215889214886397 + 0.0068615630930857294i }, { 0.00018614826529329132 + 0.0005979836264364919i, -0.002959642359722142 + 0.00559643963254965i, -0.0012004768224711956 + 0.00519249131113197i, -0.04577667450406493 + 0.028404178323459227i, 0.0004265969204245867 + -0.0011833617533366534i, 0.012447266947208945 + -0.007276153317833175i, 0.008215889214886397 + -0.006861563093085728i, 0.1226909494541488 + -8.418227188527328e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.12510999593653555, 1.0e-7), DoubleNear(0.1500776560685158, 1.0e-7), DoubleNear(0.11616530023450013, 1.0e-7), DoubleNear(0.13934790617795906, 1.0e-7), DoubleNear(0.11121051548936713, 1.0e-7), DoubleNear(0.13213811832510947, 1.0e-7), DoubleNear(0.10325955831386302, 1.0e-7), DoubleNear(0.1226909494541488, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, true}), Matrix({ { 0.14895506924373325 + -1.2387371797702587e-19i, 0.012249099953510681 + 0.01103395502742757i, -0.03531816337105279 + -7.538941363732159e-05i, -0.003153754365158778 + -0.002810627795778356i, -0.0487067535666293 + -0.030414619516277285i, -0.0015874717899212688 + -0.006474735902489695i, 0.010984193126821208 + 0.006988491017596138i, 0.0003368826798763653 + 0.0016168520119755557i }, { 0.012249099953510683 + -0.01103395502742757i, 0.17894224501033112 + -3.9118875783897487e-20i, -0.0031979045185307102 + 0.0026084061491147064i, -0.04224319584673407 + -9.861337836571797e-05i, -0.006279063991943434 + 0.001443769590904021i, -0.058819826539682596 + -0.036535219704275125i, 0.001557761490438305 + -0.00024255283865083025i, 0.01318773271583555 + 0.008311434143179496i }, { -0.0353181633710528 + 7.538941363732141e-05i, -0.0031979045185307107 + -0.002608406149114707i, 0.09232022692730242 + 6.770432055308152e-20i, 0.00804635427770744 + 0.007229712932548529i, 0.011405187708354029 + 0.007907040112619675i, 0.00032968758028295754 + 0.0018076575247499421i, -0.030183656555522437 + -0.018768784612573045i, -0.0009059182353573754 + -0.004310067101762502i }, { -0.003153754365158778 + 0.002810627795778357i, -0.04224319584673408 + 9.861337836571774e-05i, 0.00804635427770744 + -0.007229712932548531i, 0.11048331723614377 + 9.462160971501976e-20i, 0.001777927441536894 + -0.0001747991120624394i, 0.013737557160582321 + 0.00946204486069395i, -0.004313589354392222 + 0.0007195370298974681i, -0.036258313631242184 + -0.022460250747340725i }, { -0.0487067535666293 + 0.03041461951627728i, -0.006279063991943434 + -0.0014437695909040212i, 0.011405187708354025 + -0.007907040112619673i, 0.0017779274415368937 + 0.00017479911206243952i, 0.13273729871095147 + 7.593750436029669e-21i, 0.0103426700681164 + 0.0087165230336658i, -0.03125627633424504 + -0.00021090407696225952i, -0.00244618597736306 + -0.0022553907491176008i }, { -0.0015874717899212686 + 0.0064747359024896955i, -0.058819826539682596 + 0.03653521970427513i, 0.00032968758028295765 + -0.001807657524749942i, 0.01373755716058232 + -0.00946204486069395i, 0.0103426700681164 + -0.008716523033665798i, 0.1578158321743771 + -2.3857710195670882e-20i, -0.0027943576864406534 + 0.0018780863075436368i, -0.03715085402931691 + -0.0003756011143817388i }, { 0.01098419312682121 + -0.006988491017596138i, 0.001557761490438305 + 0.00024255283865083014i, -0.030183656555522437 + 0.01876878461257304i, -0.004313589354392223 + -0.0007195370298974685i, -0.03125627633424504 + 0.00021090407696225947i, -0.002794357686440654 + -0.0018780863075436368i, 0.08173277509227869 + -1.1884233109526109e-20i, 0.00672172953855211 + 0.005534941595948523i }, { 0.0003368826798763655 + -0.0016168520119755557i, 0.013187732715835551 + -0.008311434143179496i, -0.0009059182353573753 + 0.004310067101762502i, -0.036258313631242184 + 0.022460250747340725i, -0.0024461859773630603 + 0.0022553907491176016i, -0.03715085402931691 + 0.00037560111438173876i, 0.00672172953855211 + -0.005534941595948523i, 0.09701323560488115 + 7.819634872357234e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.14895506924373325, 1.0e-7), DoubleNear(0.17894224501033112, 1.0e-7), DoubleNear(0.09232022692730242, 1.0e-7), DoubleNear(0.11048331723614377, 1.0e-7), DoubleNear(0.13273729871095147, 1.0e-7), DoubleNear(0.1578158321743771, 1.0e-7), DoubleNear(0.08173277509227869, 1.0e-7), DoubleNear(0.09701323560488115, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true, false}), Matrix({ { 0.16613301974038996 + -1.0068789452115809e-19i, 0.0008075436094801584 + 0.0052003895547867i, 0.015649549665651744 + 0.009148074288537674i, -0.00021028845564462532 + 0.0005343382290158146i, -0.038953541274789553 + 8.932209850457052e-05i, -0.0006832413459827865 + -0.0011377903081301278i, -0.0036742996965891993 + -0.0021365532229611936i, -1.7084449224803834e-06 + -0.00014480112721614564i }, { 0.0008075436094801586 + -0.005200389554786699i, 0.1545559770456249 + 2.34566220750672e-19i, 0.0003624279140555768 + -0.00044540384448103076i, 0.014559004842496101 + 0.008510587250868815i, -0.000330205984140287 + 0.0009333608809713024i, -0.0367364171594096 + -0.0004836730835254436i, -8.250033405314125e-05 + 6.973886712832119e-05i, -0.0034338971774924626 + -0.0020684433458715676i }, { 0.015649549665651744 + -0.009148074288537675i, 0.00036242791405557647 + 0.00044540384448103103i, 0.154255397201006 + -1.8373100935986937e-19i, 0.0007498085596238109 + 0.00482858950994291i, -0.003664462697370083 + 0.0021533813119103008i, -0.00012701273758889553 + -6.955609043997454e-05i, -0.03616857137201364 + 8.293604609836728e-05i, -0.0006343932432783054 + -0.0010564443852662854i }, { -0.00021028845564462535 + -0.000534338229015815i, 0.014559004842496101 + -0.008510587250868817i, 0.000749808559623812 + -0.0048285895099429085i, 0.14350605115237203 + -1.2940387039020908e-19i, 2.0290245332981673e-05 + 0.0001061042913908243i, -0.0034871638586901096 + 0.001977320389647711i, -0.00030659802200251943 + 0.0008666305689928175i, -0.03410995977513602 + -0.0004490930444245321i }, { -0.038953541274789553 + -8.932209850457098e-05i, -0.00033020598414028703 + -0.0009333608809713024i, -0.003664462697370083 + -0.0021533813119103016i, 2.0290245332981697e-05 + -0.00010610429139082432i, 0.10194194304945411 + 9.11483162060599e-20i, 0.0011385668851154125 + 0.0031136281435918314i, 0.009602820097163478 + 0.005613408277244222i, -6.419941420944792e-05 + 0.0003559952910832301i }, { -0.0006832413459827867 + 0.0011377903081301283i, -0.0367364171594096 + 0.0004836730835254434i, -0.00012701273758889553 + 6.955609043997454e-05i, -0.00348716385869011 + -0.001977320389647712i, 0.001138566885115412 + -0.0031136281435918314i, 0.09590534598405898 + 1.2407335567626443e-19i, 0.00027870293727937903 + -0.0002306054743715258i, 0.009034179222916723 + 0.005281004529389049i }, { -0.003674299696589199 + 0.002136553222961194i, -8.250033405314124e-05 + -6.973886712832128e-05i, -0.03616857137201364 + -8.29360460983673e-05i, -0.0003065980220025195 + -0.0008666305689928177i, 0.00960282009716348 + -0.005613408277244223i, 0.00027870293727937914 + 0.0002306054743715258i, 0.09465363924106665 + -3.930018798376795e-20i, 0.0010571654411497531 + 0.0028910203809966676i }, { -1.7084449224802987e-06 + 0.00014480112721614567i, -0.0034338971774924626 + 0.002068443345871568i, -0.0006343932432783052 + 0.0010564443852662854i, -0.03410995977513602 + 0.00044909304442453227i, -6.419941420944788e-05 + -0.0003559952910832301i, 0.009034179222916723 + -0.005281004529389049i, 0.0010571654411497531 + -0.0028910203809966676i, 0.08904862658602629 + 5.271656198359112e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.16613301974038996, 1.0e-7), DoubleNear(0.1545559770456249, 1.0e-7), DoubleNear(0.154255397201006, 1.0e-7), DoubleNear(0.14350605115237203, 1.0e-7), DoubleNear(0.10194194304945411, 1.0e-7), DoubleNear(0.09590534598405898, 1.0e-7), DoubleNear(0.09465363924106665, 1.0e-7), DoubleNear(0.08904862658602629, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, true}), Matrix({ { 0.14098083966505054 + -1.4968612567788752e-19i, 0.0008758858675021555 + 0.0038448231541405023i, 0.013280241674359363 + 0.007763075615742573i, -0.00012920675546013052 + 0.00041040859906781767i, -0.045866676809812226 + -0.028474540778825178i, 0.0006986925614388509 + -0.0015835163861723412i, -0.0027526473850380873 + -0.005207908146745217i, 0.00015301202324982397 + -0.00011069218451348773i }, { 0.0008758858675021555 + -0.0038448231541405023i, 0.13420681234000084 + 3.394205576434522e-19i, 0.0002942217465358024 + -0.00031394771493158656i, 0.012642135672160007 + 0.007390065450159742i, -0.0008695747866240011 + 0.001033911478745292i, -0.044342329108567516 + -0.02762013105026636i, -0.00013884508246855538 + 4.951041220998472e-05i, -0.0026561033541542237 + -0.005043485845043055i }, { 0.013280241674359365 + -0.007763075615742574i, 0.00029422174653580225 + 0.00031394771493158677i, 0.13090146350344467 + -1.988183213714679e-19i, 0.000813264711647476 + 0.003569938858249613i, -0.005888534697310411 + -0.00015663336127281553i, -2.1379865376027967e-05 + -0.00018763885612493912i, -0.04258745468326457 + -0.026438763376586356i, 0.0006487397794523789 + -0.0014703034321835698i }, { -0.00012920675546013047 + -0.00041040859906781783i, 0.012642135672160007 + -0.007390065450159742i, 0.0008132647116474764 + -0.003569938858249611i, 0.12461174290901449 + 8.41722591308107e-21i, -2.498091470571201e-05 + 0.00014527626008184724i, -0.0056978949390158315 + -0.00016008672973350673i, -0.0008074048393045268 + 0.0009599923367055999i, -0.041172089691432205 + -0.025645439374788286i }, { -0.045866676809812226 + 0.02847454077882518i, -0.0008695747866240013 + -0.0010339114787452923i, -0.005888534697310411 + 0.00015663336127281542i, -2.4980914705712024e-05 + -0.00014527626008184718i, 0.12709412312479357 + 1.4014654736278934e-19i, 0.0010702246270934154 + 0.004469194544238029i, 0.01197212808845586 + 0.006998406950039323i, -0.0001452811143939427 + 0.0004799249210312271i }, { 0.000698692561438851 + 0.0015835163861723414i, -0.044342329108567516 + 0.02762013105026636i, -2.1379865376028065e-05 + 0.00018763885612493904i, -0.0056978949390158315 + 0.00016008672973350673i, 0.0010702246270934152 + -0.004469194544238028i, 0.11625451068968304 + 1.9219018783484183e-20i, 0.0003469091047991534 + -0.00036206160392097i, 0.010951048393252817 + 0.006401526330098122i }, { -0.0027526473850380873 + 0.0052079081467452165i, -0.00013884508246855536 + -4.951041220998474e-05i, -0.04258745468326457 + 0.026438763376586356i, -0.0008074048393045268 + -0.0009599923367056004i, 0.01197212808845586 + -0.006998406950039324i, 0.00034690910479915336 + 0.00036206160392097004i, 0.11800757293862799 + -2.4212875972169444e-20i, 0.0009937092891260878 + 0.004149671032689964i }, { 0.000153012023249824 + 0.00011069218451348774i, -0.002656103354154224 + 0.005043485845043057i, 0.0006487397794523789 + 0.0014703034321835698i, -0.04117208969143221 + 0.025645439374788283i, -0.00014528111439394276 + -0.0004799249210312272i, 0.010951048393252817 + -0.006401526330098124i, 0.0009937092891260887 + -0.004149671032689964i, 0.10794293482938384 + -8.510453431969904e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.14098083966505054, 1.0e-7), DoubleNear(0.13420681234000084, 1.0e-7), DoubleNear(0.13090146350344467, 1.0e-7), DoubleNear(0.12461174290901449, 1.0e-7), DoubleNear(0.12709412312479357, 1.0e-7), DoubleNear(0.11625451068968304, 1.0e-7), DoubleNear(0.11800757293862799, 1.0e-7), DoubleNear(0.10794293482938384, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, true}), Matrix({ { 0.16835900200214812 + -3.676253015594168e-19i, 0.0005760938895423195 + 0.004559228979407472i, -0.03954842678672603 + 4.155690972651858e-05i, -0.0006656678324219322 + -0.0010354453603837457i, -0.0547497999334442 + -0.03427259346903196i, 0.001067926044041206 + -0.0017067701555278972i, 0.012255647863638294 + 0.007695420328258184i, -0.00010638970424089048 + 0.0005667099191908791i }, { 0.00057609388954232 + -0.004559228979407471i, 0.15953831225191623 + 2.046327077984934e-19i, -0.0004224648277367974 + 0.000845039566888876i, -0.03801293243106084 + -0.00021555970172955813i, -0.0008916247628939848 + 0.001437848431927157i, -0.052776780172867695 + -0.03267724575152045i, 0.0002947191543619409 + -0.00016544973280614177i, 0.011916277979018463 + 0.0076045048325174515i }, { -0.03954842678672603 + -4.1556909726518854e-05i, -0.0004224648277367973 + -0.0008450395668888761i, 0.10352330116634709 + 1.912085451006139e-20i, 0.001113056689607312 + 0.002855533032982643i, 0.012612082268207911 + 0.008620183115217665i, -4.579828998431694e-06 + 0.0004950664766822059i, -0.033704331559632594 + -0.02064071068637957i, 0.0002795062968500238 + -0.0013470496628280137i }, { -0.0006656678324219319 + 0.001035445360383746i, -0.03801293243106084 + 0.00021555970172955802i, 0.0011130566896073116 + -0.002855533032982642i, 0.09928024299709909 + 1.4320507575803986e-19i, 0.0002903226084933178 + -3.475770378547706e-05i, 0.012530662600728437 + 0.008748901858095957i, -0.0007853548630345432 + 0.0005560553835237349i, -0.032737638627132026 + -0.020588324673534195i }, { -0.0547497999334442 + 0.03427259346903197i, -0.0008916247628939852 + -0.0014378484319271575i, 0.012612082268207911 + -0.008620183115217664i, 0.0002903226084933178 + 3.4757703785477006e-05i, 0.15202941493924788 + 8.320639767838932e-20i, 0.0009812582795616497 + 0.005469750085322137i, -0.03557368586007716 + 0.0001307012348764192i, -0.0006519667568391597 + -0.0011587893330126675i }, { 0.001067926044041206 + 0.0017067701555278975i, -0.052776780172867695 + 0.03267724575152045i, -4.579828998431667e-06 + -0.0004950664766822058i, 0.012530662600728435 + -0.008748901858095957i, 0.0009812582795616506 + -0.005469750085322135i, 0.1385237159460807 + -9.947035743803052e-20i, -0.000214339178406009 + 0.0009549518830752439i, -0.03283344450348478 + -0.0007172064262204176i }, { 0.012255647863638296 + -0.007695420328258184i, 0.00029471915436194085 + 0.0001654497328061419i, -0.033704331559632594 + 0.02064071068637957i, -0.000785354863034543 + -0.0005560553835237351i, -0.03557368586007716 + -0.00013070123487641941i, -0.00021433917840600923 + -0.0009549518830752439i, 0.09307228112417368 + 3.272727371223056e-20i, 0.0010826756366578536 + 0.0031491154916058564i }, { -0.00010638970424089048 + -0.0005667099191908793i, 0.011916277979018465 + -0.007604504832517452i, 0.0002795062968500238 + 0.0013470496628280137i, -0.032737638627132026 + 0.020588324673534195i, -0.0006519667568391598 + 0.0011587893330126677i, -0.032833444503484785 + 0.0007172064262204176i, 0.0010826756366578533 + -0.003149115491605857i, 0.08567372957298616 + 3.3584841901815675e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.16835900200214812, 1.0e-7), DoubleNear(0.15953831225191623, 1.0e-7), DoubleNear(0.10352330116634709, 1.0e-7), DoubleNear(0.09928024299709909, 1.0e-7), DoubleNear(0.15202941493924788, 1.0e-7), DoubleNear(0.1385237159460807, 1.0e-7), DoubleNear(0.09307228112417368, 1.0e-7), DoubleNear(0.08567372957298616, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, true}), Matrix({ { 0.17002665546350126 + -2.5639645356307738e-20i, 0.016016325913528327 + 0.009362476391763071i, -0.04021837913190545 + -9.02267614874842e-05i, -0.0037835592320064632 + -0.002223114518868413i, -0.05575643347520297 + -0.03471592096563984i, -0.0033405716198282942 + -0.006340416411389636i, 0.01253402064755631 + 0.00793356636618535i, 0.0007438312042749575 + 0.0014375161136808666i }, { 0.016016325913528327 + -0.009362476391763073i, 0.15787065879056308 + -1.3735294840461565e-19i, -0.0037934958613194264 + 0.0022061159933823207i, -0.03734298008588142 + -8.377603051555537e-05i, -0.007163819093267983 + -0.00019998753948778425i, -0.051770146631108925 + -0.032233918254912564i, 0.0016175510054839005 + 5.7150522336188855e-05i, 0.011637905195100447 + 0.007366358794590285i }, { -0.04021837913190545 + 9.022676148748388e-05i, -0.0037934958613194264 + -0.0022061159933823215i, 0.1051609965415501 + 2.1537407732187242e-19i, 0.009906051432991045 + 0.005790664674139244i, 0.013037425539646262 + 0.00900650081014583i, 0.0007321705233193302 + 0.0015663052385173088i, -0.034452572443176774 + -0.02137875086345169i, -0.002068179119364017 + -0.003910977580398637i }, { -0.0037835592320064624 + 0.0022231145188684135i, -0.03734298008588142 + 8.377603051555526e-05i, 0.009906051432991045 + -0.005790664674139243i, 0.09764254762189609 + -5.3048147053771165e-20i, 0.0017240520724507431 + 0.00013049991150480844i, 0.012105319329290086 + 0.008362584163167795i, -0.004422610543058259 + -0.00011673255151853803i, -0.03198939774358785 + -0.019850284496462076i }, { -0.05575643347520297 + 0.03471592096563985i, -0.007163819093267983 + 0.00019998753948778387i, 0.01303742553964626 + -0.009006500810145828i, 0.0017240520724507431 + -0.00013049991150480855i, 0.1506623413225136 + 1.595179715858216e-19i, 0.01419222859461952 + 0.008296185147643416i, -0.0354715793022937 + -0.0003041242235333889i, -0.0033246376420751986 + -0.001981882049964348i }, { -0.003340571619828295 + 0.006340416411389636i, -0.051770146631108925 + 0.032233918254912564i, 0.0007321705233193302 + -0.0015663052385173086i, 0.012105319329290085 + -0.008362584163167793i, 0.01419222859461952 + -0.00829618514764342i, 0.13989078956281498 + -1.757819313454628e-19i, -0.0033581306947407658 + 0.0019245857081756912i, -0.03293555106126824 + -0.0002823809678106095i }, { 0.012534020647556312 + -0.00793356636618535i, 0.0016175510054839005 + -5.715052233618863e-05i, -0.034452572443176774 + 0.02137875086345169i, -0.004422610543058259 + 0.00011673255151853828i, -0.0354715793022937 + 0.00030412422353338854i, -0.0033581306947407658 + -0.0019245857081756918i, 0.09268629249196299 + -1.524054395480999e-22i, 0.008730947887089157 + 0.005103748132494028i }, { 0.0007438312042749573 + -0.0014375161136808668i, 0.011637905195100448 + -0.007366358794590285i, -0.0020681791193640164 + 0.003910977580398637i, -0.03198939774358785 + 0.019850284496462076i, -0.0033246376420751986 + 0.001981882049964348i, -0.03293555106126825 + 0.0002823809678106097i, 0.008730947887089157 + -0.005103748132494028i, 0.08605971820519687 + 6.646452105359433e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.17002665546350126, 1.0e-7), DoubleNear(0.15787065879056308, 1.0e-7), DoubleNear(0.1051609965415501, 1.0e-7), DoubleNear(0.09764254762189609, 1.0e-7), DoubleNear(0.1506623413225136, 1.0e-7), DoubleNear(0.13989078956281498, 1.0e-7), DoubleNear(0.09268629249196299, 1.0e-7), DoubleNear(0.08605971820519687, 1.0e-7) }));


}
}

}
