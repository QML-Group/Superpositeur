#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { -0.22400259066927886 + -0.44051204364561514i, 0.021373945243198814 + -0.11674474757607904i }, { -0.015456124880477774 + -0.006580356122850647i, -0.10476548453933056 + 0.11495699649910039i } }), Matrix({ { -0.02558154076137615 + -0.16997605090361761i, -0.18591868954970717 + 0.2875234312570456i }, { 0.024354480421728993 + -0.11042913425049687i, 0.3842250265251228 + -0.28868798609364305i } }), Matrix({ { -0.167889355314095 + -0.7297592440064333i, -0.1263439334843803 + 0.2853212565228297i }, { 0.009204266278072002 + 0.08413901889357761i, 0.07099095301130455 + 0.18683053723594004i } }), Matrix({ { -0.0025570577496520364 + -0.2529736157399062i, 0.43897487585877937 + -0.5317511431750556i }, { 0.019346217453681494 + 0.284393794910881i, -0.010178906606229863 + -0.02529010807095296i } }) }, { QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.40959433391439215 + 0.2870224195012999i, 0.08926645241934512 + -0.005648478154306649i }, { 0.1574307245243329 + -0.02558655473369023i, 0.2342887494602892 + -0.2714897321915597i } }), Matrix({ { -0.20920883754020786 + 0.3287411130535181i, -0.026747161084768836 + 0.3176738957327232i }, { -0.046499250450225106 + -0.17930198180890666i, 0.058329919445122023 + -0.47381993715016546i } }), Matrix({ { -0.37903866856579904 + -0.1779523971984055i, 0.1354555097112429 + 0.1663141874990724i }, { 0.2796184832320002 + 0.07488529918422765i, -0.4655538483467538 + -0.2949293791067767i } }), Matrix({ { -0.1245243464521448 + 0.11627257511000727i, 0.06894491793220983 + -0.26654148651511284i }, { 0.10309664177945174 + 0.48936168134408325i, -0.25597519902361754 + 0.2069020992049086i } }) }, { QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.029134538694782997 + 0.006668581097137922i, -0.10162811013007378 + -0.04644248043134739i, 0.08557632682596074 + -0.017327561870019555i, -0.0842320440113181 + -0.16562770031921084i }, { 0.11434122298449302 + -0.08897282110966201i, -0.17125417754067998 + 0.04673664810952693i, -0.02039665268236361 + 0.04874742908141991i, 0.01221130490082637 + 0.10872770876559472i }, { 0.10202487262096167 + -0.13524401964966154i, 0.009088748396201279 + -0.049488010960729974i, -0.03996929671635222 + 0.037040793873769934i, -0.05088630735540686 + -0.05227276757690554i }, { -0.12416541382310732 + 0.1194131802931355i, -0.06889828330015389 + -0.09833909371631025i, -0.007039848134761275 + 0.00901656866277315i, 0.06700164731440715 + 0.13091963684122326i } }), Matrix({ { 0.1541621983603391 + -0.17093511457544702i, -0.09862320671319698 + 0.006521158225966508i, 0.050746158071208955 + 0.06100528610403045i, 0.08252499752484453 + 0.10570486324035744i }, { 0.08387722953828299 + 0.0047013109914214885i, 0.045782074807564736 + 0.06579565100516933i, -0.07351518514779008 + -0.17026043156023138i, 0.058903950784890975 + 0.06065133834635703i }, { 0.06681234328784014 + -0.04415316880130505i, -0.016946382774226443 + 0.08080594984537426i, -0.05641524226082316 + -0.10443220469209717i, 0.027964309616081134 + 0.1245073926888418i }, { -0.06114650186061818 + 0.15927739712635594i, 0.00942494188319472 + -0.04850829383402978i, 0.09882853329621737 + -0.009446281555802544i, -0.017460313464633854 + -0.12458130389460026i } }), Matrix({ { 0.22549863640113665 + 0.003944795807481339i, 0.0756532146569436 + 0.0020241157152651222i, 0.026226269716223452 + -0.062136492595320295i, 0.14517373492998567 + 0.07482792924303679i }, { -0.06504372078308641 + -0.05382402031743126i, -0.058258417784599975 + 0.11799771215010596i, -0.07135756288733366 + 0.008038693186866343i, 0.08531934904712742 + -0.065054707373854i }, { 0.15243391142050738 + 0.001965173058191357i, -0.10119428009485266 + 0.037568482841320465i, -0.04536400821843235 + -0.04293306893969863i, -0.10232771010487611 + -0.1822179948560177i }, { -0.02923781695810496 + 0.10422836979724655i, -0.03427538287658049 + 0.14265301975613134i, 0.0224326817954122 + 0.07624587255818967i, -0.08834853411311103 + 0.02073393163638921i } }), Matrix({ { -0.04354731711141684 + 0.18009033192465773i, 0.021784595486835787 + -0.08403015279900188i, -0.18845802201247155 + 0.004884400412415602i, -0.030409091897079823 + 0.07535136647074037i }, { -0.12222584377860686 + -0.10979272191754845i, -0.1287179582541066 + -0.03551985521069264i, -0.05755311740368901 + -0.008004626269770375i, 0.019486734137529306 + 0.03129526551573007i }, { 0.08220408655621554 + 0.013713974993714713i, -0.05062411090071498 + 0.07008648232127393i, -0.07733054565960411 + 0.19094570132878097i, 0.00683239498873686 + 0.12139585779024456i }, { -0.01690699023805157 + -0.03193856380346925i, 0.13584814347020727 + -0.040139373053193886i, -0.05277398231416037 + 0.06388548195345971i, 0.004227151309229401 + -0.09844241348824241i } }), Matrix({ { 0.002763459904029212 + -0.03573055100914964i, -0.10353382977662985 + 0.06195979421538685i, 0.1336323839996407 + -0.1161801059370692i, 0.043617038892792795 + -0.0008284216759486771i }, { -0.06408285489938513 + 0.049856440536899506i, 0.05085018449662848 + -0.022335003801269866i, -0.007301976172926484 + -0.04600951881181396i, 0.05021718630175498 + 0.07588906758022147i }, { 0.07479035094710043 + 0.047187196244189086i, 0.12574790193457608 + -0.07670478472552854i, 0.09026933198460163 + 0.18649402204854124i, 0.14360150692087614 + -0.12888866913466923i }, { -0.06863844480079682 + -0.009283960378159414i, -0.01415246377389207 + -0.058088230222557345i, -0.09646990845394544 + 0.035213762214162725i, 0.14227967761523805 + 0.16358860768893266i } }), Matrix({ { 0.055688475579766264 + -0.0043887908997763975i, 0.02315333539876147 + 0.053521193087936514i, 0.09812466322785796 + -0.018345912924074628i, -0.019604665992981364 + 0.05056044871909998i }, { 0.06818653838606942 + -0.07861495215959603i, 0.1117942816771281 + 0.000547682896107412i, -0.049984163731740035 + 0.07239838388558889i, 0.0030936185413957705 + 0.08942859974270764i }, { -0.05478292995650268 + 0.07420260483598468i, 0.007089370238154657 + -0.0021405220473925397i, 0.21841209714395707 + 0.07354158464848108i, 0.08450771510070931 + 0.1381700234461188i }, { 0.05246152808814132 + -0.01951597077036964i, -0.007046193390093305 + 0.08438660361334895i, -0.07250696352861492 + 0.14131137173668676i, -0.04005245201291332 + 0.022170045905190044i } }), Matrix({ { 0.1507307999801657 + -0.01213030885728015i, -0.026604294188393853 + 0.09061695814761807i, -0.04761461851542897 + 0.09825516541913794i, -0.11292787883686883 + -0.08864067986279921i }, { -0.09993713740025718 + -0.045045635350666816i, -0.14923707861655083 + 0.24316741597646527i, -0.2020825522606944 + 0.02484620999057981i, -0.025454211588338445 + 0.04655345448980609i }, { 0.0014953138309864145 + 0.13206241226815843i, -0.017591744126493402 + 0.09964060271137418i, 0.1469655822711343 + 0.02891065230839246i, -0.044088851961635284 + 0.06462773722704936i }, { 0.06921396594131374 + -0.14938364258302658i, -0.008375460327967377 + -0.07025088464669742i, 0.052725612287806874 + -0.13481093734457675i, 0.05963943959286752 + 0.10235421028218811i } }), Matrix({ { -0.08161600501193657 + -0.07828028709720466i, 0.20268075069132385 + 0.04714806682884668i, -0.04099923780993104 + -0.048581040652445916i, -0.0014397819026491438 + 0.07691602859132624i }, { 0.05943248816680683 + -0.05190786804331213i, 0.174145265452168 + 0.003550542303497423i, 0.13718806268435046 + 0.14653998160364998i, -0.05948510175635779 + 0.033261417360143576i }, { 0.10650550525381038 + 0.03897514583111759i, 0.012157072676885912 + 0.030209529573334996i, 0.049344684538052706 + 0.0920675145867463i, 0.03251636269893115 + 0.02298528287361569i }, { -0.0360445548554382 + -0.015983284260315363i, 0.020724568454736466 + 0.02480285281718184i, -0.12519987013449466 + 0.07449446808507867i, 0.03163827439404306 + -0.018300102956589556i } }), Matrix({ { 0.046794023392959266 + 0.022234426165653954i, 0.0073759101555416285 + -0.0735073691611479i, 0.058793476708369055 + -0.023307074459517425i, 0.09411155504491404 + -0.20469054993119815i }, { 0.007093905165764175 + 0.10392994895281028i, 0.04208568681091929 + 0.0021398072428851266i, 0.03437625530954655 + -0.0020740021604385254i, -0.005169439169007078 + 0.019729885908860264i }, { -0.09509230164924606 + -0.09132500078847551i, -0.03623082725598121 + -0.14682840478149306i, -0.09173376668566989 + 0.10096951292789122i, -0.10505496382013146 + -0.022872944813362026i }, { 0.1142991189847608 + -0.019831425942265724i, 0.051477712145779106 + 0.07214655064513294i, -0.147748920177267 + 0.12055929433026334i, -0.0454941354317158 + -0.14088816979667396i } }), Matrix({ { 0.024748574560930766 + -0.09977369127395627i, -0.06251504935704859 + 0.05504375930392998i, 0.11384345562960445 + -0.15237579054232514i, 0.017756523900379496 + 0.016452357209574765i }, { -0.07182939211907949 + -0.04430405705679i, 0.0019083079870783168 + -0.1339451343438198i, -0.024412754357684568 + 0.06776883814215541i, -0.14782378260219994 + -0.05202051689826738i }, { -0.0506734501684975 + -0.09160695849387289i, -0.2205695540061028 + 0.0942691006662868i, 0.07868553951898828 + 0.012854356652175521i, 0.23805030537694205 + -0.016293500141632555i }, { 0.09885711026705606 + 0.1283583370574393i, 0.03049732832571187 + -0.09848918596514955i, -0.15121573816001457 + 0.12432313350166906i, -0.08817820053393365 + -0.007032788396770214i } }), Matrix({ { 0.06430576169617071 + 0.02848507619568109i, 0.11217127792252635 + 0.194415298790542i, 0.0548127253798132 + -0.05879589270459316i, 0.12809664105778018 + 0.0339016263717192i }, { -0.15489090778749212 + 0.05801003941374812i, -0.062261468354193564 + -0.19564483447700307i, 0.075265889290679 + -0.030058398915306535i, -0.09320665792364524 + 0.06193927832498859i }, { -0.049092421471061354 + 0.008725919331685018i, -0.12178100071819489 + -0.04719019717080276i, 0.023971189149990618 + -0.003078047920336893i, 0.09726632249018619 + -0.03812816588979141i }, { -0.004151101873222102 + 0.0630151381120408i, -0.11529134968068282 + -0.03928117406533878i, 0.0063790605032806565 + -0.13296549543008923i, 0.0889957918505337 + -0.013808505277375958i } }), Matrix({ { 0.07581352469373788 + -0.1158576081333907i, -0.053947879966049994 + 0.05384084653292296i, 0.14568059048861556 + 0.03918292859679269i, -0.12378469226204367 + -0.06323072838888365i }, { -0.006776403370063585 + -0.05557606492041498i, 0.023077758701868793 + -0.01584617407047312i, -0.005575611415567231 + 0.01950565185037123i, 0.01884391578039939 + 0.0386877639862975i }, { 0.022334525033512815 + 0.24863335408940754i, 0.08153388680275543 + 0.09810430592946827i, 0.10610484462328919 + -0.03205313534957755i, 0.076725238106854 + 0.06136507462427165i }, { -0.03796047316664907 + 0.061978646339875744i, -0.06401144213039936 + 0.06975824541793492i, 0.006993421272482652 + 0.02628615519576982i, -0.026949946206403196 + -0.06932992560671586i } }), Matrix({ { -0.13841620945954602 + -0.0018698202980360675i, 0.050852778454018394 + -0.03619992317214811i, -0.015916222141939832 + -0.11836911282511998i, 0.06422508144107142 + -0.11470546763256556i }, { 0.035590228947555425 + -0.08057091452559412i, 0.02981957112542729 + 0.12338023173043094i, 0.013123808522838244 + -0.03945780209344697i, 0.08243271159468353 + -0.08899253482046043i }, { -0.11505661532596641 + -0.051345145981771666i, -0.015803286896840577 + 5.8329163465228715e-05i, -0.018320886880516706 + 0.031956479385417055i, 0.00788964441786202 + -0.06589152831830372i }, { 0.14809754330976269 + 0.09336250233387927i, 0.04991332939922742 + -0.1560973755685291i, 0.04413143715993509 + -0.06278888416445257i, -0.014463782419442732 + -0.10817162944985986i } }), Matrix({ { 0.016138665750486145 + 0.005475974416403127i, -0.1267470479313994 + 0.1179918694598409i, 0.11368643495176736 + 0.12727924853765807i, -0.0006541636109901632 + -0.03410346811140827i }, { -0.09927788589257985 + -0.2040487063385175i, 0.08182710701546869 + 0.07681697427311011i, 0.02354268902413043 + -0.029699250816049346i, -0.01406643983837983 + -0.14244220625450635i }, { -0.09326915539713196 + -0.015066357672346585i, 0.06873650837990666 + -0.0030635468657612287i, -0.04704248305342966 + -0.06616432774011825i, 0.1435267590862092 + 0.11909417146066714i }, { -0.010662892870617294 + -0.06464085142882682i, 0.25500689808025345 + -0.06956973214034186i, 0.07471318003166297 + -0.0022407536748295064i, 0.07043709231147183 + 0.17805336139982209i } }), Matrix({ { -0.06264459513574645 + -0.05716921391228726i, -0.12765514751269946 + -0.07065513797152256i, 0.017307413994944055 + -0.0056229802728397i, 0.1337728388066872 + 0.19318362704867947i }, { -0.08310232628318474 + 0.06960146715654474i, 0.13632405384522003 + -0.07494503466512775i, 0.17361212932785355 + -0.04309935135952072i, -0.02537818284501165 + -0.10360384294629538i }, { -0.18102116591566222 + 0.1576707436997242i, 0.07827464758813736 + 0.09139572104632371i, 0.0039047467171790503 + -0.026570848709594468i, -0.023928087115645848 + 0.06096085422324262i }, { -0.14734624733160767 + 0.04932977034105728i, -0.06433894944758888 + -0.011958222574890343i, 0.14699125790150802 + 0.0850601492127287i, 0.00922753611191562 + 0.035053934259135916i } }), Matrix({ { 0.04780749367963843 + -0.02246366575737933i, -0.11740660769286276 + -0.02386439144134469i, 0.02382147838285055 + 0.13337259507055932i, 0.14114407058855288 + -0.10687656752430921i }, { 0.03423843348714732 + -0.06590727726019163i, 0.0023248381877198107 + -0.055457958024483174i, -0.23130248915722526 + -0.039879829825284895i, 0.08962023431928245 + 0.15845918703606063i }, { -0.030710724699897187 + 0.14373485034199163i, -0.05409041844313296 + -0.029662517113709666i, 0.04658631687055686 + 0.03498715881818016i, -0.04534436740424204 + -0.04553072426606679i }, { -0.06813988456278376 + 0.03211382450677131i, -0.05513062450682046 + 0.13048127718809366i, -0.01691523547865727 + -0.1966886505483154i, -0.11310281500132939 + 0.031096769923089993i } }) }, { QubitIndex{ 2 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.1863686433891951 + -0.19492498667992536i, 0.15283302423402345 + 0.19974907203611916i }, { 0.034210646201420884 + 0.18171637804295235i, -0.0007516189371468904 + -0.39711390369707006i } }), Matrix({ { 0.08818654079692159 + 0.5291273622760261i, 0.027501227870060818 + 0.10940225404090251i }, { -0.09865517342262399 + -0.05136498859128223i, -0.08977870379108754 + 0.22726359561577153i } }), Matrix({ { 0.4099061692405222 + -0.3655251570958559i, 0.012759214662124402 + 0.0021675471518010254i }, { -0.10930809779141458 + 0.02804369143814723i, -0.042510553675960974 + -0.7880940375669956i } }), Matrix({ { 0.30123486477087863 + -0.3432955090430035i, 0.08782038339488142 + -0.2615505915252902i }, { -0.1169707347945734 + 0.2373038372613043i, 0.006229524540979962 + -0.08591528111247794i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.17695021056120552 + -0.08092612731464584i, -0.07846799820454745 + -0.07445726444881656i, 0.00928035070115058 + -0.01719108101889239i, -0.015558346046346268 + -0.0887007429425307i }, { -0.00019473007500735856 + 0.06583256810667991i, -0.04606423476765766 + 0.03791803300216497i, -0.11266725896524188 + 0.013178767439799418i, 0.01860980498186423 + -0.03886769741841368i }, { -0.037600241906814325 + 0.0812897487895263i, -0.01594089315791593 + -0.06396104013980092i, 0.09472784648371257 + -0.1639753982815724i, -0.1902984119200408 + -0.009517406209168149i }, { -0.08777898798380931 + 0.14487709860377906i, -0.026457750994380323 + -0.10914981032098965i, 0.0368134984985005 + -0.11959179414254859i, 0.0915198961891293 + -0.11872775669162229i } }), Matrix({ { 0.05056307826813594 + 0.13240670866192966i, 0.11470165302654506 + -0.11191132136358031i, -0.007485568551408529 + 0.03801510711756742i, -0.01968298214481325 + -0.06842752354261174i }, { 0.08711671431332718 + -0.018850816372850823i, 0.018080027148146906 + -0.0935911212246613i, 0.03452926068356776 + 0.1692193684614406i, 0.14947949908613653 + 0.06819760375250061i }, { 0.020340561277343745 + 0.07746694637471396i, -0.08014285861751136 + 0.006813798419886805i, -0.039323695304233255 + -0.028960735456460565i, -0.18468030303438315 + 0.003513713134718832i }, { -0.012096273473980963 + 0.08565613388184913i, 0.09958084785237009 + 0.07330389839427301i, -0.049609669747346506 + -0.019915324401910985i, 0.015427636134383341 + -0.084703798787498i } }), Matrix({ { 0.05840094725837617 + 0.07457861121283162i, -0.05060361821944141 + -0.05174664831955167i, -0.05549576118833686 + 0.1343642394421402i, 0.1736324263434946 + -0.1325306340100298i }, { -0.14228205173455635 + -0.02015708069521837i, 0.015205079817293573 + 0.05816525209638341i, 0.1828000052680347 + -0.011208117008168551i, -0.0424766668602232 + -0.05975982784260891i }, { 0.028605725488960912 + 0.13433582699387037i, -0.013837216225866037 + -0.02222952625060191i, -0.012820872714770162 + 0.1291548642134031i, 0.17977531449380954 + 0.017255638859481174i }, { -0.01232783412401672 + 0.08138668733785324i, -0.13706358992229936 + 0.07354510285805772i, -0.034886736142023894 + -0.1125404631767501i, -0.027145045462914033 + -0.024813503215417688i } }), Matrix({ { -0.0703530757905032 + -0.030039591043900304i, 0.10121787130326224 + 0.042157954481721195i, -0.020515672201182344 + 0.06988322738034271i, 0.09896187057734808 + 0.09961332271364444i }, { -0.13422603567433075 + 0.12940206482298233i, -0.037185905002716776 + 0.11122156977024997i, -0.1328555467099871 + 0.0041681264123306135i, -0.05718476308666651 + -0.18484561766249544i }, { 0.03258378760663668 + 0.029142843677196818i, -0.12715060242780046 + 0.0054452835481856865i, -0.040324923225930356 + 0.06354787928012552i, -0.19571476893437714 + 0.15302726829542218i }, { -0.10903619297499971 + 0.05701026114997501i, 0.035777520082659706 + 0.1746700556398874i, 0.12264999160154139 + -0.07918479863187072i, -0.002916331648494246 + 0.01473469390871711i } }), Matrix({ { 0.011957655090209221 + 0.1804296391373791i, -0.06806896753259614 + 0.07310128876322645i, -0.03667923970130478 + 0.15877347622236182i, 0.10663417923052675 + 0.11360371768971829i }, { -0.08134899082450323 + 0.11394847651990261i, -0.07788454161000662 + -0.10379918745861334i, -0.1238179868524621 + -0.06690869154424547i, 0.16359688917929383 + -0.19725418973793052i }, { 0.10047537721087958 + 0.11284592791152845i, -0.01537197777598758 + 0.05120053432436374i, 0.008446279288697251 + -0.03105236684991095i, 0.055432247334021925 + 0.014941044694974039i }, { -0.1512896315782237 + 0.10729105049683808i, -0.0019179575950517326 + 0.1460719623132496i, -0.0648355068731057 + 0.010828637915841153i, -0.09250231285729756 + 0.10889598229500148i } }), Matrix({ { 0.044277273504731714 + 0.005727039282219496i, -0.059866693920321616 + -0.08390085792489413i, 0.0789305569759686 + -0.01725279698747084i, 0.030865769560337188 + 0.2240754691813741i }, { 0.12813042938736385 + 0.08164295001834251i, -0.08107863316209259 + 0.06806295934932415i, -0.004936115828530735 + 0.05046492631032602i, -0.17695807959161894 + 0.0914050410632992i }, { -0.11432212373849111 + -0.05536126509670916i, -0.11846420340638102 + -0.02379348944558088i, 0.0802300970121359 + 0.07456011788961751i, 0.11274939792963559 + 0.06475559887726673i }, { -0.1539337130935487 + 0.09462244479193786i, 0.15106469995717503 + 0.06119201406543232i, -0.007324272329346039 + 0.17474014834509452i, -0.012596853398611453 + -0.03775294093611425i } }), Matrix({ { -0.05373622176745833 + 0.022037261186823327i, -0.07418075114728301 + -0.05609447453671655i, -0.10014624726171084 + -0.02601921480138027i, 0.024594562169107638 + 0.040972603139105786i }, { -0.0006623096104443919 + -0.08837801637910031i, 0.006656390324578662 + -0.03666765853590079i, -0.000891761215082777 + 0.016555715554065428i, 0.05994546389820528 + -0.0030074962531918847i }, { 0.21322129675863602 + 0.04027442420493435i, 0.05028350407734801 + 0.21611803730784288i, 0.06274105943486397 + -0.07409274188180773i, 0.10443710131300932 + 0.03620561092151571i }, { 0.13449147310789086 + -0.09361186310360796i, -0.1689232038753966 + 0.2456095305437562i, -0.00022897495508189083 + -0.05704169795288258i, -0.014428215965728786 + -0.004452331561944667i } }), Matrix({ { -0.12318218321777105 + 0.14929410291566653i, 0.022587477212618393 + 0.12427567097765i, 0.20259648261448124 + -0.03403803633167066i, 0.04744678734505397 + 0.07008287662650955i }, { -0.009348511584809547 + 0.10629105824076872i, -0.04054488925748939 + 0.028502184912157436i, -0.059370464860464586 + -0.01169482733863698i, 0.06530243360221105 + 0.1150546026235124i }, { 0.00410490326280959 + 0.018407574043775455i, 0.10433447523524671 + -0.02775730023163589i, 0.10476479884938639 + 0.03331521316099168i, 0.005725888540642714 + 0.016540049988957327i }, { 0.040453530678475194 + 0.0724363208452177i, -0.007971422479963798 + 0.08308014650907873i, -0.06523305930556988 + -0.03791188110878381i, 0.1233363328650996 + 0.06048174838752736i } }), Matrix({ { 0.1554337518076217 + -0.07996785685644305i, 0.00020595906093488756 + 0.03907697910201749i, -0.21826605260273632 + 0.07947461047846487i, 0.03119140720546603 + -0.011943125528420908i }, { 0.15461820192549805 + 0.028041376216702545i, 0.06675812515510432 + 0.02466759300636536i, 0.0019874127304651164 + 0.049174338779054916i, -0.13040770803834578 + -0.005220535744108146i }, { 0.15255647011701792 + 0.123921389746478i, 0.01363402100787309 + -0.10576579225368109i, -0.045591385246657685 + -0.06398407458922409i, -0.20566736922282491 + 0.05710814385211766i }, { -0.008967418019377523 + 0.03615171281799889i, 0.1042390758810882 + 0.03516749773133365i, 0.034383411772703175 + -0.07641453144490581i, -0.0434250152984981 + -0.0069543626015835065i } }), Matrix({ { -0.021806510316458645 + -0.16839802508065446i, -0.023847200734532267 + -0.02346086864783247i, -0.026351102541673804 + 0.09856051258449884i, -0.16040929933239992 + -0.07088839393670453i }, { 0.11295030696271495 + -0.04831857102290803i, 0.030246198758293364 + 0.06988355311095105i, 0.07137465961121546 + -0.006651808915599008i, -0.09549436103180753 + -0.08763375411420517i }, { 0.10255463824610446 + -0.10246853405379693i, -0.04341388065268065 + -0.10988553234477244i, 0.1703572436588955 + -0.04724537610212983i, 0.035326515941257186 + 0.02582761911319065i }, { 0.12351157596571402 + -0.04961703857477024i, -0.026976343649048964 + -0.0006092531193469778i, -0.08508121146519676 + 0.15511032145320827i, -0.13596748282460197 + 0.006234292808700246i } }), Matrix({ { 0.08098423783508968 + -0.018012808618145776i, -0.0986950129027577 + 0.05315799210326518i, 0.03320716656618544 + -0.0738241043225784i, 0.07175955684380292 + -0.04729633074907606i }, { 0.04336561145831866 + -0.15449826929306434i, 0.02732181860603368 + 0.007124424949975358i, -0.11409076129407558 + -0.137088045287942i, 0.031344637700091195 + 0.1076037356394729i }, { -0.22490832483693146 + 0.0587957386511945i, 0.03853223264329099 + 0.056423388624207725i, 0.12447481116881687 + 0.06839153190968855i, -0.0923700405859095 + 0.04602408385876354i }, { 0.08339300703611151 + 0.027771132071144886i, -0.06967124088441819 + 0.06802194564830351i, 0.008413841088148806 + 0.009702490159497394i, 0.04114645285835282 + 0.010338870147812936i } }), Matrix({ { 0.0618267517105981 + 0.062185908054416886i, -0.09502331770888353 + 0.1561034282952178i, 0.15386593356354483 + 0.08905036646365137i, 0.050609461471402634 + -0.047453814575705i }, { -0.03218940028078701 + -0.05130854674135932i, 0.02191385900548479 + 0.09366735453222845i, -0.045702173030354794 + -0.11227358910699305i, -0.12032072531362877 + -0.02821767058106539i }, { 0.056738215878522805 + -0.0006336890585650823i, 0.028773904791323947 + -0.05109490096066011i, 0.035469815656462726 + -0.043978928261651305i, 0.016606976811105505 + 0.08266758198338862i }, { -0.053363189669401304 + -0.04143068158496654i, 0.20131889612443798 + 0.264545528745187i, -0.12155600202260683 + -0.09896497325257916i, -0.08066450529322093 + 0.03483514144002126i } }), Matrix({ { 0.0318965191434087 + 0.09123191710773416i, 0.153140898107451 + 0.08684865952741247i, 0.10055469319952294 + -0.04949030094790148i, 0.003772215359837777 + -0.02049822712509528i }, { 0.13582182586217453 + -0.053706467906207214i, -0.011846432087990494 + -0.06385120790364326i, 0.01667172588898586 + -0.1685021369750345i, 0.0782365517734535 + 0.043265086014364726i }, { 0.07606257516306228 + -0.050072047128432655i, 0.0814034160380081 + -0.014591279102798137i, -0.05311591948669942 + 0.1543935403824718i, 0.06189552095138962 + -0.08651112286063256i }, { -0.15055315886795925 + -0.06675632322469277i, 0.08322695422815868 + -0.20258536628800822i, 0.04401141621184611 + 0.03161260191671956i, -0.024408093039855742 + 0.061444338703343135i } }), Matrix({ { 0.026661972661115915 + 0.05782124548406726i, 0.05842946968396343 + -0.017099312877028722i, -0.07384022458545128 + 0.07679158439143853i, -0.0004862687409430449 + -0.13162083667252558i }, { -0.007605169665620398 + 0.06854782228675388i, 0.061484658589287575 + -0.02504373015732738i, 0.0561691994285037 + 0.056754789879552243i, 0.13246139841157797 + 0.059468926226247734i }, { -0.03504926732762166 + -0.0238659546636113i, 0.034389875898147494 + -0.10398525865226722i, 0.05538371725084681 + -0.03301654476721452i, -0.09044208539219818 + -0.04893720068931142i }, { -0.1276284351250915 + -0.021881556848566748i, 0.10275834949335166 + -0.02710968884018206i, -0.045049424718626115 + -0.08366763777118395i, -0.060262276190800004 + 0.021554233871770946i } }), Matrix({ { -0.0018701337575422958 + -0.010028019273593534i, -0.04918485151269147 + 0.011374575222229259i, 0.07260281704279081 + -0.13665515788273327i, -0.18214700339108442 + 0.026384020993743273i }, { 0.018709406017262346 + -0.02744317423389072i, -0.07360185864077416 + 0.17709515677335014i, 0.06616954857155757 + 0.09258382908296119i, -0.0011368134943619556 + 0.09496940679085784i }, { -0.11765496525023374 + -0.0859700936107718i, -0.057695901422869504 + 0.21574194626032375i, 0.040124368452051314 + 0.09502133961089826i, -0.009825658244438642 + -0.011827242028111112i }, { 0.046903956505462266 + -0.00457346767623898i, 0.08462181797297777 + 0.04984017843765693i, -0.00840134125460707 + -0.014101468033821712i, -0.0010474653429058277 + -0.04670017657498956i } }), Matrix({ { -0.06925750337531232 + -0.10177729602747364i, -0.04423219925663996 + 0.008480707884525552i, -0.016390738884162807 + -0.09527368927658804i, 0.008537008332010806 + 0.00360646265789686i }, { 0.08948489051679899 + 0.0751040674824913i, 0.0163497275689235 + 0.12186806572613769i, 0.2190679197237762 + 0.1610094152081521i, 0.003806099379541826 + -0.02098455793857427i }, { 0.04617533438269064 + 0.025246566271985692i, -0.06535036467263024 + -0.13502160945005467i, 0.2020496276280292 + 0.06446302472628923i, -0.03627269734791272 + 0.061840320294135664i }, { -0.015899211658534473 + 0.014700626599452347i, -0.08312643593437939 + 0.04432444731411887i, -0.01769394951258403 + -0.11863357446606689i, 0.19159093984622644 + -0.02237123936791226i } }) }, { QubitIndex{ 3 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.09099619668952519 + -0.034250438996756755i, 0.21488030590237567 + 0.06144651537258594i }, { 0.32622709264446276 + -0.2219954292466031i, 0.2532504541152672 + 0.02588129361729843i } }), Matrix({ { -0.1304682494482444 + 0.2658363503111895i, -0.12603087435966176 + 0.4271704204251469i }, { 0.17539581848794294 + 0.07842507480803942i, -0.5006023490733069 + 0.14489970241284544i } }), Matrix({ { -0.24665969013732825 + -0.04245434496288743i, -0.4062014350723361 + 0.1313470331393023i }, { -0.17764975386982132 + 0.45274939185915963i, -0.08535967147238555 + -0.10369510223931913i } }), Matrix({ { -0.3427533594247149 + -0.05905741753408917i, 0.2805865577302459 + 0.31662174898082296i }, { 0.18993584018492032 + -0.5039913787944895i, -0.1244905480598094 + 0.14325333994513956i } }) }, { QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.183393130444383 + 0.29258045656609327i, 0.16388453585447516 + -0.44924351181013067i }, { -0.18461366817472996 + -0.03269964438892219i, -0.2328397536950727 + 0.0543829553397431i } }), Matrix({ { -0.44108125192570025 + -0.27194488854303533i, 0.010293244734845858 + 0.11388158316339819i }, { 0.12407971545248983 + -0.20940131841094278i, -0.02467511065133155 + -0.1852138744509605i } }), Matrix({ { -0.22284675807448306 + 0.19365662802293498i, -0.18791478047896631 + 0.02145753859800026i }, { -0.18529496934282869 + -0.38506370115024935i, -0.22890450360836848 + -0.10365180616343206i } }), Matrix({ { -0.0977631440287602 + -0.4236732855414591i, -0.18646156407943854 + -0.05233148849163306i }, { -0.19596591673487918 + -0.14363011270211537i, 0.5752496971812735 + -0.44590379004232195i } }) }, { QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.5034402783668056 + -0.18259459424002428i, -0.06966500989738514 + 0.36846448454699154i }, { 0.3531158417577255 + 0.04648481848424091i, 0.5996016654851567 + -0.22249290386203335i } }), Matrix({ { -0.29851310886925725 + -0.12801767589227384i, 0.26908291938602696 + 0.23739959584171128i }, { -0.047756576647547885 + -0.14388056507459648i, -0.046491700927136434 + 0.12440932260952282i } }), Matrix({ { 0.11162159420189274 + 0.38043119454716784i, 0.12623289109573038 + 0.1319921991631403i }, { 0.06777278246659782 + -0.023056720570296164i, -0.26605915469207037 + -0.03261525747618002i } }), Matrix({ { 0.1739832109141907 + 0.17413457918176367i, -0.2772832981389641 + -0.30086817691320633i }, { 0.48159651318059166 + -0.05508455098812679i, 0.17261804595101823 + 0.039236816126685864i } }) }, { QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.12859449026898062 + -0.30173015973780637i, 0.149195287631894 + 0.1503150474947838i }, { -0.015634439229814664 + -0.15453529083863307i, 0.37900785382289387 + 0.12108837753618662i } }), Matrix({ { -0.4952176691113143 + 0.18461229419159642i, -0.14324198005657726 + -0.07913167263860332i }, { -0.11345666048467336 + 0.016822227618644933i, -0.3384447985356576 + -0.4137004894110418i } }), Matrix({ { 0.33178335613832854 + 0.19271613755540715i, 0.05062402496764578 + -0.019218279725445066i }, { 0.031047599251239434 + -0.10285199625616852i, 0.18969364856078663 + 0.18556149633738056i } }), Matrix({ { 0.35252988575463173 + 0.49275018104931373i, 0.39170297182512864 + -0.3735343134278729i }, { 0.07330452727559834 + 0.21119500283883438i, -0.3089313651371183 + 0.15039005264461774i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.0027441760887905176 + -0.00856015262873108i, 0.008185766780754873 + 0.05961529236893932i, 0.00871675151530463 + -0.06352057752456548i, 0.0416231504596803 + 0.004082733715958746i }, { -0.02681306444664768 + -0.24606417901588568i, -0.000796935733964207 + -0.03276577079785661i, -0.10334558762315188 + 0.05215241348714395i, 0.11655243143913906 + -0.009396865100112048i }, { -0.005924637298220764 + -0.0650511333840153i, -0.02433007621745152 + 0.003113358933517691i, -0.001087734766781348 + 0.04755815989380203i, 0.16971290619960552 + 0.033935827132133826i }, { -0.06409025870305986 + -0.07751219424686322i, -0.1118378600346987 + 0.02782355953411468i, 0.04273951985623461 + -0.029074585697210224i, -0.08262172137180791 + -0.09833364833245811i } }), Matrix({ { 0.03084397216749999 + 0.012880910427373006i, 0.03371339995920475 + -0.05726889073966855i, -0.04913583957985621 + 0.07948897199069031i, -0.06294731912677279 + 0.01455967373664629i }, { -0.13115981349450984 + 0.054862636771814376i, -0.18107947729578178 + -0.07403731814766779i, -0.013450709670566696 + 0.202769758167587i, -0.24472665529438176 + -0.14466698950869944i }, { 0.052141363184401435 + 0.050823389961730664i, 0.2175376605712197 + 0.06616451903144421i, 0.11397261499253104 + 0.029927734237586046i, -0.1755386952237339 + 0.020116145719036888i }, { 0.0341052384226912 + -0.12677082712784768i, 0.004814359085318818 + 0.016810419024149627i, 0.1783179572668133 + -0.01860472145925056i, 0.1496344108135522 + 0.039524204159508025i } }), Matrix({ { -0.07423927646304676 + -0.07138015420281806i, -0.09528874546245017 + 0.03128842933127525i, 0.06657302080016553 + 0.026518186457304995i, 0.09438614708033394 + -0.07194661969542553i }, { -0.14443022192300617 + -0.029325852612716388i, 0.07610041317649568 + -0.050501256777650105i, -0.05317310259002393 + -0.024680457038235903i, 0.03617677618534351 + 0.04694978493845032i }, { -0.03703227743490137 + 0.07806990292491313i, -0.10448676503925176 + -0.041910242928627134i, 0.08641304945002876 + -0.14623920219717815i, 0.0736860785372968 + -0.12101411168105491i }, { 0.04682870920816036 + 0.05286532867076238i, 0.03356934463218539 + -0.010051766704879348i, 0.037772543360562676 + -0.09901444594382842i, 0.014646691829712701 + 0.08709559279668748i } }), Matrix({ { -0.045589178544507475 + -0.01641316167229384i, 0.04240583036193744 + 0.05364207789838027i, 0.03414300585796991 + -0.07805871768034262i, 0.08622287636235393 + 0.042389600649333135i }, { 0.20826341970544535 + -0.0061745087555042585i, 0.04239858430408656 + -0.07448010392879999i, 0.11116814189395673 + -0.12724078450344048i, -0.015800585481680653 + 0.022411324356461475i }, { -0.02161828331850819 + 0.08744364007004349i, 0.05806247569930818 + -0.03077355920587673i, -0.1167452463255266 + 0.0952831447195941i, 0.028583604396394856 + 0.13506627778230354i }, { 0.10672264703647279 + 0.08041693392754935i, -0.0055523003227151806 + -0.05698011961567819i, 0.008919267252166048 + -0.010674440853455949i, -0.06962285569170468 + -0.2248145911564176i } }), Matrix({ { 0.09009156544885794 + 0.009378133237457394i, 0.06734513718934466 + 0.10007826592963828i, 0.03044655040473836 + 0.17626586446192327i, 0.023323596851883375 + 0.128302374140212i }, { -0.016363383611626786 + -0.041888381389497936i, -0.010988358024691957 + -0.0920003767607422i, -0.10491590058722225 + -0.03951640024723141i, -0.15157878713576062 + 0.08797415001527192i }, { -0.0690123336398599 + -0.011504702273197423i, 0.11217107178761154 + 0.11871143209748965i, 0.11743364289003402 + -0.0005959908027607765i, 0.08381120498252305 + -0.061374448837166765i }, { -0.022459454075449133 + -0.1248123171764848i, -0.15626151089646434 + -0.21933063791213186i, 0.10690135118835312 + 0.05563909496092901i, -0.07286091090966278 + 0.05431768989911274i } }), Matrix({ { 0.01908500945066087 + 0.044071699147443216i, -0.1278073694397765 + 0.05861465034755327i, 0.08704098200159986 + -0.10584516412081196i, -0.04110370590029061 + 0.0703349681185066i }, { -0.027212081937151415 + -0.01763185311677036i, -0.03353490505006487 + 0.08752938332151936i, 0.07809745246605462 + 0.1264801930533655i, 0.0791331978124672 + -0.004831393997155011i }, { -0.020303356427971375 + 0.106745796830871i, 0.09205610987023082 + 0.04017674648062511i, 0.018371769681313994 + 0.07115808939901219i, -0.24772853372986672 + 0.05278189860591522i }, { -0.03937661260750127 + -0.0513743098299806i, 0.05016738851282907 + -0.2125979753661016i, -0.0375807024634419 + 0.0037076922251170234i, -0.046276643383234575 + -0.27382129323726695i } }), Matrix({ { -0.17743092212130726 + -0.0953062860396329i, -0.07130401172993443 + 0.02988362973676845i, 0.003988140703133581 + 0.011775689933596007i, -0.056325816992966356 + 0.06117445315894083i }, { -0.013866614477036424 + -0.01024220514227394i, -0.05427454841989358 + -0.032576196227499216i, 0.15809039537379307 + -0.11015344156723593i, -0.0008625921365718308 + -0.030390969761732417i }, { 0.03279926822470947 + -0.04664199588991367i, -0.042289011188082676 + 0.07677951269175264i, 0.028494209824730818 + 0.10595177458999475i, 0.05366910157065183 + -0.2015445863301137i }, { -0.044517543609289216 + 0.02157219154146794i, -0.06718445519746259 + -0.22862619036251935i, 0.13974017129807248 + -0.047923490402587095i, -0.07582202046623465 + 0.06665032867431851i } }), Matrix({ { 0.24070611269970268 + -0.08210943379643701i, 0.040903572411377036 + 0.029492711899819984i, -0.13991129726403875 + 0.11590932363903393i, -0.03534996410499377 + -0.1145051990901903i }, { -0.10683710576512143 + -0.08844824250261382i, 0.19785670943823952 + 0.03997882566853098i, -0.05246251332333949 + -0.04704601228770774i, -0.0006275771725911698 + 0.037174769142493645i }, { -0.061187833140680895 + 0.036224453924984315i, 0.07132169757842524 + 0.07029418913729632i, 0.05570690596306906 + 0.03814469914879358i, 0.020298827049215745 + 0.06996179061008424i }, { -0.24371265294049532 + -0.07679392572588503i, 0.011505110993864932 + 0.0020638034860310833i, -0.09067266894287412 + -0.02320918325886488i, 0.0789199217475486 + 0.019539086922631985i } }), Matrix({ { -0.2185087664468881 + 0.03945393084216449i, 0.0015536150793656993 + -0.03337879567430266i, -0.00392367416727616 + -0.05316802245413127i, -0.001883083175772784 + 0.177359723180168i }, { -0.07707749314239525 + 0.10337284326442199i, 0.07620048559278818 + -0.08262692668263052i, -0.04360638387281127 + -0.07113972724996592i, -0.0660350031944677 + 0.15672496703141092i }, { -0.0009891667030508344 + 0.014588886687882184i, -0.0016382178888095162 + -0.06602983465009414i, -0.00578214684415034 + -0.08730238180055516i, 0.03210386362795157 + -0.02672414669148095i }, { 0.041965837976493246 + 0.08545231238048892i, 0.06230751114001423 + 0.08479355336559097i, -0.14567309986511193 + 0.20599962419045842i, -0.10255975450672586 + 0.02819507119061194i } }), Matrix({ { 0.19195541677909436 + 0.09546322565607168i, 0.011509083078930359 + 0.04460895373911671i, -0.01477646223395937 + -0.06768934584815832i, -0.11705722223757135 + -0.10417219729437772i }, { -0.05497717738926674 + -0.08618031835021368i, -0.039265981826051614 + 0.07567139602601124i, 0.22148181141728565 + 0.06966247216062571i, -0.09018784218742666 + -0.13106901440505828i }, { -0.1657549101183229 + -0.12587849924876346i, 0.1700480850250371 + 0.09998663716432049i, 0.0529964748632094 + 0.0892173538416385i, -0.04796283866634718 + -0.10641775790611127i }, { -0.08860626437769879 + -0.049134579348308165i, -0.1550260033634677 + 0.01840525355949488i, -0.11490922723386883 + 0.1096874483670681i, -0.05469783898901572 + -0.0027125232051776944i } }), Matrix({ { -0.03927235827101611 + -0.008614479946516899i, 0.15023730371921373 + -0.09086789382753141i, -0.043472807258991934 + -0.009217282666960052i, -0.07872233896151966 + -0.10492364498197088i }, { -0.1382004705694281 + -0.051745552810166864i, 0.09262923271235109 + -0.09900456052148032i, 0.032615690558746434 + -0.051262405873734186i, 0.06393415963874596 + -0.021247436116128404i }, { -0.08389200616062613 + -0.0739192643282159i, 0.07814035294321155 + 0.014083331387083144i, 0.035467011991705114 + -0.12217160554632998i, -0.078728997003681 + -0.12733642185536448i }, { -0.095343151798121 + -0.03177175288294467i, -0.04739147524410082 + -0.0741055071439223i, 0.1218842124372097 + -0.17016380077291363i, 0.09347840068334563 + -0.004471993696560243i } }), Matrix({ { 0.0084511741237131 + 0.09081904376311228i, 0.11121433115307923 + -0.08224985896515896i, 0.028481424311593086 + -0.0006612918117690248i, 0.15657094393503757 + 0.02436203870748754i }, { -0.0980306791585109 + 0.06896002982900888i, -0.10442073130180382 + 0.08101978803896082i, 0.10821248436000358 + -0.049738616605187524i, 0.057146717936838 + -0.010998407859440472i }, { 0.08914061532523106 + 0.06675240014761778i, -0.08697702018573726 + -0.08106957120781541i, -0.019156641360708833 + -0.16952216894136105i, -0.04699959239171223 + -0.05577921913554477i }, { -0.16867178384438164 + -0.11165505473205228i, -0.051446328920453206 + 0.02997015872334804i, -0.08246968824617339 + -0.07787570489183473i, -0.04843383537965085 + -0.01029274917342721i } }), Matrix({ { -0.0009688707121028997 + -0.05321363916899613i, 0.14981851831451454 + -0.035714055084397046i, -0.033954673164975704 + 0.07308104031831339i, -0.04414705534454888 + -0.025026053159714748i }, { -0.013837502177627714 + -0.06863297184887121i, 0.12698048607653514 + -0.058845678473218886i, -0.013610186359147378 + -0.08061147810879209i, -0.13891177721629536 + 0.09736840545936148i }, { -0.057674120963444965 + 0.028929992283191805i, 0.16765855704850796 + 0.07067804118527964i, -0.03752267407913938 + -0.15227513908944731i, -0.04181510157372142 + -0.006056078565157452i }, { -0.01719229840715472 + -0.05397448796691888i, 0.1529050701416219 + 0.09587535263830893i, 0.0507097707011037 + -0.03981420735523249i, -0.03330745769487198 + -0.0660439853028535i } }), Matrix({ { -0.060169320478385344 + 0.020392665351213236i, -0.054829635342713526 + 0.04709520354187658i, -0.028486416858003193 + -0.006021989152867232i, -0.040528939265757964 + 0.03877583739084863i }, { -0.10902553063545081 + -0.014970472237138936i, -0.06242396219223717 + 0.014792450298834647i, 0.11923632309907464 + -0.0962799426395072i, -0.09481833408644912 + 0.048784414516074466i }, { 0.10404648538009584 + -0.12160503156907079i, -0.19012891822111364 + -0.0024353791803857364i, 0.003182462389233217 + -0.0921735869557042i, -0.0033150285148615703 + -0.05512091675570631i }, { -0.07185971893152387 + -0.03394805614272023i, 0.05180489870000478 + 0.06695971268485479i, -0.06934592119673291 + 0.16503589793361145i, -0.017455288038828877 + 0.04639866352407039i } }), Matrix({ { 0.005233767333312369 + -0.22883355316800633i, 0.10934556229671907 + -0.038155637009107075i, -0.08088721661647015 + -0.08662513824422666i, -0.017406577161565344 + 0.027585546024315045i }, { 0.07509331581331823 + -0.010981278268275257i, 0.07978364857793717 + 0.05945073672148916i, -0.010391764517619868 + -0.02704412927371237i, -0.11985074276126063 + 0.00788924572840987i }, { -0.0892860595950834 + 0.11080171908432888i, 0.09071370960395982 + -0.055382526815677825i, -0.07867291309579678 + 0.14747123949852825i, 0.12732613824315248 + -0.10518779136722885i }, { -0.07660505697774626 + -0.018659702172094932i, -0.021450440424860284 + -0.10111408061175904i, -0.009192875371518009 + -0.00420676986719464i, -0.012568942374928749 + -0.11196724801500231i } }), Matrix({ { 0.06208493174679099 + 0.05900829399282241i, -0.09538526764521756 + 0.03200928826056491i, 0.04069651460394416 + 0.07846877077280373i, -0.03255236250410616 + 0.0034675520112248826i }, { 0.09909809035703258 + 0.003906690727140528i, 0.11745841141552522 + -0.03910072806504895i, -0.21841831978761886 + 0.0930179583540659i, -0.05277353327486022 + -0.011562957155162949i }, { -0.05377908184483461 + 0.05283187984071882i, 0.026803141273125608 + 0.1956158652484325i, 0.028793384891871915 + 0.09704879693028903i, 0.03151585065758797 + -0.033530846049504265i }, { 0.181225044862162 + 0.0425039990181548i, -0.06652626035298162 + -0.05491850663540945i, 0.06414774351523482 + -0.06617775739988052i, -0.0892406459051267 + -0.02484589650246326i } }) }, { QubitIndex{ 6 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.05875751362898839 + 0.05508020050190534i, -0.010141853892512473 + 0.060328504675890696i, 0.07542489786967006 + 0.00919872990423123i, -0.0641418420685048 + 0.027826156825894094i }, { 0.018202537591256427 + -0.04167219700797082i, -0.06127070149979892 + 0.033823718831964396i, 0.05814431761450641 + 0.010092512363530827i, -0.1755145793075388 + -0.008746824428706508i }, { -0.05645564865163841 + -0.049614019086799896i, -0.054466118851689824 + -0.012079518477907569i, -0.0009033135927121763 + -0.07405488096930583i, 0.03149254974940107 + -0.03503001895553719i }, { 0.0715564624198282 + -0.009441969307358848i, 0.013238953070946666 + 0.016585146611650357i, 0.06284212926049049 + 0.06911752360516053i, 0.002174955718745057 + 0.06785459591932022i } }), Matrix({ { 0.040852921250663254 + -0.0210162208566928i, -0.001918355207795896 + 0.08929562400991405i, -0.016589490598950138 + 0.08803464360893701i, 0.10404648103337388 + 0.07799251472614635i }, { -0.008823808159484815 + 0.02920024827299626i, -0.10252424592100196 + -0.08994026438093584i, -0.09276123516925669 + -0.007152567043048002i, 0.07113575523407815 + -0.1428209796821931i }, { -0.01934597473255073 + -0.002691730624438137i, -0.07752395113961635 + 0.16553604672512276i, 0.07192670761141128 + 0.05190956950653272i, -0.08723610016997833 + -0.1491503305686312i }, { 0.30923830218083015 + -0.013656209592008526i, -0.1381642782671248 + -0.110595596387255i, 0.040307323167294136 + 0.006957337481210027i, -0.08129629448245566 + 0.016937109788655577i } }), Matrix({ { 0.012283259038282065 + 0.02919534052533603i, -0.07782650187466414 + 0.08859598676559577i, -0.1003690753638285 + -0.12653835154371096i, -0.08462083213447497 + 0.12050813270213123i }, { 0.015843105025559037 + -0.14460707750969196i, -0.0847161458508986 + 0.16807422070520356i, -0.09992382992313557 + -0.02641201403854441i, 0.010152157827153216 + -0.07958626238568411i }, { -0.05985430466083983 + 0.022035022708655955i, 0.0340397778135187 + 0.0814613032915536i, 0.1832874412556601 + 0.0845069420518521i, 0.040892860585238736 + -0.015884324953117694i }, { 0.08110433996538598 + -0.06485252914993421i, -0.14998526566300818 + -0.05332488593241466i, -0.094952606277129 + -0.050203675157144516i, -0.04174273717366092 + -0.08154237157426619i } }), Matrix({ { -0.0594533806344637 + 0.034134068424608796i, -0.2412241975955809 + 0.03301101237144956i, -0.1763198811777586 + -0.025341792564640957i, 0.060208414422678797 + 0.020342259207228264i }, { -0.03096139221943275 + 0.051592769544258864i, 0.12320576430999092 + -0.08843591560463615i, -0.07823258627329331 + -0.16570533926764938i, -0.0601634354370743 + 0.003566442535261446i }, { 0.07023324719043858 + -0.15998529058929897i, 0.048412880161242275 + -0.05296803833596242i, -0.16595216491672002 + -0.003702045207173545i, 0.04134252431128632 + -0.029125066102315595i }, { -0.07008199676476967 + -0.13980279276630464i, -0.02358925822944728 + 0.17376712931040605i, 0.007200686858694976 + 0.038615158518335094i, -0.12941607362412347 + 0.08111799746341944i } }), Matrix({ { 0.042327024962456224 + -0.16896243013178847i, 0.12090684619667363 + 0.07999004979875719i, 0.004377711323954371 + -0.12585691914579547i, 0.10175622340639677 + -0.18480831698311262i }, { 0.13508456259522753 + 0.008196996831128485i, 0.09649903281033574 + 0.08398245060115077i, -0.02906967566412637 + 0.032611704418189724i, 0.12177310645380411 + 0.0019447573060717594i }, { -0.07642621326646536 + 0.010288251925243968i, 0.023125393649018822 + -0.055611272132461954i, 0.11892080910659003 + 0.06700374764163188i, -0.05623831176850569 + 0.17833264247326694i }, { 0.09957321090844556 + -0.09242229699198999i, 0.24195348662960905 + -0.1519479516583207i, -0.026130219881770163 + 0.025498239711989883i, -0.05602382345315939 + -0.017178070812724655i } }), Matrix({ { -0.09541509241164628 + 0.0344324855188781i, -0.009269913747497225 + -0.10176580997938219i, 0.0756342379443589 + 0.17026343741461558i, 0.0199861202287382 + -0.0025803529316898665i }, { -0.07466722318876781 + -0.07984612834899454i, 0.07085326419065267 + -0.16076096682451307i, 0.156125072781213 + 0.07473589525102206i, -0.07592485084993515 + 0.058756611045586805i }, { 0.13429352609993533 + -0.03387169908060105i, -0.07425423418228097 + -0.14630385032083618i, 0.08523711578997546 + 0.008885985733549453i, -0.04913970231707482 + 0.06074712014702148i }, { -0.03165751949446474 + 0.0400550530962395i, -0.03598985882694114 + -0.05417803608365406i, -0.11193800757086356 + 0.22087700454321235i, 0.17316851198078148 + 0.08917978849228356i } }), Matrix({ { 0.07908388817429035 + -0.02324791914520233i, 0.09435345158130239 + -0.05011708174954496i, -0.04327280508827969 + 0.07384900263917203i, 0.012257590550568017 + -0.0386991358036699i }, { -0.1419377899470365 + 0.010094417158486238i, -0.11404974181176646 + 0.015928790982815133i, 0.10644330675977702 + -0.1006740142943107i, -0.02959115884178553 + 0.038653587316366214i }, { 0.04697521697967889 + 0.06878829467183639i, 0.05966417798081595 + 0.023467029888733833i, 0.051875249053597326 + -0.14347594119388482i, -0.0637811358494491 + 0.006786890728406724i }, { -0.06602018661556819 + -0.04924849021509603i, 0.034025738535109165 + -0.09928681142596618i, 0.04020755045193554 + -0.01768642951999251i, -0.16761536287106518 + 0.14436282671996087i } }), Matrix({ { -0.15485645957339103 + -0.08063658864923222i, -0.06655827113968402 + 0.16708603824987575i, -0.004889402424652173 + 0.05903809668753119i, -0.058849294821604135 + -2.3467176718298026e-05i }, { 0.026445137989566173 + -0.04535898878564939i, -0.1642153743878153 + -0.02880872598634155i, 0.15511162803251502 + -0.05380966625229393i, 0.04111492930202022 + -0.035528436501144074i }, { 0.08625881206070349 + 0.07137653785271922i, -0.015311216964131553 + -0.07908752043113026i, -0.28915812783637823 + -0.08722501804202737i, -0.016728617039432816 + -0.05446899810177188i }, { 0.21728793332878013 + 0.05663313481986874i, 0.1230080305456868 + 0.09036970530291927i, -0.08537933530237628 + 0.0296465468655707i, -0.11422604871897057 + 0.023515753026385852i } }), Matrix({ { -0.08392508851806554 + -0.1422165256125782i, -0.07586678349563461 + -0.05642463068611923i, 0.027916327298427576 + -0.07508154011106315i, 0.10188179453809658 + -0.02999937150091194i }, { -0.10411882116293007 + 0.029363711102045453i, 0.06210077564348494 + 0.07034982045353066i, 0.048094095619393866 + 0.018875444904733304i, -0.027158545129686053 + 0.11456759363237443i }, { -0.03649923412722495 + -0.12621242297774338i, 0.0060799511993798565 + 0.0792534640004598i, -0.11480073193108918 + 0.14284080290195023i, 0.03865174500656064 + 0.08938619443604742i }, { -0.03391978604677681 + 0.05252271480662525i, 0.0216281719312458 + 0.06701471747923823i, -0.026296040175893386 + 0.012176708340756933i, -0.04341660969953011 + -0.01096325865491199i } }), Matrix({ { -0.032187185805817836 + 0.13798211884860725i, 0.007737247270550086 + -0.06287891867387413i, -0.1887433042129612 + -0.017686585548834486i, -0.08157847381832975 + 0.12012311388030476i }, { -0.14997937281809925 + -0.002063981847324556i, 0.03342721274805226 + -0.023577652585607806i, 0.10817561057978456 + 0.04455498318592041i, 0.08457294924076177 + -0.1309783685316855i }, { -0.08450025432609963 + 0.07092039649665795i, 0.009289159968064477 + 0.08299529701161315i, 0.09594493683148535 + 0.11672768223301377i, 0.04998423905143929 + 0.05518936243248152i }, { 0.07676132872005348 + 0.03336842721908898i, 0.00420679810375297 + -0.06951416721383882i, -0.06366900961513598 + -0.027767826171073054i, 0.007440023600814542 + -0.09317146877671242i } }), Matrix({ { -0.11541298809849375 + -0.16133663228663675i, -0.008272771377728498 + 0.04442968176142789i, -0.028676424277735375 + -0.16981980640674332i, 0.02619587048342631 + -0.04747283225421084i }, { 0.0328218542319759 + 0.030338559199402076i, 0.017638376599843377 + 0.11924400559659029i, -0.030255041723234184 + -0.018139600983055292i, 0.042488161217494186 + 0.08131811490656463i }, { 0.04413558944967799 + 0.030838805261764815i, -0.007697442267102955 + -0.017727852275874534i, -0.07605716232523282 + 0.08735336595260638i, 0.029012065081896753 + 0.015336364133824429i }, { 0.04869430079359794 + 0.13239108754060896i, -0.018069357808927558 + 0.015274158443702902i, -0.013015374865757438 + 0.0654013523226017i, 0.0894624284144948 + -0.05765837885845964i } }), Matrix({ { -0.019679133586454293 + 0.11025266587510996i, -0.11685736367334948 + -0.008268500668540039i, 0.01678137645658707 + 0.006496517914334198i, -0.08591119850698764 + 0.060986311929531946i }, { -0.04800420827764506 + -0.05195522432100936i, 0.088758039581107 + 0.05434552396027967i, -0.03132866035271037 + -0.014723332359432146i, 0.04254511132202969 + -0.08668822035465333i }, { -0.04824342765603018 + 0.04866903157397804i, -0.030126659508457068 + -0.08445940512791346i, 0.0895990242326241 + 0.09680572220652772i, -0.1571847968645111 + -0.058848477406805745i }, { -0.03404825513117258 + 0.011204512951067837i, -0.0882388162361205 + 0.11861922552410241i, 0.042734127767258136 + 0.07700363548729044i, 0.002563575305697339 + -0.04566969843401893i } }), Matrix({ { -0.09048514142938077 + -0.052064164801693506i, -0.06195586566993573 + -0.015742119589818616i, 0.017006221887049255 + -0.07858667447590217i, -0.05553506704022011 + -0.258137469654825i }, { 0.10439060410226847 + 0.0735525400742413i, -0.06544821632247251 + 0.12559251105851799i, -0.014048369748180202 + -0.1000977062273951i, -0.07079654145783751 + -0.01255138947352715i }, { -0.11539672826854577 + 0.134854702131085i, 0.10957839736244997 + 0.0747740491850871i, -0.03604301285401613 + -0.032672533968822304i, 0.015809380661961372 + 0.06831217368329164i }, { -0.04424341793682382 + -0.10723173695720975i, -0.14844869749174916 + -0.08098357582561502i, -0.09867685844056247 + 0.014714430739263354i, 0.04467433108572985 + -0.041440356017184696i } }), Matrix({ { -0.07328195745058956 + -0.05689716915234254i, 0.015286153339398539 + 0.04483961195171502i, 0.007397517960820755 + -0.02495382022603496i, -0.050620980602671395 + 0.15848860731401965i }, { -0.1812426800672167 + 0.02973297017684875i, 0.045280971814830165 + -0.16138204391601954i, -0.033256986773468 + -0.018246373914744856i, 0.01246478186538791 + -0.17331277806135723i }, { 0.01518274019826092 + -0.0537359109120433i, -0.12215798413547665 + 0.03935820740709631i, -0.026089090015804273 + -0.147930541490447i, -0.035564305563483584 + 0.2108855186771355i }, { 0.09856741089785995 + 0.15806720935716784i, 0.0811127567775503 + 0.05501051363309783i, -0.047368500317150564 + -0.024902490629695608i, -0.056123291549577535 + -0.06570576067154575i } }), Matrix({ { -0.1348491935692929 + -0.05135167543555425i, 0.06503414049034136 + -0.013425934363564061i, 0.08211027478577218 + 0.022633178659404334i, -0.11631268642358154 + 0.08343696548339383i }, { -0.025653646568370516 + 0.31057307479891016i, -0.035932469868021115 + -0.03953270170174495i, -0.02737801758131601 + 0.08485112789360173i, 0.06560287877603316 + -0.15331749313513368i }, { -0.04986217593151371 + -0.04101617301967675i, -0.010072019571785839 + 0.07635881071442326i, 0.048302685763347404 + -0.1537090389156198i, -0.06909422309171077 + -0.07481416404518543i }, { -0.091513196381488 + 0.038738891119638574i, -0.20227386749864465 + -0.05167195355967729i, -0.22335582022794473 + 0.043439989828477105i, -0.05893746989844355 + -0.038758641827139916i } }), Matrix({ { 0.015874281028542814 + -0.14046323165333968i, 0.11202153465164703 + 0.09119871047496635i, -0.022160246761631607 + -0.1449527058753829i, 0.013697264518808146 + -0.17155424526705107i }, { 0.07966100737650654 + -0.027936821469121745i, -0.039696862395885324 + 0.16656607093314157i, -0.029861322595210966 + -0.16250475520032273i, 0.09673148305923707 + 0.016911003944459956i }, { -0.04248376954491955 + 0.007952319456661855i, -0.03763467171409412 + -0.10255243310008007i, -0.08367828295669347 + -0.06124597113170283i, 0.2465889233399621 + 0.10948504160933226i }, { 0.008455379603164484 + 0.06375631578312918i, -0.00980841878528772 + 0.08228506130379618i, -0.017627626258195687 + -0.07978307739236054i, 0.07389884421292174 + -0.16743910355928407i } }) }, { QubitIndex{ 8 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.017203287432379977 + -0.06665909044756076i, 0.08751741767255083 + -0.05810688434648439i, -0.06617025738446833 + -0.1425608721973856i, 0.024617599468324196 + 0.10032018355943594i }, { 0.023747468941790084 + 0.02484357481002218i, -0.0036396401389103892 + 0.014026408620706936i, -0.07308203179281349 + -0.13599797114805712i, 0.024234504563847747 + 0.07846690868508802i }, { -0.21973448476818974 + 0.047289920359653556i, -0.10179107985488209 + 0.16188818424217025i, -0.10232235834300552 + -0.06900135632698538i, -0.11139563917508775 + 0.04585390133278915i }, { 0.07029223562521593 + -0.06826242186535175i, 0.11420405075928343 + -0.09241296300603558i, -0.013539803721579771 + 0.15208176510431465i, 0.019220249870890813 + -0.0008668172445297812i } }), Matrix({ { -0.06026767800814395 + -0.03229092729150655i, -0.07123650526211531 + -0.03820562934250236i, -0.08001273184091669 + -0.10546184938695842i, -0.07443884642080119 + 0.044443333614411086i }, { -0.07941001334387329 + -0.05773031458936104i, 0.15013301987673466 + 0.06433161699134184i, 0.08020592664975129 + 0.05548066503146347i, -0.13703900552785567 + 0.03818283462017403i }, { -0.026395036658062296 + -0.09189754748010186i, -0.010044185172323602 + -0.008335060982688346i, -0.13415944288181678 + 0.1152210998229678i, 0.11264847674192525 + 0.18881149995758872i }, { -0.08225434816571639 + -0.14202488752936449i, 0.008797029278340002 + -0.036282893642665126i, -0.016656021599897455 + -0.15128558952064752i, -0.0005296992382790483 + -0.05219268888516794i } }), Matrix({ { 0.12838763682235574 + 0.07661431838098469i, -0.21456024916075547 + -0.0489973262026228i, 0.05320343103903025 + -0.07908152999884056i, 0.04234858360855516 + 0.1255602356368487i }, { -0.04035281500298989 + 0.05993271750286249i, 0.04352044914373629 + -0.02203777315544716i, -0.029871977575592616 + -0.03867748541536013i, -0.03347492401975112 + -0.026524809645963453i }, { 0.2062524190264477 + -0.06332748700714953i, -0.021654744735615444 + -0.025053427996910942i, -0.030290685623040492 + 0.056560351540657895i, -0.22994019635543195 + -0.03287575940981403i }, { -0.056786947256144485 + -0.02074717280909157i, -0.128236083908429 + -0.13305985875168125i, -0.03798086013596061 + 0.22323365779125298i, 0.0046958296208770125 + -0.0758099352219841i } }), Matrix({ { 0.03881692203315219 + 0.019812114698426815i, 0.0037137007093320184 + -0.05926240754443101i, -0.13482549491656184 + -0.0018511792159919141i, 0.019799601372121615 + -0.020050142569745754i }, { 0.008601031765149127 + -0.06899146313394244i, 0.1489851837168702 + -0.12323405097898395i, -0.05047106424860725 + -0.12050171322146205i, -0.1511456857981555 + 0.028240339865336177i }, { -0.06482714056867768 + 0.04010352880605261i, -0.03869739915129792 + -0.08714249244509654i, -0.09300785260921832 + -0.1763196796653091i, 0.20254055847119515 + 0.03147634531898305i }, { 0.04950236813591535 + 0.062299436559057064i, -0.10443941230467219 + -0.044839128512014825i, -0.022573216001594912 + -0.12043819798155615i, 0.20071117782941747 + -0.08549110414707972i } }), Matrix({ { -0.03743347634663066 + -0.045281440274847984i, 0.027870194748897407 + -0.03541516891441074i, -0.0492754500192882 + 0.05169104546130854i, 0.061926263353456024 + 0.03190672432402738i }, { 0.08118667101492048 + 0.04811498942124155i, 0.19927626787598499 + -0.03772340955069895i, 0.02184223694123769 + 0.013271177097278826i, 0.07708212962869164 + 0.05036367993201179i }, { -0.06463039310851358 + 0.04044249668709973i, 0.027149660681469706 + -0.09913547349935532i, -0.01801251073715289 + 0.08142380752886902i, -0.002062762515939175 + 0.07414711739425531i }, { 0.047641701208729174 + 0.11400600438855882i, 0.021942045594914056 + 0.022569652156927862i, -0.10733879137757373 + -0.025301788572366944i, 0.035428022757935884 + -0.05805709772755987i } }), Matrix({ { 0.04694896507316379 + 0.07449589136442579i, 0.0405414134971652 + 0.0937363011970118i, -0.13224953306465906 + -0.012833657844611901i, -0.07555084260756262 + 0.0708048890144443i }, { 0.18102941206800535 + 0.16176268540638028i, -0.14254841346721409 + -0.029712737831467956i, -0.12030546731135054 + 0.056241842731506626i, -0.05704009479644203 + 0.17588774410801855i }, { 0.11954333118381703 + -0.0013736138132593844i, 0.17931661409313945 + -0.05020240171053925i, -0.08064515694245959 + -0.027260988810352892i, -0.029123700182502807 + -0.03073147559587421i }, { -0.01211138704722938 + 0.08092674443323117i, -0.20637822913280077 + -0.049780738453769825i, 0.13076314789942137 + 0.09598159962859705i, 0.053863973769625005 + 0.17796726369548146i } }), Matrix({ { 0.04225391898797999 + -0.1244126812069676i, 0.028243685748317468 + 0.1052909500950993i, 0.12068863833361114 + -0.007723655048973394i, -0.014675487075497288 + -0.16748676211562158i }, { 0.03140976886678377 + -0.02026362169542976i, -0.04821954490399732 + 0.02246622777444014i, -0.03534244186148895 + -0.07646653911280563i, 0.029863766841675687 + -0.020476573143917605i }, { -0.07771996436223841 + -0.01760159822438692i, 0.07439447553016884 + 0.12313750202185808i, -0.010382182697076968 + -0.06830316331185936i, 0.01350087096880904 + -0.01594799383878839i }, { -0.006445340992729598 + -0.013897823420303788i, -0.054391094239287466 + 0.038464795615005924i, -0.0968128649210374 + 0.16060790280257684i, 0.13568267638808587 + 0.0024352022914798646i } }), Matrix({ { -0.09890764852724204 + 0.016131807536912113i, -0.10465658649291584 + -0.048495031084866254i, -0.04467609394828155 + -0.0718198555225819i, -0.10786386796719209 + 0.06807526299953279i }, { 0.03392344013304495 + 0.014396850825435641i, 0.03175298881177271 + 0.06341399203715099i, 0.07285292674499456 + -0.1388908641225206i, 0.053567330501934345 + -0.114082918002809i }, { 0.023552343813258523 + 0.07250829266031589i, 0.010466265516411676 + 0.19220538734784542i, 0.015641141373912308 + 0.0664210690844624i, -0.10667563295902387 + 0.19624216080559365i }, { 0.09359928766184163 + -0.08816054851989023i, -0.09415679589094593 + 0.015769428731725568i, -0.15582855819717117 + -0.1437516631309761i, 0.004343312807439929 + -0.015651523978775082i } }), Matrix({ { -0.03325395731966177 + 0.03314602983889249i, -0.04234572914685912 + -0.1088664272199607i, 0.09534560188381669 + -0.07257644022826094i, -0.09120468246650477 + -0.12576862281450155i }, { 0.0031429221248707633 + -0.09074459541904237i, -0.009965409659501743 + -0.10129794379320749i, 0.04195684603500173 + -0.12348583881312428i, -0.06553880205555948 + -0.09624573780035822i }, { 0.1326871831678803 + 0.003125513271953177i, -0.09613531553143834 + 0.00555214316807577i, 0.012036792385288876 + -0.015053219394719194i, -0.10131474953001372 + 0.08459376899223298i }, { 0.1255609066790485 + 0.00023143418229508092i, -0.07829502629770299 + 0.10387764602256845i, 0.19003234749923695 + 0.08013650942434189i, -0.024825417530456608 + 0.10911012842955095i } }), Matrix({ { -0.005136071394564845 + 0.0390906367810112i, -0.10560078591143027 + 0.007083284417338186i, -0.1474971739017454 + -0.13340859952937886i, 0.09487403003954219 + 0.07000597833787223i }, { 0.061308431208830075 + 0.06613561967367058i, 0.05220051950842373 + -0.0383993560086016i, 0.1050382616819238 + -0.021231549688521773i, -0.009225728722619028 + -0.016716578550495964i }, { 0.0998000539527802 + 0.06576821578625519i, -0.0009275897870599535 + -0.14489687449259825i, 0.03941164911850796 + -0.048343317063580464i, 0.11498473077966626 + -0.15717131795246125i }, { -0.12947616578887286 + 0.11488157752170398i, 0.07257533514139233 + 0.10300955016778468i, 0.0657211885590343 + 0.030229242850927984i, 0.12783800984135338 + -0.01895849620697469i } }), Matrix({ { 0.07255567470735338 + -0.1609705251118383i, 0.003715496604054701 + -0.00012906698299024807i, -0.004128769540912241 + 0.023687487625435072i, -0.10661587932496773 + 0.12375967883809007i }, { -0.1541298685277216 + 0.1251846362071173i, -0.020499053130035794 + -0.08129532270043512i, -0.037296188778408304 + 0.027702192131903256i, -0.11551014620023595 + -0.02376049693554022i }, { 0.11551499941884186 + -0.12534094106490595i, -0.1656653334305693 + 0.07438425313293053i, -0.06578822036799921 + 0.1290043359431456i, -0.042439573023862996 + -0.08304384016192665i }, { 0.015038422921494259 + -0.08651909706901798i, -0.022566280775652224 + 0.0038750299135759943i, -0.02032721309569461 + 0.041054737276843084i, 0.15738980115189452 + -0.018188328152669245i } }), Matrix({ { -0.17884453774960615 + -0.025749483952389244i, -0.04800379363690067 + -0.12027442134129122i, 0.02750029537380396 + 0.13480676471696215i, 0.07535578832586572 + 0.023257102234868935i }, { 0.03911160335011342 + 0.07173067903297788i, 0.16073129083232104 + -0.06432537910673972i, 0.04992698821782667 + -0.03056844486540521i, 0.08448490195273546 + -0.05132175489957298i }, { -0.09184588887361789 + 0.17870355988790107i, -0.0558848661167414 + 0.03394736910688799i, -0.04351075655545437 + -0.051981983422028255i, 0.1685651042592572 + -0.14590522994884017i }, { -0.07946205739440891 + 0.09089282137432908i, -0.0740120900157282 + 0.021946523432329695i, -0.03211717459705563 + 0.08689372495955873i, 0.05047003369920051 + 0.052514709345470464i } }), Matrix({ { 0.1332593776427892 + -0.09192667525242845i, -0.14959827710339998 + -0.020076107647020964i, 0.04929752072422099 + 0.03531404099459838i, 0.05674362051416848 + 0.14751063168217984i }, { 0.02091142045776703 + 0.09484646371246044i, 0.12624201028303134 + 0.020925329151741518i, -0.07602339473021856 + -0.029899544052221023i, -0.1252045100114173 + 0.045531533691880434i }, { 0.1086427305988352 + 0.01420988917844082i, 0.10098659082076893 + -0.015317736122839484i, -0.027306312586979326 + -0.12207187660272456i, 0.07542673039674083 + 0.030792726889176635i }, { -0.147798762672047 + -0.08230785403993214i, 0.09497758978745927 + 0.0614429293977595i, -0.19938247906314638 + -0.10254973412527396i, 0.08058058617803669 + 0.07067233494822346i } }), Matrix({ { -0.1277062610908615 + -0.023815678532709814i, -0.01884074763029544 + -0.05130639830814811i, -0.12734041306087868 + 0.0549322498202445i, -0.0985026530518985 + -0.02989088443655574i }, { 0.04113389846251886 + -0.041295400562325724i, 0.10357964082638406 + -0.018306052844460446i, 0.021024437612953886 + 0.08068292155163163i, -0.011669716907012274 + -0.016293686708754317i }, { -0.038045124848196034 + -0.10676727520395361i, -0.10138768655299973 + 0.06193237821952734i, -0.16731201210316404 + 0.005757158018091407i, 0.09657211701346735 + -0.09362515957175963i }, { -0.014489674653176205 + 0.03250974478661091i, 0.14432650776196007 + -0.08104115787082253i, -0.110834203547496 + 0.043479244854952366i, 0.0402706256147919 + -0.10104947466597668i } }), Matrix({ { 0.006245295457623803 + -0.18802379680391157i, -0.07157946228089795 + -1.6140351438929253e-05i, 0.04710124962158676 + -0.03882120120737668i, -0.06685497752327736 + -0.007348521884594983i }, { 0.15403089987874127 + -0.06171919804860382i, -0.012390671793112516 + 0.06031085868997497i, -0.1590777689008879 + -0.08836060667890461i, 0.04150195230360932 + 0.04709427322564328i }, { -0.1973529538295924 + 0.013376284538425846i, -0.16074391663587187 + 0.20435416598888334i, 0.026571093043080564 + -0.028110183398609666i, -0.15251155012566683 + -0.09056273951119312i }, { -0.0936885208529125 + 0.10807114420870477i, -0.05379303636463005 + 0.04678624460653973i, 0.015749142044400363 + -0.05130888984396474i, -0.030814480574493836 + -0.10812753464102107i } }), Matrix({ { 0.12698225538746877 + 0.014020367913576968i, 0.046250330145543195 + 0.09192915460396302i, -0.04179431903278855 + 0.1678535332773522i, -0.07235562833448855 + -0.01997850618776543i }, { 0.059170003846662225 + -0.0946795609431299i, 0.056013945712276116 + -0.08514972448552909i, 0.0325535171452649 + 0.12806231547474056i, -0.03271771650685062 + -0.06028804865333998i }, { 0.13233797128324604 + 0.09840509942699333i, -0.21687958870218488 + 0.025803628190178125i, -0.019211349990801766 + -0.08277658656344099i, 0.09198986890692473 + -0.024297749427159423i }, { 0.05717064465630569 + -0.12240283197417683i, 0.0369218642227353 + 0.08250784142796125i, -0.039759446087126664 + -0.0035771864640755267i, -0.03635823879297086 + 0.05733247772442741i } }) }, { QubitIndex{ 5 }, QubitIndex{ 7 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 9_12_2_100_0_0) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false}), Matrix({ { 0.4063666802366216 + 3.051436192483617e-19i, -0.008561204129360199 + -0.05444307507707041i }, { -0.008561204129360199 + 0.05444307507707042i, 0.5936333197633776 + -2.272165881009661e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4063666802366216, 1.0e-7), DoubleNear(0.5936333197633776, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false}), Matrix({ { 0.5104754130797122 + -8.06798882259722e-20i, 0.03254935056546274 + 0.05230047541771492i }, { 0.032549350565462744 + -0.05230047541771492i, 0.4895245869202869 + 1.5860691937336764e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5104754130797122, 1.0e-7), DoubleNear(0.4895245869202869, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false}), Matrix({ { 0.4687531282758067 + -1.9905274260476154e-20i, 0.003224504380681661 + -0.056455580513055395i }, { 0.0032245043806816615 + 0.056455580513055395i, 0.5312468717241926 + 9.783230540787159e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4687531282758067, 1.0e-7), DoubleNear(0.5312468717241926, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false}), Matrix({ { 0.4962394158866811 + -7.517417406881925e-20i, 0.13906375710462252 + -0.16797753739744647i }, { 0.13906375710462252 + 0.16797753739744647i, 0.5037605841133181 + 1.5310120521621464e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4962394158866811, 1.0e-7), DoubleNear(0.5037605841133181, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false}), Matrix({ { 0.6100717846589525 + -1.461131834013669e-19i, 0.27495107370774174 + -0.002913020928841157i }, { 0.27495107370774174 + 0.0029130209288411573i, 0.3899282153410467 + 2.2404021454876234e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.6100717846589525, 1.0e-7), DoubleNear(0.3899282153410467, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false}), Matrix({ { 0.42942706783152446 + 1.187651058269457e-19i, 0.02965552523863609 + 0.024324696971136053i }, { 0.02965552523863609 + -0.02432469697113605i, 0.5705729321684747 + -4.083807467955031e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.42942706783152446, 1.0e-7), DoubleNear(0.5705729321684747, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false}), Matrix({ { 0.5136246728350069 + -5.0821976835258165e-20i, 0.0350744940735978 + 0.03440103635483908i }, { 0.035074494073597806 + -0.03440103635483908i, 0.48637532716499227 + 1.2874900798265356e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5136246728350069, 1.0e-7), DoubleNear(0.48637532716499227, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false}), Matrix({ { 0.5274590358294472 + 1.6036505637390823e-19i, -0.011149654728432618 + -0.008072512465377109i }, { -0.011149654728432618 + 0.008072512465377105i, 0.472540964170552 + -8.243802522651284e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5274590358294472, 1.0e-7), DoubleNear(0.472540964170552, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true}), Matrix({ { 0.546838817847147 + -6.435332816764548e-19i, 0.023670275616893898 + -0.004364085954316641i }, { 0.023670275616893898 + 0.004364085954316641i, 0.45316118215285206 + 7.214603128238501e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.546838817847147, 1.0e-7), DoubleNear(0.45316118215285206, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false}), Matrix({ { 0.20744019895562094 + 2.2827537928503394e-19i, -0.004370284214394889 + -0.02779185123929733i, 0.013226971533145107 + 0.021253170570293863i, 0.0025687370752640985 + -0.0022198417826590168i }, { -0.004370284214394889 + 0.02779185123929733i, 0.3030352141240914 + -3.089552675110061e-19i, -0.0031260603442021637 + 0.0013243316904317313i, 0.019322379032317635 + 0.031047304847421058i }, { 0.013226971533145107 + -0.021253170570293863i, -0.003126060344202164 + -0.0013243316904317313i, 0.19892648128100066 + 7.686823996332773e-20i, -0.00419091991496531 + -0.026651223837773085i }, { 0.0025687370752640985 + 0.0022198417826590168i, 0.019322379032317635 + -0.031047304847421058i, -0.00419091991496531 + 0.026651223837773085i, 0.29059810563928623 + 8.173867941003995e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.20744019895562094, 1.0e-7), DoubleNear(0.3030352141240914, 1.0e-7), DoubleNear(0.19892648128100066, 1.0e-7), DoubleNear(0.29059810563928623, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false}), Matrix({ { 0.19048565258797093 + 8.576208590949786e-20i, -0.00401309121744535 + -0.02552036175533138i, 0.0013103311405860511 + -0.022941666833921646i, -0.003101221048610903 + 0.0003077758149300033i }, { -0.00401309121744535 + 0.02552036175533138i, 0.27826747568783566 + -1.0566736016997404e-19i, 0.003046009768172839 + 0.0006588796830975915i, 0.0019141732400956098 + -0.033513913679133756i }, { 0.0013103311405860511 + 0.022941666833921646i, 0.003046009768172839 + -0.0006588796830975919i, 0.21588102764865064 + 2.193815333388638e-19i, -0.004548112911914849 + -0.028922713321739034i }, { -0.003101221048610903 + -0.0003077758149300033i, 0.00191417324009561 + 0.033513913679133756i, -0.004548112911914849 + 0.028922713321739034i, 0.3153658440755419 + -1.215492279309921e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.19048565258797093, 1.0e-7), DoubleNear(0.27826747568783566, 1.0e-7), DoubleNear(0.21588102764865064, 1.0e-7), DoubleNear(0.3153658440755419, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false}), Matrix({ { 0.20165516403643097 + 1.6114801821513064e-19i, -0.00424840693644035 + -0.02701679977532017i, 0.0565108773158374 + -0.06826047422652333i, -0.01033576689135903 + -0.006132968581739676i }, { -0.00424840693644035 + 0.02701679977532017i, 0.2945842518502501 + -2.363221922839498e-19i, 0.00795466046822215 + 0.00900914855535323i, 0.08255287978878512 + -0.09971706317092316i }, { 0.056510877315837385 + 0.06826047422652333i, 0.00795466046822215 + -0.00900914855535323i, 0.20471151620019062 + 1.43995601033231e-19i, -0.004312797192919848 + -0.02742627530175025i }, { -0.010335766891359028 + 0.006132968581739676i, 0.08255287978878512 + 0.09971706317092316i, -0.004312797192919849 + 0.02742627530175025i, 0.29904906791312746 + 9.105604182983614e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.20165516403643097, 1.0e-7), DoubleNear(0.2945842518502501, 1.0e-7), DoubleNear(0.20471151620019062, 1.0e-7), DoubleNear(0.29904906791312746, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false}), Matrix({ { 0.2479128458378898 + 1.0757318430129612e-19i, -0.005222949082028376 + -0.033214183974589716i, 0.11173095505010977 + -0.0011837546443129816i, -0.0025125060847287174 + -0.014944242981586812i }, { -0.005222949082028375 + 0.033214183974589716i, 0.36215893882106265 + -2.53686367702663e-19i, -0.002195318450468764 + 0.014994120915196626i, 0.163220118657632 + -0.0017292662845281752i }, { 0.11173095505010977 + 0.0011837546443129818i, -0.002195318450468764 + -0.014994120915196626i, 0.15845383439873179 + 1.9757043494706553e-19i, -0.003338255047331824 + -0.0212288911024807i }, { -0.002512506084728718 + 0.014944242981586812i, 0.163220118657632 + 0.0017292662845281752i, -0.003338255047331824 + 0.021228891102480704i, 0.23147438094231493 + 2.6469779601696813e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2479128458378898, 1.0e-7), DoubleNear(0.36215893882106265, 1.0e-7), DoubleNear(0.15845383439873179, 1.0e-7), DoubleNear(0.23147438094231493, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false}), Matrix({ { 0.17450485195844323 + 9.480366189775994e-20i, -0.0036764127863782928 + -0.023379330094077916i, 0.012051017341897903 + 0.009884746355922371i, 0.0010704242982951914 + -0.0018227866831717484i }, { -0.0036764127863782923 + 0.023379330094077916i, 0.25492221587308117 + 2.396144392918578e-20i, -0.0015781983085579054 + 0.0014062892908622972i, 0.017604507896738186 + 0.014439950615213684i }, { 0.012051017341897903 + -0.009884746355922371i, -0.0015781983085579054 + -0.001406289290862297i, 0.23186182827817836 + 2.1033995735060173e-19i, -0.004884791342981907 + -0.0310637449829925i }, { 0.001070424298295191 + 0.0018227866831717482i, 0.017604507896738186 + -0.014439950615213684i, -0.004884791342981906 + 0.031063744982992504i, 0.3387111038902964 + -2.5117803203015194e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.17450485195844323, 1.0e-7), DoubleNear(0.25492221587308117, 1.0e-7), DoubleNear(0.23186182827817836, 1.0e-7), DoubleNear(0.3387111038902964, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false}), Matrix({ { 0.2087199531875828 + 1.4738373282224826e-19i, -0.0043972456700163455 + -0.02796330662459203i, 0.01425310571766701 + 0.013979434940215297i, 0.0015726183014974284 + -0.0022040776086344666i }, { -0.0043972456700163455 + 0.02796330662459203i, 0.30490471964742405 + -1.9820570965750633e-19i, -0.00217317810849364 + 0.0016150490196438294i, 0.020821388355930795 + 0.020421601414623784i }, { 0.01425310571766701 + -0.013979434940215297i, -0.00217317810849364 + -0.0016150490196438299i, 0.1976467270490388 + 1.5775988642611344e-19i, -0.0041639584593438535 + -0.026479768452478382i }, { 0.0015726183014974284 + 0.002204077608634467i, 0.020821388355930795 + -0.02042160141462378i, -0.0041639584593438535 + 0.026479768452478382i, 0.28872860011595347 + -2.901087844345981e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2087199531875828, 1.0e-7), DoubleNear(0.30490471964742405, 1.0e-7), DoubleNear(0.1976467270490388, 1.0e-7), DoubleNear(0.28872860011595347, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false}), Matrix({ { 0.21434177735082185 + 2.167728549804743e-19i, -0.0045156844756114155 + -0.028716491887741787i, -0.0045308481777777175 + -0.003280400091724044i, -0.0003440379321111151 + 0.0006761319165163689i }, { -0.0045156844756114155 + 0.028716491887741794i, 0.3131172584786253 + -5.640779860656607e-20i, 0.0005349468723151108 + -0.0005379110624105724i, -0.006618806550654901 + -0.0047921123736530645i }, { -0.0045308481777777175 + 0.003280400091724044i, 0.0005349468723151109 + 0.0005379110624105727i, 0.1920249028857997 + 8.837076426788732e-20i, -0.004045519653748783 + -0.025726583189328626i }, { -0.0003440379321111151 + -0.0006761319165163688i, -0.006618806550654901 + 0.004792112373653063i, -0.004045519653748783 + 0.025726583189328626i, 0.28051606128475226 + -1.708087894944001e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.21434177735082185, 1.0e-7), DoubleNear(0.3131172584786253, 1.0e-7), DoubleNear(0.1920249028857997, 1.0e-7), DoubleNear(0.28051606128475226, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true}), Matrix({ { 0.24329477642839054 + -2.0900537973499863e-19i, 0.0031029310270825486 + -0.028464750806573708i, -0.014596020304418917 + 0.0019381298388947677i, -0.0029707417708519134 + 0.0367557056698237i }, { 0.0031029310270825495 + 0.028464750806573708i, 0.30354404141875657 + -4.345279019414561e-19i, -0.05390118998813568 + 0.001264643012991463i, 0.038266295921312816 + -0.006302215793211408i }, { -0.014596020304418917 + -0.0019381298388947677i, -0.05390118998813567 + -0.0012646430129914623i, 0.16307190380823103 + 5.141489989833603e-19i, -0.011664135156442748 + -0.02597832427049671i }, { -0.0029707417708519143 + -0.0367557056698237i, 0.038266295921312816 + 0.006302215793211408i, -0.011664135156442748 + 0.025978324270496712i, 0.29008927834462106 + 2.0731131384048996e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.24329477642839054, 1.0e-7), DoubleNear(0.30354404141875657, 1.0e-7), DoubleNear(0.16307190380823103, 1.0e-7), DoubleNear(0.29008927834462106, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false}), Matrix({ { 0.23928694678899992 + -8.089164646278573e-20i, 0.01525760990090657 + 0.024516011462365813i, 0.001646030205705814 + -0.028819185783056932i, 0.0030576092243025594 + -0.001668949369399993i }, { 0.015257609900906572 + -0.02451601146236581i, 0.2294661814868067 + 6.098637220230954e-20i, -0.0028476981773292035 + -0.002006235593592304i, 0.001578474174975847 + -0.027636394729998466i }, { 0.001646030205705814 + 0.02881918578305693i, -0.0028476981773292035 + 0.002006235593592304i, 0.2711884662907123 + 2.11758236813551e-22i, 0.017291740664556174 + 0.0277844639553491i }, { 0.0030576092243025594 + 0.001668949369399993i, 0.0015784741749758472 + 0.027636394729998466i, 0.017291740664556174 + -0.027784463955349104i, 0.2600584054334802 + 9.762054717105811e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.23928694678899992, 1.0e-7), DoubleNear(0.2294661814868067, 1.0e-7), DoubleNear(0.2711884662907123, 1.0e-7), DoubleNear(0.2600584054334802, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false}), Matrix({ { 0.2533180208111888 + -1.1519648082658485e-19i, 0.01615227071209606 + 0.025953557371882596i, 0.07098862885239901 + -0.08574840279107437i, 0.013311740046332166 + 0.0018055408580727752i }, { 0.01615227071209606 + -0.025953557371882596i, 0.24292139507549224 + 4.002230675776569e-20i, -0.004258870084434723 + -0.01274066036181801i, 0.0680751282522235 + -0.0822291346063721i }, { 0.07098862885239901 + 0.08574840279107439i, -0.004258870084434722 + 0.01274066036181801i, 0.2571573922685234 + 3.451659260061264e-20i, 0.016397079853366685 + 0.02634691804583232i }, { 0.013311740046332166 + -0.001805540858072775i, 0.0680751282522235 + 0.0822291346063721i, 0.016397079853366685 + -0.02634691804583232i, 0.24660319184479468 + 1.1858461261560195e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2533180208111888, 1.0e-7), DoubleNear(0.24292139507549224, 1.0e-7), DoubleNear(0.2571573922685234, 1.0e-7), DoubleNear(0.24660319184479468, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false}), Matrix({ { 0.3114266462820563 + -9.147955830346448e-20i, 0.019857440388961756 + 0.031907044376597034i, 0.14035576292767 + -0.0014870255619600379i, 0.009101831265943827 + 0.0142852549321087i }, { 0.019857440388961756 + -0.03190704437659704i, 0.29864513837689616 + -5.463362509790244e-20i, 0.008797126506983534 + -0.014474888810943462i, 0.13459531078007175 + -0.001425995366881119i }, { 0.14035576292767002 + 0.001487025561960038i, 0.008797126506983534 + 0.014474888810943462i, 0.19904876679765598 + 1.0799670077492281e-20i, 0.012691910176500986 + 0.020393431041117877i }, { 0.009101831265943827 + -0.0142852549321087i, 0.13459531078007175 + 0.001425995366881119i, 0.012691910176500986 + -0.020393431041117877i, 0.1908794485433907 + 2.1324054447127004e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3114266462820563, 1.0e-7), DoubleNear(0.29864513837689616, 1.0e-7), DoubleNear(0.19904876679765598, 1.0e-7), DoubleNear(0.1908794485433907, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false}), Matrix({ { 0.21921195983890723 + 1.2817851053882556e-19i, 0.01397757217314705 + 0.022459239804824057i, 0.015138416496288602 + 0.012417159734379516i, -0.0003069251287869712 + 0.0023427511578548704i }, { 0.01397757217314705 + -0.022459239804824057i, 0.2102151079926172 + -9.41340471187991e-21i, 0.002237461303177561 + -0.0007592449796305547i, 0.014517108742347488 + 0.011907537236756544i }, { 0.015138416496288604 + -0.012417159734379514i, 0.002237461303177561 + 0.0007592449796305547i, 0.29126345324080505 + -2.0885839876479776e-19i, 0.018571778392315694 + 0.029841235612890857i }, { -0.0003069251287869713 + -0.0023427511578548704i, 0.014517108742347486 + -0.011907537236756539i, 0.018571778392315694 + -0.029841235612890857i, 0.2793094789276697 + 1.6802032408524755e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21921195983890723, 1.0e-7), DoubleNear(0.2102151079926172, 1.0e-7), DoubleNear(0.29126345324080505, 1.0e-7), DoubleNear(0.2793094789276697, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false}), Matrix({ { 0.26733570441318333 + -8.703263533037943e-20i, 0.018400930810662568 + 0.05170347169766684i, -0.08465700057694357 + 0.03986682717674933i, -0.05627543252224882 + 0.06492641161979928i }, { 0.018400930810662568 + -0.05170347169766684i, 0.24628896842182355 + 3.6210658495121315e-20i, 0.04216156940289437 + 0.01363199007600786i, 0.11973149465054138 + -0.00546579082191025i }, { -0.08465700057694356 + -0.03986682717674933i, 0.04216156940289437 + -0.01363199007600786i, 0.24313970866652898 + 6.3527471044072044e-21i, 0.014148419754800176 + 0.0005970037200480689i }, { -0.05627543252224882 + -0.06492641161979928i, 0.11973149465054138 + 0.00546579082191025i, 0.014148419754800178 + -0.0005970037200480689i, 0.24323561849846334 + 1.2239626087824635e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.26733570441318333, 1.0e-7), DoubleNear(0.24628896842182355, 1.0e-7), DoubleNear(0.24313970866652898, 1.0e-7), DoubleNear(0.24323561849846334, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false}), Matrix({ { 0.26925486919766406 + -6.399730537354153e-20i, 0.017168449066133663 + 0.027586358337249633i, -0.005691624603192814 + -0.004120819135354508i, 5.928221931502998e-05 + -0.0008458872812200271i }, { 0.017168449066133663 + -0.027586358337249633i, 0.25820416663178314 + 2.2436236174744977e-19i, -0.000785110260194276 + 0.00032037720486077195i, -0.0054580301252398055 + -0.003951693330022599i }, { -0.005691624603192814 + 0.004120819135354508i, -0.000785110260194276 + -0.00032037720486077195i, 0.24122054388204825 + -1.6682582852430694e-20i, 0.015380901499329079 + 0.02471411708046528i }, { 5.92822193150299e-05 + 0.0008458872812200271i, -0.0054580301252398055 + 0.003951693330022599i, 0.01538090149932908 + -0.02471411708046528i, 0.23132042028850375 + -6.575544237408215e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.26925486919766406, 1.0e-7), DoubleNear(0.25820416663178314, 1.0e-7), DoubleNear(0.24122054388204825, 1.0e-7), DoubleNear(0.23132042028850375, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true}), Matrix({ { 0.2791477714285442 + -4.207636165485738e-19i, 0.017799248384910028 + 0.028599930150267024i, 0.012083093723244565 + -0.002227758580245159i, 0.0009986958692099375 + 0.0010959185044070326i }, { 0.01779924838491003 + -0.028599930150267024i, 0.2676910464186029 + -2.2276966512788104e-19i, 0.0005422083288608725 + -0.0013800148316567616i, 0.011587181893649334 + -0.002136327374071481i }, { 0.012083093723244565 + 0.002227758580245159i, 0.0005422083288608725 + 0.0013800148316567614i, 0.2313276416511681 + 3.400837283226016e-19i, 0.014750102180552713 + 0.02370054526744789i }, { 0.0009986958692099375 + -0.0010959185044070326i, 0.011587181893649334 + 0.002136327374071481i, 0.014750102180552713 + -0.023700545267447894i, 0.22183354050168397 + 3.813765845012487e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2791477714285442, 1.0e-7), DoubleNear(0.2676910464186029, 1.0e-7), DoubleNear(0.2313276416511681, 1.0e-7), DoubleNear(0.22183354050168397, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false}), Matrix({ { 0.23119732949157978 + 1.207021949837378e-20i, 0.0032598975735688013 + -0.029217120290509383i, 0.06873234304765069 + -0.07804928789333594i, -0.01299695828125454 + -0.009584755464096158i }, { 0.003259897573568802 + 0.029217120290509383i, 0.2650420863951013 + -8.724439356719293e-20i, 0.00571888927170634 + 0.004827454569179643i, 0.07033141405697182 + -0.08992824950411055i }, { 0.06873234304765069 + 0.07804928789333594i, 0.005718889271706341 + -0.004827454569179643i, 0.2375557987842269 + -3.1975493758849964e-20i, -3.539319288714048e-05 + -0.027238460222546012i }, { -0.01299695828125454 + 0.009584755464096158i, 0.07033141405697182 + 0.08992824950411055i, -3.539319288714026e-05 + 0.027238460222546012i, 0.26620478532909125 + 1.8507669897506458e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.23119732949157978, 1.0e-7), DoubleNear(0.2650420863951013, 1.0e-7), DoubleNear(0.2375557987842269, 1.0e-7), DoubleNear(0.26620478532909125, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false}), Matrix({ { 0.2859730575316885 + -1.245138432463822e-19i, 0.001967179142163073 + -0.034441956757556916i, 0.12888417592329596 + -0.0013654876731271893i, 0.0007221246540593327 + -0.015531915527604523i }, { 0.0019671791421630733 + 0.034441956757556916i, 0.324098727127264 + -2.159934015498466e-20i, 0.0010510372292281479 + 0.01551312943011239i, 0.14606689778444581 + -0.0015475332557139676i }, { 0.12888417592329596 + 0.0013654876731271893i, 0.0010510372292281479 + -0.01551312943011239i, 0.18278007074411817 + 1.0460856898590607e-19i, 0.001257325238518588 + -0.022013623755498483i }, { 0.0007221246540593329 + 0.015531915527604523i, 0.14606689778444581 + 0.001547533255713968i, 0.0012573252385185885 + 0.022013623755498483i, 0.20714814459692854 + 1.194316455628563e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2859730575316885, 1.0e-7), DoubleNear(0.324098727127264, 1.0e-7), DoubleNear(0.18278007074411817, 1.0e-7), DoubleNear(0.20714814459692854, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false}), Matrix({ { 0.20128895649576495 + -1.2359095446512438e-20i, 0.001397683402797867 + -0.02429794593816969i, 0.013987682682463712 + 0.01145962460020666i, 0.001155525876057187 + -0.0015295454829065414i }, { 0.0013976834027978672 + 0.02429794593816969i, 0.22813811133575948 + 1.3112420127345814e-19i, -0.001202731730834718 + 0.0016354256981936147i, 0.015667842556172377 + 0.012865072370929391i }, { 0.013987682682463712 + -0.011459624600206662i, -0.0012027317308347175 + -0.0016354256981936147i, 0.26746417178004167 + -7.546178813963716e-21i, 0.001826820977883794 + -0.032157634574885706i }, { 0.0011555258760571868 + 0.0015295454829065414i, 0.015667842556172373 + -0.012865072370929391i, 0.0018268209778837944 + 0.032157634574885706i, 0.30310876038843304 + -3.329189586558652e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.20128895649576495, 1.0e-7), DoubleNear(0.22813811133575948, 1.0e-7), DoubleNear(0.26746417178004167, 1.0e-7), DoubleNear(0.30310876038843304, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false}), Matrix({ { 0.24076317215104737 + 1.0227922838095669e-19i, 0.001656185007582666 + -0.02899697907072849i, 0.016441278819690222 + 0.016125593407260583i, 0.002055228337453674 + -0.001869224631700519i }, { 0.0016561850075826664 + 0.02899697907072849i, 0.2728615006839595 + -1.5310120521621479e-19i, -0.0018290326178726556 + 0.0020910772165528553i, 0.018633215253907584 + 0.018275442947578494i }, { 0.016441278819690226 + -0.016125593407260583i, -0.0018290326178726556 + -0.002091077216552855i, 0.22798995612475925 + -1.2218450264143285e-19i, 0.001568319373098995 + -0.027458601442326903i }, { 0.002055228337453674 + 0.0018692246317005188i, 0.018633215253907577 + -0.018275442947578494i, 0.0015683193730989952 + 0.027458601442326903i, 0.25838537104023307 + 2.5093351062408643e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24076317215104737, 1.0e-7), DoubleNear(0.2728615006839595, 1.0e-7), DoubleNear(0.22798995612475925, 1.0e-7), DoubleNear(0.25838537104023307, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false}), Matrix({ { 0.2473413145880847 + 3.2420558016939483e-20i, 0.0016387864679550121 + -0.029533516536993695i, -0.00523353521865135 + -0.0038381804640429344i, -0.0003651841633855647 + 0.00041816427160399467i }, { 0.0016387864679550126 + 0.0295335165369937i, 0.28011772124136247 + 1.2794449835696877e-19i, 0.0002557948483754238 + -0.0004874375580376002i, -0.0059161195097812685 + -0.0042343320013341745i }, { -0.00523353521865135 + 0.003838180464042934i, 0.00025579484837542384 + 0.00048743755803760036i, 0.22141181368772195 + -5.232583227741564e-20i, 0.0015857179127266485 + -0.0269220639760617i }, { -0.0003651841633855648 + -0.00041816427160399456i, -0.005916119509781268 + 0.004234332001334173i, 0.001585717912726649 + 0.0269220639760617i, 0.2511291504828301 + -3.0112192949097156e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2473413145880847, 1.0e-7), DoubleNear(0.28011772124136247, 1.0e-7), DoubleNear(0.22141181368772195, 1.0e-7), DoubleNear(0.2511291504828301, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true}), Matrix({ { 0.2563324065284944 + -2.0815834678774433e-19i, 0.0017632841636749078 + -0.030872102908633674i, 0.011095515742569572 + -0.0020456789431504358i, -0.00017005209854120074 + -0.0013503911651331323i }, { 0.001763284163674908 + 0.030872102908633674i, 0.29050641131865274 + -4.353749348887105e-19i, 0.00032270191337843425 + 0.0013222471365784009i, 0.012574759874324326 + -0.002318407011166205i }, { 0.011095515742569572 + 0.0020456789431504358i, 0.0003227019133784343 + -0.0013222471365784009i, 0.21242072174731225 + 1.8825307252726818e-19i, 0.0014612202170067533 + -0.02558347760442172i }, { -0.00017005209854120074 + 0.0013503911651331323i, 0.012574759874324326 + 0.0023184070111662044i, 0.0014612202170067535 + 0.025583477604421725i, 0.24074046040553987 + 5.332072402965821e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2563324065284944, 1.0e-7), DoubleNear(0.29050641131865274, 1.0e-7), DoubleNear(0.21242072174731225, 1.0e-7), DoubleNear(0.24074046040553987, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false}), Matrix({ { 0.30274166606810393 + -1.545835128739098e-20i, 0.08483887447819621 + -0.10247835602267619i, 0.1364415602141457 + -0.0014455558041938138i, 0.037746407247734634 + -0.04659069990109934i }, { 0.08483887447819621 + 0.10247835602267619i, 0.3073301185908486 + -1.306548321139759e-19i, 0.03872505141176255 + 0.04578050863132125i, 0.13850951349359608 + -0.001467465124647343i }, { 0.1364415602141457 + 0.0014455558041938138i, 0.03872505141176255 + -0.04578050863132124i, 0.19349774981857715 + -5.971582278142822e-20i, 0.0542248826264263 + -0.06549918137477029i }, { 0.037746407247734634 + 0.04659069990109935i, 0.13850951349359608 + 0.0014674651246473435i, 0.0542248826264263 + 0.06549918137477029i, 0.19643046552246954 + 2.837560373301905e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.30274166606810393, 1.0e-7), DoubleNear(0.3073301185908486, 1.0e-7), DoubleNear(0.19349774981857715, 1.0e-7), DoubleNear(0.19643046552246954, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false}), Matrix({ { 0.21348139021044688 + 1.4697622339730158e-19i, 0.0593967654304034 + -0.07250380459589365i, 0.015291987117002033 + 0.011917541110140374i, 0.008614985011301821 + -0.0009908437705724881i }, { 0.0593967654304034 + 0.07250380459589365i, 0.21594567762107758 + -2.821111757035584e-20i, 0.0018890440079335977 + 0.008716401161497456i, 0.014363538121634056 + 0.012407155860995684i }, { 0.015291987117002033 + -0.011917541110140373i, 0.0018890440079335985 + -0.008716401161497456i, 0.2827580256762342 + -2.2215039746612073e-19i, 0.07966699167421912 + -0.09547373280155284i }, { 0.008614985011301823 + 0.0009908437705724881i, 0.014363538121634056 + -0.012407155860995682i, 0.07966699167421912 + 0.09547373280155283i, 0.2878149064922405 + 1.8131232278657047e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21348139021044688, 1.0e-7), DoubleNear(0.21594567762107758, 1.0e-7), DoubleNear(0.2827580256762342, 1.0e-7), DoubleNear(0.2878149064922405, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false}), Matrix({ { 0.2548808076326317 + -2.954027403549373e-19i, 0.07142657674606866 + -0.08627740768939365i, 0.017405346451603042 + 0.01707115018662184i, 0.010656192295224232 + -0.0011077897761476618i }, { 0.07142657674606866 + 0.08627740768939364i, 0.2587438652023752 + 2.4458076351967913e-19i, -0.000901010446387571 + 0.010675664503740929i, 0.017669147621994757 + 0.017329886168217238i }, { 0.017405346451603045 + -0.017071150186621836i, -0.0009010104463875705 + -0.010675664503740929i, 0.24135860825404937 + 2.202285662861181e-19i, 0.06763718035855384 + -0.08170012970805283i }, { 0.010656192295224232 + 0.0011077897761476618i, 0.017669147621994757 + -0.017329886168217238i, 0.06763718035855384 + 0.08170012970805283i, 0.24501671891094293 + -9.147955830346451e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2548808076326317, 1.0e-7), DoubleNear(0.2587438652023752, 1.0e-7), DoubleNear(0.24135860825404937, 1.0e-7), DoubleNear(0.24501671891094293, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false}), Matrix({ { 0.26186170691022786 + -4.5299367798948447e-20i, 0.07415960430285143 + -0.08781136082688515i, -0.004509576218052666 + -0.004492634273623194i, -0.002991549821673495 + -0.00013676073374844475i }, { 0.07415960430285143 + 0.08781136082688515i, 0.2655973289192193 + 2.056644241728567e-19i, -0.0007390589631546326 + -0.0017987018459575336i, -0.0066400785103799525 + -0.003579878191753914i }, { -0.004509576218052665 + 0.004492634273623194i, -0.0007390589631546329 + 0.001798701845957533i, 0.2343777089764532 + -2.9874806269870756e-20i, 0.06490415280177109 + -0.08016617657056133i }, { -0.0029915498216734945 + 0.00013676073374844426i, -0.006640078510379953 + 0.003579878191753914i, 0.06490415280177109 + 0.08016617657056133i, 0.23816325519409884 + -5.2563218956642073e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.26186170691022786, 1.0e-7), DoubleNear(0.2655973289192193, 1.0e-7), DoubleNear(0.2343777089764532, 1.0e-7), DoubleNear(0.23816325519409884, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true}), Matrix({ { 0.27136297555263167 + -6.9308470909083135e-19i, 0.07604546054047465 + -0.09185663797529464i, 0.011746123746004188 + -0.0021656314648493603i, 0.0025586090473903094 + -0.0045829607967794485i }, { 0.07604546054047465 + 0.09185663797529464i, 0.27547584229451544 + 4.9551427414376474e-20i, 0.004024745870584099 + 0.003369188418509879i, 0.011924151870889712 + -0.00219845448946728i }, { 0.011746123746004186 + 0.0021656314648493603i, 0.004024745870584099 + -0.003369188418509879i, 0.22487644033404938 + 6.179105350220121e-19i, 0.06301829656414787 + -0.07612089942215183i }, { 0.0025586090473903094 + 0.0045829607967794485i, 0.01192415187088971 + 0.00219845448946728i, 0.06301829656414787 + 0.07612089942215183i, 0.2282847418188027 + 1.0354977780183816e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.27136297555263167, 1.0e-7), DoubleNear(0.27547584229451544, 1.0e-7), DoubleNear(0.22487644033404938, 1.0e-7), DoubleNear(0.2282847418188027, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false}), Matrix({ { 0.2619813376528394 + -5.081614177110391e-20i, 0.118071433379445 + -0.0012509300360041228i, 0.018091999207333342 + 0.014839811292469196i, 0.008224676857094673 + 0.006601714384153392i }, { 0.11807143337944499 + 0.0012509300360041228i, 0.16744573017868508 + 1.6958124759804958e-19i, 0.008082960154365396 + 0.006774488715505244i, 0.01156352603130275 + 0.009484885678666852i }, { 0.018091999207333342 + -0.0148398112924692i, 0.008082960154365396 + -0.006774488715505243i, 0.34809044700611314 + -9.529704163026297e-20i, 0.15687964032829677 + -0.0016620908928370339i }, { 0.008224676857094673 + -0.006601714384153391i, 0.011563526031302748 + -0.009484885678666854i, 0.15687964032829677 + 0.0016620908928370345i, 0.22248248516236163 + 5.445896695071271e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2619813376528394, 1.0e-7), DoubleNear(0.16744573017868508, 1.0e-7), DoubleNear(0.34809044700611314, 1.0e-7), DoubleNear(0.22248248516236163, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false}), Matrix({ { 0.31334792080132345 + -5.230428449295306e-20i, 0.14122165527877284 + -0.0014961994215375684i, 0.021397959195489678 + 0.020987101643114202i, 0.00974398074416702 + 0.009356429147117165i }, { 0.14122165527877284 + 0.0014961994215375684i, 0.2002767520336834 + 1.4823076576949293e-21i, 0.009543558866416078 + 0.009560774617726978i, 0.013676534878108123 + 0.013413934711724878i }, { 0.021397959195489674 + -0.0209871016431142i, 0.009543558866416078 + -0.009560774617726977i, 0.296723863857629 + -9.380889890841381e-20i, 0.13372941842896896 + -0.0014168215073035884i }, { 0.00974398074416702 + -0.009356429147117165i, 0.013676534878108125 + -0.013413934711724876i, 0.13372941842896896 + 0.0014168215073035886i, 0.1896514633073633 + 2.225579068910674e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.31334792080132345, 1.0e-7), DoubleNear(0.2002767520336834, 1.0e-7), DoubleNear(0.296723863857629, 1.0e-7), DoubleNear(0.1896514633073633, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false}), Matrix({ { 0.3217878753229615 + 1.4825937813728702e-21i, 0.14502542823815684 + -0.0015364992104775583i, -0.006802089758506021 + -0.004924812086434256i, -0.003089124936813126 + -0.00218706679230129i }, { 0.14502542823815684 + 0.0015364992104775588i, 0.2056711605064857 + 1.5888246259253539e-19i, -0.003042094141293177 + -0.0022520251474478447i, -0.004347564969926597 + -0.0031477003789428517i }, { -0.006802089758506021 + 0.004924812086434256i, -0.0030420941412931768 + 0.0022520251474478442i, 0.288283909335991 + -1.4759577718273975e-19i, 0.12992564546958493 + -0.0013765217183635983i }, { -0.003089124936813126 + 0.00218706679230129i, -0.004347564969926597 + 0.0031477003789428513i, 0.12992564546958493 + 0.0013765217183635985i, 0.18425705483456098 + 6.515775195622693e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3217878753229615, 1.0e-7), DoubleNear(0.2056711605064857, 1.0e-7), DoubleNear(0.288283909335991, 1.0e-7), DoubleNear(0.18425705483456098, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true}), Matrix({ { 0.33361093352480115 + -4.391865831513548e-19i, 0.15035392011214543 + -0.0015929529210914986i, 0.014440567288967759 + -0.0026624057065550238i, 0.0064954550221029755 + -0.0012688621271556865i }, { 0.15035392011214543 + 0.0015929529210914981i, 0.21322788432234596 + -2.0434669852510003e-19i, 0.006520880369543349 + -0.0011309581106287857i, 0.009229708327926137 + -0.001701680247761617i }, { 0.01444056728896776 + 0.0026624057065550233i, 0.006520880369543349 + 0.0011309581106287853i, 0.2764608511341513 + 2.930733997499879e-19i, 0.12459715359559634 + -0.0013200680077496583i }, { 0.006495455022102976 + 0.0012688621271556865i, 0.009229708327926139 + 0.001701680247761617i, 0.12459715359559634 + 0.001320068007749659i, 0.17670033101870072 + 4.2838691307386235e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.33361093352480115, 1.0e-7), DoubleNear(0.21322788432234596, 1.0e-7), DoubleNear(0.2764608511341513, 1.0e-7), DoubleNear(0.17670033101870072, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false}), Matrix({ { 0.22056433722146324 + 1.0392018713716086e-19i, 0.015231809448444765 + 0.01249376452361045i, 0.015061937145699299 + 0.01477273617222423i, 0.00020335775940747715 + 0.0018733572416123432i }, { 0.015231809448444763 + -0.01249376452361045i, 0.2930603356135436 + -1.54742163972419e-19i, 0.0018769473290564686 + 0.00016700436209999403i, 0.020012556927898502 + 0.019628300182614848i }, { 0.015061937145699297 + -0.01477273617222423i, 0.0018769473290564682 + -0.00016700436209999463i, 0.20886273061006122 + 1.4844918689784787e-20i, 0.014423715790191326 + 0.011830932447525604i }, { 0.00020335775940747683 + -0.0018733572416123434i, 0.020012556927898505 + -0.019628300182614848i, 0.014423715790191326 + -0.011830932447525604i, 0.2775125965549311 + 1.1390408929286877e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.22056433722146324, 1.0e-7), DoubleNear(0.2930603356135436, 1.0e-7), DoubleNear(0.20886273061006122, 1.0e-7), DoubleNear(0.2775125965549311, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false}), Matrix({ { 0.21774087201559683 + 5.849867650851273e-20i, 0.03460011953648107 + 0.06279536439762506i, -0.0038422462057211178 + -0.01794948224815439i, 0.006449626516918475 + 0.00514795937256329i }, { 0.03460011953648107 + -0.06279536439762506i, 0.30971816381385037 + 1.018663798653955e-19i, -0.01371981188659315 + 0.004436854028108171i, -0.0073074085227115 + 0.00987696978277728i }, { -0.0038422462057211178 + 0.01794948224815439i, -0.01371981188659315 + -0.004436854028108171i, 0.21168619581592765 + 6.026642931843295e-20i, -0.004944594297844987 + -0.03847066742648901i }, { 0.006449626516918474 + -0.00514795937256329i, -0.0073074085227115 + -0.00987696978277728i, -0.004944594297844987 + 0.03847066742648901i, 0.26085476835462434 + -1.4270445454494581e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.21774087201559683, 1.0e-7), DoubleNear(0.30971816381385037, 1.0e-7), DoubleNear(0.21168619581592765, 1.0e-7), DoubleNear(0.26085476835462434, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true}), Matrix({ { 0.23482739012455767 + -2.6396281241047753e-19i, 0.016216792364132007 + 0.01330168853618613i, 0.010164657052926782 + -0.0018740566351269365i, 0.0008081095243570134 + 0.0004463530204424006i }, { 0.016216792364132007 + -0.013301688536186126i, 0.3120114277225894 + -3.7957046926597725e-19i, 0.0005957993875675266 + -0.0007051915427660296i, 0.013505618563967117 + -0.0024900293191897037i }, { 0.010164657052926782 + 0.0018740566351269365i, 0.0005957993875675267 + 0.0007051915427660295i, 0.1945996777069668 + 3.8272791823742323e-19i, 0.013438732874504082 + 0.011023008434949924i }, { 0.0008081095243570134 + -0.0004463530204424005i, 0.013505618563967115 + 0.0024900293191897037i, 0.013438732874504082 + -0.011023008434949924i, 0.2585615044458853 + 3.3873239458642694e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.23482739012455767, 1.0e-7), DoubleNear(0.3120114277225894, 1.0e-7), DoubleNear(0.1945996777069668, 1.0e-7), DoubleNear(0.2585615044458853, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false}), Matrix({ { 0.2709159747117682 + 7.670186628486154e-21i, 0.01850035882626557 + 0.018145137467257197i, -0.005726737762114496 + -0.004146241573985835i, -0.00011336570389874198 + -0.0006666989682826284i }, { 0.01850035882626557 + -0.018145137467257197i, 0.256543061117679 + 1.5269486974542208e-19i, -0.0006687712934914015 + 0.00010042038703080014i, -0.0054229169663181235 + -0.003926270891391274i }, { -0.005726737762114496 + 0.004146241573985835i, -0.0006687712934914014 + -0.0001004203870308003i, 0.24270869812323867 + -5.849216346374432e-20i, 0.016574135247332228 + 0.01625589888758188i }, { -0.00011336570389874223 + 0.0006666989682826283i, -0.005422916966318123 + 0.003926270891391272i, 0.01657413524733223 + -0.01625589888758188i, 0.2298322660473133 + -2.3945861762768523e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.2709159747117682, 1.0e-7), DoubleNear(0.256543061117679, 1.0e-7), DoubleNear(0.24270869812323867, 1.0e-7), DoubleNear(0.2298322660473133, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true}), Matrix({ { 0.2808699089102231 + -3.8158834273806235e-19i, 0.019180094875793002 + 0.018811822052996946i, 0.01215763756964158 + -0.002241502220509735i, 0.0009803520214152618 + 0.0006612139050844782i }, { 0.019180094875793006 + -0.018811822052996946i, 0.265968908936924 + -2.6194493893839243e-19i, 0.0006800938622750828 + -0.0009673501189671793i, 0.011512638047252319 + -0.002122583733806906i }, { 0.01215763756964158 + 0.002241502220509735i, 0.0006800938622750829 + 0.0009673501189671793i, 0.23275476392478378 + 3.307663659028042e-19i, 0.015894399197804797 + 0.015589214301842132i }, { 0.000980352021415262 + -0.000661213905084478i, 0.011512638047252319 + 0.002122583733806906i, 0.015894399197804797 + -0.015589214301842132i, 0.22040641822806828 + 3.90693946921046e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.2808699089102231, 1.0e-7), DoubleNear(0.265968908936924, 1.0e-7), DoubleNear(0.23275476392478378, 1.0e-7), DoubleNear(0.22040641822806828, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true}), Matrix({ { 0.28843507561577114 + -2.842978179579142e-19i, -0.006097064011099952 + -0.00441436317362318i, 0.012485100754704138 + -0.00230187656974069i, -0.00029914453872140277 + -0.000142420543380455i }, { -0.006097064011099952 + 0.004414363173623179i, 0.25840374223137597 + -3.5923546371854057e-19i, -0.00022868626218900637 + 0.00023973664657212093i, 0.01118517486218976 + -0.0020622093845759507i }, { 0.012485100754704138 + 0.00230187656974069i, -0.00022868626218900634 + -0.00023973664657212087i, 0.23902396021367606 + 4.446628743318224e-19i, -0.005052590717332666 + -0.0036581492917539286i }, { -0.00029914453872140277 + 0.00014242054338045498i, 0.01118517486218976 + 0.0020622093845759507i, -0.005052590717332666 + 0.003658149291753927i, 0.21413722193917603 + 2.7679743849202773e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.28843507561577114, 1.0e-7), DoubleNear(0.25840374223137597, 1.0e-7), DoubleNear(0.23902396021367606, 1.0e-7), DoubleNear(0.21413722193917603, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false, false}), Matrix({ { 0.0972382421906031 + 5.992758101824172e-20i, -0.002048584396951982 + -0.013027517208996489i, 0.006200184283776816 + 0.009962490190604564i, 0.0012041035397480934 + -0.0010405577798987583i, 0.0006688918302618755 + -0.011711156853783298i, -0.0015830970958411507 + 0.00015711198626233865i, 0.0012425105099407037 + -0.0006782054147260789i, -0.00011703955253514217 + -0.0001521774323220471i }, { -0.002048584396951982 + 0.013027517208996489i, 0.14204870459839683 + -1.4081922748102743e-19i, -0.0014653505655237104 + 0.0006207846227646618i, 0.009057425617129754 + 0.014553521271761247i, 0.00155491309465287 + 0.00033634187839907335i, 0.0009771383754439385 + -0.017108028929273635i, 6.46859191010043e-05 + 0.00018075386478804773i, 0.0018150987143618555 + -0.0009907439546739144i }, { 0.006200184283776816 + -0.009962490190604564i, -0.0014653505655237104 + -0.0006207846227646618i, 0.09324741039736784 + 2.5834504891256136e-20i, -0.001964506820493368 + -0.01249284454633489i, -0.0011572096546371474 + -0.0008152672979406532i, -8.484590964931454e-05 + 0.0001722132381135024i, 0.0006414393103241756 + -0.011230509980138349i, -0.0015181239527697525 + 0.00015066382866766462i }, { 0.0012041035397480932 + 0.0010405577798987583i, 0.009057425617129754 + -0.014553521271761247i, -0.001964506820493368 + 0.012492844546334893i, 0.13621877108943886 + 3.5151867311053416e-20i, 0.00013360536043915914 + -0.00013786165321683867i, -0.0016904885226920563 + -0.0011909682956516509i, 0.0014910966735199689 + 0.00032253780469851834i, 0.0009370348646516713 + -0.016405884749860114i }, { 0.0006688918302618755 + 0.011711156853783298i, 0.00155491309465287 + -0.00033634187839907335i, -0.0011572096546371474 + 0.0008152672979406532i, 0.00013360536043915914 + 0.00013786165321683867i, 0.11020195676501783 + 1.683477982667922e-19i, -0.0023216998174429068 + -0.014764334030300842i, 0.007026787249368291 + 0.011290680379689295i, 0.001364633535516005 + -0.0011792840027602587i }, { -0.0015830970958411507 + -0.00015711198626233865i, 0.0009771383754439385 + 0.017108028929273635i, -8.484590964931454e-05 + -0.00017221323811350238i, -0.0016904885226920563 + 0.001190968295651651i, -0.0023216998174429076 + 0.014764334030300842i, 0.16098650952569452 + -1.6813604002997864e-19i, -0.0016607097786784533 + 0.0007035470676670698i, 0.010264953415187884 + 0.01649378357565981i }, { 0.0012425105099407039 + 0.0006782054147260789i, 6.468591910100428e-05 + -0.00018075386478804773i, 0.0006414393103241757 + 0.011230509980138349i, 0.001491096673519969 + -0.0003225378046985184i, 0.007026787249368291 + -0.011290680379689295i, -0.0016607097786784535 + -0.0007035470676670698i, 0.10567907088363282 + 5.103373507207157e-20i, -0.002226413094471941 + -0.014158379291438192i }, { -0.00011703955253514217 + 0.00015217743232204712i, 0.0018150987143618555 + 0.0009907439546739142i, -0.0015181239527697525 + -0.00015066382866766464i, 0.0009370348646516714 + 0.016405884749860114i, 0.0013646335355160053 + 0.0011792840027602587i, 0.010264953415187884 + -0.01649378357565981i, -0.0022264130944719416 + 0.014158379291438192i, 0.15437933454984737 + 4.658681209898652e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.0972382421906031, 1.0e-7), DoubleNear(0.14204870459839683, 1.0e-7), DoubleNear(0.09324741039736784, 1.0e-7), DoubleNear(0.13621877108943886, 1.0e-7), DoubleNear(0.11020195676501783, 1.0e-7), DoubleNear(0.16098650952569452, 1.0e-7), DoubleNear(0.10567907088363282, 1.0e-7), DoubleNear(0.15437933454984737, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false, false}), Matrix({ { 0.10294000316115431 + 1.317136232980437e-19i, -0.0021687072858101045 + -0.013791412025398454i, 0.006563744627557691 + 0.010546660949542635i, 0.0012747085857955187 + -0.0011015729895875602i, 0.02884741344129906 + -0.03484529377780158i, -0.005276154873362118 + -0.0031307296701684616i, 0.005409447610800897 + 0.0007337116445266154i, -1.566532736285424e-05 + -0.0007401896665987687i }, { -0.0021687072858101045 + 0.013791412025398452i, 0.15037801765003456 + -2.4691010412462855e-19i, -0.0015512743592334 + 0.0006571855845000638i, 0.009588526084538366 + 0.015406896422339958i, 0.004060658588424563 + 0.004598948830290437i, 0.04214121541109995 + -0.0509031090132728i, -0.0002122637203444028 + 0.0007092744588990463i, 0.007902292435531269 + 0.0010718292135461602i }, { 0.006563744627557692 + -0.010546660949542635i, -0.0015512743592334002 + -0.0006571855845000638i, 0.09871516087527664 + 2.9434394917086937e-20i, -0.002079699650630246 + -0.013225387749921717i, -0.0017306628977707998 + -0.005177379855254303i, -0.0006571796724566426 + 0.00034094137785074124i, 0.027663463874538337 + -0.03341518044872175i, -0.005059612017996911 + -0.003002238911571215i }, { 0.001274708585795519 + 0.0011015729895875602i, 0.009588526084538366 + -0.01540689642233996i, -0.002079699650630246 + 0.013225387749921717i, 0.14420623420021556 + 1.0587911840678754e-20i, 0.0007301017847631848 + -0.00012279058964999683i, -0.002528207186663923 + -0.007563280506563708i, 0.0038940018797975874 + 0.004410199725062793i, 0.04041166437768517 + -0.048813954157650344i }, { 0.02884741344129906 + 0.03484529377780157i, 0.004060658588424563 + -0.004598948830290437i, -0.0017306628977707998 + 0.005177379855254303i, 0.0007301017847631848 + 0.00012279058964999675i, 0.1045001957944666 + 9.656175598699021e-20i, -0.002201576928584785 + -0.01400043921389888i, 0.006663226905587415 + 0.010706509620751228i, 0.0012940284894685798 + -0.0011182687930714565i }, { -0.005276154873362118 + 0.0031307296701684616i, 0.04214121541109995 + 0.050903109013272795i, -0.0006571796724566426 + -0.00034094137785074124i, -0.002528207186663923 + 0.007563280506563708i, -0.002201576928584785 + 0.014000439213898878i, 0.15265719647405682 + -6.204516338637757e-20i, -0.0015747859849687637 + 0.0006671461059316675i, 0.009733852947779271 + 0.015640408425081097i }, { 0.005409447610800897 + -0.0007337116445266152i, -0.0002122637203444028 + -0.0007092744588990463i, 0.027663463874538333 + 0.03341518044872175i, 0.0038940018797975874 + -0.004410199725062793i, 0.006663226905587415 + -0.010706509620751224i, -0.0015747859849687634 + -0.0006671461059316675i, 0.10021132040572403 + 4.7433845046240795e-20i, -0.002111220264335063 + -0.013425836087851369i }, { -1.566532736285424e-05 + 0.0007401896665987688i, 0.007902292435531269 + -0.0010718292135461598i, -0.005059612017996911 + 0.003002238911571215i, 0.040411664377685175 + 0.04881395415765035i, 0.0012940284894685798 + 0.0011182687930714565i, 0.009733852947779271 + -0.015640408425081097i, -0.002111220264335064 + 0.013425836087851369i, 0.14639187143907068 + 7.115076756936117e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10294000316115431, 1.0e-7), DoubleNear(0.15037801765003456, 1.0e-7), DoubleNear(0.09871516087527664, 1.0e-7), DoubleNear(0.14420623420021556, 1.0e-7), DoubleNear(0.1045001957944666, 1.0e-7), DoubleNear(0.15265719647405682, 1.0e-7), DoubleNear(0.10021132040572403, 1.0e-7), DoubleNear(0.14639187143907068, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false, false}), Matrix({ { 0.12655341238686393 + 1.1434944787933055e-19i, -0.002666187090142741 + -0.016955024284534256i, 0.008069402128859003 + 0.012965959699480313i, 0.0015671140118259878 + -0.0013542628380072978i, 0.05703590543299559 + -0.0006042776410406977i, -0.0012825725814671837 + -0.007628668609189125i, 0.0036986809556154828 + 0.0058050516230948425i, 0.000699810571345147 + -0.0006178306664643393i }, { -0.0026661870901427405 + 0.016955024284534256i, 0.18487323389519236 + -2.05829006182795e-19i, -0.0019071212131389949 + 0.0008079373978620943i, 0.011788038260102754 + 0.01894108467711672i, -0.0011206560928445574 + 0.007654130067952157i, 0.08331985749467442 + -0.0008827479209193402i, -0.0008556558421826232 + 0.00037323269943687477i, 0.005403150310328344 + 0.008480203309013858i }, { 0.008069402128859003 + -0.012965959699480313i, -0.001907121213138995 + -0.0008079373978620944i, 0.12135943345102587 + -6.776263578034415e-21i, -0.002556761991885634 + -0.016259159690055456i, 0.0035748590942644887 + -0.0058821125128973185i, -0.0008633714540445337 + -0.0003550201410219122i, 0.05469504961711416 + -0.0005794770032722838i, -0.001229933503261534 + -0.0073155743723976865i }, { 0.001567114011825988 + 0.001354262838007298i, 0.011788038260102754 + -0.018941084677116728i, -0.0025567619918856342 + 0.016259159690055456i, 0.1772857049258703 + -4.785736151986797e-20i, 0.0007127434624883505 + 0.0006028650967424701i, 0.005222267412719046 + -0.008592776298046143i, -0.0010746623576242068 + 0.007339990847244468i, 0.07990026116295759 + -0.0008465183636088352i }, { 0.05703590543299559 + 0.0006042776410406978i, -0.0011206560928445574 + -0.007654130067952157i, 0.0035748590942644883 + 0.0058821125128973185i, 0.0007127434624883506 + -0.0006028650967424702i, 0.080886786568757 + 1.1392593140570337e-19i, -0.0017040971242521488 + -0.010836826954763075i, 0.005157569404286104 + 0.008287210870813548i, 0.0010016230634381108 + -0.0008655789446517187i }, { -0.001282572581467184 + 0.007628668609189124i, 0.08331985749467442 + 0.0008827479209193403i, -0.0008633714540445337 + 0.0003550201410219122i, 0.005222267412719046 + 0.008592776298046143i, -0.0017040971242521488 + 0.010836826954763075i, 0.11816198022889898 + -1.0312626132821108e-19i, -0.0012189391310631686 + 0.0005163942925696369i, 0.007534340772214884 + 0.01210622017030433i }, { 0.0036986809556154828 + -0.0058050516230948425i, -0.0008556558421826232 + -0.0003732326994368747i, 0.05469504961711416 + 0.000579477003272284i, -0.001074662357624207 + -0.007339990847244468i, 0.0051575694042861045 + -0.008287210870813546i, -0.0012189391310631688 + -0.000516394292569637i, 0.07756704782997478 + 8.364450354136215e-20i, -0.0016341579230796754 + -0.01039206414771763i }, { 0.000699810571345147 + 0.0006178306664643393i, 0.0054031503103283435 + -0.008480203309013858i, -0.001229933503261534 + 0.007315574372397687i, 0.07990026116295759 + 0.0008465183636088352i, 0.0010016230634381108 + 0.0008655789446517187i, 0.007534340772214884 + -0.01210622017030433i, -0.0016341579230796754 + 0.01039206414771763i, 0.11331240071341593 + 1.2959604092990795e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12655341238686393, 1.0e-7), DoubleNear(0.18487323389519236, 1.0e-7), DoubleNear(0.12135943345102587, 1.0e-7), DoubleNear(0.1772857049258703, 1.0e-7), DoubleNear(0.080886786568757, 1.0e-7), DoubleNear(0.11816198022889898, 1.0e-7), DoubleNear(0.07756704782997478, 1.0e-7), DoubleNear(0.11331240071341593, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false, false}), Matrix({ { 0.08908043638790042 + 1.167566552674959e-19i, -0.0018767183357779966 + -0.011934573187301381i, 0.005680019601769551 + 0.009126686720124549i, 0.0011030852302607887 + -0.0009532601477771666i, 0.006151748055636113 + 0.005045919979227657i, 0.0005464252858427994 + -0.0009304877850482977i, -0.00012472414566635918 + 0.0009520160106379859i, 0.00013017422585396185 + -3.346823057101916e-06i }, { -0.001876718335777996 + 0.011934573187301383i, 0.13013152345100681 + 1.1421855271329669e-20i, -0.0013424149274751424 + 0.000568703874658465i, 0.008297552571377499 + 0.013332553084699508i, -0.0008056314334828009 + 0.0007178761066625074i, 0.008986668440652492 + 0.0073712397551518585i, -0.00012491892849401105 + -3.6766718716279125e-05i, -0.00018220098312061235 + 0.0013907351472168842i }, { 0.005680019601769552 + -0.009126686720124549i, -0.0013424149274751424 + -0.000568703874658465i, 0.08542441557054281 + -2.1952993369735987e-20i, -0.001799694450600296 + -0.011444756906776533i, 0.0009092297219301716 + -0.0003085318618587902i, -6.049099437596253e-05 + -0.00011531422245612675i, 0.005899269286261789 + 0.004838826376694714i, 0.000523999012452392 + -0.0008922988981234507i }, { 0.001103085230260789 + 0.0009532601477771666i, 0.008297552571377499 + -0.01333255308469951i, -0.0017996944506002963 + 0.011444756906776533i, 0.12479069242207438 + 1.2539588657856113e-20i, 2.2180268479867716e-05 + 0.00012831432496574502i, 0.0013282315812473897 + -0.0004507131177717644i, -0.0007725668750751049 + 0.0006884131841997897i, 0.008617839456085699 + 0.007068710860061827i }, { 0.006151748055636112 + -0.0050459199792276576i, -0.0008056314334828008 + -0.0007178761066625075i, 0.0009092297219301716 + 0.0003085318618587901i, 2.2180268479867703e-05 + -0.000128314324965745i, 0.1183597625677205 + 1.1151872401753803e-19i, -0.002493565878616893 + -0.015857278051995948i, 0.007546951931375556 + 0.012126483850169314i, 0.00146565184500331 + -0.0012665816348818501i }, { 0.0005464252858427994 + 0.0009304877850482976i, 0.00898666844065249 + -0.007371239755151859i, -6.049099437596254e-05 + 0.00011531422245612678i, 0.0013282315812473897 + 0.0004507131177717645i, -0.002493565878616893 + 0.01585727805199595i, 0.17290369067308453 + -3.2037712278233577e-19i, -0.0017836454167270215 + 0.0007556278157732664i, 0.011024826460940138 + 0.017714751762721543i }, { -0.0001247241456663594 + -0.0009520160106379856i, -0.00012491892849401102 + 3.676671871627915e-05i, 0.005899269286261789 + -0.004838826376694712i, -0.0007725668750751052 + -0.0006884131841997897i, 0.007546951931375556 + -0.012126483850169314i, -0.0017836454167270215 + -0.0007556278157732664i, 0.11350206571045784 + 9.882123333306373e-20i, -0.0023912254643650133 + -0.015206466930996553i }, { 0.0001301742258539619 + 3.3468230571019226e-06i, -0.00018220098312061192 + -0.0013907351472168847i, 0.000523999012452392 + 0.0008922988981234506i, 0.008617839456085699 + -0.007068710860061825i, 0.00146565184500331 + 0.0012665816348818503i, 0.011024826460940138 + -0.017714751762721543i, -0.0023912254643650133 + 0.015206466930996553i, 0.16580741321721187 + 6.919909075218383e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.08908043638790042, 1.0e-7), DoubleNear(0.13013152345100681, 1.0e-7), DoubleNear(0.08542441557054281, 1.0e-7), DoubleNear(0.12479069242207438, 1.0e-7), DoubleNear(0.1183597625677205, 1.0e-7), DoubleNear(0.17290369067308453, 1.0e-7), DoubleNear(0.11350206571045784, 1.0e-7), DoubleNear(0.16580741321721187, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false, false}), Matrix({ { 0.10863632271110413 + 1.1583175553702557e-19i, -0.0022887155365475644 + -0.014554577826148454i, 0.007477525166792719 + 0.021010568150489014i, 0.002657361866540948 + -0.001444447233013205i, -0.034401784283242344 + 0.01620055021138276i, 0.002895238527986935 + 0.0042676793927600605i, -0.022868460692946277 + 0.026383930349614268i, 0.004016578967592521 + 0.0025079593345394393i }, { -0.0022887155365475644 + 0.014554577826148456i, 0.15869938170207915 + -2.0286439086740493e-19i, -0.00297243011622158 + 0.0005591592822125574i, 0.010923405643869847 + 0.03069290354717783i, -0.001445706802149778 + -0.004950295483660211i, -0.05025521629370123 + 0.023666276965366564i, -0.0030530080370105043 + -0.0036196558610673713i, -0.03340697182930254 + 0.03854248127018502i }, { 0.007477525166792719 + -0.021010568150489014i, -0.00297243011622158 + -0.0005591592822125574i, 0.10008363047647865 + 3.1551977285222676e-20i, -0.002108530133468781 + -0.013408728798443577i, 0.01713305699182012 + 0.0055395865522058895i, 0.00038121365708560927 + -0.002412111738099011i, 0.048654890000909355 + -0.0022211152711674657i, -0.0013226202264895067 + -0.006471757001394527i }, { 0.002657361866540948 + 0.001444447233013205i, 0.010923405643869847 + -0.03069290354717783i, -0.0021085301334687816 + 0.013408728798443577i, 0.1462053379453449 + 4.658681209898652e-21i, -0.0011031212612303415 + 0.002178699238638779i, 0.025028512411074254 + 0.008092403523801972i, -0.0007274713063438619 + 0.0065653445033040415i, 0.07107660464963202 + -0.0032446755507427845i }, { -0.034401784283242344 + -0.01620055021138276i, -0.001445706802149778 + 0.004950295483660212i, 0.01713305699182012 + -0.0055395865522058895i, -0.0011031212612303415 + -0.002178699238638779i, 0.0988038762445168 + 1.1244362374800837e-19i, -0.0020815686778473254 + -0.013237273413148877i, 0.005749446366352388 + 0.00024260241980484737i, -8.862479127684931e-05 + -0.0007753945496458117i }, { 0.002895238527986935 + -0.0042676793927600605i, -0.05025521629370123 + -0.023666276965366564i, 0.00038121365708560927 + 0.0024121117380990105i, 0.02502851241107425 + -0.008092403523801972i, -0.002081568677847325 + 0.013237273413148877i, 0.1443358324220122 + -1.0609087664360112e-19i, -0.00015363022798058412 + 0.0007651724082191739i, 0.008398973388447788 + 0.0003544013002432215i }, { -0.022868460692946277 + -0.026383930349614268i, -0.0030530080370105043 + 0.0036196558610673713i, 0.04865489000090936 + 0.0022211152711674657i, -0.0007274713063438619 + -0.0065653445033040415i, 0.005749446366352389 + -0.00024260241980484734i, -0.00015363022798058418 + -0.0007651724082191739i, 0.09884285080452201 + 4.5316262678105056e-20i, -0.0020823897814965285 + -0.013242495039329508i }, { 0.004016578967592521 + -0.0025079593345394393i, -0.033406971829302544 + -0.03854248127018502i, -0.0013226202264895067 + 0.006471757001394527i, 0.07107660464963202 + 0.003244675550742785i, -8.862479127684937e-05 + 0.0007753945496458117i, 0.008398973388447788 + -0.0003544013002432216i, -0.002082389781496528 + 0.013242495039329508i, 0.14439276769394133 + 7.70799982001413e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10863632271110413, 1.0e-7), DoubleNear(0.15869938170207915, 1.0e-7), DoubleNear(0.10008363047647865, 1.0e-7), DoubleNear(0.1462053379453449, 1.0e-7), DoubleNear(0.0988038762445168, 1.0e-7), DoubleNear(0.1443358324220122, 1.0e-7), DoubleNear(0.09884285080452201, 1.0e-7), DoubleNear(0.14439276769394133, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true, false}), Matrix({ { 0.1094162073334006 + 1.0510839853941593e-19i, -0.0023051458980253834 + -0.014659063058595209i, 0.0069766856518162675 + 0.011210176857325992i, 0.0013549035810181565 + -0.0011708756063752471i, -0.002312886595152544 + -0.0016745635918895584i, -0.00017562290550951162 + 0.00034514871938007134i, 2.40903186601081e-05 + -0.0003437404063237643i, -4.656023193899842e-05 + 4.014307368050642e-06i }, { -0.002305145898025383 + 0.014659063058595209i, 0.15983866186426343 + -1.6910570391295746e-19i, -0.0016488687750975443 + 0.0006985307165535034i, 0.010191763414317396 + 0.016376181479923646i, 0.00027307722562075655 + -0.0002745903717841841i, -0.0033787380080402695 + -0.00244625554346495i, 4.5545177577403484e-05 + 1.0469320001857712e-05i, 3.519190065492188e-05 + -0.0005021468748962628i }, { 0.006976685651816268 + -0.01121017685732599i, -0.0016488687750975445 + -0.0006985307165535034i, 0.10492557001742128 + 1.1166445644105842e-19i, -0.002210538577586033 + -0.014057428829146582i, -0.0003190426500548584 + 0.00013019062116276006i, 2.4163809418795287e-05 + 4.000100219032837e-05i, -0.002217961582625174 + -0.0016058364998344855i, -0.00016841502660160343 + 0.0003309831971362977i }, { 0.0013549035810181565 + 0.0011708756063752471i, 0.010191763414317396 + -0.016376181479923646i, -0.0022105385775860326 + 0.014057428829146582i, 0.15327859661436188 + 1.1269790530639137e-19i, -1.0720831015638677e-05 + -4.5486631488742196e-05i, -0.00046606761013941764 + 0.00019018658369801192i, 0.0002618696466943543 + -0.0002633206906263884i, -0.0032400685426146316 + -0.0023458568301881135i }, { -0.0023128865951525437 + 0.0016745635918895584i, 0.0002730772256207566 + 0.0002745903717841842i, -0.0003190426500548584 + -0.00013019062116276003i, -1.0720831015638675e-05 + 4.5486631488742216e-05i, 0.09802399162222034 + 1.2316698074561799e-19i, -0.0020651383163695063 + -0.013132788180702123i, 0.006250285881328838 + 0.010042993712967869i, 0.001213833494245942 + -0.0010489661762837694i }, { -0.00017562290550951167 + -0.00034514871938007123i, -0.0033787380080402695 + 0.0024462555434649506i, 2.4163809418795283e-05 + -4.0001002190328355e-05i, -0.0004660676101394176 + -0.0001901865836980119i, -0.0020651383163695063 + 0.013132788180702123i, 0.14319655225982791 + -1.3984956359804866e-19i, -0.0014771915691046194 + 0.0006258009738782279i, 0.009130615618000243 + 0.01467112336749741i }, { 2.4090318660108047e-05 + 0.0003437404063237643i, 4.5545177577403484e-05 + -1.0469320001857719e-05i, -0.0022179615826251734 + 0.0016058364998344848i, 0.00026186964669435434 + 0.00026332069062638843i, 0.006250285881328839 + -0.01004299371296787i, -0.0014771915691046194 + -0.0006258009738782279i, 0.0940009112635794 + -3.4796216477730704e-20i, -0.001980381337379277 + -0.012593795008626504i }, { -4.656023193899842e-05 + -4.014307368050646e-06i, 3.519190065492191e-05 + 0.0005021468748962628i, -0.00016841502660160345 + -0.00033098319713629765i, -0.0032400685426146316 + 0.0023458568301881135i, 0.001213833494245942 + 0.0010489661762837698i, 0.009130615618000243 + -0.01467112336749741i, -0.001980381337379277 + 0.012593795008626504i, 0.13731950902492435 + -3.0959225896351414e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1094162073334006, 1.0e-7), DoubleNear(0.15983866186426343, 1.0e-7), DoubleNear(0.10492557001742128, 1.0e-7), DoubleNear(0.15327859661436188, 1.0e-7), DoubleNear(0.09802399162222034, 1.0e-7), DoubleNear(0.14319655225982791, 1.0e-7), DoubleNear(0.0940009112635794, 1.0e-7), DoubleNear(0.13731950902492435, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, true}), Matrix({ { 0.12419600149741902 + -6.924494343803908e-20i, 0.0015839699978078216 + -0.014530555426196799i, 0.007919086968713572 + 0.012724432473851497i, 0.0015897183896115515 + -0.0007642243848569109i, -0.00745090949421812 + 0.0009893676301119237i, -0.0015164906326287878 + 0.01876288403483959i, -0.0005764560937445996 + -0.0007002939335601602i, -0.0020190365961843034 + 0.0010410031421692397i }, { 0.0015839699978078218 + 0.014530555426196797i, 0.15495176993112517 + -3.515186731105347e-19i, -0.0013877216100496286 + 0.0010887939206665027i, 0.009880161416196458 + 0.01587549767641553i, -0.02751523222468163 + 0.0006455691644551896i, 0.019534003217462688 + -0.0032171262103570827i, -0.0018205901596325853 + -0.0027778945531900514i, 0.0015751519629545372 + 0.001796212437967193i }, { 0.007919086968713572 + -0.012724432473851497i, -0.0013877216100496288 + -0.0010887939206665027i, 0.11909877493097155 + -1.3976043629695958e-19i, 0.0015189610292747277 + -0.013934195380376909i, -0.0003737258697536883 + 0.0008264636686952996i, 0.0018256451655064578 + 0.001351745556086879i, -0.007145110810200795 + 0.000948762208782844i, -0.001454251138223126 + 0.01799282163498411i }, { 0.0015897183896115515 + 0.0007642243848569109i, 0.009880161416196458 + -0.01587549767641553i, 0.0015189610292747277 + 0.013934195380376909i, 0.14859227148763138 + -8.300922883092145e-20i, -0.0016883072980062952 + 0.0028602211707300955i, 0.0009159341986145608 + -0.0022064785003520614i, -0.026385957763454045 + 0.0006190738485362732i, 0.01873229270385013 + -0.003085089582854325i }, { -0.00745090949421812 + -0.0009893676301119235i, -0.02751523222468163 + -0.0006455691644551892i, -0.0003737258697536882 + -0.0008264636686952996i, -0.0016883072980062954 + -0.002860221170730096i, 0.08324419745820191 + 2.97520322723073e-19i, -0.005954254212202711 + -0.013261295813100534i, 0.005307884564431535 + 0.008528738096442365i, 0.0009790186856525472 + -0.0014556173978021057i }, { -0.001516490632628788 + -0.01876288403483959i, 0.01953400321746268 + 0.0032171262103570823i, 0.0018256451655064578 + -0.0013517455560868787i, 0.0009159341986145608 + 0.0022064785003520614i, -0.005954254212202711 + 0.013261295813100534i, 0.1480834441929662 + 4.256340559952858e-20i, -0.001738338734152535 + 0.0002355377697652286i, 0.00944221761612118 + 0.015171807171005528i }, { -0.0005764560937445996 + 0.0007002939335601602i, -0.0018205901596325853 + 0.0027778945531900514i, -0.007145110810200795 + -0.0009487622087828441i, -0.02638595776345404 + -0.0006190738485362731i, 0.005307884564431535 + -0.008528738096442364i, -0.001738338734152535 + -0.00023553776976522863i, 0.07982770635002912 + 2.166286762602873e-19i, -0.005709880944240037 + -0.012717028457396177i }, { -0.0020190365961843034 + -0.00104100314216924i, 0.0015751519629545372 + -0.001796212437967193i, -0.001454251138223126 + -0.01799282163498411i, 0.01873229270385013 + 0.003085089582854325i, 0.0009790186856525472 + 0.0014556173978021061i, 0.00944221761612118 + -0.015171807171005528i, -0.005709880944240037 + 0.012717028457396177i, 0.14200583415165488 + 1.647479082409614e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12419600149741902, 1.0e-7), DoubleNear(0.15495176993112517, 1.0e-7), DoubleNear(0.11909877493097155, 1.0e-7), DoubleNear(0.14859227148763138, 1.0e-7), DoubleNear(0.08324419745820191, 1.0e-7), DoubleNear(0.1480834441929662, 1.0e-7), DoubleNear(0.07982770635002912, 1.0e-7), DoubleNear(0.14200583415165488, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false, false}), Matrix({ { 0.09395089126506573 + 6.839791049078476e-20i, -0.0019793275319403654 + -0.012587093567128272i, 0.0013247137548825726 + -0.011872864178528345i, -0.0016185785220801299 + 7.265488253775681e-05i, 0.027930534069158467 + -0.03171663001604729i, -0.004837674859608926 + -0.0030738042269601563i, -0.0052815307899272785 + -0.0038949252588245777i, -0.0004105539484205497 + 0.0007896514235380214i }, { -0.0019793275319403654 + 0.012587093567128272i, 0.13724643822651406 + -5.632769099241097e-20i, 0.0015627612249438727 + 0.00042761257922048897i, 0.0019351838186862284 + -0.017344256111981038i, 0.0036608116213686257 + 0.004410195998572259i, 0.04080180897849221 + -0.046332657877288644i, 0.0006330931742337469 + -0.0006255373274217656i, -0.007715427491327261 + -0.005689830205271579i }, { 0.0013247137548825726 + 0.011872864178528345i, 0.0015627612249438725 + -0.000427612579220489i, 0.10770427277136524 + 9.275010772434589e-20i, -0.002269079404499985 + -0.014429706208191896i, 0.0023239660479841377 + 0.0019617166872706432i, 0.00021386089309270798 + -0.0003526827419689206i, 0.028580343246678925 + -0.03654384421047604i, -0.005498092031750104 + -0.0030591643547795196i }, { -0.0016185785220801299 + -7.265488253775681e-05i, 0.0019351838186862287 + 0.017344256111981038i, -0.002269079404499985 + 0.014429706208191896i, 0.15733781362373606 + -1.799945012915388e-19i, -0.0003117820499892803 + 0.0002700250939850016i, 0.0033949232237222024 + 0.002865737881909i, 0.004293848846853525 + 0.004598952556780972i, 0.0417510708102929 + -0.0533844052936345i }, { 0.027930534069158464 + 0.03171663001604729i, 0.0036608116213686257 + -0.004410195998572259i, 0.002323966047984138 + -0.0019617166872706437i, -0.0003117820499892803 + -0.0002700250939850016i, 0.09653476132290521 + 1.7364175418713112e-20i, -0.002033763685504985 + -0.012933268188203107i, -1.4382614296521634e-05 + -0.011068802655393301i, -0.0014826425265307734 + 0.0002351209323922464i }, { -0.004837674859608924 + 0.003073804226960157i, 0.04080180897849221 + 0.046332657877288644i, 0.00021386089309270796 + 0.0003526827419689206i, 0.0033949232237222024 + -0.002865737881909i, -0.002033763685504985 + 0.012933268188203107i, 0.14102103746132166 + -4.933966917756307e-20i, 0.0014832485432289663 + 0.00023126710387710273i, -2.1010578590618854e-05 + -0.01616965756715271i }, { -0.005281530789927278 + 0.0038949252588245777i, 0.000633093174233747 + 0.0006255373274217656i, 0.028580343246678925 + 0.03654384421047604i, 0.004293848846853525 + -0.004598952556780972i, -1.4382614296521554e-05 + 0.011068802655393301i, 0.0014832485432289663 + -0.00023126710387710273i, 0.10817675487728541 + 1.2663142561451788e-19i, -0.0022790335074148634 + -0.01449300711354714i }, { -0.00041055394842054975 + -0.0007896514235380214i, -0.007715427491327261 + 0.005689830205271579i, -0.005498092031750104 + 0.0030591643547795196i, 0.0417510708102929 + 0.0533844052936345i, -0.0014826425265307734 + -0.0002351209323922464i, -2.1010578590618708e-05 + 0.01616965756715271i, -0.0022790335074148634 + 0.01449300711354714i, 0.15802803045180586 + 5.844527336054668e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.09395089126506573, 1.0e-7), DoubleNear(0.13724643822651406, 1.0e-7), DoubleNear(0.10770427277136524, 1.0e-7), DoubleNear(0.15733781362373606, 1.0e-7), DoubleNear(0.09653476132290521, 1.0e-7), DoubleNear(0.14102103746132166, 1.0e-7), DoubleNear(0.10817675487728541, 1.0e-7), DoubleNear(0.15802803045180586, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false, false}), Matrix({ { 0.11620992202626873 + 3.0069669627527626e-20i, -0.0024482737210260556 + -0.015569252641217106i, 0.0007993960574315337 + -0.013996063628421691i, -0.0018919674597479633 + 0.00018776534068921073i, 0.05237423470498253 + -0.0005548886926327254i, -0.0011777450870285864 + -0.007005160647332592i, 0.00029344739838711015 + -0.00631165295066829i, -0.0008517874997303351 + 9.365721259584596e-05i }, { -0.0024482737210260556 + 0.015569252641217104i, 0.16976313550541977 + -1.5458351287390986e-19i, 0.0018582846153578074 + 0.0004019639041428732i, 0.0011677830847315392 + -0.020445893129135223i, -0.0010290623912188306 + 0.007028541084744125i, 0.07650994121831342 + -0.000810598980494464i, 0.0008394229865898438 + 0.00017228658610775753i, 0.0004286772556722226 + -0.009220262576936231i }, { 0.0007993960574315337 + 0.013996063628421691i, 0.0018582846153578072 + -0.0004019639041428732i, 0.13170292381162108 + 7.750351467376848e-20i, -0.0027746753610023195 + -0.01764493133337261i, 0.00042710650964653983 + 0.006304018906595812i, 0.0008355843259769408 + -0.0001900327665160417i, 0.059356720345127234 + -0.0006288659516802562i, -0.0013347609977001314 + -0.00793908233425422i }, { -0.0018919674597479633 + -0.00018776534068921076i, 0.0011677830847315394 + 0.020445893129135227i, -0.0027746753610023195 + 0.01764493133337261i, 0.19239580331564293 + -9.910285482875314e-20i, -0.0008535806145108995 + -7.558936895671336e-05i, 0.0006239307195816079 + 0.00920911052351658i, -0.0011662560592499336 + 0.007965579830452502i, 0.08671017743931858 + -0.0009186673040337114i }, { 0.05237423470498253 + 0.0005548886926327254i, -0.0010290623912188308 + -0.007028541084744125i, 0.00042710650964653983 + -0.006304018906595811i, -0.0008535806145108995 + 7.558936895671336e-05i, 0.0742757305617022 + 5.569241628197024e-20i, -0.001564817496419295 + -0.009951109114114275i, 0.0005109350831545175 + -0.008945603205499955i, -0.0012092535888629397 + 0.00012001047424079254i }, { -0.0011777450870285862 + 0.007005160647332592i, 0.07650994121831342 + 0.0008105989804944639i, 0.0008355843259769408 + 0.00019003276651604167i, 0.000623930719581608 + -0.00920911052351658i, -0.0015648174964192952 + 0.009951109114114275i, 0.10850434018241596 + 4.891615270393582e-20i, 0.0011877251528150314 + 0.0002569157789547185i, 0.0007463901553640707 + -0.013068020549998526i }, { 0.00029344739838711015 + 0.00631165295066829i, 0.0008394229865898437 + -0.00017228658610775755i, 0.059356720345127234 + 0.0006288659516802563i, -0.0011662560592499338 + -0.007965579830452502i, 0.0005109350831545177 + 0.008945603205499954i, 0.0011877251528150314 + -0.0002569157789547186i, 0.08417810383702959 + 1.418780186650953e-19i, -0.0017734375509125295 + -0.011277781988366428i }, { -0.0008517874997303351 + -9.365721259584596e-05i, 0.0004286772556722227 + 0.009220262576936231i, -0.0013347609977001317 + 0.007939082334254222i, 0.0867101774393186 + 0.0009186673040337115i, -0.00120925358886294 + -0.00012001047424079252i, 0.0007463901553640707 + 0.013068020549998527i, -0.0017734375509125295 + 0.011277781988366428i, 0.12297004075989895 + -2.2446373102238983e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.11620992202626873, 1.0e-7), DoubleNear(0.16976313550541977, 1.0e-7), DoubleNear(0.13170292381162108, 1.0e-7), DoubleNear(0.19239580331564293, 1.0e-7), DoubleNear(0.0742757305617022, 1.0e-7), DoubleNear(0.10850434018241596, 1.0e-7), DoubleNear(0.08417810383702959, 1.0e-7), DoubleNear(0.12297004075989895, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false, false}), Matrix({ { 0.0817971250194778 + -5.553735303194237e-21i, -0.00172327584554615 + -0.0109587897706841i, 0.0005679719644167945 + -0.00987387562746293i, -0.001334820747849943 + 0.00013192549266832982i, 0.005684128175876066 + 0.004656809605543907i, 0.0005041457957228061 + -0.0008596406438838174i, 0.0004695672141808734 + -0.000621556320159652i, -9.31658524613582e-05 + -4.981563091937533e-05i }, { -0.00172327584554615 + 0.010958789770684102i, 0.11949183147628716 + -6.805360143318207e-21i, 0.0013108890420108002 + 0.0002841138575333289i, 0.0008297114383810724 + -0.014424070310706761i, -0.000743648609205383 + 0.0006634242729874033i, 0.008303554506587648 + 0.006802814994662752i, 7.338046665799146e-05 + 7.600513312798276e-05i, 0.0006859586618763136 + -0.0009079891627468894i }, { 0.0005679719644167945 + 0.00987387562746293i, 0.0013108890420108002 + -0.000284113857533329i, 0.09270772693896542 + 1.0035739720095417e-19i, -0.0019531369408321425 + -0.012420540323393814i, -0.0004887501006745505 + 0.0006645825117485987i, 9.933443593026006e-05 + 5.147920067877244e-05i, 0.0063668891660218375 + 0.005227936750378465i, 0.0005662785025723852 + -0.000963146039287931i }, { -0.001334820747849943 + -0.00013192549266832982i, 0.0008297114383810727 + 0.014424070310706761i, -0.0019531369408321425 + 0.012420540323393814i, 0.13543038439679406 + 3.0766804072504e-20i, -7.87407722091906e-05 + -7.94816271600464e-05i, -0.0007139816301601671 + 0.000970843186445016i, -0.0008345496993525224 + 0.0007428650178748937i, 0.009300953390150541 + 0.007637135620550931i }, { 0.0056841281758760655 + -0.004656809605543907i, -0.0007436486092053834 + -0.0006634242729874032i, -0.0004887501006745505 + -0.0006645825117485987i, -7.874077220919063e-05 + 7.948162716004638e-05i, 0.1086885275684931 + 9.131582121269212e-20i, -0.002289815371899201 + -0.01456157198464728i, 0.0007423591761692568 + -0.013067791206458717i, -0.00176640030076096 + 0.0001758503222616734i }, { 0.000504145795722806 + 0.0008596406438838174i, 0.008303554506587648 + -0.006802814994662753i, 9.933443593026006e-05 + -5.147920067877245e-05i, -0.0007139816301601671 + -0.0009708431864450159i, -0.0022898153718992004 + 0.01456157198464728i, 0.15877564421154855 + -9.886200002665581e-20i, 0.0017351207261620386 + 0.00037476582556426267i, 0.0010844618017145373 + -0.019089843368426992i }, { 0.0004695672141808731 + 0.0006215563201596519i, 7.338046665799146e-05 + -7.600513312798277e-05i, 0.0063668891660218375 + -0.0052279367503784615i, -0.000834549699352522 + -0.0007428650178748937i, 0.0007423591761692569 + 0.013067791206458717i, 0.0017351207261620386 + -0.0003747658255642628i, 0.12317330070968523 + 1.190241361379096e-19i, -0.002594975971082706 + -0.01650217299834522i }, { -9.316585246135818e-05 + 4.981563091937531e-05i, 0.0006859586618763136 + 0.0009079891627468894i, 0.0005662785025723852 + 0.0009631460392879307i, 0.009300953390150541 + -0.00763713562055093i, -0.00176640030076096 + -0.00017585032226167342i, 0.0010844618017145375 + 0.01908984336842699i, -0.0025949759710827062 + 0.01650217299834522i, 0.1799354596787478 + -1.5231603200349614e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.0817971250194778, 1.0e-7), DoubleNear(0.11949183147628716, 1.0e-7), DoubleNear(0.09270772693896542, 1.0e-7), DoubleNear(0.13543038439679406, 1.0e-7), DoubleNear(0.1086885275684931, 1.0e-7), DoubleNear(0.15877564421154855, 1.0e-7), DoubleNear(0.12317330070968523, 1.0e-7), DoubleNear(0.1799354596787478, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false, false}), Matrix({ { 0.09783813099025943 + 1.0524384369634679e-19i, -0.002061222663617409 + -0.013107887457213113i, 0.0006730184033890325 + -0.011783406121862742i, -0.0015928636464818135 + 0.00015808125224995068i, 0.006681187892802202 + 0.006552903859754039i, 0.0007371697484107059 + -0.001033168274010066i, 0.0008351763166192811 + -0.0007595906082006622i, -0.00011936156628896724 + -9.589013704089678e-05i }, { -0.002061222663617409 + 0.013107887457213111i, 0.14292504116078797 + -2.9646153153900993e-21i, 0.0015645057706300106 + 0.0003384168616686338i, 0.0009831666041936334 + -0.01721357294886575i, -0.0010186840366568947 + 0.0007570592802768203i, 0.00976009092688802 + 0.009572689547506544i, 8.417110763019424e-05 + 0.00012789576431212931i, 0.0012200520208343927 + -0.0011096340234998568i }, { 0.0006730184033890325 + 0.011783406121862742i, 0.0015645057706300106 + -0.0003384168616686339i, 0.11088182219732334 + 4.213988912590144e-20i, -0.0023360230063989356 + -0.01485541916737892i, -0.0007432579129694088 + 0.0008497441066090194i, 0.00012950339549360447 + 8.167602123208836e-05i, 0.007571917824864807 + 0.007426531080461257i, 0.0008354485530867225 + -0.001170909334624401i }, { -0.0015928636464818133 + -0.00015808125224995068i, 0.0009831666041936337 + 0.01721357294886575i, -0.0023360230063989365 + 0.014855419167378918i, 0.16197967848663614 + -1.9524109434211623e-19i, -9.818595229187274e-05 + -0.00011748029903441512i, -0.0010857747049032467 + 0.001241333109943836i, -0.0011544940718367452 + 0.0008579897393670092i, 0.011061297429042771 + 0.010848911867117238i }, { 0.006681187892802202 + -0.006552903859754039i, -0.001018684036656895 + -0.0007570592802768202i, -0.0007432579129694089 + -0.0008497441066090193i, -9.818595229187271e-05 + 0.00011748029903441512i, 0.0926475215977115 + -1.9481757786848914e-20i, -0.0019518685538279417 + -0.012412474298118268i, 0.0006373127371970187 + -0.011158260712058903i, -0.0015083574021290897 + 0.00014969456268005258i }, { 0.000737169748410706 + 0.001033168274010066i, 0.009760090926888024 + -0.009572689547506544i, 0.0001295033954936045 + -8.167602123208833e-05i, -0.0010857747049032467 + -0.0012413331099438356i, -0.0019518685538279412 + 0.01241247429811827i, 0.13534243452704775 + -1.0270274485458394e-19i, 0.0014815039975428282 + 0.0003204628214289578i, 0.0009310066359019763 + -0.016300340730268002i }, { 0.0008351763166192812 + 0.0007595906082006622i, 8.417110763019423e-05 + -0.00012789576431212934i, 0.007571917824864807 + -0.007426531080461257i, -0.0011544940718367452 + -0.0008579897393670092i, 0.0006373127371970187 + 0.011158260712058903i, 0.0014815039975428282 + -0.0003204628214289579i, 0.1049992054513273 + 1.7724164421296232e-19i, -0.0022120899055159127 + -0.014067294154360116i }, { -0.00011936156628896724 + 9.589013704089681e-05i, 0.001220052020834393 + 0.0011096340234998565i, 0.0008354485530867225 + 0.001170909334624401i, 0.01106129742904277 + -0.010848911867117238i, -0.0015083574021290897 + -0.00014969456268005258i, 0.0009310066359019764 + 0.016300340730268002i, -0.0022120899055159122 + 0.014067294154360118i, 0.15338616558890578 + 7.36918664111241e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.09783813099025943, 1.0e-7), DoubleNear(0.14292504116078797, 1.0e-7), DoubleNear(0.11088182219732334, 1.0e-7), DoubleNear(0.16197967848663614, 1.0e-7), DoubleNear(0.0926475215977115, 1.0e-7), DoubleNear(0.13534243452704775, 1.0e-7), DoubleNear(0.1049992054513273, 1.0e-7), DoubleNear(0.15338616558890578, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true, false}), Matrix({ { 0.10051126889452192 + 6.135920403846686e-20i, -0.0021175394838128924 + -0.013466021759780396i, 0.0006659482165995775 + -0.012001437070851502i, -0.001621925443590046 + 0.00016362188902087653i, -0.0021267343327047925 + -0.0015597086533221843i, -0.00016415698383816457 + 0.0003177891972655219i, -0.00014839867614998005 + 0.00016992802684528044i, 2.5892565001038206e-05 + 1.6301759135350446e-05i }, { -0.0021175394838128924 + 0.013466021759780396i, 0.14683004569356278 + -2.893864602152737e-20i, 0.0015938654726368536 + 0.0003420630384412002i, 0.0009728382513554347 + -0.017532079466142193i, 0.0002537677104883046 + -0.00025207030438953383i, -0.003106800885946558 + -0.00227847181072075i, -1.9639732665931308e-05 + -2.3461738512964478e-05i, -0.00021678548723558466 + 0.00024823624475871426i }, { 0.0006659482165995777 + 0.012001437070851502i, 0.0015938654726368536 + -0.0003420630384412003i, 0.11383050845629994 + 1.554136509420075e-19i, -0.0023981449917985236 + -0.015250470127961394i, 0.00010394650335595105 + -0.00019807838228238532i, -2.87275114798057e-05 + -9.753205699754306e-06i, -0.002404113845072925 + -0.0017206914384018594i, -0.0001798809482729505 + 0.0003583427192508471i }, { -0.001621925443590046 + -0.00016362188902087653i, 0.0009728382513554349 + 0.017532079466142193i, -0.002398144991798523 + 0.015250470127961394i, 0.16628721278506253 + -2.746915258503872e-20i, 2.434768765544422e-05 + 1.809931056910781e-05i, 0.00015184834501947284 + -0.00028935917575521484i, 0.00028117916182680624 + -0.00028584075802103867i, -0.003512005664708343 + -0.0025136405629323138i }, { -0.0021267343327047925 + 0.0015597086533221845i, 0.0002537677104883046 + 0.00025207030438953383i, 0.00010394650335595107 + 0.00019807838228238538i, 2.434768765544422e-05 + -1.8099310569107822e-05i, 0.08997438369344901 + 2.4402881871030998e-20i, -0.0018955517336324578 + -0.012054339995550983i, 0.0006443829239864736 + -0.010940229763070143i, -0.001479295605020857 + 0.00014415392590912671i }, { -0.0001641569838381646 + -0.00031778919726552186i, -0.003106800885946558 + 0.00227847181072075i, -2.8727511479805698e-05 + 9.753205699754308e-06i, 0.00015184834501947276 + 0.00028935917575521495i, -0.0018955517336324578 + 0.012054339995550984i, 0.13143742999427294 + -7.672871414844666e-20i, 0.0014521442955359853 + 0.00031681664465639146i, 0.0009413349887401751 + -0.015981834212991555i }, { -0.00014839867614998002 + -0.0001699280268452804i, -1.963973266593131e-05 + 2.346173851296447e-05i, -0.002404113845072925 + 0.0017206914384018594i, 0.00028117916182680624 + 0.0002858407580210387i, 0.0006443829239864737 + 0.010940229763070143i, 0.0014521442955359853 + -0.00031681664465639157i, 0.1020505191923507 + 6.396788239685631e-20i, -0.002149967920116325 + -0.013672243193777644i }, { 2.5892565001038213e-05 + -1.6301759135350446e-05i, -0.00021678548723558466 + -0.00024823624475871415i, -0.0001798809482729505 + -0.00035834271925084697i, -0.0035120056647083434 + 0.0025136405629323146i, -0.001479295605020857 + -0.00014415392590912671i, 0.0009413349887401752 + 0.015981834212991555i, -0.0021499679201163256 + 0.013672243193777644i, 0.14907863129047932 + -9.40800753459534e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.10051126889452192, 1.0e-7), DoubleNear(0.14683004569356278, 1.0e-7), DoubleNear(0.11383050845629994, 1.0e-7), DoubleNear(0.16628721278506253, 1.0e-7), DoubleNear(0.08997438369344901, 1.0e-7), DoubleNear(0.13143742999427294, 1.0e-7), DoubleNear(0.1020505191923507, 1.0e-7), DoubleNear(0.14907863129047932, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, true}), Matrix({ { 0.11404518754397115 + -4.679857033580012e-20i, 0.0014545086257690075 + -0.013342940986172726i, 0.0007845050723903112 + -0.013735347839058828i, -0.001596988616254801 + -0.0002669624860967254i, -0.006841930178073564 + 0.000908504424986608i, -0.0013925444983864455 + 0.017229352014714677i, 6.235331375236146e-05 + 0.0008302763076221602i, 0.0020654855309029142 + 0.00028623388517521947i }, { 0.0014545086257690075 + 0.013342940986172726i, 0.14228721898452323 + -1.6135977645194426e-19i, 0.0016169994456343624 + -8.33930587551079e-05i, 0.0009787790912845966 + -0.017136755069574846i, -0.025266351424727208 + 0.0005928053684918893i, 0.017937445920643134 + -0.0029541833681370443i, -0.00010240846780048556 + 0.003047100818060081i, -0.0002324054122935622 + -0.0021806674727552922i }, { 0.0007845050723903112 + 0.013735347839058828i, 0.0016169994456343624 + 8.339305875510784e-05i, 0.1292495888844194 + -1.6220680939919851e-19i, 0.0016484224013135415 + -0.01512180982040098i, -0.00015648317657659594 + -0.0008177772913104682i, -0.002084643870610887 + -4.9196017280434876e-05i, -0.007754090126345352 + 0.0010296254139081596i, -0.001578197272465468 + 0.019526353655109026i }, { -0.0015969886162548008 + 0.0002669624860967254i, 0.0009787790912845966 + 0.017136755069574846i, 0.001648422401313542 + 0.015121809820400981i, 0.16125682243423328 + -2.7316812548951186e-19i, -0.0002452007786809104 + -0.0030389451241893024i, 0.0004791850899550302 + 0.0021400244278888692i, -0.02863483856340847 + 0.0006718376444995734i, 0.02032885000066968 + -0.003348032425074364i }, { -0.006841930178073564 + -0.000908504424986608i, -0.02526635142472721 + -0.0005928053684918893i, -0.00015648317657659597 + 0.0008177772913104682i, -0.00024520077868091044 + 0.003038945124189302i, 0.07644046504399978 + 1.3256065624529798e-19i, -0.005467599843214358 + -0.012177420769158655i, 0.0005258260681957399 + -0.009206318994862819i, -0.0015042324323561022 + 0.0005747383010267287i }, { -0.0013925444983864455 + -0.017229352014714677i, 0.017937445920643134 + 0.002954183368137044i, -0.002084643870610887 + 4.919601728043483e-05i, 0.0004791850899550302 + -0.0021400244278888692i, -0.005467599843214358 + 0.012177420769158655i, 0.13598025670331243 + 5.569241628197022e-20i, 0.0014290103225384765 + 0.0007422727418526995i, 0.0009353941488110132 + -0.016377158609558906i }, { 6.235331375236146e-05 + -0.0008302763076221601i, -0.00010240846780048562 + -0.003047100818060081i, -0.0077540901263453525 + -0.0010296254139081596i, -0.028634838563408465 + -0.0006718376444995731i, 0.00052582606819574 + 0.009206318994862819i, 0.0014290103225384765 + -0.0007422727418526997i, 0.08663143876423124 + 3.815883427380623e-19i, -0.006196535313228391 + -0.013800903501338056i }, { 0.0020654855309029142 + -0.00028623388517521963i, -0.00023240541229356217 + 0.0021806674727552922i, -0.001578197272465468 + -0.019526353655109026i, 0.02032885000066968 + 0.0033480324250743636i, -0.0015042324323561022 + -0.0005747383010267287i, 0.0009353941488110134 + 0.016377158609558906i, -0.006196535313228391 + 0.013800903501338054i, 0.15410902164130863 + 1.5161889755851976e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11404518754397115, 1.0e-7), DoubleNear(0.14228721898452323, 1.0e-7), DoubleNear(0.1292495888844194, 1.0e-7), DoubleNear(0.16125682243423328, 1.0e-7), DoubleNear(0.07644046504399978, 1.0e-7), DoubleNear(0.13598025670331243, 1.0e-7), DoubleNear(0.08663143876423124, 1.0e-7), DoubleNear(0.15410902164130863, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false, false}), Matrix({ { 0.12302412580939934 + 9.889109659193956e-20i, -0.00259183320167164 + -0.016482187254703178i, 0.03447569177671606 + -0.04164378933304155i, -0.0063055597532303215 + -0.003741551087919212i, 0.05544530387052753 + -0.0005874257132470202i, -0.0012468045518975119 + -0.007415922408051279i, 0.015338882204121485 + -0.018932908048710447i, -0.0028596956702066282 + -0.001656157991295019i }, { -0.0025918332016716403 + 0.016482187254703178i, 0.17971754025870457 + -1.1434944787933055e-19i, 0.00485291390820431 + 0.005496227337421973i, 0.050363182701480144 + -0.060834566689634634i, -0.0010894035455458746 + 0.007440673804691447i, 0.08099625634361815 + -0.0008581300909467935i, 0.0022133862750109926 + 0.0024539029760611668i, 0.022407525043613145 + -0.027657791852388893i }, { 0.03447569177671606 + 0.04164378933304155i, 0.004852913908204311 + -0.005496227337421973i, 0.12488872002849044 + 8.682087709356554e-21i, -0.0026311158803567344 + -0.016731996719886538i, 0.015736570584190458 + 0.01860367331205403i, 0.002160898598425427 + -0.0025002471609126796i, 0.05628565117958223 + -0.0005963289310659613i, -0.0012657015328312055 + -0.007528320573535533i }, { -0.006305559753230321 + 0.0037415510879192124i, 0.050363182701480144 + 0.06083456668963464i, -0.0026311158803567353 + 0.016731996719886538i, 0.18244139856235814 + -1.3933691982333248e-19i, -0.0028239647385375627 + 0.0017163746018353239i, 0.022988480827572093 + 0.027176835319267217i, -0.0011059149049228898 + 0.007553447110505178i, 0.08222386231401385 + -0.0008711361935813817i }, { 0.05544530387052753 + 0.0005874257132470204i, -0.0010894035455458746 + -0.007440673804691447i, 0.015736570584190458 + -0.01860367331205403i, -0.0028239647385375627 + -0.0017163746018353239i, 0.0786310382270316 + 6.225692162319107e-20i, -0.00165657373476871 + -0.010534612520616993i, 0.02203518553912133 + -0.02661668489348178i, -0.004030207138128707 + -0.0023914174938204644i }, { -0.0012468045518975123 + 0.007415922408051278i, 0.08099625634361815 + 0.0008581300909467934i, 0.002160898598425427 + 0.00250024716091268i, 0.022988480827572096 + -0.02717683531926722i, -0.00165657373476871 + 0.010534612520616993i, 0.11486671159154555 + -1.2197274440461925e-19i, 0.003101746560017841 + 0.0035129212179312577i, 0.03218969708730497 + -0.03888249648128851i }, { 0.015338882204121485 + 0.018932908048710447i, 0.0022133862750109926 + -0.0024539029760611668i, 0.05628565117958222 + 0.0005963289310659614i, -0.0011059149049228898 + -0.007553447110505179i, 0.02203518553912133 + 0.02661668489348178i, 0.003101746560017841 + -0.0035129212179312573i, 0.07982279617170017 + 1.3531351332387446e-19i, -0.0016816813125631138 + -0.01069427858186371i }, { -0.0028596956702066287 + 0.0016561579912950193i, 0.022407525043613145 + 0.027657791852388893i, -0.0012657015328312055 + 0.007528320573535533i, 0.08222386231401385 + 0.0008711361935813818i, -0.004030207138128707 + 0.0023914174938204644i, 0.03218969708730497 + 0.03888249648128851i, -0.0016816813125631138 + 0.01069427858186371i, 0.11660766935076937 + 1.4844252400631604e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12302412580939934, 1.0e-7), DoubleNear(0.17971754025870457, 1.0e-7), DoubleNear(0.12488872002849044, 1.0e-7), DoubleNear(0.18244139856235814, 1.0e-7), DoubleNear(0.0786310382270316, 1.0e-7), DoubleNear(0.11486671159154555, 1.0e-7), DoubleNear(0.07982279617170017, 1.0e-7), DoubleNear(0.11660766935076937, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false, false}), Matrix({ { 0.08675172383211817 + 1.3081565167267107e-19i, -0.0018276577594112347 + -0.011622583354784735i, 0.024136866384746374 + -0.02946313037815803i, -0.004455837910460894 + -0.0026130226883619052i, 0.006214154038957307 + 0.004842891617511209i, 0.0005179097621412451 + -0.0009345713048524897i, 0.003500842859330978 + -0.000402645893680679i, -0.00012769922704405903 + -0.00046054345997796576i }, { -0.0018276577594112354 + 0.011622583354784735i, 0.12672966637832872 + 1.616057172463046e-20i, 0.003438822243514075 + 0.0038544624309632854i, 0.03525989904565702 + -0.04304067421773562i, -0.0007797454086456468 + 0.0007305143005245824i, 0.009077833078044727 + 0.007074649492629162i, -1.9810063462207916e-05 + 0.0004775090915383178i, 0.005114142151970844 + -0.0005881978768918089i }, { 0.024136866384746374 + 0.02946313037815803i, 0.003438822243514075 + -0.0038544624309632854i, 0.08775312812632508 + -3.6011989774911144e-20i, -0.0018487550269670574 + -0.01175674673929318i, 0.000767644542324859 + 0.0035420550036083564i, 0.00045837519147600586 + -0.00017746825436479102i, 0.005836863302940596 + 0.005041854738411162i, 0.0005525145361539463 + -0.0008882153783192584i }, { -0.004455837910460893 + 0.0026130226883619052i, 0.03525989904565702 + 0.04304067421773562i, -0.001848755026967057 + 0.01175674673929318i, 0.1281925494947525 + 7.800872204555303e-21i, -0.0004907201741985345 + 2.8222475130846886e-05i, 0.0011213994656087392 + 0.005174346157889099i, -0.0007984528999122589 + 0.0006757749903377147i, 0.008526674818693462 + 0.007365301122584518i }, { 0.006214154038957307 + -0.004842891617511208i, -0.0007797454086456467 + -0.0007305143005245822i, 0.000767644542324859 + -0.0035420550036083572i, -0.0004907201741985345 + -2.8222475130846886e-05i, 0.11490344020431278 + 3.033236654245957e-20i, -0.002420749177029116 + -0.015394216420535435i, 0.03237401093109102 + -0.0387973438483653i, -0.005879928980898136 + -0.003519945893377772i }, { 0.000517909762141245 + 0.0009345713048524897i, 0.009077833078044727 + -0.007074649492629162i, 0.0004583751914760059 + 0.00017746825436479107i, 0.001121399465608739 + -0.005174346157889099i, -0.002420749177029115 + 0.015394216420535437i, 0.1678545854719214 + -2.5248276400858025e-19i, 0.004515838224708076 + 0.005154686124389946i, 0.0472929807431281 + -0.05667638895318753i }, { 0.0035008428593309784 + 0.0004026458936806788i, -1.981006346220793e-05 + -0.0004775090915383177i, 0.005836863302940596 + -0.005041854738411161i, -0.0007984528999122587 + -0.0006757749903377147i, 0.03237401093109102 + 0.0387973438483653i, 0.004515838224708075 + -0.005154686124389946i, 0.11695838807386555 + 1.8000759080814214e-19i, -0.002464042165952791 + -0.015669528562457066i }, { -0.00012769922704405898 + 0.00046054345997796576i, 0.0051141421519708425 + 0.0005881978768918089i, 0.0005525145361539462 + 0.0008882153783192584i, 0.008526674818693458 + -0.00736530112258452i, -0.005879928980898136 + 0.003519945893377772i, 0.0472929807431281 + 0.05667638895318754i, -0.0024640421659527915 + 0.015669528562457066i, 0.170856518418375 + 1.304731978428311e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.08675172383211817, 1.0e-7), DoubleNear(0.12672966637832872, 1.0e-7), DoubleNear(0.08775312812632508, 1.0e-7), DoubleNear(0.1281925494947525, 1.0e-7), DoubleNear(0.11490344020431278, 1.0e-7), DoubleNear(0.1678545854719214, 1.0e-7), DoubleNear(0.11695838807386555, 1.0e-7), DoubleNear(0.170856518418375, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false, false}), Matrix({ { 0.10357506765370159 + 3.875175733688424e-20i, -0.0021820866227991497 + -0.013876494945647721i, 0.029025380872966217 + -0.035060263742160494i, -0.005308704888073182 + -0.0031500439813034204i, 0.007072952855906196 + 0.006937146629158305i, 0.0007803951873477892 + -0.0010937501850776816i, 0.00433032148697334 + -0.0004501688537331957i, -0.00015154131943354832 + -0.0005706718627585744i }, { -0.00218208662279915 + 0.01387649494564772i, 0.1513057399789301 + -3.341544976918215e-19i, 0.004085709880504168 + 0.004627320979265282i, 0.04240119587310244 + -0.05121714394723315i, -0.0010784166351766073 + 0.0008014509821364113i, 0.010332393595696848 + 0.010134003557463533i, -3.091835552871193e-05 + 0.000589639891570611i, 0.006325870808250892 + -0.0006576209224144662i }, { 0.029025380872966213 + 0.035060263742160494i, 0.004085709880504168 + -0.004627320979265282i, 0.10514488553388121 + 1.0863197548536397e-19i, -0.002215159047217195 + -0.014086811678944312i, -0.0003661406239570343 + 0.004338234343705146i, 0.0005889297384289935 + -4.234276365518785e-05i, 0.0071801528617608116 + 0.007042288311056992i, 0.0007922231141496393 + -0.0011103274235567855i }, { -0.005308704888073181 + 0.0031500439813034204i, 0.04240119587310244 + 0.05121714394723316i, -0.002215159047217195 + 0.014086811678944312i, 0.153598979668494 + 1.3594878803431513e-19i, -0.0005735022697205736 + -0.0001404503224109944i, -0.0005348698224305368 + 0.006337430160035784i, -0.0010947614733170328 + 0.0008135980375074182i, 0.010488994760233943 + 0.010287597857160246i }, { 0.007072952855906196 + -0.006937146629158305i, -0.0010784166351766073 + -0.0008014509821364115i, -0.00036614062395703387 + -0.004338234343705144i, -0.0005735022697205736 + 0.00014045032241099436i, 0.09808009638272938 + 1.223962608782464e-19i, -0.0020663203136412 + -0.013140304829672449i, 0.02748549644287118 + -0.033200210484362835i, -0.005027062003285848 + -0.0029829246004362563i }, { 0.0007803951873477892 + 0.0010937501850776816i, 0.01033239359569685 + -0.010134003557463533i, 0.0005889297384289934 + 4.2342763655187814e-05i, -0.0005348698224305369 + -0.006337430160035784i, -0.0020663203136412006 + 0.013140304829672449i, 0.14327851187132 + 9.783230540787169e-20i, 0.003868950587717983 + 0.0043818275760879495i, 0.040151683915682676 + -0.04849991922369i }, { 0.00433032148697334 + 0.0004501688537331954i, -3.0918355528712025e-05 + -0.000589639891570611i, 0.007180152861760813 + -0.007042288311056991i, -0.0010947614733170328 + -0.0008135980375074182i, 0.027485496442871175 + 0.033200210484362835i, 0.0038689505877179827 + -0.0043818275760879495i, 0.09956663066630941 + 3.536362554786703e-20i, -0.0020976381457026533 + -0.013339463622805935i }, { -0.0001515413194335483 + 0.0005706718627585742i, 0.006325870808250893 + 0.0006576209224144662i, 0.0007922231141496393 + 0.0011103274235567855i, 0.010488994760233943 + -0.010287597857160248i, -0.005027062003285848 + 0.0029829246004362563i, 0.040151683915682676 + 0.04849991922369i, -0.0020976381457026537 + 0.013339463622805935i, 0.1454500882446335 + -1.2684318385133152e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10357506765370159, 1.0e-7), DoubleNear(0.1513057399789301, 1.0e-7), DoubleNear(0.10514488553388121, 1.0e-7), DoubleNear(0.153598979668494, 1.0e-7), DoubleNear(0.09808009638272938, 1.0e-7), DoubleNear(0.14327851187132, 1.0e-7), DoubleNear(0.09956663066630941, 1.0e-7), DoubleNear(0.1454500882446335, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true, false}), Matrix({ { 0.10641187251820458 + 9.111109324893525e-20i, -0.0022418515265211552 + -0.014256556569123356i, 0.030135992208211237 + -0.035683611186281466i, -0.005415616020707123 + -0.0032857059198301095i, -0.0018325415170040824 + -0.0018256568752895246i, -0.00020598542251303031 + 0.0002839775557002609i, -0.0012156661697959165 + -5.557500536007997e-05i, 1.816559379143609e-05 + 0.00016404000809666836i }, { -0.002241851526521155 + 0.014256556569123356i, 0.1554498343920233 + -1.3641046104788367e-19i, 0.004145824999528543 + 0.004789247889661846i, 0.04402361209464019 + -0.05212774964060369i, 0.00028320022759234455 + -0.00020705283751016468i, -0.0026770347010485838 + -0.002666977398333669i, 3.305694358155975e-05 + -0.0001616983349796653i, -0.0017758836518775784 + -8.118572838836471e-05i }, { 0.030135992208211237 + 0.035683611186281466i, 0.004145824999528543 + -0.004789247889661846i, 0.10792990483261727 + 1.2566176173153908e-19i, -0.0022738329490902607 + -0.014459935318618434i, -0.00030032893735626806 + -0.0007309324978772465i, -9.159962499353112e-05 + 5.563569628850897e-05i, -0.0026983066607736347 + -0.0014547432164345193i, -0.00013805250959808478 + 0.00039215436081610814i }, { -0.005415616020707123 + 0.0032857059198301095i, 0.04402361209464019 + 0.05212774964060369i, -0.002273832949090261 + 0.014459935318618434i, 0.157667424086602 + 8.00026624413176e-20i, 0.00010425409428793138 + -2.483758894631002e-05i, -0.00043873002579836455 + -0.001067769348080287i, 0.00025174664472276634 + -0.0003308582249004078i, -0.003941771849606318 + -0.0021251349753193946i }, { -0.001832541517004082 + 0.0018256568752895248i, 0.0002832002275923446 + 0.00020705283751016476i, -0.000300328937356268 + 0.0007309324978772463i, 0.00010425409428793135 + 2.4837588946310028e-05i, 0.09524329151822639 + 7.003692496619539e-20i, -0.0020065554099191955 + -0.012760243206196814i, 0.02637488510762616 + -0.03257686304024186i, -0.004920150870651906 + -0.002847262661909567i }, { -0.00020598542251303042 + -0.0002839775557002608i, -0.002677034701048583 + 0.0026669773983336695i, -9.159962499353109e-05 + -5.5635696288508945e-05i, -0.00043873002579836504 + 0.0010677693480802865i, -0.002006555409919195 + 0.012760243206196812i, 0.1391344174582268 + -9.991173123606607e-20i, 0.003808835468693609 + 0.004219900665691384i, 0.03852926769414493 + -0.04758931353031946i }, { -0.0012156661697959163 + 5.557500536007982e-05i, 3.3056943581559726e-05 + 0.0001616983349796653i, -0.0026983066607736347 + 0.0014547432164345188i, 0.00025174664472276634 + 0.0003308582249004079i, 0.026374885107626155 + 0.03257686304024186i, 0.003808835468693609 + -0.004219900665691384i, 0.09678161136757335 + 1.833383930169192e-20i, -0.002038964243829587 + -0.012966339983131814i }, { 1.816559379143612e-05 + -0.00016404000809666836i, -0.0017758836518775782 + 8.118572838836436e-05i, -0.0001380525095980847 + -0.00039215436081610803i, -0.003941771849606318 + 0.0021251349753193946i, -0.004920150870651905 + 0.002847262661909567i, 0.03852926769414493 + 0.04758931353031946i, -0.0020389642438295875 + 0.012966339983131812i, 0.1413816438265255 + -7.089705825833398e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.10641187251820458, 1.0e-7), DoubleNear(0.1554498343920233, 1.0e-7), DoubleNear(0.10792990483261727, 1.0e-7), DoubleNear(0.157667424086602, 1.0e-7), DoubleNear(0.09524329151822639, 1.0e-7), DoubleNear(0.1391344174582268, 1.0e-7), DoubleNear(0.09678161136757335, 1.0e-7), DoubleNear(0.1413816438265255, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, true}), Matrix({ { 0.1207324577431053 + -2.3992208230978057e-19i, 0.0015397966804161047 + -0.01412533131361408i, 0.03383348569406117 + -0.040868057406103386i, -0.00434993349645763 + -0.004479637904852433i, -0.007243120590134985 + 0.0009617764191656875i, -0.0014741991611177197 + 0.0182396299120961i, -0.0017042151448137988 + 0.002721327163692702i, 0.005761010411680045 + 0.005610404412388798i }, { 0.0015397966804161051 + 0.01412533131361408i, 0.1506305178095264 + -4.531626267810507e-19i, 0.005212943989782838 + 0.0034371924795655205i, 0.042211974846413466 + -0.05098858056919126i, -0.026747895035309492 + 0.0006275657100720563i, 0.018989244336139174 + -0.0031274078840150482i, -0.007283270373151022 + 0.00923005516578164i, 0.004262824192204109 + -0.00730428796047215i }, { 0.033833485694061166 + 0.040868057406103386i, 0.005212943989782838 + -0.00343719247956552i, 0.12256231868528528 + 3.091670257478192e-20i, 0.0015631343466664446 + -0.014339419492959625i, -0.0023553396998019054 + -0.0021822799293861354i, -0.006587255435764659 + 0.00461236863856593i, -0.00735289971428393 + 0.00097635341972908i, -0.0014965426097341941 + 0.018516075757727603i }, { -0.004349933496457629 + 0.004479637904852433i, 0.042211974846413466 + 0.05098858056919126i, 0.0015631343466664443 + 0.014339419492959625i, 0.15291352360923013 + 1.863472483959457e-20i, -0.007708133611169408 + -0.008878323148216233i, 0.006380085570386005 + 0.0055514683478960145i, -0.027153294952826187 + 0.0006370773029194065i, 0.019277051585173642 + -0.00317480790919636i }, { -0.007243120590134986 + -0.0009617764191656875i, -0.02674789503530949 + -0.0006275657100720559i, -0.002355339699801905 + 0.0021822799293861354i, -0.007708133611169408 + 0.008878323148216233i, 0.08092270629332567 + 4.010701005249112e-19i, -0.005788203616856455 + -0.012891468461706088i, 0.022677391621776222 + -0.027392416820419943i, -0.0059858333949014 + -0.0016533306768872435i }, { -0.0014741991611177197 + -0.0182396299120961i, 0.018989244336139174 + 0.0031274078840150482i, -0.006587255435764659 + -0.00461236863856593i, 0.006380085570386005 + -0.0055514683478960145i, -0.005788203616856455 + 0.012891468461706088i, 0.1439537340407237 + 2.168404344971009e-19i, 0.002741716478439313 + 0.005571956075787711i, 0.04034090494237165 + -0.04872848260173189i }, { -0.0017042151448137988 + -0.0027213271636927017i, -0.007283270373151024 + -0.00923005516578164i, -0.00735289971428393 + -0.0009763534197290801i, -0.02715329495282618 + -0.0006370773029194066i, 0.022677391621776222 + 0.027392416820419943i, 0.002741716478439313 + -0.005571956075787711i, 0.08214919751490535 + 1.130788984584491e-19i, -0.005875931539586292 + -0.013086855808790623i }, { 0.005761010411680044 + -0.005610404412388798i, 0.004262824192204109 + 0.00730428796047215i, -0.0014965426097341941 + -0.018516075757727603i, 0.019277051585173642 + 0.00317480790919636i, -0.0059858333949014 + 0.0016533306768872435i, 0.04034090494237165 + 0.04872848260173189i, -0.005875931539586293 + 0.013086855808790623i, 0.14613554430389736 + -9.529120656610957e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1207324577431053, 1.0e-7), DoubleNear(0.1506305178095264, 1.0e-7), DoubleNear(0.12256231868528528, 1.0e-7), DoubleNear(0.15291352360923013, 1.0e-7), DoubleNear(0.08092270629332567, 1.0e-7), DoubleNear(0.1439537340407237, 1.0e-7), DoubleNear(0.08214919751490535, 1.0e-7), DoubleNear(0.14613554430389736, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false, false}), Matrix({ { 0.10646048646593385 + -1.6125640095192555e-20i, -0.0022428757097287992 + -0.014263069634624882i, 0.047980296413184534 + -0.0005083362859392733i, -0.0010789381208739179 + -0.006417462444544669i, 0.0073519856567276455 + 0.0060304048502586435i, 0.0006530356620032547 + -0.001112030724855162i, 0.003342234630436535 + 0.00268271675815877i, 0.0002890044943822268 + -0.00050429532406192i }, { -0.0022428757097287992 + 0.01426306963462488i, 0.1555208511869055 + -3.4690501675911364e-20i, -0.0009427291651412477 + 0.006438881379324225i, 0.07009113696626046 + -0.0007425937500648496i, -0.0009628142586476623 + 0.0008579374174231351i, 0.010740013550605698 + 0.008809406442210559i, -0.00042983076932545135 + 0.0003912580751689785i, 0.004882442226658137 + 0.003918997625994625i }, { 0.047980296413184534 + 0.0005083362859392733i, -0.0009427291651412478 + -0.006438881379324227i, 0.06804436549250939 + 1.1092930199295248e-19i, -0.0014335370766494933 + -0.009116260459453034i, 0.003284645684414359 + 0.0027529264896203223i, 0.0002996241258960114 + -0.000498058987294572i, 0.004699031685170258 + 0.003854341505663728i, 0.00041738863629193666 + -0.0007107559583165862i }, { -0.001078938120873918 + 0.006417462444544667i, 0.07009113696626046 + 0.0007425937500648495i, -0.0014335370766494933 + 0.009116260459453034i, 0.09940136468617569 + 5.865194560509713e-20i, -0.00043802386959802554 + 0.0003820634257635967i, 0.004798314469951037 + 0.0040215622258849195i, -0.000615384049910243 + 0.000548351873439162i, 0.006864494346132491 + 0.0056305441730031235i }, { 0.007351985656727646 + -0.006030404850258643i, -0.0009628142586476624 + -0.0008579374174231349i, 0.0032846456844143586 + -0.002752926489620322i, -0.0004380238695980256 + -0.0003820634257635968i, 0.14145235937195594 + 1.2369882439648869e-19i, -0.002980073372299576 + -0.018951114339964832i, 0.06375065863692524 + -0.0006754183583737082i, -0.0014335679638547998 + -0.008526780537042145i }, { 0.0006530356620032547 + 0.001112030724855162i, 0.010740013550605696 + -0.008809406442210559i, 0.00029962412589601146 + 0.0004980589872945718i, 0.004798314469951036 + -0.004021562225884919i, -0.0029800733722995755 + 0.018951114339964832i, 0.20663808763415717 + -2.1899586602675164e-19i, -0.0012525892853275163 + 0.008555239535872401i, 0.09312898169137154 + -0.0009866725344633257i }, { 0.003342234630436536 + -0.002682716758158769i, -0.0004298307693254516 + -0.0003912580751689785i, 0.0046990316851702576 + -0.0038543415056637277i, -0.0006153840499102431 + -0.000548351873439162i, 0.06375065863692524 + 0.0006754183583737085i, -0.0012525892853275165 + -0.008555239535872401i, 0.0904094689062224 + 8.664113295411305e-20i, -0.001904717970682331 + -0.012112630643027669i }, { 0.0002890044943822269 + 0.00050429532406192i, 0.004882442226658137 + -0.003918997625994625i, 0.00041738863629193655 + 0.0007107559583165862i, 0.006864494346132491 + -0.005630544173003126i, -0.0014335679638548 + 0.008526780537042143i, 0.09312898169137154 + 0.0009866725344633259i, -0.001904717970682331 + 0.012112630643027669i, 0.13207301625613924 + -3.218216600340031e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.10646048646593385, 1.0e-7), DoubleNear(0.1555208511869055, 1.0e-7), DoubleNear(0.06804436549250939, 1.0e-7), DoubleNear(0.09940136468617569, 1.0e-7), DoubleNear(0.14145235937195594, 1.0e-7), DoubleNear(0.20663808763415717, 1.0e-7), DoubleNear(0.0904094689062224, 1.0e-7), DoubleNear(0.13207301625613924, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false, false}), Matrix({ { 0.12733415433508175 + 4.341043854678289e-20i, -0.0026826355134907257 + -0.01705962437743038i, 0.05738777523315553 + -0.0006080055919021756i, -0.0012904851157647529 + -0.007675731912184381i, 0.008695417642109838 + 0.00852845882250087i, 0.0009594100537818676 + -0.0013446455602264666i, 0.003959629107296721 + 0.0038021410513831705i, 0.0004259725663264212 + -0.0006105945750545796i }, { -0.0026826355134907253 + 0.017059624377430384i, 0.18601376646624174 + -9.571472303973596e-20i, -0.0011275697208906741 + 0.007701350449516408i, 0.08383388004561731 + -0.0008881938296353927i, -0.0013257946470304825 + 0.0009852958377258034i, 0.01270254155337984 + 0.01245864282061333i, -0.0005928129826931591 + 0.00045038997535384835i, 0.0057843516368703 + 0.005554288095733995i }, { 0.057387775233155525 + 0.0006080055919021757i, -0.0011275697208906743 + -0.007701350449516408i, 0.08138579885250104 + 1.0397329427546534e-19i, -0.00171461015652562 + -0.010903682247161648i, 0.0038781843341882793 + 0.0038851802418962697i, 0.0004388136147319059 + -0.0006014324350038984i, 0.00555768807555717 + 0.0054509761177144265i, 0.000613208247715561 + -0.0008594320484080002i }, { -0.0012904851157647529 + 0.00767573191218438i, 0.08383388004561731 + 0.0008881938296353927i, -0.00171461015652562 + 0.010903682247161647i, 0.11889095318118234 + -1.0249098661777038e-19i, -0.0006022223258838128 + 0.0004377289487295654i, 0.005665374532227798 + 0.005675594375830708i, -0.0008473834614631571 + 0.0006297531819180259i, 0.008118846802550952 + 0.007962958594010453i }, { 0.008695417642109838 + -0.008528458822500869i, -0.001325794647030483 + -0.0009852958377258038i, 0.0038781843341882793 + -0.0038851802418962697i, -0.0006022223258838129 + -0.00043772894872956547i, 0.12057869150280806 + 6.416274575451324e-20i, -0.0025403135685376495 + -0.01615455959715933i, 0.05434317981695423 + -0.0005757490524108059i, -0.001222020968963965 + -0.007268511069402432i }, { 0.0009594100537818677 + 0.0013446455602264666i, 0.01270254155337984 + -0.012458642820613328i, 0.00043881361473190587 + 0.0006014324350038983i, 0.005665374532227799 + -0.005675594375830708i, -0.002540313568537649 + 0.01615455959715933i, 0.17614517235482094 + -1.5797164466292704e-19i, -0.00106774872957809 + 0.007292770465680219i, 0.0793862386120147 + -0.0008410724548927825i }, { 0.00395962910729672 + -0.00380214105138317i, -0.0005928129826931592 + -0.0004503899753538484i, 0.0055576880755571715 + -0.0054509761177144265i, -0.0008473834614631572 + -0.0006297531819180259i, 0.05434317981695423 + 0.0005757490524108061i, -0.00106774872957809 + -0.007292770465680219i, 0.07706803554623073 + 9.359714067160018e-20i, -0.0016236448908062042 + -0.010325208855319054i }, { 0.0004259725663264211 + 0.0006105945750545797i, 0.0057843516368703 + -0.005554288095733995i, 0.0006132082477155608 + 0.0008594320484080005i, 0.008118846802550955 + -0.007962958594010453i, -0.001222020968963965 + 0.00726851106940243i, 0.07938623861201469 + 0.0008410724548927825i, -0.0016236448908062042 + 0.010325208855319054i, 0.11258342776113257 + 1.289607662194672e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.12733415433508175, 1.0e-7), DoubleNear(0.18601376646624174, 1.0e-7), DoubleNear(0.08138579885250104, 1.0e-7), DoubleNear(0.11889095318118234, 1.0e-7), DoubleNear(0.12057869150280806, 1.0e-7), DoubleNear(0.17614517235482094, 1.0e-7), DoubleNear(0.07706803554623073, 1.0e-7), DoubleNear(0.11258342776113257, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true, false}), Matrix({ { 0.13076387063538786 + 1.0076313096494847e-19i, -0.002754891686992985 + -0.017519121455098978i, 0.05893350182303425 + -0.0006243820833479559i, -0.0013252440369666296 + -0.00788247599426877i, -0.002764142633835617 + -0.0020012795383534806i, -0.00020988783523340378 + 0.0004124890049740195i, -0.0012553174454089143 + -0.0008887510718432329i, -9.262401240667267e-05 + 0.00018690538611080396i }, { -0.002754891686992985 + 0.017519121455098978i, 0.19102400468757363 + -9.928053718357563e-20i, -0.0011579405532228513 + 0.007908784561039767i, 0.08609192641512262 + -0.0009121171271296025i, 0.0003263559930910047 + -0.00032816436183261144i, -0.004037947124670404 + -0.0029235325480807765i, 0.0001455172707369809 + -0.00014945753560393114i, -0.0018338074914042116 + -0.0012983157204580576i }, { 0.058933501823034244 + 0.0006243820833479561i, -0.0011579405532228513 + -0.007908784561039767i, 0.08357790671543402 + 1.1600972401552586e-19i, -0.0017607927886184307 + -0.011197370432642809i, -0.0012362056971645854 + -0.0009151479829777697i, -9.656318525361201e-05 + 0.0001849010067176941i, -0.0017667055439421003 + -0.0012791205533705633i, -0.00013415009687771135 + 0.00026364291154234954i }, { -0.00132524403696663 + 0.007882475994268768i, 0.08609192641512262 + 0.0009121171271296026i, -0.0017607927886184307 + 0.01119737043264281i, 0.12209325379105168 + 4.287273857700953e-20i, 0.00014865116310229526 + -0.0001463409127341871i, -0.0018058884441285918 + -0.0013368771644700751i, 0.0002085908792241062 + -0.00020974670057796112i, -0.0025808594259844973 + -0.0018685798255722876i }, { -0.0027641426338356175 + 0.00200127953835348i, 0.0003263559930910047 + 0.0003281643618326115i, -0.0012362056971645852 + 0.0009151479829777693i, 0.0001486511631022953 + 0.0001463409127341871i, 0.11714897520250195 + 6.810053336347645e-21i, -0.00246805739503539 + -0.015695062519490734i, 0.05279745322707552 + -0.0005593725609650257i, -0.001187262047762088 + -0.007061766987318043i }, { -0.0002098878352334037 + -0.00041248900497401934i, -0.004037947124670404 + 0.0029235325480807756i, -9.656318525361199e-05 + -0.00018490100671769407i, -0.0018058884441285914 + 0.001336877164470075i, -0.00246805739503539 + 0.015695062519490734i, 0.17113493413348907 + -1.5440583051908737e-19i, -0.001037377897245913 + 0.0070853363541568595i, 0.07712819224250939 + -0.0008171491573985728i }, { -0.0012553174454089145 + 0.0008887510718432328i, 0.00014551727073698094 + 0.00014945753560393114i, -0.0017667055439421003 + 0.0012791205533705633i, 0.00020859087922410615 + 0.0002097467005779611i, 0.05279745322707552 + 0.0005593725609650258i, -0.0010373778972459131 + -0.0070853363541568595i, 0.07487592768329776 + 8.156071093153965e-20i, -0.0015774622587133931 + -0.010031520669837892i }, { -9.262401240667267e-05 + -0.00018690538611080393i, -0.0018338074914042118 + 0.0012983157204580573i, -0.0001341500968777114 + -0.0002636429115423495i, -0.002580859425984497 + 0.0018685798255722876i, -0.001187262047762088 + 0.007061766987318042i, 0.0771281922425094 + 0.0008171491573985728i, -0.001577462258713393 + 0.010031520669837892i, 0.10938112715126323 + -1.6402958975312705e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.13076387063538786, 1.0e-7), DoubleNear(0.19102400468757363, 1.0e-7), DoubleNear(0.08357790671543402, 1.0e-7), DoubleNear(0.12209325379105168, 1.0e-7), DoubleNear(0.11714897520250195, 1.0e-7), DoubleNear(0.17113493413348907, 1.0e-7), DoubleNear(0.07487592768329776, 1.0e-7), DoubleNear(0.10938112715126323, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, true}), Matrix({ { 0.1484272784538692 + -1.3976043629695958e-19i, 0.0018930106693658888 + -0.017365541324438794i, 0.06689416000647103 + -0.0007087227756136327i, 0.0007702358027036158 + -0.007835452700113398i, -0.008904620156035162 + 0.0011823983297152996i, -0.0018123657339045249 + 0.02242361895438854i, -0.004007545641776472 + 0.0005754093928136922i, -0.0007097384997336506 + 0.01011467457175644i }, { 0.0018930106693658892 + 0.017365541324438794i, 0.18518365507093193 + -2.9942614685439517e-19i, 0.0009360726323712111 + 0.007817374894068113i, 0.08345976010567441 + -0.0008842301454778658i, -0.03288359517130322 + 0.000771523019892178i, 0.02334518744500292 + -0.0038448040362703234i, -0.01481650612979854 + 0.0005047302488038793i, 0.010503000663879448 + -0.001844271519969379i }, { 0.06689416000647103 + 0.0007087227756136325i, 0.000936072632371211 + -0.007817374894068113i, 0.09486749797452138 + -6.924494343803908e-20i, 0.0012099203577166603 + -0.011099209482134912i, -0.004018837267343495 + 0.0004903723675645664i, -0.0009238787794746946 + 0.010097366905851092i, -0.005691400148383753 + 0.0007557315091794678i, -0.0011583760369473892 + 0.014332086715435156i }, { 0.0007702358027036159 + 0.007835452700113398i, 0.08345976010567441 + 0.0008842301454778656i, 0.0012099203577166603 + 0.011099209482134914i, 0.11836038634782459 + -1.3510175508706095e-19i, -0.014823873992927252 + 0.0001906996597541135i, 0.010539717636886846 + -0.0016213304781933521i, -0.021017594816832456 + 0.0004931199930992848i, 0.014921108476309891 + -0.002457411756941085i }, { -0.008904620156035162 + -0.0011823983297152999i, -0.032883595171303216 + -0.0007715230198921779i, -0.004018837267343495 + -0.0004903723675645664i, -0.014823873992927252 + -0.00019069965975411339i, 0.09948556738402062 + 2.473336205982557e-19i, -0.007115959751394264 + -0.015848642650150922i, 0.044836795043638744 + -0.0004750318686993489i, -0.0032827418874323334 + -0.007108790281473414i }, { -0.0018123657339045249 + -0.022423618954388547i, 0.02334518744500292 + 0.003844804036270323i, -0.0009238787794746949 + -0.010097366905851092i, 0.010539717636886842 + 0.001621330478193352i, -0.007115959751394264 + 0.015848642650150922i, 0.17697528375013075 + 4.573977915173218e-20i, -0.003131391082839975 + 0.007176746021128513i, 0.0797603585519576 + -0.0008450361390503094i }, { -0.004007545641776473 + -0.0005754093928136922i, -0.01481650612979854 + -0.000504730248803879i, -0.005691400148383753 + -0.0007557315091794678i, -0.021017594816832456 + -0.0004931199930992843i, 0.044836795043638744 + 0.0004750318686993492i, -0.003131391082839975 + -0.007176746021128513i, 0.06358633642421041 + 2.668153783851046e-19i, -0.004548175405048484 + -0.010129681620345788i }, { -0.0007097384997336503 + -0.01011467457175644i, 0.01050300066387945 + 0.001844271519969379i, -0.0011583760369473892 + -0.014332086715435158i, 0.014921108476309893 + 0.002457411756941085i, -0.003282741887432334 + 0.007108790281473413i, 0.0797603585519576 + 0.0008450361390503096i, -0.004548175405048484 + 0.010129681620345788i, 0.11311399459449033 + 1.6157153468875777e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1484272784538692, 1.0e-7), DoubleNear(0.18518365507093193, 1.0e-7), DoubleNear(0.09486749797452138, 1.0e-7), DoubleNear(0.11836038634782459, 1.0e-7), DoubleNear(0.09948556738402062, 1.0e-7), DoubleNear(0.17697528375013075, 1.0e-7), DoubleNear(0.06358633642421041, 1.0e-7), DoubleNear(0.11311399459449033, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false, false}), Matrix({ { 0.08962999749527678 + 9.4768730268322e-20i, -0.0018882963146099878 + -0.01200820077067241i, 0.006189699839561311 + 0.005077049613117658i, 0.0005497963300065099 + -0.0009362282137920974i, 0.006120669395830485 + 0.006003147756318222i, 0.0006753248660302336 + -0.0009464905847490183i, 8.263781759077393e-05 + 0.000761269963171243i, 0.0001002503416616977 + -2.7109615515584506e-05i }, { -0.0018882963146099876 + 0.012008200770672408i, 0.13093433972618645 + 9.151456868838887e-21i, -0.000810601589901816 + 0.0007223048769305218i, 0.009042109608883454 + 0.00741671491049279i, -0.0009332215030060831 + 0.0006935457649098282i, 0.008941267749868812 + 0.00876958841590601i, -0.00010373231624085115 + -4.96677198973237e-06i, 0.00012071994181670295 + 0.0011120872784411004i }, { 0.006189699839561311 + -0.0050770496131176575i, -0.0008106015899018164 + -0.0007223048769305217i, 0.11908995569230599 + 5.2615002553926235e-20i, -0.0025089493554063575 + -0.015955105853919623i, 0.0007627288550876714 + 6.78650082116093e-05i, -6.9766982001016455e-06 + -0.00010361654278595985i, 0.008132436321836523 + 0.007976287183897075i, 0.0008972934354671949 + -0.0012575870238854486i }, { 0.0005497963300065098 + 0.0009362282137920972i, 0.009042109608883454 + -0.00741671491049279i, -0.0025089493554063575 + 0.015955105853919623i, 0.17397037992123765 + -2.0735716652634524e-19i, -2.5161160248118078e-05 + 0.00010075702591709656i, 0.0011142184739687969 + 9.913935388838478e-05i, -0.0012399566054875568 + 0.0009215032547340012i, 0.011880120606061978 + 0.011652012998717773i }, { 0.006120669395830485 + -0.006003147756318222i, -0.0009332215030060831 + -0.0006935457649098283i, 0.0007627288550876715 + -6.786500821160985e-05i, -2.5161160248118078e-05 + -0.0001007570259170966i, 0.08487485446316645 + 3.493162943790513e-23i, -0.0017881164717683047 + -0.011371129323405506i, 0.005861317502336592 + 0.004807696742804712i, 0.0005206279682886815 + -0.0008865584693796511i }, { 0.0006753248660302336 + 0.0009464905847490183i, 0.008941267749868814 + -0.00876958841590601i, -6.976698200101639e-06 + 0.00010361654278595985i, 0.0011142184739687967 + -9.913935388838484e-05i, -0.0017881164717683047 + 0.011371129323405506i, 0.12398787614689476 + 1.4809987060346894e-20i, -0.0007675967186560896 + 0.0006839844139317754i, 0.008562398287854734 + 0.007023235704720892i }, { 8.263781759077402e-05 + -0.000761269963171243i, -0.00010373231624085115 + 4.966771989732349e-06i, 0.008132436321836524 + -0.007976287183897075i, -0.001239956605487557 + -0.0009215032547340014i, 0.005861317502336593 + -0.004807696742804712i, -0.0007675967186560894 + -0.0006839844139317754i, 0.11277187258587235 + 1.577249547966755e-19i, -0.0023758419875755487 + -0.01510863912907288i }, { 0.00010025034166169771 + 2.7109615515584513e-05i, 0.00012071994181670284 + -0.0011120872784411i, 0.0008972934354671949 + 0.0012575870238854489i, 0.01188012060606198 + -0.011652012998717771i, 0.0005206279682886814 + 0.0008865584693796509i, 0.008562398287854735 + -0.007023235704720892i, -0.002375841987575549 + 0.015108639129072881i, 0.16474072396905876 + -4.3820865503806717e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.08962999749527678, 1.0e-7), DoubleNear(0.13093433972618645, 1.0e-7), DoubleNear(0.11908995569230599, 1.0e-7), DoubleNear(0.17397037992123765, 1.0e-7), DoubleNear(0.08487485446316645, 1.0e-7), DoubleNear(0.12398787614689476, 1.0e-7), DoubleNear(0.11277187258587235, 1.0e-7), DoubleNear(0.16474072396905876, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true, false}), Matrix({ { 0.08848263531280523 + 4.3457404418503835e-20i, -0.0018641240526304195 + -0.011854482642491927i, 0.014060335711830099 + 0.025517943764511858i, 0.0031225540521398207 + -0.0024213408385858784i, -0.0015613608352706473 + -0.0072940715131486755i, -0.0009443307555483746 + 0.000362852880185441i, 0.0026209133164462476 + 0.002091959160221547i, 0.00022505416944469827 + -0.0003952102317178244i }, { -0.0018641240526304193 + 0.011854482642491927i, 0.12925823670279157 + 1.5041272090008916e-20i, -0.003714991424643977 + 0.0013461329726146252i, 0.020539783824650975 + 0.03727742063311321i, 0.0010101192637132507 + -5.551451709988689e-05i, -0.0022808853704504705 + -0.010655410735005711i, -0.00033548730778364523 + 0.0003070647696414896i, 0.0038287132004722274 + 0.003056000212341743i }, { 0.014060335711830102 + -0.025517943764511858i, -0.0037149914246439775 + -0.001346132972614625i, 0.12585914203801662 + 1.7331545056197052e-19i, -0.0026515604229809964 + -0.016862009245249863i, -0.005575274409825803 + 0.0018029896420968007i, 0.0003590140871358421 + 0.0007089639355582664i, -0.00296948734250707 + 0.004013671421424631i, 0.0006002928234372595 + 0.0003132790363309279i }, { 0.0031225540521398203 + 0.002421340838585878i, 0.020539783824650975 + -0.03727742063311321i, -0.0026515604229809964 + 0.016862009245249866i, 0.18385902177583374 + -7.144907069657499e-20i, -0.00012409786678074913 + -0.0007849335616118827i, -0.008144537476767346 + 0.00263386438601137i, -0.00047517239139814013 + -0.0004823965453106856i, -0.004337921180204431 + 0.005863298361352647i }, { -0.0015613608352706473 + 0.0072940715131486755i, 0.0010101192637132512 + 5.5514517099886914e-05i, -0.005575274409825803 + -0.001802989642096801i, -0.0001240978667807491 + 0.0007849335616118827i, 0.086022216645638 + 5.134625747925609e-20i, -0.0018122887337478732 + -0.011524847451585989i, -0.0020093183699321972 + -0.015633197408589483i, -0.0020521297538446293 + 0.00059855415541413i }, { -0.0009443307555483746 + -0.0003628528801854409i, -0.0022808853704504705 + 0.010655410735005711i, 0.0003590140871358421 + -0.0007089639355582663i, -0.008144537476767346 + -0.00263386438601137i, -0.001812288733747873 + 0.011524847451585989i, 0.12566397917028965 + 8.920171839176866e-21i, 0.002136793116086072 + 6.0156318247671825e-05i, -0.0029352759279127885 + -0.022837470017899528i }, { 0.0026209133164462476 + -0.002091959160221547i, -0.0003354873077836453 + -0.00030706476964148955i, -0.0029694873425070703 + -0.004013671421424631i, -0.0004751723913981402 + 0.0004823965453106857i, -0.0020093183699321977 + 0.015633197408589487i, 0.002136793116086072 + -6.0156318247671934e-05i, 0.10600268624016172 + 3.7024506788631214e-20i, -0.0022332309200009098 + -0.014201735737742638i }, { 0.00022505416944469816 + 0.00039521023171782435i, 0.0038287132004722274 + -0.0030560002123417424i, 0.0006002928234372595 + -0.0003132790363309279i, -0.004337921180204431 + -0.005863298361352649i, -0.0020521297538446293 + -0.00059855415541413i, -0.0029352759279127885 + 0.022837470017899528i, -0.00223323092000091 + 0.014201735737742638i, 0.15485208211446264 + -1.7972896133357695e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.08848263531280523, 1.0e-7), DoubleNear(0.12925823670279157, 1.0e-7), DoubleNear(0.12585914203801662, 1.0e-7), DoubleNear(0.18385902177583374, 1.0e-7), DoubleNear(0.086022216645638, 1.0e-7), DoubleNear(0.12566397917028965, 1.0e-7), DoubleNear(0.10600268624016172, 1.0e-7), DoubleNear(0.15485208211446264, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, true}), Matrix({ { 0.10447736246037012 + -1.2159724907703338e-19i, 0.0013324825726435206 + -0.012223534475421977i, 0.007215034382800466 + 0.005918071711280901i, 0.0007844154871162001 + -0.0007686592789997154i, -0.006267926201336015 + 0.0008322854137933656i, -0.0012757169279415687 + 0.015783894911870943i, -0.00047999706954317235 + -0.0002975675125364418i, -0.0009821703099416991 + 0.0010177473637998683i }, { 0.001332482572643521 + 0.012223534475421977i, 0.13035002766418752 + -1.4236556333344418e-19i, -0.0006003773883414127 + 0.0009196149929119535i, 0.00900175798133154 + 0.007383616824905232i, -0.02314662996923505 + 0.0005430719409225488i, 0.0164325832542628 + -0.0027063420489203023i, -0.0016292301581533593 + -0.0012736264600554004i, 0.001288106593900186 + 0.0007439205329788426i }, { 0.007215034382800468 + -0.005918071711280901i, -0.0006003773883414129 + -0.0009196149929119533i, 0.13881741396802044 + -8.740813065796526e-20i, 0.0017704484544390283 + -0.01624121633115173i, -0.00038570822749950834 + 0.00041252002924263695i, 0.00080597249481576 + 0.0011622721505108063i, -0.008328094103082901 + 0.001105844425101402i, -0.0016950248429103449 + 0.020971810757952757i }, { 0.0007844154871161999 + 0.0007686592789997152i, 0.00900175798133154 + -0.007383616824905232i, 0.0017704484544390287 + 0.01624121633115173i, 0.173194013754569 + -2.9216233860801194e-19i, -0.001567706042017996 + 0.001348633765634667i, 0.000981507615067035 + -0.0011177115720086667i, -0.03075456001890063 + 0.000721571072068914i, 0.021833712667050018 + -0.0035958737442911065i }, { -0.006267926201336014 + -0.0008322854137933656i, -0.023146629969235045 + -0.0005430719409225486i, -0.00038570822749950834 + -0.00041252002924263716i, -0.001567706042017996 + -0.001348633765634667i, 0.07002748949807311 + 2.1640091097479332e-19i, -0.005008895359021813 + -0.011155795618655939i, 0.004835982959097436 + 0.00396667464464147i, 0.0002860088111789913 + -0.001054127404172033i }, { -0.0012757169279415687 + -0.015783894911870943i, 0.0164325832542628 + 0.0027063420489203023i, 0.00080597249481576 + -0.0011622721505108065i, 0.000981507615067035 + 0.001117711572008666i, -0.005008895359021813 + 0.011155795618655939i, 0.12457218820889368 + 1.6632700726262996e-19i, -0.0009778209202164928 + 0.0004866742979503436i, 0.008602749915406646 + 0.007056333790308452i }, { -0.00047999706954317235 + 0.0002975675125364418i, -0.0016292301581533597 + 0.0012736264600554008i, -0.008328094103082901 + -0.001105844425101402i, -0.03075456001890063 + -0.0007215710720689136i, 0.004835982959097436 + -0.0039666746446414694i, -0.0009778209202164925 + -0.0004866742979503437i, 0.0930444143101579 + 2.97748088008567e-19i, -0.006655239797420935 + -0.01482252865184077i }, { -0.0009821703099416991 + -0.0010177473637998683i, 0.0012881065939001858 + -0.0007439205329788426i, -0.001695024842910345 + -0.02097181075795276i, 0.021833712667050018 + 0.003595873744291106i, 0.0002860088111789912 + 0.0010541274041720328i, 0.008602749915406646 + -0.007056333790308452i, -0.006655239797420935 + 0.014822528651840774i, 0.1655170901357274 + 4.098430657786e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.10447736246037012, 1.0e-7), DoubleNear(0.13035002766418752, 1.0e-7), DoubleNear(0.13881741396802044, 1.0e-7), DoubleNear(0.173194013754569, 1.0e-7), DoubleNear(0.07002748949807311, 1.0e-7), DoubleNear(0.12457218820889368, 1.0e-7), DoubleNear(0.0930444143101579, 1.0e-7), DoubleNear(0.1655170901357274, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true, false}), Matrix({ { 0.11009122526668985 + 1.168949135027215e-19i, -0.002319366961412035 + -0.014749498750810518i, 0.007517929399415828 + 0.0073735792750064515i, 0.000829491733035577 + -0.0011625606503436105i, -0.002327155412976169 + -0.0016848944238796895i, -0.00017670637032340397 + 0.00034727803441402644i, -4.606804474601963e-05 + -0.00027092424645819264i, -3.532659505167081e-05 + 1.1879723488825587e-05i }, { -0.002319366961412035 + 0.014749498750810518i, 0.16082474944507832 + -1.0922472687423535e-19i, -0.001146262429791718 + 0.000851872198718629i, 0.010982429426849743 + 0.010771558192250744i, 0.00027476191227695926 + -0.00027628439344496147i, -0.0033995823491383267 + -0.002461347150106145i, 3.726768891636226e-05 + -4.642315682227382e-07i, -6.72976591527223e-05 + -0.0003957747218244358i }, { 0.007517929399415828 + -0.007373579275006453i, -0.0011462624297917182 + -0.0008518721987186291i, 0.104250552084132 + 9.987794147775282e-20i, -0.002196317514199381 + -0.013966993136931272i, -0.0002717663703736523 + 4.080749930578306e-05i, 1.1192682229822471e-05 + 3.555024630882189e-05i, -0.0022036927648015486 + -0.0015955056678443544i, -0.0001673315617877112 + 0.0003288538821023425i }, { 0.0008294917330355771 + 0.0011625606503436105i, 0.010982429426849743 + -0.010771558192250742i, -0.0021963175141993807 + 0.013966993136931272i, 0.15229250903354696 + 5.281692826766927e-20i, 2.582928890498255e-07 + -3.726968517306195e-05i, -0.0003970049231177491 + 5.9612887725017097e-05i, 0.0002601849600381515 + -0.00026162666896561103i, -0.0032192242015165744 + -0.002330765223546919i }, { -0.002327155412976169 + 0.0016848944238796897i, 0.00027476191227695926 + 0.0002762843934449615i, -0.0002717663703736523 + -4.0807499305783016e-05i, 2.5829288904981704e-07 + 3.7269685173061935e-05i, 0.09862872792089292 + 3.048881931952671e-20i, -0.0020778787086043107 + -0.013213807873781513i, 0.0067351763182511805 + 0.0066058556652088445i, 0.0007431265684618514 + -0.0010415169582908563i }, { -0.00017670637032340394 + -0.00034727803441402644i, -0.0033995823491383267 + 0.0024613471501061445i, 1.1192682229822483e-05 + -3.555024630882186e-05i, -0.0003970049231177491 + -5.961288772501726e-05i, -0.0020778787086043107 + 0.013213807873781513i, 0.14407997020234575 + -8.898098278327098e-20i, -0.001026915678701922 + 0.0007631768209252006i, 0.00983895892908105 + 0.009650043222373039i }, { -4.606804474601968e-05 + 0.0002709242464581926i, 3.726768891636228e-05 + 4.6423156822273313e-07i, -0.002203692764801548 + 0.0015955056678443541i, 0.0002601849600381516 + 0.0002616266689656111i, 0.006735176318251181 + -0.006605855665208844i, -0.0010269156787019221 + -0.0007631768209252007i, 0.09339617496490679 + 5.78819449483606e-20i, -0.0019676409451444728 + -0.012512775315547111i }, { -3.53265950516708e-05 + -1.1879723488825611e-05i, -6.729765915272249e-05 + 0.00039577472182443567i, -0.00016733156178771116 + -0.0003288538821023424i, -0.003219224201516574 + 0.0023307652235469182i, 0.0007431265684618514 + 0.0010415169582908565i, 0.00983895892908105 + -0.009650043222373039i, -0.0019676409451444723 + 0.012512775315547111i, 0.13643609108240654 + -8.18278067111291e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.11009122526668985, 1.0e-7), DoubleNear(0.16082474944507832, 1.0e-7), DoubleNear(0.104250552084132, 1.0e-7), DoubleNear(0.15229250903354696, 1.0e-7), DoubleNear(0.09862872792089292, 1.0e-7), DoubleNear(0.14407997020234575, 1.0e-7), DoubleNear(0.09339617496490679, 1.0e-7), DoubleNear(0.13643609108240654, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, true}), Matrix({ { 0.12496219994549834 + -1.308665903507894e-19i, 0.0015937419336148674 + -0.01462019832035643i, 0.008533441193974894 + 0.008369592448855516i, 0.0010880506632485675 + -0.0008916426904023836i, -0.00749687615355029 + 0.0009954713044140904i, -0.0015258462701311043 + 0.018878637299483022i, -0.0005786217027136723 + -0.0004341393015801072i, -0.0013686316316313058 + 0.0011869911850272221i }, { 0.0015937419336148678 + 0.01462019832035643i, 0.15590770896472472 + -2.507217523872729e-19i, -0.0008703831914081881 + 0.0011051307765408335i, 0.01064665368181811 + 0.010442229604141432i, -0.02768498107307376 + 0.000649551853800818i, 0.01965451372319187 + -0.0032369735249238255i, -0.0019340619990645483 + -0.001809900082486559i, 0.001558973724128934 + 0.0010953532066645855i }, { 0.008533441193974894 + -0.008369592448855516i, -0.0008703831914081882 + -0.0011051307765408338i, 0.11833257648289222 + -7.813878938420922e-20i, 0.0015091890934676815 + -0.013844552486217276i, -0.00044527435261723766 + 0.0005700971486764625i, 0.0011602371023594358 + 0.0013913843763470538i, -0.0070991441508686266 + 0.0009426585344806772i, -0.0014448955007208093 + 0.017877068370340678i }, { 0.0010880506632485673 + 0.0008916426904023837i, 0.010646653681818111 + -0.01044222960414143i, 0.0015091890934676817 + 0.013844552486217276i, 0.1476363324540318 + -1.8380614955418317e-19i, -0.0018470519385329232 + 0.001898613510215331i, 0.0011253682148923204 + -0.0015374472676436418i, -0.02621620891506192 + 0.0006150911591906449i, 0.018611782198120947 + -0.003065242268287583i }, { -0.00749687615355029 + -0.0009954713044140907i, -0.027684981073073756 + -0.0006495518538008175i, -0.00044527435261723755 + -0.0005700971486764625i, -0.0018470519385329234 + -0.0018986135102153313i, 0.08375775324208444 + 2.7825032317303766e-19i, -0.005990987603631212 + -0.013343108304235601i, 0.005719664523692115 + 0.00560984249135978i, 0.0004845676382488609 + -0.0013124349182320832i }, { -0.0015258462701311045 + -0.018878637299483022i, 0.01965451372319187 + 0.0032369735249238255i, 0.0011602371023594362 + -0.0013913843763470536i, 0.0011253682148923204 + 0.0015374472676436418i, -0.005990987603631213 + 0.013343108304235601i, 0.14899701068269935 + 5.2516042729766585e-20i, -0.0013027949170854518 + 0.0005099182431029959i, 0.010174734674112684 + 0.00997937181048235i }, { -0.0005786217027136723 + 0.0004341393015801073i, -0.0019340619990645483 + 0.001809900082486559i, -0.0070991441508686266 + -0.0009426585344806772i, -0.02621620891506192 + -0.0006150911591906447i, 0.005719664523692115 + -0.005609842491359781i, -0.0013027949170854518 + -0.000509918243102996i, 0.07931415056614657 + 2.3589867581032264e-19i, -0.005673147552811535 + -0.012635215966261108i }, { -0.0013686316316313058 + -0.001186991185027222i, 0.0015589737241289343 + -0.001095353206664585i, -0.0014448955007208095 + -0.01787706837034068i, 0.018611782198120947 + 0.0030652422682875824i, 0.0004845676382488611 + 0.0013124349182320834i, 0.010174734674112682 + -0.00997937181048235i, -0.005673147552811535 + 0.012635215966261108i, 0.1410922676619217 + 1.5479527111072336e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.12496219994549834, 1.0e-7), DoubleNear(0.15590770896472472, 1.0e-7), DoubleNear(0.11833257648289222, 1.0e-7), DoubleNear(0.1476363324540318, 1.0e-7), DoubleNear(0.08375775324208444, 1.0e-7), DoubleNear(0.14899701068269935, 1.0e-7), DoubleNear(0.07931415056614657, 1.0e-7), DoubleNear(0.1410922676619217, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, true}), Matrix({ { 0.12832802819725989 + -8.60245287837814e-20i, 0.0016366690077902388 + -0.015013990015560858i, -0.002712652754407764 + -0.001964000115479321i, -0.0002643786653080308 + 0.0002923236940288417i, -0.007698802796715842 + 0.0010222840961357168i, -0.001566944590151816 + 0.01938712907383617i, 0.00017838616408746036 + 9.621707732976978e-05i, 0.0003298336372257155 + -0.0003858320775418092i }, { 0.0016366690077902393 + 0.015013990015560858i, 0.16010704741851123 + -1.9827328917413281e-19i, 0.0001951854461118082 + -0.00034242059281950027i, -0.003384411256692188 + -0.002450363058143859i, -0.02843066970120192 + 0.0006670473843009247i, 0.020183903551419982 + -0.0033241606658764066i, 0.000611188504305988 + 0.00042101769512830576i, -0.00047753070280886307 + -0.0002386376207102248i }, { -0.002712652754407764 + 0.001964000115479321i, 0.00019518544611180826 + 0.00034242059281950027i, 0.11496674823113065 + -1.2298085095121724e-19i, 0.00146626201929231 + -0.013450760791012848i, 0.00014709500951946567 + -0.00013943603437486856i, -0.0002635881471610527 + -0.0004337947774950464i, -0.006897217507703075 + 0.0009158457427590509i, -0.0014037971807000975 + 0.017368576595987534i }, { -0.00026437866530803074 + -0.0002923236940288417i, -0.003384411256692188 + 0.0024503630581438588i, 0.0014662620192923102 + 0.013450760791012848i, 0.14343699400024532 + -2.362546127673233e-19i, 0.0005907708113327367 + -0.00044921836102746496i, -0.000375781271708472 + 0.0003791726809469895i, -0.025470520286933758 + 0.0005975956286905382i, 0.018082392369892834 + -0.0029780551273350018i }, { -0.007698802796715842 + -0.0010222840961357168i, -0.028430669701201918 + -0.0006670473843009242i, 0.00014709500951946565 + 0.00013943603437486856i, 0.0005907708113327367 + 0.00044921836102746485i, 0.08601374915356197 + 3.027973837642557e-19i, -0.006152353483401655 + -0.01370250187218093i, -0.0018181954233699536 + -0.0013163999762447229i, -7.965926680308436e-05 + 0.00038380822248752723i }, { -0.0015669445901518163 + -0.01938712907383617i, 0.020183903551419982 + 0.0033241606658764066i, -0.0002635881471610527 + 0.0004337947774950464i, -0.000375781271708472 + -0.00037917268094698954i, -0.006152353483401655 + 0.013702501872180934i, 0.1530102110601141 + 1.4186549056756674e-19i, 0.0003397614262033026 + -0.0001954904695910722i, -0.003234395293962713 + -0.002341749315509205i }, { 0.00017838616408746036 + -9.621707732976976e-05i, 0.000611188504305988 + -0.0004210176951283058i, -0.006897217507703075 + -0.0009158457427590509i, -0.025470520286933758 + -0.000597595628690538i, -0.0018181954233699536 + 0.0013163999762447229i, 0.00033976142620330263 + 0.00019549046959107234i, 0.07705815465466906 + 2.1135161521910456e-19i, -0.005511781673041094 + -0.012275822398315778i }, { 0.0003298336372257154 + 0.0003858320775418092i, -0.0004775307028088632 + 0.00023863762071022477i, -0.0014037971807000977 + -0.017368576595987534i, 0.018082392369892834 + 0.0029780551273350013i, -7.965926680308436e-05 + -0.0003838082224875272i, -0.003234395293962713 + 0.0023417493155092044i, -0.005511781673041094 + 0.012275822398315778i, 0.13707906728450697 + 6.544582327292322e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.12832802819725989, 1.0e-7), DoubleNear(0.16010704741851123, 1.0e-7), DoubleNear(0.11496674823113065, 1.0e-7), DoubleNear(0.14343699400024532, 1.0e-7), DoubleNear(0.08601374915356197, 1.0e-7), DoubleNear(0.1530102110601141, 1.0e-7), DoubleNear(0.07705815465466906, 1.0e-7), DoubleNear(0.13707906728450697, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false, false}), Matrix({ { 0.11802055227514063 + -6.098637220230962e-20i, 0.007525322927420235 + 0.012091730247715714i, 0.001664097560465087 + -0.014914621549297433i, 0.0016341768304597992 + -0.0007805040979383816i, 0.035086171209186 + -0.039842242477928086i, 0.006319207991879203 + 0.0010542805849406854i, -0.0066346276474032045 + -0.0048927820048025195i, 7.824471615352173e-05 + -0.0009917246627789205i }, { 0.0075253229274202344 + -0.012091730247715714i, 0.11317677721643915 + 7.305659170068342e-20i, -0.0014219617326006145 + -0.0011214924837597891i, 0.0015958000131037144 + -0.014302498741211951i, -0.001844821733791944 + -0.006135187850990527i, 0.03364617183846468 + -0.038207045415407856i, -0.0009243298189160186 + 0.00036776953140871916i, -0.006362330633851335 + -0.004691973459293638i }, { 0.0016640975604650871 + 0.014914621549297435i, -0.0014219617326006145 + 0.0011214924837597891i, 0.13529746853604824 + -5.421010862427522e-20i, 0.008626947784675824 + 0.013861827124166878i, 0.0029193523633314314 + 0.0024642968653255247i, -6.633203727568189e-05 + 0.0004562311388825845i, 0.03590245764321301 + -0.0459061603131463i, 0.006992532054452962 + 0.00075126027313209i }, { 0.0016341768304597997 + 0.0007805040979383816i, 0.0015958000131037148 + 0.014302498741211951i, 0.008626947784675824 + -0.013861827124166878i, 0.12974461785905306 + -3.3034284942917713e-20i, 0.0004386243007753494 + -0.00014197011666043803i, 0.0027995369083749088 + 0.002363157703854118i, -0.0024140483506427785 + -0.006605472510827484i, 0.03442895641375882 + -0.044022089190964245i }, { 0.035086171209186 + 0.039842242477928086i, -0.0018448217337919438 + 0.006135187850990527i, 0.0029193523633314314 + -0.0024642968653255247i, 0.0004386243007753494 + 0.00014197011666043803i, 0.12126639451385932 + -1.9905274260476106e-20i, 0.007732286973486335 + 0.012424281214650097i, -1.8067354759273026e-05 + -0.013904564233759499i, 0.0014234323938427597 + -0.0008884452714616116i }, { 0.006319207991879203 + -0.0010542805849406852i, 0.03364617183846468 + 0.038207045415407856i, -6.63320372756819e-05 + -0.0004562311388825845i, 0.002799536908374909 + -0.0023631577038541185i, 0.007732286973486335 + -0.012424281214650097i, 0.11628940427036753 + -1.2070219498373852e-20i, -0.001425736444728589 + -0.0008847431098325149i, -1.732583812786746e-05 + -0.013333895988786513i }, { -0.006634627647403203 + 0.0048927820048025195i, -0.0009243298189160186 + -0.00036776953140871916i, 0.03590245764321301 + 0.0459061603131463i, -0.0024140483506427785 + 0.006605472510827485i, -1.806735475927291e-05 + 0.013904564233759499i, -0.001425736444728589 + 0.0008847431098325149i, 0.1358909977546641 + 5.442186686108876e-20i, 0.00866479287988035 + 0.013922636831182222i }, { 7.824471615352168e-05 + 0.0009917246627789203i, -0.006362330633851335 + 0.004691973459293638i, 0.006992532054452962 + -0.0007512602731320896i, 0.03442895641375882 + 0.044022089190964245i, 0.0014234323938427597 + 0.0008884452714616117i, -1.7325838127867355e-05 + 0.013333895988786513i, 0.00866479287988035 + -0.013922636831182224i, 0.13031378757442713 + 1.3065483211397583e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.11802055227514063, 1.0e-7), DoubleNear(0.11317677721643915, 1.0e-7), DoubleNear(0.13529746853604824, 1.0e-7), DoubleNear(0.12974461785905306, 1.0e-7), DoubleNear(0.12126639451385932, 1.0e-7), DoubleNear(0.11628940427036753, 1.0e-7), DoubleNear(0.1358909977546641, 1.0e-7), DoubleNear(0.13031378757442713, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false, false}), Matrix({ { 0.14598221467315714 + -1.2641966737770433e-19i, 0.009308237301876184 + 0.014956526865564857i, 0.0010041965851974894 + -0.017581772103087465i, 0.001865361116259939 + -0.0010181789202952881i, 0.06579220294388285 + -0.0006970478839948575i, 0.0042665118789497174 + 0.006696257937643354i, 0.0003686268810759825 + -0.007928660994873122i, 0.0008358312547584463 + -0.0004677863007429982i }, { 0.009308237301876182 + -0.01495652686556486i, 0.13999084285853136 + 1.9058241313221156e-21i, -0.0017373003092132746 + -0.0012239477290291708i, 0.0009629825569655834 + -0.016860184654469444i, 0.004123680569986555 + -0.006785149411574224i, 0.06309197297941307 + -0.0006684397891323317i, -0.0007888218777245648 + -0.0005433212261793103i, 0.0003534977729833502 + -0.0076032545327314i }, { 0.0010041965851974896 + 0.01758177210308747i, -0.0017373003092132746 + 0.0012239477290291708i, 0.1654444316088992 + 3.4940109074239865e-20i, 0.010549203087085575 + 0.01695051751103218i, 0.0005365286637523955 + 0.00791907115399567i, -0.0007771334651799238 + 0.000559912034958476i, 0.07456355998378715 + -0.0007899776779651804i, 0.00483531938699411 + 0.007588996994465346i }, { 0.001865361116259939 + 0.0010181789202952881i, 0.0009629825569655836 + 0.016860184654469448i, 0.010549203087085575 + -0.01695051751103218i, 0.15865429551836482 + -5.653944922922455e-20i, 0.0008455546236429232 + 0.00044997254141777594i, 0.0005145085654757524 + 0.0075940582761167205i, 0.00467344593699698 + -0.0076897393993692375i, 0.07150333780065868 + -0.0007575555777487872i }, { 0.06579220294388285 + 0.0006970478839948577i, 0.004123680569986555 + 0.006785149411574223i, 0.0005365286637523954 + -0.00791907115399567i, 0.0008455546236429232 + -0.00044997254141777594i, 0.09330473211584284 + 4.552802091491862e-20i, 0.005949372599030388 + 0.009559484596800952i, 0.0006418336205083246 + -0.011237413679969464i, 0.00119224810804262 + -0.0006507704491047052i }, { 0.0042665118789497174 + -0.006696257937643354i, 0.06309197297941309 + 0.0006684397891323316i, -0.0007771334651799238 + -0.0005599120349584759i, 0.0005145085654757524 + -0.0075940582761167205i, 0.0059493725990303874 + -0.009559484596800952i, 0.08947533862827534 + 5.908054807098742e-20i, -0.001110397868115929 + -0.0007822878645631332i, 0.0006154916180102635 + -0.010776210075529018i }, { 0.00036862688107598256 + 0.007928660994873122i, -0.0007888218777245648 + 0.0005433212261793103i, 0.07456355998378715 + 0.0007899776779651804i, 0.00467344593699698 + 0.0076897393993692375i, 0.0006418336205083246 + 0.011237413679969464i, -0.0011103978681159287 + 0.0007822878645631332i, 0.10574403468181315 + -3.472835083742636e-20i, 0.0067425375774706 + 0.010833946444316924i }, { 0.0008358312547584464 + 0.0004677863007429981i, 0.0003534977729833503 + 0.007603254532731401i, 0.00483531938699411 + -0.007588996994465346i, 0.07150333780065868 + 0.0007575555777487874i, 0.00119224810804262 + 0.0006507704491047052i, 0.0006154916180102638 + 0.010776210075529018i, 0.0067425375774706 + -0.010833946444316924i, 0.10140410991511538 + 1.5415999640028266e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.14598221467315714, 1.0e-7), DoubleNear(0.13999084285853136, 1.0e-7), DoubleNear(0.1654444316088992, 1.0e-7), DoubleNear(0.15865429551836482, 1.0e-7), DoubleNear(0.09330473211584284, 1.0e-7), DoubleNear(0.08947533862827534, 1.0e-7), DoubleNear(0.10574403468181315, 1.0e-7), DoubleNear(0.10140410991511538, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false, false}), Matrix({ { 0.10275306321555995 + -2.3239549839297867e-20i, 0.0065518248099368384 + 0.01052750812106425i, 0.0007134830123978995 + -0.012403503989775699i, 0.0013162878112974075 + -0.0007177828539123693i, 0.007140368095358609 + 0.005849856601528931i, -0.00014405382746938603 + 0.0011045657927457185i, 0.0005898675489045894 + -0.0007807953622109255i, 0.00011760757275627934 + 1.064884054631736e-05i }, { 0.0065518248099368384 + -0.01052750812106425i, 0.09853589328020501 + 1.0880454392785411e-20i, -0.001225300437183014 + -0.0008639818668119255i, 0.0006842003903999674 + -0.01189444194839399i, 0.0010546338019293137 + -0.00035855911582426304i, 0.006847314587105106 + 0.00560976799867773i, -4.238433910178166e-05 + -0.00011022026480420752i, 0.0005656583271525974 + -0.000748750120695616i }, { 0.0007134830123978997 + 0.012403503989775699i, -0.001225300437183014 + 0.0008639818668119255i, 0.1164588966233473 + 1.5141806037812345e-19i, 0.007425747363210212 + 0.011931731683759807i, -0.0006139649771219304 + 0.000834844608846563i, -0.0001246816782690195 + -9.67139694835622e-06i, 0.007998048400929995 + 0.00656730313285058i, -0.00016287130131758545 + 0.0012381853651091514i }, { 0.0013162878112974075 + 0.0007177828539123693i, 0.0006842003903999674 + 0.01189444194839399i, 0.007425747363210212 + -0.011931731683759807i, 0.11167921471241218 + -2.0293859104665303e-20i, 4.6385404782729434e-05 + 0.0001161354856968976i, -0.0005887667537127875 + 0.0008005810893470515i, 0.0011828275012482478 + -0.0004006858638062916i, 0.00766979415524238 + 0.006297769238078812i }, { 0.007140368095358609 + -0.005849856601528931i, 0.001054633801929314 + 0.000358559115824263i, -0.0006139649771219302 + -0.000834844608846563i, 4.638540478272943e-05 + -0.00011613548569689762i, 0.13653388357344 + -5.765209662348785e-20i, 0.008705785090969732 + 0.013988503341301561i, 0.0009325471933079144 + -0.016415681793281234i, 0.0017413214130051517 + -0.0009511665154876239i }, { -0.00014405382746938587 + -0.001104565792745718i, 0.006847314587105106 + -0.005609767998677727i, -0.00012468167826901948 + 9.671396948356227e-06i, -0.0005887667537127872 + -0.0008005810893470516i, 0.008705785090969732 + -0.013988503341301561i, 0.13093028820660169 + 5.010591780952413e-20i, -0.0016223977401461894 + -0.0011422537267803787i, 0.0008942737845758796 + -0.015741952781604476i }, { 0.0005898675489045894 + 0.0007807953622109255i, -4.2384339101781654e-05 + 0.00011022026480420745i, 0.007998048400929995 + -0.00656730313285058i, 0.0011828275012482476 + 0.00040068586380629154i, 0.0009325471933079146 + 0.016415681793281234i, -0.0016223977401461894 + 0.0011422537267803787i, 0.154729569667365 + -1.5120630214130992e-19i, 0.009865993301345962 + 0.015852732271589298i }, { 0.00011760757275627938 + -1.064884054631738e-05i, 0.0005656583271525974 + 0.0007487501206956159i, -0.00016287130131758566 + -0.0012381853651091518i, 0.00766979415524238 + -0.006297769238078812i, 0.0017413214130051517 + 0.000951166515487624i, 0.0008942737845758799 + 0.015741952781604476i, 0.009865993301345964 + -0.015852732271589298i, 0.14837919072106803 + 1.179144062757234e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.10275306321555995, 1.0e-7), DoubleNear(0.09853589328020501, 1.0e-7), DoubleNear(0.1164588966233473, 1.0e-7), DoubleNear(0.11167921471241218, 1.0e-7), DoubleNear(0.13653388357344, 1.0e-7), DoubleNear(0.13093028820660169, 1.0e-7), DoubleNear(0.154729569667365, 1.0e-7), DoubleNear(0.14837919072106803, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false, false}), Matrix({ { 0.12531444774349615 + 4.997494388800367e-20i, 0.00862549388068476 + 0.024236164101000983i, 0.0008620251499929279 + -0.015092592384512861i, 0.002978283391239716 + -0.000872117159910946i, -0.039683233850889094 + 0.018687699953532207i, -0.026379285039878228 + 0.030434458554503625i, 0.0019777280022613137 + 0.0049079108709407255i, 0.0034839978799326107 + 0.003386417710356821i }, { 0.00862549388068476 + -0.024236164101000983i, 0.11544872440755125 + 5.230428449295301e-20i, -0.002859615627224512 + -0.0012055533018821003i, 0.0007941598575897381 + -0.01390438668621563i, 0.019763367550624283 + 0.006390037992753441i, 0.05612451267057932 + -0.002562106546271624i, 0.0009055520785252813 + -0.0023362994642643817i, 7.750033519236013e-05 + -0.006777135502641245i }, { 0.0008620251499929281 + 0.015092592384512861i, -0.002859615627224512 + 0.0012055533018821003i, 0.14202125666968718 + -1.3700757921838308e-19i, 0.009775436929977807 + 0.027467307596665862i, -0.002523681740692763 + -0.004650809353190111i, -0.003846918637318104 + -0.0029677067129768534i, -0.04497376672605447 + 0.021179127223217124i, -0.029896147482370596 + 0.034491953065295664i }, { 0.002978283391239716 + 0.000872117159910946i, 0.0007941598575897382 + 0.01390438668621563i, 0.009775436929977807 + -0.027467307596665862i, 0.13084024401427233 + -1.6093625997831706e-20i, -0.0006336517480531876 + 0.002424212287699374i, 0.0006946491228201076 + 0.006741886569742967i, 0.022398201852270084 + 0.007241952083254418i, 0.06360698197996206 + -0.002903684275638626i }, { -0.039683233850889094 + -0.018687699953532207i, 0.019763367550624286 + -0.0063900379927534405i, -0.0025236817406927635 + 0.004650809353190111i, -0.0006336517480531877 + -0.002424212287699374i, 0.1139724990455038 + -1.308665903507894e-19i, 0.00663211602022181 + 0.00027984736136482674i, 0.0007840050557128861 + -0.013726593398544071i, 7.93258330628436e-05 + -0.0007968322094890473i }, { -0.02637928503987822 + -0.030434458554503625i, 0.05612451267057932 + 0.002562106546271624i, -0.0038469186373181036 + 0.0029677067129768534i, 0.0006946491228201075 + -0.006741886569742967i, 0.00663211602022181 + -0.0002798473613648266i, 0.11401745707925545 + 8.682087709356524e-21i, 1.191744989530875e-05 + -0.0008006822917102038i, 0.0007843143173861089 + -0.013732008043782835i }, { 0.0019777280022613137 + -0.004907910870940726i, 0.0009055520785252813 + 0.0023362994642643817i, -0.04497376672605448 + -0.021179127223217117i, 0.022398201852270084 + -0.007241952083254418i, 0.0007840050557128862 + 0.013726593398544071i, 1.191744989530871e-05 + 0.0008006822917102038i, 0.12916720962102518 + 1.372193374551966e-19i, 0.007516303734578367 + 0.00031715635868324215i }, { 0.003483997879932611 + -0.003386417710356821i, 7.750033519236018e-05 + 0.006777135502641245i, -0.029896147482370596 + -0.034491953065295664i, 0.06360698197996206 + 0.0029036842756386266i, 7.932583306284366e-05 + 0.0007968322094890473i, 0.0007843143173861091 + 0.013732008043782835i, 0.007516303734578367 + -0.0003171563586832424i, 0.1292181614192079 + 1.1371417316888982e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.12531444774349615, 1.0e-7), DoubleNear(0.11544872440755125, 1.0e-7), DoubleNear(0.14202125666968718, 1.0e-7), DoubleNear(0.13084024401427233, 1.0e-7), DoubleNear(0.1139724990455038, 1.0e-7), DoubleNear(0.11401745707925545, 1.0e-7), DoubleNear(0.12916720962102518, 1.0e-7), DoubleNear(0.1292181614192079, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true, false}), Matrix({ { 0.1262616597360317 + -5.648847846807684e-20i, 0.00805079915784998 + 0.012936068343399425i, 0.0008365601991787783 + -0.015076134053918383i, 0.0015979583908891212 + -0.0008755874718113348i, -0.002671591052608273 + -0.0019592967578568i, 3.0390490479852573e-05 + -0.0003986466615084645i, -0.00018641753665441543 + 0.00021346257928222634i, -3.375669756258338e-05 + -5.4883298896957155e-06i }, { 0.00805079915784998 + -0.012936068343399425i, 0.12107965485205299 + 8.890903648501631e-20i, -0.001491275520394313 + -0.001047006094575665i, 0.0008022262687762341 + -0.014457382483075315i, -0.00037108683553701004 + 0.0001487860985931764i, -0.0025619441660430778 + -0.001878883706186134i, 9.983682852599424e-06 + 3.271028083047533e-05i, -0.00017876662673114923 + 0.00020470169232176833i }, { 0.0008365601991787784 + 0.015076134053918383i, -0.0014912755203943127 + 0.001047006094575665i, 0.1429932094616323 + -7.508826905464683e-21i, 0.009117649908283685 + 0.01465028999385021i, 0.00013057698088810696 + -0.00024882488878981033i, 3.381917221442758e-05 + -2.4875837759019866e-06i, -0.0030200335505845407 + -0.0021615223774977084i, 2.889172883517745e-05 + -0.00044724061971156267i }, { 0.0015979583908891212 + 0.0008755874718113348i, 0.0008022262687762342 + 0.014457382483075315i, 0.009117649908283686 + -0.01465028999385021i, 0.13712451177973015 + 1.3545332526243342e-19i, -1.716725982920546e-05 + -2.924396813477593e-05i, 0.00012521786748731685 + -0.0002386126692477898i, -0.00041402342465726586 + 0.0001715911062675955i, -0.0028960859591967278 + -0.0020728096238364644i }, { -0.002671591052608273 + 0.0019592967578568i, -0.00037108683553701 + -0.0001487860985931765i, 0.00013057698088810696 + 0.00024882488878981044i, -1.716725982920546e-05 + 2.924396813477594e-05i, 0.11302528705296824 + -2.4403167994708897e-20i, 0.007206810743056591 + 0.011579943118966386i, 0.0008094700065270357 + -0.013743051729138549i, 0.001459650833413438 + -0.0007933618975886584i }, { 3.0390490479852526e-05 + 0.00039864666150846444i, -0.0025619441660430778 + 0.001878883706186134i, 3.3819172214427597e-05 + 2.487583775901985e-06i, 0.00012521786748731685 + 0.00023861266924778992i, 0.00720681074305659 + -0.011579943118966386i, 0.1083865266347537 + -2.792266428270677e-20i, -0.0013564226569348905 + -0.0009592294990166391i, 0.0007762479061996128 + -0.01317901224692315i }, { -0.0001864175366544155 + -0.00021346257928222628i, 9.983682852599414e-06 + -3.271028083047533e-05i, -0.0030200335505845407 + 0.0021615223774977084i, -0.0004140234246572659 + -0.00017159110626759546i, 0.0008094700065270358 + 0.013743051729138549i, -0.001356422656934891 + 0.0009592294990166391i, 0.12819525682908 + 7.720585142278246e-21i, 0.00817409075627249 + 0.013134173961498893i }, { -3.375669756258338e-05 + 5.488329889695724e-06i, -0.00017876662673114928 + -0.00020470169232176828i, 2.8891728835177464e-05 + 0.00044724061971156267i, -0.0028960859591967278 + 0.0020728096238364644i, 0.001459650833413438 + 0.0007933618975886584i, 0.000776247906199613 + 0.013179012246923152i, 0.00817409075627249 + -0.013134173961498893i, 0.12293389365375006 + -3.783277809137533e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1262616597360317, 1.0e-7), DoubleNear(0.12107965485205299, 1.0e-7), DoubleNear(0.1429932094616323, 1.0e-7), DoubleNear(0.13712451177973015, 1.0e-7), DoubleNear(0.11302528705296824, 1.0e-7), DoubleNear(0.1083865266347537, 1.0e-7), DoubleNear(0.12819525682908, 1.0e-7), DoubleNear(0.12293389365375006, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, true}), Matrix({ { 0.13085139110835 + -2.1366406094489728e-19i, 0.008343453361384683 + 0.01340630672640724i, 0.0009001132118288643 + -0.015759449484924172i, 0.0016720194136561452 + -0.0009126463002094347i, 0.005663987982020658 + -0.0010442688035331889i, 0.00046814181288828445 + 0.0005137152272761403i, -8.680741524789146e-05 + -0.0006893414878405301i, 6.509101456653467e-05 + -5.284816103390696e-05i }, { 0.008343453361384683 + -0.01340630672640724i, 0.1254810154201444 + 5.505714157152916e-21i, -0.0015572319048761784 + -0.0010970875003228858i, 0.0008631709518460435 + -0.0151126534237095i, 0.00025416185033073154 + -0.0006468862694061181i, 0.005431527760548914 + -0.001001410139617247i, -7.616118530615499e-05 + -3.5060549834937135e-05i, -8.324468329330928e-05 + -0.0006610496772926019i }, { 0.0009001132118288643 + 0.015759449484924172i, -0.0015572319048761784 + 0.0010970875003228858i, 0.14829638032019415 + -2.0709955560367648e-19i, 0.009455795023525348 + 0.015193623423859784i, 0.00016473139253346989 + 0.0006749746532383266i, -5.86504161560624e-05 + 5.991574907056809e-05i, 0.0064191057412239065 + -0.0011834897767119702i, 0.0005305540563216532 + 0.0005822032771308922i }, { 0.0016720194136561452 + 0.0009126463002094347i, 0.0008631709518460436 + 0.0151126534237095i, 0.009455795023525348 + -0.015193623423859786i, 0.14221003099845853 + -2.2827537928503394e-19i, 7.965789156946294e-05 + 2.6160822094771313e-05i, 0.00015797052084496436 + 0.0006472724833400745i, 0.000288046478530141 + -0.0007331285622506434i, 0.0061556541331004196 + -0.0011349172344542343i }, { 0.005663987982020658 + 0.0010442688035331889i, 0.00025416185033073154 + 0.0006468862694061182i, 0.0001647313925334699 + -0.0006749746532383266i, 7.965789156946291e-05 + -2.6160822094771313e-05i, 0.10843555568064993 + 1.3277241448211155e-19i, 0.006914156539521887 + 0.011109704735958573i, 0.0007459169938769498 + -0.01305973629813276i, 0.001385589810646414 + -0.0007563030691905585i }, { 0.0004681418128882844 + -0.0005137152272761404i, 0.005431527760548915 + 0.0010014101396172471i, -5.865041615606238e-05 + -5.9915749070568084e-05i, 0.00015797052084496433 + -0.0006472724833400744i, 0.006914156539521888 + -0.011109704735958572i, 0.1039851660666623 + 5.548065804515662e-20i, -0.001290466272453025 + -0.0009091480932694183i, 0.0007153032231298035 + -0.012523741306288966i }, { -8.680741524789148e-05 + 0.0006893414878405301i, -7.616118530615499e-05 + 3.5060549834937135e-05i, 0.0064191057412239065 + 0.0011834897767119704i, 0.000288046478530141 + 0.0007331285622506434i, 0.0007459169938769499 + 0.013059736298132759i, -0.0012904662724530253 + 0.0009091480932694184i, 0.12289208597051816 + 2.0731131384049003e-19i, 0.007835945641030826 + 0.012590840531489319i }, { 6.509101456653467e-05 + 5.284816103390696e-05i, -8.324468329330925e-05 + 0.0006610496772926019i, 0.0005305540563216532 + -0.0005822032771308923i, 0.0061556541331004196 + 0.0011349172344542343i, 0.001385589810646414 + 0.0007563030691905585i, 0.0007153032231298036 + 0.012523741306288968i, 0.007835945641030826 + -0.012590840531489319i, 0.11784837443502168 + 3.2589592645609206e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.13085139110835, 1.0e-7), DoubleNear(0.1254810154201444, 1.0e-7), DoubleNear(0.14829638032019415, 1.0e-7), DoubleNear(0.14221003099845853, 1.0e-7), DoubleNear(0.10843555568064993, 1.0e-7), DoubleNear(0.1039851660666623, 1.0e-7), DoubleNear(0.12289208597051816, 1.0e-7), DoubleNear(0.11784837443502168, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false, false}), Matrix({ { 0.1545421770425558 + -3.3881317890172014e-21i, 0.009854044619622979 + 0.01583353306411294i, 0.043308159494475106 + -0.05231268112240549i, 0.008121117006981917 + 0.0011015095335591154i, 0.0696500618115565 + -0.0007379206962756133i, 0.0045166874309111 + 0.007088906563301957i, 0.019268612832062403 + -0.023783406777686616i, 0.00366533679696482 + 0.00045765802019604883i }, { 0.009854044619622979 + -0.01583353306411294i, 0.14819948902554814 + -1.207021949837378e-20i, -0.0025982164730417173 + -0.007772717404667896i, 0.0415307149837211 + -0.0501656749002707i, 0.004365480919306752 + -0.007183010368567245i, 0.06679149840258918 + -0.0007076351079182005i, -0.0012080947127783412 + -0.0034906520685383568i, 0.01847779441567223 + -0.022807293123412724i }, { 0.043308159494475106 + 0.05231268112240549i, -0.0025982164730417173 + 0.007772717404667896i, 0.15688446923950053 + -8.809142651444728e-20i, 0.010003395769338777 + 0.016073511312484096i, 0.019768186615952598 + 0.023369824054573066i, -0.001133867092215876 + 0.0035154644239167045i, 0.07070570111611349 + -0.0007491048656844245i, 0.004585143835032728 + 0.007196348368806743i }, { 0.008121117006981919 + -0.001101509533559115i, 0.0415307149837211 + 0.0501656749002707i, 0.010003395769338778 + -0.0160735113124841i, 0.15044564935134808 + -4.256340559952863e-20i, 0.0036548176403499327 + -0.0005352127749045658i, 0.018956864795809953 + 0.02241068457674818i, 0.004431645587676782 + -0.007291878442376217i, 0.06780381237748259 + -0.0007183602589629184i }, { 0.0696500618115565 + 0.0007379206962756133i, 0.004365480919306752 + 0.0071830103685672445i, 0.0197681866159526 + -0.023369824054573066i, 0.0036548176403499327 + 0.000535212774904566i, 0.09877584376863308 + -1.1180834903756764e-19i, 0.006298226092473078 + 0.010120024307769655i, 0.027680469357923898 + -0.033435721668668886i, 0.005190623039350248 + 0.00070403132451366i }, { 0.004516687430911099 + -0.007088906563301957i, 0.06679149840258918 + 0.0007076351079182005i, -0.001133867092215876 + -0.0035154644239167045i, 0.01895686479580995 + -0.02241068457674818i, 0.006298226092473079 + -0.010120024307769655i, 0.09472190604994409 + 5.209252625613947e-20i, -0.0016606536113930054 + -0.004967942957150116i, 0.026544413268502404 + -0.0320634597061014i }, { 0.0192686128320624 + 0.023783406777686616i, -0.0012080947127783414 + 0.0034906520685383568i, 0.07070570111611349 + 0.0007491048656844248i, 0.004431645587676782 + 0.007291878442376217i, 0.0276804693579239 + 0.033435721668668886i, -0.0016606536113930059 + 0.004967942957150116i, 0.10027292302902291 + 1.2260801911505993e-19i, 0.006393684084027909 + 0.010273406733348223i }, { 0.00366533679696482 + -0.00045765802019604894i, 0.018477794415672235 + 0.022807293123412724i, 0.004585143835032727 + -0.007196348368806743i, 0.06780381237748258 + 0.0007183602589629186i, 0.005190623039350249 + -0.0007040313245136598i, 0.026544413268502397 + 0.0320634597061014i, 0.006393684084027908 + -0.010273406733348221i, 0.09615754249344663 + 1.611480182151306e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1545421770425558, 1.0e-7), DoubleNear(0.14819948902554814, 1.0e-7), DoubleNear(0.15688446923950053, 1.0e-7), DoubleNear(0.15044564935134808, 1.0e-7), DoubleNear(0.09877584376863308, 1.0e-7), DoubleNear(0.09472190604994409, 1.0e-7), DoubleNear(0.10027292302902291, 1.0e-7), DoubleNear(0.09615754249344663, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false, false}), Matrix({ { 0.1089770008525092 + 1.44638879268012e-19i, 0.006948680609162187 + 0.011165178200841092i, 0.03032058836868397 + -0.037011409600939585i, 0.005725309590407105 + 0.0007465273171630412i, 0.007806183440361259 + 0.006083611721093364i, -0.0001255488163566642 + 0.0011876864197730521i, 0.004397738032319831 + -0.0005058013830804508i, 0.00033223376751469256 + 0.00041831649056360494i }, { 0.006948680609162188 + -0.011165178200841092i, 0.10450438935793768 + 2.337344129289559e-21i, -0.0018586573095095845 + -0.005466430823406147i, 0.029076177061719423 + -0.03549239499495407i, 0.0011210373153843435 + -0.0004118699728285056i, 0.0074858036766407765 + 0.005833929389047008i, 0.00022859056698344788 + -0.00048281913305154255i, 0.004217246978981992 + -0.00048504238749203735i }, { 0.03032058836868397 + 0.037011409600939585i, -0.0018586573095095843 + 0.0054664308234061475i, 0.11023495898639804 + -1.6460368729186417e-20i, 0.007028891563984862 + 0.011294061603982965i, 0.0009643105202756593 + 0.004449508483483901i, -0.0003943847690300223 + 0.00038251109677470043i, 0.007332233055927346 + 0.006333548013286151i, -0.00018137631243030723 + 0.0011550647380818182i }, { 0.005725309590407105 + -0.0007465273171630409i, 0.029076177061719423 + 0.03549239499495407i, 0.007028891563984862 + -0.011294061603982965i, 0.10571071863467954 + -1.1750748841169425e-20i, 0.0005173590803256574 + 0.00018491529737487463i, 0.0009247334876579384 + 0.004266892678013554i, 0.001116423987793218 + -0.00034737500680204913i, 0.007031305065706711 + 0.0060736078477095345i }, { 0.007806183440361259 + -0.006083611721093363i, 0.0011210373153843437 + 0.0004118699728285055i, 0.0009643105202756595 + -0.004449508483483901i, 0.0005173590803256573 + -0.0001849152973748746i, 0.14434101995867965 + -2.5983536009459677e-19i, 0.00920359010293387 + 0.014788379171041503i, 0.04066804048371503 + -0.048736993190134796i, 0.0075864304559250615 + 0.001059013540909734i }, { -0.00012554881635666435 + -0.0011876864197730521i, 0.007485803676640776 + -0.0058339293890470045i, -0.0003943847690300222 + -0.00038251109677470043i, 0.0009247334876579388 + -0.004266892678013555i, 0.00920359010293387 + -0.014788379171041501i, 0.13841700571755455 + 3.7684962628476144e-20i, -0.0024002127749251385 + -0.007274229538411864i, 0.038998951190504075 + -0.046736739611418034i }, { 0.004397738032319831 + 0.0005058013830804508i, 0.00022859056698344783 + 0.00048281913305154266i, 0.007332233055927345 + -0.006333548013286151i, 0.001116423987793218 + 0.00034737500680204913i, 0.040668040483715036 + 0.0487369931901348i, -0.0024002127749251385 + 0.007274229538411864i, 0.14692243328212534 + 5.097696132979906e-20i, 0.009368188289381824 + 0.015052856441849356i }, { 0.00033223376751469256 + -0.00041831649056360494i, 0.00421724697898199 + 0.0004850423874920369i, -0.00018137631243030723 + -0.001155064738081818i, 0.007031305065706711 + -0.006073607847709534i, 0.0075864304559250615 + -0.0010590135409097338i, 0.038998951190504075 + 0.046736739611418034i, 0.009368188289381824 + -0.015052856441849354i, 0.14089247321011517 + 1.3033536145677137e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1089770008525092, 1.0e-7), DoubleNear(0.10450438935793768, 1.0e-7), DoubleNear(0.11023495898639804, 1.0e-7), DoubleNear(0.10571071863467954, 1.0e-7), DoubleNear(0.14434101995867965, 1.0e-7), DoubleNear(0.13841700571755455, 1.0e-7), DoubleNear(0.14692243328212534, 1.0e-7), DoubleNear(0.14089247321011517, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false, false}), Matrix({ { 0.13266251380365263 + -2.270048298641525e-19i, 0.009131267157254434 + 0.025657300594563764i, 0.03717670746390811 + -0.044906393285738234i, 0.0112439244234256 + 0.004099135986234174i, -0.04201014051702094 + 0.019783491031445367i, -0.027926087763611114 + 0.03221904457782745i, -0.005075989112438027 + 0.019764505251408635i, 0.003080305656715257 + 0.01848191930623405i }, { 0.009131267157254434 + -0.025657300594563767i, 0.12221829382897907 + -6.839791049078474e-20i, -0.006126119277919709 + -0.010281022073025971i, 0.03424986928216055 + -0.04137101440365541i, 0.020922232573358086 + 0.006764730792691179i, 0.05941548696862398 + -0.002712340844823527i, 0.008153014369388022 + -0.005186480844327147i, 0.015732181407662256 + -0.020872295027556297i }, { 0.03717670746390811 + 0.044906393285738234i, -0.006126119277919709 + 0.010281022073025971i, 0.1346731906095307 + 1.3997219453377306e-19i, 0.009269663653408134 + 0.02604617110310308i, -0.01846945201843793 + -0.00867644370932976i, -0.018732051815178438 + -0.00042409783589301953i, -0.04264686005992263 + 0.02008333614530396i, -0.028349344758637707 + 0.032707367041971844i }, { 0.0112439244234256 + -0.004099135986234173i, 0.03424986928216055 + 0.04137101440365541i, 0.009269663653408134 + -0.02604617110310308i, 0.12407067459284449 + 1.0460856898590604e-19i, 0.0035732781237995596 + 0.008977912357892312i, 0.017568441572050356 + 0.01935210821307069i, 0.021239336829536284 + 0.0068672592833166814i, 0.06031600768191739 + -0.0027534499770867234i }, { -0.04201014051702094 + -0.019783491031445367i, 0.020922232573358086 + -0.00676473079269118i, -0.01846945201843793 + 0.008676443709329762i, 0.0035732781237995596 + -0.008977912357892312i, 0.12065550700753624 + 1.1180834903756762e-19i, 0.007021003554841625 + 0.0002962567773188292i, 0.033811921388490894 + -0.040842009505336146i, 0.0020678156229065655 + -0.002293595128161398i }, { -0.02792608776361111 + -0.03221904457782745i, 0.059415486968623976 + 0.0027123408448235273i, -0.018732051815178438 + 0.0004240978358930194i, 0.017568441572050356 + -0.01935210821307069i, 0.007021003554841625 + -0.00029625677731882926i, 0.12070310124651315 + 1.0842021724855044e-19i, 0.0018672491934849868 + -0.00245963828879204i, 0.03382525897006296 + -0.04085812020271669i }, { -0.005075989112438026 + -0.01976450525140864i, 0.008153014369388022 + 0.005186480844327147i, -0.04264686005992263 + -0.02008333614530396i, 0.021239336829536284 + -0.006867259283316681i, 0.033811921388490894 + 0.040842009505336146i, 0.0018672491934849868 + 0.00245963828879204i, 0.12248420165899274 + -1.0545560193316042e-19i, 0.0071274161999585525 + 0.0003007469427292397i }, { 0.003080305656715257 + -0.01848191930623405i, 0.01573218140766226 + 0.020872295027556297i, -0.02834934475863771 + -0.032707367041971844i, 0.06031600768191739 + 0.002753449977086723i, 0.0020678156229065655 + 0.002293595128161398i, 0.03382525897006296 + 0.04085812020271669i, 0.0071274161999585525 + -0.0003007469427292397i, 0.12253251725195019 + 1.3976043629695907e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.13266251380365263, 1.0e-7), DoubleNear(0.12221829382897907, 1.0e-7), DoubleNear(0.1346731906095307, 1.0e-7), DoubleNear(0.12407067459284449, 1.0e-7), DoubleNear(0.12065550700753624, 1.0e-7), DoubleNear(0.12070310124651315, 1.0e-7), DoubleNear(0.12248420165899274, 1.0e-7), DoubleNear(0.12253251725195019, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true, false}), Matrix({ { 0.13367396300475723 + -1.1158814336117578e-19i, 0.008523428497891474 + 0.013695491765099252i, 0.03785665464032612 + -0.0448255406911959i, 0.007006422876572117 + 0.00102037979464412i, -0.002302027782724883 + -0.002293379336643875i, 8.818313116534343e-05 + -0.0003820853080711501i, -0.0015271126309673185 + -6.981299205332201e-05i, -9.022035248617903e-05 + -0.0001609109509756723i }, { 0.008523428497891472 + -0.013695491765099254i, 0.12818774390547066 + 6.628877556222734e-20i, -0.0021787289600730926 + -0.006736785329013379i, 0.036302949662525306 + -0.04298582013568925i, -0.00038175068561148364 + 8.96206522020009e-05i, -0.0022075484353277827 + -0.002199254936979319i, -0.00010452565527321745 + 0.00015200800484293614i, -0.0014644371907061766 + -6.694774169512262e-05i }, { 0.037856654640326115 + 0.0448255406911959i, -0.0021787289600730926 + 0.006736785329013379i, 0.1355809061929068 + 4.7590837987634213e-20i, 0.008645020568242191 + 0.013890866572150381i, -0.0003772714295066252 + -0.0009181930678224137i, 7.001707239803289e-05 + -9.719971208152752e-05i, -0.0033895968204679296 + -0.0018274397987106338i, -2.8900911850313495e-05 + -0.00046380197314887714i }, { 0.007006422876572118 + -0.0010203797946441197i, 0.036302949662525306 + 0.04298582013568926i, 0.008645020568242191 + -0.013890866572150381i, 0.13001642272631247 + 1.5807358618522245e-19i, -0.0001181288509585681 + -1.989344181210597e-05i, -0.0003617875336480071 + -0.0008805087781351198i, -0.0004033595745827923 + 0.000230756552658771i, -0.003250481689912023 + -0.00175243839304328i }, { -0.002302027782724883 + 0.002293379336643875i, -0.0003817506856114836 + -8.962065220200094e-05i, -0.0003772714295066256 + 0.0009181930678224132i, -0.00011812885095856806 + 1.9893441812105937e-05i, 0.11964405780643163 + -3.608337465409087e-21i, 0.007628842214204586 + 0.01225806560678334i, 0.03313197421207288 + -0.040922862099878485i, 0.006305317169760048 + 0.0007851610634286553i }, { 8.818313116534349e-05 + 0.00038208530807114997i, -0.002207548435327782 + 0.002199254936979319i, 7.001707239803287e-05 + 9.719971208152752e-05i, -0.0003617875336480073 + 0.0008805087781351196i, 0.007628842214204586 + -0.01225806560678334i, 0.11473365117002157 + -2.626646880446162e-20i, -0.00208014112436163 + -0.006003875032804631i, 0.0317721785896982 + -0.03924331447068285i }, { -0.0015271126309673183 + 6.981299205332172e-05i, -0.00010452565527321743 + -0.0001520080048429362i, -0.0033895968204679305 + 0.0018274397987106338i, -0.00040335957458279237 + -0.000230756552658771i, 0.03313197421207289 + 0.040922862099878485i, -0.0020801411243616293 + 0.006003875032804631i, 0.12157648607561664 + -1.3074245387021569e-20i, 0.007752059285124496 + 0.01245605147368194i }, { -9.022035248617907e-05 + 0.00016091095097567224i, -0.0014644371907061764 + 6.694774169512243e-05i, -2.890091185031346e-05 + 0.00046380197314887714i, -0.0032504816899120233 + 0.0017524383930432796i, 0.006305317169760049 + -0.0007851610634286553i, 0.0317721785896982 + 0.03924331447068284i, 0.007752059285124496 + -0.01245605147368194i, 0.11658676911848219 + -3.948897356962049e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.13367396300475723, 1.0e-7), DoubleNear(0.12818774390547066, 1.0e-7), DoubleNear(0.1355809061929068, 1.0e-7), DoubleNear(0.13001642272631247, 1.0e-7), DoubleNear(0.11964405780643163, 1.0e-7), DoubleNear(0.11473365117002157, 1.0e-7), DoubleNear(0.12157648607561664, 1.0e-7), DoubleNear(0.11658676911848219, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, true}), Matrix({ { 0.13852412703976963 + -4.546449344387457e-19i, 0.008832688621749712 + 0.014192412632168399i, 0.03881933788223578 + -0.04689055521455216i, 0.0072793761904248145 + 0.0009873398284032406i, 0.00599610737132691 + -0.0011055016165974006i, 0.000495592254785181 + 0.0005438379584863514i, 0.001306107010376058 + -0.0023394888058641183i, 0.00032297209133578684 + -1.5355928015566846e-05i }, { 0.008832688621749712 + -0.014192412632168399i, 0.13283884851286207 + -2.3843977465208555e-19i, -0.002328915482336865 + -0.0069670876508485715i, 0.03722612265823885 + -0.04496608276074249i, 0.00026906514440281303 + -0.0006848177539763084i, 0.005750016374677277 + -0.00106012984825196i, -0.00015640996564884294 + -0.00028298886718872683i, 0.001252502037014251 + -0.00224347199091533i }, { 0.03881933788223578 + 0.04689055521455217i, -0.002328915482336865 + 0.0069670876508485715i, 0.14062364438877456 + 3.388131789017196e-20i, 0.008966559763160319 + 0.014407517518098625i, 0.0020545338108272863 + 0.0017198878496822146i, -4.520729178138535e-05 + 0.00032016101742220865i, 0.006086986351917654 + -0.0011222569636477587i, 0.0005031036144247565 + 0.0005520805459206812i }, { 0.007279376190424815 + -0.0009873398284032406i, 0.03722612265823885 + 0.04496608276074249i, 0.008966559763160319 + -0.014407517518098625i, 0.13485219790574085 + 1.5670109524204514e-20i, 0.00030721302033846635 + -0.0001008312275118583i, 0.001970212059756813 + 0.0016493005688276647i, 0.00027314318445805945 + -0.0006951970776804532i, 0.005837165518972056 + -0.0010761975258195215i }, { 0.00599610737132691 + 0.0011055016165974006i, 0.00026906514440281314 + 0.0006848177539763084i, 0.0020545338108272863 + -0.0017198878496822144i, 0.00030721302033846635 + 0.00010083122751185827i, 0.11479389377141921 + 3.3944845361216086e-19i, 0.007319582090346346 + 0.011761144739714196i, 0.032169290970163224 + -0.03885784757652222i, 0.006032363855907351 + 0.0008182010296695346i }, { 0.0004955922547851811 + -0.0005438379584863514i, 0.005750016374677277 + 0.00106012984825196i, -4.5207291781385385e-05 + -0.0003201610174222086i, 0.001970212059756813 + -0.0016493005688276647i, 0.007319582090346346 + -0.011761144739714196i, 0.11008254656263017 + 2.7846208140985124e-19i, -0.0019299546020978575 + -0.005773572710969439i, 0.03084900559398465 + -0.03726305184562961i }, { 0.0013061070103760584 + 0.0023394888058641183i, -0.0001564099656488429 + 0.00028298886718872683i, 0.006086986351917655 + 0.0011222569636477587i, 0.0002731431844580594 + 0.0006951970776804532i, 0.032169290970163224 + 0.03885784757652222i, -0.0019299546020978573 + 0.005773572710969439i, 0.11653374787974888 + 6.352747104406846e-22i, 0.007430520090206368 + 0.011939400527733696i }, { 0.00032297209133578684 + 1.535592801556686e-05i, 0.001252502037014251 + 0.00224347199091533i, 0.0005031036144247565 + -0.0005520805459206812i, 0.005837165518972056 + 0.0010761975258195215i, 0.006032363855907352 + -0.0008182010296695344i, 0.03084900559398465 + 0.03726305184562961i, 0.007430520090206368 + -0.011939400527733696i, 0.11175099393905383 + 1.0291450309139744e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.13852412703976963, 1.0e-7), DoubleNear(0.13283884851286207, 1.0e-7), DoubleNear(0.14062364438877456, 1.0e-7), DoubleNear(0.13485219790574085, 1.0e-7), DoubleNear(0.11479389377141921, 1.0e-7), DoubleNear(0.11008254656263017, 1.0e-7), DoubleNear(0.11653374787974888, 1.0e-7), DoubleNear(0.11175099393905383, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false, false}), Matrix({ { 0.13373503155750888 + 7.914955942223579e-20i, 0.00852732240087114 + 0.013701748509812407i, 0.06027256372728597 + -0.0006385690268630245i, 0.003908572712431552 + 0.0061344751387212675i, 0.009235520768801322 + 0.007575358799548202i, -0.00018724636107574652 + 0.0014292463798843491i, 0.004198495316072557 + 0.0033700128772849837i, -7.756491055396666e-05 + 0.000645036025605996i }, { 0.00852732240087114 + -0.013701748509812407i, 0.1282463060953305 + -1.299657011933397e-19i, 0.0037777242412369233 + -0.006215909059270797i, 0.05779886965215904 + -0.0006123610091410984i, 0.0013650120103348813 + -0.0004631939397165629i, 0.00885647843853202 + 0.007264452492921i, 0.0006129806911724128 + -0.00021527299396026213i, 0.004026181541022116 + 0.003231701506868409i }, { 0.06027256372728597 + 0.0006385690268630245i, 0.0037777242412369233 + 0.006215909059270797i, 0.08547692828139838 + 4.9028951116589775e-20i, 0.005450249772275909 + 0.00875749129501165i, 0.004126152423706534 + 0.003458209925451391i, -9.121387686176281e-05 + 0.0006432478669585085i, 0.005902895727487281 + 0.004841800934831313i, -0.0001196787677112249 + 0.0009135047779705211i }, { 0.003908572712431552 + -0.0061344751387212675i, 0.057798869652159024 + 0.0006123610091410984i, 0.005450249772275909 + -0.00875749129501165i, 0.0819688018972867 + 1.2055229648145982e-19i, 0.0006174040842039754 + -0.00020223745075300526i, 0.003956807730658862 + 0.003316278790053852i, 0.00087244929284268 + -0.00029605103991399174i, 0.005660630303815467 + 0.0046430847438355405i }, { 0.009235520768801322 + -0.007575358799548201i, 0.0013650120103348815 + 0.00046319393971656285i, 0.004126152423706534 + -0.003458209925451391i, 0.0006174040842039756 + 0.00020223745075300528i, 0.17769161472454742 + -1.7062911772570026e-19i, 0.011330117988090617 + 0.018205295866784627i, 0.08008319920038404 + -0.0008484565350970134i, 0.005193258553512273 + 0.008150779793387432i }, { -0.0001872463610757463 + -0.0014292463798843491i, 0.00885647843853202 + -0.007264452492920998i, -9.121387686176281e-05 + -0.0006432478669585085i, 0.003956807730658862 + -0.0033162787900538515i, 0.011330117988090617 + -0.018205295866784633i, 0.1703988322815657 + 7.533207609543729e-20i, 0.005019402265746611 + -0.008258979751672665i, 0.07679644112791272 + -0.0008136343577400205i }, { 0.004198495316072557 + -0.003370012877284984i, 0.0006129806911724129 + 0.0002152729939602621i, 0.0059028957274872805 + -0.004841800934831315i, 0.00087244929284268 + 0.0002960510399139918i, 0.08008319920038404 + 0.0008484565350970136i, 0.005019402265746611 + 0.008258979751672665i, 0.1135718385162576 + -3.82292810390975e-20i, 0.0072416604042250775 + 0.011635939746106229i }, { -7.756491055396666e-05 + -0.0006450360256059961i, 0.004026181541022116 + -0.003231701506868409i, -0.0001196787677112249 + -0.0009135047779705211i, 0.005660630303815467 + -0.0046430847438355405i, 0.005193258553512273 + -0.008150779793387432i, 0.07679644112791273 + 0.0008136343577400208i, 0.0072416604042250775 + -0.011635939746106227i, 0.10891064664610403 + 9.268824798981024e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13373503155750888, 1.0e-7), DoubleNear(0.1282463060953305, 1.0e-7), DoubleNear(0.08547692828139838, 1.0e-7), DoubleNear(0.0819688018972867, 1.0e-7), DoubleNear(0.17769161472454742, 1.0e-7), DoubleNear(0.1703988322815657, 1.0e-7), DoubleNear(0.1135718385162576, 1.0e-7), DoubleNear(0.10891064664610403, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false, false}), Matrix({ { 0.16309397029440909 + 1.1223186551119455e-20i, 0.011225888699046827 + 0.03154282925165928i, 0.07350423896882029 + -0.0007787545019820969i, 0.005209968978762594 + 0.01416232276112973i, -0.051646847425849976 + 0.024321626404409512i, -0.034332053551302824 + 0.03960977180839274i, -0.023160400303575204 + 0.01120803455202177i, -0.015283858599476867 + 0.018015518099571533i }, { 0.011225888699046827 + -0.031542829251659285i, 0.1502539505069144 + -6.352747104407251e-20i, 0.004908742388464494 + -0.014269527354252966i, 0.06771741630995255 + -0.0007174449195554714i, 0.025721583889646075 + 0.008316492514123253i, 0.07304480662133966 + -0.003334524761295312i, 0.011632079048922455 + 0.003625312774108224i, 0.03290438104774222 + -0.0018516054049046054i }, { 0.07350423896882027 + 0.0007787545019820969i, 0.004908742388464494 + 0.014269527354252966i, 0.10424173411877423 + -9.825582188149891e-20i, 0.0071750421116157405 + 0.020160642446007567i, -0.02339266610743993 + 0.01071481932311466i, -0.01566212259124293 + 0.01768765507413773i, -0.033010153151093596 + 0.015545200772339817i, -0.021943378970945997 + 0.025316639811406555i }, { 0.005209968978762594 + -0.01416232276112973i, 0.06771741630995254 + 0.0007174449195554715i, 0.0071750421116157405 + -0.020160642446007564i, 0.09603501791490915 + 9.973812953919383e-20i, 0.011552658504136122 + 0.0038709478422350647i, 0.03293622497385601 + -0.0011540447053876844i, 0.016439985513248295 + 0.005315497561884608i, 0.046686688029201714 + -0.002131266060614939i }, { -0.051646847425849976 + -0.024321626404409512i, 0.025721583889646075 + -0.008316492514123253i, -0.02339266610743993 + -0.01071481932311466i, 0.011552658504136122 + -0.003870947842235065i, 0.14833267598764724 + -1.0270274485458396e-19i, 0.008631551689914928 + 0.00036421512493775945i, 0.06685152395884972 + -0.0007082710599779409i, 0.003891862287181232 + 0.00012293217097897023i }, { -0.034332053551302824 + -0.03960977180839274i, 0.07304480662133966 + 0.0033345247612953117i, -0.015662122591242927 + -0.01768765507413773i, 0.03293622497385601 + 0.0011540447053876844i, 0.008631551689914928 + -0.00036421512493775945i, 0.14839118786998176 + 8.893845946170105e-21i, 0.00388838411851904 + -0.00020536145669049544i, 0.0668778944701192 + -0.0007085504473256475i }, { -0.023160400303575204 + -0.01120803455202177i, 0.011632079048922453 + -0.003625312774108224i, -0.033010153151093596 + -0.015545200772339816i, 0.016439985513248295 + -0.005315497561884609i, 0.06685152395884972 + 0.000708271059977941i, 0.00388838411851904 + 0.00020536145669049544i, 0.09480703267888174 + 1.0905549195899114e-19i, 0.005516868064885247 + 0.00023278859511030944i }, { -0.015283858599476867 + -0.018015518099571533i, 0.03290438104774222 + 0.0018516054049046054i, -0.021943378970946 + -0.025316639811406555i, 0.046686688029201714 + 0.0021312660606149386i, 0.003891862287181232 + -0.00012293217097897026i, 0.0668778944701192 + 0.0007085504473256476i, 0.005516868064885248 + -0.0002327885951103095i, 0.09484443062848157 + 1.1350241493207625e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.16309397029440909, 1.0e-7), DoubleNear(0.1502539505069144, 1.0e-7), DoubleNear(0.10424173411877423, 1.0e-7), DoubleNear(0.09603501791490915, 1.0e-7), DoubleNear(0.14833267598764724, 1.0e-7), DoubleNear(0.14839118786998176, 1.0e-7), DoubleNear(0.09480703267888174, 1.0e-7), DoubleNear(0.09484443062848157, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true, false}), Matrix({ { 0.16426479857953183 + -7.924826520574702e-20i, 0.010473986361602499 + 0.01682965886304727i, 0.07403191538693535 + -0.0007843450691651841i, 0.004800843143817051 + 0.007534886793067916i, -0.003472299579278645 + -0.0025139954841624894i, 3.6166409336063796e-05 + -0.0005160519632742116i, -0.001576922328174522 + -0.0011164438242329236i, 1.3835622498810822e-05 + -0.00023275030655274195i }, { 0.010473986361602499 + -0.01682965886304727i, 0.1575230767434296 + 8.073085898711983e-20i, 0.004640123865443211 + -0.007634910895958698i, 0.07099351285122149 + -0.0007521541413123743i, -0.00047897361759077686 + 0.00019545309313345814i, -0.0033297901792273764 + -0.0024108166022717677i, -0.0002149336435164978 + 9.037509908734834e-05i, -0.0015122026086386042 + -0.0010706229680683668i }, { 0.07403191538693535 + 0.0007843450691651842i, 0.004640123865443211 + 0.007634910895958698i, 0.10499007061813218 + 1.525095983220546e-20i, 0.006694462704531164 + 0.010756699474202363i, -0.001552914263404008 + -0.0011496034674093392i, 1.8763797206079853e-05 + -0.0002324049258615964i, -0.0022193250239141687 + -0.00160682365119202i, 2.311580997896618e-05 + -0.00032983531794581557i }, { 0.004800843143817051 + -0.007534886793067916i, 0.07099351285122149 + 0.0007521541413123744i, 0.006694462704531164 + -0.010756699474202363i, 0.10068108988835352 + 1.4363150276032993e-19i, -0.0002168001745222639 + 8.580101384856055e-05i, -0.0014891798778891687 + -0.0011024216800385052i, -0.0003061366426034991 + 0.00012492411172731381i, -0.0021282399460124286 + -0.001540876727750831i }, { -0.003472299579278645 + 0.0025139954841624894i, -0.0004789736175907769 + -0.00019545309313345814i, -0.001552914263404008 + 0.0011496034674093394i, -0.0002168001745222639 + -8.580101384856058e-05i, 0.14716184770252447 + -1.2231293097717479e-20i, 0.009383454027359257 + 0.015077385513549766i, 0.06632384754073466 + -0.0007026804927948538i, 0.004300988122126776 + 0.006750368139040784i }, { 3.6166409336063735e-05 + 0.0005160519632742115i, -0.003329790179227376 + 0.0024108166022717677i, 1.8763797206079782e-05 + 0.00023240492586159634i, -0.0014891798778891687 + 0.0011024216800385048i, 0.009383454027359257 + -0.015077385513549767i, 0.14112206163346655 + -1.3536448408502226e-19i, 0.004157002641540323 + -0.006839977914984764i, 0.06360179792885026 + -0.0006738412255687446i }, { -0.001576922328174522 + 0.0011164438242329232i, -0.0002149336435164978 + -9.037509908734837e-05i, -0.0022193250239141687 + 0.0016068236511920199i, -0.0003061366426034991 + -0.00012492411172731381i, 0.06632384754073466 + 0.0007026804927948538i, 0.0041570026415403225 + 0.006839977914984764i, 0.09405869617952381 + -4.4512897547131905e-21i, 0.005997447471969822 + 0.009636731566915515i }, { 1.3835622498810767e-05 + 0.000232750306552742i, -0.0015122026086386042 + 0.001070622968068367i, 2.311580997896616e-05 + 0.00032983531794581557i, -0.0021282399460124286 + 0.001540876727750831i, 0.004300988122126776 + -0.006750368139040784i, 0.06360179792885025 + 0.0006738412255687447i, 0.005997447471969822 + -0.009636731566915514i, 0.0901983586550372 + 6.960904171094011e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.16426479857953183, 1.0e-7), DoubleNear(0.1575230767434296, 1.0e-7), DoubleNear(0.10499007061813218, 1.0e-7), DoubleNear(0.10068108988835352, 1.0e-7), DoubleNear(0.14716184770252447, 1.0e-7), DoubleNear(0.14112206163346655, 1.0e-7), DoubleNear(0.09405869617952381, 1.0e-7), DoubleNear(0.0901983586550372, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, true}), Matrix({ { 0.17030017909898143 + -2.426749393883571e-19i, 0.010858819227770048 + 0.0174480104278948i, 0.07675197947740156 + -0.0008131633004107176i, 0.004977234649712929 + 0.007811731919719456i, 0.007371554551941204 + -0.00135909265283946i, 0.0006092761712604309 + 0.000668588957824369i, 0.003315770085548711 + -0.000647722918501002i, 0.000277784935086401 + 0.0002984147475143407i }, { 0.010858819227770048 + -0.017448010427894803i, 0.1633107544258197 + -1.9651164376299773e-19i, 0.004810610259530682 + -0.007915431085845226i, 0.07360194063474387 + -0.000779789620680781i, 0.0003307860028451009 + -0.0008419081112046652i, 0.007069012737026555 + -0.0013033130537155636i, 0.00014506075010685003 + -0.0003810160239063991i, 0.003179684936554265 + -0.0006211392086546846i }, { 0.07675197947740156 + 0.0008131633004107173i, 0.0048106102595306816 + 0.007915431085845226i, 0.10884759232956275 + -1.780886771602167e-19i, 0.006940429157139981 + 0.011151919722372224i, 0.00332874910028603 + -0.0005773263086990808i, 0.000271400068007117 + 0.00030423319145145213i, 0.00471153917130336 + -0.0008686659274056993i, 0.0003894196979495067 + 0.00042732954658266373i }, { 0.004977234649712929 + -0.007811731919719456i, 0.07360194063474387 + 0.0007797896206807808i, 0.006940429157139981 + -0.011151919722372223i, 0.1043802919927832 + -2.625802136488333e-20i, 0.00015310077428030473 + -0.0003778570954868716i, 0.0031921312692573182 + -0.0005536318019297049i, 0.00021142232601577157 + -0.0005381067204520964i, 0.004518169156622778 + -0.0008330143203559177i }, { 0.007371554551941205 + 0.0013590926528394597i, 0.0003307860028451009 + 0.0008419081112046652i, 0.00332874910028603 + 0.0005773263086990806i, 0.00015310077428030473 + 0.00037785709548687166i, 0.14112646718307487 + 1.511953810848926e-19i, 0.008998621161191708 + 0.014459033948702236i, 0.06360378345026844 + -0.0006738622615493203i, 0.004124596616230897 + 0.006473523012389245i }, { 0.0006092761712604309 + -0.000668588957824369i, 0.007069012737026555 + 0.0013033130537155636i, 0.00027140006800711707 + -0.00030423319145145213i, 0.003192131269257318 + 0.0005536318019297048i, 0.008998621161191708 + -0.014459033948702238i, 0.13533438395107647 + 1.4187801866509528e-19i, 0.003986516247452852 + -0.006559457725098236i, 0.06099337014532788 + -0.0006462057462003379i }, { 0.003315770085548711 + 0.0006477229185010021i, 0.00014506075010685003 + 0.0003810160239063991i, 0.004711539171303359 + 0.0008686659274056992i, 0.00021142232601577157 + 0.0005381067204520964i, 0.06360378345026846 + 0.0006738622615493207i, 0.003986516247452852 + 0.006559457725098236i, 0.09020117446809323 + 1.8888834723770898e-19i, 0.005751481019361005 + 0.009241511318745654i }, { 0.000277784935086401 + -0.00029841474751434057i, 0.003179684936554265 + 0.0006211392086546846i, 0.00038941969794950657 + -0.0004273295465826636i, 0.004518169156622779 + 0.0008330143203559176i, 0.004124596616230898 + -0.006473523012389245i, 0.06099337014532788 + 0.0006462057462003382i, 0.005751481019361005 + -0.009241511318745654i, 0.0864991565506075 + 2.3949856583615337e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.17030017909898143, 1.0e-7), DoubleNear(0.1633107544258197, 1.0e-7), DoubleNear(0.10884759232956275, 1.0e-7), DoubleNear(0.1043802919927832, 1.0e-7), DoubleNear(0.14112646718307487, 1.0e-7), DoubleNear(0.13533438395107647, 1.0e-7), DoubleNear(0.09020117446809323, 1.0e-7), DoubleNear(0.0864991565506075, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false, false}), Matrix({ { 0.11480118767282853 + 8.701154228943576e-20i, 0.00790185776339359 + 0.0222028702478393i, 0.007927980729413722 + 0.006502859999415889i, -0.0007119820133314557 + 0.0019808906758114753i, -0.03635400752916858 + 0.01711989469825761i, -0.024166193978980142 + 0.027881158566713048i, -0.0034802963075118622 + -0.0008769841859950097i, -0.0032481927975535796 + 0.0005565439954217166i }, { 0.007901857763393588 + -0.0222028702478393i, 0.1057631495486347 + 1.6908644847725134e-20i, 0.0018033605494714566 + -0.001085696543899059i, 0.007303828719031041 + 0.005990904524194559i, 0.01810531912386026 + 0.0058539455270485i, 0.051415944674867875 + -0.0023471585260333785i, 0.0009187294578156167 + 0.0014298312253048162i, 0.0036836540669193387 + 0.002750341427607352i }, { 0.007927980729413722 + -0.006502859999415891i, 0.0018033605494714566 + 0.0010856965438990592i, 0.1525345167403548 + -1.740441776198152e-19i, 0.010499073047268978 + 0.029500601449827545i, -0.0015407993269617028 + 0.003241527585043878i, -8.956222140384822e-05 + 0.0032943096814683523i, -0.048302993047774995 + 0.022746932478491716i, -0.03210923854326868 + 0.037045253053086244i }, { -0.0007119820133314556 + -0.0019808906758114757i, 0.007303828719031041 + -0.005990904524194559i, 0.010499073047268978 + -0.029500601449827545i, 0.14052581887318888 + 1.930201364739617e-20i, 0.0015819175132404677 + -0.0006213035738010398i, 0.0034177466560181714 + -0.0030745232229438843i, 0.02405625027903411 + 0.00777804454895936i, 0.06831554997567349 + -0.003118632295876872i }, { -0.03635400752916858 + -0.01711989469825761i, 0.01810531912386026 + -0.0058539455270485i, -0.0015407993269617028 + -0.003241527585043878i, 0.0015819175132404677 + 0.0006213035738010398i, 0.10441077216607872 + 4.116696824938982e-20i, 0.006075714409753461 + 0.00025636955698475476i, 0.0072104357668748825 + 0.005914299734963625i, 0.0004050568845444842 + 0.0003618604820433948i }, { -0.024166193978980142 + -0.027881158566713048i, 0.051415944674867875 + 0.002347158526033379i, -8.956222140384812e-05 + -0.0032943096814683527i, 0.0034177466560181705 + 0.003074523222943883i, 0.0060757144097534615 + -0.00025636955698475476i, 0.1044519584439825 + -2.6322049559605032e-20i, 0.00043410075370610467 + 0.0003264515642685044i, 0.007213280023316445 + 0.005916632712561981i }, { -0.003480296307511862 + 0.0008769841859950103i, 0.0009187294578156167 + -0.001429831225304816i, -0.04830299304777499 + -0.022746932478491716i, 0.02405625027903411 + -0.00777804454895936i, 0.0072104357668748825 + -0.005914299734963625i, 0.00043410075370610467 + -0.00032645156426850454i, 0.13872893650045026 + -3.481422114498259e-20i, 0.008072705345046716 + 0.0003406341630633142i }, { -0.003248192797553579 + -0.0005565439954217166i, 0.0036836540669193387 + -0.002750341427607353i, -0.03210923854326868 + -0.037045253053086244i, 0.06831554997567349 + 0.003118632295876872i, 0.00040505688454448425 + -0.0003618604820433949i, 0.007213280023316444 + -0.005916632712561979i, 0.008072705345046716 + -0.0003406341630633142i, 0.13878366005448084 + 1.4871831043785138e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.11480118767282853, 1.0e-7), DoubleNear(0.1057631495486347, 1.0e-7), DoubleNear(0.1525345167403548, 1.0e-7), DoubleNear(0.14052581887318888, 1.0e-7), DoubleNear(0.10441077216607872, 1.0e-7), DoubleNear(0.1044519584439825, 1.0e-7), DoubleNear(0.13872893650045026, 1.0e-7), DoubleNear(0.13878366005448084, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true, false}), Matrix({ { 0.11115136158649863 + 6.785146923913543e-20i, 0.007087323975665223 + 0.011387951124283539i, 0.017662510312992614 + 0.032055489580368746i, -0.002158015991624603 + 0.003853551030932006i, -0.0019613722190194465 + -0.009162769365193581i, 0.0008137038363714736 + -0.0007851952933948538i, 0.003292375760433827 + 0.0026279066872268234i, -5.930956810065753e-05 + 0.0005048812674158595i }, { 0.007087323975665222 + -0.011387951124283539i, 0.10658951042909817 + -9.35279273062269e-21i, 0.0044104388324242814 + 0.00023434562839655062i, 0.016937609223488463 + 0.03073987481725633i, -0.0010638290737891454 + -0.000383292686932602i, -0.0018808739867016712 + -0.008786712882960806i, 0.0004791718771316258 + -0.00016975579878721492i, 0.003157250756484648 + 0.002520052685336466i }, { 0.017662510312992617 + -0.032055489580368746i, 0.0044104388324242814 + -0.00023434562839655062i, 0.1581035076111654 + -1.3184877461267696e-19i, 0.010081125090468442 + 0.016198407212966094i, -0.00700362664018459 + 0.002264904892772906i, -0.0006786205418179846 + -0.0005731359671417599i, -0.003730252384173367 + 0.005041950229839072i, -0.0007544216170564436 + -6.069198782517335e-05i }, { -0.0021580159916246033 + -0.0038535510309320063i, 0.016937609223488463 + -0.030739874817256325i, 0.010081125090468442 + -0.016198407212966094i, 0.151614656202685 + 2.337151544780725e-19i, -0.00021452139175986258 + 0.000861969401479117i, -0.00671618524640856 + 0.002171949135335265i, 0.0002787188135948695 + 0.0007036698917933739i, -0.0035771561385381343 + 0.004835019552938207i }, { -0.0019613722190194465 + 0.009162769365193581i, -0.0010638290737891454 + 0.0003832926869326021i, -0.007003626640184591 + -0.0022649048927729063i, -0.00021452139175986252 + -0.0008619694014791169i, 0.1080605982524086 + 6.032704129969016e-20i, 0.006890248197481828 + 0.011071288680540518i, -0.002524093816704011 + -0.019638329845989226i, 0.0018510908628376318 + -0.0015107998730771355i }, { 0.0008137038363714736 + 0.000785195293394854i, -0.001880873986701671 + 0.008786712882960807i, -0.0006786205418179846 + 0.0005731359671417599i, -0.006716185246408558 + -0.0021719491353352654i, 0.006890248197481828 + -0.011071288680540518i, 0.10362559756351902 + -6.06119812572084e-23i, -0.0021729775292467206 + -0.0009935906080271052i, -0.002420500481140975 + -0.018832337580499785i }, { 0.003292375760433827 + -0.002627906687226824i, 0.00047917187713162555 + 0.00016975579878721492i, -0.003730252384173367 + -0.005041950229839072i, 0.00027871881359486944 + -0.000703669891793374i, -0.002524093816704011 + 0.019638329845989226i, -0.0021729775292467206 + 0.0009935906080271052i, 0.13315994562963965 + -7.700962415212081e-20i, 0.008490653301847253 + 0.013642828399924763i }, { -5.930956810065761e-05 + -0.0005048812674158595i, 0.003157250756484648 + -0.0025200526853364656i, -0.0007544216170564437 + 6.0691987825173214e-05i, -0.003577156138538134 + -0.004835019552938207i, 0.001851090862837632 + 0.0015107998730771355i, -0.002420500481140975 + 0.018832337580499785i, 0.008490653301847253 + -0.013642828399924763i, 0.12769482272498472 + -6.569483039282492e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.11115136158649863, 1.0e-7), DoubleNear(0.10658951042909817, 1.0e-7), DoubleNear(0.1581035076111654, 1.0e-7), DoubleNear(0.151614656202685, 1.0e-7), DoubleNear(0.1080605982524086, 1.0e-7), DoubleNear(0.10362559756351902, 1.0e-7), DoubleNear(0.13315994562963965, 1.0e-7), DoubleNear(0.12769482272498472, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, true}), Matrix({ { 0.11987360897626442 + -1.219348952431043e-19i, 0.007643479043536918 + 0.012281584144615589i, 0.008278273780908216 + 0.006790184950167297i, -0.00016783857459345074 + 0.0012811072736713936i, 0.005188807507906415 + -0.0009566598349511994i, 0.00042886703877027945 + 0.000470617069929822i, 0.00041252004325979656 + 0.00022785224248971197i, 2.9589650303152152e-06 + 5.679301325178817e-05i }, { 0.007643479043536917 + -0.012281584144615589i, 0.11495378114829324 + -1.4202791716737328e-19i, 0.0012235306940083556 + -0.0004151846271175542i, 0.00793851858322379 + 0.0065115035860188394i, 0.00023283893281655563 + -0.0005926157227223785i, 0.004975849545020368 + -0.0009173968001757373i, 4.9647915376856394e-05 + -2.773601137512246e-05i, 0.00039558948109721687 + 0.00021850077795268865i }, { 0.008278273780908217 + -0.006790184950167295i, 0.0012235306940083556 + 0.00041518462711755415i, 0.15927416245227977 + -2.9882872130546944e-19i, 0.010155769341373112 + 0.016318346005651435i, 0.000304140938481173 + -0.00035998294409380884i, 5.627473607983863e-05 + 8.207064482074019e-06i, 0.0068942862153381496 + -0.0012710987452939598i, 0.0005698288304396581 + 0.0006253014344772107i }, { -0.00016783857459345096 + -0.0012811072736713936i, 0.00793851858322379 + -0.006511503586018836i, 0.010155769341373112 + -0.016318346005651435i, 0.15273726527030967 + -8.074174796050776e-20i, -1.7488969814591765e-05 + -5.4114117964656093e-05i, 0.0002916584490863536 + -0.00034520859867222074i, 0.0003093693960443169 + -0.0007873991089343831i, 0.006611332348628965 + -0.001218930573895744i }, { 0.005188807507906415 + 0.0009566598349511993i, 0.00023283893281655558 + 0.0005926157227223784i, 0.000304140938481173 + 0.0003599829440938088i, -1.748896981459178e-05 + 5.411411796465609e-05i, 0.09933835086264282 + 2.5011340578192986e-19i, 0.006334093129610132 + 0.010177655660208468i, 0.0068601427153803865 + 0.005626974784212219i, -0.00013908655419352046 + 0.0010616438841834766i }, { 0.0004288670387702795 + -0.000470617069929822i, 0.004975849545020368 + 0.0009173968001757372i, 5.627473607983863e-05 + -8.207064482074033e-06i, 0.00029165844908635364 + 0.0003452085986722207i, 0.006334093129610132 + -0.010177655660208468i, 0.09526132684432395 + 1.3261451245549337e-19i, 0.0010139306091692054 + -0.00034406035251300043i, 0.006578590159123697 + 0.005396033650737705i }, { 0.00041252004325979656 + -0.00022785224248971197i, 4.9647915376856394e-05 + 2.7736011375122442e-05i, 0.0068942862153381496 + 0.0012710987452939598i, 0.0003093693960443169 + 0.0007873991089343831i, 0.0068601427153803865 + -0.005626974784212219i, 0.0010139306091692054 + 0.0003440603525130005i, 0.13198929078852528 + 8.997032254067169e-20i, 0.008416009050942582 + 0.013522889607239422i }, { 2.958965030315222e-06 + -5.67930132517882e-05i, 0.0003955894810972169 + -0.00021850077795268865i, 0.0005698288304396581 + -0.0006253014344772106i, 0.006611332348628965 + 0.0012189305738957439i, -0.00013908655419352036 + -0.001061643884183477i, 0.006578590159123696 + -0.005396033650737703i, 0.008416009050942582 + -0.013522889607239422i, 0.12657221365736004 + 2.487620720457553e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.11987360897626442, 1.0e-7), DoubleNear(0.11495378114829324, 1.0e-7), DoubleNear(0.15927416245227977, 1.0e-7), DoubleNear(0.15273726527030967, 1.0e-7), DoubleNear(0.09933835086264282, 1.0e-7), DoubleNear(0.09526132684432395, 1.0e-7), DoubleNear(0.13198929078852528, 1.0e-7), DoubleNear(0.12657221365736004, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true, false}), Matrix({ { 0.14100863289256388 + -4.5659099290221476e-20i, 0.009705737223756453 + 0.027271463330686484i, -0.04465309990052764 + 0.02102811822422742i, -0.0296829853790705 + 0.034246022472845174i, -0.002980700800789317 + -0.0021580708063157934i, 0.00021221289456202285 + -0.0007250176010338891i, 0.0012657217861169866 + 0.00023889333429996456i, 0.0011515709094493181 + -0.0002696229417865159i }, { 0.009705737223756453 + -0.027271463330686484i, 0.12990734181920432 + 5.332928591870766e-20i, 0.022238500746307004 + 0.0071903163419277044i, 0.06315345872679322 + -0.0028829807569702246i, -0.000622540945003354 + 0.0004279341143466584i, -0.002746036961325179 + -0.0019881707676700413i, -0.00036004253183465106 + -0.0004923417771736348i, -0.0013790874900157285 + -0.0009055923025825932i }, { -0.04465309990052764 + -0.02102811822422742i, 0.022238500746307004 + -0.0071903163419277044i, 0.12824623630510015 + -1.8338206083320057e-20i, 0.00746271184237721 + 0.00031489500656314785i, 0.0006220708674382988 + 0.0011278960505776642i, -0.0005801313514675922 + -0.00018835781195581937i, -0.0027109238024034966 + -0.0019627483290387154i, -0.00015293067524699288 + -0.00012086968018613804i }, { -0.0296829853790705 + -0.03424602247284518i, 0.06315345872679322 + 0.0028829807569702246i, 0.007462711842377212 + -0.0003148950065631479i, 0.1282968248125788 + 1.7103307582874214e-19i, 0.00010333237518324751 + 0.0011781912028472003i, -0.0012908421609297 + -0.001027475663546864i, -0.00016256931519092194 + -0.00010755690948588643i, -0.002711993163914626 + -0.0019635225623525574i }, { -0.002980700800789317 + 0.0021580708063157934i, -0.0006225409450033541 + -0.0004279341143466584i, 0.0006220708674382987 + -0.001127896050577664i, 0.00010333237518324773 + -0.0011781912028472003i, 0.12632707152061945 + -4.1373536040157944e-20i, 0.008695193586906114 + 0.02443200836698036i, -0.04000390067641593 + 0.01883870895252191i, -0.02659244714317832 + 0.03068038914695411i }, { 0.00021221289456202274 + 0.0007250176010338891i, -0.002746036961325179 + 0.0019881707676700413i, -0.0005801313514675922 + 0.00018835781195581942i, -0.0012908421609297 + 0.0010274756635468636i, 0.008695193586906114 + -0.02443200836698036i, 0.11638162660261925 + -1.7118627423586363e-20i, 0.01992306865658737 + 0.006441673734080156i, 0.05657803592374816 + -0.002582810064940026i }, { 0.0012657217861169866 + -0.00023889333429996489i, -0.00036004253183465106 + 0.0004923417771736348i, -0.0027109238024034966 + 0.001962748329038715i, -0.00016256931519092194 + 0.00010755690948588642i, -0.040003900676415925 + -0.018838708952521904i, 0.01992306865658737 + -0.006441673734080156i, 0.11489347236142883 + 2.4690953187727262e-20i, 0.006685707912422966 + 0.00028210871348492104i }, { 0.0011515709094493181 + 0.00026962294178651587i, -0.001379087490015729 + 0.000905592302582593i, -0.00015293067524699283 + 0.00012086968018613806i, -0.002711993163914626 + 0.0019635225623525574i, -0.02659244714317832 + -0.03068038914695411i, 0.05657803592374816 + 0.0025828100649400256i, 0.006685707912422966 + -0.00028210871348492104i, 0.11493879368588451 + -4.8636814950495785e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.14100863289256388, 1.0e-7), DoubleNear(0.12990734181920432, 1.0e-7), DoubleNear(0.12824623630510015, 1.0e-7), DoubleNear(0.1282968248125788, 1.0e-7), DoubleNear(0.12632707152061945, 1.0e-7), DoubleNear(0.11638162660261925, 1.0e-7), DoubleNear(0.11489347236142883, 1.0e-7), DoubleNear(0.11493879368588451, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, true}), Matrix({ { 0.14618954056963962 + -2.1641691802347378e-19i, 0.010062343251789872 + 0.028273465341745588i, -0.046293734117981114 + 0.021800728644650137i, -0.030773590994303466 + 0.03550428217722834i, 0.0063279098056965325 + -0.0011666759927169193i, 0.0006611934985209741 + 0.0011435321817368834i, -0.001829872276030581 + 0.001313109214397149i, -0.0010487105572473984 + 0.0017824168824999934i }, { 0.010062343251789872 + -0.028273465341745588i, 0.13468036834058345 + -1.651714247145886e-19i, 0.023055582770859222 + 0.007454501338068185i, 0.06547382899377412 + -0.00298890659165319i, 0.00020991670927058214 + -0.0013041386691312134i, 0.005829727763945046 + -0.001074826227792816i, 0.001057467144627401 + 0.0001386762494627511i, 0.0028102242974458423 + -0.0006518953093126707i }, { -0.04629373411798111 + -0.021800728644650137i, 0.023055582770859222 + -0.007454501338068185i, 0.13295823085890457 + -2.043466985251e-19i, 0.007736905133120158 + 0.0003264648085214355i, -0.0021778367970810225 + -0.0005742083600923179i, 0.0009384847917872214 + -0.0005066696751489864i, 0.005755183917548032 + -0.0010610825875282401i, 0.0003375023706889634 + -4.761367732985074e-05i }, { -0.030773590994303466 + -0.03550428217722835i, 0.06547382899377412 + 0.00298890659165319i, 0.007736905133120158 + -0.0003264648085214355i, 0.13301067807801947 + -5.759824041329245e-20i, -0.0016153994392756922 + -0.0012912352332131128i, 0.0028579306593561056 + -0.00039314175887486134i, 0.0003322916195902904 + -7.587616252554833e-05i, 0.005757454129704288 + -0.0010615011462786657i }, { 0.006327909805696532 + 0.0011666759927169191i, 0.00020991670927058214 + 0.0013041386691312132i, -0.0021778367970810225 + 0.0005742083600923179i, -0.0016153994392756922 + 0.0012912352332131128i, 0.1211461638435437 + 1.2938428269309435e-19i, 0.008338587558872694 + 0.023430006355921254i, -0.03836326645896246 + 0.018066098532099194i, -0.025501841527945355 + 0.029422129442570943i }, { 0.0006611934985209742 + -0.0011435321817368834i, 0.005829727763945047 + 0.0010748262277928155i, 0.0009384847917872215 + 0.0005066696751489864i, 0.0028579306593561056 + 0.00039314175887486134i, 0.008338587558872694 + -0.023430006355921257i, 0.1116086000812401 + 2.013820832097099e-19i, 0.019105986632035145 + 0.006177488737939676i, 0.05425766565676726 + -0.0024768842302570603i }, { -0.0018298722760305807 + -0.001313109214397149i, 0.001057467144627401 + -0.000138676249462751i, 0.005755183917548032 + 0.00106108258752824i, 0.00033229161959029034 + 7.587616252554831e-05i, -0.03836326645896246 + -0.01806609853209919i, 0.019105986632035145 + -0.006177488737939676i, 0.11018147780762441 + 2.106994456295072e-19i, 0.006411514621680018 + 0.00027053891152663343i }, { -0.0010487105572473984 + -0.0017824168824999934i, 0.0028102242974458423 + 0.0006518953093126708i, 0.0003375023706889634 + 4.7613677329850755e-05i, 0.005757454129704288 + 0.0010615011462786657i, -0.025501841527945355 + -0.029422129442570943i, 0.05425766565676726 + 0.0024768842302570603i, 0.00641151462168002 + -0.00027053891152663343i, 0.11022494042044387 + 1.799945012915388e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.14618954056963962, 1.0e-7), DoubleNear(0.13468036834058345, 1.0e-7), DoubleNear(0.13295823085890457, 1.0e-7), DoubleNear(0.13301067807801947, 1.0e-7), DoubleNear(0.1211461638435437, 1.0e-7), DoubleNear(0.1116086000812401, 1.0e-7), DoubleNear(0.11018147780762441, 1.0e-7), DoubleNear(0.11022494042044387, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, true}), Matrix({ { 0.14723901437163894 + -2.364998746387723e-19i, 0.009388374391593495 + 0.015085291581849392i, -0.0031124012696396985 + -0.0022534238645391643i, 3.241781872958632e-05 + -0.0004625640008942973i, 0.006373336965099429 + -0.0011750513927968908i, 0.0005267711602603257 + 0.0005780521176821837i, -0.00015270593197434822 + -7.270218571317491e-05i, -2.2882983325395e-06 + -2.0281097787956536e-05i }, { 0.009388374391593497 + -0.01508529158184939i, 0.1411960612441322 + -4.779794331914193e-20i, -0.0004293287665643043 + 0.000175194691971238i, -0.0029846627414602533 + -0.002160939309084016i, 0.00028599268235965185 + -0.000727901292536013i, 0.006111763789604711 + -0.0011268251769437992i, -1.718562258863369e-05 + 1.1009705399528283e-05i, -0.00014643860674705455 + -6.97183576672801e-05i }, { -0.0031124012696396985 + 0.002253423864539164i, -0.0004293287665643043 + -0.00017519469197123798i, 0.13190875705690525 + -1.8426374190980148e-19i, 0.008410873993316532 + 0.013514638568417631i, -0.0001167387141565885 + 0.0001223796636892485i, -1.9981929908265933e-05 + -4.157128081320823e-06i, 0.005709756758145136 + -0.0010527071874482684i, 0.0004719247089496118 + 0.0005178663867248489i }, { 3.241781872958632e-05 + 0.0004625640008942973i, -0.0029846627414602538 + 0.0021609393090840155i, 0.008410873993316532 + -0.013514638568417631i, 0.12649498517447072 + -1.749717218087391e-19i, 5.094751273275328e-06 + 1.976367238664966e-05i, -0.00011194754803241786 + 0.00011735698288287241i, 0.0002562156465012207 + -0.0006521135391207486i, 0.005475418104044623 + -0.001009502197127682i }, { 0.006373336965099428 + 0.0011750513927968906i, 0.00028599268235965185 + 0.0007279012925360128i, -0.0001167387141565885 + -0.0001223796636892485i, 5.094751273275331e-06 + -1.9763672386649665e-05i, 0.12201585482602509 + 1.7250256926523077e-19i, 0.0077800746745401664 + 0.01250106675540024i, -0.002579223333553115 + -0.0018673952708153445i, 2.686440058544366e-05 + -0.0003833232803257299i }, { 0.0005267711602603258 + -0.0005780521176821837i, 0.006111763789604711 + 0.0011268251769437992i, -1.9981929908265923e-05 + 4.1571280813208214e-06i, -0.00011194754803241786 + -0.0001173569828828724i, 0.0077800746745401664 + -0.012501066755400242i, 0.11700810538765094 + 2.721603050665917e-19i, -0.0003557814936299717 + 0.00014518251288953398i, -0.0024733673837795517 + -0.0017907540209385832i }, { -0.00015270593197434817 + 7.270218571317488e-05i, -1.7185622588633682e-05 + -1.1009705399528285e-05i, 0.005709756758145137 + 0.0010527071874482684i, 0.0002562156465012206 + 0.0006521135391207486i, -0.002579223333553115 + 0.0018673952708153445i, -0.0003557814936299717 + -0.000145182512889534i, 0.109311786825143 + 1.675811590573708e-19i, 0.006970027506012546 + 0.01119947851204765i }, { -2.288298332539506e-06 + 2.028109778795653e-05i, -0.0001464386067470546 + 6.97183576672801e-05i, 0.0004719247089496118 + -0.0005178663867248489i, 0.005475418104044624 + 0.001009502197127682i, 2.686440058544358e-05 + 0.00038332328032572984i, -0.0024733673837795513 + 0.0017907540209385834i, 0.006970027506012547 + -0.01119947851204765i, 0.10482543511403303 + 1.0921627943465696e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.14723901437163894, 1.0e-7), DoubleNear(0.1411960612441322, 1.0e-7), DoubleNear(0.13190875705690525, 1.0e-7), DoubleNear(0.12649498517447072, 1.0e-7), DoubleNear(0.12201585482602509, 1.0e-7), DoubleNear(0.11700810538765094, 1.0e-7), DoubleNear(0.109311786825143, 1.0e-7), DoubleNear(0.10482543511403303, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false, false}), Matrix({ { 0.14104696741131206 + 3.451659260061274e-20i, 0.001988771530512509 + -0.017824540718226367i, 0.04193166318687163 + -0.04761566835644787i, -0.007929077533782917 + -0.005847388871500793i, 0.06356795398207246 + -0.0006734826595011571i, 0.0008112022551432813 + -0.008042774744381493i, 0.018670672310285977 + -0.02165995426218348i, -0.003601448227630401 + -0.0025974783945948154i }, { 0.001988771530512509 + 0.017824540718226367i, 0.16169469865679187 + -4.997494388800371e-20i, 0.003488932984256827 + 0.0029450938243794416i, 0.042907211291324576 + -0.05486268766622833i, 0.0009814224209167284 + 0.008023782444666125i, 0.07287360623207323 + -0.0007720731446926566i, 0.0015864772218643951 + 0.0013106545729330821i, 0.019075734937448657 + -0.024930745638915862i }, { 0.04193166318687163 + 0.047615668356447864i, 0.0034889329842568272 + -0.002945093824379442i, 0.14492609012037644 + -1.5903043584699496e-19i, -2.159238834943635e-05 + -0.01661741603933055i, 0.019125390728514845 + 0.021259516754611286i, 0.0015583522694782945 + -0.0013439730612094937i, 0.06531622194122348 + -0.0006920050136260321i, -8.907760108394846e-05 + -0.007489140783223028i }, { -0.007929077533782915 + 0.005847388871500793i, 0.042907211291324576 + 0.054862687666228316i, -2.1592388349436213e-05 + 0.01661741603933055i, 0.16240402847047217 + 2.837560373301907e-20i, -0.003545607041100927 + 0.002673199217563955i, 0.019599660683247706 + 0.02452099187670996i, 6.961480831141955e-05 + 0.007489346985446265i, 0.0731932915523726 + -0.0007754601110213109i }, { 0.06356795398207248 + 0.0006734826595011572i, 0.0009814224209167284 + -0.008023782444666125i, 0.019125390728514845 + -0.021259516754611286i, -0.003545607041100927 + -0.002673199217563955i, 0.09015036208026772 + -2.2446373102238953e-20i, 0.001271126043056292 + -0.011392579572283016i, 0.026800679860779053 + -0.03043361953688807i, -0.005067880747471624 + -0.003737366592595363i }, { 0.0008112022551432813 + 0.008042774744381493i, 0.07287360623207322 + 0.0007720731446926567i, 0.0015583522694782945 + 0.0013439730612094937i, 0.019599660683247706 + -0.02452099187670996i, 0.0012711260430562925 + 0.011392579572283016i, 0.10334738773830945 + -3.7269449679189215e-20i, 0.0022299562874495134 + 0.0018823607448002014i, 0.027424202765647252 + -0.035065561837882224i }, { 0.018670672310285977 + 0.02165995426218348i, 0.0015864772218643951 + -0.0013106545729330821i, 0.06531622194122348 + 0.0006920050136260321i, 6.961480831141948e-05 + -0.007489346985446265i, 0.02680067986077905 + 0.03043361953688807i, 0.0022299562874495134 + -0.0018823607448002014i, 0.09262970866385045 + 1.27054942088145e-19i, -1.3800804537704134e-05 + -0.010621044183215465i }, { -0.0036014482276304012 + 0.0025974783945948154i, 0.01907573493744866 + 0.024930745638915862i, -8.907760108394836e-05 + 0.007489140783223029i, 0.0731932915523726 + 0.0007754601110213112i, -0.005067880747471624 + 0.0037373665925953627i, 0.027424202765647252 + 0.03506556183788222i, -1.380080453770405e-05 + 0.010621044183215467i, 0.10380075685861909 + 1.5670109524204551e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.14104696741131206, 1.0e-7), DoubleNear(0.16169469865679187, 1.0e-7), DoubleNear(0.14492609012037644, 1.0e-7), DoubleNear(0.16240402847047217, 1.0e-7), DoubleNear(0.09015036208026772, 1.0e-7), DoubleNear(0.10334738773830945, 1.0e-7), DoubleNear(0.09262970866385045, 1.0e-7), DoubleNear(0.10380075685861909, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false, false}), Matrix({ { 0.09943981588723566 + 6.406887192261679e-20i, 0.0014285255327145174 + -0.012618222890896293i, 0.029353131180752855 + -0.03368947390546522i, -0.005622080347181677 + -0.004147876448477873i, 0.007004299648675437 + 0.00562969424288818i, 0.0007556990791788205 + -0.0010051440863320302i, 0.0041411247912825095 + -0.0004554754797929646i, -0.00015567469421299066 + -0.0005471905363163686i }, { 0.0014285255327145174 + 0.012618222890896293i, 0.11404157432321121 + 8.290735147468474e-20i, 0.002500384725409246 + 0.0020881144580520913i, 0.030043634249650536 + -0.03881433069042843i, -0.0003600220538908809 + 0.0010351745572653385i, 0.008287687468326596 + 0.006287846867252191i, -5.664146057467165e-05 + 0.00042189186328711495i, 0.004473860220019313 + -0.0005353682907795235i }, { 0.029353131180752855 + 0.03368947390546522i, 0.002500384725409246 + -0.0020881144580520918i, 0.10184914060852931 + -7.642796736912925e-20i, -3.084212991665047e-05 + -0.011679723047273396i, 0.0010150520287731178 + 0.004339606163028876i, 4.813923440578067e-05 + -0.0003835567365312797i, 0.006983383033788277 + 0.005829930357318478i, 0.0003998267968783665 + -0.0005244013965745112i }, { -0.005622080347181677 + 0.004147876448477873i, 0.030043634249650536 + 0.03881433069042843i, -3.084212991665038e-05 + 0.011679723047273396i, 0.11409653701254827 + 4.8216849798773416e-20i, -0.0004581018554068759 + 8.770552443560181e-05i, 0.0008739919791604803 + 0.004376794998468579i, -0.000842709676943837 + 0.000600251140928276i, 0.00738015508784578 + 0.006577225503677203i }, { 0.007004299648675437 + -0.005629694242888181i, -0.0003600220538908808 + -0.0010351745572653385i, 0.0010150520287731178 + -0.004339606163028876i, -0.00045810185540687596 + -8.770552443560176e-05i, 0.13175751360434412 + -5.1998652424243e-20i, 0.0018313720408542839 + -0.01659889739961309i, 0.03937921186689783 + -0.044359813987870714i, -0.007374877934072863 + -0.005436879015618283i }, { 0.0007556990791788202 + 0.0010051440863320302i, 0.008287687468326596 + -0.00628784686725219i, 4.813923440578071e-05 + 0.0003835567365312797i, 0.0008739919791604805 + -0.004376794998468579i, 0.0018313720408542843 + 0.016598897399613094i, 0.15100051207189008 + -1.701517450418777e-19i, 0.003218504546297094 + 0.0027393401111275514i, 0.04028777980732129 + -0.051113918813682116i }, { 0.004141124791282509 + 0.00045547547979296415i, -5.66414605746716e-05 + -0.000421891863287115i, 0.006983383033788276 + -0.005829930357318478i, -0.0008427096769438371 + -0.000600251140928276i, 0.03937921186689783 + 0.044359813987870714i, 0.0032185045462970944 + -0.0027393401111275514i, 0.13570665817569755 + 4.4452473610279275e-20i, -4.551062970490016e-06 + -0.015558737175272617i }, { -0.00015567469421299057 + 0.0005471905363163687i, 0.004473860220019312 + 0.0005353682907795238i, 0.0003998267968783666 + 0.0005244013965745112i, 0.007380155087845779 + -0.006577225503677205i, -0.007374877934072862 + 0.005436879015618283i, 0.04028777980732129 + 0.051113918813682116i, -4.551062970489878e-06 + 0.015558737175272615i, 0.152108248316543 + 1.3685984917629118e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.09943981588723566, 1.0e-7), DoubleNear(0.11404157432321121, 1.0e-7), DoubleNear(0.10184914060852931, 1.0e-7), DoubleNear(0.11409653701254827, 1.0e-7), DoubleNear(0.13175751360434412, 1.0e-7), DoubleNear(0.15100051207189008, 1.0e-7), DoubleNear(0.13570665817569755, 1.0e-7), DoubleNear(0.152108248316543, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false, false}), Matrix({ { 0.11874865272044005 + -1.7575933655526732e-20i, 0.0016743638246999098 + -0.015006633850393936i, 0.03530262721103307 + -0.040088039959219966i, -0.006675558445059602 + -0.004922966889449936i, 0.008109129363084057 + 0.007953427736981551i, 0.0011194384754221955 + -0.0009126318575356741i, 0.0050957285491772695 + -0.0003730754537278387i, -0.00012613621503804585 + -0.0007832892830580896i }, { 0.0016743638246999098 + 0.015006633850393936i, 0.13613215491219163 + -2.778268066994105e-19i, 0.002937362631159802 + 0.002479499773720755i, 0.03612394953503559 + -0.04618936773017368i, -0.0008907599591728456 + 0.0011369195674184587i, 0.009296217088518986 + 0.009117722449640289i, 3.45177077323434e-05 + 0.00036605624442252337i, 0.005560463746046962 + -0.000734714322419823i }, { 0.03530262721103307 + 0.040088039959219966i, 0.0029373626311598026 + -0.0024794997737207555i, 0.12201451943060736 + 1.198551620364834e-19i, -1.8178817117243803e-05 + -0.013990345220334554i, -0.00027422423139863636 + 0.005102003117598846i, 0.00036665658800370923 + 2.7415191068015018e-05i, 0.008332149456606163 + 0.008172165670279032i, 0.0009357898620314786 + -0.0009565927741648449i }, { -0.006675558445059601 + 0.004922966889449936i, 0.03612394953503559 + 0.04618936773017368i, -1.8178817117243694e-05 + 0.013990345220334554i, 0.13672934577176785 + 1.2472560148319572e-19i, -0.0007855872573832752 + -0.00011092838561343947i, -0.0006267862149889347 + 0.005573661386142083i, -0.00093827265869981 + 0.0009541576491343964i, 0.009336998165388594 + 0.009157720497938206i }, { 0.00810912936308406 + -0.007953427736981551i, -0.0008907599591728457 + -0.0011369195674184587i, -0.00027422423139863576 + -0.005102003117598846i, -0.0007855872573832752 + 0.00011092838561343946i, 0.11244867677113975 + 2.964615315390051e-20i, 0.0015855337488688917 + -0.014210486440115449i, 0.033429715836617614 + -0.03796124793411597i, -0.006321399836194938 + -0.0046617885746462195i }, { 0.0011194384754221955 + 0.0009126318575356742i, 0.009296217088518985 + -0.009117722449640287i, 0.00036665658800370934 + -2.7415191068015018e-05i, -0.0006267862149889348 + -0.0055736613861420824i, 0.001585533748868892 + 0.014210486440115449i, 0.12890993148290963 + 1.9058241313221758e-19i, 0.002781526640546538 + 0.002347954795458888i, 0.03420746452193624 + -0.04373888177393686i }, { 0.00509572854917727 + 0.0003730754537278387i, 3.451770773234333e-05 + -0.0003660562444225233i, 0.008332149456606165 + -0.008172165670279032i, -0.00093827265869981 + -0.0009541576491343964i, 0.033429715836617614 + 0.03796124793411597i, 0.002781526640546538 + -0.002347954795458888i, 0.11554127935361952 + -1.5183065579533336e-19i, -1.7214375769896686e-05 + -0.013248115002211458i }, { -0.00012613621503804577 + 0.0007832892830580896i, 0.005560463746046963 + 0.0007347143224198233i, 0.0009357898620314786 + 0.0009565927741648447i, 0.00933699816538859 + -0.009157720497938207i, -0.006321399836194938 + 0.0046617885746462195i, 0.03420746452193624 + 0.04373888177393686i, -1.7214375769896564e-05 + 0.013248115002211458i, 0.1294754395573234 + 6.035109749186888e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.11874865272044005, 1.0e-7), DoubleNear(0.13613215491219163, 1.0e-7), DoubleNear(0.12201451943060736, 1.0e-7), DoubleNear(0.13672934577176785, 1.0e-7), DoubleNear(0.11244867677113975, 1.0e-7), DoubleNear(0.12890993148290963, 1.0e-7), DoubleNear(0.11554127935361952, 1.0e-7), DoubleNear(0.1294754395573234, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true, false}), Matrix({ { 0.12205203901452753 + 7.063404313669477e-20i, 0.0016812806639344593 + -0.015295411259799363i, 0.036686805840819084 + -0.040844115910243714i, -0.006740997120330515 + -0.004976845860952986i, -0.0022458017288042144 + -0.0021754843162646396i, -4.387781512041081e-05 + 4.8473803091228564e-05i, -0.0014643482392119795 + -0.00020335104369024548i, 3.26558254636417e-05 + 6.237517390110501e-05i }, { 0.0016812806639344593 + 0.015295411259799363i, 0.13980966789570035 + -1.159334109356432e-19i, 0.0028342886453620046 + 0.0025496966066028883i, 0.037472798462032345 + -0.04696724491664145i, 0.0002509416648485581 + -9.962392436788131e-06i, -0.0022637744892484517 + -0.0023171499573585545i, -5.1485312866791e-05 + 0.00014429935984898847i, -0.0015272015824615156 + 6.659030994180079e-05i }, { 0.036686805840819084 + 0.040844115910243714i, 0.002834288645362005 + -0.0025496966066028883i, 0.12528927557355715 + -3.821348511975528e-20i, -4.2494195979446914e-05 + -0.014238105277194334i, -0.00045315147834884756 + -0.0008345719130386869i, 6.578677829825294e-05 + -0.00013627699053833265i, -0.002987733489847136 + -0.0016626961477782948i, -0.0003213063482651538 + 0.0003696904685127661i }, { -0.006740997120330515 + 0.0049768458609529866i, 0.037472798462032345 + 0.04696724491664145i, -4.249419597944677e-05 + 0.014238105277194334i, 0.14030805334566215 + 2.4387790929261196e-19i, 8.049821073110795e-05 + 9.73580683569856e-05i, -0.0002859074848057847 + -0.0009641299329188468i, 4.8531835268656636e-06 + -0.000477475165600812i, -0.0036523450205328168 + -0.0019171820439756195i }, { -0.002245801728804214 + 0.0021754843162646396i, 0.0002509416648485581 + 9.962392436788246e-06i, -0.00045315147834884756 + 0.0008345719130386864i, 8.049821073110799e-05 + -9.735806835698568e-05i, 0.10914529047705224 + -5.856382363832099e-20i, 0.0015786169096343424 + -0.013921709030710022i, 0.0320455372068316 + -0.03720517198309223i, -0.006255961160924025 + -0.004607909603143171i }, { -4.387781512041092e-05 + -4.847380309122846e-05i, -0.002263774489248451 + 0.002317149957358554i, 6.578677829825296e-05 + 0.00013627699053833268i, -0.0002859074848057854 + 0.0009641299329188464i, 0.0015786169096343424 + 0.013921709030710022i, 0.12523241849940095 + 2.868901736845028e-20i, 0.0028846006263443355 + 0.0022777579625767553i, 0.03285861559493948 + -0.0429610045874691i }, { -0.0014643482392119793 + 0.00020335104369024532i, -5.148531286679101e-05 + -0.00014429935984898852i, -0.002987733489847136 + 0.0016626961477782943i, 4.853183526865623e-06 + 0.0004774751656008121i, 0.0320455372068316 + 0.03720517198309223i, 0.0028846006263443355 + -0.002277757962576755i, 0.11226652321066972 + 6.237991360905315e-21i, 7.10100309230643e-06 + -0.01300035494535168i }, { 3.265582546364166e-05 + -6.237517390110504e-05i, -0.0015272015824615154 + -6.659030994180112e-05i, -0.00032130634826515385 + -0.0003696904685127661i, -0.003652345020532817 + 0.0019171820439756186i, -0.006255961160924024 + 0.004607909603143171i, 0.03285861559493948 + 0.0429610045874691i, 7.101003092306512e-06 + 0.013000354945351678i, 0.1258967319834291 + -5.880121031754738e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12205203901452753, 1.0e-7), DoubleNear(0.13980966789570035, 1.0e-7), DoubleNear(0.12528927557355715, 1.0e-7), DoubleNear(0.14030805334566215, 1.0e-7), DoubleNear(0.10914529047705224, 1.0e-7), DoubleNear(0.12523241849940095, 1.0e-7), DoubleNear(0.11226652321066972, 1.0e-7), DoubleNear(0.1258967319834291, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, true}), Matrix({ { 0.12642767434859295 + -2.445807635196792e-19i, 0.001782638535433148 + -0.015977055520560057i, 0.03758551322004191 + -0.042680380325403514i, -0.007107241302129927 + -0.00524131634734033i, 0.005472504510955529 + -0.0010089650183097206i, -5.0343350236174686e-05 + -0.0007058037632216233i, 0.0012862997026930703 + -0.0021474020090390894i, -0.00034947028139498853 + -0.0001701539604716237i }, { 0.0017826385354331481 + 0.015977055520560057i, 0.14493530120403875 + -4.48503945571152e-19i, 0.00312731064873863 + 0.002639839549821007i, 0.03845994732043273 + -0.04917625764989114i, 0.0002046686983346092 + 0.0006773508167949782i, 0.006273619235048657 + -0.00115666644653964i, 0.00015643511196424532 + 8.93094558355702e-05i, 0.0012723093446972392 + -0.002435558787740359i }, { 0.03758551322004191 + 0.042680380325403514i, 0.0031273106487386296 + -0.002639839549821007i, 0.12990473217990148 + 3.642241673193485e-20i, -1.9354371758240208e-05 + -0.014895047388073613i, 0.0019675273047725173 + 0.0015474943032360374i, 0.00011430025860332825 + -0.00013922490452546188i, 0.005623011231614043 + -0.0010367139248407152i, -0.00011970874830502607 + -0.0006445874019115087i }, { -0.007107241302129927 + 0.00524131634734033i, 0.03845994732043273 + 0.04917625764989114i, -1.935437175824012e-05 + 0.014895047388073613i, 0.14557111011461396 + 1.3129010682441619e-20i, -0.000265812888002145 + 0.0002835936466397483i, 0.002057218565811582 + 0.0018216941152738417i, 0.00011803321504382506 + 0.0006448963197834229i, 0.006301140639275667 + -0.0011617405646265648i }, { 0.005472504510955529 + 0.0010089650183097206i, 0.0002046686983346092 + -0.0006773508167949781i, 0.0019675273047725173 + -0.0015474943032360376i, -0.000265812888002145 + -0.0002835936466397482i, 0.10476965514298683 + 2.56650983018053e-19i, 0.0014772590381356536 + -0.013240064769949326i, 0.031146829827608774 + -0.03536890756793243i, -0.005889716979124613 + -0.0043434391167558265i }, { -5.0343350236174686e-05 + 0.0007058037632216233i, 0.006273619235048657 + 0.0011566664465396397i, 0.00011430025860332825 + 0.00013922490452546188i, 0.0020572185658115816 + -0.0018216941152738415i, 0.0014772590381356538 + 0.013240064769949326i, 0.12010678519106255 + 3.612595520039591e-19i, 0.00259157862296771 + 0.002187615019358636i, 0.031871466736539095 + -0.040751991854219405i }, { 0.0012862997026930703 + 0.0021474020090390894i, 0.00015643511196424532 + -8.93094558355702e-05i, 0.005623011231614043 + 0.0010367139248407154i, 0.00011803321504382507 + -0.0006448963197834229i, 0.031146829827608774 + 0.03536890756793243i, 0.002591578622967711 + -0.0021876150193586357i, 0.1076510666043254 + -6.839791049078481e-20i, -1.603882112890028e-05 + -0.012343412834472399i }, { -0.00034947028139498864 + 0.00017015396047162374i, 0.0012723093446972392 + 0.002435558787740359i, -0.00011970874830502604 + 0.0006445874019115087i, 0.006301140639275669 + 0.0011617405646265648i, -0.005889716979124613 + 0.0043434391167558265i, 0.031871466736539095 + 0.040751991854219405i, -1.603882112890014e-05 + 0.012343412834472399i, 0.12063367521447729 + 1.7194768829262297e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12642767434859295, 1.0e-7), DoubleNear(0.14493530120403875, 1.0e-7), DoubleNear(0.12990473217990148, 1.0e-7), DoubleNear(0.14557111011461396, 1.0e-7), DoubleNear(0.10476965514298683, 1.0e-7), DoubleNear(0.12010678519106255, 1.0e-7), DoubleNear(0.1076510666043254, 1.0e-7), DoubleNear(0.12063367521447729, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false, false}), Matrix({ { 0.12280071292150968 + -8.839122351900317e-20i, 0.0008526872079330929 + -0.01482349124204594i, 0.05534461471402154 + -0.000586358943016761i, 0.00031351412725702456 + -0.006684817805596668i, 0.008533490537333769 + 0.006991193631369718i, 0.000704953733425808 + -0.0009331325424738338i, 0.003879310498523651 + 0.0031100896757144674i, 0.00031325748231568153 + -0.00042391624387075235i }, { 0.000852687207933093 + 0.014823491242045942i, 0.1391806247313297 + 3.7575081747899264e-20i, 0.0004550749773485033 + 0.006676674843588181i, 0.06272681866542346 + -0.0006645710929873619i, -0.0007337526934962878 + 0.0009977270743740927i, 0.009558508669999573 + 0.007848617661099481i, -0.0003259283514889739 + 0.0004531656343912707i, 0.004345366358571021 + 0.003491624708438924i }, { 0.05534461471402154 + 0.0005863589430167609i, 0.0004550749773485033 + -0.00667667484358818i, 0.07848824357425528 + 7.603212807249072e-20i, 0.000544996194864774 + -0.009474454696123749i, 0.0038125462459295224 + 0.0031915825005144807i, 0.00032216867832232383 + -0.00041718410174920815i, 0.0054541921451299455 + 0.004468430968836942i, 0.00045057214263137876 + -0.0005964129404327076i }, { 0.0003135141272570246 + 0.006684817805596668i, 0.06272681866542346 + 0.000664571092987362i, 0.0005449961948647741 + 0.009474454696123749i, 0.08895748660442979 + 9.354911952555891e-20i, -0.00033545641006177916 + 0.0004461584689838649i, 0.004270413908435874 + 0.0035829062149907616i, -0.00046897903733843 + 0.0006376986238195219i, 0.006109333886172803 + 0.005016454709829911i }, { 0.008533490537333769 + -0.00699119363136972i, -0.0007337526934962877 + -0.0009977270743740927i, 0.0038125462459295215 + -0.00319158250051448i, -0.00033545641006177927 + -0.000446158468983865i, 0.1631723446101788 + -3.612261972737904e-20i, 0.0011144919342299798 + -0.019618465515510976i, 0.0735395612092744 + -0.0007791287301104283i, 0.00040861052680230816 + -0.008847097722007853i }, { 0.0007049537334258078 + 0.0009331325424738337i, 0.009558508669999572 + -0.007848617661099481i, 0.0003221686783223239 + 0.00041718410174920815i, 0.004270413908435874 + -0.0035829062149907633i, 0.0011144919342299803 + 0.019618465515510976i, 0.18491810239593431 + -5.917442190288391e-20i, 0.0005959622518796445 + 0.008836454586524212i, 0.08334007911902236 + -0.0008829621627266057i }, { 0.0038793104985236516 + -0.0031100896757144687i, -0.00032592835148897395 + -0.00045316563439127085i, 0.005454192145129945 + -0.004468430968836942i, -0.0004689790373384299 + -0.000637698623819522i, 0.0735395612092744 + 0.0007791287301104285i, 0.0005959622518796445 + -0.008836454586524212i, 0.10429182716986288 + 2.8576440913415335e-20i, 0.0007123290436538141 + -0.012539169059374734i }, { 0.0003132574823156814 + 0.00042391624387075224i, 0.004345366358571021 + -0.0034916247084389243i, 0.00045057214263137865 + 0.0005964129404327076i, 0.006109333886172803 + -0.005016454709829912i, 0.00040861052680230827 + 0.008847097722007853i, 0.08334007911902236 + 0.0008829621627266059i, 0.0007123290436538143 + 0.012539169059374734i, 0.11819065799249874 + 2.588252603729739e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.12280071292150968, 1.0e-7), DoubleNear(0.1391806247313297, 1.0e-7), DoubleNear(0.07848824357425528, 1.0e-7), DoubleNear(0.08895748660442979, 1.0e-7), DoubleNear(0.1631723446101788, 1.0e-7), DoubleNear(0.18491810239593431, 1.0e-7), DoubleNear(0.10429182716986288, 1.0e-7), DoubleNear(0.11819065799249874, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false, false}), Matrix({ { 0.14688281811434023 + -3.5998900258308246e-21i, 0.0010103917433013586 + -0.017690238771397637i, 0.0661980926922124 + -0.0007013481593701879i, 0.00037090103918731765 + -0.007977575031366844i, 0.010030360311603856 + 0.009837769548652111i, 0.0012538368197120156 + -0.0011403612069900099i, 0.004567521455687517 + 0.004385855432202112i, 0.000559642147624616 + -0.0005199322426475662i }, { 0.0010103917433013586 + 0.017690238771397637i, 0.16646510268698328 + -4.8704394467122245e-20i, 0.00053983865299972 + 0.007967926028188601i, 0.07502356258656043 + -0.0007948512621673804i, -0.0011158411933850079 + 0.0012757072093620766i, 0.011367598883885822 + 0.011149332094462087i, -0.0004968031304349274 + 0.0005802719361924001i, 0.005176459288479502 + 0.004970573714915053i }, { 0.0661980926922124 + 0.0007013481593701879i, 0.00053983865299972 + -0.007967926028188601i, 0.09388035403670718 + 1.0587911840678752e-19i, 0.0006457932642813073 + -0.011306740299330853i, 0.004473573073516852 + 0.004481643010799454i, 0.0005705323285703141 + -0.0005079583963264664i, 0.006410918508086366 + 0.006287823858608472i, 0.0008013915177416582 + -0.0007288634247105092i }, { 0.0003709010391873177 + 0.007977575031366842i, 0.07502356258656043 + 0.0007948512621673805i, 0.0006457932642813075 + 0.011306740299330853i, 0.1063963979969762 + -1.0439681074909252e-19i, -0.0005089858338262102 + 0.0005696159156016076i, 0.005069985792899226 + 0.005079131606927524i, -0.0007131914244876478 + 0.0008153700071907786i, 0.007265616370021757 + 0.007126110853116407i }, { 0.01003036031160386 + -0.009837769548652111i, -0.0011158411933850079 + -0.0012757072093620763i, 0.004473573073516851 + -0.004481643010799454i, -0.0005089858338262101 + -0.0005696159156016076i, 0.13909023941734827 + -1.2091395322055137e-19i, 0.0009567873988617141 + -0.01675171798615928i, 0.06268608323108354 + -0.0006641395137570012i, 0.00035122361487201513 + -0.00755434049623768i }, { 0.0012538368197120156 + 0.0011403612069900099i, 0.011367598883885818 + -0.011149332094462087i, 0.0005705323285703141 + 0.0005079583963264662i, 0.005069985792899228 + -0.005079131606927523i, 0.0009567873988617144 + 0.01675171798615928i, 0.15763362444028073 + 2.7105054312137587e-20i, 0.0005111985762284279 + 0.0075452034019237915i, 0.07104333519788539 + -0.0007526819935465872i }, { 0.004567521455687517 + -0.004385855432202112i, -0.0004968031304349275 + -0.0005802719361924i, 0.006410918508086367 + -0.006287823858608472i, -0.0007131914244876479 + -0.0008153700071907788i, 0.06268608323108354 + 0.0006641395137570014i, 0.0005111985762284279 + -0.0075452034019237915i, 0.08889971670741098 + -1.2705494208814565e-21i, 0.0006115319742372807 + -0.01070688345616763i }, { 0.000559642147624616 + 0.0005199322426475664i, 0.005176459288479504 + -0.004970573714915053i, 0.0008013915177416582 + 0.000728863424710509i, 0.007265616370021759 + -0.007126110853116405i, 0.0003512236148720152 + 0.00755434049623768i, 0.07104333519788539 + 0.0007526819935465873i, 0.0006115319742372809 + 0.01070688345616763i, 0.10075174659995233 + 2.2382845631194886e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.14688281811434023, 1.0e-7), DoubleNear(0.16646510268698328, 1.0e-7), DoubleNear(0.09388035403670718, 1.0e-7), DoubleNear(0.1063963979969762, 1.0e-7), DoubleNear(0.13909023941734827, 1.0e-7), DoubleNear(0.15763362444028073, 1.0e-7), DoubleNear(0.08889971670741098, 1.0e-7), DoubleNear(0.10075174659995233, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true, false}), Matrix({ { 0.15089595721064436 + 7.742132926740789e-21i, 0.0009997773851802565 + -0.018017565140978443i, 0.06800676001827827 + -0.0007205104259621758i, 0.00036455434716740957 + -0.008125045901490826i, -0.0031928321709181135 + -0.0023415656055418015i, -0.00022278855428581806 + 0.00025511022345806023i, -0.0014501468276758973 + -0.0010400664420489258i, -9.918965654904846e-05 + 0.00011603850457455768i }, { 0.0009997773851802567 + 0.018017565140978447i, 0.17089191811231713 + -6.259539145367931e-21i, 0.0005366178507164879 + 0.008115498262932716i, 0.07701866821987857 + -0.0008159887845153827i, 0.00015605321965496104 + -0.0002973719009418007i, -0.0036092575875879083 + -0.002583246480892456i, 6.891115240166508e-05 + -0.00013476661569472532i, -0.0016389781091372285 + -0.0011470003502523645i }, { 0.06800676001827827 + 0.0007205104259621757i, 0.0005366178507164879 + -0.008115498262932716i, 0.09644535737744034 + 2.4678425090198718e-20i, 0.0006390090827747559 + -0.011515951396015252i, -0.001427785427635045 + -0.001070557237296443i, -0.00010162589909880054 + 0.00011391092635291069i, -0.002040703047733237 + -0.0014966148585011329i, -0.00014239560909974657 + 0.00016305404814593447i }, { 0.00036455434716740974 + 0.008125045901490824i, 0.07701866821987857 + 0.0008159887845153829i, 0.0006390090827747561 + 0.011515951396015252i, 0.10922580312904537 + 1.3420403750233672e-19i, 7.17509840177986e-05 + -0.0001332763442011106i, -0.001614308713658132 + -0.0011814679101514016i, 9.974162872046276e-05 + -0.00019006565709579946i, -0.00230686192219336 + -0.0016510855204417182i }, { -0.003192832170918113 + 0.002341565605541801i, 0.00015605321965496112 + 0.00029737190094180087i, -0.0014277854276350448 + 0.0010705572372964429i, 7.175098401779862e-05 + 0.0001332763442011106i, 0.13507710032104414 + -1.3225597617312299e-19i, 0.0009674017569828164 + -0.01642439161657847i, 0.060877415905017676 + -0.0006449772471650134i, 0.0003575703068919232 + -0.007406869626113697i }, { -0.00022278855428581817 + -0.0002551102234580601i, -0.003609257587587908 + 0.002583246480892455i, -0.00010162589909880055 + -0.00011391092635291062i, -0.0016143087136581318 + 0.0011814679101514016i, 0.0009674017569828166 + 0.01642439161657847i, 0.1532068090149469 + -1.5339801009616728e-20i, 0.00051441937851166 + 0.007397631167179675i, 0.06904822956456724 + -0.0007315444711985849i }, { -0.0014501468276758977 + 0.0010400664420489253i, 6.891115240166508e-05 + 0.00013476661569472538i, -0.002040703047733237 + 0.0014966148585011329i, 9.974162872046267e-05 + 0.0001900656570957995i, 0.060877415905017676 + 0.0006449772471650135i, 0.00051441937851166 + -0.007397631167179675i, 0.08633471336667783 + 7.993014389570734e-20i, 0.0006183161557438322 + -0.010497672359483231i }, { -9.918965654904849e-05 + -0.00011603850457455768i, -0.001638978109137229 + 0.0011470003502523645i, -0.00014239560909974657 + -0.00016305404814593447i, -0.00230686192219336 + 0.0016510855204417182i, 0.0003575703068919232 + 0.007406869626113697i, 0.06904822956456724 + 0.0007315444711985849i, 0.0006183161557438324 + 0.010497672359483231i, 0.09792234146788316 + -1.4772391939480392e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.15089595721064436, 1.0e-7), DoubleNear(0.17089191811231713, 1.0e-7), DoubleNear(0.09644535737744034, 1.0e-7), DoubleNear(0.10922580312904537, 1.0e-7), DoubleNear(0.13507710032104414, 1.0e-7), DoubleNear(0.1532068090149469, 1.0e-7), DoubleNear(0.08633471336667783, 1.0e-7), DoubleNear(0.09792234146788316, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, true}), Matrix({ { 0.15638116871676283 + -2.795208725939191e-19i, 0.0010757299165940202 + -0.018834198917644998i, 0.07047887040109896 + -0.0007467016649577247i, 0.00039488579216408583 + -0.008493454326017013i, 0.006769061090780927 + -0.0012480110036870275i, -0.00010374398724203049 + -0.0008238355481004528i, 0.0030447648611855714 + -0.0005947830914549228i, -5.0689724806312884e-05 + -0.0003707961354567595i }, { 0.0010757299165940204 + 0.018834198917644998i, 0.17722976480803831 + -1.5966571055743561e-19i, 0.0005747479559444617 + 0.008483181358672452i, 0.07987504971104649 + -0.0008462512561337738i, 0.00019687133220764024 + 0.0008066656703725754i, 0.007671506198186833 + -0.0014143947028679963i, 9.257897115289638e-05 + 0.0003626132324817703i, 0.0034506901609174046 + -0.0006740790357007637i }, { 0.07047887040109896 + 0.0007467016649577244i, 0.0005747479559444617 + -0.008483181358672452i, 0.09995123781173157 + 7.13625258061748e-20i, 0.0006875542470808874 + -0.012037903990988676i, 0.003056683072335745 + -0.0005301401523061395i, -4.282228935400284e-05 + -0.0003717868661008472i, 0.004326454651788646 + -0.0007976679394634084i, -6.630811129917025e-05 + -0.0005265556170326792i }, { 0.0003948857921640859 + 0.008493454326017011i, 0.0798750497110465 + 0.0008462512561337738i, 0.0006875542470808876 + 0.012037903990988676i, 0.11327664651061439 + -2.757092243312748e-19i, 8.487550398899007e-05 + 0.00036449330733666715i, 0.003464197297207603 + -0.0006008179583226463i, 0.000125830581170794 + 0.0005155814662058254i, 0.004903253676137493 + -0.0009040123082982086i }, { 0.006769061090780928 + 0.0012480110036870275i, 0.00019687133220764024 + -0.0008066656703725754i, 0.003056683072335745 + 0.0005301401523061394i, 8.487550398899004e-05 + -0.00036449330733666726i, 0.12959188881492567 + 1.5500702934753691e-19i, 0.0008914492255690527 + -0.015607757839911918i, 0.058405305522197 + -0.0006187860081694645i, 0.00032723886189524695 + -0.007038461201587511i }, { -0.00010374398724203049 + 0.0008238355481004528i, 0.007671506198186833 + 0.0014143947028679958i, -4.2822289354002846e-05 + 0.0003717868661008472i, 0.003464197297207603 + 0.000600817958322646i, 0.0008914492255690527 + 0.015607757839911916i, 0.1468689623192257 + 1.3806637040245096e-19i, 0.0004762892732836861 + 0.007029948071439938i, 0.06619184807339933 + -0.0007012819995801938i }, { 0.003044764861185572 + 0.0005947830914549228i, 9.257897115289639e-05 + -0.0003626132324817703i, 0.004326454651788646 + 0.0007976679394634083i, 0.00012583058117079403 + -0.0005155814662058256i, 0.058405305522197 + 0.0006187860081694649i, 0.0004762892732836861 + -0.007029948071439938i, 0.08282883293238659 + 3.324604317973126e-20i, 0.0005697709914377006 + -0.009975719764509807i }, { -5.068972480631289e-05 + 0.0003707961354567595i, 0.0034506901609174046 + 0.0006740790357007638i, -6.630811129917025e-05 + 0.0005265556170326792i, 0.004903253676137493 + 0.0009040123082982086i, 0.000327238861895247 + 0.007038461201587511i, 0.06619184807339933 + 0.0007012819995801941i, 0.0005697709914377009 + 0.009975719764509807i, 0.09387149808631415 + 3.951408698941311e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.15638116871676283, 1.0e-7), DoubleNear(0.17722976480803831, 1.0e-7), DoubleNear(0.09995123781173157, 1.0e-7), DoubleNear(0.11327664651061439, 1.0e-7), DoubleNear(0.12959188881492567, 1.0e-7), DoubleNear(0.1468689623192257, 1.0e-7), DoubleNear(0.08282883293238659, 1.0e-7), DoubleNear(0.09387149808631415, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false, false}), Matrix({ { 0.10338697442543729 + 1.132026179275203e-19i, 0.0007178846804889742 + -0.012480024533055103i, 0.007184418941500322 + 0.0058859459360931475i, 0.0005935066000422578 + -0.0007856122982441356i, 0.007060108311691399 + 0.0069245487102384375i, 0.0008848975597950904 + -0.0008041564032567286i, 9.638793086492296e-05 + 0.0008831313156049919i, 9.31474352555046e-05 + -1.3896746304303293e-05i }, { 0.0007178846804889742 + 0.012480024533055103i, 0.11717736279602593 + -9.282430790359399e-21i, -0.0006177526917582641 + 0.0008399949891806588i, 0.008047390506944441 + 0.006607818587517301i, -0.0007868514833386908 + 0.0009003199183611379i, 0.008001828834007898 + 0.007848187461985793i, -9.844554586448703e-05 + 1.5986510961537816e-05i, 0.00010696982854255406 + 0.0009902259260073513i }, { 0.007184418941500323 + -0.0058859459360931475i, -0.0006177526917582638 + -0.0008399949891806587i, 0.1373761977256101 + -1.0923389546563616e-20i, 0.0009383003270936919 + -0.016516954537673392i, 0.0008848338558339582 + 7.92502453537833e-05i, 1.4075131933906288e-05 + -9.873694695666523e-05i, 0.009381170507998823 + 0.009201044697022147i, 0.0011703307776585836 + -0.0010650682284437903i }, { 0.0005935066000422576 + 0.0007856122982441356i, 0.008047390506944441 + -0.0066078185875173i, 0.0009383003270936921 + 0.01651695453767339i, 0.15568413788793356 + -1.4381877442585542e-19i, -1.2088464272191106e-05 + 9.33993216467044e-05i, 0.00099211347322251 + 8.775411674621079e-05i, -0.001042181134533965 + 0.0011907572981917172i, 0.01063138641989968 + 0.010427255485592701i }, { 0.007060108311691401 + -0.006924548710238438i, -0.0007868514833386908 + -0.000900319918361138i, 0.0008848338558339586 + -7.925024535378357e-05i, -1.2088464272191005e-05 + -9.339932164670442e-05i, 0.09790198207032769 + -1.2556171337403276e-19i, 0.0006797987223088928 + -0.011817921405114588i, 0.006803263740963391 + 0.0055736786641135145i, 0.0005620192760149291 + -0.0007439331846624058i }, { 0.0008848975597950904 + 0.0008041564032567286i, 0.008001828834007898 + -0.007848187461985793i, 1.4075131933906288e-05 + 9.873694695666523e-05i, 0.00099211347322251 + -8.7754116746211e-05i, 0.0006797987223088929 + 0.011817921405114588i, 0.11096074853973356 + 1.4040663206381755e-19i, -0.0005849790390764539 + 0.000795430709012956i, 0.007620452049227936 + 0.006257253783412093i }, { 9.638793086492274e-05 + -0.000883131315604992i, -9.8445545864487e-05 + -1.5986510961537813e-05i, 0.009381170507998826 + -0.009201044697022145i, -0.0010421811345339648 + -0.0011907572981917172i, 0.006803263740963391 + -0.0055736786641135145i, -0.0005849790390764537 + -0.000795430709012956i, 0.13008797405443157 + 3.3772107325999056e-21i, 0.0008885206507901022 + -0.015640680037212314i }, { 9.31474352555046e-05 + 1.3896746304303272e-05i, 0.00010696982854255398 + -0.000990225926007351i, 0.0011703307776585836 + 0.0010650682284437903i, 0.010631386419899679 + -0.010427255485592701i, 0.0005620192760149291 + 0.0007439331846624058i, 0.007620452049227935 + -0.006257253783412094i, 0.0008885206507901024 + 0.015640680037212317i, 0.14742462250049954 + 1.1052687856026888e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.10338697442543729, 1.0e-7), DoubleNear(0.11717736279602593, 1.0e-7), DoubleNear(0.1373761977256101, 1.0e-7), DoubleNear(0.15568413788793356, 1.0e-7), DoubleNear(0.09790198207032769, 1.0e-7), DoubleNear(0.11096074853973356, 1.0e-7), DoubleNear(0.13008797405443157, 1.0e-7), DoubleNear(0.14742462250049954, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true, false}), Matrix({ { 0.10204932660273841 + -4.6193627651534276e-20i, 0.0007074810715902015 + -0.012376814496815164i, 0.01632687600705633 + 0.029434899833114977i, 0.0034133343710259115 + -0.0015830993529849739i, -0.0018160422527519287 + -0.008402834158771345i, -0.0011117608982902192 + 4.7646794286699615e-05i, 0.0030420130558675143 + 0.0025425611806441026i, 4.422190331961394e-05 + -0.00040874324416592797i }, { 0.0007074810715902016 + 0.012376814496815165i, 0.1156915454128584 + 1.0469230416004703e-19i, -0.0034883598621893524 + 0.0019281272813663913i, 0.01827324352942475 + 0.033360464564510084i, 0.0010822092267813261 + -0.00026312994293905374i, -0.0020262039529691887 + -0.009546648089383042i, -4.149954101235672e-06 + 0.00021157500502175935i, 0.0034076134610509607 + 0.0026053981919191872i }, { 0.01632687600705633 + -0.02943489983311498i, -0.003488359862189352 + -0.001928127281366391i, 0.14529198798534626 + 7.861418566847377e-20i, 0.0009313053963648109 + -0.017156702040178533i, -0.006307886094059903 + 0.002036523353095138i, 0.00014302212209432806 + 0.0011277500143485816i, -0.0034174929658994215 + 0.004564653694728412i, 0.0007465767349046545 + 0.00037051747731729507i }, { 0.003413334371025911 + 0.0015830993529849739i, 0.01827324352942475 + -0.033360464564510084i, 0.0009313053963648111 + 0.017156702040178533i, 0.1644261758285041 + 2.325219419692174e-20i, -0.00048445230026635276 + -0.001096245340535759i, -0.007411925792533247 + 0.002400330675013033i, -0.0008264143784059025 + -0.0002243076150985464i, -0.00388991555681208 + 0.005312316088048868i }, { -0.0018160422527519291 + 0.008402834158771345i, 0.0010822092267813263 + 0.00026312994293905385i, -0.006307886094059903 + -0.0020365233530951384i, -0.0004844523002663527 + 0.0010962453405357587i, 0.09923962989302654 + 3.383453220502182e-20i, 0.0006902023312076655 + -0.011921131441354526i, -0.002339193324592615 + -0.017975275232908317i, -0.0022578084949687245 + 5.355387007843256e-05i }, { -0.0011117608982902194 + -4.7646794286699514e-05i, -0.0020262039529691882 + 0.00954664808938304i, 0.00014302212209432816 + -0.0011277500143485816i, -0.007411925792533247 + -0.0024003306750130333i, 0.0006902023312076655 + 0.011921131441354526i, 0.1124465659229011 + 2.6431897113411127e-20i, 0.0022856281313546343 + -0.0002927015831727766i, -0.002605400973252371 + -0.020495392193580694i }, { 0.003042013055867514 + -0.0025425611806441026i, -4.149954101235767e-06 + -0.0002115750050217593i, -0.003417492965899421 + -0.004564653694728412i, -0.0008264143784059025 + 0.0002243076150985465i, -0.0023391933245926156 + 0.017975275232908317i, 0.0022856281313546347 + 0.00029270158317277654i, 0.1221721837946954 + -8.616036448243748e-20i, 0.0008955155815189832 + -0.015000932534707174i }, { 4.422190331961385e-05 + 0.00040874324416592797i, 0.0034076134610509607 + -0.0026053981919191872i, 0.0007465767349046545 + -0.00037051747731729507i, -0.0038899155568120794 + -0.005312316088048868i, -0.002257808494968724 + -5.3553870078432615e-05i, -0.002605400973252371 + 0.020495392193580694i, 0.0008955155815189833 + 0.015000932534707174i, 0.13868258455992893 + -5.654409006250827e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.10204932660273841, 1.0e-7), DoubleNear(0.1156915454128584, 1.0e-7), DoubleNear(0.14529198798534626, 1.0e-7), DoubleNear(0.1644261758285041, 1.0e-7), DoubleNear(0.09923962989302654, 1.0e-7), DoubleNear(0.1124465659229011, 1.0e-7), DoubleNear(0.1221721837946954, 1.0e-7), DoubleNear(0.13868258455992893, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, true}), Matrix({ { 0.11007261501583002 + -1.2139349436456e-19i, 0.0007643075397105639 + -0.013287060032942614i, 0.007649007862499474 + 0.0062665675693491i, 0.0006318864040549014 + -0.0008364148437160575i, 0.004764565078891725 + -0.000878442307802222i, -7.295477321812782e-05 + -0.0005812386877875964i, 0.0003811030910950734 + 0.00021020902322505143i, 2.0676548010285523e-05 + -4.1247577394523544e-05i }, { 0.0007643075397105641 + 0.013287060032942614i, 0.12475477510872765 + -1.4256931804591754e-19i, -0.0006577003978769109 + 0.0008943142554770421i, 0.008567784501632533 + 0.007035120966837028i, 0.00013912187595689518 + 0.0005690394667741328i, 0.0054000919740350576 + -0.0009956143273247148i, -2.133185324322638e-05 + 4.3959801680540756e-05i, 0.00042700643326194 + 0.0002361439972173492i }, { 0.007649007862499474 + -0.0062665675693491i, -0.0006577003978769104 + -0.0008943142554770421i, 0.14625979151266438 + -8.676485242318432e-20i, 0.0009989766239643437 + -0.01758504287569106i, 0.0002810815175760668 + -0.00033229592228100745i, -3.560612988085687e-05 + -3.3462152373847303e-05i, 0.006330950663677847 + -0.001167236635348214i, -9.709732532307293e-05 + -0.0007691524773455358i }, { 0.0006318864040549016 + 0.0008364148437160575i, 0.008567784501632533 + -0.007035120966837028i, 0.000998976623964344 + 0.01758504287569106i, 0.16575163620992506 + -2.928056168427929e-19i, 3.402668392716732e-05 + 3.116194890342233e-05i, 0.0003147178699914598 + -0.00037289562048502213i, 0.0001835800374215391 + 0.0007532076698042681i, 0.007174667900289268 + -0.0013227926838414899i }, { 0.004764565078891726 + 0.0008784423078022219i, 0.00013912187595689518 + -0.0005690394667741329i, 0.00028108151757606683 + 0.00033229592228100735i, 3.40266839271673e-05 + -3.116194890342233e-05i, 0.09121634147993495 + 1.0903439891804757e-19i, 0.0006333758630873031 + -0.011010885905227075i, 0.006338674819964239 + 0.0051930570308575605i, 0.0005236394720022856 + -0.0006931306391904839i }, { -7.295477321812782e-05 + 0.0005812386877875964i, 0.0054000919740350576 + 0.0009956143273247148i, -3.5606129880856874e-05 + 3.3462152373847303e-05i, 0.00031471786999145984 + 0.00037289562048502213i, 0.0006333758630873031 + 0.011010885905227077i, 0.10338333622703183 + 2.736935193193757e-19i, -0.000545031332957807 + 0.0007411114427165726i, 0.007100058054539844 + 0.005829951404092364i }, { 0.0003811030910950735 + -0.00021020902322505143i, -2.1331853243226388e-05 + -4.395980168054075e-05i, 0.006330950663677847 + 0.0011672366353482138i, 0.0001835800374215391 + -0.0007532076698042681i, 0.006338674819964239 + -0.005193057030857562i, -0.000545031332957807 + -0.0007411114427165725i, 0.12120438026737729 + 7.92186736092206e-20i, 0.0008278443539194503 + -0.014572591699194646i }, { 2.0676548010285496e-05 + 4.124757739452354e-05i, 0.0004270064332619399 + -0.0002361439972173492i, -9.709732532307292e-05 + 0.0007691524773455358i, 0.0071746679002892685 + 0.0013227926838414897i, 0.0005236394720022851 + 0.0006931306391904839i, 0.0071000580545398425 + -0.005829951404092364i, 0.0008278443539194505 + 0.014572591699194648i, 0.137357124178508 + 2.595137209772064e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.11007261501583002, 1.0e-7), DoubleNear(0.12475477510872765, 1.0e-7), DoubleNear(0.14625979151266438, 1.0e-7), DoubleNear(0.16575163620992506, 1.0e-7), DoubleNear(0.09121634147993495, 1.0e-7), DoubleNear(0.10338333622703183, 1.0e-7), DoubleNear(0.12120438026737729, 1.0e-7), DoubleNear(0.137357124178508, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true, false}), Matrix({ { 0.1270406017838856 + 5.178784618396438e-20i, 0.0008417211634498304 + -0.015169142768980664i, 0.00867537147267567 + 0.008508797555198398i, 0.0010734631823335423 + -0.0009794971978873503i, -0.002688072814450288 + -0.0019713841851257685i, -0.0001875675964434365 + 0.00021477948719389093i, -5.152621433057814e-05 + -0.0003146612732606289i, -2.7193934084182597e-05 + 2.1041865853263678e-06i }, { 0.0008417211634498305 + 0.015169142768980666i, 0.14387537292788258 + -4.4117659555478204e-20i, -0.0009585039698171816 + 0.0010922491036112283i, 0.0098249873535899 + 0.009636339912058797i, 0.00013138254530970728 + -0.0002503599562745573i, -0.003038664947664208 + -0.0021748573888600666i, 2.5740232048166145e-05 + -8.297017862295317e-06i, -6.183948956816387e-05 + -0.0003520376950219995i }, { 0.008675371472675676 + -0.008508797555198398i, -0.0009585039698171816 + -0.001092249103611228i, 0.12030071280419907 + -1.93672881670249e-20i, 0.0007970653045051819 + -0.014364373768013031i, -0.0003156009856905263 + 4.541679738168316e-05i, 1.5766345353050774e-06 + 2.7229613947003004e-05i, -0.0025454624042010624 + -0.0018667962789171658i, -0.0001776165669421282 + 0.00020338478441010374i }, { 0.0010734631823335426 + 0.0009794971978873501i, 0.009824987353589897 + -0.009636339912058797i, 0.0007970653045051822 + 0.014364373768013033i, 0.13624234831347992 + 1.7206215791244698e-19i, -7.796482261364833e-06 + -2.5896233618982338e-05i, -0.00035317030780087516 + 5.500358964911694e-05i, 0.00012441230306571647 + -0.00023707760176304286i, -0.00287745456211706 + -0.0020594746124741074i }, { -0.002688072814450288 + 0.0019713841851257685i, 0.00013138254530970734 + 0.0002503599562745574i, -0.00031560098569052657 + -4.541679738168302e-05i, -7.796482261364823e-06 + 2.5896233618982345e-05i, 0.11372257036716177 + 5.049138219699231e-20i, 0.0008144638441328355 + -0.013827836301747828i, 0.00776590734701455 + 0.007616795852062185i, 0.0009817651551201315 + -0.0008897274338131686i }, { -0.00018756759644343655 + -0.00021477948719389085i, -0.0030386649476642075 + 0.002174857388860066i, 1.576634535305047e-06 + -2.7229613947002994e-05i, -0.00035317030780087494 + -5.5003589649117295e-05i, 0.0008144638441328358 + 0.013827836301747828i, 0.1289861277560769 + -1.0898354566073658e-19i, -0.0008705286480554741 + 0.0009988281129416268i, 0.008808227900317682 + 0.008639103035519697i }, { -5.152621433057817e-05 + 0.0003146612732606289i, 2.5740232048166168e-05 + 8.297017862295292e-06i, -0.0025454624042010624 + 0.0018667962789171654i, 0.0001244123030657165 + 0.00023707760176304297i, 0.007765907347014551 + -0.007616795852062185i, -0.0008705286480554741 + -0.000998828112941627i, 0.10768924332056018 + -1.0281721447440796e-19i, 0.000771254068593813 + -0.013094227674313872i }, { -2.719393408418259e-05 + -2.1041865853263678e-06i, -6.183948956816399e-05 + 0.0003520376950219993i, -0.00017761656694212824 + -0.00020338478441010371i, -0.00287745456211706 + 0.0020594746124741065i, 0.0009817651551201315 + 0.0008897274338131686i, 0.00880822790031768 + -0.008639103035519697i, 0.0007712540685938132 + 0.013094227674313872i, 0.12214302272675315 + 7.887135271163945e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1270406017838856, 1.0e-7), DoubleNear(0.14387537292788258, 1.0e-7), DoubleNear(0.12030071280419907, 1.0e-7), DoubleNear(0.13624234831347992, 1.0e-7), DoubleNear(0.11372257036716177, 1.0e-7), DoubleNear(0.1289861277560769, 1.0e-7), DoubleNear(0.10768924332056018, 1.0e-7), DoubleNear(0.12214302272675315, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, true}), Matrix({ { 0.13165864844020803 + -4.0022306757765715e-20i, 0.0009056662516826739 + -0.015856673756175648i, 0.008990729473654745 + 0.008818100435910133i, 0.0011238786344591255 + -0.0010221645878898816i, 0.00569893064321297 + -0.001050711177901106i, -8.734295347813068e-05 + -0.0006935942203907892i, 0.00045954307684991497 + 0.00030994608646781177i, 4.04903642425122e-05 + -5.3214255342633426e-05i }, { 0.0009056662516826741 + 0.015856673756175648i, 0.14921126047001504 + -3.415660359802966e-19i, -0.0010001860345613565 + 0.001143482193126867i, 0.010189365402138259 + 0.009993721617086813i, 0.00016574766468222918 + 0.0006791387529321063i, 0.006458706926428609 + -0.0011907910426086292i, -3.41680654671849e-05 + 5.7478429609658484e-05i, 0.0005208089445653467 + 0.0003512678186166665i }, { 0.008990729473654748 + -0.008818100435910133i, -0.0010001860345613565 + -0.0011434821931268668i, 0.12467375808828637 + -1.6813604002997862e-19i, 0.0008576179119922337 + -0.015015429152458026i, 0.00031879612546262097 + -0.0004534483944038393i, -5.241934688748465e-05 + -4.1514318494368394e-05i, 0.0053965850993566026 + -0.0009949677652493299i, -8.270914506307006e-05 + -0.0006567969447423428i }, { 0.0011238786344591255 + 0.0010221645878898814i, 0.010189365402138257 + -0.009993721617086813i, 0.0008576179119922339 + 0.015015429152458026i, 0.14129515084863764 + -9.380889890841381e-20i, 5.680527816384605e-05 + 3.527586910184319e-05i, 0.00036129773681246185 + -0.0005139017245633399i, 0.00015695424869620507 + 0.0006431083836462945i, 0.006116052947895716 + -0.0011276159685575757i }, { 0.00569893064321297 + 0.001050711177901106i, 0.0001657476646822292 + -0.0006791387529321063i, 0.000318796125462621 + 0.0004534483944038393i, 5.680527816384605e-05 + -3.527586910184317e-05i, 0.10910452371083935 + 1.423015351387224e-19i, 0.000750518755899992 + -0.013140305314552844i, 0.007450549346035475 + 0.007307492971350449i, 0.0009313497029945486 + -0.0008470600438106374i }, { -8.734295347813067e-05 + 0.0006935942203907892i, 0.00645870692642861 + 0.0011907910426086287i, -5.241934688748464e-05 + 4.1514318494368394e-05i, 0.0003612977368124619 + 0.00051390172456334i, 0.0007505187558999922 + 0.013140305314552845i, 0.12365024021394443 + 1.8846483076408183e-19i, -0.0008288465833112991 + 0.0009475950234259881i, 0.008443849851769323 + 0.008281721330491681i }, { 0.000459543076849915 + -0.0003099460864678116i, -3.41680654671849e-05 + -5.7478429609658484e-05i, 0.005396585099356603 + 0.0009949677652493299i, 0.00015695424869620507 + -0.0006431083836462946i, 0.007450549346035478 + -0.007307492971350449i, -0.0008288465833112991 + -0.0009475950234259881i, 0.10331619803647288 + 4.5951537388545763e-20i, 0.0007107014611067613 + -0.01244317228986888i }, { 4.0490364242512197e-05 + 5.321425534263344e-05i, 0.0005208089445653469 + -0.00035126781861666637i, -8.270914506307007e-05 + 0.0006567969447423428i, 0.006116052947895716 + 0.0011276159685575757i, 0.0009313497029945486 + 0.0008470600438106375i, 0.00844384985176932 + -0.008281721330491681i, 0.0007107014611067614 + 0.01244317228986888i, 0.11709022019159543 + 3.4474240953250024e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.13165864844020803, 1.0e-7), DoubleNear(0.14921126047001504, 1.0e-7), DoubleNear(0.12467375808828637, 1.0e-7), DoubleNear(0.14129515084863764, 1.0e-7), DoubleNear(0.10910452371083935, 1.0e-7), DoubleNear(0.12365024021394443, 1.0e-7), DoubleNear(0.10331619803647288, 1.0e-7), DoubleNear(0.11709022019159543, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, true}), Matrix({ { 0.13525583207410766 + -9.471506393271629e-20i, 0.000896152054840421 + -0.016150073269958817i, -0.002861900212128717 + -0.002098866067641254i, -0.00019969687620226175 + 0.000228668455949842i, 0.005854637087744828 + -0.001079418756916075i, -9.009627732694129e-05 + -0.000706218281373662i, -0.00014062937052946093 + -6.801119191213619e-05i, -6.819104973957112e-06 + 1.1491758640174062e-05i }, { 0.0008961520548404213 + 0.016150073269958817i, 0.15317924354166348 + -1.8958275402519792e-19i, 0.0001398785524970071 + -0.00026654977801158174i, -0.0032351637989712348 + -0.002315497105981926i, 0.00016767733207440378 + 0.0006919146713598083i, 0.00663046366695931 + -0.0012224578128246153i, 3.927515161789582e-06 + -1.2654092049757466e-05i, -0.00015851516819194184 + -7.440935146831882e-05i }, { -0.002861900212128717 + 0.002098866067641254i, 0.00013987855249700707 + 0.00026654977801158174i, 0.12107657445438674 + -1.1344328285502805e-19i, 0.0008671321088344866 + -0.014722029638674857i, -0.00010712907162293634 + 0.0001136903869904119i, 8.181953963066158e-06 + 1.042147063979399e-05i, 0.005240878654824744 + -0.0009662601862343611i, -7.995582121425945e-05 + -0.0006441728837594702i }, { -0.00019969687620226186 + -0.00022866845594984191i, -0.0032351637989712343 + 0.002315497105981926i, 0.0008671321088344867 + 0.014722029638674857i, 0.13732716777698922 + -2.457921808635125e-19i, -1.046891462256518e-05 + -8.304368483834425e-06i, -0.00012155719056607 + 0.00012604625958170904i, 0.00015502458130403046 + 0.0006303324652185925i, 0.005944296207365016 + -0.0010959491983415896i }, { 0.005854637087744829 + 0.0010794187569160747i, 0.00016767733207440378 + -0.0006919146713598083i, -0.00010712907162293634 + -0.00011369038699041186i, -1.0468914622565177e-05 + 8.304368483834425e-06i, 0.11208548251397704 + 1.2713562194965577e-19i, 0.0007426344131145912 + -0.013383443267034879i, -0.002371635006522633 + -0.0017393143964016804i, -0.00016548728718330293 + 0.00018949581565415267i }, { -9.009627732694129e-05 + 0.000706218281373662i, 0.00663046366695931 + 0.001222457812824615i, 8.18195396306616e-06 + -1.042147063979399e-05i, -0.00012155719056607 + -0.00012604625958170904i, 0.0007426344131145914 + 0.013383443267034882i, 0.12693847769969901 + 3.175272523821667e-19i, 0.00011591629587841666 + -0.00022088778002601845i, -0.0026809557108100337 + -0.001918834895352248i }, { -0.00014062937052946093 + 6.801119191213618e-05i, 3.927515161789578e-06 + 1.2654092049757463e-05i, 0.005240878654824744 + 0.0009662601862343611i, 0.0001550245813040305 + -0.0006303324652185926i, -0.002371635006522633 + 0.0017393143964016798i, 0.00011591629587841677 + 0.0002208877800260186i, 0.1003352392333352 + 6.111745057761241e-20i, 0.000718585803892162 + -0.012200034337386843i }, { -6.819104973957104e-06 + -1.1491758640174062e-05i, -0.00015851516819194184 + 7.440935146831879e-05i, -7.995582121425945e-05 + 0.0006441728837594702i, 0.005944296207365016 + 0.0010959491983415894i, -0.00016548728718330293 + -0.00018949581565415265i, -0.0026809557108100333 + 0.0019188348953522471i, 0.0007185858038921621 + 0.012200034337386843i, 0.11380198270584084 + 2.1567998791441537e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.13525583207410766, 1.0e-7), DoubleNear(0.15317924354166348, 1.0e-7), DoubleNear(0.12107657445438674, 1.0e-7), DoubleNear(0.13732716777698922, 1.0e-7), DoubleNear(0.11208548251397704, 1.0e-7), DoubleNear(0.12693847769969901, 1.0e-7), DoubleNear(0.1003352392333352, 1.0e-7), DoubleNear(0.11380198270584084, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false, false}), Matrix({ { 0.13023897271716167 + 1.4558778957150299e-19i, 0.0362362906890954 + -0.044232525464380834i, 0.058696937454983805 + -0.0006218757576011377i, 0.016119999329647857 + -0.02010802294234151i, 0.009329209871451149 + 0.0072705555738097755i, 0.005255759280655033 + -0.000604485827431364i, 0.004239264323618831 + 0.0032321948456738533i, 0.00236581303019265 + -0.000297529190235108i }, { 0.0362362906890954 + 0.044232525464380834i, 0.13174236493567773 + -1.9640393134260687e-19i, 0.016542409530064753 + 0.019761974900733045i, 0.05937449592446119 + -0.0006290542784029851i, 0.0011524524492193514 + 0.005317630412398123i, 0.008762789335882194 + 0.007569255718659424i, 0.0005447857372701364 + 0.0023910810334905217i, 0.0039854125334758414 + 0.0033695195384795392i }, { 0.05869693745498381 + 0.0006218757576011378i, 0.016542409530064753 + -0.019761974900733045i, 0.0832424174932852 + 1.3884338257985638e-21i, 0.02316047474130799 + -0.02827127913151281i, 0.004169832230270504 + 0.003321286602704647i, 0.0023715857274744286 + -0.000247337926955958i, 0.005962777245550886 + 0.0046469855363305956i, 0.00335922573064679 + -0.00038635794314112405i }, { 0.016119999329647854 + 0.02010802294234151i, 0.05937449592446119 + 0.0006290542784029849i, 0.023160474741307994 + 0.028271279131512814i, 0.08420331268539985 + 1.6819281377225107e-19i, 0.0004940036192549015 + 0.002402086682951747i, 0.0039131279240948915 + 0.0034532021128005955i, 0.0007365915587142468 + 0.0033987707490993327i, 0.005600748785751863 + 0.004837900142336258i }, { 0.009329209871451147 + -0.007270555573809776i, 0.0011524524492193514 + -0.005317630412398125i, 0.004169832230270504 + -0.0033212866027046476i, 0.0004940036192549015 + -0.002402086682951747i, 0.17250269335094226 + -1.6104614085889397e-19i, 0.0486025837891008 + -0.05824583055829535i, 0.07774462275916189 + -0.0008236800465926761i, 0.021626407918086774 + -0.02648267695875783i }, { 0.005255759280655033 + 0.0006044858274313638i, 0.008762789335882194 + -0.007569255718659424i, 0.0023715857274744286 + 0.000247337926955958i, 0.0039131279240948915 + -0.0034532021128005955i, 0.0486025837891008 + 0.05824583055829535i, 0.17558775365517088 + 6.574909922863098e-20i, 0.0221826418816978 + 0.026018533730588204i, 0.0791350175691349 + -0.0008384108462443578i }, { 0.004239264323618832 + -0.0032321948456738533i, 0.0005447857372701366 + -0.0023910810334905217i, 0.005962777245550887 + -0.004646985536330594i, 0.0007365915587142467 + -0.0033987707490993327i, 0.07774462275916187 + 0.0008236800465926761i, 0.022182641881697798 + -0.026018533730588204i, 0.11025533232529194 + -6.110425660722676e-20i, 0.03106440788511831 + -0.03722790224325748i }, { 0.00236581303019265 + 0.0002975291902351082i, 0.003985412533475842 + -0.003369519538479539i, 0.003359225730646789 + 0.00038635794314112394i, 0.005600748785751862 + -0.004837900142336259i, 0.021626407918086777 + 0.026482676958757834i, 0.0791350175691349 + 0.0008384108462443584i, 0.03106440788511831 + 0.03722790224325748i, 0.11222715283706967 + 1.1556322355793945e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13023897271716167, 1.0e-7), DoubleNear(0.13174236493567773, 1.0e-7), DoubleNear(0.0832424174932852, 1.0e-7), DoubleNear(0.08420331268539985, 1.0e-7), DoubleNear(0.17250269335094226, 1.0e-7), DoubleNear(0.17558775365517088, 1.0e-7), DoubleNear(0.11025533232529194, 1.0e-7), DoubleNear(0.11222715283706967, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false, false}), Matrix({ { 0.1554955891877549 + -1.7448878713438587e-19i, 0.04357533914755377 + -0.05263541208481645i, 0.07007975172608852 + -0.0007424731269937935i, 0.01938748607331465 + -0.023930132993856153i, 0.010618510772336841 + 0.010414627060533404i, 0.006501042251216432 + -0.0006758312857613458i, 0.0048353473128965145 + 0.004643028934750544i, 0.0029267044984053955 + -0.0003356296995720027i }, { 0.04357533914755377 + 0.05263541208481645i, 0.1578523316135686 + 1.2218450264143278e-19i, 0.019890141861885376 + 0.023513998767982602i, 0.07114190355268432 + -0.0007537262945437748i, -0.0005496810510240253 + 0.006512921696217464i, 0.010779448423152834 + 0.010572474582580794i, -0.00021663535552747016 + 0.0029379100801346283i, 0.004908633431270506 + 0.004713400212366621i }, { 0.07007975172608852 + 0.0007424731269937935i, 0.01989014186188538 + -0.023513998767982602i, 0.09938521844487677 + -1.2091395322055137e-19i, 0.02785123759851488 + -0.033641995604577195i, 0.004735890077350476 + 0.004744433211725046i, 0.0029331585280107444 + -0.00027354627721651423i, 0.0067868356792662 + 0.006656523126088436i, 0.004155150044007801 + -0.0004319584903863159i }, { 0.01938748607331465 + 0.023930132993856157i, 0.07114190355268432 + 0.0007537262945437749i, 0.02785123759851488 + 0.033641995604577195i, 0.10089153358880659 + 1.2239626087824635e-19i, -0.00027883222378483833 + 0.002932660755559766i, 0.004807668789065602 + 0.004816341406001932i, -0.0003513293953635457 + 0.004162742807523465i, 0.006889699198841923 + 0.0067574115856364435i }, { 0.010618510772336843 + -0.010414627060533402i, -0.0005496810510240248 + -0.0065129216962174635i, 0.0047358900773504745 + -0.0047444332117250465i, -0.00027883222378483855 + -0.002932660755559765i, 0.14724607688034902 + 1.590304358469949e-19i, 0.041263535330642434 + -0.049842943937859735i, 0.06636180848805716 + -0.0007030826772000203i, 0.018358921174419982 + -0.022660566907243187i }, { 0.006501042251216432 + 0.0006758312857613459i, 0.010779448423152834 + -0.010572474582580796i, 0.002933158528010745 + 0.0002735462772165144i, 0.004807668789065604 + -0.004816341406001932i, 0.041263535330642434 + 0.04984294393785973i, 0.14947778697728 + -2.528393347554087e-19i, 0.018834909549877175 + 0.022266509863338644i, 0.06736760994091176 + -0.0007137388301035682i }, { 0.0048353473128965145 + -0.004643028934750543i, -0.00021663535552747022 + -0.0029379100801346283i, 0.006786835679266203 + -0.006656523126088434i, -0.0003513293953635457 + -0.004162742807523465i, 0.06636180848805716 + 0.0007030826772000203i, 0.018834909549877175 + -0.022266509863338644i, 0.09411253137370038 + 6.119813043912319e-20i, 0.02637364502791142 + -0.0318571857701931i }, { 0.0029267044984053955 + 0.0003356296995720025i, 0.004908633431270506 + -0.004713400212366622i, 0.004155150044007801 + 0.00043195849038631605i, 0.006889699198841923 + -0.0067574115856364435i, 0.018358921174419982 + 0.022660566907243187i, 0.06736760994091176 + 0.0007137388301035684i, 0.02637364502791142 + 0.0318571857701931i, 0.09553893193366293 + 1.6135977645194421e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1554955891877549, 1.0e-7), DoubleNear(0.1578523316135686, 1.0e-7), DoubleNear(0.09938521844487677, 1.0e-7), DoubleNear(0.10089153358880659, 1.0e-7), DoubleNear(0.14724607688034902, 1.0e-7), DoubleNear(0.14947778697728, 1.0e-7), DoubleNear(0.09411253137370038, 1.0e-7), DoubleNear(0.09553893193366293, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true, false}), Matrix({ { 0.15975443886856242 + -3.461824799923036e-20i, 0.045242682146642337 + -0.0535712336129891i, 0.07199915747790919 + -0.0007628086326915633i, 0.02013446649693154 + -0.024359856422498813i, -0.002751165211402962 + -0.002740829409129281i, -0.0018250601386045218 + -8.343386490918155e-05i, -0.0012529999607851726 + -0.001222118127405507i, -0.0008229282223989843 + -2.8888063344987484e-05i }, { 0.045242682146642337 + 0.0535712336129891i, 0.16203343645439908 + 3.610084178060323e-20i, 0.020646059160689022 + 0.023927799463681246i, 0.07302627076024765 + -0.0007736905777859951i, -0.00045087902061994174 + -0.0010973372452326656i, -0.00405092454710306 + -0.0021839826773049757i, -0.00020844471157471615 + -0.0004924021095988042i, -0.0018361249760279537 + -0.0009649486648957832i }, { 0.07199915747790919 + 0.0007628086326915633i, 0.020646059160689022 + -0.023927799463681246i, 0.10210726804166548 + -1.0681119799718088e-20i, 0.028916922156209085 + -0.034240127213896056i, -0.0012268256854557852 + -0.0012483911072122904i, -0.0008221314486396786 + -4.6316957825399366e-05i, -0.0017584110066497043 + -0.001751804864493913i, -0.0011664896830689733 + -5.3326868839263173e-05i }, { 0.02013446649693154 + 0.024359856422498813i, 0.07302627076024765 + 0.0007736905777859953i, 0.02891692215620909 + 0.034240127213896056i, 0.10356389246482023 + 1.6956358239225347e-19i, -0.0001979653993306773 + -0.0004967078980534381i, -0.0018152684558373918 + -0.0010036340402355542i, -0.00028817994253469076 + -0.000701364600724868i, -0.002589153963276893 + -0.0013958955144489382i }, { -0.002751165211402961 + 0.002740829409129281i, -0.00045087902061994217 + 0.0010973372452326652i, -0.0012268256854557854 + 0.0012483911072122906i, -0.00019796539933067723 + 0.0004967078980534382i, 0.1429872271995415 + 1.9159896711839402e-20i, 0.03959619233155387 + -0.04890712240968709i, 0.06444240273623648 + -0.0006827471715022504i, 0.017611940750803086 + -0.022230843478600527i }, { -0.0018250601386045214 + 8.343386490918114e-05i, -0.00405092454710306 + 0.0021839826773049752i, -0.0008221314486396787 + 4.6316957825399366e-05i, -0.0018152684558373914 + 0.0010036340402355538i, 0.03959619233155387 + 0.04890712240968709i, 0.14529668213644953 + -1.6675567389457913e-19i, 0.01807899225107353 + 0.021852709167640004i, 0.06548324273334843 + -0.000693774546861348i }, { -0.0012529999607851722 + 0.0012221181274055066i, -0.00020844471157471615 + 0.0004924021095988041i, -0.0017584110066497039 + 0.0017518048644939127i, -0.0002881799425346907 + 0.0007013646007248676i, 0.06444240273623648 + 0.0006827471715022505i, 0.01807899225107353 + -0.02185270916764i, 0.0913904817769117 + -4.9034702981710134e-20i, 0.025307960470217217 + -0.03125905416087424i }, { -0.0008229282223989843 + 2.888806334498735e-05i, -0.0018361249760279537 + 0.0009649486648957833i, -0.0011664896830689735 + 5.3326868839263065e-05i, -0.002589153963276893 + 0.0013958955144489382i, 0.017611940750803086 + 0.02223084347860053i, 0.06548324273334843 + 0.0006937745468613481i, 0.025307960470217213 + 0.03125905416087424i, 0.09286657305764931 + 1.1419245493793707e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.15975443886856242, 1.0e-7), DoubleNear(0.16203343645439908, 1.0e-7), DoubleNear(0.10210726804166548, 1.0e-7), DoubleNear(0.10356389246482023, 1.0e-7), DoubleNear(0.1429872271995415, 1.0e-7), DoubleNear(0.14529668213644953, 1.0e-7), DoubleNear(0.0913904817769117, 1.0e-7), DoubleNear(0.09286657305764931, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, true}), Matrix({ { 0.16555089478575782 + -3.1213164106320967e-19i, 0.04639318982713935 + -0.05603914306235935i, 0.07461154149272382 + -0.0007904860270974282i, 0.02064120071732821 + -0.025477603256588377i, 0.007165978676549681 + -0.0013211906526742327i, 0.0015609351877859496 + -0.0027959350723132555i, 0.0032233008060865926 + -0.0006296594008204702i, 0.0006901420440612314 + -0.0012675432735387683i }, { 0.04639318982713935 + 0.05603914306235935i, 0.16806003873904332 + -1.270549420881451e-19i, 0.021176361335078248 + 0.025034559220392848i, 0.07574237861942161 + -0.0008024668939940703i, 0.002455383896065993 + 0.0020554467913325974i, 0.007274588612418078 + -0.001341215053880791i, 0.0011164227148942273 + 0.0009146378042387018i, 0.003272154216016384 + -0.0006392027263352165i }, { 0.07461154149272382 + 0.0007904860270974278i, 0.021176361335078248 + -0.025034559220392844i, 0.10581208076687385 + -3.8095306802762163e-19i, 0.029652270713335288 + -0.03581749491293529i, 0.003235917865649119 + -0.0005612259922107335i, 0.0007168425654953856 + -0.0012526367101312276i, 0.004580145069454507 + -0.0008444408121751279i, 0.0009976738596043596 + -0.001787025724466193i }, { 0.02064120071732821 + 0.02547760325658838i, 0.07574237861942161 + 0.0008024668939940704i, 0.029652270713335288 + 0.03581749491293529i, 0.10741580355547212 + 1.7660636950252157e-19i, 0.0010967936821415704 + 0.0009380861421472589i, 0.0032849625038942295 + -0.0005697321184180523i, 0.0015693619745181064 + 0.0013137416271772817i, 0.004649563258471632 + -0.0008572394355864891i }, { 0.007165978676549681 + 0.0013211906526742324i, 0.0024553838960659933 + -0.0020554467913325974i, 0.003235917865649119 + 0.0005612259922107333i, 0.0010967936821415702 + -0.0009380861421472588i, 0.13719077128234608 + 2.966732897758187e-19i, 0.038445684651056855 + -0.046439212960316834i, 0.06183001872142186 + -0.0006550697770963856i, 0.017105206530406425 + -0.021113096644510963i }, { 0.0015609351877859498 + 0.002795935072313255i, 0.00727458861241808 + 0.001341215053880791i, 0.0007168425654953856 + 0.0012526367101312276i, 0.0032849625038942295 + 0.0005697321184180522i, 0.038445684651056855 + 0.046439212960316834i, 0.13927007985180528 + -3.5998900258308005e-21i, 0.017548690076684303 + 0.020745949410928402i, 0.06276713487417447 + -0.0006649982306532727i }, { 0.0032233008060865926 + 0.0006296594008204702i, 0.0011164227148942273 + -0.0009146378042387019i, 0.004580145069454507 + 0.0008444408121751279i, 0.0015693619745181064 + -0.0013137416271772817i, 0.06183001872142186 + 0.000655069777096386i, 0.017548690076684303 + -0.020745949410928402i, 0.08768566905170332 + 3.212372452461934e-19i, 0.024572611913091014 + -0.029681686461835i }, { 0.0006901420440612315 + 0.0012675432735387683i, 0.003272154216016384 + 0.0006392027263352165i, 0.0009976738596043598 + 0.001787025724466193i, 0.004649563258471632 + 0.000857239435586489i, 0.017105206530406425 + 0.021113096644510963i, 0.06276713487417447 + 0.0006649982306532729i, 0.024572611913091014 + 0.029681686461835003i, 0.08901466196699742 + 1.0714966782766896e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.16555089478575782, 1.0e-7), DoubleNear(0.16806003873904332, 1.0e-7), DoubleNear(0.10581208076687385, 1.0e-7), DoubleNear(0.10741580355547212, 1.0e-7), DoubleNear(0.13719077128234608, 1.0e-7), DoubleNear(0.13927007985180528, 1.0e-7), DoubleNear(0.08768566905170332, 1.0e-7), DoubleNear(0.08901466196699742, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false, false}), Matrix({ { 0.1096493092032033 + -1.1724569807962673e-20i, 0.030507644211648612 + -0.03723974291485917i, 0.007854341879967317 + 0.006121143153693598i, 0.0044248688579083895 + -0.0005089218074908991i, 0.0074877517557597455 + 0.007343981065711177i, 0.004577517514847053 + -0.0004997239776808097i, 0.00012638294651859391 + 0.000944061929789195i, 0.00033625229329646995 + 0.0002616110686113818i }, { 0.030507644211648616 + 0.03723974291485917i, 0.11091502801825993 + 1.1564475694512356e-19i, 0.0009702596105458255 + 0.004476958694872808i, 0.007377467568477448 + 0.006372621369916852i, -0.00041089452068792347 + 0.004586344551543125i, 0.0075741853899395535 + 0.007428755106513054i, -0.00023359597037900327 + 0.0003707084324748585i, 7.697481288888305e-05 + 0.0009292953118231484i }, { 0.007854341879967317 + -0.006121143153693597i, 0.0009702596105458255 + -0.004476958694872808i, 0.1452314984294284 + -2.836781705469746e-19i, 0.04091893253442004 + -0.04903766477453447i, 0.0009463344764990508 + 0.0001080584797102416i, 0.0003661104961010683 + -0.00024073828928922896i, 0.009917594695843298 + 0.009727169120910664i, 0.0060786747803771805 + -0.000608065798466852i }, { 0.00442486885790839 + 0.0005089218074908987i, 0.007377467568477448 + -0.006372621369916851i, 0.04091893253442004 + 0.04903766477453447i, 0.14782883718411527 + 1.2893600657455552e-19i, 0.0002680801881496101 + 0.000331117756528994i, 0.0009306128525574177 + 5.8945882389752546e-05i, -0.0004901159256996475 + 0.006089319952197804i, 0.010094962232055204 + 0.009901131061704184i }, { 0.007487751755759745 + -0.007343981065711176i, -0.0004108945206879231 + -0.0045863445515431246i, 0.0009463344764990504 + -0.00010805847971024181i, 0.0002680801881496101 + -0.0003311177565289939i, 0.10383208100724357 + 1.5870079320526425e-19i, 0.02888912121875478 + -0.03526406168103448i, 0.007437645237034718 + 0.005796397956446774i, 0.004190116153393432 + -0.00048192196308158904i }, { 0.004577517514847053 + 0.0004997239776808095i, 0.0075741853899395535 + -0.007428755106513054i, 0.0003661104961010682 + 0.000240738289289229i, 0.0009306128525574177 + -5.894588238975287e-05i, 0.02888912121875478 + 0.03526406168103448i, 0.10503064960281765 + -1.4385587451547941e-19i, 0.0009187843973877725 + 0.004239442466624646i, 0.006986070553156609 + 0.006034534491078831i }, { 0.00012638294651859375 + -0.000944061929789195i, -0.00023359597037900321 + -0.0003707084324748583i, 0.0099175946958433 + -0.009727169120910662i, -0.0004901159256996475 + -0.006089319952197803i, 0.007437645237034716 + -0.005796397956446774i, 0.0009187843973877728 + -0.004239442466624648i, 0.1375265272468058 + 6.152777308085382e-20i, 0.038748059139799076 + -0.04643606802701836i }, { 0.0003362522932964701 + -0.00026161106861138185i, 7.6974812888883e-05 + -0.0009292953118231483i, 0.0060786747803771805 + 0.0006080657984668524i, 0.010094962232055204 + -0.009901131061704184i, 0.004190116153393433 + 0.00048192196308158904i, 0.006986070553156609 + -0.0060345344910788315i, 0.038748059139799076 + 0.04643606802701836i, 0.13998606930812527 + 5.237631621201491e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.1096493092032033, 1.0e-7), DoubleNear(0.11091502801825993, 1.0e-7), DoubleNear(0.1452314984294284, 1.0e-7), DoubleNear(0.14782883718411527, 1.0e-7), DoubleNear(0.10383208100724357, 1.0e-7), DoubleNear(0.10503064960281765, 1.0e-7), DoubleNear(0.1375265272468058, 1.0e-7), DoubleNear(0.13998606930812527, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true, false}), Matrix({ { 0.10827699678394631 + 1.3143718403409652e-19i, 0.030073915855615176 + -0.03695961214232094i, 0.017216466432057754 + 0.0300889027958815i, 0.01623970239954224 + 0.004454852826360365i, -0.001870151005738635 + -0.009755960004311061i, -0.004304996304521156 + -0.001158698010821069i, 0.0033016917322148892 + 0.003009438658758479i, 0.0010288680795530823 + 0.001026538010705479i }, { 0.030073915855615176 + 0.03695961214232094i, 0.10946387523165049 + -7.293850752558376e-20i, -0.003171691110090878 + 0.014580642539371105i, 0.017383653104423323 + 0.03270646160174357i, 0.003163206103429868 + -0.0020212989180259924i, -0.0019720951999824825 + -0.008193522243843326i, 0.0007922784956601117 + 0.0029396442932539506i, 0.0031479347847035858 + 0.002138520713804811i }, { 0.017216466432057754 + -0.0300889027958815i, -0.0031716911100908777 + -0.014580642539371106i, 0.15358471012628155 + -1.7673655183304495e-19i, 0.044085688447236246 + -0.05085174868456421i, -0.007211769887373611 + 0.0014731747634806145i, 0.0004530061257008222 + 0.004517832691402965i, -0.002639425212314031 + 0.005263325730687867i, 0.0013134464828476605 + 0.0010219372770726243i }, { 0.01623970239954224 + -0.004454852826360365i, 0.017383653104423323 + -0.03270646160174357i, 0.04408568844723626 + 0.05085174868456421i, 0.15613345368756879 + 2.7860293169844045e-19i, -0.0007544932323974426 + -0.00288122489699092i, -0.006508041999219538 + 0.0029636792646275563i, -0.0039022650665845003 + 0.00022259707206845886i, -0.00466798331039747 + 0.004613644052089412i }, { -0.0018701510057386348 + 0.009755960004311061i, 0.0031632061034298675 + 0.0020212989180259924i, -0.007211769887373611 + -0.0014731747634806147i, -0.000754493232397443 + 0.00288122489699092i, 0.10520439342650056 + 1.5539039363205053e-20i, 0.029322849574788222 + -0.03554419245357271i, -0.00192447931505572 + -0.018171361685741128i, -0.00762471738824042 + -0.005445696596932854i }, { -0.004304996304521155 + 0.0011586980108210685i, -0.0019720951999824825 + 0.008193522243843326i, 0.00045300612570082203 + -0.004517832691402965i, -0.006508041999219538 + -0.002963679264627557i, 0.029322849574788222 + 0.03554419245357271i, 0.10648180238942709 + 4.472738995522792e-20i, 0.005060735118024476 + -0.005864241377873649i, -0.003020114982789266 + -0.020299305740747887i }, { 0.0033016917322148892 + -0.003009438658758479i, 0.0007922784956601118 + -0.0029396442932539506i, -0.00263942521231403 + -0.005263325730687867i, -0.0039022650665845003 + -0.0002225970720684595i, -0.00192447931505572 + 0.018171361685741128i, 0.005060735118024476 + 0.00586424137787365i, 0.12917331554995262 + -4.5413845633075785e-20i, 0.03558130322698286 + -0.044621984116988624i }, { 0.001028868079553082 + -0.0010265380107054788i, 0.003147934784703585 + -0.0021385207138048105i, 0.0013134464828476607 + -0.0010219372770726245i, -0.00466798331039747 + -0.004613644052089413i, -0.00762471738824042 + 0.005445696596932854i, -0.003020114982789266 + 0.02029930574074789i, 0.03558130322698286 + 0.04462198411698862i, 0.13168145280467175 + -9.729060891186999e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.10827699678394631, 1.0e-7), DoubleNear(0.10946387523165049, 1.0e-7), DoubleNear(0.15358471012628155, 1.0e-7), DoubleNear(0.15613345368756879, 1.0e-7), DoubleNear(0.10520439342650056, 1.0e-7), DoubleNear(0.10648180238942709, 1.0e-7), DoubleNear(0.12917331554995262, 1.0e-7), DoubleNear(0.13168145280467175, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, true}), Matrix({ { 0.11673991105504639 + -2.426240007102387e-19i, 0.03248045699190612 + -0.039647894794639066i, 0.008362252157595201 + 0.0065169740923139464i, 0.004711008219351182 + -0.0005418318361710699i, 0.005053163345358956 + -0.0009316511365254019i, 0.001089524973218187 + -0.0019753976278048865i, 0.00041397472355818397 + 0.00021535593656178686i, 0.00019959494227084657 + -6.105008022720392e-05i }, { 0.03248045699190612 + 0.039647894794639066i, 0.1180874790695113 + -2.1338811700238856e-20i, 0.0010330025921596458 + 0.004766466507034772i, 0.007854540206536805 + 0.00678471444387219i, 0.0017223506437611031 + 0.0014569724483115588i, 0.0051114937075678255 + -0.0009424054986015347i, 8.27533162013105e-05 + 0.00019807566745794997i, 0.0003941348007988294 + 0.0002309970838806137i }, { 0.008362252157595201 + -0.006516974092313945i, 0.0010330025921596467 + -0.004766466507034774i, 0.15462306449758528 + -4.504607083805926e-19i, 0.04356500354856853 + -0.05220874318065559i, 0.0003099563760206744 + -0.00034882702894358604i, 6.675068439149895e-06 + -0.0002145635683021681i, 0.006692960400645232 + -0.0012339803283239587i, 0.0014690840741721223 + -0.002607563168974562i }, { 0.004711008219351184 + 0.0005418318361710699i, 0.007854540206536805 + -0.006784714443872188i, 0.04356500354856853 + 0.05220874318065558i, 0.15738836322500413 + 7.089023911461533e-20i, 0.00020824319703500156 + -1.4142989941737499e-05i, 0.00028584301154685216 + -0.0003563645138224433i, 0.002302395226822996 + 0.0019122159701983202i, 0.006812658163321885 + -0.0012560489908657454i }, { 0.005053163345358956 + 0.0009316511365254018i, 0.001722350643761103 + -0.0014569724483115588i, 0.0003099563760206744 + 0.00034882702894358604i, 0.0002082431970350016 + 1.4142989941737499e-05i, 0.09674147915540049 + 3.896002241075403e-19i, 0.02691630843849728 + -0.032855909801254586i, 0.0069297349594068325 + 0.005400567017826428i, 0.0039039767919506387 + -0.00044901193440141825i }, { 0.001089524973218187 + 0.0019753976278048865i, 0.005111493707567826 + 0.0009424054986015347i, 6.675068439149841e-06 + 0.00021456356830216807i, 0.00028584301154685227 + 0.0003563645138224433i, 0.026916308438497284 + 0.032855909801254586i, 0.0978581985515663 + -6.872305870116985e-21i, 0.0008560414157739518 + 0.003949934654462683i, 0.0065089979150972505 + 0.005622441417123494i }, { 0.00041397472355818397 + -0.00021535593656178676i, 8.275331620131054e-05 + -0.00019807566745794994i, 0.006692960400645231 + 0.0012339803283239585i, 0.002302395226822996 + -0.0019122159701983202i, 0.0069297349594068325 + -0.005400567017826428i, 0.0008560414157739518 + -0.003949934654462683i, 0.1281349611786489 + 2.2831031091447186e-19i, 0.03610198812565059 + -0.043264989620897254i }, { 0.00019959494227084657 + 6.10500802272039e-05i, 0.00039413480079882957 + -0.00023099708388061386i, 0.0014690840741721225 + 0.002607563168974562i, 0.006812658163321885 + 0.0012560489908657454i, 0.0039039767919506387 + 0.00044901193440141825i, 0.0065089979150972505 + -0.005622441417123494i, 0.03610198812565059 + 0.04326498962089725i, 0.1304265432672364 + 1.1042208367195513e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.11673991105504639, 1.0e-7), DoubleNear(0.1180874790695113, 1.0e-7), DoubleNear(0.15462306449758528, 1.0e-7), DoubleNear(0.15738836322500413, 1.0e-7), DoubleNear(0.09674147915540049, 1.0e-7), DoubleNear(0.0978581985515663, 1.0e-7), DoubleNear(0.1281349611786489, 1.0e-7), DoubleNear(0.1304265432672364, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true, false}), Matrix({ { 0.13449863353978236 + -1.7795323200328576e-19i, 0.03809020249762566 + -0.04510208147590566i, 0.009184666887125 + 0.009008314099358972i, 0.005621912417794294 + -0.0005287718112342703i, -0.00231622960962183 + -0.002307527808957054i, -0.0015365337984266734 + -7.024368712822059e-05i, -3.6198293586180575e-06 + -0.0003127109696271868i, -0.00010022238551756496 + -0.00010770922771806304i }, { 0.03809020249762566 + 0.04510208147590566i, 0.13641734117198584 + 1.8562341863177191e-19i, -0.0004196912145528479 + 0.005631106298600019i, 0.009315691939140572 + 0.009136823367898221i, -0.00037959891815607795 + -0.0009238576471576616i, -0.0034105081524926657 + -0.0018387137650287813i, 3.595508837109487e-05 + -8.851295149605917e-05i, -0.00010974587454012393 + -0.0003539879986554416i }, { 0.009184666887125001 + -0.009008314099358972i, -0.0004196912145528476 + -0.005631106298600018i, 0.1273630733704455 + 1.3265386420433731e-19i, 0.03606940180522576 + -0.04270927935097949i, -0.0003127223793104334 + -2.44277878289157e-06i, -0.00010963180746475445 + 9.811560062734169e-05i, -0.0021933466084308358 + -0.00218510646466614i, -0.0014550160232468215 + -6.651704662022416e-05i }, { 0.005621912417794294 + 0.00052877181123427i, 0.009315691939140572 + -0.009136823367898223i, 0.03606940180522576 + 0.04270927935097949i, 0.12917998774723347 + 2.004100554108477e-20i, -8.77993268175078e-05 + -3.7664162976354645e-05i, -0.0003560489141809681 + 0.00010286316581369174i, -0.0003594600449985546 + -0.0008748441987998718i, -0.0032295703578872877 + -0.0017411644267251326i }, { -0.00231622960962183 + 0.002307527808957054i, -0.0003795989181560784 + 0.0009238576471576615i, -0.0003127223793104333 + 2.442778782891543e-06i, -8.779932681750782e-05 + 3.76641629763547e-05i, 0.12038217409284932 + -1.174495083516515e-19i, 0.03333637424844299 + -0.04117532621348799i, 0.008220679564478044 + 0.008062836087262867i, 0.0050342798774299395 + -0.0005790179649133914i }, { -0.001536533798426673 + 7.024368712822031e-05i, -0.0034105081524926657 + 0.001838713765028781i, -0.00010963180746475446 + -9.811560062734166e-05i, -0.0003560489141809681 + -0.0001028631658136918i, 0.033336374248443 + 0.04117532621348799i, 0.12232652403038936 + 5.89573448879072e-20i, -0.0004813192318347231 + 0.0050445582051409105i, 0.008353455682854186 + 0.008193062800319017i }, { -3.619829358618139e-06 + 0.0003127109696271867i, 3.5955088371094734e-05 + 8.851295149605917e-05i, -0.002193346608430835 + 0.00218510646466614i, -0.0003594600449985545 + 0.0008748441987998714i, 0.008220679564478044 + -0.008062836087262866i, -0.000481319231834723 + -0.00504455820514091i, 0.11399553488360387 + 8.757470208178075e-20i, 0.03156777855332808 + -0.03899085035707334i }, { -0.00010022238551756487 + 0.00010770922771806315i, -0.000109745874540124 + 0.0003539879986554415i, -0.0014550160232468215 + 6.651704662022394e-05i, -0.0032295703578872877 + 0.0017411644267251326i, 0.005034279877429939 + 0.0005790179649133918i, 0.008353455682854186 + -0.008193062800319017i, 0.03156777855332808 + 0.03899085035707334i, 0.11583673116370946 + -1.1152056384454927e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.13449863353978236, 1.0e-7), DoubleNear(0.13641734117198584, 1.0e-7), DoubleNear(0.1273630733704455, 1.0e-7), DoubleNear(0.12917998774723347, 1.0e-7), DoubleNear(0.12038217409284932, 1.0e-7), DoubleNear(0.12232652403038936, 1.0e-7), DoubleNear(0.11399553488360387, 1.0e-7), DoubleNear(0.11583673116370946, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, true}), Matrix({ { 0.13937871953775455 + -4.2902218778430317e-19i, 0.03905882479068874 + -0.04717983562778442i, 0.00951791907781465 + 0.009335167587343398i, 0.0058272195974723015 + -0.0006057824516117436i, 0.006033098966120911 + -0.0011123217526144502i, 0.0013141647348785372 + -0.002353921739861508i, 0.00048648931447043694 + 0.0003281204020352731i, 0.0002474005188521574 + -7.272622844907762e-05i }, { 0.03905882479068874 + 0.04717983562778441i, 0.14149118937246855 + 4.743384504624077e-20i, -0.00049270748737051 + 0.005837867756958444i, 0.009662175797978352 + 0.009476654465653548i, 0.0020672087810228047 + 0.0017304982991766323i, 0.006124538603520668 + -0.0011291804678952846i, 2.526235191407813e-05 + 0.0002566280082308114i, 0.0004938627069448248 + 0.0003330935030492051i }, { 0.009517919077814654 + -0.009335167587343398i, -0.0004927074873705103 + -0.005837867756958444i, 0.13198425601487715 + -2.6406252130652813e-19i, 0.0369866357497859 + -0.04467680234751023i, 0.0003374893809635042 + -0.00048003725799418477i, -6.791668311346703e-05 + -0.0002487638341632663i, 0.005713024779883277 + -0.0010533097122349103i, 0.001244444312511772 + -0.00222903905691794i }, { 0.0058272195974723015 + 0.0006057824516117438i, 0.009662175797978352 + -0.009476654465653548i, 0.0369866357497859 + 0.04467680234751023i, 0.13398465292204687 + 2.1175823681357027e-21i, 0.00025706949845700073 + -2.0282849795092957e-05i, 0.00034260448131157863 + -0.00048731286097299445i, 0.0019575370895612947 + 0.0016386901193332468i, 0.005799613267369043 + -0.0010692740215719953i }, { 0.006033098966120911 + 0.0011123217526144502i, 0.0020672087810228047 + -0.0017304982991766323i, 0.0003374893809635041 + 0.0004800372579941848i, 0.00025706949845700057 + 2.028284979509295e-05i, 0.11550208809487715 + 1.3361944742936588e-19i, 0.032367751955379914 + -0.03909757206160923i, 0.007887427373788392 + 0.007735982599278441i, 0.004828972697751932 + -0.0005020073245359182i }, { 0.0013141647348785374 + 0.0023539217398615086i, 0.006124538603520668 + 0.0011291804678952846i, -6.7916683113467e-05 + 0.00024876383416326623i, 0.00034260448131157874 + 0.00048731286097299445i, 0.032367751955379914 + 0.03909757206160923i, 0.11725267582990664 + 1.9714691847343836e-19i, -0.000408302959017061 + 0.004837796746782485i, 0.008006971824016405 + 0.00785323170256369i }, { 0.00048648931447043705 + -0.0003281204020352731i, 2.5262351914078112e-05 + -0.0002566280082308114i, 0.005713024779883276 + 0.00105330971223491i, 0.0019575370895612947 + -0.0016386901193332468i, 0.007887427373788392 + -0.00773598259927844i, -0.00040830295901706024 + -0.004837796746782484i, 0.10937435223917223 + 4.842910875926462e-19i, 0.030650544608767955 + -0.037023327360542604i }, { 0.0002474005188521574 + 7.27262284490776e-05i, 0.0004938627069448249 + -0.0003330935030492049i, 0.001244444312511772 + 0.00222903905691794i, 0.005799613267369044 + 0.0010692740215719953i, 0.004828972697751931 + 0.0005020073245359182i, 0.008006971824016405 + -0.00785323170256369i, 0.030650544608767955 + 0.037023327360542604i, 0.11103206598889606 + -9.359714067160021e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.13937871953775455, 1.0e-7), DoubleNear(0.14149118937246855, 1.0e-7), DoubleNear(0.13198425601487715, 1.0e-7), DoubleNear(0.13398465292204687, 1.0e-7), DoubleNear(0.11550208809487715, 1.0e-7), DoubleNear(0.11725267582990664, 1.0e-7), DoubleNear(0.10937435223917223, 1.0e-7), DoubleNear(0.11103206598889606, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, true}), Matrix({ { 0.14319614624622523 + -3.621616363703114e-19i, 0.04055335034898351 + -0.04801866074812319i, -0.0024660113280715306 + -0.0024567468152076853i, -0.001635895568014779 + -7.478607797090813e-05i, 0.006198338776075389 + -0.001142786997100307i, 0.001372161947074245 + -0.0024021580005826474i, -0.00012634915412809716 + -8.666171326944094e-05i, -7.140764439793513e-05 + 9.81821629700942e-06i }, { 0.04055335034898351 + 0.04801866074812319i, 0.1452389293695459 + 7.786381841239715e-20i, -0.00040414612973081786 + -0.0009835999911028998i, -0.0036310526830284216 + -0.0019576163584154945i, 0.0021385945999023255 + 0.0017548802255511393i, 0.00628676197862875 + -0.001159089572640383i, -2.534341881695272e-05 + -3.9350451605915716e-05i, -0.0001727953845933056 + -5.575883011101407e-05i }, { -0.0024660113280715297 + 0.0024567468152076853i, -0.00040414612973081786 + 0.0009835999911028993i, 0.12816682930640644 + -3.3092307272051994e-19i, 0.03549211019149113 + -0.04383797722717145i, -8.713666986529615e-05 + 0.00012602206973568903i, -9.644039893059306e-06 + 4.5801085286945635e-05i, 0.005547784969928799 + -0.0010228444677490532i, 0.0011864471003160642 + -0.0021808027961968007i }, { -0.0016358955680147787 + 7.47860779709078e-05i, -0.003631052683028422 + 0.0019576163584154945i, 0.03549211019149113 + 0.04383797722717145i, 0.13023691292496953 + -2.831239099802068e-20i, -7.021397320342784e-05 + 1.6292544819798067e-05i, -0.0001415495923237102 + 0.00011371457683643192i, 0.0018861512706817736 + 0.0016143081929587398i, 0.005637389892260961 + -0.0010393649168268973i }, { 0.006198338776075389 + 0.001142786997100307i, 0.0021385945999023255 + -0.0017548802255511393i, -8.713666986529613e-05 + -0.00012602206973568906i, -7.021397320342783e-05 + -1.6292544819798074e-05i, 0.11866556066400263 + 3.1686226857136296e-19i, 0.03360625395386792 + -0.039792700078761956i, -0.0020435648899811355 + -0.002035887458415509i, -0.001355654253658716 + -6.197465577753662e-05i }, { 0.0013721619470742452 + 0.002402158000582648i, 0.006286761978628749 + 0.001159089572640383i, -9.644039893059286e-06 + -4.580108528694564e-05i, -0.0001415495923237102 + -0.00011371457683643185i, 0.03360625395386792 + 0.039792700078761956i, 0.1203583995496734 + 1.2780060576045955e-19i, -0.0003349128334238147 + -0.0008151018548546338i, -0.0030090258273515313 + -0.0016222618333384194i }, { -0.0001263491541280972 + 8.666171326944096e-05i, -2.53434188169527e-05 + 3.935045160591572e-05i, 0.005547784969928798 + 0.0010228444677490532i, 0.0018861512706817734 + -0.0016143081929587395i, -0.002043564889981135 + 0.0020358874584155084i, -0.000334912833423815 + 0.0008151018548546335i, 0.10621087967004675 + 3.010482664506492e-19i, 0.02941204261027995 + -0.03632819934338988i }, { -7.140764439793512e-05 + -9.818216297009444e-06i, -0.00017279538459330558 + 5.5758830111014e-05i, 0.0011864471003160645 + 0.0021808027961968007i, 0.005637389892260961 + 0.0010393649168268973i, -0.0013556542536587158 + 6.197465577753645e-05i, -0.0030090258273515313 + 0.0016222618333384192i, 0.02941204261027995 + 0.03632819934338988i, 0.10792634226912931 + -2.4250827958621395e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.14319614624622523, 1.0e-7), DoubleNear(0.1452389293695459, 1.0e-7), DoubleNear(0.12816682930640644, 1.0e-7), DoubleNear(0.13023691292496953, 1.0e-7), DoubleNear(0.11866556066400263, 1.0e-7), DoubleNear(0.1203583995496734, 1.0e-7), DoubleNear(0.10621087967004675, 1.0e-7), DoubleNear(0.10792634226912931, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false, false}), Matrix({ { 0.1345600788408172 + 2.493945079796057e-20i, 0.0606444013406778 + -0.0006425085304821015i, 0.0092924971737978 + 0.007622093220027741i, 0.004224396959898908 + 0.0033908033907109475i, 0.009188862874897745 + 0.009012429520884706i, 0.004184329079974482 + 0.004017903934019938i, 0.00012406283120596542 + 0.0011428823956942157i, 6.137056314789915e-05 + 0.0005144891996102911i }, { 0.06064440134067779 + 0.0006425085304821015i, 0.08600425838064603 + 7.898073633920032e-20i, 0.004151607764824327 + 0.0034795445501258284i, 0.005939312274646965 + 0.004871671303582708i, 0.004098262500682607 + 0.004105655410288563i, 0.005873074270801553 + 0.005760306651339525i, 5.045630544387342e-05 + 0.000515673970428684i, 7.929492820151165e-05 + 0.0007304748459181276i }, { 0.0092924971737978 + -0.007622093220027742i, 0.004151607764824326 + -0.0034795445501258284i, 0.1787878419605063 + -7.724373529091364e-20i, 0.08057725393809503 + -0.0008536908910554669i, 0.0011450726067483348 + 0.00010188464923217383i, 0.0005165551706189596 + 4.045044182139591e-05i, 0.012209096320591934 + 0.011974672122229493i, 0.005559651664192538 + 0.005338525213097227i }, { 0.004224396959898908 + -0.003390803390710947i, 0.0059393122746469644 + -0.004871671303582708i, 0.08057725393809503 + 0.0008536908910554671i, 0.11427249365303735 + -7.749842868150538e-20i, 0.0005155821962149497 + 5.138561552514386e-05i, 0.0007318747223081339 + 6.511971286782026e-05i, 0.005445296365733472 + 0.005455119207438414i, 0.00780346060730657 + 0.007653628060385354i }, { 0.009188862874897745 + -0.009012429520884706i, 0.0040982625006826074 + -0.004105655410288563i, 0.0011450726067483343 + -0.0001018846492321741i, 0.0005155821962149496 + -5.138561552514413e-05i, 0.1274212588120222 + -7.575559256906446e-20i, 0.05742703203876721 + -0.0006084215055220213i, 0.008799502033535543 + 0.007217718072441459i, 0.004000279897195766 + 0.0032109109934424446i }, { 0.004184329079974482 + -0.004017903934019938i, 0.005873074270801554 + -0.005760306651339524i, 0.0005165551706189594 + -4.045044182139599e-05i, 0.0007318747223081337 + -6.51197128678205e-05i, 0.05742703203876721 + 0.0006084215055220212i, 0.08144147179803904 + 9.060051125884929e-20i, 0.0039313523895410695 + 0.0032949441653794143i, 0.005624213756655784 + 0.004613214375084144i }, { 0.00012406283120596536 + -0.0011428823956942157i, 5.045630544387345e-05 + -0.0005156739704286839i, 0.01220909632059193 + -0.011974672122229493i, 0.005445296365733472 + -0.005455119207438413i, 0.008799502033535541 + -0.00721771807244146i, 0.0039313523895410695 + -0.003294944165379414i, 0.16930260504560682 + -1.8053306339349322e-20i, 0.07630238639020173 + -0.0008084000017815672i }, { 6.137056314789921e-05 + -0.0005144891996102913i, 7.929492820151146e-05 + -0.0007304748459181275i, 0.005559651664192538 + -0.005338525213097228i, 0.007803460607306573 + -0.007653628060385354i, 0.004000279897195765 + -0.0032109109934424446i, 0.0056242137566557835 + -0.004613214375084146i, 0.07630238639020173 + 0.0008084000017815674i, 0.10820999150932427 + 1.3195739563221811e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.1345600788408172, 1.0e-7), DoubleNear(0.08600425838064603, 1.0e-7), DoubleNear(0.1787878419605063, 1.0e-7), DoubleNear(0.11427249365303735, 1.0e-7), DoubleNear(0.1274212588120222, 1.0e-7), DoubleNear(0.08144147179803904, 1.0e-7), DoubleNear(0.16930260504560682, 1.0e-7), DoubleNear(0.10820999150932427, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true, false}), Matrix({ { 0.13283756238375183 + -2.1459781531416456e-20i, 0.05986808655074837 + -0.0006342837172455578i, 0.021108556675034116 + 0.0383096800263684i, 0.009696264227696181 + 0.01716486199264575i, -0.002344045999823373 + -0.010950472668835743i, -0.001108716937163256 + -0.004924036873017077i, 0.003934735159560161 + 0.0031406247617714704i, 0.0017883278492337598 + 0.0013966490598631175i }, { 0.05986808655074837 + 0.0006342837172455577i, 0.08490330963184499 + 7.995845803992918e-20i, 0.009330415806247203 + 0.017366443737346103i, 0.013491562861446961 + 0.024485684371256665i, -0.0010041425022617825 + -0.004946421960239131i, -0.001498200205897745 + -0.006999009579318645i, 0.001758335622447558 + 0.001434224853917102i, 0.002514891357358314 + 0.0020073346107918194i }, { 0.021108556675034112 + -0.038309680026368406i, 0.009330415806247203 + -0.017366443737346103i, 0.18895031293920966 + 2.2942375312789314e-20i, 0.08515734168740847 + -0.0009022154932320006i, -0.008370070122839 + 0.002706799455199216i, -0.0037593523606449354 + 0.0012598838780782705i, -0.004458043758682648 + 0.006025660582401485i, -0.0019804079996498703 + 0.0027369700807157874i }, { 0.009696264227696181 + -0.01716486199264575i, 0.013491562861446961 + -0.024485684371256665i, 0.08515734168740847 + 0.000902215493232001i, 0.12076785087464073 + 7.892400455260622e-20i, -0.0037852016579291202 + 0.001179951679747452i, -0.00534974176375415 + 0.0017300545729089546i, -0.0020379516390313943 + 0.0026943968127912856i, -0.0028493647640288524 + 0.003851309200375793i }, { -0.002344045999823373 + 0.010950472668835743i, -0.0010041425022617825 + 0.00494642196023913i, -0.008370070122839 + -0.0027067994551992166i, -0.00378520165792912 + -0.0011799516797474517i, 0.12914377526908757 + -2.9356360239687464e-20i, 0.05820334682869663 + -0.0006166463187585651i, -0.0030165574677007735 + -0.023469868733899203i, -0.0014715873706015077 + -0.010563147608492357i }, { -0.001108716937163256 + 0.004924036873017077i, -0.001498200205897745 + 0.006999009579318645i, -0.0037593523606449354 + -0.001259883878078271i, -0.00534974176375415 + -0.001730054572908955i, 0.05820334682869663 + 0.0006166463187585651i, 0.08254242054684008 + 8.96227895581204e-20i, -0.0012474556518818067 + -0.010591955021840859i, -0.0019280368301442129 + -0.015000798692589811i }, { 0.00393473515956016 + -0.0031406247617714695i, 0.001758335622447558 + -0.0014342248539171022i, -0.004458043758682648 + -0.006025660582401486i, -0.0020379516390313943 + -0.0026943968127912856i, -0.0030165574677007735 + 0.023469868733899203i, -0.001247455651881807 + 0.010591955021840859i, 0.15914013406690344 + -1.1823941694305228e-19i, 0.07172229864088829 + -0.0007598753996050332i }, { 0.00178832784923376 + -0.0013966490598631177i, 0.002514891357358314 + -0.00200733461079182i, -0.0019804079996498703 + -0.0027369700807157874i, -0.0028493647640288524 + -0.0038513092003757935i, -0.0014715873706015077 + 0.010563147608492359i, -0.0019280368301442126 + 0.015000798692589811i, 0.07172229864088829 + 0.0007598753996050334i, 0.1017146342877209 + -2.4465037601893502e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.13283756238375183, 1.0e-7), DoubleNear(0.08490330963184499, 1.0e-7), DoubleNear(0.18895031293920966, 1.0e-7), DoubleNear(0.12076785087464073, 1.0e-7), DoubleNear(0.12914377526908757, 1.0e-7), DoubleNear(0.08254242054684008, 1.0e-7), DoubleNear(0.15914013406690344, 1.0e-7), DoubleNear(0.1017146342877209, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, true}), Matrix({ { 0.1432615649800931 + -2.0694382203724435e-19i, 0.06456604305073395 + -0.0006840571020979845i, 0.009893407459029696 + 0.008114984864248607i, 0.004497572569708444 + 0.00361007368959495i, 0.006201170468725255 + -0.001143309075943843i, 0.0027893242043732333 + -0.0005448837427469379i, 0.0004930048197243808 + 0.0002723073837692095i, 0.00022349081708561373 + 0.00012037120226608388i }, { 0.06456604305073393 + 0.0006840571020979842i, 0.09156582514446458 + -5.701899037323321e-20i, 0.00442007637551877 + 0.0037045534007057283i, 0.006323384905102313 + 0.00518670367193752i, 0.00280024253677315 + -0.0004856640252876008i, 0.003963486584201527 + -0.0007307475591830938i, 0.00022089034570521332 + 0.00012507928218057952i, 0.0003151047046326327 + 0.00017404563667319111i }, { 0.009893407459029694 + -0.008114984864248605i, 0.00442007637551877 + -0.0037045534007057283i, 0.19034936854470805 + -2.3224276111411043e-19i, 0.0857878770614115 + -0.0009088958189935139i, 0.00036348039567203215 + -0.0004302174630216722i, 0.0001617614436031873 + -0.00019562874793851385i, 0.008239396820242504 + -0.0015190966306111808i, 0.003706130817729743 + -0.0007239783844087487i }, { 0.004497572569708444 + -0.00361007368959495i, 0.006323384905102312 + -0.005186703671937522i, 0.0857878770614115 + 0.0009088958189935139i, 0.12166205917788138 + -1.4732770815186682e-19i, 0.0001658699190490258 + -0.00019215759576776388i, 0.00023231899189549447 + -0.00027497407974435737i, 0.0037206378327701984 + -0.0006452940853411851i, 0.005266221743724611 + -0.0009709326885785231i }, { 0.006201170468725256 + 0.0011433090759438427i, 0.00280024253677315 + 0.0004856640252876006i, 0.00036348039567203226 + 0.0004302174630216721i, 0.00016586991904902581 + 0.00019215759576776388i, 0.11871977267274629 + 1.5612768026614044e-19i, 0.05350539032871106 + -0.0005668729339061384i, 0.008198591748303646 + 0.006724826428220589i, 0.0037271042873862296 + 0.0029916406945584423i }, { 0.002789324204373233 + 0.0005448837427469379i, 0.003963486584201527 + 0.0007307475591830938i, 0.0001617614436031873 + 0.00019562874793851385i, 0.00023231899189549447 + 0.0002749740797443573i, 0.05350539032871106 + 0.0005668729339061386i, 0.07587990503422049 + 2.266002379712828e-19i, 0.003662883778846626 + 0.0030699353147995156i, 0.005240141126200436 + 0.004298182006729332i }, { 0.0004930048197243808 + -0.0002723073837692094i, 0.00022089034570521324 + -0.00012507928218057958i, 0.008239396820242504 + 0.0015190966306111808i, 0.0037206378327701984 + 0.0006452940853411848i, 0.008198591748303646 + -0.006724826428220594i, 0.0036628837788466257 + -0.0030699353147995148i, 0.15774107846140506 + 1.3694571948384745e-19i, 0.07109176326688527 + -0.00075319507384352i }, { 0.00022349081708561373 + -0.00012037120226608385i, 0.0003151047046326326 + -0.00017404563667319122i, 0.003706130817729743 + 0.0007239783844087488i, 0.005266221743724611 + 0.0009709326885785231i, 0.00372710428738623 + -0.0029916406945584414i, 0.005240141126200436 + -0.004298182006729332i, 0.07109176326688527 + 0.0007531950738435205i, 0.10082042598448024 + 2.0178667510257953e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.1432615649800931, 1.0e-7), DoubleNear(0.09156582514446458, 1.0e-7), DoubleNear(0.19034936854470805, 1.0e-7), DoubleNear(0.12166205917788138, 1.0e-7), DoubleNear(0.11871977267274629, 1.0e-7), DoubleNear(0.07587990503422049, 1.0e-7), DoubleNear(0.15774107846140506, 1.0e-7), DoubleNear(0.10082042598448024, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true, false}), Matrix({ { 0.1652781921850282 + -9.791563530894348e-21i, 0.07448863813158013 + -0.000789183904292783i, 0.011286546925970848 + 0.011069836397531632i, 0.0051395506884590395 + 0.0049351330967449605i, -0.0034937211268070084 + -0.0025295049966686843i, -0.0015866507850171045 + -0.0011233314656640592i, -6.91612172966239e-05 + -0.00040673422941046584i, -3.3112130056437365e-05 + -0.0001829793605010827i }, { 0.07448863813158013 + 0.0007891839042927831i, 0.10563778252674 + 1.7461750159380496e-20i, 0.0050338363580614 + 0.005042916961648927i, 0.007213811900294723 + 0.007075301069725563i, -0.0015624946080550007 + -0.0011566956795741085i, -0.002233016635307487 + -0.0016167365773171506i, -2.922791396074889e-05 + -0.0001836398338372222i, -4.420448660211808e-05 + -0.00025996473887216257i }, { 0.011286546925970847 + -0.011069836397531632i, 0.005033836358061402 + -0.005042916961648927i, 0.1565096831379333 + 1.1274157312267212e-20i, 0.07053679010657671 + -0.0007473153061847755i, -0.00040799849654897573 + 6.126364473202305e-05i, -0.00018358685852127318 + 2.955883801081418e-05i, -0.0033083686316990124 + -0.0023953070897655723i, -0.0015024741517960217 + -0.0010637353266372308i }, { 0.00513955068845904 + -0.0049351330967449605i, 0.007213811900294725 + -0.007075301069725563i, 0.07053679010657671 + 0.0007473153061847756i, 0.10003337797974571 + 1.414207124331549e-19i, -0.00018417191189947952 + 2.566254846171685e-05i, -0.0002607727969424258 + 3.915674229877708e-05i, -0.0014795995332381765 + -0.0010953294678737364i, -0.00211454833461911 + -0.001530963801625701i }, { -0.003493721126807009 + 0.0025295049966686843i, -0.0015624946080550002 + 0.0011566956795741083i, -0.0004079984965489757 + -6.126364473202315e-05i, -0.00018417191189947955 + -2.5662548461716973e-05i, 0.1480697286162953 + -4.251272096205872e-20i, 0.0667330171471927 + -0.0007070155172447853i, 0.01011141226951883 + 0.009917265245582568i, 0.0046044300557079795 + 0.004421296050372205i }, { -0.0015866507850171045 + 0.001123331465664059i, -0.0022330166353074867 + 0.0016167365773171508i, -0.00018358685852127313 + -2.9558838010814276e-05i, -0.0002607727969424257 + -3.915674229877715e-05i, 0.0667330171471927 + 0.0007070155172447854i, 0.09463896950694338 + -1.5979442501685567e-20i, 0.0045097225083546785 + 0.00451785765607805i, 0.0064627229778134 + 0.006338633641999315i }, { -6.916121729662415e-05 + 0.0004067342294104659i, -2.922791396074893e-05 + 0.00018363983383722223i, -0.0033083686316990124 + 0.002395307089765572i, -0.0014795995332381765 + 0.0010953294678737362i, 0.01011141226951883 + -0.009917265245582566i, 0.0045097225083546785 + -0.00451785765607805i, 0.1402141807196957 + -1.0508305622068102e-19i, 0.06319262832239222 + -0.0006695062011188131i }, { -3.311213005643737e-05 + 0.0001829793605010827i, -4.420448660211804e-05 + 0.00025996473887216235i, -0.0015024741517960217 + 0.001063735326637231i, -0.00211454833461911 + 0.0015309638016257005i, 0.004604430055707981 + -0.004421296050372205i, 0.006462722977813401 + -0.006338633641999315i, 0.06319262832239222 + 0.0006695062011188131i, 0.08961808532761759 + 8.11371944579125e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1652781921850282, 1.0e-7), DoubleNear(0.10563778252674, 1.0e-7), DoubleNear(0.1565096831379333, 1.0e-7), DoubleNear(0.10003337797974571, 1.0e-7), DoubleNear(0.1480697286162953, 1.0e-7), DoubleNear(0.09463896950694338, 1.0e-7), DoubleNear(0.1402141807196957, 1.0e-7), DoubleNear(0.08961808532761759, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, true}), Matrix({ { 0.17135080658585736 + -1.198551620364835e-19i, 0.07722548302706152 + -0.0008181799229371903i, 0.011701234710803076 + 0.011476561852558496i, 0.005328386911265663 + 0.005116458654080145i, 0.007417031649347973 + -0.0013674772599833805i, 0.0033362259606421465 + -0.0006517188949330709i, 0.0005980851072988208 + 0.00040338794711620307i, 0.0002714749708436334 + 0.00017894568719745193i }, { 0.07722548302706152 + 0.00081817992293719i, 0.10951910232436572 + -2.6173318070157885e-19i, 0.005218788448565633 + 0.005228202689660834i, 0.0074788601649899275 + 0.00733526020043845i, 0.0033492850464029236 + -0.0005808879895618081i, 0.004740605920293605 + -0.0008740249605263548i, 0.00026762271095572953 + 0.0001846572591094807i, 0.0003822669141164409 + 0.0002578259579682751i }, { 0.011701234710803074 + -0.011476561852558496i, 0.005218788448565633 + -0.005228202689660833i, 0.1622601269389438 + -3.193314211148713e-19i, 0.07312843708508393 + -0.0007747729981543083i, 0.00041490607629376 + -0.0005901530134683575i, 0.00018417462651251076 + -0.00026795508151572153i, 0.007023535639619786 + -0.0012949284465716433i, 0.00315922906146083 + -0.0006171432322226156i }, { 0.005328386911265663 + -0.005116458654080145i, 0.007478860164989931 + -0.007335260200438449i, 0.07312843708508393 + 0.0007747729981543081i, 0.10370878199798023 + 5.738648217647882e-20i, 0.00018981044879664763 + -0.0002639928262069541i, 0.00026518778598132284 + -0.0003771971054988217i, 0.0031715953231404247 + -0.0005500701210669777i, 0.004489102407632534 + -0.0008276552872352622i }, { 0.007417031649347974 + 0.00136747725998338i, 0.0033492850464029236 + 0.0005808879895618079i, 0.00041490607629376003 + 0.0005901530134683577i, 0.0001898104487966477 + 0.0002639928262069541i, 0.14199711421546612 + 6.755087754353044e-20i, 0.06399617225171132 + -0.0006780194986003781i, 0.009696724484686602 + 0.009510539790555704i, 0.004415593832901358 + 0.00423997049303702i }, { 0.0033362259606421465 + 0.0006517188949330709i, 0.004740605920293605 + 0.0008740249605263548i, 0.00018417462651251093 + 0.00026795508151572153i, 0.00026518778598132284 + 0.0003771971054988217i, 0.06399617225171132 + 0.0006780194986003784i, 0.09075764970931766 + 2.632154883592738e-19i, 0.004324770417850446 + 0.004332571928066143i, 0.006197674713118196 + 0.006078674511286427i }, { 0.0005980851072988209 + -0.00040338794711620296i, 0.00026762271095572953 + -0.0001846572591094806i, 0.007023535639619786 + 0.0012949284465716433i, 0.0031715953231404247 + 0.0005500701210669776i, 0.009696724484686602 + -0.009510539790555703i, 0.0043247704178504464 + -0.004332571928066143i, 0.1344637369186852 + 2.2552252220645747e-19i, 0.060600981343885016 + -0.0006420485091492801i }, { 0.0002714749708436334 + -0.0001789456871974519i, 0.000382266914116441 + -0.00025782595796827506i, 0.00315922906146083 + 0.0006171432322226157i, 0.004489102407632534 + 0.0008276552872352622i, 0.004415593832901358 + -0.00423997049303702i, 0.006197674713118195 + -0.006078674511286427i, 0.060600981343885016 + 0.0006420485091492806i, 0.08594268130938307 + 1.6517142471458857e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.17135080658585736, 1.0e-7), DoubleNear(0.10951910232436572, 1.0e-7), DoubleNear(0.1622601269389438, 1.0e-7), DoubleNear(0.10370878199798023, 1.0e-7), DoubleNear(0.14199711421546612, 1.0e-7), DoubleNear(0.09075764970931766, 1.0e-7), DoubleNear(0.1344637369186852, 1.0e-7), DoubleNear(0.08594268130938307, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, true}), Matrix({ { 0.17596610133915355 + -2.0652341297028393e-19i, 0.07930553373553002 + -0.000840217411880624i, -0.0037196467224316215 + -0.0026930784194650528i, -0.0016892534286290341 + -0.0011959730192547904i, 0.007616807699069195 + -0.001404309946966332i, 0.003426086443231979 + -0.0006692727941900404i, -0.0001824996426087455 + -8.688675507221205e-05i, -8.266498613882113e-05 + -3.8287267018452164e-05i }, { 0.07930553373553002 + 0.0008402174118806238i, 0.11246897427661759 + -7.77744049876303e-20i, -0.0016635351640044943 + -0.0012314947693924275i, -0.0023774172886683303 + -0.0017212847541581274i, 0.0034394972724785065 + -0.0005965340745957531i, 0.004868293055634944 + -0.0008975666227743579i, -8.183523809169272e-05 + -4.0030095622540134e-05i, -0.0001166448961126573 + -5.553378830824296e-05i }, { -0.0037196467224316215 + 0.0026930784194650528i, -0.0016635351640044943 + 0.0012314947693924275i, 0.1576448321856476 + -2.3266317018107087e-19i, 0.07104838637661542 + -0.0007527355092108746i, -0.00013951503610063238 + 0.00014625656382240645i, -6.217917546220273e-05 + 6.658201624999313e-05i, 0.0068237595898985644 + -0.0012580957595886917i, 0.0030693685788709965 + -0.0005995893329656461i }, { -0.0016892534286290341 + 0.0011959730192547902i, -0.0023774172886683303 + 0.0017212847541581274i, 0.07104838637661542 + 0.0007527355092108745i, 0.10075891004572837 + -1.2657229353746973e-19i, -6.35758911999523e-05 + 6.524968051420308e-05i, -8.917122608837398e-05 + 9.348008274971448e-05i, 0.003081383097064842 + -0.0005344240360330327i, 0.004361415272291194 + -0.000804113624987259i }, { 0.007616807699069195 + 0.0014043099469663318i, 0.0034394972724785065 + 0.0005965340745957529i, -0.00013951503610063235 + -0.0001462565638224064i, -6.357589119995228e-05 + -6.524968051420307e-05i, 0.1458217739838079 + 2.080060067516568e-19i, 0.06571989450262683 + -0.0006962817985969344i, -0.0030824430360743994 + -0.002231733666969204i, -0.001399871508184092 + -0.0009910937730464996i }, { 0.003426086443231979 + 0.0006692727941900404i, 0.004868293055634944 + 0.0008975666227743579i, -6.21791754622027e-05 + -6.658201624999314e-05i, -8.917122608837396e-05 + -9.348008274971445e-05i, 0.06571989450262683 + 0.0006962817985969349i, 0.09320218622986812 + 2.366568675801657e-19i, -0.0013785589772886827 + -0.0010205303780554172i, -0.001970147681258267 + -0.001426415624784724i }, { -0.0001824996426087455 + 8.688675507221205e-05i, -8.18352380916927e-05 + 4.003009562254015e-05i, 0.006823759589898565 + 0.0012580957595886915i, 0.0030813830970648423 + 0.0005344240360330325i, -0.0030824430360743994 + 0.0022317336669692035i, -0.0013785589772886825 + 0.0010205303780554168i, 0.13063907715034342 + 8.506739299833112e-20i, 0.0588772590929695 + -0.0006237862091527238i }, { -8.26649861388211e-05 + 3.8287267018452143e-05i, -0.00011664489611265732 + 5.553378830824292e-05i, 0.0030693685788709974 + 0.0005995893329656462i, 0.004361415272291195 + 0.000804113624987259i, -0.001399871508184092 + 0.0009910937730464998i, -0.001970147681258267 + 0.0014264156247847238i, 0.0588772590929695 + 0.0006237862091527241i, 0.0834981447888326 + 1.9173004549369666e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.17596610133915355, 1.0e-7), DoubleNear(0.11246897427661759, 1.0e-7), DoubleNear(0.1576448321856476, 1.0e-7), DoubleNear(0.10075891004572837, 1.0e-7), DoubleNear(0.1458217739838079, 1.0e-7), DoubleNear(0.09320218622986812, 1.0e-7), DoubleNear(0.13063907715034342, 1.0e-7), DoubleNear(0.0834981447888326, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true, false}), Matrix({ { 0.11183708415182012 + 4.169489820380571e-20i, 0.01777147507697724 + 0.03225324849428524i, 0.007637150925091075 + 0.007490511654142914i, -0.0009466439259299865 + 0.003392795606470181i, -0.001973472450365057 + -0.009219296947266068i, 0.003312687309660239 + 0.002644118948500729i, 0.0004827159495974292 + -0.0007617462601442953i, 4.912224951579209e-05 + 0.00040243590678774036i }, { 0.017771475076977235 + -0.03225324849428524i, 0.1590788905599481 + -3.4024711575319555e-20i, 0.003373807301186151 + -0.0010122356663576529i, 0.010863207901174496 + 0.010654625813114282i, -0.007046833891609251 + 0.0022788776986037433i, -0.0037532653117494383 + 0.005073055373280233i, -0.0006338478374292521 + -0.00031635533717794576i, -0.0005960816534961713 + 9.504729186166693e-05i }, { 0.0076371509250910755 + -0.007490511654142914i, 0.003373807301186151 + 0.0010122356663576522i, 0.1059037878637767 + 1.6803778304707005e-20i, 0.016828644459503838 + 0.030542115903339828i, -0.0007522456331411673 + -0.0004973917573297858i, 0.00040331252457336084 + -4.131176577955328e-05i, -0.0018687737553560605 + -0.00873018530088832i, 0.003136939207258236 + 0.0025038404240625605i }, { -0.0009466439259299867 + -0.003392795606470181i, 0.010863207901174498 + -0.01065462581311428i, 0.016828644459503838 + -0.030542115903339828i, 0.1506392732539023 + 1.3589109144071505e-19i, -0.0003285830839851253 + 0.0006275961578065435i, 8.347433964976583e-05 + 0.000597812144360586i, -0.006672977994983899 + 0.002157976329504427i, -0.0035541432109620625 + 0.004803914409497046i }, { -0.0019734724503650573 + 0.009219296947266068i, -0.007046833891609251 + -0.0022788776986037438i, -0.0007522456331411672 + 0.0004973917573297857i, -0.0003285830839851251 + -0.0006275961578065435i, 0.10872725306964312 + 6.222528893335517e-20i, -0.0025396656285324734 + -0.019759483970674792i, 0.007424786220608224 + 0.007282224518081316i, 0.0011500016853374638 + -0.0015194383648578376i }, { 0.0033126873096602388 + -0.002644118948500729i, -0.0037532653117494383 + -0.005073055373280233i, 0.00040331252457336084 + 4.1311765779553075e-05i, 8.347433964976585e-05 + -0.000597812144360586i, -0.0025396656285324734 + 0.019759483970674792i, 0.13398144505359555 + -1.2071745239709948e-19i, -0.0014968599721296826 + 0.0011792400284576468i, 0.009149349026724006 + 0.008973674369500566i }, { 0.0004827159495974291 + 0.0007617462601442952i, -0.0006338478374292521 + 0.0003163553371779458i, -0.0018687737553560605 + 0.00873018530088832i, -0.006672977994983899 + -0.002157976329504428i, 0.007424786220608224 + -0.007282224518081316i, -0.0014968599721296829 + -0.0011792400284576468i, 0.10295894274628452 + -1.958859614922218e-21i, -0.0024049286693125127 + -0.018711183455814222i }, { 4.912224951579204e-05 + -0.0004024359067877402i, -0.0005960816534961713 + -9.504729186166696e-05i, 0.003136939207258236 + -0.0025038404240625605i, -0.003554143210962062 + -0.004803914409497047i, 0.0011500016853374635 + 0.001519438364857838i, 0.009149349026724006 + -0.008973674369500566i, -0.0024049286693125127 + 0.018711183455814222i, 0.1268733233010288 + -2.1987002147846305e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.11183708415182012, 1.0e-7), DoubleNear(0.1590788905599481, 1.0e-7), DoubleNear(0.1059037878637767, 1.0e-7), DoubleNear(0.1506392732539023, 1.0e-7), DoubleNear(0.10872725306964312, 1.0e-7), DoubleNear(0.13398144505359555, 1.0e-7), DoubleNear(0.10295894274628452, 1.0e-7), DoubleNear(0.1268733233010288, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, true}), Matrix({ { 0.12061314142542456 + -1.1265246445274491e-19i, 0.008329344672460548 + 0.00683207542255177i, 0.008236451903242244 + 0.008078305584786893i, 0.00011120391675442968 + 0.0010244244594086868i, 0.005220818653289568 + -0.0009625617260913474i, 0.00041506499006272444 + 0.00022925792409364532i, 0.00042098969399906403 + 0.0002839431484698596i, 1.29890262395468e-05 + 4.345541149633677e-05i }, { 0.008329344672460546 + -0.006832075422551768i, 0.1602567674847985 + -2.6893587828531744e-19i, 0.0010263876585826005 + 9.132446794607766e-05i, 0.010943642972550759 + 0.010733516468210053i, 0.00030601726551466864 + -0.0003622037754392161i, 0.006936818916352011 + -0.0012789404944183874i, 4.515668198810969e-05 + -4.2381201955970284e-06i, 0.0005593623274161978 + 0.0003772707566146186i }, { 0.008236451903242244 + -0.008078305584786893i, 0.0010263876585826 + -9.132446794607831e-05i, 0.11421424869913312 + -1.5131034795773267e-19i, 0.00788744769167146 + 0.006469613113634361i, 0.00029205071312700566 + -0.0004154063251545524i, 4.369903920620927e-05 + -1.2144198755857893e-05i, 0.004943838399637215 + -0.0009114949090355892i, 0.000393044534294289 + 0.00021709509634875525i }, { 0.00011120391675442925 + -0.0010244244594086872i, 0.010943642972550762 + -0.010733516468210053i, 0.00788744769167146 + -0.006469613113634361i, 0.15175466023779088 + -1.1063459098065976e-19i, -3.3619578115288515e-06 + -4.523035297939979e-05i, 0.00038804314914807716 + -0.0005519437938126268i, 0.00028978212205285804 + -0.0003429877673268134i, 0.006568799647615105 + -0.0012110888247713163i }, { 0.005220818653289569 + 0.0009625617260913474i, 0.00030601726551466864 + 0.0003622037754392158i, 0.00029205071312700566 + 0.0004154063251545526i, -3.3619578115288583e-06 + 4.5230352979399764e-05i, 0.09995119579603867 + 2.1657265158990578e-19i, 0.006902464775984217 + 0.00566168910105868i, 0.006825485242457055 + 0.006694430587437337i, 9.215384265304747e-05 + 0.0008489327822036564i }, { 0.00041506499006272433 + -0.00022925792409364532i, 0.006936818916352011 + 0.0012789404944183874i, 4.369903920620931e-05 + 1.2144198755857925e-05i, 0.00038804314914807727 + 0.0005519437938126268i, 0.006902464775984217 + -0.0056616891010586815i, 0.1328035681287451 + 1.1419371431289843e-19i, 0.0008505596704738681 + 7.567989415391637e-05i, 0.009068913955347743 + 0.008894783714404796i }, { 0.00042098969399906403 + -0.00028394314846985955i, 4.515668198810969e-05 + 4.238120195597042e-06i, 0.004943838399637215 + 0.0009114949090355892i, 0.0002897821220528581 + 0.0003429877673268136i, 0.0068254852424570545 + -0.006694430587437337i, 0.000850559670473868 + -7.567989415391632e-05i, 0.0946484819109281 + 1.6615526664751745e-19i, 0.0065362680985198655 + 0.005361319333891243i }, { 1.2989026239546776e-05 + -4.3455411496336825e-05i, 0.000559362327416198 + -0.0003772707566146185i, 0.000393044534294289 + -0.0002170950963487552i, 0.006568799647615104 + 0.0012110888247713163i, 9.215384265304758e-05 + -0.0008489327822036561i, 0.009068913955347743 + -0.008894783714404794i, 0.0065362680985198655 + -0.005361319333891243i, 0.1257579363171402 + 2.2453868027352853e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.12061314142542456, 1.0e-7), DoubleNear(0.1602567674847985, 1.0e-7), DoubleNear(0.11421424869913312, 1.0e-7), DoubleNear(0.15175466023779088, 1.0e-7), DoubleNear(0.09995119579603867, 1.0e-7), DoubleNear(0.1328035681287451, 1.0e-7), DoubleNear(0.0946484819109281, 1.0e-7), DoubleNear(0.1257579363171402, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, true}), Matrix({ { 0.11906916105001601 + -1.4587217444824498e-19i, 0.018920688464699305 + 0.034338942833478145i, -0.002101089373014224 + -0.009815473653549105i, 0.0035269061400673143 + 0.0028151040176176527i, 0.005153986453671999 + -0.000950239881243924i, 0.001093038733569854 + 0.001335385687068239i, -0.00016928011004381022 + -0.000408101299294945i, 0.000175130574472684 + 9.37068927200732e-05i }, { 0.018920688464699305 + -0.034338942833478145i, 0.16936591456575512 + -1.3842564350966923e-19i, -0.007502525713149841 + 0.0024262440116910268i, -0.003995974638085728 + 0.005401110479925925i, 0.0005449499980421119 + -0.001637381478441907i, 0.007331114301032139 + -0.001351636688496766i, -0.00030538891642217716 + 0.0001648959960673941i, -0.00012986442867759254 + 0.00026568075591449i }, { -0.002101089373014224 + 0.009815473653549105i, -0.007502525713149841 + -0.002426244011691027i, 0.11575822907454167 + -1.1809063796223258e-19i, -0.002703896100567299 + -0.021037254297292016i, -1.2613943310957239e-05 + 0.000441637084693773i, -0.0003441145411130172 + -4.514711936709871e-05i, 0.005010670599254783 + -0.0009238167538830126i, -0.0002849292092128405 + -0.0008890326666258384i }, { 0.0035269061400673143 + -0.0028151040176176527i, -0.003995974638085728 + -0.005401110479925925i, -0.002703896100567299 + 0.02103725429729202i, 0.14264551315683427 + -2.41144825756308e-19i, 0.00013019830009029164 + -0.0001500003417062174i, -0.00021607231887804912 + -0.00020190043812165205i, 5.084938952541465e-05 + 0.0009321899356758774i, 0.006174504262934977 + -0.001138392630692938i }, { 0.005153986453671999 + 0.000950239881243924i, 0.000544949998042112 + 0.001637381478441907i, -1.261394331095722e-05 + -0.0004416370846937729i, 0.00013019830009029164 + 0.00015000034170621743i, 0.0986717109655808 + 2.043708509567577e-19i, 0.01567943107178177 + 0.02845642156414692i, -0.0017411568327068937 + -0.008134008594605283i, 0.0029227203768511607 + 0.002332855354945637i }, { 0.001093038733569854 + -0.001335385687068239i, 0.007331114301032138 + 0.001351636688496766i, -0.00034411454111301726 + 4.514711936709872e-05i, -0.00021607231887804912 + 0.00020190043812165208i, 0.01567943107178177 + -0.02845642156414692i, 0.14035224924809525 + 2.4029202337506474e-19i, -0.006217286173443309 + 0.002010610016417144i, -0.003311433884625773 + 0.004475859302851354i }, { -0.00016928011004381025 + 0.00040810129929494507i, -0.0003053889164221771 + -0.00016489599606739407i, 0.005010670599254783 + 0.0009238167538830125i, 5.084938952541467e-05 + -0.0009321899356758775i, -0.0017411568327068937 + 0.008134008594605282i, -0.006217286173443309 + -0.002010610016417144i, 0.09592796674138598 + 1.7835706728066553e-19i, -0.0022406981972776874 + -0.017433413129196995i }, { 0.00017513057447268406 + -9.370689272007324e-05i, -0.00012986442867759254 + -0.0002656807559144901i, -0.0002849292092128405 + 0.0008890326666258385i, 0.006174504262934977 + 0.001138392630692938i, 0.00292272037685116 + -0.002332855354945637i, -0.0033114338846257727 + -0.004475859302851355i, -0.0022406981972776874 + 0.017433413129196995i, 0.11820925519779006 + 9.844037121136221e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.11906916105001601, 1.0e-7), DoubleNear(0.16936591456575512, 1.0e-7), DoubleNear(0.11575822907454167, 1.0e-7), DoubleNear(0.14264551315683427, 1.0e-7), DoubleNear(0.0986717109655808, 1.0e-7), DoubleNear(0.14035224924809525, 1.0e-7), DoubleNear(0.09592796674138598, 1.0e-7), DoubleNear(0.11820925519779006, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, true}), Matrix({ { 0.14814737134729106 + -1.6527716077115644e-19i, 0.010116714350303105 + 0.009922465522268909i, -0.0031316025079553096 + -0.00226732584082711i, -6.19927675043979e-05 + -0.0003645768756755854i, 0.006412655790447016 + -0.0011823006000396307i, 0.000517095531989144 + 0.0003487632488528827i, -0.00015364801583115972 + -7.315070499877018e-05i, -5.5929290600260024e-06 + -1.5286210656662906e-05i }, { 0.010116714350303108 + -0.009922465522268909i, 0.14028770426848008 + -1.1902065718675777e-19i, -0.0003657101035429458 + 5.491376573167579e-05i, -0.0029654615031446422 + -0.0021470373327960703i, 0.00035872165286914036 + -0.0005102375610599298i, 0.006072444964257123 + -0.0011195759697010593i, -1.539175764103997e-05 + 5.295553647150208e-06i, -0.00014549652289024304 + -6.926983838168483e-05i }, { -0.0031316025079553096 + 0.00226732584082711i, -0.00036571010354294575 + -5.491376573167584e-05i, 0.13272253756293204 + -2.163111819669059e-19i, 0.009063380525489897 + 0.008889356530728037i, -0.00011745890659868908 + 0.00012313465666216738i, -1.6268244042176286e-05 + 5.415971700018166e-07i, 0.005744981779194563 + -0.0010592016204701042i, 0.0004632564894261177 + 0.0003124506562315955i }, { -6.1992767504398e-05 + 0.00036457687567558546i, -0.002965461503144642 + 0.0021470373327960694i, 0.009063380525489897 + -0.008889356530728037i, 0.1256812046684439 + -1.4292428175163466e-19i, 2.261341464532137e-07 + 1.627568600883436e-05i, -0.00011122735559031728 + 0.00011660198990995355i, 0.00032137220940594245 + -0.00045711255790724945i, 0.005440193082995197 + -0.0010030077641058463i }, { 0.006412655790447016 + 0.0011823006000396307i, 0.00035872165286914036 + 0.0005102375610599298i, -0.00011745890659868908 + -0.0001231346566621674i, 2.2613414645320353e-07 + -1.627568600883435e-05i, 0.12276860336447715 + 1.729473473996426e-19i, 0.008383644475962466 + 0.008222671944988286i, -0.0025951352541591856 + -0.0018789157331587248i, -5.1372936394344086e-05 + -0.00030212209260704296i }, { 0.0005170955319891441 + -0.0003487632488528826i, 0.006072444964257122 + 0.0011195759697010593i, -1.62682440421763e-05 + -5.415971700018014e-07i, -0.00011122735559031727 + -0.00011660198990995345i, 0.008383644475962463 + -0.008222671944988286i, 0.1162553568491989 + 2.7171552693217984e-19i, -0.0003030611899484557 + 4.550662129912435e-05i, -0.0024574554631734812 + -0.0017792335585952038i }, { -0.0001536480158311597 + 7.315070499877013e-05i, -1.5391757641039965e-05 + -5.295553647150213e-06i, 0.005744981779194563 + 0.0010592016204701042i, 0.00032137220940594256 + 0.00045711255790724945i, -0.0025951352541591856 + 0.0018789157331587244i, -0.00030306118994845565 + -4.550662129912446e-05i, 0.10998616056030663 + 1.578190185031616e-19i, 0.007510754721842332 + 0.007366542356853845i }, { -5.592929060026041e-06 + 1.528621065666292e-05i, -0.0001454965228902431 + 6.926983838168485e-05i, 0.00046325648942611785 + -0.0003124506562315954i, 0.005440193082995197 + 0.0010030077641058463i, -5.137293639434422e-05 + 0.00030212209260704285i, -0.002457455463173481 + 0.0017792335585952025i, 0.007510754721842334 + -0.007366542356853845i, 0.1041510613788694 + 1.1897841998886614e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.14814737134729106, 1.0e-7), DoubleNear(0.14028770426848008, 1.0e-7), DoubleNear(0.13272253756293204, 1.0e-7), DoubleNear(0.1256812046684439, 1.0e-7), DoubleNear(0.12276860336447715, 1.0e-7), DoubleNear(0.1162553568491989, 1.0e-7), DoubleNear(0.10998616056030663, 1.0e-7), DoubleNear(0.1041510613788694, 1.0e-7) }));


}
}

}
