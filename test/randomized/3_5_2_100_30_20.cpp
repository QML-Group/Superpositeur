#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.08635897076874133 + 0.037477562743435784i, -0.06618973420477486 + 0.12159791913159228i, -0.020978939606874813 + 0.18672948238544534i, 0.06274289993999413 + -0.12376030745960498i }, { 0.0060635804356873255 + 0.025047915594566567i, -0.0382931706672526 + 0.04012872985979407i, 0.17544323699123932 + -0.16194141592034966i, 0.07449571097019778 + -0.04051078706866821i }, { 0.17920380231356559 + 0.08086612982500666i, -0.17271331131789516 + -0.05976265293443313i, -0.10676875090424298 + -0.043225603608888746i, 0.032479431100398734 + -0.1868981891903593i }, { 0.04359670424241798 + 0.055138970692944364i, -0.006298861476061499 + -0.01564385887073615i, -0.12528409289271977 + 0.12910904465239267i, 0.12098605984236425 + -0.18052176261402028i } }), Matrix({ { -0.1388425123018616 + 0.16091928969288444i, -0.06912789191947454 + 0.1378381621074635i, -0.05497535224192834 + 0.021489733441205635i, -0.1529404804306948 + -0.02310004560609641i }, { -0.07642138753576096 + -0.008953981797345632i, 0.05291965203637662 + 0.19429173315096698i, -0.09760791699720354 + 0.1350794201506278i, -0.14580298783097806 + 0.011199663811170272i }, { 0.006353723511692439 + -0.014682755774765657i, -0.009429894087521932 + -0.058346946061870984i, 0.0763588751515866 + 0.06920078565831458i, -0.11551990440612446 + -0.04288135495594664i }, { -0.11021861501704669 + -0.050753292710428353i, 0.03828299322851058 + -0.03985452205190121i, -0.011706694043685283 + -0.036501180319806606i, 0.14149407871049752 + -0.05555954269148588i } }), Matrix({ { -0.005835539126098539 + 0.07160105163170127i, 0.021225908382303194 + -0.008365035822587597i, -0.07692702112787929 + 0.002496869453226236i, -0.05431998306260655 + 0.04626503656047798i }, { 0.15365828769121992 + -0.03925784065914143i, 0.03133875977837455 + 0.06655783102981752i, -0.01361958067573685 + -0.1340907508160406i, 0.015285528909536458 + 0.08146701946784929i }, { 0.05736066244244702 + -0.05608501589392891i, -0.12725587952830708 + 0.17262194580755005i, 0.1590604968926987 + 0.10166033824828227i, -0.06921813440946548 + -0.09370401683310073i }, { -0.0689041002529153 + 0.04705911138656946i, -0.10146633922005927 + 0.14176814066445156i, -0.14131677094500014 + -0.06782763390858834i, -0.03892706176049879 + -0.042736356297976806i } }), Matrix({ { -0.03700526904015986 + -0.01897246525928877i, -0.01869016562790583 + 0.0017745586491267494i, 0.20042576543474458 + 0.01297963208503418i, 0.13045442560613177 + -0.02935207931508387i }, { 0.019086112963446356 + -0.056631290559071346i, -0.053012792403967585 + -0.0719633401897925i, -0.12785215628792207 + 0.005677014436248923i, 0.020133472683369718 + 0.023760121504309277i }, { 0.03973593051765685 + 0.1988169383272608i, -0.19900774626642828 + -0.04864816477156278i, -0.07142391859126718 + 0.005753313845248685i, -0.13818227460485602 + 0.16866103814466163i }, { 0.007711459033074992 + -0.013439481559666877i, 0.0785496008927678 + -0.13143682462529277i, 0.12610659956053355 + -0.07448559583095911i, -0.03637577782426806 + 0.04688657115374529i } }), Matrix({ { 0.003489139828555818 + -0.008632300836358459i, -0.07039172129142997 + 0.0034041102670452285i, 0.06478571996057905 + 0.1661641560906906i, 0.06335631296756357 + 0.04514356018169948i }, { 0.07131386717531332 + 0.05689701533383888i, -0.12589322696338667 + 0.08761991734135047i, 0.030598889582840225 + -0.016266564310562292i, -0.12601009243397496 + 0.042513708014389584i }, { 0.09608275411614506 + -0.07550000176297496i, -0.2525264470490355 + -0.015166049569182397i, 0.0954620857036058 + -0.054280686000209855i, -0.0506513974689511 + 0.02838525522257195i }, { -0.061081278039194685 + -0.05932890433235004i, -0.061803133901385386 + 0.08012890920489331i, 0.021066378878542954 + -0.11077479631269146i, -0.17326802349139406 + -0.043818773219746115i } }), Matrix({ { -0.016703791742841426 + -0.1514086727839576i, -0.11701127846788115 + 0.024040461745497628i, 0.06136632848189082 + 0.047252761022379706i, 0.009943174207102399 + -0.020288053548565357i }, { -0.08028456607256368 + 0.02158237164897688i, 0.027290870864788142 + 0.1765907646625151i, 0.23201308332702494 + -0.14971646493195911i, 0.06763288621625908 + -0.019266471180141676i }, { -0.03787797814403572 + 0.06527540504719508i, 0.0703224679074566 + -0.05367972716904474i, -0.016751862506260547 + 0.005564931633611553i, 0.013752789967398225 + -0.02110632496011325i }, { 0.08913980024019907 + 0.01253835300365744i, 0.0030550425901019747 + 0.04927839869250161i, -0.0427779493089684 + -0.09501910919192028i, 0.1288447347427672 + -0.1915447149092221i } }), Matrix({ { 0.021228561644685045 + -0.08035804437229183i, 0.10199007668214811 + -0.18358505476928835i, -0.0854240197105566 + -0.059457206792774525i, 0.0015955474181956 + -0.14802137593505452i }, { -0.08320417253288376 + -0.0771387967064393i, 0.0004219583495413967 + -0.015385117684097692i, -0.011681945462638479 + 0.08162010164102229i, 0.13032566979846938 + -0.03391608829793539i }, { 0.007090183873620466 + -0.04442119753065831i, -0.042471143501723936 + 0.021981777899462058i, 0.03379259620359384 + 0.03217241733016856i, -0.0423196491679085 + -0.05089632954812426i }, { -0.05510082924009378 + -0.07408616021238487i, -0.01461782904649584 + -0.045573036943081624i, -0.03530328900096508 + -0.021645805600505708i, -0.03284138286929089 + -0.049275940502521126i } }), Matrix({ { 0.10180525819049031 + -0.053370090174638986i, 0.08116825330792994 + 0.006167574179257256i, -0.10493188171376212 + -0.10089293750159746i, -0.11044984277599627 + -0.033446625852781624i }, { 0.050079864076280144 + -0.003658211233019535i, -0.06773650018391644 + 0.0003229766333743097i, 0.001326984375733898 + -0.07013349473456375i, 0.0796626800142292 + -0.08253523543565221i }, { 0.016869208093960687 + -0.13869588407699746i, 0.0391427058796432 + 0.0071700435298980335i, -0.05810287424917782 + 0.112085780303536i, -0.11543988402938477 + -0.12728661621718584i }, { -0.07802691756103408 + 0.003437450941193275i, 0.07567226456605176 + 0.15570386772155542i, -0.1551012411134146 + -0.073366979158124i, -0.14256686352897138 + -0.009568976513144515i } }), Matrix({ { -0.12298151995542259 + -0.13731661070824258i, -0.09718361381313159 + 0.027319511246496037i, -0.09395710836440897 + -0.09919243110750282i, 0.16449898759880494 + 0.028171692835390998i }, { -0.1502621899113975 + 0.03127353549705391i, 0.07570354116690083 + -0.10362342309824653i, 0.0284945341617769 + -0.09956443014696723i, 0.0030365540523033534 + 0.06452730437869328i }, { 0.07517537250914223 + 0.09277453234368921i, 0.053558910714679046 + 0.2088639816099504i, -0.01777570238378297 + -0.04500949013014155i, -0.057278030820485826 + -0.09546983797922887i }, { 0.04493629493522574 + -0.05964292161799573i, -0.11582524759998794 + 0.16648803342222648i, -0.0006966757325848767 + -0.04640253118692929i, 0.001803950515992177 + 0.1427079302485004i } }), Matrix({ { -0.0003855827150311621 + -0.10287418204745598i, 0.07510209105266968 + -0.011846612702735555i, 0.02251187976043058 + 0.10481943774043437i, 0.13268238025310686 + 0.020831494450910985i }, { 0.11349883171200692 + 0.03484131481119166i, 0.017719464564681764 + -0.02634026712031841i, 0.09382451750303947 + -0.03754692517366353i, -0.12150114883267621 + -0.09612208914934475i }, { 0.02796235780232744 + 0.04087790768725505i, -0.10451217323496582 + 0.03844664006847385i, -0.11317373792898301 + 0.17582165457801088i, -0.008940940469062396 + 0.10124542002456423i }, { -0.046496559401584175 + -0.06312238742355525i, -0.08865170559056039 + 0.1138093698977505i, -0.03237544953219885 + -0.20493928207217038i, 0.0831509605692887 + -0.03877988933891854i } }), Matrix({ { -0.08236994402007942 + 0.17504221354457417i, 0.06927358325077267 + 0.09923040696388248i, -0.040837546756194554 + 0.0789839080342965i, -0.026762141637689297 + -0.11894090088073976i }, { -0.018253741111320665 + 0.06278873453265729i, -0.03115948659028407 + -0.007533762821077724i, -0.02496509186580111 + -0.08802576180785326i, -0.0041778764903000025 + 0.0730811397770535i }, { -0.07460274600172674 + -0.018265612066133384i, 0.07688239907378625 + 0.14708311749483657i, 0.006972967511099933 + -0.12433926890097316i, 0.022079665592087683 + 0.04292669067568943i }, { 0.08828452152585388 + 0.15464257022547948i, -0.08348385926217759 + -0.07301987309140917i, 0.023613275930306866 + 0.03394387922588082i, 0.043684853270869704 + -0.08552461140131293i } }), Matrix({ { 0.047896371060226275 + -0.15406701601228215i, -0.03376550509425189 + -0.04191427372904264i, -0.006612501653688351 + -0.005899931759542957i, 0.023974298654796472 + -0.16607174760286095i }, { -0.05642428859868029 + 0.01834241617709973i, 0.10611428082644231 + 0.14021749232621306i, 0.08569857687400756 + 0.09994482386029938i, 0.09569043431499874 + -0.07675285380425045i }, { -0.07952346087967808 + 0.01918528187405127i, 0.025738302795679308 + 0.0441694530782627i, -0.0402656682711008 + -0.06078839053430897i, -0.009017308957572157 + -0.041255176415779075i }, { -0.034664673935572314 + -0.05255447788537349i, 0.01173289479975754 + -0.024164471489324057i, 0.11406226476872583 + 0.13395932162533328i, -0.02615390077816272 + -0.1460860728044216i } }), Matrix({ { -0.13385776096167223 + -0.17914436067633502i, -0.06241937280606113 + -0.009046169362428073i, 0.005918279356461987 + -0.04620958017497297i, -0.03999212672373168 + 0.0626055033568393i }, { 0.1570131404540571 + -0.06715947836299374i, 0.011768106221969023 + -0.0034427606567484716i, -0.07822257217312789 + 0.0981226762847189i, -0.09005897445352358 + 0.06421061339588488i }, { 0.0977249384149405 + -0.11176167313737795i, 0.11963949477584364 + 0.12990533567871565i, 0.06093260240184885 + 0.0581572276643382i, 0.05149626511354253 + -0.022315554152461187i }, { -0.006447705703599033 + -0.1674778721408369i, 0.03209087162920599 + -0.2100381593562668i, -0.09058863292475598 + 0.09233284401025071i, -0.06608962605741128 + -0.023651927033348404i } }), Matrix({ { -0.024340949833226665 + -0.04062857115750146i, -0.047916574927909746 + 0.06206108672211922i, -0.020095421006452723 + -0.09853891361257329i, -0.12786847947884325 + 0.023944115045674428i }, { -0.17704670801489206 + 0.024928905108224604i, -0.03560621834889726 + -0.02583357051321741i, -0.015301585044127677 + 0.04363581483696176i, 0.06879718365967621 + -0.1546678001819068i }, { -0.03758420950676408 + -0.047549372892288715i, 0.09590642037919024 + 0.024476606002000773i, -0.03391100196082937 + 0.06660278350377671i, 0.0026063157597623152 + -0.016980661181328963i }, { 0.17560644044456994 + -0.11251220945802225i, 0.18711128609844596 + -0.018155462606752337i, 0.05150961795474212 + -0.10252636188326446i, 0.01125569481106486 + -0.003319485903174033i } }), Matrix({ { -0.08693726816169114 + 0.14543687461651203i, 0.05943556253687734 + 0.011768968832554782i, 0.1527682848555483 + 0.06994182215876024i, 0.012207933396045714 + 0.1448249984283548i }, { -0.07811150062462317 + 0.03706322831415854i, 0.06472017552821926 + -0.05507067203306177i, 0.09870175480576804 + 0.07252493717155813i, -0.004302641111882582 + -0.08231623795262366i }, { 0.04385556358750366 + 0.11755281944394569i, -0.07295820123083083 + 0.12596436753195678i, 0.009064797566850174 + -0.014220697225847694i, 0.07096970726327778 + -0.08913391782431697i }, { 0.11132340744811678 + -0.20519978059565616i, -0.06866920899942593 + -0.01748614651381251i, 0.023962296425102128 + -0.04361708729385491i, 0.023167361075396988 + -0.11759947457484453i } }), Matrix({ { 0.06444841251136625 + 0.09022639800940338i, 0.04157419439353116 + -0.08773242022616377i, 0.07253600383976236 + -0.0063120801782829035i, -0.0776502616781486 + -0.03275704353655213i }, { -0.04225168352557612 + -0.099138052320235i, 0.033730758001898585 + -0.025809676755642146i, -0.07227282095934537 + 0.08759778242662442i, 0.04139394887532313 + 0.2114978570355253i }, { 0.08142504444583942 + 0.0915209704577307i, -0.1676092422478225 + 0.0444450831015644i, -0.0800306710744351 + -0.09408203894240885i, 0.10844000515033311 + 0.20092610138207675i }, { 0.05573196286039441 + 0.23443268759810235i, -0.049155122142398984 + -0.06909660720112466i, -0.15837504387631915 + -0.008877545216836853i, 0.07837552018444204 + -0.043314273470213535i } }) }, { QubitIndex{ 1 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.002835950595692971 + 0.0853647909093755i, 0.03414743559872816 + 0.1152350209864837i, 0.004183878663429686 + -0.05992968450610727i, 0.027395090757535025 + 0.028871997082311425i }, { -0.05698831413298767 + -0.04114512368475374i, 0.04240841413435674 + 0.07521776590919978i, -0.056554484669378936 + 0.030747525372263367i, -0.0840908329753679 + -0.04123523243684634i }, { 0.028080360011309712 + -0.018496318441340122i, 0.11955871151313928 + -0.08058564150795688i, 0.1862240089435601 + 0.060713557247342904i, -0.0045010761724276 + 0.1579592657606927i }, { 0.16144879297070447 + 0.04722154512417522i, 0.07657086218383799 + 0.079444550006445i, -0.14635728165966969 + -0.013147289489391053i, -0.01621696921095274 + 0.08302273499039774i } }), Matrix({ { 0.10976130324766847 + -0.11373805401551251i, -0.09867260501923052 + 0.0006185420111694702i, -0.07253447773725445 + 0.15341087037705262i, 0.08711703818863067 + -0.02936575036118828i }, { -0.025521166030215134 + -0.03085045418055659i, -0.03949155591258277 + 0.1610984445210418i, 0.03007518499825944 + -0.01984733898993272i, -0.030098090715905676 + 0.027786789964008327i }, { 0.024136541272630638 + -0.10388471657381121i, 0.020846339429809478 + 0.10503290884996701i, -0.04238706246242121 + 0.08952218628056655i, 0.11177016043653243 + 0.06508579886640654i }, { -0.049342576736898756 + 0.020519603396283715i, -0.014974920146093947 + -0.14747752670923184i, -0.006044480158862655 + 0.039649916940277655i, -0.05288870500492111 + 0.04374722530165262i } }), Matrix({ { 0.00878919421619063 + -0.16377433158392038i, 0.07153408910652782 + -0.14813481893840807i, -0.054121127605435505 + -0.15127423531007128i, -0.09997925272481427 + -0.041999135577150806i }, { -0.1347169442768295 + 0.03775169032113375i, -0.11020677125587731 + 0.004289532589980604i, -0.056402308228739005 + 0.12474511886025727i, -0.10736168794399054 + 0.05260857468419163i }, { 0.013520756884022305 + 0.04893956326181605i, -0.08113716697447375 + -0.0011092416844553257i, -0.0033552475322212445 + -0.12064197285387494i, 0.11072237652249982 + -0.2241443108453988i }, { -0.21440489847784397 + 0.11630244769913037i, 0.053852597536267074 + 0.018453874799560527i, 0.18954473907591943 + -0.21287246876832788i, -0.18205230721748147 + 0.10475302639843664i } }), Matrix({ { 0.047969403048201686 + 0.040685504372800045i, 0.05221335978678271 + -0.042143707715622196i, -0.03823387309799287 + 0.013405157447644821i, 0.03769772618475447 + 0.009919438603552481i }, { -0.020559594301485726 + 0.2013975532309012i, -0.10487763536857277 + -0.10659596269239478i, -0.0011149456132812467 + 0.10982854021813071i, -0.02998982836956764 + -0.16335735369236515i }, { 0.05934798329627824 + -0.0656287223544313i, 0.042001777635701704 + 0.10806854327710771i, -0.005225099913445192 + -0.009823889081506167i, 0.053692384270455654 + -0.0888485243432056i }, { -0.018894527504959874 + 0.0835917871933189i, -0.17113908699815622 + -0.12372090351508853i, 0.02547169069888697 + -0.1141923490235733i, 0.008619567774822538 + -0.0707367034127961i } }), Matrix({ { -0.06198752010719957 + -0.058191613170195i, -0.02351862560481662 + -0.04249212052884438i, 0.11375390615805916 + 0.08262700776688767i, -0.04698848932629679 + 0.07544993771053791i }, { 0.11715071429993171 + -0.13338353697956906i, -0.006820982166961687 + -0.1774429039434735i, -0.04931975021699375 + -0.10936009965906117i, -0.14945163639620798 + -0.019450691929086425i }, { -0.04778923529471882 + 0.13204780475639263i, -0.13048221970985308 + 0.009407479415474356i, -0.04603238451972525 + 0.08941870714873873i, -0.0010183976120540878 + -0.17494910820591358i }, { -0.07593137667138668 + 0.17910104353153075i, 0.08751697961494696 + 0.10277511853186704i, -0.009105214234424551 + 0.038673074182215196i, -0.07337546109581813 + -0.03882051617046954i } }), Matrix({ { 0.04250239285097104 + -0.09619047655470715i, 0.01226428223043076 + 0.005034484527034175i, -0.1664659476614247 + 0.024666863674041382i, -0.05372955078957293 + -0.03137712046484587i }, { 0.07517712491298936 + 0.1262140846254767i, 0.07269305245803495 + 0.21159665474171135i, -0.05498203534912157 + -0.07810383692026628i, -0.06075349261228228 + -0.03094005104139155i }, { 0.13312353541900715 + -0.05943625305318527i, 0.0023518039925532353 + -0.10097869609578722i, -0.07959520212548539 + -0.023427801230253727i, -0.27224260930332833 + -0.09961309397608083i }, { 0.02125427073577783 + 0.016476479272920112i, 0.026199346274887216 + 0.05050361448804363i, -0.05289894348333269 + -0.00446144988714084i, 0.10991710428164933 + -0.04435960756942402i } }), Matrix({ { -0.011254798343244244 + 0.033176271409446324i, -0.014282492023872651 + 0.05087793535245645i, -0.08501851403793656 + -0.009343343788260622i, -0.09798501043886486 + -0.05769121722398139i }, { -0.04059192976888286 + 0.05751476716305498i, 0.023257829940135248 + 0.04522354349008114i, -0.06646428726749964 + -0.17152700602209647i, 0.04140645151339138 + -0.06057986344512413i }, { -0.09072875678944117 + -0.010650702484012174i, 0.0837479594041734 + 0.13131288180064532i, 0.055224502262103334 + -0.08591987379815137i, -0.021224671848686587 + 0.010463867649926305i }, { -0.05408431544265213 + 0.03395034159491818i, 0.017958764724985327 + 0.00605298890598386i, 0.10576204106475659 + 0.20224984348173944i, 0.08466747412415077 + -0.11609267867777281i } }), Matrix({ { -0.01645751418974817 + 0.023086213035088402i, -0.0931045755303575 + -0.013890205226004204i, 0.21576804719314957 + 0.08692882918717514i, 0.07630714840714 + 0.08931208298889005i }, { 0.16190059284229757 + 0.04275447671391061i, 0.026261812978657265 + -0.0474614270374219i, 0.05196332907434929 + 0.007565570757979124i, 0.03253983551163192 + -0.0795690628270012i }, { 0.026417653153142928 + 0.06038344529256947i, -0.05211584982978542 + -0.023825843800672465i, 0.02853990601239687 + -0.06995092140862724i, 0.08283855321308359 + 0.06693937248398203i }, { 0.00098865611359322 + 0.05847429018723636i, 0.03363372281311968 + -0.0522691009066465i, 0.06107947110329893 + 0.03672685991182022i, 0.10720289732832868 + 0.03512165940288386i } }), Matrix({ { 0.06263155848720792 + 0.13389927628873907i, -0.0232388100550001 + 0.13505084992158467i, -0.0027274664494464974 + -0.1550579722074715i, -0.11950931127124526 + 0.10987475572989029i }, { 0.03811429955212565 + -0.14024012190134358i, -0.1983351088789188 + -1.4690377849754575e-05i, 0.07877782887699372 + -0.08018125287657549i, -0.005094155548076601 + -0.10899616558230583i }, { -0.03233242655454413 + -0.07076659912341457i, -0.08173934637834918 + 0.07543028862248839i, 0.022207043601110775 + -0.015229683917727365i, 0.021667201043825454 + 0.10962910273034251i }, { -0.011073856754035495 + -0.08488304143443433i, 0.11183500575114469 + -0.17966055170938575i, 0.06831635216098401 + -0.07374914464198494i, -0.04331398708241872 + -0.021686388757987098i } }), Matrix({ { -0.13764021694053427 + 0.09189443184901758i, 0.03088783851788925 + -0.011898675187772564i, -0.05859687778047579 + -0.026899422157878865i, 0.06996085730848843 + -0.1089543312747972i }, { -0.1547879678311597 + 0.22660549091962834i, -0.10373922110703218 + -0.21473778326745033i, 0.056781729043527046 + -0.0301771030007151i, -0.16129129613424806 + -0.1363454761080608i }, { 0.10907519362135777 + -0.00893237497576554i, 0.002472069456367059 + 0.16156174412924817i, 0.07831105180974152 + 0.0433715525139364i, 0.04913773537131556 + -0.14144043317469687i }, { -0.054108226338391595 + 0.107863198299676i, -0.08443336309360862 + 0.08286588802030667i, -0.050958289071343914 + 0.12241419494992278i, -0.004015137049181692 + 0.10941593266409563i } }), Matrix({ { 0.06605597192679227 + 0.10028567654839234i, 0.023175966796086585 + -0.04542386675128335i, 0.11153492960219659 + -0.06781535774881207i, -0.011242321428471157 + 0.07079422399111862i }, { -0.011025193325640562 + -0.0066913007453326i, 0.07661657436868678 + 0.06396461377097519i, 0.08743154100033805 + 0.027536111544314838i, -0.03100272662689799 + -0.14575827939780958i }, { 0.17884205952283558 + 0.03945206694245568i, -0.12981328327337355 + 0.004177078117572659i, 0.17756060725035364 + 0.09942339923155499i, -0.14502726601209961 + -0.19064878171853034i }, { 0.02575148868427385 + -0.020222841293343508i, -0.049533349373130586 + -0.06515270889594375i, -0.00885099577769117 + 0.09221785369492981i, 0.05523492246993829 + -0.07469636666533169i } }), Matrix({ { -0.09791728097483941 + -0.113270978784265i, 0.022155266046600158 + 0.06038234771869179i, 0.059110096387216614 + -0.07149265449306479i, -0.0908147025999197 + 0.0678220648294151i }, { 0.09878603211064504 + -0.04378989523426303i, -0.04455558115977326 + -0.02384717519449676i, -0.08124177055650339 + -0.026924267998395774i, 0.09045177248486096 + 0.0570831739872345i }, { 0.129981678456433 + 0.017638898900301916i, -0.12246641196711792 + 0.05766587122335548i, -0.13171873621200678 + 0.17679089619262114i, -0.020424075142551085 + 0.04095869385657838i }, { 0.0770187726368812 + -0.09354292213065746i, -0.10794226258491174 + -0.05488357129082172i, -0.17147307395605493 + -0.030336521943359472i, 0.07790469180874138 + -0.0914770847422541i } }), Matrix({ { 0.02615744111103341 + 0.06021696301468561i, 0.008496208989719837 + -0.08808146491607033i, 0.008010919839792187 + -0.06982237328121849i, -0.04447826543836895 + 0.0117695798242658i }, { -0.1382013087180589 + -0.09743023601975893i, -0.19050581891933385 + 0.023510206228468188i, -0.12049873658162359 + -0.08664459388184423i, -0.00679590218473301 + 0.07711409410119817i }, { -0.01621638033649567 + -0.03045736309166073i, 0.008096513759634315 + 0.046313251525959526i, -0.13326602032589416 + 0.025544593710674926i, -0.01986620512057856 + -0.021997043453545466i }, { -0.07753736816735644 + -0.10493506695205262i, 0.02353812025694108 + -0.13768854419634943i, -0.004054360019370133 + -0.03577426573276508i, -0.1234073297610572 + 0.0613565839853709i } }), Matrix({ { -0.0886530068266776 + 0.09892155473013245i, -0.13036183244603353 + 0.022598542750877283i, -0.008572526719406384 + -0.10688722297654918i, 0.04596233929194364 + 0.11324248832270928i }, { 0.027417681092555886 + 0.09868220658589913i, -0.05720228637025299 + -0.0008099149346974797i, 0.06653418167908667 + -0.0456358204890965i, 0.036393222337874516 + -0.0408055701459949i }, { 0.21487591774589268 + 0.13720404293356125i, 0.023291087741569547 + -0.09106938186642875i, 0.07835120903999397 + 0.11158594525192649i, -0.037446654777355766 + 0.19262539061452466i }, { -0.029257852287795115 + -0.006064727584931873i, -0.04836442254741236 + 0.046909181209292355i, 0.11691980108924352 + 0.07282181473344973i, 0.009921533544241261 + 0.09833386941950845i } }), Matrix({ { 0.10884644950484225 + 0.02845206967691121i, -0.07257141807531871 + -0.11289407562856793i, 0.0630210836032577 + 0.08873712130176778i, 0.08408435074158105 + 0.04730763037167926i }, { 0.11874420385040887 + 0.03275953401565214i, 0.008954786481197949 + -0.1498290064987983i, -0.05250232160515212 + -0.02488816544940855i, 0.09710856108948551 + -0.015114799751673215i }, { -0.1356535458164067 + 0.007051002224398346i, 0.03971692715205563 + 0.10053753058486994i, -0.02467324270389608 + -0.09413791844941943i, 0.20817754084234413 + -0.12690323444479792i }, { -0.1314993435849184 + 0.06193115466260116i, 0.14305182502237687 + -0.10077391544790423i, -0.10048659217612792 + 0.10959249599433231i, 0.03369501578785761 + -3.564781284570859e-05i } }), Matrix({ { 0.06828876569167085 + 0.006168161553296968i, 0.0781249872909238 + 0.17105960373773363i, 0.14523697214254364 + -0.037504042700738205i, -0.0007667016287917856 + 0.051321714037636176i }, { -0.012199159066433414 + 0.011168817954691674i, -0.14742647212600044 + -0.14380986909217455i, 0.0870052891597093 + -0.06574458693688554i, 0.06674865116886824 + -0.018997774432585286i }, { -0.012099836335534749 + -0.08036741806735417i, -0.034471303668782004 + -0.016269541027993387i, 0.09539681293319512 + 0.00598807683614579i, 0.10029716996418672 + 0.03780716303974982i }, { 0.12397756621521085 + -0.049453809561886906i, -0.08271074886264974 + 0.004935226564285647i, 0.030554479176659967 + -0.11555291546141674i, 0.08234084787505776 + -0.07951317384774308i } }) }, { QubitIndex{ 0 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.05438799336950595 + 0.15779933244946645i, -0.01281403099697374 + -0.020965600948463243i, 0.050878835992006675 + -0.0649968930791389i, 0.03655543737875009 + 0.03865413265316408i }, { 0.0612472265901896 + 0.05713196359091002i, -0.02918713369842701 + -0.06311352275199796i, 0.09652223979127535 + -0.0036993862567275327i, -0.01232893033080988 + -0.07840949442455508i }, { -0.00924976844430955 + -0.0881518129577706i, 0.21227433824006525 + 0.015289873098086396i, 0.0016555989698188614 + 0.03480738126112933i, -0.05987702945001909 + -0.21611885148978113i }, { 0.1311335983096094 + 0.1521015746449969i, -0.05330670029971136 + -0.12990258110313435i, 0.07256674825588005 + -0.026425120070660422i, -0.05583435954199856 + -0.07586326758413543i } }), Matrix({ { 0.051864695989554004 + -0.004500113767647237i, 0.031038025268719276 + 0.025391480415479957i, -0.041321989683676 + 0.16595995660842328i, -0.14046918622983767 + -0.2359167086906956i }, { 0.027884852566236844 + -0.06929897974466809i, 0.06288661598745389 + 0.05755727967718854i, 0.15054342372504106 + -0.02349321190708745i, 0.023521263436977982 + 0.005179977638279378i }, { -0.14669571726829267 + 0.12491554927587373i, -0.07183176431981092 + 0.048082032652525225i, 0.07103827903350636 + 0.09165825691587216i, -0.017072483482009206 + 0.1267872682008698i }, { -0.003263782578894203 + -0.044543165242349324i, -0.004410956773053215 + -0.009793142720727085i, -0.17115728694734766 + 0.10307027642773256i, 0.09208071970722209 + 0.13408450303800185i } }), Matrix({ { 0.06800298309835515 + 0.031837919500257855i, 0.21638191090063363 + -0.20166421053932398i, 0.05326552626659542 + 0.016219785944916236i, 0.045882155168015866 + 0.14027323022441876i }, { 0.10137618707709511 + -0.05647916192711662i, 0.006203749431015242 + 0.03912513839652462i, 0.07990355463897805 + 0.0014458998961590095i, -0.0822377762637548 + 0.00046478079402531797i }, { -0.022542599722367038 + 0.06452644506723512i, -0.03735140974079683 + -0.1362221881156774i, -0.0025021967720922473 + -0.09634767188080418i, 0.21407663977007818 + 0.13638261498367385i }, { 0.07496784872786415 + -0.06824305946440547i, -0.08087657075495343 + -0.0356445013744168i, 0.11212768123981126 + 0.10364536068836024i, 0.06894151000538483 + -0.009463751448198703i } }), Matrix({ { -0.06169688146068762 + -0.009489565921608021i, -0.08400338378748692 + -0.05978066693247438i, -0.023400614503425704 + -0.11836646438887567i, -0.025329938147902815 + -0.14661473741955905i }, { 0.006421820410832136 + -0.10977651066016587i, -0.07559090376120645 + -0.14465934179439302i, 0.10251832875847142 + -0.02073391735520571i, -0.007752256279282111 + 0.055059297650261775i }, { -0.1801671464604228 + -0.03528458627545285i, -0.004061847074928999 + 0.021685294329857895i, 0.007500684917405167 + -0.022039904537891862i, 0.08171253390891134 + 0.15264332296784164i }, { -0.019265776202471975 + -0.041976656751635144i, 0.15556957178323952 + -0.13550632435100562i, 0.017220773095790395 + -0.00450807174610194i, 0.11207186946916618 + 0.05582311915998746i } }), Matrix({ { 0.03750701592731805 + 0.09142875156506859i, 0.1755833997972404 + 0.06196981964496797i, -0.1616369956428936 + 0.09751007221758388i, -0.0023958013145434576 + 0.039795052995108264i }, { -0.06001252480213727 + 0.0053578462399782i, 0.06006114514627414 + 0.07958587067761662i, -0.03245065702326141 + 0.1194222580029465i, 0.10911634555231324 + -0.012197194979385121i }, { 0.1009905297668053 + -0.07164119325971761i, -0.005752895337706478 + -0.17209829596735904i, -0.04822450868834593 + 0.01922843918298797i, 0.06277516120264277 + 0.09459160877517095i }, { 0.011563821994061176 + -0.15719368282231352i, -0.05987978672362595 + -0.017521120295599275i, 0.04170342811585355 + 0.09844026718003546i, 0.04912566388507817 + -0.08417222116843513i } }), Matrix({ { 0.056644591454861865 + 0.14951030884750108i, 0.0020661680655587366 + -0.03189883826916334i, 0.13850083430772892 + 0.048698473618709374i, 0.039289840817270556 + -0.0017483884943747079i }, { 0.02328313998056915 + -0.16357930057182607i, 0.013467686021392975 + -0.07269749482969771i, 0.03870333117911062 + -0.10388655900241481i, -0.020680555363698037 + 0.11586603301939372i }, { 0.0345118934214048 + -0.02623683364180011i, 0.13606844384269803 + 0.10908996373066311i, 0.06005108618273447 + -0.0664154148434961i, 0.0936213115731087 + 0.09173354688098116i }, { -0.12435866552841304 + -0.08264430760428827i, 0.15527191864464562 + -0.09337874627782373i, 0.13783390633258666 + -0.15310017791747532i, 0.03594312914227282 + -0.030628295586412i } }), Matrix({ { 0.04788713611972287 + 0.11374164233505854i, 0.034544681177547755 + 0.03174250455577517i, -0.0031983588354602397 + -0.028873753111344966i, 0.05989063604474755 + -0.015501849442269393i }, { -0.021975916480264653 + -0.03751853976725557i, 0.006598333362524976 + -0.1665231429547461i, -0.1411423046765155 + -0.11786979994732756i, -0.14027154045129625 + 0.17132384399818373i }, { 0.10512481807860169 + -0.09470673702797867i, -0.04991480487082761 + -0.12962732565844912i, -0.149049329943042 + 0.032569186530120565i, 0.11533729157193703 + -0.06138032137298857i }, { 0.06087093327138771 + -0.09729587297211635i, 0.05938588240202147 + 0.02991749529883905i, 0.04974693808674582 + 0.1881479326959402i, 0.08296290965217715 + -0.015127233167574528i } }), Matrix({ { 0.051076480618497754 + 0.05297611364743014i, 0.017544908977400457 + 0.004048879902388764i, 0.032849600676868554 + 0.05123723904389526i, 0.006065904464799292 + -0.10972604957743332i }, { -0.17355326386050118 + 0.11484595421808164i, -0.08797395877293412 + -0.07473602056766801i, -0.06881508291609313 + 0.11544591740205933i, 0.008039924080869067 + -0.008717079126148271i }, { 0.10313442640715317 + -0.07795142074040484i, 0.07210487582315668 + -0.060661652508006474i, -0.04565490843085527 + -0.03502238420753388i, 0.09524027687612416 + 0.07658734072958952i }, { 0.05817346531178959 + 0.06234462846926196i, 0.05116380146634931 + 0.057131766695497806i, -0.0031558264479607462 + -0.03331254405850767i, -0.0413633928095369 + 0.1592646543444104i } }), Matrix({ { 0.07013035186889224 + -0.07689418471114845i, -0.04239614965275165 + -0.03557622773049615i, 0.02762397721615139 + 0.19124365328594092i, 0.07204586756365357 + 0.12162549074933193i }, { -0.14182070562747284 + 0.02274791838485895i, -0.08368444146941263 + 6.418661670383418e-06i, -0.006475020363167141 + -0.0401004978578982i, -0.13067281410902032 + 0.0758254598660028i }, { -0.010805549968958448 + -0.04613122622177624i, 0.11256794758120657 + -0.09066133733318413i, 0.20674221315927688 + 0.031576834467452575i, 0.04657501569873632 + 0.030042048426167i }, { -0.014040627817011198 + -0.1319384424834065i, 0.06378580749423844 + 0.13913065075041872i, -0.060111392643247226 + -0.018367285425805752i, -0.055155447239852246 + -0.0602180615568622i } }), Matrix({ { 0.007896189102812297 + -0.06963895249640197i, -0.14045876407179284 + 0.0410121615413681i, 0.0008702688117504222 + 0.013991051556611329i, 0.06527795840082189 + 0.04598706987015976i }, { 0.03790336802103185 + 0.007271240286027646i, 0.013337529171755281 + -0.0676288260545684i, 0.034108302293422044 + 0.09405045680851772i, 0.13928614529479869 + 0.07874375543193159i }, { 0.06520994462602972 + 0.013358303926652534i, 0.23041967288241844 + 0.015216265174539594i, -0.07931669974743798 + -0.13680299230117188i, 0.01449333387967 + 0.0400440952751896i }, { 0.21623939194741268 + 0.13818421731917138i, -0.009796295740608639 + -0.01647795523570535i, 0.06517095094083117 + -0.06873790727943738i, 0.10515136266984942 + -0.04225149155593376i } }), Matrix({ { 0.04743741669196003 + -0.12499090830315525i, -0.050825736225381 + 0.019358818892799376i, -0.030775375488748282 + 0.0406621602227171i, 0.001910633070695459 + 0.10004579865321547i }, { 0.06299338915757537 + -0.04766403578093227i, -0.09105830142248464 + -0.09390522855711785i, -0.08252105061234027 + 0.11545258461101114i, -0.07810812227803864 + 0.006891797420288807i }, { 0.08617699085653617 + 0.15835258277174927i, -0.041390759190148785 + -0.0009490032566048626i, -0.057419585980891 + -0.14893426234989665i, -0.023150999716433054 + -0.11641310187181246i }, { 0.050435060171422005 + 0.024912987343896912i, 0.24596258611177696 + -0.018455867469972728i, -0.17921012020220944 + 0.046024439695711274i, 0.03554516110385856 + -0.05271157672771398i } }), Matrix({ { -0.06810577670685927 + -0.05607074151566384i, -0.03495338742343186 + -0.003024132004686364i, -0.12882585886564207 + -0.14211596000281793i, 0.05226389533916638 + 0.12040410512625076i }, { -0.20168066804133303 + 0.025065408534876456i, -0.01167284101702302 + -0.17467333323789536i, -0.12828169163499897 + 0.004747550158638892i, 0.04722743579157473 + 0.0905101385987086i }, { -0.06198451584930644 + 0.12280508094303802i, 0.1594885808035507 + 0.032606749499270664i, 0.054760165959329386 + 0.0782860532882974i, 0.1517643721186158 + 0.03154994177146018i }, { -0.1443079850248725 + 0.23343582759443196i, 0.040213809575508845 + -0.050598514395859745i, -0.02216114995083184 + -0.005242181677834215i, -0.023926675983680652 + -0.053324098298286424i } }), Matrix({ { 0.017839380211521892 + -0.21055430940109118i, -0.005542308399735826 + 0.02054663050828597i, 0.11857679630835279 + 0.13104825260346215i, 0.0536147889797347 + -0.030784829663584423i }, { -0.09347732010017741 + -0.04976278909976967i, -0.07780122781598554 + -0.10603239715669305i, 0.0012824918798429517 + 0.17779129881757413i, -0.07933331254508283 + -0.02294906967582676i }, { -0.10439699005516498 + 0.007311017255512371i, -0.08981755455581193 + -0.04272485655699341i, -0.06182325483283849 + 0.022256509636386198i, -0.03324774584030058 + -0.11283102105158402i }, { 0.04270578979919004 + -0.005516257196612737i, 0.12318702097880818 + -0.006614973734937195i, 0.17781729543302913 + 0.016103548880819593i, 0.06156159971524771 + -0.12720571405257827i } }), Matrix({ { -0.04827845442076116 + -0.20601172736299725i, -0.04129920039853893 + 0.12278581514501524i, -0.08625208752718543 + -0.04281133702089859i, 0.120331967802932 + -0.028851401594927245i }, { -0.03487330209315695 + 0.035071553091624366i, 0.11844852312996428 + -0.12715373082481995i, 0.024434305537354765 + -0.07285030154567405i, -0.02626419184791045 + -0.03599823898991014i }, { 0.0744730293483225 + -0.037052795802976296i, -0.03283730364645768 + 0.007649541268372263i, 0.22147893545755773 + -0.01921274279997187i, -0.0009677102970756445 + 0.13359737679052877i }, { -0.05842616390198849 + 0.010428838852649126i, -0.09710977916897852 + -0.0331947659891293i, 0.11424591478071436 + -0.16377727141251358i, 0.17783051727296 + 0.028022700409430085i } }), Matrix({ { -0.1389854144068819 + -0.0297453758568789i, 0.18510687220480163 + 0.029074792821465613i, -0.05136949364190581 + 0.013110033798753699i, 0.04607994344965575 + -0.054056447770451696i }, { -0.029763007485710195 + -0.042088562415515555i, 0.005577591160083249 + 0.14524190130648557i, -0.05633407075713725 + 0.017608921153717955i, -0.010070369802500208 + 0.144527614011707i }, { 0.09305229882949838 + 0.015662520346471445i, 0.057276612930112984 + 0.11410609831037828i, -0.014643010794640454 + -0.06498091083328368i, 0.01304406902592789 + -0.03927273157340556i }, { 0.06578275206652949 + -0.002323707376184557i, 0.022638015951947185 + 0.09547278179350036i, -0.0196487446391478 + -0.09261730442165639i, 0.04721961441173907 + -0.11392014189028675i } }), Matrix({ { 0.04016396646638455 + 0.06081324977372777i, 0.009137202175126868 + 0.08767046022423133i, -0.05378443844029686 + -0.12958294070172022i, 0.037879253157992905 + 0.06345324639613245i }, { 0.10597437459364 + 0.0787309735877882i, -0.058605283065763354 + -0.017895027974000402i, 0.0331431214377145 + 0.03170258333125959i, 0.03655904442786698 + 0.1286262222086737i }, { 0.0745859644204878 + -0.05447248487097103i, -0.06677851947711987 + 0.020598076195319812i, -0.08788767874195935 + -0.039083967402589605i, 0.14530935557937136 + -0.03695391251971579i }, { -0.06489914624334282 + -0.03169672439862521i, 0.07590318220295816 + -0.026476906462479865i, 0.021702822953669765 + -0.008052264463109766i, 0.22931059803038828 + 0.013078350777684213i } }) }, { QubitIndex{ 1 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.0821973846795625 + -0.0705703242231839i, -0.082814169941499 + -0.04516130381931817i, 0.01319011548372495 + -0.04990697860982074i, -0.054540791356237225 + 0.05282850047139303i }, { 0.04103165599138471 + -0.11928792174185004i, -0.02078746930117353 + 0.049110602720694604i, -0.22212778904078628 + 0.09408820324705199i, -0.1942545694850035 + 0.02957592722691855i }, { 0.2411079780991495 + -0.11740041917988209i, -0.06231780652221973 + -0.0899846307239119i, -0.028877853808804952 + 0.018048510643835922i, 0.02181853489132169 + -0.01959708423358289i }, { 0.00022497184179526178 + -0.028440046281332437i, -0.09853327088451848 + 0.09747936518415716i, 0.006585638079637857 + -0.14178059039413105i, 0.0036061819888361024 + 0.07332262244648874i } }), Matrix({ { -0.09254274862811075 + -0.09459557064106033i, -0.09039427400411548 + -0.04516833254159109i, -0.043206223283179614 + -0.07866971699357242i, 0.021291769247817574 + -0.2454534620514329i }, { 0.06582841328869636 + 0.015463662821842698i, -0.035243642070765954 + 0.12931842507195648i, -0.05109251305189307 + 0.007334755115086853i, -0.05552687749023362 + 0.27049468287222733i }, { 0.10516720675043639 + -0.015870511645811484i, -0.09046721525393199 + 0.11050326291415402i, -0.06667196356269259 + -0.08124120157663625i, -0.11996428843610646 + 0.16490647140372464i }, { -0.13507255835539067 + 0.020272832523992416i, -0.09765598187494208 + 0.05533082284957045i, -0.19024498567595222 + -0.014414781472030605i, 0.06283162940027638 + 0.030382879594393015i } }), Matrix({ { 0.14715061296743198 + 0.052975996636493404i, -0.1203795550845723 + -0.02406709880028084i, 0.04851892693580012 + 0.05002898582160013i, 0.15160447838278426 + 0.012072977860365503i }, { -0.02041750442554326 + -0.003257557303935882i, 0.0744843089867974 + -0.0593750463978137i, 0.008608268591759045 + -0.1658936934142429i, 0.11353468180346034 + 0.03973399657890081i }, { 0.0007322179139683063 + -0.0559844716780844i, 0.08511228325425871 + 0.12504152650454478i, -0.10496323927908283 + 0.04503869883807461i, 0.032495504388058705 + -0.06690074549463465i }, { 0.09757659785123461 + -0.03474870069016917i, 0.16299449892427367 + 0.029695696182323043i, 0.015473593216170962 + 0.021429212967555393i, -0.037633830689924534 + 0.03666344261241758i } }), Matrix({ { -0.02203902874722554 + 0.11309501745333433i, 0.11879257584373333 + -0.09312634484430067i, 0.046748084297773725 + -0.026127019100851648i, 0.026209539126569203 + 0.11392285056649966i }, { 0.07242531742825692 + 0.03743072068452177i, -0.0015075771209661648 + 0.10507526838143487i, -0.012467551701226948 + -0.0600163807015984i, 0.0031936216379086545 + 0.054202381687259826i }, { 0.05400218709940898 + -0.03607246658827047i, -0.027690351734003665 + -0.12367228003076615i, 0.03590393290912257 + 0.06701483415764074i, -0.12480753438790773 + 0.134760880296402i }, { -0.17398637296574423 + 0.1192378141403468i, -0.02133598780825005 + 0.01556998281952424i, -0.06148557420259936 + 0.04017698645967873i, 0.014742105897003435 + 0.026055036531349045i } }), Matrix({ { -0.11937842845648901 + 0.10181058622267855i, -0.04193313215133498 + 0.033194421835737974i, 0.12616556449015973 + -0.02475739122670199i, -0.018690971110164992 + 0.02177436596533168i }, { 0.12342451961372294 + -0.02241442893815849i, 0.007340950361872392 + -0.049523201968656255i, 0.002548047382892782 + -0.07728478226014428i, -0.04457114923346946 + 0.01643099936807222i }, { -0.12558383229695474 + -0.13326786629859888i, -0.05996667417240205 + -0.047179474302021546i, 0.0156638962429256 + 0.1127386857314996i, -0.015017269118377176 + -0.00026798937033628567i }, { -0.02818819054339999 + -0.11319793255766468i, -0.022521744387453274 + -0.043641145210060475i, -0.014653076110601767 + 0.025093347658428335i, -0.07940080145065637 + 0.07053628613967033i } }), Matrix({ { 0.09510082630409301 + 0.06222162052295539i, 0.022567319952563548 + -0.06096225113442972i, -0.0087607790748313 + -0.17089724767626163i, 0.014624582022237648 + 0.04324659445416324i }, { -0.02640383312036565 + -0.1394542102188447i, 0.1448093936586568 + 0.044800872917155114i, 0.19255609021755585 + 0.04828375379306942i, -0.026067108475843512 + -0.1552242815050452i }, { -0.00397982934010417 + -0.13059446988123805i, -0.13841851739516453 + -0.014736326928777315i, -0.06735106184220077 + -0.07866815926913506i, 0.07412071672210716 + 0.018557611338987517i }, { 0.06924889425313062 + -0.008381353119142367i, -0.05606615297606854 + 0.1353975669798969i, 0.07420355377347074 + 0.004645463336977585i, -0.13181248642845209 + -0.04004402500049106i } }), Matrix({ { -0.02914119854380456 + -0.08631323095670027i, -0.03551939114495867 + -0.1641718170888943i, -0.0217018503600896 + 0.028066230654970103i, -0.09123665976925875 + 0.1270419283652411i }, { 0.04795413637959282 + 0.09811770293042812i, 0.07017793640356282 + -0.051608573726458516i, 0.012074228490109012 + -0.08077751570718449i, -0.020924309526129965 + 0.03953765852196151i }, { 0.02177514244418999 + 0.01595132595598404i, -0.0828071428991637 + -0.11872420068656074i, 0.0031434514946739917 + -0.22604739488111278i, 0.13401204840369685 + -0.057460806123462695i }, { -0.03408303242040971 + -0.029913643337381376i, 0.036989438494022676 + -0.14684128519254375i, -0.09857108195792633 + -0.019635934508168505i, 0.07662602794533589 + 0.17164921579524703i } }), Matrix({ { 0.005766592006952704 + 0.1159450774164865i, 0.031722528205246035 + 0.01959522522049531i, 0.005684330289272827 + 0.15007940160095867i, -0.011554327133161848 + -0.030328918098180592i }, { 0.05335163768824788 + -0.013323703016796987i, -0.038626364897335085 + -0.09699933946802732i, -0.06433318462226713 + 0.10656921958545873i, -0.09640816535858618 + 0.04015750951472715i }, { 0.020215539096617753 + 0.1137016603530194i, -0.0952901136179724 + 0.006275396027488166i, 0.14357083598484344 + -0.028145667375281944i, -0.006316663074768763 + -0.1343994138689372i }, { 0.06946992729916987 + -0.024933675878419582i, 0.056931738837821426 + -0.04659448909558355i, 0.05920883138798412 + -0.05108730261265609i, -0.002503200748744421 + -0.08451882661149168i } }), Matrix({ { 0.07776768456333935 + -0.004713768332699486i, -0.04989257462475343 + -0.1589488417955186i, 0.14661783700982267 + -0.010852618439815675i, -0.06339900463980992 + 0.02323714592046578i }, { -0.016139028582697716 + 0.07196720860923028i, -0.10950690631164071 + 0.1419227514598205i, -0.08635647344657672 + -0.06950827089958794i, 0.08170056149716912 + -0.004512103265000368i }, { 0.16096057700984362 + -0.15185778023906915i, 0.19610072665908157 + -0.0528320777171626i, 0.03854546504897198 + -0.08643776441155106i, 0.1324705163165522 + -0.07272912792321602i }, { -0.01298766945892119 + -0.001249060473675295i, -0.021729775068211502 + -0.03542140607650147i, 0.016832916110567284 + -0.14656243917312375i, 0.0874589465690119 + 0.02150559478767857i } }), Matrix({ { 0.0460866305476193 + 0.13246735984326913i, -0.02727118138779248 + 0.14542214517444962i, -0.051734571062631796 + -0.018890127018235087i, 0.08305362378009686 + -0.19612191568214166i }, { -0.1513088500036882 + 0.07527671554314529i, -0.053897846293673404 + 0.04735744681232134i, 0.034231553451472316 + -0.11269369357931787i, -0.13689346758442889 + -0.1162333361827537i }, { -0.051846436135683016 + 0.15524557878414738i, -0.002362322331689653 + -0.08562893379567477i, 0.07329356035038767 + -0.1710970286207434i, -0.010902789690219494 + -0.0484270871477188i }, { -0.19595948345276898 + -0.16645651005888093i, -0.012637428521065714 + 0.15025150056373754i, 0.07191560043780862 + -0.16116195002377215i, 0.0393161650316026 + 0.060497142173436096i } }), Matrix({ { 0.03689192608472632 + 0.03861863119176647i, 0.028205849017377674 + -0.12956359200758044i, 0.060009639929722906 + 0.06723748448500971i, -0.05457958660938106 + 0.04111556803502578i }, { -0.2860009355262869 + 0.023607482176294103i, 0.03383340426154182 + -0.053934026569891894i, 0.09547302030422344 + -0.057354439025935816i, 0.08853845479281473 + -0.06209029947508477i }, { 0.007772162664835788 + -0.07966965947067245i, 0.2939178916228761 + -0.04625239431263066i, -0.013470525002123215 + 0.004008346126322264i, -0.07516691553220044 + 0.02485112634723153i }, { -0.03491464179077382 + 0.08238614846948161i, 0.021520868349492534 + -0.028053854656201967i, 0.0698885727991798 + 0.03868877608575971i, 0.2624009281691929 + 0.08457871973869352i } }), Matrix({ { -0.009031923841851442 + 0.08323993880944841i, -0.08728485418743313 + 0.05174680734312994i, -0.122914274068626 + 0.180312371279853i, 0.04359478823322017 + -0.03579966249326785i }, { -0.03213036801930742 + 0.018316990735866612i, 0.06944007656915444 + -0.032304033012345905i, -0.04021711466485877 + 0.17080351940310678i, 0.03956017804612424 + -0.1756532594243668i }, { 0.06948160876584986 + 0.03494313185717791i, -0.1640956720755527 + 0.07094225498539848i, 0.14289488829247757 + 0.2349452602717066i, 0.05746052950431828 + 0.014937748939682305i }, { 0.24691267756461135 + 0.014797643544752132i, 0.012104857969083208 + -0.007283672795099435i, -0.001041954578362767 + 0.05553491706265623i, 0.06821547757216931 + 0.023035173979003575i } }), Matrix({ { 0.13140699336621728 + 0.033290977800701525i, -0.11965376498972578 + 0.013678589197844477i, 0.0665898157886464 + -0.07304169234441148i, -0.048139171450314884 + -0.07085641688479379i }, { -0.040439609562563573 + -0.034488653435830935i, 0.07173854163865 + -0.03372760059084604i, -0.15539978374686333 + 0.0022897607822314763i, -0.20193195281354578 + -0.10287425387717346i }, { -0.0467381699288183 + 0.00978449200622378i, 0.01433301802512605 + -0.04611144244354488i, 0.058474058007161746 + 0.12657700755433698i, 0.031967195469881554 + -0.05450484680415954i }, { 0.06213414192522797 + 0.06959743698298523i, -0.12163568582413807 + 0.02506191444712003i, 0.04249317704404219 + -0.014458370794893509i, 0.11171402473666762 + 0.11483490541616527i } }), Matrix({ { 0.07601715213641758 + -0.062310904337553395i, -0.012232863944475382 + 0.03250810202329939i, 0.06744628863770134 + -0.037632699057080256i, 0.020853679668011528 + 0.03486457481963706i }, { 0.013846086482878916 + 0.15516126650644546i, 0.15743108909540857 + 0.02752285671851846i, -0.09368955757503075 + -0.011238578103650091i, 0.09596059712706786 + 0.1661998044375811i }, { -0.10212554987620888 + -0.10041694883411635i, -0.1208163696915608 + -0.033884093223216616i, -0.05604226829486022 + 0.20783338213278282i, -0.007334769646294442 + -0.023798278637006544i }, { 0.055363858446566064 + 0.017404754163245897i, -0.06224905234572485 + 0.05908954793751322i, -0.11368247114101082 + -0.01828106642104564i, 0.08641857723787304 + 0.05078128536691707i } }), Matrix({ { -0.048466422696403805 + 0.026662210281340415i, -0.0033990903739121573 + -0.09013197392018554i, 0.008469907949257343 + 0.060408559776720265i, -0.017435139868789706 + -0.1629413551651575i }, { -0.02761197417215172 + -0.09885481070830464i, 0.046707121824407234 + -0.013659959165624081i, -0.08880541775399989 + -0.03572845608886951i, 0.09704974517978755 + 0.07259072205878125i }, { -0.10586133091691995 + 0.09552078870410358i, 0.13313804317624356 + 0.08074456063412577i, 0.04530686665037446 + -0.07880759502886582i, -0.07794550069621403 + 0.04361055951841289i }, { -0.018213078166436237 + -0.11221772805231234i, 0.02915955983542984 + -0.09898172482922421i, 0.04593010271355698 + 0.008553201785575728i, -0.10273323001185619 + 0.0018147420038515162i } }), Matrix({ { 0.04854027596452898 + 0.09783575572645156i, -0.2483744665228889 + -0.22334806618539377i, -0.061533964544829414 + 0.07288096434205123i, -0.05903144708779085 + -0.06976344870588828i }, { -0.04293093297138808 + 0.022056343621649585i, 0.049669918942416805 + -0.013973436095298086i, -0.03807343491073479 + -0.15152079521162778i, -0.0026220250047659845 + -0.03602025259492677i }, { 0.02095447423568083 + -0.07311664555305655i, 0.007506859274511572 + -0.008412571237166962i, 0.07556115413047795 + -0.04355487706758039i, 0.025481353348762902 + 0.010517216425259468i }, { 0.07415563350061889 + -0.0032009485017797166i, -0.07166000973639587 + -0.09832035178199629i, 0.11071173648111515 + 0.04033115065105568i, 0.054240471713074494 + -0.03034062039723298i } }) }, { QubitIndex{ 2 }, QubitIndex{ 0 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 3_5_2_100_30_20) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false}), Matrix({ { 0.516323819518039 + -3.9302328752599536e-19i, -0.003330317476471178 + 0.00010328716127482864i }, { -0.0033303174764711813 + -0.00010328716127482973i, 0.4836761804819617 + -1.2027867851011065e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false}), ElementsAreArray({ DoubleNear(0.516323819518039, 1.0e-7), DoubleNear(0.4836761804819617, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false}), Matrix({ { 0.46557545217730323 + -3.5067164016328034e-19i, -0.015685170896010035 + 0.042150240407398384i }, { -0.015685170896010046 + -0.04215024040739839i, 0.5344245478226975 + -1.6263032587282567e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false}), ElementsAreArray({ DoubleNear(0.46557545217730323, 1.0e-7), DoubleNear(0.5344245478226975, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true}), Matrix({ { 0.5000068490065 + -6.894848190650005e-19i, 0.02771188668731413 + -0.03329068800315811i }, { 0.027711886687314127 + 0.03329068800315811i, 0.4999931509935007 + 1.7618285302889447e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true}), ElementsAreArray({ DoubleNear(0.5000068490065, 1.0e-7), DoubleNear(0.4999931509935007, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false}), Matrix({ { 0.2395411209088461 + -1.7618285302889447e-19i, -0.002347299059345562 + -0.00010632633471464479i, -0.007068476484715532 + 0.021486769469538248i, 0.0017282642651929745 + -0.00035843681742045224i }, { -0.002347299059345564 + 0.00010632633471464393i, 0.22603433126845712 + -1.7448878713438587e-19i, -0.001285963184369473 + -7.097959364536256e-05i, -0.008616694411294505 + 0.02066347093786014i }, { -0.0070684764847155366 + -0.021486769469538248i, -0.0012859631843694728 + 7.097959364536256e-05i, 0.2767826986091929 + -2.168404344971009e-19i, -0.0009830184171256157 + 0.00020961349598947344i }, { 0.0017282642651929743 + 0.0003584368174204527i, -0.008616694411294508 + -0.020663470937860143i, -0.0009830184171256175 + -0.00020961349598947365i, 0.25764184921350464 + 5.421010862427522e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false}), ElementsAreArray({ DoubleNear(0.2395411209088461, 1.0e-7), DoubleNear(0.22603433126845712, 1.0e-7), DoubleNear(0.2767826986091929, 1.0e-7), DoubleNear(0.25764184921350464, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true}), Matrix({ { 0.23436839807535045 + -6.776263578034403e-19i, -0.029957933797986017 + -0.0011224604010166821i, 0.009631341261662502 + 0.003669584126868281i, 0.028327018056265665 + 0.01526472924878147i }, { -0.029957933797986017 + 0.0011224604010166804i, 0.2656384509311496 + -1.1858461261560205e-20i, -0.00010576256965740514 + -0.005274893474648354i, 0.01808054542565163 + -0.036960272130026395i }, { 0.009631341261662502 + -0.0036695841268682815i, -0.00010576256965740254 + 0.005274893474648353i, 0.28195542144268854 + 2.846030702774449e-19i, 0.02662761632151484 + 0.0012257475622915108i }, { 0.028327018056265668 + -0.015264729248781472i, 0.01808054542565162 + 0.036960272130026395i, 0.026627616321514835 + -0.0012257475622915101i, 0.21803772955081216 + -1.0842021724855044e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true}), ElementsAreArray({ DoubleNear(0.23436839807535045, 1.0e-7), DoubleNear(0.2656384509311496, 1.0e-7), DoubleNear(0.28195542144268854, 1.0e-7), DoubleNear(0.21803772955081216, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true}), Matrix({ { 0.23252485674898848 + -2.558039500707987e-19i, -0.006296276082445675 + 0.020056419054537762i, 0.018085339645860413 + -0.010061144734620928i, -0.004083611940609266 + 0.0015609012457755101i }, { -0.006296276082445678 + -0.020056419054537766i, 0.26748199225751157 + -4.336808689942018e-19i, -0.005876782922674071 + -0.002998430620931055i, 0.009626547041453718 + -0.023229543268537184i }, { 0.01808533964586041 + 0.01006114473462093i, -0.0058767829226740705 + 0.002998430620931055i, 0.23305059542831474 + -9.486769009248164e-20i, -0.009388894813564362 + 0.022093821352860626i }, { -0.004083611940609266 + -0.0015609012457755106i, 0.009626547041453716 + 0.023229543268537184i, -0.009388894813564367 + -0.022093821352860626i, 0.266942555565186 + 2.710505431213761e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true}), ElementsAreArray({ DoubleNear(0.23252485674898848, 1.0e-7), DoubleNear(0.26748199225751157, 1.0e-7), DoubleNear(0.23305059542831474, 1.0e-7), DoubleNear(0.266942555565186, 1.0e-7) }));


}
}

}
