#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { 0.25271212364957507 + 0.36196809338244795i, 0.39024521960709935 + -0.6920343847999744i, 0.33779263699155004 + 0.0397509960503741i, -0.21145649788484464 + 0.11625361487497954i }, { 0.15423217389718746 + -0.8632209797828945i, 0.3322478162816855 + -0.15097519921832456i, 0.03638857104583094 + 0.30442418180564046i, -0.05744514403429524 + 0.024118442129085857i }, { -0.07119021383392592 + -0.03171744159700363i, 0.40520989211674546 + 0.06977564970654448i, -0.15044630103609793 + -0.41552593901039603i, 0.4287109118416418 + 0.6676625779340774i }, { -0.0028254289516218 + -0.17348092931289272i, 0.25769260924071 + -0.012073848054635246i, 0.039629811429034933 + -0.770357945825634i, -0.15921494217905585 + -0.531952855982719i } }) }, { QubitIndex{ 7 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.1893757050589555 + -0.22114065632585503i, -0.2529575548076729 + -0.591359180201525i, -0.37577158047838205 + 0.5023436684913717i, -0.17998075976333888 + 0.2749435070277486i }, { 0.3108737110884437 + -0.05920543489882387i, 0.44062717394329054 + 0.2823979718898848i, 0.21515918264664288 + 0.6659844304226612i, -0.2056463659975622 + -0.3063203682375651i }, { -0.09825151641638444 + 0.32501236855393106i, 0.03543196104591495 + -0.5572178300616459i, 0.19607587428138276 + 0.1473305078496385i, 0.5058861026475687 + -0.5068468111138599i }, { -0.16669915295917578 + -0.8197627076766002i, 0.01709132908693911 + 0.019147505848165575i, -0.20999424479642168 + -0.11121246657988125i, 0.16112219806460085 + -0.4659566468199475i } }) }, { QubitIndex{ 4 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.08363050635799718 + -0.0578930775514364i, -0.0626100009510829 + 0.507082507611939i, 0.23149249344988856 + 0.3373491714020325i, 0.7465253012477923 + 0.06251707655057397i }, { 0.035156881346132304 + -0.8278150132526145i, 0.006207607138027148 + 0.3076094191382556i, -0.4288575518520524 + 0.039935270847390895i, -0.15333110081108456 + -0.09899573871891415i }, { 0.19516686733752914 + -0.057103517957482794i, 0.6496473875364113 + -0.38180086111614814i, -0.36010828271989975 + -0.07727703992371013i, 0.4093309680111469 + 0.2960302330722823i }, { 0.5026203040688363 + -0.09572115530958505i, 0.26327760869489847 + -0.08459612404783946i, 0.3463213463294931 + 0.6257035602313658i, -0.38053388652554077 + 0.0740893239003781i } }) }, { QubitIndex{ 1 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.10897612695616399 + -0.004796989677497858i, -0.10242721212980412 + 0.009396401058053002i, -0.13190024020091023 + -0.01920715589031626i, 0.1005449020968674 + -0.011202608421368693i }, { 0.12921088795211658 + 0.06450334894806037i, -0.05690785166686491 + 0.08980497226784163i, -0.09151934513846847 + -0.0519734902460139i, -0.0020793286320813114 + 0.14523920058050713i }, { 0.05250707930168432 + 0.020456040864799612i, -0.06250552788879526 + 0.0848556087748802i, 0.04876129802929407 + 0.024654248618839088i, 0.0741362567097602 + 0.12120635345304617i }, { -0.06306942625927045 + 0.03332858566180295i, -0.024405768606998234 + 0.13962028837980886i, -0.017319440026527314 + -0.11544821309096037i, -0.0067875691444301 + 0.047645341941003665i } }), Matrix({ { 0.10515972731025933 + 0.028574521165334075i, -0.13286672998513768 + 0.18702212025393553i, 0.04930351449395758 + 0.16841991209889742i, 0.02067102275395701 + 0.16738588147841785i }, { -0.033624597859191044 + -0.030582903007089466i, 0.07037087628416837 + 0.07384139730257067i, 0.11993104325547377 + -0.08869678432774263i, 0.045263314998002 + 0.02152159059142692i }, { -0.07274282661173966 + -0.08056885677173323i, -0.016980210683548744 + 0.030425217780862514i, -0.04161310699686413 + -0.022862554723263855i, -0.18564277551489405 + 0.11332346183026439i }, { -0.024979246784162343 + -0.10931578001569212i, -0.02035535154938893 + 0.013629572543018139i, -0.10191322533349545 + -0.12358538173942663i, 0.10713226847827215 + -0.08376624822676199i } }), Matrix({ { 0.03261474028371401 + 0.048772398575658626i, 0.015145370799164379 + -0.0069703731861594015i, 0.0569354668491893 + 0.1260354073417063i, 0.07771955721133424 + 0.009547470346517657i }, { 0.01204107660146626 + 0.07173884756108735i, 0.04126724531759381 + -0.06192147082556111i, 0.11591954161858503 + -0.10501538124713485i, -0.006853674871923758 + 0.030435480999326848i }, { -0.04823711716522177 + -0.2376277268662675i, 0.06716044669797247 + 0.1476282824451752i, 0.07704193160848466 + 0.08485145485007463i, -0.034489123191695226 + -0.01173503160291238i }, { 0.09366925684135337 + -0.07599429813648342i, -0.011725381008750724 + 0.12071488016365418i, 0.022082396460050755 + 0.08464206515812697i, 0.10117374192677285 + 0.028246368961468125i } }), Matrix({ { -0.02740042503813183 + -0.0836521685937278i, -0.08311999588469127 + 0.21262277209777725i, -0.08733868859727245 + -0.07296883668910856i, -0.04918595470995213 + -0.00047561607509480054i }, { -0.037868564108939975 + -0.03267796858270273i, -0.07332734216941414 + -0.012567978361444914i, -0.0716128250065833 + 0.055464934375189956i, 0.0040735680184916636 + -0.14139169767781548i }, { -0.12257899882591887 + 0.09373301994785004i, -0.06285315509129276 + 0.009324742696261507i, 0.0357118248276526 + -0.06140971133780503i, 0.03968865693116396 + -0.08913183082871351i }, { 0.10715887317807828 + -0.12380580671377585i, 0.04009777713174982 + 0.03560575696583003i, 0.12312800730414372 + 0.06933286503794593i, 0.03910261972823152 + 0.02046979869346359i } }), Matrix({ { 0.0454269266375338 + 0.09540253238408188i, 0.045227548987919454 + -0.0016571617667962403i, -0.024905082657183338 + -0.04117054892291567i, -0.028686974587602568 + -0.13993162673494414i }, { -0.025324183287696284 + 0.009605533141641575i, -0.022568959452849573 + 0.08648765727980391i, 0.15557421771481814 + 0.0020479942516601238i, -0.08240790045161946 + 0.006820025424246775i }, { 0.2469293771121806 + 0.12824831267870582i, -0.14810492574326664 + -0.08632573748857815i, 0.053566113824288754 + -0.04292296176419658i, 0.10669400088828425 + 0.003412715417690125i }, { 0.003689353167150987 + -0.07974711135467821i, 0.043822652339855425 + 0.031016124780872022i, -0.10515695219233703 + 0.0098548718747766i, 0.11150752780921626 + 0.031579532722547446i } }), Matrix({ { 0.022639115390516176 + -0.012308007432632294i, -0.16481068017683076 + 0.10633396782982786i, 0.07383258736287118 + -0.04063749639849893i, 0.027744075317862948 + 0.037149520565862314i }, { 0.048417122657916416 + 0.08379133053520062i, -0.006463464499051392 + -0.003394806437532916i, 0.006814628686992944 + 0.015006772043686323i, 0.05355940923355806 + -0.0922806396073843i }, { 0.19698217551092082 + 0.08403534058699633i, 0.11652244914957549 + 0.08786927642782749i, 0.08633994172155102 + 0.0878474935505079i, -0.0918179481418318 + -0.08120511644062278i }, { -0.05225391762994362 + 0.1543423182373659i, 0.03289930851671954 + 0.14106918326690704i, 0.1130302056860752 + 0.03996464573460141i, 0.21371734637795306 + -0.08754674716905908i } }), Matrix({ { -0.16210319268661388 + 0.006868348892218549i, 0.11916438040153889 + 0.14850991594648025i, 0.10504767054473213 + -0.07925162395265142i, 0.022964261464456077 + -0.09511053406082509i }, { 0.08243126823710062 + -0.016440019533896625i, -0.009120298556759103 + 0.13397517702246586i, -0.07090493517385858 + 0.0004707576313491586i, -0.004334111588038221 + 0.018858063207089163i }, { 0.012806347683187837 + -0.004932129167537103i, 0.09211078542522144 + 0.04295152690356952i, -0.05266577801097113 + -0.09756322285476715i, -0.08158799665244808 + -0.03477474299081647i }, { 0.06273197960352755 + -0.02090855954888997i, 0.1226132012916574 + -0.10477777204459415i, 0.0843028166681191 + -0.06528343121702765i, 0.01406274474602191 + 0.10966050107190968i } }), Matrix({ { 0.013891218111265667 + -0.017255939025687686i, 0.14854770580292212 + 0.021796946929420625i, -0.06472365719541275 + 0.1126859990285134i, 0.0496803825790263 + 0.066037095940481i }, { 0.04373061208467986 + -0.0673240437046794i, -0.06161565183064686 + 0.015283056785541335i, -0.015939281219607308 + 0.0012088063110856535i, 0.047912292329778346 + 0.11038701880999265i }, { 0.057022129448736754 + 0.06225836828491867i, 0.038081978639918135 + 0.07295136884881834i, -0.025297899512727765 + -0.16628640955603788i, 0.053972719051126716 + -0.03954386824061981i }, { 0.094183566527642 + 0.10466075732473852i, 0.17430178251049125 + -0.043362008563933484i, 0.09971161412144218 + 0.18912893997957886i, 0.027749727946466473 + 0.016539225648406933i } }), Matrix({ { -0.03858364876117701 + 0.1535067010314858i, -0.022567320624769016 + -0.0058249835636063245i, -0.0822022253313134 + 0.04499570333057381i, 0.02178499836944317 + 0.0865696925349787i }, { -0.06081780181329363 + 0.13067323639604006i, 0.014867397000435005 + -0.017971605331235433i, -0.13105357227155887 + -0.041349943993880145i, 0.19618831802674042 + 0.034631556456825405i }, { -0.06113749324525848 + -0.1342742029940062i, 0.11294076446494433 + 0.010369621745688513i, -0.14435417245165375 + 0.17542958407366407i, -0.06270315073191524 + 0.12778428095733757i }, { 0.161552651629559 + 0.054655446742723476i, 0.020822827184903307 + -0.12666338691921825i, 0.11245335750979998 + 0.044313123052690154i, 0.0463817416963815 + 0.07266505265160479i } }), Matrix({ { -0.09699070366472427 + -0.1944264436747795i, -0.04694349311722018 + -0.12112836728421261i, -0.017547661042497595 + -0.1466223380529599i, 0.08761415582452914 + 0.18057179712955018i }, { -0.049621355464442234 + -0.008708407613276964i, -0.08610600590423413 + -0.05259984528060174i, -0.023205746783067013 + -0.11755441818313672i, 0.006974636821420435 + -0.009541951600915198i }, { -0.05944343537162943 + -0.1294029258651755i, 0.010171155624398348 + 0.07441924943722955i, 0.04711975158983613 + 0.06114912591235905i, -0.118321393088728 + 0.035635003185707885i }, { -0.02724041960579229 + 0.13556202864818373i, -0.1850064561067374 + 0.09939097934742466i, 0.06467677707456418 + 0.024123716239875196i, -0.09720797225013757 + -0.013159565339960036i } }), Matrix({ { 0.007113899461494793 + -0.007678070762873683i, -0.027544191568792068 + -0.06368216468412148i, 0.06240721572057628 + -0.015983621531649384i, -0.21554601717403263 + -0.09099455634555263i }, { -0.07159138361267635 + -0.013843791993296994i, -0.12190699212013026 + -0.0779961395849158i, -0.14884626275066937 + 0.02357212143652279i, 0.10709092401301706 + -0.08879279552902544i }, { 0.17809753691731525 + -0.04135532052082699i, -0.005147874637401261 + 0.08839561655712938i, 0.0540000591411938 + -0.04712030660721016i, 0.11499232491446924 + 0.0032553573054775625i }, { -0.008769880751397351 + -0.022561958811627043i, -0.19169059012040243 + 0.08104863161461334i, 0.06712442840732562 + 0.05395617001206304i, 0.08630796723466992 + -0.010423970918751097i } }), Matrix({ { 0.01979751210893066 + -0.01246295482281843i, -0.019281490368199743 + 0.030183313913977623i, 0.1586837725738302 + 0.14763379233659057i, 0.050336979085838646 + -0.023513007646009026i }, { -0.07508277717697592 + -0.09675292437913445i, 0.0166078328402505 + -0.09884044585983699i, 0.11093306483565145 + -0.003937629795096962i, 0.16408896289020805 + 0.18564532031598233i }, { 0.025386071162907718 + -0.14493286681783818i, 0.06062744259799336 + 0.05007075782572472i, -0.09618002295583138 + 0.04698354433226832i, 0.1295380849703599 + 0.02764882198226092i }, { 0.06751046335585853 + 0.10204933892130692i, 0.1549155981634112 + 0.05402531666334158i, -0.03478113343313872 + 0.004017925456488813i, 0.1602366745286517 + 0.004515145541127714i } }), Matrix({ { -0.08773361678900345 + 0.027668490930162767i, -0.03028794682966446 + 0.0989800555048262i, 0.019782676215723185 + -0.1848544965637416i, -0.12294378339353673 + -0.056461631584322644i }, { -0.020044596752073745 + -0.010487455854431518i, -0.1441009899369549 + -0.04528725625112489i, 0.11972084702205495 + 0.0860702327903166i, 0.02313482021996155 + -0.17561467921078625i }, { 0.033102090630146803 + 0.04133304299690601i, 0.04787047892158028 + -0.16719442453822853i, -0.15580095389669882 + -0.1563730713786008i, 0.0898241944735054 + -0.05135097407272516i }, { -0.11418943528156118 + 0.003928146119003244i, 0.19555530655687786 + -0.08470694769896768i, 0.03061457853607888 + 0.07688875297177662i, -0.0030004974762642125 + 0.05161420350552353i } }), Matrix({ { 0.018108115567703455 + 0.09677254546449278i, 0.014985140953842568 + -0.021332567275978206i, -0.15026774516915586 + 0.14487991804375366i, 0.028060246378885975 + 0.05293889171876734i }, { 0.00836616349647137 + 0.0018834822815353618i, -0.10278713517338997 + -0.14634012723724088i, 0.06542271712733091 + -0.0773343271331598i, -0.14902343953587913 + 0.06713988778536968i }, { -0.0539892659888506 + 0.12460961614500199i, -0.07675768216693792 + -0.04646132045840294i, 0.1834701805171136 + 0.16359033495467626i, -0.060595110784092396 + -0.044978381629518144i }, { -0.15550719516784256 + 0.11822084488415982i, 0.0032099936785566835 + 0.05511531330275498i, 0.025417261252957627 + 0.04764462535336569i, 0.06622197740770736 + 0.01903965384676731i } }), Matrix({ { 0.07925592575221085 + 0.1007013548819553i, 0.08621846247545308 + 0.09902425498357385i, 0.026013802803690075 + -0.11981111613946757i, 0.20901772911222516 + -0.11800320768645362i }, { 0.19674254973402192 + -0.024790242586385302i, 0.10359741672408504 + -0.040413678608912006i, -0.035848530299636916 + -0.0726951264648631i, 0.0658160614302 + 0.158919673960409i }, { 0.1839181954638784 + 0.08060443020135838i, 0.04234416427346291 + -0.014391907473942712i, -0.04885975839707023 + -0.023984082250441918i, 0.0464694079422651 + 0.12711185263318941i }, { -0.0008072122700871631 + 0.07994353926757852i, 0.1436006582083151 + 0.03219130107494906i, -0.11887092055582613 + 0.061472094729833775i, -0.1074562795611063 + 0.004077362939887988i } }), Matrix({ { 0.02424268546628936 + 0.08022335866003345i, -0.0058538737319586455 + -0.05925204543925153i, -0.11633203222322835 + -0.015795034240273592i, -0.0685447059286801 + -0.07181266364511382i }, { 0.045420448581203594 + 0.09651425861733698i, 0.042977963523010865 + 0.1438209044415635i, -0.028634009862427548 + -0.038578420637084894i, 0.032835544797055215 + -0.08548254655490833i }, { -0.10053602456257221 + -0.1334695935072275i, 0.06377594615647736 + 0.011087071694227402i, 0.045077397577063964 + 0.055661173375264564i, -0.1256008499549625 + -0.041383522158516345i }, { 0.08627715845109217 + 0.05380572012760019i, 0.028262205279668128 + -0.1596114565955893i, 0.0033414564457766257 + -0.04053644447206701i, -0.006599041027708975 + -0.07271247022410135i } }) }, { QubitIndex{ 0 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.5862802038943626 + -0.47521694868114267i, 0.02409796622661049 + 0.37731343011532126i, 0.26157977597006415 + -0.07436751726308992i, -0.41570628499329 + 0.2018217418485263i }, { 0.05190671088761655 + 0.01603175169303325i, -0.02261883354455905 + 0.175819673241614i, 0.8015424260023957 + 0.11430593896841176i, 0.5567158087130136 + 0.012486277929660526i }, { -0.39471723382091667 + -0.4594058367262897i, -0.14491023750585313 + -0.6320456010510402i, -0.12830554707341515 + -0.0540890283015775i, 0.439110389423113 + 0.021403113625656695i }, { -0.18288779674795883 + -0.16489295563337436i, 0.5170471910268543 + 0.3712294140527032i, -0.3327997042196517 + 0.37465424766471506i, 0.3370314679640512 + -0.41170575968352535i } }) }, { QubitIndex{ 6 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 0 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_10_2_10_30_80) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.4703135219479314 + 1.2461281747462565e-17i, 0.03555129222317239 + 0.001563091407886914i }, { 0.03555129222317239 + -0.0015630914078869132i, 0.5296864780520687 + 2.3851602002504762e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4703135219479314, 1.0e-7), DoubleNear(0.5296864780520687, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.4011654012645238 + -2.8309693981810836e-18i, 0.0049510929913045044 + -0.0066069540275147665i }, { 0.0049510929913045044 + 0.006606954027514769i, 0.5988345987354763 + 1.7677411345894125e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4011654012645238, 1.0e-7), DoubleNear(0.5988345987354763, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.8104139194405795 + 9.216357876740291e-18i, 0.0004215271545778172 + -5.43681315446498e-05i }, { 0.0004215271545778168 + 5.4368131544653105e-05i, 0.1895860805594206 + 5.63008407097275e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.8104139194405795, 1.0e-7), DoubleNear(0.1895860805594206, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.9364110432856496 + 1.4632705922054852e-17i, 0.10989131432072308 + 0.0036657798551509076i }, { 0.10989131432072309 + -0.003665779855150906i, 0.06358895671435033 + 2.1373602565818937e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.9364110432856496, 1.0e-7), DoubleNear(0.06358895671435033, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.18491409531426656 + 7.346944581621475e-18i, -0.006667138277872919 + 0.015990269414900057i }, { -0.0066671382778729195 + -0.01599026941490006i, 0.8150859046857335 + 7.499497366091567e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.18491409531426656, 1.0e-7), DoubleNear(0.8150859046857335, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.5638898518779865 + 7.345568153082186e-18i, 0.0231738613239512 + -0.0558980943542114i }, { 0.02317386132395121 + 0.0558980943542114i, 0.43611014812201376 + 7.500873794630855e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5638898518779865, 1.0e-7), DoubleNear(0.43611014812201376, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.5725069494897489 + 7.393888735745084e-18i, 0.4375957133492063 + -0.0761371889475953i }, { 0.43759571334920633 + 0.0761371889475953i, 0.4274930505102512 + 7.452553211967957e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5725069494897489, 1.0e-7), DoubleNear(0.4274930505102512, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.38562965881644484 + -1.8996376475208917e-18i, 0.11984527374284633 + -0.0687159599691107i }, { 0.11984527374284634 + 0.06871595996911072i, 0.6143703411835553 + 1.6746079595233933e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.38562965881644484, 1.0e-7), DoubleNear(0.6143703411835553, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.22039755785423737 + 3.071156178286881e-18i, 0.014261948410181295 + -0.0010433178707777893i, 0.0017869713400611828 + -0.003833990387788832i, 0.04489214081919812 + -0.05953824417299104i }, { 0.014261948410181297 + 0.001043317870777789i, 0.18076784341028643 + -5.902125576467965e-18i, 0.02474095381241382 + -0.03338318869701225i, 0.0031641216512433216 + -0.002772963639725934i }, { 0.0017869713400611824 + 0.003833990387788833i, 0.02474095381241382 + 0.03338318869701227i, 0.24991596409369404 + 9.390125569175684e-18i, 0.021289343812991093 + 0.0026064092786647025i }, { 0.04489214081919811 + 0.059538244172991056i, 0.003164121651243322 + 0.0027729636397259352i, 0.021289343812991093 + -0.002606409278664702i, 0.34891863464178224 + 8.287285776718441e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.22039755785423737, 1.0e-7), DoubleNear(0.18076784341028643, 1.0e-7), DoubleNear(0.24991596409369404, 1.0e-7), DoubleNear(0.34891863464178224, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.3774721905197215 + 6.7093605897056544e-18i, 0.028811262071758527 + 0.0014603274716892165i, -0.006492348353074369 + 0.0060989453961755626i, -0.022718354125452967 + -0.021887896582076228i }, { 0.028811262071758523 + -0.0014603274716892154i, 0.4329417289208579 + 2.5069972870346368e-18i, 0.017861830326803985 + 0.022514285942446442i, 0.006913875507652185 + -0.006153313527720212i }, { -0.006492348353074368 + -0.006098945396175565i, 0.017861830326803992 + -0.022514285942446435i, 0.09284133142820991 + 5.751921157756911e-18i, 0.006740030151413863 + 0.00010276393619769729i }, { -0.022718354125452977 + 0.021887896582076224i, 0.006913875507652183 + 0.006153313527720217i, 0.006740030151413864 + -0.0001027639361976968i, 0.0967447491312107 + -1.2183708678416055e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3774721905197215, 1.0e-7), DoubleNear(0.4329417289208579, 1.0e-7), DoubleNear(0.09284133142820991, 1.0e-7), DoubleNear(0.0967447491312107, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.44040677575861076 + 1.2001768648323792e-17i, 0.03329062264085386 + 0.0014636960560102208i, 0.051683371069666424 + 0.0017240658343618005i, 0.0039010482792097238 + 0.00030209338007241096i }, { 0.033290622640853855 + -0.0014636960560102193i, 0.49600426752703897 + 2.6309372737310602e-18i, 0.003912508177199306 + -4.144695835983403e-05i, 0.05820794325105667 + 0.0019417140207891059i }, { 0.05168337106966642 + -0.0017240658343617983i, 0.003912508177199306 + 4.1446958359834385e-05i, 0.029906746189320668 + 4.595130991387734e-19i, 0.0022606695823185288 + 9.939535187669398e-05i }, { 0.0039010482792097238 + -0.00030209338007241085i, 0.05820794325105666 + -0.001941714020789108i, 0.0022606695823185288 + -9.939535187669383e-05i, 0.03368221052502968 + -2.4577707348058404e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.44040677575861076, 1.0e-7), DoubleNear(0.49600426752703897, 1.0e-7), DoubleNear(0.029906746189320668, 1.0e-7), DoubleNear(0.03368221052502968, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.08466622185465393 + 3.786790864851674e-18i, 0.006573935038701042 + 0.00041021278613245804i, -0.0029540240509812613 + 0.008394052520792318i, -0.054460247593593775 + 0.11965344473809308i }, { 0.006573935038701042 + -0.0004102127861324574i, 0.10024787345961261 + 3.560153716769801e-18i, -0.039307627790796176 + 0.10523668463500434i, -0.0037131142268916582 + 0.007596216894107743i }, { -0.0029540240509812617 + -0.008394052520792318i, -0.03930762779079617 + -0.10523668463500432i, 0.38564730009327747 + 8.674490882610891e-18i, 0.028977357184471347 + 0.001152878621754456i }, { -0.05446024759359378 + -0.11965344473809311i, -0.0037131142268916582 + -0.007596216894107744i, 0.028977357184471347 + -0.0011528786217544556i, 0.429438604592456 + -1.1749935165193248e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.08466622185465393, 1.0e-7), DoubleNear(0.10024787345961261, 1.0e-7), DoubleNear(0.38564730009327747, 1.0e-7), DoubleNear(0.429438604592456, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.26202704622183187 + 4.256346350217147e-18i, 0.030298669018755508 + 0.0037905174051986283i, 0.019898366692540505 + -0.017918224752142893i, -0.003316933906125705 + 0.017910121845259933i }, { 0.030298669018755504 + -0.0037905174051986274i, 0.3018628056561544 + 3.0892218028650393e-18i, 0.001305533935804647 + 0.022929018020839735i, 0.003275494631410695 + -0.037979869602068506i }, { 0.01989836669254051 + 0.017918224752142893i, 0.0013055339358046445 + -0.022929018020839735i, 0.20828647572609948 + 8.204935397245418e-18i, 0.005252623204416883 + -0.0022274259973117153i }, { -0.003316933906125706 + -0.017910121845259933i, 0.0032754946314107 + 0.037979869602068506i, 0.005252623204416884 + 0.0022274259973117144i, 0.22782367239591417 + -7.040616026145631e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.26202704622183187, 1.0e-7), DoubleNear(0.3018628056561544, 1.0e-7), DoubleNear(0.20828647572609948, 1.0e-7), DoubleNear(0.22782367239591417, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.2692577597541902 + 6.359044637205772e-18i, 0.020353361861107054 + 0.0008948806937029742i, 0.20580718113458266 + -0.035808349485158666i, 0.015676102466749862 + -0.002022773353662562i }, { 0.020353361861107054 + -0.0008948806937029733i, 0.3032491897355586 + 1.0348440985393121e-18i, 0.015438083695020567 + -0.003390777552991142i, 0.2317885322146237 + -0.040328839462436636i }, { 0.20580718113458266 + 0.035808349485158666i, 0.015438083695020565 + 0.003390777552991142i, 0.20105576219374116 + 6.102237110256793e-18i, 0.015197930362065334 + 0.0006682107141839399i }, { 0.015676102466749862 + 0.002022773353662562i, 0.2317885322146237 + 0.04032883946243664i, 0.015197930362065334 + -0.0006682107141839399i, 0.22643728831651 + 1.350316101711164e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2692577597541902, 1.0e-7), DoubleNear(0.3032491897355586, 1.0e-7), DoubleNear(0.20105576219374116, 1.0e-7), DoubleNear(0.22643728831651, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.21065906202393567 + 3.473600432604396e-18i, 0.013709632690505699 + -0.0009395579574321795i, 0.06794871170936677 + -0.030702567272761022i, 0.00445312393647326 + -0.002865540600385497i }, { 0.013709632690505697 + 0.0009395579574321795i, 0.1749705967925092 + -5.373238080125288e-18i, 0.004068184760322778 + -0.0020203417461298447i, 0.05189656203347957 + -0.03801339269634969i }, { 0.06794871170936675 + 0.030702567272761022i, 0.004068184760322778 + 0.0020203417461298447i, 0.2596544599239957 + 8.987681314858169e-18i, 0.021841659532666688 + 0.0025026493653190936i }, { 0.00445312393647326 + 0.002865540600385497i, 0.051896562033479574 + 0.03801339269634969i, 0.02184165953266669 + -0.0025026493653190927i, 0.35471588125955944 + 7.758398280375764e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.21065906202393567, 1.0e-7), DoubleNear(0.1749705967925092, 1.0e-7), DoubleNear(0.2596544599239957, 1.0e-7), DoubleNear(0.35471588125955944, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.334107653652466 + 2.6932471349134547e-18i, 0.004610424539217794 + -0.007998404538652866i, 1.6788576635570486e-05 + -0.0004264311339685603i, -0.0022874035027475943 + 0.0015453416284969522i }, { 0.004610424539217793 + 0.007998404538652871i, 0.4763062657881134 + 6.5231107418268365e-18i, 0.000859150029131337 + 0.0009754469688872703i, 0.00040473857794224655 + 0.000372063002423911i }, { 1.6788576635570825e-05 + 0.00042643113396856054i, 0.0008591500291313369 + -0.0009754469688872706i, 0.0670577476120578 + -5.524216533094538e-18i, 0.0003406684520867111 + 0.001391450511138102i }, { -0.002287403502747593 + -0.0015453416284969522i, 0.00040473857794224655 + -0.00037206300242390803i, 0.0003406684520867115 + -0.0013914505111381017i, 0.12252833294736284 + 1.1154300604067288e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.334107653652466, 1.0e-7), DoubleNear(0.4763062657881134, 1.0e-7), DoubleNear(0.0670577476120578, 1.0e-7), DoubleNear(0.12252833294736284, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.375655711928219 + -1.8228149024912543e-18i, 0.0046362581533917185 + -0.006186824713845427i, 0.04408459320495878 + 0.0014705840465390196i, 0.0005683017551165441 + -0.0007078972447916896i }, { 0.004636258153391719 + 0.0061868247138454294i, 0.5607553313574307 + 1.6455520824546106e-17i, 0.0005198624771606007 + 0.0007441964786886958i, 0.0658067211157643 + 0.0021951958086118893i }, { 0.044084593204958784 + -0.0014705840465390242i, 0.0005198624771606006 + -0.0007441964786886952i, 0.025509689336304788 + -1.0081544956898293e-18i, 0.00031483483791278544 + -0.00042012931366933913i }, { 0.0005683017551165443 + 0.0007078972447916899i, 0.0658067211157643 + -0.002195195808611879i, 0.0003148348379127855 + 0.0004201293136693393i, 0.03807926737804555 + 1.2218905213480187e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.375655711928219, 1.0e-7), DoubleNear(0.5607553313574307, 1.0e-7), DoubleNear(0.025509689336304788, 1.0e-7), DoubleNear(0.03807926737804555, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.08267359201894663 + 3.0216312206521063e-18i, 0.00025974514789288655 + -0.0007774724705927695i, -0.0039008590617220307 + 0.00851367838542666i, 0.05007865183354061 + 0.0521707617439873i }, { 0.00025974514789288677 + 0.0007774724705927696i, 0.10224050329531992 + 4.325313360969368e-18i, -0.04250249875758511 + -0.00010621937952341872i, -0.002766279216150888 + 0.0074765910294734i }, { -0.003900859061722033 + -0.008513678385426658i, -0.04250249875758511 + 0.00010621937952342501i, 0.31849180924557713 + -5.85260061883319e-18i, 0.004691347843411618 + -0.0058294815569219964i }, { 0.05007865183354061 + -0.0521707617439873i, -0.002766279216150886 + -0.007476591029473404i, 0.004691347843411618 + 0.005829481556921999i, 0.49659409544015626 + 1.3352097984924757e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.08267359201894663, 1.0e-7), DoubleNear(0.10224050329531992, 1.0e-7), DoubleNear(0.31849180924557713, 1.0e-7), DoubleNear(0.49659409544015626, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.22806500389317907 + -2.6975617089885313e-18i, 0.00489816855318592 + -0.008631198198868989i, 0.009296551376871312 + -0.02404463832039517i, 0.008547121687166849 + 0.004137138535313761i }, { 0.0048981685531859194 + 0.00863119819886899i, 0.3358248479848073 + 1.0043129862070718e-17i, -0.008827241696117625 + 0.003763334200679931i, 0.013877309947079886 + -0.03185345603381623i }, { 0.009296551376871316 + 0.024044638320395165i, -0.008827241696117625 + -0.003763334200679931i, 0.1731003973713447 + -1.334076891925523e-19i, 5.292443811858458e-05 + 0.002024244171354222i }, { 0.008547121687166849 + -0.004137138535313761i, 0.013877309947079895 + 0.03185345603381623i, 5.2924438118585014e-05 + -0.0020242441713542217i, 0.26300975075066896 + 7.634281483823407e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.22806500389317907, 1.0e-7), DoubleNear(0.3358248479848073, 1.0e-7), DoubleNear(0.1731003973713447, 1.0e-7), DoubleNear(0.26300975075066896, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.22966998011878356 + 2.0284586202168374e-18i, 0.0028345351450918175 + -0.003782527095711489i, 0.1755482599373699 + -0.03054360595531494i, 0.0016635421622271827 + -0.003268137063311801i }, { 0.0028345351450918175 + 0.00378252709571149i, 0.3428369693709653 + 5.3654301155282466e-18i, 0.002669611976549118 + 0.0025142124581596713i, 0.2620474534118365 + -0.04559358299228037i }, { 0.1755482599373699 + 0.03054360595531493i, 0.002669611976549118 + -0.0025142124581596704i, 0.17149542114574023 + -4.859428018397921e-18i, 0.002116557846212687 + -0.0028244269318032774i }, { 0.0016635421622271825 + 0.0032681370633118032i, 0.2620474534118365 + 0.045593582992280376i, 0.0021165578462126874 + 0.0028244269318032787i, 0.2559976293645109 + 1.2311981230365878e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.22966998011878356, 1.0e-7), DoubleNear(0.3428369693709653, 1.0e-7), DoubleNear(0.17149542114574023, 1.0e-7), DoubleNear(0.2559976293645109, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.3753087007748819 + -3.0412717971165654e-18i, 0.0030693336122761825 + -0.000263526956718479i, 0.07549603321434178 + -0.0286369267548989i, 0.005369692608631741 + -0.02289636666983497i }, { 0.0030693336122761834 + 0.0002635269567184794i, 0.010320958041563025 + 1.1416341495956737e-18i, 0.00043583350273123137 + 9.728558124972591e-05i, 0.044349240528504544 + -0.040079033214211815i }, { 0.07549603321434178 + 0.028636926754898904i, 0.0004358335027312312 + -9.728558124972591e-05i, 0.025856700489641938 + 2.1030239893548176e-19i, 0.0018817593790283217 + -0.006343427070796288i }, { 0.005369692608631739 + 0.022896366669834967i, 0.04434924052850455 + 0.04007903321421181i, 0.0018817593790283215 + 0.006343427070796289i, 0.5885136406939132 + 1.653577719629845e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.3753087007748819, 1.0e-7), DoubleNear(0.010320958041563025, 1.0e-7), DoubleNear(0.025856700489641938, 1.0e-7), DoubleNear(0.5885136406939132, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.7588805437965654 + 9.229059235046043e-18i, 0.0003947226825914453 + -5.0910918781217434e-05i, 0.08905745075113386 + 0.0029707990202191645i, 4.6521474639809766e-05 + -4.4293596809534454e-06i }, { 0.00039472268259144443 + 5.091091878122085e-05i, 0.17753049948908428 + 5.403646687008809e-18i, 4.612287143705186e-05 + 7.519811184253931e-06i, 0.020833863569589214 + 0.0006949808349317411i }, { 0.08905745075113387 + -0.0029707990202191654i, 4.612287143705192e-05 + -7.519811184253605e-06i, 0.051533375644014 + -1.270135830575174e-20i, 2.6804471986372196e-05 + -3.4572127634328223e-06i }, { 4.652147463980939e-05 + 4.4293596809534454e-06i, 0.020833863569589217 + -0.0006949808349317396i, 2.6804471986371976e-05 + 3.457212763432958e-06i, 0.012055581070336333 + 2.264373839639411e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.7588805437965654, 1.0e-7), DoubleNear(0.17753049948908428, 1.0e-7), DoubleNear(0.051533375644014, 1.0e-7), DoubleNear(0.012055581070336333, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.14111082462407792 + 1.3804560816907587e-18i, -0.0001341127353040297 + -1.1197024148070379e-07i, -0.010745382330852538 + 0.0185603247179753i, 0.0003320861095140082 + -0.002550886208776032i }, { -0.00013411273530402975 + 1.1197024148119168e-07i, 0.043803270690188634 + 5.966488499930716e-18i, -0.0020572665208174394 + 0.004023646932472617i, 0.004078244052979617 + -0.002570055303075243i }, { -0.010745382330852538 + -0.018560324717975304i, -0.0020572665208174394 + -0.004023646932472619i, 0.6693030948165015 + 7.835901795049532e-18i, 0.0005556398898818467 + -5.425616130316931e-05i }, { 0.0003320861095140104 + 0.0025508862087760312i, 0.004078244052979617 + 0.0025700553030752428i, 0.0005556398898818459 + 5.4256161303171914e-05i, 0.14578280986923198 + -3.364044289579657e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.14111082462407792, 1.0e-7), DoubleNear(0.043803270690188634, 1.0e-7), DoubleNear(0.6693030948165015, 1.0e-7), DoubleNear(0.14578280986923198, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.4886072553098506 + 5.097362385695737e-18i, -0.0006782765763988915 + -0.006920092754048067i, 0.018780419784115744 + -0.07296804508073518i, -0.007952544890273108 + 0.0010257109228043642i }, { -0.0006782765763988889 + 0.006920092754048072i, 0.07528259656813568 + 2.2482057673864497e-18i, 0.0005020948189199144 + 6.475966463006589e-05i, 0.004393441539835454 + 0.017069950726523765i }, { 0.018780419784115755 + 0.07296804508073518i, 0.0005020948189199143 + -6.475966463006638e-05i, 0.3218066641307288 + 4.1189954910445545e-18i, 0.0010998037309767079 + 0.006865724622503418i }, { -0.007952544890273111 + -0.0010257109228043624i, 0.0043934415398354555 + -0.017069950726523765i, 0.0010998037309767061 + -0.006865724622503419i, 0.11430348399128493 + 3.3818783035863005e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4886072553098506, 1.0e-7), DoubleNear(0.07528259656813568, 1.0e-7), DoubleNear(0.3218066641307288, 1.0e-7), DoubleNear(0.11430348399128493, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.4639676008429572 + 5.038116401502239e-18i, 0.00024132722539443917 + -3.1126133140085463e-05i, 0.35463365718572654 + -0.06170263771020867i, 0.0001803190391993976 + -5.588515392137639e-05i }, { 0.0002413272253944396 + 3.112613314008671e-05i, 0.10853934864679168 + 2.3557723342428454e-18i, 0.00018859791260768385 + -8.302631307887005e-06i, 0.08296205616347976 + -0.014434551237386633i }, { 0.3546336571857266 + 0.061702637710208674i, 0.00018859791260768515 + 8.302631307889065e-06i, 0.34644631859762226 + 4.1782414752380525e-18i, 0.00018019992918337805 + -2.3241998404564335e-05i }, { 0.0001803190391993976 + 5.588515392137785e-05i, 0.08296205616347976 + 0.014434551237386633i, 0.0001801999291833772 + 2.3241998404566395e-05i, 0.08104673191262894 + 3.2743117367299047e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4639676008429572, 1.0e-7), DoubleNear(0.10853934864679168, 1.0e-7), DoubleNear(0.34644631859762226, 1.0e-7), DoubleNear(0.08104673191262894, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.31605509289971917 + 2.723320940444045e-18i, 4.430594183584555e-05 + -0.0004517680748969919i, 0.1038031354889704 + -0.0605925425554803i, 5.791820763211626e-05 + 5.6743727341863654e-05i }, { 4.430594183584685e-05 + 0.00045176807489699216i, 0.0695745659167257 + -4.622958587964937e-18i, 0.00020500597851456887 + 1.0558895443582269e-05i, 0.016042138253875925 + -0.008123417413630405i }, { 0.1038031354889704 + 0.06059254255548031i, 0.00020500597851456996 + -1.0558895443582919e-05i, 0.4943588265408603 + 6.493036936296246e-18i, 0.0003772212127419717 + 0.0003973999433523421i }, { 5.791820763211637e-05 + -5.6743727341863816e-05i, 0.01604213825387593 + 0.008123417413630412i, 0.00037722121274196994 + -0.00039739994335233906i, 0.12001151464269492 + 1.0253042658937687e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.31605509289971917, 1.0e-7), DoubleNear(0.0695745659167257, 1.0e-7), DoubleNear(0.4943588265408603, 1.0e-7), DoubleNear(0.12001151464269492, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.17315560091145438 + 6.860331598049392e-18i, 0.020320452970512208 + 0.0006778543655364935i, -0.006243181910512669 + 0.014973464865225179i, -0.0007912773956130336 + 0.0017327514611552948i }, { 0.020320452970512215 + -0.0006778543655364909i, 0.01175849440281215 + 4.866129835720826e-19i, -0.0006740437806138806 + 0.0017816319835363592i, -0.0004239563673602492 + 0.0010168045496748799i }, { -0.00624318191051267 + -0.01497346486522518i, -0.0006740437806138811 + -0.0017816319835363594i, 0.7632554423741953 + 7.77237432400546e-18i, 0.08957086135021086 + 0.002987925489614413i }, { -0.0007912773956130338 + -0.0017327514611552954i, -0.00042395636736024933 + -0.0010168045496748799i, 0.08957086135021086 + -0.002987925489614414i, 0.05183046231153819 + -2.728769579138932e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.17315560091145438, 1.0e-7), DoubleNear(0.01175849440281215, 1.0e-7), DoubleNear(0.7632554423741953, 1.0e-7), DoubleNear(0.05183046231153819, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.5280326844952556 + 7.265742742428982e-18i, 0.06196659695498978 + 0.0020670960595383513i, 0.02170025965931811 + -0.052343592851906776i, 0.0027515161870001635 + -0.006057764782600679i }, { 0.06196659695498977 + -0.0020670960595383517i, 0.0358571673827307 + 7.982541065320483e-20i, 0.002341695970550178 + -0.0062276653306154815i, 0.0014736016646330905 + -0.0035545015023046196i }, { 0.02170025965931812 + 0.05234359285190678i, 0.0023416959705501762 + 0.006227665330615483i, 0.4083783587903941 + 7.36696317962587e-18i, 0.0479247173657333 + 0.001598683795612556i }, { 0.0027515161870001635 + 0.006057764782600679i, 0.001473601664633091 + 0.0035545015023046196i, 0.04792471736573331 + -0.001598683795612555i, 0.027731789331619645 + 1.3391061500498454e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5280326844952556, 1.0e-7), DoubleNear(0.0358571673827307, 1.0e-7), DoubleNear(0.4083783587903941, 1.0e-7), DoubleNear(0.027731789331619645, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.5695556257922312 + 7.380780404577956e-18i, -0.03805043716425456 + -0.015267850112712056i, 0.4497323402605204 + -0.08176422817791223i, 0.18558342200229122 + -0.009762094927896814i }, { -0.038050437164254575 + 0.015267850112712058i, 0.002951323697517685 + 1.310833116712783e-20i, -0.027853553639028115 + 0.01751823726545721i, -0.012136626911314083 + 0.005627039230316936i }, { 0.4497323402605204 + 0.08176422817791223i, -0.027853553639028115 + -0.01751823726545721i, 0.36685541749341855 + 7.251925517476896e-18i, 0.14794175148497765 + 0.018933629967862964i }, { 0.18558342200229122 + 0.009762094927896814i, -0.012136626911314083 + -0.005627039230316936i, 0.14794175148497765 + -0.018933629967862964i, 0.06063763301683265 + 2.0062769449106154e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5695556257922312, 1.0e-7), DoubleNear(0.002951323697517685, 1.0e-7), DoubleNear(0.36685541749341855, 1.0e-7), DoubleNear(0.06063763301683265, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.36110787113419623 + -1.013686679626584e-18i, 0.04237735004839113 + 0.0014136334348380398i, 0.112224437818393 + -0.06434638376504989i, 0.01342185222851035 + -0.007111960765594199i }, { 0.042377350048391146 + -0.0014136334348380433i, 0.0245217876822486 + -8.859509678943077e-19i, 0.0129180570649461 + -0.007990613546037341i, 0.007620835924453322 + -0.004369576204060812i }, { 0.11222443781839302 + 0.06434638376504989i, 0.012918057064946104 + 0.007990613546037341i, 0.5753031721514534 + 1.5646392601681436e-17i, 0.06751396427233194 + 0.002252146420312868i }, { 0.01342185222851035 + 0.007111960765594198i, 0.007620835924453322 + 0.0043695762040608125i, 0.06751396427233194 + -0.0022521464203128626i, 0.03906716903210174 + 1.0996869935524971e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.36110787113419623, 1.0e-7), DoubleNear(0.0245217876822486, 1.0e-7), DoubleNear(0.5753031721514534, 1.0e-7), DoubleNear(0.03906716903210174, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.10247103997205495 + 3.091689282632285e-18i, -0.01174436439685474 + 0.019984326520386064i, 0.004285173601656707 + -0.008761377133114147i, -0.019360520336155297 + -0.014166670263639217i }, { -0.01174436439685474 + -0.019984326520386064i, 0.4614188119059314 + 4.2538788704499014e-18i, 0.01973772973968576 + -0.013261982264546125i, 0.018888687722294493 + -0.047136717221097246i }, { 0.004285173601656709 + 0.008761377133114145i, 0.019737729739685756 + 0.013261982264546125i, 0.08244305534221161 + 4.25525529898919e-18i, 0.005077226118981821 + -0.003994057105486006i }, { -0.019360520336155297 + 0.014166670263639217i, 0.018888687722294503 + 0.04713671722109725i, 0.00507722611898182 + 0.003994057105486006i, 0.35366709277980213 + 3.2456184956416653e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.10247103997205495, 1.0e-7), DoubleNear(0.4614188119059314, 1.0e-7), DoubleNear(0.08244305534221161, 1.0e-7), DoubleNear(0.35366709277980213, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.1058646046260274 + 4.106686216349153e-18i, -0.0038169829972913624 + 0.009154540364243662i, 0.0809176154473696 + -0.014078839414015958i, -0.0017000569669383986 + 0.007504890518061344i }, { -0.0038169829972913624 + -0.009154540364243662i, 0.46664234486372147 + 3.287202519395931e-18i, -0.0041349652944688 + -0.006489656184457035i, 0.3566780979018367 + -0.062058349533579346i }, { 0.0809176154473696 + 0.014078839414015963i, -0.004134965294468798 + 0.006489656184457033i, 0.07904949068823915 + 3.2402583652723217e-18i, -0.0028501552805815563 + 0.0068357290506563945i }, { -0.0017000569669383986 + -0.007504890518061344i, 0.35667809790183674 + 0.062058349533579346i, -0.002850155280581557 + -0.006835729050656396i, 0.34844355982201203 + 4.2122948466956356e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.1058646046260274, 1.0e-7), DoubleNear(0.46664234486372147, 1.0e-7), DoubleNear(0.07904949068823915, 1.0e-7), DoubleNear(0.34844355982201203, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.07614497052150637 + 2.8002305394380005e-18i, -0.0037191512672042465 + 0.00787609252406185i, 0.022161080371849044 + -0.002259969552357892i, -0.0006310361848165086 + 0.002397152689763095i }, { -0.0037191512672042487 + -0.00787609252406185i, 0.30948468829493847 + -4.699868186958892e-18i, -0.000967013839169668 + -0.001435563740738027i, 0.09768419337099728 + -0.0664559904167528i }, { 0.022161080371849044 + 0.0022599695523578896i, -0.0009670138391696682 + 0.0014355637407380264i, 0.10876912479276017 + 4.546714042183474e-18i, -0.0029479870106686725 + 0.008114176890838206i }, { -0.0006310361848165093 + -0.002397152689763095i, 0.09768419337099728 + 0.06645599041675282i, -0.002947987010668671 + -0.00811417689083821i, 0.505601216390795 + 1.2199365553050459e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.07614497052150637, 1.0e-7), DoubleNear(0.30948468829493847, 1.0e-7), DoubleNear(0.10876912479276017, 1.0e-7), DoubleNear(0.505601216390795, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.3228308589468923 + 1.6661659196277996e-18i, 0.013267196654473772 + -0.03200204748101972i, 0.2467557819829257 + -0.04293298819806577i, 0.005884858605452904 + -0.026225159132059424i }, { 0.013267196654473781 + 0.032002047481019716i, 0.2496760905428566 + 5.7277228161172844e-18i, 0.014396706148767119 + 0.022696373815525337i, 0.1908399313662806 + -0.03320420074952954i }, { 0.24675578198292575 + 0.04293298819806578i, 0.014396706148767115 + -0.022696373815525337i, 0.2410589929310941 + 5.679402233454387e-18i, 0.00990666466947743 + -0.023896046873191676i }, { 0.005884858605452906 + 0.026225159132059427i, 0.1908399313662806 + 0.033204200749529525i, 0.00990666466947743 + 0.02389604687319168i, 0.1864340575791571 + 1.7731509785135705e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.3228308589468923, 1.0e-7), DoubleNear(0.2496760905428566, 1.0e-7), DoubleNear(0.2410589929310941, 1.0e-7), DoubleNear(0.1864340575791571, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.21818032266337578 + -2.548967810930118e-18i, 0.008936528235814908 + -0.022192612655065738i, 0.06895418597869164 + -0.03975761644338693i, -0.0019469371154847341 + -0.009494238428160653i }, { 0.008936528235814912 + 0.022192612655065738i, 0.1674493361530691 + 6.493301634092263e-19i, 0.0075014926235801175 + 0.0063094101740279445i, 0.05089108776415468 + -0.02895834352572378i }, { 0.06895418597869166 + 0.03975761644338693i, 0.007501492623580117 + -0.006309410174027943i, 0.3457095292146106 + 9.894535964012304e-18i, 0.014237333088136291 + -0.03370548169914566i }, { -0.0019469371154847335 + 0.009494238428160651i, 0.05089108776415468 + 0.028958343525723785i, 0.014237333088136298 + 0.03370548169914566i, 0.26866081196894465 + 6.851543631221629e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.21818032266337578, 1.0e-7), DoubleNear(0.1674493361530691, 1.0e-7), DoubleNear(0.3457095292146106, 1.0e-7), DoubleNear(0.26866081196894465, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.22077565960177548 + 2.176774585589433e-18i, 0.16874988563839322 + -0.029360758197104382i, 0.06861225208128084 + -0.039340364623175264i, 0.04721193802714817 + -0.03919449177259388i }, { 0.16874988563839324 + 0.029360758197104368i, 0.1648539992146694 + -4.076412233110325e-18i, 0.05767561808291531 + -0.020945127269723127i, 0.05123302166156549 + -0.02937559534593544i }, { 0.06861225208128086 + 0.03934036462317527i, 0.057675618082915325 + 0.020945127269723134i, 0.3517312898879734 + 5.217114150155651e-18i, 0.26884582771081306 + -0.04677643075049093i }, { 0.047211938027148175 + 0.039194491772593876i, 0.05123302166156548 + 0.02937559534593544i, 0.2688458277108131 + 0.04677643075049094i, 0.2626390512955818 + 1.1528965445078282e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.22077565960177548, 1.0e-7), DoubleNear(0.1648539992146694, 1.0e-7), DoubleNear(0.3517312898879734, 1.0e-7), DoubleNear(0.2626390512955818, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.196137150184058 + 3.767496670268721e-18i, 0.01187795882899729 + -0.0015313333152446925i, 0.0016567082231835838 + -0.004531316457855579i, 0.0425269314375512 + -0.06856201702646057i, -0.0035281955564994303 + 0.000492669165094646i, -0.0024346435036540384 + -0.0092568765463679i, 0.004456454144145976 + -0.004659675796169572i, -0.001540904049672384 + -0.001757903824224509i }, { 0.011877958828997288 + 0.0015313333152446925i, 0.137970503468408 + -1.0742495353552664e-18i, 0.02231493858894409 + -0.04392903517556736i, 0.0029537163160342095 + -0.003467088080797289i, 0.0022412179530326365 + 0.014169900364910223i, 0.0035449841331350014 + -0.0009191002990632067i, 0.001739441672437201 + 0.001623774252020584i, -0.006743857646893571 + 0.006205017424666524i }, { 0.0016567082231835832 + 0.00453131645785558i, 0.022314938588944087 + 0.04392903517556736i, 0.18133504033566353 + 2.9418639194369333e-18i, 0.016933303242761235 + 0.00299166078693391i, 0.0011178607187091027 + 0.003921279722158616i, 0.0009993983848839972 + -0.000250144611500647i, -0.002964152796574938 + 0.005606276231080917i, -0.020283710621798925 + -0.01263102003570833i }, { 0.042526931437551194 + 0.06856201702646059i, 0.00295371631603421 + 0.00346708808079729i, 0.016933303242761235 + -0.0029916607869339092i, 0.2949712254524499 + 3.581246822389903e-18i, -0.0010739692265291942 + 0.00016547965313042524i, -0.0002587106895777651 + -0.002945832753271345i, 0.015620612373771346 + 0.00834438557753622i, 0.0033688913745171844 + -0.005234213228657005i }, { -0.003528195556499429 + -0.0004926691650946474i, 0.0022412179530326383 + -0.014169900364910214i, 0.0011178607187091025 + -0.003921279722158615i, -0.0010739692265291942 + -0.00016547965313042518i, 0.024260407670179375 + -6.9634049198184e-19i, 0.0023839895811840067 + 0.0004880154444669023i, 0.00013026311687759905 + 0.0006973260700667467i, 0.0023652093816469186 + 0.009023772853469524i }, { -0.0024346435036540384 + 0.009256876546367894i, 0.003544984133135 + 0.000919100299063208i, 0.0009993983848839974 + 0.000250144611500647i, -0.00025871068957776554 + 0.0029458327532713444i, 0.002383989581184007 + -0.00048801544446690274i, 0.042797339941878405 + -4.827876041112698e-18i, 0.002426015223469727 + 0.0105458464785551i, 0.0002104053352091122 + 0.0006941244410713552i }, { 0.004456454144145976 + 0.004659675796169573i, 0.0017394416724372012 + -0.0016237742520205849i, -0.0029641527965749382 + -0.005606276231080918i, 0.015620612373771357 + -0.00834438557753622i, 0.00013026311687759932 + -0.0006973260700667465i, 0.002426015223469729 + -0.010545846478555098i, 0.06858092375803053 + 6.448261649738751e-18i, 0.004356040570229857 + -0.00038525150826920486i }, { -0.0015409040496723848 + 0.0017579038242245093i, -0.006743857646893569 + -0.006205017424666525i, -0.020283710621798935 + 0.01263102003570833i, 0.0033688913745171844 + 0.005234213228657009i, 0.0023652093816469216 + -0.009023772853469522i, 0.0002104053352091122 + -0.000694124441071355i, 0.0043560405702298575 + 0.0003852515082692056i, 0.0539474091893323 + 4.706038954328538e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.196137150184058, 1.0e-7), DoubleNear(0.137970503468408, 1.0e-7), DoubleNear(0.18133504033566353, 1.0e-7), DoubleNear(0.2949712254524499, 1.0e-7), DoubleNear(0.024260407670179375, 1.0e-7), DoubleNear(0.042797339941878405, 1.0e-7), DoubleNear(0.06858092375803053, 1.0e-7), DoubleNear(0.0539474091893323, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.20638270708789572 + 3.2864878353466853e-18i, 0.013355045990063978 + -0.000976974375853593i, 0.0016733396968682476 + -0.003590190938976493i, 0.04203749641983161 + -0.0557522693414263i, 0.024219777305679747 + 0.0008079289277065191i, 0.0015710888292023856 + -6.23704088968256e-05i, 0.00021042719394118568 + -0.00041477159926700535i, 0.005151510453393069 + -0.006378171199048504i }, { 0.013355045990063978 + 0.0009769743758535922i, 0.16927300484032326 + -5.10930273783794e-18i, 0.023167702371364497 + -0.03126038655597095i, 0.0029629184565234715 + -0.0025966337748689343i, 0.0015634396819359537 + 0.00016693273525131362i, 0.019864815899279034 + 0.0006626551188325006i, 0.0028411913526206678 + -0.003577827592048617i, 0.00035787456117535835 + -0.00029312564552468425i }, { 0.0016733396968682474 + 0.003590190938976493i, 0.023167702371364497 + 0.03126038655597096i, 0.234024068670715 + 8.715280812977106e-18i, 0.01993557665078988 + 0.0024406704318638128i, 0.0001823180644843886 + 0.00042787288634726196i, 0.0025964405113682496 + 0.003759217372214149i, 0.027463593763986674 + 0.0009161369066552811i, 0.0023299594500073378 + 0.00036446378896923633i }, { 0.04203749641983161 + 0.05575226934142631i, 0.0029629184565234715 + 0.0025966337748689356i, 0.01993557665078988 + -0.0024406704318638115i, 0.3267312626867157 + 7.740240011569e-18i, 0.0047150022611922564 + 0.006707300609987734i, 0.000337544412676212 + 0.00031632359234143374i, 0.0023490684952633526 + -0.00020837969361114721i, 0.038343127351777626 + 0.0012790589019566045i }, { 0.024219777305679747 + -0.0008079289277065217i, 0.0015634396819359537 + -0.00016693273525131362i, 0.0001823180644843886 + -0.00042787288634726174i, 0.004715002261192258 + -0.0067073006099877324i, 0.014014850766341624 + -2.1533165705980416e-19i, 0.0009069024201173162 + -6.634349492419697e-05i, 0.00011363164319293516 + -0.00024379944881233937i, 0.0028546443993665094 + -0.003785974831564749i }, { 0.0015710888292023856 + 6.237040889682535e-05i, 0.019864815899279034 + -0.0006626551188325025i, 0.0025964405113682496 + -0.003759217372214148i, 0.00033754441267621195 + -0.00031632359234143336i, 0.0009069024201173162 + 6.6343494924197e-05i, 0.011494838569963164 + -7.928228386300251e-19i, 0.001573251441049323 + -0.002122802141041302i, 0.00020120319471985027 + -0.0001763298648569998i }, { 0.0002104271939411856 + 0.0004147715992670053i, 0.0028411913526206678 + 0.003577827592048618i, 0.027463593763986674 + -0.0009161369066552776i, 0.0023490684952633526 + 0.00020837969361114795i, 0.00011363164319293516 + 0.00024379944881233937i, 0.0015732514410493233 + 0.002122802141041302i, 0.015891895422979044 + 6.748447561985776e-19i, 0.001353767162201213 + 0.00016573884680089095i }, { 0.005151510453393069 + 0.006378171199048507i, 0.0003578745611753584 + 0.00029312564552468447i, 0.0023299594500073378 + -0.00036446378896923633i, 0.038343127351777626 + -0.0012790589019566043i, 0.0028546443993665094 + 0.0037859748315647503i, 0.00020120319471985033 + 0.00017632986485699987i, 0.001353767162201213 + -0.00016573884680089082i, 0.022187371955066513 + 5.470457651494411e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.20638270708789572, 1.0e-7), DoubleNear(0.16927300484032326, 1.0e-7), DoubleNear(0.234024068670715, 1.0e-7), DoubleNear(0.3267312626867157, 1.0e-7), DoubleNear(0.014014850766341624, 1.0e-7), DoubleNear(0.011494838569963164, 1.0e-7), DoubleNear(0.015891895422979044, 1.0e-7), DoubleNear(0.022187371955066513, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.029528680543294866 + 1.4255564502289875e-18i, 0.0029391530290049043 + 0.0006217363944671097i, 0.0003510132238876203 + -0.0003968813264021907i, 0.001981244938417998 + -0.0012673208355874635i, -0.0030330635643387093 + 0.0035636648531419805i, -0.01426632828579561 + 0.039307423838382906i, 0.021067932045440847 + 0.020332209536235317i, 0.0014774372568839174 + 0.0020638450390995005i }, { 0.0029391530290049043 + -0.0006217363944671093i, 0.053144911475651764 + 1.5960747704231188e-18i, 0.0016718592337502404 + -0.009667196898848247i, -9.126807599473376e-05 + -0.0003805911441905789i, -0.04059608061392149 + 0.08043053578320056i, -0.0008677954973833209 + 0.004950013532284679i, 0.0020832843140695034 + 0.00164563095343249i, 0.029010719788099774 + 0.03183855220775199i }, { 0.0003510132238876204 + 0.0003968813264021905i, 0.001671859233750241 + 0.009667196898848247i, 0.05513754131135907 + 2.361234414622686e-18i, 0.003634782009696137 + -0.00021152360833465162i, -0.025559456366813803 + -0.0013516157165874478i, -0.0015793893972464292 + 0.00022306513294211895i, 7.903951335744865e-05 + 0.004830387667650337i, -0.040193919307798164 + 0.08034602089971016i }, { 0.001981244938417997 + 0.0012673208355874638i, -9.126807599473371e-05 + 0.000380591144190579i, 0.003634782009696138 + 0.0002115236083346514i, 0.04710296198396085 + 1.964078946346682e-18i, -0.00144264810984543 + -0.0002306176053445212i, -0.016943042390771313 + 0.001245396337064029i, 0.0012884528231253147 + 0.024806148851803763i, -0.002845318729508337 + 0.002646203361823064i }, { -0.0030330635643387106 + -0.0035636648531419805i, -0.04059608061392149 + -0.08043053578320054i, -0.0255594563668138 + 0.0013516157165874513i, -0.0014426481098454296 + 0.00023061760534452135i, 0.1908688773109425 + 1.6455997280578937e-18i, 0.01132279538117639 + -0.0016650542652448992i, 0.0014359581161735625 + -0.003437109061386641i, 0.04291089588078012 + -0.05827092333740358i }, { -0.014266328285795615 + -0.039307423838382906i, -0.000867795497383322 + -0.004950013532284678i, -0.0015793893972464292 + -0.00022306513294211862i, -0.01694304239077131 + -0.0012453963370640262i, 0.011322795381176391 + 0.0016650542652448988i, 0.12762293193463464 + -7.498200346891084e-18i, 0.023069094578663577 + -0.023715991798164002i, 0.0032553897272380554 + -0.002392372495535355i }, { 0.021067932045440843 + -0.02033220953623531i, 0.002083284314069503 + -0.0016456309534324896i, 7.903951335744913e-05 + -0.004830387667650338i, 0.0012884528231253193 + -0.024806148851803777i, 0.001435958116173562 + 0.003437109061386642i, 0.023069094578663574 + 0.023715991798164016i, 0.19477842278233498 + 7.028891154552998e-18i, 0.017654561803294954 + 0.002817932886999354i }, { 0.001477437256883917 + -0.0020638450390995005i, 0.02901071978809977 + -0.03183855220775198i, -0.04019391930779816 + -0.08034602089971019i, -0.002845318729508336 + -0.002646203361823065i, 0.04291089588078012 + 0.05827092333740359i, 0.0032553897272380554 + 0.0023923724955353565i, 0.01765456180329495 + -0.0028179328869993533i, 0.30181567265782133 + 6.323206830371759e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.029528680543294866, 1.0e-7), DoubleNear(0.053144911475651764, 1.0e-7), DoubleNear(0.05513754131135907, 1.0e-7), DoubleNear(0.04710296198396085, 1.0e-7), DoubleNear(0.1908688773109425, 1.0e-7), DoubleNear(0.12762293193463464, 1.0e-7), DoubleNear(0.19477842278233498, 1.0e-7), DoubleNear(0.30181567265782133, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.13148835766076916 + 1.410574554974427e-19i, 0.012517768870626928 + -0.004997444498336398i, 0.0007562355136572216 + -0.005763808406094379i, 0.027531052059312926 + -0.038838705639905366i, -0.0008993651589012414 + -0.02694296802353207i, 0.0030344624533322 + 0.010458488005949357i, 0.0062876690493406835 + 0.001884427180535568i, -0.012454922264473693 + -0.004062264774666456i }, { 0.012517768870626928 + 0.004997444498336398i, 0.0965766462324099 + -2.838619164485974e-18i, 0.01346535157231747 + -0.02121247213527006i, 0.0041419330395286984 + -0.002867389792774609i, -0.0038413665295294994 + 0.007108521366033217i, 0.010195916535772554 + 0.0028983297031369075i, 0.0021781117531374187 + -0.0034979233853591214i, 0.0022594526378261664 + 0.002252711354778193i }, { 0.0007562355136572206 + 0.005763808406094379i, 0.013465351572317468 + 0.021212472135270062i, 0.13053868856106274 + 4.115288894719704e-18i, 0.017780900148128578 + 0.008787961903535027i, -0.004216798075910449 + -5.888831029803032e-06i, 0.00507736030022234 + 0.005978155251079225i, 0.020797731851441747 + 0.009024743271389184i, -0.006351396359457905 + 0.007451633839310573i }, { 0.027531052059312923 + 0.038838705639905366i, 0.0041419330395286984 + 0.0028673897927746104i, 0.017780900148128574 + -0.008787961903535027i, 0.2052861594237445 + 5.927840967351013e-18i, 0.00842678556821503 + -0.00923164661240021i, -0.004610443620207175 + 0.0037692230317097337i, 0.005146900465334146 + 0.015820496654806514i, -0.0069204219043618575 + -0.04087819930520542i }, { -0.000899365158901239 + 0.026942968023532073i, -0.0038413665295294985 + -0.007108521366033216i, -0.004216798075910449 + 5.888831029802815e-06i, 0.008426785568215025 + 0.009231646612400208i, 0.08890920019346818 + 2.9300987227894384e-18i, 0.0017441795395543662 + 0.00395412662755861i, 0.001030735826403961 + 0.001929818018305547i, 0.017361088759885193 + -0.020699538533085683i }, { 0.0030344624533322007 + -0.010458488005949357i, 0.010195916535772554 + -0.002898329703136908i, 0.005077360300222342 + -0.005978155251079224i, -0.004610443620207174 + -0.003769223031709734i, 0.0017441795395543667 + -0.00395412662755861i, 0.08419119717787651 + -3.0635064119819908e-18i, 0.011275602240096346 + -0.012170716561742189i, -0.0009778113882853764 + 9.442615304867502e-05i }, { 0.006287669049340685 + -0.0018844271805355665i, 0.0021781117531374196 + 0.0034979233853591235i, 0.02079773185144175 + -0.00902474327138918i, 0.005146900465334144 + -0.015820496654806518i, 0.0010307358264039618 + -0.0019298180183055468i, 0.011275602240096348 + 0.012170716561742196i, 0.1193772755326313 + 5.2748366744559796e-18i, 0.003508443664862518 + -0.006181552624870325i }, { -0.012454922264473697 + 0.004062264774666457i, 0.0022594526378261655 + -0.0022527113547781935i, -0.006351396359457907 + -0.0074516338393105725i, -0.006920421904361854 + 0.04087819930520542i, 0.017361088759885193 + 0.020699538533085687i, -0.0009778113882853768 + -9.44261530486751e-05i, 0.0035084436648625183 + 0.006181552624870325i, 0.1436324752180377 + 2.3594448093674277e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.13148835766076916, 1.0e-7), DoubleNear(0.0965766462324099, 1.0e-7), DoubleNear(0.13053868856106274, 1.0e-7), DoubleNear(0.2052861594237445, 1.0e-7), DoubleNear(0.08890920019346818, 1.0e-7), DoubleNear(0.08419119717787651, 1.0e-7), DoubleNear(0.1193772755326313, 1.0e-7), DoubleNear(0.1436324752180377, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.12617913352211987 + 3.370158808667649e-18i, 0.008165064578093066 + -0.0005973067315471317i, 0.0010230535107240363 + -0.0021949861412860028i, 0.02570106259646335 + -0.034086058549454915i, 0.09644502654964797 + -0.01678045050593664i, 0.006161532198443051 + -0.0015424160887798114i, 0.0004900617477103177 + -0.00181379273328063i, 0.015111533839342939 + -0.029471641838252585i }, { 0.008165064578093068 + 0.0005973067315471323i, 0.10349084659666367 + -1.3417001884508117e-18i, 0.014164367994611803 + -0.019112107525167146i, 0.0018114816343677812 + -0.0015875409544254852i, 0.006320402778162674 + -0.0006293132329538477i, 0.07910323338772192 + -0.013763155449378301i, 0.008284833186985339 + -0.016492046946899718i, 0.001173480414516865 + -0.0014543443300311717i }, { 0.0010230535107240363 + 0.0021949861412860036i, 0.014164367994611805 + 0.019112107525167156i, 0.14307862623207038 + 2.9888858285381227e-18i, 0.012188297283013988 + 0.0014921874252501056i, 0.0010738802488670029 + 0.001541682784156279i, 0.01336823747798064 + 0.012724633596580763i, 0.10936215458493467 + -0.019027898979222024i, 0.00951457026830681 + -0.0004803572648827506i }, { 0.025701062596463348 + 0.03408605854945492i, 0.0018114816343677812 + 0.001587540954425486i, 0.012188297283013988 + -0.0014921874252501056i, 0.19975834313889493 + 2.376544286990124e-18i, 0.024177682931757108 + 0.02263571902262591i, 0.001595731727682115 + 0.0009725296740033923i, 0.00911768091685789 + -0.002761464320037294i, 0.15268529882690177 + -0.026565684013058338i }, { 0.09644502654964797 + 0.016780450505936635i, 0.006320402778162674 + 0.0006293132329538477i, 0.0010738802488670027 + -0.0015416827841562787i, 0.024177682931757108 + -0.0226357190226259i, 0.09421842433211751 + -2.99002630380768e-19i, 0.006096883832088228 + -0.00044601113923065756i, 0.0007639178293371464 + -0.001639004246502829i, 0.01919107822273477 + -0.025452185623536128i }, { 0.00616153219844305 + 0.0015424160887798112i, 0.07910323338772192 + 0.013763155449378294i, 0.013368237477980643 + -0.012724633596580756i, 0.001595731727682115 + -0.0009725296740033914i, 0.006096883832088228 + 0.00044601113923065685i, 0.07727699681362275 + -4.560425388017153e-18i, 0.010576585817802011 + -0.014271081171845104i, 0.0013526400168755403 + -0.0011854226853004485i }, { 0.0004900617477103178 + 0.0018137927332806307i, 0.00828483318698534 + 0.016492046946899718i, 0.10936215458493469 + 0.01902789897922203i, 0.00911768091685789 + 0.002761464320037294i, 0.0007639178293371463 + 0.0016390042465028293i, 0.010576585817802011 + 0.014271081171845107i, 0.10683733786162367 + 6.401239740637561e-18i, 0.009101046529977105 + 0.001114221853414597i }, { 0.015111533839342935 + 0.029471641838252592i, 0.0011734804145168648 + 0.0014543443300311723i, 0.00951457026830681 + 0.0004803572648827519i, 0.15268529882690177 + 0.02656568401305835i, 0.01919107822273477 + 0.025452185623536135i, 0.0013526400168755405 + 0.001185422685300449i, 0.009101046529977104 + -0.0011142218534145965i, 0.14916029150288726 + 5.910741489728317e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12617913352211987, 1.0e-7), DoubleNear(0.10349084659666367, 1.0e-7), DoubleNear(0.14307862623207038, 1.0e-7), DoubleNear(0.19975834313889493, 1.0e-7), DoubleNear(0.09421842433211751, 1.0e-7), DoubleNear(0.07727699681362275, 1.0e-7), DoubleNear(0.10683733786162367, 1.0e-7), DoubleNear(0.14916029150288726, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.20539770997710716 + 2.738457518473153e-18i, 0.01334270929514699 + -0.0009342466584621521i, 0.001297628076142442 + -0.0002643809401118942i, 0.024102531705895217 + -0.006355022988591166i, 0.046115729952885515 + -0.01694386043879172i, 0.0025457456864102367 + -0.0014586675776993886i, 0.00029103008097292136 + -0.011178390291786668i, 0.03263622689381149 + -0.20647311867927853i }, { 0.013342709295146991 + 0.0009342466584621519i, 0.16991099079777472 + -5.779729315589718e-18i, 0.019065148290214558 + 0.002648730752233136i, 0.0017717055361337409 + 8.53983393415324e-07i, 0.0028222173905765504 + -0.0005774919251746004i, 0.02938030326145627 + -0.011693066316107182i, 0.042884130775941026 + -0.11554564966961262i, 0.00507866252765882 + -0.011717976378048304i }, { 0.001297628076142442 + 0.0002643809401118944i, 0.019065148290214558 + -0.002648730752233134i, 0.005261352046828548 + 7.351429141312431e-19i, 0.0003669233953587082 + -5.311298970026691e-06i, 0.00021015473379742522 + 0.00014728030947184755i, 0.001191482523616956 + 0.0005367038141493078i, 0.021832981756481244 + -0.013758706833969304i, 0.0019073782500630236 + -0.0014068730226861085i }, { 0.024102531705895214 + 0.006355022988591171i, 0.001771705536133741 + -8.539833934152156e-07i, 0.00036692339535870813 + 5.311298970026758e-06i, 0.005059605994734479 + 4.064912354644306e-19i, 0.004938161090956841 + 0.0008315387329713138i, 0.00022567876893380616 + -4.999472822212164e-05i, 0.0012459673697462269 + -0.0014428498209552438i, 0.022516258772023293 + -0.02632032638024251i }, { 0.046115729952885515 + 0.016943860438791716i, 0.0028222173905765504 + 0.0005774919251746004i, 0.00021015473379742522 + -0.00014728030947184752i, 0.004938161090956839 + -0.0008315387329713138i, 0.014999847877130223 + 3.3269865981372816e-19i, 0.0009192391150343051 + -0.00010907121231563717i, 0.0004893432639187408 + -0.0035696094476769377i, 0.020789609113302902 + -0.05318322118439987i }, { 0.0025457456864102362 + 0.0014586675776993884i, 0.02938030326145627 + 0.011693066316107186i, 0.0011914825236169556 + -0.0005367038141493076i, 0.00022567876893380616 + 4.9994728222121625e-05i, 0.0009192391150343053 + 0.00010907121231563721i, 0.010856852612511715 + -1.223962608782464e-19i, 0.00567580552219926 + -0.036031919449245386i, 0.0013924161151095808 + -0.002773817623119349i }, { 0.000291030080972922 + 0.011178390291786664i, 0.042884130775941026 + 0.11554564966961256i, 0.02183298175648125 + 0.013758706833969302i, 0.0012459673697462273 + 0.001442849820955244i, 0.0004893432639187404 + 0.0035696094476769386i, 0.00567580552219926 + 0.0360319194492454i, 0.2446546120468655 + 8.654982655044441e-18i, 0.020922420417632384 + 0.002611720577634729i }, { 0.03263622689381147 + 0.2064731186792785i, 0.005078662527658817 + 0.011717976378048299i, 0.0019073782500630238 + 0.0014068730226861085i, 0.022516258772023297 + 0.026320326380242502i, 0.0207896091133029 + 0.05318322118439989i, 0.0013924161151095808 + 0.0027738176231193504i, 0.020922420417632384 + -0.0026117205776347288i, 0.34385902864704776 + 7.88079454125401e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.20539770997710716, 1.0e-7), DoubleNear(0.16991099079777472, 1.0e-7), DoubleNear(0.005261352046828548, 1.0e-7), DoubleNear(0.005059605994734479, 1.0e-7), DoubleNear(0.014999847877130223, 1.0e-7), DoubleNear(0.010856852612511715, 1.0e-7), DoubleNear(0.2446546120468655, 1.0e-7), DoubleNear(0.34385902864704776, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.3534691277358919 + 6.5777931705808795e-18i, 0.02697918397499167 + 0.0013674667713031946i, -0.0060795066946762386 + 0.005711119821374968i, -0.021273717688348258 + -0.020496068073750408i, 0.04148091513573458 + 0.0013837299518868799i, 0.0031607542172767014 + 0.00026609304930671227i, -0.00073581008471829 + 0.0006464216057507334i, -0.0024163135836874463 + -0.002488570208015689i }, { 0.026979183974991668 + -0.0013674667713031944i, 0.40541141606067344 + 2.6512660644651635e-18i, 0.016726015171313776 + 0.02108262598819771i, 0.006474229377267684 + -0.005762030740156185i, 0.003171460695331985 + -5.486156109846068e-05i, 0.04757653561539929 + 0.0015870690683322864i, 0.0018803275949253132 + 0.0025396020109961404i, 0.0007823315593580995 + -0.0006508509654316865i }, { -0.006079506694676238 + -0.00571111982137497i, 0.016726015171313786 + -0.0210826259881977i, 0.0869376480227188 + 5.423975477742912e-18i, 0.006311438665862192 + 9.622928470702551e-05i, -0.0006910953023763583 + -0.000694020645361378i, 0.002045392426647168 + -0.002408646935419896i, 0.01020245593393184 + 0.0003403358824749208i, 0.0007402940619330221 + 3.6000330765698516e-05i }, { -0.02127371768834826 + 0.020496068073750404i, 0.006474229377267682 + 0.00576203074015619i, 0.006311438665862193 + -9.622928470702513e-05i, 0.09059285146636548 + -2.0328790734103208e-20i, -0.0025767860044118504 + 0.0023220092382251487i, 0.0007372181738134105 + 0.0007015404565456322i, 0.0007410474818673213 + 1.3414602738626781e-05i, 0.010631407635657378 + 0.0003546449524568203i }, { 0.041480915135734577 + -0.001383729951886879i, 0.0031714606953319856 + 5.4861561098460895e-05i, -0.0006910953023763586 + 0.000694020645361378i, -0.0025767860044118495 + -0.0023220092382251496i, 0.024003062783829576 + 1.3156741912477496e-19i, 0.0018320780967668567 + 9.286070038602233e-05i, -0.0004128416583981298 + 0.0003878255748005942i, -0.001444636437104711 + -0.0013918285083258223i }, { 0.003160754217276701 + -0.00026609304930671243i, 0.04757653561539929 + -0.0015870690683322869i, 0.0020453924266471673 + 0.0024086469354198973i, 0.0007372181738134108 + -0.000701540456545632i, 0.0018320780967668563 + -9.286070038602225e-05i, 0.02753031286018444 + -1.442687774305267e-19i, 0.001135815155490209 + 0.0014316599542487333i, 0.00043964613038450194 + -0.000391282787564027i }, { -0.0007358100847182896 + -0.0006464216057507337i, 0.0018803275949253143 + -0.0025396020109961395i, 0.01020245593393184 + -0.0003403358824749192i, 0.0007410474818673212 + -1.3414602738626727e-05i, -0.0004128416583981297 + -0.00038782557480059423i, 0.0011358151554902093 + -0.0014316599542487326i, 0.005903683405491094 + 3.2794568001399846e-19i, 0.0004285914855516724 + 6.534651490671617e-06i }, { -0.0024163135836874476 + 0.0024885702080156883i, 0.0007823315593580993 + 0.0006508509654316872i, 0.0007402940619330221 + -3.6000330765698435e-05i, 0.010631407635657376 + -0.00035464495245682054i, -0.0014446364371047116 + 0.001391828508325822i, 0.0004396461303845017 + 0.00039128278756402714i, 0.0004285914855516724 + -6.534651490671583e-06i, 0.00615189766484524 + -1.0150829605005734e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3534691277358919, 1.0e-7), DoubleNear(0.40541141606067344, 1.0e-7), DoubleNear(0.0869376480227188, 1.0e-7), DoubleNear(0.09059285146636548, 1.0e-7), DoubleNear(0.024003062783829576, 1.0e-7), DoubleNear(0.02753031286018444, 1.0e-7), DoubleNear(0.005903683405491094, 1.0e-7), DoubleNear(0.00615189766484524, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.06825111071496051 + 6.865328182539519e-19i, 0.005016672162063423 + 0.0001213291122394509i, -0.0006898160386085116 + 0.0017372175125034749i, -0.0049813756661736845 + -0.0020619707380154077i, -0.005245368836342865 + 0.009411300352513138i, -0.0780531233457911 + 0.13293605880041223i, -0.011041463670336165 + -0.0013089441955375421i, -2.452677229686966e-05 + 0.003494553864489349i }, { 0.005016672162063423 + -0.0001213291122394509i, 0.07285971390911741 + 6.939232634368069e-19i, 0.006526523312375184 + 0.0020632607762409044i, 0.0005557033033044821 + -0.0017373294827449555i, -0.0730719365169933 + 0.12809980737096782i, -0.005500013494509671 + 0.009149024365462166i, -4.296995200614938e-06 + -0.003273146979684979i, 0.011373549779850174 + -0.0012419420132384904i }, { -0.0006898160386085115 + -0.0017372175125034749i, 0.006526523312375184 + -0.002063260776240903i, 0.01641511113969343 + 3.1002580465977218e-18i, 0.001557262876637618 + 0.00028888367389300713i, -0.004002449174426867 + 0.015993909012418504i, 0.004310852382006651 + 0.0007232573658145993i, 0.0022913447853616046 + -0.00101724783172082i, 0.02359287575219733 + -0.013282614062319146i }, { -0.0049813756661736845 + 0.002061970738015407i, 0.000555703303304482 + 0.0017373294827449557i, 0.001557262876637618 + -0.00028888367389300675i, 0.027388159550495204 + 2.866230453332994e-18i, -0.00413228974365005 + -0.0010724940859028994i, 0.001945182653609427 + -0.011970262079945886i, 0.03376430872619713 + -0.02286312273596349i, 0.001786899267618013 + -0.0015528074713544232i }, { -0.005245368836342866 + -0.009411300352513138i, -0.0730719365169933 + -0.12809980737096782i, -0.004002449174426867 + -0.0159939090124185i, -0.00413228974365005 + 0.0010724940859028987i, 0.309221079804761 + 6.0228277714517026e-18i, 0.023794589909695102 + 0.0013389983594497656i, -0.005802532314465857 + 0.004361727883672087i, -0.01773697845927928 + -0.019825925844060822i }, { -0.07805312334579109 + -0.13293605880041223i, -0.005500013494509671 + -0.009149024365462166i, 0.004310852382006651 + -0.0007232573658145985i, 0.001945182653609428 + 0.011970262079945882i, 0.023794589909695102 + -0.0013389983594497648i, 0.3600820150117405 + 1.81307402359783e-18i, 0.011335307014428801 + 0.02045102516620554i, 0.006358172204347704 + -0.0044159840449752566i }, { -0.011041463670336165 + 0.0013089441955375387i, -4.296995200615806e-06 + 0.003273146979684979i, 0.002291344785361604 + 0.0010172478317208196i, 0.03376430872619713 + 0.02286312273596349i, -0.005802532314465857 + -0.00436172788367209i, 0.01133530701442881 + -0.020451025166205533i, 0.07642622028851648 + 2.651663111159189e-18i, 0.005182767274776246 + -0.0001861197376953099i }, { -2.4526772296868575e-05 + -0.00349455386448935i, 0.011373549779850174 + 0.0012419420132384939i, 0.023592875752197325 + 0.013282614062319148i, 0.001786899267618013 + 0.0015528074713544227i, -0.017736978459279292 + 0.019825925844060815i, 0.0063581722043477016 + 0.004415984044975262i, 0.0051827672747762465 + 0.00018611973769530995i, 0.06935658958071551 + -2.9880675401171546e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.06825111071496051, 1.0e-7), DoubleNear(0.07285971390911741, 1.0e-7), DoubleNear(0.01641511113969343, 1.0e-7), DoubleNear(0.027388159550495204, 1.0e-7), DoubleNear(0.309221079804761, 1.0e-7), DoubleNear(0.3600820150117405, 1.0e-7), DoubleNear(0.07642622028851648, 1.0e-7), DoubleNear(0.06935658958071551, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.224977465607793 + 2.997193823815452e-18i, 0.030752887782183082 + 0.003966906563713392i, -0.0004424694880285525 + 0.003157173438719034i, 0.004674391004476131 + -0.02032404421106241i, 0.017155218581491875 + -0.025693893630853323i, -0.0033012214266806383 + 0.02431075488700806i, 0.001694658404541867 + -0.004669939770990922i, -0.006338070068335812 + 0.03170207633833441i }, { 0.03075288778218308 + -0.003966906563713391i, 0.26362978970205764 + 2.1001685618802845e-18i, -0.005885789606521061 + 0.030071826923598232i, -0.00023580708837034033 + -0.0100772661927671i, 0.0016711548931700854 + 0.02899968857685749i, 0.0016252012026238757 + -0.04727415144988184i, -0.05683764141421175 + -0.02355373914342664i, -0.009647203294814975 + 0.005695650693795285i }, { -0.0004424694880285473 + -0.0031571734387190326i, -0.005885789606521055 + -0.03007182692359824i, 0.037049580614038916 + 1.2591525264016949e-18i, -0.0004542187634275713 + -0.0001763891585147636i, -0.003332257735698944 + -0.0032424858493203513i, -0.03179031614755551 + 0.009337278032759456i, 0.002743148111048633 + 0.007775668878710433i, -1.571247944506598e-05 + -0.0064006330417481294i }, { 0.0046743910044761226 + 0.02032404421106241i, -0.00023580708837034076 + 0.010077266192767104i, -0.00045421876342757094 + 0.00017638915851476392i, 0.038233015954096776 + 9.890532409847548e-19i, -0.009818490814165727 + -0.014703938438247582i, 0.003834352554618858 + 0.0033072455139504164i, -0.00036562095736543767 + -0.00607067055601776i, 0.001650293428786821 + 0.009294281847813335i }, { 0.017155218581491875 + 0.025693893630853323i, 0.0016711548931700841 + -0.02899968857685749i, -0.003332257735698945 + 0.00324248584932035i, -0.009818490814165722 + 0.014703938438247594i, 0.15249472491192853 + 3.712166765890202e-18i, -0.0019416257104245514 + -0.0025065790920241757i, -0.006049878865045818 + 0.0029417719574565287i, -0.0273927451299291 + -0.0015638523710138196i }, { -0.0033012214266806383 + -0.02431075488700806i, 0.0016252012026238792 + 0.04727415144988184i, -0.03179031614755549 + -0.009337278032759449i, 0.0038343525546188587 + -0.0033072455139504164i, -0.0019416257104245508 + 0.0025065790920241753i, 0.16931193921880028 + 4.0682872515435225e-19i, 0.023747619933325043 + -0.00755754098115179i, 0.007149682596022526 + 0.003923952665046889i }, { 0.001694658404541863 + 0.004669939770990927i, -0.05683764141421178 + 0.023553739143426643i, 0.0027431481110486355 + -0.007775668878710432i, -0.0003656209573654385 + 0.00607067055601776i, -0.0060498788650458196 + -0.0029417719574565317i, 0.02374761993332505 + 0.007557540981151802i, 0.055791750814170996 + 4.492768631355216e-18i, 0.007194248914841435 + 0.00027915309471246094i }, { -0.006338070068335809 + -0.031702076338334384i, -0.009647203294814973 + -0.005695650693795288i, -1.5712479445066305e-05 + 0.0064006330417481294i, 0.0016502934287868196 + -0.009294281847813335i, -0.0273927451299291 + 0.0015638523710138146i, 0.007149682596022524 + -0.003923952665046887i, 0.0071942489148414356 + -0.0002791530947124606i, 0.05851173317711394 + -1.1108903277689153e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.224977465607793, 1.0e-7), DoubleNear(0.26362978970205764, 1.0e-7), DoubleNear(0.037049580614038916, 1.0e-7), DoubleNear(0.038233015954096776, 1.0e-7), DoubleNear(0.15249472491192853, 1.0e-7), DoubleNear(0.16931193921880028, 1.0e-7), DoubleNear(0.055791750814170996, 1.0e-7), DoubleNear(0.05851173317711394, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.21610545231165906 + 3.912351918753548e-18i, 0.016494647759652176 + 0.0008360476260728714i, -0.003716914550643402 + 0.003491688623869019i, -0.013006415617790928 + -0.012530972902951562i, 0.16518021247996506 + -0.02873967149206273i, 0.012718870007419471 + -0.0015545754624788795i, -0.0023766672508654385 + 0.0031631815145889354i, -0.011607937297382437 + -0.007848338097919308i }, { 0.016494647759652176 + -0.0008360476260728705i, 0.24786214853129812 + 1.1257644827486907e-18i, 0.010226021992702032 + 0.012889585164849948i, 0.003958241776037841 + -0.003522814757009104i, 0.012496499550144738 + -0.002832641545873452i, 0.18945344470576153 + -0.03296296621814594i, 0.009530434826400508 + 0.008492205466991094i, 0.0025569862900648365 + -0.003219066668510313i }, { -0.0037169145506434015 + -0.00349168862386902i, 0.010226021992702039 + -0.012889585164849945i, 0.0531523074425312 + 2.446692718452224e-18i, 0.003858714101454881 + 5.8833067630102796e-05i, -0.0033053803668848082 + -0.002174563208045672i, 0.006102085940760048 + -0.011212104568074619i, 0.0406269686546176 + -0.007068677993095935i, 0.0029572324593303916 + -0.00046819789118368306i }, { -0.013006415617790933 + 0.01253097290295156i, 0.00395824177603784 + 0.0035228147570091064i, 0.0038587141014548815 + -5.8833067630102525e-05i, 0.055387041204260475 + -9.092038420937859e-20i, -0.008274971461912518 + 0.011307761339175295i, 0.003493978279492492 + 0.0021662605767377835i, 0.0029415841448758263 + -0.0005581360071176901i, 0.042335087508862154 + -0.007365873244290697i }, { 0.16518021247996506 + 0.028739671492062725i, 0.012496499550144737 + 0.0028326415458734505i, -0.0033053803668848082 + 0.0021745632080456706i, -0.00827497146191251 + -0.011307761339175298i, 0.16136673820806247 + 2.7970086709521065e-18i, 0.012316614312106351 + 0.0006242798456163451i, -0.002775433802430967 + 0.002607256772306543i, -0.009711938507662037 + -0.009356923679124668i }, { 0.012718870007419468 + 0.001554575462478879i, 0.18945344470576153 + 0.03296296621814595i, 0.006102085940760042 + 0.011212104568074623i, 0.003493978279492493 + -0.0021662605767377805i, 0.012316614312106351 + -0.0006242798456163449i, 0.18507958038955977 + 1.381232804285946e-18i, 0.007635808334101953 + 0.009624700777596492i, 0.0029556337316143442 + -0.002630498770711108i }, { -0.002376667250865437 + -0.0031631815145889367i, 0.009530434826400511 + -0.00849220546699109i, 0.0406269686546176 + 0.007068677993095938i, 0.0029415841448758263 + 0.0005581360071176904i, -0.002775433802430966 + -0.0026072567723065447i, 0.0076358083341019544 + -0.00962470077759649i, 0.03968902398567871 + 3.3052284393046867e-18i, 0.0028813160499589828 + 4.39308685675945e-05i }, { -0.011607937297382444 + 0.007848338097919306i, 0.002556986290064835 + 0.0032190666685103144i, 0.002957232459330392 + 0.00046819789118368333i, 0.042335087508862154 + 0.0073658732442906955i, -0.009711938507662044 + 0.009356923679124664i, 0.002955633731614343 + 0.0026304987707111106i, 0.0028813160499589823 + -4.393086856759428e-05i, 0.04135770792695023 + -3.091670257478196e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.21610545231165906, 1.0e-7), DoubleNear(0.24786214853129812, 1.0e-7), DoubleNear(0.0531523074425312, 1.0e-7), DoubleNear(0.055387041204260475, 1.0e-7), DoubleNear(0.16136673820806247, 1.0e-7), DoubleNear(0.18507958038955977, 1.0e-7), DoubleNear(0.03968902398567871, 1.0e-7), DoubleNear(0.04135770792695023, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.18427169418359166 + 3.546645443776504e-18i, 0.011236166966299817 + -0.001381841313676915i, -0.0034921586732963106 + 0.00042962366651930336i, -0.0024263092512031128 + -0.009037133130275526i, 0.055056119287994185 + -0.027882233402870743i, 0.003817442694223853 + -0.002320240775363763i, 0.0004760080931686828 + 0.0010830984419930294i, -0.0038269602900889155 + 0.0011537722911704857i }, { 0.011236166966299813 + 0.0013818413136769151i, 0.13178339871612751 + -8.233245033324586e-19i, 0.0019158489911450184 + 0.01424207042406509i, 0.0035364646151321566 + -0.0008813917414162951i, 0.003563228512676034 + -0.0019880455985060155i, 0.04874701620097621 + -0.032710309152609564i, 0.003159669581327381 + -0.0018075315075507838i, -0.0004180898855365667 + -0.0010263547146511657i }, { -0.0034921586732963093 + -0.00042962366651930445i, 0.0019158489911450202 + -0.014242070424065082i, 0.026387367840344046 + -7.304501117210766e-20i, 0.0024734657242058847 + 0.00044228335624473555i, -0.0016674227554964564 + -0.0008553931468089154i, 0.0016696334543299515 + -0.005922921493011575i, 0.012892592421372577 + -0.0028203338698902765i, 0.0006356812422494068 + -0.0005452998250217344i }, { -0.002426309251203111 + 0.009037133130275522i, 0.003536464615132155 + 0.0008813917414162964i, 0.0024734657242058856 + -0.0004422833562447357i, 0.043187198076381654 + -4.549913576792829e-18i, -0.0040315605631979345 + 0.005801269716957998i, 0.0018724287340110253 + 0.0008659520422524974i, 0.000504956247646744 + -3.229614762382925e-05i, 0.0031495458325033485 + -0.005303083543740128i }, { 0.05505611928799418 + 0.027882233402870736i, 0.0035632285126760335 + 0.001988045598506015i, -0.0016674227554964562 + 0.0008553931468089152i, -0.0040315605631979345 + -0.005801269716957998i, 0.19320049633612985 + 3.1627151459291507e-18i, 0.01757509510545871 + 0.0028421687853661315i, -0.0030001896797780584 + 0.005669321729656259i, -0.020292044874249855 + -0.012850763451800702i }, { 0.0038174426942238523 + 0.0023202407753637622i, 0.04874701620097621 + 0.03271030915260956i, 0.0016696334543299504 + 0.005922921493011577i, 0.0018724287340110262 + -0.0008659520422524976i, 0.01757509510545871 + -0.0028421687853661306i, 0.3011583302047304 + 3.3303217903670954e-18i, 0.015945981335658967 + 0.008272215518381351i, 0.0033774108925200283 + -0.005271921786303917i }, { 0.00047600809316868293 + -0.0010830984419930294i, 0.003159669581327381 + 0.0018075315075507835i, 0.01289259242137258 + 0.0028203338698902804i, 0.0005049562476467443 + 3.229614762382952e-05i, -0.0030001896797780584 + -0.0056693217296562605i, 0.01594598133565897 + -0.008272215518381351i, 0.06645396358786586 + 5.824966168929018e-18i, 0.004266564427207979 + -0.00033951942004703826i }, { -0.003826960290088917 + -0.0011537722911704861i, -0.00041808988553656667 + 0.0010263547146511657i, 0.0006356812422494073 + 0.0005452998250217346i, 0.0031495458325033524 + 0.005303083543740131i, -0.020292044874249866 + 0.012850763451800702i, 0.0033774108925200283 + 0.00527192178630392i, 0.004266564427207979 + 0.0003395194200470389i, 0.05355755105482905 + 4.4280764900086686e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.18427169418359166, 1.0e-7), DoubleNear(0.13178339871612751, 1.0e-7), DoubleNear(0.026387367840344046, 1.0e-7), DoubleNear(0.043187198076381654, 1.0e-7), DoubleNear(0.19320049633612985, 1.0e-7), DoubleNear(0.3011583302047304, 1.0e-7), DoubleNear(0.06645396358786586, 1.0e-7), DoubleNear(0.05355755105482905, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.07928238513797076 + 3.673740710919511e-18i, 0.0061559053680821305 + 0.0003841277830314081i, 0.00930408239817785 + 0.00031036773048652834i, 0.0007209146118941813 + 6.917742085320249e-05i, -0.0027661807434702637 + 0.00786028347838967i, -0.050997177266711935 + 0.11204480701991956i, -0.0003553923341311565 + 0.0009116046621293277i, -0.0064233313736123294 + 0.012949235026735926i }, { 0.0061559053680821305 + -0.0003841277830314077i, 0.09387321577348365 + 3.1865908871298813e-18i, 0.0007239221114296406 + -2.0980223585320518e-05i, 0.011016370572334361 + 0.0003674866350499654i, -0.03680809674866344 + 0.0985447936509873i, -0.0034770011670424063 + 0.007113181386835509i, -0.00470534139931824 + 0.011420504479186796i, -0.000435885061481877 + 0.0008211467990259671i }, { 0.00930408239817785 + -0.000310367730486527i, 0.0007239221114296406 + 2.0980223585320606e-05i, 0.0053838367166831715 + 1.1305015393216288e-19i, 0.0004180296706189115 + 2.6085003101049926e-05i, -0.0002938508368635582 + 0.000933262265844765i, -0.005546084998971701 + 0.013348513583806182i, -0.00018784330751099725 + 0.0005337690424026461i, -0.003463070326881837 + 0.007608637718173512i }, { 0.0007209146118941814 + -6.917742085320244e-05i, 0.011016370572334363 + -0.0003674866350499643i, 0.0004180296706189116 + -2.6085003101049953e-05i, 0.006374657686128977 + 3.735628296399197e-19i, -0.003933792362202503 + 0.011708690699405338i, -0.0003801929437503225 + 0.0008483697176915945i, -0.002499531042132732 + 0.006691890984017026i, -0.000236113059849252 + 0.000483035507272234i }, { -0.002766180743470264 + -0.007860283478389673i, -0.036808096748663435 + -0.0985447936509873i, -0.0002938508368635584 + -0.0009332622658447651i, -0.003933792362202504 + -0.01170869069940534i, 0.36112439062063995 + 8.328027937404281e-18i, 0.02713471727277173 + 0.001079568272978812i, 0.042379288671488574 + 0.0014136981038752727i, 0.0031801336673155417 + 0.0002329159592192085i }, { -0.050997177266711935 + -0.11204480701991959i, -0.0034770011670424063 + -0.0071131813868355095i, -0.005546084998971702 + -0.013348513583806183i, -0.0003801929437503228 + -0.0008483697176915946i, 0.027134717272771728 + -0.0010795682729788114i, 0.40213105175355535 + -5.55653613398821e-19i, 0.003188586065769666 + -2.0466734774513494e-05i, 0.04719157267872229 + 0.0015742273857391412i }, { -0.0003553923341311566 + -0.0009116046621293282i, -0.00470534139931824 + -0.011420504479186798i, -0.00018784330751099728 + -0.0005337690424026462i, -0.002499531042132732 + -0.0066918909840170265i, 0.04237928867148857 + -0.001413698103875271i, 0.003188586065769666 + 2.0466734774513684e-05i, 0.024522909472637498 + 3.4646294520661054e-19i, 0.0018426399116996174 + 7.331034877564401e-05i }, { -0.006423331373612329 + -0.01294923502673593i, -0.00043588506148187716 + -0.0008211467990259674i, -0.0034630703268818367 + -0.0076086377181735125i, -0.00023611305984925205 + -0.000483035507272234i, 0.003180133667315542 + -0.00023291595921920845i, 0.04719157267872229 + -0.0015742273857391434i, 0.0018426399116996174 + -7.331034877564389e-05i, 0.027307552838900698 + -6.193399031205037e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.07928238513797076, 1.0e-7), DoubleNear(0.09387321577348365, 1.0e-7), DoubleNear(0.0053838367166831715, 1.0e-7), DoubleNear(0.006374657686128977, 1.0e-7), DoubleNear(0.36112439062063995, 1.0e-7), DoubleNear(0.40213105175355535, 1.0e-7), DoubleNear(0.024522909472637498, 1.0e-7), DoubleNear(0.027307552838900698, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.24536501972164276 + 4.2631168235308936e-18i, 0.028372008266019433 + 0.003549482357994462i, 0.028794496496893963 + 0.0009605334675446878i, 0.0033156653582950392 + 0.0005276131901396927i, 0.018633050314242276 + -0.01677882353398087i, -0.0031060135395447157 + 0.016771235882492956i, 0.0022523419360154485 + -0.001896114236535173i, -0.00043015679032277587 + 0.0019560076797259657i }, { 0.028372008266019433 + -0.00354948235799446i, 0.2826676647736128 + 3.002625918898088e-18i, 0.003343455762984192 + -0.0003054766890860151i, 0.033172100458095814 + 0.0011065625919936635i, 0.00122251639487165 + 0.021470985686409996i, 0.003067209345075834 + -0.035564769317925904i, 5.941410773669265e-05 + 0.0025244857263957113i, 0.0004991742509847148 + -0.0041616505460655056i }, { 0.028794496496893966 + -0.0009605334675446857i, 0.003343455762984192 + 0.0003054766890860154i, 0.016662026500189143 + -6.7704733137465315e-21i, 0.0019266607527360714 + 0.00024103504720416718i, 0.0021209734013425043 + -0.002042000300079016i, -0.00029884766259547174 + 0.001980325978713851i, 0.0012653163782982287 + -0.0011394012181620153i, -0.00021092036658098843 + 0.0011388859627669743i }, { 0.0033156653582950392 + -0.000527613190139693i, 0.03317210045809581 + -0.0011065625919936643i, 0.0019266607527360714 + -0.00024103504720416702i, 0.019195140882541553 + 8.659588396695136e-20i, 0.0002275195724550653 + 0.0025149141263915344i, 0.00022072256920767429 + -0.004185665030536466i, 8.301754093299708e-05 + 0.0014580323344297369i, 0.00020828528633486202 + -0.0024151002841426047i }, { 0.018633050314242283 + 0.016778823533980875i, 0.0012225163948716474 + -0.021470985686409996i, 0.0021209734013425043 + 0.0020420003000790154i, 0.0002275195724550659 + -0.0025149141263915353i, 0.195041756036968 + 7.738651824792898e-18i, 0.004918614374834426 + -0.002085786301984241i, 0.022888874572772458 + 0.0007635323668171135i, 0.0005853829209146843 + -0.00022551981006728195i }, { -0.0031060135395447165 + -0.016771235882492956i, 0.003067209345075839 + 0.035564769317925904i, -0.0002988476625954713 + -0.00198032597871385i, 0.000220722569207672 + 0.004185665030536467i, 0.004918614374834427 + 0.0020857863019842406i, 0.21333660275342606 + -3.7168864516702767e-19i, 0.0005690524142151148 + 0.000264029730726181i, 0.02503584279296085 + 0.0008351514287954426i }, { 0.002252341936015448 + 0.0018961142365351742i, 5.94141077366926e-05 + -0.002524485726395711i, 0.0012653163782982292 + 0.0011394012181620153i, 8.301754093299708e-05 + -0.0014580323344297367i, 0.022888874572772454 + -0.000763532366817112i, 0.0005690524142151148 + -0.0002640297307261811i, 0.013244719689131525 + 4.662835724525199e-19i, 0.0003340088295824575 + -0.00014163969532747313i }, { -0.00043015679032277576 + -0.0019560076797259657i, 0.0004991742509847144 + 0.004161650546065505i, -0.00021092036658098843 + -0.0011388859627669743i, 0.00020828528633486196 + 0.0024151002841426047i, 0.0005853829209146843 + 0.000225519810067282i, 0.02503584279296085 + -0.0008351514287954429i, 0.0003340088295824574 + 0.00014163969532747322i, 0.01448706964248812 + -3.323729574475354e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24536501972164276, 1.0e-7), DoubleNear(0.2826676647736128, 1.0e-7), DoubleNear(0.016662026500189143, 1.0e-7), DoubleNear(0.019195140882541553, 1.0e-7), DoubleNear(0.195041756036968, 1.0e-7), DoubleNear(0.21333660275342606, 1.0e-7), DoubleNear(0.013244719689131525, 1.0e-7), DoubleNear(0.01448706964248812, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.2678697123116023 + 6.353382379117693e-18i, 0.02024843848989143 + 0.0008902675049894913i, -0.017895635114379024 + -0.007180676359082728i, -0.0013288771655177874 + -0.000602268112374409i, 0.2115152008818108 + -0.038454822123708196i, 0.016116370813350357 + -0.002203851212445011i, 0.0872823928170468 + -0.004591245247129188i, 0.006612989514084547 + -5.697123711397576e-05i }, { 0.02024843848989143 + -0.0008902675049894905i, 0.30168591348062884 + 1.027398025460263e-18i, -0.0013766072561739585 + -0.00048331548957883467i, -0.02015480204987554 + -0.008087173753629329i, 0.015860760888275562 + -0.0036097967262651983i, 0.2382171393787096 + -0.04330940605420404i, 0.006582471420675005 + -0.0006371389418700406i, 0.09830102918524442 + -0.005170849680767626i }, { -0.017895635114379027 + 0.007180676359082729i, -0.0013766072561739585 + 0.0004833154895788345i, 0.0013880474425879336 + 5.662258088078613e-21i, 0.00010492337121562485 + 4.6131887134829386e-06i, -0.013099902910736934 + 0.00823906386663668i, -0.0010176124310258554 + 0.0005792583218868555i, -0.005708019747228171 + 0.002646472638549535i, -0.000440268346600496 + 0.00018107785878244823i }, { -0.0013288771655177874 + 0.000602268112374409i, -0.02015480204987554 + 0.008087173753629329i, 0.00010492337121562485 + -4.613188713482932e-06i, 0.001563276254929751 + 7.446073079049217e-21i, -0.0009628472187239345 + 0.0006663336226314197i, -0.014753650728291181 + 0.00927917339882053i, -0.00042267719325499403 + 0.00021901917327405655i, -0.006428607164085913 + 0.0029805665917674007i }, { 0.2115152008818108 + 0.038454822123708196i, 0.01586076088827556 + 0.0036097967262651975i, -0.013099902910736932 + -0.00823906386663668i, -0.0009628472187239348 + -0.0006663336226314198i, 0.17253706344700842 + 5.6483862692060984e-18i, 0.013042184150962428 + 0.0005734285510207294i, 0.06957900618404544 + 0.008904742193444528i, 0.005229925444727512 + 0.0009043614924468199i }, { 0.016116370813350357 + 0.00220385121244501i, 0.2382171393787096 + 0.04330940605420404i, -0.0010176124310258554 + -0.0005792583218868555i, -0.01475365072829118 + -0.00927917339882053i, 0.013042184150962428 + -0.0005734285510207288i, 0.19431835404641012 + 1.6035392482707973e-18i, 0.005289115433373265 + 0.00044186853121900064i, 0.07836274530093221 + 0.010028887774418434i }, { 0.0872823928170468 + 0.00459124524712919i, 0.006582471420675004 + 0.0006371389418700415i, -0.00570801974722817 + -0.002646472638549535i, -0.00042267719325499403 + -0.00021901917327405655i, 0.06957900618404544 + -0.008904742193444528i, 0.005289115433373265 + -0.0004418685312190001i, 0.028518698746732737 + 4.538508410506948e-19i, 0.002155746211102904 + 9.478216316321104e-05i }, { 0.006612989514084548 + 5.6971237113975976e-05i, 0.09830102918524442 + 0.005170849680767625i, -0.00044026834660049603 + -0.00018107785878244829i, -0.006428607164085912 + -0.002980566591767401i, 0.005229925444727512 + -0.0009043614924468199i, 0.07836274530093221 + -0.010028887774418436i, 0.002155746211102904 + -9.47821631632109e-05i, 0.03211893427009992 + -2.5322314655963326e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2678697123116023, 1.0e-7), DoubleNear(0.30168591348062884, 1.0e-7), DoubleNear(0.0013880474425879336, 1.0e-7), DoubleNear(0.001563276254929751, 1.0e-7), DoubleNear(0.17253706344700842, 1.0e-7), DoubleNear(0.19431835404641012, 1.0e-7), DoubleNear(0.028518698746732737, 1.0e-7), DoubleNear(0.03211893427009992, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.19726347204741 + 3.6195306022952355e-18i, 0.012837851450779487 + -0.0008798124471464009i, 0.023149601199381014 + 0.0007722297458723285i, 0.0015100137678471237 + -5.2992763484342124e-05i, 0.06362792402168396 + -0.02875022305143399i, 0.0041699544312332245 + -0.0026833238631843704i, 0.007579522088752122 + -0.0031248604520564736i, 0.0004998640832191287 + -0.00029857385079694207i }, { 0.01283785145077949 + 0.0008798124471464011i, 0.16384439908678627 + -4.6332172819218195e-18i, 0.0015031253425809203 + 0.00015350575416108998i, 0.01922774884901013 + 0.0006414036889657118i, 0.0038094931356926326 + -0.0018918703222869987i, 0.04859651379670904 + -0.035596160713615904i, 0.000454464298284889 + -0.00020710494011781015i, 0.005842330139758226 + -0.003987100313537724i }, { 0.02314960119938101 + -0.0007722297458723306i, 0.0015031253425809208 + -0.00015350575416109025i, 0.01339558997652569 + -1.4593016969083945e-19i, 0.0008717812397262093 + -5.974551028577824e-05i, 0.007354424383532316 + -0.0036230304891917797i, 0.0004788552012051085 + -0.0003312221948345701i, 0.004320787687682793 + -0.00195234422132703i, 0.0002831695052400355 + -0.00018221673720112685i }, { 0.0015100137678471237 + 5.299276348434191e-05i, 0.01922774884901013 + -0.0006414036889657131i, 0.0008717812397262093 + 5.97455102857782e-05i, 0.011126197705722913 + -7.400207982034683e-19i, 0.0004396520421379226 + -0.0002369310796006564i, 0.005563632681413787 + -0.0043675830568455625i, 0.00025869162463014483 + -0.00012847142384284565i, 0.0033000482367705297 + -0.0024172319827337817i }, { 0.06362792402168396 + 0.028750223051433987i, 0.003809493135692633 + 0.001891870322286999i, 0.007354424383532316 + 0.00362303048919178i, 0.0004396520421379227 + 0.0002369310796006565i, 0.24314330371120074 + 8.382238046028556e-18i, 0.02045277119007437 + 0.0023435085031566216i, 0.02853376987028541 + 0.000951836088489472i, 0.0023910345113626 + 0.0003550861435567531i }, { 0.0041699544312332245 + 0.00268332386318437i, 0.04859651379670904 + 0.03559616071361592i, 0.0004788552012051085 + 0.0003312221948345702i, 0.005563632681413789 + 0.0043675830568455625i, 0.020452771190074368 + -0.0023435085031566203i, 0.3321598684402527 + 7.26415455565288e-18i, 0.0024093828346183855 + -0.00019495271252092402i, 0.03898019440204654 + 0.0013003103318233941i }, { 0.007579522088752122 + 0.0031248604520564736i, 0.000454464298284889 + 0.00020710494011781002i, 0.004320787687682793 + 0.0019523442213270298i, 0.0002586916246301449 + 0.00012847142384284565i, 0.028533769870285407 + -0.0009518360884894677i, 0.0024093828346183855 + 0.00019495271252092464i, 0.01651115621279498 + 6.054432688296129e-19i, 0.0013888883425923195 + 0.00015914086216247222i }, { 0.0004998640832191287 + 0.0002985738507969423i, 0.005842330139758226 + 0.003987100313537726i, 0.0002831695052400355 + 0.00018221673720112688i, 0.0033000482367705293 + 0.002417231982733782i, 0.0023910345113626 + -0.00035508614355675276i, 0.03898019440204653 + -0.001300310331823395i, 0.0013888883425923195 + -0.00015914086216247203i, 0.02255601281930676 + 4.942437247228842e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.19726347204741, 1.0e-7), DoubleNear(0.16384439908678627, 1.0e-7), DoubleNear(0.01339558997652569, 1.0e-7), DoubleNear(0.011126197705722913, 1.0e-7), DoubleNear(0.24314330371120074, 1.0e-7), DoubleNear(0.3321598684402527, 1.0e-7), DoubleNear(0.01651115621279498, 1.0e-7), DoubleNear(0.02255601281930676, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.04796643445313688 + 1.9933654827292752e-18i, 0.00524980592742 + -0.0001662699154829151i, -0.005959245212331644 + 0.009888762390677324i, -0.037446880734248754 + 0.0746514275224372i, 0.00432381389583801 + -0.005618722743595268i, 9.929131690871763e-05 + 0.0025419587973749278i, -0.010056965800789342 + -0.007936414719166764i, 0.013490634816575383 + 0.008963665650315623i }, { 0.00524980592742 + 0.0001662699154829153i, 0.05450460551891806 + 1.0983237999030097e-18i, -0.030892118854256932 + 0.06837681563241603i, -0.005785119184523096 + 0.010095564129708742i, -0.0004712275227357779 + 0.003859102102690237i, -3.864029418130296e-05 + -0.003142654389518879i, 0.011094037364802202 + 0.015019230462780978i, -0.009303554535365957 + -0.006230255544472453i }, { -0.005959245212331644 + -0.009888762390677326i, -0.030892118854256922 + -0.06837681563241604i, 0.214060611768695 + 2.262980867487872e-18i, 0.025048863091335506 + 0.003956787320681544i, 0.009026897441729801 + -0.006203194196563343i, -0.017509337632202377 + 0.005771342700407819i, 0.015574552796702494 + -0.012299502008547623i, -0.003416225223034422 + 0.015368163047885006i }, { -0.03744688073424875 + -0.07465142752243721i, -0.005785119184523096 + -0.010095564129708742i, 0.025048863091335503 + -0.003956787320681543i, 0.24735820013723636 + 1.9908980029620296e-18i, -0.011421262030773987 + 0.007788408070253574i, 0.010710832297955959 + -0.0070587880679827825i, 0.0017767614585404252 + 0.019069915918149497i, 0.003314134925591997 + -0.03483721521254963i }, { 0.0043238138958380115 + 0.005618722743595268i, -0.00047122752273577855 + -0.003859102102690237i, 0.009026897441729801 + 0.006203194196563344i, -0.011421262030773986 + -0.0077884080702535705i, 0.03669978740151705 + 1.7934253821223984e-18i, 0.0013241291112810422 + 0.0005764827016153731i, 0.0030052211613503833 + -0.0014947098698850074i, -0.017013366859345024 + 0.04500201721565588i }, { 9.92913169087172e-05 + -0.0025419587973749278i, -3.864029418130209e-05 + 0.003142654389518878i, -0.01750933763220238 + -0.005771342700407818i, 0.010710832297955957 + 0.007058788067982781i, 0.001324129111281042 + -0.0005764827016153727i, 0.045743267940694554 + 2.4618299168667912e-18i, -0.008415508936539248 + 0.036859869002588294i, 0.002072004957631437 + -0.0024993472356009986i }, { -0.010056965800789342 + 0.007936414719166764i, 0.011094037364802202 + -0.015019230462780978i, 0.015574552796702503 + 0.012299502008547623i, 0.0017767614585404226 + -0.019069915918149497i, 0.003005221161350382 + 0.0014947098698850072i, -0.008415508936539246 + -0.036859869002588294i, 0.17158668832458246 + 6.41151001512302e-18i, 0.003928494093135841 + -0.002803908698927088i }, { 0.013490634816575383 + -0.00896366565031562i, -0.009303554535365958 + 0.006230255544472454i, -0.0034162252230344223 + -0.015368163047885006i, 0.003314134925592002 + 0.03483721521254963i, -0.017013366859345028 + -0.04500201721565588i, 0.0020720049576314374 + 0.0024993472356009986i, 0.003928494093135842 + 0.002803908698927087i, 0.18208040445521964 + -3.1658915194813543e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.04796643445313688, 1.0e-7), DoubleNear(0.05450460551891806, 1.0e-7), DoubleNear(0.214060611768695, 1.0e-7), DoubleNear(0.24735820013723636, 1.0e-7), DoubleNear(0.03669978740151705, 1.0e-7), DoubleNear(0.045743267940694554, 1.0e-7), DoubleNear(0.17158668832458246, 1.0e-7), DoubleNear(0.18208040445521964, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.048472000398830234 + 1.6105514651185625e-18i, 0.003763623495150507 + 0.00023484967083038416i, -0.0016911992981466322 + 0.004805653402535547i, -0.031178870218264806 + 0.06850242864294591i, 0.03704957574906945 + -0.006446248130826808i, 0.0029079582411782106 + -0.0003210135773982001i, -0.0006535686990282539 + 0.0038981124880521196i, -0.01472149396463822 + 0.05650628466602195i }, { 0.0037636234951505076 + -0.00023484967083038384i, 0.05739260422719717 + 2.4961347512305904e-18i, -0.02250389007818719 + 0.06024873329480106i, -0.00212578369914473 + 0.004348886961708119i, 0.002845493344365238 + -0.0006800282909433965i, 0.04386803969830015 + -0.0076325912831891485i, -0.009188424080904716 + 0.04904389436754977i, -0.0010464882679101452 + 0.003606778030009225i }, { -0.001691199298146632 + -0.004805653402535547i, -0.02250389007818719 + -0.06024873329480106i, 0.22078575935536002 + 4.7484931720872094e-18i, 0.01658973836595655 + 0.0006600310228725903i, -0.0019317678246514606 + -0.0034482903134015167i, -0.025213274765452362 + -0.04305834979917058i, 0.16875760538551318 + -0.029362101354331857i, 0.01276814422557165 + -0.0017017597762643618i }, { -0.031178870218264806 + -0.06850242864294592i, -0.0021257836991447304 + -0.004348886961708119i, 0.01658973836595655 + -0.0006600310228725898i, 0.24585658550836142 + -1.4612906526912783e-18i, -0.03294164782514791 + -0.04821338434368941i, -0.002203197469817339 + -0.0030413658710555166i, 0.012592590350655328 + -0.002710749262047745i, 0.18792049251632353 + -0.03269624817924749i }, { 0.037049575749069454 + 0.006446248130826811i, 0.0028454933443652383 + 0.0006800282909433971i, -0.0019317678246514604 + 0.003448290313401516i, -0.03294164782514791 + 0.04821338434368941i, 0.036194221455823704 + 2.176239399733111e-18i, 0.0028103115435505347 + 0.00017536311530207387i, -0.0012628247528346291 + 0.0035883991182567706i, -0.023281377375328968 + 0.05115101609514717i }, { 0.0029079582411782106 + 0.0003210135773982001i, 0.04386803969830015 + 0.007632591283189152i, -0.025213274765452362 + 0.04305834979917058i, -0.0022031974698173383 + 0.0030413658710555153i, 0.0028103115435505347 + -0.00017536311530207355i, 0.04285526923241544 + 1.0640189655392106e-18i, -0.016803737712608985 + 0.04498795134020328i, -0.0015873305277469278 + 0.0032473299323996243i }, { -0.0006535686990282539 + -0.003898112488052119i, -0.009188424080904712 + -0.04904389436754977i, 0.16875760538551318 + 0.02936210135433185i, 0.012592590350655325 + 0.0027107492620477443i, -0.0012628247528346296 + -0.0035883991182567715i, -0.016803737712608978 + -0.04498795134020328i, 0.16486154073791745 + 3.925997710523682e-18i, 0.012387618818514799 + 0.0004928475988818658i }, { -0.014721493964638215 + -0.05650628466602196i, -0.0010464882679101452 + -0.003606778030009224i, 0.01276814422557165 + 0.0017017597762643622i, 0.18792049251632353 + 0.03269624817924749i, -0.02328137737532897 + -0.05115101609514718i, -0.0015873305277469278 + -0.0032473299323996247i, 0.012387618818514797 + -0.0004928475988818658i, 0.18358201908409458 + 2.862971361719535e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.048472000398830234, 1.0e-7), DoubleNear(0.05739260422719717, 1.0e-7), DoubleNear(0.22078575935536002, 1.0e-7), DoubleNear(0.24585658550836142, 1.0e-7), DoubleNear(0.036194221455823704, 1.0e-7), DoubleNear(0.04285526923241544, 1.0e-7), DoubleNear(0.16486154073791745, 1.0e-7), DoubleNear(0.18358201908409458, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.026829366205731547 + 1.34564191086478e-18i, 0.0027070520983349207 + 0.0005919874618312755i, -0.0028494289656760203 + 0.003246804600732051i, -0.013025247871039636 + 0.03658596632844713i, 0.008374247448875834 + -0.0009415404073984836i, 0.000797777264531691 + 6.215043941009302e-05i, -0.0005961113345718289 + 0.001146808519678225i, -0.0034543225743744587 + 0.011527930088169332i }, { 0.0027070520983349202 + -0.0005919874618312748i, 0.04931560431577482 + 1.4545886285732205e-18i, -0.039281588739249584 + 0.07418486690343473i, -0.0008697223015282261 + 0.004629287923329802i, 0.0007779328240299394 + -0.00022284011535278814i, 0.01378683292297321 + -0.0013184291449594085i, -0.005420687943600445 + 0.022186072130301746i, -3.492485024467971e-05 + 0.00125034417008487i }, { -0.002849428965676021 + -0.0032468046007320516i, -0.039281588739249584 + -0.07418486690343472i, 0.18382969581820413 + 2.127958521739616e-18i, 0.011002580592170779 + -0.0015315454192634547i, -0.0006813517848815679 + -0.0007366086077557432i, -0.006442571074927782 + -0.013852518830410962i, 0.05957446426049093 + -0.02976102686536254i, 0.0036553466719415695 + -0.00292769103979559i }, { -0.01302524787103964 + -0.03658596632844712i, -0.0008697223015282272 + -0.004629287923329801i, 0.011002580592170779 + 0.0015315454192634543i, 0.12565499247673437 + -6.827826708698508e-18i, -0.007157691794551923 + -0.006337517184683934i, -0.00028566205428809984 + -0.0006989551329822841i, 0.0032902519362928385 + -0.0017975016307770564i, 0.038109729110506356 + -0.036694963551390285i }, { 0.008374247448875834 + 0.000941540407398482i, 0.0007779328240299395 + 0.00022284011535278806i, -0.0006813517848815678 + 0.0007366086077557426i, -0.007157691794551927 + 0.006337517184683931i, 0.05783685564892239 + 2.4411489539868936e-18i, 0.0038668829403661216 + -0.00018177467569881743i, -0.00010459508530524114 + 0.0051472479200602664i, -0.04143499972255414 + 0.08306747840964596i }, { 0.0007977772645316911 + -6.215043941009329e-05i, 0.013786832922973212 + 0.0013184291449594078i, -0.006442571074927785 + 0.013852518830410951i, -0.0002856620542881004 + 0.0006989551329822836i, 0.003866882940366122 + 0.00018177467569881743i, 0.05093226914383779 + 2.1055650881965805e-18i, -2.603905154659105e-05 + 0.031051817731569602i, -0.002843391925363432 + 0.0029669289707779413i }, { -0.0005961113345718294 + -0.001146808519678225i, -0.0054206879436004465 + -0.022186072130301746i, 0.05957446426049093 + 0.029761026865362538i, 0.0032902519362928385 + 0.0017975016307770564i, -0.0001045950853052406 + -0.005147247920060267i, -2.6039051546587148e-05 + -0.031051817731569613i, 0.20181760427507334 + 6.5465323608712754e-18i, 0.017974776592300568 + 0.0026844240410179108i }, { -0.0034543225743744626 + -0.01152793008816933i, -3.492485024467976e-05 + -0.00125034417008487i, 0.0036553466719415686 + 0.00292769103979559i, 0.038109729110506356 + 0.03669496355139029i, -0.04143499972255414 + -0.08306747840964598i, -0.002843391925363431 + -0.002966928970777943i, 0.017974776592300568 + -0.00268442404101791i, 0.30378361211572164 + 5.6528331921791835e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.026829366205731547, 1.0e-7), DoubleNear(0.04931560431577482, 1.0e-7), DoubleNear(0.18382969581820413, 1.0e-7), DoubleNear(0.12565499247673437, 1.0e-7), DoubleNear(0.05783685564892239, 1.0e-7), DoubleNear(0.05093226914383779, 1.0e-7), DoubleNear(0.20181760427507334, 1.0e-7), DoubleNear(0.30378361211572164, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.15001230491627038 + 8.510224393486436e-19i, 0.017346198573527274 + 0.0021700975566380665i, 0.011391953214974786 + -0.010258308193121037i, -0.0018989677122551439 + 0.010253669222619475i, 0.114661912208228 + -0.019950002727571907i, 0.01354716702268257 + -0.0006481413200511636i, 0.0073431967037469684 + -0.00935594404698387i, -8.784972777623845e-05 + 0.008089934568585101i }, { 0.017346198573527274 + -0.0021700975566380652i, 0.17281855403062188 + 8.15143480279156e-19i, 0.0007474272510428642 + 0.013127022161906435i, 0.0018752434394989853 + -0.021743739287898682i, 0.012969968342905057 + -0.003965569655832116i, 0.13209386977469773 + -0.022982985470493864i, 0.0023170470313755237 + 0.009934240313278313i, -0.0014583380982940656 + -0.01686921508507556i }, { 0.011391953214974793 + 0.010258308193121037i, 0.000747427251042862 + -0.013127022161906435i, 0.11924545483791985 + 5.508022197857128e-18i, 0.0030071632875797788 + -0.0012752168629350923i, 0.010071683230865736 + 0.006325932637746881i, -0.001174454923495463 + -0.010133039681174027i, 0.09114526892635466 + -0.01585834675758676i, 0.0021289354440672923 + -0.0013746320336113986i }, { -0.0018989677122551456 + -0.010253669222619475i, 0.0018752434394989884 + 0.021743739287898682i, 0.00300716328757978 + 0.001275216862935092i, 0.13043063570493674 + 2.197006182601561e-19i, -0.002815102389790257 + -0.007584850521510345i, 0.004325022917901381 + 0.016370441177778455i, 0.0024681153521155085 + 0.0005747921028409746i, 0.09969466243992595 + -0.017345853991942776i }, { 0.114661912208228 + 0.0199500027275719i, 0.012969968342905057 + 0.003965569655832116i, 0.010071683230865732 + -0.006325932637746881i, -0.0028151023897902572 + 0.007584850521510345i, 0.1120147413055615 + 3.4053239108685035e-18i, 0.01295247044522823 + 0.0016204198485605629i, 0.00850641347756572 + -0.0076599165590218515i, -0.001417966193870561 + 0.007656452622640458i }, { 0.013547167022682568 + 0.000648141320051164i, 0.13209386977469773 + 0.022982985470493874i, -0.0011744549234954616 + 0.010133039681174029i, 0.00432502291790138 + -0.016370441177778458i, 0.012952470445228228 + -0.0016204198485605624i, 0.12904425162553254 + 2.2740783225858833e-18i, 0.0005581066847617829 + 0.0098019958589333i, 0.0014002511919117087 + -0.016236130314169823i }, { 0.00734319670374697 + 0.00935594404698387i, 0.0023170470313755237 + -0.009934240313278315i, 0.09114526892635466 + 0.01585834675758676i, 0.0024681153521155085 + -0.0005747921028409753i, 0.008506413477565719 + 0.007659916559021854i, 0.0005581066847617825 + -0.0098019958589333i, 0.08904102088817965 + 2.6969131993882897e-18i, 0.0022454599168371045 + -0.000952209134376623i }, { -8.784972777623693e-05 + -0.0080899345685851i, -0.001458338098294063 + 0.01686921508507556i, 0.0021289354440672927 + 0.0013746320336113982i, 0.09969466243992595 + 0.017345853991942772i, -0.00141796619387056 + -0.007656452622640458i, 0.0014002511919117104 + 0.016236130314169827i, 0.0022454599168371045 + 0.0009522091343766225i, 0.09739303669097746 + -9.237622208747192e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.15001230491627038, 1.0e-7), DoubleNear(0.17281855403062188, 1.0e-7), DoubleNear(0.11924545483791985, 1.0e-7), DoubleNear(0.13043063570493674, 1.0e-7), DoubleNear(0.1120147413055615, 1.0e-7), DoubleNear(0.12904425162553254, 1.0e-7), DoubleNear(0.08904102088817965, 1.0e-7), DoubleNear(0.09739303669097746, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.12483094728827031 + 4.847195671499487e-20i, 0.011826695974784179 + -0.004512860107415102i, -0.0005276534725823989 + -0.02457447524310645i, 0.0027177203246423415 + 0.009615362937227635i, 0.038152194779466735 + -0.017820297473735494i, 0.00413368590207244 + -0.0022907742633058656i, -0.002764338175320378 + -0.005102556278394045i, 0.001142316726461029 + 0.0037392205033379487i }, { 0.011826695974784177 + 0.0045128601074151025i, 0.09334937537510546 + -2.597439767645113e-18i, -0.0034933758089406596 + 0.006598556744385267i, 0.009464181708397308 + 0.0023818625880407092i, 0.0036675087053183513 + -0.0022689278376018256i, 0.03080199119922492 + -0.02193731896965144i, 0.0020681372121157484 + 0.0021720664985000254i, 0.0008174010598356438 + -0.004391682149766606i }, { -0.0005276534725823963 + 0.02457447524310645i, -0.0034933758089406596 + -0.0065985567443852654i, 0.08582811473566536 + 3.4251284758894012e-18i, 0.0018829367157215209 + 0.003573302149982922i, 0.0010474346071450758 + 0.0014633025857783953i, -0.0020013699171056703 + -0.002244089922245556i, 0.02979651692990003 + -0.012882269799025528i, 0.00031943803440081993 + -0.0005747663370796317i }, { 0.0027177203246423432 + -0.009615362937227635i, 0.009464181708397308 + -0.0023818625880407105i, 0.0018829367157215215 + -0.0035733021499829228i, 0.08162122141740372 + -2.775798312480175e-18i, -0.0016911975815700681 + -0.003390766519907513i, 0.006454058016435041 + 0.004846107588249549i, 0.000400676055004426 + 0.0002485860914719811i, 0.021094570834254648 + -0.016076073726698253i }, { 0.03815219477946673 + 0.01782029747373549i, 0.0036675087053183513 + 0.0022689278376018256i, 0.0010474346071450756 + -0.0014633025857783938i, -0.0016911975815700675 + 0.0033907665199075124i, 0.13719609893356158 + 4.207874393502152e-18i, 0.01847197304397133 + 0.00830337751261373i, 0.020426020165122905 + 0.006656250490963559i, -0.006034654230768047 + 0.008294758908032298i }, { 0.004133685902072439 + 0.0022907742633058647i, 0.030801991199224922 + 0.02193731896965144i, -0.0020013699171056694 + 0.0022440899222455554i, 0.0064540580164350395 + -0.004846107588249549i, 0.01847197304397133 + -0.00830337751261373i, 0.20851343028104896 + 5.686661570510152e-18i, 0.004798909744745307 + 0.016330461276454468i, -0.006188687076986613 + -0.04036173219010922i }, { -0.002764338175320377 + 0.005102556278394045i, 0.002068137212115748 + -0.0021720664985000254i, 0.029796516929900027 + 0.012882269799025528i, 0.00040067605500442634 + -0.00024858609147198073i, 0.020426020165122908 + -0.006656250490963559i, 0.004798909744745304 + -0.016330461276454468i, 0.12245836099043414 + 4.779806921356017e-18i, 0.0033696864886953626 + -0.005800728147294637i }, { 0.0011423167264610287 + -0.0037392205033379487i, 0.0008174010598356433 + 0.004391682149766606i, 0.00031943803440082015 + 0.000574766337079632i, 0.02109457083425465 + 0.016076073726698257i, -0.006034654230768049 + -0.008294758908032298i, -0.006188687076986608 + 0.04036173219010922i, 0.003369686488695363 + 0.005800728147294637i, 0.14620245097851045 + 2.071736709865612e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.12483094728827031, 1.0e-7), DoubleNear(0.09334937537510546, 1.0e-7), DoubleNear(0.08582811473566536, 1.0e-7), DoubleNear(0.08162122141740372, 1.0e-7), DoubleNear(0.13719609893356158, 1.0e-7), DoubleNear(0.20851343028104896, 1.0e-7), DoubleNear(0.12245836099043414, 1.0e-7), DoubleNear(0.14620245097851045, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.1206037769816952 + 3.3573451605937434e-18i, 0.007848859990266355 + -0.0005379034600783159i, 0.09218350251983884 + -0.016038988808839593i, 0.005927741195225208 + -0.0014549594291746195i, 0.03890110966248794 + -0.01757743313083221i, 0.0025494444005700885 + -0.0016405419077657247i, 0.027396457805997455 + -0.01860873572953759i, 0.0017304937394848857 + -0.0015929966217151283i }, { 0.007848859990266355 + 0.0005379034600783168i, 0.10017188262008027 + -1.1805705750043104e-18i, 0.006070811798689671 + -0.0006326663599437038i, 0.0765663831185544 + -0.013321769388264786i, 0.002329064047093078 + -0.0011566596900035898i, 0.029711142418792906 + -0.02176293149234306i, 0.0016263970709660131 + -0.0011938330393772934i, 0.019815480221150712 + -0.020585756043056284i }, { 0.09218350251983884 + 0.01603898880883959i, 0.0060708117986896706 + 0.000632666359943704i, 0.09005528504224047 + 1.1625527201065272e-19i, 0.005860772700239344 + -0.0004016544973538636i, 0.03207167213724238 + -0.008261887925214114i, 0.002166842151741998 + -0.0009148999445984805i, 0.029047602046878822 + -0.013125134141928813i, 0.0019036795359031716 + -0.0012249986926197727i }, { 0.005927741195225209 + 0.001454959429174619i, 0.0765663831185544 + 0.013321769388264782i, 0.005860772700239343 + 0.0004016544973538627i, 0.07479871417242892 + -4.192667505120977e-18i, 0.0019340433534936184 + -0.0005743527358364475i, 0.025603945945672946 + -0.012683239344509017i, 0.0017391207132296995 + -0.0008636820561262549i, 0.02218541961468666 + -0.016250461204006632i }, { 0.03890110966248794 + 0.01757743313083221i, 0.002329064047093078 + 0.00115665969000359i, 0.03207167213724238 + 0.008261887925214116i, 0.0019340433534936186 + 0.0005743527358364473i, 0.14865398277249503 + 3.0016994766120285e-18i, 0.0125045018708407 + 0.00143278415378129i, 0.11362367861474382 + -0.01976936067631907i, 0.009748361271524654 + -0.0005678139244879427i }, { 0.002549444400570088 + 0.001640541907765724i, 0.029711142418792906 + 0.02176293149234306i, 0.0021668421517419987 + 0.0009148999445984804i, 0.025603945945672946 + 0.012683239344509021i, 0.012504501870840701 + -0.00143278415378129i, 0.20307730711547833 + 2.2154146735436225e-18i, 0.009367271896330895 + -0.002758111193047438i, 0.1552221490960693 + -0.027007070074171854i }, { 0.027396457805997455 + 0.01860873572953759i, 0.0016263970709660131 + 0.0011938330393772934i, 0.02904760204687882 + 0.013125134141928813i, 0.0017391207132296995 + 0.0008636820561262547i, 0.11362367861474382 + 0.019769360676319077i, 0.009367271896330895 + 0.0027581111930474376i, 0.11100047715150069 + 5.9859818382461405e-18i, 0.00933715766182599 + 0.0010698652115378035i }, { 0.0017304937394848857 + 0.0015929966217151281i, 0.019815480221150712 + 0.020585756043056288i, 0.0019036795359031716 + 0.0012249986926197729i, 0.022185419614686668 + 0.016250461204006632i, 0.009748361271524652 + 0.0005678139244879431i, 0.1552221490960693 + 0.02700707007417186i, 0.00933715766182599 + -0.0010698652115378026i, 0.15163857414408108 + 5.5429836068321414e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1206037769816952, 1.0e-7), DoubleNear(0.10017188262008027, 1.0e-7), DoubleNear(0.09005528504224047, 1.0e-7), DoubleNear(0.07479871417242892, 1.0e-7), DoubleNear(0.14865398277249503, 1.0e-7), DoubleNear(0.20307730711547833, 1.0e-7), DoubleNear(0.11100047715150069, 1.0e-7), DoubleNear(0.15163857414408108, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.3128620965264262 + 3.0086610286472748e-18i, 0.004317252452758694 + -0.0074897943386606075i, 1.572100856259495e-05 + -0.00039931482304898216i, -0.002141949900423124 + 0.0014470749665735755i, 0.03671552918448242 + 0.0012247651062109455i, 0.0005359660024222986 + -0.0008620543858218427i, 3.408121412568293e-06 + -4.6799534553054175e-05i, -0.00025703065950982907 + 0.00016143450494908297i }, { 0.004317252452758694 + 0.007489794338660611i, 0.44601844727013923 + 6.220398206398768e-18i, 0.0008045175751177718 + 0.0009134193138055535i, 0.00037900167402884994 + 0.000348403904267765i, 0.00047732522196001614 + 0.0008958559886209588i, 0.05234192156665144 + 0.00174603391400822i, 9.083735205161521e-05 + 0.00011034260433052957i, 4.3113353227241136e-05 + 4.237017487210093e-05i }, { 1.5721008562595302e-05 + 0.0003993148230489825i, 0.0008045175751177714 + -0.0009134193138055539i, 0.06279361540179282 + -4.831475931138529e-18i, 0.0003190057006330244 + 0.0013029696248151805i, 2.817160915455589e-07 + 4.692262100510881e-05i, 9.79888997482452e-05 + -0.00010404369459184554i, 0.007369064020476362 + 0.0002458189403280745i, 3.2335752694245495e-05 + 0.00015415714103015284i }, { -0.0021419499004231234 + -0.001447074966573576i, 0.00037900167402884946 + -0.0003484039042677624i, 0.00031900570063302493 + -0.0013029696248151802i, 0.11473688408729146 + 1.0235122618147338e-17i, -0.0002457008950876885 + -0.00017820474031103015i, 4.584115534550638e-05 + -3.940280982085458e-05i, 4.2537255200584504e-05 + -0.00015165950993226298i, 0.013464799549112855 + 0.0004491618946036672i }, { 0.03671552918448242 + -0.0012247651062109472i, 0.00047732522196001603 + -0.0008958559886209583i, 2.817160915457639e-07 + -4.6922621005108796e-05i, -0.00024570089508768855 + 0.00017820474031103047i, 0.021245557126039812 + -3.154138937338201e-19i, 0.00029317208645909885 + -0.0005086101999922605i, 1.0675680729749285e-06 + -2.711631091957811e-05i, -0.00014545360232447006 + 9.826666192337643e-05i }, { 0.0005359660024222985 + 0.0008620543858218425i, 0.05234192156665144 + -0.0017460339140082189i, 9.79888997482452e-05 + 0.0001040436945918458i, 4.584115534550646e-05 + 3.940280982085512e-05i, 0.00029317208645909885 + 0.0005086101999922607i, 0.030287818517974192 + 3.0271253542806835e-19i, 5.463245401356546e-05 + 6.20276550817169e-05i, 2.57369039133973e-05 + 2.3659098156145326e-05i }, { 3.40812141256802e-06 + 4.679953455305419e-05i, 9.083735205161509e-05 + -0.00011034260433052964i, 0.007369064020476359 + -0.0002458189403280765i, 4.2537255200584436e-05 + 0.00015165950993226303i, 1.0675680729748201e-06 + 2.711631091957813e-05i, 5.4632454013565365e-05 + -6.20276550817169e-05i, 0.0042641322102649724 + -6.927406019560092e-19i, 2.1662751453686606e-05 + 8.848088632292142e-05i }, { -0.00025703065950982923 + -0.00016143450494908283i, 4.311335322724119e-05 + -4.237017487210084e-05i, 3.233575269424552e-05 + -0.0001541571410301528i, 0.013464799549112859 + -0.0004491618946036633i, -0.00014545360232447006 + -9.826666192337634e-05i, 2.573690391339719e-05 + -2.3659098156145157e-05i, 2.1662751453686626e-05 + -8.84808863229214e-05i, 0.007791448860071361 + 9.191779859199503e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3128620965264262, 1.0e-7), DoubleNear(0.44601844727013923, 1.0e-7), DoubleNear(0.06279361540179282, 1.0e-7), DoubleNear(0.11473688408729146, 1.0e-7), DoubleNear(0.021245557126039812, 1.0e-7), DoubleNear(0.030287818517974192, 1.0e-7), DoubleNear(0.0042641322102649724, 1.0e-7), DoubleNear(0.007791448860071361, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.07763977919230074 + 7.87423003591279e-19i, 9.605695372307879e-05 + -0.001306836246360529i, 6.003288266127022e-05 + 4.5501642860947415e-05i, 0.0002813900908218598 + -0.0006097179947272533i, -0.004828251265576538 + 0.008751563787122739i, 0.037249017237642644 + 0.04377298587959895i, -0.0026859715504187033 + -0.0012839682477219791i, 5.463061144816777e-05 + 0.0001506846082735643i }, { 9.605695372307907e-05 + 0.0013068362463605288i, 0.06347104543177717 + 5.930330780994798e-19i, 0.0002544244722639059 + -0.00038602593885406704i, -0.00019414561796529981 + -4.5613613102427786e-05i, -0.03449644216863678 + -0.004045249044231536i, -0.005917131065275998 + 0.009808760930852563i, 3.670620051345122e-05 + -1.3647882654655323e-05i, 0.003018057659932711 + -0.0012669179610540536i }, { 6.003288266127036e-05 + -4.5501642860947117e-05i, 0.0002544244722639059 + 0.0003860259388540673i, 0.005033812826645895 + 2.2342082170608273e-18i, 0.00016368819416980778 + 0.0005293637757677595i, -0.0002718756132422673 + -0.0015462482054267985i, 0.00011001576109978106 + 8.189040441745275e-06i, 0.0009273922038545078 + -0.0002378854016960804i, 0.012829634595897975 + 0.00839777586438835i }, { 0.0002813900908218598 + 0.0006097179947272532i, -0.00019414561796530003 + 4.5613613102428e-05i, 0.00016368819416980764 + -0.0005293637757677594i, 0.03876945786354274 + 3.7322802828698885e-18i, 0.00011124730002182482 + -2.5631576524309018e-05i, -0.0017853909075751715 + 0.005569895137899414i, -0.008006056588948339 + 0.003939029664708117i, 0.0031508518491251097 + -0.002332169901379163i }, { -0.00482825126557654 + -0.008751563787122739i, -0.034496442168636766 + 0.00404524904423154i, -0.0002718756132422676 + 0.001546248205426798i, 0.00011124730002182492 + 2.563157652430914e-05i, 0.2564678744601652 + 1.9058241313221758e-18i, 0.004514367585494715 + -0.006691568292292339i, -4.324430602570003e-05 + -0.00047193277682950767i, -0.002568793593569454 + 0.0021550596232242053i }, { 0.037249017237642644 + -0.04377298587959895i, -0.005917131065275996 + -0.009808760930852565i, 0.00011001576109978124 + -8.189040441745505e-06i, -0.0017853909075751712 + -0.005569895137899415i, 0.004514367585494714 + 0.0066915682922923415i, 0.41283522035633624 + 5.930077663727357e-18i, 0.0006047255568674311 + 0.0013614729077413375i, 0.0005988841959075461 + 0.0004176766155263388i }, { -0.0026859715504187033 + 0.0012839682477219791i, 3.6706200513451163e-05 + 1.3647882654655372e-05i, 0.0009273922038545078 + 0.0002378854016960807i, -0.008006056588948337 + -0.003939029664708115i, -4.324430602570007e-05 + 0.00047193277682950767i, 0.000604725556867431 + -0.0013614729077413381i, 0.06202393478541189 + -7.758424750155366e-18i, 0.0001769802579169033 + 0.0008620867353703424i }, { 5.463061144816777e-05 + -0.00015068460827356465i, 0.0030180576599327137 + 0.0012669179610540532i, 0.012829634595897973 + -0.008397775864388349i, 0.0031508518491251097 + 0.002332169901379162i, -0.002568793593569453 + -0.0021550596232242057i, 0.0005988841959075461 + -0.00041767661552633624i, 0.00017698025791690385 + -0.0008620867353703423i, 0.08375887508382009 + 7.4220203211974e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.07763977919230074, 1.0e-7), DoubleNear(0.06347104543177717, 1.0e-7), DoubleNear(0.005033812826645895, 1.0e-7), DoubleNear(0.03876945786354274, 1.0e-7), DoubleNear(0.2564678744601652, 1.0e-7), DoubleNear(0.41283522035633624, 1.0e-7), DoubleNear(0.06202393478541189, 1.0e-7), DoubleNear(0.08375887508382009, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.201437092469776 + -1.3149127714938945e-18i, 0.004921126611172225 + -0.008537426670204946i, -0.006964705395443019 + -0.00048774622176737617i, 0.0018583759154064154 + 0.00521632446589598i, 0.007742564433012964 + -0.030082383518733852i, 0.007269435007203725 + 0.004491675992146638i, -0.0003167338281489367 + 0.008045063523586115i, -0.029755510263112656 + 0.020102456182970296i }, { 0.004921126611172226 + 0.00853742667020495i, 0.2871701628400746 + 6.412275157189631e-18i, 0.0023245395366002872 + -0.001181315301094939i, 0.006286428819044128 + -0.006432346532280691i, -0.007530280878097435 + 0.0040391469940255515i, 0.011037855351102781 + -0.04288566156200131i, 0.011176186221042075 + 0.012689025901631705i, -0.007635811062124171 + -0.007019352600781752i }, { -0.006964705395443017 + 0.00048774622176737524i, 0.0023245395366002877 + 0.0011813153010949388i, 0.02662791142340307 + -1.3826489374946368e-18i, -2.2958057986306064e-05 + -9.37715286640417e-05i, 1.999742425657551e-05 + 0.0005079361096112536i, 0.0073608632831630725 + -0.008357250229293078i, 0.001553986943858348 + 0.006037745198338686i, 0.0012776866799631237 + -0.0003545374568328769i }, { 0.0018583759154064156 + -0.005216324465895979i, 0.006286428819044128 + 0.0064323465322806955i, -2.2958057986306125e-05 + 9.377152866404167e-05i, 0.04865468514473262 + 3.6308547048810865e-18i, -0.019597583525868077 + -0.01323988601228082i, 0.00048209739466333886 + -0.00044317644498118773i, -0.0012969608180201893 + -0.00027581279334561973i, 0.002839454595977106 + 0.01103220552818508i }, { 0.007742564433012968 + 0.030082383518733855i, -0.007530280878097434 + -0.004039146994025551i, 1.999742425657546e-05 + -0.0005079361096112537i, -0.019597583525868077 + 0.01323988601228082i, 0.13267056118268997 + 4.008159906407349e-18i, -0.0003107020719544325 + 0.0005390221315520783i, 0.00698149397207859 + 6.131508779881584e-05i, -0.00414577941815401 + -0.0036709828373990283i }, { 0.007269435007203726 + -0.004491675992146638i, 0.011037855351102787 + 0.04288566156200132i, 0.007360863283163073 + 0.008357250229293078i, 0.0004820973946633388 + 0.00044317644498118735i, -0.0003107020719544325 + -0.0005390221315520785i, 0.18913610294803881 + 1.1083558463720528e-19i, -0.0014653895074689504 + 0.0021567622699822093i, -0.005881690241101881 + 0.006804409534704603i }, { -0.0003167338281489351 + -0.008045063523586114i, 0.011176186221042073 + -0.012689025901631705i, 0.0015539869438583463 + -0.006037745198338686i, -0.0012969608180201898 + 0.0002758127933456194i, 0.006981493972078586 + -6.131508779881468e-05i, -0.0014653895074689509 + -0.002156762269982209i, 0.04042983618865472 + -4.1415675955999015e-18i, 0.00036362651007301717 + 0.0014852220398021436i }, { -0.029755510263112663 + -0.0201024561829703i, -0.007635811062124177 + 0.007019352600781752i, 0.001277686679963123 + 0.00035453745683287734i, 0.0028394545959771083 + -0.01103220552818508i, -0.004145779418154008 + 0.0036709828373990274i, -0.005881690241101881 + -0.0068044095347046035i, 0.0003636265100730176 + -0.0014852220398021434i, 0.07387364780263021 + 7.523445899186202e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.201437092469776, 1.0e-7), DoubleNear(0.2871701628400746, 1.0e-7), DoubleNear(0.02662791142340307, 1.0e-7), DoubleNear(0.04865468514473262, 1.0e-7), DoubleNear(0.13267056118268997, 1.0e-7), DoubleNear(0.18913610294803881, 1.0e-7), DoubleNear(0.04042983618865472, 1.0e-7), DoubleNear(0.07387364780263021, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.19127895359375086 + 4.820993898416257e-18i, 0.00263950008880026 + -0.004579142183209115i, 9.611576795904469e-06 + -0.00024413478767579483i, -0.0013095544016101914 + 0.0008847188216503104i, 0.1462040770354804 + -0.025438017554975535i, 0.0014085259774429789 + -0.0038510923040183864i, -2.5120658651141823e-05 + -0.00018788267129474673i, -0.0008832999999448498 + 0.0008503913449784326i }, { 0.0026395000888002596 + 0.004579142183209116i, 0.27268864724920633 + 2.1712250308598147e-19i, 0.0004918693623320106 + 0.0005584501685466729i, 0.0002317156485985346 + 0.00021300865453570964i, 0.002626478052720413 + 0.0031490427754762773i, 0.20842958015024618 + -0.036264620155233136i, 0.000450228160050248 + 0.0003614381440822412i, 0.00020543969785053964 + 0.0001319975173733693i }, { 9.611576795906122e-06 + 0.0002441347876757952i, 0.0004918693623320107 + -0.0005584501685466734i, 0.03839102652503269 + -2.7925352781994197e-18i, 0.0001950350562915575 + 0.0007966150874976266i, 3.981387698906186e-05 + 0.00018532620123181987i, 0.0003016925796931896 + -0.0004922646802868504i, 0.029344182901889466 + -0.005105588400339405i, 0.00025501618478420383 + 0.0005829552407065848i }, { -0.0013095544016101914 + -0.000884718821650311i, 0.00023171564859853373 + -0.00021300865453570875i, 0.00019503505629155782 + -0.0007966150874976263i, 0.07014832212175899 + 5.148307612442265e-18i, -0.0011186159350597637 + -0.0005020783996022632i, 0.0001487840356186228 + -0.00019362883253970753i, 4.313392382870472e-05 + -0.0006348303173166059i, 0.0536178732615903 + -0.009328962837047228i }, { 0.1462040770354804 + 0.02543801755497553i, 0.0026264780527204138 + -0.0031490427754762764i, 3.98138769890627e-05 + -0.00018532620123181963i, -0.0011186159350597634 + 0.0005020783996022636i, 0.14282870005871512 + -2.1277467635028025e-18i, 0.0019709244504175338 + -0.003419262355443752i, 7.176999839666017e-06 + -0.00018229634629276544i, -0.000977849101137403 + 0.0006606228068466416i }, { 0.001408525977442978 + 0.0038510923040183877i, 0.20842958015024618 + 0.03626462015523314i, 0.0003016925796931895 + 0.0004922646802868508i, 0.0001487840356186228 + 0.00019362883253970926i, 0.0019709244504175338 + 0.003419262355443754i, 0.2036176185389071 + 6.305988238740855e-18i, 0.00036728066679932647 + 0.0004169968003405974i, 0.00017302292934371196 + 0.00015905434788820137i }, { -2.5120658651141877e-05 + 0.00018788267129474646i, 0.00045022816005024823 + -0.00036143814408224137i, 0.029344182901889466 + 0.005105588400339399i, 4.31339238287045e-05 + 0.0006348303173166061i, 7.176999839664702e-06 + 0.00018229634629276533i, 0.00036728066679932625 + -0.00041699680034059717i, 0.028666721087025095 + -2.7316812548951186e-18i, 0.00014563339579515348 + 0.0005948354236404753i }, { -0.0008832999999448493 + -0.0008503913449784325i, 0.00020543969785054005 + -0.00013199751737336842i, 0.0002550161847842042 + -0.0005829552407065845i, 0.05361787326159029 + 0.009328962837047233i, -0.0009778491011374019 + -0.0006606228068466412i, 0.00017302292934371285 + -0.00015905434788819929i, 0.0001456333957951537 + -0.0005948354236404753i, 0.05238001082560385 + 6.005992991625023e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.19127895359375086, 1.0e-7), DoubleNear(0.27268864724920633, 1.0e-7), DoubleNear(0.03839102652503269, 1.0e-7), DoubleNear(0.07014832212175899, 1.0e-7), DoubleNear(0.14282870005871512, 1.0e-7), DoubleNear(0.2036176185389071, 1.0e-7), DoubleNear(0.028666721087025095, 1.0e-7), DoubleNear(0.05238001082560385, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.31127067469695047 + 2.329340604949326e-18i, 0.002157475852436544 + -0.0011653053973429113i, 2.5279901719586165e-05 + -0.00044408976216076115i, -0.0009723886096233312 + 0.0012958112058068963i, 0.08034623884588082 + -0.022395981923379216i, 0.0014584810335166892 + -0.02697633566883422i, -1.2324032725330447e-05 + 8.503025139567537e-05i, -0.003371932623094801 + 0.00252245704376078i }, { 0.002157475852436544 + 0.0011653053973429118i, 0.004784418202768667 + 3.939803354947192e-19i, -0.00033636709139235176 + 0.0007065013947984995i, 1.902604011625984e-05 + -7.678312736230741e-06i, 0.000659242044177971 + 0.00010054094311354114i, 0.023456896643089562 + -0.03819656063210109i, 0.0001114864698301836 + -5.492785723649705e-05i, 7.024224035744655e-05 + -2.8286524053811773e-05i }, { 2.52799017195866e-05 + 0.00044408976216076137i, -0.00033636709139235187 + -0.0007065013947984998i, 0.06403802607793134 + -5.370612402065891e-18i, 0.0009118577598396388 + 0.0009017784406244322i, 5.210479844730282e-05 + 0.00011583954656554495i, -0.006845454578981287 + -0.00023326428064045918i, -0.0048502056315390535 + -0.006240944831519682i, 0.0039112115751150514 + 0.004079968998999249i }, { -0.0009723886096233306 + -0.0012958112058068954i, 1.9026040116259826e-05 + 7.678312736230687e-06i, 0.000911857759839639 + -0.0009017784406244323i, 0.0055365398387943595 + 7.476538141009545e-19i, -0.00036817263194197715 + -0.00023119923571368367i, 0.00015290118006726589 + -0.00010528065112196268i, -0.00022340854144673952 + -3.25536186381523e-06i, 0.020892343885414978 + -0.0018824725821107227i }, { 0.08034623884588082 + 0.022395981923379216i, 0.0006592420441779707 + -0.00010054094311354108i, 5.210479844730293e-05 + -0.00011583954656554479i, -0.0003681726319419771 + 0.00023119923571368384i, 0.022836978955515487 + 3.639065299641288e-19i, 0.00245294868678125 + -0.0068330991413099555i, -8.49132508401568e-06 + 1.7658628192200853e-05i, -0.0013150148931242631 + 0.0002495304226900559i }, { 0.0014584810335166872 + 0.026976335668834207i, 0.023456896643089566 + 0.038196560632101084i, -0.006845454578981288 + 0.00023326428064045918i, 0.00015290118006726686 + 0.00010528065112196203i, 0.002452948686781249 + 0.006833099141309959i, 0.47152184758534477 + 6.129130406332117e-18i, 0.0011955171205236888 + 0.0002689455740887708i, 0.00038571253782598673 + 0.00037974131516014175i }, { -1.232403272533023e-05 + -8.503025139567553e-05i, 0.0001114864698301836 + 5.4927857236496995e-05i, -0.004850205631539049 + 0.0062409448315196864i, -0.0002234085414467395 + 3.2553618638151875e-06i, -8.491325084015775e-06 + -1.76586281922008e-05i, 0.0011955171205236888 + -0.0002689455740887708i, 0.0030197215341264505 + -1.5360413102864703e-19i, -0.0005711893077529277 + 0.0004896720705136697i }, { -0.003371932623094807 + -0.002522457043760777i, 7.024224035744668e-05 + 2.8286524053811556e-05i, 0.003911211575115052 + -0.004079968998999249i, 0.02089234388541498 + 0.0018824725821107256i, -0.0013150148931242627 + -0.00024953042269005676i, 0.00038571253782598673 + -0.0003797413151601387i, -0.0005711893077529275 + -0.0004896720705136693i, 0.11699179310856848 + 1.0406646789966334e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.31127067469695047, 1.0e-7), DoubleNear(0.004784418202768667, 1.0e-7), DoubleNear(0.06403802607793134, 1.0e-7), DoubleNear(0.0055365398387943595, 1.0e-7), DoubleNear(0.022836978955515487, 1.0e-7), DoubleNear(0.47152184758534477, 1.0e-7), DoubleNear(0.0030197215341264505, 1.0e-7), DoubleNear(0.11699179310856848, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.07741646455463397 + 2.927345865710862e-18i, 0.00024322822492676326 + -0.0007280338073136467i, 0.009085109686577286 + 0.0003030631881760197i, 3.1393778611013285e-05 + -8.448530311100021e-05i, -0.003652807503697407 + 0.007972302459095863i, 0.04689420260978458 + 0.048853277433694206i, -0.0004598797999910673 + 0.0009212796169122235i, 0.005311962341968681 + 0.0059166908902245725i }, { 0.00024322822492676342 + 0.0007280338073136469i, 0.09573913635682044 + 3.93298573233853e-18i, 2.5693692769746533e-05 + 8.638964017223811e-05i, 0.011235343283934923 + 0.0003747911773604738i, -0.03979980920383731 + -9.946499999667895e-05i, -0.0025903744068152624 + 0.007001162406129316i, -0.004670266073524244 + -0.00016747739096129236i, -0.0003313975956219662 + 0.0008114718442430714i }, { 0.009085109686577286 + -0.00030306318817601905i, 2.5693692769746523e-05 + -8.638964017223813e-05i, 0.005257127464312657 + 9.428535494124431e-20i, 1.651692296612329e-05 + -4.943866327912265e-05i, -0.0003974612585540058 + 0.0009498789980447105i, 0.005694455396826654 + 0.0055495362640955535i, -0.0002480515580246236 + 0.0005413759263307959i, 0.0031844492237560356 + 0.0033174843102930928i }, { 3.139377861101329e-05 + 8.448530311100028e-05i, 0.011235343283934923 + -0.00037479117736047236i, 1.651692296612329e-05 + 4.943866327912263e-05i, 0.006501366938499491 + 3.9232762863083826e-19i, -0.004671044827247612 + 0.00014413221651697196i, -0.00027658252205987487 + 0.0008317529854916488i, -0.0027026895537478088 + -6.754379526739756e-06i, -0.0001759048093356257 + 0.00047542862334408416i }, { -0.003652807503697409 + -0.00797230245909586i, -0.0397998092038373 + 9.94649999966848e-05i, -0.00039746125855400627 + -0.0009498789980447107i, -0.004671044827247612 + -0.0001441322165169711i, 0.29823924737358504 + -4.750160768202116e-18i, 0.004393029928464956 + -0.00545879090653178i, 0.03499948351838149 + 0.0011675208583630018i, 0.0005369079765055308 + -0.0006234119416806895i }, { 0.04689420260978458 + -0.048853277433694206i, -0.00259037440681526 + -0.0070011624061293186i, 0.005694455396826653 + -0.005549536264095554i, -0.000276582522059875 + -0.0008317529854916488i, 0.004393029928464956 + 0.005458790906531783i, 0.46501619500061026 + 1.2522535092207576e-17i, 0.000494168784390854 + 0.0006578068385164577i, 0.05457137783182937 + 0.0018204046312514145i }, { -0.00045987979999106743 + -0.0009212796169122235i, -0.004670266073524244 + 0.0001674773909612928i, -0.00024805155802462363 + -0.0005413759263307958i, -0.0027026895537478083 + 6.75437952674028e-06i, 0.03499948351838149 + -0.0011675208583630053i, 0.000494168784390854 + -0.000657806838516457i, 0.02025256187199213 + -1.1024398506310736e-18i, 0.00029831791494666215 + -0.00037069065039021647i }, { 0.005311962341968681 + -0.005916690890224571i, -0.0003313975956219663 + -0.0008114718442430717i, 0.003184449223756035 + -0.0033174843102930923i, -0.00017590480933562575 + -0.0004754286233440844i, 0.0005369079765055308 + 0.0006234119416806897i, 0.05457137783182937 + -0.001820404631251409i, 0.0002983179149466622 + 0.00037069065039021664i, 0.031577900439546065 + 8.295628927171804e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.07741646455463397, 1.0e-7), DoubleNear(0.09573913635682044, 1.0e-7), DoubleNear(0.005257127464312657, 1.0e-7), DoubleNear(0.006501366938499491, 1.0e-7), DoubleNear(0.29823924737358504, 1.0e-7), DoubleNear(0.46501619500061026, 1.0e-7), DoubleNear(0.02025256187199213, 1.0e-7), DoubleNear(0.031577900439546065, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.21356258823255755 + -2.371692252312041e-18i, 0.004586699125077788 + -0.008082349310208129i, 0.025062363028382273 + 0.0008360360969365278i, 0.0005699062525572641 + -0.0009305381066269684i, 0.008705393373774708 + -0.022515664855027352i, 0.008003619136169312 + 0.0038740622120704235i, 0.0011097526002338107 + -0.002608217796634937i, 0.0009240885967611995 + 0.00048596745767288i }, { 0.004586699125077788 + 0.008082349310208133i, 0.314470096262698 + 9.637434994741022e-18i, 0.0005066261075908065 + 0.0009664493218457739i, 0.0369042339266075 + 0.0012310599626018234i, -0.008265926605996093 + 0.003524027705091261i, 0.0129948662855434 + -0.02982792799687943i, -0.0009838327465141075 + 0.0003811990167546693i, 0.0016417635867663524 + -0.0034495469859657413i }, { 0.025062363028382273 + -0.0008360360969365296i, 0.0005066261075908066 + -0.0009664493218457734i, 0.014502415660621507 + -3.2586945667649036e-19i, 0.00031146942810813145 + -0.0005488488886608588i, 0.0009334678986752228 + -0.002676376018154358i, 0.0009544202749626428 + 0.00042330372467220076i, 0.0005911580030966041 + -0.0015289734653678177i, 0.0005435025509975378 + 0.0002630763232433375i }, { 0.000569906252557264 + 0.0009305381066269686i, 0.0369042339266075 + -0.0012310599626018197i, 0.0003114694281081315 + 0.0005488488886608589i, 0.02135475172210919 + 4.056948673296952e-19i, -0.0009562416371120016 + 0.00044591646632702146i, 0.001408228071874955 + -0.0035512893124611225i, -0.000561315090121532 + 0.0002393064955886704i, 0.0008824436615364864 + -0.002025528036936802i }, { 0.00870539337377471 + 0.02251566485502735i, -0.008265926605996092 + -0.003524027705091261i, 0.000933467898675222 + 0.0026763760181543585i, -0.0009562416371120016 + -0.0004459164663270217i, 0.16209312369566142 + 5.488773498207866e-19i, 4.955902831393054e-05 + 0.0018955245963627025i, 0.019022230176576508 + 0.0006345479496024923i, -1.6044974407199294e-06 + 0.00022264086183527868i }, { 0.008003619136169312 + -0.003874062212070423i, 0.012994866285543409 + 0.02982792799687943i, 0.0009544202749626427 + -0.00042330372467220065i, 0.0014082280718749544 + 0.0035512893124611243i, 4.955902831393108e-05 + -0.0018955245963627023i, 0.24628523509473266 + 6.818085829805084e-18i, 1.3236369569794072e-05 + -0.0002222528431570781i, 0.028902487189156795 + 0.0009641358460100643i }, { 0.0011097526002338107 + 0.0026082177966349385i, -0.0009838327465141075 + -0.0003811990167546693i, 0.0005911580030966041 + 0.0015289734653678175i, -0.000561315090121532 + -0.0002393064955886704i, 0.019022230176576508 + -0.0006345479496024941i, 1.3236369569793923e-05 + 0.00022225284315707816i, 0.011007273675683282 + -6.822850390133389e-19i, 3.365409804653976e-06 + 0.00012871957499151958i }, { 0.0009240885967611995 + -0.00048596745767288i, 0.0016417635867663526 + 0.0034495469859657413i, 0.0005435025509975378 + -0.0002630763232433375i, 0.0008824436615364868 + 0.0020255280369368017i, -1.6044974407197939e-06 + -0.0002226408618352787i, 0.028902487189156795 + -0.0009641358460100607i, 3.3654098046540166e-06 + -0.00012871957499151958i, 0.016724515655936363 + 8.161956540183235e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.21356258823255755, 1.0e-7), DoubleNear(0.314470096262698, 1.0e-7), DoubleNear(0.014502415660621507, 1.0e-7), DoubleNear(0.02135475172210919, 1.0e-7), DoubleNear(0.16209312369566142, 1.0e-7), DoubleNear(0.24628523509473266, 1.0e-7), DoubleNear(0.011007273675683282, 1.0e-7), DoubleNear(0.016724515655936363, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.22848601116340736 + 2.0464316005663896e-18i, 0.002819922867017967 + -0.003763027835721674i, -0.01526451889328873 + -0.006124933216912735i, -0.0002892652365536879 + 0.00017580494338573284i, 0.180417054742245 + -0.03280097940607625i, 0.0016864541411601415 + -0.0033761831938589697i, 0.07444964795559261 + -0.003916214728932098i, 0.0008543430675770009 + -0.0012744741772159696i }, { 0.002819922867017967 + 0.0037630278357216763i, 0.3410696146288238 + 5.3343488040115666e-18i, -8.751726896633847e-05 + -0.00032699003475640564i, -0.02278591827096584 + -0.00914291689579932i, 0.002766879134493529 + 0.002566538599716804i, 0.2693152855182754 + -0.04896324877183599i, 0.0009833384923786997 + 0.0011778080976600517i, 0.11113377404669861 + -0.005845880198964716i }, { -0.01526451889328873 + 0.006124933216912736i, -8.751726896633855e-05 + 0.00032699003475640564i, 0.00118396895537618 + -1.7972980349552185e-20i, 1.4612278073850704e-05 + -1.949925998981424e-05i, -0.01117388202224365 + 0.007027710682044276i, -2.2163345949144404e-05 + 0.00027076157014099i, -0.004868794804875131 + 0.0022573734507613107i, -2.2911978932958727e-05 + 0.00010804613054716836i }, { -0.00028926523655368796 + -0.00017580494338573298i, -0.02278591827096584 + 0.009142916895799323i, 1.4612278073850706e-05 + 1.9499259989814248e-05i, 0.0017673547421415048 + 3.1081311516680015e-20i, -0.000253647722461088 + -9.729272665096085e-05i, -0.016679671616784464 + 0.010490526583412934i, -9.726715794441088e-05 + -5.232614155713302e-05i, -0.0072678321064389515 + 0.003369665779555625i }, { 0.180417054742245 + 0.032800979406076236i, 0.002766879134493529 + -0.0025665385997168033i, -0.011173882022243647 + -0.007027710682044276i, -0.00025364772246108794 + 9.729272665096083e-05i, 0.14716970076481162 + -3.869246503057644e-18i, 0.0018163352863737523 + -0.0024237968781237523i, 0.05934911209824751 + 0.007595517263451755i, 0.000857566991670232 + -0.0008837021881774225i }, { 0.001686454141160141 + 0.003376183193858971i, 0.2693152855182754 + 0.048963248771836i, -2.216334594914433e-05 + -0.00027076157014099003i, -0.016679671616784464 + -0.010490526583412936i, 0.0018163352863737523 + 0.002423796878123754i, 0.2196857167286069 + 1.112117202053454e-17i, 0.0006073797461269391 + 0.0010711865134451013i, 0.08859263938673013 + 0.011338112704411209i }, { 0.07444964795559261 + 0.003916214728932096i, 0.0009833384923786995 + -0.0011778080976600515i, -0.004868794804875131 + -0.0022573734507613102i, -9.726715794441086e-05 + 5.2326141557133006e-05i, 0.05934911209824752 + -0.007595517263451761i, 0.000607379746126939 + -0.001071186513445101i, 0.024325720380928607 + -9.901815153402771e-19i, 0.0003002225598389347 + -0.00040063005367952493i }, { 0.0008543430675770009 + 0.0012744741772159702i, 0.11113377404669861 + 0.005845880198964719i, -2.2911978932958704e-05 + -0.00010804613054716836i, -0.007267832106438951 + -0.0033696657795556258i, 0.0008575669916702322 + 0.000883702188177423i, 0.08859263938673013 + -0.0113381127044112i, 0.00030022255983893476 + 0.00040063005367952504i, 0.036311912635904046 + 1.1908092098313386e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.22848601116340736, 1.0e-7), DoubleNear(0.3410696146288238, 1.0e-7), DoubleNear(0.00118396895537618, 1.0e-7), DoubleNear(0.0017673547421415048, 1.0e-7), DoubleNear(0.14716970076481162, 1.0e-7), DoubleNear(0.2196857167286069, 1.0e-7), DoubleNear(0.024325720380928607, 1.0e-7), DoubleNear(0.036311912635904046, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.35144321204678886 + -2.0735366548785272e-18i, 0.002874157890063252 + -0.00024676955247464316i, 0.04124316640415474 + 0.0013757990747634199i, 0.00033825913655103024 + -1.7707822308114394e-05i, 0.07069531922616984 + -0.026815934459049614i, 0.00502823945777209 + -0.021440410600750942i, 0.00840133498513652 + -0.002870197681501181i, 0.0006740156179552438 + -0.0024964277155242877i }, { 0.0028741578900632527 + 0.00024676955247464354i, 0.009664659087407448 + 1.0598499752519433e-18i, 0.0003363270729325747 + 4.0210824957353646e-05i, 0.0011341836442363968 + 3.7834360074619634e-05i, 0.0004081193049913915 + 9.109929263470667e-05i, 0.041529118592223156 + -0.03753044930600029i, 4.7537688916197576e-05 + 1.2288510062499868e-05i, 0.005020517243373826 + -0.0042417630840930155i }, { 0.04124316640415475 + -0.0013757990747634242i, 0.00033632707293257456 + -4.021082495735351e-05i, 0.023865488728093024 + -9.677351422380381e-19i, 0.00019517572221293075 + -1.675740424383585e-05i, 0.008191381646713444 + -0.003423701356903057i, 0.0005061495385663842 + -0.002535795937510437i, 0.004800713988171935 + -0.0018209922958492876i, 0.0003414531508596506 + -0.0014559560690840297i }, { 0.00033825913655103035 + 1.7707822308114388e-05i, 0.001134183644236397 + -3.783436007461931e-05i, 0.00019517572221293078 + 1.6757404243835863e-05i, 0.0006562989541555774 + 8.17841743437304e-20i, 4.825094396408136e-05 + 9.093170713475866e-06i, 0.004726675418232662 + -0.004566912189134284i, 2.7714197739839964e-05 + 6.186288615019235e-06i, 0.002820121936281388 + -0.0025485839082115247i }, { 0.07069531922616984 + 0.026815934459049617i, 0.0004081193049913913 + -9.109929263470667e-05i, 0.00819138164671344 + 0.0034237013569030574i, 4.825094396408135e-05 + -9.093170713475863e-06i, 0.024212499881430174 + 2.507217523872729e-19i, 0.0017621002633284668 + -0.0059400551613707836i, 0.002841426800804037 + 9.478497177559976e-05i, 0.00023004261856551382 + -0.0006901894224835753i }, { 0.005028239457772089 + 0.021440410600750935i, 0.04152911859222316 + 0.03753044930600029i, 0.0005061495385663842 + 0.0025357959375104364i, 0.0047266754182326625 + 0.004566912189134284i, 0.0017621002633284666 + 0.005940055161370786i, 0.5510906722700233 + 1.5395670849294163e-17i, 0.000183535404228026 + 0.0007039856537313421i, 0.0646725374715279 + 0.00215736144853727i }, { 0.008401334985136523 + 0.002870197681501182i, 4.753768891619754e-05 + -1.2288510062499871e-05i, 0.004800713988171935 + 0.0018209922958492876i, 2.7714197739839957e-05 + -6.1862886150192305e-06i, 0.002841426800804037 + -9.478497177560003e-05i, 0.00018353540422802597 + -0.0007039856537313417i, 0.0016442006082117626 + -4.0419353451791144e-20i, 0.00011965911569985466 + -0.0004033719094255033i }, { 0.0006740156179552434 + 0.002496427715524287i, 0.005020517243373825 + 0.0042417630840930155i, 0.00034145315085965054 + 0.001455956069084029i, 0.0028201219362813876 + 0.0025485839082115247i, 0.00023004261856551393 + 0.0006901894224835756i, 0.0646725374715279 + -0.0021573614485372594i, 0.0001196591156998547 + 0.00040337190942550346i, 0.03742296842388997 + 1.1401063470042883e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.35144321204678886, 1.0e-7), DoubleNear(0.009664659087407448, 1.0e-7), DoubleNear(0.023865488728093024, 1.0e-7), DoubleNear(0.0006562989541555774, 1.0e-7), DoubleNear(0.024212499881430174, 1.0e-7), DoubleNear(0.5510906722700233, 1.0e-7), DoubleNear(0.0016442006082117626, 1.0e-7), DoubleNear(0.03742296842388997, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.04880872968583624 + 8.339568761310621e-19i, 9.149920283551902e-05 + -0.0014305799811391983i, -0.005216131022889871 + 0.00935737361329744i, 0.02755234263770957 + 0.029725869887591908i, 0.0019158663565999887 + -0.006537295695212815i, 0.001691443355595564 + -4.0576486364324844e-05i, -0.008206389254410418 + -0.005565770898713913i, 0.004345628743911341 + -0.0009896742740931974i }, { 9.149920283551931e-05 + 0.001430579981139198i, 0.0536623102862187 + 2.257732406501223e-18i, -0.023977394543170435 + -0.0008747777144850056i, -0.006528233373964869 + 0.010626952907088627i, -0.0017061390628425215 + -8.456386365736264e-05i, 0.0023693072450567186 + -0.0022240814379013334i, -0.0017038354650491811 + 0.0023826797125856684i, -0.01115413108174488 + -0.008600899364925304i }, { -0.005216131022889873 + -0.00935737361329744i, -0.02397739454317043 + 0.0008747777144850079i, 0.17925627420734283 + -3.5315185851195934e-18i, 0.004806669350350401 + -0.00720061821772979i, 0.008427089749675685 + -0.0050840890418556i, -0.0002660585592101902 + 0.0023876027389276517i, 0.007380685020271323 + -0.017507342625182352i, 0.006855678331571285 + 0.004177715021678086i }, { 0.027552342637709566 + -0.029725869887591905i, -0.006528233373964867 + -0.01062695290708863i, 0.0048066693503504 + 0.007200618217729793i, 0.2821625376985885 + 7.785397455569495e-18i, -0.0020245972781495307 + -0.003407670269733317i, 0.011310639990010075 + -0.008177893222690524i, -0.007121102633275103 + 0.0038478980643372935i, 0.011508002702023169 + -0.029629374595914897i }, { 0.0019158663565999891 + 0.006537295695212813i, -0.0017061390628425217 + 8.456386365736293e-05i, 0.008427089749675683 + 0.005084089041855598i, -0.0020245972781495316 + 0.0034076702697333184i, 0.033864862333110396 + 2.1876743445210442e-18i, 0.0001682459450573675 + 0.0006531075105464287i, 0.0013152719611678396 + -0.0008436952278707795i, 0.022526309195831047 + 0.02244489185639539i }, { 0.0016914433555955634 + 4.0576486364324505e-05i, 0.0023693072450567195 + 0.0022240814379013325i, -0.00026605855921019064 + -0.0023876027389276512i, 0.011310639990010071 + 0.008177893222690526i, 0.00016824594505736746 + -0.0006531075105464284i, 0.04857819300910121 + 2.0675809544681454e-18i, -0.01852510421441468 + 0.0007685583349615868i, 0.003761954157813981 + -0.003150361877615226i }, { -0.008206389254410418 + 0.005565770898713914i, -0.0017038354650491811 + -0.002382679712585667i, 0.007380685020271325 + 0.01750734262518235i, -0.0071211026332751014 + -0.003847898064337294i, 0.0013152719611678396 + 0.0008436952278707801i, -0.018525104214414674 + -0.000768558334961583i, 0.1392355350382343 + -2.3210820337135965e-18i, -0.00011532150693878288 + 0.0013711366608077933i }, { 0.00434562874391134 + 0.0009896742740931968i, -0.01115413108174488 + 0.008600899364925304i, 0.006855678331571286 + -0.004177715021678085i, 0.011508002702023174 + 0.0296293745959149i, 0.022526309195831047 + -0.02244489185639539i, 0.0037619541578139807 + 0.0031503618776152257i, -0.00011532150693878244 + -0.0013711366608077933i, 0.2144315577415678 + 5.566700529355262e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.04880872968583624, 1.0e-7), DoubleNear(0.0536623102862187, 1.0e-7), DoubleNear(0.17925627420734283, 1.0e-7), DoubleNear(0.2821625376985885, 1.0e-7), DoubleNear(0.033864862333110396, 1.0e-7), DoubleNear(0.04857819300910121, 1.0e-7), DoubleNear(0.1392355350382343, 1.0e-7), DoubleNear(0.2144315577415678, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.04733120597012718 + 2.0543195948876953e-18i, 0.00014870590226492015 + -0.0004451083924513248i, -0.0022332689218159236 + 0.0048741400413774266i, 0.028670376195779553 + 0.02986812365860666i, 0.0361776094746722 + -0.006294534896522946i, 5.446879488610734e-05 + -0.0003599948857817545i, -0.0010587916639186803 + 0.004022549609736768i, 0.025886338517106682 + 0.019016853924440483i }, { 0.00014870590226492025 + 0.00044510839245132485i, 0.05853339865590021 + 2.0523666214614576e-18i, -0.024332975909396894 + -6.081133294764616e-05i, -0.0015837140754754381 + 0.004280400322866237i, 0.00017285793167625825 + 0.000320442354975071i, 0.0447400059726974 + -0.007784304517493011i, -0.018606998507917884 + 0.0031895396334971323i, -0.0006412653030197184 + 0.0034823409083245766i }, { -0.0022332689218159244 + -0.004874140041377426i, -0.02433297590939689 + 6.08113329476502e-05i, 0.18233877414865635 + -2.5860974670857857e-20i, 0.0026858292428268973 + -0.003337418703260164i, -0.002355206743659256 + -0.0034285487228562284i, -0.018590824017980543 + 0.0032825019238052547i, 0.13937065046269767 + -0.024249071058791993i, 0.0016090733673410752 + -0.002908142177530047i }, { 0.028670376195779553 + -0.02986812365860666i, -0.0015837140754754373 + -0.004280400322866239i, 0.0026858292428268973 + 0.0033374187032601654i, 0.28430357071506507 + 3.313063494066789e-18i, 0.017942068228222807 + -0.026642549478222727i, -0.0017797585508095438 + -0.003061107461600805i, 0.0024967540448728597 + 0.0021937701031846005i, 0.21730744743913907 + -0.03780927847478735i }, { 0.0361776094746722 + 0.006294534896522949i, 0.0001728579316762582 + -0.0003204423549750709i, -0.0023552067436592556 + 0.003428548722856228i, 0.017942068228222807 + 0.026642549478222727i, 0.03534238604881945 + 9.67311625764411e-19i, 0.0001110392456279664 + -0.00033236407814144463i, -0.001667590139906107 + 0.0036395383440492317i, 0.02140827563776106 + 0.02230263808538064i }, { 5.44687948861074e-05 + 0.00035999488578175457i, 0.0447400059726974 + 0.007784304517493015i, -0.018590824017980543 + -0.003282501923805254i, -0.001779758550809543 + 0.0030611074616008023i, 0.00011103924562796646 + 0.00033236407814144463i, 0.0437071046394197 + 2.2729467395079107e-18i, -0.01816952284818822 + -4.5408046575772545e-05i, -0.0011825651406754498 + 0.0031961907066071623i }, { -0.001058791663918681 + -0.004022549609736767i, -0.01860699850791788 + -0.0031895396334971297i, 0.1393706504626977 + 0.02424907105879198i, 0.0024967540448728597 + -0.002193770103184599i, -0.0016675901399061082 + -0.0036395383440492317i, -0.01816952284818822 + 4.540804657577482e-05i, 0.1361530350969208 + -5.826739644162332e-18i, 0.0020055186005847204 + -0.002492062853661833i }, { 0.02588633851710668 + -0.019016853924440483i, -0.0006412653030197177 + -0.003482340908324577i, 0.001609073367341075 + 0.0029081421775300487i, 0.21730744743913907 + 0.037809278474787364i, 0.02140827563776106 + -0.02230263808538064i, -0.0011825651406754487 + -0.0031961907066071645i, 0.0020055186005847204 + 0.0024920628536618337i, 0.21229052472509125 + 1.0039034490857968e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.04733120597012718, 1.0e-7), DoubleNear(0.05853339865590021, 1.0e-7), DoubleNear(0.18233877414865635, 1.0e-7), DoubleNear(0.28430357071506507, 1.0e-7), DoubleNear(0.03534238604881945, 1.0e-7), DoubleNear(0.0437071046394197, 1.0e-7), DoubleNear(0.1361530350969208, 1.0e-7), DoubleNear(0.21229052472509125, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.07606440177128339 + 2.9997671827011047e-18i, 9.194990473458693e-06 + -1.4646685573387284e-05i, -0.0036894044384645323 + 0.007905640201387143i, 0.0030012549224584387 + 0.02099082918245976i, 0.021506575547885397 + -7.208139397225702e-05i, 0.0005052496239161416 + -0.004052233139727095i, -0.0005880488777986415 + 0.002429969730480066i, 0.15752758705360242 + 0.10375685661550418i }, { 9.194990473458677e-06 + 1.4646685573387064e-05i, 8.056875022298126e-05 + -1.995366432631041e-19i, -0.0032224764035007126 + -0.00019203846707773912i, -2.974682873971388e-05 + -2.9547677325290663e-05i, -1.0250109726983784e-05 + -2.7696863842863104e-06i, 0.000654504823963647 + -0.002187888158385635i, -0.00010281623242472762 + 0.0005244005827894585i, -4.29873070178672e-05 + -3.281704071697037e-05i }, { -0.0036894044384645345 + -0.007905640201387142i, -0.0032224764035007143 + 0.00019203846707773815i, 0.29924429900359845 + -6.04103897981767e-18i, 0.003060138621802724 + -0.0002488802711450917i, -0.0005730753400168389 + -0.0020254613619219135i, -0.0991225717259547 + 0.10489043834903244i, 0.05398945766645639 + -0.028564845360926645i, 0.004864442984715599 + -0.018844133530107877i }, { 0.003001254922458436 + -0.020990829182459765i, -2.9746828739713874e-05 + 2.954767732529068e-05i, 0.0030601386218027243 + 0.0002488802711450923i, 0.010240389291340045 + 1.3411707928587778e-18i, 0.0022188492911253497 + -0.006533394555560935i, -0.0003939384991528293 + 0.0005898976211838863i, 0.00044608361245821517 + 0.00010005526763401223i, 0.043694735704540896 + -0.03789114505582618i }, { 0.021506575547885397 + 7.208139397225687e-05i, -1.0250109726983821e-05 + 2.769686384286313e-06i, -0.0005730753400168389 + 0.0020254613619219127i, 0.002218849291125351 + 0.006533394555560936i, 0.006609190247663242 + 2.1864037951001628e-20i, 0.00025055015741942785 + -0.0007628257850193821i, -0.00021145462325749843 + 0.0006080381840395158i, 0.047077396911082176 + 0.03117993256152754i }, { 0.0005052496239161412 + 0.004052233139727094i, 0.0006545048239636509 + 0.0021878881583856325i, -0.0991225717259547 + -0.10489043834903244i, -0.0003939384991528296 + -0.0005898976211838864i, 0.00025055015741942807 + 0.0007628257850193825i, 0.10215993454509693 + 4.5248500042324724e-18i, -0.0392800223540844 + 8.58190875543204e-05i, -0.002736532387411174 + 0.007506138706798691i }, { -0.0005880488777986416 + -0.002429969730480066i, -0.00010281623242472729 + -0.0005244005827894584i, 0.05398945766645638 + 0.028564845360926648i, 0.00044608361245821506 + -0.00010005526763401222i, -0.00021145462325749837 + -0.0006080381840395156i, -0.0392800223540844 + -8.581908755431314e-05i, 0.019247510241978696 + 1.8843836098448013e-19i, 0.0016312092216088938 + -0.005580601285776905i }, { 0.15752758705360242 + -0.10375685661550416i, -4.298730701786758e-05 + 3.281704071697045e-05i, 0.004864442984715598 + 0.018844133530107866i, 0.043694735704540896 + 0.03789114505582618i, 0.047077396911082176 + -0.031179932561527533i, -0.0027365323874111724 + -0.007506138706798695i, 0.0016312092216088933 + 0.005580601285776907i, 0.48635370614881623 + 1.2010927192065979e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.07606440177128339, 1.0e-7), DoubleNear(8.056875022298126e-05, 1.0e-7), DoubleNear(0.29924429900359845, 1.0e-7), DoubleNear(0.010240389291340045, 1.0e-7), DoubleNear(0.006609190247663242, 1.0e-7), DoubleNear(0.10215993454509693, 1.0e-7), DoubleNear(0.019247510241978696, 1.0e-7), DoubleNear(0.48635370614881623, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.13056879966425164 + -3.1824616015120166e-19i, 0.0028042355364710876 + -0.0049414209512758985i, 0.0053223402695473186 + -0.013765722536393755i, 0.004893286564037568 + 0.0023685405624689687i, 0.09980026806862521 + -0.017364228293749038i, 0.0014862623940246102 + -0.0041499081175235455i, 0.0022374398604730317 + -0.011229643946778865i, 0.004055173910143811 + 0.0011596402697312041i }, { 0.0028042355364710876 + 0.0049414209512759i, 0.19226205928264062 + 1.9844120797790013e-18i, -0.005053657215853018 + 0.0021545349831417096i, 0.007944856384926452 + -0.018236324944625966i, 0.0028005727302474748 + 0.003404042548261375i, 0.1469555139143005 + -0.025568759904316733i, -0.0035762334398083346 + 0.0023189002830213985i, 0.0036474187449798716 + -0.014995515185280563i }, { 0.005322340269547321 + 0.013765722536393753i, -0.005053657215853017 + -0.0021545349831417096i, 0.0991011804545319 + 2.346704780368039e-18i, 3.029960862072984e-05 + 0.0011588938555644101i, 0.005898822202426067 + 0.009814017369295108i, -0.004149292814028566 + -0.0009747375452146005i, 0.07574799186874466 + -0.013179377661565902i, 0.00017727976820257265 + 0.0008817710542117438i }, { 0.004893286564037568 + -0.0023685405624689687i, 0.007944856384926459 + 0.018236324944625966i, 3.029960862073011e-05 + -0.00115889385556441i, 0.15057491008832471 + 3.3810180357492453e-18i, 0.003425193713412688 + -0.002461147907439028i, 0.00849788394634105 + 0.012882356446230231i, -0.00013096075369835672 + -0.0008898300901017035i, 0.11509193949753595 + -0.020024823087963634i }, { 0.09980026806862523 + 0.01736422829374903i, 0.0028005727302474748 + -0.003404042548261374i, 0.005898822202426067 + -0.009814017369295108i, 0.0034251937134126874 + 0.0024611479074390275i, 0.09749620422892742 + -2.3793155488373297e-18i, 0.0020939330167148323 + -0.0036897772475930892i, 0.003974211107323994 + -0.01027891578400141i, 0.003653835123129281 + 0.0017685979728447921i }, { 0.0014862623940246093 + 0.004149908117523546i, 0.1469555139143005 + 0.025568759904316743i, -0.0041492928140285665 + 0.0009747375452146003i, 0.008497883946341047 + -0.012882356446230231i, 0.0020939330167148323 + 0.00368977724759309i, 0.14356278870216665 + 8.058717782291716e-18i, -0.0037735844802646067 + 0.0016087992175382215i, 0.005932453562153434 + -0.013617131089190266i }, { 0.002237439860473031 + 0.011229643946778865i, -0.0035762334398083337 + -0.0023189002830213993i, 0.07574799186874466 + 0.0131793776615659i, -0.000130960753698357 + 0.0008898300901017035i, 0.0039742111073239935 + 0.010278915784001412i, -0.0037735844802646067 + -0.0016087992175382215i, 0.07399921691681281 + -2.4801124695605914e-18i, 2.2624829497854687e-05 + 0.0008653503157898118i }, { 0.004055173910143811 + -0.0011596402697312037i, 0.003647418744979875 + 0.014995515185280561i, 0.00017727976820257297 + -0.0008817710542117438i, 0.11509193949753595 + 0.020024823087963634i, 0.0036538351231292813 + -0.001768597972844792i, 0.005932453562153435 + 0.013617131089190269i, 2.2624829497854904e-05 + -0.0008653503157898118i, 0.1124348406623443 + 4.253263448074162e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.13056879966425164, 1.0e-7), DoubleNear(0.19226205928264062, 1.0e-7), DoubleNear(0.0991011804545319, 1.0e-7), DoubleNear(0.15057491008832471, 1.0e-7), DoubleNear(0.09749620422892742, 1.0e-7), DoubleNear(0.14356278870216665, 1.0e-7), DoubleNear(0.07399921691681281, 1.0e-7), DoubleNear(0.1124348406623443, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.21309724503620203 + -3.1248104215395207e-18i, 0.0022414195584752614 + -0.0013046086710212478i, 0.008697351785429408 + -0.02226033217977677i, 0.0018255697687848149 + 0.001159859280189123i, 0.04651564569417031 + -0.015980990188009983i, 0.0012931885632163672 + -0.0290692575083447i, 0.00029496744227460906 + -0.008334545280013475i, 0.02858035885190974 + -0.0016214762058979208i }, { 0.0022414195584752614 + 0.0013046086710212482i, 0.00508307762717373 + 5.758426106094028e-19i, -0.0019992247093108236 + 0.0011449496080006994i, 0.00023917645038550045 + 6.771952471103011e-05i, 0.0007187249320189069 + 0.00010753590133123927i, 0.022438540284521327 + -0.02377662625537695i, -0.00010835805525782129 + 0.0008138468918214124i, -0.0022419045577593433 + -0.0011596931481471777i }, { 0.008697351785429411 + 0.022260332179776767i, -0.0019992247093108236 + -0.0011449496080006996i, 0.1622114557386798 + 8.353862442295537e-20i, 0.0008279140538009215 + 0.0010410817143027685i, 0.0032041017661605326 + 0.0070072889412891234i, -0.028884162142260895 + 0.002916893288097488i, 0.028980387520171465 + -0.012655936566888917i, 0.004076504045415374 + 0.0061728908385097325i }, { 0.001825569768784815 + -0.0011598592801891226i, 0.0002391764503855006 + -6.771952471102998e-05i, 0.0008279140538009217 + -0.0010410817143027688i, 0.005237880414389297 + 5.657915389862709e-19i, 8.369972528895647e-05 + -0.0008193510578587533i, 0.004297390857419585 + -0.00069787876726118i, -0.00028289142928767546 + -1.0250320081513352e-05i, 0.021910700243983214 + -0.016302406958834864i }, { 0.04651564569417032 + 0.015980990188009983i, 0.0007187249320189067 + -0.00010753590133123921i, 0.0032041017661605313 + -0.0070072889412891234i, 8.369972528895642e-05 + 0.0008193510578587532i, 0.014967758856977029 + 4.2724871255098943e-19i, 0.002656748994710659 + -0.007326589527847741i, 0.0005991995914419036 + -0.0017843061406183967i, 0.006721551918382034 + 0.0029772792551246378i }, { 0.001293188563216366 + 0.029069257508344697i, 0.022438540284521333 + 0.023776626255376944i, -0.028884162142260892 + -0.0029168932880974893i, 0.004297390857419585 + 0.0006978787672611803i, 0.002656748994710658 + 0.007326589527847743i, 0.3307417703576335 + 9.467287251461315e-18i, -0.006828016986806801 + 0.0026183845926792317i, 0.013638133496694385 + -0.03192117555852726i }, { 0.0002949674422746099 + 0.008334545280013475i, -0.00010835805525782117 + -0.0008138468918214123i, 0.028980387520171465 + 0.01265593656688892i, -0.00028289142928767546 + 1.0250320081513305e-05i, 0.0005991995914419033 + 0.001784306140618397i, -0.0068280169868068005 + -0.0026183845926792317i, 0.01088894163266491 + -2.1694631361550767e-19i, -0.0007749896156823369 + 0.0009831624570514534i }, { 0.02858035885190974 + 0.001621476205897923i, -0.0022419045577593433 + 0.001159693148147177i, 0.004076504045415374 + -0.0061728908385097325i, 0.021910700243983217 + 0.016302406958834864i, 0.006721551918382035 + -0.0029772792551246378i, 0.013638133496694394 + 0.03192117555852726i, -0.0007749896156823367 + -0.000983162457051453i, 0.2577718703362797 + 7.068489944837136e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.21309724503620203, 1.0e-7), DoubleNear(0.00508307762717373, 1.0e-7), DoubleNear(0.1622114557386798, 1.0e-7), DoubleNear(0.005237880414389297, 1.0e-7), DoubleNear(0.014967758856977029, 1.0e-7), DoubleNear(0.3307417703576335, 1.0e-7), DoubleNear(0.01088894163266491, 1.0e-7), DoubleNear(0.2577718703362797, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.21486683939758855 + 1.610633149204052e-18i, 0.0017572148233305888 + -0.00015087101409921345i, 0.16423347864174825 + -0.02857494946457369i, 0.0013230630298742328 + -0.0003490086997930452i, 0.043222003674119575 + -0.016394839579208544i, 0.00307418633506541 + -0.013108329036545976i, 0.03085640540624908 + -0.01827945213707323i, 0.0006064894721855181 + -0.010428185206725326i }, { 0.001757214823330589 + 0.00015087101409921367i, 0.005908820204186941 + 5.661414363853809e-19i, 0.0013631914332671525 + -0.00011837216656910855i, 0.004516406996645 + -0.0007858087325306868i, 0.00024951770913408933 + 5.5696671350617714e-05i, 0.02539024840716127 + -0.02294552504396673i, 0.00019812592321064344 + 9.388615578425936e-06i, 0.016355532620899085 + -0.020915039635520653i }, { 0.16423347864174825 + 0.02857494946457368i, 0.0013631914332671521 + 0.0001183721665691086i, 0.1604418613772933 + -4.6519049463206175e-18i, 0.0013121187889455939 + -0.00011265594261926555i, 0.03521707561268145 + -0.006783340645804684i, 0.004093019462894816 + -0.009610518605257525i, 0.03227402954022221 + -0.012242087175690357i, 0.0022955062735663307 + -0.009788037633288994i }, { 0.001323063029874233 + 0.00034900869979304544i, 0.004516406996645 + 0.0007858087325306878i, 0.001312118788945594 + 0.00011265594261926571i, 0.004412137837376085 + 5.754927132102928e-19i, 0.00018331182184766942 + 7.575489107270601e-05i, 0.022458542470233867 + -0.014161786623918447i, 0.00018631579359714204 + 4.15889098991082e-05i, 0.01895899212134327 + -0.017133508170245084i }, { 0.043222003674119575 + 0.016394839579208544i, 0.00024951770913408933 + -5.569667135061771e-05i, 0.035217075612681455 + 0.006783340645804688i, 0.00018331182184766942 + -7.575489107270603e-05i, 0.014803140721195 + 4.1782547101278534e-19i, 0.0010773203217612287 + -0.0036316560816122756i, 0.011314781295621638 + -0.001968656490741248i, 0.0003404791323529499 + -0.002919128363518756i }, { 0.003074186335065409 + 0.013108329036545976i, 0.025390248407161278 + 0.022945525043966724i, 0.004093019462894814 + 0.009610518605257521i, 0.022458542470233874 + 0.014161786623918447i, 0.0010773203217612284 + 0.0036316560816122764i, 0.3369281491667784 + 4.799288679142866e-18i, 0.0013064205432819658 + 0.00263258462472878i, 0.2575310464151915 + -0.04480777425974968i }, { 0.03085640540624908 + 0.01827945213707323i, 0.00019812592321064335 + -9.388615578425892e-06i, 0.03227402954022221 + 0.01224208717569036i, 0.00018631579359714188 + -4.1588909899108196e-05i, 0.011314781295621638 + 0.001968656490741248i, 0.0013064205432819658 + -0.002632584624728779i, 0.011053559768446937 + -2.0752307207730358e-19i, 0.0008044390572670931 + -0.0027117709891840117i }, { 0.0006064894721855179 + 0.010428185206725324i, 0.016355532620899088 + 0.02091503963552065i, 0.0022955062735663303 + 0.009788037633288988i, 0.018958992121343273 + 0.017133508170245084i, 0.00034047913235294943 + 0.0029191283635187576i, 0.2575310464151915 + 0.04480777425974969i, 0.0008044390572670931 + 0.002711770989184013i, 0.25158549152713483 + 1.1736488517155585e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.21486683939758855, 1.0e-7), DoubleNear(0.005908820204186941, 1.0e-7), DoubleNear(0.1604418613772933, 1.0e-7), DoubleNear(0.004412137837376085, 1.0e-7), DoubleNear(0.014803140721195, 1.0e-7), DoubleNear(0.3369281491667784, 1.0e-7), DoubleNear(0.011053559768446937, 1.0e-7), DoubleNear(0.25158549152713483, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.13213773450513114 + 1.3956985388382734e-18i, -0.00012558464638393862 + -1.0485017064185099e-07i, 0.015506853982820977 + 0.0005172812182506772i, -1.4737414291451464e-05 + -5.039323203977352e-07i, -0.01006209467893681 + 0.017380093032879684i, 0.0003109691002706849 + -0.00238867801606294i, -0.0012488622516722732 + 0.002000228271393376i, 4.584436631906337e-05 + -0.0002791028835945722i }, { -0.0001255846463839387 + 1.0485017064233888e-07i, 0.041017866406323246 + 5.464633059211119e-18i, -1.4738235207962673e-05 + -4.793232063956545e-07i, 0.004813598987691235 + 0.00016057314728581618i, -0.0019264470890752968 + 0.0037677874218497867i, 0.0038189127684241397 + -0.002406628167654505i, -0.0002408255257499476 + 0.00043462236360327256i, 0.00045758485605923975 + -0.0002674768102380811i }, { 0.015506853982820977 + -0.0005172812182506769i, -1.4738235207962706e-05 + 4.793232063955732e-07i, 0.008973090118946772 + -1.524245714751464e-20i, -8.528088920091068e-06 + -7.120070838765551e-09i, -0.0011127861227598463 + 0.002079008683562044i, 2.714239176523686e-05 + -0.00028153759273543636i, -0.0006832876519157269 + 0.0011802316850956182i, 2.111700924332325e-05 + -0.0001622081927130924i }, { -1.473741429145141e-05 + 5.039323203977623e-07i, 0.004813598987691235 + -0.00016057314728581466i, -8.528088920091027e-06 + 7.120070838807056e-09i, 0.002785404283865376 + 5.018554407195972e-19i, -0.0002113259180113517 + 0.00044970533594065095i, 0.00043874234214596585 + -0.0002973767000256844i, -0.00013081943174214213 + 0.00025585951062282976i, 0.0002593312845554776 + -0.00016342713542073813i }, { -0.01006209467893681 + -0.017380093032879684i, -0.0019264470890752968 + -0.003767787421849789i, -0.0011127861227598471 + -0.002079008683562044i, -0.0002113259180113516 + -0.0004497053359406503i, 0.6267428092914342 + 7.83336069620777e-18i, 0.0005203073289753836 + -5.0806068610575366e-05i, 0.0735505967683129 + 0.0024535178019684887i, 6.125888893126103e-05 + -3.925427360555622e-06i }, { 0.00031096910027068663 + 0.002388678016062939i, 0.00381891276842414 + 0.0024066281676545045i, 2.71423917652367e-05 + 0.0002815375927354364i, 0.00043874234214596585 + 0.00029737670002568436i, 0.0005203073289753836 + 5.0806068610577914e-05i, 0.13651263308276104 + -6.098637220230962e-20i, 6.0861106645014514e-05 + 7.999134390649531e-06i, 0.01602026458189798 + 0.0005344076876459254i }, { -0.0012488622516722736 + -0.0020002282713933763i, -0.00024082552574994763 + -0.00043462236360327267i, -0.000683287651915727 + -0.0011802316850956182i, -0.00013081943174214237 + -0.0002558595106228297i, 0.0735505967683129 + -0.0024535178019684896i, 6.086110664501485e-05 + -7.999134390649179e-06i, 0.042560285525067236 + 2.541098841762901e-21i, 3.533256090646325e-05 + -3.450092692594007e-06i }, { 4.5844366319063804e-05 + 0.0002791028835945725i, 0.00045758485605923975 + 0.0002674768102380811i, 2.1117009243323495e-05 + 0.0001622081927130923i, 0.0002593312845554776 + 0.00016342713542073816i, 6.125888893126086e-05 + 3.925427360555649e-06i, 0.01602026458189798 + -0.000534407687645925i, 3.5332560906463034e-05 + 3.450092692594122e-06i, 0.009270176786470958 + -2.754180567556561e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13213773450513114, 1.0e-7), DoubleNear(0.041017866406323246, 1.0e-7), DoubleNear(0.008973090118946772, 1.0e-7), DoubleNear(0.002785404283865376, 1.0e-7), DoubleNear(0.6267428092914342, 1.0e-7), DoubleNear(0.13651263308276104, 1.0e-7), DoubleNear(0.042560285525067236, 1.0e-7), DoubleNear(0.009270176786470958, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.457537229701635 + 5.1197847705602116e-18i, -0.0006351456765419042 + -0.006480051275451615i, 0.05369369347264058 + 0.0017911266335954262i, -4.916916783986934e-05 + -0.0007629445005736383i, 0.01758619248338628 + -0.06832808322056554i, -0.007446850857476603 + 0.0009604870353327223i, 0.002331289803298093 + -0.007949709492819871i, -0.0008776756406246866 + 8.356444256414674e-05i }, { -0.0006351456765419016 + 0.0064800512754516195i, 0.0704954547936206 + 2.14595797186877e-18i, -9.990424106699964e-05 + 0.0007579716753536709i, 0.008272903482349186 + 0.00027596942594292464i, 0.0004701671332131164 + 6.064166511906871e-05i, 0.004114067175931829 + 0.015984490368658753i, 5.4938464890707644e-05 + 8.957093733739489e-06i, 0.0004202263837020701 + 0.0018919447102191903i }, { 0.05369369347264059 + -0.0017911266335954262i, -9.990424106699986e-05 + -0.0007579716753536705i, 0.031070025608215618 + -2.242238486447492e-20i, -4.3130899856986724e-05 + -0.00044004147859645203i, 0.0017963202238446886 + -0.008087399261851647i, -0.0008701555797486375 + 0.0001418690002760398i, 0.0011942273007294652 + -0.004639961860169633i, -0.0005056940327965043 + 6.522388747164283e-05i }, { -4.916916783986923e-05 + 0.0007629445005736384i, 0.008272903482349186 + -0.0002759694259429239i, -4.313089985698667e-05 + 0.00044004147859645225i, 0.00478714177451508 + 1.0224779551767975e-19i, 5.541325423876201e-05 + 5.275955588594913e-06i, 0.0005453757467054892 + 0.0018597339312361664i, 3.1927685706798005e-05 + 4.117999510997129e-06i, 0.00027937436390362553 + 0.001085460357865013i }, { 0.01758619248338629 + 0.06832808322056554i, 0.0004701671332131163 + -6.0641665119069254e-05i, 0.0017963202238446877 + 0.00808739926185165i, 5.541325423876201e-05 + -5.275955588595021e-06i, 0.3013433140949304 + 4.109274464485831e-18i, 0.0010298683591333504 + 0.006429140356670398i, 0.03536375727849327 + 0.0011796723866237392i, 9.56906424796791e-05 + 0.0007585151408926849i }, { -0.007446850857476607 + -0.0009604870353327188i, 0.00411406717593183 + -0.015984490368658753i, -0.0008701555797486383 + -0.00014186900027603915i, 0.000545375746705489 + -0.0018597339312361664i, 0.001029868359133346 + -0.0064291403566704i, 0.10703504469546368 + 3.257688715140039e-18i, 0.0001460271125040515 + -0.0007504518641694171i, 0.012560960087240029 + 0.0004190114089888167i }, { 0.0023312898032980933 + 0.007949709492819871i, 5.493846489070762e-05 + -8.95709373373955e-06i, 0.0011942273007294656 + 0.004639961860169633i, 3.192768570679799e-05 + -4.1179995109971665e-06i, 0.03536375727849328 + -0.001179672386623739i, 0.00014602711250405172 + 0.0007504518641694169i, 0.02046335003579839 + 9.721026558723181e-21i, 6.993537184335892e-05 + 0.0004365842658330192i }, { -0.0008776756406246869 + -8.35644425641463e-05i, 0.0004202263837020699 + -0.0018919447102191908i, -0.0005056940327965047 + -6.522388747164283e-05i, 0.00027937436390362537 + -0.001085460357865013i, 9.569064247967856e-05 + -0.000758515140892685i, 0.012560960087240027 + -0.00041901140898881575i, 6.993537184335865e-05 + -0.00043658426583301923i, 0.007268439295821253 + 1.2418958844626136e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.457537229701635, 1.0e-7), DoubleNear(0.0704954547936206, 1.0e-7), DoubleNear(0.031070025608215618, 1.0e-7), DoubleNear(0.00478714177451508, 1.0e-7), DoubleNear(0.3013433140949304, 1.0e-7), DoubleNear(0.10703504469546368, 1.0e-7), DoubleNear(0.02046335003579839, 1.0e-7), DoubleNear(0.007268439295821253, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.461575807037714 + 5.0378872724725614e-18i, 0.00024008316231398678 + -3.096567518506789e-05i, -0.030836603918711028 + -0.012373278251274268i, -1.686937699162225e-05 + -4.367082241454472e-06i, 0.36446934856971264 + -0.06626286862769573i, 0.0001851290253984156 + -5.8916949485253336e-05i, 0.15039938840807188 + -0.007911337612467857i, 7.769770495224854e-05 + -1.420481199760151e-05i }, { 0.00024008316231398678 + 3.096567518506919e-05i, 0.10797981875451715 + 2.3428931321053947e-18i, -1.5209208024958231e-05 + -8.504544587609842e-06i, -0.007213833245543538 + -0.002894571861437787i, 0.00019401976202486348 + -1.0014735414918554e-05i, 0.08526299169080778 + -0.015501359550216517i, 7.875919867463043e-05 + 5.974835802251906e-06i, 0.03518403359421934 + -0.0018507573154289557i }, { -0.030836603918711028 + 0.01237327825127427i, -1.5209208024958394e-05 + 8.504544587609734e-06i, 0.00239179380524317 + 2.2912902967718867e-22i, 1.2440630804527167e-06 + -1.604579550174845e-07i, -0.022572907574953185 + 0.014197023323989196i, -1.0788595382261429e-05 + 8.898758375959899e-06i, -0.009835691383986059 + 0.004560230917487049i, -4.8099861990180055e-06 + 3.031795563875925e-06i }, { -1.6869376991622196e-05 + 4.367082241454282e-06i, -0.007213833245543539 + 0.002894571861437787i, 1.2440630804527133e-06 + 1.6045795501749381e-07i, 0.0005595298922745149 + 1.2879202137450641e-20i, -1.2693463038418923e-05 + 5.870067039494544e-06i, -0.005280646064074927 + 0.003321213941468015i, -5.421849417179539e-06 + 1.7121041070305456e-06i, -0.0023009355273280237 + 0.0010668083128298868i }, { 0.36446934856971264 + 0.06626286862769573i, 0.00019401976202486435 + 1.001473541492018e-05i, -0.022572907574953182 + -0.014197023323989196i, -1.2693463038418923e-05 + -5.870067039494639e-06i, 0.29730473675885144 + 4.1911719625734815e-18i, 0.00015463952027745852 + -1.9945243596149545e-05i, 0.1198940546698449 + 0.015344077271493433i, 6.339085163143202e-05 + -6.22774394989738e-08i }, { 0.0001851290253984156 + 5.89169494852548e-05i, 0.08526299169080778 + 0.01550135955021652i, -1.078859538226124e-05 + -8.898758375959913e-06i, -0.005280646064074926 + -0.0033212139414680155i, 0.00015463952027745765 + 1.9945243596151632e-05i, 0.06955068073456713 + 3.0607535549034143e-18i, 6.13320794620101e-05 + 1.6024355771863773e-05i, 0.028047696815132753 + 0.003589552696369528i }, { 0.1503993884080719 + 0.007911337612467857i, 7.875919867463108e-05 + -5.974835802251987e-06i, -0.009835691383986059 + -0.004560230917487049i, -5.421849417179566e-06 + -1.7121041070306133e-06i, 0.1198940546698449 + -0.015344077271493436i, 6.133207946201031e-05 + -1.602435577186334e-05i, 0.049141581838770834 + -1.2930487335428929e-20i, 2.556040890591948e-05 + -3.296754808415339e-06i }, { 7.769770495224854e-05 + 1.4204811997601619e-05i, 0.03518403359421934 + 0.0018507573154289577i, -4.8099861990180055e-06 + -3.0317955638759384e-06i, -0.0023009355273280237 + -0.0010668083128298868i, 6.339085163143158e-05 + 6.227743949916353e-08i, 0.028047696815132757 + -0.0035895526963695265i, 2.5560408905919263e-05 + 3.2967548084154645e-06i, 0.011496051178061817 + 2.1355818182649047e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.461575807037714, 1.0e-7), DoubleNear(0.10797981875451715, 1.0e-7), DoubleNear(0.00239179380524317, 1.0e-7), DoubleNear(0.0005595298922745149, 1.0e-7), DoubleNear(0.29730473675885144, 1.0e-7), DoubleNear(0.06955068073456713, 1.0e-7), DoubleNear(0.049141581838770834, 1.0e-7), DoubleNear(0.011496051178061817, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.29595747927796895 + 2.967791688942255e-18i, 4.14885732182577e-05 + -0.0004230406143374417i, 0.03473170955650837 + 0.0011585883926696385i, 6.52492048871671e-06 + -4.94829716895281e-05i, 0.09720240239954842 + -0.05673952598970744i, 5.423524923402483e-05 + 5.3135452920110974e-05i, 0.011629181911367303 + -0.006278074696479107i, 6.156697947197785e-06 + 6.447958175838424e-06i }, { 4.148857321825813e-05 + 0.0004230406143374421i, 0.06515039185622731 + -3.981478368568839e-18i, 3.212755872400528e-06 + 4.98078033476187e-05i, 0.00764564049188277 + 0.0002550450421684011i, 0.0001919698622206229 + 9.887466298268968e-06i, 0.015022035418844585 + -0.007606857775342461i, 2.2489669836362193e-05 + 1.9118376842945184e-06i, 0.0017926703171430435 + -0.00083388606911509i }, { 0.034731709556508374 + -0.0011585883926696402i, 3.2127558724004196e-06 + -4.98078033476187e-05i, 0.020097613621750218 + -2.4447074849820967e-19i, 2.8173686175881783e-06 + -2.8727460559550195e-05i, 0.011184944067622798 + -0.007039113582433044i, 6.572717972389767e-06 + 6.023327378269899e-06i, 0.006600733089421983 + -0.0038530165657728686i, 3.6829583980913904e-06 + 3.6082744217526753e-06i }, { 6.524920488716276e-06 + 4.948297168952807e-05i, 0.00764564049188277 + -0.00025504504216840307i, 2.8173686175880665e-06 + 2.8727460559550215e-05i, 0.004424174060498384 + -6.414802193960981e-19i, 2.2567083008781695e-05 + 4.088241118460124e-07i, 0.0017331129973233062 + -0.0009514999636042983i, 1.3036116293946005e-05 + 6.714291453132821e-07i, 0.00102010283503134 + -0.0005165596382879436i }, { 0.09720240239954842 + 0.05673952598970744i, 0.000191969862220624 + -9.887466298269185e-06i, 0.011184944067622798 + 0.007039113582433042i, 2.256708300878177e-05 + -4.0882411184622923e-07i, 0.4629230645185965 + 6.261267546103788e-18i, 0.0003532341093731876 + 0.0003721296955562243i, 0.0543257411946255 + 0.001812210627549526i, 3.9996554151093056e-05 + 4.5053612008574655e-05i }, { 5.42352492340251e-05 + -5.313545292011114e-05i, 0.015022035418844594 + 0.007606857775342467i, 6.572717972389753e-06 + -6.0233273782698854e-06i, 0.0017331129973233072 + 0.000951499963604299i, 0.0003532341093731863 + -0.00037212969555622125i, 0.11238010763285697 + 9.385125055577648e-18i, 4.2910115564651335e-05 + -4.228799216336477e-05i, 0.013188223077706444 + 0.00043993579276334i }, { 0.011629181911367303 + 0.006278074696479107i, 2.2489669836362268e-05 + -1.9118376842945184e-06i, 0.006600733089421983 + 0.0038530165657728686i, 1.3036116293946009e-05 + -6.714291453133397e-07i, 0.0543257411946255 + -0.0018122106275495252i, 4.29101155646515e-05 + 4.2287992163365094e-05i, 0.03143576202226379 + 2.3176939019245793e-19i, 2.3987103368784018e-05 + 2.5270247796117373e-05i }, { 6.156697947197778e-06 + -6.447958175838421e-06i, 0.0017926703171430444 + 0.0008338860691150906i, 3.6829583980914035e-06 + -3.6082744217526753e-06i, 0.0010201028350313405 + 0.0005165596382879441i, 3.999655415109311e-05 + -4.505361200857463e-05i, 0.013188223077706448 + -0.00043993579276333655i, 2.398710336878391e-05 + -2.5270247796117257e-05i, 0.007631407009837948 + 8.679176033600392e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.29595747927796895, 1.0e-7), DoubleNear(0.06515039185622731, 1.0e-7), DoubleNear(0.020097613621750218, 1.0e-7), DoubleNear(0.004424174060498384, 1.0e-7), DoubleNear(0.4629230645185965, 1.0e-7), DoubleNear(0.11238010763285697, 1.0e-7), DoubleNear(0.03143576202226379, 1.0e-7), DoubleNear(0.007631407009837948, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.0850772315974957 + 7.753767723306692e-19i, -6.888733071559608e-05 + 0.002192986214761811i, -0.011469526609918183 + 0.019811127392863104i, -0.004789468643528466 + -0.0019205744296792414i, 0.00327008268114678 + -0.01270533583586158i, 0.002530175188667985 + 2.112434186213319e-06i, -0.016867422381576826 + -0.01046631799603744i, 0.004319916284123856 + -0.03318300451760883i }, { -6.888733071559652e-05 + -0.00219298621476181i, 0.017393808374559238 + 2.3163125103016157e-18i, -0.008845222403052515 + -0.001984751635909684i, -0.0002748377869365562 + 0.0001731991275229576i, -0.00015974607760388046 + 1.3337142698887684e-07i, 0.001015090920509927 + 0.0039439587027474314i, -0.017625859376477773 + 0.03447304191980867i, -0.0024930979545784745 + -0.003700352267601779i }, { -0.011469526609918183 + -0.019811127392863108i, -0.008845222403052515 + 0.0019847516359096846i, 0.4035300237123549 + 4.3219856133650675e-18i, -0.000609389245683295 + -0.009113078968809878i, 0.017475368263422372 + -0.009416222929097749i, -0.026761791262718115 + -0.052341297654969116i, 0.015510337102968966 + -0.06026270924487359i, -0.010482720078941092 + 0.00102359848861815i }, { -0.004789468643528466 + 0.0019205744296792423i, -0.000274837786936556 + -0.00017319912752295763i, -0.0006093892456832924 + 0.009113078968809881i, 0.05788878819357644 + -6.810674291516609e-20i, 0.002845184621411999 + 0.021855000869511892i, 0.00226236147626339 + -0.0038457593354483755i, 0.0006618408965237949 + 6.462629320307697e-05i, 0.003378350619325527 + 0.013125992023776335i }, { 0.003270082681146781 + 0.012705335835861576i, -0.00015974607760388065 + -1.3337142698874131e-07i, 0.017475368263422365 + 0.009416222929097749i, 0.002845184621411992 + -0.021855000869511886i, 0.056033593026582215 + 6.050793093600895e-19i, -6.522540458843353e-05 + -0.002193098185003291i, 0.0007241442790656466 + -0.0012508026748878054i, 0.005121554753042473 + -0.000630311779096792i }, { 0.002530175188667984 + -2.112434186214078e-06i, 0.001015090920509928 + -0.003943958702747431i, -0.026761791262718115 + 0.05234129765496911i, 0.0022623614762633895 + 0.0038457593354483755i, -6.52254045884332e-05 + 0.002193098185003291i, 0.026409462315629392 + 3.6501759896291e-18i, 0.006787955882235076 + 0.0060083985683823i, 0.004353081839916173 + -0.002743254430598201i }, { -0.016867422381576826 + 0.01046631799603744i, -0.01762585937647777 + -0.03447304191980868i, 0.015510337102968973 + 0.06026270924487359i, 0.0006618408965237949 + -6.462629320307773e-05i, 0.0007241442790656466 + 0.0012508026748878057i, 0.006787955882235077 + -0.006008398568382303i, 0.2657730711041466 + 3.513916181684465e-18i, 0.0011650291355651422 + 0.009058822807506708i }, { 0.00431991628412387 + 0.03318300451760885i, -0.002493097954578475 + 0.003700352267601779i, -0.010482720078941094 + -0.0010235984886181482i, 0.003378350619325527 + -0.013125992023776335i, 0.005121554753042476 + 0.0006303117790967894i, 0.004353081839916173 + 0.0027432544305982004i, 0.0011650291355651387 + -0.00905882280750671i, 0.08789402167565555 + -2.6829768604279963e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.0850772315974957, 1.0e-7), DoubleNear(0.017393808374559238, 1.0e-7), DoubleNear(0.4035300237123549, 1.0e-7), DoubleNear(0.05788878819357644, 1.0e-7), DoubleNear(0.056033593026582215, 1.0e-7), DoubleNear(0.026409462315629392, 1.0e-7), DoubleNear(0.2657730711041466, 1.0e-7), DoubleNear(0.08789402167565555, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.08078692774551377 + 7.462004577646988e-19i, -7.678047297663614e-05 + -6.410374138378794e-08i, -0.0061518060593374335 + 0.010625914885827223i, 0.0001901216055257835 + -0.001460400081881837i, 0.06174949196266812 + -0.010743781516954405i, -5.869568317401213e-05 + 1.0161968970427183e-05i, -0.003289002296298163 + 0.008940041739793582i, -4.88978472752504e-05 + -0.0011415409730689413i }, { -7.67804729766363e-05 + 6.410374138389636e-08i, 0.02507767688051362 + 3.360485758584454e-18i, -0.0011777993801205806 + 0.0023035658311336836i, 0.0023348230620460703 + -0.0014713745215835592i, -5.867863297514799e-05 + 1.0259964365816625e-05i, 0.019168123484701476 + -0.003335057897061553i, -0.0005939018439704653 + 0.00191736513949174i, 0.0015889453293597647 + -0.0014351512217322376i }, { -0.0061518060593374335 + -0.010625914885827224i, -0.0011777993801205821 + -0.002303565831133684i, 0.3831806730974434 + 4.29191594373754e-18i, 0.00031810769837107514 + -3.1062029398701676e-05i, -0.006115264196260583 + -0.007303795330117038i, -0.0012066001774826268 + -0.001604096159869661i, 0.29288416522305843 + -0.05095885619325427i, 0.00023901472237340985 + -6.604712289180379e-05i }, { 0.00019012160552578524 + 0.001460400081881837i, 0.0023348230620460703 + 0.001471374521583559i, 0.00031810769837107514 + 3.1062029398702814e-05i, 0.08346167176627806 + -1.0047134243416087e-18i, 0.00033953676324754295 + 0.0010909727673350605i, 0.0019802989017917833 + 0.0008141391456600053i, 0.0002472765455828318 + -1.8562595673703955e-05i, 0.06379393267877828 + -0.011099493340325079i }, { 0.06174949196266812 + 0.010743781516954405i, -5.8678632975147824e-05 + -1.02599643658163e-05i, -0.006115264196260582 + 0.007303795330117037i, 0.0003395367632475412 + -0.00109097276733506i, 0.06032389687856414 + 6.342556239260599e-19i, -5.733226232739356e-05 + -4.786650009691584e-08i, -0.004593576271515104 + 0.00793440983214808i, 0.00014196450398822492 + -0.0010904861268941951i }, { -5.869568317401232e-05 + -1.016196897042713e-05i, 0.019168123484701476 + 0.003335057897061558i, -0.0012066001774826268 + 0.0016040961598696598i, 0.0019802989017917837 + -0.0008141391456600058i, -5.733226232739345e-05 + 4.7866500097295313e-08i, 0.018725593809675017 + 2.6060027413462618e-18i, -0.0008794671406968588 + 0.001720081101338933i, 0.0017434209909335473 + -0.001098680781491684i }, { -0.003289002296298164 + -0.008940041739793582i, -0.0005939018439704649 + -0.0019173651394917414i, 0.2928841652230585 + 0.05095885619325427i, 0.00024727654558283265 + 1.856259567370542e-05i, -0.004593576271515104 + -0.00793440983214808i, -0.0008794671406968573 + -0.0017200811013389345i, 0.2861224217190581 + 3.543985851311993e-18i, 0.00023753219151077158 + -2.3194131904467636e-05i }, { -4.889784727524931e-05 + 0.00114154097306894i, 0.0015889453293597652 + 0.0014351512217322376i, 0.00023901472237340985 + 6.60471228918052e-05i, 0.06379393267877828 + 0.011099493340325076i, 0.00014196450398822535 + 0.0010904861268941943i, 0.001743420990933547 + 0.0010986807814916837i, 0.00023753219151077072 + 2.31941319044691e-05i, 0.06232113810295393 + 6.68308995383643e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.08078692774551377, 1.0e-7), DoubleNear(0.02507767688051362, 1.0e-7), DoubleNear(0.3831806730974434, 1.0e-7), DoubleNear(0.08346167176627806, 1.0e-7), DoubleNear(0.06032389687856414, 1.0e-7), DoubleNear(0.018725593809675017, 1.0e-7), DoubleNear(0.2861224217190581, 1.0e-7), DoubleNear(0.06232113810295393, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.07257250224912073 + 7.133117566095904e-19i, 5.095218064473251e-05 + 3.8746465634829507e-05i, -0.004716803998172018 + 0.008097416340928056i, -0.0027303424287704603 + -0.0014108672697783517i, 0.019632732154980133 + -0.0005566023032733741i, 3.2421007731060157e-05 + 2.6484245618414428e-05i, -0.00041015773319985236 + 0.00262955823294284i, 0.00019061888117779884 + 0.00041289984218665087i }, { 5.095218064473273e-05 + -3.8746465634829236e-05i, 0.0035724682723856306 + 2.08691878282841e-18i, -0.00016156221628345043 + -0.001302107347775899i, 0.0009976527309677708 + -0.0002213238168662044i, 1.43764007453239e-05 + -1.6654669698878933e-06i, 0.0025283482168689114 + -0.001703367249084518i, 6.280952185521021e-05 + -0.00021770956723123118i, -0.00022087845161665627 + -0.000232405543179745i }, { -0.004716803998172019 + -0.008097416340928056i, -0.00016156221628345043 + 0.0013021073477758986i, 0.2434825906505984 + 2.0100091838344547e-18i, -6.646238808887071e-06 + -0.0004905145405318214i, -0.002487421961025981 + -0.002143150893866263i, -0.0007090791331699631 + 0.000734354296493035i, 0.08417040333399026 + -0.060035940252206925i, 2.5497199901055998e-05 + 3.0259481723449145e-05i }, { -0.0027303424287704603 + 0.0014108672697783517i, 0.000997652730967771 + 0.00022132381686620472i, -6.646238808886637e-06 + 0.0004905145405318214i, 0.06600209764434006 + -6.709877370793347e-18i, 7.777452300826719e-05 + 0.0006963970476962945i, 0.0015204081218563132 + 0.000707587153128236i, 0.00019062957776924498 + 1.2224362413470243e-05i, 0.013513790037007015 + -0.0064200501645458865i }, { 0.019632732154980133 + 0.000556602303273372i, 1.43764007453239e-05 + 1.665466969887934e-06i, -0.002487421961025982 + 0.002143150893866263i, 7.777452300826741e-05 + -0.0006963970476962945i, 0.06853832237495718 + 6.671443250811683e-19i, -0.0001850649159487622 + -3.885843587631021e-05i, -0.00602857833268052 + 0.010462908377047244i, 0.0030624285382844685 + -0.0011400189389976804i }, { 3.2421007731060184e-05 + -2.6484245618414373e-05i, 0.0025283482168689136 + 0.0017033672490845177i, -0.0007090791331699624 + -0.0007343542964930352i, 0.0015204081218563132 + -0.0007075871531282363i, -0.00018506491594876248 + 3.885843587631043e-05i, 0.040230802417803004 + 3.879569717102306e-18i, -0.001895704304533989 + 0.005325754280248516i, 0.0030805913220118466 + -0.002348731486209039i }, { -0.00041015773319985285 + -0.00262955823294284i, 6.280952185521045e-05 + 0.00021770956723123088i, 0.08417040333399026 + 0.06003594025220693i, 0.00019062957776924607 + -1.2224362413470894e-05i, -0.006028578332680518 + -0.010462908377047248i, -0.001895704304533989 + -0.005325754280248517i, 0.4258205041659031 + 5.825892611215078e-18i, 0.0005622861286907338 + 0.0004362583792286521i }, { 0.00019061888117779868 + -0.0004128998421866507i, -0.0002208784516166563 + 0.00023240554317974517i, 2.5497199901056242e-05 + -3.025948172344947e-05i, 0.01351379003700702 + 0.006420050164545894i, 0.0030624285382844707 + 0.0011400189389976795i, 0.0030805913220118466 + 0.002348731486209038i, 0.0005622861286907325 + -0.0004362583792286495i, 0.07978071222489191 + 6.373472941835381e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.07257250224912073, 1.0e-7), DoubleNear(0.0035724682723856306, 1.0e-7), DoubleNear(0.2434825906505984, 1.0e-7), DoubleNear(0.06600209764434006, 1.0e-7), DoubleNear(0.06853832237495718, 1.0e-7), DoubleNear(0.040230802417803004, 1.0e-7), DoubleNear(0.4258205041659031, 1.0e-7), DoubleNear(0.07978071222489191, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.27973104923600145 + 6.104237232977946e-19i, -0.00038831805366448075 + -0.003961801192806174i, 0.01075192084074103 + -0.04177471289940217i, -0.004552887215810547 + 0.000587226631473042i, 0.21381244043491185 + -0.03720118291869203i, -0.0008236873318471739 + -0.0029765608532943267i, 0.002662649356979091 + -0.033360392108419734i, -0.0034019048078654775 + 0.0010543311158796045i }, { -0.00038831805366447815 + 0.0039618011928061764i, 0.043099809710890793 + 1.055742196330005e-18i, 0.0002874527731344481 + 3.7075358047337947e-05i, 0.0025152758137327405 + 0.009772665418382445i, 0.00023006548725251416 + 0.00307984499700635i, 0.03294334154801385 + -0.0057318052793737355i, 0.0002246451592763229 + -9.889536457665087e-06i, 0.003222209248473813 + 0.007135232976360303i }, { 0.01075192084074104 + 0.04177471289940217i, 0.00028745277313444806 + -3.707535804733838e-05i, 0.18423655160695573 + 4.427692678204444e-18i, 0.0006296452790589199 + 0.003930675059666089i, 0.01377381302787627 + 0.030500615369182974i, 0.00021478392163207818 + -6.65666397377633e-05i, 0.14082121675081472 + -0.02450145479151664i, 0.0010040063710465715 + 0.0029206756993729504i }, { -0.004552887215810548 + -0.0005872266314730411i, 0.0025152758137327418 + -0.009772665418382445i, 0.0006296452790589178 + -0.00393067505966609i, 0.06543953893590088 + 1.3000301379128404e-18i, -0.0035580943005358158 + 0.00015663770997031068i, 0.0006228931208908499 + -0.007804241553657637i, -4.146757464483031e-05 + -0.003088147628314237i, 0.05001871461546591 + -0.008702745958012896i }, { 0.21381244043491188 + 0.03720118291869204i, 0.00023006548725251373 + -0.003079844997006348i, 0.013773813027876265 + -0.030500615369182974i, -0.0035580943005358136 + -0.0001566377099703085i, 0.20887620607384919 + 4.486938662397942e-18i, -0.00028995852273441076 + -0.0029582915612418933i, 0.008028498943374715 + -0.031193332181333i, -0.003399657674462562 + 0.0004384842913313222i }, { -0.0008236873318471726 + 0.0029765608532943293i, 0.032943341548013844 + 0.005731805279373737i, 0.00021478392163207805 + 6.656663973776352e-05i, 0.0006228931208908494 + 0.007804241553657635i, -0.00028995852273441033 + 0.002958291561241896i, 0.03218278685724489 + 1.1924635710564447e-18i, 0.00021464204578546632 + 2.7684306582727915e-05i, 0.0018781657261027133 + 0.007297285308141323i }, { 0.002662649356979093 + 0.03336039210841973i, 0.00022464515927632272 + 9.889536457664925e-06i, 0.14082121675081472 + 0.024501454791516636i, -4.1467574644828576e-05 + 0.003088147628314237i, 0.008028498943374715 + 0.031193332181333i, 0.00021464204578546623 + -2.7684306582727997e-05i, 0.13757011252377305 + -3.086971871598895e-19i, 0.0004701584519177888 + 0.002935049562837329i }, { -0.003401904807865478 + -0.0010543311158796053i, 0.003222209248473813 + -0.007135232976360305i, 0.0010040063710465702 + -0.0029206756993729512i, 0.05001871461546591 + 0.008702745958012896i, -0.0033996576744625634 + -0.00043848429133132045i, 0.0018781657261027135 + -0.007297285308141322i, 0.0004701584519177875 + -0.002935049562837329i, 0.04886394505538405 + 2.08184816567346e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.27973104923600145, 1.0e-7), DoubleNear(0.043099809710890793, 1.0e-7), DoubleNear(0.18423655160695573, 1.0e-7), DoubleNear(0.06543953893590088, 1.0e-7), DoubleNear(0.20887620607384919, 1.0e-7), DoubleNear(0.03218278685724489, 1.0e-7), DoubleNear(0.13757011252377305, 1.0e-7), DoubleNear(0.04886394505538405, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.19055300972005876 + -1.4956244383765168e-18i, -0.007365262180691761 + -0.0009503849577472398i, 0.0073242168935866055 + -0.02845696712936775i, -0.0008358773273059571 + 0.008523071068123446i, 0.0625840251594311 + -0.03653189462826015i, 0.0009568455447064923 + -0.0009187199482352717i, -0.003050111625748776 + -0.01075038945638256i, -0.0010926867727415448 + -0.001070528989714905i }, { -0.007365262180691758 + 0.0009503849577472387i, 0.027627312943317016 + -1.0533433725536012e-18i, 5.277426045167975e-05 + 0.000538115770943361i, 0.001612311342228304 + 0.006264354474302007i, -7.015849020198606e-05 + 0.0033575842164782297i, 0.006370160819260562 + -0.0032257218151267785i, 0.0002441893447241028 + 1.2577046669862766e-05i, 0.0011031745102640421 + 0.0012561510282219075i }, { 0.007324216893586609 + 0.028456967129367745i, 5.277426045167972e-05 + -0.0005381157709433612i, 0.12550208317966038 + 4.218945378820562e-18i, 0.007409568122527606 + 0.0004986168828502479i, 0.007861150559374213 + 0.007942063099489935i, 6.898827669201756e-05 + 6.758931469809848e-05i, 0.041219110329539316 + -0.024060647927220152i, -0.000898927337074376 + 0.0009754636755771353i }, { -0.0008358773273059553 + -0.008523071068123445i, 0.0016123113422283025 + -0.006264354474302009i, 0.0074095681225276044 + -0.0004986168828502466i, 0.04194725297340868 + -3.569615215411336e-18i, -0.003867649401007951 + -0.00019920446190681979i, -0.0003596579357940952 + -0.0016326529254619903i, 0.00027516446871655493 + -0.0033470253210346477i, 0.009671977434615363 + -0.004897695598503626i }, { 0.06258402515943108 + 0.03653189462826015i, -7.015849020198485e-05 + -0.00335758421647823i, 0.007861150559374211 + -0.007942063099489935i, -0.0038676494010079516 + 0.00019920446190681946i, 0.2980542455897919 + 6.5929868240722535e-18i, 0.0066869856042928695 + -0.005969707796300828i, 0.01145620289052914 + -0.044511077951367425i, -0.007116667562967151 + -0.007497360145319082i }, { 0.0009568455447064917 + 0.0009187199482352715i, 0.006370160819260567 + 0.003225721815126782i, 6.898827669201752e-05 + -6.758931469809848e-05i, -0.0003596579357940956 + 0.001632652925461991i, 0.006686985604292869 + 0.005969707796300834i, 0.04765528362481867 + 3.301549139940051e-18i, 0.00044932055846823467 + -0.00047335610631329516i, 0.00278113019760715 + 0.01080559625222176i }, { -0.0030501116257487756 + 0.01075038945638256i, 0.00024418934472410274 + -1.2577046669862719e-05i, 0.041219110329539316 + 0.02406064792722016i, 0.0002751644687165548 + 0.003347025321034647i, 0.011456202890529146 + 0.044511077951367425i, 0.00044932055846823456 + 0.0004733561063132948i, 0.1963045809510684 + -9.994988777600744e-20i, -0.006309764391550898 + 0.00636710773965317i }, { -0.0010926867727415446 + 0.001070528989714904i, 0.0011031745102640421 + -0.001256151028221908i, -0.0008989273370743754 + -0.0009754636755771352i, 0.009671977434615366 + 0.004897695598503629i, -0.007116667562967156 + 0.007497360145319082i, 0.0027811301976071526 + -0.010805596252221758i, -0.006309764391550898 + -0.006367107739653172i, 0.07235623101787625 + 6.951493518997636e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.19055300972005876, 1.0e-7), DoubleNear(0.027627312943317016, 1.0e-7), DoubleNear(0.12550208317966038, 1.0e-7), DoubleNear(0.04194725297340868, 1.0e-7), DoubleNear(0.2980542455897919, 1.0e-7), DoubleNear(0.04765528362481867, 1.0e-7), DoubleNear(0.1963045809510684, 1.0e-7), DoubleNear(0.07235623101787625, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.1809437371067174 + 4.5488489953444734e-18i, 2.536545960470961e-05 + -0.00025864036243613317i, 0.13830435383510226 + -0.024063546325955705i, -1.5008261055658376e-05 + -0.00020106510286800388i, 0.05942801644626153 + -0.03468965170026582i, 3.315857637137677e-05 + 3.2486178243168354e-05i, 0.040810461260818505 + -0.034418315823284126i, 2.9665067274901424e-05 + 2.042108232626317e-05i }, { 2.5365459604711343e-05 + 0.00025864036243613355i, 0.039831922495058084 + -2.3720744097550404e-18i, 5.3784441502188404e-05 + 0.00019431844313789028i, 0.03044553180329096 + -0.005297211871148672i, 0.00011736734738653684 + 6.045041020386619e-06i, 0.00918423563501931 + -0.004650712922909448i, 9.051366202640087e-05 + -1.0988051537736288e-05i, 0.006401476766329663 + -0.004776175949309759i }, { 0.13830435383510228 + 0.0240635463259557i, 5.378444150219014e-05 + -0.00019431844313788995i, 0.13511135579300176 + -1.8255280549004283e-18i, 1.8940482231135942e-05 + -0.00019312771246085872i, 0.050037152983542124 + -0.01861175794313097i, 2.10244514944651e-05 + 2.9240541362248254e-05i, 0.04437511904270887 + -0.02590289085521448i, 2.4759631260739493e-05 + 2.42575490986953e-05i }, { -1.5008261055659243e-05 + 0.0002010651028680036i, 0.03044553180329096 + 0.005297211871148667i, 1.8940482231135508e-05 + 0.00019312771246085862i, 0.029742643421667617 + -2.2508841782098964e-18i, 8.890581279146907e-05 + 2.0229106305364114e-05i, 0.007638465099373191 + -0.002333369326592163i, 8.763863112803204e-05 + 4.51385442319565e-06i, 0.006857902618856614 + -0.0034727044907209566i }, { 0.05942801644626153 + 0.03468965170026582i, 0.00011736734738653748 + -6.045041020386836e-06i, 0.050037152983542124 + 0.01861175794313097i, 8.890581279146951e-05 + -2.0229106305364765e-05i, 0.2830238637362398 + 4.892674061577652e-19i, 0.00021596176578972956 + 0.0002275142292960477i, 0.21632930335062428 + -0.03763909138425296i, 0.00019532730025505598 + 0.0001451799489466275i }, { 3.315857637137688e-05 + -3.248617824316846e-05i, 0.009184235635019317 + 0.004650712922909452i, 2.1024451494465208e-05 + -2.92405413622482e-05i, 0.007638465099373194 + 0.002333369326592166i, 0.00021596176578972826 + -0.00022751422929604683i, 0.0687074261517336 + 4.727846743997886e-18i, 0.00013481347110549545 + -0.00020262107444577728i, 0.052516524360188804 + -0.009137339366237961i }, { 0.040810461260818505 + 0.03441831582328412i, 9.05136620264013e-05 + 1.0988051537735855e-05i, 0.04437511904270887 + 0.025902890855214487i, 8.763863112803248e-05 + -4.5138544231960835e-06i, 0.21632930335062434 + 0.037639091384252976i, 0.000134813471105495 + 0.00020262107444577902i, 0.2113349628046205 + 6.003769530138481e-18i, 0.0001612594469522421 + 0.0001698857140562944i }, { 2.966506727490175e-05 + -2.0421082326263224e-05i, 0.006401476766329666 + 0.004776175949309763i, 2.4759631260739493e-05 + -2.4257549098695354e-05i, 0.006857902618856616 + 0.0034727044907209596i, 0.00019532730025505684 + -0.00014517994894662576i, 0.0525165243601888 + 0.009137339366237967i, 0.00016125944695224168 + -0.00016988571405629222i, 0.051304088490961325 + 5.525195914939801e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1809437371067174, 1.0e-7), DoubleNear(0.039831922495058084, 1.0e-7), DoubleNear(0.13511135579300176, 1.0e-7), DoubleNear(0.029742643421667617, 1.0e-7), DoubleNear(0.2830238637362398, 1.0e-7), DoubleNear(0.0687074261517336, 1.0e-7), DoubleNear(0.2113349628046205, 1.0e-7), DoubleNear(0.051304088490961325, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.09595501344679747 + 2.9086052617528606e-18i, 0.011260677262340466 + 0.0003756362740659228i, -0.010997552517585586 + 0.01871354404631579i, -0.0013638617810090626 + 0.002153051652722166i, 0.004012683882987482 + -0.008204250301838453i, 0.0005030206389764716 + -0.0009470907453526647i, -0.018129405046532217 + -0.013265826481458189i, -0.0020756211312061785 + -0.0016277654202531359i }, { 0.011260677262340467 + -0.00037563627406592137i, 0.006516026525257465 + 1.8308402087942438e-19i, -0.001217345497854684 + 0.0022391561615572493i, -0.0007468118792691531 + 0.001270782474070273i, 0.0004387860793805726 + -0.00097850775148222i, 0.00027248971866922515 + -0.0005571268312756943i, -0.0021794849201402073 + -0.0014858226093861007i, -0.0012311152896230786 + -0.0009008437821810284i }, { -0.010997552517585586 + -0.018713544046315794i, -0.0012173454978546844 + -0.0022391561615572493i, 0.4320776710484582 + 4.357137480676121e-18i, 0.05070591969264931 + 0.0016914597854724277i, 0.018482628097629336 + -0.012418666648379421i, 0.0022176205702260335 + -0.00138502248948294i, 0.01768757577633063 + -0.04413934255006833i, 0.002248495548023691 + -0.0051106740372480145i }, { -0.0013638617810090628 + -0.002153051652722166i, -0.0007468118792691533 + -0.001270782474070273i, 0.05070591969264931 + -0.001691459785472429i, 0.02934114085747323 + -1.0325861022621955e-19i, 0.0021203895553765497 + -0.0015297308336152458i, 0.001255101642056423 + -0.0008433156161667054i, 0.001902909891169605 + -0.005249157579133261i, 0.0012011119459638655 + -0.0029973746710289257i }, { 0.004012683882987484 + 0.008204250301838452i, 0.00043878607938057284 + 0.0009785077514822198i, 0.018482628097629336 + 0.01241866664837942i, 0.0021203895553765497 + 0.0015297308336152463i, 0.07720058746465691 + 3.9517263362965314e-18i, 0.009059775708171743 + 0.00030221809147057085i, 0.004754370607072917 + -0.0037400791810906133i, 0.000572584385396029 + -0.00042030019156687074i }, { 0.0005030206389764719 + 0.0009470907453526648i, 0.00027248971866922515 + 0.0005571268312756945i, 0.002217620570226033 + 0.00138502248948294i, 0.001255101642056423 + 0.0008433156161667054i, 0.009059775708171743 + -0.0003022180914705698i, 0.005242467877554683 + 3.035289626926582e-19i, 0.0005433017172408034 + -0.00045752417802088976i, 0.000322855511908904 + -0.00025397792439539303i }, { -0.018129405046532217 + 0.013265826481458189i, -0.002179484920140207 + 0.0014858226093861007i, 0.017687575776330636 + 0.04413934255006833i, 0.0019029098911696038 + 0.005249157579133263i, 0.004754370607072916 + 0.0037400791810906133i, 0.0005433017172408033 + 0.0004575241780208897i, 0.3311777713257371 + 3.415236843329339e-18i, 0.03886494165756156 + 0.0012964657041419853i }, { -0.0020756211312061793 + 0.0016277654202531359i, -0.0012311152896230788 + 0.0009008437821810285i, 0.002248495548023691 + 0.0051106740372480145i, 0.0012011119459638658 + 0.0029973746710289253i, 0.0005725843853960289 + 0.0004203001915668706i, 0.000322855511908904 + 0.0002539779243953931i, 0.03886494165756156 + -0.0012964657041419849i, 0.02248932145406496 + -1.6961834768767364e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.09595501344679747, 1.0e-7), DoubleNear(0.006516026525257465, 1.0e-7), DoubleNear(0.4320776710484582, 1.0e-7), DoubleNear(0.02934114085747323, 1.0e-7), DoubleNear(0.07720058746465691, 1.0e-7), DoubleNear(0.005242467877554683, 1.0e-7), DoubleNear(0.3311777713257371, 1.0e-7), DoubleNear(0.02248932145406496, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.10531886327452135 + 4.101068832809305e-18i, -0.0070360621645404785 + -0.0028232406909859727i, -0.0037973061140972484 + 0.009107347903189776i, 0.0004978245627961779 + -0.0005066438737038675i, 0.08316184883284203 + -0.015119358282587902i, 0.03431699058487943 + -0.001805148951964028i, -0.001690995663482104 + 0.007736474700804921i, -0.00108121180861922 + 0.003032614153521738i }, { -0.007036062164540479 + 0.0028232406909859727i, 0.0005457413515060389 + 5.617383539847611e-21i, 9.55048941902192e-06 + -0.0007102296095184452i, -1.967688319411359e-05 + 4.719246105388679e-05i, -0.00515051467244828 + 0.003239368995442691i, -0.0022442333854724244 + 0.001040518868571943i, -9.441783990725205e-05 + -0.000562182337083819i, -9.061303456294974e-06 + -0.0002315841827435771i }, { -0.0037973061140972484 + -0.009107347903189778i, 9.550489419021838e-06 + 0.0007102296095184454i, 0.46423676251770984 + 3.279711571768651e-18i, -0.03101437499971409 + -0.012444609421726083i, -0.004305859737614465 + -0.006646207869913535i, -0.001393408864521019 + -0.0029024436799897193i, 0.3665704914276784 + -0.06664486989532434i, 0.1512664314174118 + -0.007956945975932784i }, { 0.0004978245627961779 + 0.0005066438737038675i, -1.9676883194113593e-05 + -4.7192461053886785e-05i, -0.03101437499971409 + 0.012444609421726085i, 0.0024055823460116463 + 7.490947627280219e-21i, 0.00046582482719035375 + 0.00032858931661704i, 0.00017089444314566442 + 0.00015655168545649996i, -0.022703038966579832 + 0.01427886827001452i, -0.009892393525841658 + 0.004586520361744993i }, { 0.08316184883284203 + 0.015119358282587907i, -0.00515051467244828 + -0.003239368995442691i, -0.004305859737614463 + 0.006646207869913532i, 0.00046582482719035386 + -0.0003285893166170399i, 0.06783673763693304 + 2.7592627652400867e-18i, 0.02735651513505269 + 0.003501095056522466i, -0.0024458757964154207 + 0.005866116962035401i, -0.0012891019584092113 + 0.002239395334859162i }, { 0.03431699058487943 + 0.0018051489519640314i, -0.0022442333854724244 + -0.001040518868571943i, -0.0013934088645210182 + 0.0029024436799897184i, 0.00017089444314566436 + -0.00015655168545649996i, 0.027356515135052693 + -0.0035010950565224634i, 0.011212753051306111 + 4.80995600032235e-19i, -0.0006835942700329025 + 0.0024918615930548046i, -0.00040427948416613563 + 0.0009696120886209933i }, { -0.0016909956634821037 + -0.007736474700804921i, -9.441783990725203e-05 + 0.0005621823370838191i, 0.3665704914276784 + 0.06664486989532434i, -0.022703038966579832 + -0.01427886827001452i, -0.0024458757964154216 + -0.005866116962035403i, -0.000683594270032903 + -0.0024918615930548046i, 0.2990186798564855 + 4.492662752236809e-18i, 0.12058523634992496 + 0.015432534911340497i }, { -0.0010812118086192197 + -0.003032614153521738i, -9.06130345629498e-06 + 0.00023158418274357717i, 0.1512664314174118 + 0.007956945975932782i, -0.009892393525841658 + -0.0045865203617449935i, -0.0012891019584092118 + -0.002239395334859163i, -0.00040427948416613574 + -0.0009696120886209933i, 0.12058523634992496 + -0.015432534911340499i, 0.04942487996552654 + -2.803679055411734e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.10531886327452135, 1.0e-7), DoubleNear(0.0005457413515060389, 1.0e-7), DoubleNear(0.46423676251770984, 1.0e-7), DoubleNear(0.0024055823460116463, 1.0e-7), DoubleNear(0.06783673763693304, 1.0e-7), DoubleNear(0.011212753051306111, 1.0e-7), DoubleNear(0.2990186798564855, 1.0e-7), DoubleNear(0.04942487996552654, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.07130299128699882 + 2.7268108154484064e-18i, 0.008367670889521048 + 0.00027913069900879816i, -0.003482654318259874 + 0.007375260017471064i, -0.0004375744422226679 + 0.0008518805693872017i, 0.020751880391340294 + -0.0021162604463172566i, 0.002443594799687958 + -0.0001671133824379207i, -0.000590909252175023 + 0.002244720251136061i, -7.813282977327517e-05 + 0.0002611130199713515i }, { 0.008367670889521051 + -0.0002791306990087973i, 0.004841979234507551 + 7.341972398959418e-20i, -0.0003798303995986466 + 0.0008791477489743544i, -0.00023649694894437208 + 0.0005008325065907873i, 0.002427025697971382 + -0.0003295886664289294i, 0.0014091999805087478 + -0.0001437091060406358i, -6.055796169356652e-05 + 0.00026573949943969465i, -4.012693264148575e-05 + 0.00015243243862703393i }, { -0.003482654318259876 + -0.0073752600174710635i, -0.00037983039959864714 + -0.0008791477489743547i, 0.28980487984719744 + -3.74049749507499e-18i, 0.034009679158870085 + 0.0011345027358292412i, -0.0009055224380085302 + -0.0013442777401675458i, -0.00010100396111110059 + -0.00016130084611215594i, 0.09147255742705271 + -0.062230123318732636i, 0.010978257428822392 + -0.006944847383156276i }, { -0.00043757444222266813 + -0.0008518805693872017i, -0.00023649694894437213 + -0.0005008325065907873i, 0.034009679158870085 + -0.0011345027358292455i, 0.01967980844774105 + -9.59370691883902e-19i, -0.00011152888239426579 + -0.00015421112640959527i, -6.14914011611378e-05 + -9.128600057048126e-05i, 0.010491031366974721 + -0.007661024879608412i, 0.0062116359439445745 + -0.0042258670980201765i }, { 0.0207518803913403 + 0.002116260446317254i, 0.0024270256979713823 + 0.000329588666428929i, -0.0009055224380085305 + 0.0013442777401675454i, -0.00011152888239426576 + 0.00015421112640959516i, 0.10185260962445557 + 4.133520782600986e-18i, 0.01195278208099116 + 0.00039872366652769537i, -0.0027605275922527955 + 0.007598204847754114i, -0.00035370295339036563 + 0.0008808708917680931i }, { 0.0024435947996879585 + 0.0001671133824379203i, 0.0014091999805087478 + 0.00014370910604063553i, -0.00010100396111110063 + 0.0001613008461121559i, -6.149140116113782e-05 + 9.128600057048122e-05i, 0.011952782080991164 + -0.00039872366652769363i, 0.0069165151683045975 + 4.131932595824884e-19i, -0.000294213381015234 + 0.0009024842345620049i, -0.00018745941841587715 + 0.0005159720430840927i }, { -0.0005909092521750234 + -0.002244720251136061i, -6.055796169356655e-05 + -0.00026573949943969465i, 0.09147255742705271 + 0.06223012331873265i, 0.010491031366974723 + 0.007661024879608412i, -0.002760527592252794 + -0.007598204847754117i, -0.000294213381015234 + -0.0009024842345620047i, 0.4734505625269979 + 1.151287181908045e-17i, 0.05556118219134078 + 0.0018534227537851718i }, { -7.813282977327525e-05 + -0.0002611130199713514i, -4.012693264148577e-05 + -0.00015243243862703393i, 0.010978257428822392 + 0.006944847383156278i, 0.0062116359439445745 + 0.004225867098020177i, -0.0003537029533903657 + -0.0008808708917680937i, -0.0001874594184158772 + -0.0005159720430840927i, 0.05556118219134078 + -0.0018534227537851684i, 0.03215065386379714 + 6.864937339700087e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.07130299128699882, 1.0e-7), DoubleNear(0.004841979234507551, 1.0e-7), DoubleNear(0.28980487984719744, 1.0e-7), DoubleNear(0.01967980844774105, 1.0e-7), DoubleNear(0.10185260962445557, 1.0e-7), DoubleNear(0.0069165151683045975, 1.0e-7), DoubleNear(0.4734505625269979, 1.0e-7), DoubleNear(0.03215065386379714, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.32116663746425506 + 1.6642079831178866e-18i, -0.021456255376444133 + -0.008609385738552498i, 0.013198803088385405 + -0.031837074110506056i, -0.00173521928034649 + 0.001773131885599632i, 0.253599502734245 + -0.04610601851616081i, 0.10464860834388183 + -0.005504746262910573i, 0.005851570344605125 + -0.02703397367507772i, 0.0037550019821310657 + -0.010599985067751835i }, { -0.021456255376444133 + 0.008609385738552498i, 0.0016642214826372384 + 1.9579365099130165e-21i, -2.833182797381849e-05 + 0.002480761968053356i, 6.839356608836571e-05 + -0.00016497337051366362i, -0.01570633623578711 + 0.009878356216782087i, -0.00684372075131928 + 0.003173030318095035i, 0.00033376169017391554 + 0.0019629257704442613i, 3.328826084777854e-05 + 0.0008088145430182937i }, { 0.013198803088385416 + 0.031837074110506056i, -2.833182797381899e-05 + -0.002480761968053356i, 0.24838898832797615 + 5.7165724214600696e-18i, -0.016594181787810434 + -0.006658464374159559i, 0.01499249942758155 + 0.023244387904968036i, 0.004846366988879757 + 0.010147534199571177i, 0.19613283752627542 + -0.03565820966175144i, 0.0809348136584094 + -0.00425734866498624i }, { -0.00173521928034649 + -0.0017731318855996319i, 6.839356608836573e-05 + 0.00016497337051366365i, -0.016594181787810434 + 0.006658464374159559i, 0.0012871022148804468 + 1.1150394657214813e-20i, -0.0016247104689940633 + -0.0011509953683847022i, -0.0005957932788144319 + -0.000548014089442698i, -0.012147217403241003 + 0.007639881048675124i, -0.005292906159994802 + 0.0024540089122219006i }, { 0.25359950273424503 + 0.04610601851616081i, -0.01570633623578711 + -0.009878356216782087i, 0.014992499427581548 + -0.023244387904968036i, -0.0016247104689940633 + 0.0011509953683847022i, 0.2068660470310006 + 5.601534759311095e-18i, 0.0834228523314339 + 0.010676481798090848i, 0.008501456570932705 + -0.02050651874140072i, 0.004486735467346653 + -0.007830896668200311i }, { 0.10464860834388183 + 0.005504746262910577i, -0.00684372075131928 + -0.003173030318095035i, 0.004846366988879755 + -0.010147534199571179i, -0.0005957932788144319 + 0.000548014089442698i, 0.0834228523314339 + -0.01067648179809085i, 0.03419294590009346 + 7.786747414329181e-20i, 0.0023700277985239963 + -0.008708427298668837i, 0.001405208098544725 + -0.0033895281317909563i }, { 0.005851570344605128 + 0.02703397367507772i, 0.00033376169017391565 + -0.0019629257704442613i, 0.19613283752627542 + 0.03565820966175143i, -0.012147217403241003 + -0.007639881048675125i, 0.008501456570932705 + 0.020506518741400723i, 0.0023700277985239954 + 0.00870842729866884i, 0.15998937046241793 + 1.6503907581658008e-18i, 0.06451889915354374 + 0.008257148169772115i }, { 0.0037550019821310696 + 0.010599985067751835i, 3.328826084777831e-05 + -0.0008088145430182935i, 0.0809348136584094 + 0.004257348664986238i, -0.005292906159994801 + -0.002454008912221901i, 0.004486735467346653 + 0.007830896668200311i, 0.0014052080985447251 + 0.003389528131790956i, 0.06451889915354374 + -0.008257148169772114i, 0.026444687116739196 + 1.2276022034776973e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.32116663746425506, 1.0e-7), DoubleNear(0.0016642214826372384, 1.0e-7), DoubleNear(0.24838898832797615, 1.0e-7), DoubleNear(0.0012871022148804468, 1.0e-7), DoubleNear(0.2068660470310006, 1.0e-7), DoubleNear(0.03419294590009346, 1.0e-7), DoubleNear(0.15998937046241793, 1.0e-7), DoubleNear(0.026444687116739196, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.20430646356961138 + -2.315893956911664e-18i, 0.023976122416397804 + 0.0007998010316097267i, 0.008368263728651106 + -0.02078140756956442i, 0.0010634000657020605 + -0.0024060160276940475i, 0.06456946123121936 + -0.03722947109230265i, 0.007723208794560985 + -0.004116245859333964i, -0.0018231334155226133 + -0.008890509711716624i, -0.00017914769055046381 + -0.0010504713822020798i }, { 0.023976122416397804 + -0.0007998010316097289i, 0.013873859093764391 + -2.3307385401845405e-19i, 0.0009006936008938466 + -0.0024715347180577227i, 0.0005682645071638041 + -0.001411205085501319i, 0.007431723455667016 + -0.004621787591111998i, 0.004384724747472287 + -0.002528145351084275i, -0.00024875526649036593 + -0.0010361972964877007i, -0.00012380369996212095 + -0.0006037287164440294i }, { 0.008368263728651109 + 0.020781407569564418i, 0.0009006936008938459 + 0.0024715347180577236i, 0.15680140756458488 + 1.30220727728508e-18i, 0.018401227631993332 + 0.0006138324032283126i, 0.007024480533846262 + 0.0059082013635786i, 0.0008012199750585924 + 0.000720848197155556i, 0.047654976587173645 + -0.027116912672747243i, 0.005698643433949364 + -0.002995714906260233i }, { 0.0010634000657020603 + 0.002406016027694048i, 0.000568264507163804 + 0.001411205085501319i, 0.018401227631993335 + -0.0006138324032283144i, 0.01064792858848421 + -6.528771138758537e-19i, 0.0008474777924862642 + 0.0006658505560693898i, 0.00047701208973385454 + 0.00040120881044934453i, 0.005486333609279088 + -0.003368825954925343i, 0.0032361111769810356 + -0.001841430852976537i }, { 0.06456946123121937 + 0.03722947109230265i, 0.007431723455667016 + 0.004621787591111998i, 0.007024480533846262 + -0.005908201363578598i, 0.0008474777924862638 + -0.0006658505560693899i, 0.3237262209256443 + 9.581636699340645e-18i, 0.03799047453859197 + 0.0012672950279286246i, 0.013331995930667005 + -0.03156218528234236i, 0.0016881161212981028 + -0.003651748754906631i }, { 0.007723208794560985 + 0.004116245859333964i, 0.004384724747472287 + 0.0025281453510842752i, 0.0008012199750585925 + -0.0007208481971555559i, 0.00047701208973385443 + -0.0004012088104493446i, 0.037990474538591966 + -0.0012672950279286228i, 0.021983308288966306 + 3.128992646716589e-19i, 0.0014410023696563312 + -0.0037561306125577583i, 0.0009053371574692865 + -0.002143296416803301i }, { -0.0018231334155226124 + 0.008890509711716621i, -0.0002487552664903657 + 0.0010361972964877007i, 0.047654976587173645 + 0.027116912672747254i, 0.0054863336092790885 + 0.003368825954925344i, 0.013331995930667011 + 0.031562185282342364i, 0.0014410023696563305 + 0.0037561306125577596i, 0.2515769512258092 + 6.0647559023407904e-18i, 0.02952348973373997 + 0.0009848513923842433i }, { -0.00017914769055046398 + 0.0010504713822020793i, -0.0001238036999621209 + 0.0006037287164440294i, 0.005698643433949364 + 0.002995714906260233i, 0.003236111176981036 + 0.0018414308529765373i, 0.001688116121298103 + 0.003651748754906631i, 0.0009053371574692868 + 0.0021432964168033005i, 0.02952348973373997 + -0.0009848513923842407i, 0.017083860743135434 + 7.867877288808382e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.20430646356961138, 1.0e-7), DoubleNear(0.013873859093764391, 1.0e-7), DoubleNear(0.15680140756458488, 1.0e-7), DoubleNear(0.01064792858848421, 1.0e-7), DoubleNear(0.3237262209256443, 1.0e-7), DoubleNear(0.021983308288966306, 1.0e-7), DoubleNear(0.2515769512258092, 1.0e-7), DoubleNear(0.017083860743135434, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.21963754165124483 + 2.1901625038036037e-18i, -0.014673377101468061 + -0.005887735829825769i, 0.17343012893338577 + -0.03153071141563825i, 0.07156647170873187 + -0.003764553336378595i, 0.06825854988484809 + -0.039137561582120756i, -0.005609310035144565 + 0.0007848926407633556i, 0.048279787999154326 + -0.04070284579851084i, 0.02157048428771875 + -0.01392248393617747i }, { -0.014673377101468061 + 0.00588773582982577i, 0.0011381179505306335 + -1.3387918214170753e-20i, -0.010741156386643958 + 0.006755551859743794i, -0.004680243294992533 + 0.0021699532185338708i, -0.0035110200808255573 + 0.004444451993208802i, 0.00035370219643275636 + -0.00020280304105451302i, -0.0021343342699178362 + 0.0040134616174277845i, -0.0010678499720061575 + 0.0015083540259169586i }, { 0.17343012893338577 + 0.031530711415638235i, -0.010741156386643958 + -0.006755551859743794i, 0.1414703294829514 + -3.2038491834301876e-18i, 0.0570507271498592 + 0.0073013692646638085i, 0.05951680285991162 + -0.02110473318180195i, -0.004541899251242918 + -0.0001854942637139174i, 0.04396588793354492 + -0.02520882218292914i, 0.019031162263654915 + -0.007896853406357554i }, { 0.07156647170873187 + 0.0037645533363785937i, -0.004680243294992533 + -0.0021699532185338703i, 0.057050727149859204 + -0.007301369264663813i, 0.023383669731717967 + -8.72563049680137e-19i, 0.022912107736278775 + -0.01158260205830258i, -0.0018411847769963057 + 0.00015960591207882178i, 0.01642907714577166 + -0.012435065539246143i, 0.007267133728020566 + -0.004166773163006299i }, { 0.0682585498848481 + 0.039137561582120756i, -0.003511020080825558 + -0.004444451993208803i, 0.059516802859911636 + 0.021104733181801956i, 0.02291210773627878 + 0.011582602058302579i, 0.34991808414098635 + 5.1906179007743525e-18i, -0.023377060062786503 + -0.009380114282886287i, 0.2763022113271346 + -0.05023351676227399i, 0.11401695029355935 + -0.005997541591518218i }, { -0.005609310035144565 + -0.0007848926407633559i, 0.0003537021964327563 + 0.00020280304105451308i, -0.004541899251242919 + 0.00018549426371391726i, -0.0018411847769963059 + -0.00015960591207882176i, -0.02337706006278651 + 0.009380114282886287i, 0.0018132057469870517 + 2.6496249381298582e-20i, -0.017112397252384157 + 0.010762685405713415i, -0.00745638361632155 + 0.003457086011783065i }, { 0.048279787999154326 + 0.040702845798510835i, -0.0021343342699178367 + -0.0040134616174277845i, 0.04396588793354492 + 0.025208822182929143i, 0.016429077145771662 + 0.012435065539246145i, 0.2763022113271346 + 0.050233516762274i, -0.017112397252384157 + -0.010762685405713417i, 0.2253850880104671 + 1.0455774700907083e-17i, 0.09089102433511845 + 0.011632260703199155i }, { 0.021570484287718746 + 0.01392248393617747i, -0.0010678499720061575 + -0.0015083540259169586i, 0.019031162263654915 + 0.007896853406357554i, 0.007267133728020566 + 0.0041667731630063i, 0.11401695029355936 + 0.005997541591518221i, -0.00745638361632155 + -0.0034570860117830657i, 0.09089102433511845 + -0.01163226070319915i, 0.03725396328511468 + 1.0731907441711985e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.21963754165124483, 1.0e-7), DoubleNear(0.0011381179505306335, 1.0e-7), DoubleNear(0.1414703294829514, 1.0e-7), DoubleNear(0.023383669731717967, 1.0e-7), DoubleNear(0.34991808414098635, 1.0e-7), DoubleNear(0.0018132057469870517, 1.0e-7), DoubleNear(0.2253850880104671, 1.0e-7), DoubleNear(0.03725396328511468, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.058665382505443286 + 1.2874627828663223e-18i, -0.006723730234539321 + 0.011441165813793312i, 0.0024532916667184823 + -0.005015949295808422i, -0.011084032438186515 + -0.008110517177063225i, 0.04484088783420641 + -0.007801856932008936i, -0.003617733071801597 + 0.009639238510644544i, 0.0012081069728171019 + -0.0041602021486690935i, -0.009550691157932672 + -0.004725218584842575i }, { -0.006723730234539321 + -0.011441165813793314i, 0.264165476441449 + 3.7870313676147734e-19i, 0.01129998744312059 + -0.0075925770104624535i, 0.01081390498775529 + -0.0269860981852113i, -0.0066608339603477455 + -0.007850872728339064i, 0.20191489414871927 + -0.03513113126605683i, 0.007627415875836228 + -0.007306161848065611i, 0.004676751632635802 + -0.02206495698339033i }, { 0.002453291666718483 + 0.005015949295808422i, 0.011299987443120586 + 0.0075925770104624535i, 0.04719922212058411 + 2.8192234334828306e-18i, 0.0029067472372479586 + -0.0022866254495496493i, 0.002542240225267209 + 0.0035076800043039244i, 0.009646875974827041 + 0.004300611330891558i, 0.03607672761316319 + -0.0062769824820070215i, 0.0019176761048631983 + -0.0021343479925831996i }, { -0.011084032438186515 + 0.008110517177063225i, 0.010813904987755297 + 0.026986098185211298i, 0.0029067472372479586 + 0.0022866254495496493i, 0.2024768684222725 + 2.9084993826344538e-18i, -0.007393470256690715 + 0.0076733297747578096i, 0.01185446592349991 + 0.019188693811221413i, 0.002525868665878946 + 0.0013612165438820299i, 0.15476320375311742 + -0.026927218267522517i }, { 0.04484088783420641 + 0.00780185693200894i, -0.006660833960347744 + 0.007850872728339063i, 0.002542240225267207 + -0.0035076800043039253i, -0.007393470256690715 + -0.0076733297747578096i, 0.04380565746661165 + 1.8042264997659627e-18i, -0.005020634162315418 + 0.008543160706592752i, 0.0018318819349382254 + -0.0037454278373057256i, -0.008276487897968782 + -0.006056153086575994i }, { -0.0036177330718015974 + -0.009639238510644544i, 0.20191489414871933 + 0.03513113126605684i, 0.00964687597482704 + -0.004300611330891559i, 0.011854465923499908 + -0.019188693811221413i, -0.005020634162315419 + -0.008543160706592754i, 0.19725333546448243 + 3.875175733688424e-18i, 0.008437742296565172 + -0.005669405254083671i, 0.008074782734539203 + -0.02015061903588595i }, { 0.001208106972817103 + 0.004160202148669093i, 0.007627415875836228 + 0.007306161848065611i, 0.03607672761316318 + 0.006276982482007023i, 0.002525868665878946 + -0.0013612165438820305i, 0.0018318819349382258 + 0.0037454278373057247i, 0.008437742296565172 + 0.005669405254083671i, 0.035243833221627496 + 1.436031865506359e-18i, 0.002170478881733862 + -0.001707431655936357i }, { -0.009550691157932674 + 0.004725218584842575i, 0.004676751632635803 + 0.02206495698339033i, 0.0019176761048631987 + 0.0021343479925831996i, 0.15476320375311742 + 0.026927218267522507i, -0.008276487897968782 + 0.006056153086575994i, 0.008074782734539203 + 0.020150619035885955i, 0.0021704788817338617 + 0.0017074316559363568i, 0.1511902243575296 + 3.3711911300721153e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.058665382505443286, 1.0e-7), DoubleNear(0.264165476441449, 1.0e-7), DoubleNear(0.04719922212058411, 1.0e-7), DoubleNear(0.2024768684222725, 1.0e-7), DoubleNear(0.04380565746661165, 1.0e-7), DoubleNear(0.19725333546448243, 1.0e-7), DoubleNear(0.035243833221627496, 1.0e-7), DoubleNear(0.1511902243575296, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.045173329769102474 + 7.414375517976185e-19i, -0.005101908131367291 + 0.008658026276323665i, 0.0017645729873817413 + -0.0062126247698979994i, -0.007591011837133449 + -0.005509629818247686i, 0.012840764982286017 + -0.0010119703478008947i, -0.00042291349234213816 + 0.0028224294246380595i, 0.0006168102207090219 + -0.001592416670308099i, -0.002629942533216162 + -0.00024292724109335257i }, { -0.0051019081313672925 + -0.008658026276323665i, 0.1730069928942733 + -3.2904053627277365e-18i, 0.007801431776344498 + -0.005064020916897595i, 0.007171955248433167 + -0.01597998788516774i, -0.002757514465566594 + -0.0023352655701322357i, 0.05611342099640562 + -0.038745646095586034i, 0.002664763626092182 + -0.0036673008997220894i, -0.002563747336193756 + -0.007901821757852555i }, { 0.0017645729873817417 + 0.0062126247698979994i, 0.0078014317763444975 + 0.005064020916897593i, 0.030971640752403905 + 2.058792987640382e-18i, 0.001382756864163044 + -0.0007819337522618137i, 0.0004103053859433114 + 0.0014876722283027112i, 0.0026656449250010697 + 0.0001073025549700789i, 0.009320315389563027 + -0.0012479992045569973i, -0.00020812269247437053 + -0.0004252767348749644i }, { -0.0075910118371334484 + 0.005509629818247687i, 0.0071719552484331706 + 0.01597998788516774i, 0.001382756864163044 + 0.0007819337522618143i, 0.13647769540066518 + -1.4094628242311558e-18i, -0.002610052489428122 + 0.003748521375405175i, 0.007091187237636806 + 0.004821737945725233i, 0.001790500626396926 + 0.0008997018293942086i, 0.041570772374591655 + -0.027710344321166782i }, { 0.012840764982286017 + 0.0010119703478008932i, -0.0027575144655665944 + 0.0023352655701322357i, 0.0004103053859433113 + -0.0014876722283027112i, -0.002610052489428121 + -0.003748521375405176i, 0.05729771020295247 + 2.3502517308346665e-18i, -0.0066424562654874494 + 0.0113263002440624i, 0.002520600614274966 + -0.0025487523632161477i, -0.011769508499021848 + -0.008657040445391532i }, { -0.00042291349234213865 + -0.0028224294246380595i, 0.056113420996405636 + 0.038745646095586034i, 0.0026656449250010697 + -0.00010730255497007913i, 0.007091187237636805 + -0.004821737945725232i, -0.006642456265487448 + -0.011326300244062401i, 0.28841181901165813 + 7.544284233177638e-18i, 0.011936297963341263 + -0.00819796134764853i, 0.011716732473861326 + -0.03115672933592951i }, { 0.0006168102207090222 + 0.0015924166703080989i, 0.0026647636260921813 + 0.0036673008997220894i, 0.009320315389563029 + 0.0012479992045569964i, 0.001790500626396926 + -0.0008997018293942093i, 0.0025206006142749673 + 0.002548752363216147i, 0.01193629796334126 + 0.008197961347648532i, 0.0514714145898077 + 2.1964623113488076e-18i, 0.003694469254818777 + -0.0032121233532241924i }, { -0.002629942533216162 + 0.00024292724109335284i, -0.002563747336193756 + 0.007901821757852553i, -0.00020812269247437058 + 0.0004252767348749647i, 0.041570772374591655 + 0.027710344321166792i, -0.01176950849902185 + 0.00865704044539153i, 0.011716732473861331 + 0.031156729335929514i, 0.003694469254818776 + 0.003212123353224192i, 0.21718939737913692 + 4.655081319872821e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.045173329769102474, 1.0e-7), DoubleNear(0.1730069928942733, 1.0e-7), DoubleNear(0.030971640752403905, 1.0e-7), DoubleNear(0.13647769540066518, 1.0e-7), DoubleNear(0.05729771020295247, 1.0e-7), DoubleNear(0.28841181901165813, 1.0e-7), DoubleNear(0.0514714145898077, 1.0e-7), DoubleNear(0.21718939737913692, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.043593524792254465 + 1.9536872831063316e-18i, -0.002129239946678037 + 0.0045091177048496665i, 0.03332071269331287 + -0.005797464008005005i, -0.0010278211071526068 + 0.003729710049227016i, 0.012687372521084445 + -0.0012938482743601297i, -0.00036127260118694885 + 0.0013723865738774158i, 0.009525526045084692 + -0.002676235351965855i, -9.362626216721256e-05 + 0.0010970290625199944i }, { -0.002129239946678038 + -0.004509117704849666i, 0.177182134809521 + 2.2308730248310135e-19i, -0.0022271481964990874 + -0.0031633786037153794i, 0.13542917294508036 + -0.023563294189099374i, -0.0005536221431773972 + -0.0008218702180080206i, 0.05592487956019639 + -0.03804651634881513i, -0.0005324608985448934 + -0.0005545708237987116i, 0.037686411982063475 + -0.036518256420628024i }, { 0.03332071269331287 + 0.005797464008005007i, -0.0022271481964990865 + 0.003163378603715379i, 0.03255144572925191 + 8.465432563316689e-19i, -0.0015899113205262096 + 0.003366974819212184i, 0.009869661502732063 + 0.0006983293751427778i, -0.0004586511967206708 + 0.001000938420047706i, 0.009473707850764599 + -0.0009661212779977624i, -0.00026976358362955984 + 0.0010247661158856792i }, { -0.001027821107152608 + -0.003729710049227016i, 0.1354291729450804 + 0.023563294189099363i, -0.0015899113205262109 + -0.0033669748192121846i, 0.13230255348541747 + -4.9229554894419936e-18i, -0.00031386132299511755 + -0.0007018222545743123i, 0.04780595658018326 + -0.02164345664486591i, -0.0004133916959922708 + -0.0006136935227300064i, 0.041759313810800884 + -0.028409474067937677i }, { 0.012687372521084445 + 0.001293848274360129i, -0.0005536221431773974 + 0.0008218702180080202i, 0.009869661502732063 + -0.0006983293751427794i, -0.00031386132299511787 + 0.0007018222545743121i, 0.06227107983377293 + 2.1529989332428213e-18i, -0.0016877430506133254 + 0.004645422659393996i, 0.04759690275405673 + -0.008281375406010953i, -0.0006722358597857918 + 0.0037751804688343276i }, { -0.00036127260118694907 + -0.001372386573877416i, 0.0559248795601964 + 0.038046516348815146i, -0.000458651196720671 + -0.001000938420047706i, 0.04780595658018326 + 0.021643456644865916i, -0.0016877430506133245 + -0.0046454226593939975i, 0.2894602100542005 + 3.0641152169128298e-18i, -0.0019078170979697127 + -0.0033262775807416547i, 0.22124892495675635 + -0.03849505534447997i }, { 0.009525526045084694 + 0.0026762353519658535i, -0.0005324608985448936 + 0.0005545708237987111i, 0.009473707850764599 + 0.0009661212779977606i, -0.0004133916959922708 + 0.0006136935227300062i, 0.04759690275405673 + 0.008281375406010956i, -0.0019078170979697118 + 0.0033262775807416534i, 0.04649804495898724 + 2.3937151089406528e-18i, -0.001260243960055347 + 0.0034687542314442103i }, { -9.362626216721283e-05 + -0.0010970290625199942i, 0.037686411982063475 + 0.036518256420628024i, -0.00026976358362956017 + -0.001024766115885679i, 0.04175931381080088 + 0.02840947406793768i, -0.0006722358597857907 + -0.003775180468834328i, 0.22124892495675635 + 0.038495055344479986i, -0.0012602439600553465 + -0.003468754231444212i, 0.21614100633659455 + 9.135250336137629e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.043593524792254465, 1.0e-7), DoubleNear(0.177182134809521, 1.0e-7), DoubleNear(0.03255144572925191, 1.0e-7), DoubleNear(0.13230255348541747, 1.0e-7), DoubleNear(0.06227107983377293, 1.0e-7), DoubleNear(0.2894602100542005, 1.0e-7), DoubleNear(0.04649804495898724, 1.0e-7), DoubleNear(0.21614100633659455, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.12490975096669837 + -5.483223116297635e-19i, 0.0051162245193154 + -0.012705424972359285i, 0.09547477393463992 + -0.016611636451268758i, 0.002220903305257216 + -0.010391794304701878i, 0.03947675066920956 + -0.022761511708986926i, -0.001114635028834536 + -0.005435517480234604i, 0.02714702304650324 + -0.02264774041519531i, -0.0015748359610149763 + -0.004006403718647661i }, { 0.005116224519315402 + 0.01270542497235928i, 0.0958659086350771 + 2.7250968972191965e-18i, 0.0056002695911762865 + 0.009030990027050358i, 0.07327511170375331 + -0.012749121745835625i, 0.004294656658545706 + 0.003612181171812324i, 0.029135501412071278 + -0.01657885291418834i, 0.0037630017703671964 + 0.002189828284645987i, 0.02006491498064493 + -0.01654675135739857i }, { 0.09547477393463993 + 0.016611636451268747i, 0.0056002695911762865 + -0.009030990027050358i, 0.0932705716966774 + -2.0006454993003544e-18i, 0.003820303716499509 + -0.009487187682706455i, 0.03320108935701558 + -0.012147784642020763i, -0.00012910671077820038 + -0.004302872356709155i, 0.029477435309482082 + -0.0169961047344i, -0.0008323020866501981 + -0.004058720947926049i }, { 0.002220903305257215 + 0.010391794304701878i, 0.07327511170375331 + 0.012749121745835621i, 0.0038203037164995096 + 0.009487187682706457i, 0.07158342751799199 + -2.0757667338099702e-18i, 0.002802240261231505 + 0.00333211340718701i, 0.024474528725899735 + -0.008797342627702365i, 0.0032068359650344117 + 0.0026972290022156203i, 0.0217555863520834 + -0.01237949061153544i }, { 0.03947675066920957 + 0.02276151170898693i, 0.004294656658545706 + -0.0036121811718123225i, 0.03320108935701559 + 0.012147784642020768i, 0.002802240261231505 + -0.00333211340718701i, 0.1979211079801939 + 2.214488231257563e-18i, 0.008150972135158372 + -0.01929662250866044i, 0.15128100804828576 + -0.026321351746797013i, 0.0036639553001956877 + -0.015833364827357546i }, { -0.001114635028834536 + 0.005435517480234603i, 0.02913550141207128 + 0.01657885291418834i, -0.00012910671077820055 + 0.0043028723567091545i, 0.02447452872589974 + 0.008797342627702367i, 0.008150972135158379 + 0.01929662250866044i, 0.1538101819077795 + 3.002625918898088e-18i, 0.008796436557590832 + 0.01366538378847498i, 0.1175648196625273 + -0.020455079003693914i }, { 0.027147023046503245 + 0.022647740415195308i, 0.0037630017703671964 + -0.002189828284645987i, 0.029477435309482082 + 0.016996104734399997i, 0.003206835965034411 + -0.0026972290022156207i, 0.15128100804828581 + 0.02632135174679703i, 0.008796436557590829 + -0.01366538378847498i, 0.14778842123441668 + 7.680047732754741e-18i, 0.0060863609529779195 + -0.014408859190485221i }, { -0.0015748359610149756 + 0.004006403718647661i, 0.02006491498064493 + 0.01654675135739857i, -0.0008323020866501975 + 0.004058720947926049i, 0.021755586352083398 + 0.012379490611535444i, 0.003663955300195691 + 0.01583336482735755i, 0.1175648196625273 + 0.020455079003693907i, 0.0060863609529779195 + 0.014408859190485223i, 0.11485063006116512 + 3.848917712323541e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.12490975096669837, 1.0e-7), DoubleNear(0.0958659086350771, 1.0e-7), DoubleNear(0.0932705716966774, 1.0e-7), DoubleNear(0.07158342751799199, 1.0e-7), DoubleNear(0.1979211079801939, 1.0e-7), DoubleNear(0.1538101819077795, 1.0e-7), DoubleNear(0.14778842123441668, 1.0e-7), DoubleNear(0.11485063006116512, 1.0e-7) }));


}
}

}
