#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { -0.3246406907378403 + 0.4115284891954701i, -0.10036609404778295 + -0.15635545658841976i, 0.5196532927713492 + -0.5173639133565928i, -0.38956003927477134 + -0.03564204156407194i }, { -0.26723716034130307 + -0.072105397315852i, -0.4448851170054393 + 0.07957440583675073i, -0.5036381979925002 + 0.029498285565248326i, -0.43367805803812737 + -0.5258631162776878i }, { -0.2337710665332814 + -0.20453853903001848i, -0.7080580893721131 + -0.2942105809353104i, 0.0772681120536905 + 0.1449474588970519i, 0.1424258192958257 + 0.5180190244196018i }, { 0.4535575012965779 + 0.5885902682081603i, -0.2920469158846134 + -0.2966938489859673i, 0.12853717851726604 + 0.40530423128508153i, 0.09786543386165383 + -0.2900990844189761i } }) }, { QubitIndex{ 7 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.28247398746710695 + 0.11123570175394575i, -0.05075935078405497 + 0.19729692280462283i }, { 0.2923306828808605 + 0.3786844790740409i, -0.0032545606817733497 + 0.27529826337788865i } }), Matrix({ { 0.3072137483803622 + 0.18349190445454328i, 0.04160661054714271 + 0.3950535432871964i }, { 0.024926394881963042 + 0.31048972059189184i, -0.028917353939602056 + -0.4986031253597061i } }), Matrix({ { 0.2469277207258882 + 0.1338772985670034i, -0.23751077932198061 + -0.39109762858648506i }, { -0.08757022682825501 + -0.11400680402459677i, -0.23282422603132616 + 0.13894474184431582i } }), Matrix({ { -0.3699066167463117 + -0.021169951195759443i, 0.1710248795035535 + 0.2987554005474524i }, { 0.368265737224467 + 0.28537675585147476i, 0.09104746579629985 + 0.2564811061395974i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.5599180571421956 + 0.4650812397786231i, -0.36619843541170405 + -0.5797326242278487i }, { 0.520692252000671 + -0.44617349584949306i, 0.672054772822696 + -0.2795553122982044i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.2555324532313976 + -0.35131670426861294i, -0.012449900894679067 + -0.9006246380235752i }, { 0.7273281691523432 + -0.5312941492289217i, -0.12723205357859357 + 0.41537003490236324i } }) }, { QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.30563194643326086 + 0.007016270840760458i, -0.2618713627169165 + -0.04757291635340986i }, { 0.22004508687438296 + 0.1929650783976512i, 0.41202301739761077 + -0.31008655335937424i } }), Matrix({ { 0.2796233393039025 + 0.1547720314153567i, 0.07658066244055245 + 0.2279264116799154i }, { 0.4891406016488963 + 0.09837032714392492i, -0.17397578474982062 + -0.49062424711046393i } }), Matrix({ { 0.32940567742236926 + -0.1667191712452281i, -0.0001900843221001869 + 0.05715585640116006i }, { -0.06271902380598651 + -0.19171001118581496i, 0.04128499106133578 + -0.07305210407043523i } }), Matrix({ { 0.4726375282707081 + -0.04469888821253411i, -0.1421186145516503 + 0.4397991515148446i }, { 0.2005753739859098 + 0.16492783084396295i, -0.017964570929944787 + 0.3319596187980406i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 0 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.049685510745921535 + 0.12019182997938418i, 0.009584685524159142 + 0.05447471002918085i, 0.06203361314088683 + -0.10014006589072534i, -0.13080214281606942 + 0.09867895822110662i }, { -0.008247862171764972 + -0.058976805019573864i, 0.1850912807388019 + -0.018359850562141466i, 0.05246860702636073 + 0.004480821298612484i, 0.05070974674847117 + 0.053767104908253156i }, { 0.09315082494137783 + 0.1127897062414257i, 0.12732277887669424 + -0.09785211999993644i, -0.0864801892033578 + 0.03268292948226281i, -0.015607325110762882 + 0.04689788873071398i }, { 0.14200106529380668 + -0.038861224443809246i, -0.12655590067341801 + -0.03190890114762161i, 0.0031613718708667494 + -0.20418476838037378i, 0.03151179294886238 + -0.10727284992121953i } }), Matrix({ { -0.07077333352935539 + -0.16917657162575403i, -0.10112359152710902 + -0.04497738569949397i, -0.19670438957645112 + -0.08336885366768447i, 0.0834254252477221 + -0.0814904642793512i }, { -0.07782571530256821 + -0.10369099589583927i, 0.06032087110767941 + -0.021199491979366797i, -0.0800127798416159 + 0.12434052732198982i, 0.0050777131315208005 + 0.09722601570608849i }, { -0.015339586482725688 + 0.15720224331967156i, 0.02057254853512302 + -0.043413150761417316i, 0.059342453765948606 + 0.1073551315017985i, 0.07022966915758239 + 0.04451186130771537i }, { -0.017798303424742073 + -0.17218334481025696i, -0.11677808761082618 + 0.08302147010941871i, -0.019726036889597606 + -0.1620407910779543i, 0.036533839231240685 + 0.08270051678870657i } }), Matrix({ { -0.03501890351500871 + -0.0716899663015505i, -0.12431432134388377 + -0.0795204299361913i, -0.06456772244859289 + 0.012903986022785023i, 0.17074358486368088 + 0.09267058954137325i }, { 0.01872708993709179 + 0.04478294960067855i, -0.05511889680851895 + -0.14997327261137505i, 0.07306606059417915 + 0.10235786715810372i, -0.03496027644260997 + -0.0034925900474286637i }, { 0.014555037423862233 + 0.14132439538640565i, -0.13239478126304427 + 0.07101957146579888i, -0.06936082185987162 + 0.09827584496059037i, 0.06570068923565048 + 0.013369228840906898i }, { 0.02513963888980901 + 0.15158137989313838i, 0.12396281118028564 + -0.01753492958244603i, -0.058028884861499555 + -0.013494393187970641i, -0.11044966657160317 + -0.09798821163004422i } }), Matrix({ { -0.0967476109015814 + 0.09690818069311014i, -0.06291406176273655 + 0.08809798257042138i, 0.014937909912255578 + -0.06336664904125253i, 0.004283951876084405 + -0.07780810784125204i }, { -0.055404565015827814 + 0.020963070732539044i, 0.09723745506192863 + -0.02244544754441173i, -0.06661024584691319 + 0.06201919123528828i, -0.053718762867125944 + 0.016155646449341515i }, { -0.0509747833002499 + 0.005801821726541198i, 0.13750458188595993 + -0.18235117346757598i, -0.030222709154392714 + -0.02033746413612062i, 0.16994150471837338 + -0.029679462900636947i }, { -0.029897176519175412 + -0.06907170005006315i, 0.1285076461617722 + -0.02955584824859671i, 0.16483730974443028 + -0.08110981565142379i, 0.048937081213399396 + -0.05442309667306472i } }), Matrix({ { 0.0020310185762087707 + -0.22766349768999122i, -0.13415629737223178 + 0.015194359196739244i, 0.02442349647038495 + -0.075242308249938i, 0.181007153170282 + -0.012156677723990497i }, { -0.03823039915567718 + -0.08889597278593495i, 0.20011168799045023 + 0.10325561327653747i, 0.013786374044796856 + 0.11192529209698698i, -0.05533355782035397 + 0.004596738652049736i }, { 0.15463115666326352 + 0.034215823325323066i, 0.03555011079586703 + 0.03630110809180076i, -0.11544150678154431 + -0.04701367261596399i, 0.04356781076986234 + 0.04454558732113335i }, { -0.006274043649132461 + -0.10094116205227702i, -0.057971398545826676 + -0.06382557804466556i, -0.04956943668104162 + 0.058703740253094536i, -0.3274321869331807 + 0.06372391213345603i } }), Matrix({ { 0.02521307962193457 + -0.010738913838875933i, -0.08903941725491875 + 0.004345379685690143i, -0.09229387679526414 + 0.1208087584999465i, -0.1282877230743371 + 0.030573140270980105i }, { 0.009574859857719605 + -0.020442527990343094i, 0.15593480923198594 + -0.0395799231843133i, -0.06878580003783649 + -0.03889405821182783i, 0.14009244820414507 + -0.10307455342331065i }, { 0.11918626520385098 + 0.08822813481233946i, 0.09760113555677036 + 0.1474678601135475i, -0.1010978529014323 + 0.10028704918437849i, 0.11367693757435926 + 0.09310174164498297i }, { 0.04019879478642593 + 0.021158784785395575i, -0.003223181207129338 + 0.05912687399527246i, 0.06755764184097456 + 0.09431022668734226i, 0.054486869859307605 + 0.07556084063380282i } }), Matrix({ { 0.08597698977203165 + -0.018465510996468253i, -0.16092775175867652 + 0.005036661249955665i, -0.02205153241059226 + -0.040567522094355525i, -0.02099738486028679 + -0.0048090381690692185i }, { 0.11261601856459161 + 0.07618710194089538i, -0.05293453529119239 + -0.01233005890091744i, -0.030523616547564063 + 0.04148435876431662i, 0.10553714879824383 + -0.03842647832877975i }, { 0.10451907230135168 + -0.06051779825215603i, 0.12686446952288513 + 0.1787459739377187i, 0.07851846751534368 + 0.15339884389874905i, -0.10305624631080977 + -0.03629084127056165i }, { -0.17984717998163147 + 0.09924928590564434i, 0.015357651632926577 + -0.057239176771027196i, 0.08984052288240528 + 0.1517181435410602i, -0.04472790257175081 + -0.03954041122028155i } }), Matrix({ { 0.0031543998586303214 + 0.05617896309053237i, 0.0461070116759256 + -0.07797031616168507i, 0.00479157998171058 + 0.0809251048652214i, -0.01201267105858227 + -0.0642710673952211i }, { -0.10454404105132219 + 0.0020126252446311266i, -0.016994849304336757 + 0.06516715528726069i, -0.10659544193845842 + -0.19276866586488348i, -0.017616732687177897 + 0.11181906295479488i }, { 0.07037311058735138 + -0.031041022619692632i, 0.002078866771190431 + -0.024977241448549372i, 0.027918007992625414 + -0.05934127563602747i, -0.04244759925801587 + -0.029939770377436968i }, { -0.09212469711674957 + -0.045864115674799505i, 0.025147926618490864 + 0.018136446416429395i, 0.05361462213107393 + -0.0887855097378668i, -0.06454433668208527 + -0.08795005734937618i } }), Matrix({ { -0.24400707697664173 + -0.002833349371130618i, 0.09958163998055308 + 0.01253796042731681i, 0.18481210390106678 + 0.017528726784223278i, 0.09507267598695501 + 0.01909475934740827i }, { -0.053724981775739755 + -0.18212144069488645i, -0.07037980538062552 + 0.018086329490421077i, 0.10041921883308899 + 0.10555031756312429i, -0.06880106520259663 + -0.050908377925458714i }, { 0.004194172124146021 + -0.08555680704148402i, 0.008135745212443472 + -0.04016387504811568i, -0.0664996587524401 + 0.1504631636695891i, 0.1680446942439152 + -0.024501485782559927i }, { 0.09456586603867853 + -0.0400153069029749i, -0.042507215770925116 + -0.10201556207645789i, -0.017539400825345476 + 0.19592254548801066i, 0.07453191549329925 + 0.01186485606148578i } }), Matrix({ { -0.047383119446187914 + 0.002876788389385652i, -0.16775264479697624 + -0.03629292274243924i, 0.003826294214109197 + -0.007981402477535435i, -0.1376014736271977 + -0.08750390298557852i }, { -0.06419069974039428 + -0.08750091369930874i, 0.20619419277524184 + 0.05438661134458001i, -0.049843636523034696 + -0.12204988185165362i, -0.14881433133617752 + -0.04449458923545272i }, { 0.01554374374444465 + -0.19944245815266726i, 0.08193228589470451 + 0.05099447400262435i, -0.016554733956743655 + -0.008639032239370433i, -0.11120510443431707 + -0.10569801335560915i }, { 0.0402755590510548 + 0.0035438444533650616i, 0.04068520062971775 + -0.03195453444275343i, -0.05353095182794206 + 0.04605996236087047i, -0.0806887130335437 + 0.18194685633240923i } }), Matrix({ { -0.15622154472325073 + -0.07797971245428749i, -0.004629307278618291 + -0.023454390275419335i, 0.05726480462893835 + 0.017656001331834783i, 0.04832247816295886 + -0.10467260565638291i }, { -0.05962757016479606 + -0.032968625846857606i, 0.12533210185456659 + -0.0650765466073025i, 0.05680747875106146 + 0.04650146900513924i, -0.06575736280936384 + 0.03419229589870816i }, { 0.06732956176687988 + 0.03189325743189799i, 0.09353243246759153 + 0.05182847014098129i, -0.08385197784297893 + -0.004458419027167421i, -0.07806157010964411 + -0.09972333427812631i }, { 0.19379631894664226 + -0.08498653721110327i, 0.027464502758892263 + 0.0073306822988771295i, 0.021785980253200075 + -0.08961478414762265i, -0.00726416914309066 + -0.10159430562911324i } }), Matrix({ { -0.043292550148905234 + 0.02902203168277608i, 0.02738804329811339 + 0.005428976088082518i, 0.038942297951840545 + -0.03822104960376991i, -0.16294037490182106 + -0.07133474249904052i }, { 0.013019175209804768 + 0.034368217270777414i, 0.1040742047085915 + 0.03737433042120385i, 0.11253532749985279 + 0.08707282150635329i, -0.02171703181693521 + -0.1331036996320168i }, { -0.060697742914565526 + -0.018166621930074782i, 0.05208191590173032 + -0.04707564788763641i, -0.0070875755763932435 + 0.08192315770025058i, 0.19314525923787101 + -0.12497216308127569i }, { -0.057278605014815645 + 0.13370031849257816i, -0.023706744414579903 + -0.0059207920334712425i, 0.064219162681513 + 0.10951561111688797i, 0.04047366050389179 + -0.08332718382404623i } }), Matrix({ { 0.028364254506325876 + 0.011038271044396489i, -0.13706961971463177 + -0.016927583714711217i, 0.05008841168286256 + 0.10207519606440138i, -0.06293416237808515 + -0.007597269072216635i }, { -0.009920864115989268 + 0.2089437149397579i, -0.04450720927580678 + 0.1169335158270196i, -0.027204919795145378 + 0.18711103478087435i, -0.0891409962827748 + -0.020027730004428864i }, { 0.160263352687632 + -0.06425174651942483i, 0.04501569286669042 + 0.07581738022562015i, 0.06011977033040729 + 0.10078393712200612i, 0.014029974618688426 + -0.047572914429058366i }, { -0.018671355108006556 + -0.008714347119569206i, 0.061517276790054726 + 0.021435875211902565i, 0.1682586316976676 + -0.06842959201656879i, 0.013993595669832272 + 0.016281915273089524i } }), Matrix({ { 0.03137785518110224 + -0.011402820323599227i, 0.1206497694076589 + -0.10095929894351004i, 0.0019599406385029756 + 0.11091918206172693i, 0.043682222947735445 + -0.08068974225682116i }, { -0.10599808295750687 + -0.06541200234524125i, 0.08968084305070799 + 0.10725822866556603i, -0.0011146571933667096 + -0.11978101274183953i, 0.18452363255246967 + 0.1492520444363432i }, { 0.07412074824369556 + -0.060270826751919145i, 0.03956344609942057 + -0.10820440888585746i, -0.02200999036479577 + 0.05593848873995873i, 0.11885886546759428 + -0.1074402570667316i }, { 0.1433543322318321 + -0.023399302896388623i, 0.06859174227429218 + 0.18711342025537708i, 0.14077397154771862 + 0.01488800578419009i, 0.04290192271498125 + -0.00836702335813951i } }), Matrix({ { -0.07504116359614815 + -0.06418873199141364i, 0.08859223719941901 + 0.13518644151808143i, -0.06239308865932612 + 0.15448216228467218i, -0.14088991478006077 + 0.017288851322893144i }, { 0.17939342385328225 + -0.07070458824306092i, 0.13036206388343133 + -0.004815789788127488i, -0.1664876544563925 + 0.02211622195790324i, -0.07688684653988276 + -0.06584962488423i }, { 0.0913939189255273 + -0.1058178511147721i, -0.1371633384950829 + -0.14590041546885585i, 0.048562597689038506 + 0.10987364161067575i, -0.10026274121987143 + 0.06953045077527438i }, { 0.09878258422033936 + -0.038750925332052745i, -0.06169219023082145 + -0.06449165342381534i, 0.019362108274916835 + 0.06540473215356594i, -0.02508379625396283 + 0.10941958376108776i } }), Matrix({ { -0.032000057077083754 + -0.026158169208776196i, -0.07936135184490233 + -0.016020121138050028i, 0.05626550799137742 + 0.014496036136830068i, 0.0821033912546299 + 0.057602463156658484i }, { -0.037766869007889114 + -0.03084767511780346i, -0.031841614905482665 + 0.0512802787120777i, -0.07410826932429401 + 0.02979769785514157i, -0.023870552827182055 + 0.03314252558606262i }, { -0.12362164647062508 + 0.0512238056447459i, -0.05118374882604353 + 0.12861452596547504i, 0.14097220230811722 + 0.18228992958529447i, 0.007733936424288068 + -0.050607256038693246i }, { -0.068492608745991 + 0.050496942608847996i, -0.10113687595045505 + -0.13768371837997473i, -0.007416889379734673 + 0.01765890724025775i, 0.05192028969446093 + 0.10695121990731485i } }) }, { QubitIndex{ 0 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.09990686350498112 + 0.07486377632312395i, 0.016160103930696047 + 0.007543574164061556i, -0.011913223191757073 + 0.13994392556642513i, -0.055556950104265236 + -0.10146719990165425i }, { 0.08891872373636761 + -0.05548906666678886i, -0.08939710418275013 + -0.004383424728806297i, 0.0736108222216364 + -0.0053040755210022154i, -0.020855666140426346 + -0.19347610585838956i }, { 0.2283672821817156 + 0.03547822394196488i, 0.059532319277164174 + -0.034429751290754956i, 0.014600355839038563 + 0.15171558715863964i, -0.037788711062640694 + -0.05680996616352517i }, { -0.0615878743595042 + -0.16923038748229466i, -0.05732880385102445 + -0.10878625787826507i, 0.049212957350669224 + -0.03814517029724231i, -0.14547863462523433 + -0.08869185922466861i } }), Matrix({ { 0.041203937626969556 + 0.0420995037120659i, -0.12237052564242704 + 0.11988644893091305i, 0.1453091263429625 + 0.02528478085800143i, 0.01818468413534355 + 0.012155080173688087i }, { -0.05543301589581234 + 0.0348085475664914i, 0.039059691440466456 + 0.14846126538042034i, -0.12895911366463478 + 0.033901958061698975i, 0.1022634497288652 + 0.10233689210880784i }, { 0.11846167548075764 + -0.024428037251068246i, 0.0037404855385657285 + -0.09639555152174492i, -0.04001318443342023 + -0.00902345126492811i, -0.03788908235327944 + -0.012039516559104964i }, { 0.11613677114282162 + 0.0028865193545204865i, -0.07323876880530678 + 0.004884058530055963i, 0.017165684775407707 + -0.04295587104607476i, 0.06935210527432659 + 0.03998926439563417i } }), Matrix({ { 0.004650192794431243 + -0.04643825162493513i, -0.0323987542516071 + -0.07674733938761354i, -0.044431510134006834 + -0.024387017489515356i, 0.1612567422337574 + 0.0025076249550897555i }, { -0.08293312506184813 + 0.0995980189322409i, 0.21148707572878778 + 0.11140565698560546i, -0.05604420689759555 + 0.14353597616151687i, 0.020097511298360266 + 0.018971336471475118i }, { -0.06434340931754454 + -0.003781172217071814i, -0.07330613658756396 + -0.16312848015195722i, -0.05218134606821359 + -0.0845880979782632i, 0.05934342054112845 + -0.020610444272471485i }, { -0.05409341570981363 + -0.1019638929366276i, -0.055385402866094044 + -0.05787237558738508i, 0.028340454119360436 + 0.01855745317337897i, -0.04613630243599288 + 0.09574094110442224i } }), Matrix({ { -0.107719221398659 + 0.05644013841580923i, -0.12425914516762447 + 0.15027462380341053i, 0.04152560911565747 + 0.11405827734168536i, -0.04739580175620438 + 0.2509861472074255i }, { 0.07011195748021382 + 0.013848553460889569i, 0.04744070094287402 + 0.018575265739577535i, 0.0928676379145154 + 0.009844286964603282i, -0.0933721371480484 + -0.11782311778994062i }, { 0.17314951889492136 + -0.05540422159945166i, -0.0042388890063467174 + -0.048908515545979206i, -0.06584697742487493 + -0.04437871164771297i, 0.04321190661491902 + 0.13270845752830526i }, { 0.0957536008553716 + -0.13805136950147448i, -0.02500265457732412 + 0.1264593128067457i, 0.06184763750505256 + 0.15732740100479686i, -0.23025829009821103 + 0.019290366998896927i } }), Matrix({ { -0.04585313102989077 + -0.029232580983509553i, 0.12507093851195974 + -0.14330973606730557i, 0.07660049905912443 + 0.18978326713265284i, -0.028197266338797957 + -0.1270886969602968i }, { 0.04222512566059174 + 0.1589159563578755i, -0.04626989569309555 + -0.09058096257401721i, -0.0688208131856735 + -0.12408813435551587i, -0.09383334266527835 + -0.007190676728475504i }, { 0.1504832354291561 + -0.03140596933939946i, 0.08365649169414638 + 0.02347621077950788i, 0.007624460788674686 + 0.060116314284350936i, 0.07201764818879107 + 0.15751914662747318i }, { 0.02985800660463943 + -0.013824022414180077i, -0.014801861060506167 + -0.05297906618788124i, -0.16292867869481814 + 0.10340845841442967i, 0.0361550466436442 + 0.08087616887841509i } }), Matrix({ { -0.11526693276977991 + 0.0935453009024732i, -0.007115623172973569 + -0.015184396247677414i, 0.03873545690914492 + 0.05678138543122772i, -0.07239575783141822 + -0.09350563280275144i }, { -0.061660230507315485 + -0.004942731606236952i, -0.10444073907251761 + 0.03970768864363171i, 0.09507347014713684 + -0.01470147713925163i, 0.0962190134659913 + -0.0857352014199678i }, { -0.023249578994046467 + 0.03737950466549143i, -0.12397513907555331 + 0.02046401631241827i, 0.16757129018838673 + -0.1207785701828858i, 0.024238443640719663 + 0.05855446776076271i }, { -0.015168672106513667 + -0.147121303882824i, -0.01965498927582742 + -0.07140530088730578i, -0.060591973892409175 + -0.03771542920091079i, -0.011649584996158053 + 0.04187527599064335i } }), Matrix({ { 0.09604780045731015 + -0.1193952738700868i, 0.02612253035969322 + 0.06787826671324815i, -0.052570966531948135 + 0.03268483754131469i, 0.09476009037840596 + -0.0436725706479332i }, { 0.07595033697953248 + -0.08246367283853567i, 0.019352229755795487 + 0.1040679159178072i, 0.19646480529669202 + -0.09191555239189726i, -0.016697117199441697 + 0.18942300330228326i }, { -0.1969634149297952 + 0.21025531015692417i, -0.012907219678324852 + -0.11734749767952946i, -0.04880945380218049 + -0.061257142746985335i, 0.07505056754274297 + 0.08952436318847533i }, { 0.101209061971651 + 0.036489672745489386i, -0.0789709124591016 + -0.05921455476657014i, 0.08215827737312377 + -0.018560752393403143i, 0.05678533085884059 + 0.05023878686564593i } }), Matrix({ { -0.014948519701461247 + 0.10907702391277643i, -0.0022595470623991446 + -0.025985889543823155i, -0.04460164209444147 + -0.11612859424039064i, 0.03348888225265544 + 0.12298909364415694i }, { -0.12178014835123706 + 0.004810882721125282i, 0.21536422467294333 + 0.09585526963928584i, 0.00670912425678102 + -0.041429114256800265i, -0.059390794774516656 + 0.11613175273819125i }, { 0.06593423422561104 + -0.11638758291156592i, 0.03111673245948441 + 0.10061585460015027i, -0.0467455530294647 + -0.047250170294507086i, -0.05824000068548967 + 0.1200691656511172i }, { 0.1103150835086779 + -0.042052157133363306i, -0.04627526831583529 + -0.10233859315390585i, 0.0009429111058293241 + 0.17207267469124543i, -0.07219705151806378 + 0.08991553180237037i } }), Matrix({ { 0.07014677192312235 + 0.05208472438987642i, -0.006646733738020735 + 0.10540037663236435i, -0.011588750654999177 + 0.09484872790299471i, 0.0954376909534871 + -0.08184869311282174i }, { 0.00032788763874991365 + 0.002305707722509969i, -0.09013278022716295 + 0.10771821924572739i, 0.00811082173640318 + -0.013339184961748204i, 0.10309694485502867 + -0.1217855457157768i }, { -0.04564461566526543 + 0.07553984624930617i, -0.04032597348591279 + 0.1449195899251907i, 0.015917188763484205 + 0.024946747869611353i, 0.06294389849844091 + -0.058105654270573695i }, { -0.02236477076263615 + -0.023172610282209263i, -0.10033122798910729 + 0.028940329385193555i, -0.02605625633336367 + -0.010045917786728996i, 0.11567069572063733 + -0.03711282429969481i } }), Matrix({ { 0.08566437872576134 + -0.07476639820936179i, 0.1086168330949864 + 0.0940844676377395i, 0.08086387442342782 + 0.0014616802927717464i, 0.122627952978743 + -0.14269078605406665i }, { 0.030487147970215622 + 0.017942635931113518i, 0.12172396836081809 + 0.13889511415301534i, 0.1271879477317897 + -0.1256034136559273i, -0.0394674467567267 + -0.064471648015269i }, { -0.05134738303990025 + 0.038604140296402516i, 0.07573459879624626 + 0.1115038751092304i, -0.12825817983297538 + -0.07243794267321732i, -0.03396279639259988 + -0.028219488286064718i }, { -0.006989974547117597 + -0.056229230229917854i, 0.039639490596484514 + -0.13917222645860755i, -0.008947440274041473 + -0.05513839146369404i, 0.009433283455603535 + -0.2036118379813156i } }), Matrix({ { -0.019950119897799073 + -0.002570220559632557i, -0.04124526829046838 + -0.03249238469282721i, -0.1900298368233455 + 0.019253291095941063i, -0.1048767047765896 + -0.0967638742533228i }, { 0.04416866406737059 + -0.08445140565828319i, -0.08174668836120791 + -0.04935796839623072i, 0.16388726365879794 + -0.0957713736541645i, 0.0751745960281796 + -0.1163608764716531i }, { -0.019044069003660524 + -0.00556755175418339i, -0.002183160609275024 + 0.004228797159212983i, -0.20454844353764096 + 0.0782920466961172i, -0.08881021058799819 + 0.025949818167798174i }, { -0.18309027015603518 + -0.015540195056270219i, 0.06995487110017017 + -0.02578315896649319i, -0.009732284685766751 + 0.1266559498027804i, -0.06473785657470399 + -0.08054112242492345i } }), Matrix({ { 0.014427887213453427 + 0.22344637887984994i, 0.07735731853561523 + 0.04182304001788443i, 0.041931737233810565 + -0.09668132408748678i, -0.044576465236967594 + -0.08216351346083257i }, { -0.030310907370793512 + 0.071965719038955i, -0.11446721026913301 + -0.06509754473218758i, 0.08484225043906636 + -0.0011348999368007977i, 0.1053418378781654 + 0.0030654511358709302i }, { -0.10218276242611206 + 0.10469318259253005i, -0.14351683493741657 + 0.06211821012131729i, -0.0005067670892335999 + 0.14692979913565596i, 0.0156476315709235 + -0.07069036728415723i }, { 0.05879091633928461 + 0.06778126194399481i, 0.17511820613382828 + -0.17824174244620625i, -0.031486611736350575 + -0.0494080348111268i, 0.10926870350032955 + 0.06922733750610643i } }), Matrix({ { -0.0593061285906402 + 0.20373627468095978i, 0.04973950822081997 + 0.012363867739929896i, -0.10648702822638255 + -0.048854730887975144i, -0.08615864259639142 + 0.019646307446556346i }, { -0.0883087043021784 + -0.03292912489638726i, 0.06778989687511414 + -0.12181120497463853i, -0.041262712643271034 + 0.16019013613587493i, -0.010059090679333242 + 0.004300686639395032i }, { 0.03472927539854701 + -0.13888231850583485i, -0.04790625809901165 + -0.12613623785411643i, -0.09361367609843924 + 0.00040698391364485555i, -0.049040909514222644 + 0.14386530178931306i }, { 0.09328350360834825 + -0.2076315452490696i, -0.05606700049993309 + 0.04231985736284734i, -0.013568382238313574 + -0.1260925478710978i, -0.09602972025171261 + 0.006243467827564434i } }), Matrix({ { -0.0634653909958184 + -0.10889166366872485i, 0.026663842537246824 + 0.01880346807091237i, 0.03615883794986683 + 0.03230726768333251i, 0.09603342218220791 + 0.028832742128803573i }, { 0.06095193397159065 + 0.013726841735666767i, -0.07524827063667765 + 0.0003390032259705769i, -0.04046778035898093 + 0.08572975751897598i, -0.029146586947435434 + -0.10712711663285494i }, { 0.015701528988243767 + 0.035258101559570695i, -0.025904092666423954 + 0.020805518763131282i, 0.10247175094924821 + 0.004198910501466184i, 0.03904232628611421 + -0.004170387809915857i }, { 0.03204373362258741 + -0.06365714307545452i, -0.1010969840919628 + -0.04238271511964041i, -0.11905537760502967 + -0.12210163122335102i, 0.21501933637603463 + -0.04277004873757706i } }), Matrix({ { -0.15554587777216278 + 0.09164591751098988i, -0.05975115521023556 + 0.025340591049364092i, 0.016984657629211596 + -0.15617429922884588i, 0.06291041966436418 + 0.01125584931933734i }, { 0.1338052210355365 + -0.11492138267894635i, -0.023698734880932285 + 0.17036193768020877i, -0.16509793321818167 + 0.059029595781260165i, -0.08976108884116055 + 0.07647287235466203i }, { 0.016602155780052585 + 0.0619450152304171i, -0.10346085306321162 + 0.045470384318022555i, -0.0016981451386210997 + 0.16457346308790072i, -0.09064871335077528 + 0.10335505666594677i }, { -0.13164246666983545 + -0.10439403337032302i, -0.002178128982306785 + -0.1483727168389073i, 0.1196113056150136 + 0.09830289852772416i, 0.05874275404097289 + -0.1320326990647377i } }), Matrix({ { -0.12025456282916744 + -0.00046004076727384526i, -0.03336589292317094 + 0.037357279659445325i, -0.07653078551287153 + 0.041159051020220216i, -0.04292071321709657 + 0.08433852908308632i }, { 0.04939970475954647 + -0.02389338628225957i, -0.1250361827312946 + 0.13948760572168362i, -0.0022391456588140134 + 0.0027819458717471606i, 0.09587836793427552 + -0.006599473056037417i }, { 0.04482467762026897 + -0.053592586365172994i, -0.09366622047334151 + 0.03220768445232953i, 0.029474376568796787 + -0.16225189551938857i, 0.005629512319062483 + 0.026113952260386052i }, { -0.026971783488861378 + 0.03533553883318409i, 0.11518349930987966 + -0.22090725208667675i, 0.005588497320109522 + -0.12732732874855565i, -0.1120201784744013 + 0.043555927518791206i } }) }, { QubitIndex{ 1 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.015958870995334884 + -0.09697754183324062i, 0.2495415430859003 + -0.4052887659142097i }, { 0.2840102719135844 + 0.30526610251072683i, 0.12413664501236893 + -0.05870270215663506i } }), Matrix({ { 0.08294520372300374 + -0.29182074735275143i, 0.08317603196004758 + 0.2896937401204328i }, { -0.4905459336047483 + 0.2568834282706055i, 0.08284330127721516 + -0.1741147416505806i } }), Matrix({ { -0.19193063407347308 + 0.18489929363646251i, 0.37450910899099715 + 0.12364805849363307i }, { -0.0192376931686394 + 0.2666640053056805i, -0.42512659094150584 + -0.06286678729289541i } }), Matrix({ { -0.13094404700464746 + 0.30628228388178136i, -0.05318787504044209 + 0.5203643504833086i }, { 0.10700665127699549 + 0.39104638713213696i, 0.10374254849629322 + -0.04464481390034192i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.08439918728980178 + 0.3323320979522309i, -0.09265957332524083 + 0.1458602526244181i, 0.06458392267212404 + 0.04552318375368628i, 0.03997226370708258 + 0.020349613279959357i }, { -0.045874916808813636 + 0.039048748036020736i, -0.06945708087447251 + 0.13250744767552763i, 0.07350019319454648 + 0.024059284606969242i, 0.05612817651527635 + -0.08973560796167815i }, { 0.016174126517903186 + 0.0441978236416214i, 0.15240080955805932 + 0.01439634271280305i, -0.0259887087526532 + 0.22807780147598616i, 0.13303403695117563 + 0.16577153948408063i }, { 0.0180444892715513 + -0.025750915797265055i, 0.04229004657047031 + 0.05190486950824726i, -0.16212040396035124 + 0.010437858513919504i, 0.02417834826547072 + 0.07681033210496499i } }), Matrix({ { -0.11702769893260791 + -0.00880211586242572i, -0.07543400107746073 + 0.14738557965047133i, -0.11801827520655243 + -0.062369183890947484i, 0.08180320522134704 + -0.07456516335821282i }, { -0.010042897929752354 + 0.06882958225722863i, 0.08547102051611764 + -0.0019808028475404816i, -0.15657861812419777 + 0.02549793837403403i, 0.0987853990840166 + -0.027511750602007775i }, { -0.003311761778170018 + 0.17364639132963958i, 0.03625717599702786 + -0.1175724495521354i, 0.011975385372715567 + -0.07551194604375915i, -0.07020369465885522 + -0.16490125123339408i }, { -0.013143758825992327 + -0.04007615944313932i, -0.024456062405464055 + 0.08129061895931781i, 0.060083849550499606 + 0.051107284341039165i, -0.06771821352386242 + 0.060480310331836006i } }), Matrix({ { -0.030712079391196512 + -0.08797556153545452i, 0.04553133365255872 + 0.00020491689838522873i, 0.17737718853625337 + 0.04978528571315498i, 0.008838923205255447 + 0.043342131068128655i }, { -0.08710718777602017 + -0.03919627481349246i, 0.1557467976831661 + -0.0028258974194623563i, -0.17448898471465246 + -0.16195040380842007i, -0.00828067966345334 + -0.006736611278177035i }, { 0.04488248150646129 + 0.02199098928401194i, -0.06435499433449562 + 0.006770538401670207i, -0.01534799205943539 + 0.024847370959492392i, 0.13139441479291988 + 0.04839240378237071i }, { -0.07622367949655331 + 0.1236322322585807i, -0.06332464286066328 + 0.13269649939688807i, 0.02436197551667649 + -0.07698917938225053i, -0.055854699826654086 + -0.05071920464520496i } }), Matrix({ { 0.05415771411404387 + 0.0924817062918348i, -0.06321375809957681 + 0.02384589674375259i, -0.05605939294391232 + -0.14532385524181987i, 0.02133883698467218 + -0.009095132832093159i }, { 0.036624592476578566 + 0.07833016291950491i, 0.04188710797702567 + -0.032849472939226305i, 0.016460232703150106 + -0.07613870129838701i, -0.1177797975997467 + -0.05769370141422055i }, { -0.05501124026956042 + -0.10942261457383763i, 0.09415968534871288 + 0.058365947949748136i, 0.04450930201760765 + 0.22324160555519354i, -0.08014535174752467 + 0.027199242334470002i }, { -0.026345282945350726 + 0.01552586262409753i, 0.1746737453452624 + 0.05370590528119145i, 0.009379364874921461 + -0.005046100590200522i, 0.030822928085571563 + 0.0857489762028121i } }), Matrix({ { -0.010091903076072446 + -0.1723703782336081i, -0.14232680578899223 + 0.04608366598333595i, -0.01611932549686628 + -0.031796625356634155i, -0.09379488698161409 + 0.052600862710857066i }, { -0.012072113561879066 + 0.01553647713196369i, -0.06446062079108954 + 0.0523782499751912i, -0.016785463840988526 + 0.15190465979149945i, -0.03432057795277053 + -0.04644344891039618i }, { -0.031602599963027694 + -0.20431946237301157i, 0.013473286275574892 + -0.047815236262057415i, -0.07656998689449447 + 0.02892492855308501i, 0.11814794974671484 + -0.01718007764177405i }, { 0.09604652357916416 + 0.06666700326057011i, 0.030706465040089764 + 0.048936013655264746i, -0.06819524408048462 + -0.04913838845379369i, -0.03132100455436822 + 0.13096836958419444i } }), Matrix({ { -0.06939281978061716 + -0.12669009980874074i, 0.22193753920277443 + 0.01808323825133112i, -0.08348166228795165 + -0.01172709691612129i, -0.05728843443893172 + -0.0656067615473714i }, { 0.04411490805326029 + -0.032772841170101805i, -0.1877165921797198 + 0.0792824063615199i, 0.027885440145746527 + -0.1502678367982148i, 0.007888782843448598 + 0.09566071603962852i }, { -0.0789952405665439 + -0.008720834984985822i, -0.05079675972712132 + 0.11692371809431983i, 0.10346434055074542 + -0.032989486762878925i, 0.21342988515276295 + 0.006973904811780148i }, { -0.07554113746906935 + -0.16294662088227696i, 0.029387895918405137 + 8.162089195004409e-05i, 0.009911861298945177 + -0.12175289793305659i, 0.04794283043939154 + 0.20817016822756573i } }), Matrix({ { 0.011868227475024884 + 0.06990680120169177i, -0.06563829211024665 + -0.15214048827593554i, -0.1685660119863985 + -0.10183118815217349i, 0.09734739596438044 + 0.10896280324806588i }, { 0.034888705330482606 + -0.11409034878799067i, 0.06640595644846627 + 0.016917880774274002i, 0.017969651459713895 + 0.01221622918227912i, -0.12163948410426166 + -0.004971570207722742i }, { -0.14499913220642227 + 0.027927782053665504i, -0.014647366344375311 + 0.05459395409777543i, 0.0893565929588518 + 0.021372646164492203i, 0.03998897446340172 + 0.023639435948507065i }, { 0.08976424221320668 + -0.11590925754608988i, -0.01712004648182355 + 0.03481789219316723i, -0.009013583483725145 + -0.13154918318669737i, -0.0389643873858786 + 0.07556899439371935i } }), Matrix({ { -0.07026657566492048 + 0.0049860181899110696i, 0.0063403560635592925 + 0.011968052101370523i, -0.04205604145766708 + -0.017725810967299308i, -0.10428483575036185 + -0.034305481851269554i }, { 0.020139824068411475 + 0.05848023903979696i, -0.0739884166457265 + -0.039393136583260775i, 0.04495791942663543 + -0.0006678614466727049i, -0.0860048779037455 + 0.032588864361021944i }, { 0.03469247804881871 + 0.0011915124473075404i, -0.03247069319738786 + -0.03547244803431773i, -0.05330907121487609 + -0.10924893181063781i, 0.04350980942814827 + -0.10893743306094125i }, { -0.017153013027563002 + 0.06007392517464836i, -0.03720098265460086 + -0.05425429890577952i, -0.030366774263694857 + -0.03034461559054624i, -0.11253730229755887 + 0.04405712281952277i } }), Matrix({ { -0.05131821180378605 + -0.10917072970381037i, -0.008720377622539317 + 0.15801889498597407i, -0.02234966009332859 + -0.10348001037850794i, 0.10395309554760704 + 0.03470710958096122i }, { 0.23640379263911895 + 0.06500393791402892i, -0.00993730430052872 + -0.04067139482020474i, -0.010081117506969009 + -0.1765408575604286i, -0.1627550870686021 + -0.049700964879848354i }, { 0.20052316606641113 + 0.08186522738805499i, 0.03708220438218812 + 0.0017768460967951686i, 0.06698211876179781 + 0.18278388062765674i, -0.0858521115471389 + 0.08269357811792434i }, { -0.04958538936164357 + 0.05968335155730657i, -0.07974237242383804 + -0.23339714528826425i, 0.12724893539956925 + 0.03472598368045574i, -0.15090827713938912 + -0.02322691175331486i } }), Matrix({ { 0.09214360457966121 + 0.16709024479605056i, 0.03605523896361409 + 0.13797720159676183i, 0.022184661585681758 + 0.10018376595242875i, 0.12370841030468292 + 0.020106120238195465i }, { -0.14704845197960628 + -0.05117424079067464i, -0.12754813324276834 + 0.1718276377460072i, -0.019057742268755756 + 0.016600573532500315i, -0.14751813128956093 + -0.038236303272635296i }, { -0.027606561573254747 + -0.08970208886583284i, 0.08962566752801143 + 0.015453565985425851i, 0.13352036642653212 + -0.18105578366496183i, -0.07289439269809429 + 0.05885327151526669i }, { -0.011846723470346682 + -0.022574223487360247i, -0.0011902900158992436 + -0.08401306679328714i, 0.06324770157106825 + -0.04307923926708972i, 0.19290589550006018 + 0.011767045428849163i } }), Matrix({ { 0.026265062964840664 + 0.12865524642461845i, -0.10403578753407978 + -0.009214683826121672i, 0.04605031683901424 + -0.0729162564661553i, -0.024149732528509542 + -0.07390125299724491i }, { 0.04138445806538062 + -0.0870230474939103i, 0.13572054952983542 + -0.15724294182766044i, 0.10043117796742929 + -0.028877654739636226i, -0.055071168909642206 + -0.019503612222526223i }, { 0.03467612813364836 + -0.029401908781573456i, 0.1230834279463994 + -0.17241004040842955i, -0.015704833015381624 + -0.08110097923792634i, 0.012060606908781761 + -0.19482788036090987i }, { 0.038052473369407674 + 0.13953450197108247i, -0.018019585989109493 + -0.048450386107205874i, -0.09749737087838448 + -0.031488152675791775i, 0.07010407388363485 + 0.12913062319428753i } }), Matrix({ { -0.03054715644254382 + -0.07420287296715027i, 0.06312374331474355 + 0.04815594681906134i, 0.07768251450158635 + 0.018829088795460965i, -0.13078377939785726 + -0.06087013488279982i }, { 0.05962968025221979 + -0.04760496103073255i, 0.0453206552292299 + -0.012508507827399503i, 0.08837015176500086 + -0.06723413254726371i, 0.14351508649790087 + -0.05805698987435591i }, { -0.05845894998943791 + 0.08415971467255823i, -0.09307528878504603 + -0.05489669773675541i, -0.1291851124618569 + 0.05395628405932788i, 0.034396849592603515 + 0.10890997704708706i }, { 0.14165797122966428 + 0.05893585208048455i, -0.13623949429259086 + -0.10205795824598211i, -0.0723628371366896 + -0.020568143818447102i, 0.045334990197289676 + -0.0005436095341346434i } }), Matrix({ { -0.08224182238625435 + -0.02331446064431488i, 0.009673267090330983 + 0.09918744614788948i, -0.09958357617222022 + -0.03172997332527596i, 0.06376618320884012 + 0.03416753482519249i }, { 0.1219071715901398 + 0.1634488203685575i, 0.12124813090702587 + -0.021356524486690592i, -0.011598866938944982 + 0.02609442227150889i, -0.04121278197207044 + 0.17681800368738604i }, { 0.04981581453903833 + -0.09684443065458002i, 0.03311682465897576 + 0.07178078149541027i, -0.06637008990051982 + 0.11237584401788211i, -0.06845446981076503 + 0.03078756942594597i }, { 0.030596032027123295 + 0.07216048592953658i, -0.028422145056563815 + -0.07892369543842408i, 0.07887707542089127 + -0.07836480077361123i, 0.1587803285354643 + 0.039824377017814994i } }), Matrix({ { 0.07947707915045459 + -0.000662962593607444i, -0.03630863831727493 + -0.2508883826441619i, -0.11121730000232466 + 0.14256509659013678i, 0.14531493936153325 + 0.06556668534135662i }, { 0.11383322548142553 + 0.04309173461034009i, 0.03916484981270463 + 0.1404523586751421i, 0.023829725475987905 + -0.04643245971178731i, -0.05782438102076578 + -0.08976389837864888i }, { -0.1063169006336944 + 0.10619008031348189i, -0.14257614904330168 + -0.11681543969360583i, -0.053535931350365974 + 0.12893808657870542i, -0.170272268595004 + -0.028175847862254202i }, { -0.04445824476830565 + -0.010840415174245737i, 0.02332432678000219 + 0.04604122617413196i, -0.017604470806611972 + -0.10199452091314994i, -0.12123507247058002 + 0.0807096536656199i } }), Matrix({ { -0.061390523606004 + 0.11101932358681299i, 0.08440742869351077 + -0.0826398189049191i, -0.05492436047165899 + 0.009464898730964084i, -0.07005911023141723 + 0.04126144812550978i }, { -0.13237051848394782 + 0.03702509504464144i, -0.005902493605501389 + -0.009294144393491984i, 0.12897621152156621 + 0.03299997596206476i, 0.036845048864290346 + 0.08602942334604961i }, { 0.014251201370294243 + -0.0031057055825750544i, -0.09739208326567875 + 0.0033899232025711365i, 0.1536296392358601 + -0.037809561651052266i, 0.05404304134577335 + 0.01051467897195202i }, { 0.039937539268011114 + 0.1113572063009331i, 0.0680142005913572 + -0.02177804899981099i, 0.0329589794419583 + -0.2564237117288145i, 0.07474987372776717 + 0.07799510540393272i } }), Matrix({ { -0.011732994655163906 + -0.14439810283530874i, 0.024900909572319836 + 0.055781400305909876i, 0.06907770578411483 + 0.08170998849519864i, 0.008269773127285392 + 0.1588455718975376i }, { -0.12907473773236644 + 0.04224183790504322i, -0.15100870827674207 + -0.10686531022204432i, -0.021748797647024462 + -0.07749092769811186i, -0.0319223664861144 + 0.11656831583242473i }, { -0.045160378175937745 + 0.027878668976292223i, -0.023693304752042305 + 0.07338651922661803i, -0.08864013440328422 + 0.02850377021561597i, 0.01605913272453417 + -0.15278045483735994i }, { 0.04972605799164954 + 0.15193815682221365i, 0.09293327971659414 + -0.02384427449637433i, 0.0033197626573034014 + 0.029645380073277713i, 0.02557101430984356 + 0.12809055705862094i } }) }, { QubitIndex{ 3 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.09757344135746603 + -0.16578806802292212i, 0.3090195253489445 + 0.815239734112451i, 0.18042812190379887 + 0.26046049139444793i, 0.3130747035989695 + -0.06689621914211513i }, { -0.6693736395309259 + 0.45717584336961986i, -0.05731995797720746 + 0.07504156583727653i, 0.22466110640863945 + 0.15745224751658693i, -0.2742802199092089 + 0.42839106286237705i }, { -0.24758837248050453 + 0.16233716306539384i, -0.09618290867394494 + 0.378751621619338i, -0.33711910972774717 + -0.7487459420433398i, -0.12204834036384543 + -0.2654752780288776i }, { 0.45749385180503044 + 0.0947044763684304i, -0.04124976965839931 + 0.27671069439836443i, 0.38739160878314594 + 0.0004047745804148517i, -0.7350878135814043 + -0.11416466069295558i } }) }, { QubitIndex{ 1 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.0625487573141037 + -0.1779812071162542i, -0.13474696422585244 + 0.06671370295248265i, 0.036436931095028845 + -0.05924702936531438i, -0.05993506305344382 + 0.05048731533940915i }, { -0.01640184619809787 + 0.025890387224773194i, 0.025959649434437355 + -0.06586605324767465i, 0.05159039431767662 + -0.010117237930271741i, 0.022861764769724846 + 0.15794255324271514i }, { -0.0769534748985917 + 0.08386641901713834i, 0.06577370205721422 + 0.04223589341642152i, -0.023383302325027458 + 0.09068999713513812i, 0.006193989096672206 + -0.10104175557290834i }, { -0.04456403368688154 + -0.15243392832525035i, 0.10165263993443165 + 0.10208781717156053i, 0.1475021571667179 + -0.05598632519511225i, 0.01943158344454792 + 0.13475030841555652i } }), Matrix({ { 0.0759151226832014 + 0.00796542449469857i, -0.04943490681512208 + 0.12914366692081305i, 0.07417962562016982 + 0.06456022553491092i, -0.0003767095364417827 + -0.060886242537923956i }, { 0.115090233524698 + 0.07526419499014017i, 0.17054075055743234 + -0.1024549330253048i, 0.20511158306273267 + -0.018273119518414416i, 0.0772808764836361 + 0.06300403352272882i }, { 0.042974073202431955 + 0.05007238478359572i, 0.03117848683601252 + -0.03480291345177636i, 0.07571656680231642 + -0.18703351730487414i, 0.03405296359040864 + -0.020686964988125767i }, { -0.09242793010052983 + 0.14516160590379834i, -0.004681421387131715 + 0.14641870667068438i, 0.009356248746201154 + 0.07449532686282752i, -0.16163384738308814 + 0.02852756957718518i } }), Matrix({ { 0.09925976400046835 + 0.1250015664991293i, 0.04308682112515155 + 0.006617292967703217i, -0.08238523951457774 + -0.1005723290917574i, 0.18520728669960043 + 0.023678366571801696i }, { -0.03237246249011422 + -0.06705774193759015i, 0.037529086639444174 + 0.06477134559740752i, -0.08798156921770255 + 0.016552532191795966i, 0.09484982831913905 + -0.0276977923791322i }, { 0.05665905550267865 + -0.020071955223432726i, 0.024429868914474486 + -0.019201048720780413i, 0.10036286071518218 + -0.04648504560928221i, 0.0957293581842305 + -0.015784277820447796i }, { -0.0026909500181877344 + -0.03992224903071233i, 0.039371366171660406 + -0.15983337055045313i, 0.056392379615824766 + -0.11370704829339304i, -0.10785702194603525 + 0.05780911583779867i } }), Matrix({ { 0.06643936873617041 + 0.07701594413336035i, 0.05013434037300909 + -0.0016220404766313342i, 0.018241168624224105 + -0.18283450032216628i, 0.0588416180955905 + -0.1963902205742652i }, { 0.014543480506807687 + 0.058218204856600196i, -0.05949905338833855 + -0.10119939668836735i, -0.08356171562243912 + -0.008592544497245766i, -0.04137603405498486 + 0.0024547959102482284i }, { -0.09332781489254352 + 0.0625530679721174i, -0.030917005093170052 + 0.009421631709493549i, -0.06780532953019404 + 0.058318532395251386i, -0.007196147740249721 + 0.06672512794119602i }, { 0.020263745673244696 + -0.0375609799042287i, -0.10003045635526683 + -0.14082676941750352i, -0.04548193955670624 + -0.03858082836625383i, 0.01700762367191206 + 0.07865342327099144i } }), Matrix({ { 0.10525609817750689 + -0.09166045381606622i, -0.06457032743719589 + 0.014708669471769865i, 0.04935718034234803 + -0.15570806574989082i, -0.102570066618798 + -0.011985109108755757i }, { 0.05016274613947428 + 0.07319876717380489i, 0.042518280110787725 + -0.05454943172240258i, 0.0809916656952569 + 0.008386652624308436i, 0.11432191047765024 + -0.12278744201986162i }, { -0.0831820550199601 + 0.03711145761255207i, 0.01404843396112163 + -0.03198163136953961i, -0.058388416442279024 + -0.09298329080422155i, -0.22280269061923325 + -0.019606951333342823i }, { -0.047675510591985604 + -0.10562375863470937i, 0.03749673414359082 + -0.15264191191958568i, -0.1086926487751409 + -0.053638766515973026i, 0.0035731166720093786 + -0.06750066078282778i } }), Matrix({ { -0.10057228453271108 + 0.027359283610938808i, 0.00783076182821693 + 0.0074351922178179436i, 0.11630162786554157 + 0.11353631570691887i, 0.0869141651312739 + -0.07213912978801515i }, { -0.09997410820953258 + -0.06335481218589957i, 0.12097166132653257 + 0.13185700544428644i, -0.07009755818664704 + 0.01495873876605384i, -0.013066234242044087 + 0.03548477809691405i }, { -0.06425133595846456 + -0.008553765315391145i, 0.09835402954746925 + 0.05153993960644066i, -0.09976738475651982 + 0.10216727937068937i, -0.15135387067291411 + 0.05328089195300478i }, { -0.050859795728386115 + -0.11120079745228577i, -0.12700811766638717 + 0.09927739498681923i, 0.00919173800903004 + -0.07753873050273004i, 0.0031078735768529406 + -0.057519038747835254i } }), Matrix({ { 0.03127320595448447 + -0.011986067316739967i, 0.0643626292521236 + 0.07293034934670445i, 0.032238813555907124 + -0.037932033466750475i, -0.07945872286958115 + 0.11015453036747203i }, { -0.04876768126351656 + -0.05079355054960152i, -0.03980245557904258 + -0.10276396488717181i, -0.04236697398697235 + 0.07260461965293495i, 0.11976893476711883 + 0.1352768754157301i }, { 0.10116856599169434 + -0.08468303471422754i, -0.017123996363786337 + 0.021049791906584275i, 0.011767324608261378 + 0.17086036358053242i, -0.03513810451273327 + -0.1573304034738675i }, { 0.03548196174186135 + -0.07179328023447808i, 0.10200822745410917 + 0.07705216618379508i, 0.13574866023676635 + -0.1537869055666172i, 0.08772394106937222 + -0.06389858920443281i } }), Matrix({ { 0.000975639541787583 + -0.03918888853709132i, -0.08071533093951973 + 0.08832678389865234i, -0.022764513257524297 + 0.17263843428297976i, 0.0054861409244333975 + -0.0290015040748694i }, { 0.09981317501872017 + -0.011323666152990956i, 0.03560863154005106 + -0.09760304304955457i, 0.008500418870891435 + -0.11167075114750886i, -0.01838451363591131 + -0.0319331159992044i }, { -0.21770176074327002 + -0.036675930542676406i, -0.1599557460424927 + -0.011634207494721816i, 0.0693681129112488 + -0.19657228057999918i, 0.007696024698363955 + 0.05863238001251963i }, { -0.07536545843547594 + -0.01750939370936779i, -0.07146477321494044 + 0.03116744818965163i, 0.09358704422122976 + 0.013470510848834471i, 0.0899276545976102 + -0.023441424940339208i } }), Matrix({ { -0.08388154086830663 + -0.08548183335395294i, 0.05024789533876869 + 0.0859477629514234i, -0.052550609372247425 + 0.07665837408763417i, -0.01202305342548403 + -0.17597714188274113i }, { -0.050995938577702404 + -0.08681984731245228i, -0.05273107273662322 + -0.07124059208118272i, -0.0807247043086101 + 0.017846262576801126i, -0.1706495647202992 + -0.07605926152845355i }, { 0.10983831973091657 + 0.11267515105948762i, -0.04717944348272448 + 0.01318435232212504i, 0.12002424962413437 + -0.09705509746285428i, -0.14412936363689963 + -0.055760030610230646i }, { 0.06939654917191741 + 0.025284490902265123i, -0.10599560079461556 + 0.09450217849529162i, -0.08030330676697688 + -0.035804734705680775i, -0.03264917688033297 + 0.011729449863939296i } }), Matrix({ { -0.06446563247610788 + 0.07107203218721596i, -0.07373740448956646 + -0.12043397470364481i, 0.0726286937141736 + -0.016121596225579366i, -0.17095750984177324 + 0.016392642028350262i }, { -0.05688268819229744 + 0.11067728483330788i, -0.111946108827813 + -0.10499560261119956i, 0.007612482737274337 + 0.05781337549091437i, -0.08984484251849756 + 0.02490019744947571i }, { 0.17534751731320466 + -0.1466802260794094i, 0.06493566639976257 + 0.02690626409192768i, 0.04362213433132233 + -0.015907962203633705i, 0.11207128195968197 + 0.01106923378008141i }, { -0.08206811082585735 + 0.15365659437370133i, -0.06681717397821657 + 0.21108756594484548i, 0.014364193222476368 + -0.19746766133501323i, -0.03579175345899526 + -0.19427500765360814i } }), Matrix({ { -0.1814211065882405 + -0.12989291872435393i, -0.022811613065240384 + -0.0973652307668359i, -0.01187846907700638 + 0.03551041513366354i, -0.040061859876197155 + -0.051453434841168204i }, { -0.05133063079505966 + 0.016847218726522402i, -0.004272560234928125 + -0.04813095982937635i, 0.01885341277675235 + -0.16206948974200572i, 0.05011015624803415 + 0.03453643386878199i }, { 0.09322826857633276 + -0.08514920230404613i, -0.02926234253711963 + -0.07997042304027556i, 0.08793104333412753 + 0.055789525569538735i, -0.04961096115875253 + -0.036773392609467076i }, { 0.18261512256489282 + 0.01660226520892464i, -0.16857536106862053 + -0.08664323849627556i, 0.09290554630726813 + 0.04580030208078512i, 0.08139219016501124 + -0.056087588609413604i } }), Matrix({ { -0.032614978054075906 + 0.14759660274204695i, 0.10686692806204708 + -0.1026126107079123i, -0.16958874265465945 + -0.1375467620274797i, 0.15054485166288112 + 0.08193214101324962i }, { -0.06854967227859218 + -0.07356563992223215i, 0.0950429858199357 + -0.0022486124335460325i, 0.01003567981994977 + 0.00040466758557849476i, 0.23664827371040686 + 0.07072138014668478i }, { -0.057284564226314845 + 0.1374586167804663i, 0.009899807142427249 + 0.09647682309724669i, 0.03509958348945168 + -0.10249278970097409i, -0.022546757164397156 + -0.14814216852581033i }, { -0.05450145615421528 + -0.03304394440581039i, -0.03766765090409656 + -0.016475449367605113i, -0.06609105011310934 + -0.05361838052074687i, -0.0790449501853541 + -0.007562357954003726i } }), Matrix({ { 0.1159061191666466 + 0.11310129687907958i, 0.14069294884810307 + -0.06402637771559637i, -0.018583495995884807 + 0.01867324778390127i, 0.012630051007299692 + 0.13245417150112598i }, { -0.08119169171631774 + -0.05086650550381346i, -0.0010491881612649915 + 0.08520967521897779i, -0.13892608907666942 + 0.03240256880257504i, 0.06890137973295611 + 0.03006751079921816i }, { 0.08490184079441804 + -0.13745783582334506i, 0.1251352767851354 + 0.0551794410323978i, 0.08729513722305786 + -0.014760434436044878i, -0.09837397521240866 + 0.10156444124503176i }, { 0.008208772512144127 + -0.02919341509620964i, -0.0851172088309356 + -0.10195693710094048i, -0.008739575812172936 + 0.02343190974630166i, 0.0042079577063626064 + -0.00929943860323052i } }), Matrix({ { 0.1602356807673087 + 0.015051090181020872i, -0.0511826173355904 + 0.06729349819372352i, -0.04539920216764396 + -0.16040549480619307i, 0.07278205577092169 + -0.024935948008869734i }, { -0.0660492047326666 + 0.12813501524382856i, -0.11624951296410885 + -0.08887383055186002i, -0.09273317864399314 + -0.008377726750690428i, 0.07311780626300664 + 0.06937254301451454i }, { -0.051065525128529174 + 0.017882307707594643i, 0.09986521968118914 + 0.1760651336420287i, -0.03951271836639365 + -0.006912624089301871i, 0.011556326027067944 + -0.12600216205949338i }, { 0.003028762863383279 + -0.09816367581584758i, -0.12204262532257179 + -0.1138950061123412i, 0.21380765548093317 + 0.04640149941033456i, -0.11454768033001761 + 0.0007487107570235478i } }), Matrix({ { 0.10456173417682094 + 0.13394193352419825i, -0.21550982464100826 + 0.005717809271358036i, 0.17583932782652603 + -0.025299394085154192i, -0.2101645235812409 + 0.002741364589677301i }, { 0.05992421825041777 + 0.15677209637465558i, -0.07359094605257281 + 0.0677127675572519i, -0.04616813974322898 + 0.09649063182570934i, 0.03175731888905781 + -0.04046705630507481i }, { -0.003942344729765561 + 0.14190066468098533i, 0.0563694386359359 + -0.02135587601078178i, 0.0087965801991427 + -0.22566359496762547i, -0.016701943331086315 + -0.20928043872791297i }, { 0.10736635730605064 + -0.1543637780095402i, 0.019207393377538417 + 0.06518857061990083i, -0.051260218038890026 + 0.04001911285419974i, 0.07168579911626001 + 0.03982041597898961i } }), Matrix({ { 0.004671060242961143 + -0.061445743463901706i, 0.014336718922596631 + -0.09867161756300276i, -0.05035490983805429 + -0.033077660329324875i, -0.04581747079652392 + -0.08062092497326587i }, { -0.06980776947380773 + -0.06756756221954753i, -0.17944037708071708 + -0.0885476202525214i, -0.0016859872711104454 + 0.011445593772275506i, 0.0012245418620953307 + 0.06904941975902021i }, { 0.008316820788453794 + -0.015488406608560273i, 0.0299680244522792 + -0.11766954651467534i, -0.10233878135498448 + 0.016921516673209906i, -0.0337656014981135 + 0.03743600448447191i }, { 0.19541460929659282 + 0.05631182026821051i, -0.21567337860274674 + 0.05494323717332399i, -0.1314484706274333 + -0.03474836579389443i, 0.09513009757795261 + 0.02973953323298422i } }) }, { QubitIndex{ 7 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.12939933336919515 + 0.06389170085008095i, 0.07658690071269997 + -0.4025032462271802i }, { 0.10795736815450908 + 0.22783096793225552i, 0.179846693494651 + 0.3295122514877974i } }), Matrix({ { -0.04108699123505804 + -0.3006836934456132i, -0.2705763886684764 + -0.377491071454889i }, { -0.7496981414596133 + 0.02159529433033613i, 0.0047830468306939815 + -0.34680544329467566i } }), Matrix({ { -0.2318276218902599 + 0.11807448923344736i, 0.24626725980001044 + 0.09167281077081918i }, { 0.07000075052916423 + 0.2526364643070765i, 0.1513314965063265 + 0.05684598979778735i } }), Matrix({ { 0.25092796411436735 + 0.0018631041532650523i, -0.37334394649027736 + -0.04317314798157253i }, { -0.10423885218026438 + 0.2252875125555144i, 0.26560627915386825 + -0.2195767923004475i } }) }, { QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.10149942300256254 + -0.31046501425499795i, 0.28954620555197974 + 0.33272734818594035i, -0.5371400560042923 + -0.31966196098181454i, 0.5265617752303208 + -0.1754831515463891i }, { 0.36351430346651614 + -0.37973098168249886i, 0.07342074591951808 + 0.08361865826623062i, -0.23069597148323812 + -0.29341400601977213i, -0.7283522941194502 + -0.20364079220000136i }, { -0.282415238840216 + 0.6664315778505314i, 0.1703499501513315 + 0.5169863187571254i, -0.159238486410548 + -0.19209383496231636i, -0.31911468352561817 + 0.12540138511739835i }, { 0.29202205154979266 + 0.08834467218013149i, -0.635550830369939 + 0.30471954875828894i, -0.46796114536778294 + 0.43444195261394986i, 0.04740277088014577 + -0.012845718142511703i } }) }, { QubitIndex{ 1 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.13418679635807607 + -0.21523349162903224i, -0.26969998134034845 + 0.3071544708842373i }, { -0.00414335439599723 + -0.06264499063689682i, -0.3638963382863021 + -0.2866577885252166i } }), Matrix({ { -0.10293483235908224 + -0.5640869117738069i, 0.42169217038105566 + -0.057863745827824664i }, { -0.2486085713713525 + -0.2645953618431247i, -0.4539487566081166 + -0.14924211169074367i } }), Matrix({ { 0.21674160494842465 + 0.23912841687905656i, -0.040116390973151464 + -0.19735028438359398i }, { 0.20738936356180204 + -0.4918921755822265i, -0.1991384845950489 + -0.1854077384220719i } }), Matrix({ { -0.13669905199310184 + 0.05208419844935194i, -0.0887008226174924 + -0.1664709493882027i }, { -0.10765843251719004 + -0.2213662537131872i, 0.1723362040640795 + 0.17012005152706708i } }) }, { QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.8842298868218019 + -0.10190873677649069i, -0.004340926739873425 + -0.4557776573887338i }, { -0.2100966167219977 + -0.4044892189684331i, 0.8286082503584702 + -0.3250480746261259i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.03379218825837982 + 0.2098783809449912i, 0.012026541692057073 + -0.31867663870665003i, 0.21851407948001034 + -0.13080554577748998i, -0.7952669926115571 + 0.39471715466597873i }, { 0.004891442264246593 + -0.5531680840391378i, 0.4187116916973165 + 0.12432678629497951i, 0.10423548835800456 + 0.5947820907816505i, -0.0777700041608177 + 0.3640406130414327i }, { 0.5392388175804304 + 0.37270291945975054i, -0.07413542648603486 + -0.4344946616623886i, 0.18925685807757733 + 0.535279491917073i, 0.21333633891590575 + -0.09043048528466474i }, { -0.45955252236983263 + 0.08897082916229894i, -0.6978969048794404 + 0.16180905218624764i, -0.005874940612173626 + 0.4981304307020812i, -0.13082336267464245 + 0.04868488874224092i } }) }, { QubitIndex{ 7 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.1040030305543338 + 0.02867311713042222i, 0.02392159309782467 + 0.00573131058321511i, -0.08391947472450366 + 0.03231572973830002i, -0.03597232620154746 + -0.14076542305878376i }, { 0.25634801997670936 + -0.14565471213779882i, 0.0033289601793930024 + -0.11806326577350836i, -0.11691194272477345 + 0.1169016619277546i, -0.0058468495791606755 + 0.010991279282030983i }, { 0.12353488938767039 + -0.033764673184952784i, 0.006651872762364366 + 0.08212972668110108i, 0.06328935764449964 + 0.0874942677050566i, -0.03131726848943912 + -0.009695806304798646i }, { 0.04630721623950197 + -0.11178170475735284i, -0.002348368341118467 + -0.1604966791787651i, 0.18644226138127395 + -0.02761753269966664i, 0.10945258928227147 + 0.18830883348727293i } }), Matrix({ { 0.035893309042836975 + -0.021852248714697643i, -0.12149628394331623 + -0.1288665354583568i, 0.09255823340869064 + 0.06346655501182376i, 0.0718056938840778 + -0.08599529902606996i }, { 0.028184841453599493 + -0.010532869624690789i, 0.12784351853951983 + 0.022390927181910242i, -0.040356186055553744 + -0.1741197490108719i, -0.004543918899014214 + -0.11789699874309059i }, { 0.12288947359398529 + -0.03806689850568661i, 0.13703475960463402 + 0.040825052271259966i, -0.18575975678811804 + -0.13844964484850317i, 0.03261310317501349 + 0.03455101999122637i }, { -0.043551762230349185 + -0.04284581379378484i, -0.06805570370896874 + -0.12322206192138913i, -0.03985250052058482 + -0.052063925490217454i, -0.09042629485237351 + 0.17878599506111043i } }), Matrix({ { -0.12229777627312824 + -0.07095641810143717i, 0.03936128089729405 + -0.15911584671788218i, -0.0036349886670866737 + -0.007952112206505699i, -0.009222114251454423 + -0.07494411993181102i }, { -0.09368020239539053 + -0.11550210075548087i, 0.08252100126370411 + 6.649743311401202e-05i, 0.017707084809672962 + -0.08472640215682928i, -0.08207737782850402 + 0.0039562298588167386i }, { 0.05794028084489864 + 0.11402060775259115i, -0.03880746908867039 + -0.03269043293099973i, -0.04263317289837474 + -0.05743691770166244i, -0.056241463165231514 + -0.12202608653557498i }, { 0.1369176943697711 + -0.05901314530141904i, 0.0882968910082732 + 0.058701361419836014i, 0.1935927576238778 + 0.047839388630936786i, -0.02286733600276119 + -0.012688723516057517i } }), Matrix({ { 0.15622920573257917 + -0.022509870395661675i, 0.02633250370130792 + 0.06001883200696387i, -0.1353020959279021 + 0.03259121692190652i, -0.018571064218459776 + -0.031061295711345135i }, { 0.06852462386732955 + -0.039288720345091246i, 0.11750864562713341 + 0.05722463670185662i, 0.01793205988490805 + -0.005487945515407798i, 0.03579372244864551 + -0.13451120228267635i }, { -0.033298132557125715 + -0.10283741286463446i, 0.03182340528076812 + -0.05392223205056401i, 0.12859153211295934 + 0.18626742020369633i, -0.012353540615071922 + -0.05320821469078131i }, { 0.08034371283336343 + 0.00844652168181298i, 0.026980739931076355 + -0.0037332354803068057i, -0.03877095883232134 + -0.04210916266832474i, 0.041463845019717 + 0.12080125803163733i } }), Matrix({ { -0.004607937270518374 + 0.041504590255642675i, -0.13508441509426175 + -0.03595564080816014i, -0.09047431871128966 + 0.034090877730514606i, -0.05178513767138961 + 0.05554063774226205i }, { -0.006297862334408174 + 0.12510389952018566i, -0.12919106482254694 + 0.0012011835264838246i, 0.0622931193753658 + 0.024326918370460287i, 0.030614889607322053 + -0.09673850051160264i }, { 0.06592028628774849 + 0.05123914390614253i, -0.1502615041608775 + 0.11983023293360381i, 0.05925136035777867 + 0.02222280207944771i, -0.03979208691793148 + -0.12251360951526215i }, { 0.06965497834973167 + -0.07622446779800077i, -0.0661848030881721 + 0.025319638665646793i, -0.047437092511632487 + -0.00862125727305818i, -0.020541964932973056 + -0.20169000808848417i } }), Matrix({ { 0.014051203101603203 + -0.09814524373664821i, 0.022297222435199205 + -0.057705543633188784i, -0.0010751586036433338 + 0.03833480313589218i, -0.011553926125845226 + 0.05855239326413961i }, { 0.09616586121857973 + -0.045303565374903876i, 0.0751921867429474 + -0.03405079182450668i, 0.08739437138894068 + -0.01887642840594793i, 0.009599924177195296 + -0.13441533506694572i }, { 0.12266075062500596 + -0.008063051206677187i, -0.22788100667157268 + -0.07541235083523241i, 0.002435853990621175 + -0.06660243600536268i, -0.14296289569780374 + -0.027242482258156727i }, { 0.11354069364656334 + 0.08417598340223616i, 0.1132421989533227 + 0.028660087435290096i, 0.03627475332336787 + -0.1911853546157825i, -0.13307001108982672 + 0.011726655711177793i } }), Matrix({ { 0.05778008510633396 + 0.06940535311852829i, -0.16836546435089197 + 0.019770426632695418i, -0.023672884434790962 + 0.027511655724106618i, 0.1044223189021839 + 0.0764602876187947i }, { 0.09723146718331147 + 0.006236748278519114i, 0.11727983869490734 + 0.06373856469468304i, -0.07302980150448522 + -0.04602490704947746i, 0.11953510424870921 + 0.09770150127120052i }, { -0.059537355748098326 + -0.1524059848673429i, -0.05280486392775309 + -0.11610802161199088i, -0.018840724254392434 + -0.055059337416375996i, -0.06294129887978521 + 0.005349951365159315i }, { -0.011424091681465739 + -0.016069039825117253i, 0.020695304683371347 + -0.028188935058874043i, -0.20777156822566437 + 0.10337475141901752i, -0.09040964697284408 + -0.05253246329160435i } }), Matrix({ { -0.08128416502218969 + -0.11865171148690237i, -0.019809942218096482 + 0.08927453861198231i, -0.07107551975326516 + 0.02816438187135128i, 0.12293640735799158 + -0.016535897564514537i }, { 0.09121642410251063 + 0.042537593103602944i, -0.12230355268455717 + 0.060100595973171626i, 0.05903320051146291 + 0.021095048649555144i, -0.08898431667481957 + -0.03324352530171633i }, { -0.0895673588563838 + -0.04503777223859174i, 0.020524916178062385 + 0.07030421029474339i, 0.06517508079228881 + 0.18782159894908435i, -0.030232369617796278 + -0.0001751180371066144i }, { 0.08059807536008413 + 0.04685315079635949i, -0.06619224556895352 + 0.057387112529405974i, -0.06779409742667095 + 0.07987735908717568i, -0.05318957587571931 + -0.0506457755159615i } }), Matrix({ { 0.16755902662523592 + -0.05691752142849529i, -0.11368039961963104 + 0.006595211652229384i, 0.022676271674657293 + -0.16159415213599113i, -0.04714045334899857 + 0.13453404087964999i }, { 0.12018157336542419 + -0.11296899482073228i, 0.02619331113115472 + -0.0013141479292675025i, 0.16931975682723172 + -0.011266746440681163i, 0.04656437298172966 + -0.11319638971457142i }, { -0.061571902093259405 + -0.07535991735510798i, 0.01727285858983494 + -0.08207260799312668i, -0.08238671595826437 + -0.0284886951508154i, 0.09491487979203253 + 0.012437323033866363i }, { 0.0630050866207687 + -0.0024025478212840864i, 0.04389908668350202 + 0.010979236944550058i, -0.00040222788849699083 + 0.09785385568361862i, 0.11758539298379538 + -0.07436060286389698i } }), Matrix({ { -0.03762589837205232 + 0.001808492959773696i, 0.06895984691315125 + 0.08426756068797082i, 0.0967897865327367 + 0.024652298342421223i, 0.06074169020464627 + 0.012498685280617598i }, { -0.025767894718533656 + -0.1286497263043827i, -0.0021525554593496863 + -0.051573448908656276i, 0.0068283848280019386 + 0.03585197708837548i, 0.04219320589570619 + -0.12925191995954552i }, { 0.06869633107969737 + -0.022865172806428267i, 0.028661217845318564 + 0.09374649186606596i, -0.08869505633155778 + -0.04717986057072426i, -0.13821391824435217 + 0.0034031685744755156i }, { -0.09283322499431063 + 0.006959657033718786i, 0.06770067913984569 + 0.1411996174177428i, 0.0028864362208704908 + -0.1887826676590299i, 0.15548270616881277 + 0.0802039821910917i } }), Matrix({ { -0.07707414774835766 + -0.06786439413858959i, -0.028667728078139276 + 0.0004536339087870291i, -0.10669688110338321 + -0.07320724252098944i, 0.11920040108116438 + -0.07388082243667203i }, { -0.14715354321642815 + -0.11261335915676515i, -0.05690326994150041 + -0.08756031250316632i, -0.013024757530287848 + -0.024908627279293334i, 0.038188921285486684 + 0.05206452026317893i }, { 0.060410194932465605 + -0.10652966239627099i, -0.07267461547574161 + -0.16573988062916747i, -0.08653890016798253 + -0.020677681786197773i, -0.19247218765783974 + 0.04390711056677674i }, { -0.09149831580234881 + -0.020237143481161825i, 0.09059182564785503 + 0.13032289833701874i, 0.026018066065472863 + -0.05627953416484354i, -0.10422349922335596 + 0.11796974563055829i } }), Matrix({ { 0.033072611241932455 + 0.09141330395031474i, -0.1492085700496914 + -0.15705486639010838i, 0.08464541627710397 + -0.027431866769221443i, 0.0703692747240905 + -0.06153824523236796i }, { -0.04349391288584146 + 0.09746566503968261i, 0.08167484943198777 + 0.1417288258551631i, 0.1289020858477549 + 0.12292033541765088i, 0.13670947903855668 + 0.0022477911296400884i }, { -0.039148951992284214 + 0.13115731695312807i, 0.18586510992706867 + -0.1485168587188063i, -0.0430340071761792 + -0.15470985153300076i, 0.014767597972099335 + 0.17163146282866873i }, { -0.11322994653034271 + 0.01045731008644103i, -0.12078311330616433 + -0.054333270024494555i, -0.005378232129979332 + -0.038884624205602944i, 0.0008978349813295986 + 0.061810269233808765i } }), Matrix({ { 0.033367090133641246 + -0.04035401944368436i, 0.010939441738830945 + -0.039688456389978324i, 0.020701219092256244 + 0.020698305535718622i, -0.12656343525751024 + 0.1519319392348789i }, { 0.005373600609176313 + -0.0017872305082324105i, -0.06978111068304105 + -0.03927120926745504i, 0.02607573650183807 + -0.04572769176165538i, -0.0220844841510698 + -0.16559766992257843i }, { 0.02248239949119848 + -0.04251906196110585i, -0.02790405826158692 + 0.13740187695618508i, -0.3211472075465992 + 0.11175281390844763i, -0.04498727191126492 + 0.01609319290712918i }, { -0.15178735751545377 + 0.017100952280900358i, 0.14698956028016955 + -0.08592680735805792i, -0.011871031526410464 + -0.057154115279221665i, 0.023683812995640596 + -0.024644050078705047i } }), Matrix({ { -0.07019095685006647 + -0.07191209323703672i, 0.1823816771048927 + 0.14970131275603266i, -0.21547369330478844 + 0.011054909206250825i, -0.036080118696811964 + -0.05457407093177572i }, { -0.03193595395170005 + -0.015306816511315173i, -0.1308207116910173 + 0.09900310405989975i, 0.049003520744448525 + 0.037036027593929065i, -0.0701650310027282 + -0.12226469293099151i }, { -0.13862361823312427 + -0.08441003505640543i, -0.05711861132892733 + 0.017206780657028926i, -0.004015076866720237 + -0.06549525293352253i, 0.004757388545767778 + -0.005037757302095744i }, { 0.02103307798868819 + -0.007655447211605626i, 0.055637826949236115 + 0.08086245868935354i, 0.01135915113345353 + 0.008846806504271037i, 0.03998349574505668 + 0.15558715636758141i } }), Matrix({ { -0.10066359646692752 + 0.02697837924387285i, -0.04811773746470567 + 0.009122626880563825i, 0.145694550358896 + 0.0005187853439055332i, 0.045171398550975315 + 0.08391947477204915i }, { 0.01372972456206995 + -0.08031142155100816i, -0.11697010944798296 + -0.012868092569516138i, 0.06695544261015779 + -0.09823315729283619i, 0.0009495878079473701 + 0.034162468784751765i }, { 0.28087591607955587 + 0.06743251263810461i, -0.11268316319154253 + -0.13539347240592953i, -0.050851463106866106 + 0.04998484774431001i, 0.022970255501942607 + 0.1471681431237966i }, { -0.02052052195838982 + -0.06355131621182479i, 0.06347296915660468 + -0.06436332519571748i, -0.012340137643956677 + -0.07532142391881193i, 0.05386260819266634 + -0.1748256768362704i } }), Matrix({ { -0.1477195930297851 + -0.0019414331588003i, 0.051341696585826574 + 0.13119045620260641i, -0.10722032780924674 + 0.08951133455358325i, -0.014844790529958053 + -0.1439748770316901i }, { 0.09490640115050741 + 0.05978798302836019i, 0.014999461446718734 + 0.015009167866491532i, -0.04876218832151503 + -0.0361379744662233i, 0.22110941160625275 + -0.09268184020434618i }, { -0.24033024302977263 + -0.17680454573288326i, -0.06912558104937669 + -0.048427852400064565i, -0.040646328712674346 + -0.1136554508809297i, -0.08350595629243675 + -0.060220073334315796i }, { 0.08979414331859051 + -0.05048033998437493i, 0.02807493888208242 + 0.04111260915910182i, -0.04940587846278816 + 0.010421810642523217i, -0.0648149649216857 + 0.07384789070097154i } }) }, { QubitIndex{ 2 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.4945036161944278 + 0.4534802071285582i, 0.4880467186271511 + 0.5582403386987944i }, { -0.2415292450567171 + -0.701060267805562i, 0.6393703433009059 + -0.20342981294295964i } }) }, { QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.12086329639051652 + 0.054315470428004824i, -0.3356038324382595 + 0.5075420504702921i, 0.302314158143973 + 0.7052225392068742i, -0.15055769457108634 + 0.028508393513432588i }, { -0.07991445690945187 + -0.14579738898690506i, -0.46334120810003987 + -0.22710337418549803i, 0.41655266024514137 + -0.29316395790801447i, -0.4752599636619502 + -0.46985372747044524i }, { 0.4211466017209613 + -0.07780128747618988i, -0.3991280650058452 + -0.3987272488069562i, 0.2614611047987957 + -0.06707143406899851i, 0.1848392351481776 + 0.625515658372048i }, { -0.857657357281054 + 0.1892222270952427i, -0.1302747322698217 + -0.16808325283226105i, 0.2575428721953119 + 0.11232665488397686i, 0.19553806247511601 + 0.25732193499892414i } }) }, { QubitIndex{ 3 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.14960150089460897 + 0.5962858247892868i, -0.20105508302261668 + 0.49540827677149196i, -0.10301176046049122 + -0.0232745936862653i, 0.5599787459393527 + -0.10714837177609905i }, { -0.13811876675337517 + 0.3318959931782248i, 0.19082464639379865 + -0.6466320122967381i, -0.386070461822168 + -0.3153208947932401i, 0.16851479400094813 + -0.37329123617163296i }, { -0.5095052563370913 + 0.103756637486885i, 0.2926493105367313 + 0.37529472346145154i, -0.5609025196569843 + 0.31259022361313527i, -0.29888927396148796 + -0.038602111099903906i }, { -0.1978952108404381 + 0.4281440196206353i, -0.0794129876408257 + 0.16372023966861612i, 0.4587665139722315 + -0.3428967825927807i, -0.5656583636597473 + -0.31049177488844204i } }) }, { QubitIndex{ 7 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.3636905914334825 + -0.08006595981855959i, 0.2756972215667 + -0.4054416407372178i }, { -0.02292766232450107 + 0.42944422893563844i, -0.04927521233771685 + -0.4803300012172519i } }), Matrix({ { -0.03693523752014372 + 0.03883823679890572i, -0.03942707476860975 + -0.10490738475050271i }, { 0.028801684152871904 + -0.3890302516153048i, -0.4509863999391422 + 0.01143032842852075i } }), Matrix({ { -0.4277523964063258 + 0.41294523191577853i, -0.24989463131077222 + 0.17939430290952185i }, { 0.31353719388185836 + -0.08250504001964515i, 0.334090739108609 + -0.24348156589070813i } }), Matrix({ { 0.11359130113013044 + -0.17387234821630038i, -0.08536446800655478 + 0.12509361224189497i }, { 0.04146757626169835 + 0.13364583947167424i, 0.10116632577624281 + 0.10809280810706268i } }) }, { QubitIndex{ 0 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_30_2_30_30_30) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.45369053700790674 + 5.836057006582129e-19i, -0.07654714914182448 + 0.21998325247759948i }, { -0.07654714914182448 + -0.21998325247759948i, 0.5463094629920923 + -2.036267205199338e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.45369053700790674, 1.0e-7), DoubleNear(0.5463094629920923, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.534051536006068 + 1.0164395367051604e-19i, -0.01047335556793529 + -0.019375122780023964i }, { -0.01047335556793529 + 0.019375122780023964i, 0.4659484639939308 + -1.5543054582116411e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.534051536006068, 1.0e-7), DoubleNear(0.4659484639939308, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.45007463018260296 + 7.047314121155779e-19i, -0.018120999427040624 + -0.006943372612900277i }, { -0.01812099942704062 + 0.006943372612900275i, 0.5499253698173958 + -2.157392916656703e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.45007463018260296, 1.0e-7), DoubleNear(0.5499253698173958, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.5105436785494282 + 1.796556881126371e-18i, 0.020228178774127956 + 0.01460392670105704i }, { 0.020228178774127945 + -0.014603926701057033i, 0.48945632145057083 + -3.249218385667496e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5105436785494282, 1.0e-7), DoubleNear(0.48945632145057083, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.999999999999999 + -1.452661504541125e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.999999999999999, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.4942067746809583 + -1.9651164376299768e-19i, 0.007977517551891855 + -0.02153197811211359i }, { 0.007977517551891853 + 0.021531978112113593i, 0.5057932253190407 + -1.2561498607781274e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4942067746809583, 1.0e-7), DoubleNear(0.5057932253190407, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.5378575367231538 + 1.8914245712188527e-18i, -0.001782039439851861 + 0.002149118768274493i }, { -0.0017820394398518602 + -0.002149118768274491i, 0.4621424632768451 + -3.3440860757599777e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5378575367231538, 1.0e-7), DoubleNear(0.4621424632768451, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.5307780896899406 + -1.802486111757151e-18i, -0.019995240987322874 + 0.03712383392593112i }, { -0.019995240987322877 + -0.03712383392593111i, 0.46922191031005844 + 3.4982460721602604e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5307780896899406, 1.0e-7), DoubleNear(0.46922191031005844, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.24232435759738236 + -2.202285662861181e-20i, -0.04086817284234337 + 0.1175028437870059i, -0.004849686110339258 + -0.00881903107496011i, 0.005215665465387818 + -0.0007011521958293221i }, { -0.04086817284234337 + -0.1175028437870059i, 0.2917271784086857 + 1.2366681029912785e-19i, -0.003282089968359443 + 0.003735739700089909i, -0.005623669457596032 + -0.010556091705063851i }, { -0.004849686110339258 + 0.008819031074960113i, -0.003282089968359444 + -0.003735739700089909i, 0.21136617941052432 + 6.056285572868247e-19i, -0.03567897629948111 + 0.10248040869059359i }, { 0.005215665465387817 + 0.000701152195829322i, -0.005623669457596031 + 0.010556091705063851i, -0.03567897629948112 + -0.10248040869059359i, 0.25458228458340654 + -2.159934015498466e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24232435759738236, 1.0e-7), DoubleNear(0.2917271784086857, 1.0e-7), DoubleNear(0.21136617941052432, 1.0e-7), DoubleNear(0.25458228458340654, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.204177996110668 + 1.4789195259060084e-18i, -0.034493261815703724 + 0.09898496284860435i, -0.008162280218281609 + -0.003116687905824859i, 0.0031245957547216653 + -0.003586165111016978i }, { -0.034493261815703724 + -0.09898496284860435i, 0.24589663407193502 + -7.741881137904305e-19i, -0.0001261791788506696 + 0.004249739030856749i, -0.009958719208759013 + -0.0038266847070754176i }, { -0.008162280218281609 + 0.0031166879058248586i, -0.00012617917885066984 + -0.004249739030856748i, 0.2495125408972387 + -8.953138252477955e-19i, -0.042053887326120754 + 0.12099828962899513i }, { 0.0031245957547216653 + 0.0035861651110169783i, -0.009958719208759011 + 0.003826684707075417i, -0.04205388732612076 + -0.12099828962899514i, 0.3004128289201572 + -1.2620790914089075e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.204177996110668, 1.0e-7), DoubleNear(0.24589663407193502, 1.0e-7), DoubleNear(0.2495125408972387, 1.0e-7), DoubleNear(0.3004128289201572, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.23169946778861691 + 2.4318315915670963e-18i, -0.039022666936339906 + 0.11240080294942117i, 0.009335294304914416 + 0.006665286667398774i, -0.005368852492350474 + 0.0031556087902555284i }, { -0.039022666936339906 + -0.11240080294942117i, 0.2788442107608111 + -6.352747104407253e-19i, 0.0013106033928961575 + -0.005311598772050622i, 0.01089288446921354 + 0.007938640033658266i }, { 0.009335294304914414 + -0.006665286667398772i, 0.0013106033928961575 + 0.00531159877205062i, 0.22199106921928977 + -1.8482258909088833e-18i, -0.03752448220548457 + 0.1075824495281783i }, { -0.0053688524923504715 + -0.0031556087902555275i, 0.010892884469213535 + -0.007938640033658264i, -0.037524482205484586 + -0.1075824495281783i, 0.26746525223128104 + -1.4009924947586128e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.23169946778861691, 1.0e-7), DoubleNear(0.2788442107608111, 1.0e-7), DoubleNear(0.22199106921928977, 1.0e-7), DoubleNear(0.26746525223128104, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.45369053700790674 + 5.836057006582129e-19i, -0.07654714914182448 + 0.21998325247759948i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07654714914182448 + -0.21998325247759948i, 0.5463094629920923 + -2.036267205199338e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.45369053700790674, 1.0e-7), DoubleNear(0.5463094629920923, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.2244393772490625 + 9.402065714522734e-19i, -0.03920403434652461 + 0.10795744156534004i, 0.003817208428612927 + -0.009932040603458401i, 0.003946376596262304 + 0.0037238859410810687i }, { -0.03920403434652461 + -0.10795744156534004i, 0.2697673974318957 + -1.136718215215271e-18i, -0.005291193408268434 + 8.02864208091017e-05i, 0.004160309123278927 + -0.011599937508655185i }, { 0.003817208428612927 + 0.009932040603458404i, -0.005291193408268436 + -8.028642080910224e-05i, 0.2292511597588442 + -3.5660087079406044e-19i, -0.03734311479529987 + 0.11202581091225944i }, { 0.003946376596262307 + -0.003723885941081069i, 0.004160309123278925 + 0.011599937508655189i, -0.037343114795299864 + -0.11202581091225944i, 0.2765420655601965 + -8.99548989984067e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2244393772490625, 1.0e-7), DoubleNear(0.2697673974318957, 1.0e-7), DoubleNear(0.2292511597588442, 1.0e-7), DoubleNear(0.2765420655601965, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.2406220509553802 + 1.5983511714688647e-18i, -0.04395725716346954 + 0.11650253397576825i, -0.0013724246848604144 + 0.0008169767139353709i, -0.005086879769469019 + 0.0015039386523991788i }, { -0.04395725716346954 + -0.11650253397576826i, 0.2972354857677736 + 2.930733997499879e-19i, -0.00021363179802751846 + 0.005683742817514567i, -0.00040961475499144673 + 0.001332142054339121i }, { -0.0013724246848604142 + -0.0008169767139353704i, -0.00021363179802751868 + -0.005683742817514567i, 0.21306848605252648 + -1.0147454708106518e-18i, -0.03258989197835495 + 0.10348071850183121i }, { -0.005086879769469019 + -0.0015039386523991785i, -0.00040961475499144625 + -0.0013321420543391217i, -0.03258989197835495 + -0.10348071850183121i, 0.2490739772243186 + -2.329340604949326e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2406220509553802, 1.0e-7), DoubleNear(0.2972354857677736, 1.0e-7), DoubleNear(0.21306848605252648, 1.0e-7), DoubleNear(0.2490739772243186, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.23580442974111815 + -9.622294280808852e-19i, -0.03917829010833192 + 0.11627691292599568i, -0.01430161993354365 + 0.017416739378301335i, -0.008931876691482425 + -0.007721971812030115i }, { -0.039178290108331924 + -0.11627691292599568i, 0.2949736599488224 + -8.402566836762659e-19i, 0.006011141501541849 + 0.00498380356047923i, -0.005693621053779222 + 0.019707094547629776i }, { -0.014301619933543652 + -0.017416739378301335i, 0.0060111415015418525 + -0.00498380356047923i, 0.21788610726678856 + 1.5458351287390981e-18i, -0.03736885903349256 + 0.10370633955160379i }, { -0.008931876691482425 + 0.007721971812030114i, -0.005693621053779222 + -0.019707094547629776i, -0.03736885903349256 + -0.1037063395516038i, 0.25133580304326986 + -1.196010521523072e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.23580442974111815, 1.0e-7), DoubleNear(0.2949736599488224, 1.0e-7), DoubleNear(0.21788610726678856, 1.0e-7), DoubleNear(0.25133580304326986, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.21761493898051262 + 4.743384504624082e-20i, 0.002255278413847832 + -0.030099247670134492i, -0.01813738201334838 + -0.0072701398932076555i, -0.02506107378614001 + -0.016701777213857617i }, { 0.002255278413847832 + 0.030099247670134496i, 0.23245969120209037 + 6.572975670693371e-19i, 0.008227505794115733 + 0.04073700863915215i, 1.6382586307757654e-05 + 0.00032676728030737903i }, { -0.01813738201334838 + 0.0072701398932076555i, 0.008227505794115731 + -0.04073700863915216i, 0.3164365970255555 + 5.421010862427522e-20i, -0.012728633981783121 + 0.010724124890110532i }, { -0.025061073786140014 + 0.016701777213857613i, 1.638258630775718e-05 + -0.00032676728030737936i, -0.012728633981783121 + -0.010724124890110532i, 0.2334887727918405 + -2.211603025280978e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21761493898051262, 1.0e-7), DoubleNear(0.23245969120209037, 1.0e-7), DoubleNear(0.3164365970255555, 1.0e-7), DoubleNear(0.2334887727918405, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.27257891105128407 + 8.436448154652831e-19i, -0.00530182524212642 + -0.009926580810496334i, 0.010852795901210154 + 0.0077389174478083335i, 7.88896621999379e-05 + -0.0005049427875616711i }, { -0.005301825242126419 + 0.009926580810496336i, 0.23796476749814405 + 9.529120656610879e-19i, -0.0004894446106401553 + 0.00027204972403835863i, 0.009375382872917797 + 0.006865009253248707i }, { 0.010852795901210154 + -0.007738917447808328i, -0.0004894446106401549 + -0.0002720497240383584i, 0.261472624954784 + -7.420008617947671e-19i, -0.00517153032580887 + -0.009448541969527624i }, { 7.88896621999379e-05 + 0.0005049427875616707i, 0.009375382872917797 + -0.006865009253248704i, -0.00517153032580887 + 0.009448541969527626i, 0.22798369649578681 + -2.507217523872729e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.27257891105128407, 1.0e-7), DoubleNear(0.23796476749814405, 1.0e-7), DoubleNear(0.261472624954784, 1.0e-7), DoubleNear(0.22798369649578681, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.534051536006068 + 1.0164395367051604e-19i, -0.01047335556793529 + -0.019375122780023964i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01047335556793529 + 0.019375122780023964i, 0.4659484639939308 + -1.5543054582116411e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.534051536006068, 1.0e-7), DoubleNear(0.4659484639939308, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.26189350639286935 + 1.2874900798265365e-19i, -0.00511147691651127 + -0.00867663133794299i, 0.0036542513367723156 + -0.009780845184706384i, 0.000911551635236356 + 4.967927013759015e-05i }, { -0.005111476916511269 + 0.008676631337942994i, 0.2323132682880889 + -3.2526065174565133e-19i, -0.0009818964321328407 + -0.001718837984183467i, 0.0043232662151195395 + -0.011751132927407204i }, { 0.0036542513367723147 + 0.009780845184706385i, -0.0009818964321328407 + 0.0017188379841834665i, 0.2721580296131987 + -2.710505431213761e-20i, -0.005361878651424019 + -0.01069849144208097i }, { 0.0009115516352363557 + -4.9679270137589825e-05i, 0.004323266215119539 + 0.011751132927407208i, -0.005361878651424019 + 0.010698491442080967i, 0.23363519570584196 + -1.2290448064659898e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.26189350639286935, 1.0e-7), DoubleNear(0.2323132682880889, 1.0e-7), DoubleNear(0.2721580296131987, 1.0e-7), DoubleNear(0.23363519570584196, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.28684787399390216 + 3.2424421220894617e-18i, -0.005902415087178087 + -0.01044554880724103i, -0.00042666577171814415 + 0.0016290917018540537i, 0.0007729572011120065 + 0.0006707810286386697i }, { -0.005902415087178087 + 0.01044554880724103i, 0.2510096627292516 + -1.351017550870609e-18i, 0.000993683632450825 + 0.0003468656312103428i, -0.0013553736681337167 + 0.0005200270664204389i }, { -0.0004266657717181438 + -0.0016290917018540534i, 0.0009936836324508252 + -0.0003468656312103431i, 0.24720366201216587 + -3.1407981684189457e-18i, -0.004570940480757202 + -0.00892957397278293i }, { 0.0007729572011120072 + -0.0006707810286386698i, -0.0013553736681337167 + -0.0005200270664204388i, -0.004570940480757201 + 0.00892957397278293i, 0.21493880126467918 + -2.0328790734103208e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.28684787399390216, 1.0e-7), DoubleNear(0.2510096627292516, 1.0e-7), DoubleNear(0.24720366201216587, 1.0e-7), DoubleNear(0.21493880126467918, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.2834917980587556 + -2.1955093992831465e-18i, -0.005516894537561769 + -0.010331634138519874i, -0.010643764542009269 + 0.019829712243276294i, 0.0010772633334019325 + 2.645355411529438e-05i }, { -0.005516894537561769 + 0.010331634138519875i, 0.24728629163118493 + 3.9302328752599536e-19i, -0.00036140102266927457 + -0.0008388820656306498i, -0.009351476445313605 + 0.017294121682654817i }, { -0.010643764542009269 + -0.019829712243276294i, -0.0003614010226692747 + 0.0008388820656306502i, 0.25055973794731246 + 2.2971533529536625e-18i, -0.00495646103037352 + -0.009043488641504088i }, { 0.0010772633334019321 + -2.645355411529381e-05i, -0.009351476445313606 + -0.017294121682654817i, -0.004956461030373519 + 0.009043488641504087i, 0.21866217236274588 + -1.9473287457376365e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2834917980587556, 1.0e-7), DoubleNear(0.24728629163118493, 1.0e-7), DoubleNear(0.25055973794731246, 1.0e-7), DoubleNear(0.21866217236274588, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.22975023409489337 + -8.944667923005412e-19i, -0.009211732974388164 + -0.003547108289607288i, 0.009114535446734802 + 0.00660581943372117i, -0.00021625792360970895 + -0.00032244432047602535i }, { -0.009211732974388162 + 0.0035471082896072876i, 0.28079344445453475 + 2.691023673426912e-18i, -0.00045313998677463257 + -0.00010584876921580368i, 0.011113643327393152 + 0.00799810726733587i }, { 0.009114535446734802 + -0.00660581943372117i, -0.00045313998677463273 + 0.00010584876921580373i, 0.22032439608770965 + 1.599198204416119e-18i, -0.00890926645265246 + -0.0033962643232929887i }, { -0.00021625792360970898 + 0.0003224443204760258i, 0.011113643327393147 + -0.007998107267335863i, -0.008909266452652458 + 0.0033962643232929883i, 0.2691319253628612 + -4.848416590083615e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.22975023409489337, 1.0e-7), DoubleNear(0.28079344445453475, 1.0e-7), DoubleNear(0.22032439608770965, 1.0e-7), DoubleNear(0.2691319253628612, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.45007463018260296 + 7.047314121155779e-19i, -0.018120999427040624 + -0.006943372612900277i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01812099942704062 + 0.006943372612900275i, 0.5499253698173958 + -2.157392916656703e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.45007463018260296, 1.0e-7), DoubleNear(0.5499253698173958, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.22330447395020617 + 1.8058742435461683e-18i, -0.011647703639194505 + -0.0027233795975240708i, 0.004184495546025751 + -0.009552108470840889i, -0.0028079119982635905 + 0.0023217209454710133i }, { -0.011647703639194505 + 0.00272337959752407i, 0.27090230073075205 + -2.002385887309166e-18i, -0.0006410422475832266 + 0.0007383639507690876i, 0.0037930220058661032 + -0.011979869641272699i }, { 0.0041844955460257505 + 0.00955210847084089i, -0.0006410422475832265 + -0.0007383639507690875i, 0.22677015623239682 + -1.1011428314305904e-18i, -0.006473295787846119 + -0.0042199930153762055i }, { -0.002807911998263591 + -0.0023217209454710133i, 0.003793022005866103 + 0.011979869641272702i, -0.006473295787846117 + 0.0042199930153762055i, 0.2790230690866438 + -1.5500702934753696e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.22330447395020617, 1.0e-7), DoubleNear(0.27090230073075205, 1.0e-7), DoubleNear(0.22677015623239682, 1.0e-7), DoubleNear(0.2790230690866438, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.2420882368637419 + 1.0638733817514012e-18i, -0.00988945075772585 + -0.00421597319072424i, -0.00042190316069810706 + 0.0010596966301847594i, -4.672848031002006e-05 + -0.0009445914932059876i }, { -0.009889450757725848 + 0.004215973190724239i, 0.2957692998594119 + 8.275511894674514e-19i, -0.0015435157377162371 + 0.00021819863021143118i, -0.0013601362791537538 + 0.0010894221380897328i }, { -0.00042190316069810625 + -0.0010596966301847594i, -0.0015435157377162376 + -0.00021819863021143118i, 0.2079863933188611 + -3.5914196963582334e-19i, -0.008231548669314772 + -0.0027273994221760365i }, { -4.672848031002017e-05 + 0.0009445914932059874i, -0.0013601362791537544 + -0.0010894221380897328i, -0.008231548669314772 + 0.0027273994221760365i, 0.25415606995798395 + -2.9849441061241544e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2420882368637419, 1.0e-7), DoubleNear(0.2957692998594119, 1.0e-7), DoubleNear(0.2079863933188611, 1.0e-7), DoubleNear(0.25415606995798395, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.23888529737121939 + -1.0503208545953324e-18i, -0.009588428459584892 + -0.0037594233076834807i, -0.008975460834388622 + 0.01670037477315904i, 0.000617254891928486 + -0.0006098729511088658i }, { -0.00958842845958489 + 0.00375942330768348i, 0.2918927923187211 + -7.521652571618187e-19i, 0.00013242230948438066 + -0.0007592923330620303i, -0.011019780152934252 + 0.020423459152772074i }, { -0.008975460834388624 + -0.016700374773159034i, 0.0001324223094843805 + 0.0007592923330620297i, 0.2111893328113836 + 1.7550522667109103e-18i, -0.00853257096745573 + -0.003183949305216796i }, { 0.000617254891928486 + 0.0006098729511088657i, -0.01101978015293425 + -0.020423459152772078i, -0.00853257096745573 + 0.003183949305216796i, 0.25803257749867475 + -1.4052276594948843e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.23888529737121939, 1.0e-7), DoubleNear(0.2918927923187211, 1.0e-7), DoubleNear(0.2111893328113836, 1.0e-7), DoubleNear(0.25803257749867475, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.5105436785494282 + 1.796556881126371e-18i, 0.020228178774127956 + 0.01460392670105704i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020228178774127945 + -0.014603926701057033i, 0.48945632145057083 + -3.249218385667496e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5105436785494282, 1.0e-7), DoubleNear(0.48945632145057083, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.25108664983906537 + 2.032879073410321e-18i, 0.010462306161632118 + 0.00633681461821328i, 0.0033103825035994254 + -0.014078858796971738i, 0.002369075409511789 + 0.00018390321444387495i }, { 0.010462306161632117 + -0.00633681461821328i, 0.24312012484189288 + -2.2293907171733185e-18i, -0.0013546636193708282 + 0.001100985326704346i, 0.004667135048292429 + -0.007453119315141848i }, { 0.0033103825035994262 + 0.014078858796971742i, -0.001354663619370828 + -0.001100985326704348i, 0.25945702871036275 + -2.363221922839498e-19i, 0.009765872612495834 + 0.00826711208284376i }, { 0.002369075409511786 + -0.00018390321444387468i, 0.004667135048292427 + 0.007453119315141851i, 0.00976587261249583 + -0.008267112082843754i, 0.24633619660867792 + -1.0198276684941776e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.25108664983906537, 1.0e-7), DoubleNear(0.24312012484189288, 1.0e-7), DoubleNear(0.25945702871036275, 1.0e-7), DoubleNear(0.24633619660867792, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.2745261742861973 + 2.369151153470278e-18i, 0.010654116784744254 + 0.006978457144159438i, -0.0010926042540789918 + 0.001371360955311108i, -0.00012405296112348867 + -0.00016179370296127366i }, { 0.01065411678474425 + -0.006978457144159437i, 0.26333136243695654 + -4.777265822514254e-19i, 0.0002849987377629758 + -3.112457202598696e-05i, -0.0006894351857728693 + 0.0007777578129633842i }, { -0.0010926042540789914 + -0.0013713609553111074i, 0.0002849987377629758 + 3.112457202598712e-05i, 0.23601750426323082 + -5.72594272343907e-19i, 0.009574061989383698 + 0.007625469556897602i }, { -0.00012405296112348894 + 0.0001617937029612733i, -0.000689435185772869 + -0.0007777578129633841i, 0.009574061989383697 + -0.007625469556897597i, 0.22612495901361426 + -2.7714918034160707e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2745261742861973, 1.0e-7), DoubleNear(0.26333136243695654, 1.0e-7), DoubleNear(0.23601750426323082, 1.0e-7), DoubleNear(0.22612495901361426, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.27490870041067755 + -6.810144895924575e-19i, 0.025403266267496193 + 0.0003784405888359076i, -0.014027362920746807 + 0.020792270654374924i, -0.0020482740063481946 + 0.025853400905155467i }, { 0.025403266267496186 + -0.00037844058883590236i, 0.25586938927926295 + -1.1214716221646936e-18i, -0.023721919150828285 + 0.017724523543394998i, -0.005967878066576067 + 0.016331563271556188i }, { -0.014027362920746807 + -0.020792270654374924i, -0.02372191915082828 + -0.017724523543395i, 0.23563497813875056 + 2.4775713707188285e-18i, -0.005175087493368239 + 0.014225486112221132i }, { -0.002048274006348194 + -0.025853400905155473i, -0.0059678780665760696 + -0.016331563271556188i, -0.00517508749336824 + -0.01422548611222113i, 0.23358693217130785 + -2.1277467635028025e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.27490870041067755, 1.0e-7), DoubleNear(0.25586938927926295, 1.0e-7), DoubleNear(0.23563497813875056, 1.0e-7), DoubleNear(0.23358693217130785, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.4942067746809583 + -1.9651164376299768e-19i, 0.0 + 0.0i, 0.007977517551891855 + -0.02153197811211359i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007977517551891853 + 0.021531978112113593i, 0.0 + 0.0i, 0.5057932253190407 + -1.2561498607781274e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.4942067746809583, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5057932253190407, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.5378575367231538 + 1.8914245712188527e-18i, 0.0 + 0.0i, -0.001782039439851861 + 0.002149118768274493i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017820394398518602 + -0.002149118768274491i, 0.0 + 0.0i, 0.4621424632768451 + -3.3440860757599777e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.5378575367231538, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4621424632768451, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.5307780896899406 + -1.802486111757151e-18i, 0.0 + 0.0i, -0.019995240987322874 + 0.03712383392593112i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.019995240987322877 + -0.03712383392593111i, 0.0 + 0.0i, 0.46922191031005844 + 3.4982460721602604e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.5307780896899406, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.46922191031005844, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.2657450047571205 + 2.846030702774449e-19i, 0.0035576777422622018 + -0.01193744793868622i, -0.0011169273517444656 + -0.002383195752723809i, 0.0012072116251841615 + 0.0009138534669666159i }, { 0.0035576777422621983 + 0.011937447938686223i, 0.27211253196603336 + 1.6068215009414077e-18i, 4.217889138505198e-05 + 0.0014739717390938895i, -0.0006651120881073953 + 0.004532314520998301i }, { -0.001116927351744465 + 0.0023831957527238098i, 4.217889138505168e-05 + -0.0014739717390938904i, 0.2284617699238378 + -4.811147140404426e-19i, 0.004419839809629653 + -0.009594530173427367i }, { 0.0012072116251841607 + -0.0009138534669666164i, -0.0006651120881073957 + -0.004532314520998301i, 0.004419839809629655 + 0.00959453017342737i, 0.2336806933530073 + -2.862971361719535e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.2657450047571205, 1.0e-7), DoubleNear(0.27211253196603336, 1.0e-7), DoubleNear(0.2284617699238378, 1.0e-7), DoubleNear(0.2336806933530073, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.2623900926089572 + 2.913793338554793e-19i, 0.004515741877774625 + -0.010805545976761581i, -0.010665194217447126 + 0.018774275388483593i, 6.0868080711317025e-05 + 0.0008531685814410478i }, { 0.004515741877774625 + 0.010805545976761585i, 0.2683879970809834 + -2.0938654456126304e-18i, -0.0005703395011766744 + 0.0005040472347718502i, -0.009330046769875748 + 0.01834955853744752i }, { -0.010665194217447126 + -0.018774275388483596i, -0.0005703395011766725 + -0.0005040472347718473i, 0.23181668207200112 + -4.87890977618477e-19i, 0.00346177567411723 + -0.010726432135352007i }, { 6.0868080711317404e-05 + -0.0008531685814410498i, -0.009330046769875752 + -0.018349558537447515i, 0.003461775674117228 + 0.010726432135352008i, 0.2374052282380573 + 8.37715584834503e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.2623900926089572, 1.0e-7), DoubleNear(0.2683879970809834, 1.0e-7), DoubleNear(0.23181668207200112, 1.0e-7), DoubleNear(0.2374052282380573, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.2879062497749427 + 4.845028458294598e-19i, -0.0012563366628525398 + 0.0010867100478377017i, -0.008513465885745003 + 0.018902208641601838i, -0.0006205357013402455 + 0.000922265103148418i }, { -0.00125633666285254 + -0.0010867100478377013i, 0.2428718399149978 + -2.286988957586611e-18i, -0.0006533215091995477 + -0.0004226257237100363i, -0.01148177510157787 + 0.018221625284329277i }, { -0.00851346588574501 + -0.018902208641601838i, -0.000653321509199547 + 0.0004226257237100363i, 0.24995128694821112 + 1.4069217253893929e-18i, -0.0005257027769993211 + 0.0010624087204367909i }, { -0.0006205357013402456 + -0.0009222651031484177i, -0.011481775101577867 + -0.018221625284329274i, -0.0005257027769993203 + -0.00106240872043679i, 0.2192706233618473 + -1.0570971181733668e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2879062497749427, 1.0e-7), DoubleNear(0.2428718399149978, 1.0e-7), DoubleNear(0.24995128694821112, 1.0e-7), DoubleNear(0.2192706233618473, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.09871970541864475 + 5.878408653944844e-19i, -0.016697179341619336 + 0.047858919948778375i, 0.0009898792670632829 + -0.013610952477530969i, 0.006563388311390455 + 0.0027161739827029144i, -0.00818077766670406 + -0.0032402652402513587i, 0.0031000895246017773 + -0.003562423484679005i, -0.011372037829499257 + -0.007617397950164653i, 0.005652709564837072 + -0.0041416242972101384i }, { -0.01669717934161934 + -0.047858919948778375i, 0.11889523356186785 + -5.404070203482436e-19i, -0.006792579826142016 + 0.0016722817375239706i, 0.0012653991467845493 + -0.016488295192603527i, -0.0002454729105923998 + 0.004363943421133038i, -0.009956604346644322 + -0.004029874652956298i, -0.001651076876749558 + 0.006800260625829096i, -0.013689035956640755 + -0.00908437926369296i }, { 0.0009898792670632829 + 0.013610952477530969i, -0.006792579826142016 + -0.001672281737523971i, 0.10545829069202325 + 8.91078660511524e-19i, -0.017796082474084384 + 0.05112604289982597i, 0.003733392568072034 + 0.018542796319057288i, -0.0095428914792689 + -0.0014152208302492795i, 1.8497448422448597e-05 + 0.0001235773344264997i, 2.450623011988754e-05 + -2.3741626337973106e-05i }, { 0.006563388311390455 + -0.0027161739827029144i, 0.0012653991467845493 + 0.01648829519260353i, -0.017796082474084388 + -0.05112604289982597i, 0.12700140051006714 + -2.337810934421869e-19i, 0.008272553691585622 + -0.005031274037464416i, 0.004494113226043699 + 0.02219421232009487i, 0.0001192937317417303 + -0.00011420439027628828i, -2.1148621146909496e-06 + 0.00020318994588087942i }, { -0.008180777666704057 + 0.0032402652402513583i, -0.00024547291059240015 + -0.004363943421133037i, 0.0037333925680720337 + -0.018542796319057288i, 0.008272553691585624 + 0.005031274037464417i, 0.14360465217873764 + -6.098637220230962e-19i, -0.02417099350072403 + 0.06964392383822751i, -0.005839565377402541 + 0.004791921402570857i, -0.0013477228460026369 + -0.003417326178532236i }, { 0.0031000895246017773 + 0.0035624234846790047i, -0.00995660434664432 + 0.004029874652956297i, -0.0095428914792689 + 0.0014152208302492797i, 0.004494113226043699 + -0.022194212320094865i, -0.02417099350072403 + -0.06964392383822751i, 0.1728319448468178 + 6.640738306473715e-19i, 0.0035104898577825723 + 0.0020634579625659387i, -0.00688906860438058 + 0.005932203487539676i }, { -0.011372037829499257 + 0.007617397950164653i, -0.001651076876749558 + -0.006800260625829096i, 1.8497448422448543e-05 + -0.00012357733442649974i, 0.00011929373174173034 + 0.00011420439027628809i, -0.005839565377402541 + -0.004791921402570857i, 0.0035104898577825723 + -0.0020634579625659387i, 0.10590788871850106 + -2.854501032246992e-19i, -0.017882893825396727 + 0.051354365790767624i }, { 0.005652709564837072 + 0.004141624297210139i, -0.013689035956640755 + 0.009084379263692962i, 2.4506230119887493e-05 + 2.374162633797328e-05i, -2.11486211469139e-06 + -0.00020318994588087964i, -0.001347722846002637 + 0.003417326178532236i, -0.00688906860438058 + -0.005932203487539676i, -0.01788289382539673 + -0.05135436579076762i, 0.12758088407333942 + -1.926152922056279e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.09871970541864475, 1.0e-7), DoubleNear(0.11889523356186785, 1.0e-7), DoubleNear(0.10545829069202325, 1.0e-7), DoubleNear(0.12700140051006714, 1.0e-7), DoubleNear(0.14360465217873764, 1.0e-7), DoubleNear(0.1728319448468178, 1.0e-7), DoubleNear(0.10590788871850106, 1.0e-7), DoubleNear(0.12758088407333942, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.12371784202644275 + 1.0028870095490916e-18i, -0.020810682625415945 + 0.06002682650424193i, -0.002454396690616578 + -0.004512493876611896i, 0.0026998029004275427 + -0.00033985401597473613i, 0.005014236950364074 + 0.0035346345940184855i, -0.002885077218511502 + 0.0016876908202493551i, 2.6549650398232063e-05 + -0.00020856776887201797i, 0.00011894726954982227 + 8.922969964719037e-05i }, { -0.020810682625415945 + -0.06002682650424193i, 0.14886106902484125 + -1.5924219408380846e-19i, -0.0016588232591498635 + 0.0018974225825462334i, -0.002847428551509842 + -0.0054140869338844405i, 0.0006525946334173035 + -0.002844166829103791i, 0.005838558950846082 + 0.004204282853789847i, -7.764244916052671e-05 + 4.2776396986627475e-05i, 5.23400118017058e-05 + -0.000296375018689653i }, { -0.0024543966906165784 + 0.004512493876611896i, -0.0016588232591498637 + -0.0018974225825462334i, 0.10798162576217418 + 1.4289445820180047e-18i, -0.01821198431092396 + 0.05237397644517924i, -0.0002130944089444439 + 0.0001493715429879681i, 6.016646653003054e-06 + -0.0001585873082797907i, 0.004321057354550342 + 0.0031306520733802882i, -0.002483775273838972 + 0.001467917970006173i }, { 0.0026998029004275427 + 0.00033985401597473613i, -0.002847428551509841 + 0.0054140869338844405i, -0.01821198431092396 + -0.05237397644517924i, 0.12998314173596986 + -4.760325163569168e-19i, 0.0001183710788518767 + 4.810275160246164e-05i, -0.0002763502016957113 + 0.0001226781810503906i, 0.0006580087594788538 + -0.002467431942946831i, 0.005054325518367455 + 0.003734357179868419i }, { 0.005014236950364072 + -0.0035346345940184837i, 0.0006525946334173041 + 0.0028441668291037895i, -0.00021309440894444378 + -0.00014937154298796796i, 0.00011837107885187664 + -4.810275160246161e-05i, 0.11860651557093964 + -1.0249098661777034e-18i, -0.020057490216927425 + 0.057476017282763955i, -0.00239528941972268 + -0.004306537198348214i, 0.0025158625649602745 + -0.0003612981798545859i }, { -0.0028850772185115003 + -0.0016876908202493543i, 0.00583855895084608 + -0.004204282853789845i, 6.016646653003034e-06 + 0.00015858730827979055i, -0.0002763502016957111 + -0.00012267818105039045i, -0.020057490216927425 + -0.05747601728276396i, 0.14286610938384436 + 2.829090043829363e-19i, -0.00162326670920958 + 0.0018383171175436757i, -0.0027762409060861893 + -0.00514200477117941i }, { 2.6549650398232307e-05 + 0.00020856776887201797i, -7.764244916052676e-05 + -4.2776396986627665e-05i, 0.004321057354550342 + -0.0031306520733802874i, 0.0006580087594788527 + 0.00246743194294683i, -0.00239528941972268 + 0.0043065371983482155i, -0.0016232667092095803 + -0.001838317117543676i, 0.10338455364835013 + -8.233160247311799e-19i, -0.017466991988557154 + 0.05010643224541434i }, { 0.000118947269549822 + -8.922969964719045e-05i, 5.234001180170561e-05 + 0.0002963750186896529i, -0.0024837752738389716 + -0.001467917970006173i, 0.005054325518367457 + -0.0037343571798684173i, 0.0025158625649602745 + 0.0003612981798545859i, -0.0027762409060861897 + 0.005142004771179411i, -0.017466991988557154 + -0.05010643224541434i, 0.12459914284743669 + -1.683901499141549e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12371784202644275, 1.0e-7), DoubleNear(0.14886106902484125, 1.0e-7), DoubleNear(0.10798162576217418, 1.0e-7), DoubleNear(0.12998314173596986, 1.0e-7), DoubleNear(0.11860651557093964, 1.0e-7), DoubleNear(0.14286610938384436, 1.0e-7), DoubleNear(0.10338455364835013, 1.0e-7), DoubleNear(0.12459914284743669, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.24232435759738236 + -2.202285662861181e-20i, -0.04086817284234337 + 0.1175028437870059i, -0.004849686110339258 + -0.00881903107496011i, 0.005215665465387818 + -0.0007011521958293221i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04086817284234337 + -0.1175028437870059i, 0.2917271784086857 + 1.2366681029912785e-19i, -0.003282089968359443 + 0.003735739700089909i, -0.005623669457596032 + -0.010556091705063851i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004849686110339258 + 0.008819031074960113i, -0.003282089968359444 + -0.003735739700089909i, 0.21136617941052432 + 6.056285572868247e-19i, -0.03567897629948111 + 0.10248040869059359i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.005215665465387817 + 0.000701152195829322i, -0.005623669457596031 + 0.010556091705063851i, -0.03567897629948112 + -0.10248040869059359i, 0.25458228458340654 + -2.159934015498466e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.24232435759738236, 1.0e-7), DoubleNear(0.2917271784086857, 1.0e-7), DoubleNear(0.21136617941052432, 1.0e-7), DoubleNear(0.25458228458340654, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.11894008197703243 + 1.7110065534536867e-19i, -0.02083116935625752 + 0.0571777286073189i, -0.002335518326523867 + -0.003953233579000299i, 0.00241728785942678 + -0.00022876909327662558i, 0.0017324626362674315 + -0.0045020563630921336i, 0.001750591848770648 + 0.0016314153534522885i, 0.0003984886560522382 + 2.096859058991868e-05i, -0.00034583179736924377 + 0.00015420599489458623i }, { -0.02083116935625752 + -0.0571777286073189i, 0.14295342441583692 + -4.2351647362715017e-20i, -0.0012667329739644837 + 0.0018059375682572395i, -0.002775958589987403 + -0.004723397758942691i, -0.0024868732675586594 + 1.7136970594581113e-05i, 0.001921788700504884 + -0.00527878882161425i, -0.00024069928255161753 + 5.841179265402707e-06i, 0.0005130629791841176 + 2.871067954767147e-05i }, { -0.002335518326523867 + 0.0039532335790003i, -0.001266732973964485 + -0.0018059375682572397i, 0.10549929527203009 + 7.691059161069047e-19i, -0.018372864990267093 + 0.05077971295802114i, -0.000512384332504075 + -0.0007684741113922621i, 0.0002459496672797092 + -5.641633728067954e-05i, 0.002084745792345496 + -0.005429984240366269i, 0.002195784747491656 + 0.00209247058762878i }, { 0.0024172878594267803 + 0.0002287690932766254i, -0.002775958589987403 + 0.004723397758942694i, -0.018372864990267097 + -0.05077971295802115i, 0.1268139730160588 + -1.094366567852556e-18i, -0.000380045488382272 + 0.0005492875804693856i, -0.0004695120996287657 + -0.0009503638727912046i, -0.0028043201407097758 + 6.314945021452067e-05i, 0.002238520422774043 + -0.006321148687040935i }, { 0.0017324626362674317 + 0.0045020563630921336i, -0.00248687326755866 + -1.7136970594581276e-05i, -0.0005123843325040751 + 0.0007684741113922618i, -0.00038004548838227193 + -0.0005492875804693857i, 0.12338427562034995 + -1.9312351197398048e-19i, -0.020037003486085846 + 0.060325115179686986i, -0.002514167783815391 + -0.004865797495959812i, 0.0027983776059610378 + -0.00047238310255269647i }, { 0.0017505918487706492 + -0.0016314153534522885i, 0.0019217887005048828 + 0.005278788821614252i, 0.0002459496672797092 + 5.641633728067958e-05i, -0.0004695120996287657 + 0.0009503638727912046i, -0.020037003486085846 + -0.060325115179686986i, 0.1487737539928487 + 1.6601845766184287e-19i, -0.00201535699439496 + 0.0019298021318326696i, -0.002847710867608628 + -0.005832693946121159i }, { 0.00039848865605223815 + -2.0968590589918522e-05i, -0.00024069928255161755 + -5.841179265402721e-06i, 0.0020847457923454955 + 0.005429984240366271i, -0.002804320140709776 + -6.314945021452102e-05i, -0.0025141677838153914 + 0.00486579749595981i, -0.002015356994394959 + -0.0019298021318326696i, 0.10586688413849424 + -1.6347735882007997e-19i, -0.01730611130921402 + 0.05170069573257244i }, { -0.00034583179736924355 + -0.00015420599489458626i, 0.0005130629791841176 + -2.8710679547671323e-05i, 0.002195784747491657 + -0.0020924705876287806i, 0.002238520422774043 + 0.0063211486870409376i, 0.002798377605961037 + 0.0004723831025526967i, -0.002847710867608628 + 0.005832693946121157i, -0.01730611130921402 + -0.05170069573257244i, 0.12776831156734775 + -1.0655674476459098e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.11894008197703243, 1.0e-7), DoubleNear(0.14295342441583692, 1.0e-7), DoubleNear(0.10549929527203009, 1.0e-7), DoubleNear(0.1268139730160588, 1.0e-7), DoubleNear(0.12338427562034995, 1.0e-7), DoubleNear(0.1487737539928487, 1.0e-7), DoubleNear(0.10586688413849424, 1.0e-7), DoubleNear(0.12776831156734775, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.1282550651903439 + 1.6974540262976179e-18i, -0.023541152159357728 + 0.06209840380163284i, -0.0030525963771656822 + -0.004640789998311198i, 0.002496964745106633 + -0.0005330868365573454i, -0.0005643972327056515 + 0.0006606290398335572i, -0.0029497185687527554 + 0.0008861049196333464i, 0.00017983014041588418 + 0.00039272652459785445i, -0.00029187018402977835 + 3.5744145310553793e-05i }, { -0.023541152159357728 + -0.06209840380163283i, 0.1585928088035582 + 1.5449880957918438e-18i, -0.0019894720011889083 + 0.0023656281036354065i, -0.002849818710012405 + -0.005804758808929831i, -5.880947863692626e-05 + 0.0029853641904382306i, 0.00013773146098750732 + 0.0009684626620204963i, 5.5618136469031356e-05 + -0.00017658684361155508i, 0.0005931270606961224 + 0.0002780545040408153i }, { -0.0030525963771656827 + 0.004640789998311199i, -0.0019894720011889083 + -0.002365628103635407i, 0.11236698576503629 + -9.910285482875314e-20i, -0.020416105004111812 + 0.05440413017413542i, 0.0004419371003651009 + 0.00022115881502745324i, -0.0003440118332648979 + 0.0001419408758136322i, -0.0008080274521547629 + 0.0001563476741018139i, -0.002137161200716263 + 0.0006178337327658323i }, { 0.002496964745106633 + 0.0005330868365573453i, -0.0028498187100124053 + 0.005804758808929833i, -0.020416105004111812 + -0.05440413017413542i, 0.13864267696421537 + -1.2519146960418559e-18i, -0.00011541530389604135 + -7.646366447666033e-05i, 0.0005517465320857241 + 0.00012570681618288954i, -0.0001548223193905921 + 0.0026983786270763366i, -0.0005473462159789539 + 0.0003636793923186249i }, { -0.0005643972327056513 + -0.0006606290398335568i, -5.880947863692626e-05 + -0.002985364190438231i, 0.0004419371003651011 + -0.00022115881502745348i, -0.0001154153038960411 + 7.646366447666029e-05i, 0.11406929240703846 + -1.7194768829262297e-18i, -0.01732702068298564 + 0.055404439985373054i, -0.0017970897331735759 + -0.004178241076648912i, 0.0027187007202811846 + -0.00016806535927197665i }, { -0.0029497185687527554 + -0.0008861049196333467i, 0.0001377314609875076 + -0.0009684626620204966i, -0.0003440118332648981 + -0.0001419408758136323i, 0.0005517465320857242 + -0.0001257068161828896i, -0.017327020682985642 + -0.05540443998537306i, 0.13313436960512742 + -1.421321285492716e-18i, -0.0012926179671705353 + 0.0013701115964545024i, -0.0027738507475836265 + -0.004751332896134018i }, { 0.00017983014041588453 + -0.00039272652459785445i, 5.5618136469031315e-05 + 0.00017658684361155527i, -0.0008080274521547629 + -0.00015634767410181353i, -0.00015482231939059252 + -0.0026983786270763366i, -0.0017970897331735759 + 0.004178241076648912i, -0.0012926179671705355 + -0.0013701115964545024i, 0.09899919364548801 + 7.047314121155779e-19i, -0.015262871295369303 + 0.04807627851645817i }, { -0.00029187018402977835 + -3.574414531055389e-05i, 0.0005931270606961225 + -0.0002780545040408154i, -0.002137161200716263 + -0.000617833732765832i, -0.0005473462159789538 + -0.0003636793923186252i, 0.0027187007202811846 + 0.00016806535927197676i, -0.0027738507475836257 + 0.004751332896134018i, -0.015262871295369303 + -0.04807627851645817i, 0.11593960761919117 + -9.0801931945661e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1282550651903439, 1.0e-7), DoubleNear(0.1585928088035582, 1.0e-7), DoubleNear(0.11236698576503629, 1.0e-7), DoubleNear(0.13864267696421537, 1.0e-7), DoubleNear(0.11406929240703846, 1.0e-7), DoubleNear(0.13313436960512742, 1.0e-7), DoubleNear(0.09899919364548801, 1.0e-7), DoubleNear(0.11593960761919117, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.12597126620446858 + -1.1689054672109345e-18i, -0.020924132799662046 + 0.062113535030127114i, -0.0025593263985580136 + -0.004624859124636647i, 0.002907757768239702 + -0.00030327627840381725i, -0.0076146630779599 + 0.009293068591120158i, -0.004763751657207856 + -0.004113250748390259i, 0.0005949082795063686 + 3.903442880473157e-05i, -0.00028207763575534045 + 0.00045714976910491995i }, { -0.020924132799662046 + -0.06211353503012712i, 0.15752053185428697 + -1.026603932072212e-18i, -0.0015809461072891142 + 0.0019662876347244433i, -0.0029575681390037554 + -0.005706775013883228i, 0.00322080321278143 + 0.002653751416834411i, -0.003029101464049369 + 0.010536643652156138i, -0.00014420835380778496 + 3.0074512102186256e-05i, 0.00048235505389556397 + -1.2580874689437211e-05i }, { -0.0025593263985580136 + 0.004624859124636647i, -0.0015809461072891146 + -0.0019662876347244433i, 0.10983316353664954 + 2.0667603913004928e-19i, -0.018254157308669874 + 0.05416337789586857i, -8.875734471042672e-05 + -0.0005479687327417614i, 0.00015124256802098832 + 0.00019144141992810096i, -0.006686956855583752 + 0.008123670787181177i, -0.004168125034274569 + -0.0036087210636398565i }, { 0.0029077577682397014 + 0.0003032762784038175i, -0.0029575681390037554 + 0.005706775013883229i, -0.018254157308669878 + -0.05416337789586857i, 0.13745312809453542 + 1.8634724839594607e-19i, -0.00023220807697011629 + 0.00032248985610751585i, -0.00027264367795884785 + -0.0002909133328888883i, 0.002790338288760419 + 0.002330052143644819i, -0.0026645195897298524 + 0.00917045089547364i }, { -0.007614663077959901 + -0.009293068591120158i, 0.003220803212781432 + -0.0026537514168344105i, -8.875734471042694e-05 + 0.0005479687327417618i, -0.00023220807697011615 + -0.0003224898561075163i, 0.11635309139291378 + 1.1468826105823227e-18i, -0.01994404004268132 + 0.05538930875687878i, -0.0022903597117812447 + -0.004194171950323464i, 0.002307907697148116 + -0.0003978759174255048i }, { -0.004763751657207855 + 0.004113250748390258i, -0.003029101464049369 + -0.010536643652156136i, 0.00015124256802098845 + -0.00019144141992810123i, -0.00027264367795884785 + 0.0002909133328888883i, -0.019944040042681323 + -0.05538930875687877i, 0.13420664655439868 + 1.1502707423713399e-18i, -0.0017011438610703292 + 0.0017694520653654656i, -0.002666101318592276 + -0.0048493166911806225i }, { 0.0005949082795063682 + -3.9034428804731326e-05i, -0.00014420835380778504 + -3.007451210218604e-05i, -0.006686956855583753 + -0.008123670787181177i, 0.00279033828876042 + -0.0023300521436448196i, -0.0022903597117812447 + 0.004194171950323465i, -0.0017011438610703294 + -0.0017694520653654658i, 0.10153301587387478 + 3.9895251815677546e-19i, -0.017424818990811237 + 0.04831703079472502i }, { -0.00028207763575534023 + -0.00045714976910491974i, 0.00048235505389556397 + 1.2580874689437516e-05i, -0.004168125034274569 + 0.003608721063639856i, -0.0026645195897298524 + -0.009170450895473636i, 0.002307907697148116 + 0.0003978759174255045i, -0.0026661013185922755 + 0.0048493166911806225i, -0.01742481899081124 + -0.04831703079472502i, 0.11712915648887114 + -2.346281263894412e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12597126620446858, 1.0e-7), DoubleNear(0.15752053185428697, 1.0e-7), DoubleNear(0.10983316353664954, 1.0e-7), DoubleNear(0.13745312809453542, 1.0e-7), DoubleNear(0.11635309139291378, 1.0e-7), DoubleNear(0.13420664655439868, 1.0e-7), DoubleNear(0.10153301587387478, 1.0e-7), DoubleNear(0.11712915648887114, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.10426661205693431 + 8.300922883092143e-19i, -0.017591491295466034 + 0.05056723884998552i, -0.004158550128746585 + -0.00159927991801667i, 0.0016117671876256343 + -0.0017952003335771616i, 0.004204267657803741 + 0.0030241021329698186i, -0.0024115357091887392 + 0.0014162166009268986i, -8.996018258209861e-05 + -0.0001416210381897145i, 8.840861750211973e-05 + -6.179707338105865e-05i }, { -0.017591491295466038 + -0.05056723884998553i, 0.12548362203795904 + -1.7245590806097555e-18i, -4.249676791332041e-05 + 0.0021716843460735592i, -0.005053182845641579 + -0.001947828371590618i, 0.0006060405177246092 + -0.002404253432158962i, 0.0049102677889310605 + 0.0035817173007513517i, -6.292716267051144e-05 + 2.4169647165546567e-05i, -0.0001262977410276103 + -0.00018082328228631088i }, { -0.004158550128746584 + 0.00159927991801667i, -4.249676791332043e-05 + -0.002171684346073559i, 0.12743285573168261 + 1.601739303257882e-18i, -0.02143117564087387 + 0.06183356409943565i, -0.00021070384144360914 + -7.193757384029413e-05i, 4.776603813301538e-05 + -2.4761015918520305e-05i, 0.005131026647110674 + 0.003641184534428956i, -0.002957316783161735 + 0.0017393921893286291i }, { 0.0016117671876256343 + 0.0017952003335771618i, -0.005053182845641579 + 0.0019478283715906176i, -0.021431175640873868 + -0.061833564099435655i, 0.1533605887228521 + 1.0892843701690302e-18i, 2.8740294256308718e-05 + 0.0001660003254857048i, -0.00024243614533102337 + -3.3911195375509575e-05i, 0.0007045628751715478 + -0.0029073453398916595i, 0.0059826166802824775 + 0.004356922732906915i }, { 0.004204267657803743 + -0.003024102132969818i, 0.0006060405177246092 + 0.0024042534321589626i, -0.00021070384144360925 + 7.193757384029402e-05i, 2.8740294256308785e-05 + -0.00016600032548570487i, 0.09991138405373368 + 6.488272375967941e-19i, -0.01690177052023769 + 0.04841772399861882i, -0.004003730089535026 + -0.0015174079878081891i, 0.001512828567096031 + -0.0017909647774398162i }, { -0.0024115357091887392 + -0.0014162166009268986i, 0.00491026778893106 + -0.003581717300751352i, 4.7766038133015405e-05 + 2.476101591852023e-05i, -0.00024243614533102348 + 3.391119537550963e-05i, -0.01690177052023769 + -0.04841772399861882i, 0.12041301203397595 + 9.50370966819325e-19i, -8.368241093734915e-05 + 0.0020780546847831904i, -0.004905536363117434 + -0.0018788563354847996i }, { -8.996018258209869e-05 + 0.00014162103818971477i, -6.292716267051156e-05 + -2.416964716554665e-05i, 0.005131026647110671 + -0.0036411845344289525i, 0.0007045628751715474 + 0.0029073453398916573i, -0.004003730089535026 + 0.0015174079878081887i, -8.36824109373494e-05 + -0.0020780546847831895i, 0.12207968516555608 + -2.4970531285056774e-18i, -0.02062271168524689 + 0.059164725529559474i }, { 8.840861750211977e-05 + 6.179707338105868e-05i, -0.0001262977410276103 + 0.00018082328228631098i, -0.002957316783161733 + -0.0017393921893286287i, 0.005982616680282476 + -0.0043569227329069106i, 0.0015128285670960309 + 0.0017909647774398164i, -0.004905536363117432 + 0.0018788563354847996i, -0.020622711685246892 + -0.059164725529559474i, 0.14705224019730512 + -2.3513634615779377e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10426661205693431, 1.0e-7), DoubleNear(0.12548362203795904, 1.0e-7), DoubleNear(0.12743285573168261, 1.0e-7), DoubleNear(0.1533605887228521, 1.0e-7), DoubleNear(0.09991138405373368, 1.0e-7), DoubleNear(0.12041301203397595, 1.0e-7), DoubleNear(0.12207968516555608, 1.0e-7), DoubleNear(0.14705224019730512, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.204177996110668 + 1.4789195259060084e-18i, -0.034493261815703724 + 0.09898496284860435i, -0.008162280218281609 + -0.003116687905824859i, 0.0031245957547216653 + -0.003586165111016978i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.034493261815703724 + -0.09898496284860435i, 0.24589663407193502 + -7.741881137904305e-19i, -0.0001261791788506696 + 0.004249739030856749i, -0.009958719208759013 + -0.0038266847070754176i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008162280218281609 + 0.0031166879058248586i, -0.00012617917885066984 + -0.004249739030856748i, 0.2495125408972387 + -8.953138252477955e-19i, -0.042053887326120754 + 0.12099828962899513i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0031245957547216653 + 0.0035861651110169783i, -0.009958719208759011 + 0.003826684707075417i, -0.04205388732612076 + -0.12099828962899514i, 0.3004128289201572 + -1.2620790914089075e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.204177996110668, 1.0e-7), DoubleNear(0.24589663407193502, 1.0e-7), DoubleNear(0.2495125408972387, 1.0e-7), DoubleNear(0.3004128289201572, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.10140603571432172 + 1.74319380544935e-18i, -0.01768363336430663 + 0.048802071795563104i, -0.0052609738681277 + -0.0012607254521093433i, 0.001473361464210129 + -0.0023598941049704633i, 0.001964044447517816 + -0.004414338545743036i, 0.0016070021755802133 + 0.001840923324134674i, -0.00127237584643753 + 0.0010723485313095667i, -0.00023828374434317837 + -0.0009533721969270958i }, { -0.01768363336430663 + -0.048802071795563104i, 0.12189843823588443 + 6.268043809681823e-20i, 0.00025858894117260407 + 0.002788053470087954i, -0.006386729771066805 + -0.0014626541454147274i, -0.00240708134354634 + 4.6850869479282816e-07i, 0.002220451098507935 + -0.005137769925097853i, 0.0006351643887446689 + 0.00030241880989824183i, -0.0015355361518260605 + 0.0012493724141614466i }, { -0.0052609738681277 + 0.0012607254521093429i, 0.0002585889411726041 + -0.0027880534700879546i, 0.12303334153474078 + -8.029872339970767e-19i, -0.021520400982217983 + 0.059155369769776936i, -0.0002803445053365397 + 0.0004041075624884855i, 5.625567443495588e-06 + -0.000352242634446967i, 0.0018531639810951113 + -0.0055177020577153665i, 0.0023393744206820907 + 0.001882962616946395i }, { 0.0014733614642101287 + 0.0023598941049704637i, -0.006386729771066804 + 0.001462654145414727i, -0.021520400982217983 + -0.059155369769776936i, 0.14786895919601128 + -1.1993986533120893e-18i, 0.0001625177621882949 + -0.00010312766619195905i, -0.00036069774224668696 + 0.0003342563882806021i, -0.0028841120647220947 + 7.981791211430893e-05i, 0.0019398580247709917 + -0.006462167583557331i }, { 0.001964044447517816 + 0.004414338545743038i, -0.0024070813435463404 + -4.685086947930992e-07i, -0.0002803445053365395 + -0.0004041075624884853i, 0.00016251776218829462 + 0.00010312766619195928i, 0.10277196039634628 + -2.642742795433417e-19i, -0.016809628451397097 + 0.05018289105304123i, -0.0029013063501539104 + -0.0018559624537155157i, 0.0016512342905115364 + -0.0012262710060465145i }, { 0.0016070021755802137 + -0.0018409233241346741i, 0.0022204510985079345 + 0.005137769925097855i, 5.625567443495669e-06 + 0.0003522426344469672i, -0.00036069774224668696 + -0.0003342563882806021i, -0.016809628451397097 + -0.05018289105304123i, 0.12399819583605055 + -8.368685518872487e-19i, -0.0003847681200232736 + 0.0014616855607687948i, -0.0035719894376922082 + -0.0023640305616606902i }, { -0.0012723758464375302 + -0.001072348531309567i, 0.0006351643887446689 + -0.0003024188098982418i, 0.0018531639810951115 + 0.0055177020577153665i, -0.0028841120647220956 + -7.981791211430925e-05i, -0.00290130635015391 + 0.0018559624537155157i, -0.00038476812002327394 + -0.0014616855607687941i, 0.1264791993624979 + -9.232659125071874e-20i, -0.020533486343902778 + 0.06184291985921819i }, { -0.00023828374434317842 + 0.000953372196927096i, -0.0015355361518260605 + -0.0012493724141614468i, 0.0023393744206820924 + -0.0018829626169463952i, 0.0019398580247709913 + 0.006462167583557334i, 0.0016512342905115364 + 0.0012262710060465143i, -0.0035719894376922074 + 0.0023640305616606902i, -0.020533486343902774 + -0.06184291985921819i, 0.1525438697241459 + -6.268043809681823e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10140603571432172, 1.0e-7), DoubleNear(0.12189843823588443, 1.0e-7), DoubleNear(0.12303334153474078, 1.0e-7), DoubleNear(0.14786895919601128, 1.0e-7), DoubleNear(0.10277196039634628, 1.0e-7), DoubleNear(0.12399819583605055, 1.0e-7), DoubleNear(0.1264791993624979, 1.0e-7), DoubleNear(0.1525438697241459, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.1082704876006153 + 8.199278929421627e-19i, -0.01981536578452663 + 0.05242627312293982i, -0.004420594671180918 + -0.0016607192945962924i, 0.0017064997416519885 + -0.0017412924458894384i, -0.00048187918114255023 + 0.00045920928066901676i, -0.0024308003731130803 + 0.0006885258522266863i, 6.586040950516076e-05 + -0.0004470417238018121i, 0.0002562199279670987 + -6.684779225208791e-06i }, { -0.01981536578452663 + -0.05242627312293982i, 0.1338177492631266 + 2.439454888092385e-19i, -3.218832870029574e-05 + 0.00249741375039186i, -0.005468856086544932 + -0.002555253896127948i, -0.0002001097663197388 + 0.0025131527687055682i, 5.9976020444443145e-05 + 0.0006004873495157425i, -0.00030856541657760814 + 6.952637546767018e-06i, -0.0001125888898151809 + -0.0004975497694041756i }, { -0.004420594671180918 + 0.001660719294596292i, -3.218832870029578e-05 + -0.00249741375039186i, 0.13235156335476492 + 7.78423278526702e-19i, -0.02414189137894291 + 0.06407626085282844i, -0.0007535204671537078 + 2.14345800445904e-05i, 0.00021208012583390592 + -0.0006083401431961632i, -0.000890545503717864 + 0.00035776743326635405i, -0.002656079396355938 + 0.0008154128001724925i }, { 0.0017064997416519883 + 0.0017412924458894388i, -0.005468856086544931 + 0.0025552538961279474i, -0.02414189137894291 + -0.06407626085282844i, 0.163417736504647 + 4.912791094074942e-20i, -6.567111610021972e-05 + 8.157129412773552e-05i, -0.0007899952705625293 + 0.00019676405016684061i, -1.3522031707779818e-05 + 0.0031705900488089985i, -0.0004695907754358898 + 0.0007316547048233786i }, { -0.00048187918114254974 + -0.0004592092806690165i, -0.00020010976631973897 + -0.0025131527687055682i, -0.000753520467153708 + -2.1434580044590618e-05i, -6.567111610021965e-05 + -8.157129412773555e-05i, 0.0959075085100527 + 6.589916329638457e-19i, -0.014677896031177095 + 0.04655868972566453i, -0.003741685547100692 + -0.0014559686112285667i, 0.0014180960130696766 + -0.0018448726651275394i }, { -0.0024308003731130807 + -0.0006885258522266863i, 5.997602044444347e-05 + -0.0006004873495157429i, 0.00021208012583390587 + 0.0006083401431961633i, -0.0007899952705625298 + -0.00019676405016684064i, -0.014677896031177095 + -0.04655868972566453i, 0.11207888480880841 + -1.018133602599669e-18i, -9.399085015037385e-05 + 0.0017523252804648888i, -0.004489863122214081 + -0.0012714308109474698i }, { 6.586040950516082e-05 + 0.0004470417238018118i, -0.00030856541657760803 + -6.952637546766984e-06i, -0.0008905455037178645 + -0.0003577674332663539i, -1.352203170777971e-05 + -0.0031705900488089985i, -0.003741685547100692 + 0.0014559686112285667i, -9.399085015037405e-05 + -0.0017523252804648886i, 0.11716097754247379 + -1.6737371037744975e-18i, -0.01791199594717785 + 0.0569220287761667i }, { 0.0002562199279670985 + 6.684779225208737e-06i, -0.00011258888981518085 + 0.0004975497694041755i, -0.002656079396355937 + -0.0008154128001724925i, -0.00046959077543588985 + -0.0007316547048233787i, 0.0014180960130696768 + 0.0018448726651275394i, -0.004489863122214081 + 0.0012714308109474698i, -0.01791199594717785 + -0.0569220287761667i, 0.13699509241551022 + -1.311207002349657e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1082704876006153, 1.0e-7), DoubleNear(0.1338177492631266, 1.0e-7), DoubleNear(0.13235156335476492, 1.0e-7), DoubleNear(0.163417736504647, 1.0e-7), DoubleNear(0.0959075085100527, 1.0e-7), DoubleNear(0.11207888480880841, 1.0e-7), DoubleNear(0.11716097754247379, 1.0e-7), DoubleNear(0.13699509241551022, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.10610003827236678 + -3.3542504711270293e-19i, -0.01764415029238699 + 0.05232746906731914i, -0.0042164473079971225 + -0.0015977298262570203i, 0.0016501822750824046 + -0.0020219544303332034i, -0.006424250339056089 + 0.007820206742450353i, -0.004048641052713558 + -0.0034572408913750774i, 0.00035562358089143647 + -0.0002657565380211499i, 0.00033116805219345167 + 0.00034150389276373403i }, { -0.01764415029238699 + -0.05232746906731914i, 0.13278525909885264 + -7.148958074826295e-19i, -0.0001307188301731778 + 0.0021269867823556854i, -0.00537198115158777 + -0.0021616934814264605i, 0.0026990312532646386 + 0.0022577663280498005i, -0.0025512104953325323 + 0.008880168030708685i, 0.00012273966326755749 + -3.634621378995267e-05i, 0.00026163131103704954 + -0.00034411641308771594i }, { -0.0042164473079971225 + 0.0015977298262570198i, -0.00013071883017317775 + -0.0021269867823556846i, 0.12970439146875137 + -6.2680438096818225e-19i, -0.021534139815944934 + 0.06394944385867654i, 0.00019931641174182846 + -0.00035873195145527887i, 2.692476330062964e-05 + -1.8439235012378865e-06i, -0.007877369594487564 + 0.009596532635850981i, -0.004883235638768867 + -0.004264730920655038i }, { 0.0016501822750824046 + 0.002021954430333204i, -0.00537198115158777 + 0.00216169348142646i, -0.021534139815944934 + -0.06394944385867656i, 0.16218840084996977 + -1.2536087619363645e-19i, -0.00034509039435672587 + -0.00011114007365399861i, -6.689410225744778e-05 + -0.0004005603816067514i, 0.0033121102482772105 + 0.0027260372324294296i, -0.0031424105584466895 + 0.010826926516921092i }, { -0.00642425033905609 + -0.00782020674245035i, 0.0026990312532646386 + -0.002257766328049803i, 0.0001993164117418285 + 0.0003587319514552786i, -0.00034509039435672565 + 0.00011114007365399882i, 0.09807795783830123 + 1.8143445730187113e-18i, -0.016849111523316734 + 0.04665749378128521i, -0.003945832910284487 + -0.0015189580795678388i, 0.0014744134796392605 + -0.0015642106806837744i }, { -0.004048641052713557 + 0.0034572408913750765i, -0.0025512104953325336 + -0.008880168030708683i, 2.6924763300629763e-05 + 1.8439235012379543e-06i, -6.689410225744805e-05 + 0.0004005603816067511i, -0.016849111523316734 + -0.04665749378128521i, 0.11311137497308238 + -5.929230630780102e-20i, 4.539651322508221e-06 + 0.002122752248501064i, -0.004586738057171243 + -0.0016649912256489572i }, { 0.00035562358089143647 + 0.0002657565380211499i, 0.00012273966326755722 + 3.6346213789952735e-05i, -0.007877369594487564 + -0.009596532635850986i, 0.003312110248277213 + -0.002726037232429427i, -0.003945832910284487 + 0.0015189580795678388i, 4.539651322507909e-06 + -0.0021227522485010642i, 0.11980814942848733 + -2.685094442796132e-19i, -0.020519747510175823 + 0.05704884577031859i }, { 0.0003311680521934514 + -0.00034150389276373376i, 0.0002616313110370495 + 0.00034411641308771594i, -0.004883235638768867 + 0.004264730920655038i, -0.003142410558446688 + -0.010826926516921092i, 0.0014744134796392605 + 0.0015642106806837744i, -0.004586738057171242 + 0.0016649912256489572i, -0.020519747510175827 + -0.05704884577031859i, 0.13822442807018742 + -1.136718215215271e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.10610003827236678, 1.0e-7), DoubleNear(0.13278525909885264, 1.0e-7), DoubleNear(0.12970439146875137, 1.0e-7), DoubleNear(0.16218840084996977, 1.0e-7), DoubleNear(0.09807795783830123, 1.0e-7), DoubleNear(0.11311137497308238, 1.0e-7), DoubleNear(0.11980814942848733, 1.0e-7), DoubleNear(0.13822442807018742, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.23169946778861691 + 2.4318315915670963e-18i, -0.039022666936339906 + 0.11240080294942117i, 0.009335294304914416 + 0.006665286667398774i, -0.005368852492350474 + 0.0031556087902555284i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.039022666936339906 + -0.11240080294942117i, 0.2788442107608111 + -6.352747104407253e-19i, 0.0013106033928961575 + -0.005311598772050622i, 0.01089288446921354 + 0.007938640033658266i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.009335294304914414 + -0.006665286667398772i, 0.0013106033928961575 + 0.00531159877205062i, 0.22199106921928977 + -1.8482258909088833e-18i, -0.03752448220548457 + 0.1075824495281783i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0053688524923504715 + -0.0031556087902555275i, 0.010892884469213535 + -0.007938640033658264i, -0.037524482205484586 + -0.1075824495281783i, 0.26746525223128104 + -1.4009924947586128e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.23169946778861691, 1.0e-7), DoubleNear(0.2788442107608111, 1.0e-7), DoubleNear(0.22199106921928977, 1.0e-7), DoubleNear(0.26746525223128104, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.11405750347076227 + 2.120970499924768e-18i, -0.019885953677783064 + 0.054869456526150454i, 0.004832022821167089 + 0.0028778108331564065i, -0.002539590445569297 + 0.0017195165606058126i, 0.0016458393107725987 + -0.006497732150052529i, 0.0027006548014134064 + 0.002044979492451503i, 0.0010626312926920755 + 4.251603068211494e-05i, -8.969305548320018e-05 + 0.0004995041462405761i }, { -0.019885953677783064 + -0.054869456526150454i, 0.13702914636830305 + -8.809142651444724e-20i, 0.0003528396942162025 + -0.002663686925677999i, 0.005630283340465028 + 0.003459003785056873i, -0.003302795248837727 + 0.0004967732000755099i, 0.0016645431928268264 + -0.007581126646919209i, -6.825919707566239e-06 + -0.0005370660388890723i, 0.0013064441168197131 + 0.00014138718376176002i }, { 0.004832022821167091 + -0.002877810833156407i, 0.0003528396942162034 + 0.0026636869256779984i, 0.11038187377830022 + -1.1807639284724947e-18i, -0.01931808066874155 + 0.053087985039189586i, -0.0006279514527963943 + 0.0004662898135970955i, -0.00025156175378868487 + -0.0004218925506478124i, 0.002171369117840329 + -0.0034343084534058724i, 0.0012457217948488976 + 0.0016789064486295658i }, { -0.002539590445569297 + -0.0017195165606058121i, 0.005630283340465027 + -0.0034590037850568724i, -0.019318080668741553 + -0.053087985039189586i, 0.13273825106359266 + -1.0486267887008238e-18i, 0.00022103123983340003 + 0.00016889881827980455i, -0.0007267121665744338 + 0.0006346955131072503i, -0.0019883981594307075 + -0.0004164867792664082i, 0.0024957659304521004 + -0.004018810861735975i }, { 0.0016458393107725993 + 0.00649773215005253i, -0.003302795248837728 + -0.0004967732000755101i, -0.0006279514527963939 + -0.000466289813597097i, 0.00022103123983340038 + -0.00016889881827980398i, 0.11764196431785465 + 3.1086109164232822e-19i, -0.019136713258556842 + 0.05753134642327072i, 0.004503271483747326 + 0.0037874758342423672i, -0.002829262046781177 + 0.0014360922296497154i }, { 0.0027006548014134072 + -0.0020449794924515038i, 0.0016645431928268267 + 0.0075811266469192114i, -0.00025156175378868525 + 0.00042189255064781277i, -0.000726712166574434 + -0.0006346955131072511i, -0.019136713258556842 + -0.05753134642327072i, 0.14181506439250807 + -5.47183283926278e-19i, 0.0009577636986799545 + -0.0026479118463726228i, 0.005262601128748509 + 0.004479636248601393i }, { 0.0010626312926920742 + -4.251603068211428e-05i, -6.8259197075657915e-06 + 0.0005370660388890714i, 0.002171369117840328 + 0.0034343084534058732i, -0.001988398159430708 + 0.0004164867792664078i, 0.004503271483747324 + -0.0037874758342423638i, 0.0009577636986799537 + 0.002647911846372622i, 0.11160919544098954 + -6.674619624363887e-19i, -0.01820640153674303 + 0.05449446448898871i }, { -8.969305548319994e-05 + -0.0004995041462405759i, 0.0013064441168197118 + -0.00014138718376176043i, 0.001245721794848899 + -0.0016789064486295658i, 0.002495765930452099 + 0.004018810861735978i, -0.002829262046781175 + -0.0014360922296497154i, 0.005262601128748507 + -0.00447963624860139i, -0.01820640153674303 + -0.05449446448898871i, 0.13472700116768838 + -3.5236570605778894e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.11405750347076227, 1.0e-7), DoubleNear(0.13702914636830305, 1.0e-7), DoubleNear(0.11038187377830022, 1.0e-7), DoubleNear(0.13273825106359266, 1.0e-7), DoubleNear(0.11764196431785465, 1.0e-7), DoubleNear(0.14181506439250807, 1.0e-7), DoubleNear(0.11160919544098954, 1.0e-7), DoubleNear(0.13472700116768838, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.12260661766270325 + 1.7643696291307076e-18i, -0.022451132335348484 + 0.059322732466327244i, 0.004618070261402374 + 0.0031608866485983785i, -0.002265288007255487 + 0.001654921437803722i, -0.000757869156090326 + 0.0005026491513063715i, -0.002559854271367749 + 0.0008498838310793987i, -3.2646851000425075e-06 + -0.0001644746648462215i, -0.000405222694968834 + 0.0004392504035926882i }, { -0.022451132335348487 + -0.059322732466327244i, 0.151919556623494 + 6.047815243395704e-19i, 0.0005827044122420696 + -0.0030667932894137603i, 0.0060360465233418835 + 0.0038175704955610602i, 2.7049152981271874e-06 + 0.0030095134067300183i, -0.00033473509798866575 + 0.0008687118040047364i, -0.0004238503951520511 + 0.0007794202465029071i, -0.00012078827602344611 + 2.680961884947826e-06i }, { 0.004618070261402373 + -0.003160886648598378i, 0.0005827044122420693 + 0.0030667932894137585i, 0.11801543329267697 + -1.6601845766184287e-19i, -0.021506124828121052 + 0.05717980150944101i, 0.00018265941939573936 + -0.00011583735642458747i, -0.00044367971704626865 + 0.0005668151395740405i, -0.0006145555287700884 + 0.0003143275626289991i, -0.0025270254981012694 + 0.00065405482131978i }, { -0.002265288007255486 + -0.001654921437803721i, 0.006036046523341878 + -0.0038175704955610585i, -0.02150612482812106 + -0.057179801509441006i, 0.1453159291442796 + -3.1170812458958252e-19i, -0.00022803710292381004 + 0.00041274315258416083i, 0.00010233931836723642 + 8.471278439860053e-05i, -0.0002163367133256456 + 0.002674229410784549i, -7.487965700278087e-05 + 0.00046343025033438487i }, { -0.0007578691560903258 + -0.0005026491513063711i, 2.704915298127079e-06 + -0.0030095134067300183i, 0.00018265941939573938 + 0.00011583735642458744i, -0.00022803710292381015 + -0.0004127431525841606i, 0.10909285012591366 + 6.674619624363887e-19i, -0.016571534600991422 + 0.05307807048309393i, 0.004717224043512042 + 0.0035044000188003952i, -0.0031035644850949872 + 0.0015006873524518064i }, { -0.002559854271367749 + -0.0008498838310793989i, -0.0003347350979886657 + -0.0008687118040047366i, -0.0004436797170462684 + -0.0005668151395740403i, 0.00010233931836723639 + -8.47127843986004e-05i, -0.016571534600991422 + -0.05307807048309393i, 0.12692465413731716 + -1.2400562347802957e-18i, 0.0007278989806540879 + -0.0022448054826368614i, 0.0048568379458716554 + 0.0041210695380972055i }, { -3.2646851000427243e-06 + 0.00016447466484622144i, -0.000423850395152051 + -0.0007794202465029071i, -0.0006145555287700883 + -0.0003143275626289993i, -0.0002163367133256458 + -0.002674229410784549i, 0.004717224043512041 + -0.003504400018800393i, 0.0007278989806540877 + 0.0022448054826368614i, 0.10397563592661281 + -1.6822074332470405e-18i, -0.016018357377363523 + 0.05040264801873729i }, { -0.000405222694968834 + -0.00043925040359268816i, -0.00012078827602344619 + -2.680961884948097e-06i, -0.0025270254981012694 + -0.0006540548213197796i, -7.487965700278055e-05 + -0.00046343025033438514i, -0.0031035644850949864 + -0.0015006873524518066i, 0.004856837945871657 + -0.004121069538097204i, -0.016018357377363526 + -0.05040264801873729i, 0.12214932308700145 + -1.0892843701690302e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12260661766270325, 1.0e-7), DoubleNear(0.151919556623494, 1.0e-7), DoubleNear(0.11801543329267697, 1.0e-7), DoubleNear(0.1453159291442796, 1.0e-7), DoubleNear(0.10909285012591366, 1.0e-7), DoubleNear(0.12692465413731716, 1.0e-7), DoubleNear(0.10397563592661281, 1.0e-7), DoubleNear(0.12214932308700145, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.1204445020583472 + 5.996993266560446e-19i, -0.022054308880820814 + 0.058909575656173586i, 0.008390984606219665 + 0.0004427503739725954i, -0.0019437293542836239 + 0.0038656755599866493i, -0.010661386943046584 + 0.010107463568742413i, -0.00651859292172551 + -0.004920265483638267i, -0.002585095199299254 + 0.013606909251129114i, -0.005803265759517065 + -0.003960538342670971i }, { -0.022054308880820817 + -0.058909575656173586i, 0.15446419835233033 + -1.2807138162485021e-18i, -0.0031019064117558917 + -0.006090602611458695i, 0.017012281661276527 + -6.430978513668784e-05i, 0.002768970470194084 + 0.0052049957480430065i, -0.0033659759777002213 + 0.010684807085632509i, 0.004736747684927068 + -0.001964315438812113i, 0.0005368211929510595 + 0.012246491654026356i }, { 0.008390984606219665 + -0.00044275037397259345i, -0.0031019064117558926 + 0.006090602611458693i, 0.11535992768277092 + -1.5619287547369298e-18i, -0.017123981227511107 + 0.0573673372698221i, -0.012403237467123865 + 0.00873628617008678i, -0.002222482162458394 + -0.005492673133761701i, -0.0036402329904970674 + 0.00730927580955892i, -0.002413283769756915 + -0.0028017063283918486i }, { -0.0019437293542836236 + -0.003865675559986649i, 0.017012281661276524 + 6.430978513669109e-05i, -0.01712398122751111 + -0.0573673372698221i, 0.14050946159649202 + 4.404571325722362e-19i, 0.00687500126191768 + 0.005003998091601016i, -0.01131868168370442 + 0.008988237373308219i, 0.0032421710313477654 + -0.00022119218756377597i, -0.0023276450760790005 + 0.009022287461997265i }, { -0.010661386943046585 + -0.010107463568742415i, 0.002768970470194085 + -0.005204995748043006i, -0.012403237467123863 + -0.00873628617008678i, 0.00687500126191768 + -0.005003998091601014i, 0.11125496573026972 + 1.8321322649110516e-18i, -0.016968358055519092 + 0.05349122729324759i, 0.0009443096986947497 + 0.006222536293426178i, -0.00342512313806685 + -0.0007100667697311209i }, { -0.006518592921725509 + 0.004920265483638266i, -0.003365975977700221 + -0.010684807085632507i, -0.0022224821624583944 + 0.0054926731337617005i, -0.011318681683704418 + -0.008988237373308219i, -0.016968358055519092 + -0.05349122729324759i, 0.1243800124084808 + 6.454391058077769e-19i, 0.004412509804652049 + 0.000779003839408073i, -0.006119397192062987 + 0.008002949818794954i }, { -0.002585095199299254 + -0.013606909251129118i, 0.0047367476849270685 + 0.0019643154388121133i, -0.0036402329904970687 + -0.00730927580955892i, 0.0032421710313477667 + 0.0002211921875637756i, 0.0009443096986947491 + -0.006222536293426178i, 0.00441250980465205 + -0.000779003839408073i, 0.10663114153651884 + -2.862971361719535e-19i, -0.020400500977973468 + 0.050215112258356204i }, { -0.0058032657595170675 + 0.003960538342670973i, 0.0005368211929510603 + -0.012246491654026356i, -0.002413283769756915 + 0.0028017063283918486i, -0.002327645076079001 + -0.009022287461997267i, -0.0034251231380668483 + 0.0007100667697311214i, -0.006119397192062988 + -0.008002949818794954i, -0.020400500977973475 + -0.050215112258356204i, 0.126955790634789 + -1.841449627330849e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1204445020583472, 1.0e-7), DoubleNear(0.15446419835233033, 1.0e-7), DoubleNear(0.11535992768277092, 1.0e-7), DoubleNear(0.14050946159649202, 1.0e-7), DoubleNear(0.11125496573026972, 1.0e-7), DoubleNear(0.1243800124084808, 1.0e-7), DoubleNear(0.10663114153651884, 1.0e-7), DoubleNear(0.126955790634789, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.2244393772490625 + 9.402065714522734e-19i, -0.03920403434652461 + 0.10795744156534004i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003817208428612927 + -0.009932040603458401i, 0.003946376596262304 + 0.0037238859410810687i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03920403434652461 + -0.10795744156534004i, 0.2697673974318957 + -1.136718215215271e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005291193408268434 + 8.02864208091017e-05i, 0.004160309123278927 + -0.011599937508655185i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003817208428612927 + 0.009932040603458404i, -0.005291193408268436 + -8.028642080910224e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2292511597588442 + -3.5660087079406044e-19i, -0.03734311479529987 + 0.11202581091225944i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003946376596262307 + -0.003723885941081069i, 0.004160309123278925 + 0.011599937508655189i, 0.0 + 0.0i, 0.0 + 0.0i, -0.037343114795299864 + -0.11202581091225944i, 0.2765420655601965 + -8.99548989984067e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2244393772490625, 1.0e-7), DoubleNear(0.2697673974318957, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2292511597588442, 1.0e-7), DoubleNear(0.2765420655601965, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.2406220509553802 + 1.5983511714688647e-18i, -0.04395725716346954 + 0.11650253397576825i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0013724246848604144 + 0.0008169767139353709i, -0.005086879769469019 + 0.0015039386523991788i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04395725716346954 + -0.11650253397576826i, 0.2972354857677736 + 2.930733997499879e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00021363179802751846 + 0.005683742817514567i, -0.00040961475499144673 + 0.001332142054339121i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0013724246848604142 + -0.0008169767139353704i, -0.00021363179802751868 + -0.005683742817514567i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21306848605252648 + -1.0147454708106518e-18i, -0.03258989197835495 + 0.10348071850183121i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005086879769469019 + -0.0015039386523991785i, -0.00040961475499144625 + -0.0013321420543391217i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03258989197835495 + -0.10348071850183121i, 0.2490739772243186 + -2.329340604949326e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2406220509553802, 1.0e-7), DoubleNear(0.2972354857677736, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21306848605252648, 1.0e-7), DoubleNear(0.2490739772243186, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.23580442974111815 + -9.622294280808852e-19i, -0.03917829010833192 + 0.11627691292599568i, 0.0 + 0.0i, 0.0 + 0.0i, -0.01430161993354365 + 0.017416739378301335i, -0.008931876691482425 + -0.007721971812030115i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.039178290108331924 + -0.11627691292599568i, 0.2949736599488224 + -8.402566836762659e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.006011141501541849 + 0.00498380356047923i, -0.005693621053779222 + 0.019707094547629776i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014301619933543652 + -0.017416739378301335i, 0.0060111415015418525 + -0.00498380356047923i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21788610726678856 + 1.5458351287390981e-18i, -0.03736885903349256 + 0.10370633955160379i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008931876691482425 + 0.007721971812030114i, -0.005693621053779222 + -0.019707094547629776i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03736885903349256 + -0.1037063395516038i, 0.25133580304326986 + -1.196010521523072e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.23580442974111815, 1.0e-7), DoubleNear(0.2949736599488224, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21788610726678856, 1.0e-7), DoubleNear(0.25133580304326986, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.1195964317290831 + 7.386127300057499e-19i, -0.021590474880742894 + 0.05772116565950042i, 0.0024999684242635227 + -0.007065463078585193i, 0.004289894475788911 + 0.000995785602873861i, -0.0007390670574426319 + -0.0011144486782787484i, -0.0017703385567554167 + 0.0010205707310421415i, 0.0007090677339804484 + 0.0006253438761622387i, -0.00038686063780254753 + 0.0006818337164556748i }, { -0.0215904748807429 + -0.05772116565950042i, 0.14614857302803735 + -4.54009659728305e-19i, -0.0030633119385757865 + -0.0017811814281020208i, 0.0010577093179986792 + -0.004871984860101025i, -0.0008047424196163797 + 0.0031532337697973843i, -0.0003778602943018337 + -0.0012687470744450605i, 0.000418526121613166 + -6.925764246272928e-05i, 0.0004981438912037131 + 0.0002885095908043773i }, { 0.002499968424263521 + 0.007065463078585195i, -0.003063311938575787 + 0.0017811814281020188i, 0.1210256192262971 + 8.597384414631148e-19i, -0.022366782282726642 + 0.05878136831626783i, 7.920326593298618e-05 + 0.0005878213874788923i, -0.0003761079953382204 + -0.00011528432770705586i, -0.0006333576274177824 + 0.0019314253922141193i, -0.003316541212713601 + 0.0004833679213570376i }, { 0.004289894475788911 + -0.000995785602873861i, 0.001057709317998677 + 0.004871984860101028i, -0.02236678228272664 + -0.05878136831626784i, 0.15108691273973626 + 7.470830594782929e-19i, 0.00030964400326894927 + -0.00013252668271427625i, -3.7024374547934134e-05 + 0.0008861503516149971i, 0.0005911106215888613 + 0.002530509047717183i, -3.175446068961297e-05 + 0.0026008891287841816i }, { -0.0007390670574426314 + 0.0011144486782787488i, -0.00080474241961638 + -0.0031532337697973843i, 7.920326593298602e-05 + -0.0005878213874788929i, 0.00030964400326894965 + 0.00013252668271427647i, 0.1048429455199794 + 2.0159384144652348e-19i, -0.017613559465781716 + 0.05023627590583962i, 0.0013172400043494049 + -0.0028665775248732078i, -0.0003435178795266063 + 0.0027281003382072077i }, { -0.0017703385567554167 + -0.0010205707310421413i, -0.0003778602943018332 + 0.0012687470744450608i, -0.00037610799533822046 + 0.00011528432770705595i, -3.702437454793434e-05 + -0.0008861503516149974i, -0.017613559465781716 + -0.05023627590583962i, 0.12361882440385838 + -6.827085554869661e-19i, -0.002227881469692648 + 0.0018614678489111225i, 0.003102599805280248 + -0.006727952648554159i }, { 0.0007090677339804478 + -0.0006253438761622387i, 0.00041852612161316573 + 6.925764246272942e-05i, -0.0006333576274177826 + -0.0019314253922141193i, 0.0005911106215888613 + -0.002530509047717183i, 0.0013172400043494062 + 0.0028665775248732095i, -0.0022278814696926486 + -0.001861467848911121i, 0.10822554053254708 + -1.2163393122571753e-18i, -0.014976332512573229 + 0.05324444259599159i }, { -0.0003868606378025474 + -0.0006818337164556742i, 0.0004981438912037129 + -0.0002885095908043775i, -0.0033165412127136016 + -0.0004833679213570373i, -3.1754460689613026e-05 + -0.0026008891287841824i, -0.00034351787952660465 + -0.0027281003382072086i, 0.0031025998052802485 + 0.006727952648554161i, -0.01497633251257323 + -0.05324444259599159i, 0.12545515282046021 + -1.6466320494623599e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1195964317290831, 1.0e-7), DoubleNear(0.14614857302803735, 1.0e-7), DoubleNear(0.1210256192262971, 1.0e-7), DoubleNear(0.15108691273973626, 1.0e-7), DoubleNear(0.1048429455199794, 1.0e-7), DoubleNear(0.12361882440385838, 1.0e-7), DoubleNear(0.10822554053254708, 1.0e-7), DoubleNear(0.12545515282046021, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.11680948457895514 + -5.421010862427522e-20i, -0.02087078843103096 + 0.057066480163891264i, 0.002140186289404265 + -0.005060309337401992i, 0.0018028937510995132 + 0.002179909211849444i, -0.007697098150437575 + 0.00903317973210109i, -0.003847798035102003 + -0.005522785655348011i, -0.0001726974574192985 + 0.0005180614609480989i, -0.0003304680883413178 + -0.0002602853157506307i }, { -0.020870788431030962 + -0.057066480163891264i, 0.145580608030002 + 3.4558944247975454e-19i, -0.0027171094096849926 + 0.00015363330825430557i, 0.002375555588370359 + -0.005745236639359589i, 0.0034614621251586597 + 0.0011378060288269212i, -0.0029680960670095506 + 0.009741095656382502i, 1.2773898965632885e-05 + -0.0002200696929367139i, 0.00023356553813061554 + 0.000335107120492949i }, { 0.002140186289404266 + 0.005060309337401993i, -0.002717109409684994 + -0.0001536333082543048i, 0.118994945162163 + -9.0801931945661e-19i, -0.018307501677300962 + 0.059210432762104415i, -0.0004870031330925222 + 0.00011154022938768092i, 0.00018211780550317472 + -0.0002676653359122102i, -0.006604521783106077 + 0.008383559646200243i, -0.005084078656380422 + -0.002199186156682104i }, { 0.0018028937510995147 + -0.0021799092118494445i, 0.002375555588370359 + 0.005745236639359592i, -0.018307501677300962 + -0.05921043276210442i, 0.1493930519188204 + -1.1858461261560205e-18i, 0.0002948143106342491 + 7.039154637501416e-05i, -8.33363680841522e-05 + 0.0003925070053841692i, 0.0025496793763831894 + 0.0038459975316523093i, -0.002725524986769671 + 0.009965998891247274i }, { -0.007697098150437575 + -0.009033179732101092i, 0.0034614621251586614 + -0.0011378060288269203i, -0.0004870031330925209 + -0.00011154022938767967i, 0.000294814310634248 + -7.039154637501459e-05i, 0.10762989267010736 + 9.944166800765486e-19i, -0.01833324591549365 + 0.050890961401448775i, 0.0016770221392086622 + -0.00487173126605641i, 0.002143482845162791 + 0.0015439767292316246i }, { -0.0038477980351020033 + 0.005522785655348011i, -0.0029680960670095484 + -0.009741095656382502i, 0.00018211780550317494 + 0.0002676653359122093i, -8.333636808415155e-05 + -0.00039250700538416767i, -0.018333245915493655 + -0.050890961401448775i, 0.12418678940189373 + -1.4823076576950256e-18i, -0.002574083998583442 + -7.334688744520387e-05i, 0.0017847535349085678 + -0.005854700869295596i }, { -0.00017269745741929865 + -0.0005180614609480994i, 1.2773898965633644e-05 + 0.00022006969293671434i, -0.006604521783106077 + -0.008383559646200243i, 0.002549679376383191 + -0.0038459975316523097i, 0.0016770221392086615 + 0.004871731266056411i, -0.002574083998583442 + 7.334688744520257e-05i, 0.1102562145966812 + 5.514184486625495e-19i, -0.01903561311799891 + 0.052815378150155017i }, { -0.0003304680883413176 + 0.000260285315750631i, 0.0002335655381306161 + -0.00033510712049295054i, -0.005084078656380421 + 0.002199186156682103i, -0.0027255249867696734 + -0.009965998891247274i, 0.0021434828451627917 + -0.0015439767292316246i, 0.0017847535349085663 + 0.005854700869295597i, -0.019035613117998906 + -0.05281537815015501i, 0.1271490136413761 + 2.862971361719535e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.11680948457895514, 1.0e-7), DoubleNear(0.145580608030002, 1.0e-7), DoubleNear(0.118994945162163, 1.0e-7), DoubleNear(0.1493930519188204, 1.0e-7), DoubleNear(0.10762989267010736, 1.0e-7), DoubleNear(0.12418678940189373, 1.0e-7), DoubleNear(0.1102562145966812, 1.0e-7), DoubleNear(0.1271490136413761, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.1255810470280899 + 1.7279472123987727e-19i, -0.021799895532514196 + 0.06248359458053415i, -0.000453530488683935 + -3.11186841419343e-05i, -0.004011231256690045 + 0.002431642708433634i, -0.0059585419433966025 + 0.007552859288356985i, -0.006090124378966133 + -0.002832152896890079i, -0.0003826524242912932 + 0.0009706093370722316i, -0.0017869458621743747 + -0.0033750625405891983i }, { -0.0217998955325142 + -0.06248359458053416i, 0.16232520274685283 + 3.1170812458958252e-19i, -0.0011401451725136654 + 0.005086228992591026i, -0.000802806174168605 + 0.0011178287319796357i, 0.0024830781273967283 + 0.0033824969808065423i, -0.0025549239423484013 + 0.01134934935324485i, -0.0020837098835838203 + -0.003504900739085423i, -0.00023788327704895212 + -4.8344233923813584e-05i }, { -0.00045353048868393496 + 3.111868414193452e-05i, -0.001140145172513665 + -0.005086228992591026i, 0.11022338271302824 + -1.1350241493207625e-18i, -0.017378394575817725 + 0.05379331834546153i, -0.0005949354303997419 + -0.00024855550945693055i, 0.0034646864940717807 + -0.000609364199735102i, -0.008343077990147049 + 0.009863880089944349i, -0.002841752312516291 + -0.0048898189151400364i }, { -0.004011231256690045 + -0.002431642708433634i, -0.0008028061741686051 + -0.0011178287319796362i, -0.017378394575817725 + -0.05379331834546153i, 0.13264845720196955 + -1.1519648082658485e-18i, 0.003601672302582276 + -0.0005467230618730025i, -5.838607879980577e-05 + -0.00017407021425310573i, 0.003528063374145121 + 0.0016013065796726877i, -0.0031386971114308205 + 0.008357745194384926i }, { -0.005958541943396605 + -0.007552859288356986i, 0.00248307812739673 + -0.0033824969808065428i, -0.0005949354303997417 + 0.00024855550945693055i, 0.0036016723025822754 + 0.0005467230618730024i, 0.11504100392729032 + 1.4255564502289875e-18i, -0.022157361630955344 + 0.0540189393952341i, -0.0009188941961764793 + 0.0008480953980773052i, -0.0010756485127789738 + -0.0009277040560344553i }, { -0.006090124378966133 + 0.0028321528968900805i, -0.002554923942348403 + -0.011349349353244852i, 0.0034646864940717816 + 0.0006093641997351017i, -5.838607879980528e-05 + 0.00017407021425310578i, -0.02215736163095534 + -0.0540189393952341i, 0.13491028302092078 + -1.8634724839594607e-20i, 0.000926513374486147 + 0.0005975138249235414i, 0.00039319141917715825 + 0.0002143133223594854i }, { -0.0003826524242912933 + -0.0009706093370722319i, -0.0020837098835838203 + 0.003504900739085423i, -0.008343077990147047 + -0.009863880089944349i, 0.003528063374145122 + -0.0016013065796726873i, -0.0009188941961764791 + -0.0008480953980773049i, 0.0009265133744861463 + -0.0005975138249235412i, 0.10284510333949824 + 1.2027867851011065e-19i, -0.01521149740253722 + 0.04968740015636969i }, { -0.001786945862174375 + 0.0033750625405891987i, -0.00023788327704895234 + 4.834423392381421e-05i, -0.002841752312516291 + 0.004889818915140034i, -0.0031386971114308188 + -0.008357745194384925i, -0.0010756485127789738 + 0.0009277040560344556i, 0.00039319141917715884 + -0.0002143133223594855i, -0.01521149740253722 + -0.049687400156369695i, 0.11642552002234904 + -1.1773757966834775e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1255810470280899, 1.0e-7), DoubleNear(0.16232520274685283, 1.0e-7), DoubleNear(0.11022338271302824, 1.0e-7), DoubleNear(0.13264845720196955, 1.0e-7), DoubleNear(0.11504100392729032, 1.0e-7), DoubleNear(0.13491028302092078, 1.0e-7), DoubleNear(0.10284510333949824, 1.0e-7), DoubleNear(0.11642552002234904, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.110906621338633 + -7.623296525288703e-19i, 0.0011661394622134013 + -0.015369684121591752i, -0.009295281986572918 + -0.003701201825802838i, -0.01273149554597635 + -0.008593118135471286i, 0.004468556410079848 + 0.003124532629255075i, 0.0004597832526612462 + -0.0005566083098060792i, -0.00022102934090663894 + -0.000440371864840301i, -0.00022714324405140058 + -0.0007355219258231506i }, { 0.0011661394622134015 + 0.015369684121591754i, 0.11884361275626036 + -1.3213713977167085e-19i, 0.004060899242197363 + 0.020754596530240053i, 8.3549012184754e-05 + 0.00015409353619555i, -0.00039837270998909825 + 0.0006195857819881593i, 0.004645979036654952 + 0.0034812868044660945i, -0.00030194309698669135 + 0.0008174366324302561i, 4.771417296929966e-06 + 0.00011792754436427558i }, { -0.009295281986572918 + 0.0037012018258028375i, 0.004060899242197362 + -0.020754596530240053i, 0.16167228971265102 + 1.6059744679941534e-18i, -0.006467964704339822 + 0.005443103311095418i, -0.0005315401461107878 + -0.00010631811666934941i, 0.0006934157266601512 + -0.0007009976709192769i, 0.006384239491130308 + 0.004614384818553257i, -0.0003808935904613083 + 5.1665522244408174e-05i }, { -0.01273149554597635 + 0.008593118135471284i, 8.354901218475378e-05 + -0.00015409353619555018i, -0.006467964704339821 + -0.005443103311095418i, 0.1191211547418837 + 1.0850492054327587e-18i, -0.0008674045282431554 + -4.060131696567823e-05i, 7.84001593361552e-05 + 4.693474535457543e-07i, -9.107190065105701e-05 + -0.0003475360579498005i, 0.0047294038362628455 + 0.003383722448782613i }, { 0.004468556410079848 + -0.0031245326292550753i, -0.00039837270998909803 + -0.000619585781988159i, -0.0005315401461107877 + 0.00010631811666934969i, -0.0008674045282431553 + 4.0601316965678286e-05i, 0.10670831764187962 + 8.097634975751111e-19i, 0.0010891389516344307 + -0.01472956354854274i, -0.008842100026775462 + -0.0035689380674048176i, -0.012329578240163664 + -0.008108659078386331i }, { 0.00045978325266124605 + 0.0005566083098060795i, 0.004645979036654955 + -0.003481286804466095i, 0.0006934157266601514 + 0.0007009976709192774i, 7.840015933615489e-05 + -4.693474535459271e-07i, 0.0010891389516344307 + 0.01472956354854274i, 0.11361607844583002 + 7.894347068410079e-19i, 0.00416660655191837 + 0.019982412108912103i, -6.716642587699631e-05 + 0.00017267374411182907i }, { -0.00022102934090663894 + 0.0004403718648403014i, -0.0003019430969866912 + -0.0008174366324302563i, 0.006384239491130305 + -0.004614384818553254i, -9.107190065105693e-05 + 0.0003475360579498006i, -0.008842100026775462 + 0.0035689380674048176i, 0.00416660655191837 + -0.019982412108912103i, 0.15476430731290441 + -1.5517643593698782e-18i, -0.006260669277443299 + 0.005281021579015114i }, { -0.0002271432440513997 + 0.000735521925823151i, 4.771417296929956e-06 + -0.00011792754436427565i, -0.0003808935904613081 + -5.1665522244408743e-05i, 0.004729403836262842 + -0.0033837224487826105i, -0.012329578240163664 + 0.008108659078386331i, -6.716642587699663e-05 + -0.0001726737441118292i, -0.006260669277443301 + -0.005281021579015115i, 0.11436761804995678 + -3.296652230713737e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.110906621338633, 1.0e-7), DoubleNear(0.11884361275626036, 1.0e-7), DoubleNear(0.16167228971265102, 1.0e-7), DoubleNear(0.1191211547418837, 1.0e-7), DoubleNear(0.10670831764187962, 1.0e-7), DoubleNear(0.11361607844583002, 1.0e-7), DoubleNear(0.15476430731290441, 1.0e-7), DoubleNear(0.11436761804995678, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.21761493898051262 + 4.743384504624082e-20i, 0.002255278413847832 + -0.030099247670134492i, -0.01813738201334838 + -0.0072701398932076555i, -0.02506107378614001 + -0.016701777213857617i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002255278413847832 + 0.030099247670134496i, 0.23245969120209037 + 6.572975670693371e-19i, 0.008227505794115733 + 0.04073700863915215i, 1.6382586307757654e-05 + 0.00032676728030737903i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01813738201334838 + 0.0072701398932076555i, 0.008227505794115731 + -0.04073700863915216i, 0.3164365970255555 + 5.421010862427522e-20i, -0.012728633981783121 + 0.010724124890110532i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.025061073786140014 + 0.016701777213857613i, 1.638258630775718e-05 + -0.00032676728030737936i, -0.012728633981783121 + -0.010724124890110532i, 0.2334887727918405 + -2.211603025280978e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21761493898051262, 1.0e-7), DoubleNear(0.23245969120209037, 1.0e-7), DoubleNear(0.3164365970255555, 1.0e-7), DoubleNear(0.2334887727918405, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.1071342745762043 + 6.166399856011306e-19i, 0.0011705852113614466 + -0.01372296609650617i, -0.010825339201693436 + -0.0023428324593258963i, -0.013363616874000141 + -0.00858469489047869i, 0.0014524986018278024 + -0.003051842961103027i, -0.0004893318490942547 + -5.228747233010222e-05i, -0.002156503309697061 + 0.0035016176493821707i, -0.00014989671756179178 + -0.00125767784877957i }, { 0.0011705852113614468 + 0.013722966096506176i, 0.11617019937400186 + 1.1892342579450377e-18i, 0.0032277650007459485 + 0.019374555690305807i, -0.000822364437501068 + -0.0003805471381981737i, 0.00036474089030673817 + -0.0013979853902225609i, 0.0027319969441979485 + -0.006500265509737862i, -0.0007777855105585264 + 0.00040459766086287015i, -0.0006514086885665298 + -0.0011798967039111574i }, { -0.010825339201693436 + 0.002342832459325896i, 0.0032277650007459476 + -0.019374555690305807i, 0.15475923181666507 + -4.87890977618477e-19i, -0.006282062127872717 + 0.005046334758563182i, -0.001355800450371632 + 0.00036391418043891144i, -0.0008591840334730759 + 0.0010261660985596494i, 0.0022017527349445128 + -0.006729002223603356i, 0.0014008834843306107 + 0.00010196674246769235i }, { -0.013363616874000143 + 0.008584694890478686i, -0.0008223644375010687 + 0.000380547138198174i, -0.006282062127872716 + -0.005046334758563181i, 0.11614306891408702 + -1.514494909690689e-18i, 0.0003744151233308674 + 0.0008922612680840765i, 0.0007147582027884054 + 0.00037444977033017606i, -0.0013466373224395789 + -0.000320852593960906i, 0.0015912692709215903 + -0.005250867417669341i }, { 0.0014524986018278022 + 0.003051842961103028i, 0.0003647408903067384 + 0.0013979853902225609i, -0.0013558004503716318 + -0.0003639141804389112i, 0.00037441512333086734 + -0.0008922612680840762i, 0.11048066440430833 + -5.692061405548898e-19i, 0.0010846932024863852 + -0.01637628157362832i, -0.007312042811654945 + -0.004927307433881759i, -0.011697456912139872 + -0.008117082323378927i }, { -0.0004893318490942548 + 5.228747233010222e-05i, 0.0027319969441979477 + 0.006500265509737865i, -0.0008591840334730761 + -0.0010261660985596485i, 0.0007147582027884052 + -0.0003744497703301762i, 0.0010846932024863852 + 0.016376281573628318i, 0.11628949182808851 + -5.319366908757006e-19i, 0.004999740793369785 + 0.021362452948846353i, 0.0008387470238088257 + 0.0007073144185055528i }, { -0.002156503309697061 + -0.003501617649382171i, -0.0007777855105585263 + -0.0004045976608628703i, 0.002201752734944512 + 0.006729002223603358i, -0.001346637322439579 + 0.00032085259396090547i, -0.007312042811654942 + 0.004927307433881759i, 0.004999740793369785 + -0.021362452948846353i, 0.16167736520889037 + 5.421010862427522e-19i, -0.006446571853910404 + 0.00567779013154735i }, { -0.0001498967175617915 + 0.00125767784877957i, -0.00065140868856653 + 0.0011798967039111576i, 0.0014008834843306107 + -0.00010196674246769203i, 0.0015912692709215907 + 0.005250867417669343i, -0.01169745691213987 + 0.008117082323378929i, 0.0008387470238088259 + -0.0007073144185055534i, -0.006446571853910404 + -0.005677790131547351i, 0.11734570387775346 + -6.971081155902892e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1071342745762043, 1.0e-7), DoubleNear(0.11617019937400186, 1.0e-7), DoubleNear(0.15475923181666507, 1.0e-7), DoubleNear(0.11614306891408702, 1.0e-7), DoubleNear(0.11048066440430833, 1.0e-7), DoubleNear(0.11628949182808851, 1.0e-7), DoubleNear(0.16167736520889037, 1.0e-7), DoubleNear(0.11734570387775346, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.1167250115276412 + 6.132518538121134e-19i, 0.001053661193908287 + -0.01635246419314193i, -0.009698055259938452 + -0.004165896813783448i, -0.01327745481576137 + -0.00888107407792453i, 0.00040882416130136665 + 0.001052989896719917i, 0.0010040414743255543 + -0.00011139248990799932i, 0.00028081041390732344 + -0.0012982484211496088i, 0.0003267513897963486 + 0.001082406926894062i }, { 0.0010536611939082864 + 0.01635246419314193i, 0.12536322533610067 + 4.506215279392878e-19i, 0.004290148133350453 + 0.022226516373589883i, -0.00019139549778739937 + -5.00763769407918e-05i, -0.00015990447983712158 + 0.0009652295630571195i, -0.0008307273219994738 + 6.706733464842505e-06i, 0.0007020077391336963 + -0.00048440273029358026i, -0.00032753889421734367 + 0.0003536569279436212i }, { -0.00969805525993845 + 0.004165896813783448i, 0.004290148133350453 + -0.022226516373589883i, 0.17012286246626096 + 2.6291902682773483e-18i, -0.006956076281086375 + 0.0059069153859009i, -0.0014721571450403835 + 0.0007564412907136477i, -3.504670252049892e-05 + 0.0012796031150558614i, -0.0008354899330195109 + 0.0005761018051341365i, -0.00023108427321354765 + 0.0007821735185466691i }, { -0.01327745481576137 + 0.00888107407792453i, -0.00019139549778739916 + 5.0076376940791215e-05i, -0.006956076281086373 + -0.0059069153859009i, 0.12564643739315096 + -1.801639078809897e-18i, 0.00109272473711977 + 0.00016381135786851415i, -7.135859267585359e-05 + -0.0005382426605022165i, 0.0011535881122879466 + -0.0006183639318467769i, -0.000524646346134243 + 0.0005133203329555964i }, { 0.00040882416130136746 + -0.0010529898967199167i, -0.00015990447983712136 + -0.0009652295630571199i, -0.001472157145040384 + -0.0007564412907136479i, 0.0010927247371197697 + -0.00016381135786851405i, 0.10088992745287143 + -5.658180087658726e-19i, 0.001201617219939545 + -0.013746783476992562i, -0.008439326753409929 + -0.0031042430794242072i, -0.011783618970378643 + -0.007820703135933086i }, { 0.0010040414743255543 + 0.00011139248990799927i, -0.0008307273219994738 + -6.706733464842572e-06i, -3.504670252049886e-05 + -0.0012796031150558614i, -7.13585926758537e-05 + 0.0005382426605022167i, 0.0012016172199395456 + 0.013746783476992566i, 0.10709646586598967 + 2.0667603913004928e-19i, 0.00393735766076528 + 0.018510492265562277i, 0.00020777808409515701 + 0.00037684365724817084i }, { 0.0002808104139073235 + 0.0012982484211496086i, 0.0007020077391336969 + 0.0004844027302935807i, -0.0008354899330195113 + -0.0005761018051341367i, 0.0011535881122879466 + 0.0006183639318467769i, -0.008439326753409929 + 0.0031042430794242072i, 0.003937357660765279 + -0.018510492265562277i, 0.14631373455929447 + -2.574980159653073e-18i, -0.0057725577006967465 + 0.004817209504209632i }, { 0.00032675138979634854 + -0.0010824069268940617i, -0.00032753889421734356 + -0.0003536569279436212i, -0.0002310842732135472 + -0.0007821735185466691i, -0.0005246463461342429 + -0.000513320332955596i, -0.011783618970378645 + 0.007820703135933084i, 0.00020777808409515634 + -0.00037684365724817057i, -0.0057725577006967465 + -0.004817209504209633i, 0.10784233539868951 + -4.0996394647108136e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1167250115276412, 1.0e-7), DoubleNear(0.12536322533610067, 1.0e-7), DoubleNear(0.17012286246626096, 1.0e-7), DoubleNear(0.12564643739315096, 1.0e-7), DoubleNear(0.10088992745287143, 1.0e-7), DoubleNear(0.10709646586598967, 1.0e-7), DoubleNear(0.14631373455929447, 1.0e-7), DoubleNear(0.10784233539868951, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.11553117973481475 + -1.633079522306291e-18i, 0.0011700703378069637 + -0.01604144728587673i, -0.009575926441968084 + -0.0038865739593877953i, -0.013315794928792412 + -0.008838389176044032i, -0.004286030300305811 + 0.008045937069934964i, 0.0011364567278296473 + 0.0006062256556700091i, 0.0006516581492422022 + -0.0006144228219450999i, 0.0011283605234352779 + -0.0005155098181347306i }, { 0.0011700703378069634 + 0.016041447285876732i, 0.12335411763640464 + 5.827586677109586e-19i, 0.004375718880766038 + 0.021603473777522933i, -1.2502017616808575e-05 + 0.00012715065170431475i, -0.0010870281254008098 + -0.0004824403176050084i, -0.004689430534082811 + 0.008654437703224074i, -0.001676634652829721 + -0.000605725871760798i, -3.440325731371625e-05 + 4.54987083623408e-06i }, { -0.009575926441968082 + 0.003886573959387795i, 0.004375718880766037 + -0.021603473777522936i, 0.16796061832394085 + -5.624298769768554e-19i, -0.0066869648753687325 + 0.005709813147356855i, 9.852084990563033e-05 + -0.0007929520758467241i, 0.0013919614452257635 + 0.001155032619186205i, -0.006357734241703458 + 0.01178377517334133i, -5.9193394427714774e-05 + -0.0005797721015547148i }, { -0.013315794928792412 + 0.00883838917604403i, -1.2502017616808955e-05 + -0.000127150651704315i, -0.0066869648753687325 + -0.005709813147356856i, 0.1239321739947803 + -1.8973538018496328e-19i, -0.00010744204327874112 + -0.001251208149957299i, 3.3901459578750354e-05 + 3.365974278469376e-05i, 0.0007256271027315353 + -0.00035644174802564125i, -0.004662045911230794 + 0.008639683979430744i }, { -0.00428603030030581 + -0.00804593706993496i, -0.0010870281254008098 + 0.00048244031760500853i, 9.852084990563002e-05 + 0.0007929520758467234i, -0.00010744204327874066 + 0.0012512081499572991i, 0.10208375924569787 + 1.6805133673525319e-18i, 0.0010852080760408683 + -0.014057800384257763i, -0.008561455571380296 + -0.0033835659338198607i, -0.0117452788573476 + -0.007863388037813585i }, { 0.0011364567278296473 + -0.000606225655670009i, -0.004689430534082814 + -0.008654437703224072i, 0.0013919614452257644 + -0.0011550326191862052i, 3.390145957875046e-05 + -3.3659742784693817e-05i, 0.0010852080760408687 + 0.014057800384257763i, 0.10910557356568573 + 7.453889935837843e-20i, 0.0038517869133496948 + 0.019133534861629223i, 2.888460392456623e-05 + 0.0001996166286030643i }, { 0.0006516581492422024 + 0.0006144228219451i, -0.0016766346528297206 + 0.0006057258717607969i, -0.00635773424170346 + -0.011783775173341334i, 0.0007256271027315348 + 0.0003564417480256416i, -0.008561455571380296 + 0.0033835659338198607i, 0.0038517869133496943 + -0.019133534861629223i, 0.1484759787016146 + 6.166399856011306e-19i, -0.006041669106414389 + 0.005014311742753677i }, { 0.0011283605234352775 + 0.0005155098181347292i, -3.440325731371641e-05 + -4.549870836234209e-06i, -5.9193394427715126e-05 + 0.0005797721015547153i, -0.004662045911230792 + -0.008639683979430744i, -0.011745278857347602 + 0.007863388037813585i, 2.8884603924566135e-05 + -0.00019961662860306438i, -0.006041669106414389 + -0.005014311742753677i, 0.10955659879706017 + -2.021867645096015e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11553117973481475, 1.0e-7), DoubleNear(0.12335411763640464, 1.0e-7), DoubleNear(0.16796061832394085, 1.0e-7), DoubleNear(0.1239321739947803, 1.0e-7), DoubleNear(0.10208375924569787, 1.0e-7), DoubleNear(0.10910557356568573, 1.0e-7), DoubleNear(0.1484759787016146, 1.0e-7), DoubleNear(0.10955659879706017, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.27257891105128407 + 8.436448154652831e-19i, -0.00530182524212642 + -0.009926580810496334i, 0.010852795901210154 + 0.0077389174478083335i, 7.88896621999379e-05 + -0.0005049427875616711i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005301825242126419 + 0.009926580810496336i, 0.23796476749814405 + 9.529120656610879e-19i, -0.0004894446106401553 + 0.00027204972403835863i, 0.009375382872917797 + 0.006865009253248707i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010852795901210154 + -0.007738917447808328i, -0.0004894446106401549 + -0.0002720497240383584i, 0.261472624954784 + -7.420008617947671e-19i, -0.00517153032580887 + -0.009448541969527624i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 7.88896621999379e-05 + 0.0005049427875616707i, 0.009375382872917797 + -0.006865009253248704i, -0.00517153032580887 + 0.009448541969527626i, 0.22798369649578681 + -2.507217523872729e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.27257891105128407, 1.0e-7), DoubleNear(0.23796476749814405, 1.0e-7), DoubleNear(0.261472624954784, 1.0e-7), DoubleNear(0.22798369649578681, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.13300243615011817 + 1.0299920638612292e-18i, -0.0026108646929804426 + -0.004402321844774491i, 0.005566828681299874 + 0.0033694951987003974i, 7.478185035111797e-06 + -0.00027916008225003337i, 0.0014708582865758956 + -0.0065625834121279935i, 0.0003902688164357115 + 0.00010831753924399933i, 0.0011810373639608049 + 0.00014805857615090526i, -9.435250480584516e-06 + -6.44482740295639e-05i }, { -0.002610864692980442 + 0.004402321844774492i, 0.11808421368894717 + 1.0028870095490916e-18i, -0.00022351513653683759 + 0.00012583784371986644i, 0.004895477480332243 + 0.0029673194195128827i, -0.00041503947831372345 + -0.0008500267714060955i, 0.0018395242170235297 + -0.0075162753848437465i, -4.8104623363978694e-05 + 2.8051185219282697e-05i, 0.0011880380455509842 + 3.584463829296973e-05i }, { 0.005566828681299874 + -0.003369495198700395i, -0.00022351513653683712 + -0.00012583784371986674i, 0.12889107024275115 + -9.012430558785756e-19i, -0.0025006122235308277 + -0.004274309493168499i, -0.0006921585213758302 + 0.0005711926558647058i, 5.096143466505623e-05 + 9.920225239179845e-06i, 0.0021833930501964196 + -0.00321826177257839i, 0.0005212828188006444 + -5.8638269106409184e-05i }, { 7.4781850351118785e-06 + 0.000279160082250033i, 0.004895477480332242 + -0.002967319419512885i, -0.0025006122235308277 + 0.0042743094931685i, 0.11422905459914172 + -1.328147661294743e-18i, -4.1648741075040904e-05 + -7.952149743300184e-05i, -0.0006625050979949979 + 0.0005297926708396401i, -0.0005668569538191172 + -0.0008688112127773713i, 0.0024837419980960093 + -0.0042348575425634576i }, { 0.0014708582865758958 + 0.006562583412127994i, -0.00041503947831372356 + 0.0008500267714060953i, -0.00069215852137583 + -0.000571192655864707i, -4.1648741075040796e-05 + 7.952149743300179e-05i, 0.13957647490116584 + -1.8634724839594607e-19i, -0.0026909605491459774 + -0.005524258965721845i, 0.005285967219910281 + 0.004369422249107936i, 7.14114771648261e-05 + -0.00022578270531163768i }, { 0.0003902688164357115 + -0.00010831753924399924i, 0.0018395242170235302 + 0.007516275384843748i, 5.096143466505619e-05 + -9.920225239179995e-06i, -0.0006625050979949978 + -0.0005297926708396412i, -0.002690960549145978 + 0.005524258965721843i, 0.11988055380919689 + -4.997494388800372e-20i, -0.00026592947410331773 + 0.00014621188031849222i, 0.004479905392585554 + 0.0038976898337358245i }, { 0.0011810373639608027 + -0.000148058576150905i, -4.8104623363978694e-05 + -2.805118521928279e-05i, 0.0021833930501964183 + 0.003218261772578392i, -0.0005668569538191174 + 0.0008688112127773712i, 0.005285967219910277 + -0.0043694222491079335i, -0.0002659294741033178 + -0.00014621188031849165i, 0.13258155471203287 + 1.5924219408380846e-19i, -0.002670918102278041 + -0.005174232476359126i }, { -9.435250480584321e-06 + 6.444827402956384e-05i, 0.0011880380455509831 + -3.584463829296967e-05i, 0.0005212828188006442 + 5.8638269106409414e-05i, 0.002483741998096008 + 0.004234857542563459i, 7.141147716482603e-05 + 0.0002257827053116378i, 0.004479905392585555 + -0.00389768983373582i, -0.002670918102278042 + 0.005174232476359125i, 0.11375464189664508 + -1.179069862577986e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.13300243615011817, 1.0e-7), DoubleNear(0.11808421368894717, 1.0e-7), DoubleNear(0.12889107024275115, 1.0e-7), DoubleNear(0.11422905459914172, 1.0e-7), DoubleNear(0.13957647490116584, 1.0e-7), DoubleNear(0.11988055380919689, 1.0e-7), DoubleNear(0.13258155471203287, 1.0e-7), DoubleNear(0.11375464189664508, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.14635523527445554 + 1.7143946852427039e-18i, -0.0029674811805535523 + -0.005334515524868738i, 0.0057238594432663815 + 0.003723880401952745i, 2.3519928089436618e-05 + -0.00025102960858414076i, -0.00030907593255077544 + 0.001000183301287689i, 0.0004377036336887259 + 0.0003389914227533605i, -6.503515701936796e-05 + -8.721945347667492e-05i, -4.637172774235955e-05 + 5.734932998233858e-05i }, { -0.0029674811805535523 + 0.0053345155248687385i, 0.1281709390117417 + 6.547564682275742e-19i, -0.00025661023866289934 + 0.00017665449317158768i, 0.004930257341477874 + 0.003254576742206694i, 0.0005091238214340469 + 0.00018132475531869362i, -0.0007835283215282163 + 0.00037117765402341907i, 5.241197336842221e-06 + 3.743979071780577e-05i, -5.90178041041207e-05 + -7.457424948459873e-05i }, { 0.0057238594432663815 + -0.0037238804019527447i, -0.0002566102386628988 + -0.00017665449317158763i, 0.14049263871944662 + 1.5280474368467578e-18i, -0.002934933906624535 + -0.005111033282372291i, 0.00015284057472849562 + -4.2918330732583286e-05i, 4.0532387774429155e-05 + 2.8305355316130187e-05i, -0.00011758983916736868 + 0.0006289084005663644i, 0.00033525356742328065 + 0.00033178960588530924i }, { 2.351992808943666e-05 + 0.0002510296085841406i, 0.004930257341477871 + -0.003254576742206692i, -0.0029349339066245352 + 0.005111033282372291i, 0.12283872371750992 + -2.0057740190981832e-18i, 6.523385179239368e-05 + -7.192309095483141e-06i, 0.00013215816303448018 + 1.1793758706596342e-05i, 0.0004845598110167781 + 0.00016554087589164908i, -0.0005718453466055006 + 0.0001488494123970197i }, { -0.0003090759325507751 + -0.0010001833012876888i, 0.0005091238214340471 + -0.00018132475531869365i, 0.00015284057472849557 + 4.2918330732583286e-05i, 6.523385179239373e-05 + 7.192309095483151e-06i, 0.12622367577682847 + -8.707498697774207e-19i, -0.002334344061572868 + -0.004592065285627597i, 0.005128936457943774 + 0.0040150370458555875i, 5.5369734110501275e-05 + -0.00025391317897753026i }, { 0.0004377036336887262 + -0.00033899142275336055i, -0.0007835283215282165 + -0.000371177654023419i, 4.053238777442913e-05 + -2.8305355316130194e-05i, 0.00013215816303448023 + -1.1793758706596207e-05i, -0.0023343440615728674 + 0.004592065285627597i, 0.10979382848640232 + 2.981555974335137e-19i, -0.00023283437197725592 + 9.539523086677092e-05i, 0.004445125531439924 + 0.003610432511042013i }, { -6.503515701936812e-05 + 8.721945347667477e-05i, 5.241197336842176e-06 + -3.7439790717805846e-05i, -0.00011758983916736865 + -0.0006289084005663647i, 0.0004845598110167782 + -0.0001655408758916494i, 0.00512893645794377 + -0.004015037045855584i, -0.00023283437197725614 + -9.539523086677079e-05i, 0.1209799862353374 + -2.270048298641525e-18i, -0.0022365964191843344 + -0.004337508687155333i }, { -4.637172774235954e-05 + -5.734932998233854e-05i, -5.9017804104120834e-05 + 7.457424948459856e-05i, 0.00033525356742328087 + -0.00033178960588530935i, -0.0005718453466055003 + -0.0001488494123970197i, 5.536973411050125e-05 + 0.0002539131789775302i, 0.004445125531439926 + -0.0036104325110420123i, -0.0022365964191843344 + 0.004337508687155333i, 0.10514497277827688 + -5.014435047745458e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.14635523527445554, 1.0e-7), DoubleNear(0.1281709390117417, 1.0e-7), DoubleNear(0.14049263871944662, 1.0e-7), DoubleNear(0.12283872371750992, 1.0e-7), DoubleNear(0.12622367577682847, 1.0e-7), DoubleNear(0.10979382848640232, 1.0e-7), DoubleNear(0.1209799862353374, 1.0e-7), DoubleNear(0.10514497277827688, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.14677006481979782 + -1.3315357930837601e-18i, -0.002879500791533948 + -0.005382968309239704i, 0.01359942521882138 + 0.00015081456225012546i, -0.0002559152023901524 + -0.0005150077671325841i, -0.007398723574586629 + 0.011111193121105912i, 0.0005354260501236273 + -6.801906399948471e-05i, -0.0011286594050051225 + 0.013869526982609268i, 0.0006326978176980115 + -0.0002791765328084241i }, { -0.002879500791533948 + 0.005382968309239705i, 0.12813863559087973 + 6.505213034913027e-19i, -0.00027818290355932055 + 0.0004675220645660662i, 0.01180384104867481 + 0.00022762602658578217i, -0.00032852614042868766 + -0.00048746720490056884i, -0.0066286393461601765 + 0.009681077533269012i, -0.0004609811823145572 + -0.0004297868072043687i, -0.0009196146013430719 + 0.011983873922546202i }, { 0.01359942521882138 + -0.00015081456225012272i, -0.00027818290355932044 + -0.00046752206456606604i, 0.13672173323895778 + -8.639736061993863e-19i, -0.002637393746027821 + -0.0049486658292801685i, -0.012680881832773227 + 0.009456876128384927i, 0.0005009259102449009 + 0.0002920585652303112i, -0.0032450409674226388 + 0.008718519122170382i, 0.0005418372832783052 + 9.447261811477907e-05i }, { -0.0002559152023901523 + 0.0005150077671325841i, 0.01180384104867481 + -0.00022762602658577956i, -0.0026373937460278207 + 0.00494866582928017i, 0.11914765604030521 + -2.574980159653073e-19i, -0.00015310339507811847 + -0.00057228291445582i, -0.011041037318055058 + 0.008267647415010071i, -3.2874882240586885e-05 + -0.00035141486073008083i, -0.002722837099153428 + 0.007613044149385803i }, { -0.007398723574586627 + -0.011111193121105912i, -0.0003285261404286881 + 0.0004874672049005688i, -0.012680881832773227 + -0.009456876128384927i, -0.00015310339507811841 + 0.0005722829144558198i, 0.12580884623148622 + 2.1751806085490433e-18i, -0.002422324450592472 + -0.004543612501256631i, -0.002746629317611225 + 0.007588102885558208i, 0.0003348048645900903 + 1.0064979570912988e-05i }, { 0.0005354260501236273 + 6.801906399948524e-05i, -0.006628639346160179 + -0.009681077533269012i, 0.0005009259102449012 + -0.00029205856523031117i, -0.011041037318055056 + -0.008267647415010071i, -0.0024223244505924713 + 0.004543612501256631i, 0.10982613190726431 + 3.023907621697852e-19i, -0.00021126170708083472 + -0.00019547234052770757i, -0.002428458175757013 + 0.006637383226662925i }, { -0.001128659405005122 + -0.01386952698260927i, -0.00046098118231455723 + 0.00042978680720436854i, -0.0032450409674226422 + -0.008718519122170384i, -3.2874882240586614e-05 + 0.00035141486073008137i, -0.002746629317611227 + -0.007588102885558206i, -0.0002112617070808345 + 0.00019547234052770762i, 0.12475089171582625 + 1.2197274440461925e-19i, -0.0025341365797810485 + -0.004499876140247456i }, { 0.0006326978176980117 + 0.00027917653280842397i, -0.0009196146013430721 + -0.011983873922546203i, 0.0005418372832783049 + -9.447261811477902e-05i, -0.002722837099153427 + -0.007613044149385805i, 0.0003348048645900902 + -1.0064979570913334e-05i, -0.002428458175757013 + -0.006637383226662925i, -0.002534136579781049 + 0.004499876140247455i, 0.10883604045548159 + -2.2497195079074217e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.14677006481979782, 1.0e-7), DoubleNear(0.12813863559087973, 1.0e-7), DoubleNear(0.13672173323895778, 1.0e-7), DoubleNear(0.11914765604030521, 1.0e-7), DoubleNear(0.12580884623148622, 1.0e-7), DoubleNear(0.10982613190726431, 1.0e-7), DoubleNear(0.12475089171582625, 1.0e-7), DoubleNear(0.10883604045548159, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.26189350639286935 + 1.2874900798265365e-19i, -0.00511147691651127 + -0.00867663133794299i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0036542513367723156 + -0.009780845184706384i, 0.000911551635236356 + 4.967927013759015e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005111476916511269 + 0.008676631337942994i, 0.2323132682880889 + -3.2526065174565133e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0009818964321328407 + -0.001718837984183467i, 0.0043232662151195395 + -0.011751132927407204i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0036542513367723147 + 0.009780845184706385i, -0.0009818964321328407 + 0.0017188379841834665i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2721580296131987 + -2.710505431213761e-20i, -0.005361878651424019 + -0.01069849144208097i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0009115516352363557 + -4.9679270137589825e-05i, 0.004323266215119539 + 0.011751132927407208i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005361878651424019 + 0.010698491442080967i, 0.23363519570584196 + -1.2290448064659898e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.26189350639286935, 1.0e-7), DoubleNear(0.2323132682880889, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2721580296131987, 1.0e-7), DoubleNear(0.23363519570584196, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.28684787399390216 + 3.2424421220894617e-18i, -0.005902415087178087 + -0.01044554880724103i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00042666577171814415 + 0.0016290917018540537i, 0.0007729572011120065 + 0.0006707810286386697i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005902415087178087 + 0.01044554880724103i, 0.2510096627292516 + -1.351017550870609e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.000993683632450825 + 0.0003468656312103428i, -0.0013553736681337167 + 0.0005200270664204389i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004266657717181438 + -0.0016290917018540534i, 0.0009936836324508252 + -0.0003468656312103431i, 0.0 + 0.0i, 0.0 + 0.0i, 0.24720366201216587 + -3.1407981684189457e-18i, -0.004570940480757202 + -0.00892957397278293i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0007729572011120072 + -0.0006707810286386698i, -0.0013553736681337167 + -0.0005200270664204388i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004570940480757201 + 0.00892957397278293i, 0.21493880126467918 + -2.0328790734103208e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.28684787399390216, 1.0e-7), DoubleNear(0.2510096627292516, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24720366201216587, 1.0e-7), DoubleNear(0.21493880126467918, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.2834917980587556 + -2.1955093992831465e-18i, -0.005516894537561769 + -0.010331634138519874i, 0.0 + 0.0i, 0.0 + 0.0i, -0.010643764542009269 + 0.019829712243276294i, 0.0010772633334019325 + 2.645355411529438e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005516894537561769 + 0.010331634138519875i, 0.24728629163118493 + 3.9302328752599536e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00036140102266927457 + -0.0008388820656306498i, -0.009351476445313605 + 0.017294121682654817i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010643764542009269 + -0.019829712243276294i, -0.0003614010226692747 + 0.0008388820656306502i, 0.0 + 0.0i, 0.0 + 0.0i, 0.25055973794731246 + 2.2971533529536625e-18i, -0.00495646103037352 + -0.009043488641504088i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010772633334019321 + -2.645355411529381e-05i, -0.009351476445313606 + -0.017294121682654817i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004956461030373519 + 0.009043488641504087i, 0.21866217236274588 + -1.9473287457376365e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2834917980587556, 1.0e-7), DoubleNear(0.24728629163118493, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25055973794731246, 1.0e-7), DoubleNear(0.21866217236274588, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.1407339574648194 + 4.2012834183813297e-19i, -0.002967609497723244 + -0.0047117124955083686i, 0.0016325877946965902 + -0.0054179517606582905i, 0.0004680555169136384 + 8.685674337190758e-06i, -0.0005833374384460124 + -0.0013577456927724232i, 0.00039570501902684606 + 0.0004883490859862779i, 0.0008090995687766499 + -3.611156471289883e-05i, -0.0009070565287559152 + -0.0001221631807984347i }, { -0.0029676094977232437 + 0.00471171249550837i, 0.12501104729230106 + -1.3552527156068805e-19i, -0.0006112825083467329 + -0.0009753208410794306i, 0.001925089947565611 + -0.006519496178027929i, 0.0007603447641705101 + 0.0007019555138784552i, -0.0005335899132984533 + -0.0010254500599513857i, 4.0906699838794965e-05 + -0.0005171909993587502i, 0.0003981120564075114 + 0.0009499650316795148i }, { 0.0016325877946965887 + 0.005417951760658292i, -0.0006112825083467326 + 0.0009753208410794299i, 0.14611391652908276 + 2.8223137802513287e-18i, -0.002934805589454843 + -0.005733836311732661i, -0.00040987085964106943 + 0.0010488878586372896i, 7.796513179131079e-05 + 0.0002529011630320473i, 0.00015667166672786822 + 0.0029868373946264765i, 0.00037725218208516044 + 0.00018243194265239184i }, { 0.00046805551691363835 + -8.685674337190636e-06i, 0.0019250899475656094 + 0.0065194961780279306i, -0.002934805589454844 + 0.00573383631173266i, 0.12599861543695062 + -1.215492279309921e-18i, 0.00033027019606761616 + -0.0013049098871038053i, 0.00045204975102612144 + 0.0004250838804565998i, 0.00023333886828031476 + -0.0003550898826681124i, -0.0008217837548352636 + 0.0015454771263718246i }, { -0.0005833374384460121 + 0.0013577456927724237i, 0.0007603447641705101 + -0.0007019555138784554i, -0.0004098708596410698 + -0.0010488878586372898i, 0.00033027019606761616 + 0.0013049098871038053i, 0.12115954892804995 + -2.913793338554793e-19i, -0.0021438674187880258 + -0.003964918842434622i, 0.002021663542075725 + -0.004362893424048092i, 0.00044349611832271744 + 4.099359580039939e-05i }, { 0.00039570501902684644 + -0.0004883490859862779i, -0.0005335899132984526 + 0.001025450059951386i, 7.79651317913109e-05 + -0.0002529011630320473i, 0.00045204975102612155 + -0.00042508388045660046i, -0.0021438674187880258 + 0.0039649188424346225i, 0.10730222099578784 + -1.8973538018496328e-19i, -0.00037061392378610783 + -0.0007435171431040362i, 0.002398176267553928 + -0.005231636749379275i }, { 0.0008090995687766498 + 3.6111564712898155e-05i, 4.0906699838794884e-05 + 0.00051719099935875i, 0.00015667166672786827 + -0.0029868373946264773i, 0.0002333388682803151 + 0.00035508988266811227i, 0.002021663542075726 + 0.004362893424048094i, -0.00037061392378610815 + 0.0007435171431040366i, 0.12604411308411595 + -2.8494188345634663e-18i, -0.002427073061969176 + -0.00496465513034831i }, { -0.0009070565287559155 + 0.00012216318079843468i, 0.0003981120564075109 + -0.0009499650316795146i, 0.00037725218208516066 + -0.00018243194265239198i, -0.000821783754835264 + -0.0015454771263718249i, 0.00044349611832271744 + -4.099359580039919e-05i, 0.0023981762675539292 + 0.005231636749379277i, -0.002427073061969176 + 0.004964655130348309i, 0.10763658026889136 + -1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1407339574648194, 1.0e-7), DoubleNear(0.12501104729230106, 1.0e-7), DoubleNear(0.14611391652908276, 1.0e-7), DoubleNear(0.12599861543695062, 1.0e-7), DoubleNear(0.12115954892804995, 1.0e-7), DoubleNear(0.10730222099578784, 1.0e-7), DoubleNear(0.12604411308411595, 1.0e-7), DoubleNear(0.10763658026889136, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.1390616816315885 + -3.4558944247975454e-19i, -0.0026108259572819367 + -0.004623625282608494i, 0.0020690767489104736 + -0.0048624662887278396i, 0.0004408562307043851 + 1.0244151103324154e-06i, -0.005640184307557944 + 0.009918309309851988i, 0.0005852850133603657 + -2.9944708850128426e-05i, -2.3332712195531864e-05 + 0.00039985098161351507i, -5.231713072792414e-05 + 8.01404547765796e-05i }, { -0.0026108259572819367 + 0.004623625282608496i, 0.12332841097736864 + 6.369687763352339e-19i, -0.0006209578241079424 + -0.0009020800825953901i, 0.002446665128864151 + -0.0059430796880337415i, -9.699719103125446e-05 + -0.0005183430862551847i, -0.00502500990988918 + 0.008855966078631608i, 9.565232271634735e-05 + 6.267255551010192e-05i, 8.420079290684884e-05 + 0.0004533175998275328i }, { 0.002069076748910474 + 0.004862466288727841i, -0.0006209578241079425 + 0.0009020800825953897i, 0.14443011642716708 + -1.849919956803392e-18i, -0.002906068580279832 + -0.00570800885591138i, -0.0002047793932909265 + 0.00033708565947355084i, -5.9539544712850414e-05 + -6.967891644113497e-05i, -0.005003580234451324 + 0.009911402933424308i, 0.0004919783200415668 + 5.639826296542281e-05i }, { 0.0004408562307043851 + -1.0244151103321443e-06i, 0.0024466651288641513 + 0.005943079688033743i, -0.0029060685802798324 + 0.005708008855911379i, 0.12395788065381631 + -2.439454888092385e-19i, -0.00011950422492840353 + 5.727710132385702e-05i, -0.0003655601078857479 + 0.0001669615752982993i, -0.0002644038316380201 + -0.00032053897937546504i, -0.004326466535424425 + 0.00843815560402321i }, { -0.005640184307557944 + -0.009918309309851988i, -9.699719103125492e-05 + 0.0005183430862551847i, -0.0002047793932909258 + -0.00033708565947354954i, -0.00011950422492840348 + -5.7277101323856925e-05i, 0.12283182476128085 + 4.743384504624082e-19i, -0.002500650959229333 + -0.004053006055334495i, 0.001585174587861842 + -0.004918378895978544i, 0.0004706954045319708 + 4.8654855027257735e-05i }, { 0.0005852850133603657 + 2.9944708850128914e-05i, -0.00502500990988918 + -0.008855966078631605i, -5.953954471285028e-05 + 6.967891644113506e-05i, -0.0003655601078857467 + -0.00016696157529829772i, -0.0025006509592293323 + 0.004053006055334498i, 0.10898485731072025 + -9.622294280808852e-19i, -0.0003609386080248983 + -0.0008167579015880768i, 0.0018766010862553881 + -0.005808053239373463i }, { -2.3332712195531648e-05 + -0.00039985098161351594i, 9.565232271634731e-05 + -6.267255551010204e-05i, -0.005003580234451325 + -0.009911402933424306i, -0.0002644038316380198 + 0.0003205389793754654i, 0.0015851745878618405 + 0.004918378895978544i, -0.0003609386080248983 + 0.0008167579015880768i, 0.12772791318603163 + 1.8228149024912543e-18i, -0.002455810071144187 + -0.004990482586169591i }, { -5.231713072792421e-05 + -8.014045477657954e-05i, 8.420079290684902e-05 + -0.00045331759982753384i, 0.0004919783200415665 + -5.639826296542271e-05i, -0.0043264665354244254 + -0.00843815560402321i, 0.00047069540453197067 + -4.865485502725768e-05i, 0.0018766010862553873 + 0.005808053239373464i, -0.002455810071144187 + 0.004990482586169589i, 0.10967731505202566 + -9.850993176567513e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1390616816315885, 1.0e-7), DoubleNear(0.12332841097736864, 1.0e-7), DoubleNear(0.14443011642716708, 1.0e-7), DoubleNear(0.12395788065381631, 1.0e-7), DoubleNear(0.12283182476128085, 1.0e-7), DoubleNear(0.10898485731072025, 1.0e-7), DoubleNear(0.12772791318603163, 1.0e-7), DoubleNear(0.10967731505202566, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.15380755762883158 + 7.148958074826295e-19i, -0.002898274900534491 + -0.005761503708470988i, -0.00047003669914701335 + 0.0008980860269683108i, 0.0004329885905265838 + 0.00044561306177177674i, -0.00435263955531065 + 0.010033953072637197i, 0.0006668864648540838 + -0.00016303437326564395i, -0.00036512743913114153 + 0.0005894021050106924i, 9.524041801691607e-05 + 6.133008384322614e-05i }, { -0.002898274900534491 + 0.005761503708470988i, 0.13409869214611114 + -2.303929616531697e-19i, 0.0002776879644111814 + 8.971398675645156e-05i, -0.0007862999637055266 + 0.00018862402086939083i, 4.919254298015049e-05 + -0.0003228777150865988i, -0.004160826330434354 + 0.00886825556896464i, -0.00021705442907080178 + 3.3159140286215464e-05i, -0.000255408262209104 + 0.00033286299813772553i }, { -0.0004700366991470135 + -0.000898086026968311i, 0.00027768796441118154 + -8.971398675645167e-05i, 0.129684240429924 + -2.910405206765776e-18i, -0.002618619637027278 + -0.004570130430048886i, -0.0003991195728699151 + -0.00023030288488401962i, -0.00018975314710505353 + 0.0002281390833397822i, -0.006291124986698619 + 0.009795759170639098i, 0.0004103768685478487 + 0.00018948792738093833i }, { 0.00043298859052658427 + -0.0004456130617717768i, -0.0007862999637055266 + -0.00018862402086939055i, -0.002618619637027278 + 0.004570130430048887i, 0.1131875994850738 + 6.2341624917916505e-19i, 4.554352732116691e-05 + 6.928443684689543e-05i, -0.0002542019363296325 + -0.00019232283882601668i, -0.00041059356564942504 + -0.000516004350544051i, -0.005190650114879251 + 0.008425866113690176i }, { -0.0043526395553106535 + -0.0100339530726372i, 4.91925429801504e-05 + 0.0003228777150865992i, -0.0003991195728699146 + 0.0002303028848840193i, 4.5543527321166964e-05 + -6.928443684689545e-05i, 0.13304031636507058 + 2.5275463146068322e-18i, -0.0030041401866435966 + -0.004684045098770042i, 4.3370927428869175e-05 + 0.0007310056748857427i, 0.0003399686105854228 + 0.000225167966866893i }, { 0.0006668864648540834 + 0.00016303437326564436i, -0.0041608263304343555 + -0.008868255568964638i, -0.00018975314710505342 + -0.00022813908333978218i, -0.00025420193632963244 + 0.00019232283882601698i, -0.003004140186643596 + 0.004684045098770042i, 0.1169109705831405 + -1.1206245892174393e-18i, 0.0007159956680396435 + 0.00025715164445389124i, -0.0005690737044281903 + 0.00033140304555104804i }, { -0.0003651274391311416 + -0.0005894021050106928i, -0.00021705442907080178 + -3.3159140286215396e-05i, -0.0062911249866986155 + -0.009795759170639096i, -0.0004105935656494251 + 0.000516004350544051i, 4.337092742886972e-05 + -0.0007310056748857424i, 0.0007159956680396437 + -0.0002571516444538914i, 0.11751942158224189 + -2.303929616531697e-19i, -0.0019523208437299238 + -0.004359443542734045i }, { 9.524041801691598e-05 + -6.133008384322629e-05i, -0.00025540826220910403 + -0.000332862998137725i, 0.00041037686854784877 + -0.00018948792738093817i, -0.00519065011487925 + -0.008425866113690178i, 0.0003399686105854229 + -0.00022516796686689305i, -0.0005690737044281901 + -0.00033140304555104815i, -0.0019523208437299234 + 0.0043594435427340445i, 0.1017512017796054 + -8.267041565201971e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.15380755762883158, 1.0e-7), DoubleNear(0.13409869214611114, 1.0e-7), DoubleNear(0.129684240429924, 1.0e-7), DoubleNear(0.1131875994850738, 1.0e-7), DoubleNear(0.13304031636507058, 1.0e-7), DoubleNear(0.1169109705831405, 1.0e-7), DoubleNear(0.11751942158224189, 1.0e-7), DoubleNear(0.1017512017796054, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.22975023409489337 + -8.944667923005412e-19i, -0.009211732974388164 + -0.003547108289607288i, 0.009114535446734802 + 0.00660581943372117i, -0.00021625792360970895 + -0.00032244432047602535i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009211732974388162 + 0.0035471082896072876i, 0.28079344445453475 + 2.691023673426912e-18i, -0.00045313998677463257 + -0.00010584876921580368i, 0.011113643327393152 + 0.00799810726733587i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.009114535446734802 + -0.00660581943372117i, -0.00045313998677463273 + 0.00010584876921580373i, 0.22032439608770965 + 1.599198204416119e-18i, -0.00890926645265246 + -0.0033962643232929887i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00021625792360970898 + 0.0003224443204760258i, 0.011113643327393147 + -0.007998107267335863i, -0.008909266452652458 + 0.0033962643232929883i, 0.2691319253628612 + -4.848416590083615e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.22975023409489337, 1.0e-7), DoubleNear(0.28079344445453475, 1.0e-7), DoubleNear(0.22032439608770965, 1.0e-7), DoubleNear(0.2691319253628612, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.1134405369093299 + 9.215718466126788e-19i, -0.005958260871703759 + -0.0013580241243744545i, 0.004727128152115875 + 0.0028672590467130853i, -0.00019970085788072105 + -0.00021038970521857864i, 0.0017618851538594839 + -0.006276971974741087i, -0.0015099400026365752 + 0.0012009982173221791i, 0.001097559766957392 + 4.8581485060898485e-05i, -5.039431951434046e-05 + -8.88262352521713e-05i }, { -0.0059582608717037595 + 0.0013580241243744543i, 0.13764611292973544 + 1.111307226797642e-18i, -0.00021934183835820435 + -6.505322084562026e-05i, 0.0057351780095162425 + 0.0034695555715001944i, -0.00018350623376503652 + 0.00035679337953880696i, 0.0015484973497399415 + -0.007801886822230652i, 2.136668296879622e-05 + 9.681506732596205e-05i, 0.0012715156425543968 + 0.00013532172938297648i }, { 0.004727128152115874 + -0.0028672590467130874i, -0.00021934183835820454 + 6.50532208456202e-05i, 0.10986393704087626 + 8.843023969334896e-19i, -0.005689442767490746 + -0.001365355473149616i, -0.0006098777459643759 + 0.0005222532775134552i, -9.776284009777823e-06 + 6.184664579444551e-05i, 0.0024226103921662677 + -0.0032751364960998024i, -0.0012979719956270155 + 0.0011207227281488342i }, { -0.0001997008578807212 + 0.00021038970521857923i, 0.005735178009516244 + -0.0034695555715001923i, -0.005689442767490745 + 0.0013653554731496156i, 0.13325618780101664 + -3.113693114106808e-18i, -0.00010093795946985506 + -4.230825859921144e-05i, -0.0007447858734064522 + 0.0005787320491908907i, -0.0004575360138181901 + 0.0003815705712302806i, 0.002244524656126162 + -0.004177982819042046i }, { 0.0017618851538594839 + 0.006276971974741089i, -0.00018350623376503646 + -0.00035679337953880685i, -0.0006098777459643758 + -0.0005222532775134562i, -0.00010093795946985494 + 4.2308258599211274e-05i, 0.11630969718556346 + -1.81603863891322e-18i, -0.0032534721026844056 + -0.0021890841652328335i, 0.004387407294618926 + 0.003738560387008084i, -1.655706572898791e-05 + -0.00011205461525744674i }, { -0.0015099400026365754 + -0.0012009982173221793i, 0.001548497349739942 + 0.007801886822230653i, -9.77628400977785e-06 + -6.184664579444544e-05i, -0.0007447858734064522 + -0.0005787320491908918i, -0.003253472102684404 + 0.0021890841652328335i, 0.14314733152479928 + 1.5797164466292701e-18i, -0.0002337981484164282 + -4.079554837018343e-05i, 0.005378465317876909 + 0.004528551695835676i }, { 0.0010975597669573907 + -4.858148506089828e-05i, 2.1366682968796126e-05 + -9.68150673259621e-05i, 0.002422610392166266 + 0.0032751364960998033i, -0.00045753601381819 + -0.0003815705712302806i, 0.004387407294618928 + -0.003738560387008083i, -0.00023379814841642822 + 4.07955483701835e-05i, 0.11046045904683338 + 7.148958074826295e-19i, -0.003219823685161713 + -0.002030908850143373i }, { -5.03943195143406e-05 + 8.88262352521713e-05i, 0.0012715156425543953 + -0.0001353217293829764i, -0.0012979719956270155 + -0.0011207227281488342i, 0.0022445246561261607 + 0.004177982819042048i, -1.6557065728987788e-05 + 0.00011205461525744656i, 0.005378465317876903 + -0.004528551695835671i, -0.003219823685161713 + 0.0020309088501433725i, 0.13587573756184457 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1134405369093299, 1.0e-7), DoubleNear(0.13764611292973544, 1.0e-7), DoubleNear(0.10986393704087626, 1.0e-7), DoubleNear(0.13325618780101664, 1.0e-7), DoubleNear(0.11630969718556346, 1.0e-7), DoubleNear(0.14314733152479928, 1.0e-7), DoubleNear(0.11046045904683338, 1.0e-7), DoubleNear(0.13587573756184457, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.12354558468947582 + -6.471331717022855e-19i, -0.005020827748872282 + -0.002155517204425062i, 0.004796432149749822 + 0.003159469640793462i, -0.00017107166857862407 + -0.000144778116785985i, -0.0002937678267623201 + 0.0006615881596903355i, 4.9383509168472424e-06 + -0.0004500250030672351i, -5.307457469270498e-05 + -6.652623605287407e-05i, 8.480790928425923e-06 + -1.4669987547236232e-05i }, { -0.005020827748872282 + 0.002155517204425061i, 0.15098058959672148 + 3.0162843251725635e-18i, -0.0002010690341625038 + -5.792264971064679e-05i, 0.005857684634994434 + 0.0038189875033659768i, -0.0007680089569735088 + 0.0001652608707513718i, -0.0007988364273166717 + 0.0007097727956207725i, -8.451293083713642e-05 + -1.0284143992851027e-05i, -7.097838643078369e-05 + -9.526746690839958e-05i }, { 0.004796432149749822 + -0.0031594696407934615i, -0.00020106903416250416 + 5.792264971064701e-05i, 0.11854265217426609 + 1.7110065534536867e-18i, -0.004868623008853568 + -0.0020604559862991787i, 0.0001332661879627561 + -1.4800953195255427e-05i, -1.619433531211263e-05 + -6.217148879634524e-05i, -0.00012813533393578693 + 0.0003981084704944239i, -5.166683122686733e-05 + -0.0004945664901387526i }, { -0.00017107166857862417 + 0.00014477811678598505i, 0.005857684634994431 + -0.0038189875033659746i, -0.004868623008853568 + 0.002060455986299178i, 0.14478871026269047 + -2.188733135705112e-18i, -4.476132084991608e-06 + 1.7219866880494155e-05i, 0.0001517325498002197 + -1.6323618830731558e-05i, -0.0007755067807427283 + 5.2937759460059346e-05i, -0.0005612998518370823 + 0.0003796493424689603i }, { -0.00029376782676231975 + -0.0006615881596903352i, -0.0007680089569735089 + -0.0001652608707513718i, 0.00013326618796275609 + 1.4800953195255576e-05i, -4.476132084991659e-06 + -1.721986688049413e-05i, 0.10620464940541754 + -2.473336205982557e-19i, -0.004190905225515882 + -0.0013915910851822263i, 0.00431810329698498 + 0.003446349792927708i, -4.5186255031084884e-05 + -0.00017766620369004038i }, { 4.9383509168475135e-06 + 0.00045002500306723516i, -0.0007988364273166717 + -0.0007097727956207724i, -1.6194335312112726e-05 + 6.217148879634525e-05i, 0.0001517325498002197 + 1.632361883073153e-05i, -0.004190905225515881 + 0.0013915910851822265i, 0.12981285485781324 + -3.2526065174565133e-19i, -0.00025207095261212874 + -4.7926119505156884e-05i, 0.005255958692398718 + 0.004179119763969894i }, { -5.307457469270517e-05 + 6.652623605287388e-05i, -8.451293083713641e-05 + 1.0284143992851078e-05i, -0.00012813533393578644 + -0.000398108470494424i, -0.0007755067807427285 + -5.29377594600594e-05i, 0.004318103296984981 + -0.0034463497929277083i, -0.0002520709526121286 + 4.792611950515669e-05i, 0.10178174391344355 + -1.1180834903756764e-19i, -0.004040643443798892 + -0.0013358083369938102i }, { 8.480790928425855e-06 + 1.4669987547236252e-05i, -7.097838643078377e-05 + 9.526746690839943e-05i, -5.166683122686752e-05 + 0.0004945664901387522i, -0.0005612998518370826 + -0.00037964934246896033i, -4.51862550310848e-05 + 0.00017766620369004074i, 0.005255958692398715 + -0.0041791197639698885i, -0.00404064344379889 + 0.00133580833699381i, 0.12434321510017073 + -2.659683454378503e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12354558468947582, 1.0e-7), DoubleNear(0.15098058959672148, 1.0e-7), DoubleNear(0.11854265217426609, 1.0e-7), DoubleNear(0.14478871026269047, 1.0e-7), DoubleNear(0.10620464940541754, 1.0e-7), DoubleNear(0.12981285485781324, 1.0e-7), DoubleNear(0.10178174391344355, 1.0e-7), DoubleNear(0.12434321510017073, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.12372199678273062 + -3.8285889215894375e-19i, -0.004975602671926898 + -0.0019709000723021003i, 0.01144111036947989 + 0.00019370770126312645i, -0.00043913738188354105 + -0.0001545216432756584i, -0.006371392485397636 + 0.009335466199770994i, 0.0005657375225121073 + -0.00024233516176429086i, -0.0008930999363632425 + 0.011598645650037064i, 0.00011119980048425247 + -0.0003676595005661853i }, { -0.004975602671926897 + 0.0019709000723021i, 0.15118670362794695 + -2.981555974335137e-19i, -0.0005083753555254433 + 0.0001462120289644073i, 0.0139621558980163 + 0.00018473288757278117i, 0.00025845266291873087 + -0.00043525619639326756i, -0.0076559704353491706 + 0.011456804454603932i, -0.00019204036832675087 + -0.0004536811558912955i, -0.001155174069984952 + 0.014254755255118405i }, { 0.01144111036947989 + -0.00019370770126312596i, -0.0005083753555254432 + -0.00014621202896440734i, 0.11516330058848878 + -6.674619624363887e-19i, -0.0046128257876579945 + -0.00178852323538138i, -0.010688851472638476 + 0.007983844975207832i, 0.0006297479951876284 + -0.0002359796711722559i, -0.0026040683489909856 + 0.007364908573388045i, 5.151736941637868e-05 + -0.000367537789344575i }, { -0.0004391373818835409 + 0.0001545216432756585i, 0.013962155898016299 + -0.00018473288757277635i, -0.004612825787657994 + 0.0017885232353813797i, 0.1407060886907742 + -4.54009659728305e-19i, 0.00032106720206983056 + -0.0004187607583858057i, -0.01303306767818981 + 0.009740678568187167i, -0.00012603035343435018 + -0.0003240361366687628i, -0.0033638097175850814 + 0.008966654698168142i }, { -0.006371392485397637 + -0.009335466199770989i, 0.00025845266291873087 + 0.00043525619639326707i, -0.010688851472638474 + -0.007983844975207835i, 0.00032106720206983067 + 0.00041876075838580566i, 0.10602823731216275 + -5.116079001415974e-19i, -0.0042361303024612655 + -0.0015762082173051875i, -0.002326574922745089 + 0.006412111732458044i, 0.0002228794582738321 + -0.00016792267720036697i }, { 0.0005657375225121071 + 0.0002423351617642911i, -0.007655970435349169 + -0.011456804454603932i, 0.0006297479951876282 + 0.00023597967117225635i, -0.013033067678189807 + -0.009740678568187165i, -0.0042361303024612655 + 0.0015762082173051877i, 0.1296067408265878 + 2.989179270860426e-18i, 5.523536875081078e-05 + -0.00025206079818021097i, -0.002848512570623149 + 0.007813374379763089i }, { -0.0008930999363632416 + -0.011598645650037065i, -0.00019204036832675135 + 0.00045368115589129536i, -0.0026040683489909873 + -0.007364908573388043i, -0.00012603035343435037 + 0.00032403613666876256i, -0.002326574922745088 + -0.006412111732458044i, 5.5235368750810495e-05 + 0.0002520607981802111i, 0.10516109549922086 + 2.2666601668525077e-18i, -0.004296440664994464 + -0.0016077410879116088i }, { 0.0001111998004842524 + 0.0003676595005661851i, -0.0011551740699849524 + -0.01425475525511841i, 5.151736941637881e-05 + 0.00036753778934457465i, -0.0033638097175850827 + -0.008966654698168146i, 0.0002228794582738319 + 0.00016792267720036724i, -0.002848512570623152 + -0.007813374379763087i, -0.004296440664994464 + 0.0016077410879116083i, 0.12842583667208698 + -4.39440693035531e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12372199678273062, 1.0e-7), DoubleNear(0.15118670362794695, 1.0e-7), DoubleNear(0.11516330058848878, 1.0e-7), DoubleNear(0.1407060886907742, 1.0e-7), DoubleNear(0.10602823731216275, 1.0e-7), DoubleNear(0.1296067408265878, 1.0e-7), DoubleNear(0.10516109549922086, 1.0e-7), DoubleNear(0.12842583667208698, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.22330447395020617 + 1.8058742435461683e-18i, -0.011647703639194505 + -0.0027233795975240708i, 0.0 + 0.0i, 0.0 + 0.0i, 0.004184495546025751 + -0.009552108470840889i, -0.0028079119982635905 + 0.0023217209454710133i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011647703639194505 + 0.00272337959752407i, 0.27090230073075205 + -2.002385887309166e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0006410422475832266 + 0.0007383639507690876i, 0.0037930220058661032 + -0.011979869641272699i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0041844955460257505 + 0.00955210847084089i, -0.0006410422475832265 + -0.0007383639507690875i, 0.0 + 0.0i, 0.0 + 0.0i, 0.22677015623239682 + -1.1011428314305904e-18i, -0.006473295787846119 + -0.0042199930153762055i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002807911998263591 + -0.0023217209454710133i, 0.003793022005866103 + 0.011979869641272702i, 0.0 + 0.0i, 0.0 + 0.0i, -0.006473295787846117 + 0.0042199930153762055i, 0.2790230690866438 + -1.5500702934753696e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.22330447395020617, 1.0e-7), DoubleNear(0.27090230073075205, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22677015623239682, 1.0e-7), DoubleNear(0.2790230690866438, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.2420882368637419 + 1.0638733817514012e-18i, -0.00988945075772585 + -0.00421597319072424i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00042190316069810706 + 0.0010596966301847594i, -4.672848031002006e-05 + -0.0009445914932059876i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009889450757725848 + 0.004215973190724239i, 0.2957692998594119 + 8.275511894674514e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0015435157377162371 + 0.00021819863021143118i, -0.0013601362791537538 + 0.0010894221380897328i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00042190316069810625 + -0.0010596966301847594i, -0.0015435157377162376 + -0.00021819863021143118i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2079863933188611 + -3.5914196963582334e-19i, -0.008231548669314772 + -0.0027273994221760365i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.672848031002017e-05 + 0.0009445914932059874i, -0.0013601362791537544 + -0.0010894221380897328i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008231548669314772 + 0.0027273994221760365i, 0.25415606995798395 + -2.9849441061241544e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2420882368637419, 1.0e-7), DoubleNear(0.2957692998594119, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2079863933188611, 1.0e-7), DoubleNear(0.25415606995798395, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.23888529737121939 + -1.0503208545953324e-18i, -0.009588428459584892 + -0.0037594233076834807i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008975460834388622 + 0.01670037477315904i, 0.000617254891928486 + -0.0006098729511088658i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00958842845958489 + 0.00375942330768348i, 0.2918927923187211 + -7.521652571618187e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00013242230948438066 + -0.0007592923330620303i, -0.011019780152934252 + 0.020423459152772074i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008975460834388624 + -0.016700374773159034i, 0.0001324223094843805 + 0.0007592923330620297i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2111893328113836 + 1.7550522667109103e-18i, -0.00853257096745573 + -0.003183949305216796i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.000617254891928486 + 0.0006098729511088657i, -0.01101978015293425 + -0.020423459152772078i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00853257096745573 + 0.003183949305216796i, 0.25803257749867475 + -1.4052276594948843e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.23888529737121939, 1.0e-7), DoubleNear(0.2918927923187211, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2111893328113836, 1.0e-7), DoubleNear(0.25803257749867475, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.12009096383350626 + 3.5914196963582334e-19i, -0.006234326708726867 + -0.0017011235515508871i, 0.0019160990949589633 + -0.005299889611338588i, -0.0014948557527443584 + 0.0012417121892419666i, -0.0002718083325553236 + -0.0008736814049438899i, -0.001200010283649424 + -0.00012707824625783027i, 0.000505879680768586 + 0.0005226348869572726i, 0.0008852030341974208 + -0.001829875936568619i }, { -0.006234326708726866 + 0.0017011235515508867i, 0.1456540409236142 + -7.453889935837843e-20i, -0.00023146343705631196 + 0.0004120647581148545i, 0.0016415786473032382 + -0.006637558327347632i, -0.0008090001414587543 + -0.001205358083604123i, -0.0008451190191891419 + -0.001509514347779919i, 0.0020169086243245044 + -0.00016705491389506545i, 0.0007013319444155754 + 0.0003912185800093433i }, { 0.0019160990949589614 + 0.0052998896113385895i, -0.0002314634370563119 + -0.0004120647581148542i, 0.12199727303023564 + 7.047314121155779e-19i, -0.003655124048998983 + -0.0025148496391733527i, 0.00024221825352280975 + 0.0006123248227621815i, 0.00035187572546912507 + 0.0013501229430926483i, -0.00015009482814278344 + 0.0019333780351286495i, 0.001153281803339404 + -0.0008175132469481574i }, { -0.0014948557527443586 + -0.0012417121892419674i, 0.0016415786473032367 + 0.006637558327347633i, -0.0036551240489989824 + 0.0025148496391733523i, 0.15011525893579772 + 9.020900888258299e-19i, -0.001165252424074389 + 0.001234830550758411i, -0.00020003936213775777 + 0.0008616469163317078i, -0.0007345155962574828 + 0.0014235567138155543i, -0.0005150172599646119 + 0.002598936485869652i }, { -0.000271808332555323 + 0.0008736814049438903i, -0.0008090001414587549 + 0.0012053580836041229i, 0.00024221825352280943 + -0.0006123248227621821i, -0.0011652524240743888 + -0.0012348305507584112i, 0.10321351011669991 + 1.446732273910345e-18i, -0.005413376930467637 + -0.0010222560459731834i, 0.002268396451066788 + -0.004252218859502301i, -0.0013130562455192323 + 0.0010800087562290465i }, { -0.0012000102836494243 + 0.00012707824625783002i, -0.0008451190191891418 + 0.0015095143477799194i, 0.0003518757254691251 + -0.001350122943092649i, -0.00020003936213775774 + -0.0008616469163317082i, -0.005413376930467638 + 0.001022256045973183i, 0.12524825980713788 + -1.9278469879507876e-18i, -0.0004095788105269147 + 0.0003262991926542331i, 0.002151443358562865 + -0.005342311313925065i }, { 0.0005058796807685858 + -0.0005226348869572729i, 0.002016908624324505 + 0.00016705491389506567i, -0.00015009482814278322 + -0.0019333780351286495i, -0.0007345155962574828 + -0.001423556713815554i, 0.0022683964510667887 + 0.004252218859502303i, -0.00040957881052691453 + -0.0003262991926542332i, 0.1047728832021612 + -1.8058742435461683e-18i, -0.0028181717388471358 + -0.001705143376202853i }, { 0.0008852030341974208 + 0.0018298759365686192i, 0.0007013319444155748 + -0.00039121858000934343i, 0.001153281803339404 + 0.0008175132469481573i, -0.0005150172599646124 + -0.0025989364858696523i, -0.0013130562455192323 + -0.0010800087562290463i, 0.0021514433585628663 + 0.005342311313925067i, -0.0028181717388471345 + 0.0017051433762028537i, 0.1289078101508461 + -1.0570971181733668e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.12009096383350626, 1.0e-7), DoubleNear(0.1456540409236142, 1.0e-7), DoubleNear(0.12199727303023564, 1.0e-7), DoubleNear(0.15011525893579772, 1.0e-7), DoubleNear(0.10321351011669991, 1.0e-7), DoubleNear(0.12524825980713788, 1.0e-7), DoubleNear(0.1047728832021612, 1.0e-7), DoubleNear(0.1289078101508461, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.11860143255922379 + 7.995991022080595e-19i, -0.006186093816092299 + -0.001514468390024623i, 0.0023406797562525606 + -0.004795311992214606i, -0.0014634070115945796 + 0.00122639647075584i, -0.0047668372352589 + 0.008485635936702918i, 0.0003736271516332515 + -0.0003497467431807579i, 1.6694767804852127e-05 + 0.00043907794795540044i, -3.358062197935135e-05 + -0.00015319166601872772i }, { -0.006186093816092299 + 0.0015144683900246223i, 0.14378866004973334 + -5.082197683525802e-19i, -0.000345226007955584 + 0.0004267885654398463i, 0.002175062121522064 + -0.006010233984546975i, 4.029567616967417e-05 + -0.00048636223847934126i, -0.005898356982188225 + 0.010288639451780676i, -3.91045001863448e-05 + -9.487127389424998e-05i, 4.417331290646495e-05 + 0.00041409063348564744i }, { 0.0023406797562525606 + 0.004795311992214608i, -0.000345226007955584 + -0.00042678856543984625i, 0.1202838648119956 + -1.849919956803392e-18i, -0.0034023346434925933 + -0.0022449549176588573i, -0.0002579611038486449 + 0.00024371668087304658i, 2.0454235422260534e-05 + 5.6468819001437336e-05i, -0.004208623599129722 + 0.008214738836456119i, 0.00024362774029523451 + -0.00026012620792810795i }, { -0.0014634070115945796 + -0.00122639647075584i, 0.0021750621215220643 + 0.006010233984546976i, -0.0034023346434925925 + 0.0022449549176588573i, 0.14810413226898778 + -2.439454888092385e-19i, 0.0001129095706234193 + -7.462833533973626e-05i, -0.0003123783973280294 + 0.0002603305538988036i, 9.21266333147065e-05 + -0.00027293009458268907i, -0.005121423170746027 + 0.010134819700991398i }, { -0.0047668372352589 + -0.008485635936702915i, 4.0295676169674186e-05 + 0.00048636223847934093i, -0.0002579611038486438 + -0.0002437166808730453i, 0.0001129095706234193 + 7.46283353397359e-05i, 0.10470304139098238 + 1.0062751413381088e-18i, -0.005461609823102205 + -0.0012089112074994475i, 0.0018438157897731906 + -0.004756796478626283i, -0.001344504986669011 + 0.0010953244747151734i }, { 0.0003736271516332514 + 0.000349746743180758i, -0.0058983569821882235 + -0.010288639451780678i, 2.045423542226033e-05 + -5.6468819001437634e-05i, -0.0003123783973280287 + -0.00026033055389880207i, -0.005461609823102205 + 0.0012089112074994473i, 0.12711364068101874 + -1.4941661189565858e-18i, -0.0002958162396276426 + 0.0003115753853292413i, 0.0016179598843440394 + -0.005969635656725723i }, { 1.669476780485256e-05 + -0.0004390779479554016i, -3.910450018634492e-05 + 9.487127389424957e-05i, -0.004208623599129723 + -0.008214738836456115i, 9.212663331470629e-05 + 0.0002729300945826887i, 0.0018438157897731895 + 0.004756796478626283i, -0.00029581623962764245 + -0.0003115753853292412i, 0.10648629142040124 + 7.487771253728015e-19i, -0.0030709611443535253 + -0.0019750380977173482i }, { -3.358062197935112e-05 + 0.00015319166601872767i, 4.417331290646495e-05 + -0.0004140906334856482i, 0.00024362774029523457 + 0.0002601262079281078i, -0.005121423170746028 + -0.0101348197009914i, -0.0013445049866690113 + -0.0010953244747151734i, 0.0016179598843440383 + 0.005969635656725725i, -0.0030709611443535244 + 0.0019750380977173487i, 0.13091893681765604 + 8.893845946170154e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.11860143255922379, 1.0e-7), DoubleNear(0.14378866004973334, 1.0e-7), DoubleNear(0.1202838648119956, 1.0e-7), DoubleNear(0.14810413226898778, 1.0e-7), DoubleNear(0.10470304139098238, 1.0e-7), DoubleNear(0.12711364068101874, 1.0e-7), DoubleNear(0.10648629142040124, 1.0e-7), DoubleNear(0.13091893681765604, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.12965353958759934 + 2.337810934421869e-19i, -0.005205935098471373 + -0.002391862420406051i, -0.00032871304250854986 + 0.0004864153734106291i, -3.711749446465187e-05 + -0.0007383997296933752i, -0.0037587449926599578 + 0.008461210304317558i, 0.0002790738984265142 + -0.00046321216004116815i, -0.0002906839272068562 + 0.00036604751372563456i, -8.512254481624243e-05 + -0.00014112327922594344i }, { -0.005205935098471373 + 0.00239186242040605i, 0.15825271018734338 + 2.507217523872729e-19i, -0.00063365758428584 + -0.00014517602952242585i, -0.00092762362034399 + 0.0006002946744270725i, 9.125992481417747e-05 + -0.0002467846078986314i, -0.004754720893085046 + 0.01044099833728428i, 3.951749997836182e-05 + -0.00031081902887391524i, -0.00032985177413338927 + 0.0005562175894227833i }, { -0.0003287130425085496 + -0.000486415373410629i, -0.0006336575842858403 + 0.00014517602952242574i, 0.10923175778362004 + -1.2841019480375193e-18i, -0.00438249336111352 + -0.0013675608872774296i, -0.0002590075881436342 + -0.00011742797163207265i, 0.0002796360519477482 + 6.795914582720896e-05i, -0.0052167158417286644 + 0.008239164468841481i, 0.0003381809935019718 + -0.00014666079106769768i }, { -3.711749446465198e-05 + 0.000738399729693375i, -0.0009276236203439906 + -0.0006002946744270725i, -0.004382493361113519 + 0.0013675608872774296i, 0.13364008213137774 + -1.0028870095490916e-18i, 2.010699010912902e-05 + 0.0001240902856866531i, -0.0003943139210559134 + -0.0003051977520779636i, 4.116238467020319e-05 + -0.0005125077251633989i, -0.006265059259849206 + 0.009982460815487794i }, { -0.0037587449926599595 + -0.008461210304317554i, 9.125992481417747e-05 + 0.0002467846078986308i, -0.0002590075881436333 + 0.00011742797163207279i, 2.01069901091293e-05 + -0.00012409028568665309i, 0.11243469727614255 + 8.300922883092143e-19i, -0.0046835156592544775 + -0.001824110770318189i, -9.319011818955722e-05 + 0.0005732812567741303i, -9.610985845368188e-06 + -0.00020619176351261242i }, { 0.0002790738984265143 + 0.0004632121600411681i, -0.004754720893085049 + -0.010440998337284284i, 0.0002796360519477482 + -6.79591458272089e-05i, -0.0003943139210559137 + 0.0003051977520779635i, -0.004683515659254477 + 0.0018241107703181889i, 0.13751658967206853 + 5.768294370801785e-19i, -0.000909858153430397 + 0.00036337465973385703i, -0.00043251265880976387 + 0.0004891274636626604i }, { -0.00029068392720685667 + -0.0003660475137256348i, 3.9517499978361977e-05 + 0.0003108190288739152i, -0.0052167158417286644 + -0.008239164468841478i, 4.1162384670203016e-05 + 0.0005125077251633989i, -9.319011818955666e-05 + -0.0005732812567741303i, -0.0009098581534303972 + -0.0003633746597338569i, 0.09875463553524105 + 9.24959978401696e-19i, -0.0038490553082012532 + -0.001359838534898607i }, { -8.512254481624246e-05 + 0.0001411232792259434i, -0.00032985177413338894 + -0.000556217589422783i, 0.0003381809935019717 + 0.00014666079106769763i, -0.006265059259849201 + -0.009982460815487794i, -9.610985845368188e-06 + 0.0002061917635126124i, -0.0004325126588097637 + -0.0004891274636626604i, -0.0038490553082012532 + 0.0013598385348986071i, 0.12051598782660622 + -1.9820570965750628e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.12965353958759934, 1.0e-7), DoubleNear(0.15825271018734338, 1.0e-7), DoubleNear(0.10923175778362004, 1.0e-7), DoubleNear(0.13364008213137774, 1.0e-7), DoubleNear(0.11243469727614255, 1.0e-7), DoubleNear(0.13751658967206853, 1.0e-7), DoubleNear(0.09875463553524105, 1.0e-7), DoubleNear(0.12051598782660622, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.25108664983906537 + 2.032879073410321e-18i, 0.010462306161632118 + 0.00633681461821328i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0033103825035994254 + -0.014078858796971738i, 0.002369075409511789 + 0.00018390321444387495i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.010462306161632117 + -0.00633681461821328i, 0.24312012484189288 + -2.2293907171733185e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0013546636193708282 + 0.001100985326704346i, 0.004667135048292429 + -0.007453119315141848i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0033103825035994262 + 0.014078858796971742i, -0.001354663619370828 + -0.001100985326704348i, 0.0 + 0.0i, 0.0 + 0.0i, 0.25945702871036275 + -2.363221922839498e-19i, 0.009765872612495834 + 0.00826711208284376i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002369075409511786 + -0.00018390321444387468i, 0.004667135048292427 + 0.007453119315141851i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00976587261249583 + -0.008267112082843754i, 0.24633619660867792 + -1.0198276684941776e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.25108664983906537, 1.0e-7), DoubleNear(0.24312012484189288, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25945702871036275, 1.0e-7), DoubleNear(0.24633619660867792, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.2745261742861973 + 2.369151153470278e-18i, 0.010654116784744254 + 0.006978457144159438i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0010926042540789918 + 0.001371360955311108i, -0.00012405296112348867 + -0.00016179370296127366i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01065411678474425 + -0.006978457144159437i, 0.26333136243695654 + -4.777265822514254e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0002849987377629758 + -3.112457202598696e-05i, -0.0006894351857728693 + 0.0007777578129633842i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0010926042540789914 + -0.0013713609553111074i, 0.0002849987377629758 + 3.112457202598712e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23601750426323082 + -5.72594272343907e-19i, 0.009574061989383698 + 0.007625469556897602i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00012405296112348894 + 0.0001617937029612733i, -0.000689435185772869 + -0.0007777578129633841i, 0.0 + 0.0i, 0.0 + 0.0i, 0.009574061989383697 + -0.007625469556897597i, 0.22612495901361426 + -2.7714918034160707e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2745261742861973, 1.0e-7), DoubleNear(0.26333136243695654, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23601750426323082, 1.0e-7), DoubleNear(0.22612495901361426, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.27490870041067755 + -6.810144895924575e-19i, 0.025403266267496193 + 0.0003784405888359076i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014027362920746807 + 0.020792270654374924i, -0.0020482740063481946 + 0.025853400905155467i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.025403266267496186 + -0.00037844058883590236i, 0.25586938927926295 + -1.1214716221646936e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.023721919150828285 + 0.017724523543394998i, -0.005967878066576067 + 0.016331563271556188i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014027362920746807 + -0.020792270654374924i, -0.02372191915082828 + -0.017724523543395i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23563497813875056 + 2.4775713707188285e-18i, -0.005175087493368239 + 0.014225486112221132i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002048274006348194 + -0.025853400905155473i, -0.0059678780665760696 + -0.016331563271556188i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00517508749336824 + -0.01422548611222113i, 0.23358693217130785 + -2.1277467635028025e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.27490870041067755, 1.0e-7), DoubleNear(0.25586938927926295, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23563497813875056, 1.0e-7), DoubleNear(0.23358693217130785, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.13498249861910824 + 1.4094628242311558e-18i, 0.005491361934628578 + 0.0029751497882549967i, 0.0014145780791809655 + -0.007789694444555564i, 0.0012374751946234966 + 0.0001534084183192776i, -0.0006479097573650077 + -0.0012148201267916626i, -6.677434405573442e-05 + -0.00010347407357969231i, 0.0005426402833254462 + 0.0006377650333582783i, 6.206226742098158e-06 + -8.082189793534337e-05i }, { 0.005491361934628576 + -0.0029751497882549976i, 0.1307625061380122 + -1.1248597539537109e-18i, -0.0006891285270139411 + 0.0005499847701182963i, 0.002143099663081236 + -0.004147753494130656i, 6.331063559758947e-05 + 0.00016612342684819157i, -0.00046901759437945783 + -0.0011683756259321463i, 3.583714318145625e-05 + -5.901057610605459e-05i, 0.0006645713418587152 + 0.0002760884336083378i }, { 0.0014145780791809648 + 0.007789694444555565i, -0.0006891285270139419 + -0.0005499847701182987i, 0.13954367566708903 + 9.596883292391223e-19i, 0.005162754850115678 + 0.0040033073559044416i, 0.00016077591691299523 + 0.0007934038544805417i, 2.654581972164431e-05 + 0.00015407333085150736i, -0.000444694496713984 + 0.0025861810821027707i, -5.7278617067754224e-05 + -5.831962938158135e-05i }, { 0.0012374751946234949 + -0.00015340841831927677i, 0.002143099663081233 + 0.004147753494130657i, 0.005162754850115676 + -0.00400330735590444i, 0.13256885629894435 + 6.471331717022855e-19i, 4.069650634624043e-05 + -0.00020444811163262923i, -0.00011859702552794325 + 0.0006805678846133477i, 0.00022168810216538634 + -0.00019724799887417852i, -0.0002204175913934114 + 0.0019461334388955304i }, { -0.0006479097573650073 + 0.0012148201267916632i, 6.331063559758952e-05 + -0.00016612342684819154i, 0.0001607759169129954 + -0.0007934038544805421i, 4.0696506346240054e-05 + 0.0002044481116326294i, 0.1161041512199571 + 6.2341624917916505e-19i, 0.004970944227003541 + 0.0033616648299582834i, 0.00189580442441846 + -0.006289164352416175i, 0.0011316002148882922 + 3.0494796124597334e-05i }, { -6.677434405573439e-05 + 0.00010347407357969219i, -0.0004690175943794575 + 0.0011683756259321468i, 2.6545819721644124e-05 + -0.00015407333085150734i, -0.00011859702552794371 + -0.0006805678846133483i, 0.0049709442270035415 + -0.003361664829958282i, 0.1123576187038807 + -1.1045309632196076e-18i, -0.000665535092356887 + 0.0005510005565860497i, 0.002524035385211193 + -0.003305365821011192i }, { 0.0005426402833254453 + -0.0006377650333582786i, 3.58371431814564e-05 + 5.901057610605515e-05i, -0.0004446944967139842 + -0.0025861810821027707i, 0.00022168810216538628 + 0.00019724799887417863i, 0.0018958044244184612 + 0.006289164352416177i, -0.0006655350923568859 + -0.0005510005565860496i, 0.11991335304327373 + -1.196010521523072e-18i, 0.004603117762380157 + 0.004263804726939318i }, { 6.206226742098641e-06 + 8.082189793534301e-05i, 0.0006645713418587154 + -0.00027608843360833773i, -5.727861706775452e-05 + 5.831962938158112e-05i, -0.00022041759139341155 + -0.0019461334388955309i, 0.0011316002148882912 + -3.0494796124597897e-05i, 0.0025240353852111937 + 0.0033053658210111937i, 0.004603117762380155 + -0.004263804726939315i, 0.11376734030973358 + -1.666960840196463e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.13498249861910824, 1.0e-7), DoubleNear(0.1307625061380122, 1.0e-7), DoubleNear(0.13954367566708903, 1.0e-7), DoubleNear(0.13256885629894435, 1.0e-7), DoubleNear(0.1161041512199571, 1.0e-7), DoubleNear(0.1123576187038807, 1.0e-7), DoubleNear(0.11991335304327373, 1.0e-7), DoubleNear(0.11376734030973358, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.13531496309100643 + 2.439454888092385e-19i, 0.013214573425036935 + -0.00037996001239240496i, 0.0021095997444932598 + -0.007075797083998714i, 0.0012684174265445932 + 1.191126987460565e-05i, -0.007468029326158757 + 0.010361619913850756i, -0.0008527625557436091 + 0.01355710933537773i, 0.0003705048932424863 + 0.0008816498484537303i, -0.0005438084775255003 + 0.0005119396201232283i }, { 0.013214573425036933 + 0.00037996001239240604i, 0.12707512951795072 + 4.743384504624082e-20i, -9.601011805757448e-05 + 0.0009305203571647136i, 0.002406142133281365 + -0.003729748892762867i, -0.012363954921478567 + 0.00908383140408553i, -0.0031971648912883675 + 0.008412655474632838i, -0.0009309837158221639 + 0.0007268488009072661i, -0.00030963681253116926 + -2.8481267012682432e-05i }, { 0.002109599744493261 + 0.007075797083998716i, -9.601011805757503e-05 + -0.0009305203571647148i, 0.13959373731967115 + -9.24959978401696e-19i, 0.012188692842459256 + 0.0007584006012283126i, -0.0005917862947706727 + 0.0001016769471259629i, 0.00028674251015423037 + 0.0013803253563517076i, -0.0065593335945880495 + 0.01043065074052417i, -0.0011955114506045856 + 0.012296291569777736i }, { 0.001268417426544592 + -1.1911269874604579e-05i, 0.002406142133281364 + 0.0037297488927628677i, 0.012188692842459254 + -0.0007584006012283085i, 0.12879425976131226 + -1.1689054672109345e-18i, -8.009396685334147e-05 + -0.0001721678675625073i, 2.1446793593998294e-05 + 0.00040237028764588724i, -0.011357964229349718 + 0.008640692139309469i, -0.0027707131752876995 + 0.00791890779692335i }, { -0.007468029326158757 + -0.010361619913850754i, -0.012363954921478567 + -0.00908383140408553i, -0.0005917862947706712 + -0.00010167694712596043i, -8.00939668533412e-05 + 0.00017216786756250882i, 0.11577168674805893 + 1.7889335846010823e-18i, -0.0027522672634048163 + 0.006716774630605685i, 0.0012007827591061656 + -0.007003061712973025i, 0.0011006579829671956 + 0.0001719919445692693i }, { -0.0008527625557436082 + -0.013557109335377732i, -0.0031971648912883666 + -0.00841265547463284i, 0.00028674251015422885 + -0.0013803253563517079i, 2.144679359399862e-05 + -0.0004023702876458869i, -0.002752267263404816 + -0.006716774630605686i, 0.11604499532394218 + -2.2768245622195593e-18i, -0.0012586535013132537 + 0.00017046496953963233i, 0.002260992915011064 + -0.0037233704223789813i }, { 0.00037050489324248585 + -0.0008816498484537327i, -0.0009309837158221631 + -0.0007268488009072635i, -0.006559333594588048 + -0.010430650740524166i, -0.011357964229349714 + -0.008640692139309469i, 0.0012007827591061651 + 0.007003061712973026i, -0.0012586535013132528 + -0.00017046496953963342i, 0.11986329139069161 + 6.886377861177462e-19i, -0.0024228202299634224 + 0.0075087114816154476i }, { -0.0005438084775254998 + -0.000511939620123228i, -0.0003096368125311684 + 2.8481267012682866e-05i, -0.0011955114506045858 + -0.012296291569777741i, -0.002770713175287703 + -0.00791890779692335i, 0.001100657982967194 + -0.0001719919445692701i, 0.002260992915011063 + 0.003723370422378983i, -0.0024228202299634237 + -0.007508711481615446i, 0.11754193684736566 + 1.4907779871675686e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.13531496309100643, 1.0e-7), DoubleNear(0.12707512951795072, 1.0e-7), DoubleNear(0.13959373731967115, 1.0e-7), DoubleNear(0.12879425976131226, 1.0e-7), DoubleNear(0.11577168674805893, 1.0e-7), DoubleNear(0.11604499532394218, 1.0e-7), DoubleNear(0.11986329139069161, 1.0e-7), DoubleNear(0.11754193684736566, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.1484960644762342 + 3.5236570605778894e-19i, 0.014023606030371439 + -0.00021790056040636176i, -0.00040146558226867646 + 0.00019176606468122078i, 0.0002527783488592718 + -1.5493230351183795e-05i, -0.006425440319290241 + 0.010429807921688242i, -0.0002827519152056386 + 0.013847318664194638i, 0.000582642555323158 + -7.986377874027051e-05i, 0.0001515185965884633 + 0.0005570792869140452i }, { 0.014023606030371437 + 0.00021790056040636464i, 0.13941018529870852 + 1.3213713977167085e-19i, -1.9868464392566238e-05 + -0.0002513729522265539i, -0.0008548710805838635 + 0.0008949439831564807i, -0.012835794645386473 + 0.009025907859356556i, -0.002088025566454762 + 0.008472400719913594i, -8.269776995402993e-05 + -0.0005544622365902532i, -0.0012031782566634035 + 0.0010021288818886885i }, { -0.00040146558226867625 + -0.00019176606468122121i, -1.986846439256594e-05 + 0.000251372952226554i, 0.12641263593444335 + -1.0333801956502464e-18i, 0.011379660237124752 + 0.0005963411492422694i, -0.0007313661311166812 + 0.00038514008676619196i, -0.00045495190947271176 + -0.0005069530270543852i, -0.007601922601456566 + 0.010362462732686682i, -0.001765522091142556 + 0.012006082240960829i }, { 0.00025277834885927176 + 1.549323035118385e-05i, -0.0008548710805838639 + -0.0008949439831564801i, 0.01137966023712475 + -0.000596341149242267i, 0.11645920398055445 + -1.2536087619363645e-18i, 0.0004728468784283963 + 0.0002734800883890533i, 7.804462191713358e-05 + -0.0008077658104762282i, -0.010886124505441812 + 0.008698615684038442i, -0.003879852500121305 + 0.007859162551642592i }, { -0.006425440319290243 + -0.010429807921688242i, -0.012835794645386471 + -0.009025907859356558i, -0.0007313661311166808 + -0.0003851400867661923i, 0.000472846878428396 + -0.00027348008838905323i, 0.12603010980996307 + 2.016785447412489e-18i, -0.003369489245627184 + 0.0071963577045658i, -0.0006911386718103153 + 0.0011795948906298873i, -0.0003768313099827605 + -0.00014630047261008988i }, { -0.00028275191520563917 + -0.013847318664194641i, -0.002088025566454766 + -0.008472400719913595i, -0.0004549519094727117 + 0.0005069530270543851i, 7.804462191713372e-05 + 0.0008077658104762286i, -0.003369489245627186 + -0.007196357704565802i, 0.12392117713824805 + -6.098637220230962e-19i, 0.00030486720215554204 + 0.00022024838020056692i, 0.0001654358948109942 + -0.00011718617019309651i }, { 0.0005826425553231586 + 7.986377874027065e-05i, -8.269776995403088e-05 + 0.0005544622365902534i, -0.007601922601456563 + -0.010362462732686682i, -0.01088612450544181 + -0.008698615684038442i, -0.0006911386718103153 + -0.0011795948906298862i, 0.0003048672021555417 + -0.00022024838020056687i, 0.10960486832878748 + 4.607859233063394e-19i, -0.001805598247741054 + 0.007029128407655332i }, { 0.00015151859658846367 + -0.0005570792869140453i, -0.0012031782566634041 + -0.0010021288818886885i, -0.001765522091142555 + -0.012006082240960832i, -0.0038798525001213034 + -0.007859162551642592i, -0.0003768313099827607 + 0.00014630047261008947i, 0.0001654358948109949 + 0.00011718617019309597i, -0.0018055982477410536 + -0.00702912840765533i, 0.10966575503305981 + -1.5178830414797062e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1484960644762342, 1.0e-7), DoubleNear(0.13941018529870852, 1.0e-7), DoubleNear(0.12641263593444335, 1.0e-7), DoubleNear(0.11645920398055445, 1.0e-7), DoubleNear(0.12603010980996307, 1.0e-7), DoubleNear(0.12392117713824805, 1.0e-7), DoubleNear(0.10960486832878748, 1.0e-7), DoubleNear(0.10966575503305981, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.2657450047571205 + 2.846030702774449e-19i, 0.0 + 0.0i, 0.0035576777422622018 + -0.01193744793868622i, 0.0 + 0.0i, -0.0011169273517444656 + -0.002383195752723809i, 0.0 + 0.0i, 0.0012072116251841615 + 0.0009138534669666159i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0035576777422621983 + 0.011937447938686223i, 0.0 + 0.0i, 0.27211253196603336 + 1.6068215009414077e-18i, 0.0 + 0.0i, 4.217889138505198e-05 + 0.0014739717390938895i, 0.0 + 0.0i, -0.0006651120881073953 + 0.004532314520998301i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001116927351744465 + 0.0023831957527238098i, 0.0 + 0.0i, 4.217889138505168e-05 + -0.0014739717390938904i, 0.0 + 0.0i, 0.2284617699238378 + -4.811147140404426e-19i, 0.0 + 0.0i, 0.004419839809629653 + -0.009594530173427367i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0012072116251841607 + -0.0009138534669666164i, 0.0 + 0.0i, -0.0006651120881073957 + -0.004532314520998301i, 0.0 + 0.0i, 0.004419839809629655 + 0.00959453017342737i, 0.0 + 0.0i, 0.2336806933530073 + -2.862971361719535e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.2657450047571205, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27211253196603336, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2284617699238378, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2336806933530073, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.2623900926089572 + 2.913793338554793e-19i, 0.0 + 0.0i, 0.004515741877774625 + -0.010805545976761581i, 0.0 + 0.0i, -0.010665194217447126 + 0.018774275388483593i, 0.0 + 0.0i, 6.0868080711317025e-05 + 0.0008531685814410478i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004515741877774625 + 0.010805545976761585i, 0.0 + 0.0i, 0.2683879970809834 + -2.0938654456126304e-18i, 0.0 + 0.0i, -0.0005703395011766744 + 0.0005040472347718502i, 0.0 + 0.0i, -0.009330046769875748 + 0.01834955853744752i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010665194217447126 + -0.018774275388483596i, 0.0 + 0.0i, -0.0005703395011766725 + -0.0005040472347718473i, 0.0 + 0.0i, 0.23181668207200112 + -4.87890977618477e-19i, 0.0 + 0.0i, 0.00346177567411723 + -0.010726432135352007i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 6.0868080711317404e-05 + -0.0008531685814410498i, 0.0 + 0.0i, -0.009330046769875752 + -0.018349558537447515i, 0.0 + 0.0i, 0.003461775674117228 + 0.010726432135352008i, 0.0 + 0.0i, 0.2374052282380573 + 8.37715584834503e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.2623900926089572, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2683879970809834, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23181668207200112, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2374052282380573, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.2879062497749427 + 4.845028458294598e-19i, 0.0 + 0.0i, -0.0012563366628525398 + 0.0010867100478377017i, 0.0 + 0.0i, -0.008513465885745003 + 0.018902208641601838i, 0.0 + 0.0i, -0.0006205357013402455 + 0.000922265103148418i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00125633666285254 + -0.0010867100478377013i, 0.0 + 0.0i, 0.2428718399149978 + -2.286988957586611e-18i, 0.0 + 0.0i, -0.0006533215091995477 + -0.0004226257237100363i, 0.0 + 0.0i, -0.01148177510157787 + 0.018221625284329277i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00851346588574501 + -0.018902208641601838i, 0.0 + 0.0i, -0.000653321509199547 + 0.0004226257237100363i, 0.0 + 0.0i, 0.24995128694821112 + 1.4069217253893929e-18i, 0.0 + 0.0i, -0.0005257027769993211 + 0.0010624087204367909i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0006205357013402456 + -0.0009222651031484177i, 0.0 + 0.0i, -0.011481775101577867 + -0.018221625284329274i, 0.0 + 0.0i, -0.0005257027769993203 + -0.00106240872043679i, 0.0 + 0.0i, 0.2192706233618473 + -1.0570971181733668e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.2879062497749427, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2428718399149978, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24995128694821112, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2192706233618473, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.1417583485757476 + 2.439454888092385e-19i, 0.001570800078084563 + -0.006059429864400523i, -0.0006537890242448482 + -0.0011626106866678752i, 0.000674704045798182 + 4.458578942591385e-05i, -0.0048223746243734 + 0.009769334885555666i, -0.00045713183872325735 + 0.001028162739455907i, -0.00019917326768175965 + 0.0004921000155804203i, -0.00014471417054826057 + -0.00026144131591541005i }, { 0.0015708000780845623 + 0.006059429864400526i, 0.14614790119919516 + 2.405573570202213e-19i, 0.0001631112958708608 + 0.0012512730606930036i, -0.0006025476386076916 + 0.002249320734505577i, -0.00039506659014672 + 9.596641977644338e-05i, -0.0036910912613716037 + 0.00913287375604617i, 0.00026465828709920224 + 0.0003018855498378828i, -0.00042136243365848585 + 0.0004301650875679977i }, { -0.0006537890242448483 + 0.0011626106866678752i, 0.00016311129587086082 + -0.001251273060693004i, 0.12063174403320956 + 4.743384504624082e-20i, 0.002944941799690062 + -0.004746116112361057i, -0.00040498089907867467 + -0.00026352556659117276i, -6.899423379478964e-05 + -0.0003036817371476917i, -0.005842819593073725 + 0.009004940502927928i, 0.0005179999194345744 + -0.00017499415801485927i }, { 0.0006747040457981814 + -4.458578942591435e-05i, -0.0006025476386076918 + -0.0022493207345055766i, 0.002944941799690063 + 0.004746116112361059i, 0.12224009588178825 + -2.3344228026328517e-18i, 0.00016141483361369754 + 0.0001693535137255761i, -0.000248340610120873 + -0.0001591001571188635i, -0.00017527291102995435 + 0.0004080808149954068i, -0.005638955508504145 + 0.00921668478140135i }, { -0.004822374624373404 + -0.009769334885555668i, -0.00039506659014671867 + -9.596641977644088e-05i, -0.0004049808990786747 + 0.00026352556659117255i, 0.00016141483361369676 + -0.00016935351372557604i, 0.12398665618137288 + 4.0657581468206416e-20i, 0.001986877664177639 + -0.005878018074285696i, -0.0004631383274996173 + -0.0012205850660559335i, 0.0005325075793859795 + 0.0008692676775407021i }, { -0.0004571318387232571 + -0.0010281627394559088i, -0.003691091261371606 + -0.00913287375604617i, -6.899423379478918e-05 + 0.00030368173714769156i, -0.00024834061012087233 + 0.00015910015711886373i, 0.001986877664177636 + 0.005878018074285696i, 0.12596463076683823 + 1.3662641439211864e-18i, -0.0001209324044858088 + 0.00022269867840088583i, -6.256444949970377e-05 + 0.0022829937864927243i }, { -0.00019917326768175943 + -0.0004921000155804201i, 0.00026465828709920235 + -0.00030188554983788334i, -0.005842819593073721 + -0.009004940502927928i, -0.00017527291102995387 + -0.00040808081499540646i, -0.0004631383274996165 + 0.0012205850660559348i, -0.00012093240448580913 + -0.0002226986784008863i, 0.10783002589062823 + -5.285485590866834e-19i, 0.0014748980099395913 + -0.0048484140610663105i }, { -0.00014471417054826098 + 0.00026144131591541065i, -0.0004213624336584862 + -0.0004301650875679976i, 0.0005179999194345745 + 0.00017499415801485905i, -0.005638955508504145 + -0.009216684781401346i, 0.0005325075793859793 + -0.000869267677540702i, -6.256444949970385e-05 + -0.0022829937864927248i, 0.0014748980099395922 + 0.004848414061066312i, 0.11144059747121907 + -5.285485590866834e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.1417583485757476, 1.0e-7), DoubleNear(0.14614790119919516, 1.0e-7), DoubleNear(0.12063174403320956, 1.0e-7), DoubleNear(0.12224009588178825, 1.0e-7), DoubleNear(0.12398665618137288, 1.0e-7), DoubleNear(0.12596463076683823, 1.0e-7), DoubleNear(0.10783002589062823, 1.0e-7), DoubleNear(0.11144059747121907, 1.0e-7) }));


}
}

}
