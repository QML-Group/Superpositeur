#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { -0.6072857973496384 + 0.20583307735466347i, -0.00875486653092637 + -0.3683132298143948i, 0.24325885625600624 + 0.5028795646395499i, 0.26671060850739975 + 0.26440148503820227i }, { 0.3432231957056891 + -0.2270689735552565i, -0.0406272464520992 + 0.27453815615649896i, 0.3722111774228617 + 0.0076606305525799695i, 0.24068135550255265 + 0.7463835381977046i }, { 0.4257060801886716 + 0.4366650078423443i, 0.46792107330447175 + -0.4018308235157843i, -0.3734925331453737 + -0.015087050240878308i, 0.2464500164220091 + 0.21729694119322573i }, { -0.0737962893561279 + 0.20524701136914975i, -0.47092682572927447 + 0.4301822032050974i, -0.611675612459519 + 0.1883244014564608i, 0.3545839022034453 + 0.10127235601077136i } }) }, { QubitIndex{ 4 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.36501209620722186 + -0.14139236818323847i, -0.062272066244926386 + 0.8866479096529576i, 0.22113763444859671 + -0.06731133264829608i, 0.05487122601744179 + -0.017564782905175387i }, { 0.39713760594141045 + 0.41647266521435633i, 0.26855292390393126 + -0.20505192307623213i, 0.424122853552717 + -0.2003224307686621i, 0.25992546658319665 + 0.5168121105667965i }, { -0.23134532419809167 + 0.44742965928167633i, 0.06721551509448453 + 0.2984483391460979i, -0.6434470879046158 + -0.1161428344804206i, 0.44716488602642324 + 0.15882995979720302i }, { -0.02224137407545241 + 0.5112709371402989i, 0.043045392374740865 + 0.019195509001859207i, 0.1505381040043066 + -0.5257214340898957i, -0.24413295770670682 + -0.6141989325023348i } }) }, { QubitIndex{ 0 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.17815332498160497 + 0.5818287992186504i, 0.24688791118437192 + -0.7541770352568418i }, { -0.02024266701152161 + 0.7933012514991027i, -0.027218583497104765 + 0.6078836299117037i } }) }, { QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.06478335529099377 + -0.4066180937272676i, -0.11216205010779785 + -0.3032282575101687i }, { 0.5130214169150444 + -0.2666267013760864i, -0.09044988554680713 + 0.21620551921616143i } }), Matrix({ { -0.05256577294485534 + -0.35848519003514046i, 0.0010788964756335007 + -0.16495333326616488i }, { 0.019536554251512114 + -0.18264012914274225i, -0.08220788617253405 + 0.5033438430716584i } }), Matrix({ { -0.019216035708206323 + 0.1313158212900015i, -0.14575349765944337 + -0.03553792125952471i }, { -0.08425994352633988 + 0.13223166315837048i, 0.0932917158547821 + 0.6609743540060107i } }), Matrix({ { 0.12090558594782035 + 0.29428377830637265i, -0.19961049180691595 + 0.0153585785798602i }, { -0.06444168072226616 + 0.4284837220588926i, 0.19317528767419306 + -0.08790887313618478i } }) }, { QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.44779749876250574 + -0.09471308555770966i, 0.4109724607385129 + -0.20862923539250602i, -0.3113852695370757 + 0.29254026936234395i, 0.025190082427410637 + -0.6284164022718394i }, { -0.723480177426632 + 0.4555894801647445i, 0.26481882845135263 + -0.18803349168648653i, -0.01391159736517146 + 0.3660789532763101i, 0.0012317824301922853 + -0.17123143016018832i }, { -0.1623987195586816 + -0.16158368282455976i, -0.02247494855706031 + -0.554628820684638i, 0.3206887508647518 + -0.5212452065952902i, 0.4131050964465009 + -0.3069290736376127i }, { 0.08315271095901064 + 0.011157327226934195i, -0.1589287443462772 + -0.5905194958083535i, -0.5269084308068532 + 0.17630013431219538i, 0.24039862137395232 + 0.5024776522669904i } }) }, { QubitIndex{ 6 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.0566031940959979 + -0.14920876781658318i, 0.01222137599215056 + 0.06862630574872255i, -0.0016773669030536902 + 0.043207806384741025i, -0.055766826062693654 + -0.08353258276455004i }, { -0.02207964274900385 + -0.06059298477248028i, 0.12828328145936094 + 0.012477677206583604i, -0.016388105724509494 + 0.18882191441611285i, -0.0076518718545143215 + -0.14868702930490058i }, { 0.21989979822245276 + -0.03987836310520211i, -0.052283103319705204 + -0.06557265534171239i, -0.1286169761045115 + -0.1072608616723837i, 0.046841200359061246 + -0.1051481787567859i }, { 0.1241450453383887 + -0.01533726007943606i, 0.12027511125691032 + -0.10509518181729288i, 0.023790267895883083 + -0.06410789496299801i, 0.0970075807427247 + 0.09421319407413553i } }), Matrix({ { -0.13738008456233455 + 0.1380407384486385i, 0.0042225142291199055 + 0.12843706639842603i, 0.13430890079920063 + -0.08396350493977045i, 0.0925072238738512 + 0.009482346568751257i }, { -0.07675028424697664 + 0.1077262329680671i, -0.015901489214824076 + 0.04913828096445271i, 0.09418808200052704 + -0.051756918716494696i, 0.09507407193670381 + -0.031316840317677966i }, { 0.13688183825416203 + 0.06630881827664517i, -0.034491098452756656 + -0.0640626796225897i, 0.10423139251009725 + -0.07127737559759037i, -0.06793886532942398 + -0.09210392465858637i }, { -0.11467473971384765 + 0.1484825282118732i, -0.015866479302941487 + 0.07383479595025419i, 0.08862002169303028 + 0.08942041433627192i, 0.05576510769962931 + 0.05501889511211599i } }), Matrix({ { 0.0621421064077661 + 0.02128395599913626i, 0.08401781540644802 + -0.059005715255881525i, 0.028009307763274593 + 0.001554708367897795i, -0.08536841468486359 + 0.07569913396366433i }, { -0.14837929755257143 + -0.05060057452858556i, -0.03366133153997257 + -0.07172170873372957i, -0.09748119962297702 + 0.04698835344698828i, 0.13276367385252696 + -0.01581585560502864i }, { -0.06182540298217909 + -0.03799256214798982i, 0.017862723700555878 + 0.05053454009200032i, 0.0038556003751973075 + -0.04931851607687341i, -0.08152806518755323 + 0.10576540631810541i }, { -0.10516307045425172 + 0.016169670871673994i, -0.0017482334607460675 + 0.08331257464525822i, 0.09192434895657531 + 0.031703360261003725i, -0.02849876606154752 + 0.15788062076908327i } }), Matrix({ { 0.17229303512054578 + -0.04264980364502351i, -0.015473640870005495 + 0.16888416682618265i, 0.04119664029161379 + -0.021764336712414612i, 0.031678115601903103 + 0.02009234547644501i }, { 0.017398369762962718 + 0.04975642515419236i, -0.08608913962210946 + 0.018431365581992997i, -0.15324538563779586 + -0.1130459117315234i, -0.051396917206350305 + -0.05217611664528194i }, { -0.1163835524711161 + -0.0033326676196683454i, 0.01390889867932351 + 0.10426633466058341i, 0.015399613822143783 + 0.016770754011683014i, 0.028521705815596023 + 0.007714875712955976i }, { 0.14144717414088126 + -0.04876901462174421i, 0.05206550076641335 + -0.031488495122131796i, 0.023347863928664118 + -0.04941643430439231i, -0.014859292809810033 + 0.10508506172728607i } }), Matrix({ { 0.04478113803645531 + 0.013819962190278676i, -0.027771249524124873 + 0.05154287891181662i, -0.029253153283744136 + -0.04988494392589444i, -0.042996573484146414 + -0.006847811524735061i }, { -0.10957076785301641 + -0.2056697843116681i, 0.1031526847929785 + 0.12888677156646047i, -0.059798681897369504 + -0.22329012083281327i, -0.1545863009367507 + -0.09547356176138697i }, { 0.06632721363565806 + -0.07327442989120003i, 0.025189952687371835 + 0.09070751810521008i, -0.06280248263360581 + 0.13730902086092345i, -0.1413409809086373 + 0.07315357148798171i }, { 0.08378331600746522 + 0.08493767601599547i, 0.13609331912094352 + -0.19955223669934347i, -0.04923708447999252 + -0.04101724075980087i, 0.05282311718984478 + -0.10853691166436669i } }), Matrix({ { 0.031337787979738435 + 0.15464791113266235i, -0.10983246295218761 + 0.004200318573169198i, 0.0868009004289118 + -0.00210143343691592i, 0.03147973325369004 + -0.13444754191348754i }, { 0.06472152635668683 + -0.13305909279830944i, 0.0011350415032983416 + -0.0365139925095539i, 0.013252725996431451 + 0.03938176365458869i, 0.15676313847103088 + -0.002295693576656964i }, { 0.04231590163866824 + 0.01564028974641842i, -0.09053007675630677 + -0.09097485794532208i, 0.031220863773312686 + -0.14528863584870416i, 0.17676901324460165 + -0.1073899691396585i }, { -0.00392216726244194 + 0.01620443534936034i, 0.06768506173177195 + -0.08746465538507768i, 0.017703975546322862 + -0.2523280025939312i, -0.21164455229671666 + 0.004349360080340539i } }), Matrix({ { -0.07653240029452986 + 0.07995322467251943i, -0.007553429943241686 + -0.1441301989677164i, -0.04126933523732568 + 0.15439258418173948i, -0.04372274404545324 + -0.14465038088334922i }, { 0.05600972289187615 + 0.17771782564063351i, -0.17338723559282787 + -0.013262660576651064i, 0.0896619224794388 + 0.1571551668217916i, -0.05662980195383143 + -0.0693799821536385i }, { 0.004478675617431091 + 0.07690925857272117i, -0.057379392556380665 + -0.08180905545600602i, -0.09474699278455435 + -0.09147631543578733i, -0.19757528909975788 + -0.014355914517902177i }, { -0.0693154739865788 + -0.05687247270796402i, 0.18959657847824757 + -0.07760486281721897i, 0.3020723834524018 + -0.004203776378769166i, 0.039989538277305524 + -0.18269981086074402i } }), Matrix({ { -0.12005283077847133 + 0.10366804057677466i, 0.11239081225348489 + 0.06258378023196899i, -0.05156701819764821 + -0.00829814535464893i, 0.008582444846525117 + 0.025678644697640217i }, { 0.03471205203842875 + 0.11758360246752131i, 0.1712252033549776 + 0.06063284501612474i, -0.08107079292400632 + -0.0023676298482597003i, 0.03375878297863707 + -0.007387299711023556i }, { 0.1659683411703632 + 0.022011662689590882i, -0.13247657381298047 + -0.005229626048905572i, 0.05820104056004353 + -0.032992858456933095i, 0.05534743193484302 + 0.08349746712209813i }, { 0.010146512260822775 + 0.026618226124967292i, -0.03340741426082161 + -0.025253628528784846i, 0.0722519164189414 + -0.062345013617709714i, -0.0032083192720824194 + 0.004361940716504493i } }), Matrix({ { -0.05573303854792218 + 0.03658945450563259i, -0.049751092422158874 + -0.009725784074995894i, -0.09765387400190927 + 0.021229739540465555i, 0.15437943604105597 + -0.02557751936108442i }, { -0.014657414166212936 + -0.05320489939055451i, -0.04569566258980123 + -0.18230992925049339i, 0.03862758725353208 + 0.013631232238890565i, 0.12068768371603092 + -0.08407277108114512i }, { 0.007026906072509817 + 0.012125710577307621i, -0.051152940251773076 + -0.1252321805805667i, 0.024569404596455607 + 0.03206202073441543i, 0.041867281557496985 + -0.005721510091625114i }, { 0.011512511378265 + 0.036395363653897776i, -0.12090985279234366 + -0.05168678565410431i, -0.002640693817016546 + -0.03460926337266599i, 0.06784268360583767 + 0.06271527837885829i } }), Matrix({ { 0.004841478693407922 + -0.03878108730044826i, -0.07056318140363804 + -0.029343731765498503i, 0.009556106737394958 + 0.07161585108773498i, -0.04953887744916989 + 0.02978508854753005i }, { -0.08043497392057951 + -0.03292755173122987i, 0.01704103753496575 + -0.002750745819553229i, -0.09612262051894285 + -0.09113429402660074i, 0.16887562592703945 + -0.10330424788142972i }, { 0.02896663936848827 + 0.038341489529423456i, 0.08295831260419784 + 0.0890646682648231i, -0.0384191353134279 + 0.06594747765943902i, -0.0058966510314895524 + -0.18276540367255448i }, { 0.03913092870809851 + 0.006797305428998008i, -0.1678660330371319 + 0.0011887743137566184i, -0.015897491766523747 + -0.04697974412298867i, 0.12207175650341123 + 0.06947617799371218i } }), Matrix({ { -0.05561088243740026 + -0.06972361794418457i, -0.14123159459581083 + 0.027804311673940065i, -0.16950261133661512 + 0.09889175660085543i, 0.04070673299642838 + 0.15197099660259727i }, { -0.027011398491812545 + -0.00887260294000914i, -0.0953214150885749 + -0.03158862948395553i, -0.13792648926687495 + -0.03902606184480809i, -0.05765853827602423 + -0.00021814231315484464i }, { -0.014630996210171617 + 0.1407040565835856i, -0.04527619933160273 + -0.07993550882414145i, -0.030215551439010044 + 0.13235001358733636i, -0.1038433937821936 + 0.08432915019771604i }, { 0.038193008023250145 + -0.09778545832476664i, 0.01574219292516833 + -0.12014178557422345i, 0.22795152947356295 + -0.007391146824469167i, 0.11127615781550414 + 0.1419232498196924i } }), Matrix({ { 0.009971182797493913 + -0.14996014235987357i, 0.006432905805628106 + -0.2655494849892036i, 0.0633631350803516 + 0.04989096146820267i, -0.07965973183905456 + -0.010971803554298647i }, { 0.0235859801033606 + -0.11714031196861485i, 0.10942561085419936 + -0.080799997249535i, 0.005487462296687088 + 0.053415773708091356i, 0.038852043465668215 + 0.06299263523086586i }, { 0.07903959432757339 + 0.11016657299174275i, -0.08531638433610382 + 0.06721314075438568i, -0.05765054051384178 + -0.05029933459711923i, -0.027231470954043446 + 0.024258132978622775i }, { 0.11193364642043176 + -0.09282966685748531i, -0.05619566033677299 + -0.0024611525405552046i, -0.12319966936419646 + 0.12398511930892514i, 0.0893225753541274 + -0.0076863385075609395i } }), Matrix({ { 0.13660965326313754 + -0.05631076647857135i, -0.1855802277521926 + 0.08138586160016043i, 0.09447852962320365 + -0.055093066953749326i, 0.1235029724024049 + 0.07030029265837735i }, { -0.07452575464232984 + 0.020349579354138468i, -0.039700022450955094 + 0.09384271209203898i, -0.04472929266396996 + -0.037643172873821885i, -0.03828180960100455 + -0.08772146420122409i }, { 0.06722662147486137 + 0.10204500776057189i, 0.12404612926621716 + 0.17348753351295654i, 0.02334317139165894 + -0.08440080563914207i, -0.06051875003334773 + -0.06364252799880445i }, { -0.1497991137760437 + 0.08143697788194648i, -0.03811305755135665 + -0.04087680057229887i, -0.02361007561110141 + -0.14587214485407576i, -0.04415869544991775 + -0.020226015129000696i } }), Matrix({ { -0.12595582000718047 + 0.009744076148181251i, -0.11648494506392282 + 0.08381578579683446i, 0.07373408550470084 + -0.020261457923051507i, -0.06758249978788904 + -0.07179014952930746i }, { -0.15135016237470317 + -0.012009927764583529i, -0.11841049520644062 + 0.09150371420280082i, 0.03813562905162087 + -0.09404421449408419i, -0.057370949808345596 + 0.09927569913799911i }, { 0.18366418919291239 + 0.01131336256965557i, -0.09909305998273882 + 0.03682741635088274i, -0.0015543052677587112 + 0.03842470096437426i, -0.13048264578703925 + -0.005915068381416259i }, { 0.09890184727469283 + 0.15222956521672049i, 0.004034860090700395 + -0.038386604209577756i, -0.06665678617487947 + -0.05119045621594512i, 0.11016586732523806 + 0.0937394197576671i } }), Matrix({ { 0.09742676153954327 + -0.018408947711421337i, -0.08354196099234507 + 0.09718419317956341i, -0.0982421627184673 + -0.10989130751917382i, 0.06758040380676004 + -0.039842241135641436i }, { 0.1617333405978876 + -0.08800976390410589i, 0.1674332197653164 + -0.08730136816533961i, -0.0006995935601261196 + 0.006997559154297608i, -0.017771665202354445 + -0.016055471183474175i }, { -0.0701543185574488 + -0.1505469101202158i, 0.0017603916700032073 + -0.03692167809571976i, -0.03676569922608836 + -0.13966301798341207i, -0.10251374097644403 + -0.06266149653924141i }, { -0.07062653594443952 + -0.008962459997393478i, 0.06046794851261704 + 0.05825365682581028i, 0.06681124325292823 + -0.09173972580275061i, -0.10462739274977365 + -0.013892268302148918i } }), Matrix({ { -0.017410769226459226 + 0.07283251860110737i, -0.025727706600978336 + -0.06962117298166774i, 0.015528815444751078 + 0.09987450242269694i, -0.10221891609194882 + -0.0656453890961614i }, { -0.0771015156050502 + -0.10381868397809021i, 0.07252319869466983 + 0.120305788581241i, 0.06146976776202203 + -0.11819640015615082i, -0.05841013231387872 + 0.21313823909976526i }, { -0.01298266979891331 + 0.006925015247079161i, -0.027221668691991482 + -0.05095899836468889i, -0.19625433756062438 + 0.025621332690905597i, 0.0927163570862398 + -0.04199070634577431i }, { -0.028374004506755562 + -0.007785825930075964i, -0.025291396992521826 + -0.0013473142242223356i, -0.08222599130884986 + -0.0780341064635414i, 0.13871250931061985 + -0.06393239340344309i } }) }, { QubitIndex{ 5 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 0 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_10_2_30_30_30) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.48194183622828235 + -2.5537404303046606e-18i, 0.056390502929748884 + 0.0033525061739888636i }, { 0.05639050292974889 + -0.003352506173988846i, 0.5180581637717171 + -6.976227259253472e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.48194183622828235, 1.0e-7), DoubleNear(0.5180581637717171, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.2619757991432655 + -4.374078139621207e-18i, 1.5178830414797062e-18 + 0.0i }, { 6.505213034913027e-19 + 8.673617379884035e-19i, 0.7380242008567339 + -5.155889549936925e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2619757991432655, 1.0e-7), DoubleNear(0.7380242008567339, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.5158548039760683 + -4.630372277797894e-18i, -0.19655374508142565 + -0.017570836625600994i }, { -0.19655374508142567 + 0.017570836625600952i, 0.48414519602393113 + -4.899595411760239e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5158548039760683, 1.0e-7), DoubleNear(0.48414519602393113, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.6202058341390468 + -1.8584749895706604e-17i, 0.3625746500556671 + -0.08901295262843001i }, { 0.362574650055667 + 0.08901295262842998i, 0.37979416586095255 + 9.05478220614847e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.6202058341390468, 1.0e-7), DoubleNear(0.37979416586095255, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.58052577621774 + -1.7975733206630762e-17i, -0.24057898046758724 + 0.2991161625211706i }, { -0.2405789804675873 + -0.2991161625211706i, 0.41947422378225935 + 8.445765517072629e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.58052577621774, 1.0e-7), DoubleNear(0.41947422378225935, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.47822428751487955 + -4.924458407580399e-18i, 0.011253895676536885 + 0.03360749882880406i }, { 0.011253895676536882 + -0.03360749882880406i, 0.5217757124851199 + -4.605509281977735e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.47822428751487955, 1.0e-7), DoubleNear(0.5217757124851199, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.4334117857310842 + -4.244477119242596e-18i, -0.003091907204023856 + 0.0008594915886468062i }, { -0.0030919072040238565 + -0.0008594915886468071i, 0.5665882142689153 + -5.285490570315537e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4334117857310842, 1.0e-7), DoubleNear(0.5665882142689153, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.9999999999999994 + -9.529967689558133e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.9999999999999994, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.12881904538139072 + -2.0625000822911416e-18i, 0.014772947069111628 + 0.0004026487496284637i, 0.0014149531044716306 + 0.0003204790413416166i, -0.0017262497706496734 + 0.007621598160831184i }, { 0.014772947069111626 + -0.00040264874962846415i, 0.1331567537618748 + -2.3115780573300654e-18i, 0.0017262497706496795 + -0.007621598160831192i, -0.0014149531044716302 + -0.0003204790413416166i }, { 0.0014149531044716297 + -0.0003204790413416153i, 0.0017262497706496804 + 0.007621598160831192i, 0.35312279084689163 + -4.912403480135186e-19i, 0.041617555860637256 + 0.002949857424360396i }, { -0.001726249770649677 + -0.007621598160831187i, -0.0014149531044716297 + 0.00032047904134161614i, 0.041617555860637256 + -0.0029498574243603786i, 0.38490141000984235 + -4.664649201923409e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12881904538139072, 1.0e-7), DoubleNear(0.1331567537618748, 1.0e-7), DoubleNear(0.35312279084689163, 1.0e-7), DoubleNear(0.38490141000984235, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.2526130707180424 + -4.595292037114899e-20i, 0.033842178962422934 + 0.08329823025727065i, -0.09168092141789289 + -0.01202965160713592i, -0.023107831174098523 + 0.00814753510714571i }, { 0.033842178962422934 + -0.08329823025727065i, 0.2632417332580259 + -4.5844193574267455e-18i, 0.005549404614990425 + -0.010425632907234389i, -0.10487282366353277 + -0.005541185018465053i }, { -0.09168092141789289 + 0.01202965160713591i, 0.005549404614990425 + 0.010425632907234382i, 0.22932876551023995 + -2.507787509933511e-18i, 0.02254832396732595 + -0.0799457240832818i }, { -0.023107831174098523 + -0.008147535107145706i, -0.10487282366353277 + 0.005541185018465046i, 0.022548323967325954 + 0.0799457240832818i, 0.2548164305136912 + -2.391807901826727e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2526130707180424, 1.0e-7), DoubleNear(0.2632417332580259, 1.0e-7), DoubleNear(0.22932876551023995, 1.0e-7), DoubleNear(0.2548164305136912, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.29890313854446593 + -6.952905803919129e-18i, 0.034973718907065285 + 0.00207924388809508i, 0.17473989261765518 + -0.042899065837846695i, 0.020744183339468585 + -0.0038039514131356198i }, { 0.034973718907065285 + -0.0020792438880950503i, 0.3213026955945809 + -1.1631844091787475e-17i, 0.020147350392965006 + -0.006235018918822567i, 0.1878347574380119 + -0.04611388679058332i }, { 0.17473989261765518 + 0.04289906583784668i, 0.020147350392965 + 0.0062350189188225495i, 0.18303869768381642 + 4.399165373614469e-18i, 0.021416784022683603 + 0.001273262285893783i }, { 0.020744183339468574 + 0.003803951413135604i, 0.18783475743801192 + 0.0461138867905833i, 0.0214167840226836 + -0.0012732622858937952i, 0.19675546817713616 + 4.655616832534001e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.29890313854446593, 1.0e-7), DoubleNear(0.3213026955945809, 1.0e-7), DoubleNear(0.18303869768381642, 1.0e-7), DoubleNear(0.19675546817713616, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.27977965856822673 + -7.318177297027756e-18i, 0.03273614048460122 + 0.0019462162489296611i, -0.11594507560447716 + 0.14415659261101038i, -0.014569158484485582 + 0.016060768321635797i }, { 0.03273614048460122 + -0.0019462162489296386i, 0.3007461176495133 + -1.0657555909603009e-17i, -0.012563580921301422 + 0.017673853356334854i, -0.12463390486311013 + 0.15495956991016024i }, { -0.11594507560447717 + -0.14415659261101038i, -0.012563580921301406 + -0.01767385335633484i, 0.20216217766005562 + 4.764436866723094e-18i, 0.023654362445147667 + 0.001406289925059202i }, { -0.014569158484485561 + -0.01606076832163579i, -0.12463390486311014 + -0.15495956991016024i, 0.023654362445147667 + -0.0014062899250592072i, 0.21731204612220373 + 3.681328650349534e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.27977965856822673, 1.0e-7), DoubleNear(0.3007461176495133, 1.0e-7), DoubleNear(0.20216217766005562, 1.0e-7), DoubleNear(0.21731204612220373, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.23306189927666998 + -1.6762346174644656e-18i, 0.026967308086184902 + 0.0011232305915671614i, 0.007449014897761105 + 0.010720539701595585i, -0.0004947377645073072 + 0.0015568761973333957i }, { 0.026967308086184902 + -0.0011232305915671534i, 0.24516238823820957 + -3.2482237901159337e-18i, 0.0017639634387449897 + 0.0022334113250010216i, 0.00380488077877578 + 0.022886959127208478i }, { 0.007449014897761105 + -0.010720539701595585i, 0.0017639634387449901 + -0.002233411325001021i, 0.24887993695161237 + -8.775058128401948e-19i, 0.029423194843563982 + 0.0022292755824217018i }, { -0.0004947377645073065 + -0.0015568761973333953i, 0.0038048807787757783 + -0.022886959127208475i, 0.029423194843563986 + -0.0022292755824216927i, 0.2728957755335075 + -3.728003469137539e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.23306189927666998, 1.0e-7), DoubleNear(0.24516238823820957, 1.0e-7), DoubleNear(0.24887993695161237, 1.0e-7), DoubleNear(0.2728957755335075, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.2321991717738916 + -4.663305448550672e-18i, 0.02444030857305641 + -0.002876334152917759i, -0.003911398477468591 + -0.006515923180108239i, -0.02223909723047538 + 0.006490786560932972i }, { 0.024440308573056416 + 0.0028763341529177647i, 0.20121261395719262 + 4.1882832930807517e-19i, -0.012372542847255976 + 0.003130593239005966i, 0.0008194912734447341 + 0.007375414768755045i }, { -0.003911398477468591 + 0.006515923180108239i, -0.012372542847255976 + -0.0031305932390059653i, 0.24974266445439075 + 2.1095650182460115e-18i, 0.031950194356692475 + 0.006228840326906623i }, { -0.02223909723047538 + -0.006490786560932975i, 0.0008194912734447342 + -0.007375414768755046i, 0.031950194356692475 + -0.0062288403269066105i, 0.3168455498145245 + -7.395055588561548e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2321991717738916, 1.0e-7), DoubleNear(0.20121261395719262, 1.0e-7), DoubleNear(0.24974266445439075, 1.0e-7), DoubleNear(0.3168455498145245, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.48194183622828235 + -2.5537404303046606e-18i, 0.056390502929748884 + 0.0033525061739888636i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.05639050292974889 + -0.003352506173988846i, 0.5180581637717171 + -6.976227259253472e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.48194183622828235, 1.0e-7), DoubleNear(0.5180581637717171, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.12848165928598348 + -2.0637748733328937e-18i, -0.0014209451537223689 + 0.006273641945902495i, -0.0514923244423082 + 0.0027775012967749223i, 0.001265464265453128 + 0.00028662064725878803i }, { -0.0014209451537223667 + -0.006273641945902497i, 0.3873731446900849 + -2.566597404465001e-18i, -0.0012654642654531278 + 0.0002866206472587886i, -0.14506142063911745 + -0.0203483379223759i }, { -0.051492324442308196 + -0.0027775012967749223i, -0.0012654642654531278 + -0.00028662064725878825i, 0.13349413985728203 + -2.3103032662883136e-18i, 0.0014209451537223697 + -0.006273641945902495i }, { 0.0012654642654531278 + -0.000286620647258789i, -0.14506142063911745 + 0.020348337922375892i, 0.0014209451537223676 + 0.006273641945902497i, 0.35065105616664904 + -2.589292145471925e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12848165928598348, 1.0e-7), DoubleNear(0.3873731446900849, 1.0e-7), DoubleNear(0.13349413985728203, 1.0e-7), DoubleNear(0.35065105616664904, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.1624789190318925 + -5.522654816098038e-18i, 1.734723475976807e-18 + 0.0i, 0.09498578369742328 + -0.023319239398934603i, 6.776263578034403e-19 + 6.505213034913027e-19i }, { 9.75781955236954e-19 + 4.336808689942018e-19i, 0.45772691510715446 + -1.3062095079608564e-17i, -6.505213034913027e-19 + -2.168404344971009e-19i, 0.26758886635824386 + -0.06569371322949541i }, { 0.09498578369742325 + 0.023319239398934592i, -2.168404344971009e-19 + 4.336808689942018e-19i, 0.09949688011137302 + 1.1485766764768313e-18i, -2.168404344971009e-19 + 0.0i }, { 4.607859233063394e-19 + 0.0i, 0.2675888663582438 + 0.06569371322949538i, -7.047314121155779e-19 + 4.336808689942018e-19i, 0.28029728574957957 + 7.90620552967164e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1624789190318925, 1.0e-7), DoubleNear(0.45772691510715446, 1.0e-7), DoubleNear(0.09949688011137302, 1.0e-7), DoubleNear(0.28029728574957957, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.15208370414790706 + -4.8890741715518216e-18i, 1.4094628242311558e-18 + 0.0i, -0.06302587066506828 + 0.07836119571315059i, 2.168404344971009e-19 + 6.505213034913027e-19i }, { 1.0842021724855044e-18 + 0.0i, 0.4284420720698331 + -1.3086659035078939e-17i, 0.0 + 0.0i, -0.177553109802519 + 0.22075496680802i }, { -0.06302587066506829 + -0.0783611957131506i, -4.336808689942018e-19 + 0.0i, 0.10989209499535846 + 5.149960319306146e-19i, -1.6263032587282567e-19 + 2.168404344971009e-19i }, { 2.168404344971009e-19 + 4.336808689942018e-19i, -0.177553109802519 + -0.22075496680802004i, -4.336808689942018e-19 + 4.336808689942018e-19i, 0.30958212878690095 + 7.930769485142014e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.15208370414790706, 1.0e-7), DoubleNear(0.4284420720698331, 1.0e-7), DoubleNear(0.10989209499535846, 1.0e-7), DoubleNear(0.30958212878690095, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.1435851223960342 + -2.3245443594608684e-18i, -0.004049782208977585 + -0.004336583003762931i, -0.008297910001449046 + 0.021324285867764484i, -0.000299784768415283 + -0.007988959660219317i }, { -0.004049782208977584 + 0.0043365830037629316i, 0.3346391651188454 + -2.5999140481195296e-18i, -6.558975377164017e-05 + 0.0016052436286205867i, 0.019551805677985933 + 0.012283212961039573i }, { -0.008297910001449046 + -0.021324285867764484i, -6.558975377163843e-05 + -0.0016052436286205856i, 0.1183906767472313 + -2.0495337801603386e-18i, 0.004049782208977587 + 0.004336583003762931i }, { -0.00029978476841528386 + 0.007988959660219317i, 0.01955180567798593 + -0.012283212961039573i, 0.004049782208977585 + -0.004336583003762931i, 0.40338503573788864 + -2.5559755018173954e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1435851223960342, 1.0e-7), DoubleNear(0.3346391651188454, 1.0e-7), DoubleNear(0.1183906767472313, 1.0e-7), DoubleNear(0.40338503573788864, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.14151379856111887 + -2.3966503383620924e-18i, 0.0009448621231544798 + -0.0041716787121500905i, -0.0003950310114480079 + 3.7782982113582176e-05i, -0.02805353718787914 + 0.018702558870919185i }, { 0.0009448621231544798 + 0.0041716787121500905i, 0.29189798716996535 + -1.847826780880503e-18i, 0.0033135325430618872 + 0.0007326708517236254i, -0.0026968761925758485 + 0.0008217086065332242i }, { -0.00039503101144800797 + -3.778298211358207e-05i, 0.0033135325430618877 + -0.0007326708517236253i, 0.12046200058214662 + -1.9774278012591146e-18i, -0.0009448621231544782 + 0.0041716787121500905i }, { -0.02805353718787914 + -0.018702558870919185i, -0.0026968761925758485 + -0.0008217086065332251i, -0.0009448621231544791 + -0.00417167871215009i, 0.44612621368676864 + -3.3080627690564214e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.14151379856111887, 1.0e-7), DoubleNear(0.29189798716996535, 1.0e-7), DoubleNear(0.12046200058214662, 1.0e-7), DoubleNear(0.44612621368676864, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.2619757991432655 + -4.374078139621207e-18i, 1.5178830414797062e-18 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 6.505213034913027e-19 + 8.673617379884035e-19i, 0.7380242008567339 + -5.155889549936925e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2619757991432655, 1.0e-7), DoubleNear(0.7380242008567339, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.31993615899461214 + -9.673503763305079e-18i, -0.12190377942137927 + -0.010897535385901783i, 0.18703587503115782 + -0.045917759229469855i, -0.07282943738822523 + 0.011125089259160895i }, { -0.12190377942137925 + 0.010897535385901769i, 0.30026967514443476 + -8.911246132401525e-18i, -0.06970137329183222 + 0.02386656914058604i, 0.17553877502450926 + -0.04309519339896016i }, { 0.18703587503115782 + 0.045917759229469834i, -0.06970137329183224 + -0.023866569140586033i, 0.19591864498145617 + 5.043131485507184e-18i, -0.07464996566004639 + -0.006673301239699191i }, { -0.07282943738822524 + -0.011125089259160888i, 0.17553877502450926 + 0.043095193398960153i, -0.07464996566004639 + 0.0066733012396991975i, 0.18387552087949638 + 4.011650720641286e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.31993615899461214, 1.0e-7), DoubleNear(0.30026967514443476, 1.0e-7), DoubleNear(0.19591864498145617, 1.0e-7), DoubleNear(0.18387552087949638, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.2994670104938574 + -8.345639696600289e-18i, -0.1141045154318985 + -0.010200323570872125i, -0.12410382280986969 + 0.15430050938343234i, 0.05254242082251167 + -0.05456522799657086i }, { -0.11410451543189849 + 0.010200323570872097i, 0.2810587657238827 + -9.630093510030471e-18i, 0.042030978375039274 + -0.06301957591927011i, -0.1164751576577176 + 0.14481565313773825i }, { -0.12410382280986969 + -0.15430050938343237i, 0.04203097837503927 + 0.06301957591927011i, 0.21638779348221093 + 3.715267418802395e-18i, -0.08244922964952714 + -0.0073705130547288555i }, { 0.05254242082251167 + 0.05456522799657085i, -0.1164751576577176 + -0.14481565313773825i, -0.08244922964952715 + 0.007370513054728873i, 0.2030864303000484 + 4.730498098270233e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2994670104938574, 1.0e-7), DoubleNear(0.2810587657238827, 1.0e-7), DoubleNear(0.21638779348221093, 1.0e-7), DoubleNear(0.2030864303000484, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.24665737292109569 + -2.4346305509631515e-18i, -0.09399677469994608 + -0.008361881303447807i, 0.0013733883489685014 + 0.020791659860943914i, 0.0022075435586268117 + -0.001891739492161149i }, { -0.0939967746999461 + 0.008361881303447796i, 0.23156691459378387 + -2.4898278566172472e-18i, -0.006631534242584791 + -0.01131962002308099i, 0.009880507327568388 + 0.012815838967860146i }, { 0.0013733883489684996 + -0.020791659860943914i, -0.006631534242584791 + 0.01131962002308099i, 0.2691974310549726 + -2.195741726834743e-18i, -0.10255697038147957 + -0.009208955322153177i }, { 0.002207543558626811 + 0.0018917394921611468i, 0.009880507327568384 + -0.012815838967860144i, -0.10255697038147957 + 0.009208955322153163i, 0.25257828143014727 + -2.4097675551429917e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24665737292109569, 1.0e-7), DoubleNear(0.23156691459378387, 1.0e-7), DoubleNear(0.2691974310549726, 1.0e-7), DoubleNear(0.25257828143014727, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.16510773109525412 + -1.7836704747725223e-18i, -0.08518870964787303 + 0.0571828495650607i, -0.0011272843751785422 + 0.0019358529111915238i, -0.002501676161211909 + 0.0006954185479051903i }, { -0.08518870964787306 + -0.057182849565060714i, 0.26830405463583007 + -2.460806644470074e-18i, 0.012431620718605981 + -0.0034557548903743733i, -0.001964622828845314 + -0.0010763613225447174i }, { -0.0011272843751785426 + -0.0019358529111915244i, 0.012431620718605978 + 0.003455754890374381i, 0.3507470728808142 + -2.846701803025372e-18i, -0.11136503543355261 + -0.0747536861906617i }, { -0.002501676161211909 + -0.0006954185479051927i, -0.0019646228288453136 + 0.0010763613225447174i, -0.11136503543355261 + 0.07475368619066167i, 0.21584114138810107 + -2.4387887672901645e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.16510773109525412, 1.0e-7), DoubleNear(0.26830405463583007, 1.0e-7), DoubleNear(0.3507470728808142, 1.0e-7), DoubleNear(0.21584114138810107, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.5158548039760683 + -4.630372277797894e-18i, -0.19655374508142565 + -0.017570836625600994i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.19655374508142567 + 0.017570836625600952i, 0.48414519602393113 + -4.899595411760239e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.5158548039760683, 1.0e-7), DoubleNear(0.48414519602393113, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.5065292885977429 + -1.940721888749053e-17i, 0.19329585005633615 + -0.010867501271556397i, -0.17575224019096525 + 0.1633757932226891i, -0.14940683791605366 + 0.36410585987890765i }, { 0.19329585005633615 + 0.01086750127155639i, 0.07399648761999716 + 1.4314856808597676e-18i, -0.07057373800944389 + 0.058574846121910704i, -0.06482674027662201 + 0.1357403692984815i }, { -0.1757522401909653 + -0.1633757932226891i, -0.0705737380094439 + -0.058574846121910724i, 0.11367654554130395 + 8.224689917839253e-19i, 0.16927879999933093 + -0.07814545135687362i }, { -0.1494068379160537 + -0.36410585987890765i, -0.06482674027662201 + -0.13574036929848154i, 0.16927879999933093 + 0.07814545135687359i, 0.3057976782409554 + 7.623296525288703e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5065292885977429, 1.0e-7), DoubleNear(0.07399648761999716, 1.0e-7), DoubleNear(0.11367654554130395, 1.0e-7), DoubleNear(0.3057976782409554, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.2965974931437174 + -8.90113955794822e-18i, 0.17339200369382826 + -0.042568155850326694i, 0.006979731755380379 + 0.020843566844445473i, 0.0070718799878917 + 0.011183484644359008i }, { 0.17339200369382826 + 0.04256815585032668i, 0.18162679437116214 + 3.976681150367821e-18i, 0.0010888745854749932 + 0.01318696960984075i, 0.004274163921156506 + 0.012763931984358587i }, { 0.006979731755380374 + -0.020843566844445473i, 0.0010888745854749932 + -0.013186969609840752i, 0.3236083409953294 + -9.683610337758384e-18i, 0.18918264636183882 + -0.04644479677810332i }, { 0.0070718799878917 + -0.011183484644359008i, 0.00427416392115651 + -0.012763931984358585i, 0.1891826463618388 + 0.04644479677810331i, 0.1981673714897904 + 5.078101055780651e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2965974931437174, 1.0e-7), DoubleNear(0.18162679437116214, 1.0e-7), DoubleNear(0.3236083409953294, 1.0e-7), DoubleNear(0.1981673714897904, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.2688045180950411 + -7.992970478157738e-18i, 0.15714412654144969 + -0.03857926275188428i, -0.0019176188865521453 + 0.0005330616976721868i, -0.001044541288438791 + 0.0005868496514626802i }, { 0.15714412654144969 + 0.038579262751884266i, 0.1646072676360431 + 3.748493358915141e-18i, -0.0011975530565682957 + 3.641007249612896e-05i, -0.0011742883174717111 + 0.0003264298909746195i }, { -0.0019176188865521451 + -0.0005330616976721887i, -0.0011975530565682948 + -3.6410072496129067e-05i, 0.3514013160440058 + -1.0591779417548866e-17i, 0.2054305235142174 + -0.050433689876545736i }, { -0.001044541288438792 + -0.0005868496514626805i, -0.0011742883174717114 + -0.00032642989097461845i, 0.20543052351421737 + 0.050433689876545715i, 0.21518689822490944 + 5.30628884723333e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2688045180950411, 1.0e-7), DoubleNear(0.1646072676360431, 1.0e-7), DoubleNear(0.3514013160440058, 1.0e-7), DoubleNear(0.21518689822490944, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.6202058341390468 + -1.8584749895706604e-17i, 0.3625746500556671 + -0.08901295262843001i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.362574650055667 + 0.08901295262842998i, 0.37979416586095255 + 9.05478220614847e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.6202058341390468, 1.0e-7), DoubleNear(0.37979416586095255, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.2776215257157513 + -8.509008384399016e-18i, -0.1150507115251681 + 0.1430446137058718i, 0.006533176523095051 + 0.019510019344328278i, -0.012759996829756443 + -0.00471903571612001i }, { -0.1150507115251681 + -0.14304461370587182i, 0.20060276179912823 + 3.584549976818617e-18i, 0.007345095333456779 + -0.011451479892478626i, 0.004720719153441835 + 0.01409747948447578i }, { 0.006533176523095047 + -0.019510019344328278i, 0.007345095333456779 + 0.011451479892478626i, 0.30290425050198877 + -9.466724822231746e-18i, -0.12552826894241917 + 0.1560715488152988i }, { -0.012759996829756445 + 0.004719035716120011i, 0.0047207191534418365 + -0.01409747948447578i, -0.1255282689424192 + -0.1560715488152988i, 0.21887146198313112 + 4.861215540254011e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2776215257157513, 1.0e-7), DoubleNear(0.20060276179912823, 1.0e-7), DoubleNear(0.30290425050198877, 1.0e-7), DoubleNear(0.21887146198313112, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.25160671333345463 + -7.684567890521403e-18i, -0.10426976553382068 + 0.12964047013932983i, -0.001794931829609173 + 0.0004989570216518059i, 0.00048676005712918965 + -0.0011316150278562922i }, { -0.1042697655338207 + -0.12964047013932983i, 0.18180507239762955 + 3.440090771278807e-18i, 0.0010009357085597034 + 0.0007180638076220606i, -0.001296975374414683 + 0.00036053456699500035i }, { -0.001794931829609173 + -0.0004989570216518073i, 0.0010009357085597034 + -0.0007180638076220614i, 0.3289190628842854 + -1.0291165316109359e-17i, -0.13630921493376658 + 0.1694756923818408i }, { 0.00048676005712918987 + 0.0011316150278562918i, -0.0012969753744146834 + -0.00036053456699499975i, -0.1363092149337666 + -0.1694756923818408i, 0.2376691513846298 + 5.005674745793822e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.25160671333345463, 1.0e-7), DoubleNear(0.18180507239762955, 1.0e-7), DoubleNear(0.3289190628842854, 1.0e-7), DoubleNear(0.2376691513846298, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.58052577621774 + -1.7975733206630762e-17i, -0.24057898046758724 + 0.2991161625211706i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.2405789804675873 + -0.2991161625211706i, 0.41947422378225935 + 8.445765517072629e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.58052577621774, 1.0e-7), DoubleNear(0.41947422378225935, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.20742311518187662 + -2.2242897169124093e-18i, 0.023491371208409353 + 5.501914309765732e-05i, -0.0017438763255051737 + -0.0011568932268073771i, 0.001286137717893369 + -0.00048351658983823703i }, { 0.02349137120840935 + -5.501914309765743e-05i, 0.22598867054920757 + -2.0201874023301874e-18i, 0.0023884628706389386 + 0.0001262798898594571i, -0.0013480308785186823 + 0.0020163848154541833i }, { -0.0017438763255051741 + 0.0011568932268073767i, 0.0023884628706389395 + -0.00012627988985945644i, 0.27080117233300294 + -2.7001686906679894e-18i, -0.012237475531872467 + 0.033552479685706404i }, { 0.001286137717893369 + 0.00048351658983823736i, -0.0013480308785186823 + -0.0020163848154541838i, -0.012237475531872467 + -0.033552479685706404i, 0.2957870419359123 + -2.5853218796475478e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.20742311518187662, 1.0e-7), DoubleNear(0.22598867054920757, 1.0e-7), DoubleNear(0.27080117233300294, 1.0e-7), DoubleNear(0.2957870419359123, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.47822428751487955 + -4.924458407580399e-18i, 0.011253895676536885 + 0.03360749882880406i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.011253895676536882 + -0.03360749882880406i, 0.5217757124851199 + -4.605509281977735e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.47822428751487955, 1.0e-7), DoubleNear(0.5217757124851199, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.4334117857310842 + -4.244477119242596e-18i, -0.003091907204023856 + 0.0008594915886468062i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0030919072040238565 + -0.0008594915886468071i, 0.5665882142689153 + -5.285490570315537e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.4334117857310842, 1.0e-7), DoubleNear(0.5665882142689153, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.06111212562622396 + -1.5176482597802484e-18i, 0.006493838267298102 + -0.04471634076148595i, -2.996024625370221e-06 + 0.003297060493622055i, -0.00186051713459638 + 0.008214404550448097i, -0.024953963390076647 + 0.0031740955982530236i, 0.005585288553517443 + 0.0012954086705350915i, 0.004552212124399758 + 0.0010310508334169073i, 0.005510758856834708 + -0.00167853177132107i }, { 0.006493838267298102 + 0.04471634076148595i, 0.06736953365975953 + -5.461266135526455e-19i, -0.00013426736394670392 + 0.000592806389616906i, -0.0014179491290969987 + 0.0029765814522804404i, -0.010185171383038127 + -0.0009352994891255245i, -0.026538361052231556 + -0.000396594301478103i, 0.004249693860756033 + 0.003889220252874466i, -0.003286747858946629 + -0.000744430186158119i }, { -2.996024625371088e-06 + -0.0032970604936220557i, -0.00013426736394670348 + -0.000592806389616906i, 0.19150094509181842 + 1.471695339409099e-18i, 0.027348340695124828 + 0.1280145710187566i, 0.003286747858946629 + -0.0007444301861581186i, -0.00551075885683471 + -0.00167853177132107i, -0.06672695802781622 + -0.015203747205388946i, -0.028693119727615967 + 0.006852126436610621i }, { -0.0018605171345963797 + -0.008214404550448095i, -0.0014179491290969987 + -0.002976581452280442i, 0.027348340695124828 + -0.12801457101875663i, 0.1958721995982664 + -4.0382927438741e-18i, -0.004249693860756035 + 0.003889220252874466i, -0.004552212124399757 + 0.001031050833416907i, 0.015734575998028553 + -0.009490333418108867i, -0.07833446261130123 + -0.005144590716986953i }, { -0.024953963390076647 + -0.003174095598253022i, -0.010185171383038127 + 0.0009352994891255245i, 0.003286747858946629 + 0.0007444301861581192i, -0.004249693860756035 + -0.0038892202528744662i, 0.06770691975516675 + -5.448518225108935e-19i, 0.008279108801813526 + 0.04511898951111441i, 0.0014179491290970004 + -0.0029765814522804386i, 0.00013426736394670478 + -0.0005928063896169077i }, { 0.005585288553517443 + -0.0012954086705350932i, -0.026538361052231556 + 0.000396594301478103i, -0.00551075885683471 + 0.0016785317713210717i, -0.004552212124399757 + -0.0010310508334169081i, 0.008279108801813524 + -0.04511898951111442i, 0.06578722010211527 + -1.76545144377742e-18i, 0.001860517134596383 + -0.008214404550448093i, 2.996024625368486e-06 + -0.0032970604936220565i }, { 0.004552212124399757 + -0.001031050833416907i, 0.004249693860756033 + -0.0038892202528744654i, -0.06672695802781622 + 0.015203747205388939i, 0.015734575998028553 + 0.009490333418108857i, 0.0014179491290969987 + 0.0029765814522804412i, 0.001860517134596383 + 0.008214404550448093i, 0.1616218457550732 + -1.9629356874226177e-18i, 0.014269215165512427 + -0.1250647135943962i }, { 0.00551075885683471 + 0.0016785317713210691i, -0.0032867478589466296 + 0.0007444301861581186i, -0.028693119727615964 + -0.006852126436610616i, -0.07833446261130123 + 0.0051445907169869465i, 0.00013426736394670435 + 0.0005928063896169077i, 2.9960246253676187e-06 + 0.0032970604936220574i, 0.014269215165512427 + 0.12506471359439622i, 0.1890292104115759 + -6.263564580493073e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.06111212562622396, 1.0e-7), DoubleNear(0.06736953365975953, 1.0e-7), DoubleNear(0.19150094509181842, 1.0e-7), DoubleNear(0.1958721995982664, 1.0e-7), DoubleNear(0.06770691975516675, 1.0e-7), DoubleNear(0.06578722010211527, 1.0e-7), DoubleNear(0.1616218457550732, 1.0e-7), DoubleNear(0.1890292104115759, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.0798943234937612 + -2.565956350720634e-18i, 0.009162267959690367 + 0.00024972510362836686i, 0.0008775621704264626 + 0.00019876297115936008i, -0.0010706301789381208 + 0.004726959644810933i, 0.04670652029966286 + -0.011466563584173313i, 0.0053921370679506225 + -0.0011689934081532472i, 0.0005415529124243271 + -9.75157739517053e-06i, 5.252654954101285e-05 + 0.0029170568750879616i }, { 0.009162267959690367 + -0.0002497251036283658i, 0.08258459553813127 + -2.9566984653774043e-18i, 0.0010706301789381247 + -0.004726959644810935i, -0.0008775621704264612 + -0.00019876297115936008i, 0.005320455159797472 + -0.0014609738671370314i, 0.04827926339776041 + -0.011852675814761286i, -5.252654954101318e-05 + -0.0029170568750879625i, -0.0005415529124243266 + 9.75157739517118e-06i }, { 0.0008775621704264626 + -0.00019876297115935812i, 0.0010706301789381277 + 0.004726959644810937i, 0.21900881505070477 + -4.386949453198496e-18i, 0.025811450947374914 + 0.0018295187844667095i, 0.0004844993409736343 + -0.00024214672992439506i, 0.001304315362544981 + 0.0026097396969686076i, 0.12803337231799233 + -0.03143250225367339i, 0.01535204627151796 + -0.002634958004982373i }, { -0.0010706301789381212 + -0.004726959644810931i, -0.0008775621704264613 + 0.00019876297115935877i, 0.025811450947374918 + -0.0018295187844666804i, 0.2387181000564497 + -8.675145626410071e-18i, -0.0013043153625449787 + -0.002609739696968606i, -0.0004844993409736352 + 0.00024214672992439474i, 0.014826895233167534 + -0.004774045051685535i, 0.1395554940402515 + -0.034261210975822035i }, { 0.04670652029966286 + 0.01146656358417331i, 0.005320455159797469 + 0.001460973867137029i, 0.00048449934097363485 + 0.00024214672992439485i, -0.0013043153625449783 + 0.0026097396969686068i, 0.0489247218876295 + 5.034562684294923e-19i, 0.005610679109421259 + 0.0001529236460000974i, 0.0005373909340451684 + 0.00012171607018225661i, -0.0006556195917115533 + 0.002894638516020254i }, { 0.005392137067950619 + 0.0011689934081532444i, 0.04827926339776041 + 0.011852675814761283i, 0.0013043153625449796 + -0.0026097396969686076i, -0.00048449934097363485 + -0.0002421467299243942i, 0.005610679109421259 + -0.00015292364600009794i, 0.050572158223743516 + 6.451204080473388e-19i, 0.0006556195917115557 + -0.002894638516020254i, -0.0005373909340451687 + -0.00012171607018225683i }, { 0.0005415529124243272 + 9.751577395170205e-06i, -5.2526549541011876e-05 + 0.0029170568750879642i, 0.12803337231799233 + 0.031432502253673375i, 0.014826895233167528 + 0.0047740450516855215i, 0.0005373909340451678 + -0.00012171607018225683i, 0.0006556195917115555 + 0.002894638516020254i, 0.1341139757961869 + 3.895709105184977e-18i, 0.015806104913262346 + 0.0011203386398936865i }, { 5.2526549541013394e-05 + -0.0029170568750879625i, -0.0005415529124243267 + -9.751577395170422e-06i, 0.015352046271517955 + 0.0026349580049823593i, 0.13955549404025147 + 0.03426121097582202i, -0.0006556195917115542 + -0.002894638516020253i, -0.0005373909340451685 + 0.00012171607018225715i, 0.015806104913262342 + -0.0011203386398936973i, 0.14618330995339263 + 4.0104964244866625e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.0798943234937612, 1.0e-7), DoubleNear(0.08258459553813127, 1.0e-7), DoubleNear(0.21900881505070477, 1.0e-7), DoubleNear(0.2387181000564497, 1.0e-7), DoubleNear(0.0489247218876295, 1.0e-7), DoubleNear(0.050572158223743516, 1.0e-7), DoubleNear(0.1341139757961869, 1.0e-7), DoubleNear(0.14618330995339263, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.07478277631166017 + -2.278837325874506e-18i, 0.008576076564319617 + 0.00023374797792116665i, 0.0008214167492850956 + 0.00018604634423635994i, -0.0010021324880520994 + 0.004424534188336226i, -0.03099115460266285 + 0.038531858514122136i, -0.003674499293221325 + 0.0043219584107688815i, -0.0004362684362977992 + 0.00034613482172977635i, -0.001864443784290932 + -0.002349945522016189i }, { 0.008576076564319616 + -0.00023374797792116773i, 0.07730092783624688 + -2.6102368456773157e-18i, 0.0010021324880521024 + -0.004424534188336229i, -0.0008214167492850942 + -0.00018604634423635973i, -0.0034336217955556964 + 0.004515696062113211i, -0.03203471606240542 + 0.03982933719902845i, 0.0018644437842909338 + 0.00234994552201619i, 0.0004362684362977993 + -0.0003461348217297756i }, { 0.0008214167492850953 + -0.00018604634423635864i, 0.0010021324880521041 + 0.004424534188336228i, 0.20499688225656656 + -5.039339971153249e-18i, 0.024160063920281603 + 0.0017124682710084917i, -0.0002445475142686639 + 0.0005003358637841674i, -0.0026950426040015458 + -0.0013172471081166234i, -0.0849539210018143 + 0.10562473409688823i, -0.010894659191264255 + 0.011738809910866916i }, { -0.0010021324880520976 + -0.004424534188336224i, -0.0008214167492850946 + 0.00018604634423635843i, 0.024160063920281603 + -0.0017124682710084674i, 0.22344518981326647 + -8.047319063925693e-18i, 0.002695042604001543 + 0.001317247108116623i, 0.0002445475142686638 + -0.0005003358637841676i, -0.009129959125745725 + 0.013158157294221642i, -0.09259918880070471 + 0.11513023271113176i }, { -0.030991154602662857 + -0.03853185851412214i, -0.0034336217955556942 + -0.004515696062113209i, -0.0002445475142686639 + -0.0005003358637841667i, 0.002695042604001543 + -0.001317247108116623i, 0.05403626906973054 + 2.163372435833642e-19i, 0.00619687050479201 + 0.0001689007717072975i, 0.0005935363551865353 + 0.00013443269710525685i, -0.0007241172825975749 + 0.0031970639724949595i }, { -0.003674499293221323 + -0.004321958410768881i, -0.032034716062405426 + -0.03982933719902847i, -0.002695042604001545 + 0.0013172471081166225i, 0.00024454751426866337 + 0.0005003358637841663i, 0.00619687050479201 + -0.0001689007717072961i, 0.0558558259256279 + 2.9865878834725035e-19i, 0.0007241172825975771 + -0.0031970639724949613i, -0.0005935363551865355 + -0.00013443269710525696i }, { -0.00043626843629779983 + -0.00034613482172977527i, 0.001864443784290933 + -0.0023499455220161907i, -0.08495392100181431 + -0.10562473409688825i, -0.009129959125745712 + -0.013158157294221633i, 0.0005935363551865346 + -0.00013443269710525663i, 0.0007241172825975771 + 0.0031970639724949595i, 0.14812590859032507 + 4.5480996231397305e-18i, 0.017457491940355657 + 0.0012373891533519047i }, { -0.001864443784290932 + 0.002349945522016187i, 0.0004362684362977997 + 0.0003461348217297758i, -0.01089465919126424 + -0.011738809910866909i, -0.09259918880070472 + -0.11513023271113179i, -0.0007241172825975762 + -0.0031970639724949613i, -0.0005935363551865352 + 0.0001344326971052574i, 0.017457491940355653 + -0.0012373891533519104i, 0.16145622019657585 + 3.3826698620022836e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.07478277631166017, 1.0e-7), DoubleNear(0.07730092783624688, 1.0e-7), DoubleNear(0.20499688225656656, 1.0e-7), DoubleNear(0.22344518981326647, 1.0e-7), DoubleNear(0.05403626906973054, 1.0e-7), DoubleNear(0.0558558259256279, 1.0e-7), DoubleNear(0.14812590859032507, 1.0e-7), DoubleNear(0.16145622019657585, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.07203219014322976 + -1.1579573734338042e-18i, 0.008096837265141923 + -4.448722076328001e-05i, -0.0015869623063587645 + -0.0014192147821791604i, -0.02198906254751474 + -0.016866790755732754i, -0.005078397496887663 + 0.009346070208579471i, -0.0007122528078219745 + 0.0013750386194596982i, -0.001158332414139548 + -0.0034283729453093706i, -0.00437837302653811 + -0.04084994810484746i }, { 0.008096837265141921 + 4.448722076328109e-05i, 0.07155293225280444 + -1.1665869860270641e-18i, -0.013919308530703774 + -0.021584568768099038i, -0.0024628199026188215 + -0.00291736822158377i, -0.00022359382867303645 + 0.0010299357899422547i, -0.003219512504561384 + 0.011978215659185016i, 0.0017202590459911207 + -0.029986090280658108i, 0.0008585476457242649 + -0.004560586714909946i }, { -0.001586962306358764 + 0.001419214782179162i, -0.013919308530703774 + 0.021584568768099038i, 0.16102970913344022 + -5.182772440306613e-19i, 0.018870470821042977 + 0.0011677178123304403i, 0.00028831740213735614 + 0.0023572933629977533i, -0.008664970634231817 + 0.008846300655868913i, 0.012527412394648768 + 0.0013744694930161172i, 0.00021751504331466755 + 0.00018183757787369748i }, { -0.02198906254751474 + 0.016866790755732754i, -0.0024628199026188206 + 0.00291736822158377i, 0.018870470821042977 + -0.0011677178123304334i, 0.17360945598540511 + -2.0816368040888692e-18i, 0.00808340325706771 + 0.005386979286858252i, -0.0003539071559089946 + -0.0007520497343771666i, 0.001987557267418026 + 0.0012034755350587671i, 0.007024393283337163 + 0.010908743468023459i }, { -0.005078397496887662 + -0.009346070208579471i, -0.00022359382867303634 + -0.0010299357899422549i, 0.0002883174021373557 + -0.002357293362997754i, 0.008083403257067707 + -0.005386979286858254i, 0.05678685523816096 + -9.045427088573374e-19i, 0.0066761098039697046 + 0.00044713597039174415i, 0.0030019154108303953 + 0.0017396938235207772i, 0.020262812776865067 + 0.024488388916563936i }, { -0.0007122528078219744 + -0.0013750386194596982i, -0.0032195125045613835 + -0.011978215659185016i, -0.008664970634231817 + -0.008846300655868911i, -0.0003539071559089933 + 0.0007520497343771687i, 0.006676109803969704 + -0.0004471359703917449i, 0.061603821509070344 + -1.1449910713030012e-18i, 0.015645558301353453 + 0.013962970607267845i, 0.0010478667981471913 + 0.0025968891802421535i }, { -0.0011583324141395497 + 0.0034283729453093714i, 0.0017202590459911207 + 0.029986090280658108i, 0.012527412394648767 + -0.0013744694930161137i, 0.001987557267418027 + -0.0012034755350587665i, 0.003001915410830394 + -0.0017396938235207772i, 0.015645558301353453 + -0.013962970607267845i, 0.1920930817134514 + 2.7036896017142154e-20i, 0.02274708503959428 + 0.0017821396120299557i }, { -0.004378373026538106 + 0.04084994810484745i, 0.0008585476457242659 + 0.004560586714909946i, 0.0002175150433146682 + -0.00018183757787369683i, 0.007024393283337163 + -0.010908743468023457i, 0.020262812776865063 + -0.024488388916563943i, 0.0010478667981471909 + -0.002596889180242154i, 0.02274708503959428 + -0.0017821396120299448i, 0.21129195402443718 + -2.583012397834539e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.07203219014322976, 1.0e-7), DoubleNear(0.07155293225280444, 1.0e-7), DoubleNear(0.16102970913344022, 1.0e-7), DoubleNear(0.17360945598540511, 1.0e-7), DoubleNear(0.05678685523816096, 1.0e-7), DoubleNear(0.061603821509070344, 1.0e-7), DoubleNear(0.1920930817134514, 1.0e-7), DoubleNear(0.21129195402443718, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.05617748923240477 + -4.321712962529918e-19i, 0.007980034272360673 + 0.002706673990636047i, 0.001179907613813055 + -0.0019255998354042367i, 0.0033257991092509234 + -0.014683798836839871i, -8.350780061013052e-05 + 0.0012108720215668477i, -0.0013644176008364801 + 0.00013050055391574354i, -0.00865581613373121 + 0.005770606028494146i, 0.0037882772334014527 + 0.008397244705807308i }, { 0.007980034272360673 + -0.0027066739906360486i, 0.08533630932871411 + -1.964479042109101e-18i, 0.005052048879900601 + -0.022305396997671062i, -0.00023504549065857543 + -0.002246078876745853i, -0.0030576656913098047 + 0.00029245230064495285i, -0.0003115232108378775 + -0.0011730890394532655i, -0.006294339746901391 + -0.006726518430577139i, -0.01939772105414793 + 0.012931952842425041i }, { 0.0011799076138130555 + 0.0019255998354042372i, 0.005052048879900602 + 0.022305396997671062i, 0.1760216825414868 + -4.23113415229768e-18i, 0.016460274300695743 + -0.005583008143553806i, 0.002291154215017373 + 0.0005066079443408083i, -4.9491454613634455e-05 + 0.0009258939422557646i, -0.003827890676858459 + -0.007726795201675086i, -0.020874679629638904 + 0.006360286007017229i }, { 0.0033257991092509234 + 0.014683798836839871i, -0.0002350454906585756 + 0.0022460788767458533i, 0.016460274300695743 + 0.005583008143553813i, 0.1158763046284785 + 2.383307371417176e-18i, 0.00034549404558163976 + -0.0008604434094426703i, 0.0010223783280445143 + 0.00022606290738281696i, -0.00931487715594617 + 0.0028381409383610124i, 0.0011310144842826115 + 0.008548503808208312i }, { -8.350780061013073e-05 + -0.0012108720215668477i, -0.0030576656913098047 + -0.000292452300644952i, 0.002291154215017374 + -0.000506607944340808i, 0.0003454940455816396 + 0.0008604434094426703i, 0.07264155614898593 + -1.63032878603815e-18i, 0.006792912796750955 + -0.002304025241007583i, 0.00023504549065857553 + 0.0022460788767458533i, -0.005052048879900597 + 0.022305396997671055i }, { -0.0013644176008364801 + -0.00013050055391574398i, -0.0003115232108378775 + 0.0011730890394532657i, -4.9491454613634434e-05 + -0.0009258939422557642i, 0.0010223783280445143 + -0.00022606290738281723i, 0.006792912796750953 + 0.0023040252410075845i, 0.04782044443316068 + -3.4709901522096444e-19i, -0.0033257991092509216 + 0.01468379883683987i, -0.0011799076138130546 + 0.0019255998354042363i }, { -0.00865581613373121 + -0.005770606028494146i, -0.006294339746901391 + 0.006726518430577139i, -0.0038278906768584604 + 0.007726795201675086i, -0.00931487715594617 + -0.0028381409383610133i, 0.00023504549065857423 + -0.0022460788767458524i, -0.0033257991092509216 + -0.01468379883683987i, 0.17710110830540482 + 3.739893804284161e-18i, 0.025157281559941517 + 0.008532865567914202i }, { 0.003788277233401453 + -0.008397244705807307i, -0.019397721054147936 + -0.012931952842425041i, -0.020874679629638904 + -0.00636028600701723i, 0.001131014484282612 + -0.008548503808208312i, -0.0050520488799006 + -0.02230539699767106i, -0.0011799076138130542 + -0.0019255998354042372i, 0.025157281559941517 + -0.008532865567914192i, 0.2690251053813638 + -7.047956573340585e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.05617748923240477, 1.0e-7), DoubleNear(0.08533630932871411, 1.0e-7), DoubleNear(0.1760216825414868, 1.0e-7), DoubleNear(0.1158763046284785, 1.0e-7), DoubleNear(0.07264155614898593, 1.0e-7), DoubleNear(0.04782044443316068, 1.0e-7), DoubleNear(0.17710110830540482, 1.0e-7), DoubleNear(0.2690251053813638, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.12881904538139072 + -2.0625000822911416e-18i, 0.014772947069111628 + 0.0004026487496284637i, 0.0014149531044716306 + 0.0003204790413416166i, -0.0017262497706496734 + 0.007621598160831184i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.014772947069111626 + -0.00040264874962846415i, 0.1331567537618748 + -2.3115780573300654e-18i, 0.0017262497706496795 + -0.007621598160831192i, -0.0014149531044716302 + -0.0003204790413416166i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0014149531044716297 + -0.0003204790413416153i, 0.0017262497706496804 + 0.007621598160831192i, 0.35312279084689163 + -4.912403480135186e-19i, 0.041617555860637256 + 0.002949857424360396i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001726249770649677 + -0.007621598160831187i, -0.0014149531044716297 + 0.00032047904134161614i, 0.041617555860637256 + -0.0029498574243603786i, 0.38490141000984235 + -4.664649201923409e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12881904538139072, 1.0e-7), DoubleNear(0.1331567537618748, 1.0e-7), DoubleNear(0.35312279084689163, 1.0e-7), DoubleNear(0.38490141000984235, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.1566721002391096 + -3.2814055604479334e-18i, 0.020989116832472423 + 0.05166204837901697i, -0.056861042342620696 + -0.0074608601094058626i, -0.014331611708476053 + 0.0050531488073044745i, 0.09159109571508176 + -0.022485835297147358i, 0.01968493761834426 + 0.027189434412961296i, -0.03431197280851614 + 0.0037991427933528193i, -0.007653077644963371 + 0.005010985971935409i }, { 0.02098911683247243 + -0.05166204837901695i, 0.16326405875550254 + -6.392098202857146e-18i, 0.003441773118215213 + -0.006466038353658808i, -0.06504273707875857 + -0.0034366752764959166i, 0.004855694770499271 + -0.03321421895861132i, 0.09544477931607608 + -0.023431923932322494i, 0.001084057068204411 + -0.004274039093059496i, -0.03851746457970909 + 0.007325946465808073i }, { -0.056861042342620696 + 0.007460860109405859i, 0.0034417731182152136 + 0.006466038353658798i, 0.14223103830535636 + -3.671500243471197e-18i, 0.01398460207459286 + -0.04958280449092189i, -0.032170383191231125 + 0.012522436236850624i, 0.002940089804390522 + 0.0032861013128392185i, 0.08314879690257343 + -0.020413230540699337i, 0.001059245721124322 + -0.03099338582609691i }, { -0.014331611708476051 + -0.005053148807304477i, -0.06504273707875856 + 0.0034366752764959027i, 0.013984602074592858 + 0.0495828044909219i, 0.15803863683907837 + -5.239745888930328e-18i, -0.009103549958025032 + -0.0008971934086438311i, -0.0375309901006011 + 0.011344132903735413i, 0.015291655622465733 + 0.026979200039788744i, 0.09238997812193582 + -0.022681962858260827i }, { 0.09159109571508176 + 0.022485835297147358i, 0.004855694770499271 + 0.033214218958611305i, -0.03217038319123113 + -0.01252243623685062i, -0.00910354995802504 + 0.0008971934086438298i, 0.09594097047893278 + 3.2354526400767844e-18i, 0.01285306212995051 + 0.031636181878253684i, -0.034819879075272175 + -0.004568791497730056i, -0.008776219465622471 + 0.0030943862998412345i }, { 0.01968493761834425 + -0.027189434412961302i, 0.09544477931607606 + 0.023431923932322477i, 0.0029400898043905224 + -0.0032861013128392185i, -0.037530990100601104 + -0.011344132903735416i, 0.012853062129950505 + -0.03163618187825369i, 0.0999776745025234 + 1.8076788454304004e-18i, 0.0021076314967752125 + -0.003959594553575585i, -0.039830086584774216 + -0.00210450974196914i }, { -0.03431197280851614 + -0.0037991427933528193i, 0.0010840570682044113 + 0.004274039093059493i, 0.08314879690257342 + 0.020413230540699323i, 0.015291655622465726 + -0.02697920003978876i, -0.034819879075272175 + 0.004568791497730054i, 0.002107631496775212 + 0.003959594553575585i, 0.08709772720488362 + 1.1637127335376852e-18i, 0.008563721892733092 + -0.0303629195923599i }, { -0.007653077644963374 + -0.005010985971935408i, -0.0385174645797091 + -0.007325946465808072i, 0.001059245721124323 + 0.030993385826096908i, 0.09238997812193583 + 0.022681962858260823i, -0.008776219465622471 + -0.00309438629984123i, -0.039830086584774216 + 0.002104509741969145i, 0.008563721892733096 + 0.030362919592359896i, 0.09677779367461276 + 2.8479379871036006e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1566721002391096, 1.0e-7), DoubleNear(0.16326405875550254, 1.0e-7), DoubleNear(0.14223103830535636, 1.0e-7), DoubleNear(0.15803863683907837, 1.0e-7), DoubleNear(0.09594097047893278, 1.0e-7), DoubleNear(0.0999776745025234, 1.0e-7), DoubleNear(0.08709772720488362, 1.0e-7), DoubleNear(0.09677779367461276, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.14664839896133852 + -5.204412294431183e-18i, 0.019646257211060246 + 0.04835676977766613i, -0.053223138070479924 + -0.006983522836861572i, -0.013414691629052046 + 0.004729854142337054i, -0.060773395006133206 + 0.07556065231586997i, -0.03305756389094103 + -0.00991706060745387i, 0.0256547658282388 + -0.024529164071900103i, 0.0031221990294258133 + -0.008872051474384418i }, { 0.01964625721106025 + -0.048356769777666106i, 0.1528186115325189 + -3.141227402169107e-18i, 0.0032215724216636253 + -0.006052348636033465i, -0.06088137736141858 + -0.003216800734010542i, 0.01677413006777833 + 0.03016254601264316i, -0.06333042780373649 + 0.07873985706756237i, 0.0017834052025898581 + 0.004168104748264996i, 0.026887654994272866 + -0.030036063924670762i }, { -0.05322313807047993 + 0.006983522836861562i, 0.0032215724216636253 + 0.006052348636033454i, 0.13313125960688824 + -2.1137650025965723e-18i, 0.013089883273540968 + -0.046410553528736465i, 0.01845823937785254 + -0.030317326709950163i, -0.004453545411542913 + -0.0008482715228385609i, -0.05517168059834395 + 0.06859594029514039i, 0.01848840540645545 + 0.025977828929089664i }, { -0.013414691629052046 + -0.004729854142337052i, -0.060881377361418576 + 0.003216800734010535i, 0.013089883273540973 + 0.04641055352873647i, 0.14792750611699446 + -7.5163285074339e-18i, 0.007996317899937693 + -0.004951800095582437i, 0.023572738997186732 + -0.032702249209319946i, -0.029337710989079748 + -0.012488692656308305i, -0.06130347705937364 + 0.07621971284259786i }, { -0.060773395006133206 + -0.07556065231586999i, 0.01677413006777833 + -0.030162546012643152i, 0.018458239377852546 + 0.03031732670995016i, 0.007996317899937691 + 0.004951800095582435i, 0.10596467175670388 + 5.158459374060034e-18i, 0.014195921751362686 + 0.03494146047960453i, -0.03845778334741295 + -0.005046128770274348i, -0.00969313954504648 + 0.0034176809648086555i }, { -0.033057563890941014 + 0.009917060607453874i, -0.06333042780373649 + -0.07873985706756238i, -0.004453545411542914 + 0.0008482715228385579i, 0.023572738997186725 + 0.03270224920931994i, 0.01419592175136268 + -0.03494146047960454i, 0.11042312172550707 + -1.4431919552576383e-18i, 0.0023278321933268005 + -0.004373284271200927i, -0.0439914463021142 + -0.002324384284454509i }, { 0.025654765828238797 + 0.024529164071900096i, 0.0017834052025898607 + -0.004168104748264997i, -0.05517168059834396 + -0.0685959402951404i, -0.029337710989079734 + 0.012488692656308312i, -0.038457783347412955 + 0.005046128770274348i, 0.0023278321933268 + 0.004373284271200929i, 0.09619750590335172 + -3.940225073369391e-19i, 0.009458440693784983 + -0.03353517055454533i }, { 0.0031221990294258125 + 0.008872051474384416i, 0.02688765499427287 + 0.03003606392467076i, 0.018488405406455456 + -0.02597782892908966i, -0.06130347705937365 + -0.07621971284259786i, -0.009693139545046477 + -0.0034176809648086555i, -0.04399144630211419 + 0.0023243842844545178i, 0.009458440693784981 + 0.03353517055454533i, 0.10688892439669667 + 5.124520605607173e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.14664839896133852, 1.0e-7), DoubleNear(0.1528186115325189, 1.0e-7), DoubleNear(0.13313125960688824, 1.0e-7), DoubleNear(0.14792750611699446, 1.0e-7), DoubleNear(0.10596467175670388, 1.0e-7), DoubleNear(0.11042312172550707, 1.0e-7), DoubleNear(0.09619750590335172, 1.0e-7), DoubleNear(0.10688892439669667, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.1217944170836825 + -2.6752503898287516e-19i, 0.016171001177996507 + 0.03331922703711311i, -0.04478846626493055 + -0.00548295927879577i, -0.009948983517416115 + 0.0025693280874838622i, 0.001815047514778267 + 0.007283674829540093i, -0.00021218021329038033 + 0.006973829798050392i, 0.00037662670175679473 + 0.0010862985941548797i, -0.003778898587131224 + -0.0006543485263431256i }, { 0.016171001177996507 + -0.03331922703711311i, 0.12486295583741319 + -2.167105511980276e-18i, 0.0015521174863043037 + -0.0036534644782480977i, -0.04920830843501554 + -0.002878922024652033i, -0.0021831456456278217 + -0.002237977165006967i, -0.000441659165809767 + 0.013507985031403822i, 0.004154300872043089 + 0.0006754264995553246i, 0.0018309168568700165 + -0.002978038086316028i }, { -0.04478846626493056 + 0.005482959278795767i, 0.0015521174863043032 + 0.003653464478248097i, 0.11126748219298749 + -1.4087095784815898e-18i, 0.010796306908188395 + -0.03219599644554595i, -0.003919683763946434 + -0.003248054324641159i, -0.0026754000531647847 + -0.0018097772137685188i, 0.00563396738298284 + 0.0034368648720554916i, -0.00028255755121692726 + -0.005416953600716996i }, { -0.009948983517416115 + -0.0025693280874838614i, -0.04920830843501553 + 0.0028789220246520295i, 0.010796306908188396 + 0.03219599644554595i, 0.12029943240079635 + -1.081118278135657e-18i, 0.0019047963667722452 + 0.0006085096405145844i, -0.0027118504786383573 + -0.00807156569843983i, 0.0039471090843728115 + 0.004471388490007989i, 0.0042465399445855475 + 0.009378974095804654i }, { 0.001815047514778267 + -0.007283674829540095i, -0.0021831456456278204 + 0.002237977165006966i, -0.003919683763946434 + 0.003248054324641159i, 0.0019047963667722452 + -0.0006085096405145838i, 0.1308186536343599 + 2.2157211861172617e-19i, 0.017671177784426426 + 0.04997900322015754i, -0.04689245515296232 + -0.00654669232834015i, -0.01315884765668241 + 0.005578207019661848i }, { -0.0002121802132903786 + -0.006973829798050392i, -0.00044165916580976745 + -0.01350798503140382i, -0.0026754000531647843 + 0.0018097772137685188i, -0.0027118504786383573 + 0.00807156569843983i, 0.017671177784426426 + -0.04997900322015754i, 0.13837877742061275 + -2.4173138454464692e-18i, 0.003997287128686122 + -0.006772168428986291i, -0.055664515228517245 + -0.00266226299381302i }, { 0.0003766267017567943 + -0.00108629859415488i, 0.004154300872043089 + -0.0006754264995553251i, 0.005633967382982838 + -0.0034368648720554916i, 0.0039471090843728115 + -0.004471388490007987i, -0.04689245515296232 + 0.006546692328340143i, 0.003997287128686122 + 0.006772168428986288i, 0.11806128331725246 + -1.0990779314519214e-18i, 0.011752017059137554 + -0.04774972763773584i }, { -0.0037788985871312244 + 0.0006543485263431257i, 0.0018309168568700165 + 0.0029780380863160274i, -0.00028255755121692726 + 0.005416953600716996i, 0.0042465399445855475 + -0.009378974095804654i, -0.013158847656682408 + -0.005578207019661846i, -0.05566451522851724 + 0.0026622629938130218i, 0.011752017059137556 + 0.04774972763773584i, 0.1345169981128948 + -1.31068962369107e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1217944170836825, 1.0e-7), DoubleNear(0.12486295583741319, 1.0e-7), DoubleNear(0.11126748219298749, 1.0e-7), DoubleNear(0.12029943240079635, 1.0e-7), DoubleNear(0.1308186536343599, 1.0e-7), DoubleNear(0.13837877742061275, 1.0e-7), DoubleNear(0.11806128331725246, 1.0e-7), DoubleNear(0.1345169981128948, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.09147399861136044 + -1.8906780381486908e-18i, -0.0061573090339513215 + 0.02434630098439565i, -0.04825345237690836 + 0.027566568087559043i, -0.008331439902310068 + -0.004260625943209171i, -0.0037193038584737185 + -0.0018329959356310015i, -0.00965709472549265 + 0.008606946149133097i, 0.002363177988901016 + 0.010959564805874861i, 0.020658590304368948 + -0.0059860209651709335i }, { -0.006157309033951321 + -0.024346300984395657i, 0.07363373248389368 + 1.0700756337616827e-19i, 0.0007214108926989285 + 0.011674508763516323i, -0.03693525727096468 + 0.029616281477501664i, -0.004419553771848459 + 0.007820260868808436i, 0.002592019483295176 + 0.0037688488468225253i, 0.012882529090098084 + -0.0033377743789535863i, -0.004864854150112925 + -0.01026414625796967i }, { -0.04825345237690837 + -0.027566568087559046i, 0.0007214108926989285 + -0.011674508763516327i, 0.14072517316253114 + -2.772627410401981e-18i, 0.03059761760700773 + -0.02722263513731341i, 0.0021748252049819 + -0.013593444681070587i, 0.03011761102485557 + -0.00855142800135478i, -0.0001920946189948717 + -0.004682927244477237i, -0.012582002504982733 + -0.002116159588200125i }, { -0.00833143990231007 + 0.004260625943209172i, -0.03693525727096468 + -0.029616281477501664i, 0.030597617607007736 + 0.027222635137313423i, 0.1275788814732989 + 3.118207659319069e-19i, 0.024387518873441812 + -0.006599964842751653i, 0.01025679551362408 + 0.010137689790696212i, -0.007952989075407518 + -0.0046896676298024695i, -0.0017725282098504424 + 0.0036065659219325203i }, { -0.003719303858473719 + 0.0018329959356310017i, -0.004419553771848459 + -0.007820260868808436i, 0.0021748252049818987 + 0.01359344468107059i, 0.024387518873441812 + 0.006599964842751653i, 0.16113907210668194 + 1.8447251177775418e-18i, 0.039999487996374254 + 0.058951929272875i, -0.04342746904098452 + -0.03959621969469496i, -0.014776391271788456 + 0.012408161050354881i }, { -0.00965709472549265 + -0.008606946149133099i, 0.0025920194832951765 + -0.003768848846822526i, 0.03011761102485557 + 0.00855142800135478i, 0.010256795513624078 + -0.010137689790696208i, 0.039999487996374254 + -0.058951929272874994i, 0.18960800077413226 + -4.691426920802914e-18i, 0.004827993722291497 + -0.022100141670750712i, -0.0679375663925681 + -0.03515746649596672i }, { 0.002363177988901016 + -0.010959564805874861i, 0.012882529090098082 + 0.0033377743789535863i, -0.00019209461899487182 + 0.004682927244477237i, -0.007952989075407516 + 0.0046896676298024695i, -0.04342746904098452 + 0.039596219694694956i, 0.004827993722291497 + 0.02210014167075071i, 0.08860359234770881 + 2.648399004684696e-19i, -0.00804929363968178 + -0.05272308894596839i }, { 0.020658590304368948 + 0.005986020965170932i, -0.004864854150112926 + 0.010264146257969668i, -0.012582002504982731 + 0.002116159588200125i, -0.001772528209850442 + -0.0036065659219325194i, -0.014776391271788453 + -0.01240816105035488i, -0.0679375663925681 + 0.03515746649596671i, -0.008049293639681782 + 0.052723088945968374i, 0.12723754904039225 + -2.703628667758634e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.09147399861136044, 1.0e-7), DoubleNear(0.07363373248389368, 1.0e-7), DoubleNear(0.14072517316253114, 1.0e-7), DoubleNear(0.1275788814732989, 1.0e-7), DoubleNear(0.16113907210668194, 1.0e-7), DoubleNear(0.18960800077413226, 1.0e-7), DoubleNear(0.08860359234770881, 1.0e-7), DoubleNear(0.12723754904039225, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.2526130707180424 + -4.595292037114899e-20i, 0.033842178962422934 + 0.08329823025727065i, -0.09168092141789289 + -0.01202965160713592i, -0.023107831174098523 + 0.00814753510714571i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.033842178962422934 + -0.08329823025727065i, 0.2632417332580259 + -4.5844193574267455e-18i, 0.005549404614990425 + -0.010425632907234389i, -0.10487282366353277 + -0.005541185018465053i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.09168092141789289 + 0.01202965160713591i, 0.005549404614990425 + 0.010425632907234382i, 0.22932876551023995 + -2.507787509933511e-18i, 0.02254832396732595 + -0.0799457240832818i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.023107831174098523 + -0.008147535107145706i, -0.10487282366353277 + 0.005541185018465046i, 0.022548323967325954 + 0.0799457240832818i, 0.2548164305136912 + -2.391807901826727e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2526130707180424, 1.0e-7), DoubleNear(0.2632417332580259, 1.0e-7), DoubleNear(0.22932876551023995, 1.0e-7), DoubleNear(0.2548164305136912, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.24411765545020192 + -7.894011095305254e-18i, 0.028563441332674643 + 0.0016981425673301262i, 0.09315735691145743 + -0.005237503518027085i, 0.01093648356401886 + 3.5201668427533705e-05i, -0.08470235735886798 + 0.078737629780995i, -0.01045847557085795 + 0.008623632676041524i, -0.0720054058103243 + 0.17547784669151853i, -0.009645793874459322 + 0.020031225211690585i }, { 0.028563441332674647 + -0.0016981425673301132i, 0.262411633147541 + -1.1513207792185275e-17i, 0.01086361683380141 + -0.001260849393013051i, 0.10013849314487872 + -0.005629997753529311i, -0.009363038859939162 + 0.009802053616706687i, -0.0910498828320973 + 0.08463816344169411i, -0.0072044595880002135 + 0.02103299990479002i, -0.07740143210572936 + 0.18862801318738912i }, { 0.09315735691145743 + 0.005237503518027082i, 0.010863616833801404 + 0.0012608493930130367i, 0.03566200311802481 + 5.758337982774996e-19i, 0.004172699151926576 + 0.00024807368159953476i, -0.034012436885765135 + 0.028229668896782748i, -0.004176061113249043 + 0.0030664661394490724i, -0.031242718245609175 + 0.06541896283001537i, -0.004110682913627633 + 0.0074371356455942735i }, { 0.010936483564018853 + -3.520166842754758e-05i, 0.10013849314487872 + 0.005629997753529308i, 0.004172699151926576 + -0.00024807368159952543i, 0.03833448450197234 + 8.55651882582268e-19i, -0.003783316046720736 + 0.003539663924245335i, -0.03656130112367875 + 0.030345177225127966i, -0.0032005420613622593 + 0.007871799739628165i, -0.03358402203101283 + 0.07032140646846613i }, { -0.08470235735886798 + -0.078737629780995i, -0.009363038859939166 + -0.00980205361670669i, -0.03401243688576514 + -0.02822966889678275i, -0.0037833160467207264 + -0.0035396639242453202i, 0.05478548309426402 + 9.411052913861245e-19i, 0.006410277574390641 + 0.0003811013207649539i, 0.08158253570619775 + -0.03766156231981961i, 0.009807699775449725 + -0.0038391530815631535i }, { -0.010458475570857951 + -0.008623632676041531i, -0.0910498828320973 + -0.08463816344169411i, -0.004176061113249033 + -0.003066466139449058i, -0.036561301123678766 + -0.030345177225127973i, 0.006410277574390642 + -0.0003811013207649374i, 0.058891062447039934 + -1.186362996021989e-19i, 0.009283733559163595 + -0.004974169525809516i, 0.08769626429313318 + -0.04048388903705401i }, { -0.0720054058103243 + -0.17547784669151853i, -0.007204459588000167 + -0.021032999904790014i, -0.031242718245609178 + -0.0654189628300154i, -0.0032005420613622393 + -0.007871799739628151i, 0.08158253570619775 + 0.0376615623198196i, 0.009283733559163593 + 0.004974169525809514i, 0.14737669456579158 + 3.8233315753369694e-18i, 0.01724408487075703 + 0.0010251886042942481i }, { -0.009645793874459286 + -0.020031225211690575i, -0.07740143210572938 + -0.18862801318738912i, -0.004110682913627611 + -0.007437135645594258i, -0.033584022031012836 + -0.07032140646846614i, 0.009807699775449721 + 0.0038391530815631517i, 0.08769626429313318 + 0.040483889037053994i, 0.017244084870757025 + -0.0010251886042942698i, 0.15842098367516383 + 3.799964949951734e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.24411765545020192, 1.0e-7), DoubleNear(0.262411633147541, 1.0e-7), DoubleNear(0.03566200311802481, 1.0e-7), DoubleNear(0.03833448450197234, 1.0e-7), DoubleNear(0.05478548309426402, 1.0e-7), DoubleNear(0.058891062447039934, 1.0e-7), DoubleNear(0.14737669456579158, 1.0e-7), DoubleNear(0.15842098367516383, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.1445463496469177 + -3.6258186687878145e-18i, 0.016725281806076978 + 0.0006966341659734121i, 0.08450233657154779 + -0.020745527799806165i, 0.009877644363729832 + -0.001993184778522578i, 0.004619922498180116 + 0.006648941268048859i, -0.0003068392479163417 + 0.0009655837006183865i, 0.003655090862424515 + 0.0032239371204910282i, -4.079722463399215e-05 + 0.000608521911623738i }, { 0.016725281806076978 + -0.0006966341659734004i, 0.1520511434967997 + -5.275320889160404e-18i, 0.009677680220853892 + -0.002807694655861139i, 0.08888966712228047 + -0.02182262805052053i, 0.0010940204159176176 + 0.0013851747337978533i, 0.0023598092572002607 + 0.014194625576396613i, 0.0008383709629860724 + 0.00065276273558132i, 0.0034167891254671856 + 0.007959547523867981i }, { 0.08450233657154779 + 0.020745527799806155i, 0.00967768022085389 + 0.002807694655861133i, 0.08851554962975228 + 1.949584051323349e-18i, 0.010242026280107926 + 0.00042659642559374905i, 0.0017465570772058538 + 0.004550054740936786i, -0.0003179615190371278 + 0.00052044577323257i, 0.0028290923995809886 + 0.004071598433546724i, -0.0001878985165909654 + 0.0005912924967150092i }, { 0.009877644363729829 + 0.0019931847785225705i, 0.08888966712228047 + 0.02182262805052052i, 0.010242026280107926 + -0.00042659642559375295i, 0.09311124474140986 + 2.0270970990444708e-18i, 0.00044076589004184174 + 0.0009667939236039003i, -0.0006576824917308597 + 0.008636914868903965i, 0.0006699430228273723 + 0.0008482365912031683i, 0.001445071521575519 + 0.008692333550811863i }, { 0.004619922498180116 + -0.006648941268048862i, 0.0010940204159176185 + -0.0013851747337978516i, 0.0017465570772058538 + -0.004550054740936786i, 0.0004407658900418413 + -0.0009667939236039011i, 0.15435678889754822 + -3.3270871351313153e-18i, 0.018248437100988307 + 0.001382609722121668i, 0.09023755604610739 + -0.02215353803804053i, 0.01086653897573875 + -0.001810766634613042i }, { -0.0003068392479163416 + -0.0009655837006183865i, 0.0023598092572002594 + -0.01419462557639661i, -0.0003179615190371288 + -0.0005204457732325702i, -0.0006576824917308606 + -0.008636914868903965i, 0.01824843710098831 + -0.0013826097221216502i, 0.16925155209778125 + -6.35652320262707e-18i, 0.01046967017211111 + -0.0034273242629614285i, 0.09894509031573143 + -0.024291258740062792i }, { 0.003655090862424517 + -0.0032239371204910274i, 0.0008383709629860721 + -0.0006527627355813201i, 0.002829092399580989 + -0.004071598433546724i, 0.0006699430228273717 + -0.0008482365912031696i, 0.09023755604610739 + 0.022153538038040523i, 0.010469670172111109 + 0.0034273242629614172i, 0.09452314805406414 + 2.4495813222911205e-18i, 0.011174757742575677 + 0.0008466658603000338i }, { -4.0797224633991715e-05 + -0.0006085219116237378i, 0.0034167891254671848 + -0.007959547523867981i, -0.00018789851659096476 + -0.0005912924967150085i, 0.0014450715215755193 + -0.008692333550811863i, 0.010866538975738745 + 0.0018107666346130337i, 0.09894509031573143 + 0.024291258740062785i, 0.011174757742575675 + -0.0008466658603000423i, 0.1036442234357263 + 2.62851973348953e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1445463496469177, 1.0e-7), DoubleNear(0.1520511434967997, 1.0e-7), DoubleNear(0.08851554962975228, 1.0e-7), DoubleNear(0.09311124474140986, 1.0e-7), DoubleNear(0.15435678889754822, 1.0e-7), DoubleNear(0.16925155209778125, 1.0e-7), DoubleNear(0.09452314805406414, 1.0e-7), DoubleNear(0.1036442234357263, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.14401128101642235 + -6.268033773569191e-18i, 0.015158021965168156 + -0.0017839192225729838i, 0.08418953344913452 + -0.020668733877470105i, 0.008605405332431254 + -0.003218389878175009i, -0.0024258721553686064 + -0.004041213571104985i, -0.01379281784832636 + 0.0040256236932419516i, -0.0019981754955579064 + -0.0020143434394315324i, -0.007485568819223992 + 0.004332962374191657i }, { 0.015158021965168154 + 0.001783919222572995i, 0.12479323707861872 + -1.724936704588546e-18i, 0.009117467323825661 + -0.0011326181803003655i, 0.07295459309231518 + -0.01791052887441417i, -0.007673523257003495 + 0.0019416121911477562i, 0.0005082532688164612 + 0.004574275268777172i, -0.0042073070454600615 + 0.002236390318455244i, 0.0009536342071191151 + 0.002601193090894212i }, { 0.08418953344913452 + 0.020668733877470098i, 0.009117467323825658 + 0.0011326181803003603i, 0.08818789075746924 + 1.60472832501852e-18i, 0.009282286607888254 + -0.0010924149303447753i, -0.0008381723728349786 + -0.00271067369420318i, -0.008641096972563149 + 0.0003738269576409451i, -0.0014855263220999839 + -0.0024747096090032544i, -0.008446279382149022 + 0.0024651628676910205i }, { 0.008605405332431253 + 0.0032183898781750005i, 0.07295459309231518 + 0.017910528874414165i, 0.00928228660788826 + 0.0010924149303447696i, 0.07641937687857386 + 2.143765033896621e-18i, -0.004764633740825107 + 3.375717774320832e-05i, -0.0003593806837333172 + 0.002747083766699309i, -0.004699019590252481 + 0.0011889810478582091i, 0.0003112380046282728 + 0.002801139499977874i }, { -0.002425872155368607 + 0.004041213571104984i, -0.007673523257003495 + -0.0019416121911477562i, -0.0008381723728349787 + 0.0027106736942031804i, -0.004764633740825105 + -3.3757177743207016e-05i, 0.1548918575280436 + -6.848720303499383e-19i, 0.01981569694189713 + 0.003863163110668064i, 0.09055035916852067 + -0.02223033196037659i, 0.012138778007037328 + -0.0005855615349606106i }, { -0.01379281784832636 + -0.004025623693241953i, 0.0005082532688164616 + -0.004574275268777172i, -0.008641096972563147 + -0.0003738269576409447i, -0.0003593806837333163 + -0.0027470837666993095i, 0.019815696941897134 + -0.0038631631106680457i, 0.19650945851596222 + -9.906907387198928e-18i, 0.011029883069139344 + -0.005102400738522202i, 0.11488016434569671 + -0.02820335791616915i }, { -0.001998175495557907 + 0.002014343439431531i, -0.004207307045460063 + -0.0022363903184552435i, -0.0014855263220999839 + 0.0024747096090032552i, -0.004699019590252481 + -0.0011889810478582091i, 0.09055035916852067 + 0.022230331960376583i, 0.01102988306913934 + 0.00510240073852219i, 0.09485080692634716 + 2.7944370485959495e-18i, 0.012134497414795348 + 0.0023656772162385584i }, { -0.007485568819223994 + -0.004332962374191656i, 0.000953634207119115 + -0.002601193090894212i, -0.008446279382149022 + -0.0024651628676910196i, 0.0003112380046282726 + -0.002801139499977874i, 0.012138778007037321 + 0.0005855615349606037i, 0.11488016434569673 + 0.02820335791616914i, 0.012134497414795341 + -0.002365677216238565i, 0.12033609129856229 + 2.51185179863738e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.14401128101642235, 1.0e-7), DoubleNear(0.12479323707861872, 1.0e-7), DoubleNear(0.08818789075746924, 1.0e-7), DoubleNear(0.07641937687857386, 1.0e-7), DoubleNear(0.1548918575280436, 1.0e-7), DoubleNear(0.19650945851596222, 1.0e-7), DoubleNear(0.09485080692634716, 1.0e-7), DoubleNear(0.12033609129856229, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.29890313854446593 + -6.952905803919129e-18i, 0.034973718907065285 + 0.00207924388809508i, 0.17473989261765518 + -0.042899065837846695i, 0.020744183339468585 + -0.0038039514131356198i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.034973718907065285 + -0.0020792438880950503i, 0.3213026955945809 + -1.1631844091787475e-17i, 0.020147350392965006 + -0.006235018918822567i, 0.1878347574380119 + -0.04611388679058332i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.17473989261765518 + 0.04289906583784668i, 0.020147350392965 + 0.0062350189188225495i, 0.18303869768381642 + 4.399165373614469e-18i, 0.021416784022683603 + 0.001273262285893783i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020744183339468574 + 0.003803951413135604i, 0.18783475743801192 + 0.0461138867905833i, 0.0214167840226836 + -0.0012732622858937952i, 0.19675546817713616 + 4.655616832534001e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.29890313854446593, 1.0e-7), DoubleNear(0.3213026955945809, 1.0e-7), DoubleNear(0.18303869768381642, 1.0e-7), DoubleNear(0.19675546817713616, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.1352984399843697 + -3.643559741421924e-18i, 0.01565521745923543 + 0.0006520643110410418i, -0.056069794113820806 + 0.06971258094153315i, -0.006823743909505648 + 0.007796132037716537i, 0.004324345155580278 + 0.0062235496317418785i, -0.0002872080247648344 + 0.0009038067629318931i, -0.004998763105288365 + -0.00035101576069082683i, -0.0003466633266829373 + -0.0005225357498424524i }, { 0.01565521745923543 + -0.0006520643110410336i, 0.14232308573138164 + -4.865448642977092e-18i, -0.006151791061153744 + 0.008336583378814997i, -0.0589809174113473 + 0.07333203276433865i, 0.0010240262444971492 + 0.00129655284305971i, 0.0022088313675147704 + 0.013286469712586398i, -0.0010924219505409982 + -9.68184490845916e-06i, -0.0077612337244680795 + -0.004368019955429184i }, { -0.05606979411382082 + -0.06971258094153315i, -0.006151791061153735 + -0.008336583378814991i, 0.0977634592923003 + 1.9673251239574585e-18i, 0.011312090626949472 + 0.00047116628052611934i, 0.0014146102861058926 + -0.004807257262253493i, 0.0005847103406508986 + -0.00022656762669499397i, 0.003124669742180827 + 0.004496990069853705i, -0.0002075297397424727 + 0.0006530694344015027i }, { -0.006823743909505639 + -0.007796132037716533i, -0.058980917411347304 + -0.07333203276433867i, 0.011312090626949472 + -0.00047116628052611977i, 0.10283930250682793 + 1.6172248528611589e-18i, 0.00024367689919026014 + -0.0010649417941585584i, 0.005930485047350888 + -0.006644222630225134i, 0.0007399371942478407 + 0.0009368584819413117i, 0.0015960494112610092 + 0.00960048941462208i }, { 0.004324345155580278 + -0.006223549631741879i, 0.0010240262444971499 + -0.001296552843059708i, 0.0014146102861058918 + 0.004807257262253492i, 0.0002436768991902603 + 0.0010649417941585603i, 0.14448121858385707 + -3.674617555605831e-18i, 0.01708092302536579 + 0.001294151937888619i, -0.05987528149065634 + 0.07444401166947723i, -0.007745414574979934 + 0.00826463628391926i }, { -0.0002872080247648344 + -0.0009038067629318928i, 0.0022088313675147696 + -0.013286469712586395i, 0.0005847103406508981 + 0.00022656762669499375i, 0.005930485047350886 + 0.006644222630225134i, 0.01708092302536579 + -0.001294151937888605i, 0.15842303191813173 + -5.7921072666259154e-18i, -0.006411789860147678 + 0.009337269977519855i, -0.06565298745176282 + 0.08162753714582158i }, { -0.004998763105288366 + 0.0003510157606908277i, -0.0010924219505409976 + 9.681844908459268e-06i, 0.0031246697421808273 + -0.004496990069853705i, 0.0007399371942478402 + -0.000936858481941313i, -0.05987528149065634 + -0.07444401166947723i, -0.006411789860147671 + -0.00933726997751985i, 0.1043987183677553 + 2.797111742765636e-18i, 0.012342271818198195 + 0.0009351236445330827i }, { -0.0003466633266829372 + 0.0005225357498424508i, -0.0077612337244680795 + 0.004368019955429186i, -0.00020752973974247195 + -0.0006530694344015022i, 0.0015960494112610083 + -0.009600489414622077i, -0.007745414574979922 + -0.008264636283919255i, -0.06565298745176285 + -0.08162753714582159i, 0.012342271818198193 + -0.0009351236445330874i, 0.11447274361537582 + 2.0641037974883755e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.1352984399843697, 1.0e-7), DoubleNear(0.14232308573138164, 1.0e-7), DoubleNear(0.0977634592923003, 1.0e-7), DoubleNear(0.10283930250682793, 1.0e-7), DoubleNear(0.14448121858385707, 1.0e-7), DoubleNear(0.15842303191813173, 1.0e-7), DoubleNear(0.1043987183677553, 1.0e-7), DoubleNear(0.11447274361537582, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.13479760443115485 + -5.516774398357754e-18i, 0.014188229105374664 + -0.0016697861167841767i, -0.055862240010781036 + 0.06945452520160061i, -0.005019466484869808 + 0.008002476849198959i, -0.002270667637229342 + -0.0037826613619075028i, -0.012910369182103521 + 0.003768068906549291i, 0.0028900181948285867 + 0.0003976316528040071i, 0.003408760170377057 + -0.008213620234776967i }, { 0.01418822910537466 + 0.001669786116784185i, 0.11680910890229979 + -2.16779349216365e-18i, -0.006740182552768499 + 0.00661850577321285i, -0.048407525523039646 + 0.06018594493772921i, -0.007182580040190527 + 0.0018173900700959476i, 0.0004757358076201688 + 0.004281618383559309i, 0.0020401627079181975 + -0.004453982466798744i, -0.002403258137699397 + -0.0015292466806602991i }, { -0.05586224001078104 + -0.06945452520160061i, -0.006740182552768488 + -0.006618505773212846i, 0.09740156734273675 + 8.534689498070818e-19i, 0.010252079467681748 + -0.0012065480361335824i, -0.001008017679004854 + 0.0027375566581471144i, 0.007291758506077573 + 0.00509052660825302i, -0.0016407308402392486 + -0.0027332618182007353i, -0.00932872804837186 + 0.0027227176543836813i }, { -0.005019466484869804 + -0.008002476849198956i, -0.048407525523039646 + -0.06018594493772922i, 0.010252079467681753 + 0.0012065480361335798i, 0.0844035050548928 + 2.586621821471725e-18i, 0.003912984780050571 + 0.0029476726074011894i, 0.0020089533875645577 + -0.002019492850525054i, -0.0051899628070654485 + 0.0013132031689100186i, 0.0003437554658245654 + 0.003093796385195736i }, { -0.002270667637229342 + 0.0037826613619075028i, -0.007182580040190525 + -0.0018173900700959476i, -0.0010080176790048534 + -0.002737556658147115i, 0.0039129847800505714 + -0.0029476726074011894i, 0.14498205413707188 + -1.8014028986700013e-18i, 0.018547911379226557 + 0.003616002365713838i, -0.06008283559369612 + 0.07470206740940977i, -0.009549691999615775 + 0.008058291472436838i }, { -0.012910369182103521 + -0.0037680689065492934i, 0.0004757358076201686 + -0.00428161838355931i, 0.007291758506077573 + -0.0050905266082530215i, 0.002008953387564557 + 0.0020194928505250535i, 0.01854791137922656 + -0.0036160023657138235i, 0.18393700874721355 + -8.489762417439358e-18i, -0.0058233983685329225 + 0.011055347583122002i, -0.07622637934007048 + 0.09477362497243103i }, { 0.0028900181948285867 + -0.00039763165280400683i, 0.0020401627079181988 + 0.004453982466798745i, -0.0016407308402392488 + 0.002733261818200736i, -0.005189962807065449 + -0.0013132031689100177i, -0.06008283559369612 + -0.07470206740940978i, -0.005823398368532918 + -0.011055347583121995i, 0.10476061031731887 + 3.910967916916013e-18i, 0.01340228297746592 + 0.0026128379611927845i }, { 0.0034087601703770573 + 0.008213620234776965i, -0.002403258137699397 + 0.0015292466806602987i, -0.00932872804837186 + -0.0027227176543836804i, 0.0003437554658245656 + -0.0030937963851957358i, -0.009549691999615757 + -0.008058291472436833i, -0.0762263793400705 + -0.09477362497243103i, 0.013402282977465912 + -0.002612837961192787i, 0.13290854106731093 + 1.0947068288778088e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.13479760443115485, 1.0e-7), DoubleNear(0.11680910890229979, 1.0e-7), DoubleNear(0.09740156734273675, 1.0e-7), DoubleNear(0.0844035050548928, 1.0e-7), DoubleNear(0.14498205413707188, 1.0e-7), DoubleNear(0.18393700874721355, 1.0e-7), DoubleNear(0.10476061031731887, 1.0e-7), DoubleNear(0.13290854106731093, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.27977965856822673 + -7.318177297027756e-18i, 0.03273614048460122 + 0.0019462162489296611i, -0.11594507560447716 + 0.14415659261101038i, -0.014569158484485582 + 0.016060768321635797i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03273614048460122 + -0.0019462162489296386i, 0.3007461176495133 + -1.0657555909603009e-17i, -0.012563580921301422 + 0.017673853356334854i, -0.12463390486311013 + 0.15495956991016024i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11594507560447717 + -0.14415659261101038i, -0.012563580921301406 + -0.01767385335633484i, 0.20216217766005562 + 4.764436866723094e-18i, 0.023654362445147667 + 0.001406289925059202i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014569158484485561 + -0.01606076832163579i, -0.12463390486311014 + -0.15495956991016024i, 0.023654362445147667 + -0.0014062899250592072i, 0.21731204612220373 + 3.681328650349534e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.27977965856822673, 1.0e-7), DoubleNear(0.3007461176495133, 1.0e-7), DoubleNear(0.20216217766005562, 1.0e-7), DoubleNear(0.21731204612220373, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.11052807361669927 + -2.354961144685375e-18i, 0.011696693784361258 + -0.0012654892463235304i, 0.014091322786539847 + -0.0034798219861466176i, 0.0006735525659213196 + -0.0004323660339606819i, -0.0007789943344781911 + -0.004196491028362703i, -0.012330486463051047 + -0.006541301730257623i, 0.00477403856012698 + 0.004734238250888299i, 0.01073297011763256 + -0.0056403974213024895i }, { 0.01169669378436126 + 0.0012654892463235341i, 0.09689504156517736 + 1.3067142777296562e-19i, 0.001975827907981933 + 0.0004385711482607635i, 0.009400048421869506 + 0.0035348411292442754i, -0.007190933727021405 + -0.006409271922959043i, -0.0009648819910269827 + 0.0030395978015553262i, 0.0036644010984851596 + 0.00022778278742423402i, -0.0034879008422336114 + -0.005217754840726536i }, { 0.014091322786539847 + 0.0034798219861466176i, 0.001975827907981933 + -0.0004385711482607631i, 0.12167109815719235 + -2.3083443038652968e-18i, 0.012743614788695151 + -0.0016108449065942287i, -0.001424868222589265 + 0.008029247927590423i, 0.019026608603164977 + 0.002567064709362676i, -0.003132404142990399 + -0.0023194321517455356i, -0.009908610767424334 + 0.013032088291190595i }, { 0.00067355256592132 + 0.00043236603396068247i, 0.009400048421869504 + -0.0035348411292442745i, 0.012743614788695155 + 0.0016108449065942306i, 0.10431757239201525 + 2.8815690153510956e-19i, 0.007710486581966638 + -0.001153453689218572i, 0.0038133310932282035 + -0.007902968037730964i, -0.005181609120234571 + 0.009539865161965009i, 0.0017843732644717168 + 0.004335816967199719i }, { -0.0007789943344781915 + 0.004196491028362703i, -0.007190933727021405 + 0.006409271922959044i, -0.0014248682225892647 + -0.008029247927590421i, 0.007710486581966639 + 0.0011534536892185727i, 0.12253382565997073 + 6.787265272209094e-19i, 0.015270614301823644 + 0.002388719837890692i, -0.006642307888778742 + 0.014200361687742202i, -0.0011682903304286267 + 0.0019892422312940776i }, { -0.012330486463051047 + 0.006541301730257622i, -0.0009648819910269826 + -0.0030395978015553262i, 0.019026608603164973 + -0.002567064709362676i, 0.003813331093228204 + 0.007902968037730964i, 0.015270614301823644 + -0.0023887198378906875i, 0.1482673466730322 + -3.3788952178888993e-18i, -0.00021186446923694339 + 0.001794840176740258i, -0.005595167643093726 + 0.019352117997964203i }, { 0.004774038560126981 + -0.004734238250888298i, 0.003664401098485159 + -0.00022778278742423323i, -0.003132404142990399 + 0.0023194321517455356i, -0.005181609120234571 + -0.009539865161965009i, -0.006642307888778742 + -0.014200361687742202i, -0.00021186446923694295 + -0.001794840176740258i, 0.12720883879442002 + 1.430838491025102e-18i, 0.01667958005486883 + 0.0038401204890159304i }, { 0.010732970117632561 + 0.005640397421302491i, -0.003487900842233611 + 0.005217754840726536i, -0.009908610767424334 + -0.013032088291190597i, 0.0017843732644717168 + -0.00433581696719972i, -0.0011682903304286265 + -0.0019892422312940776i, -0.005595167643093726 + -0.0193521179979642i, 0.01667958005486883 + -0.003840120489015923i, 0.1685782031414923 + -4.016160370672649e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.11052807361669927, 1.0e-7), DoubleNear(0.09689504156517736, 1.0e-7), DoubleNear(0.12167109815719235, 1.0e-7), DoubleNear(0.10431757239201525, 1.0e-7), DoubleNear(0.12253382565997073, 1.0e-7), DoubleNear(0.1482673466730322, 1.0e-7), DoubleNear(0.12720883879442002, 1.0e-7), DoubleNear(0.1685782031414923, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.23306189927666998 + -1.6762346174644656e-18i, 0.026967308086184902 + 0.0011232305915671614i, 0.007449014897761105 + 0.010720539701595585i, -0.0004947377645073072 + 0.0015568761973333957i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026967308086184902 + -0.0011232305915671534i, 0.24516238823820957 + -3.2482237901159337e-18i, 0.0017639634387449897 + 0.0022334113250010216i, 0.00380488077877578 + 0.022886959127208478i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007449014897761105 + -0.010720539701595585i, 0.0017639634387449901 + -0.002233411325001021i, 0.24887993695161237 + -8.775058128401948e-19i, 0.029423194843563982 + 0.0022292755824217018i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004947377645073065 + -0.0015568761973333953i, 0.0038048807787757783 + -0.022886959127208475i, 0.029423194843563986 + -0.0022292755824216927i, 0.2728957755335075 + -3.728003469137539e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.23306189927666998, 1.0e-7), DoubleNear(0.24516238823820957, 1.0e-7), DoubleNear(0.24887993695161237, 1.0e-7), DoubleNear(0.2728957755335075, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.2321991717738916 + -4.663305448550672e-18i, 0.02444030857305641 + -0.002876334152917759i, -0.003911398477468591 + -0.006515923180108239i, -0.02223909723047538 + 0.006490786560932972i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.024440308573056416 + 0.0028763341529177647i, 0.20121261395719262 + 4.1882832930807517e-19i, -0.012372542847255976 + 0.003130593239005966i, 0.0008194912734447341 + 0.007375414768755045i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003911398477468591 + 0.006515923180108239i, -0.012372542847255976 + -0.0031305932390059653i, 0.24974266445439075 + 2.1095650182460115e-18i, 0.031950194356692475 + 0.006228840326906623i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02223909723047538 + -0.006490786560932975i, 0.0008194912734447342 + -0.007375414768755046i, 0.031950194356692475 + -0.0062288403269066105i, 0.3168455498145245 + -7.395055588561548e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2321991717738916, 1.0e-7), DoubleNear(0.20121261395719262, 1.0e-7), DoubleNear(0.24974266445439075, 1.0e-7), DoubleNear(0.3168455498145245, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.07968507466903224 + -2.5251981921601094e-18i, -0.0008812784743302169 + 0.0038909493361481712i, -0.03193584003250021 + 0.0017226225085885758i, 0.0007848483203285136 + 0.00017776379761461043i, 0.04658419265418694 + -0.011436531851645339i, 4.3236701479167875e-05 + 0.0024011460567660405i, -0.018422577923867547 + 0.005590535397018261i, 0.00048433821330139565 + -8.721329835166775e-06i }, { -0.0008812784743302178 + -0.003890949336148172i, 0.24025108432557993 + -7.14830557114497e-18i, -0.000784848320328514 + 0.0001777637976146108i, -0.08996793938887905 + -0.012620157894490357i, -0.0010736340851975345 + -0.002148181009454267i, 0.1404516823769709 + -0.03448122737782451i, -0.0004333123131078425 + 0.00021656409159233434i, -0.05440685946435768 + 0.005534553862142633i }, { -0.03193584003250021 + -0.001722622508588574i, -0.0007848483203285139 + -0.00017776379761461048i, 0.08279384436286023 + -2.9974566239379296e-18i, 0.0008812784743302184 + -0.003890949336148172i, -0.018917045106578004 + 0.003576432275603605i, -0.0004843382133013959 + 8.721329835167046e-06i, 0.04840159104323633 + -0.011882707547289262i, -4.323670147916695e-05 + -0.0024011460567660396i }, { 0.0007848483203285137 + -0.0001777637976146107i, -0.08996793938887904 + 0.012620157894490336i, 0.0008812784743302189 + 0.0038909493361481725i, 0.2174758307815745 + -5.913789508463595e-18i, 0.00043331231310784254 + -0.0002165640915923344i, -0.05078432818525422 + 0.020290136864982433i, 0.0010736340851975339 + 0.002148181009454267i, 0.12713718398127294 + -0.031212485851670902i }, { 0.04658419265418694 + 0.011436531851645336i, -0.0010736340851975352 + 0.002148181009454267i, -0.018917045106578007 + -0.0035764322756036034i, 0.00043331231310784297 + 0.00021656409159233385i, 0.04879658461695123 + 4.614233188272153e-19i, -0.000539666679392151 + 0.0023826926097543235i, -0.01955648440980799 + 0.0010548787881863456i, 0.00048061594512461436 + 0.00010885684964417772i }, { 4.323670147916736e-05 + -0.0024011460567660396i, 0.14045168237697087 + 0.0344812273778245i, -0.0004843382133013959 + -8.721329835166504e-06i, -0.05078432818525423 + -0.020290136864982433i, -0.0005396666793921494 + -0.0023826926097543243i, 0.14712206036450495 + 4.581708166679969e-18i, -0.000480615945124614 + 0.00010885684964417777i, -0.055093481250238406 + -0.0077281800278855405i }, { -0.01842257792386755 + -0.005590535397018263i, -0.000433312313107843 + -0.0002165640915923339i, 0.04840159104323633 + 0.011882707547289257i, 0.001073634085197535 + -0.0021481810094542667i, -0.019556484409807992 + -0.0010548787881863465i, -0.00048061594512461387 + -0.00010885684964417782i, 0.05070029549442179 + 6.87153357649616e-19i, 0.0005396666793921509 + -0.002382692609754324i }, { 0.0004843382133013957 + 8.721329835166178e-06i, -0.05440685946435769 + -0.005534553862142626i, -4.3236701479167224e-05 + 0.0024011460567660396i, 0.1271371839812729 + 0.03121248585167089i, 0.00048061594512461403 + -0.0001088568496441781i, -0.0550934812502384 + 0.007728180027885544i, 0.0005396666793921489 + 0.002382692609754324i, 0.1331752253850746 + 3.3244973629916703e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.07968507466903224, 1.0e-7), DoubleNear(0.24025108432557993, 1.0e-7), DoubleNear(0.08279384436286023, 1.0e-7), DoubleNear(0.2174758307815745, 1.0e-7), DoubleNear(0.04879658461695123, 1.0e-7), DoubleNear(0.14712206036450495, 1.0e-7), DoubleNear(0.05070029549442179, 1.0e-7), DoubleNear(0.1331752253850746, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.0745869149867388 + -2.3153688029405007e-18i, -0.0008248952883275133 + 0.00364201086035722i, -0.029892621616126696 + 0.0016124110962560407i, 0.0007346346249779894 + 0.00016639067372993933i, -0.03090998659980584 + 0.03843094087997592i, -0.0015346981675073185 + -0.001934334044698403i, 0.011557175386947852 + -0.016070394916703826i, -0.0003901769709082599 + 0.00030956591179153174i }, { -0.0008248952883275135 + -0.003642010860357222i, 0.22488009550711857 + -6.030270893659789e-18i, -0.0007346346249779896 + 0.00016639067372993955i, -0.08421189381577182 + -0.011812734667128164i, 0.0022183972402730918 + 0.0010842787216294235i, -0.09319383621006384 + 0.11586956850345642i, 0.0002187112346934943 + -0.00044747571798849014i, 0.04098524543556382 + -0.038494833079867036i }, { -0.029892621616126696 + -0.0016124110962560407i, -0.0007346346249779897 + -0.00016639067372993944i, 0.07749678916116826 + -2.5737053686113213e-18i, 0.0008248952883275149 + -0.0036420108603572206i, 0.013218766445525634 + -0.014733978056252801i, 0.00039017697090825966 + -0.0003095659117915317i, -0.03211588406526243 + 0.039930254833174667i, 0.0015346981675073185 + 0.0019343340446984036i }, { 0.0007346346249779895 + -0.00016639067372993944i, -0.08421189381577181 + 0.01181273466712814i, 0.0008248952883275146 + 0.003642010860357222i, 0.20356197656271446 + -7.056388141419152e-18i, -0.0002187112346934942 + 0.0004474757179884901i, 0.028812211929513637 + -0.04828559786301732i, -0.0022183972402730918 + -0.0010842787216294235i, -0.08435927359245515 + 0.10488539830456359i }, { -0.030909986599805848 + -0.03843094087997593i, 0.002218397240273091 + -0.0010842787216294256i, 0.01321876644552563 + 0.0147339780562528i, -0.00021871123469349385 + -0.00044747571798849106i, 0.053894744299244665 + 2.5159392960760683e-19i, -0.0005960498653948548 + 0.002631631085545275i, -0.021599702826181504 + 0.0011650902005188798i, 0.0005308296404751387 + 0.00012022997352884881i }, { -0.0015346981675073185 + 0.0019343340446984047i, -0.09319383621006384 + -0.11586956850345644i, 0.0003901769709082598 + 0.00030956591179153256i, 0.02881221192951364 + 0.0482855978630173i, -0.0005960498653948537 + -0.0026316310855452746i, 0.16249304918296628 + 3.4636734891947882e-18i, -0.0005308296404751383 + 0.00012022997352884908i, -0.06084952682334564 + -0.008535603255247739i }, { 0.01155717538694785 + 0.016070394916703822i, 0.00021871123469349425 + 0.00044747571798849095i, -0.03211588406526243 + -0.03993025483317467i, -0.0022183972402730918 + 0.0010842787216294254i, -0.021599702826181504 + -0.0011650902005188798i, -0.000530829640475138 + -0.00012022997352884886i, 0.05599735069611378 + 2.6340210232300773e-19i, 0.0005960498653948546 + -0.0026316310855452746i }, { -0.00039017697090826004 + -0.0003095659117915327i, 0.04098524543556382 + 0.03849483307986703i, 0.0015346981675073185 + -0.0019343340446984045i, -0.08435927359245518 + -0.10488539830456359i, 0.0005308296404751382 + -0.00012022997352884946i, -0.06084952682334564 + 0.008535603255247746i, 0.000596049865394853 + 0.0026316310855452755i, 0.14708907960393464 + 4.467095995947226e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.0745869149867388, 1.0e-7), DoubleNear(0.22488009550711857, 1.0e-7), DoubleNear(0.07749678916116826, 1.0e-7), DoubleNear(0.20356197656271446, 1.0e-7), DoubleNear(0.053894744299244665, 1.0e-7), DoubleNear(0.16249304918296628, 1.0e-7), DoubleNear(0.05599735069611378, 1.0e-7), DoubleNear(0.14708907960393464, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.07206946672666058 + -1.1766760584591535e-18i, -0.005346159572377897 + -0.00022659571805325044i, -0.028222193544915425 + -0.0003068761879279156i, 0.0010221564130693736 + 0.0013450826429178366i, -0.005222981202005725 + 0.009141342458756738i, -0.00265990624058452 + -0.008465717535242258i, -5.4417870729673874e-05 + -0.0030010956382000168i, -0.000855226723333827 + 0.0017500674528237005i }, { -0.005346159572377896 + 0.00022659571805324903i, 0.17458790619443512 + -1.257954492503998e-18i, 0.00023883257979882984 + -5.2081016762884095e-06i, -0.06577458115503068 + -0.00805500511551989i, 0.006860332965389191 + -0.0006211309988802189i, 0.006596369550974224 + 0.011650317402187176i, -0.0002769755757262326 + -0.0016403355510529387i, 0.0022619614293564847 + 0.0011093561460388682i }, { -0.028222193544915418 + 0.0003068761879279156i, 0.0002388325797988293 + 5.208101676288518e-06i, 0.07151565566937361 + -1.147868301001715e-18i, 0.0012963773634003114 + -0.004109987285709681i, 0.0033163884449965327 + -0.0053816408587920445i, 0.0009485713215601723 + 0.0007374713026364238i, -0.0030749287994433203 + 0.012182943409007746i, 0.0023601214721692366 + 0.0004767578750229412i }, { 0.0010221564130693738 + -0.001345082642917837i, -0.06577458115503067 + 0.008055005115519879i, 0.0012963773634003114 + 0.004109987285709682i, 0.16005125892441022 + -1.341959555615532e-18i, 0.0002973983918884509 + 0.0011405075499137359i, -0.009947922687581323 + -0.005937979164288944i, -0.006925922719160829 + 0.002226374627500806i, 0.012955436127011706 + 0.0006328955588523963i }, { -0.005222981202005725 + -0.009141342458756738i, 0.006860332965389189 + 0.0006211309988802224i, 0.0033163884449965322 + 0.0053816408587920445i, 0.00029739839188845033 + -0.0011405075499137354i, 0.05641219255932291 + -8.870988148737402e-19i, 0.0039252144186555284 + 0.006500237663955745i, -0.02327013089739278 + 0.003084377484702838i, 0.00024330785238375435 + -0.0010584619956590486i }, { -0.0026599062405845224 + 0.008465717535242256i, 0.006596369550974224 + -0.011650317402187176i, 0.0009485713215601723 + -0.0007374713026364238i, -0.009947922687581325 + 0.005937979164288944i, 0.0039252144186555284 + -0.006500237663955745i, 0.21278523849564973 + -1.3086429119610032e-18i, -0.0015042968452519576 + 0.000291828748935077i, -0.07928683948408678 + -0.012293332806856013i }, { -5.441787072967431e-05 + 0.0030010956382000168i, -0.0002769755757262321 + 0.001640335551052938i, -0.00307492879944332 + -0.012182943409007746i, -0.0069259227191608265 + -0.0022263746275008084i, -0.023270130897392778 + -0.003084377484702838i, -0.001504296845251957 + -0.00029182874893507677i, 0.06197848418790841 + -1.1624349652865983e-18i, 0.00012456779032205825 + -0.0021636546601928154i }, { -0.0008552267233338264 + -0.0017500674528237005i, 0.002261961429356485 + -0.0011093561460388708i, 0.002360121472169239 + -0.0004767578750229399i, 0.012955436127011706 + -0.0006328955588523963i, 0.00024330785238375397 + 0.001058461995659048i, -0.07928683948408678 + 0.01229333280685601i, 0.0001245677903220563 + 0.0021636546601928146i, 0.19059979724223886 + -1.2473325898563928e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.07206946672666058, 1.0e-7), DoubleNear(0.17458790619443512, 1.0e-7), DoubleNear(0.07151565566937361, 1.0e-7), DoubleNear(0.16005125892441022, 1.0e-7), DoubleNear(0.05641219255932291, 1.0e-7), DoubleNear(0.21278523849564973, 1.0e-7), DoubleNear(0.06197848418790841, 1.0e-7), DoubleNear(0.19059979724223886, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.05390952200269493 + -4.0909176925074743e-19i, -0.00023804151528394456 + 0.0010509816168762028i, -0.0278150670878864 + 0.018670840343787166i, 0.00048563030408567566 + 0.0007927824021701217i, -0.0001791109371186753 + 0.00021131609453491865i, -0.0077497301529413885 + 0.018766736034187298i, -0.00031962138546486735 + 3.057038242610657e-05i, 0.02718585534064788 + -0.01812409809713548i }, { -0.00023804151528394315 + -0.0010509816168762036i, 0.11119820909255923 + -1.3745787055217753e-18i, -0.0007798339613674522 + -0.0005061617549113334i, -0.05737364255998664 + 0.03851200922127354i, 0.0019026686174403648 + -0.0007457675377940746i, -0.0009481734380598671 + 0.001724536816656605i, -0.003211046641958939 + -0.0007100097094306412i, -0.0021820547757470414 + 0.0006648481654790838i }, { -0.027815067087886395 + -0.018670840343787166i, -0.0007798339613674525 + 0.0005061617549113336i, 0.08760427655842397 + -1.9875585691113454e-18i, 0.0011829036384384244 + -0.005222660329026293i, 0.0015882998364303562 + -0.00015191390693829578i, 0.04417767216745807 + -0.029452097571818405i, -0.00021592007432933265 + -0.00017353311242133653i, -0.02030380703493775 + -6.417716326810857e-05i }, { 0.0004856303040856758 + -0.0007927824021701223i, -0.05737364255998665 + -0.03851200922127354i, 0.001182903638438423 + 0.005222660329026294i, 0.1806997780774061 + -4.732480753587288e-19i, -0.005218028422698821 + -0.0011537829428541172i, 0.010843320882175623 + -0.003303840983436079i, 0.0014108639256215222 + 0.0014784383895176999i, -0.0017487027545159814 + -0.0009028282101233808i }, { -0.00017911093711867534 + -0.0002113160945349187i, 0.0019026686174403646 + 0.0007457675377940745i, 0.0015882998364303562 + 0.0001519139069382962i, -0.00521802842269882 + 0.0011537829428541176i, 0.07457213728328856 + -1.6546831040821464e-18i, -0.0011829036384384244 + 0.005222660329026292i, -0.023677257354421805 + -0.015893339047012244i, 0.0007798339613674524 + -0.0005061617549113336i }, { -0.007749730152941389 + -0.018766736034187298i, -0.0009481734380598674 + -0.0017245368166566057i, 0.044177672167458076 + 0.0294520975718184i, 0.01084332088217562 + 0.0033038409834360858i, -0.0011829036384384236 + -0.005222660329026293i, 0.27617493559752565 + -1.1920186989432258e-18i, -0.0004856303040856756 + 0.000792782402170122i, -0.08768777807913081 + -0.05886034714364944i }, { -0.0003196213854648676 + -3.057038242610711e-05i, -0.0032110466419589395 + 0.0007100097094306418i, -0.0002159200743293327 + 0.00017353311242133664i, 0.001410863925621523 + -0.0014784383895176997i, -0.023677257354421805 + 0.015893339047012244i, -0.0004856303040856753 + -0.0007927824021701219i, 0.04588986329885805 + -3.2274469717696815e-19i, 0.0002380415152839452 + -0.0010509816168762028i }, { 0.02718585534064788 + 0.01812409809713548i, -0.0021820547757470414 + -0.0006648481654790857i, -0.02030380703493775 + 6.41771632681103e-05i, -0.0017487027545159811 + 0.0009028282101233806i, 0.000779833961367452 + 0.0005061617549113333i, -0.08768777807913081 + 0.05886034714364943i, 0.00023804151528394478 + 0.0010509816168762034i, 0.16995127808924299 + -2.116044070113196e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.05390952200269493, 1.0e-7), DoubleNear(0.11119820909255923, 1.0e-7), DoubleNear(0.08760427655842397, 1.0e-7), DoubleNear(0.1806997780774061, 1.0e-7), DoubleNear(0.07457213728328856, 1.0e-7), DoubleNear(0.27617493559752565, 1.0e-7), DoubleNear(0.04588986329885805, 1.0e-7), DoubleNear(0.16995127808924299, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.12848165928598348 + -2.0637748733328937e-18i, -0.0014209451537223689 + 0.006273641945902495i, -0.0514923244423082 + 0.0027775012967749223i, 0.001265464265453128 + 0.00028662064725878803i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0014209451537223667 + -0.006273641945902497i, 0.3873731446900849 + -2.566597404465001e-18i, -0.0012654642654531278 + 0.0002866206472587886i, -0.14506142063911745 + -0.0203483379223759i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.051492324442308196 + -0.0027775012967749223i, -0.0012654642654531278 + -0.00028662064725878825i, 0.13349413985728203 + -2.3103032662883136e-18i, 0.0014209451537223697 + -0.006273641945902495i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0012654642654531278 + -0.000286620647258789i, -0.14506142063911745 + 0.020348337922375892i, 0.0014209451537223676 + 0.006273641945902497i, 0.35065105616664904 + -2.589292145471925e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12848165928598348, 1.0e-7), DoubleNear(0.3873731446900849, 1.0e-7), DoubleNear(0.13349413985728203, 1.0e-7), DoubleNear(0.35065105616664904, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.13269841516986353 + -5.44811591673966e-18i, 1.463672932855431e-18 + -4.336808689942018e-19i, 0.0506388347895855 + -0.002847022330306443i, 3.5236570605778894e-19 + 2.168404344971009e-19i, -0.0460428335752473 + 0.0428005039901789i, 3.2526065174565133e-19 + 4.336808689942018e-19i, -0.039140975760526525 + 0.09538692361452272i, -2.168404344971009e-19 + -5.421010862427522e-19i }, { 1.0842021724855044e-18 + 0.0i, 0.37383087342787946 + -1.395910297075087e-17i, -7.047314121155779e-19 + 0.0i, 0.14265701526675062 + -0.008020478941249954i, -2.168404344971009e-19 + 2.168404344971009e-19i, -0.12970940661571798 + 0.12057528923251021i, -6.505213034913027e-19 + 7.589415207398531e-19i, -0.11026586215552714 + 0.2687189362643849i }, { 0.05063883478958551 + 0.0028470223303064405i, -5.421010862427522e-20 + 3.2526065174565133e-19i, 0.019385288978043515 + 5.590417451878381e-19i, 8.131516293641283e-20 + 1.0842021724855044e-19i, -0.01848861141355152 + 0.01534519212248137i, -1.3552527156068805e-19 + -3.7947076036992655e-19i, -0.016983037089820976 + 0.03556069172297169i, -1.0842021724855044e-19 + 2.710505431213761e-19i }, { 2.710505431213761e-20 + 1.0842021724855044e-19i, 0.14265701526675062 + 0.00802047894124995i, -1.4907779871675686e-19 + -5.421010862427522e-20i, 0.05461119864195364 + 8.724439356719293e-19i, 1.0842021724855044e-19 + 1.6263032587282567e-19i, -0.05208512659589236 + 0.04322965399942934i, 2.168404344971009e-19 + -2.710505431213761e-19i, -0.04784370318680103 + 0.1001796775755098i }, { -0.046042833575247306 + -0.0428005039901789i, -8.673617379884035e-19 + -1.0842021724855044e-19i, -0.01848861141355153 + -0.015345192122481375i, 1.6263032587282567e-19 + 2.710505431213761e-20i, 0.029780503862028938 + -7.453889935837849e-20i, 2.303929616531697e-19 + 1.0842021724855044e-19i, 0.04434694890783776 + -0.02047221706862816i, 2.168404344971009e-19 + 4.336808689942018e-19i }, { 1.0842021724855044e-19 + 3.2526065174565133e-19i, -0.12970940661571798 + -0.12057528923251021i, -1.6263032587282567e-19 + -5.421010862427522e-20i, -0.05208512659589238 + -0.04322965399942935i, -6.776263578034403e-20 + 4.336808689942018e-19i, 0.08389604167927503 + 8.970078911423039e-19i, -1.0842021724855044e-19 + -2.168404344971009e-19i, 0.12493185109149318 + -0.057673234288245466i }, { -0.039140975760526525 + -0.09538692361452272i, -4.336808689942018e-19 + -1.0842021724855044e-18i, -0.016983037089820976 + -0.0355606917229717i, 1.0842021724855044e-19 + -1.6263032587282567e-19i, 0.04434694890783775 + 0.020472217068628153i, -1.0842021724855044e-19 + 1.0842021724855044e-19i, 0.0801115911333295 + 5.89534931288993e-19i, -3.7947076036992655e-19 + -2.168404344971009e-19i }, { -6.505213034913027e-19 + -4.336808689942018e-19i, -0.11026586215552717 + -0.2687189362643849i, -1.0842021724855044e-19 + 1.0842021724855044e-19i, -0.047843703186801034 + -0.10017967757550983i, 5.421010862427522e-19 + -1.0842021724855044e-19i, 0.12493185109149317 + 0.057673234288245445i, -5.421010862427522e-19 + 2.168404344971009e-19i, 0.22568608710762592 + 7.03376159399971e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13269841516986353, 1.0e-7), DoubleNear(0.37383087342787946, 1.0e-7), DoubleNear(0.019385288978043515, 1.0e-7), DoubleNear(0.05461119864195364, 1.0e-7), DoubleNear(0.029780503862028938, 1.0e-7), DoubleNear(0.08389604167927503, 1.0e-7), DoubleNear(0.0801115911333295, 1.0e-7), DoubleNear(0.22568608710762592, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.08905233060558958 + -2.95052868710298e-18i, -0.002511698553000416 + -0.002689574079162003i, 0.05206032550594225 + -0.012780935697985524i, -0.0018543604247049212 + -0.0012118519931035182i, -0.005146412194059449 + 0.013225446504036368i, -0.00018592826235718125 + -0.00495479938996952i, -0.0011104741671863888 + 0.008470266956065679i, -0.0008198152452857318 + -0.0028699095257231884i }, { -0.002511698553000415 + 0.0026895740791620035i, 0.20754516253812785 + -5.950610870845239e-18i, -0.001082336309738511 + 0.001932818136949881i, 0.12133167818788601 + -0.029787220152341167i, -4.06791479489136e-05 + 0.0009955814636850224i, 0.012126143949439826 + 0.007618120340409103i, 0.00011910629305050434 + 0.0005878589845465828i, 0.008182354155078092 + 0.002713217688293329i }, { 0.05206032550594225 + 0.01278093569798552i, -0.0010823363097385104 + -0.0019328181369498792i, 0.05453279179044461 + 6.259843276421115e-19i, -0.0015380836559771693 + -0.0016470089246009277i, -0.00490674946275123 + 0.006993024016317759i, 0.0006024265302853506 + -0.002923278980502536i, -0.0031514978073895975 + 0.008098839363728117i, -0.00011385650605810185 + -0.0030341602702497967i }, { -0.0018543604247049203 + 0.0012118519931035186i, 0.12133167818788601 + 0.029787220152341157i, -0.0015380836559771697 + 0.001647008924600928i, 0.1270940025807175 + 3.350696822725709e-18i, -0.00016666865709248245 + 0.0005761823092558136i, 0.005995624048226224 + 0.0061939455935229905i, -2.4910605822725486e-05 + 0.0006096621649355643i, 0.007425661728546106 + 0.004665092620630469i }, { -0.005146412194059449 + -0.01322544650403637i, -4.067914794891273e-05 + -0.0009955814636850217i, -0.004906749462751231 + -0.006993024016317759i, -0.000166668657092482 + -0.0005761823092558134i, 0.0734265884263029 + -2.5721261289950583e-18i, 0.0025116985530004177 + 0.0026895740791620026i, 0.04292545819148101 + -0.010538303700949077i, 0.0018543604247049218 + 0.0012118519931035188i }, { -0.00018592826235718158 + 0.00495479938996952i, 0.01212614394943982 + -0.007618120340409106i, 0.0006024265302853523 + 0.0029232789805025364i, 0.005995624048226223 + -0.006193945593522992i, 0.002511698553000416 + -0.002689574079162003i, 0.25018175256902664 + -7.111484208763327e-18i, 0.0010823363097385102 + -0.0019328181369498811i, 0.1462571881703578 + -0.03590649307715425i }, { -0.0011104741671863886 + -0.008470266956065679i, 0.00011910629305050412 + -0.0005878589845465828i, -0.0031514978073895975 + -0.008098839363728115i, -2.4910605822725486e-05 + -0.0006096621649355639i, 0.04292545819148101 + 0.010538303700949072i, 0.0010823363097385102 + 0.0019328181369498796i, 0.04496408832092841 + 5.225923488347197e-19i, 0.001538083655977169 + 0.0016470089246009277i }, { -0.0008198152452857303 + 0.002869909525723187i, 0.008182354155078089 + -0.002713217688293329i, -0.00011385650605810218 + 0.003034160270249797i, 0.007425661728546107 + -0.004665092620630468i, 0.0018543604247049207 + -0.0012118519931035186i, 0.14625718817035777 + 0.03590649307715424i, 0.0015380836559771688 + -0.0016470089246009277i, 0.153203283168862 + 4.555508706945931e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.08905233060558958, 1.0e-7), DoubleNear(0.20754516253812785, 1.0e-7), DoubleNear(0.05453279179044461, 1.0e-7), DoubleNear(0.1270940025807175, 1.0e-7), DoubleNear(0.0734265884263029, 1.0e-7), DoubleNear(0.25018175256902664, 1.0e-7), DoubleNear(0.04496408832092841, 1.0e-7), DoubleNear(0.153203283168862, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.08776768347878385 + -2.9909487695741733e-18i, 0.0005860090012374157 + -0.002587299475429152i, 0.051309315991345875 + -0.01259656104759007i, -2.8750385932055947e-05 + -0.0015966499166112445i, -0.00024500053796590337 + 2.343322593801472e-05i, -0.017398967432159365 + 0.011599436125073071i, -0.00013986505593986036 + 4.8862028226673705e-05i, -0.008506731441911372 + 0.009278201914533626i }, { 0.0005860090012374158 + 0.002587299475429152i, 0.18103683461625725 + -5.0020217085835635e-18i, 0.0007139164932392376 + 0.0014284399817937486i, 0.10583481055010382 + -0.025982701704294207i, 0.0020550722148165762 + 0.0004544067367426174i, -0.0016726183485862418 + 0.000509628471734172i, 0.0012666200980654353 + -2.9299437618648125e-05i, -0.0009046762324989308 + 0.0005379876232360066i }, { 0.05130931599134587 + 0.012596561047590065i, 0.0007139164932392365 + -0.0014284399817937484i, 0.05374611508233504 + 5.942984312120808e-19i, 0.000358853121917064 + -0.0015843792367209377i, -0.00014659140553393462 + -2.146372519089054e-05i, -0.01183627141552648 + 0.004283945561004453i, -0.0001500304734821046 + 1.4349756175567347e-05i, -0.010654569755719774 + 0.007103122745846116i }, { -2.875038593205573e-05 + 0.0015966499166112434i, 0.10583481055010381 + 0.025982701704294196i, 0.00035885312191706397 + 0.001584379236720938i, 0.11086115255370807 + 3.1541949277030603e-18i, 0.0011361857064320223 + 0.0005605951929580104i, -0.0010509616510343612 + 5.787379768701947e-05i, 0.001258460328245311 + 0.00027826411498100786i, -0.0010242578439896063 + 0.0003120801347990522i }, { -0.00024500053796590337 + -2.3433225938014883e-05i, 0.002055072214816577 + -0.00045440673674261714i, -0.00014659140553393443 + 2.1463725190890568e-05i, 0.0011361857064320219 + -0.0005605951929580107i, 0.07471123555310863 + -2.531706046523865e-18i, -0.000586009001237414 + 0.002587299475429152i, 0.043676467706077395 + -0.010722678351344533i, 2.8750385932056624e-05 + 0.0015966499166112451i }, { -0.017398967432159365 + -0.011599436125073075i, -0.0016726183485862418 + -0.0005096284717341737i, -0.01183627141552648 + -0.00428394556100445i, -0.0010509616510343603 + -5.787379768701947e-05i, -0.0005860090012374149 + -0.0025872994754291517i, 0.2766900804908972 + -8.060073371025e-18i, -0.0007139164932392383 + -0.0014284399817937488i, 0.16175405580814 + -0.039711011525201206i }, { -0.0001398650559398604 + -4.886202822667376e-05i, 0.0012666200980654355 + 2.9299437618647915e-05i, -0.0001500304734821046 + -1.4349756175567212e-05i, 0.0012584603282453106 + -0.0002782641149810081i, 0.04367646770607739 + 0.010722678351344526i, -0.0007139164932392368 + 0.0014284399817937488i, 0.04575076502903798 + 5.542782452647504e-19i, -0.00035885312191706424 + 0.0015843792367209377i }, { -0.008506731441911376 + -0.009278201914533627i, -0.0009046762324989314 + -0.0005379876232360068i, -0.010654569755719778 + -0.007103122745846113i, -0.0010242578439896067 + -0.00031208013479905127i, 2.875038593205619e-05 + -0.0015966499166112434i, 0.16175405580813998 + 0.03971101152520119i, -0.0003588531219170647 + -0.0015843792367209375i, 0.16943613319587147 + 4.75201060196858e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.08776768347878385, 1.0e-7), DoubleNear(0.18103683461625725, 1.0e-7), DoubleNear(0.05374611508233504, 1.0e-7), DoubleNear(0.11086115255370807, 1.0e-7), DoubleNear(0.07471123555310863, 1.0e-7), DoubleNear(0.2766900804908972, 1.0e-7), DoubleNear(0.04575076502903798, 1.0e-7), DoubleNear(0.16943613319587147, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.1624789190318925 + -5.522654816098038e-18i, 1.734723475976807e-18 + 0.0i, 0.09498578369742328 + -0.023319239398934603i, 6.776263578034403e-19 + 6.505213034913027e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 9.75781955236954e-19 + 4.336808689942018e-19i, 0.45772691510715446 + -1.3062095079608564e-17i, -6.505213034913027e-19 + -2.168404344971009e-19i, 0.26758886635824386 + -0.06569371322949541i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09498578369742325 + 0.023319239398934592i, -2.168404344971009e-19 + 4.336808689942018e-19i, 0.09949688011137302 + 1.1485766764768313e-18i, -2.168404344971009e-19 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 4.607859233063394e-19 + 0.0i, 0.2675888663582438 + 0.06569371322949538i, -7.047314121155779e-19 + 4.336808689942018e-19i, 0.28029728574957957 + 7.90620552967164e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1624789190318925, 1.0e-7), DoubleNear(0.45772691510715446, 1.0e-7), DoubleNear(0.09949688011137302, 1.0e-7), DoubleNear(0.28029728574957957, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.08335486463227701 + -2.536890656647813e-18i, -0.0023510029603795073 + -0.0025174982143921346i, -0.03454356235635166 + 0.04294863080623436i, 0.002271434541491702 + -0.0001680645956375304i, -0.004817150644576159 + 0.01237929760567297i, -0.0001740327853825374 + -0.0046377970079210335i, -0.004382135829109738 + -0.007612213949845643i, 0.0024617488700462986 + 0.001832305300541571i }, { -0.002351002960379506 + 0.002517498214392135i, 0.1942666610834743 + -5.972117727751202e-18i, -0.00032284959158849797 + -0.00225464603115424i, -0.08050714916881645 + 0.10009598289963745i, -3.8076542720210955e-05 + 0.0009318853035235487i, 0.011350327167671209 + 0.007130721738655307i, -0.0004643747980130478 + -0.0004058068310245121i, -0.008377861000646705 + 0.0028931782337256323i }, { -0.03454356235635166 + -0.042948630806234366i, -0.00032284959158849775 + 0.002254646031154238i, 0.06023025776375718 + 2.1234629718694453e-19i, -0.0016987792485980784 + -0.001819084789370796i, 0.008374741285430556 + -0.0026481359566866815i, -0.002317505042156177 + 0.002011646239562923i, -0.003480759356872887 + 0.008944988262091516i, -0.0001257519830327456 + -0.0033511626522982835i }, { 0.0022714345414917 + 0.0001680645956375317i, -0.08050714916881646 + -0.10009598289963745i, -0.0016987792485980784 + 0.001819084789370797i, 0.14037250403537105 + 3.3722036796316726e-18i, 0.0004959338301960504 + -0.0003665689201267498i, -0.0010296459519737785 + -0.008803343935791946i, -2.7513211051428347e-05 + 0.000673358325097038i, 0.008201478510314723 + 0.005152491222384266i }, { -0.004817150644576159 + -0.01237929760567297i, -3.807654272021009e-05 + -0.0009318853035235484i, 0.008374741285430556 + 0.0026481359566866815i, 0.0004959338301960504 + 0.0003665689201267496i, 0.06872883951563005 + -2.3521835149040085e-18i, 0.0023510029603795086 + 0.002517498214392134i, -0.028482308308716616 + 0.03541256490691623i, -0.002271434541491702 + 0.00016806459563753105i }, { -0.0001740327853825374 + 0.004637797007921033i, 0.011350327167671205 + -0.007130721738655308i, -0.002317505042156179 + -0.0020116462395629244i, -0.0010296459519737768 + 0.008803343935791944i, 0.0023510029603795073 + -0.002517498214392135i, 0.23417541098635877 + -7.114541307327737e-18i, 0.00032284959158849797 + 0.00225464603115424i, -0.09704596063370255 + 0.12065898390838256i }, { -0.004382135829109738 + 0.0076122139498456445i, -0.00046437479801304804 + 0.00040580683102451123i, -0.0034807593568728866 + -0.008944988262091516i, -2.7513211051428347e-05 + -0.0006733583250970372i, -0.02848230830871662 + -0.03541256490691624i, 0.0003228495915884971 + -0.002254646031154238i, 0.049661837231601266 + 3.0264973474367e-19i, 0.0016987792485980782 + 0.0018190847893707963i }, { 0.002461748870046298 + -0.0018323053005415695i, -0.008377861000646707 + -0.0028931782337256306i, -0.00012575198303274636 + 0.0033511626522982844i, 0.008201478510314724 + -0.005152491222384265i, -0.0022714345414917 + -0.00016806459563753126i, -0.09704596063370255 + -0.12065898390838259i, 0.001698779248598078 + -0.001819084789370796i, 0.16920962475152987 + 4.5585658055103415e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.08335486463227701, 1.0e-7), DoubleNear(0.1942666610834743, 1.0e-7), DoubleNear(0.06023025776375718, 1.0e-7), DoubleNear(0.14037250403537105, 1.0e-7), DoubleNear(0.06872883951563005, 1.0e-7), DoubleNear(0.23417541098635877, 1.0e-7), DoubleNear(0.049661837231601266, 1.0e-7), DoubleNear(0.16920962475152987, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.08215240775521448 + -2.6407300317784705e-18i, 0.0005485168174629969 + -0.0024217670225019534i, -0.03404524537992952 + 0.04232906436939586i, 0.00102050256137865 + 0.0012862417437969815i, -0.000229325684550934 + 2.193399501930818e-05i, -0.016285801451646785 + 0.010857317505798348i, 8.373465736882072e-05 + -0.00012724995153709544i, 0.0011548537363738874 + -0.012890708934084137i }, { 0.000548516817462997 + 0.0024217670225019534i, 0.16945430557824015 + -5.0438378587429325e-18i, -0.0014751304939205402 + -0.0007209946790178337i, -0.07022452015389116 + 0.08731140576993396i, 0.0019235910515837452 + 0.00042533431490897084i, -0.001565606145058239 + 0.00047702302663249783i, -0.0010163199745146898 + 0.0008148659321436988i, 0.0004030253997603688 + -0.0010043650763191965i }, { -0.03404524537992953 + -0.04232906436939586i, -0.0014751304939205389 + 0.0007209946790178326i, 0.05936139080590439 + 2.4407969341637784e-19i, 0.0003963453056914828 + -0.0017499116896481364i, 0.00010633765860566208 + 0.00010907036890527384i, 0.012343329013965142 + 0.0038918238434825932i, -0.00016570532689707396 + 1.5848987094273915e-05i, -0.011767735736232354 + 0.00784524136512084i }, { 0.00102050256137865 + -0.0012862417437969802i, -0.07022452015389116 + -0.08731140576993396i, 0.00039634530569148275 + 0.0017499116896481366i, 0.12244368159172517 + 3.1960110778624293e-18i, -0.0005780125873973124 + -0.001167396345195676i, 0.0008945980499540413 + 0.0006089934387167868i, 0.001389941491478142 + 0.00030733653681465443i, -0.0011312700475176092 + 0.0003446855799007265i }, { -0.00022932568455093406 + -2.1933995019308235e-05i, 0.001923591051583746 + -0.0004253343149089704i, 0.00010633765860566207 + -0.00010907036890527397i, -0.0005780125873973128 + 0.001167396345195676i, 0.06993129639269256 + -2.248344139773351e-18i, -0.0005485168174629955 + 0.0024217670225019534i, -0.028980625285138756 + 0.03603213134375473i, -0.0010205025613786497 + -0.0012862417437969809i }, { -0.016285801451646785 + -0.01085731750579835i, -0.001565606145058239 + -0.00047702302663249913i, 0.012343329013965142 + -0.0038918238434825945i, 0.0008945980499540415 + -0.0006089934387167875i, -0.0005485168174629959 + -0.0024217670225019534i, 0.25898776649159294 + -8.042821176336006e-18i, 0.0014751304939205402 + 0.0007209946790178337i, -0.10732858964862785 + 0.13344356103808605i }, { 8.373465736882061e-05 + 0.00012724995153709523i, -0.00101631997451469 + -0.0008148659321436989i, -0.00016570532689707393 + -1.5848987094273887e-05i, 0.0013899414914781416 + -0.00030733653681465486i, -0.028980625285138756 + -0.03603213134375474i, 0.0014751304939205384 + -0.0007209946790178326i, 0.05053070418945406 + 2.709163385142367e-19i, -0.00039634530569148296 + 0.0017499116896481366i }, { 0.0011548537363738872 + 0.012890708934084135i, 0.0004030253997603693 + 0.0010043650763191967i, -0.011767735736232356 + -0.007845241365120837i, -0.0011312700475176094 + -0.000344685579900726i, -0.0010205025613786497 + 0.0012862417437969806i, -0.10732858964862785 + -0.13344356103808608i, -0.0003963453056914832 + -0.0017499116896481362i, 0.18713844719517575 + 4.734758407279585e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.08215240775521448, 1.0e-7), DoubleNear(0.16945430557824015, 1.0e-7), DoubleNear(0.05936139080590439, 1.0e-7), DoubleNear(0.12244368159172517, 1.0e-7), DoubleNear(0.06993129639269256, 1.0e-7), DoubleNear(0.25898776649159294, 1.0e-7), DoubleNear(0.05053070418945406, 1.0e-7), DoubleNear(0.18713844719517575, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.15208370414790706 + -4.8890741715518216e-18i, 1.4094628242311558e-18 + 0.0i, -0.06302587066506828 + 0.07836119571315059i, 2.168404344971009e-19 + 6.505213034913027e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 1.0842021724855044e-18 + 0.0i, 0.4284420720698331 + -1.3086659035078939e-17i, 0.0 + 0.0i, -0.177553109802519 + 0.22075496680802i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06302587066506829 + -0.0783611957131506i, -4.336808689942018e-19 + 0.0i, 0.10989209499535846 + 5.149960319306146e-19i, -1.6263032587282567e-19 + 2.168404344971009e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 2.168404344971009e-19 + 4.336808689942018e-19i, -0.177553109802519 + -0.22075496680802004i, -4.336808689942018e-19 + 4.336808689942018e-19i, 0.30958212878690095 + 7.930769485142014e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.15208370414790706, 1.0e-7), DoubleNear(0.4284420720698331, 1.0e-7), DoubleNear(0.10989209499535846, 1.0e-7), DoubleNear(0.30958212878690095, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.07062959225173487 + -1.1697318745096098e-18i, 0.00018359721605962567 + -0.003459428458168585i, 0.0003618221069137165 + 0.01704931669211851i, 0.001519149531499405 + -0.0010213157075305822i, -0.00027241505473105966 + -0.0005630454832881767i, -0.019006420167439274 + 0.007079380009298223i, -0.00018147185213815724 + 0.00044275839706914847i, -0.015991019340645406 + 0.014818902526208395i }, { 0.00018359721605962649 + 0.003459428458168585i, 0.13679352293014174 + -1.054557842402799e-18i, -0.004616402760107318 + 0.0017493508998026363i, 0.023129549101495638 + -0.016994297549020855i, 0.0008884379733707214 + 0.00030314337676625466i, -0.0014714612707741141 + -0.0005938477435192004i, -0.007336636786035844 + -0.002485865436098969i, 0.0014676095700315262 + -0.0009262749869073855i }, { 0.0003618221069137162 + -0.01704931669211851i, -0.004616402760107317 + -0.0017493508998026354i, 0.070884206309384 + -1.2269184638524828e-18i, 0.0007612649070948541 + -0.0007122502539815049i, -0.00012578160732139537 + -0.00037085438654819265i, 0.004229172546211343 + 0.0043554203297291455i, -0.00012261595671694828 + 0.0006008284654017589i, -0.009047117020439865 + 0.011623178861620963i }, { 0.0015191495314994048 + 0.0010213157075305826i, 0.023129549101495638 + 0.016994297549020855i, 0.0007612649070948533 + 0.0007122502539815049i, 0.1551044642398236 + -7.932689384777044e-19i, -0.005952903136614217 + -0.014369163677683247i, 0.002514244477960334 + 0.0004971342764076498i, 0.002425094569691166 + 0.00042952747495737066i, -0.001225414921801734 + 0.0014155563500524247i }, { -0.0002724150547310598 + 0.0005630454832881766i, 0.000888437973370722 + -0.0003031433767662549i, -0.0001257816073213953 + 0.00037085438654819276i, -0.005952903136614217 + 0.014369163677683247i, 0.07295553014429931 + -1.1548124849512586e-18i, -0.004233379425037211 + -0.0008771545455943456i, -0.008659732108362763 + 0.004274969175645974i, -0.001818934299914688 + -0.006967643952688735i }, { -0.019006420167439274 + -0.007079380009298222i, -0.0014714612707741144 + 0.0005938477435192i, 0.004229172546211343 + -0.004355420329729145i, 0.002514244477960335 + -0.0004971342764076493i, -0.004233379425037211 + 0.0008771545455943463i, 0.19784564218870362 + -1.5453562057167304e-18i, 0.0045508130063356775 + -0.0001441072711820495i, -0.003577743423509705 + 0.029277510510060428i }, { -0.00018147185213815707 + -0.0004427583970691487i, -0.007336636786035841 + 0.0024858654360989693i, -0.00012261595671694814 + -0.0006008284654017587i, 0.002425094569691166 + -0.0004295274749573704i, -0.008659732108362763 + -0.0042749691756459735i, 0.004550813006335678 + 0.00014410727118204983i, 0.04750647043784731 + -8.226153163078558e-19i, 0.0032885173018827327 + 0.005048833257744436i }, { -0.015991019340645403 + -0.014818902526208395i, 0.0014676095700315262 + 0.000926274986907386i, -0.009047117020439865 + -0.011623178861620965i, -0.001225414921801734 + -0.001415556350052425i, -0.0018189342999146887 + 0.006967643952688734i, -0.003577743423509706 + -0.029277510510060428i, 0.003288517301882732 + -0.005048833257744436i, 0.24828057149806504 + -1.762706563339691e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.07062959225173487, 1.0e-7), DoubleNear(0.13679352293014174, 1.0e-7), DoubleNear(0.070884206309384, 1.0e-7), DoubleNear(0.1551044642398236, 1.0e-7), DoubleNear(0.07295553014429931, 1.0e-7), DoubleNear(0.19784564218870362, 1.0e-7), DoubleNear(0.04750647043784731, 1.0e-7), DoubleNear(0.24828057149806504, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.1435851223960342 + -2.3245443594608684e-18i, -0.004049782208977585 + -0.004336583003762931i, -0.008297910001449046 + 0.021324285867764484i, -0.000299784768415283 + -0.007988959660219317i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.004049782208977584 + 0.0043365830037629316i, 0.3346391651188454 + -2.5999140481195296e-18i, -6.558975377164017e-05 + 0.0016052436286205867i, 0.019551805677985933 + 0.012283212961039573i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008297910001449046 + -0.021324285867764484i, -6.558975377163843e-05 + -0.0016052436286205856i, 0.1183906767472313 + -2.0495337801603386e-18i, 0.004049782208977587 + 0.004336583003762931i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00029978476841528386 + 0.007988959660219317i, 0.01955180567798593 + -0.012283212961039573i, 0.004049782208977585 + -0.004336583003762931i, 0.40338503573788864 + -2.5559755018173954e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1435851223960342, 1.0e-7), DoubleNear(0.3346391651188454, 1.0e-7), DoubleNear(0.1183906767472313, 1.0e-7), DoubleNear(0.40338503573788864, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.14151379856111887 + -2.3966503383620924e-18i, 0.0009448621231544798 + -0.0041716787121500905i, -0.0003950310114480079 + 3.7782982113582176e-05i, -0.02805353718787914 + 0.018702558870919185i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0009448621231544798 + 0.0041716787121500905i, 0.29189798716996535 + -1.847826780880503e-18i, 0.0033135325430618872 + 0.0007326708517236254i, -0.0026968761925758485 + 0.0008217086065332242i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00039503101144800797 + -3.778298211358207e-05i, 0.0033135325430618877 + -0.0007326708517236253i, 0.12046200058214662 + -1.9774278012591146e-18i, -0.0009448621231544782 + 0.0041716787121500905i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02805353718787914 + -0.018702558870919185i, -0.0026968761925758485 + -0.0008217086065332251i, -0.0009448621231544791 + -0.00417167871215009i, 0.44612621368676864 + -3.3080627690564214e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.14151379856111887, 1.0e-7), DoubleNear(0.29189798716996535, 1.0e-7), DoubleNear(0.12046200058214662, 1.0e-7), DoubleNear(0.44612621368676864, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.26129556687772615 + -9.651038747333684e-18i, -0.0995602286673167 + -0.008900143376032843i, 0.09971259284019883 + -0.005606052738148402i, -0.03818397432664161 + -0.0012603217271449675i, -0.09066263741206532 + 0.084278187787325i, 0.037415410387278344 + -0.029024010114589334i, -0.07707223508587013 + 0.18782575697437184i, 0.035764118111530165 + -0.0689411672255215i }, { -0.0995602286673167 + 0.008900143376032822i, 0.24523372172001678 + -9.756180140156846e-18i, -0.03780207214789955 + 0.00553241787634812i, 0.09358325721613729 + -0.005261448533407994i, 0.031674111644690674 + -0.035200237912547i, -0.08508960277889994 + 0.0790976054353641i, 0.022968828954817666 + -0.07419157350506275i, -0.07233460283018353 + 0.17628010290453583i }, { 0.09971259284019883 + 0.0056060527381483986i, -0.03780207214789956 + -0.005532417876348113i, 0.03817144361613122 + 1.3053990507333944e-18i, -0.014544286764581794 + -0.0013001801948392807i, -0.03640580178672009 + 0.030216115764146637i, 0.014900741561729372 + -0.010273065752207874i, -0.03344118539780436 + 0.07002232159610734i, 0.015127010435233323 + -0.02554121788198153i }, { -0.038183974326641626 + 0.001260321727144978i, 0.09358325721613729 + 0.0052614485334079916i, -0.014544286764581795 + 0.0013001801948392712i, 0.035825044003865936 + 1.2608663012637314e-19i, 0.012842323458573753 + -0.012753144993451681i, -0.03416793622272378 + 0.028358730357764077i, 0.0103568667303486 + -0.027819338006723118i, -0.03138555487881765 + 0.06571804770237416i }, { -0.09066263741206533 + -0.08427818778732502i, 0.03167411164469067 + 0.03520023791254699i, -0.03640580178672011 + -0.03021611576414664i, 0.012842323458573755 + 0.012753144993451678i, 0.058640592116885985 + -2.246501597139481e-20i, -0.02234355075406255 + -0.0019973920098689465i, 0.087323282190959 + -0.04031170649132145i, -0.03464546306158362 + 0.012385410986305866i }, { 0.037415410387278344 + 0.029024010114589324i, -0.08508960277889996 + -0.0790976054353641i, 0.014900741561729373 + 0.010273065752207867i, -0.034167936222723794 + -0.02835873035776408i, -0.02234355075406255 + 0.0019973920098689396i, 0.055035953424417965 + 8.449340077553201e-19i, -0.03189930114393267 + 0.01833415126423792i, 0.08195551780837196 + -0.03783374486555217i }, { -0.07707223508587013 + -0.18782575697437184i, 0.022968828954817666 + 0.07419157350506275i, -0.03344118539780436 + -0.07002232159610736i, 0.010356866730348604 + 0.027819338006723114i, 0.08732328219095899 + 0.04031170649132144i, -0.031899301143932676 + -0.018334151264237923i, 0.15774720136532497 + 3.7377324347737896e-18i, -0.0601056788954646 + -0.005373121044859916i }, { 0.03576411811153016 + 0.06894116722552152i, -0.07233460283018356 + -0.17628010290453583i, 0.015127010435233323 + 0.025541217881981527i, -0.03138555487881765 + -0.06571804770237417i, -0.03464546306158362 + -0.012385410986305866i, 0.08195551780837193 + 0.03783374486555216i, -0.0601056788954646 + 0.00537312104485993i, 0.14805047687563044 + 3.8855640905149135e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.26129556687772615, 1.0e-7), DoubleNear(0.24523372172001678, 1.0e-7), DoubleNear(0.03817144361613122, 1.0e-7), DoubleNear(0.035825044003865936, 1.0e-7), DoubleNear(0.058640592116885985, 1.0e-7), DoubleNear(0.055035953424417965, 1.0e-7), DoubleNear(0.15774720136532497, 1.0e-7), DoubleNear(0.14805047687563044, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.15297834171907418 + -4.6572892585825795e-18i, -0.05829734805916016 + -0.005186087568776549i, 0.0894317106705165 + -0.021955701051278503i, -0.0348251634375427 + 0.005335124266186908i, 0.0008517834665688574 + 0.012895108747192066i, 0.0013691313941764224 + -0.0011732678697095832i, 0.0023486828342864164 + 0.007416279446111033i, 0.0006320100154506873 + -0.000882396754576058i }, { -0.05829734805916016 + 0.005186087568776542i, 0.14361915142464324 + -4.243850299365639e-18i, -0.03333653194884599 + 0.01139873664099613i, 0.08396029302331176 + -0.02061245479904819i, -0.004112916226543956 + -0.007020494378552006i, 0.00612794828881152 + 0.007948458097253405i, -0.0034120190082236913 + -0.0035139148252427005i, 0.004723197153605286 + 0.0037672051982479754i }, { 0.08943171067051649 + 0.02195570105127849i, -0.033336531948846004 + -0.011398736640996127i, 0.0936790312020215 + 2.222658707619428e-18i, -0.03569942664078593 + -0.0031757937346712506i, -0.0013527712342508462 + 0.007660778150205373i, 0.0009687886510528283 + -0.0004893968141575697i, 0.0005216048823996418 + 0.007896551113751848i, 0.0008384121644503882 + -0.0007184716224515656i }, { -0.03482516343754271 + -0.0053351242661869025i, 0.08396029302331176 + 0.020612454799048184i, -0.03569942664078593 + 0.003175793734671254i, 0.08794776316914063 + 1.754022442748392e-18i, -0.0013968334064510188 + -0.004694499712020726i, 0.0024416458197258403 + 0.005526191459635377i, -0.0025186180160408364 + -0.004299125644528982i, 0.0037525590387568657 + 0.004867380870606739i }, { 0.0008517834665688565 + -0.012895108747192068i, -0.004112916226543956 + 0.007020494378552006i, -0.001352771234250847 + -0.007660778150205374i, -0.001396833406451018 + 0.004694499712020725i, 0.16695781727553796 + -5.0162145047225e-18i, -0.0636064313622191 + -0.005711447817125237i, 0.09760416436064133 + -0.023962058178191352i, -0.038004273950682524 + 0.005789964992973989i }, { 0.0013691313941764224 + 0.0011732678697095817i, 0.006127948288811518 + -0.007948458097253409i, 0.000968788651052829 + 0.0004893968141575699i, 0.0024416458197258407 + -0.005526191459635377i, -0.06360643136221909 + 0.005711447817125223i, 0.15665052371979152 + -4.667395833035886e-18i, -0.03636484134298623 + 0.01246783249958991i, 0.09157848200119749 + -0.022482738599911973i }, { 0.0023486828342864155 + -0.007416279446111031i, -0.0034120190082236918 + 0.0035139148252427022i, 0.0005216048823996431 + -0.007896551113751848i, -0.002518618016040836 + 0.004299125644528982i, 0.09760416436064133 + 0.02396205817819134i, -0.03636484134298623 + -0.012467832499589906i, 0.10223961377943469 + 2.8204727778877564e-18i, -0.03895053901926046 + -0.0034975075050279417i }, { 0.0006320100154506873 + 0.0008823967545760585i, 0.004723197153605286 + -0.003767205198247976i, 0.0008384121644503888 + 0.0007184716224515654i, 0.003752559038756867 + -0.004867380870606737i, -0.03800427395068254 + -0.005789964992973986i, 0.09157848200119748 + 0.022482738599911966i, -0.03895053901926046 + 0.003497507505027945i, 0.09592775771035575 + 2.2576282778928943e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.15297834171907418, 1.0e-7), DoubleNear(0.14361915142464324, 1.0e-7), DoubleNear(0.0936790312020215, 1.0e-7), DoubleNear(0.08794776316914063, 1.0e-7), DoubleNear(0.16695781727553796, 1.0e-7), DoubleNear(0.15665052371979152, 1.0e-7), DoubleNear(0.10223961377943469, 1.0e-7), DoubleNear(0.09592775771035575, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.10240077808673759 + -1.6707265187490444e-18i, -0.0528345347263882 + 0.03546513691294613i, 0.059863877823346984 + -0.014696726646569422i, -0.025797252309778015 + 0.028315950246600954i, -0.0006991483462195226 + 0.0012006272695560417i, -0.001551554150310201 + 0.0004313026405793046i, -0.00023640875436408033 + 0.000802234102521046i, -0.0008451431004423959 + 0.000474822718278572i }, { -0.052834534726388216 + -0.03546513691294613i, 0.1664037400083035 + -6.322243959408693e-18i, -0.035977280868764804 + -0.013150153093874538i, 0.0972802487181027 + -0.023882536105314857i, 0.007710163697483282 + -0.0021432793443647295i, -0.0012184705403326225 + -0.0006675655718838549i, 0.0041997835853209865 + -0.002359544386175536i, -0.0008081325340747107 + -0.00021538445105836584i }, { 0.059863877823346984 + 0.014696726646569423i, -0.03597728086876481 + 0.013150153093874545i, 0.06270695300851654 + -1.129439560234781e-19i, -0.03235417492148484 + 0.021717712652114578i, -0.0005810407213230797 + 0.0006015482811479742i, -0.0009689456169656294 + 2.9459555019315463e-05i, -0.00042813602895901956 + 0.0007352256416354819i, -0.0009501220109017076 + 0.00026411590732588574i }, { -0.025797252309778026 + -0.028315950246600958i, 0.0972802487181027 + 0.023882536105314843i, -0.03235417492148484 + -0.021717712652114578i, 0.10190031462752658 + 3.861437314938619e-18i, 0.0048149974780257055 + -0.00014639385393576745i, -0.0006165123352452161 + -0.0005651382086518452i, 0.004721457021122697 + -0.001312475546009645i, -0.0007461522885126914 + -0.00040879575066086245i }, { -0.0006991483462195224 + -0.001200627269556043i, 0.00771016369748328 + 0.0021432793443647343i, -0.0005810407213230803 + -0.0006015482811479742i, 0.004814997478025707 + 0.00014639385393576702i, 0.21753538090787455 + -8.002777244556035e-18i, -0.06906924469499107 + -0.04636267229884791i, 0.12717199720781083 + -0.031221032582900432i, -0.04703218507844721 + -0.01719086098744006i }, { -0.0015515541503102023 + -0.00043130264057930395i, -0.0012184705403326225 + 0.0006675655718838542i, -0.0009689456169656275 + -2.9459555019317198e-05i, -0.0006165123352452147 + 0.0005651382086518452i, -0.06906924469499104 + 0.0463626722988479i, 0.13386593513613126 + -2.589002172992832e-18i, -0.03372409242306742 + 0.03701672223446058i, 0.07825852630640655 + -0.019212657293645307i }, { -0.00023640875436408153 + -0.0008022341025210469i, 0.0041997835853209865 + 0.002359544386175535i, -0.00042813602895902026 + -0.0007352256416354816i, 0.004721457021122697 + 0.0013124755460096468i, 0.12717199720781083 + 0.03122103258290041i, -0.033724092423067425 + -0.03701672223446058i, 0.13321169197293964 + 5.156075441530662e-18i, -0.04229579073856156 + -0.02839101389181377i }, { -0.0008451431004423956 + -0.00047482271827857373i, -0.0008081325340747103 + 0.00021538445105836627i, -0.0009501220109017068 + -0.00026411590732588867i, -0.000746152288512691 + 0.0004087957506608631i, -0.04703218507844722 + 0.01719086098744007i, 0.07825852630640655 + 0.01921265729364531i, -0.04229579073856156 + 0.028391013891813775i, 0.0819752062519698 + 1.502134057026672e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.10240077808673759, 1.0e-7), DoubleNear(0.1664037400083035, 1.0e-7), DoubleNear(0.06270695300851654, 1.0e-7), DoubleNear(0.10190031462752658, 1.0e-7), DoubleNear(0.21753538090787455, 1.0e-7), DoubleNear(0.13386593513613126, 1.0e-7), DoubleNear(0.13321169197293964, 1.0e-7), DoubleNear(0.0819752062519698, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.31993615899461214 + -9.673503763305079e-18i, -0.12190377942137927 + -0.010897535385901783i, 0.18703587503115782 + -0.045917759229469855i, -0.07282943738822523 + 0.011125089259160895i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.12190377942137925 + 0.010897535385901769i, 0.30026967514443476 + -8.911246132401525e-18i, -0.06970137329183222 + 0.02386656914058604i, 0.17553877502450926 + -0.04309519339896016i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.18703587503115782 + 0.045917759229469834i, -0.06970137329183224 + -0.023866569140586033i, 0.19591864498145617 + 5.043131485507184e-18i, -0.07464996566004639 + -0.006673301239699191i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.07282943738822524 + -0.011125089259160888i, 0.17553877502450926 + 0.043095193398960153i, -0.07464996566004639 + 0.0066733012396991975i, 0.18387552087949638 + 4.011650720641286e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.31993615899461214, 1.0e-7), DoubleNear(0.30026967514443476, 1.0e-7), DoubleNear(0.19591864498145617, 1.0e-7), DoubleNear(0.18387552087949638, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.14319096287484773 + -3.993756376011021e-18i, -0.054567550594650266 + -0.004854287634324651i, -0.0593405793021707 + 0.07377920684571149i, 0.02511482207149938 + -0.0261042616588405i, 0.0007972873373333408 + 0.0120700944796297i, 0.0012815359379063028 + -0.0010982035370886048i, -0.006549529878831908 + -0.0045912336789800025i, 3.476127871276328e-05 + 0.0011154247161891812i }, { -0.054567550594650266 + 0.00485428763432464i, 0.13443056284090357 + -4.515252008387995e-18i, 0.02011247437760972 + -0.030127647416389403i, -0.05571013222299741 + 0.06926540686016032i, -0.003849776563691061 + -0.006571331200388967i, 0.00573588918576171 + 0.007439924864698576i, 0.004981289049518735 + 0.0007396635701636117i, -0.006210466950924537 + -0.000127802037140007i }, { -0.05934057930217071 + -0.07377920684571149i, 0.02011247437760972 + 0.030127647416389396i, 0.10346641004624796 + 1.5591258250478699e-18i, -0.039429224105295826 + -0.0035075936691231525i, 0.005888713141270098 + -0.005412838984169491i, -0.001096938436057219 + -0.0002051991995203799i, 0.0005761010116351602 + 0.008721565381314213i, 0.0009260076207205082 + -0.0007935359550725438i }, { 0.02511482207149938 + 0.026104261658840493i, -0.05571013222299741 + -0.06926540686016032i, -0.039429224105295826 + 0.0035075936691231577i, 0.09713635175288027 + 2.0254241517707475e-18i, -0.0017904735554848472 + 0.0047068617187030135i, 0.0014563821921866798 + -0.006038640908309136i, -0.002781757678893731 + -0.004748288822692021i, 0.004144618141806677 + 0.005375914103161569i }, { 0.0007972873373333399 + -0.0120700944796297i, -0.0038497765636910613 + 0.006571331200388967i, 0.005888713141270098 + 0.00541283898416949i, -0.0017904735554848475 + -0.004706861718703014i, 0.15627604761900965 + -4.351883320589268e-18i, -0.05953696483724824 + -0.0053460359365474705i, -0.06476324350769898 + 0.08052130253772086i, 0.027427598751012285 + -0.028460966337730365i }, { 0.0012815359379063028 + 0.0010982035370886041i, 0.005735889185761707 + -0.007439924864698575i, -0.0010969384360572198 + 0.0002051991995203799i, 0.0014563821921866802 + 0.006038640908309135i, -0.059536964837248234 + 0.005346035936547453i, 0.14662820288297912 + -5.1148415016424774e-18i, 0.02191850399742955 + -0.03289192850288071i, -0.06076502543472019 + 0.07555024627757793i }, { -0.006549529878831907 + 0.004591233678980004i, 0.0049812890495187345 + -0.0007396635701636114i, 0.0005761010116351602 + -0.008721565381314213i, -0.00278175767889373 + 0.004748288822692021i, -0.06476324350769899 + -0.08052130253772087i, 0.021918503997429548 + 0.03289192850288071i, 0.11292138343596299 + 2.1561415937545253e-18i, -0.04302000554423133 + -0.003862919385605708i }, { 3.476127871276309e-05 + -0.0011154247161891816i, -0.006210466950924538 + 0.00012780203714000786i, 0.0009260076207205084 + 0.0007935359550725429i, 0.004144618141806677 + -0.0053759141031615686i, 0.027427598751012285 + 0.028460966337730355i, -0.06076502543472019 + -0.07555024627757795i, -0.04302000554423133 + 0.0038629193856057117i, 0.10595007854716812 + 2.7050739464994857e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.14319096287484773, 1.0e-7), DoubleNear(0.13443056284090357, 1.0e-7), DoubleNear(0.10346641004624796, 1.0e-7), DoubleNear(0.09713635175288027, 1.0e-7), DoubleNear(0.15627604761900965, 1.0e-7), DoubleNear(0.14662820288297912, 1.0e-7), DoubleNear(0.11292138343596299, 1.0e-7), DoubleNear(0.10595007854716812, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.09584929375362236 + -4.329663440057385e-18i, -0.04945424179331921 + 0.033196118130099136i, -0.039721449614212825 + 0.0493863909277898i, 0.0033902983905082715 + -0.03923831156859575i, -0.0006544176369186543 + 0.0011238125139128319i, -0.0014522874953329604 + 0.000403708392318875i, -0.0003078439683235497 + -0.0008029144960831479i, 0.000393839772928982 + -0.0009155948584656807i }, { -0.04945424179331921 + -0.03319611813009915i, 0.1557574195798323 + -3.354904450464018e-18i, 0.03759892743836099 + -0.01172432827140829i, -0.06454831591960786 + 0.08025407921154001i, 0.007216876267313279 + -0.0020061547901528342i, -0.0011405141926905187 + -0.0006248554922610259i, -0.00195711449661941 + 0.004549880671540248i, 0.0007946040254527393 + -0.00032870053177314426i }, { -0.039721449614212825 + -0.049386390927789806i, 0.037598927438360984 + 0.011724328271408287i, 0.06925843734163178 + 2.5459929652848633e-18i, -0.03573446785455383 + 0.023986731434961564i, 0.0008502458196785396 + -0.00012853654333618676i, 0.0008098616277198761 + 0.0005809886879591184i, -0.00047286673825988786 + 0.0008120403972786918i, -0.001049388665878948 + 0.0002917101555863153i }, { 0.003390298390508271 + 0.039238311568595745i, -0.06454831591960786 + -0.08025407921154003i, -0.035734467854553836 + -0.02398673143496156i, 0.11254663505599777 + 8.940978059939438e-19i, -0.004024458779464516 + -0.0028871166949959504i, 0.00015068988888116374 + 0.0008466003509582474i, 0.0052147444512927014 + -0.0014496001002215404i, -0.0008241086361547952 + -0.0004515058302836914i }, { -0.0006544176369186538 + -0.0011238125139128327i, 0.007216876267313276 + 0.0020061547901528403i, 0.0008502458196785385 + 0.000128536543336186i, -0.004024458779464516 + 0.0028871166949959526i, 0.20361771674023504 + -4.015976256542904e-18i, -0.0646502736385793 + -0.04339644170097126i, -0.08438237319565686 + 0.10491411845564255i, 0.0491521224320034 + -0.015326916427975108i }, { -0.0014522874953329617 + -0.00040370839231887586i, -0.0011405141926905194 + 0.0006248554922610254i, 0.0008098616277198724 + -0.0005809886879591198i, 0.00015068988888116498 + -0.0008466003509582476i, -0.06465027363857928 + 0.04339644170097125i, 0.12530134614405042 + -6.2751890595664535e-18i, 0.004432050936678285 + -0.05129524764786182i, -0.051926841738109734 + 0.06456157392619823i }, { -0.0003078439683235507 + 0.0008029144960831472i, -0.0019571144966194108 + -0.004549880671540246i, -0.00047286673825988883 + -0.0008120403972786917i, 0.0052147444512927014 + 0.0014496001002215415i, -0.08438237319565686 + -0.10491411845564255i, 0.004432050936678283 + 0.05129524764786182i, 0.14712935614057915 + 1.1692744535175319e-18i, -0.04671476179497332 + -0.03135724448969042i }, { 0.0003938397729289847 + 0.0009155948584656825i, 0.0007946040254527406 + 0.00032870053177314464i, -0.0010493886658789475 + -0.00029171015558631687i, -0.0008241086361547943 + 0.00045150583028369195i, 0.0491521224320034 + 0.015326916427975103i, -0.051926841738109734 + -0.06456157392619824i, -0.04671476179497332 + 0.03135724448969043i, 0.09053979524405062 + 3.8364002922762894e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.09584929375362236, 1.0e-7), DoubleNear(0.1557574195798323, 1.0e-7), DoubleNear(0.06925843734163178, 1.0e-7), DoubleNear(0.11254663505599777, 1.0e-7), DoubleNear(0.20361771674023504, 1.0e-7), DoubleNear(0.12530134614405042, 1.0e-7), DoubleNear(0.14712935614057915, 1.0e-7), DoubleNear(0.09053979524405062, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.2994670104938574 + -8.345639696600289e-18i, -0.1141045154318985 + -0.010200323570872125i, -0.12410382280986969 + 0.15430050938343234i, 0.05254242082251167 + -0.05456522799657086i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11410451543189849 + 0.010200323570872097i, 0.2810587657238827 + -9.630093510030471e-18i, 0.042030978375039274 + -0.06301957591927011i, -0.1164751576577176 + 0.14481565313773825i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.12410382280986969 + -0.15430050938343237i, 0.04203097837503927 + 0.06301957591927011i, 0.21638779348221093 + 3.715267418802395e-18i, -0.08244922964952714 + -0.0073705130547288555i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.05254242082251167 + 0.05456522799657085i, -0.1164751576577176 + -0.14481565313773825i, -0.08244922964952715 + 0.007370513054728873i, 0.2030864303000484 + 4.730498098270233e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2994670104938574, 1.0e-7), DoubleNear(0.2810587657238827, 1.0e-7), DoubleNear(0.21638779348221093, 1.0e-7), DoubleNear(0.2030864303000484, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.07901760185552105 + -8.188787049368028e-19i, -0.040769790105453785 + 0.027366687252757i, 0.008949011374931502 + 2.095948052805287e-05i, -0.0046245760232513896 + 0.003088555918762234i, -0.0014354754901612235 + 0.0002710176076968179i, -0.0014109782550849315 + -0.0009360475640423542i, 0.00040754181074438166 + -0.0008682522490943296i, 0.0010406198687664438 + -0.00039121546881309955i }, { -0.0407697901054538 + -0.027366687252757003i, 0.12840551332635558 + -1.4054110119756064e-18i, -0.004610057952970283 + -0.0031101843560162653i, 0.014542359833477854 + 3.4059662569604454e-05i, 0.007011597576609971 + 0.004651516639592703i, -0.00030840083534395017 + -0.001427910834504195i, -0.005171169522790262 + 0.0019440734987777332i, 0.0008785959071489872 + 0.00038473565925609257i }, { 0.0089490113749315 + -2.0959480528053086e-05i, -0.004610057952970282 + 0.003110184356016265i, 0.08609012923973308 + -9.647917698357195e-19i, -0.04441891954241925 + 0.029816162312303704i, 0.0012557439673214431 + -0.0011003105374013747i, 0.0019325161562549578 + 0.00010217363240744789i, 0.00030819111498268134 + 0.0016648353034947059i, -0.0010906979061269771 + 0.0016314661119475446i }, { -0.00462457602325139 + -0.0030885559187622345i, 0.01454235983347785 + -3.4059662569604346e-05i, -0.044418919542419256 + -0.02981616231230371i, 0.1398985413094745 + -1.0553956324944679e-18i, -0.009603284493665886 + -0.0005077331211871627i, 0.0011327189033174957 + 0.0012265904272608318i, 0.005420023141996009 + -0.008107271529967076i, -0.001656221993501364 + 0.00035154951195947773i }, { -0.001435475490161224 + -0.0002710176076968184i, 0.007011597576609971 + -0.004651516639592699i, 0.0012557439673214436 + 0.0011003105374013747i, -0.009603284493665886 + 0.0005077331211871599i, 0.16763977106557465 + -1.6157518460263485e-18i, -0.0532269845944923 + -0.03572856855620481i, -0.007575623025963001 + 0.02077070038041586i, 0.006832119581878201 + -0.004980295410923383i }, { -0.0014109782550849332 + 0.0009360475640423527i, -0.0003084008353439501 + 0.001427910834504195i, 0.0019325161562549578 + -0.00010217363240744726i, 0.001132718903317496 + -0.0012265904272608312i, -0.0532269845944923 + 0.0357285685562048i, 0.10316140126742829 + -1.0844168446416408e-18i, -0.002021476289614508 + -0.008209435667064724i, -0.004661852505909466 + 0.012781779305290541i }, { 0.000407541810744382 + 0.0008682522490943299i, -0.005171169522790264 + -0.001944073498777735i, 0.00030819111498268134 + -0.001664835303494706i, 0.005420023141996006 + 0.00810727152996708i, -0.007575623025963001 + -0.02077070038041586i, -0.002021476289614509 + 0.008209435667064724i, 0.18310730181523954 + -1.2309499569990235e-18i, -0.05813805083906031 + -0.03902511763445688i }, { 0.0010406198687664442 + 0.0003912154688131004i, 0.000878595907148987 + -0.00038473565925609257i, -0.0010906979061269758 + -0.0016314661119475455i, -0.0016562219935013635 + -0.0003515495119594776i, 0.006832119581878201 + 0.004980295410923381i, -0.004661852505909466 + -0.01278177930529054i, -0.058138050839060304 + 0.039025117634456874i, 0.11267974012067278 + -1.3543719226485237e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.07901760185552105, 1.0e-7), DoubleNear(0.12840551332635558, 1.0e-7), DoubleNear(0.08609012923973308, 1.0e-7), DoubleNear(0.1398985413094745, 1.0e-7), DoubleNear(0.16763977106557465, 1.0e-7), DoubleNear(0.10316140126742829, 1.0e-7), DoubleNear(0.18310730181523954, 1.0e-7), DoubleNear(0.11267974012067278, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.24665737292109569 + -2.4346305509631515e-18i, -0.09399677469994608 + -0.008361881303447807i, 0.0013733883489685014 + 0.020791659860943914i, 0.0022075435586268117 + -0.001891739492161149i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0939967746999461 + 0.008361881303447796i, 0.23156691459378387 + -2.4898278566172472e-18i, -0.006631534242584791 + -0.01131962002308099i, 0.009880507327568388 + 0.012815838967860146i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0013733883489684996 + -0.020791659860943914i, -0.006631534242584791 + 0.01131962002308099i, 0.2691974310549726 + -2.195741726834743e-18i, -0.10255697038147957 + -0.009208955322153177i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002207543558626811 + 0.0018917394921611468i, 0.009880507327568384 + -0.012815838967860144i, -0.10255697038147957 + 0.009208955322153163i, 0.25257828143014727 + -2.4097675551429917e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.24665737292109569, 1.0e-7), DoubleNear(0.23156691459378387, 1.0e-7), DoubleNear(0.2691974310549726, 1.0e-7), DoubleNear(0.25257828143014727, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.16510773109525412 + -1.7836704747725223e-18i, -0.08518870964787303 + 0.0571828495650607i, -0.0011272843751785422 + 0.0019358529111915238i, -0.002501676161211909 + 0.0006954185479051903i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08518870964787306 + -0.057182849565060714i, 0.26830405463583007 + -2.460806644470074e-18i, 0.012431620718605981 + -0.0034557548903743733i, -0.001964622828845314 + -0.0010763613225447174i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0011272843751785426 + -0.0019358529111915244i, 0.012431620718605978 + 0.003455754890374381i, 0.3507470728808142 + -2.846701803025372e-18i, -0.11136503543355261 + -0.0747536861906617i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002501676161211909 + -0.0006954185479051927i, -0.0019646228288453136 + 0.0010763613225447174i, -0.11136503543355261 + 0.07475368619066167i, 0.21584114138810107 + -2.4387887672901645e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.16510773109525412, 1.0e-7), DoubleNear(0.26830405463583007, 1.0e-7), DoubleNear(0.3507470728808142, 1.0e-7), DoubleNear(0.21584114138810107, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.24223460814507455 + -9.225644687283075e-18i, 0.09243877017277438 + -0.005197103052657108i, -0.08404898984446839 + 0.07813027231109883i, -0.0714499786122559 + 0.17412426542058326i, 0.005700427770989449 + 0.017023182473303606i, 0.002540560867497383 + 0.0063738883288062785i, -0.007468549155413238 + -0.0040679790733779515i, -0.013918096226709614 + -0.000923580767986109i }, { 0.09243877017277438 + 0.005197103052657105i, 0.03538691757067676 + 7.166363028840594e-19i, -0.03375007557682809 + 0.028011914052944467i, -0.031001721680699718 + 0.06491434139477298i, 0.0018101017949856656 + 0.006618491779955733i, 0.0008327487521056014 + 0.0024868368710246704i, -0.002762783557501021 + -0.001712611609971526i, -0.005291447674343206 + -0.000651056642742058i }, { -0.0840489898444684 + -0.07813027231109881i, -0.033750075576828104 + -0.028011914052944478i, 0.05436288499864286 + 3.2450512933485634e-19i, 0.08095323352105388 + -0.037371052797669585i, 0.003512754403359684 + -0.007745207339377164i, 0.0011743245873779657 + -0.0030310020250218965i, 0.0012793039843909297 + 0.003820384371141866i, 0.0045313191203943184 + 0.004809596315552731i }, { -0.0714499786122559 + -0.1741242654205833i, -0.03100172168069972 + -0.064914341394773i, 0.08095323352105387 + 0.03737105279766957i, 0.14623987680048536 + 3.260044847483761e-18i, 0.010555278292172565 + -0.00911879949257208i, 0.0038323409300970953 + -0.0037062725531014627i, -0.0007212272095106715 + 0.006568477829885018i, 0.003441415169050906 + 0.010277095113333915i }, { 0.005700427770989445 + -0.01702318247330361i, 0.0018101017949856673 + -0.006618491779955733i, 0.003512754403359685 + 0.007745207339377165i, 0.010555278292172565 + 0.009118799492572079i, 0.26429468045266835 + -1.0181574200207454e-17i, 0.10085707988356175 + -0.005670398218899289i, -0.09170325034649687 + 0.08524552091159028i, -0.07795685930379778 + 0.18998159445832438i }, { 0.002540560867497381 + -0.006373888328806277i, 0.0008327487521056019 + -0.00248683687102467i, 0.0011743245873779657 + 0.0030310020250218957i, 0.0038323409300970936 + 0.0037062725531014614i, 0.10085707988356175 + 0.005670398218899285i, 0.03860957004932039 + 7.148493779757081e-19i, -0.036823662432615784 + 0.030562932068966243i, -0.03382501859592228 + 0.07082602790370852i }, { -0.0074685491554132375 + 0.004067979073377952i, -0.002762783557501022 + 0.001712611609971527i, 0.0012793039843909289 + -0.003820384371141866i, -0.0007212272095106741 + -0.006568477829885019i, -0.09170325034649689 + -0.08524552091159028i, -0.0368236624326158 + -0.030562932068966247i, 0.05931366054266109 + 4.97963862449069e-19i, 0.08832556647827708 + -0.040774398559204034i }, { -0.013918096226709614 + 0.000923580767986109i, -0.0052914476743432075 + 0.0006510566427420589i, 0.00453131912039432 + -0.004809596315552731i, 0.0034414151690509076 + -0.010277095113333915i, -0.07795685930379778 + -0.18998159445832438i, -0.03382501859592229 + -0.07082602790370854i, 0.08832556647827705 + 0.04077439855920402i, 0.15955780144047005 + 4.363251677804942e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.24223460814507455, 1.0e-7), DoubleNear(0.03538691757067676, 1.0e-7), DoubleNear(0.05436288499864286, 1.0e-7), DoubleNear(0.14623987680048536, 1.0e-7), DoubleNear(0.26429468045266835, 1.0e-7), DoubleNear(0.03860957004932039, 1.0e-7), DoubleNear(0.05931366054266109, 1.0e-7), DoubleNear(0.15955780144047005, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.2195357634962436 + -8.322133195630937e-18i, 0.08377669954732457 + -0.0047101031325400885i, -0.07617309226740472 + 0.07080899428587809i, -0.06475468442163151 + 0.15780777092526937i, -0.0015661415564644419 + 0.00043535766295301045i, -0.0005883123053645887 + 0.00019973746271501825i, 0.0004029894975063745 + -0.0006562003641583108i, 0.00014900615454013647 + -0.0012541954516620583i }, { 0.08377669954732458 + 0.004710103132540086i, 0.032070949837211045 + 6.375653051095333e-19i, -0.03058748981639078 + 0.025387028656620805i, -0.028096673266415958 + 0.058831475853451734i, -0.0006069933572296105 + 0.0001325348517724917i, -0.00022879027314473132 + 6.35993586987955e-05i, 0.00016786286141822843 + -0.00024176552289740513i, 8.377055962281504e-05 + -0.0004754146636979813i }, { -0.07617309226740474 + -0.07080899428587809i, -0.030587489816390787 + -0.025387028656620812i, 0.049268754598797496 + 3.2916271747319945e-19i, 0.07336742699412512 + -0.03386915961934419i, 0.0006838297376331769 + 0.0003540852198983759i, 0.00026855203651435456 + 0.00012045045450044417i, -0.0003514773300877034 + 9.770403471917637e-05i, -0.0004562289830742024 + 0.000387112188747662i }, { -0.06475468442163151 + -0.15780777092526937i, -0.02809667326641596 + -0.05883147585345175i, 0.0733674269941251 + 0.03386915961934418i, 0.13253631779883207 + 3.1109280538056077e-18i, 0.0007748980024260043 + 0.0009973676107117315i, 0.00031710597092652644 + 0.00036397858772368476i, -0.0005905596993386853 + -9.612477927636271e-05i, -0.0009454980443269797 + 0.000262830532275824i }, { -0.0015661415564644416 + -0.0004353576629530124i, -0.0006069933572296108 + -0.0001325348517724919i, 0.0006838297376331762 + -0.0003540852198983759i, 0.000774898002426003 + -0.0009973676107117293i, 0.28699352510149934 + -1.1085085691859592e-17i, 0.10951915050901156 + -0.006157398139016309i, -0.09957914792356054 + 0.09256679893681102i, -0.08465215349442215 + 0.20629808895363827i }, { -0.0005883123053645884 + -0.00019973746271501812i, -0.00022879027314473148 + -6.359935869879494e-05i, 0.000268552036514355 + -0.00012045045450044418i, 0.00031710597092652736 + -0.0003639785877236855i, 0.10951915050901156 + 0.006157398139016304i, 0.04192553778278611 + 7.939203757502343e-19i, -0.0399862481930531 + 0.0331878174652899i, -0.03673006701020605 + 0.07690889344502977i }, { 0.0004029894975063747 + 0.0006562003641583114i, 0.00016786286141822805 + 0.00024176552289740472i, -0.0003514773300877035 + -9.770403471917632e-05i, -0.0005905596993386841 + 9.612477927636292e-05i, -0.09957914792356055 + -0.09256679893681102i, -0.03998624819305311 + -0.03318781746528991i, 0.06440779094250645 + 4.933062743107259e-19i, 0.09591137300520583 + -0.04427629173752943i }, { 0.00014900615454013658 + 0.0012541954516620602i, 8.377055962281518e-05 + 0.0004754146636979803i, -0.00045622898307420346 + -0.00038711218874766236i, -0.0009454980443269798 + -0.00026283053227582344i, -0.08465215349442216 + -0.20629808895363827i, -0.03673006701020605 + -0.0769088934450298i, 0.09591137300520582 + 0.044276291737529415i, 0.17326136044212334 + 4.512368471483096e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2195357634962436, 1.0e-7), DoubleNear(0.032070949837211045, 1.0e-7), DoubleNear(0.049268754598797496, 1.0e-7), DoubleNear(0.13253631779883207, 1.0e-7), DoubleNear(0.28699352510149934, 1.0e-7), DoubleNear(0.04192553778278611, 1.0e-7), DoubleNear(0.06440779094250645, 1.0e-7), DoubleNear(0.17326136044212334, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.5065292885977429 + -1.940721888749053e-17i, 0.19329585005633615 + -0.010867501271556397i, -0.17575224019096525 + 0.1633757932226891i, -0.14940683791605366 + 0.36410585987890765i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.19329585005633615 + 0.01086750127155639i, 0.07399648761999716 + 1.4314856808597676e-18i, -0.07057373800944389 + 0.058574846121910704i, -0.06482674027662201 + 0.1357403692984815i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1757522401909653 + -0.1633757932226891i, -0.0705737380094439 + -0.058574846121910724i, 0.11367654554130395 + 8.224689917839253e-19i, 0.16927879999933093 + -0.07814545135687362i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1494068379160537 + -0.36410585987890765i, -0.06482674027662201 + -0.13574036929848154i, 0.16927879999933093 + 0.07814545135687359i, 0.3057976782409554 + 7.623296525288703e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.5065292885977429, 1.0e-7), DoubleNear(0.07399648761999716, 1.0e-7), DoubleNear(0.11367654554130395, 1.0e-7), DoubleNear(0.3057976782409554, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.12864502617109547 + -3.869855702838754e-18i, 0.07520636340052528 + -0.018463343925725777i, 0.014569485475381522 + 3.412319353849778e-05i, 0.008522273111595004 + -0.0020710877659960115i, -0.0010815622710952729 + -0.0007175119287418836i, -0.0007352638304543553 + -0.0002642325761094235i, 0.0007976701161437476 + -0.00029987980992069097i, 0.0004232816936822508 + -0.00028979377411318707i }, { 0.07520636340052528 + 0.01846334392572577i, 0.07877808901078115 + 1.6455659859263447e-18i, 0.008512478278838588 + 0.0021109848591060027i, 0.00892188573302783 + 2.0895949559159542e-05i, -0.0005293068664664438 + -0.0005746877376134876i, -0.0006623140544099011 + -0.00043938129806549354i, 0.0005093601722949129 + -6.082794260022909e-05i, 0.0004884676017496213 + -0.0001836367799175461i }, { 0.014569485475381519 + -3.412319353849843e-05i, 0.00851247827883859 + -0.002110984859106003i, 0.1401594919239456 + -4.123114775318984e-18i, 0.08193776314092441 + -0.0201159188261585i, 0.0014813386069947665 + 7.831952442527234e-05i, 0.0008772366353468487 + -0.00016681824548408616i, -0.0008360566154568724 + 0.0012505736264140704i, -0.00030927745798443564 + 0.0008510822275721037i }, { 0.008522273111595006 + 0.0020710877659960106i, 0.008921885733027832 + -2.0895949559159e-05i, 0.08193776314092441 + 0.020115918826158496i, 0.08582917862526195 + 2.102927372988796e-18i, 0.0008547555436388832 + 0.00025839001923380763i, 0.0009071242636441723 + 4.7960365434184766e-05i, -0.000668246190101852 + 0.0006110978101096165i, -0.00051197426306181 + 0.000765811189040113i }, { -0.0010815622710952735 + 0.0007175119287418825i, -0.0005293068664664434 + 0.0005746877376134869i, 0.0014813386069947672 + -7.831952442527093e-05i, 0.0008547555436388822 + -0.0002583900192338073i, 0.16795246697262195 + -5.031283855109465e-18i, 0.09818564029330298 + -0.024104811924600913i, -0.007589753720001143 + 0.020809443650906975i, -0.001450393123703304 + 0.01325457241035502i }, { -0.0007352638304543562 + 0.0002642325761094236i, -0.0006623140544099006 + 0.000439381298065494i, 0.0008772366353468493 + 0.00016681824548408637i, 0.0009071242636441724 + -4.796036543418551e-05i, 0.09818564029330298 + 0.024104811924600907i, 0.10284870536038097 + 2.331115164441476e-18i, -0.007423603693363595 + 0.011075984750734747i, -0.004647721811871324 + 0.012743036034799426i }, { 0.0007976701161437476 + 0.00029987980992069173i, 0.0005093601722949123 + 6.082794260022905e-05i, -0.0008360566154568716 + -0.0012505736264140713i, -0.0006682461901018515 + -0.000611097810109616i, -0.007589753720001145 + -0.020809443650906975i, -0.0074236036933635965 + -0.01107598475073475i, 0.18344884907138384 + -5.560495562439401e-18i, 0.10724488322091441 + -0.026328877951944822i }, { 0.0004232816936822508 + 0.00028979377411318723i, 0.0004884676017496215 + 0.00018363677991754565i, -0.0003092774579844357 + -0.0008510822275721041i, -0.0005119742630618107 + -0.0007658111890401125i, -0.0014503931237033053 + -0.013254572410355018i, -0.004647721811871322 + -0.012743036034799426i, 0.1072448832209144 + 0.02632887795194481i, 0.11233819286452848 + 2.975173682791854e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.12864502617109547, 1.0e-7), DoubleNear(0.07877808901078115, 1.0e-7), DoubleNear(0.1401594919239456, 1.0e-7), DoubleNear(0.08582917862526195, 1.0e-7), DoubleNear(0.16795246697262195, 1.0e-7), DoubleNear(0.10284870536038097, 1.0e-7), DoubleNear(0.18344884907138384, 1.0e-7), DoubleNear(0.11233819286452848, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.2965974931437174 + -8.90113955794822e-18i, 0.17339200369382826 + -0.042568155850326694i, 0.006979731755380379 + 0.020843566844445473i, 0.0070718799878917 + 0.011183484644359008i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.17339200369382826 + 0.04256815585032668i, 0.18162679437116214 + 3.976681150367821e-18i, 0.0010888745854749932 + 0.01318696960984075i, 0.004274163921156506 + 0.012763931984358587i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.006979731755380374 + -0.020843566844445473i, 0.0010888745854749932 + -0.013186969609840752i, 0.3236083409953294 + -9.683610337758384e-18i, 0.18918264636183882 + -0.04644479677810332i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0070718799878917 + -0.011183484644359008i, 0.00427416392115651 + -0.012763931984358585i, 0.1891826463618388 + 0.04644479677810331i, 0.1981673714897904 + 5.078101055780651e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.2965974931437174, 1.0e-7), DoubleNear(0.18162679437116214, 1.0e-7), DoubleNear(0.3236083409953294, 1.0e-7), DoubleNear(0.1981673714897904, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.2688045180950411 + -7.992970478157738e-18i, 0.15714412654144969 + -0.03857926275188428i, -0.0019176188865521453 + 0.0005330616976721868i, -0.001044541288438791 + 0.0005868496514626802i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.15714412654144969 + 0.038579262751884266i, 0.1646072676360431 + 3.748493358915141e-18i, -0.0011975530565682957 + 3.641007249612896e-05i, -0.0011742883174717111 + 0.0003264298909746195i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0019176188865521451 + -0.0005330616976721887i, -0.0011975530565682948 + -3.6410072496129067e-05i, 0.3514013160440058 + -1.0591779417548866e-17i, 0.2054305235142174 + -0.050433689876545736i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001044541288438792 + -0.0005868496514626805i, -0.0011742883174717114 + -0.00032642989097461845i, 0.20543052351421737 + 0.050433689876545715i, 0.21518689822490944 + 5.30628884723333e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.2688045180950411, 1.0e-7), DoubleNear(0.1646072676360431, 1.0e-7), DoubleNear(0.3514013160440058, 1.0e-7), DoubleNear(0.21518689822490944, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.1204144649464607 + -3.678869943113689e-18i, -0.04990164157586682 + 0.06204360623138973i, 0.01363734650518092 + 3.194003075360219e-05i, -0.005667987250053333 + 0.007013412358867089i, -0.001012365157491632 + -0.0006716063384933994i, 0.0007655854509009529 + -0.00024329740138145115i, 0.0007466360970029616 + -0.0002806938436299972i, -0.00016479007404395966 + 0.0005010285068724476i }, { -0.04990164157586683 + -0.062043606231389735i, 0.08700865023541592 + 1.4545802262012798e-18i, -0.005635073020156183 + -0.0070398852575723585i, 0.009854024703228433 + 2.3079112344055134e-05i, 7.349452600224034e-05 + 0.0007999457874118019i, -0.0007315111680135417 + -0.00048528688831397774i, -0.0004540453277794318 + -0.00026838065042755234i, 0.0005395016208904073 + -0.00020282274620823986i }, { 0.013637346505180918 + -3.1940030753602514e-05i, -0.005635073020156183 + 0.0070398852575723585i, 0.13119224838699395 + -4.005697947407715e-18i, -0.05436812395795386 + 0.06759686390794009i, 0.0013865642619449233 + 7.330873108135282e-05i, -0.0006123863183613584 + 0.0006840475610338701i, -0.0007825666721175409 + 0.0011705633601452052i, -0.00027882539377176326 + -0.000888317626474841i }, { -0.005667987250053333 + -0.007013412358867088i, 0.009854024703228433 + -2.3079112344054917e-05i, -0.05436812395795386 + -0.06759686390794009i, 0.09479642216221364 + 1.9855105450775272e-18i, -0.0005368416062446456 + -0.0007448081353457643i, 0.0010018986086940155 + 5.297115877810429e-05i, 0.0009274411825574631 + -8.18819797897413e-05i, -0.0005654642064011414 + 0.0008458214553089781i }, { -0.0010123651574916325 + 0.0006716063384933986i, 7.349452600224018e-05 + -0.0007999457874118023i, 0.001386564261944924 + -7.330873108135172e-05i, -0.0005368416062446453 + 0.0007448081353457648i, 0.1572070607692906 + -4.830138441285327e-18i, -0.06514906994930128 + 0.08100100747448208i, -0.007104169982085869 + 0.019478079313574675i, -0.007092009579703111 + -0.0117324480749871i }, { 0.0007655854509009526 + 0.0002432974013814508i, -0.0007315111680135416 + 0.000485286888313978i, -0.0006123863183613584 + -0.0006840475610338701i, 0.0010018986086940157 + -5.2971158778104723e-05i, -0.06514906994930128 + -0.08100100747448208i, 0.11359411156371231 + 2.1299697506173376e-18i, 0.012980168353612962 + -0.004411594634906269i, -0.0051333055497865985 + 0.014074400372131726i }, { 0.0007466360970029615 + 0.0002806938436299978i, -0.0004540453277794319 + 0.00026838065042755234i, -0.0007825666721175406 + -0.0011705633601452059i, 0.0009274411825574633 + 8.188197978974086e-05i, -0.0071041699820858705 + -0.019478079313574675i, 0.012980168353612962 + 0.004411594634906268i, 0.17171200211499482 + -5.461026874824032e-18i, -0.07116014498446531 + 0.08847468490735871i }, { -0.00016479007404395939 + -0.0005010285068724473i, 0.0005395016208904076 + 0.00020282274620823959i, -0.0002788253937717627 + 0.000888317626474841i, -0.0005654642064011417 + -0.0008458214553089778i, -0.007092009579703112 + 0.0117324480749871i, -0.005133305549786597 + -0.014074400372131726i, -0.07116014498446532 + -0.08847468490735871i, 0.12407503982091748 + 2.875704995176484e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.1204144649464607, 1.0e-7), DoubleNear(0.08700865023541592, 1.0e-7), DoubleNear(0.13119224838699395, 1.0e-7), DoubleNear(0.09479642216221364, 1.0e-7), DoubleNear(0.1572070607692906, 1.0e-7), DoubleNear(0.11359411156371231, 1.0e-7), DoubleNear(0.17171200211499482, 1.0e-7), DoubleNear(0.12407503982091748, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.2776215257157513 + -8.509008384399016e-18i, -0.1150507115251681 + 0.1430446137058718i, 0.006533176523095051 + 0.019510019344328278i, -0.012759996829756443 + -0.00471903571612001i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1150507115251681 + -0.14304461370587182i, 0.20060276179912823 + 3.584549976818617e-18i, 0.007345095333456779 + -0.011451479892478626i, 0.004720719153441835 + 0.01409747948447578i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.006533176523095047 + -0.019510019344328278i, 0.007345095333456779 + 0.011451479892478626i, 0.30290425050198877 + -9.466724822231746e-18i, -0.12552826894241917 + 0.1560715488152988i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012759996829756445 + 0.004719035716120011i, 0.0047207191534418365 + -0.01409747948447578i, -0.1255282689424192 + -0.1560715488152988i, 0.21887146198313112 + 4.861215540254011e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.2776215257157513, 1.0e-7), DoubleNear(0.20060276179912823, 1.0e-7), DoubleNear(0.30290425050198877, 1.0e-7), DoubleNear(0.21887146198313112, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.25160671333345463 + -7.684567890521403e-18i, -0.10426976553382068 + 0.12964047013932983i, -0.001794931829609173 + 0.0004989570216518059i, 0.00048676005712918965 + -0.0011316150278562922i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1042697655338207 + -0.12964047013932983i, 0.18180507239762955 + 3.440090771278807e-18i, 0.0010009357085597034 + 0.0007180638076220606i, -0.001296975374414683 + 0.00036053456699500035i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001794931829609173 + -0.0004989570216518073i, 0.0010009357085597034 + -0.0007180638076220614i, 0.3289190628842854 + -1.0291165316109359e-17i, -0.13630921493376658 + 0.1694756923818408i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00048676005712918987 + 0.0011316150278562918i, -0.0012969753744146834 + -0.00036053456699499975i, -0.1363092149337666 + -0.1694756923818408i, 0.2376691513846298 + 5.005674745793822e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.25160671333345463, 1.0e-7), DoubleNear(0.18180507239762955, 1.0e-7), DoubleNear(0.3289190628842854, 1.0e-7), DoubleNear(0.2376691513846298, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.20742311518187662 + -2.2242897169124093e-18i, 0.023491371208409353 + 5.501914309765732e-05i, -0.0017438763255051737 + -0.0011568932268073771i, 0.001286137717893369 + -0.00048351658983823703i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02349137120840935 + -5.501914309765743e-05i, 0.22598867054920757 + -2.0201874023301874e-18i, 0.0023884628706389386 + 0.0001262798898594571i, -0.0013480308785186823 + 0.0020163848154541833i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017438763255051741 + 0.0011568932268073767i, 0.0023884628706389395 + -0.00012627988985945644i, 0.27080117233300294 + -2.7001686906679894e-18i, -0.012237475531872467 + 0.033552479685706404i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001286137717893369 + 0.00048351658983823736i, -0.0013480308785186823 + -0.0020163848154541838i, -0.012237475531872467 + -0.033552479685706404i, 0.2957870419359123 + -2.5853218796475478e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.20742311518187662, 1.0e-7), DoubleNear(0.22598867054920757, 1.0e-7), DoubleNear(0.27080117233300294, 1.0e-7), DoubleNear(0.2957870419359123, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));


}
}

}
