#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { -0.13184754287724987 + 0.07360894643831269i, -0.5022272399706337 + 0.12448232177221444i }, { -0.2110923242879319 + 0.08847467306078845i, -0.043752752956976865 + -0.1004958457166896i } }), Matrix({ { -0.03589193800928466 + -0.540482804814746i, -0.23366021619422095 + -0.22185535084852304i }, { -0.6628643985351642 + 0.02057769040262327i, 0.19711910060495713 + -0.020038792456222018i } }), Matrix({ { 0.1597525547138276 + 0.015034308968974633i, -0.4245440412413213 + 0.5137736841792806i }, { 0.003568810839241805 + -0.15231895398827558i, 0.012962414957535803 + -0.06460334103954299i } }), Matrix({ { -0.029066088961746492 + 0.1149165017772254i, 0.25220819037560727 + 0.2260740147564636i }, { -0.35777080987365883 + 0.02400758105789796i, 0.11350457629543623 + -0.032240790580752916i } }) }, { QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.13587137149402784 + -0.1077482079409566i, -0.11070871267360191 + 0.008228546996979794i, -0.0712085232171903 + 0.14464332253914075i, 0.010452193804322303 + 0.1518875192340846i }, { 0.10889111470822245 + 0.01045148733768236i, -0.01864848074427817 + 0.06633218153299474i, -0.06181351260556313 + 0.08773886643895933i, 0.1616584623547594 + -0.006941508508138282i }, { -0.08958611040438176 + -0.0664875338981602i, -0.18214279777332096 + -0.155329557565605i, 0.009506723553324898 + -0.0590239221557582i, -0.05845199086713559 + -0.03520382036596154i }, { 0.1139506227561812 + 0.05113057375955489i, 0.002903406169614245 + -0.10071860023499259i, -0.0583705687189264 + -0.022839719223750922i, -0.054396308842697715 + -0.04640165098851968i } }), Matrix({ { 0.01634983363117789 + -0.10074640847116562i, 0.07545135589048782 + 0.059702569739830076i, 0.13664367914348113 + 0.02816056691429325i, 0.03441843284358296 + 0.040803691503886685i }, { -0.003150643874536654 + 0.006384020626982198i, -0.03290905164812568 + -0.007550449945839257i, -0.03369380959071918 + 0.0016737943605542158i, 0.08226171826950594 + 0.09507503424904823i }, { -0.11002499784784724 + 0.06320935028950961i, 0.022443611908053863 + 0.038751508272707326i, -0.17415472734366197 + 0.002143398338254651i, -0.019789416867693758 + -0.028347436691449297i }, { -0.0911108618946253 + -0.00038117550627328294i, 0.004678350625389835 + -0.10587703810494171i, 0.052736548461494254 + 0.005904181244835811i, 0.09445916129942476 + 0.020986889564346353i } }), Matrix({ { -0.19536555274280748 + 0.015379857240922789i, -0.013237517322118284 + 0.14993527958608854i, -0.1135213128549348 + -0.020062439759379738i, 0.02401570494742188 + -0.008186802446877977i }, { -0.08108580640399189 + -0.02218371080285119i, -0.020248230992969973 + -0.007322982902504357i, -0.033191072719856274 + 0.1449482827909144i, -0.13172931191509252 + 0.08626334129612113i }, { 0.1300559906895413 + -0.043148901964600216i, 0.06525803271576444 + -0.010285785599395407i, 0.23308095623188418 + -0.13862200478386766i, 0.036674086912755186 + 0.06538636082448339i }, { 0.07226613329087833 + -0.06308742940914325i, -0.15856059879237094 + 0.06304552243577546i, -0.0835602994976946 + -0.010173763933148144i, -0.016573380482110597 + -0.15589483107096275i } }), Matrix({ { -0.06092807337037742 + 0.04860219114326913i, 0.10690973256236991 + 0.1146268692344698i, -0.08601672392910069 + -0.021986651177581452i, 0.020573920727552812 + 0.0007069889683858638i }, { 0.06344941165527952 + 0.06236804450654764i, -0.0674148249601433 + 0.1448967809011973i, -0.10860768355493526 + -0.02764055818272012i, 0.08457205196522519 + -0.07271921470737162i }, { -0.02404984088731416 + -0.008185661514258152i, 0.046208528156250324 + -0.11177742946901362i, 0.01145673653553128 + -0.11235130226713295i, 0.013989684133898136 + -0.0641022338604623i }, { -0.04921049715682432 + 0.1390843718512101i, -0.013632393028250523 + 0.007307836743777081i, -0.03169364553590598 + 0.007962036075349377i, 0.23589804248048526 + 0.042522207642218736i } }), Matrix({ { 0.07934522911349473 + 0.0028115681742636517i, 0.08925790678872415 + -0.008996582600561307i, -0.10330203350034348 + -0.11095276772935223i, -0.0010827521409621846 + -0.02025848800901245i }, { -0.018027940417022693 + -0.08181723513375418i, 0.07811038657015602 + -0.00871395897456377i, -0.12800747789464992 + -0.07039643451137291i, 0.032449987496015874 + 0.07352104670037662i }, { 0.05061817704413652 + 0.03169868238259269i, -0.07797010094353354 + 0.07181505762300157i, -0.02687469221563641 + 0.02536128287717204i, 0.02196032527081482 + -0.1399053930799198i }, { -0.052430461320138864 + -0.006234837198019229i, -0.0679223744863094 + 0.012569980934298895i, 0.18171342356333847 + -0.017983197587311987i, -0.07380148403881555 + 0.006134947013293524i } }), Matrix({ { -0.0811624672959227 + -0.16668267199578396i, 0.02881277016283288 + 0.0681509796420625i, 0.1647073268763263 + -0.042443518453207034i, 0.02120400881362312 + -0.0466199314425907i }, { 0.05014063405926908 + -0.041258031833059185i, -0.11256000107583997 + 0.15531768028867382i, -0.023320966964560083 + 0.009128219185142672i, 0.044943083700943735 + 0.1144118047952697i }, { -0.13418956970864232 + -0.01221305850231358i, 0.04300169977025633 + 0.026848214622865515i, 0.0789879418009729 + 0.08381311597587487i, -0.10443926051983439 + -0.042637249659440116i }, { -0.01480390885178753 + 0.04892870845185618i, -0.10672565694889616 + 0.0831057029482665i, -0.07704621766020561 + 0.15108383525432584i, -0.11235892996509422 + 0.11100064712549776i } }), Matrix({ { -0.12437755037816949 + 0.044556769385114714i, -0.16070747988247422 + 0.12878233553904603i, -0.011767748993957588 + -0.011030903766718723i, -0.012048403219548424 + -0.004638828043388973i }, { 0.02016912567659454 + -0.032226652762732996i, 0.14797802975967317 + 0.11699428428517307i, 0.10722911927850831 + 0.08314417333672398i, 0.0042270470645560144 + -0.20188695546122837i }, { 0.06960262193084565 + 0.03290050543875889i, -0.07537330558093902 + 0.009683398999879087i, -0.0182251620011376 + 0.14557520451125747i, -0.09797054910381699 + 0.0459735855237372i }, { 0.0743704391792883 + -0.09725727739846703i, 0.03727612521013435 + 0.011563561349884543i, -0.10917065686696854 + -0.18518218276047307i, -0.1034009076071677 + -0.06373057306825486i } }), Matrix({ { -0.03469187939404587 + -0.004335465730869296i, 0.04040527027460332 + 0.045544101021187555i, 0.1378339363462092 + -0.07731672393506396i, 0.018233866087695876 + 0.24834581215186882i }, { 0.1842773464382962 + 0.10548656497705658i, 0.008626103065042143 + -0.05295255583977793i, -0.060885346425577185 + 0.026860728064732983i, 0.10309614693014632 + -0.058733549902269526i }, { 0.05954190836861996 + -0.04392679292440434i, 0.0383829879252445 + -0.09121198680140426i, -0.06273985774245171 + -0.19214242486927238i, 0.033550139582073715 + 0.05527149795444337i }, { -0.04482003514058117 + -0.06001203242903972i, 0.1038197197947346 + -0.03872736312958022i, 0.021000305462855542 + -0.07902596739333465i, -0.08664386319445909 + -0.10744405771889294i } }), Matrix({ { -0.18834690636198995 + -0.033444404393550696i, 0.01890655931553495 + -0.06891217640922365i, -0.10831953468375231 + 0.10872743142248667i, -0.008139606257826197 + -0.11300240572925845i }, { 0.10471103749156213 + 0.07124426159974509i, -0.06807537669998252 + -0.027950213469634073i, 0.2379554209184819 + 0.020135934373780726i, -0.06239127831213755 + -0.14317617831079593i }, { 0.008839266272624408 + -0.20360464762000213i, -0.15370417361677044 + 0.04884273817922195i, 0.18903141422989775 + -0.13255547099329287i, -0.03628557653991005 + 0.02719510768979352i }, { -0.025427687998570002 + -0.14287670209712758i, 0.14530015360580104 + -0.040720778428479036i, 0.004384549939483841 + -0.10516820018733146i, 0.0015624133899305452 + 0.057579084516861216i } }), Matrix({ { 0.06410290791917214 + 0.024979162078935142i, 0.16427443387351728 + 0.16975384887809244i, -0.016900173564205295 + 0.0213907822694476i, -0.03691793315347317 + 0.044231417494725894i }, { -0.1043631942126964 + -0.012116408123362737i, -0.13369924703720565 + -0.10722017617531505i, -0.016069473941864035 + -0.09218568196053056i, -0.0018616287507217041 + 0.04683913818538129i }, { 0.00633209537918495 + 0.18034836231603132i, -0.062047487172557474 + -0.11230847485078577i, 0.09262256358621071 + 0.0032481527744065057i, -0.1432663475655536 + 0.1127151211327072i }, { -0.14038637943930898 + -0.0526209563260478i, -0.13953537708122923 + -0.10816922718627475i, 0.1961342935405942 + 0.13079394613053413i, 0.13927616383476552 + -0.04817710503233183i } }), Matrix({ { 0.040544144731455914 + -0.01176275903338415i, -0.20090527011705417 + -8.961629917110247e-05i, 0.06171611709448771 + -0.11954524138872824i, 0.007692134899736126 + -0.06426660018230831i }, { 0.033329310766136565 + 0.015798387738451818i, 0.05857743271354898 + -0.04355647631042166i, -0.058229474538232136 + -0.03390773767567633i, 0.02248575092007786 + -0.01301685297922095i }, { -0.021259562996189654 + -0.004843305371880975i, -0.012465325400091064 + 0.015517432331588298i, -0.06415873690166861 + 0.014243887131442956i, 0.02130032362083607 + 0.0747469573708528i }, { -0.2108960577681671 + 0.03529453979234153i, 0.07829601219181682 + 0.05813357089484684i, -0.01913248740770812 + 0.043757039411948i, 0.025835316488304783 + 0.06760361929176335i } }), Matrix({ { -0.029368003955298552 + 0.22589042926089495i, -0.11917580905919478 + 0.09467387424753272i, 0.09837832295555966 + 0.05035467818259046i, -0.1847199390477426 + -0.013024415181016711i }, { -0.022014578140342016 + 0.07961591146174815i, -0.0812161612478201 + 0.02315655464078303i, 0.05101020926837006 + -0.03643901214465928i, 0.09567694366464034 + 0.09793524280497753i }, { 0.10776079364760884 + 0.08465033972624361i, 0.08151816799634458 + -0.041219428219068814i, -0.0916849846563791 + -0.12810179221003506i, -0.3117196283379439 + 0.05538125303360449i }, { -0.1033360188268413 + 0.00358419003215695i, 0.015244484218164975 + -0.06955527129251733i, 0.03895577458929718 + -0.049903442397906735i, 0.02649792286054093 + -0.01923723879789384i } }), Matrix({ { 0.12487575933490555 + -0.0891177984073078i, 0.009656914858627895 + 0.07877361164869373i, 0.06862400981250007 + -0.048164369006600725i, 0.08865398342966374 + -0.07841555742944241i }, { -0.2377447048065016 + 0.042647673623363205i, 0.10943741090472225 + 0.028372670987958943i, 0.09133000849595836 + 0.03048656292594843i, 0.08475097372017233 + 0.14179389937889392i }, { -0.06938830925776299 + 0.0012652517785128716i, -0.0018951896289071228 + -0.1383839774288006i, 0.05272101204272128 + -0.03068168334031132i, 0.13042720182258177 + 0.04287769558729129i }, { 0.1521239832882071 + 0.0343758369987066i, 0.16139320506826188 + 0.11035352330861832i, -0.048191359653152875 + 0.10891157861912194i, 0.04908110045580165 + 0.1321655443401818i } }), Matrix({ { -0.050676532851443266 + 0.020449974462737948i, 0.003850479809706598 + 0.07626942672911727i, 0.03218798471220316 + -0.016292529580101765i, 0.03136974574985143 + -0.04327589712242647i }, { -0.046455821282346044 + 0.036139551898215314i, 0.04677597027489188 + 0.10790570774873616i, -0.03866264807856667 + -0.04604678756009291i, 0.11014339342701865 + -0.027384087479254447i }, { -0.048064318374290094 + 0.07913948095975466i, -0.06744986591021497 + -0.1178207550059887i, -0.017696150580128717 + -0.034656757420530024i, 0.053421443687630264 + 0.08718211401291434i }, { -0.06943237137619299 + 0.026109190154973892i, -0.07390881783344135 + -0.10345200506024989i, 0.14588011820522245 + -0.016909560544331396i, -9.092528513583847e-05 + 0.028077130892595347i } }), Matrix({ { -0.06469349982577438 + -0.09764248417698282i, -0.09135815024074767 + -0.054146832513069815i, 0.03787268174511371 + 0.02344183323228185i, -0.007552144521895971 + -0.11963358940518172i }, { 0.004393305314232312 + 0.2051366126142588i, -0.017014247854753403 + -0.021099874029063524i, 0.019480122464310298 + -0.048783185950844785i, 0.15161266310580274 + 0.029556826340212367i }, { -0.034167336206114444 + -0.042044051693136554i, 0.09404334490037858 + -0.00659441938846645i, 0.06575910320673234 + -0.08260780771602633i, 0.04714797990117546 + 0.014887739090130513i }, { 0.08442675568740315 + -0.1094877188427108i, 0.04268041162491522 + -0.06772792189783743i, -0.14666340518848145 + -0.05140107615850983i, 0.12836082516817618 + 0.18168170870696967i } }), Matrix({ { -0.1503503232532899 + -0.0022425334484984637i, 0.03547609420765594 + 0.14127087574392166i, 0.05687327972647951 + -0.09774613097701239i, 0.11248306373161243 + 0.026141606793597522i }, { -0.03294014165090471 + 0.14682832633846465i, 0.11181258558034535 + -0.0585950947276084i, 0.06576333539602873 + -0.11716059660623424i, 0.005879593823552242 + 0.05401702432609736i }, { -0.1105261770178 + 0.03132569166741403i, 0.10767642894455443 + -0.062439992690768616i, -0.05073617834700049 + 0.05901925915259344i, -0.16566582966163262 + 0.06272371482735428i }, { -0.08885772702158092 + -0.09812270945742357i, -0.10129965112873938 + 0.22491154941493913i, -0.06461958642033856 + -0.028507904211920176i, 0.08194276904315898 + 0.04189196015523712i } }) }, { QubitIndex{ 0 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.05061433029148632 + 0.05252781116168339i, 0.05997321335201657 + 0.009292175854441045i, -0.009190715895655385 + 0.03883267742220437i, -0.09415531852721436 + 0.1632937235828299i }, { -0.08742807017123995 + -0.008678398689379231i, 0.05315988986158112 + 0.1332169334699993i, 0.05514535778513522 + 0.13310656411811472i, -0.09698721590509045 + -0.026239320250165753i }, { 0.04090431922349689 + -0.12029488812705058i, -0.017864100223233582 + 0.05601034653915254i, -0.042986657937234656 + -0.11172341491339187i, -0.10050695658756599 + 0.039231004656251726i }, { 0.09947908665165672 + -0.06918122529186743i, 0.018247860881246858 + -0.040455341486006414i, 0.08109484637323841 + 0.13804508772401392i, -0.07886610037189751 + -0.02490867829521928i } }), Matrix({ { -0.12020013724738553 + -0.05564827298207374i, -0.0331196539943252 + -0.0525478016232434i, -0.01405014360553396 + 0.019411455342421897i, -0.10678008080386547 + -0.04035825190020815i }, { 0.02430467066143612 + -0.09963022917076389i, -0.04157418874012029 + -0.0776823919737689i, 0.023783974815813874 + -0.126226764584221i, -0.06744489232199555 + -0.10531975851444993i }, { -0.0023055249459800094 + 0.018004308879686046i, -0.021272817736435 + 0.054840694542436966i, -0.058319297399535695 + -0.009503310477129935i, -0.048849430965373614 + 0.027345646783331245i }, { 0.10421355773811795 + 0.04478447926568421i, -0.06523541970578385 + -0.09095523976807551i, 0.036372717309636496 + -0.29859610860247676i, -0.014015909432008002 + -0.07688371775202087i } }), Matrix({ { -0.09212725843005831 + -0.009860488433190897i, 0.10221823713138987 + 0.013562336341119634i, 0.16083875238954812 + -0.08174414626458074i, 0.09991498866964146 + 0.08040014028067204i }, { -0.09125903258832237 + -0.05979010640819952i, -0.04134038157030879 + -0.009858994838894877i, -0.08208789085289883 + 0.13663660334416144i, -0.003943897447847914 + -0.013395482144023942i }, { -0.03732271678846037 + 0.007533726174753905i, -0.017170584115076163 + 0.016571597858083636i, -0.04221873001304023 + -0.13429747468506759i, -0.04218154875058492 + 0.05539588432111993i }, { -0.06727965062432675 + 0.22719947812123534i, 0.05244463067472722 + -0.009782785916809235i, -0.09097190789713856 + 0.03744643033003518i, -0.153955618064827 + 0.01599257750869225i } }), Matrix({ { -0.04639954463863828 + -0.19708315729593104i, -0.0034572382404106407 + 0.035673471051329536i, 0.009477506312582698 + -0.008851296579285768i, -0.021978782744726276 + -0.057577085407200065i }, { -0.06750588768846721 + 0.05932850358576463i, -0.008090776649781395 + 0.08916441658881658i, 0.12997366202935556 + 0.04885095705065706i, 0.04203836324143942 + 0.0949187339897615i }, { 0.015606660433438009 + 0.10303404085094955i, 0.1180959590518075 + -0.05593019793296087i, -0.029526876588174787 + -0.0178800390465701i, 0.04623929082816067 + 0.022109728417040078i }, { -0.0568521268076756 + 0.07217835473490138i, 0.11803388462992821 + -0.11479838899711768i, 0.04016226268635636 + 0.0672464789666022i, -0.0810696589757243 + 0.17752549599993925i } }), Matrix({ { -0.10227911584481779 + -0.07733439816994157i, -0.05099775100249213 + -0.03865954344748846i, 0.18851162592299556 + 0.15309980359041075i, -0.24829796340021704 + 0.010875105090617444i }, { -0.05819874932251671 + 0.06852007068796968i, -0.09164513366055858 + 0.017637488984249647i, -0.022801213325972642 + 0.11314024182814073i, -0.03321357340734708 + 0.021248855681754227i }, { 0.0763325549549814 + -0.021462453514882355i, 0.08067147183561572 + 0.1576390534289877i, 0.0725875330321647 + 0.05244791137782659i, 0.04459288610765268 + -0.0834806500849003i }, { -0.024993874032298052 + -0.1185206874506257i, 0.05716938966365631 + -0.0814405125632063i, -0.12226849682813613 + 0.0688876146729573i, 0.15146540735309813 + -0.014523413547471475i } }), Matrix({ { 0.11621827870801088 + -0.10167312866330076i, 0.16588772888867886 + 0.14920308111563346i, -0.050228769475807296 + 0.177666718040171i, -0.17775813862647877 + 0.027758689540144963i }, { 0.023135220486753365 + -0.10445778498023621i, -0.06553775532400254 + 0.045322970110888955i, 0.01597462484678216 + 0.047901590553728064i, -0.0711699327199069 + 0.0628803781677919i }, { -0.019512623881622424 + -0.0218114990025708i, -0.11531544731913815 + -0.14417040730785832i, -0.05574684484512344 + 0.03314373408534306i, -0.03529635384894097 + 0.013115056781574258i }, { -0.04858518648644315 + 0.0760975621348767i, -0.05179168121348164 + 0.10742459064192016i, 0.022074172853220185 + 0.03558286863374842i, 0.02501373944391177 + 0.07442172988931912i } }), Matrix({ { 0.04437671357903225 + 0.08699849622896422i, 0.21612400704437007 + -0.11790120412236732i, 0.1194144462311908 + -0.06627021451184205i, -0.02203264895309477 + -0.016043230584865318i }, { -0.18022807295986834 + 0.13496593977713783i, 0.023243218474767728 + 0.0024359503200727358i, 0.06482527018879801 + 0.13807126685321144i, 0.08523391687481865 + -0.07765376199907827i }, { -0.17358127984331964 + -0.04104385486773189i, -0.04910176337912498 + -0.09609906157770544i, 0.05503264901695858 + 0.08015005607421309i, 0.03154988171857492 + -0.04163999592247693i }, { -0.05588410377270465 + 0.055558550109567374i, -0.04196473459923972 + 0.08232345598424459i, 0.08093127376327183 + -0.04144174913979177i, 0.1601638288588538 + 0.13338977929706247i } }), Matrix({ { 0.0025261030610044103 + -0.09367900077328023i, -0.07427132498026323 + -0.09935844015550736i, 0.004506819027120019 + 0.08486775952563734i, -0.19574009321160363 + 0.019696029841068555i }, { -0.029723597949278122 + 0.013722408615634132i, -0.007979815954751727 + -0.08127955916582008i, 0.011204441448861497 + -0.11691429441898309i, 0.08654919345055266 + 0.008289584323335304i }, { 0.03904496864343122 + -0.08986365776904733i, -0.09305420479569293 + 0.13681765244939947i, 0.12148841139663205 + 0.0020900808985718613i, 0.14485268880524477 + 0.001260064443470919i }, { -0.013240149058920923 + -0.15558582332400986i, 0.0038146686663395385 + 0.1682747662206128i, -0.0911616341061044 + -0.01893567589114046i, 0.17782296471582887 + 0.11920061593583668i } }), Matrix({ { -0.030449317544657482 + 0.10526213410078868i, 0.14414087398806433 + -0.12999691622901874i, 0.08134619109960085 + -0.1275558109160422i, -0.12720345216216328 + 0.030320901177401913i }, { -0.04787802458944303 + -0.08189213848069835i, -0.08773947644287991 + -0.01623284709192477i, 0.07387239842343686 + 0.04748197376017189i, -0.0942549017080105 + -0.10248888662149429i }, { 0.015507565611898238 + -0.19053715433990306i, -0.11297590057203796 + -0.1364586764700197i, 0.010867231641178858 + 0.1258569715168691i, -0.022416581738638742 + -0.04561989305805456i }, { 0.13096926505942066 + -0.04035864227990103i, -0.031238346742400756 + -0.02463790751431708i, 0.06165810413635441 + -0.026553748397273376i, 0.03461024129818562 + -0.055444346220568326i } }), Matrix({ { -0.1267122141136909 + -0.02794146760709251i, 0.1040753789982621 + -0.01214960415971623i, -0.13584672753877003 + 0.07704745504893931i, 0.0912808114669169 + -0.05997144219827151i }, { -0.02134853236878973 + -0.04566066619043563i, -0.06532787229642324 + -0.0680133460424011i, 0.046931280357254475 + 0.08113904805466932i, 0.16335384793816451 + 0.10077526270329991i }, { -0.05830392151544414 + -0.016694144920229106i, 0.15534521959272685 + 0.1294057065315965i, -0.06567128221187894 + 0.06982871297933205i, 0.09066433971123537 + -0.014275533642358746i }, { -0.05849777811696107 + 0.04012413884120687i, -0.16167470042542942 + -0.08606702250531344i, 0.06116430444817896 + -0.11973033456837151i, -0.04581169848738185 + 0.052365979987143624i } }), Matrix({ { 0.016251983324916393 + -0.05650383867851697i, 0.011089439682162923 + -0.0394441236132478i, 3.2975159425801894e-05 + 0.05663818958008804i, -0.098474638277045 + 0.0619812091785943i }, { 0.06463467249764634 + -0.05201919740864563i, -0.028898675005498788 + 0.0014143258748632167i, -0.02774458801497385 + -0.019006685462516576i, -0.045183300911056046 + -0.11365231968149563i }, { -0.050540168613955404 + -0.07154099423879023i, -0.19982231910611714 + 0.020376276935924066i, 0.03424617423098464 + -0.0367747939355161i, -0.013411260832374311 + -0.01883478578273099i }, { 0.01475512041265174 + -0.08255407094985043i, -0.04388092647019744 + 0.0020694249537579275i, 0.07457989220887698 + 0.016041701198088267i, 0.031114911918166455 + 0.015137039002792075i } }), Matrix({ { 0.02105015797219511 + 0.09427033308536382i, -0.0021447945216448387 + -0.007992797475815744i, -0.0257979398473837 + 0.09410792930433173i, -0.06921440509244707 + -0.05663462274954994i }, { 0.004252704345552631 + -0.10368307961659345i, -0.2619558890827135 + -0.011474401578144795i, -0.009604479511837419 + 0.10999709613717844i, 0.05949839552141809 + -0.060740977744281936i }, { -0.07734538711048751 + -0.011969865475091063i, 0.009087713979538871 + 0.11378434915496083i, -0.05618055233788926 + -0.1337752354223008i, 0.0957179825766362 + -0.0583663939549971i }, { -0.11648564309534021 + -0.08862375510657435i, -0.18765613995686894 + -0.03243248483296932i, -0.008020260683293411 + -0.07948254195654922i, -0.03728734778408232 + -0.046211820083714605i } }), Matrix({ { 0.014946967939053013 + -0.07047158524860082i, 0.09939428406341175 + -0.0068386306483212205i, -0.011192062272278662 + -0.01932222808888845i, -0.14592598958008457 + 0.06371144584136289i }, { -0.1490803191408965 + -0.029476535131714936i, -0.04016179632550749 + -0.006314590421391046i, -0.004357661064882231 + 0.01979698485089023i, -0.05430037134892576 + 0.10480548324163759i }, { -0.07936931550848583 + 0.11696252358682882i, -0.035977688999382404 + -0.08580553483808552i, -0.20120635233536738 + 0.07821694272892189i, 0.025574733990117428 + 0.023981131425213367i }, { 0.15736186052846157 + -0.12870917475707713i, 0.08751342300463963 + 0.13033540394642285i, -0.040037047674927634 + -0.15344005700734928i, -0.1860224612707339 + -0.0048825085112638306i } }), Matrix({ { -0.027069517918901137 + -0.12496466662983136i, 0.09388065591868713 + -0.0019839844067403314i, 0.009853310412781374 + -0.09888427741751817i, 0.16455810245454625 + -0.08001095570078064i }, { 0.07155697466178199 + -0.019858672956120944i, -0.19702285339557682 + 0.03155304806706506i, 0.05900054571046978 + -0.07851809216388238i, 0.1509186217609262 + -0.02852669708378744i }, { 0.08414881932260254 + -0.05702997277811767i, 0.03892555134706369 + 0.025464872251003294i, 0.01305337830381726 + -0.1489899712171029i, -0.02996005255265337 + 0.07060401321924839i }, { -0.1865184837318506 + 0.05683131474666057i, -0.06880759886320126 + 0.07477023697431022i, -0.0423710048435662 + -0.11792709316702348i, -0.02011590160553402 + -0.009397646314839702i } }), Matrix({ { -0.026387675372696935 + 0.1755362738011848i, -0.017245279037135287 + -0.050218975078146086i, -0.0863922823152748 + 0.09592699837048416i, -0.06691054124770357 + 0.030950674913512215i }, { 0.12488303407747327 + 0.08930970978282642i, 0.037394453198356735 + 0.18831157423009248i, 0.09917155396911823 + 0.07299967891094657i, -0.08283241496302321 + -0.09037849325110137i }, { -0.046768585579892906 + 0.011672702919696817i, -0.1370923538172986 + -0.008868549920461802i, 0.18542524288990067 + 0.02928415439531856i, 0.047171706808312945 + -0.09429693811364916i }, { -0.14165435818801478 + 0.0009168992521102594i, -0.04866405686179745 + -0.02967955993965473i, 0.05886091935405266 + -0.24983080795664195i, -0.1995791698652902 + -0.05839110657660838i } }), Matrix({ { -0.1319493451003932 + -0.061174373984652454i, 0.06039123477932472 + -0.10569207695447541i, 0.06343833146792889 + -0.1320936510494724i, -0.11976904896193255 + 0.00574714955823731i }, { 0.03599358328449835 + 0.18222941712070187i, -0.06795530573161425 + -0.005776697540178186i, -0.016068380986453173 + 0.04851938829279075i, -0.03491485273804476 + 0.030014781747882864i }, { -0.02449634785665897 + -0.03213192614794674i, 0.04326833718209102 + 0.0899443255241967i, 0.031919501168168225 + -0.010055790388579091i, -0.09963155998055476 + 0.19438993955090586i }, { -0.15432375558748096 + 0.20259493730003802i, 0.007467489965936972 + -0.15054102179206721i, 0.0070713611658494565 + -0.0626103249516091i, 0.02590320089064926 + -0.1852727725086922i } }) }, { QubitIndex{ 0 }, QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.14720066255318628 + -0.060100606552570254i, 0.014301875418880245 + 0.09393695876691373i }, { -0.21217706500445824 + -0.14782243016699528i, -0.808927715549966 + -0.0005577438335234199i } }), Matrix({ { -0.14474493288113155 + -0.02239941591103009i, -0.1512355270690859 + -0.1085847933766688i }, { 0.3155760359424461 + 0.4669502232322229i, -0.09978466893964862 + -0.13029905596213354i } }), Matrix({ { 0.10109057189585739 + -0.042429914942608615i, -0.10059765217780942 + 0.08746768775999027i }, { 0.16146005477130393 + -0.1524561691084981i, -0.002605421305296911 + 0.3412540832985886i } }), Matrix({ { 0.05120992575605498 + 0.6363787413073981i, 0.05156516690076738 + -0.13550126861897696i }, { -0.05049522032415254 + 0.3119034610934452i, -0.3244107744247293 + 0.12048130776973279i } }) }, { QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.010133813856942007 + -0.0009548917646405325i, -0.25302897032866173 + -0.05863941079187576i, 0.16653893827076446 + 0.023086766857420185i, 0.15052593910446033 + 0.04062251770968338i }, { -0.010180992314229984 + 0.17715336303817483i, 0.07730104508998344 + -0.07140764640160366i, 0.07351303302749061 + 0.021812302404565557i, -0.05239042179103874 + 0.0008760125717125204i }, { -0.007180594184489142 + -0.023973264554188547i, -0.02749735451714041 + -0.0469479858408998i, -0.1398551385013098 + -0.015240618306022413i, -0.09150721697867155 + 0.014462917877981995i }, { 0.10351496399817202 + -0.054296060204655903i, -0.00263274641477705 + -0.06035804826731007i, -0.08314304730090283 + -0.014937774608049842i, -0.16252456038217983 + 0.04846511241790841i } }), Matrix({ { -0.0200733988052192 + -0.09974666799029445i, 0.1340621156093628 + -0.057408269677148474i, -0.08324534894961558 + 0.03781044996098569i, 0.051580606272012455 + 0.011664255274469279i }, { -0.1191702281669746 + 0.06805195343648197i, 0.11936432676438997 + 0.06583245079488147i, 0.09296110524582277 + 0.008905159027866427i, -0.047934119616120346 + -0.0001789407357349603i }, { 0.004149515206178872 + -0.01770477348890963i, 0.10245957689475294 + -0.08166082299169461i, -0.21936758487789418 + 0.09520319569572541i, -0.0586053353976697 + 0.06912369733850038i }, { 0.13031852282760445 + -0.0173294124414983i, 0.09535464694224297 + -0.0007901585136856063i, -0.11007520704017648 + 0.020368167989172868i, 0.0018517619389948165 + -0.09361893910631285i } }), Matrix({ { 0.06870466776520397 + -0.06101019963410301i, -0.013860795635608695 + 0.11799297526374229i, -0.03758759582206278 + 0.012551863903079392i, 0.024721870530590183 + 0.0546343584232711i }, { 0.04428345733839964 + 0.010970056015241397i, -0.1449966277915668 + 0.07702868306011887i, 0.03944573694207924 + 0.13441773601686363i, 0.06162874653151836 + -0.14095350341969823i }, { 0.09637732525007672 + -0.17190353651829693i, -0.04728178470429913 + -0.00872237762678364i, -0.05231880161111861 + -0.0607670204358541i, -0.0772373383777793 + 0.13125695136528587i }, { -0.02294282767019307 + -0.03175597028284671i, 0.0008943237513225207 + -0.01190548962785221i, 0.16412374345698502 + 0.06725620453020231i, 0.03496223629849996 + -0.0434011653763613i } }), Matrix({ { -0.07291072285006857 + 0.03506850608248043i, -0.2246645785861857 + 0.030998865047210396i, -0.053421609300862774 + -0.11403944808282811i, -0.21957793228981207 + -0.045909679038509656i }, { 0.026300138951462167 + -0.062385527720282656i, -0.07173566501436544 + -0.10046664788538698i, -0.013291278485791475 + 0.0183916915510577i, -0.14797776296754278 + -0.050729533298022815i }, { -0.045097739897395135 + -0.10152491975074791i, 0.01124112725238963 + -0.009422806465299007i, 0.038465478764650146 + 0.05982822794296097i, 0.03428565520434634 + 0.1168718449500153i }, { 0.08379389314967456 + -0.14359703127954584i, -0.06156625443491243 + 0.03566728447907671i, 0.12291715703948095 + -0.07013140373977114i, 0.07876819577348088 + -0.10611661047417198i } }), Matrix({ { -0.03612391038298453 + -0.052126777758572766i, -0.02235508695018759 + 0.06937823257779707i, 0.05279981940477226 + 0.006208299893346206i, 0.15875467017944123 + -0.043664481974177785i }, { 0.013824463910166878 + -0.07720940586203126i, 0.0023505697068398803 + -0.028828070550069272i, 0.02844519045849862 + -0.005150624052117239i, 0.08707457685229252 + -0.1266042753233071i }, { 0.12117564110007129 + 0.10007876097156641i, 0.009110563002236099 + -0.10985732399514153i, -0.13612750176218183 + 0.026681383891977745i, 0.042856209347985494 + -0.05004530656138068i }, { 0.025087562721547007 + -0.13705808438210415i, 0.027758173546900803 + -0.05474927969773243i, -0.011051910349498975 + -0.0002524103799778197i, 0.002152040416530552 + 0.0858174171691394i } }), Matrix({ { 0.03503463510841907 + 0.007831814183940784i, -0.05764419992318596 + 0.06237294051390202i, 0.043578314505111876 + -0.0533778894772352i, -0.06516612030294495 + 0.02615428151440131i }, { -0.08514506600107472 + -0.09041758589435375i, -0.018551486587231082 + -0.006431961752389478i, 0.014732805245581565 + -0.11707340537995509i, 0.014239768092471376 + 0.0015702441919951697i }, { -0.1940981827232442 + -0.109358667229295i, -0.0396379249171264 + -0.010686473048298126i, 0.011483176835143473 + 0.015692605845529936i, 0.008951416628384822 + -0.05567517193671917i }, { 0.042870249635567965 + 0.012785029196373901i, 0.04457760741888329 + -0.03554234074766532i, 0.102485044827063 + 0.1127443497558862i, -0.03472609028660692 + -0.13246043707268543i } }), Matrix({ { -0.062365167741437945 + -0.03391669183106329i, 0.13885020619575403 + -0.06196793955896632i, 0.03533296553028079 + -0.07081188307936997i, -0.0525860712424933 + 0.028881947768284445i }, { 0.07999009711076874 + -0.10800528101106889i, 0.040841953283388154 + 0.1318854227108073i, -0.004026324296521352 + 0.062158365165129646i, 0.06273859733329169 + -0.08377899672986613i }, { -0.1564996811689563 + 0.06323607788942487i, 0.026028487670789906 + 0.0988764700271609i, 0.02874442453994058 + -0.016065258235306974i, 0.05468479872762905 + -0.028492195295935285i }, { -0.14466424862647978 + 0.05179034903924745i, 0.06503761371914898 + -0.07556015544110128i, -0.055205545021648754 + -0.023670203054423553i, 0.0024522649120569044 + 0.042249408590461945i } }), Matrix({ { -0.01938793525336193 + -0.09783503813974927i, 0.02660423782500924 + 0.04778367812052802i, -0.1093367020404543 + -0.05681294305249314i, 0.052773849906651564 + 0.13895488258627756i }, { 0.04002073002390523 + -0.1082261229898169i, 0.0603329537001052 + -0.15265109002070903i, 0.1682285139077883 + -0.06375373855733227i, -0.0052255513132401935 + -0.06943173371599812i }, { -0.033940720965168016 + -0.0459393570079921i, 0.15557146316539136 + 0.24490014531222445i, 0.10218479874360352 + 0.09215150513724137i, 0.1274444019239519 + 0.02277460998023633i }, { 0.10699642824236136 + -0.010323052708463721i, -0.1430699089089899 + -0.14232508777712916i, 0.13541760953013376 + -0.062276659894553055i, 0.09829657348590204 + 0.020209209177538254i } }), Matrix({ { 0.10011263712668286 + -0.20001742461999086i, 0.020198192996968053 + 0.044834995610051546i, -0.10514689346142228 + 0.026991871724942784i, 0.1850665364428515 + 0.08784389742145882i }, { 0.034999150922166926 + -0.16932559057639812i, 0.06243317262098022 + -0.1037408055171166i, 0.06689018227954942 + 0.14014246208938325i, -0.07444442938844753 + -0.0747445135372974i }, { 0.05390113493668687 + -0.3080352833530478i, 0.06478266618885 + -0.019600380539679666i, 0.08387650066537819 + 0.051745594443929704i, -0.12339618090274894 + -0.19857127963315327i }, { -0.07277440713529278 + -0.10024926810564597i, -0.08037008589193027 + 0.04138935781109533i, -0.2288338017193653 + 0.08767506849697818i, 0.01419812133835872 + -0.0554606327487176i } }), Matrix({ { 0.15652735597030584 + 0.07367130396896102i, 0.0555200329871587 + 0.048436169915968594i, 0.04055464650275061 + -0.034528563454366744i, -0.12800611514993765 + -0.21521053276042973i }, { 0.024323921090090676 + -0.10307162269835973i, 0.17426711463980382 + -0.1384839655735753i, -0.02493184920712021 + -0.18514614939795812i, 0.23510062970652804 + 0.13561785579233512i }, { -0.17337759920010917 + 0.05126783716897524i, 0.0620196236452456 + 0.09050311541170801i, -0.2919095281325347 + -0.039287064630092045i, 0.014947600561767527 + -0.0722840996893984i }, { -0.1302756769697221 + -0.021139265436521146i, 0.05633401534249663 + 0.0955397902231998i, 0.11361417994642657 + -0.019724150101208277i, 0.13417147946747401 + 0.178512738348089i } }), Matrix({ { -0.14109381267083068 + -0.005164127621416106i, 0.012136438454051001 + -0.02351372235911198i, -0.1584216569051478 + -0.07822166915714311i, 0.019663885527209362 + 0.14149942339445937i }, { -0.08562320191400916 + -0.07780945627273782i, -0.013227493663024403 + 0.005012032238312385i, 0.10511524124798831 + 0.02791306326750096i, 0.09417428212858539 + 0.005676325407088237i }, { -0.13588913925420687 + -0.007164293727137082i, -0.04761549469068948 + 0.028423749770376348i, 0.07443485300153817 + 0.019062438788413103i, -0.057948476499854094 + 0.11820012641343586i }, { 0.004509284071068708 + -0.008843050292115098i, -0.05481620713994629 + -0.11059696811499184i, 0.013129909895114983 + -0.04961776975918625i, 0.07674986198647725 + 0.06797448898700709i } }), Matrix({ { -0.24183030023174712 + 0.016916235937807268i, -0.10154563979168697 + 0.09777857806306883i, 0.20062597458135872 + 0.1518444183833011i, 0.04623555684069342 + -0.022340755956488153i }, { -0.00974396942597743 + 0.011258903083794973i, -0.18430762356897779 + -0.05037430614836077i, -0.025204479604804254 + -0.16123607664764808i, -0.01097406810080814 + -0.060784256942277064i }, { -0.05530162917561891 + -0.00624624454138065i, 0.16094723373785716 + -0.03399307817605178i, -0.03510994433700179 + 0.05934532549499348i, -0.00814819511934853 + -0.03415536475153772i }, { 0.07573107019331005 + 0.02722801799811491i, -0.029512531266071534 + 0.12532595991880802i, -0.014212986614202772 + 0.06783089505763246i, -0.01643213669537061 + -0.06717845291193941i } }), Matrix({ { -0.05347280700599401 + 0.05876231685172632i, -0.0538602413916683 + -0.007032548118626681i, -0.009613477640010797 + 0.016098469830438982i, 0.01565727175451936 + 0.0935224906137785i }, { -0.10270303674214087 + 0.022583351150999437i, 0.06090556123215835 + -0.009516657899312355i, -0.0677692307025633 + 0.012769863220887025i, -0.03833908431470268 + -0.04751016771403047i }, { 0.16005479278460488 + 0.028188842701621714i, 0.1306022303314935 + 0.14513956842251646i, 0.07323615124447838 + 0.008177106845272578i, -0.02741768636004064 + -0.11542261058861691i }, { -0.01679804789776402 + 0.05542958810775192i, 0.0022691869050266455 + -0.052743811084763566i, -0.12786919220595525 + 0.05345747035904179i, -0.12012470151944502 + 0.11129933557517102i } }), Matrix({ { 0.09591715639694115 + -0.013804880069885514i, -0.14460211133085238 + 0.006548669075966355i, 0.061366741721951515 + 0.042800598394567506i, 0.020125932566494108 + 0.08867883645357065i }, { -0.024641504475736677 + -0.0008937400349499993i, 0.13222861702647568 + -0.08358225727658251i, -0.012072245275093933 + 0.044035230433689836i, 0.06968495285101392 + -0.024455764759215147i }, { 0.1431780253601056 + 0.0015414854114087161i, -0.019955839165903863 + 0.018671155992019964i, 0.03172042375969152 + 0.02381952035238028i, -0.006903562482643766 + 0.04029553165160363i }, { -0.11498994345392563 + -0.09088340632080243i, 0.00211808671582368 + 0.09106552641190097i, -0.056395245251400536 + -0.11495220319622267i, 0.12608330278050106 + -0.0349729321271515i } }), Matrix({ { -0.12157297497409576 + -0.06456160949182609i, 0.17017033943408508 + -0.18879575861854234i, -0.09492762983727766 + 0.041219224678629714i, 0.03100215239067648 + -0.07260296660472877i }, { -0.049616154794777635 + 0.01454049292142864i, 0.11727108065428857 + -0.015672677835346784i, 0.15083344582630667 + -0.06412674486822989i, -0.00208542722561166 + 0.08977206447265304i }, { -0.06451909302132217 + -0.06482313642522405i, 0.06261526434044216 + -0.00577985035710996i, -0.033898376024168626 + -0.023833055969172037i, -0.02508651487417383 + -0.10851073109040157i }, { -0.008703636750538183 + -0.029121591410273172i, -0.04584853555182346 + 0.06727715097162336i, -0.08975301548533758 + -0.10759083526931132i, -0.1366074535150258 + -0.1002436470875719i } }), Matrix({ { 0.05018253860916403 + 0.0025445701129893396i, -0.0683504386422123 + 0.15962397415226462i, -0.18383476681418084 + 0.058732906389145516i, -0.06681355385452 + -0.12217257799184224i }, { -0.06931965666672345 + 0.0828449400094821i, -0.0015401720883439374 + 0.11337432644058286i, 0.06749166683167175 + -0.029557059673460413i, -0.13187265083248792 + 0.07706041096241126i }, { -0.11571381381710658 + 0.07798245317431987i, 0.04885293072375445 + 0.09653642511487978i, 0.16087569503712648 + 0.03845709992878229i, -0.1327718078791152 + 0.08253510951888547i }, { 0.01407253909084114 + -0.026179832483262527i, 0.081755145333444 + -0.01297219784508537i, -0.05770331857291697 + -0.023337624611856768i, 0.07174808092890261 + 0.05726519499129156i } }) }, { QubitIndex{ 8 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.014436433417816419 + 0.1455509426169929i, -0.06627143261739789 + 0.18328628452141743i }, { 0.2935893755283188 + -0.07658913362160613i, 0.13778415708271216 + 0.230394573924937i } }), Matrix({ { -0.0011566314363922886 + -0.07644001351025163i, 0.19467770338591464 + 0.08985729678353871i }, { 0.02366798938700362 + 0.3198691355476149i, 0.33477810243709055 + 0.4802939500898855i } }), Matrix({ { -0.12554684709968325 + -0.13432545917453204i, -0.20636805361040156 + 0.3418922829272023i }, { -0.3937934395023529 + 0.36433325607652084i, -0.032758263907299454 + 0.15055164280702996i } }), Matrix({ { -0.49643624931506936 + 0.10561023347355483i, 0.5018592751019376 + -0.15004313180661827i }, { -0.41074038882314134 + 0.1729091445981424i, -0.10586311459788474 + -0.1800445028879265i } }) }, { QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.04131472471840292 + -0.1906334211419927i, -0.14475524304043172 + 0.11052173904146542i, 0.07364355646587613 + -0.035544668252967315i, 0.09166163285212726 + 0.007571750724157151i }, { -0.0712326792608821 + 0.039131609220450184i, -0.08845868067516578 + -0.0201500762738241i, 0.09092414742026303 + 0.047164482456869876i, 0.0992226741910993 + -0.05714754511612766i }, { 0.0402655188155507 + 0.0957544018995135i, 0.06996924649172967 + 0.035983492471140806i, -0.137331461130178 + -0.10637744247395481i, -0.038695533712835635 + 0.07557348849636768i }, { -0.0894366964262822 + 0.023426807278593746i, -0.016654330014453073 + -0.03699353742897791i, 0.018979083815559437 + -0.1277566232071974i, 0.021740383943047344 + -0.05699623060517608i } }), Matrix({ { -0.09037380466865799 + 0.030369435576301368i, -0.04182068214196879 + -0.2056151856191475i, -0.045663459549311745 + -0.06329552727929262i, -0.1061373725122305 + 0.13164296780362553i }, { -0.16448093766794716 + -0.1806613767981829i, 0.04189372399659334 + -0.09721613146951835i, 0.017769158915411025 + 0.04329903881944569i, -0.019420522467431613 + 0.07555630098612753i }, { -0.11446601137199491 + -0.07974670553704884i, 0.05831475324780948 + 0.12095157192283576i, -0.027574679328381754 + 0.12483463800494092i, 0.1879833224091216 + -0.1644626404060465i }, { 0.016592131079100406 + 0.010097106645409956i, 0.1415320094344983 + 0.011409758419704251i, 0.1571249493724567 + 0.016197739006646925i, -0.08203153573879925 + -0.07243033238762905i } }), Matrix({ { 0.05278374533834397 + -0.06623912937412925i, 0.030056290623389357 + -0.024598575895176143i, -0.025284697545771576 + 0.04460246883813071i, -0.22835919844581656 + 0.08615754862563936i }, { -0.22608601959733518 + 0.1391442016701423i, -0.019923052144483398 + 0.11918175285665013i, 0.004662110439164607 + 0.11743970374579643i, 0.09928335392436985 + 0.13532967813527666i }, { -0.0017832997081505403 + -0.051205996301356735i, 0.057073291428154586 + -0.04235329015024914i, 0.0029481925393611535 + 0.07191376106808i, -0.1023130302388793 + -0.034563488613503356i }, { 0.08080334626292429 + -0.18805740305997362i, -0.11647948174926044 + 0.10113020943645148i, -0.05127422161822909 + 0.00012710291904145208i, 0.012794511917603935 + -0.1654689208036245i } }), Matrix({ { -0.12742846992312104 + -0.006280284390156706i, 0.09470625317538846 + 0.16628789806312036i, 0.15348047004453064 + 0.059257908956396634i, 0.021666575482775934 + -0.028246970702130465i }, { -0.10817957263730613 + 0.006641475365273635i, -0.012484322310731509 + 0.1010939032887409i, -0.020335018355814905 + -0.11961195371755258i, -0.11300627546779404 + 0.05550820190218537i }, { -0.04956900279649535 + -0.056509976902519174i, -0.044736239669540975 + -0.14023025222851554i, -0.06465754397398694 + 0.08787222241930216i, 0.009736870946287567 + 0.0829197494991372i }, { -0.006059638148478333 + 0.11029635566137952i, -0.04672703482367676 + -0.11563777060161179i, 0.07016960491092777 + -0.053679856038209725i, 0.06636076085890982 + -0.15309053320038668i } }), Matrix({ { -0.04595253783344373 + 0.1373337207511414i, -0.04431384430055264 + 0.009901264391179146i, -0.04496723700096519 + 0.1071580890966653i, 0.08199347303924953 + 0.04098948966823459i }, { 0.04668358396591356 + -0.022953432072956668i, -0.050572687752988045 + -0.03424890379807769i, 0.14366097989004561 + -0.15074869513523267i, 0.07240161128649587 + 0.07786137957215504i }, { 0.24900783463073098 + -0.043291426412970985i, 0.11811618158822312 + -0.16546079002957106i, -0.1757179625195488 + 0.0953001270366476i, 0.016645574272874674 + 0.09050419233671987i }, { -0.015788693610860355 + -0.0351571834015875i, 0.08405075413521793 + -0.06384197575941909i, 0.03760834055730805 + -0.044625098950078296i, 0.01660819393295615 + -0.024530701816288837i } }), Matrix({ { -0.10683968152521163 + -0.035670206927824966i, -0.008658555615100157 + -0.11270783649407007i, -0.10215927620230737 + -0.05323086481882951i, 0.043924037121695673 + 0.09624010378463134i }, { 0.15983275037220696 + 0.07554086299610649i, 0.11174051431384337 + -0.0270946452473658i, -0.008183432503868578 + 0.024536882110592174i, -0.014726003349088485 + -0.029598618515967984i }, { -0.05097672940572429 + 0.05113859521549291i, -0.08447411417851934 + -0.08553304329430703i, 0.0682457342528906 + -0.010426652703203892i, -0.028623277052983544 + 0.028250758111338568i }, { 0.04291295800533069 + 0.09370793680269163i, -0.21088019466441432 + -0.1403444199786509i, -0.14089886491946774 + -0.0897684940191546i, 0.05048922640031468 + -0.060960582034297175i } }), Matrix({ { -0.04634989789130613 + -0.07064439012590328i, 0.004262607999232722 + -0.006282944983897835i, -0.05268920026876196 + -0.22366501195872512i, 0.1117688665243348 + -0.19491779532100104i }, { -0.17256542394049365 + 0.041896310923042177i, -0.0230569316225278 + -0.026365409006841305i, 0.001845861672435779 + -0.04539924283432241i, 0.07750251237868587 + 0.022910777713529985i }, { 0.009718440884409065 + 0.01460764416330498i, -0.11156849252312082 + -0.0012191458851277342i, 0.025979647383088934 + 0.07782878344930745i, -0.07504754871629107 + 0.025605174726514794i }, { -0.04951936972605803 + -0.0640009122705672i, 0.09369073761193382 + -0.09473660705005717i, 0.017808614855619652 + 0.05045301388176385i, -0.014995250187242704 + -0.061404623350140276i } }), Matrix({ { -0.008477878236712241 + 0.07326234149506393i, 0.0698625722269915 + 0.05819954159559591i, -0.06607720384314758 + 0.03209373433768035i, -0.002140387488479491 + 0.09098033684314306i }, { -0.028961827988538198 + 0.1153045709231682i, 0.0033154580272587546 + -0.11920335523571621i, 0.056819269167301775 + 0.06752459136794536i, 0.09960454188036033 + -0.07820198975318834i }, { -0.08373608251752004 + 0.02503920838705599i, -0.013945740000396797 + 0.12022987069263151i, -0.08868872840600577 + 0.07270626637315629i, 0.04321848939059087 + -0.0641722444084337i }, { -0.08686497909727567 + 0.0224753900577368i, -0.008758714875370988 + -0.09542829921371325i, 0.017860461368380095 + 0.009697053565491194i, 0.04011416197034536 + 0.1180937842577625i } }), Matrix({ { 0.005696484710689495 + -0.1259784551765448i, 0.033107698901313834 + -0.02333881408753908i, 0.1492374267070806 + -0.043925177239214255i, 0.13700079798490716 + -0.06862338475719483i }, { -0.08719232543159962 + 0.04139198883207504i, -0.15584069617519575 + -0.07412803782340056i, -0.16806247861182108 + -0.011106802613980846i, -0.1366709751193335 + -0.06562812790676294i }, { -0.05391587510258937 + -0.0035739615043679064i, 0.05608348589386798 + 0.018945375989598494i, 0.0791575727729802 + 0.02570174025965799i, 0.04033338117546958 + 0.26328808786635327i }, { -0.11781747454412078 + 0.08421943078767725i, 0.10270353487353065 + 0.0759156333328735i, -0.083581846022523 + 0.025311947419546708i, -0.07412812942649785 + 0.04085391028750902i } }), Matrix({ { 0.13865734066371047 + 0.1331058410536925i, -0.027012552047741806 + 0.05209360859897915i, -0.014691830666735146 + 0.13260404204050266i, -0.03273983047962727 + 0.005264012039532686i }, { 0.03136006783079199 + -0.012546566639120115i, 0.004700033432251578 + 0.13440526558114538i, 0.04901743009622166 + -0.1377611994053254i, -0.11415851140190258 + 0.12445694039234438i }, { 0.16443360237312357 + -0.019224471377469198i, -0.14811345729762074 + 0.02990881312592929i, 0.20015944597653929 + 0.03669451733960781i, -0.13419103735792506 + 0.07901132805804302i }, { 0.0023908912870861474 + 0.0040814462729376185i, 0.08760517290579045 + -0.005674646192028264i, -0.03824854515310298 + 0.01718069581916749i, 0.08606586172625552 + -0.18185260180888452i } }), Matrix({ { -0.14336076172217982 + -0.09205075833284233i, 0.10955795312238326 + 0.05295951508511889i, 0.03769423061208967 + 0.08140766667516508i, -0.040907220910961335 + -0.13597190123048433i }, { 0.04386998909531232 + 0.05687423004511701i, 0.03331458614492157 + 0.09407248476065719i, 0.024337549847144063 + 0.009938140084908176i, -0.01427123169964069 + -0.04481536236931869i }, { -0.0035808080266346576 + -0.12539524273246377i, -0.03376072860065999 + -0.01196410715978977i, -0.1313050919686825 + -0.023038223990884503i, 0.007460979921400167 + 0.05750266699391361i }, { 0.067227785073519 + 0.010997002691163018i, 0.026132874450047684 + 0.06378571104419185i, 0.04312801766418183 + -0.20571813757911372i, -0.07421683907843976 + 0.07106053284610891i } }), Matrix({ { 0.02900324188927917 + 0.09242101716300902i, 0.12764234274295255 + -0.1936303494160893i, 0.11986155410928483 + -0.043735912009547004i, -0.01473734203215176 + -0.09231129827310891i }, { -0.002000287258534331 + -0.054569748577286525i, 0.0532504362376551 + -0.033943336255761646i, 0.026263194613280486 + -0.08630552707083607i, 0.06252131943624505 + 0.02579986201057286i }, { -0.11471634468428711 + 0.10624715835166514i, -0.046278741284007746 + -0.20028553264423785i, 0.09453155599972979 + 0.06783215240239261i, 0.022519307566737038 + 0.042632041873192125i }, { 0.039618888421495975 + 0.019064559391317237i, 0.038643283103497454 + 0.06148158963039713i, 0.056667105909300866 + -0.08807196938544362i, 0.08277874073620904 + -0.042436693327162676i } }), Matrix({ { -0.10554599342162067 + -0.10484406031668665i, -0.09043163073449974 + -0.17503189778713688i, 0.15942118095981953 + 0.020503222570022784i, 0.009551910057348135 + 0.09303665191716858i }, { -0.07869912237152109 + -0.05881549160861245i, 0.05456705842407325 + 0.0699298432658562i, 0.014377463757892088 + -0.09390037656002018i, 0.006005999255765419 + 0.021842535967193575i }, { 0.04974796064782212 + 0.05542718268435998i, 0.03122367585299084 + -0.08884058029723198i, -0.004433415273174372 + -0.09157887809056488i, -0.0489666309363087 + 0.12201318166815303i }, { -0.049631587059353235 + 0.10796934656020821i, -0.0947740623758378 + -0.08210621976456602i, 0.12085484988098351 + -0.10840527102758565i, -0.026211989348709264 + -0.0026846578891339167i } }), Matrix({ { -0.07819325277337316 + 0.025145445693502546i, -0.013090580545037684 + -0.08906190600859415i, -0.11253524355165018 + 0.06796422124691046i, -0.06340518590054839 + -0.08517432658184768i }, { -0.15598359513662527 + -0.05630469408762842i, -0.0182424630878271 + -0.004894307562974595i, -0.07886505599532942 + 0.023811924719781705i, -0.10170874988307937 + 0.027406077783345344i }, { 0.09805412164094907 + -0.047714244885601914i, -0.12172007612448874 + -0.1330416183951532i, 0.12163391113935754 + 0.21059888732710128i, -0.09373515327241287 + 0.018811882642195646i }, { 0.16949060372088381 + -0.08302155943983677i, 0.13996153849049692 + 0.08568441044473009i, 0.1661442560670211 + -0.06082644362598199i, 0.088201585036005 + -0.03967619138556563i } }), Matrix({ { -0.0665175806423298 + -0.13174691470823843i, -0.12761879645200033 + -0.0385688598672317i, 0.027038613626059672 + -0.04450210163780412i, -0.02904228897986976 + -0.061382033395257794i }, { -0.054711943295342215 + 0.015658710400528367i, -0.18699859992014903 + 0.02638681350898961i, 0.04310288522801948 + 0.10928271029750837i, 5.9284177684546727e-05 + -0.1220647903707314i }, { 0.00782540216722878 + 0.0738260584476903i, -0.029632809867458268 + 0.06497598038088659i, 0.0002263492280458872 + -0.012448236467482152i, 0.0421293623894018 + 0.05921310089062013i }, { -0.08525649936856639 + 0.12126925451849004i, 0.044202204512952564 + -0.09371705409702451i, 0.151642529695807 + -0.10244573817802557i, 0.1335989995461606 + 0.023130950128029387i } }), Matrix({ { 0.026248023711567744 + 0.025446941320087138i, 0.08136528111527239 + 0.1314939368244039i, -0.17421248282326005 + 0.017008080050388785i, 0.1238871623386461 + 0.18588749103727167i }, { 0.027808481761786307 + 0.10590890675113228i, 0.023297623668840285 + -0.023093913292771308i, -0.027327919978459375 + 0.07264078146220482i, -0.015800404627918548 + 0.050511814338089676i }, { -0.07461994145714049 + 0.10248169011845791i, 0.017968007542335625 + 0.10805169210351612i, 0.11570119088092035 + 0.03380742030706281i, -0.23927645184183538 + -0.0950985540535204i }, { -0.005275615618952453 + 0.16325307351493185i, 0.00569859949409962 + -0.050948758041190215i, 0.006322413420744202 + -0.08921421519098414i, 0.08268293542320841 + 0.023945731811897745i } }) }, { QubitIndex{ 2 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.09829913228701326 + 0.12276665026420469i, 0.2471805016823729 + -0.1719858735771641i }, { -0.32592053208122046 + -0.23118810013140012i, 0.20089974211611997 + -0.45141195123249406i } }), Matrix({ { -0.3087711679591921 + 0.43413757096321165i, -0.0090115393506636 + -0.11253647046091995i }, { 0.05898466708673701 + 0.2068966446246042i, 0.3951281139220602 + -0.07756887981618656i } }), Matrix({ { 0.17820760630160323 + -0.06544247858670385i, 0.0006860685142027547 + 0.00234137984949969i }, { -0.6292796390483509 + -0.02179039622034748i, 0.10237237165240677 + 0.19062993056700775i } }), Matrix({ { 0.07566062637847369 + -0.1215306276225648i, 0.03592386374139949 + -0.5799190274579451i }, { 0.05903203115143128 + -0.17031049038540821i, 0.2904370977604905 + 0.1467114324875311i } }) }, { QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.04912772914158681 + -0.10912418747123272i, -0.025220052770617993 + 0.19200444554982002i }, { -0.24269463097972493 + -0.20571375182945417i, 0.15740276934088931 + 0.06202294684472154i } }), Matrix({ { -0.12215743080240787 + 0.032122889093940184i, 0.36602913980831253 + 0.0152204584288946i }, { -0.045283986096692166 + -0.20497576802558673i, -0.08822341026447864 + -0.3411215988794557i } }), Matrix({ { 0.4885463150542358 + 0.3539016654716305i, -0.10074874868222383 + 0.09053118144630247i }, { -0.38920960440837693 + 0.17185025875964086i, 0.08712685694481426 + -0.12756365413217852i } }), Matrix({ { 0.0008040008825508302 + 0.4797148579421738i, -0.0176283010771921 + -0.005153252680961538i }, { 0.2121985093303154 + -0.06590756007829035i, 0.33671538376206833 + -0.7208294613191577i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.18599252163485147 + 0.34182668543205774i, -0.04122876034738353 + 0.3382884559302921i }, { -0.05720321849209562 + -0.18720233786096793i, 0.33281593595669845 + -0.26280464273731197i } }), Matrix({ { -0.14144700278258895 + -0.156586428165562i, 0.07663465537797695 + 0.24946633715049563i }, { 0.18872726494557515 + -0.13135083918184115i, -0.5554986474123345 + 0.12158588646182047i } }), Matrix({ { -0.1650583194970228 + 0.01941242559518554i, 0.10960482511515042 + 0.21468604180721812i }, { 0.5662131336225427 + -0.16951806952300605i, 0.18283523208165636 + 0.2868366370347861i } }), Matrix({ { 0.2705320448350203 + 0.12347622877913424i, -0.2436590053679483 + -0.03883941159781758i }, { -0.016577456904753138 + -0.49717525061977813i, -0.2655923266866236 + -0.08564692719264921i } }) }, { QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.010837389062582803 + 0.07776221471067496i, 0.021440161420685968 + 0.09596133746755896i, -0.008904919357169843 + 0.09210704681096274i, 0.17312351385331556 + 0.09732468352267856i }, { -0.00790583350973021 + -0.027364455883901195i, -0.042144074902627095 + 0.00524727491314849i, 0.04178623020997895 + 0.070632956276604i, 0.04463652779626045 + -0.003987175662146966i }, { -0.06522403803407405 + 0.08077494705133405i, 0.04235128912572511 + 0.08252183182596787i, -0.08968643554040472 + 0.04693739349696228i, -0.004057329853518693 + -0.10032683967050252i }, { 0.12438477008870273 + -0.04088465730474334i, 0.005274775772314939 + -0.1173499581066457i, -0.00259832020037335 + 0.04977770768186341i, 0.044145035120514875 + 0.04581048515678195i } }), Matrix({ { 0.118492485709043 + -0.021468657113446185i, -0.07429889809121952 + -0.05914032500075569i, -0.0150828392554404 + -0.01294342285718076i, 0.05305662074796312 + -0.01671783849510171i }, { 0.04065656683867675 + -0.005860005152116672i, -0.07314326764112132 + -0.07031428063223241i, 0.04004686700401118 + -0.04152818925887077i, 0.09770258360114799 + -0.008869743822442929i }, { -0.1914586323234967 + -0.07382249767991109i, -0.04533367358725546 + -0.021829260337418062i, 0.06655497317130965 + 0.05153487853438307i, 0.00153309883693006 + -0.0011198240522141579i }, { -0.10098222906783595 + -0.012183595846920086i, -0.07276635846553385 + 0.02206463106331692i, -0.1430455189473451 + 0.10758214033440133i, 0.10724965996310724 + 0.053101332640158774i } }), Matrix({ { -0.010411387366875111 + -0.0716928921341474i, 0.02221551918664017 + -0.019668855456073393i, -0.03793804924939658 + 0.16150301642469342i, -0.08486260670730447 + -0.10595255220147022i }, { 0.006492602277071257 + 0.133802722861102i, -0.14975125411101148 + 0.1602109912389033i, 0.059916594862384424 + 0.06054322349286958i, 0.07255556204045181 + 0.06609233939324792i }, { -0.2734585314432612 + -0.052080833565233686i, -0.058355277544059496 + 0.1309493319821512i, -0.07846584901804454 + -0.033307243787653956i, 0.03657067872878962 + -0.041441827072216844i }, { -0.22748741441795164 + 0.0045449680102796625i, -0.046186197726986865 + -0.15538738336506683i, -0.06157799505887497 + 0.003987155368200539i, -0.1014467064802202 + 0.16082305949470982i } }), Matrix({ { 0.036883477953496 + 0.030532486451097927i, -0.12239231970810396 + 0.03817059014533208i, -0.04169534387951605 + -0.005238972416258301i, -0.07570411629499452 + 0.02499377873644695i }, { 0.006602068193246949 + 0.033106885118605794i, -0.03057011093295121 + -0.06886262388579968i, 0.19378085751962984 + 0.09961276167133566i, 0.12476979651533834 + -0.1581738397591651i }, { 0.05818196352161083 + 0.0963710483689417i, -0.024656345606001308 + -0.0832452204892382i, 0.05815839130824755 + -0.09627484359600977i, -0.1850882341287865 + -0.08915850635828092i }, { 0.04838722296267119 + -0.011336672314855219i, 0.047267057853309535 + 0.05085229322067353i, -0.037314900350158456 + 0.08729274947038633i, 0.11668257363798336 + -0.04520154183795463i } }), Matrix({ { 0.0196462827158302 + 0.014578745443318065i, -0.05814287933328735 + 0.027619422712727118i, -0.03220970447831118 + 0.012495563719597072i, 0.10735908083831823 + -0.012891004930004477i }, { -0.0070596224728022025 + -0.06865142917294485i, -0.044131096828875456 + -0.021212615338389484i, 0.1078322729572086 + -0.03589128405673994i, -0.22652570632407915 + -0.09216164972289598i }, { 0.049456447421485875 + 0.07741349556289867i, 0.07721732055096206 + -0.12536104126932182i, -0.06436296971247255 + -0.018615699390310575i, 0.01683301368987856 + 0.0005227313629792607i }, { -0.03474586569277153 + 0.10906685113695304i, 0.06270567977450224 + -0.15124949400616017i, 0.1738622126883534 + -0.0162001679400205i, 0.011825787629480753 + 0.018595002140058943i } }), Matrix({ { 0.050527682702526625 + 0.20311190540970797i, -0.10526566674364123 + 0.0063086606427474766i, 0.07446345155724539 + -0.033489688474749306i, 0.03699717725334112 + -0.06860374494647692i }, { -0.020147209065187605 + -0.05055660564482447i, 0.018290937711046514 + -0.021784665857240437i, -0.049936768650042776 + 0.12390672436901655i, 0.016570224987134098 + 0.04789296292996082i }, { -0.14688367957189635 + -0.11674535878316679i, -0.06505754826806166 + -0.061103489762852556i, 0.14124165382428427 + -0.1433443834054109i, 0.13862879837610975 + -0.10001693426894451i }, { -0.07619171624161085 + -0.034786600058915526i, -0.1272826407059826 + -0.13857403924516165i, -0.05635302282117812 + 0.026688579539331764i, 0.11992088746217869 + -0.035475005621801725i } }), Matrix({ { -0.08842619636430904 + -0.03799653303318692i, 0.19802505669894682 + 0.01641545466319347i, 0.12833998609023203 + -0.13453329070089173i, -0.02500771531156373 + -0.017427106222555205i }, { -0.17835013612713688 + -0.05009097959624806i, 0.03173424625457294 + -0.0897234353885326i, -0.08282815888560402 + 0.1657749917007182i, 0.011487963578744249 + -0.07000107518704787i }, { -0.05251706355207975 + 0.06795259118303831i, 0.009610293260354686 + -0.018590032979393448i, -0.04400652762560488 + 0.04216273686312024i, -0.00922880420840701 + 0.13150220403723528i }, { -0.06828778100963483 + 0.022183298378661478i, 0.20379879475345447 + -0.14970851545021122i, -0.087706351980096 + 0.18709320189240897i, -0.05760236741259232 + 0.02664679659712353i } }), Matrix({ { -0.1225245730655466 + -0.07265420342964957i, -0.03334056102881747 + 0.06178067974142547i, 0.025401659607450604 + 0.022528028316462223i, -0.09836494671936603 + 0.09052169160856831i }, { -0.045909579161055605 + -0.019298955939867097i, -0.2133701454216743 + 0.0018308543247078457i, -0.11288596152831815 + 0.05531525640671472i, 0.11813706329521094 + 0.020229536520092472i }, { -0.06576858606818546 + 0.09356718365482944i, 0.0259223976328178 + 0.15275252722500482i, 0.0018632341153702922 + -0.07975825296556993i, -0.06242098861001333 + 0.052586383600749693i }, { 0.03858822670078524 + 0.11657977591854901i, -0.03642440914975589 + -0.156536635646293i, 0.016375240089508136 + 0.0722204971451637i, -0.11480408164807074 + 0.023956864306540676i } }), Matrix({ { 0.14793984775281815 + -0.2069752826238336i, 0.014231776359061756 + 0.026735055680208515i, -0.0466055397946616 + -0.03929866065422485i, 0.10398885776082249 + -0.03597065468135939i }, { 0.07519061495007272 + 0.014711782314975351i, 0.05200968412224488 + 0.1412198552833498i, -0.0001554367370865473 + -0.09381403870621273i, -0.11533026432824792 + 0.05755747499713373i }, { 0.03527987019517986 + 0.017132570712380116i, 0.12771452926602983 + 0.18342742940132867i, 0.11548549845719222 + 0.0952008750950376i, 0.10131183413313007 + -0.005905631732085462i }, { 0.03737489100774484 + -0.16561816520266712i, 0.04373811640020267 + -0.04109645519837119i, 0.017062545087702594 + 0.12877446983683594i, -0.01256932327730893 + -0.1379747952477648i } }), Matrix({ { 0.15378163992665536 + -0.09428321219001802i, 0.05998659382073225 + 0.12096147844708788i, 0.0757215452209208 + 0.10865426990376871i, -0.18791863138713774 + 0.07641738727639465i }, { 0.04929137991692787 + -0.008828888080011544i, -0.06652581365224793 + -0.008653499287392816i, 0.02171999470919771 + 0.032058199688276466i, -0.0991149006282933 + -0.13285209220918856i }, { 0.07317516437387839 + 0.0037975854778729435i, 0.05053642999155947 + -0.03125445963753243i, -0.0563890807853926 + -0.13608278308927127i, -0.05229693099053711 + 0.09597530633516574i }, { -0.14070919224724282 + 0.08435740585993699i, 0.15849314840476153 + -0.11142013136084289i, 0.13252447430242636 + 0.08369861454646882i, -0.054533476977457605 + -0.010373612809883895i } }), Matrix({ { -0.12491378113613107 + 0.07660731994022561i, 0.1142481881408126 + 0.022842831444509996i, -0.14694612029424592 + -0.20021075935582727i, 0.130998090607179 + -0.06618615799211337i }, { -0.052454358856615216 + 0.11008056627463145i, -0.03207713226202392 + -0.08310083177699039i, -0.1307909305670854 + -0.06556856373388761i, 0.062155226201678675 + 0.06169526438692063i }, { -0.05220979812638548 + 0.08142079075887183i, -0.028707008713292063 + -0.040357377665468784i, 0.0038580289360991954 + -0.11561516719918757i, -0.003271407968348199 + 0.10781732398041882i }, { -0.009822786369710998 + 0.017724985202415378i, 0.0928828011019647 + 0.04350966024710767i, -0.04513299922349159 + -0.02755968236626454i, 0.0013686614224052145 + 0.014176155744544167i } }), Matrix({ { -0.10981150606687122 + 0.026471485336437853i, -0.09133250792101506 + 0.06814309196513917i, -0.09129322389525353 + 0.14317868380365453i, 0.02841576923081077 + -0.0158101772463473i }, { -0.05807905587633898 + 0.013113034816409661i, -0.0321157935447662 + 0.17724955954696886i, -0.10012930584748875 + 0.02925630152113226i, 0.0890494972862097 + -0.03661738595033995i }, { 0.0038514309477077607 + 0.1233165902398865i, 0.014566899798626203 + -0.07593439663076597i, 0.017754096526120384 + -0.054391510681630666i, 0.11098135005108545 + -0.0741325124989086i }, { 0.1978097122118129 + -0.0729918167917521i, -0.052523894372625266 + 0.013811940619627538i, -0.03436517038761706 + -0.002220237360814395i, 0.056790005967685554 + 0.04489941473710079i } }), Matrix({ { 0.04210184836781258 + -0.04182283115890053i, -0.061183196588587 + -0.0590852244571043i, 0.027690223628138808 + 0.17748297334886184i, -0.224763652498164 + 0.18053180184977233i }, { -0.10002032915306323 + -0.010504265584128541i, 0.021598295321533012 + -0.0729618509193535i, -0.04538591177850394 + 0.10474985602606644i, -0.0025344684417278264 + -0.09071958914125958i }, { -0.016324924683411488 + 0.01604168001745049i, -0.11081780063969865 + -0.2048599052566145i, 0.02997956247080213 + -0.06778375796224072i, 0.004363702557883775 + -0.23753155987824903i }, { -0.008198377467455943 + -0.03558599758794281i, -0.0453743955315453 + -0.15129833638387827i, 0.010769150366947136 + 0.0302376503242792i, 0.03703381404194142 + 0.016427177876396384i } }), Matrix({ { 0.049125195178013954 + 0.03636513238088604i, 0.0030015578129830947 + -0.006202283374270828i, -0.11232677359695933 + -0.06746825192359741i, 0.04503467728220959 + 0.0022080341175755437i }, { 0.061302886394566825 + -0.052231139440970555i, 0.14016264700777656 + 0.1097690796561671i, 0.023399641377481458 + 0.20768953699684228i, -0.04186455240753808 + 0.10550010019409829i }, { -0.05854176289832735 + 0.027188363931032997i, -0.03176924049108531 + -0.003299703692448401i, -0.14318421373381005 + -0.09304320555041934i, -0.022601166740209254 + -0.023800576196377096i }, { -0.013073710327115916 + -0.010026986542911426i, 0.1772211906718026 + -0.050037001621504394i, -0.08760861877958896 + -0.052508724932940155i, 0.18725195159018984 + 0.022135811194552032i } }), Matrix({ { -0.0043270460117705205 + 0.06549425261459996i, 0.06545963728613428 + 0.04182756239514571i, -0.12085384641529939 + -0.08498916893754031i, -0.041175277557545936 + -0.07829628050546898i }, { 0.06950933959769252 + -0.13609108490330085i, -0.169095012198856 + -0.07699501245015254i, -0.003958566663866285 + 0.08938752955465916i, 0.010889975786616867 + 0.05708207900796762i }, { 0.029680050145458412 + 0.2082797750127303i, -0.03945238318389201 + 0.06820176580512201i, 0.11523212637825331 + 0.0288158621156161i, 0.10729903086164132 + 0.002911863812929332i }, { -0.002630090695447806 + 0.04899803789140136i, -0.0076110331845600605 + 0.10917761585432381i, -0.12990957276323695 + -0.021365096740359867i, -0.015471140145245645 + -0.08075788337624165i } }), Matrix({ { -0.05740347137276797 + -0.02986161338522686i, -0.010400286583548317 + 0.15308339459052114i, 0.1475519844442996 + -0.09075797684656688i, 0.005985544375434976 + -0.14695310685947885i }, { -0.025663756868026664 + -0.0037145055109160286i, 0.025211295016071437 + 0.02986882442808256i, 0.047686746044419324 + -0.12053158635322392i, 0.14778091006344293 + -0.1153467987055937i }, { 0.10308490594869603 + 0.25091012694972903i, 0.030259446227687885 + 0.0002882293681131296i, 0.07634135075711258 + 0.1291322832310109i, -0.032204196033171886 + 0.008998055144910267i }, { -0.03069485772280756 + -0.16807512432598468i, -0.10181547547320902 + 0.030393826198743014i, 0.02119884911240559 + 0.08010302461535893i, -0.08058059616895678 + -0.16839625683576473i } }) }, { QubitIndex{ 3 }, QubitIndex{ 1 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 9_15_2_100_0_50) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false}), Matrix({ { 0.46375918662760507 + 2.6418461253506935e-21i, 0.004305542013691275 + -0.024665470229671298i }, { 0.004305542013691276 + 0.024665470229671308i, 0.5362408133723944 + -6.073428908617497e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.46375918662760507, 1.0e-7), DoubleNear(0.5362408133723944, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false}), Matrix({ { 0.522032042241608 + -9.494888563278301e-21i, 0.044752145622345835 + 0.020979368718997027i }, { 0.044752145622345835 + -0.02097936871899703i, 0.4779679577583914 + -4.859755439754601e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.522032042241608, 1.0e-7), DoubleNear(0.4779679577583914, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false}), Matrix({ { 0.5202769868825443 + -7.914106249828249e-20i, -0.0032967328542182033 + -0.02431709436113466i }, { -0.003296732854218205 + 0.024317094361134654i, 0.4797230131174552 + 2.104861953745818e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5202769868825443, 1.0e-7), DoubleNear(0.4797230131174552, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false}), Matrix({ { 0.5065181782184183 + -4.4415875857502994e-20i, 0.04037530491528765 + -0.07064578193239202i }, { 0.04037530491528765 + 0.07064578193239202i, 0.49348182178158123 + -1.367656710332131e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5065181782184183, 1.0e-7), DoubleNear(0.49348182178158123, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false}), Matrix({ { 0.385218994222282 + 1.192506113195395e-19i, -0.014616108771253078 + -0.10896952339699571i }, { -0.014616108771253076 + 0.10896952339699571i, 0.6147810057777174 + -1.7734305428036382e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.385218994222282, 1.0e-7), DoubleNear(0.6147810057777174, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false}), Matrix({ { 0.5017885696768613 + -2.8108120086548834e-19i, 0.01414318644720638 + -0.004500322029584183i }, { 0.01414318644720638 + 0.004500322029584187i, 0.4982114303231382 + 2.2298875790466403e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5017885696768613, 1.0e-7), DoubleNear(0.4982114303231382, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false}), Matrix({ { 0.521986800905942 + -1.9489946875024656e-19i, 0.0015269567930157463 + 0.0003848914084483724i }, { 0.0015269567930157463 + -0.0003848914084483724i, 0.4780131990940575 + 1.3680702578942224e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.521986800905942, 1.0e-7), DoubleNear(0.4780131990940575, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false}), Matrix({ { 0.9999999999999994 + -5.809244296082431e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.9999999999999994, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true}), Matrix({ { 0.3058054030216648 + 2.4466017730448052e-20i, -0.08341931278451215 + -0.03205554637205666i }, { -0.08341931278451215 + 0.03205554637205666i, 0.6941945969783346 + -8.255846069127237e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.3058054030216648, 1.0e-7), DoubleNear(0.6941945969783346, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false}), Matrix({ { 0.24209715530351578 + 9.913298850182676e-20i, 0.002247630890364303 + -0.012876165796844901i, 0.02075421865365925 + 0.009729374973082686i, 0.0007101482377555588 + -0.0010135051621215242i }, { 0.0022476308903643036 + 0.012876165796844901i, 0.2799348869380922 + -1.0862787706510504e-19i, -0.0003247837513958787 + 0.0011941602690022492i, 0.023997926968686585 + 0.01124999374591434i }, { 0.02075421865365925 + -0.009729374973082686i, -0.0003247837513958785 + -0.001194160269002249i, 0.2216620313240892 + -9.649114237647606e-20i, 0.0020579111233269723 + -0.011789304432826402i }, { 0.0007101482377555591 + 0.0010135051621215246i, 0.023997926968686585 + -0.011249993745914344i, 0.0020579111233269727 + 0.011789304432826402i, 0.2563059264343023 + 4.789358797893007e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24209715530351578, 1.0e-7), DoubleNear(0.2799348869380922, 1.0e-7), DoubleNear(0.2216620313240892, 1.0e-7), DoubleNear(0.2563059264343023, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false}), Matrix({ { 0.24129310601813328 + 3.0452266623843965e-22i, 0.00321296669579439 + -0.012027181636204946i, -0.0010506008269070047 + -0.011481922281172783i, -0.0039344581188984346 + -0.0018976602518509605i }, { 0.0032129666957943902 + 0.01202718163620495i, 0.27898388086441106 + -7.944558516452087e-20i, -0.0011304543208300742 + 0.0030943440400159504i, -0.0022461320273111994 + -0.012835172079961875i }, { -0.0010506008269070047 + 0.011481922281172782i, -0.0011304543208300747 + -0.0030943440400159504i, 0.22246608060947173 + 2.337323459112254e-21i, 0.0010925753178968854 + -0.012638288593466357i }, { -0.003934458118898434 + 0.0018976602518509602i, -0.0022461320273112 + 0.012835172079961875i, 0.001092575317896886 + 0.012638288593466357i, 0.2572569325079834 + 1.8711296078345932e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24129310601813328, 1.0e-7), DoubleNear(0.27898388086441106, 1.0e-7), DoubleNear(0.22246608060947173, 1.0e-7), DoubleNear(0.2572569325079834, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false}), Matrix({ { 0.23490245834267004 + 1.7224404307192645e-20i, 0.002180835297017766 + -0.012493509045633745i, 0.018724418567355357 + -0.032762630367637297i, -0.0015686738594769 + -0.0013000442636019157i }, { 0.0021808352970177666 + 0.012493509045633748i, 0.2716157198757482 + -6.164028016469566e-20i, 0.0019163490027336342 + 0.0006917074992019436i, 0.0216508863479323 + -0.03788315156475473i }, { 0.018724418567355357 + 0.032762630367637297i, 0.0019163490027336342 + -0.0006917074992019434i, 0.22885672828493492 + -1.4582558181841976e-20i, 0.0021247067166735092 + -0.012171961184037558i }, { -0.0015686738594769005 + 0.0013000442636019157i, 0.021650886347932302 + 0.037883151564754726i, 0.00212470671667351 + 0.012171961184037558i, 0.26462509349664626 + 9.059910785206967e-22i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.23490245834267004, 1.0e-7), DoubleNear(0.2716157198757482, 1.0e-7), DoubleNear(0.22885672828493492, 1.0e-7), DoubleNear(0.26462509349664626, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false}), Matrix({ { 0.17864884743402967 + 8.981124934744984e-20i, 0.0016585765640959327 + -0.009501607633893622i, -0.006778354715416934 + -0.05053561753778853i, -0.0027507148056813806 + -0.00010865966542669852i }, { 0.0016585765640959327 + 0.009501607633893624i, 0.20657014678825233 + 2.943936197208968e-20i, 0.0026248542648987577 + -0.0008296860569686604i, -0.007837754055836144 + -0.05843390585920717i }, { -0.006778354715416933 + 0.05053561753778854i, 0.002624854264898757 + 0.0008296860569686603i, 0.2851103391935753 + -8.716940322209916e-20i, 0.002646965449595343 + -0.01516386259577768i }, { -0.0027507148056813814 + 0.0001086596654266991i, -0.007837754055836144 + 0.05843390585920717i, 0.002646965449595344 + 0.015163862595777684i, 0.3296706665841421 + -9.017365105826464e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.17864884743402967, 1.0e-7), DoubleNear(0.20657014678825233, 1.0e-7), DoubleNear(0.2851103391935753, 1.0e-7), DoubleNear(0.3296706665841421, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false}), Matrix({ { 0.23276060737476376 + -2.3192658765905482e-20i, 0.002300431995529968 + -0.012326060037068147i, 0.006158315585760413 + -0.001948124178100045i, 0.0005462116553298731 + -0.00039828784786686465i }, { 0.0023004319955299683 + 0.012326060037068147i, 0.2690279623020975 + -2.5788854209958286e-19i, -0.00011249445460995963 + -0.00017287022662894084i, 0.007984870861445966 + -0.002552197851484141i }, { 0.0061583155857604125 + 0.0019481241781000467i, -0.00011249445460995952 + 0.00017287022662894073i, 0.23099857925284126 + 2.583450489125616e-20i, 0.0020051100181613076 + -0.012339410192603156i }, { 0.000546211655329873 + 0.0003982878478668646i, 0.007984870861445968 + 0.002552197851484141i, 0.002005110018161308 + 0.012339410192603161i, 0.2672128510702969 + 1.9715425301340787e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.23276060737476376, 1.0e-7), DoubleNear(0.2690279623020975, 1.0e-7), DoubleNear(0.23099857925284126, 1.0e-7), DoubleNear(0.2672128510702969, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false}), Matrix({ { 0.2416909935383713 + -5.49746408117427e-20i, 0.003742659755034169 + -0.01122337867329754i, 0.0006453334027129503 + 0.00014902600734913282i, 2.5387751928117833e-05 + 6.414530169405161e-05i }, { 0.003742659755034169 + 0.011223378673297542i, 0.28029580736757065 + -1.3992482793850388e-19i, 7.09939241031846e-05 + -2.581026960167894e-05i, 0.0008816233903027959 + 0.00023586540109923936i }, { 0.0006453334027129503 + -0.00014902600734913272i, 7.09939241031846e-05 + 2.581026960167894e-05i, 0.2220681930892337 + 5.761648693709338e-20i, 0.0005628822586571068 + -0.013442091556373761i }, { 2.538775192811782e-05 + -6.414530169405162e-05i, 0.0008816233903027962 + -0.00023586540109923958i, 0.0005628822586571074 + 0.013442091556373766i, 0.2559450060048237 + 7.91905388523289e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2416909935383713, 1.0e-7), DoubleNear(0.28029580736757065, 1.0e-7), DoubleNear(0.2220681930892337, 1.0e-7), DoubleNear(0.2559450060048237, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false}), Matrix({ { 0.46375918662760507 + 2.6418461253506935e-21i, 0.004305542013691275 + -0.024665470229671298i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.004305542013691276 + 0.024665470229671308i, 0.5362408133723944 + -6.073428908617497e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.46375918662760507, 1.0e-7), DoubleNear(0.5362408133723944, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true}), Matrix({ { 0.14197664994328993 + 5.927093789113997e-20i, 0.00129182837048709 + -0.007482183295597364i, -0.0389935953307801 + -0.013666288390557047i, -0.0009187750703097636 + 0.0017417478021503061i }, { 0.0012918283704870903 + 0.007482183295597366i, 0.16382875307837486 + -3.480492016069188e-20i, 0.0005978935563477614 + -0.002823575964863493i, -0.04442571745373204 + -0.018389257981499617i }, { -0.0389935953307801 + 0.013666288390557047i, 0.0005978935563477614 + 0.002823575964863492i, 0.3217825366843151 + -5.662909176578927e-20i, 0.0030137136432041856 + -0.017183286934073935i }, { -0.0009187750703097636 + -0.0017417478021503068i, -0.04442571745373204 + 0.018389257981499617i, 0.003013713643204186 + 0.017183286934073942i, 0.3724120602940196 + -2.5929368925483092e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.14197664994328993, 1.0e-7), DoubleNear(0.16382875307837486, 1.0e-7), DoubleNear(0.3217825366843151, 1.0e-7), DoubleNear(0.3724120602940196, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false}), Matrix({ { 0.271601257993605 + -1.4870054284018177e-20i, 0.023283511480922947 + 0.010915082743817684i, -0.0017210001846125365 + -0.01269430243072502i, 0.00036262142000694246 + -0.0011574055220784987i }, { 0.023283511480922947 + -0.010915082743817684i, 0.24867572888893924 + -6.427100821426434e-20i, -0.0006576931575468323 + -0.001019078773845148i, -0.0015757326696056694 + -0.011622791930409635i }, { -0.0017210001846125343 + 0.012694302430725023i, -0.0006576931575468326 + 0.0010190787738451482i, 0.25043078424800297 + 5.375165720739828e-21i, 0.021468634141422884 + 0.010064285975179344i }, { 0.0003626214200069427 + 0.0011574055220784985i, -0.0015757326696056694 + 0.011622791930409632i, 0.021468634141422884 + -0.010064285975179346i, 0.22929222886945222 + 1.567345381671834e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.271601257993605, 1.0e-7), DoubleNear(0.24867572888893924, 1.0e-7), DoubleNear(0.25043078424800297, 1.0e-7), DoubleNear(0.22929222886945222, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false}), Matrix({ { 0.26218069900431834 + 1.7983997197011243e-20i, 0.016888253741218783 + 0.0005659945597440683i, 0.013283457502546564 + -0.024750601594897056i, 0.021188442072920206 + -0.007334068889487163i }, { 0.016888253741218787 + -0.0005659945597440685i, 0.2443374792140999 + -6.239987305451423e-20i, -0.03357117712352168 + -0.00458834943888143i, 0.02709184741274109 + -0.04589518033749497i }, { 0.013283457502546562 + 0.024750601594897056i, -0.03357117712352167 + 0.00458834943888143i, 0.25985134323728964 + -2.7478885760289527e-20i, 0.027863891881127045 + 0.02041337415925296i }, { 0.021188442072920206 + 0.007334068889487163i, 0.02709184741274109 + 0.04589518033749497i, 0.027863891881127045 + -0.020413374159252963i, 0.23363047854429156 + 1.3802318656968224e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.26218069900431834, 1.0e-7), DoubleNear(0.2443374792140999, 1.0e-7), DoubleNear(0.25985134323728964, 1.0e-7), DoubleNear(0.23363047854429156, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false}), Matrix({ { 0.20109665826411616 + 7.954577344783673e-20i, 0.01723937652592917 + 0.008081651317350443i, -0.007630077111482727 + -0.05688558284102839i, 0.001632009582315783 + -0.005183256714609062i }, { 0.01723937652592917 + -0.008081651317350443i, 0.1841223359581658 + 3.970483787170278e-20i, -0.0029402140386421117 + -0.004569983244310891i, -0.00698603165977035 + -0.05208394055596732i }, { -0.007630077111482727 + 0.05688558284102839i, -0.002940214038642112 + 0.004569983244310891i, 0.32093538397749183 + -8.904066201111503e-20i, 0.027512769096416662 + 0.012897717401646584i }, { 0.001632009582315783 + 0.005183256714609061i, -0.00698603165977035 + 0.052083940555967316i, 0.027512769096416666 + -0.012897717401646587i, 0.2938456218002256 + -8.830239226924878e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.20109665826411616, 1.0e-7), DoubleNear(0.1841223359581658, 1.0e-7), DoubleNear(0.32093538397749183, 1.0e-7), DoubleNear(0.2938456218002256, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false}), Matrix({ { 0.2619497118019074 + -1.803508256269273e-19i, 0.022456115141807537 + 0.01052720742222901i, 0.007383196504838982 + -0.0023493122998487336i, 0.0007273518546622403 + 9.531605652206147e-05i }, { 0.022456115141807537 + -0.010527207422229012i, 0.23983885787495385 + -1.0073037523856102e-19i, 0.0005385240242364964 + -0.000498114190152867i, 0.006759989942367398 + -0.0021510097297354532i }, { 0.007383196504838983 + 0.0023493122998487336i, 0.0005385240242364962 + 0.0004981141901528672i, 0.2600823304397005 + 1.7085593706364901e-19i, 0.022296030480538298 + 0.010452161296768018i }, { 0.00072735185466224 + -9.531605652206168e-05i, 0.006759989942367398 + 0.0021510097297354584i, 0.022296030480538298 + -0.01045216129676802i, 0.2381290998834376 + 5.2132820841015026e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2619497118019074, 1.0e-7), DoubleNear(0.23983885787495385, 1.0e-7), DoubleNear(0.2600823304397005, 1.0e-7), DoubleNear(0.2381290998834376, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false}), Matrix({ { 0.27249383570009267 + -2.2488926032706507e-19i, 0.023360029327085172 + 0.010950953562655455i, 0.0007971203730727067 + 0.0002009256479935526i, 6.025981398545839e-05 + 4.9259305938325885e-05i }, { 0.023360029327085172 + -0.010950953562655456i, 0.2494929652058493 + 2.998979157681849e-20i, 7.640937153468342e-05 + -1.480987321898322e-05i, 0.0007298364199430395 + 0.00018396576045481947i }, { 0.0007971203730727069 + -0.00020092564799355282i, 7.640937153468338e-05 + 1.480987321898322e-05i, 0.24953820654151532 + 2.1539437176378676e-19i, 0.021392116295260662 + 0.010028415156341574i }, { 6.0259813985458416e-05 + -4.925930593832594e-05i, 0.0007298364199430395 + -0.00018396576045481958i, 0.021392116295260666 + -0.010028415156341574i, 0.22847499255254217 + -7.858734597436449e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.27249383570009267, 1.0e-7), DoubleNear(0.2494929652058493, 1.0e-7), DoubleNear(0.24953820654151532, 1.0e-7), DoubleNear(0.22847499255254217, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false}), Matrix({ { 0.522032042241608 + -9.494888563278301e-21i, 0.044752145622345835 + 0.020979368718997027i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.044752145622345835 + -0.02097936871899703i, 0.4779679577583914 + -4.859755439754601e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.522032042241608, 1.0e-7), DoubleNear(0.4779679577583914, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true}), Matrix({ { 0.15964021906791775 + 1.2506822791710929e-20i, 0.013685447928125708 + 0.006415604306252996i, -0.04354755421529038 + -0.016734022337775316i, -0.0030606881066202202 + -0.003184639000437764i }, { 0.013685447928125708 + -0.006415604306252997i, 0.14616518395374703 + 1.1959194938737117e-20i, -0.004405698360276789 + 0.0003155300419454834i, -0.03987175856922176 + -0.015321524034281345i }, { -0.04354755421529038 + 0.016734022337775316i, -0.004405698360276789 + -0.0003155300419454833i, 0.36239182317369023 + -2.200171135498923e-20i, 0.031066697694220127 + 0.014563764412744032i }, { -0.0030606881066202202 + 0.003184639000437764i, -0.03987175856922177 + 0.015321524034281345i, 0.03106669769422013 + -0.014563764412744033i, 0.3318027738046444 + -6.055674933628312e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.15964021906791775, 1.0e-7), DoubleNear(0.14616518395374703, 1.0e-7), DoubleNear(0.36239182317369023, 1.0e-7), DoubleNear(0.3318027738046444, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false}), Matrix({ { 0.26352975156471437 + -9.713536139838645e-20i, -0.0016698551193914117 + -0.012317050335367305i, 0.02100634198578985 + -0.03675537455974623i, -0.001851006739679426 + -0.0007489098291761824i }, { -0.0016698551193914117 + 0.012317050335367306i, 0.2429884266537039 + 5.2719485540883456e-20i, 0.001584793551252813 + 0.0012147103697930863i, 0.0193689629294978 + -0.033890407372645794i }, { 0.02100634198578985 + 0.03675537455974623i, 0.0015847935512528126 + -0.0012147103697930863i, 0.25674723531782995 + 1.7994298900103973e-20i, -0.0016268777348267928 + -0.012000044025767355i }, { -0.0018510067396794259 + 0.0007489098291761824i, 0.0193689629294978 + 0.033890407372645794i, -0.0016268777348267928 + 0.012000044025767355i, 0.23673458646375128 + -3.167086600342527e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.26352975156471437, 1.0e-7), DoubleNear(0.2429884266537039, 1.0e-7), DoubleNear(0.25674723531782995, 1.0e-7), DoubleNear(0.23673458646375128, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false}), Matrix({ { 0.2004205776038932 + 1.7850649929230393e-19i, -0.0012699641143214904 + -0.009367406632204624i, -0.007604425031455082 + -0.056694335295015864i, -0.0026016367769456 + 0.0007146647040745443i }, { -0.0012699641143214908 + 0.00936740663220462i, 0.18479841661838875 + -5.92558879727644e-20i, 0.002698007588919634 + 3.822111708205896e-06i, -0.007011683739797995 + -0.05227518810197985i }, { -0.007604425031455082 + 0.056694335295015864i, 0.0026980075889196336 + -3.822111708205842e-06i, 0.3198564092786511 + -2.576475617905864e-19i, -0.0020267687398967146 + -0.014949687728930034i }, { -0.002601636776945599 + -0.0007146647040745445i, -0.007011683739797995 + 0.05227518810197985i, -0.0020267687398967133 + 0.014949687728930036i, 0.2949245964990664 + 8.030450751022257e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2004205776038932, 1.0e-7), DoubleNear(0.18479841661838875, 1.0e-7), DoubleNear(0.3198564092786511, 1.0e-7), DoubleNear(0.2949245964990664, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false}), Matrix({ { 0.2616726556469113 + -2.5147253178098504e-19i, -0.0004156983064281172 + -0.009493363131600624i, 0.0073788453616977865 + -0.004061054311220107i, 0.006990301757108909 + -0.0035808820234211614i }, { -0.00041569830642811806 + 0.00949336313160062i, 0.24011591402995003 + -2.9608669084503287e-20i, -0.007191008331058276 + -0.0029191210988910917i, 0.006764341085508593 + -0.0004392677183640767i }, { 0.0073788453616977865 + 0.00406105431122011i, -0.007191008331058277 + 0.0029191210988910917i, 0.2586043312356331 + 1.7233146928270258e-19i, -0.002881034547790086 + -0.014823731229534036i }, { 0.006990301757108909 + 0.003580882023421162i, 0.006764341085508593 + 0.0004392677183640784i, -0.002881034547790086 + 0.014823731229534034i, 0.23960709908750513 + 5.0657288621961473e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2616726556469113, 1.0e-7), DoubleNear(0.24011591402995003, 1.0e-7), DoubleNear(0.2586043312356331, 1.0e-7), DoubleNear(0.23960709908750513, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false}), Matrix({ { 0.2797664425096701 + -1.998242496468034e-19i, 0.014112520730593103 + 0.02217585501863168i, 0.0008800206330773252 + 0.00018187469343219822i, -0.0008924686675926088 + 0.0006499126489588035i }, { 0.014112520730593103 + -0.022175855018631688i, 0.24222035839627193 + 4.924780896556848e-21i, -0.00031219734824477856 + 0.0005904667394710995i, 0.0006469361599384213 + 0.00020301671501617407i }, { 0.0008800206330773251 + -0.00018187469343219865i, -0.00031219734824477834 + -0.0005904667394710997i, 0.24051054437287425 + 1.206831871485209e-19i, -0.017409253584811307 + -0.04649294937976634i }, { -0.0008924686675926096 + -0.0006499126489588028i, 0.0006469361599384213 + -0.00020301671501617407i, -0.017409253584811307 + 0.04649294937976634i, 0.23750265472118323 + 1.6123838640901335e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2797664425096701, 1.0e-7), DoubleNear(0.24222035839627193, 1.0e-7), DoubleNear(0.24051054437287425, 1.0e-7), DoubleNear(0.23750265472118323, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false}), Matrix({ { 0.5202769868825443 + -7.914106249828249e-20i, -0.0032967328542182033 + -0.02431709436113466i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003296732854218205 + 0.024317094361134654i, 0.4797230131174552 + 2.104861953745818e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5202769868825443, 1.0e-7), DoubleNear(0.4797230131174552, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true}), Matrix({ { 0.1591059439055323 + -1.0803030943624998e-20i, -0.0010190014874180246 + -0.007432809626147485i, -0.043399836126896574 + -0.016668958646549763i, -0.0005258586559102018 + 0.002099109985661129i }, { -0.0010190014874180246 + 0.007432809626147485i, 0.14669945911613252 + 3.526904867407305e-20i, 0.0010587228873337811 + -0.0019627039683938084i, -0.04001947665761556 + -0.015386587725506898i }, { -0.043399836126896574 + 0.016668958646549763i, 0.0010587228873337811 + 0.001962703968393809i, 0.361171042977012 + -6.833803155465749e-20i, -0.0022777313668001786 + -0.016884284734987175i }, { -0.0005258586559102017 + -0.002099109985661129i, -0.04001947665761556 + 0.015386587725506898i, -0.0022777313668001804 + 0.01688428473498717i, 0.33302355400132266 + -1.4220429136614872e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1591059439055323, 1.0e-7), DoubleNear(0.14669945911613252, 1.0e-7), DoubleNear(0.361171042977012, 1.0e-7), DoubleNear(0.33302355400132266, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false}), Matrix({ { 0.19512042316860173 + -2.315426668601334e-21i, 0.015553334350885075 + -0.027214097062042728i, -0.007403324787457357 + -0.055195044472375596i, -0.008288367035495207 + -0.003367111300673208i }, { 0.015553334350885073 + 0.027214097062042728i, 0.1900985710536802 + 1.2156603798814085e-19i, 0.0071081073388665 + -0.0054322441665813435i, -0.0072127839837957215 + -0.0537744789246201i }, { -0.007403324787457357 + 0.0551950444723756i, 0.0071081073388665 + 0.0054322441665813435i, 0.3113977550498165 + -4.210044918890167e-20i, 0.024821970564402576 + -0.0434316848703493i }, { -0.008288367035495205 + 0.0033671113006732084i, -0.007212783983795721 + 0.0537744789246201i, 0.02482197056440258 + 0.04343168487034929i, 0.303383250727901 + -1.3524260509146216e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.19512042316860173, 1.0e-7), DoubleNear(0.1900985710536802, 1.0e-7), DoubleNear(0.3113977550498165, 1.0e-7), DoubleNear(0.303383250727901, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false}), Matrix({ { 0.25416503216354974 + -1.814831032467822e-19i, 0.02025986650370935 + -0.03544924586955846i, 0.0071637810334424035 + -0.0022794949158211966i, 0.0002531066965521778 + -0.0011808583397399527i }, { 0.020259866503709346 + 0.03544924586955846i, 0.2476235375133115 + -9.959809761870612e-20i, 0.0008889642340072664 + 0.0008174545914170568i, 0.006979405413763977 + -0.0022208271137629867i }, { 0.007163781033442403 + 0.0022794949158211966i, 0.0008889642340072662 + -0.0008174545914170574i, 0.2523531460548685 + 1.3706722738927922e-19i, 0.020115438411578302 + -0.035196536062833565i }, { 0.0002531066965521776 + 0.0011808583397399524i, 0.006979405413763977 + 0.0022208271137629902i, 0.020115438411578306 + 0.035196536062833565i, 0.24585828426826967 + 8.592153051538481e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.25416503216354974, 1.0e-7), DoubleNear(0.2476235375133115, 1.0e-7), DoubleNear(0.2523531460548685, 1.0e-7), DoubleNear(0.24585828426826967, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false}), Matrix({ { 0.2643958034489381 + -1.1020707116718498e-19i, 0.021075376248332965 + -0.03687616570838813i, 0.0007734313730165746 + 0.00019495449501919046i, 8.884230061937552e-05 + -9.233294864419759e-05i }, { 0.02107537624833297 + 0.03687616570838813i, 0.2575909974570039 + -8.469239758306156e-20i, 3.446039160158562e-05 + 0.0001234131645949527i, 0.0007535254199991717 + 0.0001899369134291814i }, { 0.0007734313730165745 + -0.00019495449501919068i, 3.4460391601585596e-05 + -0.00012341316459495272i, 0.24212237476948018 + 6.5791195309682e-20i, 0.019299928666954687 + -0.033769616224003894i }, { 8.884230061937553e-05 + 9.233294864419756e-05i, 0.0007535254199991718 + -0.00018993691342918204i, 0.019299928666954687 + 0.033769616224003894i, 0.2358908243245773 + 7.101583047974026e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2643958034489381, 1.0e-7), DoubleNear(0.2575909974570039, 1.0e-7), DoubleNear(0.24212237476948018, 1.0e-7), DoubleNear(0.2358908243245773, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false}), Matrix({ { 0.5065181782184183 + -4.4415875857502994e-20i, 0.04037530491528765 + -0.07064578193239202i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04037530491528765 + 0.07064578193239202i, 0.49348182178158123 + -1.367656710332131e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5065181782184183, 1.0e-7), DoubleNear(0.49348182178158123, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true}), Matrix({ { 0.15489599562788292 + 4.6754303264030064e-20i, 0.012346986391742152 + -0.0216038618156158i, -0.04225339833984352 + -0.016236716950170177i, -0.005632669328222429 + 0.004598970120926718i }, { 0.012346986391742152 + 0.0216038618156158i, 0.1509094073937819 + -2.2288285533582012e-20i, -0.0011034910507744364 + -0.007187475038922581i, -0.04116591444466862 + -0.015818829421886484i }, { -0.04225339833984351 + 0.016236716950170177i, -0.0011034910507744364 + 0.007187475038922581i, 0.35162218259053535 + -9.117017912153306e-20i, 0.028028318523545502 + -0.04904192011677622i }, { -0.005632669328222429 + -0.004598970120926718i, -0.04116591444466862 + 0.015818829421886484i, 0.028028318523545502 + 0.04904192011677622i, 0.34257241438779934 + 8.611718430260703e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.15489599562788292, 1.0e-7), DoubleNear(0.1509094073937819, 1.0e-7), DoubleNear(0.35162218259053535, 1.0e-7), DoubleNear(0.34257241438779934, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false}), Matrix({ { 0.19329848812315806 + -6.062767073629198e-20i, -0.007334196314568513 + -0.05467966128374778i, 0.005448224058291054 + -0.001733609525912799i, -0.00069711629818127 + -0.0014753990901768595i }, { -0.007334196314568511 + 0.05467966128374777i, 0.30849008155370317 + -2.2045353012919636e-19i, 0.00028367959521230827 + 0.001606953482756998i, 0.008694962388915326 + -0.002766712503671385i }, { 0.005448224058291054 + 0.0017336095259128i, 0.0002836795952123087 + -0.0016069534827569977i, 0.1919205060991239 + 1.798782820558315e-19i, -0.007281912456684565 + -0.05428986211324793i }, { -0.0006971162981812711 + 0.0014753990901768595i, 0.008694962388915326 + 0.002766712503671387i, -0.007281912456684565 + 0.05428986211324793i, 0.30629092422401427 + 4.311047584883254e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.19329848812315806, 1.0e-7), DoubleNear(0.30849008155370317, 1.0e-7), DoubleNear(0.1919205060991239, 1.0e-7), DoubleNear(0.30629092422401427, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false}), Matrix({ { 0.20107923044229362 + 1.6948716350166823e-21i, -0.007629415859199676 + -0.05688065291424302i, 0.0005882127600264073 + 0.00014826748124727933i, 1.962326676249561e-05 + -0.0001720173686737332i }, { -0.007629415859199676 + 0.05688065291424302i, 0.3209075704636484 + -1.9659434038526326e-19i, -6.425959991393954e-05 + 0.00016076613929172872i, 0.0009387440329893389 + 0.00023662392720109307i }, { 0.0005882127600264073 + -0.00014826748124727976i, -6.425959991393938e-05 + -0.0001607661392917287i, 0.18413976377998836 + 1.1755573968452283e-19i, -0.006986692912053401 + -0.052088870482752694i }, { 1.9623266762495582e-05 + 0.0001720173686737332i, 0.0009387440329893389 + -0.00023662392720109307i, -0.0069866929120534 + 0.052088870482752694i, 0.2938734353140691 + 1.925128610489942e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.20107923044229362, 1.0e-7), DoubleNear(0.3209075704636484, 1.0e-7), DoubleNear(0.18413976377998836, 1.0e-7), DoubleNear(0.2938734353140691, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false}), Matrix({ { 0.385218994222282 + 1.192506113195395e-19i, -0.014616108771253078 + -0.10896952339699571i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014616108771253076 + 0.10896952339699571i, 0.6147810057777174 + -1.7734305428036382e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.385218994222282, 1.0e-7), DoubleNear(0.6147810057777174, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true}), Matrix({ { 0.11780204977974537 + 8.249256601793906e-20i, -0.0044696850334015395 + -0.03332346901949702i, -0.03213470376956373 + -0.012348405332689393i, -0.0022738118611116986 + 0.009558690108729131i }, { -0.0044696850334015395 + 0.03332346901949702i, 0.18800335324191944 + -5.802654828749101e-20i, 0.004712343359674923 + -0.008621635403737275i, -0.05128460901494841 + -0.019707141039367267i }, { -0.03213470376956373 + 0.012348405332689393i, 0.004712343359674923 + 0.008621635403737275i, 0.2674169444425366 + 3.675804530160046e-20i, -0.010146423737851538 + -0.07564605437749869i }, { -0.002273811861111698 + -0.009558690108729131i, -0.05128460901494841 + 0.019707141039367267i, -0.010146423737851537 + 0.07564605437749869i, 0.426777652535798 + -1.1931650599287282e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11780204977974537, 1.0e-7), DoubleNear(0.18800335324191944, 1.0e-7), DoubleNear(0.2674169444425366, 1.0e-7), DoubleNear(0.426777652535798, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false}), Matrix({ { 0.2814349402493782 + -2.851344456101883e-19i, 0.0074110891950553755 + -0.05387598904289488i, 0.0018906902480639361 + -0.0052069194788512555i, 0.028329031437818633 + 0.00565805415386085i }, { 0.0074110891950553755 + 0.053875989042894895i, 0.24055186065656375 + 9.023497685994172e-20i, 0.024170333705334047 + 0.004879073241149213i, -0.00036373345504818987 + 0.005591810887299628i }, { 0.0018906902480639361 + 0.0052069194788512555i, 0.024170333705334047 + -0.004879073241149213i, 0.22035362942748304 + 4.053244744699937e-21i, 0.006732097252151004 + 0.0493756670133107i }, { 0.028329031437818637 + -0.00565805415386085i, -0.0003637334550481898 + -0.005591810887299628i, 0.006732097252151004 + -0.049375667013310705i, 0.25765956966657444 + 1.327537810447223e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2814349402493782, 1.0e-7), DoubleNear(0.24055186065656375, 1.0e-7), DoubleNear(0.22035362942748304, 1.0e-7), DoubleNear(0.25765956966657444, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false}), Matrix({ { 0.5017885696768613 + -2.8108120086548834e-19i, 0.01414318644720638 + -0.004500322029584183i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01414318644720638 + 0.004500322029584187i, 0.4982114303231382 + 2.2298875790466403e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.5017885696768613, 1.0e-7), DoubleNear(0.4982114303231382, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true}), Matrix({ { 0.15345379690845928 + 1.4641099086553552e-21i, 0.0035827635699653172 + -0.0014937442582612787i, -0.04143953529902764 + -0.0163145884112335i, 0.0029324684127171596 + -0.009538412518818352i }, { 0.0035827635699653172 + 0.0014937442582612752i, 0.15235160611320553 + 2.3001907821792698e-20i, 0.003056216426215545 + -0.010066163829623418i, -0.041979777485484496 + -0.015740957960823157i }, { -0.04143953529902764 + 0.0163145884112335i, 0.003056216426215545 + 0.010066163829623418i, 0.34833477276840197 + -2.825453107741437e-19i, 0.010560422877241063 + -0.0030065777713229047i }, { 0.0029324684127171596 + 0.009538412518818352i, -0.041979777485484496 + 0.01574095796082316i, 0.010560422877241063 + 0.0030065777713229117i, 0.34585982420993266 + 1.9998685008287134e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.15345379690845928, 1.0e-7), DoubleNear(0.15235160611320553, 1.0e-7), DoubleNear(0.34833477276840197, 1.0e-7), DoubleNear(0.34585982420993266, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false}), Matrix({ { 0.521986800905942 + -1.9489946875024656e-19i, 0.0015269567930157463 + 0.0003848914084483724i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0015269567930157463 + -0.0003848914084483724i, 0.4780131990940575 + 1.3680702578942224e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.521986800905942, 1.0e-7), DoubleNear(0.4780131990940575, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true}), Matrix({ { 0.15963342874389763 + -1.9031155131326358e-20i, 0.00038749209632882363 + 0.00011416661285571124i, -0.043538898186655114 + -0.016706931914777817i, 0.0004966757412659407 + -0.0009318241474386619i }, { 0.00038749209632882363 + -0.00011416661285571124i, 0.14617197427776718 + 4.349717286177441e-20i, 0.00012363385136889715 + -0.0011004197212551943i, -0.03988041459785703 + -0.015348614457278842i }, { -0.043538898186655114 + 0.016706931914777817i, 0.00012363385136889715 + 0.0011004197212551945i, 0.36235337216204433 + -1.758683136189202e-19i, 0.0011394646966869225 + 0.00027072479559266116i }, { 0.0004966757412659407 + 0.0009318241474386619i, -0.03988041459785703 + 0.015348614457278843i, 0.0011394646966869225 + -0.00027072479559266116i, 0.3318412248162903 + 9.330985292764784e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.15963342874389763, 1.0e-7), DoubleNear(0.14617197427776718, 1.0e-7), DoubleNear(0.36235337216204433, 1.0e-7), DoubleNear(0.3318412248162903, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true}), Matrix({ { 0.3058054030216648 + 2.4466017730448052e-20i, 0.0 + 0.0i, -0.08341931278451215 + -0.03205554637205666i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08341931278451215 + 0.03205554637205666i, 0.0 + 0.0i, 0.6941945969783346 + -8.255846069127237e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3058054030216648, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6941945969783346, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false, false}), Matrix({ { 0.12596273291346705 + 1.2589220258178704e-21i, 0.0016772715658598175 + -0.006278574191958836i, 0.010798384218191638 + 0.005062177040506461i, 0.00039610983164623155 + -0.00047083617101691957i, -0.0005484472952509865 + -0.005993931337300053i, -0.002053913206922626 + -0.0009906394567544814i, 0.000193866839942892 + -0.0005358816000756671i, -0.0001362637285549976 + -0.00016746681551839341i }, { 0.001677271565859818 + 0.006278574191958837i, 0.14563852508013803 + -1.6128976309836e-20i, -0.00010853552474635584 + 0.0006056481970027759i, 0.012485127262731311 + 0.005852905703311222i, -0.0005901333777637741 + 0.0016153467386076756i, -0.0011725528893615491 + -0.0067003710934249675i, -0.0001155076409441231 + 0.00011476231706775429i, 0.00016875458006405052 + -0.0006215239220028315i }, { 0.01079838421819164 + -0.005062177040506462i, -0.00010853552474635567 + -0.0006056481970027757i, 0.11533037310466626 + -9.543993595794353e-22i, 0.0015356951299345723 + -0.00574860744424611i, -0.00028790012233629035 + -0.0004917997158273364i, -0.0002158871568089297 + -2.3819203467499553e-06i, -0.0005021535316560189 + -0.005487990943872728i, -0.001880544911975808 + -0.0009070207950964788i }, { 0.0003961098316462317 + 0.0004708361710169197i, 0.012485127262731311 + -0.005852905703311222i, 0.0015356951299345728 + 0.005748607444246112i, 0.13334535578427298 + -6.33166088546849e-20i, 1.4327128173727955e-05 + 0.00016219475310110933i, -0.00036979303521054204 + -0.0005272790580178117i, -0.0005403209430663003 + 0.0014789973014082752i, -0.0010735791379496503 + -0.006134800986536904i }, { -0.0005484472952509865 + 0.005993931337300052i, -0.0005901333777637743 + -0.0016153467386076752i, -0.00028790012233629057 + 0.0004917997158273367i, 1.4327128173727959e-05 + -0.00016219475310110933i, 0.11613442239004877 + 9.787406647600887e-20i, 0.0005703593245044856 + -0.006597591604886065i, 0.009955834435467608 + 0.004667197932576225i, 0.0003140384061093273 + -0.0005426689911046047i }, { -0.0020539132069226263 + 0.0009906394567544816i, -0.0011725528893615498 + 0.0067003710934249675i, -0.00021588715680892972 + 2.3819203467499485e-06i, -0.00036979303521054204 + 0.0005272790580178115i, 0.0005703593245044857 + 0.006597591604886065i, 0.13429636185795418 + -9.249890075526906e-20i, -0.00021624822664952287 + 0.0005885120719994731i, 0.011512799705955274 + 0.005397088042603119i }, { 0.0001938668399428921 + 0.0005358816000756673i, -0.00011550764094412312 + -0.00011476231706775429i, -0.0005021535316560193 + 0.005487990943872728i, -0.0005403209430663006 + -0.0014789973014082752i, 0.009955834435467608 + -0.004667197932576224i, -0.00021624822664952282 + -0.000588512071999473i, 0.10633165821942295 + -9.553674301689663e-20i, 0.0005222159933924002 + -0.006040696988580291i }, { -0.00013626372855499757 + 0.0001674668155183934i, 0.00016875458006405058 + 0.0006215239220028314i, -0.0018805449119758083 + 0.0009070207950964788i, -0.0010735791379496503 + 0.006134800986536904i, 0.0003140384061093274 + 0.0005426689911046049i, 0.011512799705955274 + -0.00539708804260312i, 0.0005222159933924002 + 0.006040696988580291i, 0.12296057065002926 + 1.1121019683361498e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12596273291346705, 1.0e-7), DoubleNear(0.14563852508013803, 1.0e-7), DoubleNear(0.11533037310466626, 1.0e-7), DoubleNear(0.13334535578427298, 1.0e-7), DoubleNear(0.11613442239004877, 1.0e-7), DoubleNear(0.13429636185795418, 1.0e-7), DoubleNear(0.10633165821942295, 1.0e-7), DoubleNear(0.12296057065002926, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false, false}), Matrix({ { 0.12158870771969968 + 1.0999037476203443e-19i, 0.0011288300147420396 + -0.00646681022608543i, 0.007832082818588236 + 0.00026248517666255895i, 8.667360798421963e-05 + -0.00041411980652866835i, 0.006160325446983355 + -0.011478318864193367i, -0.0005532927424410918 + -0.00043420748060713003i, 0.009826334661643604 + -0.0034012418228593915i, -8.967053030638229e-05 + -0.0005542000288977216i }, { 0.00112883001474204 + 0.0064668102260854315i, 0.1405919912846187 + -9.200637756502318e-20i, 5.8752564057173144e-05 + 0.0004189936332416661i, 0.00905617092263055 + 0.0003035093830815093i, 0.0006676777111696856 + 0.00022107797054520274i, 0.007123132055563208 + -0.013272282730703688i, 0.00027212598540562604 + 0.0004910457454277354i, 0.0113621074112766 + -0.003932827066627771i }, { 0.007832082818588236 + -0.00026248517666255884i, 5.8752564057173184e-05 + -0.00041899363324166596i, 0.11331375062297037 + -9.276597045484178e-20i, 0.0010520052822757264 + -0.006026698819548315i, -0.015568941796935682 + -0.0021278892037388812i, -0.000257715910042453 + 0.0008082935386326458i, 0.012564093120371999 + -0.02128431150344393i, -0.0010153811170358082 + -0.0008658367829947857i }, { 8.667360798421967e-05 + 0.0004141198065286685i, 0.00905617092263055 + -0.0003035093830815096i, 0.0010520052822757266 + 0.006026698819548316i, 0.13102372859112954 + 3.036609740032755e-20i, -3.1368317066335144e-05 + -0.0008478042011978476i, -0.018002235326585996 + -0.0024604602351425485i, 0.0012486712915639488 + 0.0004706295286567409i, 0.014527754292369091 + -0.02461086883405104i }, { 0.006160325446983354 + 0.011478318864193367i, 0.0006676777111696855 + -0.0002210779705452027i, -0.015568941796935683 + 0.0021278892037388817i, -3.136831706633517e-05 + 0.0008478042011978475i, 0.12050844758381613 + -1.0857386260207688e-20i, 0.0011188008756222634 + -0.00640935557075947i, 0.012922135835071014 + 0.009466889796420127i, 0.0006234746297713393 + -0.000599385355592856i }, { -0.000553292742441092 + 0.00043420748060713003i, 0.007123132055563208 + 0.013272282730703688i, -0.0002577159100424532 + -0.000808293538632646i, -0.018002235326586 + 0.0024604602351425485i, 0.0011188008756222638 + 0.006409355570759472i, 0.13934289565347352 + -1.662149950008183e-20i, -0.00038353631545305183 + 0.000775166635760583i, 0.014941756046056034 + 0.010946484362832833i }, { 0.009826334661643604 + 0.003401241822859391i, 0.000272125985405626 + -0.0004910457454277354i, 0.012564093120371999 + 0.021284311503443926i, 0.0012486712915639486 + -0.00047062952865674075i, 0.012922135835071014 + -0.009466889796420127i, -0.00038353631545305167 + -0.0007751666357605829i, 0.10834828070111885 + -3.725171921634281e-21i, 0.0010059058410512459 + -0.005762605613278086i }, { -8.967053030638236e-05 + 0.0005542000288977217i, 0.011362107411276601 + 0.003932827066627772i, -0.0010153811170358087 + 0.0008658367829947858i, 0.014527754292369091 + 0.024610868834051038i, 0.0006234746297713394 + 0.000599385355592856i, 0.014941756046056034 + -0.010946484362832833i, 0.001005905841051246 + 0.005762605613278087i, 0.12528219784317274 + 1.7527490578602515e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12158870771969968, 1.0e-7), DoubleNear(0.1405919912846187, 1.0e-7), DoubleNear(0.11331375062297037, 1.0e-7), DoubleNear(0.13102372859112954, 1.0e-7), DoubleNear(0.12050844758381613, 1.0e-7), DoubleNear(0.13934289565347352, 1.0e-7), DoubleNear(0.10834828070111885, 1.0e-7), DoubleNear(0.12528219784317274, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false, false}), Matrix({ { 0.09326042267009602 + 1.1000333016853243e-19i, 0.0008658301109690694 + -0.004960143637699943i, 0.007994919235631942 + 0.003747940041542356i, 0.0002735625898969225 + -0.0003904214391915446i, -0.0035385183551271382 + -0.02638121162919258i, -0.0014359612676340798 + -5.672382705198931e-05i, 0.0007568594364632251 + -0.0024037829180491715i, -0.00012082077836352635 + -6.257101331964496e-05i }, { 0.0008658301109690694 + 0.004960143637699944i, 0.10783623559402014 + -3.045755672069568e-20i, -0.00012511287005246012 + 0.00046001321776525635i, 0.009244457290297228 + 0.004333711275808087i, 0.001370258032491694 + -0.00043312270673873717i, -0.00409155875635559 + -0.030504371211835798i, 0.00013487415001034111 + 1.7937554214651552e-05i, 0.0008751501458525578 + -0.00277947379655989i }, { 0.007994919235631944 + -0.0037479400415423554i, -0.00012511287005246004 + -0.00046001321776525624i, 0.08538842476393366 + -2.01920808210826e-20i, 0.0007927464531268632 + -0.004541463996193679i, -0.001363551271071732 + -0.0021193717122834034i, -0.0001253800007352655 + 5.2845506978742976e-05i, -0.0032398363602897965 + -0.02415440590859595i, -0.0013147535380473008 + -5.19358383747092e-05i }, { 0.0002735625898969226 + 0.00039042143919154474i, 0.009244457290297227 + -0.004333711275808087i, 0.0007927464531268633 + 0.00454146399619368i, 0.09873391119423215 + 5.98969186927854e-20i, 0.00010006157059002849 + -9.219801669923443e-05i, -0.0015766627675703796 + -0.0024506115320274877i, 0.0012545962324070638 + -0.0003965633502299233i, -0.003746195299480553 + -0.02792953464737137i }, { -0.0035385183551271374 + 0.02638121162919258i, 0.0013702580324916936 + 0.00043312270673873706i, -0.001363551271071732 + 0.0021193717122834034i, 0.00010006157059002844 + 9.219801669923435e-05i, 0.1488367326334198 + -1.08703416667057e-20i, 0.0013818007793952338 + -0.007916022159144958i, 0.012759299418027305 + 0.005981434931540331i, 0.0004365856478586364 + -0.0006230837229299797i }, { -0.0014359612676340802 + 5.672382705198963e-05i, -0.0040915587563555905 + 0.0305043712118358i, -0.00012538000073526555 + -5.2845506978742976e-05i, -0.00157666276757038 + 0.0024506115320274877i, 0.001381800779395234 + 0.00791602215914496i, 0.17209865134407204 + -7.817032034440937e-20i, -0.0001996708813434186 + 0.0007341470512369927i, 0.014753469678389357 + 0.0069162824701062536i }, { 0.0007568594364632252 + 0.0024037829180491715i, 0.00013487415001034106 + -1.79375542146515e-05i, -0.003239836360289796 + 0.024154405908595952i, 0.0012545962324070634 + 0.00039656335022992325i, 0.012759299418027305 + -0.005981434931540331i, -0.00019967088134341843 + -0.0007341470512369926i, 0.13627360656015555 + -7.629906155539345e-20i, 0.001265164670200109 + -0.007247840436632722i }, { -0.00012082077836352637 + 6.257101331964504e-05i, 0.0008751501458525578 + 0.002779473796559889i, -0.001314753538047301 + 5.193583837470949e-05i, -0.0037461952994805535 + 0.027929534647371374i, 0.00043658564785863655 + 0.0006230837229299798i, 0.01475346967838936 + -0.006916282470106255i, 0.0012651646702001096 + 0.007247840436632722i, 0.15757201524007008 + -1.2003330713855318e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.09326042267009602, 1.0e-7), DoubleNear(0.10783623559402014, 1.0e-7), DoubleNear(0.08538842476393366, 1.0e-7), DoubleNear(0.09873391119423215, 1.0e-7), DoubleNear(0.1488367326334198, 1.0e-7), DoubleNear(0.17209865134407204, 1.0e-7), DoubleNear(0.13627360656015555, 1.0e-7), DoubleNear(0.15757201524007008, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false, false}), Matrix({ { 0.12150849522124507 + 5.12672752307068e-20i, 0.0012008992126644473 + -0.006434598293943358i, 0.010416536596381094 + 0.004883170605372871i, 0.00036154222602840765 + -0.00050335602268145i, 0.0032148380620028345 + -0.0010169832432338193i, 0.00028513998592802315 + -0.00020791901862195428i, 0.0003164682513250661 + 4.201483645286763e-05i, 3.2799971156639816e-05 + -6.365060051569526e-06i }, { 0.0012008992126644473 + 0.006434598293943359i, 0.14044121658066236 + -2.316181008576341e-19i, -0.0001556436907118862 + 0.0005998792447758529i, 0.012039578545426439 + 0.00564403681685614i, -5.872570988089314e-05 + -9.024379744987558e-05i, 0.0041683584428361484 + -0.0013323290566149108i, -1.4076599894261665e-06 + -1.0096376197971098e-05i, 0.00041088360333717397 + 5.3301220069194e-05i }, { 0.010416536596381096 + -0.004883170605372871i, -0.00015564369071188603 + -0.0005998792447758527i, 0.11125211215351868 + -7.445993399661229e-20i, 0.0010995327828655205 + -0.005891461743124788i, 0.00023472742043955823 + -0.00021638031027036014i, 1.6088315923250308e-05 + -2.9283411483127788e-05i, 0.0029434775237575784 + -0.0009311409348662231i, 0.00026107166940185 + -0.0001903688292449102i }, { 0.00036154222602840776 + 0.0005033560226814502i, 0.01203957854542644 + -0.00564403681685614i, 0.0010995327828655205 + 0.005891461743124788i, 0.12858674572143514 + -2.6270441241948722e-20i, -8.661076439396415e-06 + -5.376250913761476e-06i, 0.0003037966037969383 + -0.00028173387988250707i, -5.3768744729066546e-05 + -8.262642917906512e-05i, 0.003816512418609819 + -0.0012198687948692345i }, { 0.0032148380620028345 + 0.0010169832432338202i, -5.872570988089317e-05 + 9.024379744987555e-05i, 0.0002347274204395583 + 0.0002163803102703597i, -8.661076439396409e-06 + 5.3762509137614655e-06i, 0.12058866008227072 + 4.7865713271119946e-20i, 0.0010467316776998556 + -0.006441567502901544i, 0.010337682057278152 + 0.0048462043677098155i, 0.00034860601172715126 + -0.0005101491394400742i }, { 0.00028513998592802304 + 0.00020791901862195433i, 0.004168358442836148 + 0.0013323290566149108i, 1.6088315923250308e-05 + 2.928341148312778e-05i, 0.00030379660379693807 + 0.00028173387988250707i, 0.001046731677699856 + 0.006441567502901545i, 0.13949367035742985 + 1.229902237925291e-19i, -0.0001691400606839925 + 0.0005942810242263963i, 0.011958348423260146 + 0.005605956929058202i }, { 0.0003164682513250658 + -4.201483645286779e-05i, -1.4076599894261665e-06 + 1.0096376197971093e-05i, 0.002943477523757578 + 0.0009311409348662231i, -5.376874472906644e-05 + 8.262642917906512e-05i, 0.010337682057278152 + -0.004846204367709816i, -0.00016914006068399244 + -0.0005942810242263962i, 0.11040991917057051 + -2.2031208379863774e-20i, 0.000958378340461452 + -0.005897842689701614i }, { 3.279997115663981e-05 + 6.365060051569522e-06i, 0.0004108836033371741 + -5.330122006919362e-05i, 0.0002610716694018499 + 0.00019036882924491032i, 0.003816512418609819 + 0.0012198687948692319i, 0.00034860601172715137 + 0.0005101491394400744i, 0.011958348423260146 + -0.005605956929058202i, 0.000958378340461452 + 0.005897842689701615i, 0.1277191807128671 + 7.41640292208788e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.12150849522124507, 1.0e-7), DoubleNear(0.14044121658066236, 1.0e-7), DoubleNear(0.11125211215351868, 1.0e-7), DoubleNear(0.12858674572143514, 1.0e-7), DoubleNear(0.12058866008227072, 1.0e-7), DoubleNear(0.13949367035742985, 1.0e-7), DoubleNear(0.11040991917057051, 1.0e-7), DoubleNear(0.1277191807128671, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false, false}), Matrix({ { 0.12617044294823931 + -3.9960008911660283e-20i, 0.0019537883153359645 + -0.005858963289672427i, 0.010816190538438642 + 0.005070524469502223i, 0.0004029514538322192 + -0.00042375163777152937i, 0.0003368847141449677 + 7.779635096358061e-05i, 1.3253219986958683e-05 + 3.348590284354986e-05i, 2.5753582856276483e-05 + 2.0207920984605153e-05i, -2.0957156451969246e-07 + 3.4032588910479155e-06i }, { 0.0019537883153359645 + 0.005858963289672428i, 0.14632339275185335 + -1.8492925141540477e-19i, -6.796734508785461e-05 + 0.0005807889157527555i, 0.012543838788646526 + 0.005880429093153231i, 3.7061103186331194e-05 + -1.3473787750970965e-05i, 0.00046023565892773917 + 0.00012312929702997205i, 3.7186135924778333e-06 + 3.343427668028579e-07i, 3.450623112918189e-05 + 2.9051384953720793e-05i }, { 0.010816190538438644 + -0.005070524469502223i, -6.796734508785447e-05 + -0.0005807889157527553i, 0.11552055059013197 + -1.5014631900082394e-20i, 0.001788871439698204 + -0.005364415383625113i, 3.200652597007135e-05 + -6.869453819794798e-06i, 2.4818843071419333e-06 + 2.3380208737550944e-06i, 0.00030844868856798265 + 7.122965638555205e-05i, 1.213453194115915e-05 + 3.065939885050176e-05i }, { 0.00040295145383221933 + 0.00042375163777152953i, 0.012543838788646528 + -0.005880429093153232i, 0.001788871439698204 + 0.005364415383625114i, 0.13397241461571732 + 4.500442347690091e-20i, 2.6356472670571458e-06 + -2.6444726543355444e-06i, 4.440284556461207e-05 + -7.940419399188388e-06i, 3.39328209168534e-05 + -1.2336481850707994e-05i, 0.00042138773137505693 + 0.00011273610406926742i }, { 0.00033688471414496763 + -7.779635096358067e-05i, 3.70611031863312e-05 + 1.3473787750970958e-05i, 3.200652597007134e-05 + 6.869453819794791e-06i, 2.6356472670571437e-06 + 2.6444726543355415e-06i, 0.11592671235527648 + 1.3909299741348703e-19i, 0.0002938425750283387 + -0.0070172025071724735i, 0.009938028115220605 + 0.004658850503580463i, 0.00030719678392333963 + -0.0005897535243499949i }, { 1.325321998695867e-05 + -3.348590284354986e-05i, 0.00046023565892773917 + -0.00012312929702997205i, 2.481884307141934e-06 + -2.3380208737550927e-06i, 4.440284556461205e-05 + 7.940419399188401e-06i, 0.00029384257502833896 + 0.007017202507172474i, 0.13361149418623885 + 7.630137435029973e-20i, -0.0002568164063080241 + 0.0006133713532494936i, 0.011454088180040059 + 0.00536956465276111i }, { 2.5753582856276483e-05 + -2.020792098460515e-05i, 3.7186135924778312e-06 + -3.343427668028579e-07i, 0.0003084486885679826 + -7.122965638555205e-05i, 3.3932820916853415e-05 + 1.2336481850707973e-05i, 0.009938028115220605 + -0.004658850503580464i, -0.000256816406308024 + -0.0006133713532494936i, 0.10614148073395724 + -8.147651047639368e-20i, 0.00026903968362876823 + -0.0064248890492012885i }, { -2.095715645196931e-07 + -3.4032588910479194e-06i, 3.450623112918192e-05 + -2.9051384953720793e-05i, 1.2134531941159147e-05 + -3.065939885050176e-05i, 0.0004213877313750569 + -0.00011273610406926763i, 0.0003071967839233398 + 0.000589753524349995i, 0.011454088180040059 + -0.00536956465276111i, 0.0002690396836287684 + 0.0064248890492012885i, 0.12233351181858493 + 2.8891645020291654e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.12617044294823931, 1.0e-7), DoubleNear(0.14632339275185335, 1.0e-7), DoubleNear(0.11552055059013197, 1.0e-7), DoubleNear(0.13397241461571732, 1.0e-7), DoubleNear(0.11592671235527648, 1.0e-7), DoubleNear(0.13361149418623885, 1.0e-7), DoubleNear(0.10614148073395724, 1.0e-7), DoubleNear(0.12233351181858493, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true, false}), Matrix({ { 0.24209715530351578 + 9.913298850182676e-20i, 0.002247630890364303 + -0.012876165796844901i, 0.02075421865365925 + 0.009729374973082686i, 0.0007101482377555588 + -0.0010135051621215242i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0022476308903643036 + 0.012876165796844901i, 0.2799348869380922 + -1.0862787706510504e-19i, -0.0003247837513958787 + 0.0011941602690022492i, 0.023997926968686585 + 0.01124999374591434i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02075421865365925 + -0.009729374973082686i, -0.0003247837513958785 + -0.001194160269002249i, 0.2216620313240892 + -9.649114237647606e-20i, 0.0020579111233269723 + -0.011789304432826402i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0007101482377555591 + 0.0010135051621215246i, 0.023997926968686585 + -0.011249993745914344i, 0.0020579111233269727 + 0.011789304432826402i, 0.2563059264343023 + 4.789358797893007e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24209715530351578, 1.0e-7), DoubleNear(0.2799348869380922, 1.0e-7), DoubleNear(0.2216620313240892, 1.0e-7), DoubleNear(0.2563059264343023, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, true}), Matrix({ { 0.07411636052051757 + 5.33093520945167e-20i, 0.0006743758024710246 + -0.003905939426226739i, 0.0063537597132349325 + 0.0029785804886482492i, 0.0002147835735365735 + -0.00030774201271154705i, -0.020355906204869975 + -0.007134240438385277i, -0.00047963002631448313 + 0.000909248162226357i, -0.001458336953416251 + -0.0014296567422949803i, -7.765792509749754e-05 + 5.867163030938037e-05i }, { 0.0006743758024710246 + 0.0039059394262267394i, 0.08552385854740019 + -4.080252930280576e-20i, -9.915939082634151e-05 + 0.00036194550012376675i, 0.007331688214890775 + 0.0034370238176047473i, 0.00031211959426332006 + -0.0014739971273620086i, -0.023191648010420403 + -0.009599781899390038i, 8.599386077330631e-05 + -0.00011381765338199461i, -0.0016023511532039687 + -0.0017549822581427834i }, { 0.006353759713234933 + -0.0029785804886482492i, -9.915939082634147e-05 + -0.00036194550012376664i, 0.06786028942277236 + 5.961585796623257e-21i, 0.0006174525680160654 + -0.003576243869370625i, -0.002031757159747541 + 0.00020646528595261326i, -4.576386383869629e-06 + 9.722227224908227e-05i, -0.01863768912591012 + -0.006532047952171769i, -0.00043914504399528045 + 0.0008324996399239491i }, { 0.00021478357353657356 + 0.00030774201271154716i, 0.007331688214890774 + -0.0034370238176047478i, 0.0006174525680160655 + 0.0035762438693706256i, 0.07830489453097467 + 5.997609142113873e-21i, -3.247982177263177e-05 + -0.00013890451212865884i, -0.002373941200529248 + 0.00010906475599287016i, 0.00028577396208444143 + -0.0013495788375014841i, -0.021234069443311646 + -0.008789476082109574i }, { -0.020355906204869975 + 0.007134240438385278i, 0.00031211959426332 + 0.0014739971273620084i, -0.002031757159747541 + -0.00020646528595261312i, -3.2479821772631766e-05 + 0.00013890451212865884i, 0.1679807947829982 + 4.582363640731005e-20i, 0.0015732550878932786 + -0.008970226370618162i, 0.014400458940424316 + 0.006750794484434438i, 0.0004953646642189854 + -0.0007057631494099771i }, { -0.00047963002631448313 + -0.0009092481622263572i, -0.0231916480104204 + 0.009599781899390038i, -4.576386383869622e-06 + -9.722227224908233e-05i, -0.002373941200529248 + -0.0001090647559928701i, 0.0015732550878932788 + 0.008970226370618162i, 0.19441102839069202 + -6.782534776229928e-20i, -0.0002256243605695372 + 0.0008322147688784824i, 0.01666623875379581 + 0.007812969928309594i }, { -0.0014583369534162515 + 0.0014296567422949803i, 8.599386077330629e-05 + 0.00011381765338199458i, -0.01863768912591012 + 0.006532047952171769i, 0.00028577396208444143 + 0.0013495788375014837i, 0.014400458940424316 + -0.006750794484434438i, -0.00022562436056953702 + -0.0008322147688784822i, 0.15380174190131685 + -1.0245272817309932e-19i, 0.001440458555310907 + -0.008213060563455776i }, { -7.765792509749757e-05 + -5.867163030938041e-05i, -0.0016023511532039687 + 0.0017549822581427832i, -0.0004391450439952805 + -0.0008324996399239493i, -0.021234069443311646 + 0.008789476082109574i, 0.0004953646642189856 + 0.0007057631494099773i, 0.01666623875379581 + -0.007812969928309595i, 0.001440458555310907 + 0.008213060563455776i, 0.17800103190332758 + 4.18959788368162e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.07411636052051757, 1.0e-7), DoubleNear(0.08552385854740019, 1.0e-7), DoubleNear(0.06786028942277236, 1.0e-7), DoubleNear(0.07830489453097467, 1.0e-7), DoubleNear(0.1679807947829982, 1.0e-7), DoubleNear(0.19441102839069202, 1.0e-7), DoubleNear(0.15380174190131685, 1.0e-7), DoubleNear(0.17800103190332758, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false, false}), Matrix({ { 0.12221934447696858 + -6.728923189168224e-20i, 0.001627426037430226 + -0.006091986131472547i, -0.0005321484168797005 + -0.005815802356305105i, -0.001992874558661101 + -0.0009611994136450538i, 0.009742282729438966 + -0.017046340149546604i, -0.000719945141107242 + -0.000712583670380452i, -0.0008535677063710293 + -0.00038936559620032345i, -0.0002929166385609846 + 0.00020133425899572413i }, { 0.0016274260374302264 + 0.006091986131472549i, 0.14131040708774578 + -2.984612950670419e-20i, -0.0005725956631459888 + 0.0015673415059299005i, -0.0011377067025117123 + -0.006501247979062197i, 0.000979394161157968 + 0.00025861858128619464i, 0.011264059256350883 + -0.019709034410199625i, 0.00017295991637844522 + 0.00020479691356233896i, -0.0009974390333083968 + -0.00035954423297585904i }, { -0.0005321484168797005 + 0.005815802356305105i, -0.0005725956631459889 + -0.0015673415059299003i, 0.11268311386570146 + 8.451363619887491e-20i, 0.00055340925958754 + -0.006401522914161197i, 0.0007687310489097824 + 0.0005378066300316495i, -0.00026424479217108254 + -4.50732546945553e-05i, 0.008982135837916388 + -0.015716290218090692i, -0.000848728718369658 + -0.0005874605932214636i }, { -0.001992874558661101 + 0.0009611994136450536i, -0.0011377067025117118 + 0.006501247979062197i, 0.0005534092595875401 + 0.006401522914161199i, 0.13030531278800245 + -3.179415065799142e-20i, -2.479325389292231e-05 + 0.0003545714815839324i, 0.0008160625023430304 + 0.0006769037397614365i, 0.0009369548415756664 + 0.00043308891791574904i, 0.010386827091581414 + -0.0181741171545551i }, { 0.009742282729438966 + 0.017046340149546604i, 0.000979394161157968 + -0.0002586185812861945i, 0.0007687310489097821 + -0.0005378066300316496i, -2.4793253892922302e-05 + -0.00035457148158393243i, 0.1190737615411647 + 6.759375455792067e-20i, 0.0015855406583641638 + -0.0059351955047324i, -0.000518452410027305 + -0.005666119924867677i, -0.0019415835602373333 + -0.0009364608382059069i }, { -0.0007199451411072423 + 0.000712583670380452i, 0.011264059256350885 + 0.019709034410199625i, -0.0002642447921710826 + 4.507325469455532e-05i, 0.0008160625023430306 + -0.0006769037397614365i, 0.0015855406583641638 + 0.005935195504732401i, 0.13767347377666522 + -4.9599455657816686e-20i, -0.0005578586576840854 + 0.00152700253408605i, -0.0011084253247994876 + -0.006333924100899675i }, { -0.0008535677063710297 + 0.00038936559620032345i, 0.00017295991637844522 + -0.00020479691356233896i, 0.008982135837916388 + 0.015716290218090692i, 0.0009369548415756662 + -0.00043308891791574893i, -0.000518452410027305 + 0.005666119924867675i, -0.0005578586576840856 + -0.00152700253408605i, 0.10978296674377026 + -8.217631273976265e-20i, 0.0005391660583093456 + -0.006236765679305157i }, { -0.00029291663856098463 + -0.00020133425899572413i, -0.0009974390333083965 + 0.00035954423297585904i, -0.0008487287183696581 + 0.0005874605932214637i, 0.010386827091581414 + 0.0181741171545551i, -0.0019415835602373335 + 0.0009364608382059066i, -0.0011084253247994882 + 0.006333924100899675i, 0.0005391660583093457 + 0.006236765679305159i, 0.12695161971998103 + 5.050544673633737e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12221934447696858, 1.0e-7), DoubleNear(0.14131040708774578, 1.0e-7), DoubleNear(0.11268311386570146, 1.0e-7), DoubleNear(0.13030531278800245, 1.0e-7), DoubleNear(0.1190737615411647, 1.0e-7), DoubleNear(0.13767347377666522, 1.0e-7), DoubleNear(0.10978296674377026, 1.0e-7), DoubleNear(0.12695161971998103, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false, false}), Matrix({ { 0.09295068761307582 + 8.064674195282856e-20i, 0.001237695799023604 + -0.004633098813227572i, -0.00040471139387021474 + -0.0044230545528917906i, -0.0015156279993717471 + -0.0007310147735936298i, -0.003526766283314539 + -0.026293594761776756i, -0.0013575573214104969 + -0.00017432485452474554i, -0.0012358239026995029 + 0.00028230449635324153i, -0.0001492806653918628 + 0.00045647243469373996i }, { 0.0012376957990236043 + 0.0046330988132275725i, 0.1074698899908174 + 9.785975733947538e-20i, -0.00043547247648439443 + 0.0011920000988726578i, -0.0008652527204512763 + -0.004944352079312831i, 0.0012636351800022084 + -0.0005259060445375241i, -0.004077658748140544 + -0.03040074053323911i, 0.00035371203858105795 + 7.795779949837594e-05i, -0.0013658128742460968 + 0.0004323602077213026i }, { -0.0004047113938702142 + 0.0044230545528917906i, -0.0004354724764843945 + -0.0011920000988726578i, 0.08569815982095386 + 9.164507394621276e-21i, 0.0004208807650723284 + -0.00486850882066605i, 0.0012665352946219857 + -5.3337553576149826e-05i, -0.0003206663519526871 + 0.0001684123376274796i, -0.0032515884321023952 + -0.024242022776011774i, -0.001393157484270884 + 6.5665189098047e-05i }, { -0.0015156279993717471 + 0.0007310147735936296i, -0.0008652527204512761 + 0.004944352079312831i, 0.0004208807650723285 + 0.004868508820666051i, 0.09910025679743492 + -6.842039536738567e-20i, 0.00026429360103538143 + 0.00040099961738986577i, 0.001431472294297648 + 5.715966528435575e-05i, 0.0013612190848965493 + -0.0003037800124311363i, -0.0037600953076956 + -0.028033165325968064i }, { -0.0035267662833145387 + 0.026293594761776756i, 0.001263635180002208 + 0.0005259060445375241i, 0.0012665352946219857 + 5.333755357614988e-05i, 0.0002642936010353815 + -0.00040099961738986577i, 0.14834241840505746 + -8.034221928659012e-20i, 0.001975270896770786 + -0.007394082822977375i, -0.0006458894330367909 + -0.007058867728280991i, -0.002418830119526687 + -0.0011666454782573309i }, { -0.001357557321410497 + 0.00017432485452474578i, -0.004077658748140544 + 0.030400740533239115i, -0.00032066635195268715 + -0.00016841233762747958i, 0.0014314722942976484 + -5.715966528435583e-05i, 0.001975270896770786 + 0.007394082822977377i, 0.1715139908735936 + -1.7730534250399627e-19i, -0.0006949818443456801 + 0.0019023439411432926i, -0.0013808793068599242 + -0.007890820000649043i }, { -0.0012358239026995029 + -0.00028230449635324153i, 0.00035371203858105795 + -7.795779949837595e-05i, -0.0032515884321023952 + 0.024242022776011778i, 0.0013612190848965489 + 0.00030378001243113617i, -0.0006458894330367909 + 0.007058867728280991i, -0.0006949818443456802 + -0.0019023439411432928i, 0.13676792078851785 + -6.827183935509028e-21i, 0.0006716945528245571 + -0.007769779772800306i }, { -0.00014928066539186282 + -0.00045647243469374007i, -0.0013658128742460962 + -0.00043236020772130247i, -0.001393157484270884 + -6.566518909804664e-05i, -0.0037600953076955997 + 0.02803316532596807i, -0.002418830119526687 + 0.0011666454782573307i, -0.0013808793068599242 + 0.007890820000649045i, 0.0006716945528245573 + 0.007769779772800306i, 0.15815667571054853 + 8.713169144573159e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.09295068761307582, 1.0e-7), DoubleNear(0.1074698899908174, 1.0e-7), DoubleNear(0.08569815982095386, 1.0e-7), DoubleNear(0.09910025679743492, 1.0e-7), DoubleNear(0.14834241840505746, 1.0e-7), DoubleNear(0.1715139908735936, 1.0e-7), DoubleNear(0.13676792078851785, 1.0e-7), DoubleNear(0.15815667571054853, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false, false}), Matrix({ { 0.12143028629849825 + -9.519502091347125e-20i, 0.001566784880265072 + -0.0060725354636165345i, 0.00011861070791124146 + -0.004349459664730981i, -0.0018604241168612011 + -0.0011790596689806457i, 0.0032040980699156243 + -0.0018484636228468512i, 5.399730511265196e-05 + -7.366706126849833e-05i, 0.003292575255203991 + -0.0016604973546151245i, -0.00019341912231926622 + -0.000405946106866261i }, { 0.001566784880265072 + 0.006072535463616536i, 0.140242369348413 + -1.5627751086751377e-19i, -0.0007956448208908365 + 0.001447389336263834i, -0.00053430901433936 + -0.00514390346686964i, 0.0001919805739834405 + -1.0383942786541231e-05i, 0.004174747291782163 + -0.0022125906883732572i, 9.222486331520661e-05 + 0.0003905107123208572i, 0.003697726501904917 + -0.0019203846688060373i }, { 0.00011861070791124146 + 0.00434945966473098i, -0.0007956448208908369 + -0.001447389336263834i, 0.1113303210762655 + 7.200236214756577e-20i, 0.0007336471152648956 + -0.00625352457345161i, -0.0033315613672847927 + -0.0013588425626803928i, -0.00011268240553953155 + 0.00024455682719863483i, 0.002954217515844789 + -9.966055525319293e-05i, 0.0004922143502172213 + -0.00032462078659836627i }, { -0.0018604241168612011 + 0.0011790596689806457i, -0.0005343090143393593 + 0.00514390346686964i, 0.000733647115264896 + 0.006253524573451611i, 0.12878559295368452 + -1.0161103123206907e-19i, 8.576358408516538e-05 + -0.0002779839059950744i, -0.0038594469637734836 + -0.0015602785362106991i, -0.0003044750285934001 + -0.0001624862838423995i, 0.0038101235696638043 + -0.00033960716311088636i }, { 0.003204098069915624 + 0.0018484636228468508i, 0.00019198057398344052 + 1.0383942786541177e-05i, -0.0033315613672847927 + 0.0013588425626803926i, 8.576358408516536e-05 + 0.0002779839059950743i, 0.11986281971963503 + 9.549954357970969e-20i, 0.0016461818155293177 + -0.0059546461725884115i, -0.0011692115348182468 + -0.007132462616441802i, -0.002074034002037233 + -0.0007186005828703147i }, { 5.399730511265193e-05 + 7.366706126849836e-05i, 0.004174747291782163 + 0.0022125906883732564i, -0.00011268240553953162 + -0.00024455682719863483i, -0.0038594469637734836 + 0.0015602785362106991i, 0.0016461818155293182 + 0.005954646172588413i, 0.138741511515998 + 7.683192570299288e-20i, -0.00033480949993923756 + 0.0016469547037521169i, -0.0017118230129718403 + -0.007691268613092233i }, { 0.003292575255203991 + 0.0016604973546151245i, 9.22248633152066e-05 + -0.0003905107123208572i, 0.002954217515844789 + 9.96605552531938e-05i, -0.0003044750285934 + 0.00016248628384239944i, -0.0011692115348182468 + 0.007132462616441801i, -0.0003348094999392376 + -0.0016469547037521166i, 0.11113575953320623 + -6.966503868845352e-20i, 0.00035892820263198986 + -0.006384764020014746i }, { -0.00019341912231926622 + 0.000405946106866261i, 0.003697726501904917 + 0.001920384668806037i, 0.000492214350217221 + 0.00032462078659836627i, 0.0038101235696638043 + 0.00033960716311088636i, -0.002074034002037233 + 0.0007186005828703145i, -0.0017118230129718407 + 0.0076912686130922335i, 0.0003589282026319901 + 0.006384764020014746i, 0.1284713395542989 + 1.20322327310415e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.12143028629849825, 1.0e-7), DoubleNear(0.140242369348413, 1.0e-7), DoubleNear(0.1113303210762655, 1.0e-7), DoubleNear(0.12878559295368452, 1.0e-7), DoubleNear(0.11986281971963503, 1.0e-7), DoubleNear(0.138741511515998, 1.0e-7), DoubleNear(0.11113575953320623, 1.0e-7), DoubleNear(0.1284713395542989, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false, false}), Matrix({ { 0.12970440933717814 + -4.2889596012780645e-20i, 0.0016465692868908493 + -0.00645497880670909i, 0.00689959133703664 + 0.010490636888236742i, -0.00038926552009408777 + -0.002173476169776858i, 0.00036738519720845315 + 5.191826073534686e-05i, -1.7644135914212884e-05 + 8.504502882170602e-05i, -0.00039908063514140036 + 0.00028134565961357606i, 2.9795317809671085e-05 + 4.4582843035852045e-05i }, { 0.0016465692868908497 + 0.006454978806709091i, 0.15006203317249195 + -1.569346536340227e-19i, -0.002437575866822671 + 0.0016022052015674834i, 0.007212929393556463 + 0.011685218130394942i, 9.908901602131413e-05 + -2.689745582314912e-05i, 0.0005126354358688719 + 0.0001299564326968511i, -2.695383152599621e-05 + -4.4109776767843874e-05i, -0.0004933880324512087 + 0.00036856698934522756i }, { 0.00689959133703664 + -0.010490636888236742i, -0.0024375758668226714 + -0.0016022052015674834i, 0.11198658420119317 + -1.2085044798962048e-20i, 0.002096090468143319 + -0.004768399866588451i, -0.00012059698403849446 + 0.0002478505588971494i, -3.42705883346628e-05 + -3.90744959096577e-05i, 0.00027794820550449713 + 9.710774661378569e-05i, 4.303188784233073e-05 + -2.089972712765441e-05i }, { -0.0003892655200940876 + 0.002173476169776858i, 0.0072129293935564625 + -0.011685218130394942i, 0.0020960904681433194 + 0.004768399866588451i, 0.13023377419507876 + 1.7009825695518883e-20i, -2.768501885796356e-05 + 6.908159037158942e-05i, -0.0001916003642062841 + 0.0003426161805739501i, -2.8095091918129532e-05 + 1.0871862214701544e-06i, 0.00036898795443392413 + 0.00010590896840238822i }, { 0.0003673851972084531 + -5.1918260735346806e-05i, 9.908901602131413e-05 + 2.689745582314912e-05i, -0.00012059698403849446 + -0.00024785055889714946i, -2.768501885796356e-05 + -6.908159037158942e-05i, 0.11158869668095515 + 4.3194118679019085e-20i, 0.0015663974089035403 + -0.005572202829495857i, -0.007950192163943645 + -0.021972559169409524i, -0.0035451925988043463 + 0.00027581591792589757i }, { -1.764413591421291e-05 + -8.504502882170607e-05i, 0.000512635435868872 + -0.00012995643269685152i, -3.4270588334662816e-05 + 3.9074495909657725e-05i, -0.00019160036420628405 + -0.00034261618057395i, 0.0015663974089035406 + 0.005572202829495858i, 0.12892184769191908 + 7.748906846950184e-20i, 0.0013071215459925971 + 0.001492138838448467i, -0.009459061420867661 + -0.02452039021035682i }, { -0.0003990806351414006 + -0.00028134565961357585i, -2.6953831525996236e-05 + 4.4109776767843834e-05i, 0.0002779482055044972 + -9.710774661378586e-05i, -2.8095091918129515e-05 + -1.087186221470151e-06i, -0.007950192163943645 + 0.021972559169409524i, 0.001307121545992597 + -0.001492138838448467i, 0.11047949640827856 + 1.4422368258074298e-20i, -0.0010035151502464335 + -0.007869888726877905i }, { 2.9795317809671112e-05 + -4.4582843035852025e-05i, -0.000493388032451209 + -0.00036856698934522735i, 4.3031887842330717e-05 + 2.0899727127654445e-05i, 0.0003689879544339241 + -0.00010590896840238827i, -0.0035451925988043463 + -0.0002758159179258976i, -0.009459061420867661 + 0.02452039021035682i, -0.001003515150246433 + 0.007869888726877905i, 0.1270231583129047 + 1.701470382827049e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.12970440933717814, 1.0e-7), DoubleNear(0.15006203317249195, 1.0e-7), DoubleNear(0.11198658420119317, 1.0e-7), DoubleNear(0.13023377419507876, 1.0e-7), DoubleNear(0.11158869668095515, 1.0e-7), DoubleNear(0.12892184769191908, 1.0e-7), DoubleNear(0.11047949640827856, 1.0e-7), DoubleNear(0.1270231583129047, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true, false}), Matrix({ { 0.24129310601813328 + 3.0452266623843965e-22i, 0.00321296669579439 + -0.012027181636204946i, -0.0010506008269070047 + -0.011481922281172783i, -0.0039344581188984346 + -0.0018976602518509605i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0032129666957943902 + 0.01202718163620495i, 0.27898388086441106 + -7.944558516452087e-20i, -0.0011304543208300742 + 0.0030943440400159504i, -0.0022461320273111994 + -0.012835172079961875i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0010506008269070047 + 0.011481922281172782i, -0.0011304543208300747 + -0.0030943440400159504i, 0.22246608060947173 + 2.337323459112254e-21i, 0.0010925753178968854 + -0.012638288593466357i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003934458118898434 + 0.0018976602518509602i, -0.0022461320273112 + 0.012835172079961875i, 0.001092575317896886 + 0.012638288593466357i, 0.2572569325079834 + 1.8711296078345932e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24129310601813328, 1.0e-7), DoubleNear(0.27898388086441106, 1.0e-7), DoubleNear(0.22246608060947173, 1.0e-7), DoubleNear(0.2572569325079834, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, true}), Matrix({ { 0.07386698175377279 + 3.208558643379324e-20i, 0.0009679194115336857 + -0.00364208947695917i, -0.0003181115967800384 + -0.0035153335387334947i, -0.0012007460974124877 + -0.0005896574399570521i, -0.020292280404285594 + -0.007120544786331522i, -0.0005450581487566801 + 0.0008145916802566325i, -0.0002450922360020403 + 0.0010052213751062162i, 0.0002836497308183798 + 0.0002517933325393234i }, { 0.0009679194115336858 + 0.003642089476959171i, 0.0852389621517595 + -4.2888617377418226e-20i, -0.0003420012458674544 + 0.0009557554670481575i, -0.0007008898906379862 + -0.003917476087413991i, 0.0002074363716598791 + -0.0014442659132391528i, -0.023107555722610983 + -0.009548413860218239i, 0.00017568728335377238 + -0.00020595780914774733i, -0.0002807664199081614 + 0.0010938886105549136i }, { -0.0003181115967800384 + 0.0035153335387334934i, -0.0003420012458674546 + -0.0009557554670481575i, 0.06810966818951714 + 2.718535145734673e-20i, 0.00032390895895340424 + -0.003840093818638194i, 0.00043231380004933226 + -0.0009234398819812517i, 3.242788183020615e-05 + 0.00028638442759782996i, -0.018701314926494496 + -0.006545743604225525i, -0.0003737169215530834 + 0.0009271561218936735i }, { -0.0012007460974124875 + 0.0005896574399570519i, -0.0007008898906379858 + 0.003917476087413991i, 0.0003239089589534044 + 0.0038400938186381943i, 0.07858979092661539 + 8.083697216726334e-21i, 0.0003964371533476721 + -9.119316861154074e-06i, 0.0006264090872844486 + -0.001039264086412557i, 0.0003904571846878823 + -0.0013793100516243397i, -0.021318161731121065 + -0.008840844121281374i }, { -0.020292280404285594 + 0.007120544786331522i, 0.0002074363716598791 + 0.0014442659132391524i, 0.0004323138000493325 + 0.0009234398819812512i, 0.00039643715334767204 + 9.119316861154128e-06i, 0.1674261242643605 + -3.17810637675548e-20i, 0.002245047284260704 + -0.008385092159245777i, -0.0007324892301269663 + -0.007966588742439289i, -0.0027337120214859464 + -0.0013080028118939084i }, { -0.0005450581487566801 + -0.0008145916802566329i, -0.02310755572261098 + 0.00954841386021824i, 3.24278818302061e-05 + -0.0002863844275978299i, 0.0006264090872844484 + 0.0010392640864125573i, 0.0022450472842607044 + 0.008385092159245778i, 0.19374491871265154 + -3.655696778710264e-20i, -0.0007884530749626197 + 0.002138588572967793i, -0.0015452421366732132 + -0.008917695992547884i }, { -0.0002450922360020402 + -0.0010052213751062166i, 0.00017568728335377236 + 0.00020595780914774733i, -0.018701314926494496 + 0.006545743604225525i, 0.00039045718468788226 + 0.0013793100516243395i, -0.0007324892301269663 + 0.007966588742439287i, -0.00078845307496262 + -0.002138588572967793i, 0.1543564124199546 + -2.4848027998234476e-20i, 0.0007686663589434812 + -0.008798194774828162i }, { 0.0002836497308183798 + -0.0002517933325393234i, -0.0002807664199081614 + -0.0010938886105549136i, -0.0003737169215530835 + -0.0009271561218936738i, -0.02131816173112106 + 0.008840844121281374i, -0.0027337120214859464 + 0.0013080028118939084i, -0.001545242136673214 + 0.008917695992547884i, 0.0007686663589434816 + 0.008798194774828162i, 0.17866714158136807 + 1.0627598861619598e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.07386698175377279, 1.0e-7), DoubleNear(0.0852389621517595, 1.0e-7), DoubleNear(0.06810966818951714, 1.0e-7), DoubleNear(0.07858979092661539, 1.0e-7), DoubleNear(0.1674261242643605, 1.0e-7), DoubleNear(0.19374491871265154, 1.0e-7), DoubleNear(0.1543564124199546, 1.0e-7), DoubleNear(0.17866714158136807, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false, false}), Matrix({ { 0.0904888887431049 + 5.676033572038673e-20i, 0.0008400991796816359 + -0.004812736988866017i, 0.007213001687913657 + -0.012620787518297639i, -0.0006042829664104771 + -0.0005008017436691774i, -0.003433359881771212 + -0.02559720893038341i, -0.001393287052172164 + -5.5038095777754214e-05i, -0.003843806354852313 + -0.0015615287980848252i, -0.00011873729604296325 + 0.00018993923119677293i }, { 0.000840099179681636 + 0.004812736988866017i, 0.10463153442549687 + -5.907576238898806e-20i, 0.0007382140354119241 + 0.0002664588671385828i, 0.00834033266297142 + -0.014593309543745091i, 0.001329536400345365 + -0.00042025107006898887i, -0.003969964905686145 + -0.02959783554199219i, 4.736547105052642e-05 + -0.0002189337095364193i, -0.004444560680642894 + -0.0018055825025883828i }, { 0.007213001687913655 + 0.012620787518297639i, 0.0007382140354119239 + -0.00026645886713858274i, 0.08815995869092477 + 3.3050913627063105e-20i, 0.0008184773844142967 + -0.004688870645027607i, 0.0032964500779344395 + -0.002519253136256318i, -0.0001033846019858008 + -0.0001987135654439651i, -0.003344994833645722 + -0.024938408607405125i, -0.0013574277535092166 + -5.36215696489443e-05i }, { -0.0006042829664104772 + 0.0005008017436691776i, 0.00834033266297142 + 0.01459330954374509i, 0.0008184773844142968 + 0.004688870645027607i, 0.10193861236275545 + 8.851512436107774e-20i, 0.0001645931115564348 + 0.00015193605446827449i, 0.0038116572609320602 + -0.002912991030325026i, 0.001295317864553393 + -0.00040943498689967155i, -0.003867789150149999 + -0.02883607031721499i }, { -0.003433359881771212 + 0.025597208930383412i, 0.0013295364003453644 + 0.00042025107006898876i, 0.0032964500779344395 + 0.002519253136256318i, 0.00016459311155643479 + -0.00015193605446827446i, 0.14441356959956514 + -3.9535931413194074e-20i, 0.00134073611733613 + -0.007680772056767729i, 0.011511416879441698 + -0.020141842849339658i, -0.0009643908930664232 + -0.0007992425199327383i }, { -0.0013932870521721642 + 5.503809577775451e-05i, -0.0039699649056861444 + 0.02959783554199219i, -0.00010338460198580078 + 0.0001987135654439652i, 0.0038116572609320602 + 0.0029129910303250265i, 0.0013407361173361305 + 0.007680772056767731i, 0.16698418545025134 + -2.5645177757076033e-21i, 0.00117813496732171 + 0.00042524863206336083i, 0.013310553684960879 + -0.023289842021009637i }, { -0.0038438063548523133 + 0.0015615287980848252i, 4.736547105052641e-05 + 0.00021893370953641927i, -0.003344994833645722 + 0.024938408607405125i, 0.0012953178645533927 + 0.00040943498689967144i, 0.0115114168794417 + 0.020141842849339658i, 0.00117813496732171 + -0.0004252486320633608i, 0.14069676959401017 + -4.7633471808905087e-20i, 0.0013062293322592127 + -0.007483090539009951i }, { -0.00011873729604296334 + -0.00018993923119677293i, -0.004444560680642894 + 0.0018055825025883828i, -0.0013574277535092169 + 5.362156964894458e-05i, -0.003867789150149999 + 0.02883607031721499i, -0.0009643908930664232 + 0.0007992425199327383i, 0.013310553684960879 + 0.023289842021009633i, 0.0013062293322592129 + 0.007483090539009952i, 0.16268648113389078 + -8.760913328255707e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.0904888887431049, 1.0e-7), DoubleNear(0.10463153442549687, 1.0e-7), DoubleNear(0.08815995869092477, 1.0e-7), DoubleNear(0.10193861236275545, 1.0e-7), DoubleNear(0.14441356959956514, 1.0e-7), DoubleNear(0.16698418545025134, 1.0e-7), DoubleNear(0.14069676959401017, 1.0e-7), DoubleNear(0.16268648113389078, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false, false}), Matrix({ { 0.11789747880847792 + 3.7959690783104354e-20i, 0.0011652106234912004 + -0.00624337347458661i, 0.009397780495023643 + -0.016443555111048686i, -0.0007779035062078824 + -0.000660184249507276i, 0.0031192987913934572 + -0.0009867603096344888i, 0.000276666132579354 + -0.00020174003510805885i, 0.0001110171136763687 + -0.0005137151276461147i, -6.0838943144966025e-06 + -5.466854279304348e-05i }, { 0.0011652106234912004 + 0.0062433734745866104i, 0.1362675533550718 + -2.1944279402988657e-19i, 0.0009636647927206949 + 0.0003351526152942609i, 0.010862086008685705 + -0.01900569075850977i, -5.6980486208711354e-05 + -8.756191226029622e-05i, 0.004044482242048945 + -0.0012927346061867104i, -1.6754550239187454e-05 + 9.675705980602284e-07i, 0.00014208958287580847 + -0.0006671432120938376i }, { 0.009397780495023645 + 0.016443555111048686i, 0.0009636647927206948 + -0.00033515261529426077i, 0.11486312856628582 + -6.115234954900983e-20i, 0.0011352213720387675 + -0.006082686562481536i, 0.00038627062540292105 + 0.00035640291223884807i, 5.01908185789519e-05 + 2.2506556189686756e-05i, 0.0030390167943669557 + -0.0009613638684655549i, 0.0002695455227505191 + -0.00019654781275880567i }, { -0.0007779035062078826 + 0.0006601842495072762i, 0.010862086008685705 + 0.01900569075850977i, 0.0011352213720387675 + 0.006082686562481537i, 0.13276040894702573 + -3.844574806969628e-20i, 7.670554426875232e-06 + -1.492694681989696e-05i, 0.0005026936086043451 + 0.00046105167917820887i, -5.551396840124833e-05 + -8.530831436864455e-05i, 0.003940388619397022 + -0.0012594632452974331i }, { 0.0031192987913934572 + 0.0009867603096344888i, -5.698048620871127e-05 + 8.756191226029618e-05i, 0.00038627062540292137 + -0.00035640291223884807i, 7.670554426875225e-06 + 1.4926946819896946e-05i, 0.11700497953419212 + -2.0735286475911703e-20i, 0.0010156246735265656 + -0.006250135571047136i, 0.009326638072331712 + -0.016319075256588607i, -0.0007907703532690177 + -0.0006398600140946395i }, { 0.00027666613257935397 + 0.00020174003510805893i, 0.004044482242048945 + 0.0012927346061867087i, 5.0190818578951895e-05 + -2.2506556189686746e-05i, 0.0005026936086043451 + -0.00046105167917820914i, 0.0010156246735265658 + 0.006250135571047137i, 0.13534816652067638 + 1.578025138651909e-19i, 0.0009526842100129396 + 0.00035655488390768275i, 0.010788800339246594 + -0.018877460806244955i }, { 0.00011101711367636892 + 0.0005137151276461149i, -1.6754550239187448e-05 + -9.675705980602216e-07i, 0.0030390167943669557 + 0.0009613638684655562i, -5.551396840124825e-05 + 8.53083143686445e-05i, 0.009326638072331712 + 0.016319075256588607i, 0.0009526842100129394 + -0.00035655488390768264i, 0.11399359971864911 + 4.656979136716786e-20i, 0.000989485344634742 + -0.006089274621556021i }, { -6.0838943144966195e-06 + 5.466854279304347e-05i, 0.00014208958287580836 + 0.0006671432120938375i, 0.0002695455227505189 + 0.00019654781275880575i, 0.003940388619397022 + 0.0012594632452974323i, -0.0007907703532690179 + 0.0006398600140946396i, 0.010788800339246594 + 0.018877460806244955i, 0.0009894853446347422 + 0.006089274621556022i, 0.13186468454962053 + 3.935173914821697e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.11789747880847792, 1.0e-7), DoubleNear(0.1362675533550718, 1.0e-7), DoubleNear(0.11486312856628582, 1.0e-7), DoubleNear(0.13276040894702573, 1.0e-7), DoubleNear(0.11700497953419212, 1.0e-7), DoubleNear(0.13534816652067638, 1.0e-7), DoubleNear(0.11399359971864911, 1.0e-7), DoubleNear(0.13186468454962053, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false, false}), Matrix({ { 0.1224208817388554 + -3.400513172787369e-20i, 0.0018957252008112995 + -0.005684845319054121i, 0.009758347559390564 + -0.01707444922453496i, -0.0006417733334947573 + -0.0007175504610154087i, 0.0003268730994856566 + 7.548438174964731e-05i, 1.285935785569139e-05 + 3.249076135534186e-05i, 3.658359172399738e-05 + -3.9573112354718515e-05i, 5.556633220676909e-06 + 7.963485283129774e-07i }, { 0.0018957252008113 + 0.0056848453190541225i, 0.14197492171008266 + -7.620193943931132e-20i, 0.0009439953911021182 + 0.0001887442112128413i, 0.011317028688942405 + -0.01980171648385317i, 3.595971310132174e-05 + -1.3073370737968647e-05i, 0.000446558273530918 + 0.00011947011326954337i, 1.0430146549024094e-06 + -6.057518785831942e-06i, 5.225870889537814e-05 + -5.275983628947908e-05i }, { 0.009758347559390564 + 0.01707444922453496i, 0.0009439953911021182 + -0.00018874421121284124i, 0.1192701117995159 + -2.0969509083869013e-20i, 0.0018469345542228687 + -0.005538533354243419i, 1.552747408911361e-05 + 5.160705332877676e-05i, -3.506556770254028e-06 + 4.383423701247931e-06i, 0.00031846030322729365 + 7.354162559948535e-05i, 1.2528394072426447e-05 + 3.165454033870975e-05i }, { -0.0006417733334947574 + 0.0007175504610154089i, 0.011317028688942405 + 0.01980171648385317i, 0.0018469345542228691 + 0.00553853335424342i, 0.138320885657488 + -6.372288849919255e-20i, 4.689788010695334e-06 + 3.9733237756048045e-06i, 1.8932917512472005e-05 + 7.180611126617593e-05i, 3.5034211001862863e-05 + -1.2736898863710285e-05i, 0.0004350651167718781 + 0.00011639528782969604i }, { 0.00032687309948565657 + -7.548438174964731e-05i, 3.595971310132174e-05 + 1.3073370737968647e-05i, 1.552747408911361e-05 + -5.160705332877675e-05i, 4.68978801069533e-06 + -3.973323775604808e-06i, 0.11248157660381465 + 5.1229536035066336e-20i, 0.0002851100962064664 + -0.006808663726579624i, 0.008966071007964791 + -0.01568818114310234i, -0.0009269005259821429 + -0.0005824938025865068i }, { 1.2859357855691372e-05 + -3.2490761355341865e-05i, 0.00044655827353091797 + -0.00011947011326954359i, -3.50655677025403e-06 + -4.38342370124793e-06i, 1.8932917512472005e-05 + -7.180611126617596e-05i, 0.0002851100962064666 + 0.006808663726579626i, 0.12964079816566554 + 1.4561659274615665e-20i, 0.0009723536116315161 + 0.0005029632879891023i, 0.010333857658989896 + -0.018081435080901556i }, { 3.658359172399738e-05 + 3.95731123547185e-05i, 1.0430146549024077e-06 + 6.057518785831943e-06i, 0.00031846030322729376 + -7.35416255994853e-05i, 3.5034211001862863e-05 + 1.2736898863710292e-05i, 0.008966071007964791 + 0.015688181143102338i, 0.0009723536116315161 + -0.0005029632879891022i, 0.10958661648541905 + 6.386950902027038e-21i, 0.0002777721624506405 + -0.006633427829794139i }, { 5.556633220676908e-06 + -7.963485283129752e-07i, 5.225870889537817e-05 + 5.2759836289479074e-05i, 1.2528394072426449e-05 + -3.165454033870976e-05i, 0.0004350651167718781 + -0.00011639528782969626i, -0.0009269005259821431 + 0.0005824938025865069i, 0.010333857658989896 + 0.018081435080901556i, 0.00027777216245064074 + 0.006633427829794139i, 0.12630420783915824 + 6.462887957771324e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1224208817388554, 1.0e-7), DoubleNear(0.14197492171008266, 1.0e-7), DoubleNear(0.1192701117995159, 1.0e-7), DoubleNear(0.138320885657488, 1.0e-7), DoubleNear(0.11248157660381465, 1.0e-7), DoubleNear(0.12964079816566554, 1.0e-7), DoubleNear(0.10958661648541905, 1.0e-7), DoubleNear(0.12630420783915824, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true, false}), Matrix({ { 0.23490245834267004 + 1.7224404307192645e-20i, 0.002180835297017766 + -0.012493509045633745i, 0.018724418567355357 + -0.032762630367637297i, -0.0015686738594769 + -0.0013000442636019157i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0021808352970177666 + 0.012493509045633748i, 0.2716157198757482 + -6.164028016469566e-20i, 0.0019163490027336342 + 0.0006917074992019436i, 0.0216508863479323 + -0.03788315156475473i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.018724418567355357 + 0.032762630367637297i, 0.0019163490027336342 + -0.0006917074992019434i, 0.22885672828493492 + -1.4582558181841976e-20i, 0.0021247067166735092 + -0.012171961184037558i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0015686738594769005 + 0.0013000442636019157i, 0.021650886347932302 + 0.037883151564754726i, 0.00212470671667351 + 0.012171961184037558i, 0.26462509349664626 + 9.059910785206967e-22i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.23490245834267004, 1.0e-7), DoubleNear(0.2716157198757482, 1.0e-7), DoubleNear(0.22885672828493492, 1.0e-7), DoubleNear(0.26462509349664626, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, true}), Matrix({ { 0.07191375407882934 + 6.680432407585926e-20i, 0.000654334552789989 + -0.0037898618519822593i, 0.005732350532311392 + -0.010030051451385226i, -0.0004764267251223225 + -0.0003933576573473239i, -0.019750964869132963 + -0.006922223498592478i, -0.0004653762748058008 + 0.0008822269236611074i, -0.0025398439306880583 + 0.002202952471669235i, 8.595131179961211e-05 + 0.00013523118185937248i }, { 0.0006543345527899891 + 0.0037898618519822606i, 0.08298224154905356 + -2.0050020811829194e-20i, 0.0005807426538355935 + 0.00021083320663630727i, 0.00661463585943076 + -0.011573810364230577i, 0.0003028439549297995 + -0.0014301925537839695i, -0.022502433470710556 + -0.009314493451577697i, -0.00017533359723886322 + -0.0001562413983333674i, -0.003092825397534371 + 0.002396017649257483i }, { 0.005732350532311392 + 0.010030051451385226i, 0.0005807426538355935 + -0.00021083320663630725i, 0.07006289586446059 + -7.533386184719299e-21i, 0.0006374938176971009 + -0.003692321443615104i, -0.0006089126717591094 + -0.003306513593327228i, -0.00016014295902425525 + 5.416015335329014e-06i, -0.01924263046164713 + -0.006744064891964569i, -0.0004533987955039627 + 0.0008595208784891985i }, { -0.0004764267251223225 + 0.000393357657347324i, 0.00661463585943076 + 0.011573810364230575i, 0.000637493817697101 + 0.003692321443615105i, 0.0808465115293213 + -1.47548993488627e-20i, 0.00022361386652771642 + -7.176408273231479e-05i, -0.000494578379015327 + -0.0038809614455953523i, 0.000295049601417962 + -0.001393383411079523i, -0.021923283983021492 + -0.009074764529921918i }, { -0.019750964869132963 + 0.006922223498592478i, 0.0003028439549297995 + 0.0014301925537839693i, -0.0006089126717591095 + 0.003306513593327228i, 0.0002236138665277164 + 7.176408273231477e-05i, 0.1629887042638407 + -4.957991976866661e-20i, 0.001526500744227777 + -0.008703647193651486i, 0.012992068035043963 + -0.02273257891625207i, -0.0010922471343545776 + -0.0009066866062545917i }, { -0.00046537627480580093 + -0.0008822269236611078i, -0.022502433470710556 + 0.009314493451577695i, -0.0001601429590242553 + -5.416015335329029e-06i, -0.000494578379015327 + 0.0038809614455953528i, 0.0015265007442277774 + 0.008703647193651487i, 0.18863347832669464 + -4.159025935286647e-20i, 0.0013356063488980407 + 0.0004808742925656364i, 0.015036250488501539 + -0.026309341200524153i }, { -0.0025398439306880583 + -0.002202952471669235i, -0.0001753335972388632 + 0.0001562413983333674i, -0.01924263046164713 + 0.006744064891964569i, 0.00029504960141796195 + 0.0013933834110795228i, 0.012992068035043963 + 0.02273257891625207i, 0.0013356063488980407 + -0.00048087429256563616i, 0.15879383242047435 + -7.049171997122676e-21i, 0.0014872128989764084 + -0.008479639740422453i }, { 8.595131179961213e-05 + -0.00013523118185937254i, -0.003092825397534371 + -0.002396017649257483i, -0.00045339879550396276 + -0.0008595208784891988i, -0.021923283983021492 + 0.009074764529921918i, -0.001092247134354578 + 0.0009066866062545917i, 0.01503625048850154 + 0.026309341200524153i, 0.0014872128989764088 + 0.008479639740422453i, 0.18377858196732494 + 1.5660890427383397e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.07191375407882934, 1.0e-7), DoubleNear(0.08298224154905356, 1.0e-7), DoubleNear(0.07006289586446059, 1.0e-7), DoubleNear(0.0808465115293213, 1.0e-7), DoubleNear(0.1629887042638407, 1.0e-7), DoubleNear(0.18863347832669464, 1.0e-7), DoubleNear(0.15879383242047435, 1.0e-7), DoubleNear(0.18377858196732494, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false, false}), Matrix({ { 0.08966380706747401 + 5.042421730012487e-20i, 0.0008861700995948117 + -0.004748232450202857i, -0.0034020543550524803 + -0.025363812451223267i, -0.0013767882518696084 + -7.051794393731633e-05i, 0.0023723001360500305 + -0.0007504544365078084i, 0.0002104111044986616 + -0.00015342804416623094i, -0.000302296773654903 + -0.0006425947194215845i, -5.1384725923295e-05 + -5.369900524849001e-05i }, { 0.0008861700995948117 + 0.004748232450202857i, 0.10363468105568405 + -1.1105188803641688e-19i, 0.0013095415233345348 + -0.0004308360123828844i, -0.003932141959516033 + -0.02931584883252451i, -4.333500066043277e-05 + -6.659289483297855e-05i, 0.003075923922241023 + -0.0009831550894049907i, -1.719335502054435e-05 + 1.4785157139372035e-05i, -0.00039481952452636747 + -0.0008328043707552754i }, { -0.00340205435505248 + 0.025363812451223267i, 0.0013095415233345343 + 0.0004308360123828843i, 0.14309680030728975 + -7.361687606603035e-20i, 0.0014142618959351561 + -0.007577827586865289i, 0.00012227555275654792 + 0.0006995427091956209i, 3.541774799043975e-05 + 6.53418422618708e-05i, 0.0037860154497103824 + -0.0011976697415922348i, 0.0003358005508312115 + -0.0002448598037006337i }, { -0.0013767882518696084 + 7.051794393731659e-05i, -0.003932141959516032 + 0.02931584883252451i, 0.0014142618959351563 + 0.0075778275868652895i, 0.16539328124641345 + -1.46836654063166e-19i, 2.0481817390028265e-05 + -9.731777067932508e-06i, 0.00016140404245576002 + 0.000907410773561377i, -6.91594539495269e-05 + -0.00010627733179596226i, 0.004908946939204944 + -0.0015690427620791503i }, { 0.0023723001360500305 + 0.0007504544365078089i, -4.3335000660432786e-05 + 6.65928948329785e-05i, 0.00012227555275654825 + -0.000699542709195621i, 2.0481817390028268e-05 + 9.731777067932521e-06i, 0.08898504036655566 + 3.9387032047324966e-20i, 0.0007724064645011208 + -0.004753375183690765i, -0.0033763003603644536 + -0.025171805086565267i, -0.0013739265538117724 + -3.8141721489382195e-05i }, { 0.00021041110449866154 + 0.00015342804416623094i, 0.003075923922241023 + 0.0009831550894049902i, 3.5417747990439786e-05 + -6.534184226187081e-05i, 0.00016140404245576024 + -0.0009074107735613766i, 0.000772406464501121 + 0.004753375183690766i, 0.10293546573256826 + 1.4049125000850655e-19i, 0.001315312741564223 + -0.000398850044585776i, -0.003905612096320111 + -0.029118057026682666i }, { -0.00030229677365490324 + 0.0006425947194215844i, -1.7193355020544355e-05 + -1.4785157139372039e-05i, 0.003786015449710382 + 0.0011976697415922366i, -6.915945394952677e-05 + 0.0001062773317959622i, -0.0033763003603644536 + 0.025171805086565267i, 0.0013153127415642223 + 0.0003988500445857759i, 0.1420135388862856 + -1.3552527156068802e-20i, 0.0012327035536601868 + -0.007586035008912391i }, { -5.1384725923295035e-05 + 5.369900524849e-05i, -0.00039481952452636747 + 0.0008328043707552754i, 0.0003358005508312114 + 0.00024485980370063365i, 0.004908946939204944 + 0.0015690427620791503i, -0.0013739265538117728 + 3.814172148938249e-05i, -0.0039056120963201113 + 0.029118057026682666i, 0.001232703553660187 + 0.007586035008912393i, 0.16427738533772868 + 5.666300300490134e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.08966380706747401, 1.0e-7), DoubleNear(0.10363468105568405, 1.0e-7), DoubleNear(0.14309680030728975, 1.0e-7), DoubleNear(0.16539328124641345, 1.0e-7), DoubleNear(0.08898504036655566, 1.0e-7), DoubleNear(0.10293546573256826, 1.0e-7), DoubleNear(0.1420135388862856, 1.0e-7), DoubleNear(0.16427738533772868, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false, false}), Matrix({ { 0.0931039614434355 + 6.528133373662444e-21i, 0.0014417436265504752 + -0.0043234586443034895i, -0.0035325818505890618 + -0.026336952375222704i, -0.0012777093470066102 + -0.00024379372627331093i, 0.0002485946843311257 + 5.7407648663995226e-05i, 9.779844263314354e-06 + 2.4709988602667414e-05i, 6.807029786816803e-06 + -7.249985365895221e-05i, 6.618812810118352e-06 + -3.704045934453265e-06i }, { 0.0014417436265504752 + 0.004323458644303491i, 0.10797526899885812 + -4.83326173864578e-21i, 0.0011683031028598687 + -0.0005718779732130693i, -0.0040968340086106145 + -0.030543700539020315i, 2.734820803892181e-05 + -9.942606096564699e-06i, 0.0003396180756952816 + 9.085983258328421e-05i, -3.850187694033163e-06 + -7.358928365693011e-06i, 1.2816236975678766e-05 + -9.951751501478099e-05i }, { -0.0035325818505890618 + 0.026336952375222707i, 0.001168303102859868 + 0.0005718779732130693i, 0.1485870320949358 + -6.150277418540515e-20i, 0.0023009161284836934 + -0.006899920028994051i, -2.567155620236759e-05 + 6.814349299263116e-05i, -7.360953097396271e-06 + 1.8289365210030605e-06i, 0.00039673871838182456 + 9.16183586851376e-05i, 1.560790766480348e-05 + 3.94353130913842e-05i }, { -0.0012777093470066102 + 0.00024379372627331123i, -0.0040968340086106145 + 0.030543700539020315i, 0.0023009161284836934 + 0.0068999200289940514i, 0.17232053836871256 + -1.350915661998581e-19i, 1.7748778604526962e-06 + 8.113419781520022e-06i, -3.858804371157192e-05 + 9.262264629909754e-05i, 4.3645716064262796e-05 + -1.5867663505114237e-05i, 0.0005420053146075144 + 0.00014500556851595537i }, { 0.0002485946843311257 + -5.740764866399528e-05i, 2.7348208038921806e-05 + 9.942606096564705e-06i, -2.5671556202367494e-05 + -6.814349299263116e-05i, 1.774877860452692e-06 + -8.113419781520022e-06i, 0.08554488599059418 + 8.328311597378739e-20i, 0.0002168329375454572 + -0.0051781489895901325i, -0.0032457728648278726 + -0.024198665162565827i, -0.0014730054586747706 + 0.00013513406084661244i }, { 9.779844263314355e-06 + -2.4709988602667418e-05i, 0.00033961807569528167 + -9.085983258328448e-05i, -7.360953097396273e-06 + -1.8289365210030612e-06i, -3.8588043711571937e-05 + -9.262264629909753e-05i, 0.00021683293754545737 + 0.005178148989590133i, 0.09859487778939419 + 3.427262371073546e-20i, 0.0014565511620388892 + -0.0002578080837555911i, -0.003740920047225528 + -0.027890205320186864i }, { 6.807029786816816e-06 + 7.249985365895219e-05i, -3.850187694033168e-06 + 7.358928365693005e-06i, 0.0003967387183818245 + -9.161835868513738e-05i, 4.36457160642628e-05 + 1.5867663505114237e-05i, -0.0032457728648278717 + 0.02419866516256583i, 0.0014565511620388888 + 0.000257808083755591i, 0.13652330709863952 + -2.566662903669401e-20i, 0.0003460493211116497 + -0.00826394256678363i }, { 6.618812810118352e-06 + 3.704045934453264e-06i, 1.281623697567878e-05 + 9.951751501478101e-05i, 1.560790766480346e-05 + -3.94353130913842e-05i, 0.0005420053146075144 + -0.00014500556851595537i, -0.0014730054586747708 + -0.00013513406084661212i, -0.003740920047225528 + 0.027890205320186864i, 0.00034604932111165 + 0.008263942566783632i, 0.1573501282154296 + 4.491791514159345e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.0931039614434355, 1.0e-7), DoubleNear(0.10797526899885812, 1.0e-7), DoubleNear(0.1485870320949358, 1.0e-7), DoubleNear(0.17232053836871256, 1.0e-7), DoubleNear(0.08554488599059418, 1.0e-7), DoubleNear(0.09859487778939419, 1.0e-7), DoubleNear(0.13652330709863952, 1.0e-7), DoubleNear(0.1573501282154296, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true, false}), Matrix({ { 0.17864884743402967 + 8.981124934744984e-20i, 0.0016585765640959327 + -0.009501607633893622i, -0.006778354715416934 + -0.05053561753778853i, -0.0027507148056813806 + -0.00010865966542669852i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0016585765640959327 + 0.009501607633893624i, 0.20657014678825233 + 2.943936197208968e-20i, 0.0026248542648987577 + -0.0008296860569686604i, -0.007837754055836144 + -0.05843390585920717i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006778354715416933 + 0.05053561753778854i, 0.002624854264898757 + 0.0008296860569686603i, 0.2851103391935753 + -8.716940322209916e-20i, 0.002646965449595343 + -0.01516386259577768i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0027507148056813814 + 0.0001086596654266991i, -0.007837754055836144 + 0.05843390585920717i, 0.002646965449595344 + 0.015163862595777684i, 0.3296706665841421 + -9.017365105826464e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.17864884743402967, 1.0e-7), DoubleNear(0.20657014678825233, 1.0e-7), DoubleNear(0.2851103391935753, 1.0e-7), DoubleNear(0.3296706665841421, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, true}), Matrix({ { 0.05469210229420319 + 9.757235218745646e-20i, 0.0004976368255868466 + -0.002882279123716777i, -0.0020751461585492488 + -0.01547112787782241i, -0.0008342114516670376 + -3.140951694779171e-05i, -0.015021073574433785 + -0.005264513868562037i, -0.0003539296085012337 + 0.0006709543365332114i, -0.0009192743017879894 + 0.004448861456346122i, 0.0002032263442420469 + 7.466090619237626e-05i }, { 0.0004976368255868466 + 0.002882279123716778i, 0.06310994748554219 + -1.5079786169517386e-20i, 0.0007964484437133779 + -0.00025013032673759986i, -0.0023945388748522907 + -0.01785234114167461i, 0.00023031995442826807 + -0.0010876950932949248i, -0.017113630195129945 + -0.0070838914641273565i, -0.0003164226044195974 + -2.3882482451009704e-05i, -0.0013545375593237087 + 0.00510982865238301i }, { -0.0020751461585492488 + 0.015471127877822411i, 0.0007964484437133776 + 0.00025013032673759986i, 0.08728454764908675 + -3.8301414296316493e-20i, 0.0007941915449002435 + -0.004599904171880586i, 0.002059143563261806 + -0.00404936554111473i, -0.00017636851151412046 + -0.00012557605684901607i, -0.02397252175634631 + -0.00840177452199501i, -0.0005648454618085298 + 0.0010707934656170946i }, { -0.0008342114516670378 + 3.1409516947791916e-05i, -0.0023945388748522907 + 0.01785234114167461i, 0.0007941915449002437 + 0.004599904171880588i, 0.1007188055928327 + -1.9725133991174495e-20i, 0.000298944849913177 + 0.00010642186930369105i, 0.002653199796413117 + -0.004572269862622545i, 0.00036757360191949336 + -0.001735880871568568i, -0.0273120872586021 + -0.01130536651737226i }, { -0.015021073574433785 + 0.005264513868562037i, 0.00023031995442826807 + 0.0010876950932949244i, 0.0020591435632618064 + 0.004049365541114731i, 0.0002989448499131769 + -0.00010642186930369111i, 0.12395674513982649 + -7.761102840006618e-21i, 0.001160939738509086 + -0.006619328510176845i, -0.004703208556867686 + -0.03506448965996612i, -0.0019165033540143432 + -7.72501484789068e-05i }, { -0.0003539296085012337 + -0.0006709543365332116i, -0.017113630195129945 + 0.0070838914641273565i, -0.00017636851151412055 + 0.00012557605684901607i, 0.002653199796413117 + 0.004572269862622545i, 0.001160939738509086 + 0.006619328510176846i, 0.14346019930271015 + 4.4519148141607064e-20i, 0.0018284058211853799 + -0.0005795557302310606i, -0.005443215180983852 + -0.04058156471753256i }, { -0.0009192743017879894 + -0.004448861456346121i, -0.00031642260441959734 + 2.388248245100966e-05i, -0.02397252175634631 + 0.00840177452199501i, 0.0003675736019194934 + 0.0017358808715685677i, -0.004703208556867684 + 0.03506448965996613i, 0.0018284058211853792 + 0.0005795557302310605i, 0.1978257915444886 + -4.886798892578267e-20i, 0.0018527739046950995 + -0.010563958423897095i }, { 0.00020322634424204696 + -7.466090619237631e-05i, -0.001354537559323709 + -0.005109828652383009i, -0.0005648454618085299 + -0.001070793465617095i, -0.0273120872586021 + 0.011305366517372259i, -0.0019165033540143434 + 7.725014847890718e-05i, -0.005443215180983852 + 0.04058156471753256i, 0.0018527739046951 + 0.010563958423897096i, 0.22895186099130943 + -7.044851706709015e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.05469210229420319, 1.0e-7), DoubleNear(0.06310994748554219, 1.0e-7), DoubleNear(0.08728454764908675, 1.0e-7), DoubleNear(0.1007188055928327, 1.0e-7), DoubleNear(0.12395674513982649, 1.0e-7), DoubleNear(0.14346019930271015, 1.0e-7), DoubleNear(0.1978257915444886, 1.0e-7), DoubleNear(0.22895186099130943, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false, false}), Matrix({ { 0.1312649283074826 + -1.028228790697102e-19i, 0.0014852639024869783 + -0.006518838183556202i, 0.0032126707382921223 + -0.024563638730718484i, -0.0005147446759752438 + -0.0007818023512463008i, 0.0007733190261781394 + -0.002364125699858702i, 8.785364463985261e-05 + -1.3893406117852259e-05i, 0.013146948887402424 + 0.002246832371563721i, 0.0003232133002225374 + 0.00011272750169179273i }, { 0.0014852639024869783 + 0.006518838183556203i, 0.1501700119418956 + -1.823115665404781e-19i, 0.0007814349421751755 + -0.0007454250193339165i, 0.004198418456763254 + -0.029312350312176404i, 1.9573229728172304e-05 + -0.0002617906653702827i, 0.0011173712218857969 + -0.0028427937789925533i, 0.0009669886267093177 + 0.0005186113984710322i, 0.01518208255041621 + 0.003411221782297129i }, { 0.003212670738292122 + 0.024563638730718484i, 0.0007814349421751751 + 0.0007454250193339163i, 0.11042606523088869 + 4.78482382579675e-20i, 0.0022573958525471905 + -0.004704540489741338i, 0.011038526612309673 + 0.0019311505829958473i, 0.0002962831496742518 + 0.00016814051434627943i, -0.00012798562346518906 + 0.002513151707207835i, -6.246589271173477e-05 + 7.803870781190387e-05i }, { -0.000514744675975244 + 0.0007818023512463008i, 0.004198418456763254 + 0.029312350312176404i, 0.0022573958525471905 + 0.004704540489741339i, 0.13012579542567507 + 4.2386738601974226e-20i, 0.0009389040233630352 + 0.0002850119560802592i, 0.013131807093024372 + 0.0029479226581533664i, 5.14206943750123e-05 + 0.00023598039576860376i, -0.00023574783158300086 + 0.0030786591800917927i }, { 0.0007733190261781395 + 0.002364125699858702i, 1.957322972817228e-05 + 0.0002617906653702827i, 0.011038526612309673 + -0.0019311505829958473i, 0.0009389040233630355 + -0.00028501195608025907i, 0.10149567906728116 + 7.963022030380472e-20i, 0.0008151680930429897 + -0.005807221853511943i, 0.0029456448474682907 + 0.02261551455261844i, 0.0010609563313051169 + 0.00038351450337943606i }, { 8.785364463985255e-05 + 1.3893406117852267e-05i, 0.0011173712218857969 + 0.0028427937789925533i, 0.0002962831496742519 + -0.00016814051434627933i, 0.013131807093024372 + -0.002947922658153366i, 0.0008151680930429898 + 0.005807221853511945i, 0.11885795036020189 + -7.557697555910475e-20i, -0.000893929396785135 + 0.0005725547927049756i, 0.0037864524046827136 + 0.026760152460692264i }, { 0.013146948887402424 + -0.002246832371563721i, 0.0009669886267093179 + -0.0005186113984710321i, -0.0001279856234651891 + -0.0025131517072078348i, 5.142069437501233e-05 + -0.00023598039576860376i, 0.0029456448474682907 + -0.02261551455261844i, -0.0008939293967851346 + -0.0005725547927049756i, 0.12057251402195257 + -2.2013733366711338e-20i, -0.00025228583438588275 + -0.007634869702861818i }, { 0.0003232133002225375 + -0.00011272750169179265i, 0.015182082550416209 + -0.003411221782297129i, -6.246589271173474e-05 + -7.80387078119039e-05i, -0.00023574783158300075 + -0.0030786591800917927i, 0.001060956331305117 + -0.00038351450337943617i, 0.0037864524046827136 + -0.026760152460692264i, -0.0002522858343858824 + 0.0076348697028618216i, 0.13708705564462187 + 1.5476751441143365e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.1312649283074826, 1.0e-7), DoubleNear(0.1501700119418956, 1.0e-7), DoubleNear(0.11042606523088869, 1.0e-7), DoubleNear(0.13012579542567507, 1.0e-7), DoubleNear(0.10149567906728116, 1.0e-7), DoubleNear(0.11885795036020189, 1.0e-7), DoubleNear(0.12057251402195257, 1.0e-7), DoubleNear(0.13708705564462187, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true, false}), Matrix({ { 0.23276060737476376 + -2.3192658765905482e-20i, 0.002300431995529968 + -0.012326060037068147i, 0.006158315585760413 + -0.001948124178100045i, 0.0005462116553298731 + -0.00039828784786686465i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0023004319955299683 + 0.012326060037068147i, 0.2690279623020975 + -2.5788854209958286e-19i, -0.00011249445460995963 + -0.00017287022662894084i, 0.007984870861445966 + -0.002552197851484141i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0061583155857604125 + 0.0019481241781000467i, -0.00011249445460995952 + 0.00017287022662894073i, 0.23099857925284126 + 2.583450489125616e-20i, 0.0020051100181613076 + -0.012339410192603156i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.000546211655329873 + 0.0003982878478668646i, 0.007984870861445968 + 0.002552197851484141i, 0.002005110018161308 + 0.012339410192603161i, 0.2672128510702969 + 1.9715425301340787e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.23276060737476376, 1.0e-7), DoubleNear(0.2690279623020975, 1.0e-7), DoubleNear(0.23099857925284126, 1.0e-7), DoubleNear(0.2672128510702969, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, true}), Matrix({ { 0.07125233881957649 + 1.226060931852629e-20i, 0.0006907310766196359 + -0.003732709072397255i, 0.0017243842751039282 + -0.000645683953944578i, 0.00015880323380699558 + -3.6599781348568264e-05i, -0.019402422301833 + -0.006953898589668703i, -0.00043072546535712205 + 0.0008956671151208995i, 0.001411137998294403 + -0.0038284968158047504i, -0.0001726741686795096 + -0.0001198641023347454i }, { 0.0006907310766196359 + 0.003732709072397256i, 0.0822014580888828 + -1.0796499409870928e-20i, -3.336956195513645e-05 + -0.00017023800664012627i, 0.0018583792948613886 + -0.0008480603043166998i, 0.0002911762001976571 + -0.0014776149626310395i, -0.022037112997194644 + -0.009360689821564797i, 0.00036040495924333823 + -0.0003446520745812918i, 0.0015213304144227565 + -0.005709915703013603i }, { 0.0017243842751039284 + 0.0006456839539445798i, -3.336956195513634e-05 + 0.00017023800664012627i, 0.07072431112371344 + 4.7010328572613675e-20i, 0.0006010972938674542 + -0.003749474223200108i, 0.0014892304149260066 + -0.004034107969533112i, -7.999256622438514e-05 + -0.0001675929755776361i, -0.019591173028947095 + -0.006712389800888343i, -0.00048804960495264153 + 0.0008460806870294065i }, { 0.00015880323380699558 + 3.659978134856829e-05i, 0.0018583792948613886 + 0.0008480603043166998i, 0.0006010972938674544 + 0.0037494742232001095i, 0.08162729498949209 + -2.4008420750820953e-20i, 0.00030191140765021163 + -0.0003397173639100303i, 0.0015669860112895388 + -0.006032055860090308i, 0.0003067173561501043 + -0.0013459610022324533i, -0.0223886044565374 + -0.009028568159934816i }, { -0.019402422301833 + 0.006953898589668703i, 0.00029117620019765704 + 0.001477614962631039i, 0.0014892304149260068 + 0.004034107969533111i, 0.0003019114076502116 + 0.0003397173639100304i, 0.16150826855518727 + -3.545326808443177e-20i, 0.001609700918910332 + -0.008593350964670891i, 0.004433931310656485 + -0.001302440224155467i, 0.00038740842152287753 + -0.0003616880665182964i }, { -0.00043072546535712205 + -0.0008956671151209i, -0.022037112997194644 + 0.009360689821564797i, -7.999256622438516e-05 + 0.0001675929755776361i, 0.0015669860112895388 + 0.006032055860090308i, 0.0016097009189103323 + 0.008593350964670891i, 0.18682650421321473 + -2.4709204268971193e-19i, -7.912489265482318e-05 + -2.6322199888145705e-06i, 0.006126491566584578 + -0.0017041375471674412i }, { 0.0014111379982944031 + 0.003828496815804751i, 0.0003604049592433381 + 0.00034465207458129186i, -0.019591173028947098 + 0.006712389800888344i, 0.0003067173561501044 + 0.001345961002232453i, 0.004433931310656484 + 0.001302440224155467i, -7.912489265482318e-05 + 2.632219988814462e-06i, 0.16027426812912782 + -2.1175823681357514e-20i, 0.0014040127242938535 + -0.008589935969403047i }, { -0.00017267416867950962 + 0.00011986410233474546i, 0.0015213304144227567 + 0.005709915703013603i, -0.0004880496049526416 + -0.0008460806870294068i, -0.0223886044565374 + 0.009028568159934816i, 0.00038740842152287737 + 0.0003616880665182963i, 0.006126491566584579 + 0.0017041375471674412i, 0.0014040127242938537 + 0.00858993596940305i, 0.18558555608080485 + 2.211626737642288e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.07125233881957649, 1.0e-7), DoubleNear(0.0822014580888828, 1.0e-7), DoubleNear(0.07072431112371344, 1.0e-7), DoubleNear(0.08162729498949209, 1.0e-7), DoubleNear(0.16150826855518727, 1.0e-7), DoubleNear(0.18682650421321473, 1.0e-7), DoubleNear(0.16027426812912782, 1.0e-7), DoubleNear(0.18558555608080485, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true, false}), Matrix({ { 0.2416909935383713 + -5.49746408117427e-20i, 0.003742659755034169 + -0.01122337867329754i, 0.0006453334027129503 + 0.00014902600734913282i, 2.5387751928117833e-05 + 6.414530169405161e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003742659755034169 + 0.011223378673297542i, 0.28029580736757065 + -1.3992482793850388e-19i, 7.09939241031846e-05 + -2.581026960167894e-05i, 0.0008816233903027959 + 0.00023586540109923936i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0006453334027129503 + -0.00014902600734913272i, 7.09939241031846e-05 + 2.581026960167894e-05i, 0.2220681930892337 + 5.761648693709338e-20i, 0.0005628822586571068 + -0.013442091556373761i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 2.538775192811782e-05 + -6.414530169405162e-05i, 0.0008816233903027962 + -0.00023586540109923958i, 0.0005628822586571074 + 0.013442091556373766i, 0.2559450060048237 + 7.91905388523289e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.2416909935383713, 1.0e-7), DoubleNear(0.28029580736757065, 1.0e-7), DoubleNear(0.2220681930892337, 1.0e-7), DoubleNear(0.2559450060048237, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, true}), Matrix({ { 0.07399102997919561 + 1.5949223602639405e-20i, 0.0011302512838595627 + -0.0033957527660460197i, 0.0001737796401418548 + 4.778991331156929e-05i, -8.159529272722628e-06 + 2.887868099071907e-05i, -0.0203244304862071 + -0.007123483065649432i, -0.000566161579582699 + 0.0007363567227906341i, 0.00020833362566200818 + -0.0003784315574754544i, -1.2712669180266173e-05 + -1.8084947547374895e-05i }, { 0.0011302512838595627 + 0.0033957527660460206i, 0.085642398764702 + -3.4980378733965754e-20i, 2.3343176574523164e-05 + -2.969645461709131e-05i, 0.0002137124561869688 + 6.637669954414173e-05i, 0.00013594724840668677 + -0.0013910878101468988i, -0.02321446770044801 + -0.009583448849128387i, 4.644305689978303e-05 + -8.709083235128231e-05i, 0.00028834211560393254 + -0.0005533925899632076i }, { 0.00017377964014185483 + -4.77899133115694e-05i, 2.3343176574523158e-05 + 2.969645461709131e-05i, 0.06798561996409432 + 4.332171428850056e-20i, 0.00016157708662752746 + -0.004086430529551344i, 7.382531641814856e-05 + -0.00045246334606558174i, 6.875186732111037e-06 + -1.801155223015093e-05i, -0.018669164844572997 + -0.006542805324907615i, -0.0003526134907270645 + 0.001005391079359672i }, { -8.159529272722635e-06 + -2.887868099071908e-05i, 0.0002137124561869688 + -6.637669954414173e-05i, 0.00016157708662752757 + 0.004086430529551345i, 0.07818635431367285 + 1.7545857327387374e-22i, -1.1250854988154744e-05 + -6.065836068176807e-05i, 4.980853495074856e-05 + -0.0006479563751896125i, 0.00046194630794107463 + -0.001432488154716594i, -0.021211249753284034 + -0.008805809132371228i }, { -0.0203244304862071 + 0.007123483065649432i, 0.00013594724840668677 + 0.0013910878101468984i, 7.382531641814856e-05 + 0.00045246334606558174i, -1.1250854988154764e-05 + 6.0658360681768084e-05i, 0.16769996355917569 + -7.09238644143821e-20i, 0.0026124084711746064 + -0.00782762590725152i, 0.0004715537625710955 + 0.00010123609403756353i, 3.354728120084046e-05 + 3.526662070333254e-05i }, { -0.0005661615795826991 + -0.0007363567227906344i, -0.02321446770044801 + 0.009583448849128387i, 6.8751867321110405e-06 + 1.8011552230150935e-05i, 4.980853495074859e-05 + 0.0006479563751896128i, 0.0026124084711746064 + 0.007827625907251522i, 0.19465340860286867 + -1.0494444920453812e-19i, 4.765074752866144e-05 + 3.88618501541237e-06i, 0.0006679109341158272 + 0.00016948870155509763i }, { 0.0002083336256620082 + 0.0003784315574754544i, 4.644305689978303e-05 + 8.709083235128233e-05i, -0.018669164844572997 + 0.006542805324907615i, 0.00046194630794107463 + 0.0014324881547165937i, 0.0004715537625710955 + -0.00010123609403756332i, 4.765074752866145e-05 + -3.88618501541237e-06i, 0.1540825731251394 + 1.4294772648592823e-20i, 0.0004013051720295794 + -0.009355661026822417i }, { -1.2712669180266168e-05 + 1.8084947547374912e-05i, 0.00028834211560393254 + 0.0005533925899632076i, -0.0003526134907270645 + -0.0010053910793596723i, -0.021211249753284034 + 0.008805809132371228i, 3.3547281200840454e-05 + -3.526662070333255e-05i, 0.0006679109341158273 + -0.00016948870155509784i, 0.0004013051720295798 + 0.00935566102682242i, 0.1777586516911509 + 7.901508027905503e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.07399102997919561, 1.0e-7), DoubleNear(0.085642398764702, 1.0e-7), DoubleNear(0.06798561996409432, 1.0e-7), DoubleNear(0.07818635431367285, 1.0e-7), DoubleNear(0.16769996355917569, 1.0e-7), DoubleNear(0.19465340860286867, 1.0e-7), DoubleNear(0.1540825731251394, 1.0e-7), DoubleNear(0.1777586516911509, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, true}), Matrix({ { 0.14197664994328993 + 5.927093789113997e-20i, 0.00129182837048709 + -0.007482183295597364i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0389935953307801 + -0.013666288390557047i, -0.0009187750703097636 + 0.0017417478021503061i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0012918283704870903 + 0.007482183295597366i, 0.16382875307837486 + -3.480492016069188e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0005978935563477614 + -0.002823575964863493i, -0.04442571745373204 + -0.018389257981499617i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0389935953307801 + 0.013666288390557047i, 0.0005978935563477614 + 0.002823575964863492i, 0.0 + 0.0i, 0.0 + 0.0i, 0.3217825366843151 + -5.662909176578927e-20i, 0.0030137136432041856 + -0.017183286934073935i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0009187750703097636 + -0.0017417478021503068i, -0.04442571745373204 + 0.018389257981499617i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003013713643204186 + 0.017183286934073942i, 0.3724120602940196 + -2.5929368925483092e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.14197664994328993, 1.0e-7), DoubleNear(0.16382875307837486, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3217825366843151, 1.0e-7), DoubleNear(0.3724120602940196, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false, false}), Matrix({ { 0.1364065840967261 + 5.216878072855409e-21i, 0.00878656977018917 + 0.0002944739441355568i, -0.0008643397241494316 + -0.006375472797356255i, -4.1912717841864185e-05 + -0.00041253919268041987i, 0.006911077244807256 + -0.012877168421323344i, 0.01102385879843426 + -0.0038157472634113908i, -0.0006456547252442186 + -0.00024141896809198437i, -0.00024819587834821685 + -0.0004910628793895646i }, { 0.008786569770189172 + -0.0002944739441355567i, 0.12712316746798827 + -1.0235223947124184e-19i, -6.943940407623486e-05 + -0.0004088073269595858i, -0.0008055153952419812 + -0.005941577538011047i, -0.01746631087992607 + -0.0023872126208254445i, 0.014095264740982593 + -0.023878206138422887i, -9.001236892465026e-07 + 0.0008314800442688362i, -0.0012053520144352074 + -0.0005074908610841982i }, { -0.0008643397241494314 + 0.006375472797356254i, -6.943940407623495e-05 + 0.0004088073269595858i, 0.12577411490759224 + 1.2767119124155839e-20i, 0.008101683971029616 + 0.00027152061560851146i, 0.0005580707037117055 + 0.00040461121097110965i, 0.00010849061212522618 + 0.0005394198111157084i, 0.006372380257739306 + -0.011873433173573714i, 0.010164583274485944 + -0.0035183216260757724i }, { -4.191271784186413e-05 + 0.0004125391926804198i, -0.000805515395241981 + 0.005941577538011047i, 0.008101683971029616 + -0.00027152061560851173i, 0.11721431174611163 + 3.9952366416727623e-20i, 0.0002222505288450318 + -0.0008012269195852482i, 0.0010267228475411075 + 0.0008100991588219763i, -0.01610486624359561 + -0.002201136818055985i, 0.012996582671758494 + -0.02201697419907208i }, { 0.006911077244807257 + 0.012877168421323342i, -0.01746631087992607 + 0.0023872126208254445i, 0.0005580707037117055 + -0.00040461121097110965i, 0.00022225052884503147 + 0.0008012269195852482i, 0.13519467389687895 + -2.0086932356873516e-20i, 0.014496941710733777 + 0.010620608799682126i, -0.0008566604604631049 + -0.006318829633368765i, 0.0004045341378488067 + -0.0007448663293980789i }, { 0.01102385879843426 + 0.0038157472634113903i, 0.014095264740982596 + 0.023878206138422887i, 0.00010849061212522614 + -0.0005394198111157084i, 0.0010267228475411075 + -0.0008100991588219765i, 0.014496941710733778 + -0.010620608799682128i, 0.121552561420951 + 3.80812312569775e-20i, -0.0005882537534705977 + -0.0006102714468855624i, -0.0007702172743636875 + -0.005681214392398587i }, { -0.0006456547252442185 + 0.00024141896809198431i, -9.001236892464891e-07 + -0.0008314800442688364i, 0.006372380257739307 + 0.011873433173573714i, -0.01610486624359561 + 0.002201136818055986i, -0.0008566604604631049 + 0.006318829633368767i, -0.0005882537534705977 + 0.0006102714468855623i, 0.12465666934041073 + -7.391953403415996e-21i, 0.013366950170393268 + 0.009792765359570833i }, { -0.00024819587834821685 + 0.0004910628793895645i, -0.0012053520144352076 + 0.0005074908610841982i, 0.010164583274485946 + 0.0035183216260757716i, 0.012996582671758494 + 0.02201697419907208i, 0.00040453413784880687 + 0.0007448663293980788i, -0.0007702172743636879 + 0.005681214392398587i, 0.013366950170393268 + -0.009792765359570833i, 0.11207791712334056 + -2.427891260000928e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1364065840967261, 1.0e-7), DoubleNear(0.12712316746798827, 1.0e-7), DoubleNear(0.12577411490759224, 1.0e-7), DoubleNear(0.11721431174611163, 1.0e-7), DoubleNear(0.13519467389687895, 1.0e-7), DoubleNear(0.121552561420951, 1.0e-7), DoubleNear(0.12465666934041073, 1.0e-7), DoubleNear(0.11207791712334056, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false, false}), Matrix({ { 0.10462596343380309 + 1.2853008383131181e-19i, 0.008969250874644098 + 0.004204697196426437i, -0.0006629619601728029 + -0.004890086414717366i, 0.00013968865869853014 + -0.00044585459112239455i, -0.003969753529243702 + -0.02959625963758763i, 0.0008490970280506959 + -0.0026967291857155195i, -0.001358137759839787 + 0.00037307787498602903i, -0.00013142204223555275 + -2.2597918308550045e-05i }, { 0.008969250874644098 + -0.004204697196426436i, 0.0957946141700901 + 4.9976415460992115e-20i, -0.0002533558966570678 + -0.00039256850029390454i, -0.0006070021541486877 + -0.004477320217487257i, -0.0015297257008144755 + -0.002377657112453786i, -0.003634671502211379 + -0.02709807565742824i, -0.00010143561356108718 + 8.656347612433946e-05i, -0.0012434990171058128 + 0.0003415868290885153i }, { -0.0006629619601728031 + 0.004890086414717365i, -0.0002533558966570678 + 0.00039256850029390454i, 0.09647069483031305 + -4.898431038347506e-20i, 0.008270125651285072 + 0.003876954120924007i, 0.0014084464116270736 + 1.9952647807102125e-06i, 0.00012066144301871408 + 5.677354371434767e-05i, -0.0036603235822390244 + -0.02728932320344076i, 0.0007829125542650871 + -0.0024865275288935415i }, { 0.00013968865869853016 + 0.0004458545911223947i, -0.0006070021541486875 + 0.004477320217487256i, 0.008270125651285072 + -0.003876954120924007i, 0.08832772178807571 + -1.0271577589289333e-20i, 0.00012082181400033728 + -5.643144831484666e-05i, 0.0012895611772925598 + 1.8268469274956834e-06i, -0.0014104883378276362 + -0.0021923261318571047i, -0.0033513601575589705 + -0.024985864898539083i }, { -0.003969753529243703 + 0.02959625963758763i, -0.0015297257008144755 + 0.002377657112453786i, 0.0014084464116270738 + -1.995264780710375e-06i, 0.00012082181400033728 + 5.643144831484666e-05i, 0.16697529455980192 + -1.4340013811532993e-19i, 0.01431426060627885 + 0.006710385547391248i, -0.0010580382244397332 + -0.007804216016007656i, 0.0002229327613084124 + -0.0007115509309561042i }, { 0.0008490970280506958 + 0.0026967291857155195i, -0.003634671502211379 + 0.02709807565742824i, 0.00012066144301871401 + -5.677354371434765e-05i, 0.0012895611772925598 + -1.826846927495602e-06i, 0.01431426060627885 + -0.006710385547391249i, 0.15288111471884916 + -1.1424742367525649e-19i, -0.00040433726088976465 + -0.0006265102735512436i, -0.0009687305154569817 + -0.007145471712922379i }, { -0.0013581377598397867 + -0.000373077874986029i, -0.00010143561356108721 + -8.656347612433946e-05i, -0.0036603235822390244 + 0.02728932320344076i, -0.0014104883378276362 + 0.0021923261318571047i, -0.0010580382244397332 + 0.007804216016007658i, -0.0004043372608897647 + 0.0006265102735512437i, 0.1539600894176899 + 5.43594761042149e-20i, 0.013198508490137813 + 0.006187331854255337i }, { -0.00013142204223555275 + 2.2597918308550056e-05i, -0.0012434990171058128 + -0.00034158682908851546i, 0.0007829125542650871 + 0.0024865275288935415i, -0.0033513601575589705 + 0.024985864898539083i, 0.00022293276130841254 + 0.000711550930956104i, -0.0009687305154569817 + 0.007145471712922378i, 0.013198508490137812 + -0.006187331854255338i, 0.1409645070813765 + 2.5945031406007672e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10462596343380309, 1.0e-7), DoubleNear(0.0957946141700901, 1.0e-7), DoubleNear(0.09647069483031305, 1.0e-7), DoubleNear(0.08832772178807571, 1.0e-7), DoubleNear(0.16697529455980192, 1.0e-7), DoubleNear(0.15288111471884916, 1.0e-7), DoubleNear(0.1539600894176899, 1.0e-7), DoubleNear(0.1409645070813765, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false, false}), Matrix({ { 0.1366015108261422 + -1.6870179544683746e-19i, 0.011710412790896534 + 0.005489727126495695i, -0.00021700783586104896 + -0.004955839743330663i, 0.00018056137437694807 + -0.00043356945735761854i, 0.0038519937135521143 + -0.0021200004757403208i, 0.00041541751793443 + -2.6937376352459007e-05i, 0.003649161502148666 + -0.0018693351557128117i, 0.00038795564648685867 + -1.360003574914367e-05i }, { 0.011710412790896534 + -0.005489727126495694i, 0.12507114482076906 + -8.277073633414762e-20i, -0.00021776815666541544 + -0.0004161272812647821i, -0.00019869047056706975 + -0.0045375233882699595i, 0.00024502080636851144 + -0.00033654441147949656i, 0.0035268516481456727 + -0.0019410538354797868i, 0.00023770635786969722 + -0.00030690427178802496i, 0.0033411402549602424 + -0.00171154686770835i }, { -0.0002170078358610483 + 0.004955839743330661i, -0.00021776815666541542 + 0.0004161272812647823i, 0.12534820097576527 + -1.1649030180089885e-20i, 0.010745702350911001 + 0.005037480295733316i, -0.0037539367648387716 + -0.0015238747488046844i, -0.00026057173413398214 + -0.0002814997477454875i, 0.0035312027912868687 + -0.00022931182410841286i, 0.00031193433672781006 + 0.00012225343287452074i }, { 0.0001805613743769482 + 0.00043356945735761843i, -0.00019869047056706975 + 0.0045375233882699595i, 0.010745702350911003 + -0.005037480295733316i, 0.11476771305418478 + -1.795963890441341e-20i, -0.0003830543698720622 + 2.022588273181469e-05i, -0.003437071566219505 + -0.0013952463500864075i, 0.000293503217867985 + -0.00016156977867337038i, 0.003233138294221725 + -0.0002099558942556673i }, { 0.0038519937135521143 + 0.00212000047574032i, 0.00024502080636851133 + 0.0003365444114794968i, -0.0037539367648387716 + 0.0015238747488046844i, -0.0003830543698720622 + -2.022588273181467e-05i, 0.13499974716746285 + 1.538317411628193e-19i, 0.011573098690026415 + 0.005425355617321989i, -0.0015039923487514875 + -0.007738462687394358i, 0.00018206004562999447 + -0.0007238360647208802i }, { 0.0004154175179344297 + 2.6937376352458953e-05i, 0.0035268516481456727 + 0.0019410538354797885i, -0.0002605717341339822 + 0.00028149974774548743i, -0.003437071566219505 + 0.0013952463500864075i, 0.011573098690026415 + -0.00542535561732199i, 0.1236045840681702 + 1.8499728119883275e-20i, -0.0004399250008814169 + -0.0006029514925803659i, -0.0013770421990385996 + -0.007085268542139674i }, { 0.003649161502148666 + 0.0018693351557128117i, 0.00023770635786969727 + 0.0003069042717880249i, 0.0035312027912868683 + 0.00022931182410841286i, 0.000293503217867985 + 0.0001615697786733701i, -0.0015039923487514871 + 0.007738462687394359i, -0.00043992500088141715 + 0.0006029514925803658i, 0.1250825832722377 + 1.7024195900829722e-20i, 0.010722931790511883 + 0.005026805679446029i }, { 0.00038795564648685867 + 1.3600035749143653e-05i, 0.0033411402549602415 + 0.0017115468677083498i, 0.00031193433672781 + -0.00012225343287452064i, 0.003233138294221725 + 0.0002099558942556673i, 0.00018206004562999447 + 0.0007238360647208801i, -0.0013770421990385996 + 0.007085268542139674i, 0.010722931790511883 + -0.0050268056794460295i, 0.11452451581526743 + 3.3633092721131745e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1366015108261422, 1.0e-7), DoubleNear(0.12507114482076906, 1.0e-7), DoubleNear(0.12534820097576527, 1.0e-7), DoubleNear(0.11476771305418478, 1.0e-7), DoubleNear(0.13499974716746285, 1.0e-7), DoubleNear(0.1236045840681702, 1.0e-7), DoubleNear(0.1250825832722377, 1.0e-7), DoubleNear(0.11452451581526743, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false, false}), Matrix({ { 0.14604704733399254 + -2.289142574083385e-19i, 0.012520148575438405 + 0.005869323352612456i, 0.007367188018168551 + 0.011576506883830117i, 0.00016633014373898227 + 0.0012884888690554365i, 0.000459398968300109 + 9.494441764447664e-05i, 3.556719526797675e-05 + 2.660156010715163e-05i, -0.00046589724118001677 + 0.0003392752274146176i, -5.357464487313225e-05 + 1.0361556260431507e-05i }, { 0.012520148575438405 + -0.005869323352612457i, 0.1337193951756775 + 2.909000776153506e-20i, 0.0010968010219287723 + 0.0006963453171322321i, 0.006745332712424552 + 0.010599348134801567i, 4.31984277763141e-05 + -1.0322994576157102e-05i, 0.00042062166477721606 + 8.693027578772136e-05i, -2.6305130677838606e-05 + 4.780841475558627e-05i, -0.0004265714264125922 + 0.0003106374215441858i }, { 0.007367188018168552 + -0.011576506883830117i, 0.0010968010219287723 + -0.0006963453171322321i, 0.12644678836610013 + 4.024997081273405e-21i, 0.010839880751646765 + 0.005081630210042999i, -0.00016297701928663633 + 0.00030824255788184166i, -2.6359120635228724e-05 + 1.9874950228042057e-05i, 0.00033772140477259774 + 0.00010598123034907597i, 2.4692618717481627e-05 + 2.2657745831174303e-05i }, { 0.00016633014373898232 + -0.0012884888690554365i, 0.006745332712424551 + -0.010599348134801567i, 0.010839880751646765 + -0.005081630210042999i, 0.1157735700301718 + 8.997838152834325e-22i, -1.5838817478923875e-06 + 3.2974356791882734e-05i, -0.00014922032895814223 + 0.0002822241815892577i, 3.321094375836932e-05 + -4.486878642826083e-06i, 0.00030921475516582347 + 9.70354846670981e-05i }, { 0.000459398968300109 + -9.494441764447685e-05i, 4.319842777631409e-05 + 1.0322994576157143e-05i, -0.00016297701928663633 + -0.00030824255788184176i, -1.5838817478923943e-06 + -3.297435679188274e-05i, 0.12555421065961248 + 2.1404420312432033e-19i, 0.010763362905484544 + 0.005045759391205228i, -0.009088188202781088 + -0.024270809314555136i, 0.00019629127626796024 + -0.0024458943911339352i }, { 3.556719526797679e-05 + -2.660156010715163e-05i, 0.000420621664777216 + -8.693027578772136e-05i, -2.6359120635228728e-05 + -1.987495022804207e-05i, -0.00014922032895814207 + -0.0002822241815892578i, 0.010763362905484544 + -0.005045759391205228i, 0.11495633371326175 + -9.33610159757994e-20i, -0.0017544941794756046 + -0.00171542409097738i, -0.008321065382030222 + -0.0222221400652112i }, { -0.000465897241180017 + -0.0003392752274146174i, -2.630513067783862e-05 + -4.780841475558628e-05i, 0.00033772140477259774 + -0.00010598123034907597i, 3.321094375836931e-05 + 4.486878642826083e-06i, -0.009088188202781086 + 0.024270809314555136i, -0.001754494179475605 + 0.0017154240909773803i, 0.12398399588190284 + 1.350168639466423e-21i, 0.010628753389776119 + 0.004982655765136346i }, { -5.3574644873132276e-05 + -1.0361556260431574e-05i, -0.0004265714264125926 + -0.00031063742154418557i, 2.469261871748162e-05 + -2.265774583117431e-05i, 0.0003092147551658234 + -9.703548466709816e-05i, 0.00019629127626796035 + 0.002445894391133935i, -0.00832106538203022 + 0.0222221400652112i, 0.01062875338977612 + -0.0049826557651363465i, 0.11351865883928042 + 1.4773670001434907e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.14604704733399254, 1.0e-7), DoubleNear(0.1337193951756775, 1.0e-7), DoubleNear(0.12644678836610013, 1.0e-7), DoubleNear(0.1157735700301718, 1.0e-7), DoubleNear(0.12555421065961248, 1.0e-7), DoubleNear(0.11495633371326175, 1.0e-7), DoubleNear(0.12398399588190284, 1.0e-7), DoubleNear(0.11351865883928042, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true, false}), Matrix({ { 0.271601257993605 + -1.4870054284018177e-20i, 0.023283511480922947 + 0.010915082743817684i, -0.0017210001846125365 + -0.01269430243072502i, 0.00036262142000694246 + -0.0011574055220784987i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.023283511480922947 + -0.010915082743817684i, 0.24867572888893924 + -6.427100821426434e-20i, -0.0006576931575468323 + -0.001019078773845148i, -0.0015757326696056694 + -0.011622791930409635i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0017210001846125343 + 0.012694302430725023i, -0.0006576931575468326 + 0.0010190787738451482i, 0.25043078424800297 + 5.375165720739828e-21i, 0.021468634141422884 + 0.010064285975179344i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0003626214200069427 + 0.0011574055220784985i, -0.0015757326696056694 + 0.011622791930409632i, 0.021468634141422884 + -0.010064285975179346i, 0.22929222886945222 + 1.567345381671834e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.271601257993605, 1.0e-7), DoubleNear(0.24867572888893924, 1.0e-7), DoubleNear(0.25043078424800297, 1.0e-7), DoubleNear(0.22929222886945222, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, true}), Matrix({ { 0.08305840082978379 + -2.744039514214721e-20i, 0.007120332371041172 + 0.0033379422625782213i, -0.0005319514275240675 + -0.0038801647887308564i, 0.0001103331508107401 + -0.0003540121867022755i, -0.02265610508627495 + -0.008701730524299288i, -0.001592531556729141 + -0.0016564728291734675i, -0.00027451506807522983 + 0.0010958026727044333i, -6.757130551697784e-05 + 8.290749311921087e-05i }, { 0.007120332371041172 + -0.0033379422625782213i, 0.07604754307574849 + 1.663736419852221e-20i, -0.00020153815671937692 + -0.00031125617084277714i, -0.00048705005989395714 + -0.003552644837416629i, -0.0022919400159445037 + 0.00016452949972695557i, -0.020743731040621625 + -0.007967228122250475i, 2.0504699224849034e-05 + 0.00010497185839204354i, -0.00025134358783497195 + 0.0010033073129566972i }, { -0.0005319514275240679 + 0.003880164788730856i, -0.00020153815671937692 + 0.00031125617084277714i, 0.07658181823813398 + 3.994721793385814e-20i, 0.006565115557084535 + 0.003077662043674775i, 0.0005526872710427857 + -0.001024594360936329i, 8.855641106684419e-05 + -6.56238759824993e-05i, -0.020891449129015423 + -0.008032291813476028i, -0.0014681565498910793 + -0.0015281661712642962i }, { 0.00011033315081074016 + 0.0003540121867022753i, -0.00048705005989395714 + 0.003552644837416627i, 0.006565115557084535 + -0.0030776620436747757i, 0.07011764087799854 + -4.678169259785089e-21i, 6.203830588499395e-06 + -0.00011004655163173234i, 0.0005060356162909951 + -0.0009381096074574796i, -0.0021137583443322856 + 0.00015100054221852782i, -0.019128027528600138 + -0.0073542959120308695i }, { -0.022656105086274952 + 0.008701730524299288i, -0.0022919400159445037 + -0.00016452949972695538i, 0.0005526872710427859 + 0.0010245943609363292i, 6.203830588499408e-06 + 0.00011004655163173237i, 0.18854285716382124 + 1.2570340858129034e-20i, 0.016163179109881777 + 0.007577140481239463i, -0.001189048757088469 + -0.008814137641994162i, 0.00025228826919620237 + -0.0008033933353762232i }, { -0.001592531556729141 + 0.0016564728291734677i, -0.020743731040621625 + 0.007967228122250473i, 8.855641106684426e-05 + 6.56238759824993e-05i, 0.000506035616290995 + 0.00093810960745748i, 0.016163179109881777 + -0.007577140481239463i, 0.17262818581319075 + -8.090837241278655e-20i, -0.0004561550008274555 + -0.0007078226030023708i, -0.0010886826097117122 + -0.008070147092993005i }, { -0.0002745150680752297 + -0.001095802672704433i, 2.050469922484902e-05 + -0.00010497185839204352i, -0.020891449129015426 + 0.00803229181347603i, -0.002113758344332285 + -0.00015100054221852782i, -0.0011890487570884664 + 0.008814137641994166i, -0.0004561550008274557 + 0.000707822603002371i, 0.173848966009869 + -3.457205221311831e-20i, 0.01490351858433835 + 0.00698662393150457i }, { -6.757130551697781e-05 + -8.29074931192109e-05i, -0.00025134358783497195 + -0.0010033073129566972i, -0.0014681565498910793 + 0.0015281661712642962i, -0.01912802752860014 + 0.0073542959120308695i, 0.00025228826919620253 + 0.0008033933353762232i, -0.0010886826097117122 + 0.008070147092993005i, 0.01490351858433835 + -0.00698662393150457i, 0.15917458799145368 + 2.035162307650343e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.08305840082978379, 1.0e-7), DoubleNear(0.07604754307574849, 1.0e-7), DoubleNear(0.07658181823813398, 1.0e-7), DoubleNear(0.07011764087799854, 1.0e-7), DoubleNear(0.18854285716382124, 1.0e-7), DoubleNear(0.17262818581319075, 1.0e-7), DoubleNear(0.173848966009869, 1.0e-7), DoubleNear(0.15917458799145368, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false, false}), Matrix({ { 0.10099698517493841 + -4.790403840469592e-21i, 0.006505676120362994 + 0.00021803185503989348i, 0.005117040138925415 + -0.009534401852782657i, 0.00816219034446741 + -0.0028252226411651744i, -0.0038320616143702824 + -0.028569705814391777i, -0.00018516439621757218 + -0.001848577599237299i, -0.0028912137193003945 + -0.0010857345480517811i, -0.001108882565479347 + -0.00220169888558636i }, { 0.006505676120362996 + -0.00021803185503989301i, 0.09412343799366334 + 2.474977171868258e-21i, -0.01293225508638111 + -0.0017675193559862766i, 0.01043629421195966 + -0.017679695209260073i, -0.000308516711058779 + -0.0018320323231389851i, -0.0035712631730870736 + -0.026625338657983826i, -9.3102751173862e-06 + 0.0037252989855054938i, -0.005397153316194813 + -0.002281376752621427i }, { 0.005117040138925415 + 0.009534401852782657i, -0.01293225508638111 + 0.0017675193559862769i, 0.10009967308917775 + 8.433617728830632e-20i, 0.010733700405566175 + 0.00786361946231055i, 0.0025029087998693174 + -0.001809249518181712i, 0.0009906702279501786 + 0.003591171356547076i, -0.0037980154971124455 + -0.028315877026636613i, 0.0018171739785333553 + -0.003334679115371762i }, { 0.00816219034446741 + 0.0028252226411651744i, 0.01043629421195966 + 0.01767969520926007i, 0.010733700405566173 + -0.00786361946231055i, 0.08999889796450247 + 3.722986069983453e-20i, 0.0004894974174169532 + -0.0024160899828355752i, 0.004605198538997183 + -0.0036229946483996313i, -0.0026316973275833325 + -0.002737950921171906i, -0.0034147684866832756 + -0.025458601897983497i }, { -0.0038320616143702824 + 0.02856970581439177i, -0.00030851671105877924 + 0.001832032323138985i, 0.0025029087998693174 + 0.001809249518181712i, 0.0004894974174169533 + 0.0024160899828355752i, 0.16118371382937993 + 2.2774401037480806e-20i, 0.01038257762085579 + 0.00034796270470417473i, 0.008166417363621148 + -0.015216199742114397i, 0.013026251728452794 + -0.004508846248321988i }, { -0.00018516439621757216 + 0.0018485775992372986i, -0.003571263173087074 + 0.026625338657983822i, 0.0009906702279501784 + -0.003591171356547076i, 0.004605198538997182 + 0.0036229946483996318i, 0.010382577620855793 + -0.00034796270470417544i, 0.15021404122043655 + -6.487485022638249e-20i, -0.020638922037140572 + -0.0028208300828951533i, 0.01665555320078143 + -0.028215485128234897i }, { -0.0028912137193003945 + 0.001085734548051781i, -9.310275117386247e-06 + -0.0037252989855054933i, -0.0037980154971124455 + 0.028315877026636613i, -0.002631697327583333 + 0.002737950921171906i, 0.00816641736362115 + 0.015216199742114397i, -0.02063892203714057 + 0.0028208300828951533i, 0.15975167014811192 + -1.1181506304859584e-19i, 0.01713019147556087 + 0.01254975469694241i }, { -0.001108882565479347 + 0.0022016988855863596i, -0.005397153316194813 + 0.002281376752621427i, 0.001817173978533355 + 0.003334679115371762i, -0.0034147684866832756 + 0.025458601897983497i, 0.013026251728452797 + 0.004508846248321988i, 0.01665555320078143 + 0.028215485128234897i, 0.01713019147556087 + -0.01254975469694241i, 0.1436315805797891 + -2.3427542042866305e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10099698517493841, 1.0e-7), DoubleNear(0.09412343799366334, 1.0e-7), DoubleNear(0.10009967308917775, 1.0e-7), DoubleNear(0.08999889796450247, 1.0e-7), DoubleNear(0.16118371382937993, 1.0e-7), DoubleNear(0.15021404122043655, 1.0e-7), DoubleNear(0.15975167014811192, 1.0e-7), DoubleNear(0.1436315805797891, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false, false}), Matrix({ { 0.13155927795025668 + -1.183537295752752e-19i, 0.00847433268914608 + 0.0002840096005788614i, 0.006665487140566216 + -0.01241956897294524i, 0.010632118041451664 + -0.0036801519379673327i, 0.0037080705088769726 + -0.0011798975754609125i, 0.0002414008792156294 + -6.799761376624988e-05i, 7.648473851908164e-05 + -0.0004098322094649086i, 0.0002666664149732954 + -0.00019908191635400422i }, { 0.008474332689146082 + -0.0002840096005788612i, 0.12260575421329309 + -6.312937367150699e-20i, -0.01684563295118052 + -0.0023023813021139433i, 0.013594379363143134 + -0.02302967689661322i, 0.00023630656364394698 + -8.400754693937951e-05i, 0.00345571052456543 + -0.0010995973403602815i, -0.0004954524673693854 + 8.618722636902264e-05i, 0.0001766219580330953 + -0.000771026130275044i }, { 0.006665487140566215 + 0.01241956897294524i, -0.016845632951180516 + 0.002302381302113943i, 0.13039043385165078 + -6.199709605165209e-20i, 0.013981782452661455 + 0.01024319782165015i, 0.00029925609372503535 + 0.00029027253660939727i, -0.00045415436725092814 + 0.0002159749895670924i, 0.00367512599596201 + -0.0011694147243878177i, 0.0004859509754466106 + 0.00016331367028831135i }, { 0.010632118041451664 + 0.003680151937967332i, 0.013594379363143132 + 0.02302967689661322i, 0.013981782452661455 + -0.01024319782165015i, 0.11723310366166075 + -3.760100156705403e-20i, 0.0003326777585529898 + 8.372291087341819e-06i, 0.000589708140282231 + 0.0005271820548076599i, 0.00030221746059254937 + -0.0004141066432134875i, 0.0033042794178019673 + -0.0010514123893751713i }, { 0.0037080705088769726 + 0.0011798975754609134i, 0.000236306563643947 + 8.40075469393793e-05i, 0.0002992560937250354 + -0.00029027253660939727i, 0.00033267775855298976 + -8.372291087341819e-06i, 0.13062142105406171 + 1.3633772677228646e-19i, 0.008413921052072705 + 0.0002819849591652069i, 0.0066179703619803475 + -0.012331032621951813i, 0.010556324031468538 + -0.003653916951519831i }, { 0.00024140087921562913 + 6.799761376624966e-05i, 0.00345571052456543 + 0.0010995973403602833i, -0.00045415436725092847 + -0.0002159749895670925i, 0.0005897081402822312 + -0.0005271820548076598i, 0.008413921052072705 + -0.0002819849591652072i, 0.12173172500080683 + 7.295006169927646e-22i, -0.01672554417234116 + -0.002285968136767487i, 0.013497468049597956 + -0.022865503440881747i }, { 7.648473851908159e-05 + 0.0004098322094649086i, -0.0004954524673693853 + -8.618722636902264e-05i, 0.0036751259959620104 + 0.0011694147243878177i, 0.0003022174605925493 + 0.0004141066432134875i, 0.006617970361980348 + 0.012331032621951813i, -0.01672554417234116 + 0.0022859681367674873i, 0.12946090938563887 + 3.4518210291362566e-20i, 0.01388210942846559 + 0.01017017633760281i }, { 0.00026666641497329546 + 0.0001990819163540041i, 0.00017662195803309563 + 0.0007710261302750441i, 0.0004859509754466106 + -0.0001633136702883115i, 0.0033042794178019673 + 0.0010514123893751717i, 0.01055632403146854 + 0.0036539169515198305i, 0.013497468049597956 + 0.022865503440881747i, 0.01388210942846559 + -0.010170176337602813i, 0.1163973748826308 + 5.1403320224022256e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13155927795025668, 1.0e-7), DoubleNear(0.12260575421329309, 1.0e-7), DoubleNear(0.13039043385165078, 1.0e-7), DoubleNear(0.11723310366166075, 1.0e-7), DoubleNear(0.13062142105406171, 1.0e-7), DoubleNear(0.12173172500080683, 1.0e-7), DoubleNear(0.12946090938563887, 1.0e-7), DoubleNear(0.1163973748826308, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false, false}), Matrix({ { 0.1368548643325479 + -1.1970838013569455e-19i, 0.008815445543266603 + 0.0002954416895709731i, 0.006933789486724319 + -0.012919487347017826i, 0.01106008709382449 + -0.0038282871572472006i, 0.00040033859934226085 + 0.00010091109850775065i, 2.556978732905362e-05 + 7.364393006502365e-06i, 2.9809559576053922e-05 + -3.26804105693352e-05i, 3.517665566119828e-05 + -3.043556998974875e-06i }, { 0.008815445543266605 + -0.00029544168957097304i, 0.12754093911639017 + 9.501308968509553e-21i, -0.017523711349353835 + -0.0023950578450402924i, 0.014141586761608649 + -0.0239566783613703i, 2.6005480215601654e-05 + 5.635894530880066e-06i, 0.0003730927736743138 + 9.404339651143998e-05i, -4.9495720680311895e-05 + -1.9927468990772e-05i, 5.9032741043321595e-05 + -5.965253807486241e-05i }, { 0.006933789486724318 + 0.012919487347017826i, -0.01752371134935383 + 0.0023950578450402933i, 0.13563897136754477 + -1.0518088019137051e-19i, 0.014544583783818564 + 0.010655511873084481i, 1.0756971760445004e-05 + 4.290578790377369e-05i, -5.3027753236280646e-05 + -5.915046301912066e-06i, 0.0003967817737304459 + 0.00010001454948580185i, 3.469002665640476e-05 + 4.189491293182359e-05i }, { 0.01106008709382449 + 0.0038282871572472006i, 0.014141586761608649 + 0.0239566783613703i, 0.014544583783818564 + -0.010655511873084483i, 0.12195202608945913 + 2.048848260830894e-20i, 2.9531015452134054e-05 + 1.9354055623520877e-05i, 2.3703419841140626e-05 + 8.0507376691179e-05i, 5.0403891319081766e-05 + -2.0445767749863255e-05i, 0.00035674364626872573 + 8.992236394337954e-05i }, { 0.0004003385993422608 + -0.00010091109850775092i, 2.600548021560163e-05 + -5.635894530880022e-06i, 1.0756971760444983e-05 + -4.2905787903773695e-05i, 2.9531015452134044e-05 + -1.9354055623520897e-05i, 0.12532583467177047 + 1.376923773327058e-19i, 0.00807280819795218 + 0.0002705528701730951i, 0.006349668015822245 + -0.011831114247879228i, 0.010128354979095717 + -0.0035057817322399626i }, { 2.5569787329053616e-05 + -7.364393006502358e-06i, 0.00037309277367431374 + -9.404339651143998e-05i, -5.302775323628066e-05 + 5.915046301912066e-06i, 2.3703419841140586e-05 + -8.0507376691179e-05i, 0.008072808197952183 + -0.0002705528701730954i, 0.11679654009770973 + -7.190118202302379e-20i, -0.016047465774167845 + -0.0021932915938411373i, 0.012950260651132441 + -0.021938501976124666i }, { 2.9809559576053942e-05 + 3.2680410569335195e-05i, -4.949572068031189e-05 + 1.9927468990772014e-05i, 0.000396781773730446 + -0.00010001454948580212i, 5.040389131908176e-05 + 2.0445767749863282e-05i, 0.006349668015822245 + 0.011831114247879228i, -0.016047465774167845 + 0.002193291593841137i, 0.12421237186974488 + 7.770199443108099e-20i, 0.013319308097308483 + 0.009757862286168479i }, { 3.517665566119827e-05 + 3.0435569989748613e-06i, 5.9032741043321595e-05 + 5.965253807486235e-05i, 3.4690026656404794e-05 + -4.189491293182359e-05i, 0.00035674364626872573 + -8.992236394337965e-05i, 0.010128354979095717 + 0.0035057817322399617i, 0.01295026065113244 + 0.021938501976124666i, 0.013319308097308483 + -0.009757862286168479i, 0.11167845245483243 + -6.686163951340715e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1368548643325479, 1.0e-7), DoubleNear(0.12754093911639017, 1.0e-7), DoubleNear(0.13563897136754477, 1.0e-7), DoubleNear(0.12195202608945913, 1.0e-7), DoubleNear(0.12532583467177047, 1.0e-7), DoubleNear(0.11679654009770973, 1.0e-7), DoubleNear(0.12421237186974488, 1.0e-7), DoubleNear(0.11167845245483243, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true, false}), Matrix({ { 0.26218069900431834 + 1.7983997197011243e-20i, 0.016888253741218783 + 0.0005659945597440683i, 0.013283457502546564 + -0.024750601594897056i, 0.021188442072920206 + -0.007334068889487163i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.016888253741218787 + -0.0005659945597440685i, 0.2443374792140999 + -6.239987305451423e-20i, -0.03357117712352168 + -0.00458834943888143i, 0.02709184741274109 + -0.04589518033749497i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013283457502546562 + 0.024750601594897056i, -0.03357117712352167 + 0.00458834943888143i, 0.25985134323728964 + -2.7478885760289527e-20i, 0.027863891881127045 + 0.02041337415925296i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.021188442072920206 + 0.007334068889487163i, 0.02709184741274109 + 0.04589518033749497i, 0.027863891881127045 + -0.020413374159252963i, 0.23363047854429156 + 1.3802318656968224e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.26218069900431834, 1.0e-7), DoubleNear(0.2443374792140999, 1.0e-7), DoubleNear(0.25985134323728964, 1.0e-7), DoubleNear(0.23363047854429156, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, true}), Matrix({ { 0.0801762743235174 + 5.742246614116219e-20i, 0.005164519241665552 + 0.00017308419445060462i, 0.004062153075087411 + -0.0075688676957561575i, 0.0064795400675105655 + -0.0022427978925382763i, -0.021870933736303277 + -0.008404345554791161i, -0.0013906632563667302 + -0.000588577078158321i, -0.0019014909534262293 + 0.0016388696880954377i, -0.002002622862080262 + -6.740410074484086e-05i }, { 0.005164519241665552 + -0.00017308419445060452i, 0.0747197213043655 + -1.0668162877132125e-20i, -0.010266247350170246 + -0.0014031420493613657i, 0.008284833316654739 + -0.014034994119859642i, -0.0014269497860791456 + -0.0004941473237310759i, -0.020382464603540245 + -0.007832371395379014i, 0.002653402476802051 + 0.0014588993820542685i, -0.0037311783747961996 + 0.00296010043283128i }, { 0.004062153075087411 + 0.0075688676957561575i, -0.010266247350170246 + 0.0014031420493613655i, 0.07946394474440036 + -4.491564334945126e-20i, 0.008520928686460153 + 0.006242520111802392i, -0.0003147028391031841 + -0.002490486664003689i, 0.002947566573220579 + 0.0006933854680408867i, -0.0216766204789871 + -0.008329676782984154i, -0.0016700248502534898 + -0.0025960619222794423i }, { 0.0064795400675105655 + 0.0022427978925382763i, 0.008284833316654739 + 0.014034994119859642i, 0.008520928686460153 + -0.006242520111802393i, 0.07144546264938154 + 2.2627357815869242e-20i, -0.001532427691314634 + -0.0012910100740954197i, -0.0007887882116712523 + -0.004696988374918892i, -0.0029787485741976432 + 0.0008096773656765591i, -0.01948929396568152 + -0.007489152638902331i }, { -0.021870933736303277 + 0.008404345554791161i, -0.0014269497860791456 + 0.0004941473237310759i, -0.00031470283910318416 + 0.002490486664003689i, -0.0015324276913146343 + 0.0012910100740954199i, 0.18200442468080094 + -3.9438468944150945e-20i, 0.011723734499553232 + 0.0003929103652934636i, 0.009221304427459153 + -0.0171817338991409i, 0.01470890200540964 + -0.0050912709969488865i }, { -0.0013906632563667302 + 0.0005885770781583212i, -0.020382464603540245 + 0.007832371395379014i, 0.002947566573220579 + -0.0006933854680408867i, -0.0007887882116712523 + 0.004696988374918892i, 0.011723734499553235 + -0.00039291036529346394i, 0.1696177579097344 + -5.1731710177382106e-20i, -0.023304929773351434 + -0.0031852073895200644i, 0.01880701409608635 + -0.031860186217635325i }, { -0.0019014909534262293 + -0.001638869688095438i, 0.002653402476802051 + -0.0014588993820542683i, -0.0216766204789871 + 0.008329676782984154i, -0.0029787485741976432 + -0.0008096773656765592i, 0.009221304427459151 + 0.0171817338991409i, -0.02330492977335143 + 0.0031852073895200644i, 0.1803873984928893 + 1.7436757589161733e-20i, 0.01934296319466689 + 0.014170854047450568i }, { -0.002002622862080262 + 6.740410074484088e-05i, -0.0037311783747961996 + -0.0029601004328312806i, -0.00167002485025349 + 0.0025960619222794423i, -0.01948929396568152 + 0.007489152638902331i, 0.01470890200540964 + 0.0050912709969488865i, 0.01880701409608635 + 0.031860186217635325i, 0.01934296319466689 + -0.014170854047450568i, 0.16218501589491002 + -8.825039158901018e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.0801762743235174, 1.0e-7), DoubleNear(0.0747197213043655, 1.0e-7), DoubleNear(0.07946394474440036, 1.0e-7), DoubleNear(0.07144546264938154, 1.0e-7), DoubleNear(0.18200442468080094, 1.0e-7), DoubleNear(0.1696177579097344, 1.0e-7), DoubleNear(0.1803873984928893, 1.0e-7), DoubleNear(0.16218501589491002, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false, false}), Matrix({ { 0.10090800451714747 + -5.2922737880043695e-20i, 0.00865052208906686 + 0.004055280255160403i, -0.0038286854802950772 + -0.028544535249034254i, 0.000818923754009169 + -0.0026008989730916692i, 0.0028441475317395417 + -0.0009049997212617657i, 0.0002801897498986995 + 3.671755542666296e-05i, -0.0003639170448194785 + -0.0007702056001664369i, -2.445085714257694e-07 + -8.065233479423852e-05i }, { 0.00865052208906686 + -0.004055280255160403i, 0.0923904836060106 + -7.704932856248286e-21i, -0.0014753657969940534 + -0.0022931653556099853i, -0.003505510834273435 + -0.026135126034713522i, 0.00020744968298091923 + -0.00019188304733853403i, 0.002604076526551512 + -0.0008286098046510339i, -6.2150391612412e-05 + -5.1402215075104285e-05i, -0.0003331992533617918 + -0.000705193490010423i }, { -0.0038286854802950772 + 0.028544535249034254i, -0.0014753657969940538 + 0.0022931653556099853i, 0.16104170728475997 + -1.274280877468836e-19i, 0.013805593052740674 + 0.006471927167068608i, 0.00014808983843095326 + 0.0008388812083909005i, -2.1017599074006174e-05 + 7.786603509469183e-05i, 0.004539048973099441 + -0.0014443125785869662i, 0.0004471621047635406 + 5.859850109539856e-05i }, { 0.000818923754009169 + 0.0026008989730916692i, -0.003505510834273435 + 0.026135126034713522i, 0.013805593052740674 + -0.006471927167068608i, 0.14744837426894322 + -9.302544238231274e-20i, 4.6408140184064816e-05 + 6.596319744266216e-05i, 0.00013558975678135403 + 0.0007680722743660972i, 0.00033107434125557723 + -0.00030623114281433313i, 0.004155913415815886 + -0.001322399925084419i }, { 0.0028441475317395417 + 0.0009049997212617652i, 0.00020744968298091912 + 0.00019188304733853398i, 0.00014808983843095412 + -0.0008388812083909005i, 4.640814018406483e-05 + -6.596319744266215e-05i, 0.1001886537469687 + 1.3246851132788042e-19i, 0.008588854436862308 + 0.00402637106219004i, -0.00380139163118765 + -0.028341047591994132i, 0.0008130858283066141 + -0.002582357741517392i }, { 0.00028018974989869953 + -3.67175554266628e-05i, 0.002604076526551512 + 0.0008286098046510352i, -2.1017599074006106e-05 + -7.786603509469187e-05i, 0.0001355897567813548 + -0.0007680722743660972i, 0.00858885443686231 + -0.00402637106219004i, 0.09173185235215522 + 4.740977072795107e-20i, -0.001464848241648058 + -0.002276817888700906i, -0.003480520825496914 + -0.025948814521253798i }, { -0.0003639170448194785 + 0.0007702056001664369i, -6.215039161241202e-05 + 5.140221507510424e-05i, 0.004539048973099441 + 0.001444312578586967i, 0.0003310743412555772 + 0.0003062311428143331i, -0.00380139163118765 + 0.028341047591994135i, -0.0014648482416480583 + 0.002276817888700906i, 0.15989367669273186 + 3.8387425735768585e-20i, 0.013707176043675988 + 0.006425790234577977i }, { -2.4450857142581004e-07 + 8.065233479423858e-05i, -0.0003331992533617919 + 0.0007051934900104229i, 0.0004471621047635403 + -5.8598501095398774e-05i, 0.004155913415815886 + 0.0013223999250844215i, 0.0008130858283066141 + 0.0025823577415173917i, -0.0034805208254969147 + 0.025948814521253798i, 0.013707176043675988 + -0.006425790234577979i, 0.14639724753128242 + 4.7230501130639526e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.10090800451714747, 1.0e-7), DoubleNear(0.0923904836060106, 1.0e-7), DoubleNear(0.16104170728475997, 1.0e-7), DoubleNear(0.14744837426894322, 1.0e-7), DoubleNear(0.1001886537469687, 1.0e-7), DoubleNear(0.09173185235215522, 1.0e-7), DoubleNear(0.15989367669273186, 1.0e-7), DoubleNear(0.14639724753128242, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false, false}), Matrix({ { 0.10496980132016151 + -8.005402702649043e-21i, 0.008998727002382764 + 0.004218515317181051i, -0.003982799542088521 + -0.02969352340485837i, 0.0008518874609208585 + -0.0027055915907330287i, 0.00030706590838915846 + 7.74003760335367e-05i, 2.3213224935500093e-05 + 1.8975620289649608e-05i, 1.024397402347745e-05 + -8.97985782697766e-05i, 4.4869990952192394e-06 + -7.28646258357803e-06i }, { 0.008998727002382764 + -0.004218515317181052i, 0.09610942912213212 + 9.700274337665719e-21i, -0.0015347529200095363 + -0.002385470933891601i, -0.0036466163171111547 + -0.027187129509384643i, 2.9434341251747424e-05 + -5.705044465976217e-06i, 0.00028114685163724886 + 7.086710521374279e-05i, -2.7306325117365507e-06 + -8.109830081341292e-06i, 9.379292739018159e-06 + -8.22187904039566e-05i }, { -0.003982799542088522 + 0.02969352340485837i, -0.0015347529200095368 + 0.002385470933891601i, 0.16752403437993116 + -2.16883857624416e-19i, 0.014361302324702403 + 0.006732438245474402i, -3.354557017670253e-05 + 8.392507601776e-05i, -6.248527086713116e-06 + 5.8465038363960165e-06i, 0.0004900544646835483 + 0.0001235252719600159i, 3.704658904995829e-05 + 3.028368564867631e-05i }, { 0.0008518874609208587 + 0.0027055915907330283i, -0.003646616317111155 + 0.027187129509384643i, 0.014361302324702407 + -0.006732438245474404i, 0.1533835360837172 + 2.0289517239152776e-20i, 4.970171407485158e-07 + 8.542755517055548e-06i, -3.0714029737236996e-05 + 7.68410632739687e-05i, 4.6975030282936e-05 + -9.104828753006975e-06i, 0.00044868956830579066 + 0.00011309865524107674i }, { 0.0003070659083891585 + -7.740037603353676e-05i, 2.9434341251747403e-05 + 5.705044465976257e-06i, -3.3545570176702515e-05 + -8.392507601776e-05i, 4.970171407485192e-07 + -8.542755517055544e-06i, 0.09612685694395465 + 8.755117615048578e-20i, 0.008240649523546405 + 0.0038631360001693915i, -0.0036472775693942062 + -0.027192059436170018i, 0.0007801221213949244 + -0.0024776651238760327i }, { 2.3213224935500127e-05 + -1.8975620289649608e-05i, 0.00028114685163724886 + -7.086710521374279e-05i, -6.248527086713116e-06 + -5.846503836396013e-06i, -3.071402973723694e-05 + -7.684106327396871e-05i, 0.008240649523546405 + -0.0038631360001693915i, 0.08801290683603372 + 3.000456353403707e-20i, -0.0014054611186325753 + -0.0021845123104192897i, -0.0033394153426591945 + -0.02489681104658268i }, { 1.0243974023477437e-05 + 8.979857826977658e-05i, -2.7306325117365558e-06 + 8.1098300813413e-06i, 0.0004900544646835483 + -0.00012352527196001623i, 4.697503028293599e-05 + 9.104828753006989e-06i, -0.0036472775693942054 + 0.027192059436170018i, -0.0014054611186325755 + 0.0021845123104192897i, 0.15341134959756067 + 1.2784319561330098e-19i, 0.013151466771714259 + 0.006165279156172182i }, { 4.486999095219243e-06 + 7.2864625835780305e-06i, 9.379292739018132e-06 + 8.221879040395659e-05i, 3.7046589049958276e-05 + -3.028368564867634e-05i, 0.0004486895683057906 + -0.00011309865524107684i, 0.0007801221213949243 + 0.0024776651238760327i, -0.0033394153426591945 + 0.024896811046582677i, 0.013151466771714259 + -0.006165279156172182i, 0.14046208571650845 + -1.0859190950840157e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10496980132016151, 1.0e-7), DoubleNear(0.09610942912213212, 1.0e-7), DoubleNear(0.16752403437993116, 1.0e-7), DoubleNear(0.1533835360837172, 1.0e-7), DoubleNear(0.09612685694395465, 1.0e-7), DoubleNear(0.08801290683603372, 1.0e-7), DoubleNear(0.15341134959756067, 1.0e-7), DoubleNear(0.14046208571650845, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true, false}), Matrix({ { 0.20109665826411616 + 7.954577344783673e-20i, 0.01723937652592917 + 0.008081651317350443i, -0.007630077111482727 + -0.05688558284102839i, 0.001632009582315783 + -0.005183256714609062i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01723937652592917 + -0.008081651317350443i, 0.1841223359581658 + 3.970483787170278e-20i, -0.0029402140386421117 + -0.004569983244310891i, -0.00698603165977035 + -0.05208394055596732i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007630077111482727 + 0.05688558284102839i, -0.002940214038642112 + 0.004569983244310891i, 0.32093538397749183 + -8.904066201111503e-20i, 0.027512769096416662 + 0.012897717401646584i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001632009582315783 + 0.005183256714609061i, -0.00698603165977035 + 0.052083940555967316i, 0.027512769096416666 + -0.012897717401646587i, 0.2938456218002256 + -8.830239226924878e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.20109665826411616, 1.0e-7), DoubleNear(0.1841223359581658, 1.0e-7), DoubleNear(0.32093538397749183, 1.0e-7), DoubleNear(0.2938456218002256, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, true}), Matrix({ { 0.06149644462676807 + 6.16046141874075e-20i, 0.005271894486354 + 0.002471412638182922i, -0.0023333188061633566 + -0.017395918586822996i, 0.0004990773480552972 + -0.0015850679085757748i, -0.016775345035654463 + -0.00644626325425101i, -0.0011790351940603422 + -0.0012267834327096892i, -0.0011870026495293322 + 0.004989942518614529i, -0.00030229324378794635 + 0.00038006875427283186i }, { 0.005271894486354 + -0.0024714126381829224i, 0.05630560515297729 + 2.088795183053155e-20i, -0.0008991333390569083 + -0.0013975255678287482i, -0.0021363662272381825 + -0.015927550432674027i, -0.0016971586911925826 + 0.0001215481654051535i, -0.015359358733909268 + -0.0059021420784383825i, 9.877732473537033e-05 + 0.0004754750291366143i, -0.0010868092115823664 + 0.004568747590114602i }, { -0.0023333188061633566 + 0.017395918586822996i, -0.0008991333390569083 + 0.0013975255678287477i, 0.09814377444114969 + -4.9097791395696577e-20i, 0.008413553441771707 + 0.003944191668070075i, 0.0024599942277947814 + -0.004500769937275523i, 0.00039176394435042994 + -0.00028697469421768573i, -0.026772209179635915 + -0.010287759083524306i, -0.0018816529125598779 + -0.0019578555677280743i }, { 0.0004990773480552972 + 0.001585067908575775i, -0.0021363662272381825 + 0.015927550432674027i, 0.008413553441771707 + -0.0039441916680700755i, 0.08985957880076974 + -8.928756891794428e-21i, 3.0011008158903475e-05 + -0.00048469867196396075i, 0.0022523491318801416 + -0.0041208654664617525i, -0.0027085396690842067 + 0.00019398187654032985i, -0.024512399835312493 + -0.009419381955842961i }, { -0.016775345035654463 + 0.006446263254251011i, -0.0016971586911925824 + -0.00012154816540515356i, 0.002459994227794782 + 0.004500769937275523i, 3.0011008158903452e-05 + 0.0004846986719639607i, 0.1396002136373481 + 1.794115926042923e-20i, 0.01196748203957517 + 0.005610238679167521i, -0.005296758305319371 + -0.039489664254205394i, 0.001132932234260486 + -0.0035981888060332866i }, { -0.0011790351940603422 + 0.0012267834327096896i, -0.015359358733909268 + 0.0059021420784383825i, 0.00039176394435042994 + 0.0002869746942176857i, 0.002252349131880141 + 0.0041208654664617525i, 0.01196748203957517 + -0.005610238679167522i, 0.12781673080518852 + 1.8816886041171234e-20i, -0.0020410806995852034 + -0.003172457676482143i, -0.004849665432532167 + -0.036156390123293296i }, { -0.001187002649529332 + -0.004989942518614529i, 9.877732473537036e-05 + -0.00047547502913661423i, -0.026772209179635915 + 0.010287759083524306i, -0.0027085396690842063 + -0.0001939818765403297i, -0.005296758305319371 + 0.039489664254205394i, -0.002041080699585204 + 0.003172457676482143i, 0.22279160953634214 + -3.9942870615418453e-20i, 0.019099215654644956 + 0.008953525733576509i }, { -0.00030229324378794624 + -0.0003800687542728318i, -0.0010868092115823664 + -0.004568747590114602i, -0.0018816529125598779 + 0.0019578555677280743i, -0.024512399835312497 + 0.009419381955842961i, 0.001132932234260486 + 0.0035981888060332857i, -0.004849665432532168 + 0.03615639012329329i, 0.01909921565464496 + -0.00895352573357651i, 0.20398604299945589 + -7.937363537745436e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.06149644462676807, 1.0e-7), DoubleNear(0.05630560515297729, 1.0e-7), DoubleNear(0.09814377444114969, 1.0e-7), DoubleNear(0.08985957880076974, 1.0e-7), DoubleNear(0.1396002136373481, 1.0e-7), DoubleNear(0.12781673080518852, 1.0e-7), DoubleNear(0.22279160953634214, 1.0e-7), DoubleNear(0.20398604299945589, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false, false}), Matrix({ { 0.1469180566165279 + -2.5168082401394314e-19i, 0.01259481742925638 + 0.0059043273819006075i, 0.0038688260277294747 + -0.02812499258784893i, 0.0014619463821088485 + -0.0022555861343631i, 0.0009870008914431097 + -0.0027181788093323315i, 0.00019385032894505487 + -0.00019335533091383532i, 0.014788662136211186 + 0.002953685565053595i, 0.0011490825359193738 + 0.0008475352594187553i }, { 0.01259481742925638 + -0.0059043273819006075i, 0.1345168836328503 + -3.345362159624516e-20i, -0.0007986220963542241 + -0.0025665460800279837i, 0.0035422631673259013 + -0.025750996455045957i, -2.4625438328841887e-05 + -0.00027268630660892587i, 0.0009036893566208266 + -0.002488740669518924i, 0.0013864873445711729 + -0.00034111513255335617i, 0.013540369301607449 + 0.0027043685888072555i }, { 0.0038688260277294747 + 0.02812499258784893i, -0.0007986220963542238 + 0.0025665460800279837i, 0.12557577908356474 + 2.679156368687806e-20i, 0.01076521189782879 + 0.005046626180754848i, 0.012617688665856708 + 0.0025470325683235066i, 0.0009793144171887423 + 0.0007254273390554053i, -0.0001898805183704028 + 0.0029191044573258842i, -0.00013359051495959648 + 0.0002426146368521612i }, { 0.001461946382108848 + 0.0022555861343631i, 0.0035422631673259013 + 0.02575099645504596i, 0.01076521189782879 + -0.005046626180754849i, 0.11497608157299899 + 6.344341317306365e-20i, 0.0011840341702548645 + -0.00028872934667540425i, 0.011552645039477335 + 0.0023320406728257062i, 0.00010103480986352532 + 0.0002578764333899426i, -0.0001738529366777871 + 0.0026727064299737436i }, { 0.0009870008914431097 + 0.0027181788093323315i, -2.4625438328841894e-05 + 0.00027268630660892587i, 0.012617688665856712 + -0.0025470325683235066i, 0.0011840341702548647 + 0.0002887293466754042i, 0.11503165518537953 + 7.132999838701581e-20i, 0.009861297712551155 + 0.004622880040328403i, 0.003514370477109508 + 0.025775680288000195i, -0.0007345945274466082 + 0.0023509021908851616i }, { 0.00019385032894505487 + 0.00019335533091383527i, 0.0009036893566208266 + 0.002488740669518924i, 0.0009793144171887423 + -0.0007254273390554053i, 0.011552645039477335 + -0.0023320406728257067i, 0.009861297712551158 + -0.004622880040328403i, 0.10532197424210352 + -6.727675364231586e-20i, 0.0013371461205907206 + 0.0020684318898751162i, 0.003217726775041496 + 0.023599986725310503i }, { 0.014788662136211186 + -0.002953685565053595i, 0.0013864873445711729 + 0.0003411151325533562i, -0.00018988051837040277 + -0.0029191044573258842i, 0.00010103480986352529 + -0.0002578764333899426i, 0.0035143704771095083 + -0.025775680288000195i, 0.0013371461205907201 + -0.0020684318898751162i, 0.13450655135613582 + 1.4406437337677095e-19i, 0.011530818582709507 + 0.00540553511601317i }, { 0.0011490825359193738 + -0.0008475352594187555i, 0.013540369301607449 + -0.0027043685888072555i, -0.00013359051495959645 + -0.00024261463685216122i, -0.0001738529366777871 + -0.0026727064299737436i, -0.0007345945274466082 + -0.0023509021908851616i, 0.003217726775041496 + -0.023599986725310503i, 0.011530818582709507 + -0.005405535116013171i, 0.12315301831043864 + -1.1310592332048631e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.1469180566165279, 1.0e-7), DoubleNear(0.1345168836328503, 1.0e-7), DoubleNear(0.12557577908356474, 1.0e-7), DoubleNear(0.11497608157299899, 1.0e-7), DoubleNear(0.11503165518537953, 1.0e-7), DoubleNear(0.10532197424210352, 1.0e-7), DoubleNear(0.13450655135613582, 1.0e-7), DoubleNear(0.12315301831043864, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true, false}), Matrix({ { 0.2619497118019074 + -1.803508256269273e-19i, 0.022456115141807537 + 0.01052720742222901i, 0.007383196504838982 + -0.0023493122998487336i, 0.0007273518546622403 + 9.531605652206147e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.022456115141807537 + -0.010527207422229012i, 0.23983885787495385 + -1.0073037523856102e-19i, 0.0005385240242364964 + -0.000498114190152867i, 0.006759989942367398 + -0.0021510097297354532i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007383196504838983 + 0.0023493122998487336i, 0.0005385240242364962 + 0.0004981141901528672i, 0.2600823304397005 + 1.7085593706364901e-19i, 0.022296030480538298 + 0.010452161296768018i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00072735185466224 + -9.531605652206168e-05i, 0.006759989942367398 + 0.0021510097297354584i, 0.022296030480538298 + -0.01045216129676802i, 0.2381290998834376 + 5.2132820841015026e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2619497118019074, 1.0e-7), DoubleNear(0.23983885787495385, 1.0e-7), DoubleNear(0.2600823304397005, 1.0e-7), DoubleNear(0.2381290998834376, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, true}), Matrix({ { 0.08010779898985199 + -1.1004666031520709e-20i, 0.006867386665549257 + 0.0032193637866726557i, 0.00187031738329783 + -0.0007797823657268114i, 0.0001916741685794717 + 8.315857399040605e-06i, -0.021632765241694614 + -0.0085167379066475i, -0.0015122383524464825 + -0.0015994881269303521i, 0.0015308424742997459 + -0.004979356966941668i, 0.0003313441266650353 + -0.0003653430899609604i }, { 0.006867386665549256 + -0.003219363786672656i, 0.07334599791860728 + 1.2468775940176069e-20i, 0.0001289985454475754 + -0.00014201237853554444i, 0.0017124461866674873 + -0.0007139618925344673i, -0.00219677788400237 + 0.00013926245423403629i, -0.019806770057333025 + -0.007797850504586i, -6.887561978733972e-05 + -0.000488385762135371i, 0.0014016259384174135 + -0.004559055551876685i }, { 0.00187031738329783 + 0.0007797823657268114i, 0.0001289985454475754 + 0.00014201237853554444i, 0.07953242007806577 + 2.3511488823231644e-20i, 0.00681806126257645 + 0.003196240519580341i, 0.0015954429025096509 + -0.005254860061516922i, 0.00034795400512690447 + -0.0003863649382710665i, -0.02191478897359576 + -0.008217284431127816i, -0.0015484497541737375 + -0.0015851508735074116i }, { 0.00019167416857947164 + -8.315857399040605e-06i, 0.0017124461866674873 + 0.000713961892534469i, 0.006818061262576451 + -0.003196240519580342i, 0.07281918603513975 + -5.095810014389486e-22i, -7.440952000809739e-05 + -0.0005145999208523292i, 0.0014607735237058947 + -0.004811303768106496i, -0.002208920476274419 + 0.00017626758771144708i, -0.02006498851188874 + -0.007523673529695345i }, { -0.021632765241694614 + 0.0085167379066475i, -0.00219677788400237 + -0.0001392624542340362i, 0.001595442902509651 + 0.005254860061516922i, -7.440952000809741e-05 + 0.0005145999208523292i, 0.18184191281205545 + -1.693461595954066e-19i, 0.015588728476258279 + 0.0073078436355563554i, 0.005512879121541152 + -0.0015695299341219222i, 0.0005356776860827685 + 8.700019912302086e-05i }, { -0.001512238352446483 + 0.0015994881269303517i, -0.01980677005733303 + 0.007797850504586i, 0.0003479540051269046 + 0.0003863649382710665i, 0.0014607735237058947 + 0.004811303768106496i, 0.01558872847625828 + -0.0073078436355563554i, 0.16649285995634655 + -1.131991511787371e-19i, 0.00040952547878892094 + -0.00035610181161732255i, 0.0050475437556999105 + -0.001437047837200986i }, { 0.0015308424742997463 + 0.004979356966941668i, -6.887561978733972e-05 + 0.000488385762135371i, -0.02191478897359576 + 0.008217284431127816i, -0.002208920476274419 + -0.00017626758771144705i, 0.005512879121541153 + 0.0015695299341219222i, 0.00040952547878892083 + 0.00035610181161732277i, 0.18054991036163479 + 1.4734444824041737e-19i, 0.015477969217961846 + 0.007255920777187677i }, { 0.0003313441266650352 + 0.00036534308996096035i, 0.0014016259384174135 + 0.004559055551876686i, -0.0015484497541737373 + 0.001585150873507412i, -0.02006498851188874 + 0.007523673529695345i, 0.0005356776860827683 + -8.700019912302108e-05i, 0.0050475437556999105 + 0.0014370478372009894i, 0.015477969217961846 + -0.007255920777187678i, 0.16530991384829788 + 5.264240184245397e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.08010779898985199, 1.0e-7), DoubleNear(0.07334599791860728, 1.0e-7), DoubleNear(0.07953242007806577, 1.0e-7), DoubleNear(0.07281918603513975, 1.0e-7), DoubleNear(0.18184191281205545, 1.0e-7), DoubleNear(0.16649285995634655, 1.0e-7), DoubleNear(0.18054991036163479, 1.0e-7), DoubleNear(0.16530991384829788, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true, false}), Matrix({ { 0.27249383570009267 + -2.2488926032706507e-19i, 0.023360029327085172 + 0.010950953562655455i, 0.0007971203730727067 + 0.0002009256479935526i, 6.025981398545839e-05 + 4.9259305938325885e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.023360029327085172 + -0.010950953562655456i, 0.2494929652058493 + 2.998979157681849e-20i, 7.640937153468342e-05 + -1.480987321898322e-05i, 0.0007298364199430395 + 0.00018396576045481947i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0007971203730727069 + -0.00020092564799355282i, 7.640937153468338e-05 + 1.480987321898322e-05i, 0.24953820654151532 + 2.1539437176378676e-19i, 0.021392116295260662 + 0.010028415156341574i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 6.0259813985458416e-05 + -4.925930593832594e-05i, 0.0007298364199430395 + -0.00018396576045481958i, 0.021392116295260666 + -0.010028415156341574i, 0.22847499255254217 + -7.858734597436449e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.27249383570009267, 1.0e-7), DoubleNear(0.2494929652058493, 1.0e-7), DoubleNear(0.24953820654151532, 1.0e-7), DoubleNear(0.22847499255254217, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, true}), Matrix({ { 0.08333376481720713 + -6.174404376948025e-20i, 0.0071439384493412784 + 0.0033490085614959683i, 0.00020228329039901775 + 5.959863006487398e-05i, 1.494595925591663e-05 + 1.3238540448308269e-05i, -0.022728699937329025 + -0.008721553787062967i, -0.0015979582270823764 + -0.0016610896486294632i, 0.00025928065154492367 + -0.0004864420626974502i, 4.177638747060069e-05 + -3.1281186430793926e-05i }, { 0.0071439384493412784 + -0.0033490085614959696i, 0.07629966392669049 + 4.271288863815388e-20i, 1.973624618891454e-05 + -3.020138680850747e-06i, 0.0001852088059298058 + 5.456798279083715e-05i, -0.0022989599966889824 + 0.00016574754872395432i, -0.020810198249326086 + -0.00798537812771485i, 2.6782227298392095e-06 + -5.2121073450392617e-05i, 0.00023739508972101705 + -0.00044538208474121174i }, { 0.0002022832903990178 + -5.959863006487376e-05i, 1.9736246188914532e-05 + 3.020138680850747e-06i, 0.07630645425071063 + 7.425086656119118e-20i, 0.00654150947878443 + 0.003066595744757028i, 6.454083192030084e-05 + -0.0005744543544097903i, 2.861899119818101e-05 + -4.665238345729591e-05i, -0.020818854277961353 + -0.008012468550712349i, -0.0014627298795378439 + -0.0015235493518083005i }, { 1.494595925591663e-05 + -1.3238540448308269e-05i, 0.0001852088059298058 + -5.456798279083704e-05i, 0.00654150947878443 + -0.003066595744757028i, 0.06986552002705654 + -3.075369369941676e-20i, -1.7553230957556312e-05 + -5.183990376533146e-05i, 5.90930194485963e-05 + -0.0005259653668454039i, -0.0021067383635878065 + 0.00014978249322152905i, -0.019061560319895678 + -0.007336145906566494i }, { -0.022728699937329025 + 0.008721553787062967i, -0.002298959996688982 + -0.0001657475487239543i, 6.454083192030085e-05 + 0.0005744543544097904i, -1.755323095755631e-05 + 5.183990376533146e-05i, 0.18916007088288553 + -1.631452165575848e-19i, 0.016216090877743894 + 0.007601945001159486i, 0.000594837082673689 + 0.00014132701792867863i, 4.531385472954176e-05 + 3.6020765490017616e-05i }, { -0.0015979582270823761 + 0.0016610896486294632i, -0.02081019824932609 + 0.00798537812771485i, 2.861899119818101e-05 + 4.665238345729592e-05i, 5.909301944859632e-05 + 0.000525965366845404i, 0.016216090877743894 + -0.007601945001159487i, 0.1731933012791588 + -1.2723097061335389e-20i, 5.6673125345768884e-05 + -1.1789734538132472e-05i, 0.0005446276140132337 + 0.00012939777766398232i }, { 0.00025928065154492367 + 0.0004864420626974502i, 2.6782227298392112e-06 + 5.212107345039263e-05i, -0.020818854277961353 + 0.008012468550712349i, -0.002106738363587807 + -0.00014978249322152896i, 0.000594837082673689 + -0.00014132701792867906i, 5.667312534576886e-05 + 1.1789734538132472e-05i, 0.1732317522908047 + 1.4114350520259558e-19i, 0.014850606816476233 + 0.006961819411584545i }, { 4.1776387470600704e-05 + 3.1281186430793926e-05i, 0.00023739508972101705 + 0.00044538208474121174i, -0.0014627298795378439 + 0.0015235493518083007i, -0.019061560319895678 + 0.007336145906566494i, 4.531385472954179e-05 + -3.602076549001767e-05i, 0.0005446276140132337 + -0.00012939777766398253i, 0.014850606816476234 + -0.006961819411584545i, 0.15860947252548563 + -4.7833652274947735e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.08333376481720713, 1.0e-7), DoubleNear(0.07629966392669049, 1.0e-7), DoubleNear(0.07630645425071063, 1.0e-7), DoubleNear(0.06986552002705654, 1.0e-7), DoubleNear(0.18916007088288553, 1.0e-7), DoubleNear(0.1731933012791588, 1.0e-7), DoubleNear(0.1732317522908047, 1.0e-7), DoubleNear(0.15860947252548563, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, true}), Matrix({ { 0.15964021906791775 + 1.2506822791710929e-20i, 0.013685447928125708 + 0.006415604306252996i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04354755421529038 + -0.016734022337775316i, -0.0030606881066202202 + -0.003184639000437764i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013685447928125708 + -0.006415604306252997i, 0.14616518395374703 + 1.1959194938737117e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004405698360276789 + 0.0003155300419454834i, -0.03987175856922176 + -0.015321524034281345i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04354755421529038 + 0.016734022337775316i, -0.004405698360276789 + -0.0003155300419454833i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36239182317369023 + -2.200171135498923e-20i, 0.031066697694220127 + 0.014563764412744032i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0030606881066202202 + 0.003184639000437764i, -0.03987175856922177 + 0.015321524034281345i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03106669769422013 + -0.014563764412744033i, 0.3318027738046444 + -6.055674933628312e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.15964021906791775, 1.0e-7), DoubleNear(0.14616518395374703, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36239182317369023, 1.0e-7), DoubleNear(0.3318027738046444, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false, false}), Matrix({ { 0.10151666584540715 + 2.0528857513133823e-20i, -0.0006432599095888888 + -0.004744761741975417i, 0.008092041932055264 + -0.0141588684201687i, -0.0007130429545579744 + -0.0002884942911584302i, -0.003851779513331168 + -0.028716711428935622i, -0.0013177763206445232 + 0.0003619906639448434i, -0.0043122466274040545 + -0.0017518305220124218i, -5.455383130917711e-05 + 0.0002126494697505937i }, { -0.0006432599095888891 + 0.004744761741975416i, 0.09360375732319459 + -2.2844284181735157e-20i, 0.0006104925778635675 + 0.000467929506923069i, 0.007461292418829811 + -0.01305522864187403i, 0.0013665898887590406 + 1.9359690593877482e-06i, -0.003551545274126188 + -0.026478333043439974i, 0.00010920289513664948 + -0.00019044853685311623i, -0.0039761204080911525 + -0.0016152807786607862i }, { 0.008092041932055264 + 0.014158868420168698i, 0.0006104925778635673 + -0.000467929506923069i, 0.09890391175848603 + 1.579776417791701e-19i, -0.0006267042047326016 + -0.004622644890229205i, 0.003698184668703164 + -0.002826271626999221i, -0.00015552992498683263 + -0.00015493985907218659i, -0.003752645518123914 + -0.027977623866080242i, -0.0012838604563010767 + 0.000352674040129701i }, { -0.0007130429545579742 + 0.0002884942911584302i, 0.007461292418829811 + 0.01305522864187403i, -0.0006267042047326018 + 0.004622644890229205i, 0.09119465929519417 + -3.6411603791029245e-20i, 0.00010866286299613111 + 0.00019075717470439445i, 0.0034099226701633355 + -0.0026059725395821227i, 0.0013314177001605928 + 1.8861426488181747e-06i, -0.0034601384656718064 + -0.025796855058539864i }, { -0.003851779513331168 + 0.028716711428935622i, 0.0013665898887590404 + -1.9359690593877754e-06i, 0.003698184668703164 + 0.002826271626999221i, 0.00010866286299613117 + -0.00019075717470439445i, 0.16201308571930723 + -1.1766421891152028e-19i, -0.0010265952098025232 + -0.007572288593391888i, 0.012914300053734588 + -0.022596506139577532i, -0.0011379637851214519 + -0.00046041553801775225i }, { -0.0013177763206445232 + -0.0003619906639448434i, -0.0035515452741261876 + 0.026478333043439974i, -0.00015552992498683266 + 0.00015493985907218656i, 0.0034099226701633355 + 0.0026059725395821227i, -0.0010265952098025232 + 0.007572288593391886i, 0.14938466933050926 + 7.55637697226186e-20i, 0.0009743009733892457 + 0.0007467808628700169i, 0.011907670510667993 + -0.020835178730771765i }, { -0.0043122466274040545 + 0.0017518305220124222i, 0.00010920289513664948 + 0.00019044853685311618i, -0.003752645518123914 + 0.027977623866080246i, 0.001331417700160593 + -1.8861426488181476e-06i, 0.012914300053734588 + 0.02259650613957753i, 0.0009743009733892456 + -0.0007467808628700169i, 0.15784332355934388 + -1.3998334287906612e-19i, -0.0010001735300941908 + -0.0073773991355381464i }, { -5.45538313091771e-05 + -0.0002126494697505937i, -0.0039761204080911525 + 0.0016152807786607862i, -0.0012838604563010763 + -0.00035267404012970097i, -0.003460138465671807 + 0.025796855058539864i, -0.0011379637851214519 + 0.0004604155380177522i, 0.011907670510667991 + 0.020835178730771765i, -0.001000173530094191 + 0.007377399135538145i, 0.14553992716855713 + 4.7407377876039706e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.10151666584540715, 1.0e-7), DoubleNear(0.09360375732319459, 1.0e-7), DoubleNear(0.09890391175848603, 1.0e-7), DoubleNear(0.09119465929519417, 1.0e-7), DoubleNear(0.16201308571930723, 1.0e-7), DoubleNear(0.14938466933050926, 1.0e-7), DoubleNear(0.15784332355934388, 1.0e-7), DoubleNear(0.14553992716855713, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false, false}), Matrix({ { 0.13254195682784906 + -1.695227204159858e-19i, -0.00021055874886045196 + -0.004808560998584248i, 0.010565113259737113 + -0.018486069368501612i, -0.000687450007474872 + -0.0003539300992043397i, 0.0037375193099625902 + -0.0020569978313652636i, 0.0035407149112078144 + -0.001813781838918371i, 1.1026774115247841e-05 + -0.0006852506064283999i, 2.926135434090916e-05 + -0.0006384145371356347i }, { -0.00021055874886045196 + 0.0048085609985842465i, 0.12162307533570069 + -1.1960382830796411e-20i, 0.0006538821157252642 + 0.0004126647630155109i, 0.009694753243972235 + -0.01696317650105685i, -0.0036423764394011085 + -0.001478587901009264i, 0.0034262617234798124 + -0.00022249708445593475i, -0.0004965627466013566 + 0.0003901540019775801i, 0.00024207992243692933 + -0.0004956077333115527i }, { 0.010565113259737115 + 0.018486069368501612i, 0.0006538821157252642 + -0.0004126647630155109i, 0.12913069881906217 + -8.194981136499925e-20i, -0.00020513955756766545 + -0.004684802133016375i, 0.0005848194886873607 + 0.000357317994242289i, 0.0005352097754453775 + 0.00034925613001303126i, 0.0036413260517351963 + -0.002004056479854845i, 0.003449586845901094 + -0.0017671001845027904i }, { -0.000687450007474872 + 0.00035393009920433975i, 0.009694753243972235 + 0.01696317650105685i, -0.0002051395575676661 + 0.004684802133016374i, 0.11849283869424934 + -1.7648286253706876e-20i, -8.411556142834705e-05 + -0.000625874810882335i, 0.00030414474531990584 + 0.00046013659717476785i, -0.0035486318916571682 + -0.0014405331978818282i, 0.0033380793620287814 + -0.0002167706339081428i }, { 0.0037375193099625902 + 0.0020569978313652627i, -0.003642376439401108 + 0.0014785879010092637i, 0.0005848194886873607 + -0.00035731799424228904i, -8.41155614283471e-05 + 0.000625874810882335i, 0.13098779473686534 + 7.238735901759937e-20i, -0.00145929637053096 + -0.0075084893367830564i, 0.010441228726052737 + -0.018269305191244617i, -0.001163556732204554 + -0.00039497972997184274i }, { 0.003540714911207814 + 0.001813781838918371i, 0.0034262617234798124 + 0.00022249708445593736i, 0.0005352097754453775 + -0.00034925613001303126i, 0.00030414474531990573 + -0.00046013659717476806i, -0.0014592963705309598 + 0.0075084893367830564i, 0.12136535131800319 + 6.467986837167986e-20i, 0.000930911435527549 + 0.0008020456067775752i, 0.009674209685525566 + -0.016927230871588945i }, { 1.1026774115247841e-05 + 0.0006852506064283998i, -0.0004965627466013566 + -0.0003901540019775801i, 0.0036413260517351963 + 0.002004056479854845i, -0.003548631891657168 + 0.001440533197881828i, 0.010441228726052737 + 0.018269305191244617i, 0.0009309114355275487 + -0.0008020456067775752i, 0.12761653649876775 + 9.994411026510321e-20i, -0.001421738177259127 + -0.007315241892750979i }, { 2.926135434090916e-05 + 0.0006384145371356347i, 0.00024207992243692944 + 0.0004956077333115527i, 0.003449586845901094 + 0.0017671001845027906i, 0.0033380793620287814 + 0.00021677063390814367i, -0.001163556732204554 + 0.0003949797299718427i, 0.009674209685525566 + 0.016927230871588945i, -0.0014217381772591263 + 0.007315241892750978i, 0.11824174776950194 + -1.402257974971839e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13254195682784906, 1.0e-7), DoubleNear(0.12162307533570069, 1.0e-7), DoubleNear(0.12913069881906217, 1.0e-7), DoubleNear(0.11849283869424934, 1.0e-7), DoubleNear(0.13098779473686534, 1.0e-7), DoubleNear(0.12136535131800319, 1.0e-7), DoubleNear(0.12761653649876775, 1.0e-7), DoubleNear(0.11824174776950194, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false, false}), Matrix({ { 0.141706788786646 + -1.2083253557222417e-19i, 0.007148248290529683 + 0.011232473684473094i, 0.011295655421393226 + -0.01976431908953925i, 0.002136427945431611 + -0.00010163315391537603i, 0.00044574644786094615 + 9.212283838131016e-05i, -0.0004520516036260275 + 0.0003291925709517197i, 4.8379781323473224e-05 + -5.4826499536686863e-05i, 9.879892692054844e-06 + 8.9289568242254e-05i }, { 0.007148248290529683 + -0.011232473684473093i, 0.12268901466229207 + 1.062546440503918e-20i, -0.000996833290189581 + -0.0018923469701843092i, 0.009779720826939741 + -0.017111846618848875i, -0.0001581336320775663 + 0.00029908213717547085i, 0.0003276849251556286 + 0.00010283165663788025i, 2.9108921385878665e-05 + 4.5895700432453025e-05i, 4.046251929590231e-05 + -3.750644910751074e-05i }, { 0.011295655421393228 + 0.01976431908953925i, -0.000996833290189581 + 0.0018923469701843092i, 0.13805965372302403 + -7.899171407457922e-20i, 0.006964272440063419 + 0.010943381334158588i, 2.268242146100978e-05 + 6.951299194408576e-05i, -8.194728185483901e-05 + -3.6808725502225994e-05i, 0.00043427418521637914 + 8.975185505088773e-05i, -0.0004404170639665814 + 0.0003207200780070837i }, { 0.0021364279454316112 + 0.00010163315391537603i, 0.009779720826939741 + 0.017111846618848875i, 0.006964272440063419 + -0.010943381334158588i, 0.11953134373397986 + -5.7006835084823375e-21i, -5.4319047644133016e-05 + 1.7848488645096848e-06i, 1.1777970140575844e-05 + 5.390017265086692e-05i, -0.0001540637161672122 + 0.0002913846022956286i, 0.00031925123478279265 + 0.00010018505837829366i }, { 0.00044574644786094604 + -9.212283838131059e-05i, -0.00015813363207756626 + -0.000299082137175471i, 2.2682421461009752e-05 + -6.951299194408578e-05i, -5.4319047644133043e-05 + -1.7848488645096848e-06i, 0.12182296277806838 + 2.3697174173837727e-20i, -0.008818103409921094 + -0.0235495240198404i, 0.009710686564396623 + -0.01699105547020698i, -0.003987434685111037 + -0.0006472766752608065i }, { -0.000452051603626028 + -0.00032919257095171946i, 0.00032768492515562855 + -0.0001028316566378802i, -8.1947281854839e-05 + 3.680872550222605e-05i, 1.1777970140575803e-05 + -5.390017265086692e-05i, -0.008818103409921094 + 0.0235495240198404i, 0.12029941199141181 + 4.2094021135844277e-20i, 0.002581626841442394 + 0.0031070573399773955i, 0.009589242102558062 + -0.01677856075379692i }, { 4.837978132347325e-05 + 5.4826499536686816e-05i, 2.91089213858787e-05 + -4.5895700432453046e-05i, 0.00043427418521637903 + -8.975185505088817e-05i, -0.00015406371616721214 + -0.00029138460229562863i, 0.009710686564396625 + 0.01699105547020698i, 0.002581626841442394 + -0.0031070573399773955i, 0.11868758159480586 + 9.698601297468319e-20i, -0.008591150174890212 + -0.022943425359925943i }, { 9.879892692054763e-06 + -8.9289568242254e-05i, 4.0462519295902286e-05 + 3.7506449107510725e-05i, -0.0004404170639665815 + -0.00032072007800708346i, 0.0003192512347827927 + -0.00010018505837829393i, -0.003987434685111037 + 0.0006472766752608065i, 0.00958924210255806 + 0.01677856075379692i, -0.008591150174890212 + 0.022943425359925943i, 0.11720324272977142 + -2.5970182494942932e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.141706788786646, 1.0e-7), DoubleNear(0.12268901466229207, 1.0e-7), DoubleNear(0.13805965372302403, 1.0e-7), DoubleNear(0.11953134373397986, 1.0e-7), DoubleNear(0.12182296277806838, 1.0e-7), DoubleNear(0.12029941199141181, 1.0e-7), DoubleNear(0.11868758159480586, 1.0e-7), DoubleNear(0.11720324272977142, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true, false}), Matrix({ { 0.26352975156471437 + -9.713536139838645e-20i, -0.0016698551193914117 + -0.012317050335367305i, 0.02100634198578985 + -0.03675537455974623i, -0.001851006739679426 + -0.0007489098291761824i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0016698551193914117 + 0.012317050335367306i, 0.2429884266537039 + 5.2719485540883456e-20i, 0.001584793551252813 + 0.0012147103697930863i, 0.0193689629294978 + -0.033890407372645794i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02100634198578985 + 0.03675537455974623i, 0.0015847935512528126 + -0.0012147103697930863i, 0.25674723531782995 + 1.7994298900103973e-20i, -0.0016268777348267928 + -0.012000044025767355i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0018510067396794259 + 0.0007489098291761824i, 0.0193689629294978 + 0.033890407372645794i, -0.0016268777348267928 + 0.012000044025767355i, 0.23673458646375128 + -3.167086600342527e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.26352975156471437, 1.0e-7), DoubleNear(0.2429884266537039, 1.0e-7), DoubleNear(0.25674723531782995, 1.0e-7), DoubleNear(0.23673458646375128, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, true}), Matrix({ { 0.0805900528507521 + -3.567679298156094e-22i, -0.0005161427770088369 + -0.003764853190880548i, 0.006423950999020522 + -0.011240163817297637i, -0.0005662391437574342 + -0.0002281137981640731i, -0.021982805929973558 + -0.008443130566448541i, -0.00026635696839202156 + 0.0010632373658171664i, -0.0029298732344811822 + 0.0023930010709475183i, 0.00012706156272440506 + 0.00012190190165448615i }, { -0.0005161427770088369 + 0.0037648531908805486i, 0.07430594277713082 + 4.7111071193845673e-20i, 0.00048395415223016536 + 0.00037209011190190695i, 0.00592303539272163 + -0.010363697998318164i, 0.0005362623881304505 + -0.0009941452384528923i, -0.02027059240986996 + -0.007793586383721634i, -9.591049715209438e-05 + -0.00015403907740775988i, -0.002702796093741247 + 0.0022059690499791995i }, { 0.006423950999020522 + 0.011240163817297637i, 0.0004839541522301652 + -0.00037209011190190706i, 0.07851589105478018 + -1.0446263013809391e-20i, -0.0005028587104091882 + -0.003667956435266936i, -0.0005746899993127513 + -0.0037390296468970538i, -0.00016952496987384053 + 4.760250978910036e-05i, -0.02141703019692302 + -0.008225828080101222i, -0.00025950168751818017 + 0.0010358726198439637i }, { -0.0005662391437574342 + 0.0002281137981640731i, 0.005923035392721629 + 0.010363697998318162i, -0.0005028587104091882 + 0.003667956435266936i, 0.0723935163390017 + -1.1842022519772615e-20i, 0.0001814030159458847 + -4.450464956930406e-06i, -0.0005288010514616851 + -0.003448445392025527i, 0.0005224604992033301 + -0.0009685587299409161i, -0.019748884247745603 + -0.007593001341785264i }, { -0.021982805929973558 + 0.008443130566448541i, 0.0005362623881304505 + 0.0009941452384528925i, -0.0005746899993127512 + 0.0037390296468970538i, 0.00018140301594588465 + 4.450464956930392e-06i, 0.1829396987139623 + -9.677859346857084e-20i, -0.0011537123423825749 + -0.008552197144486757i, 0.014582390986769327 + -0.025515210742448592i, -0.001284767595921992 + -0.0005207960310121093i }, { -0.00026635696839202156 + -0.0010632373658171664i, -0.020270592409869958 + 0.007793586383721634i, -0.00016952496987384058 + -4.760250978910036e-05i, -0.0005288010514616851 + 0.003448445392025527i, -0.0011537123423825749 + 0.008552197144486757i, 0.16868248387657309 + 5.608414347037783e-21i, 0.0011008393990226478 + 0.0008426202578911792i, 0.013445927536776172 + -0.02352670937432763i }, { -0.0029298732344811822 + -0.0023930010709475183i, -9.591049715209436e-05 + 0.0001540390774077599i, -0.02141703019692302 + 0.008225828080101222i, 0.0005224604992033301 + 0.0009685587299409161i, 0.01458239098676933 + 0.025515210742448592i, 0.0011008393990226475 + -0.0008426202578911792i, 0.17823134426304973 + 2.8440561913913364e-20i, -0.0011240190244176046 + -0.008332087590500418i }, { 0.000127061562724405 + -0.00012190190165448615i, -0.0027027960937412465 + -0.0022059690499791995i, -0.0002595016875181801 + -0.0010358726198439637i, -0.019748884247745603 + 0.007593001341785264i, -0.0012847675959219917 + 0.0005207960310121093i, 0.013445927536776174 + 0.02352670937432763i, -0.0011240190244176046 + 0.008332087590500418i, 0.16434107012474958 + -1.9828843483652655e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.0805900528507521, 1.0e-7), DoubleNear(0.07430594277713082, 1.0e-7), DoubleNear(0.07851589105478018, 1.0e-7), DoubleNear(0.0723935163390017, 1.0e-7), DoubleNear(0.1829396987139623, 1.0e-7), DoubleNear(0.16868248387657309, 1.0e-7), DoubleNear(0.17823134426304973, 1.0e-7), DoubleNear(0.16434107012474958, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false, false}), Matrix({ { 0.10080127722377674 + 1.5233446426655985e-20i, -0.0001601348835021455 + -0.0036570237973420866i, -0.003824635997397908 + -0.028514344571870107i, -0.0010284113642223518 + 0.00018405447446488867i, 0.0028424713887549736 + -0.0015643952572502741i, 0.0026927970121837456 + -0.0013794237714909504i, -0.0005503811591958013 + -0.0007447124507455809i, -0.0004923780182588591 + -0.0007093912897219913i }, { -0.00016013488350214594 + 0.0036570237973420857i, 0.09249721089938133 + -7.586111716294797e-20i, 0.00104056314754791 + -9.345758180806808e-05i, -0.003509560317170605 + -0.02616531671187767i, -0.002770112996734321 + -0.0011245008937278696i, 0.002605752669536081 + -0.00016921426866252668i, -0.000212990674942542 + 0.0008262669420770983i, -0.0001467351389854689 + -0.0007306866394312789i }, { -0.0038246359973979076 + 0.028514344571870107i, 0.00104056314754791 + 9.345758180806814e-05i, 0.16087137842313454 + -2.6670597820764104e-19i, -0.00025556342292597256 + -0.005836339334258536i, 0.0003346811463701392 + 0.0008634260738230998i, 0.0002880359966072884 + 0.0008140684120246884i, 0.004536373972942813 + -0.002496659053969833i, 0.004297504744925163 + -0.002201458251930211i }, { -0.0010284113642223514 + -0.00018405447446488883i, -0.003509560317170604 + 0.02616531671187767i, -0.0002555634229259719 + 0.005836339334258535i, 0.1476187031305687 + 4.6252448078444685e-20i, 0.00042319979482601173 + -0.0007409345590813942i, -5.100155115783092e-05 + 0.0007435274089338979i, -0.004420895334323955 + -0.0017946202051632224i, 0.004158588415972513 + -0.00027005344970155044i }, { 0.002842471388754973 + 0.0015643952572502728i, -0.002770112996734321 + 0.0011245008937278696i, 0.0003346811463701392 + -0.0008634260738230998i, 0.00042319979482601173 + 0.0007409345590813943i, 0.09961930038011647 + 1.6327305286564796e-19i, -0.0011098292308193444 + -0.005710382834862536i, -0.003779789034057174 + -0.028179990723145757i, -0.0015732254127232479 + 0.0005306102296096557i }, { 0.0026927970121837456 + 0.0013794237714909506i, 0.002605752669536081 + 0.00016921426866252625i, 0.0002880359966072884 + -0.0008140684120246884i, -5.10015511578307e-05 + -0.0007435274089338979i, -0.0011098292308193447 + 0.005710382834862535i, 0.09230120571900743 + 1.6605229190183582e-20i, 0.001657444441371724 + 9.7279693516274e-05i, -0.00350212342262739 + -0.026109871390102173i }, { -0.0005503811591958011 + 0.000744712450745581i, -0.00021299067494254197 + -0.0008262669420770983i, 0.004536373972942814 + 0.0024966590539698347i, -0.004420895334323955 + 0.0017946202051632224i, -0.003779789034057174 + 0.028179990723145757i, 0.0016574444413717236 + -9.727969351627403e-05i, 0.15898503085551657 + 9.058416417054645e-21i, -0.0017712053169707414 + -0.009113348394671499i }, { -0.0004923780182588591 + 0.0007093912897219913i, -0.00014673513898546913 + 0.0007306866394312787i, 0.004297504744925163 + 0.002201458251930211i, 0.004158588415972513 + 0.00027005344970155304i, -0.0015732254127232479 + -0.0005306102296096557i, -0.00350212342262739 + 0.026109871390102176i, -0.0017712053169707414 + 0.009113348394671499i, 0.1473058933684977 + 3.40520594317779e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.10080127722377674, 1.0e-7), DoubleNear(0.09249721089938133, 1.0e-7), DoubleNear(0.16087137842313454, 1.0e-7), DoubleNear(0.1476187031305687, 1.0e-7), DoubleNear(0.09961930038011647, 1.0e-7), DoubleNear(0.09230120571900743, 1.0e-7), DoubleNear(0.15898503085551657, 1.0e-7), DoubleNear(0.1473058933684977, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false, false}), Matrix({ { 0.10777134760072102 + 6.864297758233623e-20i, 0.005436411041780182 + 0.008542560566296447i, -0.00408909675426786 + -0.03048601590275176i, 0.0022102222142662583 + -0.0018619593669908121i, 0.0003390006631689032 + 7.006158647843743e-05i, -0.0003437958825049251 + 0.0002503586969642494i, 6.95632136727618e-06 + -9.855372926790198e-05i, 8.386509072718866e-05 + 8.775269138532336e-05i }, { 0.005436411041780182 + -0.008542560566296447i, 0.0933078828415726 + -6.694810594731953e-20i, -0.002622762490336084 + -0.0012137099488950937i, -0.003540319104931816 + -0.026394637011491258i, -0.00012026434848971714 + 0.0002274590035007673i, 0.0002492120968575042 + 7.820589476884216e-05i, 6.890598958198624e-05 + 2.5389670154122717e-05i, 1.266694539521943e-05 + -7.346363940583123e-05i }, { -0.00408909675426786 + 0.03048601590275176i, -0.002622762490336084 + 0.001213709948895094i, 0.17199509490894904 + -2.6846722722913964e-19i, 0.008676109688812921 + 0.01363329445233524i, -3.2681275955286516e-05 + 9.323712866401526e-05i, -5.777625248625079e-05 + -0.0001067510793233136i, 0.0005410199699084219 + 0.00011181310695376073i, -0.0005486727850876837 + 0.0003995539519945539i }, { 0.0022102222142662583 + 0.0018619593669908121i, -0.003540319104931816 + 0.026394637011491258i, 0.008676109688812921 + -0.013633294452335238i, 0.14891247555469933 + 7.187288684387639e-20i, -5.9779768781901344e-05 + -4.265032233395623e-05i, -3.157832395865298e-05 + 6.752901062771344e-05i, -0.00019193299975506147 + 0.0003630077359703322i, 0.0003977240630809171 + 0.0001248108202473317i }, { 0.00033900066316890326 + -7.006158647843743e-05i, -0.00012026434848971709 + -0.00022745900350076728i, -3.2681275955286516e-05 + -9.323712866401526e-05i, -5.9779768781901276e-05 + 4.265032233395622e-05i, 0.09264923000317218 + 1.098635217099677e-19i, -0.006706375156101672 + -0.01790996719850107i, -0.0035153282771872214 + -0.026208319392264104i, -0.004811858991211858 + 0.0025766240710653563i }, { -0.0003437958825049252 + -0.00025035869696424934i, 0.0002492120968575041 + -7.820589476884227e-05i, -5.777625248625079e-05 + 0.00010675107932331355i, -3.15783239586529e-05 + -6.752901062771343e-05i, -0.006706375156101672 + 0.01790996719850107i, 0.09149053377681617 + 7.69221797455514e-21i, 0.005320770079255718 + 0.0012175320606032996i, -0.0034713646348661794 + -0.025880551090488587i }, { 6.956321367276194e-06 + 9.855372926790194e-05i, 6.890598958198623e-05 + -2.5389670154122662e-05i, 0.0005410199699084218 + -0.00011181310695376116i, -0.00019193299975506147 + -0.00036300773597033236i, -0.0035153282771872214 + 0.02620831939226411i, 0.005320770079255717 + -0.0012175320606032996i, 0.14786131436970207 + 1.0819665438553226e-20i, -0.010702878428709636 + -0.028582982181265273i }, { 8.38650907271887e-05 + -8.775269138532332e-05i, 1.2666945395219375e-05 + 7.346363940583124e-05i, -0.0005486727850876845 + -0.0003995539519945536i, 0.0003977240630809171 + -0.0001248108202473318i, -0.004811858991211858 + -0.0025766240710653567i, -0.003471364634866179 + 0.025880551090488587i, -0.010702878428709635 + 0.028582982181265273i, 0.14601212094436705 + 8.431620666346197e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10777134760072102, 1.0e-7), DoubleNear(0.0933078828415726, 1.0e-7), DoubleNear(0.17199509490894904, 1.0e-7), DoubleNear(0.14891247555469933, 1.0e-7), DoubleNear(0.09264923000317218, 1.0e-7), DoubleNear(0.09149053377681617, 1.0e-7), DoubleNear(0.14786131436970207, 1.0e-7), DoubleNear(0.14601212094436705, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true, false}), Matrix({ { 0.2004205776038932 + 1.7850649929230393e-19i, -0.0012699641143214904 + -0.009367406632204624i, -0.007604425031455082 + -0.056694335295015864i, -0.0026016367769456 + 0.0007146647040745443i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0012699641143214908 + 0.00936740663220462i, 0.18479841661838875 + -5.92558879727644e-20i, 0.002698007588919634 + 3.822111708205896e-06i, -0.007011683739797995 + -0.05227518810197985i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007604425031455082 + 0.056694335295015864i, 0.0026980075889196336 + -3.822111708205842e-06i, 0.3198564092786511 + -2.576475617905864e-19i, -0.0020267687398967146 + -0.014949687728930034i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002601636776945599 + -0.0007146647040745445i, -0.007011683739797995 + 0.05227518810197985i, -0.0020267687398967133 + 0.014949687728930036i, 0.2949245964990664 + 8.030450751022257e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2004205776038932, 1.0e-7), DoubleNear(0.18479841661838875, 1.0e-7), DoubleNear(0.3198564092786511, 1.0e-7), DoubleNear(0.2949245964990664, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, true}), Matrix({ { 0.061290631686076 + 5.264411027044165e-20i, -0.00039253872809418087 + -0.0028632594484302313i, -0.0023255097822761518 + -0.017337698877014994i, -0.0007950558858837232 + 0.0002196788603965606i, -0.016718441222214966 + -0.006421199484556713i, -0.0002025707425328091 + 0.0008086170374383296i, -0.0011820717537534794 + 0.0049728947709371295i, 0.00023642502200845643 + 2.662174723547294e-05i }, { -0.00039253872809418087 + 0.002863259448430231i, 0.05651141809366937 + 2.984845574749741e-20i, 0.0008248435590400643 + 2.4013524529832683e-06i, -0.0021441752511253877 + -0.01598577014248203i, 0.0004078401658188296 + -0.0007560708486607447i, -0.015416262547348765 + -0.00592720584813268i, -0.00022934932488515134 + -8.668143375443931e-05i, -0.001091740107358219 + 0.004585795337792001i }, { -0.0023255097822761518 + 0.017337698877014994i, 0.0008248435590400643 + -2.401352452983214e-06i, 0.0978153122194563 + -6.344714121406664e-20i, -0.0006264627593238442 + -0.004569550177717254i, 0.0024507452047240388 + -0.004485624145574148i, -0.00022105300738227955 + -8.798338698196607e-05i, -0.02668139490468161 + -0.010247759161993048i, -0.0003232879133773927 + 0.0012904929482228003i }, { -0.0007950558858837231 + -0.0002196788603965606i, -0.0021441752511253877 + 0.01598577014248203i, -0.0006264627593238438 + 0.0045695501777172545i, 0.09018804102246315 + 5.420592926575648e-21i, 0.00019840050712537988 + 0.00014405562313006727i, 0.0022615981549508847 + -0.004136011258163128i, 0.0006508827215149511 + -0.001206633119733064i, -0.024603214110266797 + -0.00945938187737422i }, { -0.016718441222214966 + 0.006421199484556713i, 0.0004078401658188296 + 0.0007560708486607447i, 0.0024507452047240388 + 0.004485624145574147i, 0.00019840050712537988 + -0.0001440556231300673i, 0.13912994591781722 + 1.2586238902186228e-19i, -0.0008774253862273095 + -0.006504147183774392i, -0.0052789152491789304 + -0.03935663641800087i, -0.0018065808910618765 + 0.0004949858436779837i }, { -0.00020257074253280912 + -0.0008086170374383299i, -0.015416262547348764 + 0.00592720584813268i, -0.0002210530073822795 + 8.798338698196604e-05i, 0.0022615981549508847 + 0.004136011258163128i, -0.0008774253862273099 + 0.00650414718377439i, 0.1282869985247194 + -8.910434372026181e-20i, 0.0018731640298795698 + 1.4207592552226275e-06i, -0.004867508488672607 + -0.03628941795949782i }, { -0.0011820717537534794 + -0.004972894770937129i, -0.00022934932488515128 + 8.668143375443931e-05i, -0.02668139490468161 + 0.010247759161993048i, 0.0006508827215149511 + 0.0012066331197330639i, -0.0052789152491789304 + 0.03935663641800087i, 0.0018731640298795694 + -1.4207592552226275e-06i, 0.2220410970591948 + -1.9420042057651977e-19i, -0.0014003059805728704 + -0.010380137551212781i }, { 0.00023642502200845643 + -2.6621747235472894e-05i, -0.001091740107358219 + -0.004585795337792001i, -0.0003232879133773926 + -0.0012904929482228003i, -0.024603214110266797 + 0.00945938187737422i, -0.001806580891061876 + -0.0004949858436779839i, -0.004867508488672607 + 0.03628941795949782i, -0.0014003059805728696 + 0.010380137551212781i, 0.20473655547660324 + 7.488391458364693e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.061290631686076, 1.0e-7), DoubleNear(0.05651141809366937, 1.0e-7), DoubleNear(0.0978153122194563, 1.0e-7), DoubleNear(0.09018804102246315, 1.0e-7), DoubleNear(0.13912994591781722, 1.0e-7), DoubleNear(0.1282869985247194, 1.0e-7), DoubleNear(0.2220410970591948, 1.0e-7), DoubleNear(0.20473655547660324, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false, false}), Matrix({ { 0.15083532495167745 + -2.314178416821722e-19i, 0.007577470162479778 + 0.011953058075640781i, 0.003960513639133828 + -0.02887453488103419i, 0.0024475498289298976 + -0.0011788907688603109i, 0.0007720453802465116 + -0.0030568451587896324i, 0.0017856559676548015 + 0.0036552116035905692i, 0.01674717014557149 + 0.0016856204502137268i, -0.017224963583398104 + 0.011328354454253498i }, { 0.007577470162479778 + -0.011953058075640783i, 0.13059961529770076 + -5.3716603928016085e-20i, -0.002124554348795535 + -0.0017759185384580854i, 0.0034505755559215475 + -0.025001454161860698i, 0.0018515359425607298 + 0.0013668675749942735i, 0.0011186448678174247 + -0.002150074320061623i, -0.005826174871592639 + 0.010296090075566634i, 0.011581861292247147 + 0.003972433703647123i }, { 0.003960513639133828 + 0.02887453488103419i, -0.002124554348795535 + 0.0017759185384580854i, 0.1289311175579926 + 3.1593592035368807e-20i, 0.006535050568113325 + 0.010222796942990902i, 0.014225979761109835 + 0.0014332346926218388i, -0.014774524004653976 + 0.009767754397018703i, 0.0001079752528308136 + 0.0032387198522218306i, -0.0026781246352474103 + -0.003005298954631766i }, { 0.0024475498289298976 + 0.0011788907688603109i, 0.0034505755559215475 + 0.025001454161860698i, 0.006535050568113325 + -0.010222796942990902i, 0.11162074309857117 + 5.864138482457294e-20i, -0.004906961725364229 + 0.00883962180877821i, 0.009944353944224209 + 0.0034458385485273747i, -0.0021637332908055083 + -0.0007764008355231739i, -0.00047170870787900345 + 0.002353091035077797i }, { 0.0007720453802465114 + 0.0030568451587896324i, 0.0018515359425607298 + -0.0013668675749942735i, 0.014225979761109835 + -0.0014332346926218388i, -0.004906961725364228 + -0.00883962180877821i, 0.11083733069523379 + -2.0054690098812855e-20i, -0.007993168468907895 + -0.021446421207241405i, 0.003418331722563958 + 0.024813480569814084i, 0.0045427519281790105 + -0.0024019912545608503i }, { 0.001785655967654801 + -0.003655211603590569i, 0.0011186448678174247 + 0.002150074320061623i, -0.014774524004653976 + -0.009767754397018703i, 0.009944353944224209 + -0.0034458385485273747i, -0.007993168468907897 + 0.021446421207241405i, 0.10951629873224926 + 2.4107934843512798e-20i, -0.00506645398226274 + -0.0011432025604330063i, 0.0033137655295870463 + 0.02456218644349662i }, { 0.01674717014557149 + -0.0016856204502137268i, -0.00582617487159264 + -0.010296090075566634i, 0.00010797525283081361 + -0.0032387198522218306i, -0.0021637332908055083 + 0.0007764008355231737i, 0.0034183317225639585 + -0.024813480569814084i, -0.005066453982262742 + 0.0011432025604330063i, 0.12967321367764045 + 1.4073787724733378e-19i, -0.009416085115903411 + -0.025046528172524937i }, { -0.017224963583398104 + -0.0113283544542535i, 0.011581861292247145 + -0.003972433703647123i, -0.0026781246352474107 + 0.003005298954631766i, -0.00047170870787900345 + -0.002353091035077797i, 0.0045427519281790105 + 0.0024019912545608507i, 0.003313765529587046 + -0.02456218644349662i, -0.009416085115903411 + 0.025046528172524937i, 0.127986355988934 + -7.984096202611463e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.15083532495167745, 1.0e-7), DoubleNear(0.13059961529770076, 1.0e-7), DoubleNear(0.1289311175579926, 1.0e-7), DoubleNear(0.11162074309857117, 1.0e-7), DoubleNear(0.11083733069523379, 1.0e-7), DoubleNear(0.10951629873224926, 1.0e-7), DoubleNear(0.12967321367764045, 1.0e-7), DoubleNear(0.127986355988934, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true, false}), Matrix({ { 0.2616726556469113 + -2.5147253178098504e-19i, -0.0004156983064281172 + -0.009493363131600624i, 0.0073788453616977865 + -0.004061054311220107i, 0.006990301757108909 + -0.0035808820234211614i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00041569830642811806 + 0.00949336313160062i, 0.24011591402995003 + -2.9608669084503287e-20i, -0.007191008331058276 + -0.0029191210988910917i, 0.006764341085508593 + -0.0004392677183640767i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0073788453616977865 + 0.00406105431122011i, -0.007191008331058277 + 0.0029191210988910917i, 0.2586043312356331 + 1.7233146928270258e-19i, -0.002881034547790086 + -0.014823731229534036i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.006990301757108909 + 0.003580882023421162i, 0.006764341085508593 + 0.0004392677183640784i, -0.002881034547790086 + 0.014823731229534034i, 0.23960709908750513 + 5.0657288621961473e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2616726556469113, 1.0e-7), DoubleNear(0.24011591402995003, 1.0e-7), DoubleNear(0.2586043312356331, 1.0e-7), DoubleNear(0.23960709908750513, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, true}), Matrix({ { 0.08002977811793592 + -1.362717587875322e-20i, -0.00012634943766157754 + -0.0028860530156511305i, 0.0018672666000019347 + -0.0013506742586217764i, 0.002340544942185973 + -0.0011668575474489055i, -0.021439817935665052 + -0.0086026174333807i, 0.00041899097256782754 + 0.0012899782163412836i, 0.0014951201462557484 + -0.004856651756833979i, -0.0007144042521908463 + 2.7676935648897753e-05i }, { -0.00012634943766157754 + 0.0028860530156511305i, 0.07342401879052338 + 1.509128578740858e-20i, -0.0023953316460284613 + -0.0010023800459312668i, 0.0017154969699633821 + -0.00014306999963950226i, 0.0002619022746189275 + -0.0016554933747657905i, -0.019999717363362583 + -0.007711970977852801i, 0.0006040607988360684 + 0.0003814202601125586i, 0.0014373482664614108 + -0.004681760761984375i }, { 0.0018672666000019349 + 0.0013506742586217764i, -0.0023953316460284613 + 0.0010023800459312666i, 0.07907616578759638 + 2.824144935128222e-21i, -0.0008926520497564471 + -0.004546756610496354i, 0.0016105519675913538 + -0.005336085290826895i, 0.00021296940608903192 + -0.00014196765218942457i, -0.02196001819123152 + -0.008066341213169062i, -0.0009448496284780294 + 0.0008091317693198459i }, { 0.002340544942185973 + 0.0011668575474489055i, 0.0017154969699633821 + 0.00014306999963950053i, -0.0008926520497564471 + 0.004546756610496354i, 0.07327544032560915 + 2.0177762886664476e-20i, -0.0001278531287826083 + -0.00020592143179200894i, 0.0014456644586241917 + -0.004730078538796526i, 0.0007968206127148534 + -0.00030721059362801787i, -0.020019759294252974 + -0.007674616747654098i }, { -0.021439817935665056 + 0.0086026174333807i, 0.0002619022746189275 + 0.001655493374765791i, 0.0016105519675913534 + 0.005336085290826895i, -0.00012785312878260837 + 0.00020592143179200894i, 0.18164287752897534 + -2.378453559022318e-19i, -0.00028934886876653965 + -0.006607310115949493i, 0.005511578761695852 + -0.0027103800525983303i, 0.004649756814922936 + -0.002414024475972256i }, { 0.00041899097256782765 + -0.0012899782163412836i, -0.019999717363362583 + 0.007711970977852801i, 0.0002129694060890317 + 0.00014196765218942462i, 0.0014456644586241917 + 0.004730078538796525i, -0.0002893488687665405 + 0.0066073101159494895i, 0.16669189523942665 + -4.469995487191187e-20i, -0.004795676685029815 + -0.0019167410529598251i, 0.005048844115545212 + -0.0002961977187245744i }, { 0.0014951201462557488 + 0.004856651756833979i, 0.0006040607988360684 + -0.0003814202601125585i, -0.02196001819123152 + 0.008066341213169062i, 0.0007968206127148534 + 0.00030721059362801787i, 0.005511578761695852 + 0.0027103800525983338i, -0.0047956766850298154 + 0.0019167410529598251i, 0.17952816544803668 + 1.6950732434757437e-19i, -0.001988382498033639 + -0.010276974619037682i }, { -0.0007144042521908463 + -2.767693564889776e-05i, 0.001437348266461411 + 0.004681760761984375i, -0.0009448496284780294 + -0.0008091317693198459i, -0.020019759294252974 + 0.007674616747654099i, 0.004649756814922936 + 0.0024140244759722563i, 0.005048844115545211 + 0.0002961977187245779i, -0.001988382498033639 + 0.01027697461903768i, 0.16633165876189598 + 3.0479525735297e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.08002977811793592, 1.0e-7), DoubleNear(0.07342401879052338, 1.0e-7), DoubleNear(0.07907616578759638, 1.0e-7), DoubleNear(0.07327544032560915, 1.0e-7), DoubleNear(0.18164287752897534, 1.0e-7), DoubleNear(0.16669189523942665, 1.0e-7), DoubleNear(0.17952816544803668, 1.0e-7), DoubleNear(0.16633165876189598, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true, false}), Matrix({ { 0.2797664425096701 + -1.998242496468034e-19i, 0.014112520730593103 + 0.02217585501863168i, 0.0008800206330773252 + 0.00018187469343219822i, -0.0008924686675926088 + 0.0006499126489588035i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.014112520730593103 + -0.022175855018631688i, 0.24222035839627193 + 4.924780896556848e-21i, -0.00031219734824477856 + 0.0005904667394710995i, 0.0006469361599384213 + 0.00020301671501617407i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0008800206330773251 + -0.00018187469343219865i, -0.00031219734824477834 + -0.0005904667394710997i, 0.24051054437287425 + 1.206831871485209e-19i, -0.017409253584811307 + -0.04649294937976634i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0008924686675926096 + -0.0006499126489588028i, 0.0006469361599384213 + -0.00020301671501617407i, -0.017409253584811307 + 0.04649294937976634i, 0.23750265472118323 + 1.6123838640901335e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.2797664425096701, 1.0e-7), DoubleNear(0.24222035839627193, 1.0e-7), DoubleNear(0.24051054437287425, 1.0e-7), DoubleNear(0.23750265472118323, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, true}), Matrix({ { 0.08555510114084341 + -1.0565010366739214e-20i, 0.004308090420004656 + 0.006778050445927214i, 0.00021495625289415384 + 5.735722788325227e-05i, -0.0002299046373060061 + 0.00017907106892111582i, -0.023338881357157747 + -0.00896206886230974i, -0.000465789182752503 + -0.0023306772873807387i, 0.00020710074423176982 + -0.000570574130456421i, 0.00020649203109937626 + 0.0007809854474978836i }, { 0.004308090420004656 + -0.006778050445927214i, 0.07407832760305422 + -8.466144764587147e-21i, -7.510979492429389e-05 + 0.00016156595302119128i, 0.00017253584343466984 + 5.6809384972458864e-05i, -0.001904963675302745 + 0.0013793056288530074i, -0.02020001682949736 + -0.007744863052468079i, 0.00030935047061437924 + 0.0003311662394345199i, 0.0002895749970341709 + -0.000361250016982241i }, { 0.0002149562528941538 + -5.735722788325227e-05i, -7.510979492429389e-05 + -0.00016156595302119138i, 0.07355084276468887 + -2.380205768857839e-22i, -0.00532709190742268 + -0.0142108600720747i, 0.0001296356972784244 + -0.0006291297879637137i, -0.0004158580524908068 + 6.975971775808386e-05i, -0.020060954769738827 + -0.007706889784240022i, -6.0069473157698837e-05 + 0.004429787273041868i }, { -0.0002299046373060062 + -0.0001790710689211156i, 0.00017253584343466984 + -5.6809384972458864e-05i, -0.00532709190742268 + 0.0142108600720747i, 0.07262113151307831 + 4.37351934386602e-20i, -0.0006072508420561181 + 0.0004829472922142967i, -6.001845909527259e-06 + -0.0004712899332914806i, 0.002963686562636526 + -0.0033420095972468158i, -0.019819459828118197 + -0.00764172467303882i }, { -0.023338881357157747 + 0.00896206886230974i, -0.001904963675302745 + -0.0013793056288530074i, 0.00012963569727842441 + 0.0006291297879637137i, -0.0006072508420561183 + -0.00048294729221429666i, 0.19421134136882665 + -1.8925923928006418e-19i, 0.009804430310588447 + 0.015397804572704468i, 0.0006650643801831713 + 0.00012451746554894595i, -0.0006625640302866027 + 0.00047084158003768764i }, { -0.0004657891827525029 + 0.0023306772873807387i, -0.02020001682949736 + 0.007744863052468079i, -0.0004158580524908068 + -6.975971775808377e-05i, -6.001845909527255e-06 + 0.0004712899332914807i, 0.009804430310588447 + -0.015397804572704472i, 0.1681420307932177 + 1.3390925661143995e-20i, -0.00023708755332048467 + 0.0004289007864499082i, 0.0004744003165037514 + 0.0001462073300437152i }, { 0.00020710074423176985 + 0.0005705741304564211i, 0.00030935047061437924 + -0.0003311662394345199i, -0.02006095476973883 + 0.007706889784240023i, 0.002963686562636526 + 0.003342009597246816i, 0.0006650643801831712 + -0.00012451746554894639i, -0.00023708755332048446 + -0.0004289007864499083i, 0.16695970160818538 + 1.209212077254067e-19i, -0.012082161677388625 + -0.03228208930769164i }, { 0.0002064920310993762 + -0.0007809854474978836i, 0.0002895749970341709 + 0.00036125001698224094i, -6.0069473157698837e-05 + -0.004429787273041868i, -0.019819459828118197 + 0.00764172467303882i, -0.0006625640302866033 + -0.0004708415800376872i, 0.0004744003165037514 + -0.0001462073300437152i, -0.012082161677388627 + 0.03228208930769164i, 0.16488152320810492 + -2.761135479775887e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.08555510114084341, 1.0e-7), DoubleNear(0.07407832760305422, 1.0e-7), DoubleNear(0.07355084276468887, 1.0e-7), DoubleNear(0.07262113151307831, 1.0e-7), DoubleNear(0.19421134136882665, 1.0e-7), DoubleNear(0.1681420307932177, 1.0e-7), DoubleNear(0.16695970160818538, 1.0e-7), DoubleNear(0.16488152320810492, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, true}), Matrix({ { 0.1591059439055323 + -1.0803030943624998e-20i, -0.0010190014874180246 + -0.007432809626147485i, 0.0 + 0.0i, 0.0 + 0.0i, -0.043399836126896574 + -0.016668958646549763i, -0.0005258586559102018 + 0.002099109985661129i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0010190014874180246 + 0.007432809626147485i, 0.14669945911613252 + 3.526904867407305e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0010587228873337811 + -0.0019627039683938084i, -0.04001947665761556 + -0.015386587725506898i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.043399836126896574 + 0.016668958646549763i, 0.0010587228873337811 + 0.001962703968393809i, 0.0 + 0.0i, 0.0 + 0.0i, 0.361171042977012 + -6.833803155465749e-20i, -0.0022777313668001786 + -0.016884284734987175i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005258586559102017 + -0.002099109985661129i, -0.04001947665761556 + 0.015386587725506898i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0022777313668001804 + 0.01688428473498717i, 0.33302355400132266 + -1.4220429136614872e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1591059439055323, 1.0e-7), DoubleNear(0.14669945911613252, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.361171042977012, 1.0e-7), DoubleNear(0.33302355400132266, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false, false}), Matrix({ { 0.09790919805651664 + -6.725896540020234e-20i, 0.007804485397636619 + -0.013655722839809701i, -0.0037149037559514823 + -0.027696242419044118i, -0.004159007839697989 + -0.0016895779635076062i, 0.0027596245245313437 + -0.0008781047388074482i, 9.750150707675412e-05 + -0.0004548890619536185i, -0.0003531020773611447 + -0.0007473164593014951i, -0.0001323770054883695 + -1.032136215479835e-05i }, { 0.00780448539763662 + 0.013655722839809701i, 0.09538929006664142 + 6.631294663910349e-21i, 0.0035667670146794232 + -0.0027258380304843273i, -0.00361929255861703 + -0.026983418864703658i, 0.0003424459081238607 + 0.0003148990355280653i, 0.0026885995337597108 + -0.0008555047871053514i, 7.608443928739872e-05 + -0.00010881801412045922i, -0.00034401422082012555 + -0.0007280826308753647i }, { -0.003714903755951482 + 0.027696242419044115i, 0.0035667670146794232 + 0.0027258380304843273i, 0.1562558341070331 + -1.1422413784657987e-19i, 0.012455381106072728 + -0.02179352302974876i, 0.00014368887176467683 + 0.0008139511505678173i, 0.00012497813547329115 + 4.4840470028959274e-05i, 0.0044041565089110585 + -0.001401390177013748i, 0.00015560518947542305 + -0.0007259692777863341i }, { -0.004159007839697989 + 0.001689577963507606i, -0.00361929255861703 + 0.026983418864703658i, 0.012455381106072728 + 0.021793523029748758i, 0.1522342474466701 + -1.0622939228261647e-19i, -0.00010207083516340651 + 8.492200367303521e-05i, 0.00013999072344763155 + 0.0007930023321891805i, 0.0005465183258834058 + 0.0005025555558889916i, 0.004290805880004267 + -0.0013653223266576354i }, { 0.0027596245245313433 + 0.0008781047388074482i, 0.00034244590812386086 + -0.0003148990355280654i, 0.00014368887176467683 + -0.0008139511505678173i, -0.00010207083516340648 + -8.492200367303521e-05i, 0.0972112251120851 + 6.494353873160101e-20i, 0.007748848953248455 + -0.013558374222233029i, -0.003688421031505874 + -0.02749880205333148i, -0.004129359195797218 + -0.001677533337165602i }, { 9.750150707675407e-05 + 0.00045488906195361855i, 0.0026885995337597108 + 0.0008555047871053527i, 0.00012497813547329112 + -4.484047002895926e-05i, 0.00013999072344763176 + -0.0007930023321891805i, 0.007748848953248455 + 0.013558374222233029i, 0.09470928098703879 + 1.149347433242305e-19i, 0.003541340324187076 + -0.002706406136097016i, -0.0035934914251786907 + -0.02679106005991645i }, { -0.0003531020773611456 + 0.0007473164593014951i, 7.608443928739866e-05 + 0.0001088180141204592i, 0.0044041565089110585 + 0.0014013901770137506i, 0.0005465183258834055 + -0.0005025555558889918i, -0.003688421031505874 + 0.027498802053331488i, 0.003541340324187076 + 0.002706406136097016i, 0.1551419209427834 + 7.212368865767822e-20i, 0.012366589458329847 + -0.021638161840600537i }, { -0.0001323770054883695 + 1.0321362154798241e-05i, -0.00034401422082012566 + 0.0007280826308753644i, 0.00015560518947542316 + 0.0007259692777863339i, 0.004290805880004267 + 0.0013653223266576362i, -0.004129359195797218 + 0.001677533337165602i, -0.0035934914251786907 + 0.02679106005991645i, 0.01236658945832985 + 0.021638161840600537i, 0.1511490032812309 + -2.901321280884568e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.09790919805651664, 1.0e-7), DoubleNear(0.09538929006664142, 1.0e-7), DoubleNear(0.1562558341070331, 1.0e-7), DoubleNear(0.1522342474466701, 1.0e-7), DoubleNear(0.0972112251120851, 1.0e-7), DoubleNear(0.09470928098703879, 1.0e-7), DoubleNear(0.1551419209427834, 1.0e-7), DoubleNear(0.1511490032812309, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false, false}), Matrix({ { 0.10185028548119213 + -1.74065620618213e-21i, 0.008118635241239 + -0.014205399464959486i, -0.00386443782187253 + -0.02881108468999655i, -0.0043264181935924115 + -0.0017575876561326542i, 0.00029794045561340357 + 7.510017449040556e-05i, 3.422374168898947e-05 + -3.556840561029544e-05i, 9.93954133123334e-06 + -8.712992420254541e-05i, -1.1360006136938652e-05 + -8.331554735431856e-06i }, { 0.008118635241239 + 0.014205399464959486i, 0.09922894496110149 + 3.435527841198808e-21i, 0.003710338210310975 + -0.002835559754253762i, -0.003764978037327146 + -0.028069568224246465i, 1.3274797393268807e-05 + 4.7541095139056624e-05i, 0.00029027230441300365 + 7.316730675687382e-05i, 1.294459689487824e-05 + -5.558952686423009e-06i, 9.683725431262297e-06 + -8.48874444711878e-05i }, { -0.0038644378218725306 + 0.02881108468999655i, 0.003710338210310975 + 0.0028355597542537624i, 0.16254551796774594 + -1.0846641496100287e-19i, 0.012956741007093965 + -0.022670766243428644i, -3.254865548145308e-05 + 8.143097199325492e-05i, 8.762948678256334e-06 + 1.1030651576540087e-05i, 0.00047549091740317097 + 0.00011985432052878501i, 5.461855893038605e-05 + -5.6764543033902154e-05i }, { -0.0043264181935924115 + 0.0017575876561326542i, -0.003764978037327146 + 0.02806956822424646i, 0.012956741007093969 + 0.02267076624342864i, 0.1583620524959024 + -8.812792542426037e-20i, -1.3951950558775739e-05 + 1.9513122113742283e-06i, -3.171094443248642e-05 + 7.933516729847377e-05i, 2.1185594208316796e-05 + 7.587206945589605e-05i, 0.00046325311558616803 + 0.00011676960667230752i }, { 0.0002979404556134036 + -7.510017449040567e-05i, 1.3274797393268794e-05 + -4.7541095139056644e-05i, -3.2548655481453025e-05 + -8.143097199325495e-05i, -1.3951950558775736e-05 + -1.9513122113742283e-06i, 0.09327013768740963 + -5.747704624192034e-22i, 0.007434699109646075 + -0.013008697597083244i, -0.0035388869655848263 + -0.02638395978237905i, -0.003961948841902796 + -0.0016095236445405538i }, { 3.422374168898947e-05 + 3.5568405610295414e-05i, 0.00029027230441300365 + -7.316730675687404e-05i, 8.762948678256339e-06 + -1.1030651576540091e-05i, -3.171094443248638e-05 + -7.933516729847375e-05i, 0.007434699109646075 + 0.013008697597083244i, 0.09086962609257873 + 1.1813051014694204e-19i, 0.003397769128555525 + -0.0025966844123275815i, -0.0034478059464685745 + -0.025704910700373645i }, { 9.939541331233326e-06 + 8.71299242025454e-05i, 1.294459689487824e-05 + 5.558952686423009e-06i, 0.00047549091740317086 + -0.00011985432052878501i, 2.118559420831681e-05 + -7.587206945589607e-05i, -0.003538886965584826 + 0.02638395978237905i, 0.003397769128555525 + 0.002596684412327582i, 0.14885223708207057 + 6.63659657721012e-20i, 0.01186522955730861 + -0.02076091862692065i }, { -1.1360006136938659e-05 + 8.33155473543186e-06i, 9.68372543126227e-06 + 8.488744447118779e-05i, 5.461855893038606e-05 + 5.676454303390216e-05i, 0.0004632531155861681 + -0.00011676960667230795i, -0.003961948841902795 + 0.001609523644540554i, -0.0034478059464685745 + 0.025704910700373645i, 0.011865229557308612 + 0.02076091862692065i, 0.14502119823199858 + -4.7114679667201776e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10185028548119213, 1.0e-7), DoubleNear(0.09922894496110149, 1.0e-7), DoubleNear(0.16254551796774594, 1.0e-7), DoubleNear(0.1583620524959024, 1.0e-7), DoubleNear(0.09327013768740963, 1.0e-7), DoubleNear(0.09086962609257873, 1.0e-7), DoubleNear(0.14885223708207057, 1.0e-7), DoubleNear(0.14502119823199858, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true, false}), Matrix({ { 0.19512042316860173 + -2.315426668601334e-21i, 0.015553334350885075 + -0.027214097062042728i, -0.007403324787457357 + -0.055195044472375596i, -0.008288367035495207 + -0.003367111300673208i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.015553334350885073 + 0.027214097062042728i, 0.1900985710536802 + 1.2156603798814085e-19i, 0.0071081073388665 + -0.0054322441665813435i, -0.0072127839837957215 + -0.0537744789246201i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007403324787457357 + 0.0551950444723756i, 0.0071081073388665 + 0.0054322441665813435i, 0.3113977550498165 + -4.210044918890167e-20i, 0.024821970564402576 + -0.0434316848703493i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008288367035495205 + 0.0033671113006732084i, -0.007212783983795721 + 0.0537744789246201i, 0.02482197056440258 + 0.04343168487034929i, 0.303383250727901 + -1.3524260509146216e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.19512042316860173, 1.0e-7), DoubleNear(0.1900985710536802, 1.0e-7), DoubleNear(0.3113977550498165, 1.0e-7), DoubleNear(0.303383250727901, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, true}), Matrix({ { 0.05966887964483207 + 3.453906336405942e-20i, 0.004756293679503117 + -0.008322217919928685i, -0.002263976720328679 + -0.016878942819673542i, -0.0025346274216810944 + -0.0010296808283211728i, -0.016276811610947968 + -0.006254691773016436i, -0.002169811213404542 + 0.0017716106444417177i, -0.001151727041501729 + 0.004841650300027896i, 0.0005834752897682085 + 0.0005465702446260665i }, { 0.004756293679503116 + 0.008322217919928685i, 0.05813317013491329 + 4.7953502653879635e-20i, 0.0021736976294833244 + -0.0016612096166734964i, -0.002205708313072861 + -0.01644452619982348i, -0.0004250857127126177 + -0.002768751905491515i, -0.015857892158615765 + -0.006093713559672957i, -0.0007670869841929738 + 0.00022529981083529936i, -0.0011220848196099693 + 0.0047170398087012354i }, { -0.002263976720328679 + 0.01687894281967354i, 0.0021736976294833244 + 0.0016612096166734964i, 0.09522711598305084 + 1.221523989997064e-20i, 0.007590692712239035 + -0.013281643895687116i, 0.002386887573682204 + -0.004367015057964424i, -0.00041881987462060843 + -0.0006810083396724822i, -0.02597658672889555 + -0.00998202517715374i, -0.003462858114817887 + 0.0028273594764850005i }, { -0.002534627421681094 + 0.001029680828321173i, -0.0022057083130728604 + 0.01644452619982348i, 0.007590692712239035 + 0.013281643895687114i, 0.09277623725886859 + -7.024178818746164e-20i, 0.0007993444746454208 + -1.519397691618147e-05i, 0.0023254557859927194 + -0.004254620345772852i, -0.0006784053380618188 + -0.004418723133431066i, -0.025308022286052858 + -0.00972511586221353i }, { -0.016276811610947964 + 0.006254691773016436i, -0.0004250857127126177 + 0.002768751905491515i, 0.002386887573682204 + 0.004367015057964424i, 0.0007993444746454208 + 1.519397691618147e-05i, 0.13545154352376967 + -3.6854490032660756e-20i, 0.010797040671381958 + -0.018891879142114043i, -0.005139348067128678 + -0.03831610165270206i, -0.005753739613814113 + -0.0023374304723520352i }, { -0.002169811213404542 + -0.0017716106444417177i, -0.015857892158615765 + 0.006093713559672958i, -0.0004188198746206084 + 0.0006810083396724823i, 0.0023254557859927194 + 0.004254620345772852i, 0.010797040671381958 + 0.018891879142114043i, 0.1319654009187669 + 7.361253533426121e-20i, 0.004934409709383175 + -0.003771034549907847i, -0.005007075670722861 + -0.037329952724796625i }, { -0.001151727041501729 + -0.004841650300027896i, -0.0007670869841929738 + -0.0002252998108352994i, -0.02597658672889555 + 0.00998202517715374i, -0.0006784053380618186 + 0.004418723133431066i, -0.005139348067128678 + 0.038316101652702064i, 0.004934409709383175 + 0.0037710345499078475i, 0.21617063906676565 + -5.431568908887231e-20i, 0.01723127785216354 + -0.03015004097466218i }, { 0.0005834752897682087 + -0.0005465702446260665i, -0.001122084819609969 + -0.004717039808701235i, -0.003462858114817887 + -0.0028273594764850005i, -0.025308022286052858 + 0.009725115862213527i, -0.005753739613814112 + 0.0023374304723520352i, -0.005007075670722861 + 0.037329952724796625i, 0.017231277852163544 + 0.03015004097466218i, 0.2106070134690324 + -6.500081690400051e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.05966887964483207, 1.0e-7), DoubleNear(0.05813317013491329, 1.0e-7), DoubleNear(0.09522711598305084, 1.0e-7), DoubleNear(0.09277623725886859, 1.0e-7), DoubleNear(0.13545154352376967, 1.0e-7), DoubleNear(0.1319654009187669, 1.0e-7), DoubleNear(0.21617063906676565, 1.0e-7), DoubleNear(0.2106070134690324, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false, false}), Matrix({ { 0.14255191322212452 + -2.661605913019504e-19i, 0.011363021526384413 + -0.019882191417013362i, 0.0037538513976936552 + -0.027289167819722595i, -0.003506886387311541 + -0.002698821676374968i, 0.0009576689800246748 + -0.002637399368557735i, -0.000291509702776508 + -0.00034380025259439533i, 0.0143491693945762 + 0.002865907282274753i, 0.0015435109421720167 + -0.0017728809156226726i }, { 0.011363021526384413 + 0.019882191417013362i, 0.1388830270272537 + -1.8973854308237874e-20i, 0.0041053363593210514 + -0.0016516972940641898i, 0.003657237797361721 + -0.02658682122317229i, 0.0004441840933083926 + -7.666167066154516e-05i, 0.0009330212680392615 + -0.0025695201102935205i, 0.000744075622341379 + 0.002229772239001356i, 0.013979862043242433 + 0.002792146871586097i }, { 0.003753851397693655 + 0.027289167819722595i, 0.0041053363593210514 + 0.0016516972940641898i, 0.12184389022681354 + 1.5595352013476542e-19i, 0.009712354721948552 + -0.016993974291374767i, 0.012242713395357038 + 0.002471339289501134i, 0.0013205705374835137 + -0.0015105380543647543i, -0.00018423760700810016 + 0.002832353863576926i, 0.00038035200339588354 + 0.00025146730395019776i }, { -0.003506886387311541 + 0.002698821676374968i, 0.0036572377973617207 + 0.026586821223172293i, 0.009712354721948554 + 0.016993974291374763i, 0.11870797042975022 + -6.571854327482369e-20i, 0.0006311986490307203 + 0.0019045261939955951i, 0.011927620309977007 + 0.0024077339516480794i, -0.000409723701706807 + 0.00020007483525649785i, -0.00017949584804008973 + 0.0027594570237227016i }, { 0.0009576689800246746 + 0.002637399368557735i, 0.0004441840933083926 + 7.666167066154516e-05i, 0.012242713395357038 + -0.0024713392895011344i, 0.0006311986490307204 + -0.001904526193995595i, 0.1116131189414252 + 8.467748805516819e-20i, 0.008896844977324935 + -0.015567054452545097i, 0.003409929635748748 + 0.0250096729039014i, 0.003759993083863719 + 0.0015179633366350152i }, { -0.000291509702776508 + 0.00034380025259439533i, 0.0009330212680392615 + 0.0025695201102935205i, 0.0013205705374835137 + 0.0015105380543647543i, 0.011927620309977007 + -0.0024077339516480794i, 0.008896844977324934 + 0.015567054452545097i, 0.10874051048605785 + -8.062424331046825e-20i, -0.003216372125313785 + 0.0024691518854812466i, 0.0033221676164022565 + 0.024365994109409303i }, { 0.0143491693945762 + -0.002865907282274753i, 0.0007440756223413791 + -0.002229772239001356i, -0.00018423760700810013 + -0.002832353863576926i, -0.00040972370170680705 + -0.00020007483525649787i, 0.003409929635748748 + -0.0250096729039014i, -0.003216372125313785 + -0.002469151885481247i, 0.13050925582805498 + -1.8886292745486193e-20i, 0.01040308368962975 + -0.0182025617714588i }, { 0.0015435109421720167 + 0.0017728809156226726i, 0.013979862043242435 + -0.002792146871586097i, 0.00038035200339588354 + -0.00025146730395019776i, -0.0001794958480400897 + -0.0027594570237227025i, 0.003759993083863719 + -0.0015179633366350154i, 0.0033221676164022565 + -0.024365994109409303i, 0.010403083689629751 + 0.0182025617714588i, 0.12715031383851946 + 1.516400737902085e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.14255191322212452, 1.0e-7), DoubleNear(0.1388830270272537, 1.0e-7), DoubleNear(0.12184389022681354, 1.0e-7), DoubleNear(0.11870797042975022, 1.0e-7), DoubleNear(0.1116131189414252, 1.0e-7), DoubleNear(0.10874051048605785, 1.0e-7), DoubleNear(0.13050925582805498, 1.0e-7), DoubleNear(0.12715031383851946, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true, false}), Matrix({ { 0.25416503216354974 + -1.814831032467822e-19i, 0.02025986650370935 + -0.03544924586955846i, 0.0071637810334424035 + -0.0022794949158211966i, 0.0002531066965521778 + -0.0011808583397399527i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.020259866503709346 + 0.03544924586955846i, 0.2476235375133115 + -9.959809761870612e-20i, 0.0008889642340072664 + 0.0008174545914170568i, 0.006979405413763977 + -0.0022208271137629867i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007163781033442403 + 0.0022794949158211966i, 0.0008889642340072662 + -0.0008174545914170574i, 0.2523531460548685 + 1.3706722738927922e-19i, 0.020115438411578302 + -0.035196536062833565i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0002531066965521776 + 0.0011808583397399524i, 0.006979405413763977 + 0.0022208271137629902i, 0.020115438411578306 + 0.035196536062833565i, 0.24585828426826967 + 8.592153051538481e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.25416503216354974, 1.0e-7), DoubleNear(0.2476235375133115, 1.0e-7), DoubleNear(0.2523531460548685, 1.0e-7), DoubleNear(0.24585828426826967, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, true}), Matrix({ { 0.07772713765077198 + 2.98157148029483e-20i, 0.006195743840587673 + -0.010840863473092594i, 0.00181473487644615 + -0.0007566086204187257i, 3.9128440444845345e-05 + -0.00031341751377184763i, -0.020989877925881327 + -0.008263635600441317i, -0.0028256907284628 + 0.0022688218924437984i, 0.0014853485580925531 + -0.0048313793321276294i, -0.000555449304467735 + -0.0005922828378635324i }, { 0.0061957438405876725 + 0.010840863473092592i, 0.0757266592576873 + -2.835160489429294e-20i, 0.0002501819027086233 + 0.00019279675398632895i, 0.0017680286935191673 + -0.000737135637842553i, -0.0005205770180293351 + -0.0035862348557857407i, -0.020449657373146315 + -0.008050952810792185i, 0.000792247917103545 + -0.00017794978984664385i, 0.0014471198546246065 + -0.004707033186690725i }, { 0.00181473487644615 + 0.0007566086204187257i, 0.00025018190270862306 + -0.00019279675398632906i, 0.07716885797711094 + 1.6938588461081767e-20i, 0.006151242551154478 + -0.010762998342523207i, 0.0015480291764479038 + -0.005098694964628993i, -0.0005877363447077451 + -0.0006223332331329035i, -0.021263520413962192 + -0.00797308134972886i, -0.002806978599759629 + 0.00233014822848292i }, { 3.912844044484513e-05 + 0.00031341751377184763i, 0.001768028693519167 + 0.000737135637842553i, 0.006151242551154479 + 0.010762998342523207i, 0.07518274813609459 + 6.063319360710928e-21i, 0.0008345276848988722 + -0.0001905156347636674i, 0.0015081872497676415 + -0.004967468864994426i, -0.0005829140327451013 + -0.0036012401831368394i, -0.02071625707152231 + -0.0077678766110943i }, { -0.020989877925881327 + 0.008263635600441317i, -0.0005205770180293351 + 0.0035862348557857407i, 0.0015480291764479038 + 0.005098694964628993i, 0.0008345276848988719 + 0.0001905156347636674i, 0.17643789451277775 + -2.1129881804973051e-19i, 0.014064122663121676 + -0.024608382396465865i, 0.005349046156996253 + -0.001522886295402471i, 0.00021397825610733247 + -0.000867440825968105i }, { -0.0028256907284628 + -0.0022688218924437984i, -0.020449657373146315 + 0.008050952810792184i, -0.0005877363447077453 + 0.0006223332331329035i, 0.0015081872497676417 + 0.004967468864994426i, 0.014064122663121676 + 0.024608382396465865i, 0.17189687825562422 + -7.124649272441318e-20i, 0.0006387823312986431 + 0.0006246578374307279i, 0.00521137672024481 + -0.0014836914759204338i }, { 0.0014853485580925533 + 0.0048313793321276294i, 0.000792247917103545 + 0.00017794978984664382i, -0.02126352041396219 + 0.00797308134972886i, -0.0005829140327451013 + 0.0036012401831368394i, 0.0053490461569962525 + 0.001522886295402471i, 0.0006387823312986431 + -0.0006246578374307283i, 0.17518428807775757 + 1.2012863892819746e-19i, 0.013964195860423825 + -0.024433537720310358i }, { -0.0005554493044677348 + 0.0005922828378635325i, 0.0014471198546246065 + 0.004707033186690724i, -0.002806978599759629 + -0.00233014822848292i, -0.02071625707152231 + 0.007767876611094302i, 0.00021397825610733247 + 0.0008674408259681048i, 0.00521137672024481 + 0.0014836914759204373i, 0.013964195860423826 + 0.024433537720310358i, 0.1706755361321751 + 7.985821115467388e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.07772713765077198, 1.0e-7), DoubleNear(0.0757266592576873, 1.0e-7), DoubleNear(0.07716885797711094, 1.0e-7), DoubleNear(0.07518274813609459, 1.0e-7), DoubleNear(0.17643789451277775, 1.0e-7), DoubleNear(0.17189687825562422, 1.0e-7), DoubleNear(0.17518428807775757, 1.0e-7), DoubleNear(0.1706755361321751, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true, false}), Matrix({ { 0.2643958034489381 + -1.1020707116718498e-19i, 0.021075376248332965 + -0.03687616570838813i, 0.0007734313730165746 + 0.00019495449501919046i, 8.884230061937552e-05 + -9.233294864419759e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.02107537624833297 + 0.03687616570838813i, 0.2575909974570039 + -8.469239758306156e-20i, 3.446039160158562e-05 + 0.0001234131645949527i, 0.0007535254199991717 + 0.0001899369134291814i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0007734313730165745 + -0.00019495449501919068i, 3.4460391601585596e-05 + -0.00012341316459495272i, 0.24212237476948018 + 6.5791195309682e-20i, 0.019299928666954687 + -0.033769616224003894i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 8.884230061937553e-05 + 9.233294864419756e-05i, 0.0007535254199991718 + -0.00018993691342918204i, 0.019299928666954687 + 0.033769616224003894i, 0.2358908243245773 + 7.101583047974026e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.2643958034489381, 1.0e-7), DoubleNear(0.2575909974570039, 1.0e-7), DoubleNear(0.24212237476948018, 1.0e-7), DoubleNear(0.2358908243245773, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, true}), Matrix({ { 0.08085723351011875 + 4.0284476766051063e-20i, 0.006445248360207715 + -0.01127742839616144i, 0.00019627179070651166 + 5.78274647570423e-05i, 2.371050117730467e-05 + -2.2765170332576592e-05i, -0.02205324339114175 + -0.008462364717092417i, -0.0029381705587725807 + 0.0024012920366129516i, 0.0002515752916313069 + -0.00047198586958056214i, -4.577601102164998e-05 + -7.271073018884679e-05i }, { 0.006445248360207715 + 0.011277428396161438i, 0.07877619523377888 + -5.931563189737742e-20i, 7.579721905775897e-06 + 3.1984193942966474e-05i, 0.00019122030562231194 + 5.633914809866883e-05i, -0.0005776220211511506 + -0.003750386977129162i, -0.021485654795513356 + -0.008244567197685404i, 8.588288001692774e-05 + -2.534637971681133e-06i, 0.00024510044963463383 + -0.00045983827785809993i }, { 0.0001962717907065117 + -5.78274647570423e-05i, 7.57972190577587e-06 + -3.198419394296646e-05i, 0.07403876211776417 + 6.4698264979790036e-21i, 0.005901738031534437 + -0.010326433419454361i, 6.26227931615005e-05 + -0.0005573825924858009i, -7.274825721502753e-05 + -5.316399188374321e-05i, -0.020200154948701768 + -0.00777435223307776i, -0.0026944987694498485 + 0.0021976780843137667i }, { 2.3710501177304655e-05 + 2.2765170332576592e-05i, 0.00019122030562231194 + -5.633914809866883e-05i, 0.005901738031534437 + 0.010326433419454361i, 0.07213321216000301 + 3.702734636379541e-20i, 8.273176610876869e-05 + -3.5695571677205455e-05i, 6.101105820739663e-05 + -0.0005430371287693934i, -0.0005258690296232858 + -0.0034370880617934185i, -0.019680259649155263 + -0.007574262224201081i }, { -0.02205324339114175 + 0.008462364717092417i, -0.0005776220211511506 + 0.003750386977129162i, 6.262279316150052e-05 + 0.0005573825924858009i, 8.273176610876869e-05 + 3.569557167720545e-05i, 0.1835385699388193 + -1.5049154793323606e-19i, 0.014630127888125252 + -0.02559873731222669i, 0.000577159582310063 + 0.00013712703026214816i, 6.513179944207085e-05 + -6.9567778311621e-05i }, { -0.0029381705587725807 + -0.0024012920366129516i, -0.021485654795513356 + 0.008244567197685402i, -7.274825721502755e-05 + 5.316399188374321e-05i, 6.1011058207396635e-05 + 0.0005430371287693934i, 0.014630127888125254 + 0.02559873731222669i, 0.17881480222322504 + -2.5376765685684143e-20i, 2.6880669695809726e-05 + 9.142897065198622e-05i, 0.0005623051143768598 + 0.00013359776533051256i }, { 0.0002515752916313069 + 0.00047198586958056214i, 8.588288001692775e-05 + 2.5346379716811314e-06i, -0.020200154948701764 + 0.00777435223307776i, -0.0005258690296232858 + 0.0034370880617934185i, 0.0005771595823100628 + -0.00013712703026214838i, 2.6880669695809726e-05 + -9.142897065198626e-05i, 0.168083612651716 + 5.9321368811703e-20i, 0.013398190635420248 + -0.023443182804549535i }, { -4.577601102164999e-05 + 7.271073018884678e-05i, 0.00024510044963463383 + 0.00045983827785809993i, -0.0026944987694498485 + -0.0021976780843137667i, -0.019680259649155263 + 0.007574262224201083i, 6.513179944207088e-05 + 6.956777831162097e-05i, 0.0005623051143768599 + -0.0001335977653305132i, 0.013398190635420248 + 0.023443182804549535i, 0.1637576121645743 + 3.3988484115944846e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.08085723351011875, 1.0e-7), DoubleNear(0.07877619523377888, 1.0e-7), DoubleNear(0.07403876211776417, 1.0e-7), DoubleNear(0.07213321216000301, 1.0e-7), DoubleNear(0.1835385699388193, 1.0e-7), DoubleNear(0.17881480222322504, 1.0e-7), DoubleNear(0.168083612651716, 1.0e-7), DoubleNear(0.1637576121645743, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, true}), Matrix({ { 0.15489599562788292 + 4.6754303264030064e-20i, 0.012346986391742152 + -0.0216038618156158i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04225339833984352 + -0.016236716950170177i, -0.005632669328222429 + 0.004598970120926718i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.012346986391742152 + 0.0216038618156158i, 0.1509094073937819 + -2.2288285533582012e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0011034910507744364 + -0.007187475038922581i, -0.04116591444466862 + -0.015818829421886484i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04225339833984351 + 0.016236716950170177i, -0.0011034910507744364 + 0.007187475038922581i, 0.0 + 0.0i, 0.0 + 0.0i, 0.35162218259053535 + -9.117017912153306e-20i, 0.028028318523545502 + -0.04904192011677622i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005632669328222429 + -0.004598970120926718i, -0.04116591444466862 + 0.015818829421886484i, 0.0 + 0.0i, 0.0 + 0.0i, 0.028028318523545502 + 0.04904192011677622i, 0.34257241438779934 + 8.611718430260703e-21i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.15489599562788292, 1.0e-7), DoubleNear(0.1509094073937819, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.35162218259053535, 1.0e-7), DoubleNear(0.34257241438779934, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false, false}), Matrix({ { 0.10841408462187356 + -5.444445872865445e-20i, -0.0041134836987160245 + -0.030667831306236727i, 0.002854892325810855 + -0.020754054311834663i, -0.00597916213433441 + -2.0125541428018075e-05i, 0.0007283297957450666 + -0.0020058042846394907i, -0.0005950300682954049 + -0.00012992271375682844i, 0.010912880997767906 + 0.0021795899304054827i, 0.00020249525962120368 + -0.0031696997890240768i }, { -0.004113483698716025 + 0.030667831306236727i, 0.17302085562750466 + -2.3068998688153384e-19i, 0.005762519562757634 + 0.0015950401734476003i, 0.004556196869244522 + -0.03312193473106022i, 0.0005397609996585049 + 0.00028213251668892113i, 0.0011623604523188695 + -0.0032011151942117648i, -0.001030615669380014 + 0.003004302319131136i, 0.017416150440050727 + 0.0034784642234553676i }, { 0.0028548923258108544 + 0.020754054311834663i, 0.005762519562757634 + -0.0015950401734476003i, 0.09266514582042004 + 5.613933036367114e-20i, -0.0035159321604836514 + -0.02621282160800629i, 0.009310871639985709 + 0.0018795116866923503i, 0.00017839405923241795 + -0.002705142809412141i, -0.0001401170357186594 + 0.00215407176588677i, 0.0006146533350579004 + -4.209465491690477e-05i }, { -0.00597916213433441 + 2.0125541428017994e-05i, 0.004556196869244522 + 0.033121934731060225i, -0.003515932160483652 + 0.02621282160800629i, 0.1478867148361437 + 3.409564649627059e-20i, -0.000884946512181712 + 0.002562516679021046i, 0.014859462065348338 + 0.0029995615544568628i, -0.0006040205995724445 + -0.00012136637739719243i, -0.00022361641932953049 + 0.003437739121412858i }, { 0.0007283297957450666 + 0.0020058042846394903i, 0.0005397609996585049 + -0.0002821325166889211i, 0.009310871639985709 + -0.0018795116866923503i, -0.000884946512181712 + -0.0025625166790210468i, 0.0848844035012845 + -6.183212007637536e-21i, -0.0032207126158524876 + -0.02401182997751105i, 0.0025933317324801997 + 0.019020444785921863i, 0.005282045836153139 + -0.0014552735487488417i }, { -0.0005950300682954049 + 0.00012992271375682842i, 0.0011623604523188693 + 0.0032011151942117648i, 0.00017839405923241808 + 0.0027051428094121413i, 0.014859462065348338 + -0.002999561554456863i, -0.0032207126158524868 + 0.02401182997751105i, 0.13546922592619853 + 1.0236456752337473e-20i, -0.005478839967545325 + 1.1913309309397444e-05i, 0.004138765519670805 + 0.030355222227388838i }, { 0.010912880997767908 + -0.0021795899304054827i, -0.001030615669380014 + -0.003004302319131136i, -0.00014011703571865935 + -0.0021540717658867703i, -0.0006040205995724442 + 0.00012136637739719241i, 0.0025933317324801997 + -0.019020444785921863i, -0.005478839967545325 + -1.1913309309397369e-05i, 0.09925536027870385 + 1.2373895169216035e-19i, -0.0037659802962009136 + -0.02807704050524164i }, { 0.0002024952596212037 + 0.0031696997890240768i, 0.017416150440050727 + -0.003478464223455367i, 0.0006146533350579004 + 4.2094654916904786e-05i, -0.00022361641932953046 + -0.003437739121412858i, 0.005282045836153139 + 0.0014552735487488415i, 0.004138765519670805 + -0.030355222227388838i, -0.003765980296200913 + 0.028077040505241648i, 0.1584042093878706 + 9.014829352561949e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.10841408462187356, 1.0e-7), DoubleNear(0.17302085562750466, 1.0e-7), DoubleNear(0.09266514582042004, 1.0e-7), DoubleNear(0.1478867148361437, 1.0e-7), DoubleNear(0.0848844035012845, 1.0e-7), DoubleNear(0.13546922592619853, 1.0e-7), DoubleNear(0.09925536027870385, 1.0e-7), DoubleNear(0.1584042093878706, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true, false}), Matrix({ { 0.19329848812315806 + -6.062767073629198e-20i, -0.007334196314568513 + -0.05467966128374778i, 0.005448224058291054 + -0.001733609525912799i, -0.00069711629818127 + -0.0014753990901768595i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007334196314568511 + 0.05467966128374777i, 0.30849008155370317 + -2.2045353012919636e-19i, 0.00028367959521230827 + 0.001606953482756998i, 0.008694962388915326 + -0.002766712503671385i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.005448224058291054 + 0.0017336095259128i, 0.0002836795952123087 + -0.0016069534827569977i, 0.1919205060991239 + 1.798782820558315e-19i, -0.007281912456684565 + -0.05428986211324793i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0006971162981812711 + 0.0014753990901768595i, 0.008694962388915326 + 0.002766712503671387i, -0.007281912456684565 + 0.05428986211324793i, 0.30629092422401427 + 4.311047584883254e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.19329848812315806, 1.0e-7), DoubleNear(0.30849008155370317, 1.0e-7), DoubleNear(0.1919205060991239, 1.0e-7), DoubleNear(0.30629092422401427, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, true}), Matrix({ { 0.05911331730466704 + 1.58553812322338e-20i, -0.0022428973869758214 + -0.01672178711257419i, 0.0013801485789582725 + -0.0005754186607927177i, -0.00021513866194002658 + -0.000368579310108058i, -0.015963296108930186 + -0.0062846893389258696i, -0.001172108168229495 + 0.0047541022101048385i, 0.0011296425325355165 + -0.003674377676976431i, -0.0010822575434281116 + -0.00018013521043040248i }, { -0.0022428973869758214 + 0.016721787112574188i, 0.09434047960379224 + -1.4391271323578444e-20i, 0.00011040653785943425 + 0.00041224476721842126i, 0.0022026149910070445 + -0.0009183255974685601i, 0.0023834776789510344 + -0.004277190612551211i, -0.025476239190097456 + -0.01002989907230763i, 0.000996534988851036 + 0.00045896416019066473i, 0.0018028258801816432 + -0.005864034841841922i }, { 0.0013801485789582727 + 0.0005754186607927186i, 0.00011040653785943425 + -0.00041224476721842115i, 0.05868873247507833 + 6.663718478570526e-20i, -0.002226787646425718 + -0.016601681906922836i, 0.0011773126178323701 + -0.00387767750612425i, -0.0011415750666641984 + -0.00018590630191974838i, -0.016171407660633547 + -0.006063715993763524i, -0.0011017036928822033 + 0.004804587898624292i }, { -0.0002151386619400268 + 0.0003685793101080579i, 0.0022026149910070445 + 0.0009183255974685584i, -0.002226787646425718 + 0.016601681906922832i, 0.0936628736381272 + -4.363527696391256e-20i, 0.0010522350832360848 + 0.00048016259280580717i, 0.0018789038083831754 + -0.006188486323499169i, 0.0023288656807238886 + -0.004344444791186066i, -0.025808369824850956 + -0.009677241967059637i }, { -0.015963296108930186 + 0.0062846893389258696i, 0.0023834776789510344 + 0.004277190612551211i, 0.0011773126178323701 + 0.00387767750612425i, 0.0010522350832360848 + -0.00048016259280580706i, 0.13418517081849102 + -7.648305196852578e-20i, -0.005091298927592691 + -0.037957874171173585i, 0.004068075479332782 + -0.0011581908651200814i, -0.00048197763624124347 + -0.0011068197800688016i }, { -0.001172108168229495 + -0.0047541022101048385i, -0.025476239190097456 + 0.01002989907230763i, -0.0011415750666641982 + 0.00018590630191974827i, 0.0018789038083831754 + 0.006188486323499169i, -0.00509129892759269 + 0.037957874171173585i, 0.21414960194991095 + -2.060622588056179e-19i, 0.00017327305735287402 + 0.0011947087155385766i, 0.006492347397908282 + -0.001848386906202825i }, { 0.0011296425325355165 + 0.003674377676976431i, 0.0009965349888510359 + -0.00045896416019066473i, -0.016171407660633543 + 0.006063715993763524i, 0.0023288656807238886 + 0.004344444791186066i, 0.004068075479332781 + 0.0011581908651200814i, 0.00017327305735287445 + -0.0011947087155385766i, 0.13323177362404556 + 1.1324109727012623e-19i, -0.005055124810258847 + -0.0376881802063251i }, { -0.0010822575434281116 + 0.00018013521043040243i, 0.0018028258801816434 + 0.005864034841841922i, -0.0011017036928822033 + -0.004804587898624292i, -0.025808369824850956 + 0.009677241967059637i, -0.00048197763624124434 + 0.0011068197800688016i, 0.006492347397908282 + 0.0018483869062028285i, -0.005055124810258847 + 0.037688180206325105i, 0.2126280505858871 + 8.67457528127451e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.05911331730466704, 1.0e-7), DoubleNear(0.09434047960379224, 1.0e-7), DoubleNear(0.05868873247507833, 1.0e-7), DoubleNear(0.0936628736381272, 1.0e-7), DoubleNear(0.13418517081849102, 1.0e-7), DoubleNear(0.21414960194991095, 1.0e-7), DoubleNear(0.13323177362404556, 1.0e-7), DoubleNear(0.2126280505858871, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true, false}), Matrix({ { 0.20107923044229362 + 1.6948716350166823e-21i, -0.007629415859199676 + -0.05688065291424302i, 0.0005882127600264073 + 0.00014826748124727933i, 1.962326676249561e-05 + -0.0001720173686737332i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007629415859199676 + 0.05688065291424302i, 0.3209075704636484 + -1.9659434038526326e-19i, -6.425959991393954e-05 + 0.00016076613929172872i, 0.0009387440329893389 + 0.00023662392720109307i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0005882127600264073 + -0.00014826748124727976i, -6.425959991393938e-05 + -0.0001607661392917287i, 0.18413976377998836 + 1.1755573968452283e-19i, -0.006986692912053401 + -0.052088870482752694i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 1.9623266762495582e-05 + 0.0001720173686737332i, 0.0009387440329893389 + -0.00023662392720109307i, -0.0069866929120534 + 0.052088870482752694i, 0.2938734353140691 + 1.925128610489942e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.20107923044229362, 1.0e-7), DoubleNear(0.3209075704636484, 1.0e-7), DoubleNear(0.18413976377998836, 1.0e-7), DoubleNear(0.2938734353140691, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, true}), Matrix({ { 0.061493828864978596 + 4.570177155767335e-20i, -0.0023332195580488867 + -0.01739517864845081i, 0.00014926931561687313 + 4.397914777804174e-05i, 6.777054762793197e-06 + -4.38935006885993e-05i, -0.016772010569009628 + -0.006435827508750857i, -0.001184177136502732 + 0.0049886033187304425i, 0.00019132892950507214 + -0.0003589563608683569i, -0.00010879989989458864 + -4.050287571395548e-05i }, { -0.0023332195580488867 + 0.017395178648450808i, 0.09813959987891904 + -6.473292668899971e-20i, -1.8104308018679154e-05 + 4.055615742551004e-05i, 0.0002382227807119505 + 7.01874650776695e-05i, 0.0024569156798560613 + -0.004500222650529818i, -0.026766887617645483 + -0.01027110440602696i, 9.428096657781715e-05 + 6.77421619032428e-05i, 0.00030534681176086855 + -0.000572867786570305i }, { 0.00014926931561687313 + -4.397914777804174e-05i, -1.81043080186791e-05 + -4.055615742551004e-05i, 0.05630822091476677 + 3.679079446026571e-20i, -0.002136465475352653 + -0.015928290371046216i, 4.762610787615366e-05 + -0.0004239025782442901i, -0.00012171925838125018 + 2.611532480494168e-06i, -0.015362693200554103 + -0.005912577823938535i, -0.0010896347246089665 + 0.004570086789998689i }, { 6.77705476279317e-06 + 4.3893500688599286e-05i, 0.0002382227807119505 + -7.01874650776695e-05i, -0.002136465475352653 + 0.015928290371046212i, 0.0898637533630004 + 6.706378401508704e-21i, 0.00011810516674241672 + 2.9556176199301663e-05i, 7.600774349274348e-05 + -0.0006765171430109043i, 0.0022554276798188617 + -0.004121412753207458i, -0.024517721397302926 + -0.009436036633340307i }, { -0.016772010569009628 + 0.006435827508750857i, 0.0024569156798560613 + 0.004500222650529818i, 4.762610787615367e-05 + 0.0004239025782442901i, 0.0001181051667424167 + -2.955617619930165e-05i, 0.13958540157731503 + -4.4006899922656665e-20i, -0.00529619630115079 + -0.03948547426579221i, 0.00043894344440953414 + 0.00010428833346923759i, 1.2846211999702412e-05 + -0.00012812386798513392i }, { -0.0011841771365027319 + -0.0049886033187304425i, -0.026766887617645483 + 0.01027110440602696i, -0.00012171925838125017 + -2.6115324804941874e-06i, 7.600774349274348e-05 + 0.0006765171430109043i, -0.00529619630115079 + 0.03948547426579221i, 0.22276797058472933 + -1.3186141369626355e-19i, -4.6155291895260385e-05 + 0.00012020998186621866i, 0.0007005212522773885 + 0.00016643646212342357i }, { 0.00019132892950507214 + 0.0003589563608683569i, 9.428096657781716e-05 + -6.77421619032428e-05i, -0.015362693200554105 + 0.005912577823938536i, 0.0022554276798188617 + 0.004121412753207458i, 0.00043894344440953414 + -0.00010428833346923802i, -4.6155291895260276e-05 + -0.00012020998186621865i, 0.12783154286522158 + 8.076494522425712e-20i, -0.004850227436700748 + -0.036160580111706475i }, { -0.00010879989989458864 + 4.050287571395548e-05i, 0.0003053468117608686 + 0.0005728677865703051i, -0.0010896347246089665 + -0.004570086789998689i, -0.024517721397302926 + 0.009436036633340307i, 1.2846211999702412e-05 + 0.00012812386798513392i, 0.0007005212522773884 + -0.00016643646212342357i, -0.004850227436700747 + 0.03616058011170648i, 0.20400968195106872 + 1.2544907703390718e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.061493828864978596, 1.0e-7), DoubleNear(0.09813959987891904, 1.0e-7), DoubleNear(0.05630822091476677, 1.0e-7), DoubleNear(0.0898637533630004, 1.0e-7), DoubleNear(0.13958540157731503, 1.0e-7), DoubleNear(0.22276797058472933, 1.0e-7), DoubleNear(0.12783154286522158, 1.0e-7), DoubleNear(0.20400968195106872, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, true}), Matrix({ { 0.11780204977974537 + 8.249256601793906e-20i, -0.0044696850334015395 + -0.03332346901949702i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03213470376956373 + -0.012348405332689393i, -0.0022738118611116986 + 0.009558690108729131i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0044696850334015395 + 0.03332346901949702i, 0.18800335324191944 + -5.802654828749101e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.004712343359674923 + -0.008621635403737275i, -0.05128460901494841 + -0.019707141039367267i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03213470376956373 + 0.012348405332689393i, 0.004712343359674923 + 0.008621635403737275i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2674169444425366 + 3.675804530160046e-20i, -0.010146423737851538 + -0.07564605437749869i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.002273811861111698 + -0.009558690108729131i, -0.05128460901494841 + 0.019707141039367267i, 0.0 + 0.0i, 0.0 + 0.0i, -0.010146423737851537 + 0.07564605437749869i, 0.426777652535798 + -1.1931650599287282e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.11780204977974537, 1.0e-7), DoubleNear(0.18800335324191944, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2674169444425366, 1.0e-7), DoubleNear(0.426777652535798, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true, false}), Matrix({ { 0.2814349402493782 + -2.851344456101883e-19i, 0.0074110891950553755 + -0.05387598904289488i, 0.0018906902480639361 + -0.0052069194788512555i, 0.028329031437818633 + 0.00565805415386085i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0074110891950553755 + 0.053875989042894895i, 0.24055186065656375 + 9.023497685994172e-20i, 0.024170333705334047 + 0.004879073241149213i, -0.00036373345504818987 + 0.005591810887299628i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0018906902480639361 + 0.0052069194788512555i, 0.024170333705334047 + -0.004879073241149213i, 0.22035362942748304 + 4.053244744699937e-21i, 0.006732097252151004 + 0.0493756670133107i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.028329031437818637 + -0.00565805415386085i, -0.0003637334550481898 + -0.005591810887299628i, 0.006732097252151004 + -0.049375667013310705i, 0.25765956966657444 + 1.327537810447223e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.2814349402493782, 1.0e-7), DoubleNear(0.24055186065656375, 1.0e-7), DoubleNear(0.22035362942748304, 1.0e-7), DoubleNear(0.25765956966657444, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, true}), Matrix({ { 0.08617260297415985 + -6.937390787312593e-21i, 0.0018800301750956584 + -0.017946566669316277i, 0.0005612124506436522 + -0.0017415825583218143i, 0.008674239602101962 + 0.0017395085058640116i, -0.018334571472148183 + -0.011906619614399235i, 0.0008068738686728295 + -0.0019285957051400526i, 9.660700501587307e-05 + -0.00015500519870413406i, -0.0016224671540867861 + -0.0015377315664225595i }, { 0.0018800301750956584 + 0.017946566669316277i, 0.07346082576973778 + -1.2093764344013766e-20i, 0.007384398676457699 + 0.0014932826127263335i, -0.0001737203543148286 + 0.0018557491711775256i, 0.0023187927744360995 + -0.008280731751569053i, -0.02520432671450693 + -0.004800312300378582i, -0.0024377548417245697 + -0.0009902513014160388i, 0.00040006873625006765 + -0.0007768189487345279i }, { 0.0005612124506436522 + 0.0017415825583218143i, 0.0073843986764577 + -0.0014932826127263335i, 0.06728119393429943 + 8.401500695967948e-21i, 0.0017027333948696588 + 0.016452822411054998i, 6.227312422487957e-05 + -0.000872925602431933i, -0.0026148391590110607 + 2.8835141695339484e-05i, -0.02310496382687946 + -0.004407968796834265i, 0.00212559454404433 + -0.0076098168136783i }, { 0.008674239602101962 + -0.0017395085058640116i, -0.0001737203543148286 + -0.0018557491711775256i, 0.0017027333948696588 + -0.016452822411055i, 0.07889078034346775 + 3.5095672165806464e-20i, -0.0020783037545124496 + -0.0008375742264574648i, 6.136072714401756e-05 + -0.00022749411882326128i, 0.0007374236517794457 + -0.0017854320780543655i, -0.01677545077097757 + -0.010940645660444576i }, { -0.018334571472148183 + 0.011906619614399235i, 0.0023187927744360995 + 0.008280731751569053i, 6.227312422487957e-05 + 0.0008729256024319332i, -0.0020783037545124496 + 0.0008375742264574648i, 0.19526233727521836 + -2.781970548228757e-19i, 0.0055310590199597175 + -0.03592942237357861i, 0.0013294777974202838 + -0.003465336920529441i, 0.01965479183571667 + 0.003918545647996839i }, { 0.0008068738686728295 + 0.001928595705140053i, -0.02520432671450693 + 0.004800312300378582i, -0.0026148391590110603 + -2.8835141695339494e-05i, 6.136072714401757e-05 + 0.00022749411882326128i, 0.0055310590199597175 + 0.035929422373578615i, 0.16709103488682597 + 1.0232874120395548e-19i, 0.016785935028876348 + 0.0033857906284228793i, -0.00019001310073336127 + 0.0037360617161221023i }, { 9.660700501587307e-05 + 0.0001550051987041341i, -0.0024377548417245706 + 0.0009902513014160388i, -0.02310496382687946 + 0.004407968796834265i, 0.0007374236517794458 + 0.0017854320780543655i, 0.0013294777974202838 + 0.003465336920529441i, 0.016785935028876348 + -0.0033857906284228798i, 0.1530724354931836 + -4.348255951268012e-21i, 0.005029363857281345 + 0.0329228446022557i }, { -0.0016224671540867861 + 0.0015377315664225595i, 0.00040006873625006765 + 0.0007768189487345279i, 0.00212559454404433 + 0.0076098168136783i, -0.01677545077097757 + 0.010940645660444578i, 0.019654791835716674 + -0.003918545647996838i, -0.0001900131007333612 + -0.0037360617161221023i, 0.005029363857281345 + -0.0329228446022557i, 0.1787687893231067 + 9.765810887891585e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.08617260297415985, 1.0e-7), DoubleNear(0.07346082576973778, 1.0e-7), DoubleNear(0.06728119393429943, 1.0e-7), DoubleNear(0.07889078034346775, 1.0e-7), DoubleNear(0.19526233727521836, 1.0e-7), DoubleNear(0.16709103488682597, 1.0e-7), DoubleNear(0.1530724354931836, 1.0e-7), DoubleNear(0.1787687893231067, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, true}), Matrix({ { 0.15345379690845928 + 1.4641099086553552e-21i, 0.0035827635699653172 + -0.0014937442582612787i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04143953529902764 + -0.0163145884112335i, 0.0029324684127171596 + -0.009538412518818352i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0035827635699653172 + 0.0014937442582612752i, 0.15235160611320553 + 2.3001907821792698e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.003056216426215545 + -0.010066163829623418i, -0.041979777485484496 + -0.015740957960823157i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.04143953529902764 + 0.0163145884112335i, 0.003056216426215545 + 0.010066163829623418i, 0.0 + 0.0i, 0.0 + 0.0i, 0.34833477276840197 + -2.825453107741437e-19i, 0.010560422877241063 + -0.0030065777713229047i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0029324684127171596 + 0.009538412518818352i, -0.041979777485484496 + 0.01574095796082316i, 0.0 + 0.0i, 0.0 + 0.0i, 0.010560422877241063 + 0.0030065777713229117i, 0.34585982420993266 + 1.9998685008287134e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.15345379690845928, 1.0e-7), DoubleNear(0.15235160611320553, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.34833477276840197, 1.0e-7), DoubleNear(0.34585982420993266, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, true}), Matrix({ { 0.15963342874389763 + -1.9031155131326358e-20i, 0.00038749209632882363 + 0.00011416661285571124i, 0.0 + 0.0i, 0.0 + 0.0i, -0.043538898186655114 + -0.016706931914777817i, 0.0004966757412659407 + -0.0009318241474386619i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00038749209632882363 + -0.00011416661285571124i, 0.14617197427776718 + 4.349717286177441e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00012363385136889715 + -0.0011004197212551943i, -0.03988041459785703 + -0.015348614457278842i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.043538898186655114 + 0.016706931914777817i, 0.00012363385136889715 + 0.0011004197212551945i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36235337216204433 + -1.758683136189202e-19i, 0.0011394646966869225 + 0.00027072479559266116i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0004966757412659407 + 0.0009318241474386619i, -0.03988041459785703 + 0.015348614457278843i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0011394646966869225 + -0.00027072479559266116i, 0.3318412248162903 + 9.330985292764784e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.15963342874389763, 1.0e-7), DoubleNear(0.14617197427776718, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36235337216204433, 1.0e-7), DoubleNear(0.3318412248162903, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));


}
}

}
