#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { 0.012017815212247207 + -0.17001463637585687i, -0.11150635083235376 + -0.2836613067793291i }, { -0.2854991696198897 + -0.5036230139325717i, -0.31695139842260606 + -0.3016110904426122i } }), Matrix({ { -0.030560003782573716 + 0.04152777374205933i, -0.5644244419831854 + -0.13495221241970648i }, { -0.0063553405228207165 + 0.04284382603292621i, -0.06578055281719959 + -0.12145728000613777i } }), Matrix({ { -0.1063368189127098 + 0.3163564565396399i, -0.21340150659233628 + -0.12320981603998747i }, { -0.21083448592261722 + 0.043375474021055585i, 0.3561500824069753 + -0.1710969606279749i } }), Matrix({ { 0.4156000529408697 + 0.38832309107142937i, -0.01290470367455032 + -0.23075902487676087i }, { -0.0009874025209570536 + 0.38733639776660994i, -0.13972531848249195 + -0.26463525671514393i } }) }, { QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.23151106732364202 + 0.06258979768684297i, 0.06134326698348252 + -0.4940003250415403i }, { 0.17339201158282225 + 0.32108655378940415i, 0.38246676782273537 + 0.2332599487427902i } }), Matrix({ { -0.3394717227498953 + -0.2905909532112282i, -0.1854082834169323 + 0.21051914921607542i }, { -0.3303355761404625 + -0.04525178881636596i, 0.1616365213636124 + -0.11520815044578109i } }), Matrix({ { 0.13398518620565086 + -0.0819177001009768i, 0.3170560743351492 + 0.13581138025008282i }, { 0.44548654121828535 + -0.061380114793548296i, -0.12455620615955901 + 0.5174977847609066i } }), Matrix({ { 0.19547722746666066 + 0.12544289737635123i, 0.12419995037574227 + 0.03852512388479064i }, { -0.4590618607729287 + -0.08304777389757928i, 0.1164107339758253 + -0.025827518897939716i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 0 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.017274311517888163 + 0.06015967108198134i, 0.01995649784502125 + 0.13897344300661704i, -0.03587757104412237 + 0.161679502368961i, -0.10021734591332043 + -0.05999591683891135i }, { -0.20602260811411466 + -0.11362236897635497i, -0.006745203252258992 + 0.026038398465487732i, -0.0455815489184705 + -0.02897079898354702i, 0.0016531776641641185 + 0.0034013200162228336i }, { -0.11163600164621004 + -0.08967776824233702i, 0.09391898815087465 + 0.07576444053722108i, 0.16507559099425437 + -0.0001377147523351265i, -0.024866419947992744 + 0.043478098138327294i }, { 0.07217687810844979 + -0.08503543836728633i, 0.112589450509713 + 0.06721910478243627i, 0.10398770492023725 + -0.0873975813087853i, 0.046515970967155394 + 0.024757017836704132i } }), Matrix({ { -0.1640543788635902 + -0.010185200411551739i, 0.05920447906281888 + 0.0631018907748245i, -0.02858409518470629 + 0.020753706312138253i, 0.08074819691237282 + -0.09702082158202797i }, { 0.0006058555189224542 + 0.0989056589559298i, -0.031126594863612522 + 0.07125323875009969i, 0.06445055188441785 + -0.10265784940254302i, -0.152359014846044 + -0.12208277507774115i }, { -0.11493636477511343 + -0.057324772771837146i, 0.006646831128327276 + -0.2061665581180145i, -0.030462324240107783 + -0.04082893769261088i, 0.028108149476070616 + -0.05709405913426727i }, { 0.020953246689015853 + -0.09600467807204781i, 0.11880545681186075 + 0.07978933637231046i, -0.018474847611937035 + 0.09958142891573923i, 0.007947788528882602 + -0.05472902216027495i } }), Matrix({ { 0.08931834749062217 + -0.07723430766931495i, -0.011006660522104037 + -0.0203039326549106i, 0.1828482998725295 + -0.03613890748414234i, 0.08036860495121893 + -0.07601593532722435i }, { -0.07472904190887979 + -0.17162760201331317i, 0.01411870370412189 + 0.08735993114640796i, 0.051951596787220014 + -0.05028903743823063i, -0.09436550097200493 + 0.025957648694012358i }, { -0.22105977470873284 + 0.08166660711485403i, 0.03001457034337595 + -0.05906916483895209i, 0.05457577930434887 + 0.04290240135792491i, -0.02846524860912648 + -0.09200208299852206i }, { 0.0737529283420078 + -0.018389458766230066i, 0.09485604740784498 + -0.0010373024038049389i, -0.06297011092894711 + -0.07939218833948367i, -0.0017698942924117428 + -0.0312769659137954i } }), Matrix({ { 0.04605619836433074 + -0.0364371743228799i, 0.04586573707339875 + -0.060126681303936565i, -0.04987277774648295 + 0.007834074951144987i, 0.06445331208664862 + -0.03221757267597585i }, { -0.016929547411171197 + -0.0778074698003034i, 0.051578713669143704 + 0.03279123763165306i, 0.01222117839420009 + 0.16893394729871763i, 0.013463472012456242 + -0.1267235922561936i }, { -0.12755267969208833 + -0.03148964599287015i, 0.020991208142858837 + -0.01691104530305506i, 0.0663980244784533 + 0.029631454513141135i, -0.03172733347846689 + 0.24850167531629783i }, { -0.2214036476449913 + -0.12721259304115795i, -0.0660691494774866 + 0.10720994032726254i, -0.09649646351391232 + -0.04170064847277921i, 0.009988373310543024 + 0.016296565743322874i } }), Matrix({ { 0.12170307444481944 + 0.1069363600227905i, -0.10235711387189966 + -0.0540823179811538i, 0.08611661188737137 + -0.10112207187991154i, 0.11848479251720971 + -0.036926842450973565i }, { 0.09052636669035358 + 0.0535769289367268i, -0.016075329710607197 + -0.13427963332549148i, -0.06993964114102771 + 0.034250376613067283i, 0.09654835916103237 + -0.1023336214338884i }, { -0.12473359118651488 + -0.025820423158788283i, -0.04991975536310732 + 0.05373608594076345i, -0.017060055717202684 + -0.008405160805092734i, 0.016442331040820875 + -0.011725718757486481i }, { -0.0017087210804414858 + 0.10830684458257267i, 0.07461424000019728 + 0.016148969116379603i, 0.05828300989564168 + -0.13348792488754402i, 0.01370627579510988 + 0.013195912642490459i } }), Matrix({ { -0.0105285702605794 + -0.08864053843058207i, -0.13554466746044652 + -0.1254414754011906i, -0.04180216386923725 + 0.04088688394569753i, 0.08838757611953503 + 0.03240728929822246i }, { 0.055275806626066744 + -0.1445605882083806i, -0.09618292910590141 + -0.09661948677982089i, 0.2077066798355658 + 0.029645080968497523i, -0.017496935134262537 + 0.012375813234448918i }, { 0.01630737783354089 + 0.14619447566205354i, -0.0917681816479238 + 0.11352382708289167i, -0.00457189256735488 + -0.020876731549386105i, -0.10701598496072513 + -0.048166135355762925i }, { -0.06749887026518955 + -0.11321180464892824i, 0.05095793583932919 + 0.042262147540411577i, -0.046112250081644504 + 0.20290603499964416i, 0.06895632103651199 + -0.06104022041362725i } }), Matrix({ { 0.02188110497691843 + 0.09179795248061363i, 0.18862677814461848 + -0.3065784257572855i, -0.01266299752641355 + -0.04597172526417378i, -0.10814574996706924 + 0.09808594534726733i }, { -0.1920114538972767 + 0.09467535634344314i, -0.02172378621097611 + -0.09900810897608797i, 0.1134535831358387 + 0.036871749719597884i, -0.10261627278061278 + -0.025204539720477814i }, { 0.06621468701255653 + -0.13310610612881513i, 0.016370355809892642 + -0.06164939442363021i, -0.016746296766786465 + 0.1441211079091903i, 0.014046114296068345 + -0.0782763967812024i }, { -0.12389547782626566 + 0.03291501843487882i, -0.15501519236645617 + -0.060105216292904606i, -0.043727402569673265 + 0.026268902464088414i, -0.10372193951718117 + 0.08894839294171585i } }), Matrix({ { 0.014006693428619543 + 0.03528250873697694i, -0.09734896785747561 + -0.19569792774409803i, 0.025398985794888543 + 0.02221522168425859i, 0.12069310367092029 + -0.1366071487782814i }, { 0.02472522011434434 + 0.015773314040885774i, 0.024946611372084357 + 0.11594482406866648i, 0.007451913810440957 + 0.017946884125584137i, 0.1363158746447404 + 0.024690069484033066i }, { -0.033118282515833014 + -0.10815089352530234i, -0.05200536464835483 + -0.01983159500566923i, 0.06222889996904496 + 0.11796480373862701i, 0.06997492308641488 + 0.2574404727246842i }, { -0.026772795743542906 + -0.012971203884915761i, -0.08209481015452465 + 0.030085945246537453i, 0.04886317000431622 + 0.12752851453909164i, 0.07885476566282078 + 0.03125736442626556i } }), Matrix({ { -0.05484237935684156 + 0.06320290151762405i, 0.0207842941117926 + -0.0578710998993014i, -0.07178780388606339 + -0.05973522326198405i, -0.041146199455909055 + 0.11892460166688293i }, { -0.09003418182843084 + -0.038026927606709185i, -0.18527786161562643 + -0.08187491656730786i, -0.07270522167563508 + 0.10426874682984909i, -0.07966784128067471 + -0.048406311447060965i }, { -0.013728526488280227 + -0.03774253027032758i, 0.0067560202815625595 + 0.008132617880154751i, 0.05217933548420621 + 0.14576417557908228i, 0.0021086674651512294 + 0.014038359926628373i }, { -0.04572159354171031 + 0.07783209775277962i, -0.09482975909454633 + 0.12125626599000604i, -0.016823281170171213 + 0.09336075483706564i, 0.04896314538384289 + 0.12305069599113323i } }), Matrix({ { 0.06284992567675239 + 0.03211682901632138i, -0.09089495545502309 + -0.11606976767652326i, -0.010327448728499476 + -0.06665319520921813i, 0.044904240599402956 + -0.05114418366370362i }, { -0.04966941413580908 + -0.06873111210183806i, 0.026884401152196084 + 0.18353880282089288i, -0.10998302244172017 + 0.006783163632894324i, 0.054368190263862234 + 0.13075890526701167i }, { -0.07558376685076151 + 0.06615596828176394i, 0.12505725785087035 + 0.03459608664412782i, 0.044939780711287 + -0.07167712212810377i, -0.04425200085355969 + -0.19413039035858057i }, { -0.04577829603923728 + 0.007709625016931596i, -0.04948423818547641 + -0.012578395397177308i, -0.006730332045286447 + 0.1895859859418549i, -0.11710192394900944 + -0.11104870856598933i } }), Matrix({ { 0.06815162293321686 + 0.02799225215276574i, -0.026426757027111853 + 0.06538330546040315i, -0.06794789913323665 + 0.008652548360264384i, 0.09352383496179795 + -0.17470684059519187i }, { -0.12113996070534766 + 0.044495895099612354i, 0.03430182185723909 + -0.013294809777026267i, -0.013220183495395688 + -0.06671568507267894i, -0.1353880153786095 + 0.11795819038284465i }, { 0.12216231665882717 + -0.04916509150343299i, -0.017030164565234172 + 0.04737146567316616i, -0.10786082015779004 + 0.008632111528161178i, -0.05055526784649565 + -0.026693230795042645i }, { -0.10792775957037869 + 0.11839041871049324i, -0.15815731843372774 + 0.11336729869864645i, -0.08436063867337402 + 0.02649015727710001i, -0.012466813820973664 + -0.11569845220661416i } }), Matrix({ { -0.01728488416946234 + 0.03482454903880878i, 0.004217109192003191 + 0.08318373482005337i, -0.2562345954564131 + -0.15418035690146886i, -0.10399109451636944 + -0.06342378817349434i }, { 0.12106803432634229 + 0.06126102124239123i, 0.08723583060032067 + -0.130103399577569i, 0.045823383675590454 + 0.07281389176994274i, 0.011402791419346693 + -0.12787278434668548i }, { -0.013124109056158581 + -0.15198577882765485i, 0.04513536265889839 + -0.03712125398085162i, -0.08220667824539267 + -0.049896406403463794i, 0.1855171720484697 + 0.1024495693644488i }, { -0.06388258514268831 + 0.19750837664191928i, 0.04580812106664945 + 0.07259906310040795i, 0.015160396007806071 + 0.15280154615907113i, -0.01284401548373405 + 0.010161965684960176i } }), Matrix({ { 0.0032091600521183235 + 0.005743221639846286i, 0.04584246433661974 + 0.10327911712682433i, 0.044732661604475005 + 0.031693486590227256i, 0.09870566755958123 + 0.08053010513417154i }, { -0.04880427038497233 + 0.033242846903702286i, 0.10275166025641852 + -0.107560286465472i, 0.1700036516304688 + -0.1167411980796699i, 0.0800198285387334 + -0.010631385143953375i }, { -0.12872427169493708 + -0.11203657925687037i, -0.03983551318685369 + 0.028475875233998058i, -0.08761605597211843 + -0.006008629541689576i, 0.08226983833376006 + -0.1048140744756389i }, { -0.023462589261639733 + 0.04219138201814376i, -0.04082588657739447 + 0.059095669228601225i, -0.033820810769173336 + -0.10153026809969042i, 0.18600239393860502 + 0.06444225182260725i } }), Matrix({ { -0.004156010467956178 + -0.09971007946434904i, 0.16628475039702512 + 0.058494955528334336i, -0.04315950618717378 + -0.08082851156787008i, -0.014936363932737224 + 0.02253729371748304i }, { 0.03700617334333812 + 0.10840026387615015i, -0.08204375176225517 + -0.06491087873421023i, 0.09882403433826147 + -0.08767360085877031i, -0.1010846995528765 + -0.03534537270276586i }, { -0.06061763084460771 + -0.07384659687470184i, -0.24070437755616825 + -0.035584917111029846i, 0.1591836260979876 + -0.04232930167770775i, 0.06918611225405862 + -0.019396182468141388i }, { 0.023465480649548447 + -0.03873508599925808i, 0.1880063127941778 + 0.0836851799519907i, -0.13809292669962409 + -0.0019210677996887849i, -0.0013668667854797325 + -0.011380380138148884i } }), Matrix({ { -0.17823872378801414 + -0.11359316303239606i, 0.10789516679245438 + -0.05692871966899686i, -0.09343464524115906 + -0.09795456377429536i, 0.0021165448598208752 + 0.1156216870191584i }, { 0.020948425326443792 + 0.019961607955872006i, 0.015931105055764467 + 0.0060397050730500975i, -0.00014707582687719945 + -0.16146727498812924i, -0.04414033068181447 + 0.09294666482974087i }, { 0.02944365559458412 + -0.006967299079479293i, 0.015595874315267905 + -0.002682519766045434i, -0.03972015624527302 + -0.10014934354617822i, -0.03536473865042096 + -0.08109651551137204i }, { 0.06682811382517544 + -0.04752728971067083i, -0.08925054542383018 + 0.04796917688831394i, 0.0005371611026346173 + 0.20287955624559323i, -0.0007426357226961892 + 0.17885512618487584i } }), Matrix({ { -0.08205194750793793 + -0.047488333924708165i, 0.05798831467015458 + -0.028924771018267945i, -0.05349278215922002 + -0.025353583212717468i, -0.18748145099988814 + -0.04821839969861976i }, { -0.19681131300705032 + -0.03696114681744239i, 0.04260427411194933 + -0.026908840291327528i, -0.1325892032651368 + -0.15456368534533144i, -0.00524151744049734 + 0.07650435014161322i }, { -0.09157186439109427 + 0.0188432181440315i, 0.008759453275851984 + 0.017045422428983072i, 0.019051547318866248 + -0.11774218734045576i, -0.07086109695841054 + 0.03125280631784616i }, { 0.011308496874251547 + 0.11986525167572931i, 0.008071998204001085 + 0.07715699060133503i, 0.024029716445880683 + -0.08976852093809302i, 0.19813274531821118 + 0.029540678935717157i } }) }, { QubitIndex{ 3 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.05293765691652719 + 0.08812104676398327i, 0.12876766065334233 + 0.2077714360883112i }, { -0.07072068953579976 + 0.13066720786294078i, 0.08414052926938095 + 0.00934443671559382i } }), Matrix({ { -0.054754667723072505 + -0.13686526743080524i, 0.305763043739177 + 0.02014429225690967i }, { -0.3183121078051403 + 0.24650286179183817i, -0.12920999587270682 + -0.3443795231102298i } }), Matrix({ { 0.10027616899531577 + 0.4073694165361183i, 0.54378164488015 + -0.35749215301918913i }, { 0.27726792375884296 + -0.11125690171463452i, 0.2911793999240645 + -0.2572597249233858i } }), Matrix({ { 0.25563356122562114 + -0.3666201129902953i, 0.33260500822809874 + 0.12530705477294174i }, { -0.5459985437270422 + 0.14285142840381437i, 0.03731644626397232 + 0.04130459939843362i } }) }, { QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.4523914880514659 + -0.008837471977922774i, -0.12685306892542447 + -0.29750842125243476i }, { 0.4138937362513026 + 0.041164517303533786i, -0.12268085747554419 + 0.4388086957007875i } }), Matrix({ { 0.2440959704864142 + -0.4295428779571692i, -0.03766358484577971 + 0.28795793616226145i }, { -0.08160316265441532 + 0.15901396769892845i, 0.04682396238926217 + -0.06603692720218833i } }), Matrix({ { 0.09455906949018965 + -0.18565601127177367i, 0.1519851628745017 + 0.05048032096910632i }, { 0.27888362799495714 + 0.3073343156296558i, 0.33617870135188105 + -0.06303645584246964i } }), Matrix({ { 0.02788659307866241 + -0.17086788533725553i, -0.31205198460888095 + 0.11050064517356237i }, { 0.14881148949022285 + 0.2801222339549292i, 0.1726690949151852 + 0.5611263490304376i } }) }, { QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.015809304160054882 + -0.0034567432488963124i, -0.0403628847751957 + -0.15460579287600776i, 0.014223040696994137 + -0.007597892969865971i, -0.021516063926144944 + 0.020935594430348106i }, { -0.07998278534946965 + -0.10667937928589817i, 0.12641480957225032 + -0.07195990915041255i, -0.10392212785380721 + 0.00013802354475403664i, -0.050170743222759495 + 0.05200688090720614i }, { 0.0375921832400469 + -0.16446157769398254i, 0.03369128813790944 + 0.029473886678124173i, -0.05550535869503635 + -0.11589373771773315i, 0.05069656487745039 + -0.016881436806278564i }, { 0.12924026737920474 + 0.03690447714020557i, 0.08154939028463534 + -0.01921507736632357i, 0.03199960876965447 + 0.004765816742065276i, 0.1009611417947834 + -0.01211853485935921i } }), Matrix({ { -0.12335626825135805 + 0.013828641207494182i, -0.12065109905383192 + 0.045611277289709276i, -0.0376908559277622 + 0.03519751886764844i, 0.03399009356800839 + -0.04286757361584744i }, { 0.02584722082193287 + -0.06925055801670209i, -0.11820140241419586 + 0.09570245112024174i, -0.0369326070131799 + -0.15811786630641883i, 0.04802200882898504 + 0.12982431209567785i }, { 0.062680188705023 + 0.04699570616574091i, 0.13504742370609338 + 0.0120384372308677i, 0.05137951566308221 + -0.047371036755261456i, 0.05043170335918757 + 0.10945491947734527i }, { -0.15012460882623732 + -0.031038529712773915i, 0.10759174523261389 + 0.11548251788602121i, 0.07490702164505988 + -0.160429392615355i, -0.020740667921417762 + 0.05854917808401798i } }), Matrix({ { 0.0672756759154229 + -0.020258599279493944i, 0.11107056353329961 + -0.14118763172424675i, 0.030827112187610684 + -0.037405943059293165i, -0.0635892963852038 + 0.021999189431163794i }, { -0.07886122580692692 + -0.03117244522228315i, 0.025251998983884447 + 0.13609124275970808i, -0.17578778041304863 + -0.15505627100300692i, 0.06222000251085247 + 0.05862762505310086i }, { -0.05618376767720762 + -0.016940842581108638i, 0.021671369775456133 + -0.044348468314025835i, -0.01854301311303545 + 0.052160294588019525i, 0.05235927761108117 + -0.06653202453299474i }, { -0.16655519666306204 + -0.003142586083718344i, -0.16621281539779872 + -0.022145304143928103i, 0.12432439812333855 + -0.08764468789244238i, 0.009331371851145407 + -0.09879454118105235i } }), Matrix({ { -0.08655924684880024 + 0.15822638305099765i, 0.07375363818332967 + -0.056419511216539896i, -0.08156780664493765 + -0.07744921839427275i, -0.021991796344598958 + -0.06100102742902295i }, { 0.21320672760328466 + -0.007488457988227176i, 0.026112700803084973 + -0.0906517694675221i, -0.07147558723394164 + -0.08673853184617752i, -0.1532144396576048 + -0.029707425799051484i }, { -0.06819505468130647 + -0.006802832081405135i, -0.004380779518082486 + -0.08558532863971165i, 0.0769956822425637 + 0.004045039418750359i, -0.06465690649136291 + 0.025513911665023318i }, { -0.03542870159550783 + 0.03652873526432891i, 0.05538696808209207 + -0.0989382479455786i, 0.07205016123491437 + -0.040694831850375215i, 0.0915609522094544 + 0.0727082157412273i } }), Matrix({ { -0.06260112564743198 + -0.04380760667713132i, -0.022129344721993422 + 0.09009728362869303i, -0.09654929029949198 + 0.09300527462283599i, 0.10843616960402289 + 0.09974036465773806i }, { 0.023688621374801676 + -0.21977366706191775i, -0.14458566610504447 + -0.035627508695077435i, -0.0159134161755898 + 0.08008948732499531i, 0.2047224830360478 + -0.019165883821339307i }, { 0.137695304777141 + -0.09791805465712651i, -0.21120244205300603 + 0.05686435477999836i, 0.04113223296452266 + 0.1032093317198017i, -0.02647084143236747 + 0.06408564439575777i }, { 0.06099604797523535 + 0.021560106359716783i, -0.06267205593082482 + -0.11970073835407012i, 0.1770610601222314 + -0.1360457264651871i, -0.08544275183529494 + -0.09671881373178255i } }), Matrix({ { -0.12880621990543897 + -0.052249297023927464i, 0.03988604685773715 + 0.04583529799154674i, 0.12689383736081655 + 0.034177740916043566i, -0.10017898985636325 + 0.14757837156893486i }, { -0.025451161397704116 + -0.029908207765776643i, -0.03952574871048672 + 0.012678612400007653i, -0.1733062586449692 + 0.11252572724546393i, -0.08356288249105705 + -0.09709800273931522i }, { 0.016894939887359902 + 0.07480327415056477i, -0.02828527252982197 + 0.03405496885731123i, -0.004561220362496909 + 0.03557294066596619i, -0.08425314441201737 + -0.05744038951117482i }, { 0.011141243486805274 + -0.0342331778683894i, -0.11439244703759555 + -0.1139043159775058i, 0.00633226397818557 + 0.04654840229266148i, 0.02966308470086899 + -0.01413294749794842i } }), Matrix({ { 0.08704808412577114 + -0.08777943312614334i, 0.02650801254060567 + 0.0072985815734954535i, 0.058295231825755564 + 0.21193501782769084i, -0.0898207865403438 + 0.058020899251883334i }, { 0.009972634385779881 + -0.011994973894617818i, 0.025201881742802825 + -0.04599155495882734i, -0.11498773086055347 + 0.02415077552483287i, -0.10197733482287823 + -0.15776029347892429i }, { 0.029014316848290426 + 0.01621871174877492i, 0.07276744213800627 + -0.13613654055921917i, -0.05471631510209843 + -0.11341498572656866i, 0.04429550427418473 + -0.10340049457075123i }, { 0.13136654230311703 + -0.07722346054406473i, 0.041814204924138954 + -0.029872494220914207i, 0.16618843936622762 + -0.002459553599308401i, -0.10843040371246047 + 0.037863666515108065i } }), Matrix({ { -0.04167580350526685 + 0.01398867725633066i, 0.09234147634207848 + 0.029020685408653615i, -0.041163502882903505 + -0.002804055106787066i, -0.1520836726051201 + 0.006854738643098899i }, { 0.19715114354649335 + 0.2033295075368714i, -0.021748550293085037 + 0.15500693437883137i, -0.12970762259537444 + -0.029699664041369984i, -0.124064536655683 + 0.07232584847485775i }, { -0.050176644906958674 + -0.0769932244703042i, -0.011130065665810655 + -0.13271401130367563i, 0.1236148136341487 + -0.08258962157618605i, -0.047673268804785 + -0.023121847008404018i }, { 0.04697030670242771 + -0.05119496861717855i, 0.15177957297517136 + 0.057357901842377906i, -0.1445025191064692 + -0.002505792365160273i, -0.14462655284642692 + -0.09542650346799034i } }), Matrix({ { -0.01989734896674845 + -0.1156581896255181i, 0.02672342573683512 + 0.007405391099181778i, -0.020826473366262997 + 0.13107299754542287i, -0.10617991606770437 + 0.05224278110821579i }, { 0.13533129797606316 + 0.029475865505832165i, -0.020720112686538564 + 0.06287651902449663i, 0.05750128400044202 + 0.0035556150434616885i, 0.12791098323336736 + 0.1424944783730715i }, { -0.006298530113622487 + -0.04788669559495438i, -0.08761080848399799 + -0.08787093972573826i, -0.03238736057768827 + -0.07644364987398734i, -0.1668687356748704 + -0.11843027441016923i }, { 0.08481720142434741 + 0.008668218115249857i, 0.10986825463969084 + 0.18867079072661555i, -0.004033493963544363 + -0.007882600104950302i, -0.13223508086611388 + -0.009733437041173893i } }), Matrix({ { -0.11055194397409872 + -0.02961283544018848i, -0.14652147604885996 + 0.012740204688386223i, 0.05302728952197035 + 0.09621960696731004i, 0.048773899592555785 + 0.04914363977389928i }, { 0.012605843237168868 + -0.03689045269398999i, 0.09318954841546044 + -0.008332729971563663i, 0.07542626326603273 + 0.14553697473071656i, -0.060046890234253185 + -0.022853561561757826i }, { 0.23701002155160572 + 0.02578639816464875i, -0.14846292700634736 + 0.06643700970030067i, 0.04114277215204783 + 0.008772038333692505i, 0.07926992196541521 + -0.10256263944491292i }, { -0.08149079521598654 + -0.05268762087465425i, -0.11720305705316865 + 0.052509310083490426i, -0.01721125941246128 + 0.1409399600604152i, 0.030168800578380436 + -0.04241327767059157i } }), Matrix({ { 0.16507252545350196 + 0.08194979242315092i, 0.06286454557069372 + 0.016168445232439235i, 0.004355205014301565 + 0.10724770397518785i, -0.10597021269821322 + -0.05705632420698978i }, { 0.0014673979835075688 + 0.12738524262732967i, -0.052600787301790096 + 0.01629407284467357i, -0.003537768949548691 + 0.1938860578005268i, -0.07067297031019724 + 0.15009448223385793i }, { -0.08665301889074012 + -0.009525054471758703i, 0.030332133221300704 + 0.12276899709313206i, 0.10128184135245986 + 0.046051134770006504i, 0.111244715607799 + 0.037140649260252206i }, { 0.07106168399702968 + 0.0005212343718543034i, -0.028015502416685482 + 0.038861317947489586i, 0.027438828871549338 + 0.08421107171195215i, 0.0834927047932052 + 0.05110215207128575i } }), Matrix({ { -0.10282640817354266 + -0.03441186650347937i, 0.04201529807628461 + 0.1066051078667603i, -0.08017234170510742 + -0.06903742331480464i, 0.03811840081252653 + 0.09975915556421068i }, { 0.17396059978587275 + 0.04072721665960899i, -0.026553010324537964 + -0.0983046571041437i, 0.08725898574837765 + 0.055371081879997654i, 0.02232009925357853 + -0.07201318466361636i }, { 0.0688197301109374 + -0.06834910077616632i, 0.07942415523459347 + 0.03264339709640092i, 0.01699938198563101 + -0.054612723533344606i, 0.0022381518848012504 + 0.04295448115606952i }, { 0.04390740731542524 + -0.035813617942423936i, -0.12308715639443644 + -0.0030188211308587965i, -0.005172323314705814 + 0.0848398403825871i, -0.06407670614243349 + -0.06164549282882543i } }), Matrix({ { 0.013115054330324049 + 0.02461751731376i, 0.13364946084506676 + 0.08147877809592512i, 0.08219240440331502 + 0.076182498857443i, 0.007659329190985159 + 0.06991461529678934i }, { -0.014958351401392829 + -0.11723888644086417i, 0.028428203275574614 + -0.017424709119980168i, 0.008293266366830813 + -0.041244402628464454i, 0.03790785932005991 + 0.053418319839437525i }, { 0.09841605204223043 + -0.05205226648541973i, -0.11511951059560231 + -0.06114707199767521i, -0.05087290078770633 + -0.05787072556996177i, -0.06775726634069192 + 0.06184791001352957i }, { -0.049698334065238714 + 0.13966069899842434i, -0.045700100734942954 + -0.06516897176700931i, 0.004391945328373709 + -0.08817208463617056i, -0.08566834602163197 + -0.05654779535910186i } }), Matrix({ { 0.028562287740715977 + 0.015082905498379446i, 0.04932236662960178 + 0.027396261915874767i, -0.01674635071511895 + 0.0006134729184162742i, -0.019184727743888304 + 0.1269142109739872i }, { 0.11898910649610817 + -0.011664246883230242i, 0.08459520326693049 + 0.003718848812872201i, 0.08849653035713216 + -0.049351601135667014i, 0.21049286249948804 + -0.13312371283959926i }, { 0.07401078345801189 + 0.003133855428163108i, -0.0630929021328533 + 0.13616594779862068i, 0.14036052474346417 + 0.061851342066516435i, 0.008393592243371327 + -0.21629765941417964i }, { -0.013368938424141701 + -0.09206620191630074i, 0.12319431764630541 + 0.01361324743926701i, 0.04945342513388138 + 0.12314705081112622i, -0.07978811185137889 + -0.1199144179331525i } }), Matrix({ { 0.05010319238218992 + 0.07675667021827987i, -0.1626968342069658 + 0.17930852685918905i, -0.17206649579058977 + -0.14077256002906874i, 0.0710339716202641 + 0.025506980099608088i }, { -0.040505162069054364 + -0.04427422818836661i, 0.06958258391700503 + -0.18722053083782614i, -0.14349373618795072 + 0.17036535463335625i, 0.05393090661130001 + 0.04568294762266923i }, { -0.10673440186720272 + -0.19341247174504012i, 0.07491946180893964 + 0.013085800506947947i, -0.11177585076240644 + -0.028037801252809094i, -0.004452756017579427 + -0.18297013691100378i }, { -0.09119233426768411 + -0.09730775944634897i, -0.15084462805904922 + 0.06376046019021446i, -0.04630591300469336 + 0.15634272391678028i, 0.156486112980948 + -0.10051529244121829i } }), Matrix({ { -0.02720804098008697 + 0.10580184666258663i, -0.01021737396872219 + -0.10482031529994178i, -0.10044893641632754 + -0.13664215235291927i, 0.06040670512856618 + 0.13808345198267058i }, { -0.021891027927143477 + -0.10176730230136438i, 0.11673228743183175 + 0.15712110708138793i, -0.07013711767547633 + -0.07572338357219226i, 0.0485505792838228 + 0.19806459487968592i }, { -0.03824178095434398 + -0.21249691860261175i, 0.00905112551508949 + 0.04670394419920041i, -0.021039967638894663 + -0.02976916860580882i, -0.05217885770298244 + -0.0753310172773672i }, { -0.19060550927401018 + 0.007684993270075444i, -0.09239996301136827 + 0.04098579389224708i, -0.06758681240128146 + 0.10860566054474992i, -0.06717293121998402 + 0.09407286796219809i } }) }, { QubitIndex{ 4 }, QubitIndex{ 8 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.059885592909767915 + 0.03647039141150657i, -0.04414466104511453 + -0.06663612187625545i, 0.031377979151900326 + 0.03365895278623364i, 0.030664962862690708 + 0.0007187996236783153i }, { 0.0798840416446187 + -0.04439228644842477i, -0.013984147789779725 + 0.015604173138288624i, -0.03845757951132867 + 0.006464697833296848i, 0.05772456406896634 + -0.12616818442088396i }, { 0.11392411301263308 + 0.048937015913272784i, -0.02786861630081671 + -0.05274227541370579i, 0.05869037205662619 + 0.1874954935756371i, -0.14279557977395588 + -0.15123680491885305i }, { 0.14079036720303234 + -0.04536947949583841i, -0.07724425996772054 + 0.09541611775767365i, 0.11275148971456057 + -0.0139904362539226i, -0.060033289089105615 + -0.0638008947717044i } }), Matrix({ { 0.1032845637000712 + -0.09882708034608441i, -0.024200786624579685 + -0.01151836518682993i, -0.15873099769906712 + -0.012076289328755577i, -0.13680153013931087 + 0.12566178398034236i }, { 0.1605344289322449 + 0.0355742187481441i, -0.08948024632826637 + 0.09663499169299085i, -0.06503905741749187 + -0.2266997289587579i, -0.05976089427700047 + 0.0006728466955248522i }, { -0.05946401116707202 + 0.015250564500514163i, -0.1795105808677922 + 0.1118544736153211i, -0.1247598970680624 + 0.058750293164894336i, -0.03551838501203199 + -0.10103758806960247i }, { -0.08843835290385244 + -0.10422096121720913i, -0.06694345174752099 + 0.0051026437562623865i, -0.05885386400624758 + -0.012512975238310664i, -0.09991884608209634 + -0.03154968994846458i } }), Matrix({ { 0.027100493925460132 + 0.060240196856067185i, 0.008740243227070073 + 0.03421854369390208i, 0.05716775975265342 + -0.07082100600009063i, 0.1268160041545232 + -0.052184226009165495i }, { -0.06212255324994983 + -0.10962986150456822i, -0.07276761099496658 + -0.043781620328748834i, 0.002825041932880045 + -0.031462819855463404i, -0.0101712318890461 + -0.0971508811822691i }, { -0.059755663325783394 + 0.10360265558851027i, -0.013872222458523696 + -0.057221739977008565i, 0.027830938955548203 + -0.11461463127970219i, -0.06227265404643145 + -0.062812028270141i }, { -0.016039342858458167 + 0.007872227466479116i, -0.08685128415286414 + -0.20841584163832635i, 0.016657978869759744 + -0.03406362576119192i, 0.05227175195749372 + 0.031569452604967026i } }), Matrix({ { -0.012744624907623488 + 0.02350191180292464i, 0.06347773889530843 + -0.002633668754890459i, -0.02555682299787852 + 0.0028897238444892254i, 0.06046389255075369 + 0.07317502802406987i }, { 0.054060209497498915 + -0.0411666046431056i, -0.13109494308071376 + -0.06520765506609655i, 0.01120150875625529 + 0.0011324820477994922i, -0.04609400492357585 + -0.027295937660767728i }, { -0.03307490188621454 + -0.012128035894347614i, -0.12016076912207377 + -0.1908468664925062i, -0.13319898742276762 + -0.05361320432380371i, -0.019059565630395126 + -0.08997629762322394i }, { 0.02073028082110869 + -0.024871979372721325i, 0.12644322518049225 + -0.13332923191746407i, 0.01839807619418178 + 0.053143478439359855i, -0.13457934305579078 + -0.05758545028760616i } }), Matrix({ { 0.08551056706400588 + -0.0050896438661764114i, 0.294762371550416 + -0.10017316792498819i, -0.16602354312072676 + 0.0038355809640596337i, -0.017141142878338452 + 0.018386482195185395i }, { -0.06601064517103922 + -0.16442298024215554i, -0.0606528174081949 + -0.13646382410198063i, -0.01958117976707926 + -0.05115680940572038i, -0.02189432082288473 + 0.12537369387867164i }, { 0.09847060477264898 + -0.15937039027828476i, 0.1273334432767545 + 0.06591985811592282i, 0.10098918329992514 + 0.04619082461443926i, -0.10113949289093006 + -0.09872035422965243i }, { -0.047739719101721 + -0.06595900380914574i, 0.024813562989746366 + 0.019448200010281403i, -0.012010209334174337 + -0.19381142960506667i, -0.06335563877057074 + 0.06409520090090212i } }), Matrix({ { -0.0741962866046643 + 0.16621317201507163i, 0.02107468388938798 + 0.013546939888457498i, 0.029610694216602215 + 0.12043387682728222i, -0.06957530213853474 + 0.024155538907040478i }, { -0.06935684540070833 + 0.05768532301063907i, 0.13782574219759305 + 0.053478441352795295i, -0.06775526529193027 + 0.09932804620526162i, 0.11707092971392481 + 0.009341116331523798i }, { -0.0009753715289170638 + 0.11040535297825557i, 0.09958268824050454 + 0.06159233093738446i, 0.19315892277415622 + 0.07085653307173413i, -0.016860518530208347 + -0.12563766973128357i }, { -0.010030172168676483 + -0.11704895098276388i, 0.04966773498075049 + 0.004696650189227902i, 0.04278909000027145 + -0.14275385709131064i, 0.04198886501151601 + -0.14131985332288682i } }), Matrix({ { -0.07533918459141072 + 0.0018371147334740735i, -0.06436875427392587 + -0.11288753286046825i, 0.10563457704406377 + -0.16334405063345017i, 0.17131224122894836 + 0.016317296707883833i }, { 0.17243778416809208 + 0.1298058674204315i, 0.0902822604922362 + -0.03255476398056922i, 0.07413760400309943 + -0.005714138755756827i, 0.1095989137795271 + 0.09607185284484174i }, { -0.041694197820535975 + 0.05601809789671046i, -0.1733246170905501 + -0.14591948914078937i, 0.022080107012715386 + 0.09024997864255722i, -0.07067934753552103 + -0.17253325198959593i }, { -0.16280243640302267 + 0.07192451023998161i, 0.022364666874145938 + 0.004939959762611816i, 0.19547872080875153 + -0.22449622092741797i, -0.013287919064022147 + 0.02392639945000081i } }), Matrix({ { -0.07076477819189891 + 0.13658116633191714i, 0.03262259139178005 + -0.03528145828075895i, -0.19957623652369436 + -0.0004816898433642756i, -0.062421242639681636 + -0.1801107581433396i }, { 0.1016397300576598 + 0.02358583749260325i, -0.01933878955315238 + -0.017861887810940565i, -0.026054427465434897 + -0.038732482734416214i, 0.06878917162023786 + 0.0392364677555806i }, { 0.07730674328679082 + 0.11612110740235898i, 0.023669413316544926 + -0.07582134790782068i, -0.07706132718467101 + 0.08514750367997803i, 0.06983221420164469 + 0.09337785768739815i }, { -0.06655988858442541 + 0.08380747833307942i, 0.021496286942670962 + 0.054173925015708696i, 0.03516461012804121 + 0.0916088568070672i, -0.14985793627978036 + 0.05546748218221901i } }), Matrix({ { -0.012594816820250217 + 0.03590436627432437i, -0.03630780834356717 + -0.08297307642603317i, 0.0565985543268282 + -0.047554799904131376i, 0.09580256801687054 + -0.10574858216837117i }, { 0.0705909743834774 + -0.060608802425360285i, 0.06142799234443315 + 0.025913318457817816i, 0.030753588119917852 + 0.02495742594317078i, -0.007673578007723647 + -0.1378400209465046i }, { 0.01797895996881902 + -0.02127762216933467i, 0.024211102448248867 + -0.0978237968813193i, -0.00945543300693351 + 0.05666336359899225i, -0.011771669825778848 + 0.04516623524019825i }, { 0.041656053968197194 + 0.022011109988300477i, -0.1707285163815722 + 0.006205994415813261i, 0.04631312852708413 + 0.06766839805210946i, -0.10534125640301031 + -0.06044034247397257i } }), Matrix({ { -0.08204171326142193 + 0.18801349175151982i, 0.01299295123669164 + 0.05701474269731944i, 0.12565778619782564 + 0.03293292755384855i, -0.08671018717514917 + -0.06997228905445803i }, { 0.08978750891773532 + -0.18455672647465965i, -0.07795090342312992 + -0.06845797289264953i, 0.01876582593427126 + -0.025813433971734676i, 0.020926682412415718 + 0.025660901563243705i }, { 0.015479196828942367 + -0.15670557997145063i, -0.011314460506988448 + 0.03521051215603787i, 0.003221309292695457 + -0.19692900877648173i, -0.11752146847394009 + -0.09609169581050836i }, { 0.09830985842373448 + 0.007318299472236043i, -0.06340321114742249 + -0.1286786455648766i, -0.14768596924022986 + -0.0784565716168929i, -0.03656653384021927 + -0.05315443321107058i } }), Matrix({ { 0.023082837088032934 + 0.03315519711758889i, 0.14121701148030447 + 0.05774616830727656i, 0.053019959253181925 + -0.05346599541616569i, -0.05716526602541448 + -0.12787898547759485i }, { 0.04840141353291749 + 0.2684409643736571i, -0.003181574139752704 + 0.05632924313629396i, -0.030928073413151548 + 0.010552112223309418i, -0.005172553121207545 + -0.016695996716549574i }, { -0.07712633691136901 + -0.028857338299357365i, 0.04844653866929821 + -0.08523370725903594i, -0.022973342353376 + 0.07441008413318904i, 0.07583204365928808 + -0.04563534757342373i }, { 0.04825647827025607 + 0.0966456186714527i, 0.07451344175133323 + -0.07543552208476118i, -0.17808997001348004 + -0.11272256643552046i, 0.05488428648167005 + 0.060512490090850655i } }), Matrix({ { -0.06598419261102077 + -0.03949263181980315i, -0.0109973949208027 + 0.016621263601799514i, 0.08455004061664045 + 0.06520937613483711i, 0.06224104907664031 + 0.18302938499723415i }, { -0.11379865453616392 + -0.1573428778466374i, -0.010702372181014006 + -0.0017365144259366351i, -0.07417202563206186 + 0.06147842755549676i, 0.014870942618093255 + 0.004821274194393506i }, { -0.06269628811730195 + -0.21714540101048518i, 0.09343956953284233 + 0.055628460354265614i, 0.017376173495909673 + 0.06064521984999643i, 0.004410796720115623 + 0.03663856670669062i }, { 0.004715620990734546 + -0.00539649996332465i, 0.08027702902620001 + 0.02960329346005226i, -0.05753386161023233 + 0.028819654717306693i, -0.05993943052424341 + -0.014403111368590401i } }), Matrix({ { -0.034057607196238265 + -0.0681787637952829i, -0.0009673815911414715 + -0.08456545885765879i, 0.15180131327467872 + 0.022245668035429014i, 0.09349063630965886 + 0.043063413283429185i }, { 0.07690000404227446 + 0.005877706723143588i, 0.13367123599533656 + 0.07757359447709884i, -0.062314298405423386 + 0.07752879264910462i, -0.011366961790261787 + 0.006494866049145373i }, { 0.07661501276618246 + -0.08145221245290393i, -0.029905048948256917 + -0.08124154676248517i, 0.07456688765564617 + -0.1010663254820895i, 0.1654336655379582 + 0.021925298786951167i }, { -0.09882054043238847 + -0.09248314042757153i, 0.09767690613940772 + 0.2119376589825901i, -0.040421746610039624 + -0.04304592986033472i, 0.0689229741473327 + -0.10536318611337857i } }), Matrix({ { -0.014228984941930518 + -0.023252967175840727i, -0.10347037881095278 + 0.1681737640719017i, 0.05872749578679522 + 0.20232088511860213i, 0.12302455988028145 + 0.19499661829105047i }, { -0.011150814023045734 + 0.2190520962181229i, -0.10111547827065975 + 0.10690878663813033i, -0.05171622617072789 + -0.15699776620111544i, 0.0350559758052094 + 0.09868221392164045i }, { 0.03497610830487483 + -0.01638734256375936i, -0.07520099897764164 + -0.00338948994274227i, 0.11012529272601349 + -0.01575506366173934i, 0.06300836469193594 + -0.166089347816233i }, { -0.07762736078252448 + 0.08172681442298806i, 0.04071625299157788 + -0.16885683045470506i, 0.07520711917125036 + 0.0592420991554571i, -0.14882380744836732 + -0.052217309451675534i } }), Matrix({ { -0.11489098117536423 + -0.07416511403816721i, -0.03972372135279962 + 0.17014423493833852i, 0.038311073256433875 + -0.09126809954911065i, -0.010474315283061576 + 0.08329209792845749i }, { -0.09305229162404088 + -0.11642395876304754i, 0.02342268736276789 + -0.08485822205340245i, -0.08839806203247251 + 0.1400237385618178i, 0.04067169845561282 + -0.019596647801186612i }, { 0.029087740308110257 + 0.10239674724158608i, -0.15650932217355817 + -0.1424292214823376i, 0.04039347008414634 + -0.03881562375381875i, -0.13608610494649073 + 0.06842873790678713i }, { -0.04823905218097818 + -0.03663248571330136i, 0.006000579765666098 + 0.024095360679678147i, -0.027370815140132634 + -0.022515450741556697i, 0.023562059915404956 + -0.043308182098999996i } }), Matrix({ { 0.11360101662871094 + 0.04792223932655787i, -0.07491008707272945 + -0.01539880661576652i, -0.04140780031505007 + -0.020839942249978607i, 0.022546760337866085 + 0.030449390180859195i }, { 0.04645004430631776 + 0.05320847201086117i, 0.023901225418321584 + 0.06039660181024413i, -0.0070798139773714545 + 0.12011422704127421i, -0.13832438912526782 + -0.01712136283237596i }, { -0.10368305936160896 + 0.051687950934634484i, 0.10371122946496833 + -0.07981955837165636i, -0.023211155867719407 + -0.1074890003601791i, -0.18276490892479716 + 0.2447752740254206i }, { -0.10183771276694138 + 0.09212878155388081i, -0.09229737351788458 + -0.012518355033255647i, -0.08177619822595411 + 0.030376067404694118i, 0.13112179136861765 + -0.03505821866880698i } }) }, { QubitIndex{ 6 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.14187640591642192 + -0.5367660689057312i, -0.06119368635425415 + -0.10618922086893859i }, { 0.2984752339784626 + 0.20955960415758917i, -0.20467576489803943 + 0.28490468296929633i } }), Matrix({ { 0.3994833750646064 + 0.4128369956211497i, 0.03583430066805411 + -0.27721788407320047i }, { 0.10565735363215542 + 0.10066922175346826i, 0.3470118856210688 + -0.05531734806626756i } }), Matrix({ { 0.06971882028785548 + -0.01002836631353202i, 0.7511360028492555 + 0.024241260282729923i }, { -0.12593846354500277 + 0.11199011025838942i, 0.08652605657774229 + 0.14691557071406408i } }), Matrix({ { -0.0864491599232364 + -0.20608904041561235i, 0.22806229895789015 + 0.031863080281847506i }, { 0.14080661350847345 + -0.3229477412267208i, 0.05013207138909995 + 0.10440524584078252i } }) }, { QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 8 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.07014477852998291 + 0.018079989694821864i, 0.09514157353147167 + -0.018391557393781496i, -0.2531272776893584 + 0.012443840065121973i, -0.013838409847768606 + 0.11247956920198982i }, { -0.06619160573509396 + 0.046951178986022225i, -0.11348244626173179 + -0.0018247258765538776i, -0.032310424282186126 + 0.19740763102085104i, 0.0027870336337452993 + -0.11260190632829677i }, { 0.07717832730008752 + 0.1997735477439456i, 0.061175216873104246 + -0.08483492855293373i, 0.12374751760853715 + -0.20151994186737007i, -0.05335456532345537 + -0.0046377623673954415i }, { 0.008794837293451348 + -0.10013920783988765i, 0.06478784063191446 + 0.003630126699061878i, -0.03194719005961023 + 0.1128555902430062i, 0.07060087650953442 + -0.03494528791253186i } }), Matrix({ { 0.23542302904688256 + -0.07345139183307614i, 0.09900659682867943 + 0.024484135471327072i, -0.10517251597774584 + 0.08195952923790921i, -0.12018817979169 + 0.06410359877749407i }, { -0.07516167906718162 + 0.055569862838327544i, 0.19654265090626782 + 0.030195412328879245i, 0.08467192022059626 + -0.0034746186185469798i, -0.13083868517081557 + 0.08987250093989999i }, { -0.05343871664285857 + 0.06580154368470847i, 0.014716075567186623 + 0.0599329940782291i, 0.05912482860541715 + 0.07205638032417556i, 0.07768714097534397 + -0.15388005863822665i }, { -0.0889882565405114 + -0.10979666482984257i, -0.12250680119438083 + -0.1250435441677969i, -0.2190233854529812 + 0.0749233962812098i, -0.037460953906439345 + 0.003980386140315025i } }), Matrix({ { 0.030708120972038275 + 0.03005395681077267i, -0.02515897324719127 + 0.0485703459092231i, -0.08112410346332699 + -0.05537170352191766i, 0.000593484777656577 + 0.09803297839318022i }, { 0.09055457884017733 + -0.12206167152195589i, -0.01340627365215887 + 0.2411089874118565i, 0.09861975156088212 + -0.05691566058864502i, 0.07448057252957742 + 0.015847487750278777i }, { 0.015377767944292563 + -0.034862847104092695i, -0.08415582191562145 + -0.2068643538522959i, 0.0667672690438061 + 0.07878986193361397i, -0.08139299719775261 + -0.03495984312565863i }, { -0.07699234460961951 + -0.0036679512873403755i, 0.16066127445114375 + 0.1546526449531696i, -0.0708537214338825 + 0.01618319053675149i, 0.008991331524879591 + -0.01816134664327068i } }), Matrix({ { 0.11656592187806009 + 0.04369592326197773i, 0.059769446217470656 + 0.09063123825865613i, 0.06615607802480869 + 0.027352307412248453i, 0.09796379428520133 + -0.17555611817990516i }, { 0.03248952919174611 + 0.04392716608778501i, 0.015583576411232102 + 0.0012739419081891736i, 0.10789513410356011 + -0.09254357542478482i, -0.002318265320049819 + 0.11270158296892958i }, { -0.03638707914893952 + 0.14277576224049982i, -0.004458409201605839 + -0.0059887522889155225i, 0.121385446102162 + 0.018084535257332474i, 0.03914839030673175 + 0.18392503668519722i }, { 0.08194089009221221 + -0.03508983670976442i, -0.06800048176526796 + 0.011154101848694307i, 0.16041993679417593 + 0.13136604732825732i, 0.007298989655868723 + -0.05393718506031899i } }), Matrix({ { 0.061058593025982 + 0.05357247101735983i, -0.1278912622951746 + 0.029311229475184927i, -0.008197446218180497 + -0.009382516118251428i, -0.0808130468881984 + -0.06610823041026864i }, { -0.05862494792893147 + 0.23660318479000989i, 0.24990673846642306 + 0.0819056842756374i, 0.001506722131774594 + 0.02620057859469061i, 0.015637142581471294 + 0.06383531126669849i }, { 0.05079032054355863 + -0.11684457650657722i, -0.004700437537165593 + 0.04544830594684073i, -0.02689570793010098 + -0.082564312018783i, 0.03090890813874091 + 0.02769295526430628i }, { -0.037778318759340915 + -0.1274867229470204i, 0.16540011578610037 + -0.033547080358568904i, -0.14397544319671932 + 0.08272047386649006i, 0.0809000625757849 + 0.026990607400262445i } }), Matrix({ { -0.005194935103452616 + -0.007817103090153626i, 0.05788765693230618 + 0.14034971693476897i, 0.057372889319474166 + 0.08501461351926948i, -0.05905005534015466 + 0.07103284363423036i }, { -0.034419898917680415 + -0.02427970794947999i, -0.08554975259706062 + -0.07157315572048245i, -0.05469483129117967 + 0.029822396566360255i, 0.1031785900735782 + -0.25061552653369396i }, { 0.03975036753153726 + 0.020946959212436438i, 0.12237838504485668 + 0.04965616016825201i, -0.0264215904318072 + 0.08542234553735006i, 0.14961774330519356 + 0.013376165533242907i }, { -0.03466627854978064 + -0.029939844693736544i, 0.08292825586996588 + -0.007485619718059283i, 0.034212923178772676 + 0.08596161432088714i, -0.03308313364822352 + 0.14579851441331157i } }), Matrix({ { 0.015217895159085884 + 0.07346621141363806i, -0.0196441933782605 + 0.009861283211248172i, 0.025203110029949908 + -0.07152526081676393i, -0.0013257911878069718 + 0.012759415054574006i }, { -0.0009788401687157663 + -0.03596129706590457i, -0.006366262777232005 + 0.08215610289622208i, 0.03853219374983964 + 0.08613150429840284i, -0.03775105168223698 + -0.025669060980033593i }, { -0.08041410410183294 + 0.13088417376266492i, 0.06124813976890021 + 0.08808148968556678i, -0.03620201300741192 + -0.045800176810007025i, -0.10717925405999247 + -0.1475703035797886i }, { 0.03929585777939973 + -0.10464417342269214i, -0.047574744708893044 + 0.04421619381946688i, 0.021286777684217422 + -0.057938520137998537i, -0.12510713459809653 + 0.023897452257448316i } }), Matrix({ { 0.20081481564723483 + -0.03998565923091815i, 0.13978838961993045 + 1.8853406159444823e-05i, -0.010895526510956367 + -0.15865602972815257i, 0.06990103470555163 + 0.03108906129128385i }, { 0.11403715429223071 + -0.13518735594801218i, -0.08115916063982424 + 0.14428591586593942i, 0.003515059110397578 + 0.1857454097542246i, 0.04418443916893657 + 0.04091055294354267i }, { 0.10127486390835458 + -0.01461568679176262i, -0.14973343200609718 + 0.17148354195362692i, -0.039734267024186275 + -0.04527482417863826i, 0.0003820854260949293 + -0.020248156071281408i }, { -1.8804436168350872e-05 + 0.06307127288195577i, -0.2274953889533564 + -0.016555151908648338i, -0.1294632938085226 + -0.040475399345165766i, -0.06441376995403097 + 0.03148542091171282i } }), Matrix({ { 0.06638625177925102 + 0.04220786179927211i, 0.015071899556086933 + 0.04911081087771593i, -0.017474463803317956 + 0.067903021104271i, -0.06390105087810556 + -0.17936178895397822i }, { -0.18251989363511936 + -0.07002164948406567i, 0.07183330929581677 + -0.007732778437486163i, -0.01631704490498445 + 0.0670531181433857i, 0.21450001916558245 + -0.06947977570495527i }, { -0.10068544781716207 + 0.0036598167489747748i, 0.12614023003024563 + 0.095521901427459i, -0.017363545753073154 + 0.08167589418669362i, -0.1420989050355078 + 0.1567130090155325i }, { 0.06587677261386132 + -0.09085050360284087i, 0.03761572468921065 + -0.04083207092941006i, 0.050322559414955434 + -0.06906291842298995i, -0.08636510244671364 + -0.004649370474163325i } }), Matrix({ { -0.2406806976780233 + -0.034615852138964495i, 0.01668653534219238 + 0.004508794163964685i, -0.027416143897519816 + -0.08321727563349379i, -0.031028013572601314 + -0.03624775837860534i }, { 0.09046899479880534 + -0.07344072684676174i, 0.026298510516463383 + 0.12589635233202445i, -0.15197213433231005 + -0.1478599600968122i, -0.037224826199714456 + -0.14001617020038107i }, { -0.07920188848614593 + 0.00011217744797494575i, 0.05350042680479606 + 0.021313447167836834i, -0.07119193945804649 + 0.04413151590062693i, 0.020603702717325856 + 0.06917309174526792i }, { -0.011354455168500309 + 0.12041012062052622i, 0.10900900567833903 + 0.04651119170426i, 0.010616130325568006 + -0.07206970639319243i, 0.06895988790955948 + -0.017332609433084734i } }), Matrix({ { 0.0696352055748026 + -0.058293712936205784i, -0.04194484223748282 + -0.08334704529602444i, -0.07948217411499627 + -0.011038286303987344i, -0.07405152656518944 + -0.024591556566391833i }, { 0.06705605973117335 + 0.10518982165036787i, 0.007711244325884144 + -0.07579204956606399i, 0.041644786261182336 + 0.0033893939949628817i, -0.10149551488704235 + -0.04501395002352423i }, { 0.10401587354758607 + 0.1241707438379641i, -0.06508636856517958 + 0.06213828054077074i, -0.10435976883841866 + 0.14068479410539708i, -0.025070471845675787 + 0.1826940034325993i }, { 0.06458750895668836 + 0.022633315424005655i, -0.15874995783370482 + 0.016919919991059552i, 0.0008901930332413447 + 0.04641230279900115i, -0.05569934427410752 + -0.020409753273108785i } }), Matrix({ { 0.0867228904258502 + 0.031715576029818865i, 0.12653091864410135 + -0.14791737763300766i, -0.08497843573007065 + 0.04051536416854607i, 0.060584803083345726 + 0.024271025673774867i }, { -0.028992300239601927 + 0.031189369066848438i, -0.049658012486765775 + 0.024968212332411956i, 0.05687058703847255 + -0.07550476145333729i, 0.03623383244319048 + 0.1433637867355497i }, { 0.17828869293482508 + -0.05026030557941694i, 0.15162817461985553 + -0.05254997877944332i, 0.05726318922363218 + -0.09693807740897764i, -0.08177270088815962 + -0.2647026937998914i }, { 0.030813182714695506 + -0.028118709305307975i, -0.00878040146923358 + 0.1350504209782329i, -0.02800078028944605 + 0.006572752503963777i, 0.063581062736276 + -0.015572177865141002i } }), Matrix({ { -0.12269652568274607 + -0.021850036430279836i, -0.020983867258490958 + 0.1237547719802305i, 0.008327170144522686 + -0.014882189423595349i, 0.03568336502588567 + -0.12451053229370711i }, { 0.1110208302171103 + 0.028148352657237752i, 0.017697875828109295 + -0.17225213219283975i, -0.010119445841334012 + 0.004069055596415465i, -0.07969764279218808 + 0.1521084809568438i }, { 0.015174816928339054 + 0.04328980184792696i, -0.06608363832937109 + 0.03737638156415858i, -0.017336035310614308 + 0.08342168394738464i, -0.08399870281659547 + -0.08916774106164521i }, { -0.21043970369378184 + 0.03808351411595121i, -0.025880486746250687 + -0.13849335573218577i, 0.08384610697294165 + -0.08085837074276833i, 0.11594992390258088 + 0.0226367925570092i } }), Matrix({ { 0.03454222149443444 + 0.02176816236821252i, 0.04599269337031187 + 0.008123395106903311i, -0.06433728817187069 + 0.1268842471417368i, 0.03239720913702859 + -0.05301833370678216i }, { -0.032333752418189955 + 0.05586674580202193i, -0.04130439328511424 + 0.1381036765687347i, -0.22196332091042106 + -0.1938410344979978i, 0.026554147880040086 + -0.08520458425167347i }, { 0.0685422363598952 + -0.051369966824588255i, -0.028912218435381824 + -0.08814608134830731i, 0.10386446867680123 + 0.033485655351174315i, 0.08216180481109168 + 0.05875585958503889i }, { 0.0745404013427911 + -0.20661981569216026i, 0.05694864405279263 + -0.019033468773763933i, 0.1679703374421657 + -0.07394491554734584i, -0.1588513940598877 + 0.07243916852539195i } }), Matrix({ { 0.027704795416981808 + -0.11240585533799438i, 0.02007100987968905 + -0.006650275113085883i, 0.010300229987310231 + -0.0191409341993605i, -0.008435204443044677 + -0.07241512010644366i }, { 0.016408171394199922 + -0.006097699698772051i, 0.05006321913026672 + -0.0672950740987564i, -0.13252344958750245 + -0.00453482659121611i, 0.12342687861799338 + -0.06117072846683896i }, { -0.020711827337736632 + -0.10626242947948897i, 0.025813006620199093 + 0.04520587132425007i, -0.023248613527400784 + -0.2100024458293443i, 0.048282925296270415 + -0.001492083925264752i }, { -0.07116360158705337 + -0.0891026096388241i, -0.017039618147665837 + -0.03871347142112982i, 0.07218446990712835 + -0.06653192672348616i, -0.09400855463317954 + -0.07370016378014095i } }), Matrix({ { 0.04812276800143342 + -0.0543160076479509i, -0.027216620665413662 + -0.031081383122206437i, 0.035954932886658644 + -0.039302418145418294i, 0.06074600111529582 + 0.0029945375936112134i }, { 0.10111794391894499 + -0.1770592809853295i, -0.018761784964776995 + 0.015606958999814598i, 0.15489514087463255 + 0.06658319252907674i, 0.02300513648549668 + -0.016742834876763608i }, { 0.06255155910642399 + -0.15144815205641823i, 0.11311383289624388 + 0.039771999243188846i, -0.040852407758459136 + -0.028163991757102304i, 0.031360900821243896 + -0.2047999159382481i }, { -0.080430454930554 + -0.007136292683453768i, -0.08741008405150529 + -0.06062099594343836i, 0.026486550023186714 + -0.06617985512126079i, -0.0714570917805832 + 0.01949160811602138i } }) }, { QubitIndex{ 4 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 0 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.02183263111267686 + 0.10766414673388407i, 0.09286171983945571 + 0.004050946591553311i, 0.022799124376619323 + 0.01890181125806297i, 0.0398833625757045 + 0.050335594753396655i }, { -0.02662543168785768 + 0.09323507027544911i, 0.07972506006808609 + -0.00022132155851558292i, -0.005927076200711657 + 0.11075889165630196i, -0.10639253186671743 + 0.10981990550462713i }, { 0.019818553870027237 + 0.022111717242537424i, 0.0969088845750725 + 0.08958083874309894i, -0.14518433954782045 + -0.1940401784775063i, 0.08279956376385995 + -0.007711930679534465i }, { -0.04015188588710893 + 0.050938221895691145i, 0.049272985675672946 + -0.12814456444464387i, 0.030720063206220664 + -0.024455228446785642i, -0.044933440790437276 + -0.001047467287251734i } }), Matrix({ { 0.004805483712735989 + 0.030303862799910805i, 0.018982715520726022 + -0.12075539680925754i, 0.11579029119005038 + -0.036937304386918834i, 0.1458148948465631 + -0.05637660113859548i }, { -0.05005272859132062 + 0.04064298660721087i, -0.010445477060435115 + -0.15647801355292246i, 0.09618922159471721 + -0.04282729774386349i, 0.013236262660594059 + -0.0124918298010248i }, { 0.08522103890061841 + 0.029986170142060085i, 0.021598174314153288 + -0.090110782647979i, 0.005021891845813313 + 0.027742508991916458i, -0.006792248685544853 + 0.16597327305721477i }, { 0.015602776887622197 + -0.040982162296261594i, 0.05045003964107825 + 0.10521873771913555i, -0.04832984764728054 + 0.20764623132608712i, -0.03277418997276331 + 0.043933112961163596i } }), Matrix({ { 0.015457351071432035 + 0.18700043305552744i, 0.17981764779176884 + -0.013773279755535627i, -0.07414327671553012 + -0.16437381644542723i, 0.10908875251985195 + -0.11963934432980756i }, { 0.221295468297501 + -0.07325632328301432i, 0.00042694681300913786 + -0.03763327384162633i, -0.02962500598839712 + 0.00423596973347725i, -0.036029930513826545 + 0.011167289989869952i }, { 0.06809652627380028 + 0.11423114877555282i, 0.06293649562267918 + -0.15715465642922452i, 0.0210229510140924 + 0.037049824011548674i, -0.09308087048334093 + -0.06224396457235976i }, { 0.09767310141873353 + -0.031624309292517534i, 0.06359882166262974 + -0.06766250823088699i, 0.07509172143048135 + 0.013989185980512407i, -0.15477865010554603 + 0.22415899250105611i } }), Matrix({ { -0.016647814545280346 + -0.09591057166091844i, -0.031086987497522974 + -0.05745273794078844i, -0.18015769735519477 + 0.0819653890491951i, 0.03810052477454545 + -0.028720459963349435i }, { 0.10793004867875895 + -0.06205764450948201i, 0.029785117069386448 + -0.027718524636557013i, 0.026358818682541925 + -0.048900379195284484i, 0.001660424069713593 + -0.12421131989879207i }, { 0.009806924632007014 + 0.1466352223937517i, -0.08482603670987021 + -0.025703332970277566i, -0.08962103805606779 + -0.06378277100753703i, -0.041478597419189626 + 0.16060928173014755i }, { 0.004643730822205238 + -0.1492315495055086i, -0.11377862002416 + 0.19426315605390412i, -0.007999878861581796 + 0.03868366475409062i, -0.0805656726089184 + 0.20136399403648828i } }), Matrix({ { -0.04672085358164198 + -0.003556642298396602i, -0.010017352903613035 + -0.11566128057751354i, 0.017212813593150564 + -0.16967346277757403i, -0.08612821709721138 + 0.03508178510160183i }, { -0.1924808395794189 + 0.011000325138306802i, -0.021418782849559937 + -0.06427357726645212i, -0.001168787429271982 + -0.024285069177638417i, -0.07243463379391726 + 0.05265115476565184i }, { 0.05623063637992854 + 0.03258474796738628i, 0.061044971467053386 + 0.11214653456636497i, 0.053769804538784854 + -0.14093172363171946i, -0.06624131881178047 + -0.05922170768274641i }, { -0.043764207753059205 + 0.08098786505987596i, -0.029658167944101595 + 0.0649001063444607i, 0.03863439544621782 + -0.0125361501793142i, 0.06608400618037162 + 0.003123325075625746i } }), Matrix({ { 0.16183291290916907 + -0.042603666123245766i, 0.040418148191494516 + -0.046473016117194524i, 0.08901896465147817 + 0.17414356068185038i, 0.004929234911512512 + -0.028430216084101397i }, { -0.11924502462931084 + 0.05576881417233556i, 0.09974417223668279 + -0.09686380892567663i, -0.01984048529518953 + 0.08503263155737811i, -0.020083570122503735 + -0.042327369922169754i }, { -0.00212554376510725 + -0.02186758752670242i, -0.06108930304591589 + 0.08556540185682801i, -0.056327832235307684 + -0.029059524538441517i, -0.10660063690249474 + 0.09778231712449757i }, { -0.0786733049669311 + 0.04193312030675277i, -0.0595028260992152 + -0.030764687250929117i, 0.09574378230371323 + -0.25469571604806746i, 0.043131991027013976 + -0.021226570273734844i } }), Matrix({ { 0.14555963969903102 + 0.10208881939704656i, 0.06125925166764985 + 0.0744709606086194i, 0.02883622501523317 + -0.07657714460697967i, 0.026886592013535476 + -0.18580950105630398i }, { 0.0014360129162539065 + -0.19978711915213093i, 0.07979136962500585 + -0.06335893589530517i, -0.12718943549926018 + -0.05101898275907219i, 0.19625364539269122 + 0.02970882372040282i }, { -0.11176781400060838 + 0.06804434535033257i, -0.09028822817217164 + 0.10019519124133831i, -0.022179940866774845 + -0.06628873668112639i, -0.05367181805677118 + -0.07264545260891758i }, { 0.0779589963914669 + -0.02158740599160003i, 0.05970291630961592 + -0.125689428839971i, 0.02591636042914658 + -0.027782977754842186i, 0.038519828086977445 + 0.0443788200173154i } }), Matrix({ { 0.03694540631226617 + -0.035304176132955015i, -0.13769261891612644 + 0.09157982334874763i, 0.014861321837247723 + -0.060388519843765906i, -0.15473551780444347 + 0.005917900143303896i }, { 0.015205009422048558 + -0.047083215615514054i, -0.19627725421509695 + -0.028632763240926163i, -0.16475489232041873 + 0.06140225297507928i, 0.07541300127818351 + -0.08141350638764923i }, { -0.06502208931504352 + -0.04084946029893234i, 0.03420073122683192 + -0.03799206569160677i, -0.14792897321435625 + -0.1881243649911942i, 0.14314948648544318 + 0.04522844539229085i }, { 0.00966741333814078 + -0.09902809938239775i, -0.004055079923040927 + -0.024385932441150227i, 0.19443473655183824 + -0.037452485830045956i, 0.007482622387417921 + -0.08450631654040876i } }), Matrix({ { -0.1922300770221555 + 0.064145319883963i, 0.11581475691972999 + -0.08142231211450233i, -0.01909785386340224 + -0.03308723637546197i, -0.10409801583342075 + 0.022531165139056297i }, { -0.03327721568719173 + 0.01700382933318377i, -0.0943899529840874 + -0.02328550664394956i, -0.08674037327468934 + -0.017406931519637285i, 0.05683443602475451 + -0.007726307065360659i }, { -0.1784657017029766 + -0.005102962189323986i, -0.11057961318734859 + -0.09493792269554971i, 0.06524025751183861 + -0.03904742864236523i, 0.13812660769336685 + 0.029197614621936943i }, { -0.1402309948982941 + -0.1350281229000839i, 0.12999732822877744 + -0.08909632733452261i, -0.07463783997194208 + -0.0002995848506084522i, -0.06149887400811929 + 0.02027360691166244i } }), Matrix({ { 0.04459719335369645 + 0.07465408269847829i, 0.19175918995468005 + 0.025240542589365714i, 0.036595614697862516 + 0.1045539799788919i, -0.17703238950298572 + 0.18233197957874772i }, { -0.10541650620119417 + 0.030266316859824696i, 0.19382256602829062 + 0.051531680674223826i, -0.009996632844044891 + 0.00574858193056271i, -0.03418432681955524 + -0.03426672663615373i }, { 0.07737567069854999 + 0.0781438943333075i, 0.04535309389876232 + 0.12483437229077937i, 0.06918676236524421 + 0.04196512885909026i, 0.17674622319455854 + -0.031161333810347806i }, { -0.05799215172285795 + -0.07297486868522211i, -0.02040511841366029 + -0.07931529589902703i, 0.044064429026843224 + -0.33262657429677467i, -0.08404289535123131 + 0.016349850253623257i } }), Matrix({ { -0.05871340249624231 + -0.026068299381800174i, -0.05650169236384509 + -0.21468881522259556i, 0.029550244903382733 + -0.04133662601568505i, 0.07272735440301135 + 0.09176163010365758i }, { 0.06084761838081606 + -0.0479578152272281i, 0.06407897671281426 + 0.038833614580197816i, -0.01573239875496476 + -0.09775517670651138i, 0.141400700630229 + -0.04138875736088682i }, { -0.026120378383399277 + -0.14835846675781794i, -0.116385137503513 + -0.027135761060606813i, -0.010889016238939625 + 0.10613131078305321i, -0.04629010963023025 + 0.10885710018214614i }, { -0.04211584633244324 + 0.14795714646155694i, 0.006404031741508327 + -0.06622558685555953i, -0.10009221700992561 + -0.014034347261521349i, 0.07044255397438744 + 0.12990223723657057i } }), Matrix({ { -0.06831010626939354 + 0.07846435247010466i, 0.01731246874492954 + 0.02323916152292031i, 0.10237195747044253 + 0.031786567073789324i, 0.031466238296328775 + -0.025665907046935773i }, { 0.07114181239489742 + 0.10263536469594699i, -0.13722075865163938 + -0.011953585919779621i, 0.04917847886909071 + 0.06895202491788845i, -0.12528728928210284 + -0.08115774771176222i }, { -0.05592170692715098 + 0.20322758307033706i, -0.15058092118621422 + -0.13465415090244606i, 0.1017733964015254 + 0.02476278508989682i, -0.2368312913704788 + -0.10638738326286595i }, { -0.04396463384301171 + -0.051010923509839226i, 0.0007268170029711032 + 0.02506636755988336i, -0.031555019833304325 + -0.08318604513298698i, -0.12115687729726879 + 4.735737019741788e-05i } }), Matrix({ { -0.08326512636613674 + -0.07449074180117679i, -0.013912569874788817 + -0.08973882115935884i, 0.03597815827003188 + 0.028963044369069862i, -0.004066763080302175 + -0.010357071735675367i }, { -0.06229576314340937 + 0.10099064058655915i, -0.14465292485017583 + -0.047493788547852835i, 0.09711415314819567 + -0.0066799792379561825i, -0.045488074182834334 + 0.019765470288088i }, { -0.04287944668525539 + 0.08317776023614644i, 0.0578196499689437 + 0.11182388909012686i, 0.04251302974042577 + 0.07703469230464893i, 0.026913988767732346 + 0.08468481848353916i }, { -0.03944190897970972 + -0.029061196467131643i, 0.07079249589853298 + 0.09525530405529418i, -0.0100883012134666 + -0.05723376654005274i, 0.013120691647222368 + 0.02729522855831691i } }), Matrix({ { 0.0024347749263127372 + 0.06489019368879327i, -0.1182862663224132 + 0.10584130449332005i, 0.19598471191983777 + 0.06683470106942886i, 0.09675136655916673 + -0.047701423407582495i }, { -0.009123140793280565 + 0.07122035456251509i, -0.00034523292136717586 + -0.02327249021560089i, -0.10054000335351397 + 0.014713456674767578i, 0.042196532751421725 + -0.10170244419505856i }, { 0.006182682338908903 + -0.060864417291779827i, 0.000676857630990573 + -0.03859475545370707i, 0.1575013146948915 + 0.059579443792454834i, 0.12195986702176242 + 0.012980314356959764i }, { 0.005798206426835498 + -0.2575793747192051i, 0.044616619867581316 + -0.04140991492634599i, -0.11854628200918682 + 0.03896904300466656i, 0.04439943266559464 + 0.01309560306759948i } }), Matrix({ { 0.07393020896626763 + 0.01751240075141607i, 0.02080496791768062 + 0.20698091538546806i, -0.1161628316336882 + 0.02369606557615461i, 0.04223116310848531 + -0.07854909971704471i }, { 0.006561221624467451 + -0.1419882860881443i, -0.16819731407031596 + -0.02195826604225099i, 0.030209423097692884 + 0.052382479507053555i, -0.012697032848395687 + -0.03940351796112583i }, { 0.08120009894355285 + 0.012029596448066494i, -0.038611663780253144 + -0.03875960838722848i, -0.01984837511834449 + 0.07491255456903814i, 0.10055783423753364 + -0.0627835650002658i }, { -0.049502831016338934 + 0.06517135215052909i, 0.11324021603247755 + -0.07761049225345054i, -0.02904541920122116 + -0.05660891540792609i, -0.00837734516385003 + 0.02547426584366465i } }), Matrix({ { -0.029049642137973036 + -0.1761194763694122i, -0.10060271675628017 + 0.01648742615128919i, -0.08842499973861921 + 0.04111929037091266i, -0.04270203842128137 + -0.028708961332723305i }, { 0.10282097294226684 + -0.22338837456018248i, -0.145899764387932 + -0.045085987085283566i, 0.008696997340800296 + -0.027892609011431622i, 0.041427188040842645 + -0.035110970809434205i }, { -0.06215221935163317 + 0.02709903986358156i, 0.07951283556158056 + -0.06656025901753695i, -0.11348791159786441 + 0.007486360986712418i, -0.13477497037459044 + -0.0765371585318676i }, { 0.08658398282813214 + 0.06486668440159747i, -0.031164475944946503 + 0.04494702297123936i, 0.007068554135741934 + 0.14732705164769988i, 0.23599483743978794 + -0.09733917698068617i } }) }, { QubitIndex{ 7 }, QubitIndex{ 1 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 9_15_2_100_0_50) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, false}), Matrix({ { 0.42301718193794163 + -4.674713179540754e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.576982818062059 + 3.6195331488711226e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.42301718193794163, 1.0e-7), DoubleNear(0.576982818062059, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, false}), Matrix({ { 0.5314979513996654 + 4.682171857258914e-19i, 0.06354579136889266 + -0.0372238537738397i }, { 0.06354579136889266 + 0.0372238537738397i, 0.46850204860033523 + -1.5301100263418668e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5314979513996654, 1.0e-7), DoubleNear(0.46850204860033523, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, false}), Matrix({ { 0.6931755110548898 + 3.164959528308102e-19i, -0.026582725399474046 + -0.1905583526936325i }, { -0.026582725399474046 + 0.1905583526936325i, 0.3068244889451108 + -1.2897697391054717e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.6931755110548898, 1.0e-7), DoubleNear(0.3068244889451108, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, false}), Matrix({ { 0.5011601570792579 + 1.091069304993837e-19i, 0.0011039408918418316 + -0.00023029027244829688i }, { 0.001103940891841836 + 0.0002302902724482969i, 0.4988398429207427 + 2.0609925259232102e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5011601570792579, 1.0e-7), DoubleNear(0.4988398429207427, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, false}), Matrix({ { 0.49172342292305005 + 1.0625946230546989e-20i, -0.029667133982421066 + -0.013324456742211348i }, { -0.029667133982421066 + 0.01332445674221135i, 0.5082765770769505 + 3.0458023686115773e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.49172342292305005, 1.0e-7), DoubleNear(0.5082765770769505, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, false}), Matrix({ { 0.506427377215642 + -6.703680895790661e-19i, -0.03398196103237179 + -0.001979146844940752i }, { -0.033981961032371805 + 0.001979146844940752i, 0.49357262278435854 + 9.855742726707708e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.506427377215642, 1.0e-7), DoubleNear(0.49357262278435854, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, false}), Matrix({ { 0.4828315260923913 + 1.0146587386962006e-19i, -0.04846399024199076 + -0.05023916069883742i }, { -0.04846399024199076 + 0.05023916069883742i, 0.5171684739076092 + 2.1374030922208465e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4828315260923913, 1.0e-7), DoubleNear(0.5171684739076092, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, false}), Matrix({ { 0.5685799180607346 + 4.2249091010035316e-19i, -0.007292329881192587 + -0.006966784694000827i }, { -0.007292329881192586 + 0.006966784694000826i, 0.43142008193926595 + -1.0728472700864847e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5685799180607346, 1.0e-7), DoubleNear(0.43142008193926595, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, false, true}), Matrix({ { 0.42301718193794163 + -4.674713179540754e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.576982818062059 + 3.6195331488711226e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.42301718193794163, 1.0e-7), DoubleNear(0.576982818062059, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, false}), Matrix({ { 0.22483276560687537 + 3.1108751801592e-20i, 0.0 + 0.0i, 0.026880961588885328 + -0.015746329724279678i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.30666518579278995 + 4.371084339242994e-19i, 0.0 + 0.0i, 0.036664829780007326 + -0.021477524049560028i }, { 0.026880961588885328 + 0.015746329724279678i, 0.0 + 0.0i, 0.19818441633106626 + -7.78558835969996e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.036664829780007326 + 0.021477524049560024i, 0.0 + 0.0i, 0.27031763226926897 + -7.515511903718707e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.22483276560687537, 1.0e-7), DoubleNear(0.30666518579278995, 1.0e-7), DoubleNear(0.19818441633106626, 1.0e-7), DoubleNear(0.27031763226926897, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, false}), Matrix({ { 0.29322515127483184 + 8.499515928481105e-20i, 0.0 + 0.0i, -0.011244949586715647 + -0.08060945735119673i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.399950359780058 + 2.3150079354599913e-19i, 0.0 + 0.0i, -0.015337775812758397 + -0.10994889534243577i }, { -0.011244949586715647 + 0.08060945735119673i, 0.0 + 0.0i, 0.1297920306631098 + -1.317422910802186e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.015337775812758397 + 0.10994889534243577i, 0.0 + 0.0i, 0.17703245828200098 + 1.3045252134111313e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.29322515127483184, 1.0e-7), DoubleNear(0.399950359780058, 1.0e-7), DoubleNear(0.1297920306631098, 1.0e-7), DoubleNear(0.17703245828200098, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, false}), Matrix({ { 0.21189722698062174 + 7.346000483442728e-21i, 0.0 + 0.0i, 0.0004669859650929904 + -7.714394421795535e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.28926293009863613 + 1.0176093001594098e-19i, 0.0 + 0.0i, 0.0006369549267488412 + -0.00015314632823034153i }, { 0.000466985965092993 + 7.714394421795524e-05i, 0.0 + 0.0i, 0.2111199549573199 + -5.409313227885027e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0006369549267488429 + 0.00015314632823034167i, 0.0 + 0.0i, 0.2877198879634228 + 2.601923848711713e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21189722698062174, 1.0e-7), DoubleNear(0.28926293009863613, 1.0e-7), DoubleNear(0.2111199549573199, 1.0e-7), DoubleNear(0.2877198879634228, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, false}), Matrix({ { 0.2078384304188289 + -6.930456057857297e-20i, 0.0 + 0.0i, -0.012111703537177693 + -0.00391804272066433i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.28388499250422117 + 7.993050680911995e-20i, 0.0 + 0.0i, -0.017555430445243374 + -0.009406414021547018i }, { -0.012111703537177693 + 0.0039180427206643295i, 0.0 + 0.0i, 0.21517875151911275 + 2.2557428783165437e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.017555430445243374 + 0.00940641402154702i, 0.0 + 0.0i, 0.29309782555783775 + 2.820228080779923e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2078384304188289, 1.0e-7), DoubleNear(0.28388499250422117, 1.0e-7), DoubleNear(0.21517875151911275, 1.0e-7), DoubleNear(0.29309782555783775, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, false}), Matrix({ { 0.19384951414210605 + -7.290251211764264e-19i, 0.0 + 0.0i, -0.014374953392638857 + 0.005437662208684654i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.31257786307353597 + 5.865703159736029e-20i, 0.0 + 0.0i, -0.019607007639732936 + -0.007416809053625406i }, { -0.01437495339263886 + -0.005437662208684654i, 0.0 + 0.0i, 0.2291676677958356 + 6.822779893810189e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.019607007639732943 + 0.007416809053625406i, 0.0 + 0.0i, 0.26440495498852296 + 3.0329628328975196e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.19384951414210605, 1.0e-7), DoubleNear(0.31257786307353597, 1.0e-7), DoubleNear(0.2291676677958356, 1.0e-7), DoubleNear(0.26440495498852296, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, false}), Matrix({ { 0.20496806287396058 + 2.6155093963123932e-20i, 0.0 + 0.0i, -0.020993929881925524 + -0.021629705301995986i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.27786346321843075 + 7.531077990649613e-20i, 0.0 + 0.0i, -0.027470060360065236 + -0.028609455396841434i }, { -0.020993929881925524 + 0.021629705301995986i, 0.0 + 0.0i, 0.21804911906398108 + -7.290222575853147e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.027470060360065236 + 0.028609455396841434i, 0.0 + 0.0i, 0.29911935484362817 + 2.866425349806161e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.20496806287396058, 1.0e-7), DoubleNear(0.27786346321843075, 1.0e-7), DoubleNear(0.21804911906398108, 1.0e-7), DoubleNear(0.29911935484362817, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, false}), Matrix({ { 0.24051907464455757 + 1.7422474367197437e-19i, 0.0 + 0.0i, -0.0030847808361039323 + -0.0029470696284246128i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.32806084341617703 + 2.482661664283788e-19i, 0.0 + 0.0i, -0.004207549045088655 + -0.004019715065576214i }, { -0.003084780836103932 + 0.0029470696284246128i, 0.0 + 0.0i, 0.18249810729338406 + -2.209718754673819e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.004207549045088655 + 0.004019715065576213i, 0.0 + 0.0i, 0.24892197464588192 + 1.1368714845873345e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.24051907464455757, 1.0e-7), DoubleNear(0.32806084341617703, 1.0e-7), DoubleNear(0.18249810729338406, 1.0e-7), DoubleNear(0.24892197464588192, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false, true}), Matrix({ { 0.42301718193794163 + -4.674713179540754e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0007443768822449072 + -0.0008148378235520668i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0007443768822449068 + 0.0008148378235520671i, 0.0 + 0.0i, 0.0 + 0.0i, 0.576982818062059 + 3.6195331488711226e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.42301718193794163, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.576982818062059, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, false}), Matrix({ { 0.3684213640860898 + 3.1755871919811684e-19i, 0.04404838640751954 + -0.025802663863113813i, -0.014128664092440298 + -0.10128137407876053i, -0.008782536578303086 + -0.01111966984068927i }, { 0.04404838640751954 + 0.025802663863113813i, 0.3247541469688 + -1.0627663673065822e-21i, 0.0054040959338000055 + -0.013098692807049582i, -0.012454061307033746 + -0.089276978614872i }, { -0.014128664092440298 + 0.10128137407876053i, 0.0054040959338000055 + 0.013098692807049585i, 0.16307658731357555 + 1.5065846652777457e-19i, 0.01949740496137311 + -0.011421189910725892i }, { -0.008782536578303086 + 0.011119669840689272i, -0.012454061307033748 + 0.089276978614872i, 0.01949740496137311 + 0.011421189910725892i, 0.14374790163153522 + -1.5194823626688006e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3684213640860898, 1.0e-7), DoubleNear(0.3247541469688, 1.0e-7), DoubleNear(0.16307658731357555, 1.0e-7), DoubleNear(0.14374790163153522, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, false}), Matrix({ { 0.26636559681075994 + 1.6211829958740615e-19i, 0.03184661878415997 + -0.018655112404392823i, 0.0005867423224802542 + -0.00012239880803354057i, 6.157850616941678e-05 + -5.572691194016771e-05i }, { 0.03184661878415997 + 0.018655112404392823i, 0.234794560268498 + -5.30113690880224e-20i, 7.872308902372373e-05 + 2.645895672559753e-05i, 0.00051719856936158 + -0.00010789146441475637i }, { 0.0005867423224802568 + 0.0001223988080335406i, 7.87230890237235e-05 + -2.6458956725597518e-05i, 0.26513235458890544 + 3.060988861384853e-19i, 0.03169917258473268 + -0.018568741369446883i }, { 6.157850616941685e-05 + 5.572691194016756e-05i, 0.0005171985693615835 + 0.00010789146441475637i, 0.03169917258473268 + 0.018568741369446883i, 0.23370748833183724 + -9.999963354616423e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.26636559681075994, 1.0e-7), DoubleNear(0.234794560268498, 1.0e-7), DoubleNear(0.26513235458890544, 1.0e-7), DoubleNear(0.23370748833183724, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, false}), Matrix({ { 0.2613499919388322 + 2.689293122166888e-19i, 0.031246954044265883 + -0.018303840792059545i, -0.015768020935556182 + -0.007081921461998786i, -0.002381209135947841 + 0.0002576119090061551i }, { 0.031246954044265883 + 0.018303840792059545i, 0.23037343098421786 + -2.5830336598614177e-19i, -0.0013892338771719858 + -0.0019510382054949487i, -0.013899113046864885 + -0.006242535280212562i }, { -0.015768020935556182 + 0.007081921461998786i, -0.0013892338771719858 + 0.0019510382054949485i, 0.27014795946083314 + 1.992878735092026e-19i, 0.03229883732462677 + -0.01892001298178016i }, { -0.0023812091359478407 + -0.00025761190900615505i, -0.013899113046864881 + 0.006242535280212562i, 0.03229883732462677 + 0.01892001298178016i, 0.23812861761611737 + 1.0529236335195513e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2613499919388322, 1.0e-7), DoubleNear(0.23037343098421786, 1.0e-7), DoubleNear(0.27014795946083314, 1.0e-7), DoubleNear(0.23812861761611737, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, false}), Matrix({ { 0.26916511352281913 + -2.422190504771287e-19i, 0.032181328456040666 + -0.018851178636544206i, -0.018061342673248854 + -0.0010519124936051202i, -0.0022330820788219676 + 0.0011391730959203188i }, { 0.032181328456040666 + 0.018851178636544206i, 0.23726226369282283 + -4.2814903910193747e-19i, -0.002085739133315906 + -0.001390706000914333i, -0.01592061835912294 + -0.0009272343513356319i }, { -0.01806134267324886 + 0.0010519124936051198i, -0.0020857391333159066 + 0.001390706000914333i, 0.26233283787684625 + 7.104362362030201e-19i, 0.031364462912851984 + -0.018372675137295496i }, { -0.002233082078821968 + -0.0011391730959203188i, -0.015920618359122944 + 0.0009272343513356315i, 0.031364462912851984 + 0.018372675137295496i, 0.23123978490751235 + 2.7513803646775083e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.26916511352281913, 1.0e-7), DoubleNear(0.23726226369282283, 1.0e-7), DoubleNear(0.26233283787684625, 1.0e-7), DoubleNear(0.23123978490751235, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, false}), Matrix({ { 0.2566239669892799 + 1.564416133631754e-19i, 0.030681911423391127 + -0.017972850124663032i, -0.02575851153027145 + -0.026702010991470654i, -0.004949777784395549 + -0.0013884707382519346i }, { 0.03068191142339113 + 0.017972850124663032i, 0.2262075591031114 + -5.497573949355533e-20i, -0.0012095874412476346 + -0.00499650371038125i, -0.022705478711719317 + -0.02353714970736677i }, { -0.025758511530271446 + 0.026702010991470654i, -0.001209587441247635 + 0.00499650371038125i, 0.27487398441038546 + 3.1177557236271593e-19i, 0.032863879945501516 + -0.01925100364917667i }, { -0.004949777784395549 + 0.001388470738251935i, -0.022705478711719313 + 0.02353714970736677i, 0.032863879945501516 + 0.01925100364917667i, 0.2422944894972238 + -9.803526314063133e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2566239669892799, 1.0e-7), DoubleNear(0.2262075591031114, 1.0e-7), DoubleNear(0.27487398441038546, 1.0e-7), DoubleNear(0.2422944894972238, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, false}), Matrix({ { 0.2982182009887475 + 3.76939376928118e-19i, 0.07075401885630175 + -0.005921366062922776i, 0.019392577455871765 + -0.0060161265143449825i, -0.0341519187945043 + 0.06065192511225482i }, { 0.07075401885630175 + 0.0059213660629227755i, 0.2703617170719871 + 4.55515331722351e-20i, 0.011911256320942937 + -0.035540011075470744i, -0.026684907337064353 + -0.0009506581796558435i }, { 0.019392577455871765 + 0.006016126514344983i, 0.011911256320942937 + 0.03554001107547075i, 0.2332797504109178 + 9.127780879777334e-20i, -0.007208227487409104 + -0.031302487710916926i }, { -0.0341519187945043 + -0.06065192511225482i, -0.026684907337064356 + 0.0009506581796558438i, -0.007208227487409104 + 0.031302487710916926i, 0.19814033152834815 + -1.9856253580642177e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2982182009887475, 1.0e-7), DoubleNear(0.2703617170719871, 1.0e-7), DoubleNear(0.2332797504109178, 1.0e-7), DoubleNear(0.19814033152834815, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false, true}), Matrix({ { 0.22483276560687537 + 3.1108751801592e-20i, 0.026880961588885328 + -0.015746329724279678i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026880961588885328 + 0.015746329724279678i, 0.19818441633106626 + -7.78558835969996e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.30666518579278995 + 4.371084339242994e-19i, 0.036664829780007326 + -0.021477524049560028i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.036664829780007326 + 0.021477524049560024i, 0.27031763226926897 + -7.515511903718707e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.22483276560687537, 1.0e-7), DoubleNear(0.19818441633106626, 1.0e-7), DoubleNear(0.30666518579278995, 1.0e-7), DoubleNear(0.27031763226926897, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, false}), Matrix({ { 0.3473919480037632 + 7.633206589172879e-20i, -0.013322202836795182 + -0.09550025396870543i, 0.0007652247918768515 + -0.00015963157729531792i, -7.322949254419723e-05 + -0.00020424341474585572i }, { -0.013322202836795183 + 0.09550025396870544i, 0.15376820907549463 + 3.2774864607654906e-20i, 1.4537977374033337e-05 + 0.00021648690089518322i, 0.00033871609996498006 + -7.065869515297902e-05i }, { 0.0007652247918768589 + 0.00015963157729531794i, 1.4537977374033364e-05 + -0.00021648690089518343i, 0.34578356305112656 + 2.4016388693908142e-19i, -0.013260522562678862 + -0.09505809872492707i }, { -7.322949254419712e-05 + 0.00020424341474585528i, 0.0003387160999649807 + 7.065869515297898e-05i, -0.013260522562678862 + 0.09505809872492707i, 0.15305627986961612 + -3.406463434676046e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.3473919480037632, 1.0e-7), DoubleNear(0.15376820907549463, 1.0e-7), DoubleNear(0.34578356305112656, 1.0e-7), DoubleNear(0.15305627986961612, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, false}), Matrix({ { 0.34085063498234475 + 1.4831425370393532e-20i, -0.013071348724052873 + -0.09370200545309074i, -0.0205645307597986 + -0.00923618711181112i, -0.001750453251289254 + 0.006007520555506816i }, { -0.013071348724052873 + 0.09370200545309074i, 0.1508727879407053 + -4.205479139846552e-21i, 0.0033277198033774607 + -0.005299119806156065i, -0.009102603222622466 + -0.004088269630400229i }, { -0.020564530759798597 + 0.009236187111811118i, 0.0033277198033774616 + 0.005299119806156065i, 0.3523248760725451 + 3.0166452746041672e-19i, -0.01351137667542117 + -0.09685634724054176i }, { -0.0017504532512892545 + -0.006007520555506815i, -0.009102603222622466 + 0.00408826963040023i, -0.013511376675421172 + 0.09685634724054178i, 0.15595170100440545 + 2.915709400741044e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.34085063498234475, 1.0e-7), DoubleNear(0.1508727879407053, 1.0e-7), DoubleNear(0.3523248760725451, 1.0e-7), DoubleNear(0.15595170100440545, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, false}), Matrix({ { 0.3510430560136399 + -4.207525644723607e-19i, -0.013462219903299261 + -0.09650396676116953i, -0.023555463205261657 + -0.0013718961256944783i, 0.0005261901761484564 + 0.006528157632732273i }, { -0.013462219903299261 + 0.09650396676116953i, 0.1553843212020021 + -2.4961552510670553e-19i, 0.0012804761011698763 + -0.006422935398523681i, -0.010426497827110137 + -0.000607250719246274i }, { -0.023555463205261664 + 0.0013718961256944779i, 0.0012804761011698763 + 0.006422935398523683i, 0.34213245504124995 + 7.372485173031709e-19i, -0.013120505496174783 + -0.09405438593246299i }, { 0.0005261901761484569 + -0.006528157632732274i, -0.01042649782711014 + 0.000607250719246274i, -0.013120505496174783 + 0.09405438593246299i, 0.15144016774310864 + 2.4832575536760003e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.3510430560136399, 1.0e-7), DoubleNear(0.1553843212020021, 1.0e-7), DoubleNear(0.34213245504124995, 1.0e-7), DoubleNear(0.15144016774310864, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, false}), Matrix({ { 0.33468698985250556 + 1.5436490402187823e-19i, -0.012834977872323017 + -0.09200758024071867i, -0.03359405120375112 + -0.034824555892385346i, -0.008285186759115507 + 0.010570711958631279i }, { -0.012834977872323017 + 0.09200758024071869i, 0.1481445362398858 + -5.289903015225813e-20i, 0.010861796647846766 + -0.00789972433231679i, -0.014869939038239643 + -0.015414604806452075i }, { -0.03359405120375112 + 0.03482455589238534i, 0.010861796647846766 + 0.00789972433231679i, 0.3584885212023843 + 1.6213104880893201e-19i, -0.013747747527151027 + -0.09855077245291383i }, { -0.008285186759115508 + -0.010570711958631279i, -0.01486993903823964 + 0.015414604806452075i, -0.013747747527151027 + 0.09855077245291383i, 0.158679952705225 + 5.1609260413152656e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.33468698985250556, 1.0e-7), DoubleNear(0.1481445362398858, 1.0e-7), DoubleNear(0.3584885212023843, 1.0e-7), DoubleNear(0.158679952705225, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, false}), Matrix({ { 0.3941256752772968 + 3.309399297499526e-19i, -0.01511440382946395 + -0.10834765256033407i, -0.005054864492176512 + -0.004829204540673405i, -0.001133729012105888 + 0.0015748104938964934i }, { -0.01511440382946395 + 0.10834765256033407i, 0.17445424278343774 + 9.155098035040055e-20i, 0.001521429017614131 + -0.0012044182450207288i, -0.002237465389016074 + -0.002137580153327422i }, { -0.005054864492176513 + 0.004829204540673404i, 0.001521429017614131 + 0.0012044182450207282i, 0.299049835777593 + -1.4443976919142385e-20i, -0.011468321570010093 + -0.08221070013329844i }, { -0.0011337290121058875 + -0.0015748104938964939i, -0.002237465389016074 + 0.002137580153327422i, -0.011468321570010093 + 0.08221070013329844i, 0.13237024616167303 + -9.284075008950603e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3941256752772968, 1.0e-7), DoubleNear(0.17445424278343774, 1.0e-7), DoubleNear(0.299049835777593, 1.0e-7), DoubleNear(0.13237024616167303, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false, true}), Matrix({ { 0.29322515127483184 + 8.499515928481105e-20i, -0.011244949586715647 + -0.08060945735119673i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011244949586715647 + 0.08060945735119673i, 0.1297920306631098 + -1.317422910802186e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.399950359780058 + 2.3150079354599913e-19i, -0.015337775812758397 + -0.10994889534243577i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.015337775812758397 + 0.10994889534243577i, 0.17703245828200098 + 1.3045252134111313e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.29322515127483184, 1.0e-7), DoubleNear(0.1297920306631098, 1.0e-7), DoubleNear(0.399950359780058, 1.0e-7), DoubleNear(0.17703245828200098, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, false}), Matrix({ { 0.24619422185086176 + 6.575470047012871e-20i, -0.0013415448017635484 + -0.00012537134908025162i, -0.016715661947995446 + -0.00703020105276164i, -0.0037613698635161185 + -0.0028121428190823828i }, { -0.0013415448017635462 + 0.00012537134908025156i, 0.24552920107218829 + -5.51287542395817e-20i, -0.0032561973738107256 + -0.003355454020511435i, -0.012951472034425615 + -0.006294255689449708i }, { -0.016715661947995446 + 0.00703020105276164i, -0.003256197373810725 + 0.0033554540205114353i, 0.2549659352283961 + 4.335223002925504e-20i, 0.00244548569360538 + -0.00010491892336804531i }, { -0.0037613698635161176 + 0.002812142819082382i, -0.012951472034425614 + 0.006294255689449708i, 0.0024454856936053856 + 0.00010491892336804534i, 0.2533106418485544 + 2.6122800683190268e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.24619422185086176, 1.0e-7), DoubleNear(0.24552920107218829, 1.0e-7), DoubleNear(0.2549659352283961, 1.0e-7), DoubleNear(0.2533106418485544, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, false}), Matrix({ { 0.2532227249670329 + -3.9241725690191083e-19i, 0.009634539231398488 + -0.00011704518688340423i, -0.018700841957261044 + -0.000989286829734298i, -0.011992251463895886 + 0.005291835886279898i }, { 0.009634539231398488 + 0.0001170451868834045i, 0.25320465224860905 + -2.779508326771553e-19i, -0.012835461342710642 + 0.004412983741798503i, -0.01528111907511075 + -0.0009898600152064541i }, { -0.018700841957261048 + 0.000989286829734298i, -0.012835461342710644 + -0.004412983741798503i, 0.24793743211222496 + 5.015241874012946e-19i, -0.008530598339556654 + -0.00011324508556489267i }, { -0.011992251463895884 + -0.005291835886279902i, -0.015281119075110757 + 0.0009898600152064537i, -0.008530598339556654 + 0.0001132450855648924i, 0.24563519067213363 + 4.8405008526947635e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2532227249670329, 1.0e-7), DoubleNear(0.25320465224860905, 1.0e-7), DoubleNear(0.24793743211222496, 1.0e-7), DoubleNear(0.24563519067213363, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, false}), Matrix({ { 0.2424799794107779 + 1.634363091449897e-20i, -0.00065168854370429 + -0.0002534943568706635i, -0.024108361926719564 + -0.024953147352811927i, 0.0018313606683752293 + -0.0010287640485154214i }, { -0.0006516885437042883 + 0.0002534943568706634i, 0.2403515466816134 + 8.512224295512112e-20i, 0.0017009979046865107 + -0.0010138947149370989i, -0.0243556283152712 + -0.025286013346025496i }, { -0.024108361926719564 + 0.024953147352811927i, 0.0017009979046865105 + 0.0010138947149370989i, 0.25868017766847995 + 9.276329958488474e-20i, 0.0017556294355461216 + 2.320408442236657e-05i }, { 0.0018313606683752295 + 0.0010287640485154219i, -0.024355628315271195 + 0.025286013346025496i, 0.0017556294355461242 + -2.3204084422366464e-05i, 0.2584882962391293 + 1.2097700963719988e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2424799794107779, 1.0e-7), DoubleNear(0.2403515466816134, 1.0e-7), DoubleNear(0.25868017766847995, 1.0e-7), DoubleNear(0.2584882962391293, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, false}), Matrix({ { 0.28494960104742917 + 1.8020363445266266e-19i, 0.0006276786218273218 + -0.00013093842423883684i, -0.0036546251887322415 + -0.0034914749115828214i, -9.654683897918791e-06 + -6.011565873242518e-06i }, { 0.0006276786218273236 + 0.00013093842423883686i, 0.28363031701330543 + 2.4228727564769046e-19i, -6.445918407378261e-06 + -9.37027114348806e-06i, -0.0036377046924603446 + -0.0034753097824180047i }, { -0.003654625188732242 + 0.0034914749115828214i, -6.4459184073784915e-06 + 9.370271143487776e-06i, 0.21621055603182873 + -7.109670395327896e-20i, 0.00047626227001450975 + -9.935184820946006e-05i }, { -9.654683897918453e-06 + 6.011565873242613e-06i, -0.003637704692460345 + 0.0034753097824180047i, 0.00047626227001451235 + 9.935184820946007e-05i, 0.21520952590743725 + -3.618802305536946e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.28494960104742917, 1.0e-7), DoubleNear(0.28363031701330543, 1.0e-7), DoubleNear(0.21621055603182873, 1.0e-7), DoubleNear(0.21520952590743725, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false, true}), Matrix({ { 0.21189722698062174 + 7.346000483442728e-21i, 0.0004669859650929904 + -7.714394421795535e-05i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.000466985965092993 + 7.714394421795524e-05i, 0.2111199549573199 + -5.409313227885027e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.28926293009863613 + 1.0176093001594098e-19i, 0.0006369549267488412 + -0.00015314632823034153i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0006369549267488429 + 0.00015314632823034167i, 0.2877198879634228 + 2.601923848711713e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.21189722698062174, 1.0e-7), DoubleNear(0.2111199549573199, 1.0e-7), DoubleNear(0.28926293009863613, 1.0e-7), DoubleNear(0.2877198879634228, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, false}), Matrix({ { 0.24892950630454835 + -4.144399880738594e-19i, -0.015077772948365856 + -0.007024967862378969i, -0.016616438893324183 + -0.0010346720803605979i, 0.0011811579889493217 + 0.0006656352323266206i }, { -0.015077772948365854 + 0.007024967862378969i, 0.25749787091109366 + -2.5592810150520675e-19i, 0.0011793030511935139 + -0.0005438213580379773i, -0.01736552213904761 + -0.0009444747645801547i }, { -0.01661643889332419 + 0.0010346720803605975i, 0.0011793030511935139 + 0.000543821358037978i, 0.24279391661850172 + 4.2506593430440635e-19i, -0.014589361034055209 + -0.00629948887983238i }, { 0.0011811579889493217 + -0.0006656352323266214i, -0.017365522139047615 + 0.0009444747645801542i, -0.014589361034055209 + 0.0062994888798323795i, 0.25077870616585685 + 5.605083383663646e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.24892950630454835, 1.0e-7), DoubleNear(0.25749787091109366, 1.0e-7), DoubleNear(0.24279391661850172, 1.0e-7), DoubleNear(0.25077870616585685, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, false}), Matrix({ { 0.20571004035211907 + 3.9789229847242874e-20i, -0.003861347201312463 + -0.005867413762052678i, -0.03558147595943782 + -0.01934985625955206i, 0.00783041594396022 + 0.05744362225712281i }, { -0.0038613472013124634 + 0.005867413762052678i, 0.27712148574027223 + 6.167664402237723e-20i, -0.043431732171499635 + 0.027858665769983727i, -0.012882514282552942 + -0.03088930443928536i }, { -0.03558147595943782 + 0.01934985625955206i, -0.043431732171499635 + -0.027858665769983724i, 0.286013382570931 + -2.9163283616695885e-20i, -0.025805786781108602 + -0.00745704298015867i }, { 0.00783041594396022 + -0.057443622257122816i, -0.01288251428255294 + 0.03088930443928536i, -0.025805786781108602 + 0.007457042980158672i, 0.23115509133667828 + 2.4290359283878053e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.20571004035211907, 1.0e-7), DoubleNear(0.27712148574027223, 1.0e-7), DoubleNear(0.286013382570931, 1.0e-7), DoubleNear(0.23115509133667828, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, false}), Matrix({ { 0.27958406351413156 + 1.194249849839258e-19i, -0.016868136608821794 + -0.007576018522690325i, -0.003585809410264056 + -0.0034257312165019978i, 0.0001235139063418389 + 0.00030385086899548846i }, { -0.016868136608821794 + 0.007576018522690327i, 0.28899585454660304 + 3.0306592511642734e-19i, 0.00030917114891686697 + 0.00010951820089171712i, -0.00370652047092853 + -0.0035410534774988284i }, { -0.0035858094102640564 + 0.003425731216501998i, 0.000309171148916867 + -0.00010951820089171708i, 0.2121393594089185 + -1.087990387533788e-19i, -0.01279899737359927 + -0.005748438219521023i }, { 0.00012351390634183885 + -0.0003038508689954886i, -0.0037065204709285306 + 0.003541053477498828i, -0.01279899737359927 + 0.005748438219521022i, 0.2192807225303475 + 1.5143117447303904e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.27958406351413156, 1.0e-7), DoubleNear(0.28899585454660304, 1.0e-7), DoubleNear(0.2121393594089185, 1.0e-7), DoubleNear(0.2192807225303475, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false, true}), Matrix({ { 0.2078384304188289 + -6.930456057857297e-20i, -0.012111703537177693 + -0.00391804272066433i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012111703537177693 + 0.0039180427206643295i, 0.21517875151911275 + 2.2557428783165437e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.28388499250422117 + 7.993050680911995e-20i, -0.017555430445243374 + -0.009406414021547018i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.017555430445243374 + 0.00940641402154702i, 0.29309782555783775 + 2.820228080779923e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2078384304188289, 1.0e-7), DoubleNear(0.21517875151911275, 1.0e-7), DoubleNear(0.28388499250422117, 1.0e-7), DoubleNear(0.29309782555783775, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, false}), Matrix({ { 0.24449252321322312 + -3.527232066201516e-19i, -0.016348912510462665 + -0.000919003643529483i, -0.024558140020135677 + -0.025440407612657902i, 0.001482851316528067 + 0.0018084426164672394i }, { -0.01634891251046267 + 0.000919003643529483i, 0.2383390028791682 + 4.541890804897717e-19i, 0.0016307827340507315 + 0.0017016395876035403i, -0.023905850221855086 + -0.024798753086179518i }, { -0.024558140020135677 + 0.025440407612657902i, 0.0016307827340507311 + -0.0017016395876035403i, 0.2619348540024189 + -3.1764488295891455e-19i, -0.01763304852190913 + -0.0010601432014112691i }, { 0.0014828513165280673 + -0.0018084426164672394i, -0.023905850221855082 + 0.024798753086179518i, -0.017633048521909132 + 0.0010601432014112691i, 0.2552336199051904 + 5.313851921809992e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.24449252321322312, 1.0e-7), DoubleNear(0.2383390028791682, 1.0e-7), DoubleNear(0.2619348540024189, 1.0e-7), DoubleNear(0.2552336199051904, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, false}), Matrix({ { 0.2879444366409823 + -1.473515607056477e-19i, -0.019321460619329017 + -0.0011253031509265736i, -0.0036930354955236125 + -0.0035281705002089157i, 0.00023401937991137333 + 0.00025117759766908984i }, { -0.019321460619329024 + 0.0011253031509265736i, 0.28063548141975225 + 5.698424708060009e-19i, 0.0002615959598043999 + 0.00022231241431583076i, -0.003599294385668974 + -0.0034386141937919105i }, { -0.0036930354955236125 + 0.0035281705002089157i, 0.0002615959598043998 + -0.0002223124143158308i, 0.21848294057465972 + -5.230165288734185e-19i, -0.014660500413042775 + -0.0008538436940141786i }, { 0.00023401937991137338 + -0.00025117759766908984i, -0.003599294385668974 + 0.0034386141937919105i, -0.01466050041304278 + 0.0008538436940141786i, 0.21293714136460629 + 4.1573180186477006e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2879444366409823, 1.0e-7), DoubleNear(0.28063548141975225, 1.0e-7), DoubleNear(0.21848294057465972, 1.0e-7), DoubleNear(0.21293714136460629, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false, true}), Matrix({ { 0.19384951414210605 + -7.290251211764264e-19i, -0.014374953392638857 + 0.005437662208684654i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01437495339263886 + -0.005437662208684654i, 0.2291676677958356 + 6.822779893810189e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.31257786307353597 + 5.865703159736029e-20i, -0.019607007639732936 + -0.007416809053625406i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.019607007639732943 + 0.007416809053625406i, 0.26440495498852296 + 3.0329628328975196e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.19384951414210605, 1.0e-7), DoubleNear(0.2291676677958356, 1.0e-7), DoubleNear(0.31257786307353597, 1.0e-7), DoubleNear(0.26440495498852296, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, false}), Matrix({ { 0.2745283095427511 + 1.2279093582003478e-19i, -0.02755565160068733 + -0.02856497787358504i, -0.0035209667653053607 + -0.0033637832857615307i, 3.409988407386703e-06 + 0.0007039987181982745i }, { -0.02755565160068733 + 0.02856497787358504i, 0.29405160851798345 + 2.996999742803184e-19i, 0.0007034208199996031 + -2.87223473420617e-05i, -0.003771363115887226 + -0.003603001408239296i }, { -0.0035209667653053607 + 0.0033637832857615307i, 0.0007034208199996031 + 2.872234734206167e-05i, 0.20830321654964018 + -2.1325061950414733e-20i, -0.02090833864130343 + -0.02167418282525238i }, { 3.4099884073866014e-06 + -0.0007039987181982745i, -0.0037713631158872254 + 0.0036030014082392954i, -0.02090833864130343 + 0.02167418282525238i, 0.2231168653896258 + -8.595966505823373e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.2745283095427511, 1.0e-7), DoubleNear(0.29405160851798345, 1.0e-7), DoubleNear(0.20830321654964018, 1.0e-7), DoubleNear(0.2231168653896258, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false, true}), Matrix({ { 0.20496806287396058 + 2.6155093963123932e-20i, -0.020993929881925524 + -0.021629705301995986i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.020993929881925524 + 0.021629705301995986i, 0.21804911906398108 + -7.290222575853147e-20i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.27786346321843075 + 7.531077990649613e-20i, -0.027470060360065236 + -0.028609455396841434i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.027470060360065236 + 0.028609455396841434i, 0.29911935484362817 + 2.866425349806161e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.20496806287396058, 1.0e-7), DoubleNear(0.21804911906398108, 1.0e-7), DoubleNear(0.27786346321843075, 1.0e-7), DoubleNear(0.29911935484362817, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true, true}), Matrix({ { 0.24051907464455757 + 1.7422474367197437e-19i, -0.0030847808361039323 + -0.0029470696284246128i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003084780836103932 + 0.0029470696284246128i, 0.18249810729338406 + -2.209718754673819e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.32806084341617703 + 2.482661664283788e-19i, -0.004207549045088655 + -0.004019715065576214i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.004207549045088655 + 0.004019715065576213i, 0.24892197464588192 + 1.1368714845873345e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.24051907464455757, 1.0e-7), DoubleNear(0.18249810729338406, 1.0e-7), DoubleNear(0.32806084341617703, 1.0e-7), DoubleNear(0.24892197464588192, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false, false}), Matrix({ { 0.15584856720142998 + 5.714603082637727e-20i, 0.0 + 0.0i, 0.018633224287022437 + -0.010914970153866362i, 0.0 + 0.0i, -0.005976667668931877 + -0.04284376144559974i, 0.0 + 0.0i, -0.003715163873620662 + -0.004703811400088693i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2125727968846598 + 2.6041268837173954e-19i, 0.0 + 0.0i, 0.025415162120497103 + -0.014887693709247451i, 0.0 + 0.0i, -0.008151996423508421 + -0.05843761263316079i, 0.0 + 0.0i, -0.005067372704682424 + -0.006415858440600578i }, { 0.018633224287022437 + 0.01091497015386636i, 0.0 + 0.0i, 0.1373765840734018 + 2.784912845843381e-20i, 0.0 + 0.0i, 0.002286025432838366 + -0.005540972118308898i, 0.0 + 0.0i, -0.0052682819177837705 + -0.037765695905597i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.025415162120497103 + 0.014887693709247451i, 0.0 + 0.0i, 0.18737756289539817 + -2.8911894825740394e-20i, 0.0 + 0.0i, 0.003118070500961639 + -0.007557720688740685i, 0.0 + 0.0i, -0.007185779389249976 + -0.051511282709274984i }, { -0.005976667668931877 + 0.04284376144559974i, 0.0 + 0.0i, 0.002286025432838366 + 0.005540972118308898i, 0.0 + 0.0i, 0.06898419840544537 + -2.603727902478524e-20i, 0.0 + 0.0i, 0.008247737301862889 + -0.004831359570413315i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.008151996423508421 + 0.05843761263316079i, 0.0 + 0.0i, 0.0031180705009616395 + 0.007557720688740686i, 0.0 + 0.0i, 0.09409238890813018 + 1.766957455525598e-19i, 0.0 + 0.0i, 0.011249667659510219 + -0.006589830340312576i }, { -0.003715163873620662 + 0.0047038114000886935i, 0.0 + 0.0i, -0.0052682819177837705 + 0.037765695905597i, 0.0 + 0.0i, 0.008247737301862889 + 0.004831359570413316i, 0.0 + 0.0i, 0.06080783225766443 + -1.0570501205543339e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.005067372704682424 + 0.006415858440600579i, 0.0 + 0.0i, -0.007185779389249977 + 0.051511282709274984i, 0.0 + 0.0i, 0.011249667659510219 + 0.006589830340312577i, 0.0 + 0.0i, 0.08294006937387079 + -4.624322421144668e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.15584856720142998, 1.0e-7), DoubleNear(0.2125727968846598, 1.0e-7), DoubleNear(0.1373765840734018, 1.0e-7), DoubleNear(0.18737756289539817, 1.0e-7), DoubleNear(0.06898419840544537, 1.0e-7), DoubleNear(0.09409238890813018, 1.0e-7), DoubleNear(0.06080783225766443, 1.0e-7), DoubleNear(0.08294006937387079, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false, false}), Matrix({ { 0.1126229420474703 + -1.3723942572960404e-21i, 0.0 + 0.0i, 0.013465176977357473 + -0.007887631392208782i, 0.0 + 0.0i, 0.0002482020837793206 + -4.100184831473331e-05i, 0.0 + 0.0i, 2.6803397810893514e-05 + -2.228519026370473e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.15374265476328963 + 1.634906938447022e-19i, 0.0 + 0.0i, 0.0183814418068025 + -0.01076748101218404i, 0.0 + 0.0i, 0.0003385402387009336 + -8.139695971880725e-05i, 0.0 + 0.0i, 3.477510835852326e-05 + -3.344172167646298e-05i }, { 0.013465176977357472 + 0.007887631392208782i, 0.0 + 0.0i, 0.09927428493315145 + 8.718394740738804e-21i, 0.0 + 0.0i, 3.254658760910673e-05 + 1.24808442944091e-05i, 0.0 + 0.0i, 0.00021878388131367065 + -3.614209590322206e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0183814418068025 + 0.01076748101218404i, 0.0 + 0.0i, 0.13552027533534652 + -6.17297638287612e-20i, 0.0 + 0.0i, 4.617650141461701e-05 + 1.3978112431188431e-05i, 0.0 + 0.0i, 0.00029841468804790933 + -7.174936851153431e-05i }, { 0.00024820208377932104 + 4.1001848314733234e-05i, 0.0 + 0.0i, 3.254658760910636e-05 + -1.248084429440906e-05i, 0.0 + 0.0i, 0.11220982355940508 + 3.2481146058888085e-20i, 0.0 + 0.0i, 0.013415784611527856 + -0.007858698332070896i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0003385402387009358 + 8.139695971880735e-05i, 0.0 + 0.0i, 4.617650141461714e-05 + -1.3978112431188458e-05i, 0.0 + 0.0i, 0.15292253102950037 + 2.736177400795972e-19i, 0.0 + 0.0i, 0.01828338797320482 + -0.010710043037375985i }, { 2.680339781089346e-05 + 2.2285190263704525e-05i, 0.0 + 0.0i, 0.00021878388131367195 + 3.614209590322202e-05i, 0.0 + 0.0i, 0.013415784611527856 + 0.007858698332070896i, 0.0 + 0.0i, 0.09891013139791481 + -8.657427833773836e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 3.4775108358523385e-05 + 3.3441721676463035e-05i, 0.0 + 0.0i, 0.0002984146880479115 + 7.174936851153435e-05i, 0.0 + 0.0i, 0.01828338797320482 + 0.010710043037375985i, 0.0 + 0.0i, 0.13479735693392242 + -1.342535520842587e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1126229420474703, 1.0e-7), DoubleNear(0.15374265476328963, 1.0e-7), DoubleNear(0.09927428493315145, 1.0e-7), DoubleNear(0.13552027533534652, 1.0e-7), DoubleNear(0.11220982355940508, 1.0e-7), DoubleNear(0.15292253102950037, 1.0e-7), DoubleNear(0.09891013139791481, 1.0e-7), DoubleNear(0.13479735693392242, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false, false}), Matrix({ { 0.11046569998972938 + 2.763962290028612e-20i, 0.0 + 0.0i, 0.013207257537833006 + -0.0077365473424948405i, 0.0 + 0.0i, -0.0064373456179700195 + -0.002082431679529462i, 0.0 + 0.0i, -0.0009154924354090384 + 0.00020186915611825537i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1508842919491028 + 2.4128968931640264e-19i, 0.0 + 0.0i, 0.01803969650643288 + -0.010567293449564703i, 0.0 + 0.0i, -0.009330675317586162 + -0.004999489782469325i, 0.0 + 0.0i, -0.0014657167005388025 + 5.574275288789971e-05i }, { 0.013207257537833006 + 0.007736547342494841i, 0.0 + 0.0i, 0.09737273042909952 + -9.694418347885907e-20i, 0.0 + 0.0i, -0.0006238031367817063 + -0.0006998194067217433i, 0.0 + 0.0i, -0.005674357919207672 + -0.0018356110411348685i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.01803969650643288 + 0.010567293449564703i, 0.0 + 0.0i, 0.13300070055511834 + -1.613591825072827e-19i, 0.0 + 0.0i, -0.0007654307403902796 + -0.0012512187987732055i, 0.0 + 0.0i, -0.008224755127657211 + -0.004406924239077693i }, { -0.00643734561797002 + 0.0020824316795294614i, 0.0 + 0.0i, -0.0006238031367817062 + 0.0006998194067217433i, 0.0 + 0.0i, 0.11436706561714598 + 3.4691289013058995e-21i, 0.0 + 0.0i, 0.013673704051052324 + -0.008009782381784836i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.009330675317586162 + 0.004999489782469325i, 0.0 + 0.0i, -0.0007654307403902796 + 0.0012512187987732053i, 0.0 + 0.0i, 0.15578089384368718 + 1.958187446078967e-19i, 0.0 + 0.0i, 0.018625133273574443 + -0.010910230599995324i }, { -0.0009154924354090384 + -0.00020186915611825545i, 0.0 + 0.0i, -0.005674357919207672 + 0.0018356110411348685i, 0.0 + 0.0i, 0.013673704051052324 + 0.008009782381784836i, 0.0 + 0.0i, 0.10081168590196676 + 1.9088299881859484e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0014657167005388023 + -5.57427528878996e-05i, 0.0 + 0.0i, -0.00822475512765721 + 0.004406924239077693i, 0.0 + 0.0i, 0.018625133273574443 + 0.010910230599995324i, 0.0 + 0.0i, 0.1373169317141506 + 8.620406347009564e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.11046569998972938, 1.0e-7), DoubleNear(0.1508842919491028, 1.0e-7), DoubleNear(0.09737273042909952, 1.0e-7), DoubleNear(0.13300070055511834, 1.0e-7), DoubleNear(0.11436706561714598, 1.0e-7), DoubleNear(0.15578089384368718, 1.0e-7), DoubleNear(0.10081168590196676, 1.0e-7), DoubleNear(0.1373169317141506, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false, false}), Matrix({ { 0.10303061964634974 + -3.8162510584171545e-19i, 0.0 + 0.0i, 0.012318320782635468 + -0.0072158259685556215i, 0.0 + 0.0i, -0.007640258279653218 + 0.0028901063243192715i, 0.0 + 0.0i, -0.000711057046298572 + 0.0008806317113409365i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1661344938764694 + 1.3940605536458674e-19i, 0.0 + 0.0i, 0.019863007673405198 + -0.011635352667988584i, 0.0 + 0.0i, -0.010421084393595638 + -0.003942018817924392i, 0.0 + 0.0i, -0.0015220250325233954 + 0.0002585413845793824i }, { 0.012318320782635468 + 0.0072158259685556215i, 0.0 + 0.0i, 0.09081889449575627 + -3.4740001533471103e-19i, 0.0 + 0.0i, -0.0011158785321537957 + -0.00018955061484576265i, 0.0 + 0.0i, -0.0067346951129856406 + 0.002547555884365382i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.019863007673405198 + 0.011635352667988584i, 0.0 + 0.0i, 0.14644336919706658 + -8.074902376722642e-20i, 0.0 + 0.0i, -0.0009698606011621106 + -0.0012011553860685703i, 0.0 + 0.0i, -0.0091859232461373 + -0.003474790235701014i }, { -0.007640258279653219 + -0.002890106324319272i, 0.0 + 0.0i, -0.0011158785321537957 + 0.00018955061484576265i, 0.0 + 0.0i, 0.12180214596052563 + 4.1273385764330744e-19i, 0.0 + 0.0i, 0.014562640806249862 + -0.008530503755724055i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.010421084393595641 + 0.003942018817924392i, 0.0 + 0.0i, -0.000969860601162111 + 0.0012011553860685705i, 0.0 + 0.0i, 0.14053069191632062 + 2.9770237855971265e-19i, 0.0 + 0.0i, 0.016801822106602124 + -0.009842171381571441i }, { -0.0007110570462985721 + -0.0008806317113409365i, 0.0 + 0.0i, -0.0067346951129856406 + -0.002547555884365383i, 0.0 + 0.0i, 0.014562640806249862 + 0.008530503755724055i, 0.0 + 0.0i, 0.10736552183530998 + 2.6954413173771147e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0015220250325233956 + -0.0002585413845793825i, 0.0 + 0.0i, -0.009185923246137304 + 0.0034747902357010144i, 0.0 + 0.0i, 0.016801822106602124 + 0.009842171381571441i, 0.0 + 0.0i, 0.12387426307220235 + 5.5939047300393514e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.10303061964634974, 1.0e-7), DoubleNear(0.1661344938764694, 1.0e-7), DoubleNear(0.09081889449575627, 1.0e-7), DoubleNear(0.14644336919706658, 1.0e-7), DoubleNear(0.12180214596052563, 1.0e-7), DoubleNear(0.14053069191632062, 1.0e-7), DoubleNear(0.10736552183530998, 1.0e-7), DoubleNear(0.12387426307220235, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false, false}), Matrix({ { 0.10894010551986777 + 4.15145946282432e-20i, 0.0 + 0.0i, 0.013024857760674762 + -0.007629701200727486i, 0.0 + 0.0i, -0.011158230724071629 + -0.011496144057389341i, 0.0 + 0.0i, -0.002139216875622743 + -0.0005930017644282282i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.14768386146941212 + 1.149270187349322e-19i, 0.0 + 0.0i, 0.017657053662716367 + -0.010343148923935546i, 0.0 + 0.0i, -0.014600280806199819 + -0.015205866934081314i, 0.0 + 0.0i, -0.0028105609087728063 + -0.0007954689738237065i }, { 0.013024857760674764 + 0.007629701200727487i, 0.0 + 0.0i, 0.09602795735409278 + -1.535950066511928e-20i, 0.0 + 0.0i, -0.0005289349009572561 + -0.0021559517165543065i, 0.0 + 0.0i, -0.009835699157853896 + -0.010133561244606647i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.017657053662716367 + 0.010343148923935546i, 0.0 + 0.0i, 0.13017960174901863 + -3.9616238828436045e-20i, 0.0 + 0.0i, -0.0006806525402903785 + -0.002840551993826943i, 0.0 + 0.0i, -0.012869779553865418 + -0.013403588462760121i }, { -0.011158230724071627 + 0.01149614405738934i, 0.0 + 0.0i, -0.0005289349009572564 + 0.0021559517165543065i, 0.0 + 0.0i, 0.1158926600870076 + -1.0405842826651198e-20i, 0.0 + 0.0i, 0.013856103828210566 + -0.00811662852355219i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.014600280806199819 + 0.015205866934081314i, 0.0 + 0.0i, -0.0006806525402903785 + 0.002840551993826943i, 0.0 + 0.0i, 0.15898132432337786 + 3.2218141518936714e-19i, 0.0 + 0.0i, 0.019007776117290952 + -0.01113437512562448i }, { -0.0021392168756227434 + 0.0005930017644282283i, 0.0 + 0.0i, -0.009835699157853896 + 0.010133561244606647i, 0.0 + 0.0i, 0.013856103828210566 + 0.008116628523552192i, 0.0 + 0.0i, 0.10215645897697348 + -6.249638293188031e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0028105609087728063 + 0.0007954689738237067i, 0.0 + 0.0i, -0.012869779553865417 + 0.013403588462760121i, 0.0 + 0.0i, 0.019007776117290952 + 0.011134375125624478i, 0.0 + 0.0i, 0.1401380305202503 + -3.5538880208751024e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10894010551986777, 1.0e-7), DoubleNear(0.14768386146941212, 1.0e-7), DoubleNear(0.09602795735409278, 1.0e-7), DoubleNear(0.13017960174901863, 1.0e-7), DoubleNear(0.1158926600870076, 1.0e-7), DoubleNear(0.15898132432337786, 1.0e-7), DoubleNear(0.10215645897697348, 1.0e-7), DoubleNear(0.1401380305202503, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true, false}), Matrix({ { 0.1261514229848626 + 1.1682757700989876e-19i, 0.0 + 0.0i, 0.029930165667376735 + -0.0025048395851605563i, 0.0 + 0.0i, 0.008203393465896127 + -0.0025449248842803448i, 0.0 + 0.0i, -0.014446848446224625 + 0.025656806440097095i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.17206677800388492 + 2.6011179991821926e-19i, 0.0 + 0.0i, 0.04082385318892502 + -0.00341652647776222i, 0.0 + 0.0i, 0.01118918398997564 + -0.0034712016300646378i, 0.0 + 0.0i, -0.019705070348279674 + 0.034995118672157724i }, { 0.029930165667376735 + 0.0025048395851605563i, 0.0 + 0.0i, 0.11436765165969498 + 5.739716666207554e-20i, 0.0 + 0.0i, 0.005038666082225773 + -0.015034035331188862i, 0.0 + 0.0i, -0.011288174302000058 + -0.0004021447441442678i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.04082385318892502 + 0.003416526477762219i, 0.0 + 0.0i, 0.15599406541229208 + -1.1845633489840435e-20i, 0.0 + 0.0i, 0.006872590238717164 + -0.020505975744281882i, 0.0 + 0.0i, -0.015396733035064294 + -0.0005485134355115757i }, { 0.008203393465896127 + 0.0025449248842803448i, 0.0 + 0.0i, 0.005038666082225774 + 0.015034035331188862i, 0.0 + 0.0i, 0.09868134262201278 + -8.571882520830676e-20i, 0.0 + 0.0i, -0.003049204078491407 + -0.01324149013911912i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.01118918398997564 + 0.003471201630064638i, 0.0 + 0.0i, 0.0068725902387171646 + 0.020505975744281885i, 0.0 + 0.0i, 0.13459840778890503 + 1.769966340060801e-19i, 0.0 + 0.0i, -0.004159023408917696 + -0.018060997571797806i }, { -0.014446848446224625 + -0.025656806440097095i, 0.0 + 0.0i, -0.01128817430200006 + 0.0004021447441442679i, 0.0 + 0.0i, -0.0030492040784914063 + 0.01324149013911912i, 0.0 + 0.0i, 0.08381676467137128 + -1.3525305025907514e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.019705070348279674 + -0.034995118672157724i, 0.0 + 0.0i, -0.015396733035064294 + 0.0005485134355115758i, 0.0 + 0.0i, -0.004159023408917697 + 0.018060997571797806i, 0.0 + 0.0i, 0.11432356685697687 + -6.330948554734663e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1261514229848626, 1.0e-7), DoubleNear(0.17206677800388492, 1.0e-7), DoubleNear(0.11436765165969498, 1.0e-7), DoubleNear(0.15599406541229208, 1.0e-7), DoubleNear(0.09868134262201278, 1.0e-7), DoubleNear(0.13459840778890503, 1.0e-7), DoubleNear(0.08381676467137128, 1.0e-7), DoubleNear(0.11432356685697687, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false, true}), Matrix({ { 0.22483276560687537 + 3.1108751801592e-20i, 0.0 + 0.0i, 0.026880961588885328 + -0.015746329724279678i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0003956347879824379 + -0.0004330846339408852i, 0.0 + 0.0i, -7.763342205225757e-05 + -2.4070938117611037e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.026880961588885328 + 0.015746329724279678i, 0.0 + 0.0i, 0.19818441633106626 + -7.78558835969996e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -1.697061406566575e-05 + -7.948809055223331e-05i, 0.0 + 0.0i, -0.0003487420942624693 + -0.00038175318961118155i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0003956347879824378 + 0.00043308463394088533i, 0.0 + 0.0i, -1.6970614065665736e-05 + 7.948809055223331e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.30666518579278995 + 4.371084339242994e-19i, 0.0 + 0.0i, 0.036664829780007326 + -0.021477524049560028i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -7.763342205225756e-05 + 2.407093811761106e-05i, 0.0 + 0.0i, -0.00034874209426246917 + 0.00038175318961118166i, 0.0 + 0.0i, 0.0 + 0.0i, 0.036664829780007326 + 0.021477524049560024i, 0.0 + 0.0i, 0.27031763226926897 + -7.515511903718707e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.22483276560687537, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19818441633106626, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.30666518579278995, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27031763226926897, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false, false}), Matrix({ { 0.14688196860340635 + 5.432509374323959e-20i, 0.0 + 0.0i, -0.005632805797735887 + -0.040378786513775994i, 0.0 + 0.0i, 0.0003237032350087935 + -5.347429295807109e-05i, 0.0 + 0.0i, -2.7114182605938493e-05 + -8.69373799537883e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.20050997940035686 + 2.2006972148489203e-20i, 0.0 + 0.0i, -0.007689397039059295 + -0.055121467454929435i, 0.0 + 0.0i, 0.000441521556868058 + -0.00010615728433724682i, 0.0 + 0.0i, -4.6115309938258735e-05 + -0.00011730603479206741i }, { -0.005632805797735888 + 0.040378786513775994i, 0.0 + 0.0i, 0.06501525837721536 + -4.697909325979685e-20i, 0.0 + 0.0i, 2.2866632549877136e-06 + 9.103877252454552e-05i, 0.0 + 0.0i, 0.00014328273008419644 + -2.366965125988428e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.007689397039059295 + 0.05512146745492945i, 0.0 + 0.0i, 0.08875295069827926 + 7.975395786745176e-20i, 0.0 + 0.0i, 1.2251314119045623e-05 + 0.0001254481283706377i, 0.0 + 0.0i, 0.00019543336988078362 + -4.698904389309474e-05i }, { 0.0003237032350087957 + 5.347429295807103e-05i, 0.0 + 0.0i, 2.2866632549876594e-06 + -9.103877252454487e-05i, 0.0 + 0.0i, 0.14634318267142543 + 3.067006554157148e-20i, 0.0 + 0.0i, -0.00561214378897976 + -0.04023067083742075i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0004415215568680632 + 0.00010615728433724692i, 0.0 + 0.0i, 1.2251314119045704e-05 + -0.00012544812837063856i, 0.0 + 0.0i, 0.19944038037970113 + 2.0949382139750994e-19i, 0.0 + 0.0i, -0.007648378773699102 + -0.05482742788750633i }, { -2.711418260593841e-05 + 8.693737995378722e-05i, 0.0 + 0.0i, 0.00014328273008419623 + 2.366965125988421e-05i, 0.0 + 0.0i, -0.00561214378897976 + 0.04023067083742074i, 0.0 + 0.0i, 0.06477677228589443 + -8.476319782042181e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -4.611530993825871e-05 + 0.00011730603479206806i, 0.0 + 0.0i, 0.00019543336988078449 + 4.6989043893094766e-05i, 0.0 + 0.0i, -0.007648378773699102 + 0.05482742788750633i, 0.0 + 0.0i, 0.08827950758372168 + 5.069856347366135e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.14688196860340635, 1.0e-7), DoubleNear(0.20050997940035686, 1.0e-7), DoubleNear(0.06501525837721536, 1.0e-7), DoubleNear(0.08875295069827926, 1.0e-7), DoubleNear(0.14634318267142543, 1.0e-7), DoubleNear(0.19944038037970113, 1.0e-7), DoubleNear(0.06477677228589443, 1.0e-7), DoubleNear(0.08827950758372168, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false, false}), Matrix({ { 0.1440685102224178 + -4.207326961250432e-21i, 0.0 + 0.0i, -0.005524911923281419 + -0.03960534892704217i, 0.0 + 0.0i, -0.00839553628912846 + -0.0027158912652313866i, 0.0 + 0.0i, -0.00042465367738443906 + 0.0024121385281050496i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.19678212475992696 + 1.9038752331643964e-20i, 0.0 + 0.0i, -0.0075464368007714545 + -0.054096656526048566i, 0.0 + 0.0i, -0.01216899447067014 + -0.006520295846579732i, 0.0 + 0.0i, -0.001325799573904815 + 0.003595382027401766i }, { -0.005524911923281419 + 0.03960534892704217i, 0.0 + 0.0i, 0.0637699201964111 + -6.509723361732255e-20i, 0.0 + 0.0i, 0.0010685778558817047 + -0.0022038340206113937i, 0.0 + 0.0i, -0.0037161672480492333 + -0.0012021514554329438i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0075464368007714545 + 0.054096656526048566i, 0.0 + 0.0i, 0.0871028677442942 + 6.089175447747599e-20i, 0.0 + 0.0i, 0.002259141947495756 + -0.0030952857855446715i, 0.0 + 0.0i, -0.005386435974573233 + -0.0028861181749672855i }, { -0.00839553628912846 + 0.0027158912652313857i, 0.0 + 0.0i, 0.0010685778558817052 + 0.0022038340206113937i, 0.0 + 0.0i, 0.14915664105241405 + 8.920248624606152e-20i, 0.0 + 0.0i, -0.005720037663434228 + -0.04100410842415457i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.012168994470670137 + 0.006520295846579732i, 0.0 + 0.0i, 0.0022591419474957564 + 0.003095285785544672i, 0.0 + 0.0i, 0.20316823502013104 + 2.124620412143552e-19i, 0.0 + 0.0i, -0.007791339011986942 + -0.0558522388163872i }, { -0.0004246536773844394 + -0.0024121385281050496i, 0.0 + 0.0i, -0.0037161672480492333 + 0.001202151455432944i, 0.0 + 0.0i, -0.00572003766343423 + 0.04100410842415457i, 0.0 + 0.0i, 0.0660221104666987 + -6.664505746289608e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.001325799573904815 + -0.0035953820274017656i, 0.0 + 0.0i, -0.005386435974573233 + 0.0028861181749672855i, 0.0 + 0.0i, -0.007791339011986942 + 0.055852238816387206i, 0.0 + 0.0i, 0.08992959053770674 + 6.956076686363712e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1440685102224178, 1.0e-7), DoubleNear(0.19678212475992696, 1.0e-7), DoubleNear(0.0637699201964111, 1.0e-7), DoubleNear(0.0871028677442942, 1.0e-7), DoubleNear(0.14915664105241405, 1.0e-7), DoubleNear(0.20316823502013104, 1.0e-7), DoubleNear(0.0660221104666987, 1.0e-7), DoubleNear(0.08992959053770674, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false, false}), Matrix({ { 0.13437173603319635 + -4.1443780600050203e-19i, 0.0 + 0.0i, -0.005153048403261062 + -0.036939644085380724i, 0.0 + 0.0i, -0.009964365664332658 + 0.0037692542804488435i, 0.0 + 0.0i, 0.0014183173916581225 + 0.002594719557240442i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.21667131998044353 + -6.3147584718586655e-21i, 0.0 + 0.0i, -0.008309171500038199 + -0.0595643226757888i, 0.0 + 0.0i, -0.013591097540929 + -0.005141150406143322i, 0.0 + 0.0i, -0.000892127215509666 + 0.003933438075491832i }, { -0.005153048403261062 + 0.036939644085380724i, 0.0 + 0.0i, 0.05947777810890967 + -3.1458731517592445e-19i, 0.0 + 0.0i, -0.00065406651432461 + -0.0028838153198575646i, 0.0 + 0.0i, -0.004410587728306201 + 0.0016684079282358103i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.008309171500038199 + 0.0595643226757888i, 0.0 + 0.0i, 0.09590654309309243 + 6.497179006921895e-20i, 0.0 + 0.0i, 0.0019345426154944864 + -0.003539120078666117i, 0.0 + 0.0i, -0.0060159100988039374 + -0.0022756586474820843i }, { -0.009964365664332658 + -0.003769254280448844i, 0.0 + 0.0i, -0.00065406651432461 + 0.0028838153198575646i, 0.0 + 0.0i, 0.1588534152416355 + 4.994329652853131e-19i, 0.0 + 0.0i, -0.006091901183454585 + -0.043669813265816024i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.013591097540929006 + 0.005141150406143322i, 0.0 + 0.0i, 0.0019345426154944864 + 0.0035391200786661185i, 0.0 + 0.0i, 0.18327903979961446 + 2.378155520178578e-19i, 0.0 + 0.0i, -0.007028604312720198 + -0.05038457266664696i }, { 0.001418317391658123 + -0.002594719557240442i, 0.0 + 0.0i, -0.0044105877283062015 + -0.0016684079282358103i, 0.0 + 0.0i, -0.006091901183454585 + 0.043669813265816024i, 0.0 + 0.0i, 0.07031425255420014 + 1.8284502409570586e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.000892127215509666 + -0.0039334380754918324i, 0.0 + 0.0i, -0.006015910098803939 + 0.0022756586474820843i, 0.0 + 0.0i, -0.007028604312720197 + 0.05038457266664696i, 0.0 + 0.0i, 0.08112591518890852 + 6.548073127189418e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13437173603319635, 1.0e-7), DoubleNear(0.21667131998044353, 1.0e-7), DoubleNear(0.05947777810890967, 1.0e-7), DoubleNear(0.09590654309309243, 1.0e-7), DoubleNear(0.1588534152416355, 1.0e-7), DoubleNear(0.18327903979961446, 1.0e-7), DoubleNear(0.07031425255420014, 1.0e-7), DoubleNear(0.08112591518890852, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false, false}), Matrix({ { 0.1420788417325883 + 9.547904507350456e-20i, 0.0 + 0.0i, -0.0054486097310406205 + -0.0390583764160668i, 0.0 + 0.0i, -0.014552478074954238 + -0.014993182026677718i, 0.0 + 0.0i, -0.0035636451384900435 + 0.00457554521137986i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.19260814811991722 + 5.888585894837366e-20i, 0.0 + 0.0i, -0.007386368141282397 + -0.05294920382465188i, 0.0 + 0.0i, -0.019041573128796882 + -0.019831373865707626i, 0.0 + 0.0i, -0.0047215416206254635 + 0.005995166747251418i }, { -0.0054486097310406205 + 0.0390583764160668i, 0.0 + 0.0i, 0.06288922114137224 + -6.932395111038062e-20i, 0.0 + 0.0i, 0.004679796884704121 + -0.0034255921783508457i, 0.0 + 0.0i, -0.006441451806971285 + -0.0066365232753182665i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.007386368141282396 + 0.05294920382465189i, 0.0 + 0.0i, 0.08525531509851356 + 1.6424920958122486e-20i, 0.0 + 0.0i, 0.006181999763142646 + -0.0044741321539659455i, 0.0 + 0.0i, -0.008428487231268357 + -0.008778081531133809i }, { -0.014552478074954238 + 0.01499318202667772i, 0.0 + 0.0i, 0.004679796884704121 + 0.0034255921783508453i, 0.0 + 0.0i, 0.1511463095422435 + -1.04838857886935e-20i, 0.0 + 0.0i, -0.005796339855675027 + -0.04155108093512995i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.019041573128796882 + 0.019831373865707623i, 0.0 + 0.0i, 0.006181999763142646 + 0.0044741321539659455i, 0.0 + 0.0i, 0.20734221166014077 + 1.726149345976255e-19i, 0.0 + 0.0i, -0.007951407671476 + -0.056999691517783876i }, { -0.0035636451384900435 + -0.00457554521137986i, 0.0 + 0.0i, -0.006441451806971284 + 0.0066365232753182665i, 0.0 + 0.0i, -0.005796339855675027 + 0.04155108093512995i, 0.0 + 0.0i, 0.06690280952173758 + -6.241833996983798e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.004721541620625464 + -0.005995166747251418i, 0.0 + 0.0i, -0.008428487231268355 + 0.008778081531133809i, 0.0 + 0.0i, -0.007951407671476 + 0.056999691517783876i, 0.0 + 0.0i, 0.09177714318348741 + 1.1402760038299064e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1420788417325883, 1.0e-7), DoubleNear(0.19260814811991722, 1.0e-7), DoubleNear(0.06288922114137224, 1.0e-7), DoubleNear(0.08525531509851356, 1.0e-7), DoubleNear(0.1511463095422435, 1.0e-7), DoubleNear(0.20734221166014077, 1.0e-7), DoubleNear(0.06690280952173758, 1.0e-7), DoubleNear(0.09177714318348741, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true, false}), Matrix({ { 0.16672193248519027 + 1.337904963110545e-19i, 0.0 + 0.0i, -0.00639365251461187 + -0.0458329186556637i, 0.0 + 0.0i, -0.0021382945325586727 + -0.002042836495797574i, 0.0 + 0.0i, -0.00047958685178231883 + 0.0006661718972143925i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.22740374279210654 + 1.9714943343889808e-19i, 0.0 + 0.0i, -0.00872075131485208 + -0.06251473390467037i, 0.0 + 0.0i, -0.00291656995961784 + -0.0027863680448758305i, 0.0 + 0.0i, -0.000654142160323569 + 0.000908638596682101i }, { -0.00639365251461187 + 0.0458329186556637i, 0.0 + 0.0i, 0.07379714215936728 + 4.0434247360919844e-20i, 0.0 + 0.0i, 0.0006435906155497404 + -0.0005094896118833098i, 0.0 + 0.0i, -0.0009464863035452595 + -0.0009042331326270386i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.00872075131485208 + 0.06251473390467037i, 0.0 + 0.0i, 0.10065710062407046 + 5.1116732989480704e-20i, 0.0 + 0.0i, 0.0008778384020643905 + -0.000694928633137419i, 0.0 + 0.0i, -0.001290979085470814 + -0.0012333470207003833i }, { -0.0021382945325586723 + 0.002042836495797574i, 0.0 + 0.0i, 0.0006435906155497402 + 0.0005094896118833097i, 0.0 + 0.0i, 0.12650321878964155 + -4.879533702624346e-20i, 0.0 + 0.0i, -0.004851297072103777 + -0.034776538695533044i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.002916569959617841 + 0.00278636804487583i, 0.0 + 0.0i, 0.0008778384020643907 + 0.0006949286331374185i, 0.0 + 0.0i, 0.17254661698795143 + 3.435136010710107e-20i, 0.0 + 0.0i, -0.006617024497906316 + -0.047434161437765396i }, { -0.00047958685178231867 + -0.0006661718972143925i, 0.0 + 0.0i, -0.0009464863035452594 + 0.0009042331326270386i, 0.0 + 0.0i, -0.004851297072103777 + 0.034776538695533044i, 0.0 + 0.0i, 0.055994888503742526 + -1.7217653844113844e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0006541421603235688 + -0.0009086385966821014i, 0.0 + 0.0i, -0.0012909790854708143 + 0.0012333470207003833i, 0.0 + 0.0i, -0.006617024497906316 + 0.047434161437765396i, 0.0 + 0.0i, 0.0763753576579305 + 7.933578835163241e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.16672193248519027, 1.0e-7), DoubleNear(0.22740374279210654, 1.0e-7), DoubleNear(0.07379714215936728, 1.0e-7), DoubleNear(0.10065710062407046, 1.0e-7), DoubleNear(0.12650321878964155, 1.0e-7), DoubleNear(0.17254661698795143, 1.0e-7), DoubleNear(0.055994888503742526, 1.0e-7), DoubleNear(0.0763753576579305, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false, true}), Matrix({ { 0.29322515127483184 + 8.499515928481105e-20i, 0.0 + 0.0i, -0.011244949586715647 + -0.08060945735119673i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0005159838257675587 + -0.0005648256247675577i, 0.0 + 0.0i, -0.00013548658711411355 + 0.00016350784257240114i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011244949586715647 + 0.08060945735119673i, 0.0 + 0.0i, 0.1297920306631098 + -1.317422910802186e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00017506171962297954 + -0.00012018662235522183i, 0.0 + 0.0i, -0.0002283930564773484 + -0.00025001219878450907i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005159838257675586 + 0.0005648256247675579i, 0.0 + 0.0i, 0.00017506171962297957 + 0.00012018662235522179i, 0.0 + 0.0i, 0.0 + 0.0i, 0.399950359780058 + 2.3150079354599913e-19i, 0.0 + 0.0i, -0.015337775812758397 + -0.10994889534243577i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00013548658711411363 + -0.0001635078425724011i, 0.0 + 0.0i, -0.00022839305647734832 + 0.0002500121987845092i, 0.0 + 0.0i, 0.0 + 0.0i, -0.015337775812758397 + 0.10994889534243577i, 0.0 + 0.0i, 0.17703245828200098 + 1.3045252134111313e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.29322515127483184, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1297920306631098, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.399950359780058, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17703245828200098, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false, false}), Matrix({ { 0.1039933002266728 + -7.641367066665015e-22i, 0.0 + 0.0i, -0.0004862462288583143 + -3.308611605705768e-05i, 0.0 + 0.0i, -0.006875589556306806 + -0.0020900417336746344i, 0.0 + 0.0i, -0.0018298018820284217 + -0.0011556163534846577i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.14220092162418896 + 6.651883717679522e-20i, 0.0 + 0.0i, -0.0008552985729052341 + -9.228523302319394e-05i, 0.0 + 0.0i, -0.009840072391688642 + -0.004940159319087006i, 0.0 + 0.0i, -0.0019315679814876966 + -0.001656526465597725i }, { -0.000486246228858313 + 3.308611605705757e-05i, 0.0 + 0.0i, 0.10384513019215608 + -6.854042387190645e-20i, 0.0 + 0.0i, -0.001601063358363871 + -0.0013553901558510536i, 0.0 + 0.0i, -0.005236113980870885 + -0.0018280009869896961i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0008552985729052332 + 9.2285233023194e-05i, 0.0 + 0.0i, 0.1416840708800322 + 1.341166963232475e-20i, 0.0 + 0.0i, -0.0016551340154468547 + -0.0020000638646603813i, 0.0 + 0.0i, -0.00771535805355473 + -0.004466254702460011i }, { -0.006875589556306806 + 0.002090041733674634i, 0.0 + 0.0i, -0.001601063358363871 + 0.0013553901558510538i, 0.0 + 0.0i, 0.10790392675394894 + 8.11013719010926e-21i, 0.0 + 0.0i, 0.0009532321939513034 + -4.405782816089768e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.009840072391688642 + 0.004940159319087006i, 0.0 + 0.0i, -0.0016551340154468545 + 0.0020000638646603813i, 0.0 + 0.0i, 0.14706200847444717 + 3.524209283914578e-20i, 0.0 + 0.0i, 0.0014922534996540766 + -6.0861095207147625e-05i }, { -0.0018298018820284217 + 0.0011556163534846575i, 0.0 + 0.0i, -0.005236113980870885 + 0.0018280009869896952i, 0.0 + 0.0i, 0.0009532321939513051 + 4.405782816089766e-05i, 0.0 + 0.0i, 0.10727482476516381 + 1.4447291593056172e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0019315679814876962 + 0.0016565264655977246i, 0.0 + 0.0i, -0.007715358053554729 + 0.004466254702460012i, 0.0 + 0.0i, 0.0014922534996540805 + 6.086109520714768e-05i, 0.0 + 0.0i, 0.14603581708339058 + 2.467807152388465e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1039933002266728, 1.0e-7), DoubleNear(0.14220092162418896, 1.0e-7), DoubleNear(0.10384513019215608, 1.0e-7), DoubleNear(0.1416840708800322, 1.0e-7), DoubleNear(0.10790392675394894, 1.0e-7), DoubleNear(0.14706200847444717, 1.0e-7), DoubleNear(0.10727482476516381, 1.0e-7), DoubleNear(0.14603581708339058, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false, false}), Matrix({ { 0.09769869434388724 + -3.585359390117388e-19i, 0.0 + 0.0i, -0.024720663991110878 + -3.6643382578877617e-05i, 0.0 + 0.0i, -0.007760255799094375 + 0.0027185402069667694i, 0.0 + 0.0i, -0.0056792120227000895 + -0.01318468726165727i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.15552403062314565 + -3.3881317890172014e-20i, 0.0 + 0.0i, 0.034355203222509366 + -8.040180430452662e-05i, 0.0 + 0.0i, -0.010940586158166668 + -0.0037078270367010674i, 0.0 + 0.0i, -0.006313039441195796 + 0.018476523147937168i }, { -0.024720663991110878 + 3.6643382578877556e-05i, 0.0 + 0.0i, 0.09615081979821877 + -3.704891821646876e-19i, 0.0 + 0.0i, -0.004823337082715141 + -0.013479090147584308i, 0.0 + 0.0i, -0.006614697593544482 + 0.002719122001717884i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.034355203222509366 + 8.040180430452694e-05i, 0.0 + 0.0i, 0.15705383245039028 + 9.25383494875323e-20i, 0.0 + 0.0i, -0.008012124259995501 + 0.017892073889382812i, 0.0 + 0.0i, -0.008666421481566268 + -0.0037089820169243382i }, { -0.007760255799094376 + -0.0027185402069667694i, 0.0 + 0.0i, -0.004823337082715142 + 0.013479090147584308i, 0.0 + 0.0i, 0.11419853263673452 + 3.6588193949518154e-19i, 0.0 + 0.0i, 0.025187649956203866 + -4.050056163907774e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.010940586158166671 + 0.0037078270367010674i, 0.0 + 0.0i, -0.008012124259995503 + -0.017892073889382812i, 0.0 + 0.0i, 0.13373889947549045 + 1.3564224790611298e-19i, 0.0 + 0.0i, -0.03371824829576052 + -7.274452392581493e-05i }, { -0.0056792120227000895 + 0.013184687261657266i, 0.0 + 0.0i, -0.006614697593544484 + -0.0027191220017178845i, 0.0 + 0.0i, 0.025187649956203866 + 4.050056163907768e-05i, 0.0 + 0.0i, 0.11496913515910111 + 3.1639604988583737e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.006313039441195795 + -0.018476523147937168i, 0.0 + 0.0i, -0.008666421481566274 + 0.0037089820169243382i, 0.0 + 0.0i, -0.03371824829576052 + 7.274452392581473e-05i, 0.0 + 0.0i, 0.1306660555130325 + 1.6765403538363898e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.09769869434388724, 1.0e-7), DoubleNear(0.15552403062314565, 1.0e-7), DoubleNear(0.09615081979821877, 1.0e-7), DoubleNear(0.15705383245039028, 1.0e-7), DoubleNear(0.11419853263673452, 1.0e-7), DoubleNear(0.13373889947549045, 1.0e-7), DoubleNear(0.11496913515910111, 1.0e-7), DoubleNear(0.1306660555130325, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false, false}), Matrix({ { 0.10293092859376601 + 7.176584835399041e-21i, 0.0 + 0.0i, -0.0004375515228567002 + -0.00010993890199448907i, 0.0 + 0.0i, -0.010421568692731566 + -0.010742132667833665i, 0.0 + 0.0i, 0.001031387483428753 + -0.0004417585748768345i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.13954905081701188 + 9.167046079099927e-21i, 0.0 + 0.0i, -0.0002141370208475898 + -0.0001435554548761744i, 0.0 + 0.0i, -0.013686793233987998 + -0.014211014684978263i, 0.0 + 0.0i, 0.0007999731849464764 + -0.0005870054736385869i }, { -0.00043755152285669934 + 0.00010993890199448902i, 0.0 + 0.0i, 0.10203713428019455 + 1.8978509127724914e-20i, 0.0 + 0.0i, 0.0009785824859594575 + -0.00044694468513937016i, 0.0 + 0.0i, -0.01057236118919396 + -0.010887572634162321i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.00021413702084758894 + 0.00014355545487617437i, 0.0 + 0.0i, 0.13831441240141884 + 6.61437338273962e-20i, 0.0 + 0.0i, 0.000722415418727053 + -0.0005669500297977287i, 0.0 + 0.0i, -0.013783267126077239 + -0.014398440711863175i }, { -0.010421568692731564 + 0.010742132667833665i, 0.0 + 0.0i, 0.0009785824859594573 + 0.0004469446851393703i, 0.0 + 0.0i, 0.10896629838685574 + 1.6941564804368642e-22i, 0.0 + 0.0i, 0.0009045374879496906 + 3.279495777653372e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.013686793233987998 + 0.014211014684978263i, 0.0 + 0.0i, 0.0007224154187270532 + 0.0005669500297977285i, 0.0 + 0.0i, 0.14971387928162422 + 9.259388393684106e-20i, 0.0 + 0.0i, 0.000851091947596431 + -9.590873354167151e-06i }, { 0.0010313874834287533 + 0.0004417585748768346i, 0.0 + 0.0i, -0.01057236118919396 + 0.010887572634162321i, 0.0 + 0.0i, 0.0009045374879496923 + -3.279495777653377e-05i, 0.0 + 0.0i, 0.10908282067712534 + -7.307164140657518e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0007999731849464763 + 0.0005870054736385872i, 0.0 + 0.0i, -0.013783267126077237 + 0.014398440711863175i, 0.0 + 0.0i, 0.0008510919475964319 + 9.590873354167304e-06i, 0.0 + 0.0i, 0.14940547556200395 + 1.9404865104377506e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10293092859376601, 1.0e-7), DoubleNear(0.13954905081701188, 1.0e-7), DoubleNear(0.10203713428019455, 1.0e-7), DoubleNear(0.13831441240141884, 1.0e-7), DoubleNear(0.10896629838685574, 1.0e-7), DoubleNear(0.14971387928162422, 1.0e-7), DoubleNear(0.10908282067712534, 1.0e-7), DoubleNear(0.14940547556200395, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true, false}), Matrix({ { 0.12048050795393872 + 8.074383967009713e-20i, 0.0 + 0.0i, 0.0002655188417680851 + -4.3862497482326954e-05i, 0.0 + 0.0i, -0.0015452244800526359 + -0.0014762423576298134i, 0.0 + 0.0i, -3.942860957157764e-06 + -2.6908315843492765e-06i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.16446909309349042 + 9.945979478256554e-20i, 0.0 + 0.0i, 0.00036215978005923674 + -8.707592675650987e-05i, 0.0 + 0.0i, -0.0021094007086796054 + -0.002015232553953008i, 0.0 + 0.0i, -5.711822940761028e-06 + -3.3207342888932412e-06i }, { 0.00026551884176808684 + 4.386249748232685e-05i, 0.0 + 0.0i, 0.12003856669061885 + 9.348090400187722e-20i, 0.0 + 0.0i, -2.867970457532502e-06 + -3.815949763496748e-06i, 0.0 + 0.0i, -0.0015395563560512962 + -0.001470827270794799i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.00036215978005923674 + 8.707592675651e-05i, 0.0 + 0.0i, 0.16359175032268658 + 1.4880637164581324e-19i, 0.0 + 0.0i, -3.5779479498457593e-06 + -5.554321379991312e-06i, 0.0 + 0.0i, -0.0020981483364090484 + -0.0020044825116232057i }, { -0.001545224480052636 + 0.0014762423576298134i, 0.0 + 0.0i, -2.8679704575327865e-06 + 3.815949763496585e-06i, 0.0 + 0.0i, 0.09141671902668304 + -7.33978391866544e-20i, 0.0 + 0.0i, 0.0002014671233249053 + -3.32814467356284e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.002109400708679606 + 0.002015232553953008i, 0.0 + 0.0i, -3.577947949845705e-06 + 5.55432137999119e-06i, 0.0 + 0.0i, 0.1247938370051457 + 2.301135233375444e-21i, 0.0 + 0.0i, 0.00027479514668960446 + -6.607040147383166e-05i }, { -3.942860957157452e-06 + 2.6908315843493714e-06i, 0.0 + 0.0i, -0.0015395563560512957 + 0.0014708272707947992i, 0.0 + 0.0i, 0.00020146712332490616 + 3.328144673562839e-05i, 0.0 + 0.0i, 0.09108138826670104 + -1.4757403628072749e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, -5.7118229407610005e-06 + 3.3207342888932412e-06i, 0.0 + 0.0i, -0.0020981483364090493 + 0.0020044825116232057i, 0.0 + 0.0i, 0.0002747951466896062 + 6.607040147383167e-05i, 0.0 + 0.0i, 0.12412813764073623 + 1.1138601322535803e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12048050795393872, 1.0e-7), DoubleNear(0.16446909309349042, 1.0e-7), DoubleNear(0.12003856669061885, 1.0e-7), DoubleNear(0.16359175032268658, 1.0e-7), DoubleNear(0.09141671902668304, 1.0e-7), DoubleNear(0.1247938370051457, 1.0e-7), DoubleNear(0.09108138826670104, 1.0e-7), DoubleNear(0.12412813764073623, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false, true}), Matrix({ { 0.21189722698062174 + 7.346000483442728e-21i, 0.0 + 0.0i, 0.0004669859650929904 + -7.714394421795535e-05i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0004764683829221458 + -0.0005448003706794098i, 0.0 + 0.0i, -0.0003072326311713365 + -0.0002708667188373658i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.000466985965092993 + 7.714394421795524e-05i, 0.0 + 0.0i, 0.2111199549573199 + -5.409313227885027e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00023661989795869913 + -0.0003244655943225209i, 0.0 + 0.0i, -0.0002679084993227614 + -0.00027003745287265695i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004764683829221457 + 0.0005448003706794099i, 0.0 + 0.0i, -0.00023661989795869927 + 0.00032446559432252096i, 0.0 + 0.0i, 0.0 + 0.0i, 0.28926293009863613 + 1.0176093001594098e-19i, 0.0 + 0.0i, 0.0006369549267488412 + -0.00015314632823034153i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00030723263117133655 + 0.00027086671883736597i, 0.0 + 0.0i, -0.0002679084993227613 + 0.0002700374528726571i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0006369549267488429 + 0.00015314632823034167i, 0.0 + 0.0i, 0.2877198879634228 + 2.601923848711713e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.21189722698062174, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2111199549573199, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28926293009863613, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2877198879634228, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false, false}), Matrix({ { 0.09541163465673336 + -4.0270829697239423e-19i, 0.0 + 0.0i, -0.005148929510764065 + -0.0015004574181238465i, 0.0 + 0.0i, -0.007027326893291206 + 0.0027619171690490604i, 0.0 + 0.0i, 0.0003884041993747219 + 0.0002540612392594114i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.153517871647815 + -1.1731691101465128e-20i, 0.0 + 0.0i, -0.009928843437601791 + -0.005524510444255122i, 0.0 + 0.0i, -0.009589112000032977 + -0.0037965892494096582i, 0.0 + 0.0i, 0.0007927537895745997 + 0.00041157399306720923i }, { -0.005148929510764066 + 0.0015004574181238463i, 0.0 + 0.0i, 0.09843787948537268 + -3.263168242040322e-19i, 0.0 + 0.0i, 0.0006032779147178758 + -0.00013610496940164293i, 0.0 + 0.0i, -0.007347626499347651 + 0.002675745039635593i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.00992884343760179 + 0.005524510444255122i, 0.0 + 0.0i, 0.15905999142572097 + 7.038872269882543e-20i, 0.0 + 0.0i, 0.0005760251364756381 + -0.0004077163886363344i, 0.0 + 0.0i, -0.01001789563969996 + -0.003620219804215748i }, { -0.007027326893291207 + -0.002761917169049061i, 0.0 + 0.0i, 0.0006032779147178757 + 0.00013610496940164312i, 0.0 + 0.0i, 0.11242679576209555 + 3.334037363938213e-19i, 0.0 + 0.0i, -0.006962774026413628 + -0.002417585302540484i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.009589112000032981 + 0.0037965892494096582i, 0.0 + 0.0i, 0.0005760251364756381 + 0.00040771638863633484i, 0.0 + 0.0i, 0.13036712085640617 + 9.166219791058508e-20i, 0.0 + 0.0i, -0.007626587007641582 + -0.0038819035772918965i }, { 0.00038840419937472215 + -0.00025406123925941147i, 0.0 + 0.0i, -0.007347626499347651 + -0.0026757450396355936i, 0.0 + 0.0i, -0.006962774026413626 + 0.0024175853025404834i, 0.0 + 0.0i, 0.11674087203374006 + 3.4887425298719773e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0007927537895745995 + -0.0004115739930672099i, 0.0 + 0.0i, -0.010017895639699964 + 0.003620219804215748i, 0.0 + 0.0i, -0.007626587007641582 + 0.0038819035772918965i, 0.0 + 0.0i, 0.13403783413211678 + 2.116340853791669e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.09541163465673336, 1.0e-7), DoubleNear(0.153517871647815, 1.0e-7), DoubleNear(0.09843787948537268, 1.0e-7), DoubleNear(0.15905999142572097, 1.0e-7), DoubleNear(0.11242679576209555, 1.0e-7), DoubleNear(0.13036712085640617, 1.0e-7), DoubleNear(0.11674087203374006, 1.0e-7), DoubleNear(0.13403783413211678, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false, false}), Matrix({ { 0.08662811929552922 + 2.379437880235446e-20i, 0.0 + 0.0i, -0.0018199264992239173 + -0.0018584946460406585i, 0.0 + 0.0i, -0.01523003191188255 + -0.008503659827054552i, 0.0 + 0.0i, 0.0032387279910142336 + 0.023821051848225715i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.11908192105658985 + 1.599485104488842e-20i, 0.0 + 0.0i, -0.0020414207020885457 + -0.004008919116012019i, 0.0 + 0.0i, -0.02035144404755527 + -0.010846196432497507i, 0.0 + 0.0i, 0.004591687952945986 + 0.033622570408897094i }, { -0.001819926499223918 + 0.0018584946460406585i, 0.0 + 0.0i, 0.11833994357843135 + 2.360715160769491e-21i, 0.0 + 0.0i, -0.01859434187690449 + 0.011838844919500328i, 0.0 + 0.0i, -0.0057638979700429735 + -0.013126045474941433i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0020414207020885452 + 0.004008919116012019i, 0.0 + 0.0i, 0.1587815421618409 + 5.931592886160773e-20i, 0.0 + 0.0i, -0.024837390294595148 + 0.0160198208504834i, 0.0 + 0.0i, -0.007118616312509969 + -0.017763258964343928i }, { -0.01523003191188255 + 0.008503659827054552i, 0.0 + 0.0i, -0.01859434187690449 + -0.011838844919500328i, 0.0 + 0.0i, 0.12121031112329969 + -9.309893938092742e-20i, 0.0 + 0.0i, -0.010291777037953774 + -0.002059548074623672i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.02035144404755527 + 0.010846196432497507i, 0.0 + 0.0i, -0.024837390294595144 + -0.016019820850483396i, 0.0 + 0.0i, 0.16480307144763132 + 6.393565576423154e-20i, 0.0 + 0.0i, -0.015514009743154828 + -0.005397494905534999i }, { 0.003238727991014234 + -0.023821051848225715i, 0.0 + 0.0i, -0.0057638979700429735 + 0.013126045474941433i, 0.0 + 0.0i, -0.010291777037953774 + 0.0020595480746236714i, 0.0 + 0.0i, 0.0968388079406814 + 2.0196713622395952e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.004591687952945986 + -0.0336225704088971i, 0.0 + 0.0i, -0.007118616312509968 + 0.017763258964343928i, 0.0 + 0.0i, -0.015514009743154828 + 0.005397494905535i, 0.0 + 0.0i, 0.13431628339599685 + 2.227068792163846e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.08662811929552922, 1.0e-7), DoubleNear(0.11908192105658985, 1.0e-7), DoubleNear(0.11833994357843135, 1.0e-7), DoubleNear(0.1587815421618409, 1.0e-7), DoubleNear(0.12121031112329969, 1.0e-7), DoubleNear(0.16480307144763132, 1.0e-7), DoubleNear(0.0968388079406814, 1.0e-7), DoubleNear(0.13431628339599685, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true, false}), Matrix({ { 0.11817275773740935 + 3.922985417648993e-20i, 0.0 + 0.0i, -0.006886471404744397 + -0.0022277204090737812i, 0.0 + 0.0i, -0.0015156263966033922 + -0.0014479655958670517i, 0.0 + 0.0i, 6.102637755954128e-05 + 0.00011295129082877476i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.16141130577672222 + 8.019513080743586e-20i, 0.0 + 0.0i, -0.009981665204077396 + -0.005348298113616545i, 0.0 + 0.0i, -0.0020701830136606635 + -0.001977765620634946i, 0.0 + 0.0i, 6.248752878229763e-05 + 0.00019089957816671369i }, { -0.006886471404744398 + 0.002227720409073781i, 0.0 + 0.0i, 0.12234631690714823 + 1.3499488949548443e-19i, 0.0 + 0.0i, 0.00011561869767307242 + 5.580797081339548e-05i, 0.0 + 0.0i, -0.0015691544395005398 + -0.0014991040325575608i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.009981665204077396 + 0.005348298113616546i, 0.0 + 0.0i, 0.16664953763945478 + 1.6807103562094294e-19i, 0.0 + 0.0i, 0.00019355245124379455 + 5.371023007832164e-05i, 0.0 + 0.0i, -0.0021373660314279903 + -0.0020419494449412674i }, { -0.001515626396603392 + 0.0014479655958670517i, 0.0 + 0.0i, 0.00011561869767307234 + -5.580797081339547e-05i, 0.0 + 0.0i, 0.08966567268141956 + -1.085344147550629e-19i, 0.0 + 0.0i, -0.005225232132433295 + -0.0016903223115905491i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0020701830136606644 + 0.0019777656206349465i, 0.0 + 0.0i, 0.00019355245124379468 + -5.3710230078321615e-05i, 0.0 + 0.0i, 0.12247368672749895 + -2.6462399831591e-22i, 0.0 + 0.0i, -0.007573765241165976 + -0.004058115907930473i }, { 6.102637755954132e-05 + -0.00011295129082877478i, 0.0 + 0.0i, -0.0015691544395005398 + 0.0014991040325575606i, 0.0 + 0.0i, -0.005225232132433295 + 0.001690322311590549i, 0.0 + 0.0i, 0.09283243461196453 + -1.12437460712319e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 6.248752878229753e-05 + -0.00019089957816671385i, 0.0 + 0.0i, -0.0021373660314279908 + 0.0020419494449412674i, 0.0 + 0.0i, -0.007573765241165976 + 0.004058115907930473i, 0.0 + 0.0i, 0.12644828791838297 + 1.1395177245704938e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.11817275773740935, 1.0e-7), DoubleNear(0.16141130577672222, 1.0e-7), DoubleNear(0.12234631690714823, 1.0e-7), DoubleNear(0.16664953763945478, 1.0e-7), DoubleNear(0.08966567268141956, 1.0e-7), DoubleNear(0.12247368672749895, 1.0e-7), DoubleNear(0.09283243461196453, 1.0e-7), DoubleNear(0.12644828791838297, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false, true}), Matrix({ { 0.2078384304188289 + -6.930456057857297e-20i, 0.0 + 0.0i, -0.012111703537177693 + -0.00391804272066433i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0003643134660670119 + -0.0004325967401278323i, 0.0 + 0.0i, -4.226962420468211e-05 + 7.398637771650074e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012111703537177693 + 0.0039180427206643295i, 0.0 + 0.0i, 0.21517875151911275 + 2.2557428783165437e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 9.528561783842408e-05 + 3.954083120720695e-05i, 0.0 + 0.0i, -0.00038006341617789524 + -0.0003822410834242345i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0003643134660670118 + 0.00043259674012783244i, 0.0 + 0.0i, 9.528561783842408e-05 + -3.954083120720694e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.28388499250422117 + 7.993050680911995e-20i, 0.0 + 0.0i, -0.017555430445243374 + -0.009406414021547018i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -4.2269624204682115e-05 + -7.398637771650076e-05i, 0.0 + 0.0i, -0.00038006341617789513 + 0.0003822410834242346i, 0.0 + 0.0i, 0.0 + 0.0i, -0.017555430445243374 + 0.00940641402154702i, 0.0 + 0.0i, 0.29309782555783775 + 2.820228080779923e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2078384304188289, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21517875151911275, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28388499250422117, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29309782555783775, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false, false}), Matrix({ { 0.0940840475258527 + -3.0070127029042475e-19i, 0.0 + 0.0i, -0.006932353705614024 + 0.002718478986872647i, 0.0 + 0.0i, -0.009862982355111303 + -0.00981276968460519i, 0.0 + 0.0i, 0.0008875225534247272 + 0.0003562958857774314i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.15040847568737042 + -5.2021936329726866e-20i, 0.0 + 0.0i, -0.009416558804848643 + -0.00363748263040213i, 0.0 + 0.0i, -0.014695157665024373 + -0.015627637928052714i, 0.0 + 0.0i, 0.0005953287631033399 + 0.001452146730689808i }, { -0.006932353705614024 + -0.002718478986872647i, 0.0 + 0.0i, 0.11088401534810786 + 3.268563642535487e-19i, 0.0 + 0.0i, 0.0004375077804361165 + 0.0011553753355705387i, 0.0 + 0.0i, -0.011130947526814223 + -0.011816935617390797i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.009416558804848645 + 0.00363748263040213i, 0.0 + 0.0i, 0.12745498753106033 + 1.2733271623622299e-19i, 0.0 + 0.0i, 0.001193274953614615 + 0.0005462642520330015i, 0.0 + 0.0i, -0.012774902695040863 + -0.012981817468788721i }, { -0.009862982355111303 + 0.00981276968460519i, 0.0 + 0.0i, 0.00043750778043611646 + -0.0011553753355705387i, 0.0 + 0.0i, 0.09976546661625334 + -4.283238508860017e-19i, 0.0 + 0.0i, -0.007442599687024834 + 0.002719183221812007i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.014695157665024373 + 0.01562763792805271i, 0.0 + 0.0i, 0.0011932749536146146 + -0.0005462642520330015i, 0.0 + 0.0i, 0.16216938738616554 + 1.1067896792708714e-19i, 0.0 + 0.0i, -0.010190448834884295 + -0.0037793264232232763i }, { 0.0008875225534247272 + -0.00035629588577743135i, 0.0 + 0.0i, -0.011130947526814221 + 0.011816935617390797i, 0.0 + 0.0i, -0.007442599687024835 + -0.002719183221812007i, 0.0 + 0.0i, 0.11828365244772776 + 3.554216251274702e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0005953287631033401 + -0.001452146730689808i, 0.0 + 0.0i, -0.012774902695040863 + 0.012981817468788721i, 0.0 + 0.0i, -0.010190448834884298 + 0.0037793264232232763i, 0.0 + 0.0i, 0.13694996745746263 + 1.7596356705352898e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.0940840475258527, 1.0e-7), DoubleNear(0.15040847568737042, 1.0e-7), DoubleNear(0.11088401534810786, 1.0e-7), DoubleNear(0.12745498753106033, 1.0e-7), DoubleNear(0.09976546661625334, 1.0e-7), DoubleNear(0.16216938738616554, 1.0e-7), DoubleNear(0.11828365244772776, 1.0e-7), DoubleNear(0.13694996745746263, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true, false}), Matrix({ { 0.1102189408670318 + -2.9601843363618033e-19i, 0.0 + 0.0i, -0.008173309822113475 + 0.003091745533055872i, 0.0 + 0.0i, -0.0014136146044331434 + -0.0013505078280647209i, 0.0 + 0.0i, 0.00014270992401250193 + 6.049397866458882e-05i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1777254957739505 + 1.4866687293053263e-19i, 0.0 + 0.0i, -0.011148150797215544 + -0.0042170486839824455i, 0.0 + 0.0i, -0.002279420891090469 + -0.002177662672144195i, 0.0 + 0.0i, 9.130945589887138e-05 + 0.000190683619004501i }, { -0.008173309822113476 + -0.003091745533055872i, 0.0 + 0.0i, 0.13030013377752578 + 4.702431773081547e-19i, 0.0 + 0.0i, 6.694388031928e-05 + 0.00013980043188103428i, 0.0 + 0.0i, -0.0016711662316707889 + -0.0015965618003598919i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.011148150797215548 + 0.0042170486839824455i, 0.0 + 0.0i, 0.1503353476422265 + 9.959929349784617e-20i, 0.0 + 0.0i, 0.0001946520794851199 + 8.251198243479648e-05i, 0.0 + 0.0i, -0.0019281281539981852 + -0.0018420523934320186i }, { -0.0014136146044331434 + 0.0013505078280647209i, 0.0 + 0.0i, 6.694388031928001e-05 + -0.00013980043188103425i, 0.0 + 0.0i, 0.08363057327507424 + -4.3300668754024615e-19i, 0.0 + 0.0i, -0.006201643570525382 + 0.002345916675628782i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.002279420891090469 + 0.002177662672144195i, 0.0 + 0.0i, 0.00019465207948511979 + -8.251198243479656e-05i, 0.0 + 0.0i, 0.13485236729958547 + -9.000984133317235e-20i, 0.0 + 0.0i, -0.008458856842517393 + -0.0031997603696429606i }, { 0.0001427099240125019 + -6.049397866458888e-05i, 0.0 + 0.0i, -0.0016711662316707884 + 0.0015965618003598919i, 0.0 + 0.0i, -0.006201643570525384 + -0.002345916675628782i, 0.0 + 0.0i, 0.09886753401830983 + 2.1203481207286423e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 9.130945589887147e-05 + -0.00019068361900450095i, 0.0 + 0.0i, -0.0019281281539981856 + 0.0018420523934320186i, 0.0 + 0.0i, -0.008458856842517397 + 0.0031997603696429606i, 0.0 + 0.0i, 0.11406960734629645 + 2.036969897919058e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.1102189408670318, 1.0e-7), DoubleNear(0.1777254957739505, 1.0e-7), DoubleNear(0.13030013377752578, 1.0e-7), DoubleNear(0.1503353476422265, 1.0e-7), DoubleNear(0.08363057327507424, 1.0e-7), DoubleNear(0.13485236729958547, 1.0e-7), DoubleNear(0.09886753401830983, 1.0e-7), DoubleNear(0.11406960734629645, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false, true}), Matrix({ { 0.19384951414210605 + -7.290251211764264e-19i, 0.0 + 0.0i, -0.014374953392638857 + 0.005437662208684654i, 0.0 + 0.0i, 0.0 + 0.0i, -0.000526304169998655 + -0.0002666299321166497i, 0.0 + 0.0i, 0.005019045732547656 + 0.005494136637725226i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01437495339263886 + -0.005437662208684654i, 0.0 + 0.0i, 0.2291676677958356 + 6.822779893810189e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.005933484074896385 + 0.006495133533820186i, 0.0 + 0.0i, -0.00021807271224625214 + -0.000548207891435417i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0005263041699986549 + 0.0002666299321166499i, 0.0 + 0.0i, 0.005933484074896381 + -0.006495133533820186i, 0.0 + 0.0i, 0.0 + 0.0i, 0.31257786307353597 + 5.865703159736029e-20i, 0.0 + 0.0i, -0.019607007639732936 + -0.007416809053625406i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.005019045732547656 + -0.005494136637725225i, 0.0 + 0.0i, -0.000218072712246252 + 0.0005482078914354172i, 0.0 + 0.0i, 0.0 + 0.0i, -0.019607007639732943 + 0.007416809053625406i, 0.0 + 0.0i, 0.26440495498852296 + 3.0329628328975196e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.19384951414210605, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2291676677958356, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.31257786307353597, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26440495498852296, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true, false}), Matrix({ { 0.11654072439394392 + 3.278906613427285e-20i, 0.0 + 0.0i, -0.011936726932038014 + -0.012298216068286707i, 0.0 + 0.0i, -0.0014946947295859433 + -0.0014279683631893063i, 0.0 + 0.0i, 2.4051623679333666e-06 + 0.0003039911356634602i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1579875851488072 + 9.000186968576195e-20i, 0.0 + 0.0i, -0.015618924668649316 + -0.016266761805298333i, 0.0 + 0.0i, -0.0020262720357194174 + -0.0019358149225722245i, 0.0 + 0.0i, 1.0048260394533365e-06 + 0.0004000075825348143i }, { -0.011936726932038014 + 0.012298216068286707i, 0.0 + 0.0i, 0.12397835025061366 + 1.4143567753770152e-19i, 0.0 + 0.0i, 0.00030378416203532144 + -1.1470756926809748e-05i, 0.0 + 0.0i, -0.001590086106517989 + -0.0015191012652353065i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.015618924668649316 + 0.016266761805298333i, 0.0 + 0.0i, 0.1700732582673698 + 1.5826429674261686e-19i, 0.0 + 0.0i, 0.00039963665796428167 + -1.725159041525195e-05i, 0.0 + 0.0i, -0.002181277009369237 + -0.0020839001430039894i }, { -0.0014946947295859433 + 0.0014279683631893063i, 0.0 + 0.0i, 0.00030378416203532144 + 1.147075692680974e-05i, 0.0 + 0.0i, 0.08842733848001665 + -6.6339721711489186e-21i, 0.0 + 0.0i, -0.00905720294988751 + -0.00933148923370928i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.0020262720357194174 + 0.0019358149225722245i, 0.0 + 0.0i, 0.00039963665796428167 + 1.7251590415251928e-05i, 0.0 + 0.0i, 0.11987587806962355 + -1.4691089779265814e-20i, 0.0 + 0.0i, -0.01185113569141592 + -0.012342693591543101i }, { 2.4051623679333463e-06 + -0.00030399113566346016i, 0.0 + 0.0i, -0.0015900861065179885 + 0.0015191012652353065i, 0.0 + 0.0i, -0.00905720294988751 + 0.00933148923370928i, 0.0 + 0.0i, 0.09407076881336743 + -2.14337903296233e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 1.0048260394532552e-06 + -0.00040000758253481435i, 0.0 + 0.0i, -0.002181277009369237 + 0.002083900143003989i, 0.0 + 0.0i, -0.01185113569141592 + 0.012342693591543101i, 0.0 + 0.0i, 0.12904609657625837 + 1.2837823823799926e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.11654072439394392, 1.0e-7), DoubleNear(0.1579875851488072, 1.0e-7), DoubleNear(0.12397835025061366, 1.0e-7), DoubleNear(0.1700732582673698, 1.0e-7), DoubleNear(0.08842733848001665, 1.0e-7), DoubleNear(0.11987587806962355, 1.0e-7), DoubleNear(0.09407076881336743, 1.0e-7), DoubleNear(0.12904609657625837, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false, true}), Matrix({ { 0.20496806287396058 + 2.6155093963123932e-20i, 0.0 + 0.0i, -0.020993929881925524 + -0.021629705301995986i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00035453129567802855 + -0.0003860891263124532i, 0.0 + 0.0i, -1.206027832043248e-06 + 4.367551139149513e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.020993929881925524 + 0.021629705301995986i, 0.0 + 0.0i, 0.21804911906398108 + -7.290222575853147e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 5.410519773568178e-05 + -2.436757236532002e-05i, 0.0 + 0.0i, -0.0003898455865668786 + -0.00042874869723961355i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0003545312956780284 + 0.0003860891263124534i, 0.0 + 0.0i, 5.410519773568177e-05 + 2.436757236531998e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.27786346321843075 + 7.531077990649613e-20i, 0.0 + 0.0i, -0.027470060360065236 + -0.028609455396841434i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -1.2060278320432852e-06 + -4.367551139149513e-05i, 0.0 + 0.0i, -0.0003898455865668785 + 0.0004287486972396137i, 0.0 + 0.0i, 0.0 + 0.0i, -0.027470060360065236 + 0.028609455396841434i, 0.0 + 0.0i, 0.29911935484362817 + 2.866425349806161e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.20496806287396058, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21804911906398108, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27786346321843075, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.29911935484362817, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true, true}), Matrix({ { 0.24051907464455757 + 1.7422474367197437e-19i, 0.0 + 0.0i, -0.0030847808361039323 + -0.0029470696284246128i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00042323774671311417 + -0.00046330042294802116i, 0.0 + 0.0i, -2.485578959519603e-07 + 1.112797967880653e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003084780836103932 + 0.0029470696284246128i, 0.0 + 0.0i, 0.18249810729338406 + -2.209718754673819e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 1.1105041458479027e-05 + 7.561527392227782e-07i, 0.0 + 0.0i, -0.000321139135531793 + -0.00035153740060404567i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.000423237746713114 + 0.00046330042294802137i, 0.0 + 0.0i, 1.1105041458479038e-05 + -7.561527392227712e-07i, 0.0 + 0.0i, 0.0 + 0.0i, 0.32806084341617703 + 2.482661664283788e-19i, 0.0 + 0.0i, -0.004207549045088655 + -0.004019715065576214i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.485578959519673e-07 + -1.1127979678806527e-05i, 0.0 + 0.0i, -0.0003211391355317929 + 0.0003515374006040457i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004207549045088655 + 0.004019715065576213i, 0.0 + 0.0i, 0.24892197464588192 + 1.1368714845873345e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.24051907464455757, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.18249810729338406, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.32806084341617703, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24892197464588192, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false, false}), Matrix({ { 0.1846381086967391 + 9.198523561678387e-20i, 0.02207529625108033 + -0.012931267074701401i, -0.007080723515887445 + -0.050758189342514665i, -0.0044014574111367 + -0.005572735484029319i, 0.0004067154092427829 + -8.484385631115875e-05i, 4.2684712483982206e-05 + -3.8628530663636375e-05i, -3.892132526927792e-05 + -0.00010855495652429409i, -1.2256153060032875e-05 + -1.0252925499512744e-05i }, { 0.02207529625108033 + 0.012931267074701401i, 0.1627538393070241 + -1.5653169725055033e-20i, 0.0027083175670545878 + -0.00656454294471391i, -0.006241479320907737 + -0.044742064626190764i, 5.456891746583903e-05 + 1.8340700850245288e-05i, 0.00035850938263407234 + -7.478772098415914e-05i, 2.949300949505959e-06 + -1.5704693344308064e-05i, -3.4308167274919404e-05 + -9.568845822156125e-05i }, { -0.007080723515887445 + 0.05075818934251468i, 0.0027083175670545878 + 0.006564542944713911i, 0.08172748811402078 + 7.013306397062227e-20i, 0.009771322533079642 + -0.00572384532969142i, 7.726905191793483e-06 + 0.00011506234433065132i, 8.982304020010037e-06 + 1.3215671894445005e-05i, 0.00018002691323747134 + -3.75549517223818e-05i, 1.8893793685434815e-05 + -1.7098381276531138e-05i }, { -0.0044014574111367 + 0.005572735484029318i, -0.006241479320907737 + 0.044742064626190764i, 0.009771322533079642 + 0.00572384532969142i, 0.07204072096147386 + -3.7358199362967353e-20i, -7.134649465737961e-06 + 1.4297990982321805e-05i, 6.8110721822400025e-06 + 0.00010142455656453076i, 2.4154171557884485e-05 + 8.118255875352339e-06i, 0.0001586891867275083 + -3.310374343059723e-05i }, { 0.0004067154092427857 + 8.48438563111588e-05i, 5.4568917465839225e-05 + -1.834070085024533e-05i, 7.726905191793415e-06 + -0.00011506234433065164i, -7.1346494657379135e-06 + -1.4297990982321765e-05i, 0.1837832553893507 + 2.2557348358133293e-19i, 0.021973090156439216 + -0.012871396788412412i, -0.007047940576552851 + -0.050523184736245855i, -0.004381079167166386 + -0.005546934356659952i }, { 4.268471248398212e-05 + 3.862853066363636e-05i, 0.00035850938263407256 + 7.478772098415916e-05i, 8.982304020009982e-06 + -1.3215671894444995e-05i, 6.811072182239962e-06 + -0.00010142455656453109i, 0.021973090156439216 + 0.012871396788412412i, 0.16200030766177587 + 1.459040335774847e-20i, 0.0026957783667454173 + -0.006534149862335672i, -0.006212581986126011 + -0.044534913988681216i }, { -3.892132526927789e-05 + 0.00010855495652429376i, 2.9493009495059622e-06 + 1.5704693344308017e-05i, 0.00018002691323747112 + 3.755495172238177e-05i, 2.415417155788437e-05 + -8.118255875352257e-06i, -0.007047940576552851 + 0.050523184736245855i, 0.0026957783667454173 + 0.006534149862335673i, 0.08134909919955476 + 8.052540255715229e-20i, 0.009726082428293464 + -0.005697344581034471i }, { -1.2256153060032787e-05 + 1.0252925499512639e-05i, -3.4308167274919364e-05 + 9.568845822156147e-05i, 1.8893793685434778e-05 + 1.7098381276531084e-05i, 0.00015868918672750927 + 3.31037434305972e-05i, -0.004381079167166386 + 0.005546934356659953i, -0.006212581986126011 + 0.044534913988681216i, 0.009726082428293464 + 0.005697344581034472i, 0.07170718067006135 + -1.145900369039127e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1846381086967391, 1.0e-7), DoubleNear(0.1627538393070241, 1.0e-7), DoubleNear(0.08172748811402078, 1.0e-7), DoubleNear(0.07204072096147386, 1.0e-7), DoubleNear(0.1837832553893507, 1.0e-7), DoubleNear(0.16200030766177587, 1.0e-7), DoubleNear(0.08134909919955476, 1.0e-7), DoubleNear(0.07170718067006135, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false, false}), Matrix({ { 0.18116141422639126 + 1.6811756062986927e-19i, 0.021659623338542648 + -0.012687774195303207i, -0.006947395068864727 + -0.04980242394035797i, -0.004318578948230082 + -0.005467802115837932i, -0.010930005970328352 + -0.004909014528671598i, -0.0016505958597392164 + 0.0001785702666791672i, -0.0009303623170811217 + 0.00319298486824325i, 0.00011238912959409514 + 0.00044691126372850337i }, { 0.021659623338542648 + 0.012687774195303207i, 0.1596892207559535 + -1.5328613525947573e-19i, 0.002657320550372674 + -0.0064409340628999515i, -0.006123953655188145 + -0.043899581512732766i, -0.0009629829027834569 + -0.0013524119051815755i, -0.009634524789470248 + -0.00432717258313952i, -0.00033485700380894853 + 0.0003165940320006364i, -0.0008200909342081325 + 0.0028145356872635655i }, { -0.006947395068864727 + 0.04980242394035797i, 0.0026573205503726736 + 0.0064409340628999515i, 0.08018857771244095 + 1.0081175158681951e-19i, 0.009587330705723237 + -0.0056160665967563365i, 0.0017686762583272169 + -0.002816471321193339i, 1.4208927565145484e-05 + -0.00046060731700199315i, -0.00483801496522783 + -0.0021729069333271877i, -0.0007306132762086245 + 7.904164232698784e-05i }, { -0.004318578948230082 + 0.005467802115837932i, -0.006123953655188145 + 0.043899581512732766i, 0.009587330705723237 + 0.005616066596756337i, 0.07068421022826435 + -1.0501723072666604e-19i, 0.0004087162491539676 + -0.00021286620627952686i, 0.0015590435450502445 + -0.0024826484849627267i, -0.0004262509743885291 + -0.0005986263003133732i, -0.004264588257394636 + -0.001915362697073042i }, { -0.010930005970328352 + 0.004909014528671599i, -0.0009629829027834569 + 0.0013524119051815753i, 0.0017686762583272169 + 0.0028164713211933385i, 0.0004087162491539675 + 0.0002128662062795268i, 0.18725994985969857 + 1.4944115856824757e-19i, 0.022388763068976893 + -0.013114889667810607i, -0.00718126902357557 + -0.05147895013840255i, -0.004463957630073003 + -0.00565186772485134i }, { -0.0016505958597392164 + -0.00017857026667916716i, -0.009634524789470246 + 0.00432717258313952i, 1.420892756514547e-05 + 0.00046060731700199315i, 0.0015590435450502445 + 0.0024826484849627263i, 0.022388763068976896 + 0.013114889667810607i, 0.1650649262128465 + 1.5222336889216916e-19i, 0.002746775383427332 + -0.0066577587441496305i, -0.006330107651845602 + -0.04537739710213922i }, { -0.0009303623170811218 + -0.0031929848682432497i, -0.0003348570038089485 + -0.0003165940320006364i, -0.004838014965227829 + 0.0021729069333271877i, -0.00042625097438852904 + 0.0005986263003133732i, -0.007181269023575571 + 0.05147895013840255i, 0.0027467753834273323 + 0.006657758744149632i, 0.08288800960113459 + 4.9846714940955063e-20i, 0.00991007425564987 + -0.005805123313969556i }, { 0.00011238912959409507 + -0.00044691126372850337i, -0.0008200909342081327 + -0.0028145356872635646i, -0.0007306132762086245 + -7.904164232698783e-05i, -0.004264588257394636 + 0.0019153626970730417i, -0.0044639576300730035 + 0.00565186772485134i, -0.006330107651845602 + 0.04537739710213922i, 0.00991007425564987 + 0.005805123313969556i, 0.07306369140327088 + -4.6931005540214025e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.18116141422639126, 1.0e-7), DoubleNear(0.1596892207559535, 1.0e-7), DoubleNear(0.08018857771244095, 1.0e-7), DoubleNear(0.07068421022826435, 1.0e-7), DoubleNear(0.18725994985969857, 1.0e-7), DoubleNear(0.1650649262128465, 1.0e-7), DoubleNear(0.08288800960113459, 1.0e-7), DoubleNear(0.07306369140327088, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false, false}), Matrix({ { 0.18657866512432747 + -1.4682633326964794e-19i, 0.022307308798941244 + -0.013067175385373546i, -0.007155142299895355 + -0.05129166063550297i, -0.004447716964650468 + -0.00563130523292414i, -0.012519680437866759 + -0.0007291599803397526i, -0.0015479178112149325 + 0.0007896468929445475i, 0.0002796690006695336 + 0.00346970240821129i, 0.0002764403562872922 + 0.0003952501167786678i }, { 0.022307308798941244 + 0.013067175385373546i, 0.16446439088931242 + -2.739262312027127e-19i, 0.002736782129976051 + -0.006633536643227511i, -0.006307077603403907 + -0.045212306125666554i, -0.0014457832896634356 + -0.0009640033429108943i, -0.011035782767394899 + -0.0006427361453547255i, -0.00020956601397951086 + 0.00043442376912703i, 0.000246521175478923 + 0.003058455224520983i }, { -0.007155142299895355 + 0.05129166063550297i, 0.002736782129976051 + 0.006633536643227513i, 0.08258644839849165 + -9.539271720748078e-20i, 0.009874019657099421 + -0.005784003251170663i, 0.0006805704245880195 + -0.003413777006287728i, -0.00015771754089567022 + -0.0004558147679613048i, -0.005541662235382098 + -0.0003227525132653681i, -0.0006851642676070353 + 0.00034952620297577135i }, { -0.004447716964650468 + 0.00563130523292414i, -0.006307077603403908 + 0.045212306125666554i, 0.009874019657099421 + 0.005784003251170663i, 0.07279787280351044 + -1.5422280789922475e-19i, 0.0003204552752512582 + -0.0003604862576596172i, 0.0005999056765818568 + -0.0030091583922359534i, -0.0006399558436524708 + -0.0004267026580034387i, -0.004884835591728041 + -0.0002844982059809064i }, { -0.012519680437866762 + 0.0007291599803397521i, -0.0014457832896634356 + 0.0009640033429108943i, 0.0006805704245880195 + 0.0034137770062877284i, 0.0003204552752512582 + 0.00036048625765961725i, 0.18184269896176233 + 4.643850524677647e-19i, 0.0217410776085783 + -0.012735488477740267i, -0.006973521792544942 + -0.04998971344325755i, -0.004334819613652618 + -0.005488364607765131i }, { -0.0015479178112149325 + -0.0007896468929445476i, -0.011035782767394902 + 0.000642736145354726i, -0.00015771754089567028 + 0.00045581476796130487i, 0.0005999056765818568 + 0.0030091583922359543i, 0.0217410776085783 + 0.012735488477740267i, 0.1602897560794876 + 2.7286346483540615e-19i, 0.0026673138038239546 + -0.00646515616382207i, -0.006146983703629839 + -0.044064672489205425i }, { 0.00027966900066953373 + -0.003469702408211291i, -0.00020956601397951091 + -0.0004344237691270301i, -0.0055416622353820985 + 0.00032275251326536797i, -0.0006399558436524708 + 0.0004267026580034388i, -0.006973521792544942 + 0.04998971344325755i, 0.0026673138038239546 + 0.006465156163822072i, 0.08049013891508389 + 2.4605118373525534e-19i, 0.009623385304273684 + -0.00563718665955523i }, { 0.0002764403562872923 + -0.0003952501167786679i, 0.0002465211754789232 + -0.0030584552245209837i, -0.0006851642676070354 + -0.00034952620297577135i, -0.004884835591728042 + 0.0002844982059809064i, -0.004334819613652618 + 0.0054883646077651315i, -0.006146983703629839 + 0.04406467248920544i, 0.009623385304273684 + 0.0056371866595552305i, 0.07095002882802477 + 2.2745716323446804e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.18657866512432747, 1.0e-7), DoubleNear(0.16446439088931242, 1.0e-7), DoubleNear(0.08258644839849165, 1.0e-7), DoubleNear(0.07279787280351044, 1.0e-7), DoubleNear(0.18184269896176233, 1.0e-7), DoubleNear(0.1602897560794876, 1.0e-7), DoubleNear(0.08049013891508389, 1.0e-7), DoubleNear(0.07095002882802477, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false, false}), Matrix({ { 0.17788544946672719 + 1.1603468328356414e-19i, 0.021267949631049995 + -0.012458339570276231i, -0.006821764445399716 + -0.04890184041118228i, -0.004240485539064325 + -0.005368927158823536i, -0.017855169394009173 + -0.018509180115205946i, -0.0034310647453065233 + -0.0009624539135725446i, -0.0044035597894335225 + 0.005618311750848464i, -0.00013300611301359647 + 0.0009801308371541096i }, { 0.021267949631049995 + 0.012458339570276231i, 0.15680154038577837 + 3.83302207383141e-20i, 0.0026092678868663414 + -0.006324461837843175i, -0.006013213426923302 + -0.0431057398295364i, -0.0008384563927524052 + -0.0034634540129311734i, -0.01573888180974195 + -0.0163153757771794i, -0.0009199713854805348 + 0.0003633176763335731i, -0.003881626969681985 + 0.004952400207782813i }, { -0.006821764445399715 + 0.04890184041118228i, 0.002609267886866342 + 0.006324461837843176i, 0.07873851752255273 + 4.0406930079611276e-20i, 0.009413961792341134 + -0.005514510554386802i, 0.005773022666850305 + -0.0041986872992484615i, 0.00039616328027560415 + -0.0009063121644337974i, -0.007903342136262275 + -0.008192830876264708i, -0.0015187130390890264 + -0.0004260168246793903i }, { -0.004240485539064325 + 0.005368927158823537i, -0.006013213426923302 + 0.0431057398295364i, 0.009413961792341134 + 0.005514510554386802i, 0.06940601871733305 + -9.330596023186943e-20i, 0.0009842796470752114 + -9.76763041525373e-05i, 0.005088773980996461 + -0.0037010370330683297i, -0.00037113104849522956 + -0.0015330496974500754i, -0.006966596901977366 + -0.007221773930187368i }, { -0.01785516939400917 + 0.018509180115205946i, -0.0008384563927524053 + 0.0034634540129311734i, 0.005773022666850305 + 0.004198687299248461i, 0.0009842796470752114 + 9.767630415253732e-05i, 0.19053591461936265 + 2.015240359145527e-19i, 0.02278043677646955 + -0.01334432429283758i, -0.007306899647040581 + -0.05237953366757824i, -0.004542051039238762 + -0.005750742681865735i }, { -0.0034310647453065233 + 0.0009624539135725447i, -0.01573888180974195 + 0.0163153757771794i, 0.0003961632802756042 + 0.0009063121644337974i, 0.005088773980996461 + 0.0037010370330683297i, 0.02278043677646955 + 0.01334432429283758i, 0.16795260658302164 + -3.9392987105620684e-20i, 0.0027948280469336636 + -0.006774230969206407i, -0.006440847880110444 + -0.04617123878533559i }, { -0.0044035597894335225 + -0.005618311750848465i, -0.0009199713854805348 + -0.00036331767633357307i, -0.007903342136262275 + 0.008192830876264708i, -0.0003711310484952295 + 0.0015330496974500754i, -0.007306899647040582 + 0.05237953366757824i, 0.002794828046933663 + 0.006774230969206409i, 0.0843380697910228 + 1.1025153644816328e-19i, 0.010083443169031973 + -0.00590667935633909i }, { -0.00013300611301359647 + -0.0009801308371541098i, -0.003881626969681985 + -0.004952400207782813i, -0.0015187130390890264 + 0.0004260168246793904i, -0.006966596901977366 + 0.007221773930187367i, -0.004542051039238761 + 0.005750742681865735i, -0.006440847880110444 + 0.04617123878533559i, 0.010083443169031973 + 0.005906679356339091i, 0.07434188291420216 + -5.864227603501065e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.17788544946672719, 1.0e-7), DoubleNear(0.15680154038577837, 1.0e-7), DoubleNear(0.07873851752255273, 1.0e-7), DoubleNear(0.06940601871733305, 1.0e-7), DoubleNear(0.19053591461936265, 1.0e-7), DoubleNear(0.16795260658302164, 1.0e-7), DoubleNear(0.0843380697910228, 1.0e-7), DoubleNear(0.07434188291420216, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true, false}), Matrix({ { 0.2067175538762448 + 2.4202616999380166e-19i, 0.049044953179904247 + -0.0041045459468095746i, -0.00792745254600903 + -0.056827969123674306i, -0.003009200416812821 + -0.013325363231670625i, 0.01344245978864544 + -0.004170231571151955i, -0.023673273763885602 + 0.042042429186150115i, -0.0016619307194675342 + -0.0035354925753752695i, 0.012465582016268278 + 0.00489563991659891i }, { 0.049044953179904247 + 0.004104545946809574i, 0.18740812140105206 + 8.891375975615097e-20i, -0.0007524688915197335 + -0.013640175327751507i, -0.0071869512834549214 + -0.05151968343665977i, 0.008256591187575402 + -0.024635465340135866i, -0.01849732428082195 + -0.0006589729695214501i, -0.007089079621197531 + -0.0013250390279169978i, 0.0005282017073616464 + 0.005110303069271763i }, { -0.00792745254600903 + 0.056827969123674306i, -0.0007524688915197332 + 0.01364017532775151i, 0.09150064711250272 + 1.349132069343164e-19i, 0.021709065676397504 + -0.0018168201161132018i, 0.0006309155968725944 + 0.0038553426535739236i, -0.01064987985790939 + -0.008120226857015975i, 0.005950117667226328 + -0.0018458949431930283i, -0.010478645030618697 + 0.018609495926104704i }, { -0.003009200416812821 + 0.013325363231670627i, -0.007186951283454922 + 0.05151968343665977i, 0.021709065676397504 + 0.0018168201161132022i, 0.08295359567093501 + -4.336222658391586e-20i, 0.00645581230931278 + 0.003214539738144007i, 0.0008905134207415363 + -0.0050597608985946535i, 0.003654665133367534 + -0.010904545735334881i, -0.008187583056242401 + -0.00029168521013439347i }, { 0.01344245978864544 + 0.004170231571151954i, 0.008256591187575404 + 0.024635465340135866i, 0.0006309155968725944 + -0.0038553426535739245i, 0.00645581230931278 + -0.0032145397381440066i, 0.16170381020984503 + 7.553254920431519e-20i, -0.004996566772384707 + -0.021698117916304237i, -0.006201211546431268 + -0.04445340495508622i, -0.005773336161490265 + 0.002205693390981355i }, { -0.023673273763885602 + -0.042042429186150115i, -0.01849732428082195 + 0.0006589729695214502i, -0.01064987985790939 + 0.008120226857015975i, 0.0008905134207415364 + 0.005059760898594652i, -0.004996566772384707 + 0.021698117916304237i, 0.13734602556774794 + -8.997652612345755e-20i, 0.0061565648253197386 + 0.0005414825207019245i, -0.005267110023578825 + -0.03775729517821222i }, { -0.0016619307194675342 + 0.0035354925753752695i, -0.0070890796211975325 + 0.0013250390279169978i, 0.005950117667226328 + 0.0018458949431930283i, 0.003654665133367535 + 0.010904545735334881i, -0.006201211546431268 + 0.04445340495508622i, 0.0061565648253197386 + -0.0005414825207019246i, 0.07157594020107282 + 1.5745259593458165e-20i, -0.002211660715024397 + -0.00960436979461269i }, { 0.012465582016268278 + -0.00489563991659891i, 0.0005282017073616466 + -0.005110303069271763i, -0.010478645030618697 + -0.018609495926104704i, -0.008187583056242401 + 0.00029168521013439347i, -0.005773336161490265 + -0.002205693390981355i, -0.005267110023578825 + 0.03775729517821222i, -0.002211660715024397 + 0.009604369794612691i, 0.06079430596060021 + -1.0858600968296422e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2067175538762448, 1.0e-7), DoubleNear(0.18740812140105206, 1.0e-7), DoubleNear(0.09150064711250272, 1.0e-7), DoubleNear(0.08295359567093501, 1.0e-7), DoubleNear(0.16170381020984503, 1.0e-7), DoubleNear(0.13734602556774794, 1.0e-7), DoubleNear(0.07157594020107282, 1.0e-7), DoubleNear(0.06079430596060021, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false, true}), Matrix({ { 0.15584856720142998 + 5.714603082637727e-20i, 0.018633224287022437 + -0.010914970153866362i, -0.005976667668931877 + -0.04284376144559974i, -0.003715163873620662 + -0.004703811400088693i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.018633224287022437 + 0.01091497015386636i, 0.1373765840734018 + 2.784912845843381e-20i, 0.002286025432838366 + -0.005540972118308898i, -0.0052682819177837705 + -0.037765695905597i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005976667668931877 + 0.04284376144559974i, 0.002286025432838366 + 0.005540972118308898i, 0.06898419840544537 + -2.603727902478524e-20i, 0.008247737301862889 + -0.004831359570413315i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003715163873620662 + 0.0047038114000886935i, -0.0052682819177837705 + 0.037765695905597i, 0.008247737301862889 + 0.004831359570413316i, 0.06080783225766443 + -1.0570501205543339e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2125727968846598 + 2.6041268837173954e-19i, 0.025415162120497103 + -0.014887693709247451i, -0.008151996423508421 + -0.05843761263316079i, -0.005067372704682424 + -0.006415858440600578i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.025415162120497103 + 0.014887693709247451i, 0.18737756289539817 + -2.8911894825740394e-20i, 0.003118070500961639 + -0.007557720688740685i, -0.007185779389249976 + -0.051511282709274984i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008151996423508421 + 0.05843761263316079i, 0.0031180705009616395 + 0.007557720688740686i, 0.09409238890813018 + 1.766957455525598e-19i, 0.011249667659510219 + -0.006589830340312576i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.005067372704682424 + 0.006415858440600579i, -0.007185779389249977 + 0.051511282709274984i, 0.011249667659510219 + 0.006589830340312577i, 0.08294006937387079 + -4.624322421144668e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.15584856720142998, 1.0e-7), DoubleNear(0.1373765840734018, 1.0e-7), DoubleNear(0.06898419840544537, 1.0e-7), DoubleNear(0.06080783225766443, 1.0e-7), DoubleNear(0.2125727968846598, 1.0e-7), DoubleNear(0.18737756289539817, 1.0e-7), DoubleNear(0.09409238890813018, 1.0e-7), DoubleNear(0.08294006937387079, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false, false}), Matrix({ { 0.13085172456016766 + 1.1768170255512107e-19i, 0.015644606657961725 + -0.009164297714140724i, -0.0007130283138481947 + -6.663461520036603e-05i, -8.991633085048137e-05 + 4.197064593961072e-05i, -0.008884340081648914 + -0.0037365374574705804i, -0.001323901142728949 + 0.00017548166670495837i, -0.001999160376915255 + -0.0014946481473855655i, -0.00034369801769691124 + -3.8687159092087354e-05i }, { 0.015644606657961725 + 0.009164297714140724i, 0.11534249729069407 + -5.1927002084992355e-20i, -8.058272131929663e-05 + -5.790428912419143e-05i, -0.0006285164879153531 + -5.873673387988558e-05i, -0.0008005187907515628 + -0.0010689610454652791i, -0.007831321866346533 + -0.0032936635952910604i, -0.00013434043151955936 + -0.00031871252266978985i, -0.0017622094866008636 + -0.0013174946716968177i }, { -0.0007130283138481947 + 6.6634615200366e-05i, -8.058272131929652e-05 + 5.790428912419145e-05i, 0.13049826737866452 + 1.512476096615677e-19i, 0.015602347386304161 + -0.009139543077918817i, -0.0017306622335333702 + -0.0017834169379175972i, -0.00033182056877647257 + -9.20167662338403e-05i, -0.006883680853907267 + -0.0033453840045282062i, -0.0010573079932188918 + 8.213024230119669e-05i }, { -8.991633085048142e-05 + -4.1970645939610806e-05i, -0.0006285164879153518 + 5.8736733879885574e-05i, 0.015602347386304161 + 0.009139543077918817i, 0.11503093369352377 + -2.063763639011494e-19i, -8.201470916775234e-05 + -0.00033443319603682287i, -0.0015255351402773559 + -0.0015720370825938377i, -0.000588715086420423 + -0.0008820771600296695i, -0.006067791180518349 + -0.002948871684921502i }, { -0.008884340081648916 + 0.0037365374574705804i, -0.0008005187907515628 + 0.0010689610454652791i, -0.0017306622335333702 + 0.0017834169379175974i, -8.201470916775229e-05 + 0.00033443319603682276i, 0.13551387225059222 + 4.443659703228506e-20i, 0.016202012126198248 + -0.009490814690252097i, 0.0012997706363284491 + -5.5764192833174535e-05i, 0.00015149483701989825 + -9.769755787977833e-05i }, { -0.001323901142728949 + -0.0001754816667049583i, -0.007831321866346533 + 0.0032936635952910604i, -0.00033182056877647246 + 9.20167662338403e-05i, -0.0015255351402773559 + 0.0015720370825938379i, 0.016202012126198248 + 0.009490814690252097i, 0.11945206297780389 + -1.084367003030031e-21i, 0.00015930581034302022 + 8.43632458497891e-05i, 0.0011457150572769324 + -4.915473053487077e-05i }, { -0.001999160376915255 + 0.001494648147385565i, -0.00013434043151955944 + 0.00031871252266978996i, -0.006883680853907267 + 0.003345384004528206i, -0.0005887150864204231 + 0.0008820771600296695i, 0.0012997706363284515 + 5.576419283317456e-05i, 0.00015930581034302025 + -8.436324584978905e-05i, 0.13463408721024095 + 1.5485127647691754e-19i, 0.01609682519842852 + -0.009429198291528065i }, { -0.0003436980176969113 + 3.868715909208727e-05i, -0.0017622094866008636 + 0.0013174946716968173i, -0.0010573079932188916 + -8.213024230119666e-05i, -0.006067791180518349 + 0.0029488716849215015i, 0.00015149483701989833 + 9.769755787977831e-05i, 0.0011457150572769341 + 4.9154730534870794e-05i, 0.01609682519842852 + 0.009429198291528065i, 0.11867655463831348 + 1.0637673035498517e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.13085172456016766, 1.0e-7), DoubleNear(0.11534249729069407, 1.0e-7), DoubleNear(0.13049826737866452, 1.0e-7), DoubleNear(0.11503093369352377, 1.0e-7), DoubleNear(0.13551387225059222, 1.0e-7), DoubleNear(0.11945206297780389, 1.0e-7), DoubleNear(0.13463408721024095, 1.0e-7), DoubleNear(0.11867655463831348, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false, false}), Matrix({ { 0.1345873595678188 + -1.8524316022143053e-19i, 0.01609123845061755 + -0.009425925686386057i, 0.005120737864168001 + -6.22092770497203e-05i, 0.0006078775470123793 + -0.00036607240855432487i, -0.009939459189733147 + -0.0005258039233504487i, -0.0012251848697291587 + 0.000633252391978482i, -0.006373857085730297 + 0.002812599932700996i, -0.0005650745843419846 + 0.0007826717140991365i }, { 0.016091238450617548 + 0.009425925686386057i, 0.1186353653992141 + -2.071740966804803e-19i, 0.000616591292855339 + 0.00035119695050147334i, 0.004513801367230489 + -5.483590983368395e-05i, -0.001151534733148329 + -0.0007589824209510598i, -0.008761382767527897 + -0.00046348290638384936i, -0.000959039634794065 + -0.00011012391572321379i, -0.005618394378165588 + 0.0024792359535789022i }, { 0.005120737864168001 + 6.220927704972046e-05i, 0.0006165912928553388 + -0.00035119695050147334i, 0.13457775395500032 + -5.697589025569815e-20i, 0.016090090005423118 + -0.00942525295015815i, -0.0068220214089203 + 0.0023454918183259347i, -0.0006513712870963371 + 0.0007582118803114758i, -0.008121883483515708 + -0.0005261085702546716i, -0.0010078972090928088 + 0.0005059207039418368i }, { 0.0006078775470123802 + 0.000366072408554325i, 0.00451380136723049 + 5.483590983368406e-05i, 0.016090090005423118 + 0.00942525295015815i, 0.11862689829360876 + -2.2097494242145717e-19i, -0.0009799078101184163 + -0.00019735879197019007i, -0.006013439933790341 + 0.002067491923472573i, -0.0009342044001675774 + -0.0006317235799632732i, -0.007159235591595043 + -0.00046375144495178276i }, { -0.009939459189733149 + 0.0005258039233504487i, -0.001151534733148329 + 0.0007589824209510598i, -0.0068220214089203006 + -0.0023454918183259356i, -0.0009799078101184158 + 0.00019735879197019007i, 0.13177823724294108 + 3.473614598088367e-19i, 0.015755380333542422 + -0.009229186718006765i, -0.004533995541687749 + -6.018953098382027e-05i, -0.0005462990408429623 + 0.0003103454966141573i }, { -0.001225184869729159 + -0.0006332523919784821i, -0.008761382767527899 + 0.00046348290638384914i, -0.0006513712870963372 + -0.0007582118803114755i, -0.0060134399337903426 + -0.0020674919234725713i, 0.015755380333542422 + 0.009229186718006765i, 0.11615919486928386 + 1.541627275924579e-19i, -0.0005378682038316154 + -0.00032473799377587547i, -0.003996602797868912 + -5.30555545810724e-05i }, { -0.006373857085730296 + -0.002812599932700997i, -0.0009590396347940653 + 0.00011012391572321379i, -0.008121883483515712 + 0.0005261085702546718i, -0.0009342044001675776 + 0.0006317235799632733i, -0.004533995541687749 + 6.018953098382013e-05i, -0.0005378682038316156 + 0.00032473799377587547i, 0.13055460063390512 + 3.630747763941834e-19i, 0.015609082579309558 + -0.00914348841928873i }, { -0.0005650745843419845 + -0.0007826717140991368i, -0.005618394378165588 + -0.002479235953578903i, -0.001007897209092809 + -0.0005059207039418369i, -0.007159235591595046 + 0.00046375144495178254i, -0.0005462990408429628 + -0.0003103454966141575i, -0.00399660279786891 + 5.305555458107231e-05i, 0.015609082579309558 + 0.00914348841928873i, 0.1150805900382285 + 1.2097530887529292e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1345873595678188, 1.0e-7), DoubleNear(0.1186353653992141, 1.0e-7), DoubleNear(0.13457775395500032, 1.0e-7), DoubleNear(0.11862689829360876, 1.0e-7), DoubleNear(0.13177823724294108, 1.0e-7), DoubleNear(0.11615919486928386, 1.0e-7), DoubleNear(0.13055460063390512, 1.0e-7), DoubleNear(0.1150805900382285, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false, false}), Matrix({ { 0.1288776123122614 + 7.870139565175011e-20i, 0.01540858218277067 + -0.009026039296670453i, -0.0003463711259294607 + -0.00013473173136813326i, -5.084810110837726e-05 + 8.149859542040021e-06i, -0.012813544975653129 + -0.013262546698993512i, -0.0024608372454992212 + -0.0006882613565920088i, 0.0009733644435153557 + -0.0005467859842595722i, 7.808070044404669e-05 + -0.00013354392732153913i }, { 0.015408582182770669 + 0.009026039296670453i, 0.11360236709851648 + -6.235776473725111e-20i, -3.197602736308305e-05 + -4.0366858571829855e-05i, -0.0003053174177748267 + -0.00011876262550253022i, -0.0006031326289829295 + -0.0024830736347660346i, -0.011294816951066433 + -0.011690600653818413i, 0.0001546698254634894 + 2.796676131982574e-06i, 0.0008579962248598738 + -0.0004819780642558492i }, { -0.0003463711259294594 + 0.00013473173136813318i, -3.197602736308308e-05 + 4.036685857182983e-05i, 0.1277463546770185 + 7.774021771142532e-20i, 0.01527332924062046 + -0.008946810827992578i, 0.0009040769016760031 + -0.0005388829639240154i, 7.035018935924508e-05 + -0.00012774643929907407i, -0.012944966554618319 + -0.013439464292477141i, -0.002488940538896329 + -0.000700209381659926i }, { -5.084810110837758e-05 + -8.149859542040333e-06i, -0.0003053174177748267 + 0.00011876262550253018i, 0.01527332924062046 + 0.008946810827992578i, 0.11260519200459493 + 7.382025243695797e-21i, 0.00014583232658101994 + -1.1110447517573909e-06i, 0.0007969210030105074 + -0.0004750117510130835i, -0.0006064548122647053 + -0.0025134300756152147i, -0.01141066176065288 + -0.011846549053548355i }, { -0.012813544975653129 + 0.013262546698993512i, -0.0006031326289829291 + 0.0024830736347660346i, 0.0009040769016760031 + 0.0005388829639240156i, 0.0001458323265810199 + 1.111044751757418e-06i, 0.1374879844984985 + 8.341690393565604e-20i, 0.016438036601389303 + -0.009629073107722368i, 0.0009331134484097149 + 1.2332923334592713e-05i, 0.00011242660727779403 + -6.387677148220773e-05i }, { -0.0024608372454992212 + 0.0006882613565920088i, -0.011294816951066433 + 0.011690600653818412i, 7.035018935924506e-05 + 0.0001277464392990741i, 0.0007969210030105077 + 0.0004750117510130835i, 0.016438036601389303 + 0.009629073107722368i, 0.12119219316998149 + 9.34639564922872e-21i, 0.00011069911638680679 + 6.682581529742739e-05i, 0.0008225159871364067 + 1.0871161087773855e-05i }, { 0.0009733644435153557 + 0.0005467859842595722i, 0.00015466982546348944 + -2.7966761319825842e-06i, -0.012944966554618317 + 0.013439464292477141i, -0.0006064548122647055 + 0.0025134300756152143i, 0.0009331134484097162 + -1.2332923334592622e-05i, 0.00011069911638680658 + -6.682581529742735e-05i, 0.13738599991188696 + 2.2835866842705996e-19i, 0.016425843344112217 + -0.009621930541454302i }, { 7.808070044404674e-05 + 0.00013354392732153916i, 0.0008579962248598738 + 0.0004819780642558493i, -0.002488940538896329 + 0.000700209381659926i, -0.01141066176065288 + 0.011846549053548355i, 0.00011242660727779443 + 6.38767714822079e-05i, 0.0008225159871364102 + -1.0871161087773828e-05i, 0.016425843344112217 + 0.009621930541454302i, 0.12110229632724233 + -1.0738165878986003e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1288776123122614, 1.0e-7), DoubleNear(0.11360236709851648, 1.0e-7), DoubleNear(0.1277463546770185, 1.0e-7), DoubleNear(0.11260519200459493, 1.0e-7), DoubleNear(0.1374879844984985, 1.0e-7), DoubleNear(0.12119219316998149, 1.0e-7), DoubleNear(0.13738599991188696, 1.0e-7), DoubleNear(0.12110229632724233, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true, false}), Matrix({ { 0.1494550804514143 + 1.3489368438156635e-19i, 0.03545909520401294 + -0.0029675527462181637i, 0.00032921526676298616 + -6.86767507547396e-05i, 7.67446216737226e-05 + -2.283080041165469e-05i, 0.009718787163956364 + -0.003015042908937818i, -0.017115580987611824 + 0.03039632831641699i, 2.0022803837674964e-05 + -1.1107370015466658e-05i, -2.3734151333499904e-05 + 7.482099498416512e-05i }, { 0.03545909520401294 + 0.0029675527462181637i, 0.13549452059601483 + 4.530995007109637e-20i, 7.947188768151652e-05 + -9.757124146804607e-06i, 0.00029846335506433785 + -6.226167348409725e-05i, 0.005969447088815062 + -0.017811237533181472i, -0.013373412352688605 + -0.0004764320026450033i, 4.964804092512831e-06 + -4.197711798607529e-05i, -2.96774877355937e-05 + 5.095804142224154e-06i }, { 0.0003292152667629879 + 6.867675075473962e-05i, 7.947188768151641e-05 + 9.757124146804837e-06i, 0.1487631205373332 + 2.4204569254655167e-19i, 0.03529492365228881 + -0.0029538133167046118i, 2.2793714665818966e-05 + -2.1755261238917798e-06i, -5.166924805072976e-05 + 5.909128561652809e-05i, 0.009673790291915403 + -0.0030010836054071644i, -0.017036337806892475 + 0.030255596795837825i }, { 7.674462167372282e-05 + 2.283080041165454e-05i, 0.0002984633550643413 + 6.226167348409725e-05i, 0.03529492365228881 + 0.0029538133167046118i, 0.13486719647597223 + 2.4158310113875204e-22i, 2.1333841759284028e-05 + -3.6491025059372587e-05i, -2.923963307319735e-05 + -7.1947450195962365e-06i, 0.005941809232127875 + -0.017728773542289272i, -0.013311494984375748 + -0.0004742261770108402i }, { 0.009718787163956364 + 0.003015042908937818i, 0.005969447088815062 + 0.017811237533181472i, 2.2793714665818884e-05 + 2.175526123891766e-06i, 2.1333841759284e-05 + 3.6491025059372424e-05i, 0.11691051635934559 + 2.72246152058398e-20i, -0.0036124764198529682 + -0.015687559658174657i, 0.00025752705571726806 + -5.3722057278800956e-05i, -1.5166115504305824e-05 + -3.289611152851302e-05i }, { -0.017115580987611824 + -0.03039632831641699i, -0.013373412352688605 + 0.0004764320026450033i, -5.1669248050729706e-05 + -5.909128561652809e-05i, -2.9239633073197403e-05 + 7.1947450195960095e-06i, -0.0036124764198529682 + 0.015687559658174657i, 0.09930003967248315 + -9.832131915911876e-20i, -7.487986577927864e-07 + 3.621608087240214e-05i, 0.00021873521429724213 + -4.5629790930659115e-05i }, { 2.002280383767526e-05 + 1.110737001546659e-05i, 4.964804092512696e-06 + 4.1977117986075616e-05i, 0.009673790291915403 + 0.0030010836054071644i, 0.005941809232127875 + 0.017728773542289272i, 0.0002575270557172689 + 5.372205727880096e-05i, -7.487986577929084e-07 + -3.6216080872402356e-05i, 0.11636923405157225 + 6.405319359193358e-20i, -0.0035957510675561355 + -0.015614928052742269i }, { -2.3734151333500012e-05 + -7.482099498416534e-05i, -2.96774877355937e-05 + -5.095804142223971e-06i, -0.017036337806892475 + -0.030255596795837825i, -0.013311494984375748 + 0.00047422617701084035i, -1.5166115504305973e-05 + 3.289611152851302e-05i, 0.00021873521429724213 + 4.562979093065912e-05i, -0.0035957510675561346 + 0.015614928052742269i, 0.09884029185586503 + -1.0024121664730299e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1494550804514143, 1.0e-7), DoubleNear(0.13549452059601483, 1.0e-7), DoubleNear(0.1487631205373332, 1.0e-7), DoubleNear(0.13486719647597223, 1.0e-7), DoubleNear(0.11691051635934559, 1.0e-7), DoubleNear(0.09930003967248315, 1.0e-7), DoubleNear(0.11636923405157225, 1.0e-7), DoubleNear(0.09884029185586503, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false, true}), Matrix({ { 0.1126229420474703 + -1.3723942572960404e-21i, 0.013465176977357473 + -0.007887631392208782i, 0.0002482020837793206 + -4.100184831473331e-05i, 2.6803397810893514e-05 + -2.228519026370473e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013465176977357472 + 0.007887631392208782i, 0.09927428493315145 + 8.718394740738804e-21i, 3.254658760910673e-05 + 1.24808442944091e-05i, 0.00021878388131367065 + -3.614209590322206e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00024820208377932104 + 4.1001848314733234e-05i, 3.254658760910636e-05 + -1.248084429440906e-05i, 0.11220982355940508 + 3.2481146058888085e-20i, 0.013415784611527856 + -0.007858698332070896i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 2.680339781089346e-05 + 2.2285190263704525e-05i, 0.00021878388131367195 + 3.614209590322202e-05i, 0.013415784611527856 + 0.007858698332070896i, 0.09891013139791481 + -8.657427833773836e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15374265476328963 + 1.634906938447022e-19i, 0.0183814418068025 + -0.01076748101218404i, 0.0003385402387009336 + -8.139695971880725e-05i, 3.477510835852326e-05 + -3.344172167646298e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0183814418068025 + 0.01076748101218404i, 0.13552027533534652 + -6.17297638287612e-20i, 4.617650141461701e-05 + 1.3978112431188431e-05i, 0.00029841468804790933 + -7.174936851153431e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0003385402387009358 + 8.139695971880735e-05i, 4.617650141461714e-05 + -1.3978112431188458e-05i, 0.15292253102950037 + 2.736177400795972e-19i, 0.01828338797320482 + -0.010710043037375985i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 3.4775108358523385e-05 + 3.3441721676463035e-05i, 0.0002984146880479115 + 7.174936851153435e-05i, 0.01828338797320482 + 0.010710043037375985i, 0.13479735693392242 + -1.342535520842587e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1126229420474703, 1.0e-7), DoubleNear(0.09927428493315145, 1.0e-7), DoubleNear(0.11220982355940508, 1.0e-7), DoubleNear(0.09891013139791481, 1.0e-7), DoubleNear(0.15374265476328963, 1.0e-7), DoubleNear(0.13552027533534652, 1.0e-7), DoubleNear(0.15292253102950037, 1.0e-7), DoubleNear(0.13479735693392242, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false, false}), Matrix({ { 0.13230552264379744 + -8.452190030390822e-20i, 0.015818422473190267 + -0.009266115542674608i, -0.00801380543372574 + -0.0037337560275029057i, -0.0012196253905595075 + 0.00011484567330921676i, -0.008831603231359522 + -0.000549926091082087i, -0.0010944192414323488 + 0.0005527788354532292i, 0.0006277830514059125 + 0.000353783762361039i, 9.983512769431627e-05 + -1.668934663240296e-06i }, { 0.015818422473190267 + 0.00926611554267461i, 0.1166239836607509 + -3.299180877699511e-19i, -0.0006966326376092717 + -0.0010076599576210356i, -0.007063967514640116 + -0.0032912118348760624i, -0.0010173902769859142 + -0.0006842769477608544i, -0.007784835661964663 + -0.0004847459892785104i, 5.028011058463242e-05 + 8.626556986566391e-05i, 0.0005533749375434089 + 0.0003118514699655817i }, { -0.00801380543372574 + 0.0037337560275029057i, -0.0006966326376092718 + 0.0010076599576210356i, 0.13685959087902166 + -1.5769715017322048e-19i, 0.0163629059828504 + -0.009585063093869597i, 0.000626797155788727 + -0.00028903993772456883i, 5.4696618941144925e-05 + -7.84557628924995e-05i, -0.009229739441889335 + -0.0005019864025230334i, -0.0011386628373896187 + 0.0005863942604670894i }, { -0.0012196253905595073 + -0.0001148456733092167i, -0.007063967514640116 + 0.003291211834876063i, 0.016362905982850395 + 0.009585063093869596i, 0.12063828003207197 + -9.823095133198635e-20i, 9.518287236253811e-05 + 9.340645772841138e-06i, 0.0005525058954047869 + -0.0002547814203134086i, -0.001068348856329992 + -0.0007064290531534785i, -0.008135782697158277 + -0.0004424883620571217i }, { -0.008831603231359522 + 0.0005499260910820868i, -0.0010173902769859142 + 0.0006842769477608545i, 0.0006267971557887269 + 0.00028903993772456894i, 9.518287236253811e-05 + -9.340645772841148e-06i, 0.12904446929503474 + 3.53451212520597e-19i, 0.01542853157107562 + -0.009037725249384933i, -0.007754215501830443 + -0.003348165434495881i, -0.0011615837453883334 + 0.00014276623569693824i }, { -0.001094419241432349 + -0.0005527788354532295i, -0.007784835661964664 + 0.0004847459892785102i, 5.469661894114493e-05 + 7.845576289249953e-05i, 0.000552505895404787 + 0.0002547814203134089i, 0.01542853157107562 + 0.009037725249384933i, 0.11374944732346697 + 7.161472178380932e-20i, -0.0006926012395627141 + -0.000943378247873913i, -0.006835145532224767 + -0.002951323445336499i }, { 0.0006277830514059125 + -0.0003537837623610393i, 5.028011058463238e-05 + -8.626556986566394e-05i, -0.009229739441889337 + 0.000501986402523033i, -0.0010683488563299924 + 0.0007064290531534785i, -0.007754215501830442 + 0.00334816543449588i, -0.0006926012395627142 + 0.0009433782478739129i, 0.13328836858181148 + 3.569850236824231e-19i, 0.015935931341776365 + -0.009334949887910563i }, { 9.98351276943163e-05 + 1.6689346632402654e-06i, 0.0005533749375434089 + -0.000311851469965582i, -0.001138662837389619 + -0.0005863942604670896i, -0.00813578269715828 + 0.0004424883620571215i, -0.0011615837453883334 + -0.0001427662356969383i, -0.006835145532224766 + 0.002951323445336499i, 0.015935931341776365 + 0.009334949887910563i, 0.11749033758404538 + 2.0352331468394148e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13230552264379744, 1.0e-7), DoubleNear(0.1166239836607509, 1.0e-7), DoubleNear(0.13685959087902166, 1.0e-7), DoubleNear(0.12063828003207197, 1.0e-7), DoubleNear(0.12904446929503474, 1.0e-7), DoubleNear(0.11374944732346697, 1.0e-7), DoubleNear(0.13328836858181148, 1.0e-7), DoubleNear(0.11749033758404538, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false, false}), Matrix({ { 0.10933446502949372 + 8.073007049993586e-20i, 0.013072007306702237 + -0.007657320461877941i, -0.0020522981271404043 + -0.0031185183945452i, -0.0004637801155667227 + -0.00022911522720668858i, -0.018911481580217635 + -0.010284408961829906i, -0.0029813292678660857 + 9.487772928394947e-05i, 0.00416185003282213 + 0.030531167550636975i, 0.0026358629730453683 + 0.0033588221773382834i }, { 0.013072007306702237 + 0.007657320461877941i, 0.09637557532262536 + -4.094084065269295e-20i, -2.6964611748195687e-05 + -0.000516583674390049i, -0.001809049074172059 + -0.002748895367507478i, -0.0015407768279653215 + -0.0025540815870590612i, -0.016669994379220187 + -0.009065447297722153i, -0.0016406830172322755 + 0.0039417786935109205i, 0.003668565911138088 + 0.02691245470648583i }, { -0.0020522981271404043 + 0.0031185183945451997i, -2.6964611748195755e-05 + 0.0005165836743900489i, 0.14728950195978618 + 7.571154286323955e-20i, 0.017609904116688894 + -0.010315529662785095i, -0.023083876674890987 + 0.014806823785474323i, -0.00172289689040359 + 0.0033869974103315674i, -0.006847029950053814 + -0.01641760202964075i, -0.0019684485165294635 + -0.0014833484675358844i }, { -0.0004637801155667226 + 0.00022911522720668842i, -0.0018090490741720588 + 0.002748895367507477i, 0.01760990411668889 + 0.010315529662785095i, 0.12983198378048605 + -1.4034898840862368e-20i, -0.003796910692315884 + 0.00015360451533862507i, -0.020347855496608655 + 0.013051841984509404i, 0.00033118938671768686 + -0.002442422123322188i, -0.006035484332499126 + -0.014471702409644613i }, { -0.01891148158021763 + 0.010284408961829906i, -0.0015407768279653215 + 0.0025540815870590612i, -0.023083876674890983 + -0.014806823785474325i, -0.003796910692315884 + -0.00015360451533862486i, 0.15201552690933848 + 1.8819924171675292e-19i, 0.018174946737563646 + -0.010646520330181602i, -0.013715722808415778 + -0.003963403067453587i, -0.0019174290203811182 + 0.0004867271362128436i }, { -0.0029813292678660857 + -9.487772928394947e-05i, -0.016669994379220184 + 0.009065447297722153i, -0.00172289689040359 + -0.003386997410331567i, -0.020347855496608655 + -0.013051841984509404i, 0.018174946737563646 + 0.010646520330181604i, 0.1339978556615925 + -2.1736252533344883e-19i, -0.0013622692654237903 + -0.0014344545311048996i, -0.012090063972692824 + -0.003493639912705084i }, { 0.004161850032822132 + -0.030531167550636975i, -0.0016406830172322755 + -0.0039417786935109205i, -0.0068470299500538135 + 0.01641760202964075i, 0.00033118938671768675 + 0.002442422123322188i, -0.013715722808415777 + 0.003963403067453587i, -0.00136226926542379 + 0.0014344545311048996i, 0.12285845750104696 + 1.2357633064596303e-19i, 0.014688933207937873 + -0.008604483318995066i }, { 0.0026358629730453683 + -0.003358822177338284i, 0.003668565911138089 + -0.02691245470648583i, -0.0019684485165294635 + 0.0014833484675358844i, -0.006035484332499128 + 0.014471702409644611i, -0.0019174290203811182 + -0.0004867271362128436i, -0.012090063972692824 + 0.003493639912705084i, 0.014688933207937873 + 0.008604483318995066i, 0.10829663383563132 + 1.193272621928175e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10933446502949372, 1.0e-7), DoubleNear(0.09637557532262536, 1.0e-7), DoubleNear(0.14728950195978618, 1.0e-7), DoubleNear(0.12983198378048605, 1.0e-7), DoubleNear(0.15201552690933848, 1.0e-7), DoubleNear(0.1339978556615925, 1.0e-7), DoubleNear(0.12285845750104696, 1.0e-7), DoubleNear(0.10829663383563132, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true, false}), Matrix({ { 0.14664087456814096 + 1.9076759651810026e-19i, 0.03479140833758271 + -0.0029116743888407707i, -0.008847279324729743 + -0.0039735955188146535i, -0.0021779679431648625 + -0.0007670889032407071i, 0.009535784565901633 + -0.002958270322371831i, -0.016793298409023688 + 0.02982397222307042i, -0.000655483811143886 + -7.991432807447795e-05i, 0.0018213435031234034 + -0.0013443130239561446i }, { 0.03479140833758271 + 0.0029116743888407707i, 0.1329431889459906 + -7.134261153417446e-20i, -0.002020169971244437 + -0.0011184288239360891i, -0.008020857284092053 + -0.0036024230038756728i, 0.005857043729447873 + -0.017475855896753576i, -0.013121593976165689 + -0.00046746089413016666i, -0.0008269241773651958 + 0.0008956592507189229i, 0.0007789977174857249 + 0.0003837651970699664i }, { -0.008847279324729741 + 0.0039735955188146535i, -0.0020201699712444365 + 0.001118428823936089i, 0.15157732642060656 + 1.8617178041001774e-19i, 0.035962610518719046 + -0.003009691674082005i, -0.0004951605761517652 + 0.00043687679078701464i, 0.00020503559814324176 + -0.0022544245532379187i, 0.009856792889970134 + -0.0030578561919731516i, -0.01735862038548061 + 0.0308279528891844i }, { -0.002177967943164862 + 0.0007670889032407072i, -0.008020857284092051 + 0.0036024230038756728i, 0.035962610518719046 + 0.0030096916740820056i, 0.13741852812599642 + 1.1689414470640958e-19i, 0.00012017850302044813 + 0.001213081289906514i, 0.0008043317250686322 + -0.0003273585898952975i, 0.006054212591495064 + -0.01806415517871717i, -0.013563313360898664 + -0.0004831972855256768i }, { 0.009535784565901633 + 0.0029582703223718313i, 0.005857043729447875 + 0.017475855896753576i, -0.0004951605761517653 + -0.00043687679078701453i, 0.00012017850302044816 + -0.001213081289906514i, 0.11470911737069125 + 7.816171569858852e-20i, -0.003544454293316819 + -0.015392166403218773i, -0.006920741610826441 + -0.0031083259431841327i, -0.00020324119278297866 + 0.0010247008122468621i }, { -0.016793298409023688 + -0.02982397222307042i, -0.013121593976165689 + 0.000467460894130167i, 0.0002050355981432416 + 0.0022544245532379187i, 0.0008043317250686322 + 0.00032735858989529746i, -0.003544454293316819 + 0.015392166403218773i, 0.09743024203822725 + -1.869607544519673e-19i, 0.0006309360940724507 + -0.0008326093815588594i, -0.005878255762772831 + -0.002640112276336889i }, { -0.0006554838111438859 + 7.991432807447779e-05i, -0.0008269241773651956 + -0.0008956592507189229i, 0.009856792889970134 + 0.003057856191973151i, 0.006054212591495064 + 0.01806415517871717i, -0.006920741610826441 + 0.0031083259431841327i, 0.0006309360940724507 + 0.0008326093815588596i, 0.1185706330402266 + 1.3116093099184847e-20i, -0.0036637731940922843 + -0.015910321307698157i }, { 0.0018213435031234036 + 0.0013443130239561446i, 0.0007789977174857248 + -0.00038376519706996635i, -0.017358620385480607 + -0.0308279528891844i, -0.013563313360898664 + 0.0004831972855256767i, -0.00020324119278297866 + -0.0010247008122468624i, -0.00587825576277283 + 0.002640112276336889i, -0.003663773194092284 + 0.015910321307698157i, 0.10071008949012093 + -1.160178135445445e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.14664087456814096, 1.0e-7), DoubleNear(0.1329431889459906, 1.0e-7), DoubleNear(0.15157732642060656, 1.0e-7), DoubleNear(0.13741852812599642, 1.0e-7), DoubleNear(0.11470911737069125, 1.0e-7), DoubleNear(0.09743024203822725, 1.0e-7), DoubleNear(0.1185706330402266, 1.0e-7), DoubleNear(0.10071008949012093, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false, true}), Matrix({ { 0.11046569998972938 + 2.763962290028612e-20i, 0.013207257537833006 + -0.0077365473424948405i, -0.0064373456179700195 + -0.002082431679529462i, -0.0009154924354090384 + 0.00020186915611825537i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013207257537833006 + 0.007736547342494841i, 0.09737273042909952 + -9.694418347885907e-20i, -0.0006238031367817063 + -0.0006998194067217433i, -0.005674357919207672 + -0.0018356110411348685i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00643734561797002 + 0.0020824316795294614i, -0.0006238031367817062 + 0.0006998194067217433i, 0.11436706561714598 + 3.4691289013058995e-21i, 0.013673704051052324 + -0.008009782381784836i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0009154924354090384 + -0.00020186915611825545i, -0.005674357919207672 + 0.0018356110411348685i, 0.013673704051052324 + 0.008009782381784836i, 0.10081168590196676 + 1.9088299881859484e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1508842919491028 + 2.4128968931640264e-19i, 0.01803969650643288 + -0.010567293449564703i, -0.009330675317586162 + -0.004999489782469325i, -0.0014657167005388025 + 5.574275288789971e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01803969650643288 + 0.010567293449564703i, 0.13300070055511834 + -1.613591825072827e-19i, -0.0007654307403902796 + -0.0012512187987732055i, -0.008224755127657211 + -0.004406924239077693i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.009330675317586162 + 0.004999489782469325i, -0.0007654307403902796 + 0.0012512187987732053i, 0.15578089384368718 + 1.958187446078967e-19i, 0.018625133273574443 + -0.010910230599995324i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0014657167005388023 + -5.57427528878996e-05i, -0.00822475512765721 + 0.004406924239077693i, 0.018625133273574443 + 0.010910230599995324i, 0.1373169317141506 + 8.620406347009564e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11046569998972938, 1.0e-7), DoubleNear(0.09737273042909952, 1.0e-7), DoubleNear(0.11436706561714598, 1.0e-7), DoubleNear(0.10081168590196676, 1.0e-7), DoubleNear(0.1508842919491028, 1.0e-7), DoubleNear(0.13300070055511834, 1.0e-7), DoubleNear(0.15578089384368718, 1.0e-7), DoubleNear(0.1373169317141506, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false, false}), Matrix({ { 0.12994727522036315 + -1.5681741966819826e-19i, 0.015536470871361611 + -0.009100953932886121i, -0.008689413506923262 + -0.0004884485538647486i, -0.0010731134407425064 + 0.0005501707148517838i, -0.01305260111088824 + -0.01352152452890012i, -0.0025075564550480498 + -0.0007024822214265359i, 0.000788132436964964 + 0.0009611835458761879i, 0.0001615461639049368 + 5.9721476633855044e-05i }, { 0.015536470871361611 + 0.009100953932886121i, 0.11454524799285999 + -1.9590578695195338e-19i, -0.0010046957262537716 + -0.0006669683424497372i, -0.007659499003539404 + -0.00043055508966473527i, -0.0006135764292071379 + -0.002530779447560557i, -0.011505538909247433 + -0.011918883083757784i, 2.6911756877423746e-05 + 0.00017011635778342788i, 0.0006947188795631031 + 0.0008472590705910514i }, { -0.008689413506923264 + 0.0004884485538647484i, -0.0010046957262537719 + 0.0006669683424497374i, 0.12667669176891677 + 3.1325903303137366e-19i, 0.015145440552029519 + -0.008871896191776911i, 0.0008667576823259085 + 0.0009044179548318525i, 0.00016697096257071108 + 4.7428016189696136e-05i, -0.012705910419383206 + -0.013180486462570536i, -0.0024422213293475003 + -0.0006859885168253988i }, { -0.0010731134407425064 + -0.0005501707148517839i, -0.007659499003539407 + 0.00043055508966473484i, 0.015145440552029519 + 0.008871896191776911i, 0.11166231111025142 + 1.4093004745839808e-19i, 4.0287796201249045e-05 + 0.00016883605224810993i, 0.000764025051724823 + 0.0007972216327716878i, -0.0005960110120404966 + -0.002465724262820692i, -0.01119993980247188 + -0.011618266623608983i }, { -0.01305260111088824 + 0.013521524528900118i, -0.0006135764292071382 + 0.002530779447560557i, 0.0008667576823259083 + -0.0009044179548318525i, 4.028779620124902e-05 + -0.00016883605224810993i, 0.139217838302456 + -8.540163080893043e-20i, 0.016644857584679054 + -0.009750224703658085i, -0.009371929166325593 + -0.0005634639397403716i, -0.0011599686380794612 + 0.0005890023810685349i }, { -0.0025075564550480498 + 0.0007024822214265359i, -0.011505538909247433 + 0.011918883083757784i, 0.00016697096257071108 + -4.7428016189696136e-05i, 0.0007640250517248228 + -0.0007972216327716876i, 0.016644857584679054 + 0.009750224703658085i, 0.12271701569996288 + -2.322432521499841e-19i, -0.0010810434070621345 + -0.0007237376584645957i, -0.008261119355583536 + -0.0004966792616708971i }, { 0.0007881324369649641 + -0.0009611835458761879i, 2.6911756877423753e-05 + -0.00017011635778342793i, -0.012705910419383206 + 0.013180486462570536i, -0.0005960110120404966 + 0.002465724262820692i, -0.009371929166325597 + 0.000563463939740372i, -0.0010810434070621347 + 0.0007237376584645957i, 0.13565614610792948 + 3.9717720317164643e-19i, 0.016219022360822465 + -0.009500778945518585i }, { 0.00016154616390493687 + -5.972147663385505e-05i, 0.0006947188795631032 + -0.0008472590705910515i, -0.0024422213293475003 + 0.000685988516825399i, -0.01119993980247188 + 0.011618266623608983i, -0.0011599686380794614 + -0.000589002381068535i, -0.008261119355583537 + 0.0004966792616708971i, 0.016219022360822465 + 0.009500778945518585i, 0.11957747379726093 + 1.3420798900935276e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.12994727522036315, 1.0e-7), DoubleNear(0.11454524799285999, 1.0e-7), DoubleNear(0.12667669176891677, 1.0e-7), DoubleNear(0.11166231111025142, 1.0e-7), DoubleNear(0.139217838302456, 1.0e-7), DoubleNear(0.12271701569996288, 1.0e-7), DoubleNear(0.13565614610792948, 1.0e-7), DoubleNear(0.11957747379726093, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true, false}), Matrix({ { 0.1510258613646985 + -2.735048979221039e-20i, 0.035831772196862954 + -0.0029987418847796914i, -0.010134039285143632 + -0.0005902176115907863i, -0.0024160795646197167 + 6.118703762232234e-05i, 0.009820932138428322 + -0.00304673117165721i, -0.01729546666198239 + 0.030715795357678724i, -0.0006709046092323161 + 0.00016605901828923214i, 0.0012805882398810723 + -0.0019934796933721586i }, { 0.035831772196862954 + 0.0029987418847796914i, 0.13691857527628376 + -1.2000107091343729e-19i, -0.0023926410586973712 + -0.0003412522239949784i, -0.009187421334185389 + -0.0005350855393357872i, 0.006032186297958365 + -0.017998434595165508i, -0.013513967633951934 + -0.00048143932855170555i, -0.0004751067489340523 + 0.0011841451460898333i, 0.0009049239891436895 + 8.51185793798577e-05i }, { -0.010134039285143634 + 0.0005902176115907861i, -0.002392641058697372 + 0.0003412522239949784i, 0.14719233962404904 + 4.042898667203284e-19i, 0.0349222466594388 + -0.002922624178143085i, -0.0006470910136130558 + 0.0002428205352633476i, 0.0010405101074300687 + -0.002128663018033791i, 0.009571645317443447 + -0.0029693953426877724i, -0.016856452132521908 + 0.029936129754576095i }, { -0.002416079564619717 + -6.118703762232234e-05i, -0.009187421334185389 + 0.0005350855393357868i, 0.0349222466594388 + 0.002922624178143085i, 0.13344314179570327 + 1.655526040856724e-19i, -0.00033442894735569764 + 0.0012312933968235832i, 0.0009086869734174555 + -2.0508120947516814e-05i, 0.005879070022984572 + -0.017541576480305236i, -0.01317093970311242 + -0.000469218851104138i }, { 0.009820932138428322 + 0.00304673117165721i, 0.006032186297958366 + 0.017998434595165508i, -0.0006470910136130556 + -0.0002428205352633476i, -0.00033442894735569764 + -0.0012312933968235827i, 0.11813925215812063 + -2.1486856068491832e-19i, -0.003650443740822287 + -0.015852436751764516i, -0.007927303388105223 + -0.00046169488201433387i, 0.00018299748579774931 + 0.0010779860582979964i }, { -0.01729546666198239 + -0.030715795357678724i, -0.013513967633951934 + 0.00048143932855170565i, 0.0010405101074300687 + 0.00212866301803379i, 0.0009086869734174553 + 2.0508120947516787e-05i, -0.003650443740822287 + 0.015852436751764516i, 0.10034368841653907 + -3.081479681885002e-19i, 0.0003069019253814651 + -0.0010494537769193545i, -0.006733197024937552 + -0.0003921488119998447i }, { -0.0006709046092323162 + -0.00016605901828923208i, -0.0004751067489340523 + -0.0011841451460898338i, 0.009571645317443447 + 0.002969395342687772i, 0.005879070022984572 + 0.017541576480305236i, -0.007927303388105225 + 0.00046169488201433387i, 0.0003069019253814653 + 0.001049453776919355i, 0.11514049825279721 + 3.0614636948269165e-19i, -0.0035577837465868164 + -0.015450050959152412i }, { 0.0012805882398810725 + 0.0019934796933721586i, 0.0009049239891436897 + -8.51185793798577e-05i, -0.016856452132521908 + -0.029936129754576095i, -0.01317093970311242 + 0.00046921885110413805i, 0.0001829974857977495 + -0.0010779860582979966i, -0.0067331970249375536 + 0.0003921488119998447i, -0.0035577837465868164 + 0.015450050959152412i, 0.09779664311180908 + 1.095854323820784e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.1510258613646985, 1.0e-7), DoubleNear(0.13691857527628376, 1.0e-7), DoubleNear(0.14719233962404904, 1.0e-7), DoubleNear(0.13344314179570327, 1.0e-7), DoubleNear(0.11813925215812063, 1.0e-7), DoubleNear(0.10034368841653907, 1.0e-7), DoubleNear(0.11514049825279721, 1.0e-7), DoubleNear(0.09779664311180908, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false, true}), Matrix({ { 0.10303061964634974 + -3.8162510584171545e-19i, 0.012318320782635468 + -0.0072158259685556215i, -0.007640258279653218 + 0.0028901063243192715i, -0.000711057046298572 + 0.0008806317113409365i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.012318320782635468 + 0.0072158259685556215i, 0.09081889449575627 + -3.4740001533471103e-19i, -0.0011158785321537957 + -0.00018955061484576265i, -0.0067346951129856406 + 0.002547555884365382i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007640258279653219 + -0.002890106324319272i, -0.0011158785321537957 + 0.00018955061484576265i, 0.12180214596052563 + 4.1273385764330744e-19i, 0.014562640806249862 + -0.008530503755724055i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0007110570462985721 + -0.0008806317113409365i, -0.0067346951129856406 + -0.002547555884365383i, 0.014562640806249862 + 0.008530503755724055i, 0.10736552183530998 + 2.6954413173771147e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1661344938764694 + 1.3940605536458674e-19i, 0.019863007673405198 + -0.011635352667988584i, -0.010421084393595638 + -0.003942018817924392i, -0.0015220250325233954 + 0.0002585413845793824i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.019863007673405198 + 0.011635352667988584i, 0.14644336919706658 + -8.074902376722642e-20i, -0.0009698606011621106 + -0.0012011553860685703i, -0.0091859232461373 + -0.003474790235701014i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.010421084393595641 + 0.003942018817924392i, -0.000969860601162111 + 0.0012011553860685705i, 0.14053069191632062 + 2.9770237855971265e-19i, 0.016801822106602124 + -0.009842171381571441i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0015220250325233956 + -0.0002585413845793825i, -0.009185923246137304 + 0.0034747902357010144i, 0.016801822106602124 + 0.009842171381571441i, 0.12387426307220235 + 5.5939047300393514e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.10303061964634974, 1.0e-7), DoubleNear(0.09081889449575627, 1.0e-7), DoubleNear(0.12180214596052563, 1.0e-7), DoubleNear(0.10736552183530998, 1.0e-7), DoubleNear(0.1661344938764694, 1.0e-7), DoubleNear(0.14644336919706658, 1.0e-7), DoubleNear(0.14053069191632062, 1.0e-7), DoubleNear(0.12387426307220235, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true, false}), Matrix({ { 0.14398914909192437 + 1.1190006398785337e-19i, 0.03416227090155799 + -0.0028590222127126965i, -0.01445284398270269 + -0.014982232122791875i, -0.0037265065406252556 + -0.0032676494963175704i, 0.009363347767883464 + -0.0029047755460860853i, -0.01648962307053392 + 0.029284661562391408i, -0.0012420868313271329 + -0.0006827013184843959i, 0.004702240071610537 + -0.0012236705703075237i }, { 0.03416227090155799 + 0.0028590222127126965i, 0.13053916045082675 + 1.0890871832181402e-20i, -0.003131537618241617 + -0.0038415955505030595i, -0.01310280761798464 + -0.013582745750793166i, 0.0057511300671185175 + -0.01715983778491002i, -0.012884314533188824 + -0.00045900773967544534i, -0.0023627673377670647 + 0.001123999229528962i, 0.0012454968197345194 + 0.0013867000366826706i }, { -0.01445284398270269 + 0.014982232122791875i, -0.003131537618241617 + 0.0038415955505030595i, 0.15422905189682318 + 2.6503931294026465e-19i, 0.036591747954743764 + -0.0030623438502100793i, -0.0006375965378497047 + 0.0012658323118559898i, -0.0013919635532063045 + -0.004655198043289016i, 0.010029229687988302 + -0.0031113509682588977i, -0.017662295723970378 + 0.03136726354986341i }, { -0.0037265065406252556 + 0.0032676494963175704i, -0.01310280761798464 + 0.013582745750793166i, 0.036591747954743764 + 0.0030623438502100793i, 0.13982255662116028 + 3.46606613400537e-20i, 0.0012082333175510065 + 0.002320822270394752i, 0.0013410173578493078 + -0.0012945546591980515i, 0.006160126253824419 + -0.018380173290560728i, -0.013800592803875529 + -0.0004916504399803982i }, { 0.009363347767883464 + 0.0029047755460860853i, 0.0057511300671185175 + 0.01715983778491002i, -0.0006375965378497047 + -0.0012658323118559898i, 0.0012082333175510065 + -0.002320822270394752i, 0.11263481789735554 + 4.454154937532204e-20i, -0.003480359478166859 + -0.015113827911950336i, -0.011305667547568756 + -0.01171977886867878i, -0.001223271243770294 + 0.0018791787580656359i }, { -0.01648962307053392 + -0.02928466156239141i, -0.012884314533188826 + 0.00045900773967544545i, -0.0013919635532063045 + 0.004655198043289016i, 0.0013410173578493078 + 0.0012945546591980515i, -0.003480359478166859 + 0.015113827911950336i, 0.09566839865228464 + -6.586661132573673e-20i, 0.0019219501769939824 + -0.00115490815987819i, -0.009602671093734675 + -0.009954403956573602i }, { -0.0012420868313271329 + 0.0006827013184843959i, -0.0023627673377670643 + -0.001123999229528962i, 0.010029229687988302 + 0.0031113509682588972i, 0.00616012625382442 + 0.018380173290560728i, -0.011305667547568756 + 0.011719778868678778i, 0.0019219501769939824 + 0.00115490815987819i, 0.12064493251356229 + 4.673625942245131e-20i, -0.0037278680092422446 + -0.01618865979896659i }, { 0.004702240071610537 + 0.0012236705703075235i, 0.0012454968197345194 + -0.0013867000366826706i, -0.017662295723970378 + -0.03136726354986341i, -0.013800592803875529 + 0.0004916504399803982i, -0.001223271243770294 + -0.0018791787580656357i, -0.009602671093734675 + 0.009954403956573602i, -0.003727868009242244 + 0.016188659798966592i, 0.10247193287606352 + -1.3269592448068503e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.14398914909192437, 1.0e-7), DoubleNear(0.13053916045082675, 1.0e-7), DoubleNear(0.15422905189682318, 1.0e-7), DoubleNear(0.13982255662116028, 1.0e-7), DoubleNear(0.11263481789735554, 1.0e-7), DoubleNear(0.09566839865228464, 1.0e-7), DoubleNear(0.12064493251356229, 1.0e-7), DoubleNear(0.10247193287606352, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false, true}), Matrix({ { 0.10894010551986777 + 4.15145946282432e-20i, 0.013024857760674762 + -0.007629701200727486i, -0.011158230724071629 + -0.011496144057389341i, -0.002139216875622743 + -0.0005930017644282282i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.013024857760674764 + 0.007629701200727487i, 0.09602795735409278 + -1.535950066511928e-20i, -0.0005289349009572561 + -0.0021559517165543065i, -0.009835699157853896 + -0.010133561244606647i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011158230724071627 + 0.01149614405738934i, -0.0005289349009572564 + 0.0021559517165543065i, 0.1158926600870076 + -1.0405842826651198e-20i, 0.013856103828210566 + -0.00811662852355219i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0021392168756227434 + 0.0005930017644282283i, -0.009835699157853896 + 0.010133561244606647i, 0.013856103828210566 + 0.008116628523552192i, 0.10215645897697348 + -6.249638293188031e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.14768386146941212 + 1.149270187349322e-19i, 0.017657053662716367 + -0.010343148923935546i, -0.014600280806199819 + -0.015205866934081314i, -0.0028105609087728063 + -0.0007954689738237065i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.017657053662716367 + 0.010343148923935546i, 0.13017960174901863 + -3.9616238828436045e-20i, -0.0006806525402903785 + -0.002840551993826943i, -0.012869779553865418 + -0.013403588462760121i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014600280806199819 + 0.015205866934081314i, -0.0006806525402903785 + 0.002840551993826943i, 0.15898132432337786 + 3.2218141518936714e-19i, 0.019007776117290952 + -0.01113437512562448i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0028105609087728063 + 0.0007954689738237067i, -0.012869779553865417 + 0.013403588462760121i, 0.019007776117290952 + 0.011134375125624478i, 0.1401380305202503 + -3.5538880208751024e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.10894010551986777, 1.0e-7), DoubleNear(0.09602795735409278, 1.0e-7), DoubleNear(0.1158926600870076, 1.0e-7), DoubleNear(0.10215645897697348, 1.0e-7), DoubleNear(0.14768386146941212, 1.0e-7), DoubleNear(0.13017960174901863, 1.0e-7), DoubleNear(0.15898132432337786, 1.0e-7), DoubleNear(0.1401380305202503, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true, true}), Matrix({ { 0.1261514229848626 + 1.1682757700989876e-19i, 0.029930165667376735 + -0.0025048395851605563i, 0.008203393465896127 + -0.0025449248842803448i, -0.014446848446224625 + 0.025656806440097095i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.029930165667376735 + 0.0025048395851605563i, 0.11436765165969498 + 5.739716666207554e-20i, 0.005038666082225773 + -0.015034035331188862i, -0.011288174302000058 + -0.0004021447441442678i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.008203393465896127 + 0.0025449248842803448i, 0.005038666082225774 + 0.015034035331188862i, 0.09868134262201278 + -8.571882520830676e-20i, -0.003049204078491407 + -0.01324149013911912i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014446848446224625 + -0.025656806440097095i, -0.01128817430200006 + 0.0004021447441442679i, -0.0030492040784914063 + 0.01324149013911912i, 0.08381676467137128 + -1.3525305025907514e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.17206677800388492 + 2.6011179991821926e-19i, 0.04082385318892502 + -0.00341652647776222i, 0.01118918398997564 + -0.0034712016300646378i, -0.019705070348279674 + 0.034995118672157724i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04082385318892502 + 0.003416526477762219i, 0.15599406541229208 + -1.1845633489840435e-20i, 0.006872590238717164 + -0.020505975744281882i, -0.015396733035064294 + -0.0005485134355115757i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.01118918398997564 + 0.003471201630064638i, 0.0068725902387171646 + 0.020505975744281885i, 0.13459840778890503 + 1.769966340060801e-19i, -0.004159023408917696 + -0.018060997571797806i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.019705070348279674 + -0.034995118672157724i, -0.015396733035064294 + 0.0005485134355115758i, -0.004159023408917697 + 0.018060997571797806i, 0.11432356685697687 + -6.330948554734663e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1261514229848626, 1.0e-7), DoubleNear(0.11436765165969498, 1.0e-7), DoubleNear(0.09868134262201278, 1.0e-7), DoubleNear(0.08381676467137128, 1.0e-7), DoubleNear(0.17206677800388492, 1.0e-7), DoubleNear(0.15599406541229208, 1.0e-7), DoubleNear(0.13459840778890503, 1.0e-7), DoubleNear(0.11432356685697687, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false, false}), Matrix({ { 0.1706558055502319 + 3.0313373077916717e-20i, -0.006544513394398647 + -0.04691436535859089i, -0.000929926003565478 + -8.690434897034433e-05i, 1.1771359320661041e-05 + 0.00025897527963432947i, -0.011586887513422513 + -0.004873163207566673i, -0.0008953156802852982 + 0.003372190909082303i, -0.0026072894774092446 + -0.0019493085357767683i, -0.0004358898409358602 + 0.0007915148654068743i }, { -0.006544513394398647 + 0.04691436535859089i, 0.07553841630062982 + 3.544132739221199e-20i, 5.955247483208332e-05 + -0.00025230985534320543i, -0.00041161879819807067 + -3.84670001099073e-05i, 0.0017840113831532984 + -0.0029984271009049906i, -0.005128774434572935 + -0.0021570378451949684i, 0.0006358647653512722 + -0.0006420060247193347i, -0.0011540803861068735 + -0.0008628342833056145i }, { -0.0009299260035654754 + 8.690434897034431e-05i, 5.955247483208331e-05 + 0.000252309855343205i, 0.17019482943211284 + -1.5481947707523182e-20i, -0.006526835329654226 + -0.046787640094499844i, -0.0022571162786868383 + -0.002325918555489197i, -0.0005528511900533858 + 0.0007096927204165205i, -0.008977643246376087 + -0.004363023904244446i, -0.0008551375710039562 + 0.002635329646424512i }, { 1.1771359320661034e-05 + -0.0002589752796343299i, -0.0004116187981980697 + 3.8467000109907264e-05i, -0.006526835329654226 + 0.046787640094499844i, 0.07533437164007546 + -3.9646806532058525e-20i, 0.000725968391322384 + -0.0005312984947808874i, -0.000999081095123887 + -0.0010295354650222376i, 0.001543708420224163 + -0.002300692705251074i, -0.003973828788049531 + -0.0019312317852052609i }, { -0.011586887513422515 + 0.004873163207566672i, 0.0017840113831532984 + 0.0029984271009049915i, -0.0022571162786868383 + 0.0023259185554891973i, 0.000725968391322384 + 0.0005312984947808874i, 0.1767361424535313 + 4.6018692813812106e-20i, -0.006777689442396536 + -0.04858588861011455i, 0.00169515079544233 + -7.272722832497356e-05i, -8.500085186485836e-05 + -0.000463218694380185i }, { -0.0008953156802852984 + -0.003372190909082303i, -0.005128774434572935 + 0.0021570378451949684i, -0.0005528511900533857 + -0.0007096927204165203i, -0.0009990810951238873 + 0.0010295354650222376i, -0.006777689442396536 + 0.04858588861011455i, 0.0782297927748648 + -2.666462784557067e-21i, -4.501449745804992e-05 + 0.00046879675623838805i, 0.0007503348981630506 + -3.219169504307173e-05i }, { -0.0026072894774092454 + 0.0019493085357767679i, 0.0006358647653512722 + 0.0006420060247193346i, -0.008977643246376085 + 0.0043630239042444455i, 0.0015437084202241634 + 0.002300692705251074i, 0.0016951507954423351 + 7.272722832497364e-05i, -4.501449745804991e-05 + -0.00046879675623838805i, 0.17558873361901378 + 2.5564583464660464e-19i, -0.0067336872330246355 + -0.048270458630427227i }, { -0.0004358898409358601 + -0.000791514865406874i, -0.001154080386106873 + 0.0008628342833056145i, -0.0008551375710039563 + -0.002635329646424511i, -0.003973828788049531 + 0.001931231785205261i, -8.500085186485825e-05 + 0.00046321869438018513i, 0.0007503348981630508 + 3.2191695043071705e-05i, -0.006733687233024636 + 0.048270458630427227i, 0.07772190822954064 + 5.582172185298111e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1706558055502319, 1.0e-7), DoubleNear(0.07553841630062982, 1.0e-7), DoubleNear(0.17019482943211284, 1.0e-7), DoubleNear(0.07533437164007546, 1.0e-7), DoubleNear(0.1767361424535313, 1.0e-7), DoubleNear(0.0782297927748648, 1.0e-7), DoubleNear(0.17558873361901378, 1.0e-7), DoubleNear(0.07772190822954064, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false, false}), Matrix({ { 0.17552779178973477 + -2.8246252247300423e-19i, -0.006731350162705173 + -0.04825370533431053i, 0.0066784266555030315 + -8.113285723441877e-05i, -0.0002784162487419455 + -0.0018328305448352192i, -0.012962965680881141 + -0.0006857494037809434i, 0.00030860247787315906 + 0.0035898995774957723i, -0.008312735037184776 + 0.0036681710448906724i, 0.0013271902568007298 + 0.0021445522638237403i }, { -0.006731350162705173 + 0.04825370533431054i, 0.07769493317729817 + -1.0995473442890665e-19i, -0.00023380837273550572 + 0.0018390533049597235i, 0.002956112575895462 + -3.5912329648985475e-05i, 0.0006856362151045066 + -0.003537303697223486i, -0.005737876276379901 + -0.0003035374259533544i, -0.0006896168016283614 + -0.0024258951042718624i, -0.003679516426711109 + 0.0016236648413892269i }, { 0.006678426655503035 + 8.113285723441898e-05i, -0.0002338083727355056 + -0.0018390533049597235i, 0.17551526422390512 + -1.3829004199935648e-19i, -0.00673086974059409 + -0.048250261426858995i, -0.008897227475858728 + 0.003058972260498099i, 0.0011821324565497457 + 0.002328595234529166i, -0.010592497524380514 + -0.0006861467219135351i, 0.00021758769827529765 + 0.0029382580552365003i }, { -0.0002784162487419454 + 0.0018328305448352192i, 0.002956112575895461 + 3.591232964898552e-05i, -0.00673086974059409 + 0.04825026142685899i, 0.07768938802470393 + -1.3966079067779888e-19i, -0.0004997293680520636 + -0.002563213504530312i, -0.003938233866851915 + 0.0013540114813004088i, 0.0005948398860653697 + -0.0028856317013001955i, -0.004688621550730237 + -0.00030371329329291984i }, { -0.012962965680881147 + 0.0006857494037809434i, 0.0006856362151045068 + 0.0035373036972234863i, -0.008897227475858728 + -0.003058972260498097i, -0.0004997293680520641 + 0.0025632135045303124i, 0.17186415621402848 + 3.5879458836473304e-19i, -0.00659085267409001 + -0.047246548634394904i, -0.005913201863626177 + -7.849872006089912e-05i, 0.0002051867561977485 + 0.0016285871300893637i }, { 0.00030860247787315906 + -0.003589899577495773i, -0.005737876276379903 + 0.0003035374259533544i, 0.0011821324565497457 + -0.002328595234529166i, -0.003938233866851916 + -0.001354011481300408i, -0.006590852674090011 + 0.047246548634394904i, 0.07607327589819646 + 1.4272959903656156e-19i, 0.0002483463501095391 + -0.0016225664040645411i, -0.002617396475930481 + -3.474636550399355e-05i }, { -0.008312735037184776 + -0.0036681710448906724i, -0.0006896168016283614 + 0.0024258951042718624i, -0.010592497524380518 + 0.000686146721913534i, 0.0005948398860653696 + 0.0028856317013001963i, -0.0059132018636261705 + 7.849872006089896e-05i, 0.0002483463501095391 + 0.0016225664040645411i, 0.17026829882722144 + 3.784539289384379e-19i, -0.006529652822084772 + -0.04680783729806808i }, { 0.0013271902568007306 + -0.00214455226382374i, -0.003679516426711109 + -0.001623664841389226i, 0.00021758769827529782 + -0.0029382580552365016i, -0.004688621550730238 + 0.0003037132932929196i, 0.0002051867561977484 + -0.0016285871300893628i, -0.00261739647593048 + 3.4746365503993454e-05i, -0.006529652822084772 + 0.04680783729806808i, 0.07536689184491219 + 1.0559615633103843e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.17552779178973477, 1.0e-7), DoubleNear(0.07769493317729817, 1.0e-7), DoubleNear(0.17551526422390512, 1.0e-7), DoubleNear(0.07768938802470393, 1.0e-7), DoubleNear(0.17186415621402848, 1.0e-7), DoubleNear(0.07607327589819646, 1.0e-7), DoubleNear(0.17026829882722144, 1.0e-7), DoubleNear(0.07536689184491219, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false, false}), Matrix({ { 0.16808118364864502 + 4.915598886256037e-20i, -0.006445778707546826 + -0.046206585437703736i, -0.00045173453933083745 + -0.00017571608037335266i, -3.098180945913123e-05 + 0.0001309232662366109i, -0.016711326099250072 + -0.017296910668713368i, -0.004114164689144194 + 0.0052573723988299775i, 0.0012694543672268233 + -0.0007131140450845742i, -0.00024472214015034685 + -0.0003216337199509567i }, { -0.006445778707546826 + 0.04620658543770374i, 0.07439879576213287 + -3.281235794806141e-20i, 6.562912466567963e-05 + -0.00011744612447859171i, -0.00019995400437345192 + -7.777827649731082e-05i, 0.005395896619002435 + -0.003930727070965154i, -0.007397035827469491 + -0.007656236684098558i, 0.000147357024640715 + 0.0003763284243560299i, 0.000561906301148406 + -0.0003156500034308471i }, { -0.0004517345393308366 + 0.00017571608037335258i, 6.562912466567963e-05 + 0.00011744612447859171i, 0.1666058062038605 + 1.0520891515931786e-19i, -0.006389199164776193 + -0.045800994803014944i, 0.001179090091884368 + -0.0007028069871823751i, -0.00023842326688855577 + -0.0002971872738612309i, -0.016882725104501048 + -0.017527645223671978i, -0.004171022069971313 + 0.0053133395598013i }, { -3.098180945913109e-05 + -0.00013092326623661025i, -0.0001999540043734515 + 7.777827649731078e-05i, -0.006389199164776193 + 0.045800994803014944i, 0.07374574047775292 + -2.008667220419676e-20i, 0.00014798894647783122 + 0.00035109144344353286i, 0.0005219078128021424 + -0.0003110877277547237i, 0.005465900028844331 + -0.0039689972613516375i, -0.00747290321077015 + -0.007758368122353519i }, { -0.016711326099250072 + 0.017296910668713368i, 0.005395896619002435 + 0.003930727070965154i, 0.0011790900918843682 + 0.000702806987182375i, 0.00014798894647783127 + -0.0003510914434435327i, 0.1793107643551182 + 2.7176077029168434e-20i, -0.006876424129248358 + -0.0492936685310017i, 0.001216959331207689 + 1.6084503078034767e-05i, -4.2247683085066e-05 + -0.0003351666809824666i }, { -0.004114164689144194 + -0.0052573723988299775i, -0.007397035827469491 + 0.0076562366840985585i, -0.00023842326688855572 + 0.000297187273861231i, 0.0005219078128021425 + 0.0003110877277547239i, -0.006876424129248358 + 0.0492936685310017i, 0.07936941331336177 + 6.558722255571631e-20i, -5.109114729164629e-05 + 0.00033393302537377493i, 0.000538670104338432 + 7.119581344331799e-06i }, { 0.0012694543672268238 + 0.0007131140450845748i, 0.00014735702464071496 + -0.00037632842435602996i, -0.016882725104501048 + 0.017527645223671978i, 0.005465900028844331 + 0.0039689972613516375i, 0.0012169593312076955 + -1.608450307803466e-05i, -5.109114729164626e-05 + -0.00033393302537377515i, 0.17917775684726608 + 1.3495497177976358e-19i, -0.006871323397902669 + -0.049257103921912126i }, { -0.00024472214015034674 + 0.00032163371995095686i, 0.000561906301148406 + 0.000315650003430847i, -0.004171022069971313 + -0.0053133395598013i, -0.00747290321077015 + 0.007758368122353519i, -4.224768308506603e-05 + 0.00033516668098246554i, 0.0005386701043384322 + -7.119581344331809e-06i, -0.006871323397902669 + 0.04925710392191213i, 0.0793105393918632 + -1.39779621425637e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.16808118364864502, 1.0e-7), DoubleNear(0.07439879576213287, 1.0e-7), DoubleNear(0.1666058062038605, 1.0e-7), DoubleNear(0.07374574047775292, 1.0e-7), DoubleNear(0.1793107643551182, 1.0e-7), DoubleNear(0.07936941331336177, 1.0e-7), DoubleNear(0.17917775684726608, 1.0e-7), DoubleNear(0.0793105393918632, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true, false}), Matrix({ { 0.19752008533093854 + 1.510081443551133e-19i, -0.007574736997333486 + -0.054299526576305844i, 0.0004350914494633835 + -9.076330913847765e-05i, -4.1636818870408824e-05 + -0.00011612870402064306i, -0.0025332966829135434 + -0.0024202049061717475i, -0.0005681798097922981 + 0.00078923227449123i, -6.692390445013245e-06 + -4.167070246424985e-06i, -8.889062790372683e-07 + 1.9995844641943397e-06i }, { -0.007574736997333486 + 0.05429952657630585i, 0.0874295157164906 + 2.919549009754937e-20i, 8.266001984096662e-06 + 0.0001230901043722055i, 0.00019258717236393923 + -4.017511510035922e-05i, 0.0007624796054524384 + -0.0006036064368637123i, -0.001121328505818698 + -0.0010712700054110742i, 1.4022019007913952e-06 + -1.6799768545358958e-06i, -2.962293452905513e-06 + -1.8444956268174985e-06i }, { 0.0004350914494633861 + 9.076330913847765e-05i, 8.266001984096635e-06 + -0.0001230901043722055i, 0.1966055899463583 + 1.7993178539483928e-19i, -0.007539666832130465 + -0.05404812598402822i, -4.4681527862525745e-06 + -6.4952424886102034e-06i, -1.6142333544250083e-06 + 1.4774109380335062e-06i, -0.002521567809262969 + -0.002408999634501657i, -0.0005655492023135895 + 0.0007855782194052634i }, { -4.163681887040869e-05 + 0.00011612870402064328i, 0.00019258717236394053 + 4.017511510035919e-05i, -0.007539666832130465 + 0.05404812598402822i, 0.08702472706694714 + 6.235549025285116e-20i, 1.9569335123665216e-06 + -9.792362485815924e-07i, -1.9777656211256595e-06 + -2.875028654877823e-06i, 0.0007589494121616924 + -0.0006008118081570167i, -0.0011161368831973757 + -0.0010663101479163478i }, { -0.0025332966829135443 + 0.0024202049061717475i, 0.0007624796054524383 + 0.000603606436863712i, -4.468152786252629e-06 + 6.495242488610048e-06i, 1.956933512366481e-06 + 9.792362485815754e-07i, 0.14987186267282468 + -7.467607846338451e-20i, -0.0057474658394616965 + -0.041200727392399585i, 0.00033013334241346805 + -6.886826815684026e-05i, -3.1592673673788403e-05 + -8.811471072521265e-05i }, { -0.0005681798097922979 + -0.0007892322744912303i, -0.001121328505818698 + 0.001071270005411074i, -1.6142333544249694e-06 + -1.4774109380335773e-06i, -1.977765621125856e-06 + 2.8750286548777417e-06i, -0.0057474658394616965 + 0.04120072739239959i, 0.06633869335900404 + 3.5793745101055415e-21i, 6.271975389936674e-06 + 9.339679652297771e-05i, 0.00014612892760104083 + -3.0483580052619804e-05i }, { -6.692390445013055e-06 + 4.167070246425046e-06i, 1.4022019007914426e-06 + 1.6799768545358755e-06i, -0.002521567809262969 + 0.002408999634501657i, 0.0007589494121616926 + 0.0006008118081570163i, 0.0003301333424134728 + 6.88682681568403e-05i, 6.2719753899367285e-06 + -9.339679652297793e-05i, 0.1491779731047683 + 6.023210154424215e-20i, -0.005720855730548397 + -0.041009972740898855i }, { -8.88906279037292e-07 + -1.9995844641943024e-06i, -2.962293452905418e-06 + 1.8444956268175527e-06i, -0.0005655492023135895 + -0.0007855782194052636i, -0.0011161368831973757 + 0.0010663101479163478i, -3.159267367378843e-05 + 8.8114710725212e-05i, 0.00014612892760104018 + 3.0483580052619787e-05i, -0.0057208557305483965 + 0.04100997274089885i, 0.06603155280266898 + -9.642012459961162e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.19752008533093854, 1.0e-7), DoubleNear(0.0874295157164906, 1.0e-7), DoubleNear(0.1966055899463583, 1.0e-7), DoubleNear(0.08702472706694714, 1.0e-7), DoubleNear(0.14987186267282468, 1.0e-7), DoubleNear(0.06633869335900404, 1.0e-7), DoubleNear(0.1491779731047683, 1.0e-7), DoubleNear(0.06603155280266898, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false, true}), Matrix({ { 0.14688196860340635 + 5.432509374323959e-20i, -0.005632805797735887 + -0.040378786513775994i, 0.0003237032350087935 + -5.347429295807109e-05i, -2.7114182605938493e-05 + -8.69373799537883e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005632805797735888 + 0.040378786513775994i, 0.06501525837721536 + -4.697909325979685e-20i, 2.2866632549877136e-06 + 9.103877252454552e-05i, 0.00014328273008419644 + -2.366965125988428e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0003237032350087957 + 5.347429295807103e-05i, 2.2866632549876594e-06 + -9.103877252454487e-05i, 0.14634318267142543 + 3.067006554157148e-20i, -0.00561214378897976 + -0.04023067083742075i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -2.711418260593841e-05 + 8.693737995378722e-05i, 0.00014328273008419623 + 2.366965125988421e-05i, -0.00561214378897976 + 0.04023067083742074i, 0.06477677228589443 + -8.476319782042181e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20050997940035686 + 2.2006972148489203e-20i, -0.007689397039059295 + -0.055121467454929435i, 0.000441521556868058 + -0.00010615728433724682i, -4.6115309938258735e-05 + -0.00011730603479206741i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.007689397039059295 + 0.05512146745492945i, 0.08875295069827926 + 7.975395786745176e-20i, 1.2251314119045623e-05 + 0.0001254481283706377i, 0.00019543336988078362 + -4.698904389309474e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0004415215568680632 + 0.00010615728433724692i, 1.2251314119045704e-05 + -0.00012544812837063856i, 0.19944038037970113 + 2.0949382139750994e-19i, -0.007648378773699102 + -0.05482742788750633i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -4.611530993825871e-05 + 0.00011730603479206806i, 0.00019543336988078449 + 4.6989043893094766e-05i, -0.007648378773699102 + 0.05482742788750633i, 0.08827950758372168 + 5.069856347366135e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.14688196860340635, 1.0e-7), DoubleNear(0.06501525837721536, 1.0e-7), DoubleNear(0.14634318267142543, 1.0e-7), DoubleNear(0.06477677228589443, 1.0e-7), DoubleNear(0.20050997940035686, 1.0e-7), DoubleNear(0.08875295069827926, 1.0e-7), DoubleNear(0.19944038037970113, 1.0e-7), DoubleNear(0.08827950758372168, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false, false}), Matrix({ { 0.1725518377492966 + -3.2232374028894784e-19i, -0.0066172247099204485 + -0.04743559665823392i, -0.01045154296905309 + -0.0048695356881487155i, -0.0009378580056586167 + 0.0030599383669549602i, -0.011518108521792334 + -0.0007172093480781829i, 0.0002445448250067678 + 0.003193905626936989i, 0.0008187497926265114 + 0.00046140204234414514i, 9.544395489336939e-05 + -0.00024277391924226i }, { -0.0066172247099204485 + 0.04743559665823391i, 0.07637766855525173 + -9.211624778491151e-20i, 0.0017394746015026714 + -0.0026864527837034595i, -0.004626229979312765 + -0.0021554321742302527i, 0.0006388756394299859 + -0.0031388968193555317i, -0.005098330371531851 + -0.0003174627322824145i, -0.00015824075184063898 + 0.00020738512204795267i, 0.00036240819632281016 + 0.0002042331899824754i }, { -0.010451542969053089 + 0.0048695356881487155i, 0.0017394746015026716 + 0.00268645278370346i, 0.17849121826434328 + -9.842882418341284e-20i, -0.006844995193378814 + -0.04906837010293561i, 0.0008174639951996544 + -0.00037696364778053897i, -0.0001349787913199701 + -0.00021026979293491786i, -0.012037354683469323 + -0.000654686777616295i, 0.00028164535114168893 + 0.0033342520057952837i }, { -0.000937858005658617 + -0.0030599383669549602i, -0.004626229979312766 + 0.0021554321742302527i, -0.006844995193378814 + 0.04906837010293561i, 0.07900665264675036 + -1.5749927732179398e-19i, 7.228061297469197e-05 + 0.0002391823005891031i, 0.00036183905599385943 + -0.0001668577102574384i, 0.00064160046173989 + -0.003284038579168149i, -0.005328167455578287 + -0.0002897879869638597i }, { -0.011518108521792336 + 0.0007172093480781829i, 0.0006388756394299861 + 0.0031388968193555326i, 0.0008174639951996545 + 0.00037696364778053935i, 7.228061297469206e-05 + -0.00023918230058910312i, 0.16829879723304814 + 3.3715516565934135e-19i, -0.006454124014132425 + -0.04626640879485682i, -0.01011298779074551 + -0.004366651423662404i, -0.0008125952456306375 + 0.0029475821885518545i }, { 0.00024454482500676784 + -0.0031939056269369897i, -0.005098330371531852 + 0.0003174627322824145i, -0.00013497879131997022 + 0.00021026979293491788i, 0.0003618390559938595 + 0.00016685771025743852i, -0.006454124014132425 + 0.046266408794856814i, 0.07449511938545357 + 8.791076864506496e-20i, 0.0015882452018747895 + -0.0026126670224526057i, -0.004476373243309699 + -0.0019328374561699768i }, { 0.0008187497926265114 + -0.00046140204234414574i, -0.0001582407518406391 + -0.00020738512204795286i, -0.012037354683469326 + 0.000654686777616295i, 0.0006416004617398901 + 0.0032840385791681505i, -0.010112987790745508 + 0.004366651423662403i, 0.0015882452018747902 + 0.0026126670224526057i, 0.1738336578082018 + 4.000933516438295e-19i, -0.006666381482042358 + -0.04778797713760616i }, { 9.544395489336944e-05 + 0.00024277391924226017i, 0.00036240819632281016 + -0.0002042331899824755i, 0.00028164535114168915 + -0.0033342520057952846i, -0.005328167455578289 + 0.0002897879869638597i, -0.0008125952456306376 + -0.0029475821885518545i, -0.004476373243309698 + 0.0019328374561699765i, -0.006666381482042358 + 0.047787977137606165i, 0.07694504835765509 + 1.6041498672253506e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1725518377492966, 1.0e-7), DoubleNear(0.07637766855525173, 1.0e-7), DoubleNear(0.17849121826434328, 1.0e-7), DoubleNear(0.07900665264675036, 1.0e-7), DoubleNear(0.16829879723304814, 1.0e-7), DoubleNear(0.07449511938545357, 1.0e-7), DoubleNear(0.1738336578082018, 1.0e-7), DoubleNear(0.07694504835765509, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false, false}), Matrix({ { 0.14259316235020206 + 6.66525271095665e-20i, -0.005468333514595102 + -0.039199766422040455i, -0.002676591319630134 + -0.004067147533081356i, -0.00101543956874419 + 0.0008917838107020118i, -0.024664207782270575 + -0.01341284650155365i, -0.0027414241289410897 + 0.00729471936070552i, 0.0054278525737269795 + 0.03981851221492512i, 0.010738208233270641 + -0.003019159199599224i }, { -0.005468333514595102 + 0.039199766422040455i, 0.06311687800191701 + -2.6863297262323627e-20i, 0.0012207298333932234 + -0.0005798401130185293i, -0.0011847558816823294 + -0.0018002662289713215i, 0.004633129338416534 + -0.006265975529771588i, -0.010917268177167247 + -0.00593700975799841i, -0.011154515826874557 + -3.485687322519637e-05i, 0.0024025633702332394 + 0.017625110042197682i }, { -0.002676591319630134 + 0.004067147533081356i, 0.0012207298333932232 + 0.0005798401130185293i, 0.19209382750230347 + 8.771237691231174e-20i, -0.007366644357727915 + -0.05280781381867822i, -0.030105813143978345 + 0.019310944882415824i, 0.00646323526730906 + 0.007535720075072804i, -0.008929843421480546 + -0.021411709390831694i, -0.005543762630174417 + 0.003275992597925757i }, { -0.0010154395687441897 + -0.0008917838107020115i, -0.001184755881682329 + 0.001800266228971321i, -0.007366644357727915 + 0.052807813818678224i, 0.08502765823796879 + -2.6035732889934507e-20i, -0.0041541676474321065 + -0.009016838599391213i, -0.013325919027521296 + 0.008547720887567903i, 0.006228667309430232 + -0.001633748802545203i, -0.003952670861072394 + -0.009477595048453667i }, { -0.02466420778227057 + 0.01341284650155365i, 0.004633129338416534 + 0.006265975529771588i, -0.030105813143978345 + -0.019310944882415824i, -0.0041541676474321065 + 0.009016838599391213i, 0.1982574726321427 + -5.182110173917297e-20i, -0.007603015209457769 + -0.05450223903105028i, -0.017887939440168466 + -0.005169039578729762i, -0.0007350136825450642 + 0.005115736744804804i }, { -0.0027414241289410897 + -0.00729471936070552i, -0.010917268177167245 + 0.00593700975799841i, 0.00646323526730906 + -0.007535720075072804i, -0.013325919027521293 + -0.008547720887567901i, -0.007603015209457769 + 0.054502239031050274i, 0.0877559099387883 + 2.2657818122477084e-20i, 0.002106989969984238 + -0.004719279693137537i, -0.007917847340940136 + -0.0022880034014289077i }, { 0.00542785257372698 + -0.03981851221492513i, -0.011154515826874557 + 3.485687322519621e-05i, -0.008929843421480546 + 0.021411709390831694i, 0.006228667309430232 + 0.0016337488025452032i, -0.017887939440168463 + 0.005169039578729762i, 0.002106989969984238 + 0.004719279693137536i, 0.1602310485702416 + 2.1395215054810498e-19i, -0.006144732317693257 + -0.04404853342186355i }, { 0.010738208233270641 + 0.0030191591995992243i, 0.00240256337023324 + -0.017625110042197682i, -0.0055437626301744185 + -0.003275992597925757i, -0.003952670861072394 + 0.009477595048453667i, -0.0007350136825450647 + -0.005115736744804803i, -0.007917847340940136 + 0.0022880034014289086i, -0.006144732317693257 + 0.04404853342186355i, 0.07092404276643667 + 2.895144229067556e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.14259316235020206, 1.0e-7), DoubleNear(0.06311687800191701, 1.0e-7), DoubleNear(0.19209382750230347, 1.0e-7), DoubleNear(0.08502765823796879, 1.0e-7), DoubleNear(0.1982574726321427, 1.0e-7), DoubleNear(0.0877559099387883, 1.0e-7), DoubleNear(0.1602310485702416, 1.0e-7), DoubleNear(0.07092404276643667, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true, false}), Matrix({ { 0.19380082610921082 + 2.309540905319385e-20i, -0.007432106386465265 + -0.053277078582644806i, -0.011692579214363737 + -0.005251510511227176i, -0.00099527256618719 + 0.003415755545198242i, -0.002485595270505219 + -0.0023746329867354605i, -0.0005574811104998747 + 0.0007743712065139222i, 8.561681515089001e-05 + 0.00021062198140041994i, 5.461798480500753e-05 + -3.1613790740155046e-05i }, { -0.007432106386465265 + 0.053277078582644806i, 0.08578323740492075 + 9.632957593073193e-20i, 0.0018920746531334394 + -0.0030129731051782294i, -0.005175557394458057 + -0.0023245080114631506i, 0.0007481222842756735 + -0.0005922406620725651i, -0.0011002141397588366 + -0.0010510982297665373i, -6.118465731561046e-05 + 1.545942231435777e-05i, 3.7897091190948896e-05 + 9.322888759506851e-05i }, { -0.011692579214363735 + 0.005251510511227176i, 0.0018920746531334398 + 0.0030129731051782294i, 0.20032484916808602 + 3.0784452069675876e-19i, -0.007682297442998686 + -0.05507057397768927i, 0.0002143098691538766 + 7.591533487292807e-05i, 1.2650996198798938e-05 + -6.182643709854479e-05i, -0.0025692692216712936 + -0.0024545715539379437i, -0.000576247901606013 + 0.0008004392873825711i }, { -0.0009952725661871902 + -0.003415755545198242i, -0.005175557394458057 + 0.0023245080114631506i, -0.007682297442998686 + 0.05507057397768927i, 0.08867100537851698 + -4.778595580331393e-21i, -2.9088219704992846e-05 + 5.600385257744687e-05i, 9.486127976299037e-05 + 3.3602866018789064e-05i, 0.0007733067333384574 + -0.0006121775829481639i, -0.001137251249257237 + -0.0010864819235608845i }, { -0.0024855952705052195 + 0.0023746329867354605i, 0.0007481222842756735 + 0.000592240662072565i, 0.00021430986915387668 + -7.591533487292802e-05i, -2.9088219704992853e-05 + -5.600385257744695e-05i, 0.14704980887313393 + -8.263983682800319e-21i, -0.005639242337587607 + -0.04042492687044593i, -0.008871951545434863 + -0.003984676600583943i, -0.0007551806851020642 + 0.0025917650103085737i }, { -0.0005574811104998748 + -0.0007743712065139224i, -0.0011002141397588368 + 0.0010510982297665375i, 1.2650996198798935e-05 + 6.182643709854485e-05i, 9.48612797629904e-05 + -3.3602866018789064e-05i, -0.005639242337587606 + 0.04042492687044593i, 0.06508955053578455 + -1.005350550705785e-19i, 0.0014356451502440216 + -0.002286146700977836i, -0.003927045828164409 + -0.0017637616189370789i }, { 8.56168151508899e-05 + -0.00021062198140042005i, -6.118465731561049e-05 + -1.5459422314357752e-05i, -0.002569269221671293 + 0.0024545715539379437i, 0.0007733067333384575 + 0.0006121775829481633i, -0.008871951545434862 + 0.003984676600583943i, 0.0014356451502440218 + 0.002286146700977836i, 0.15200002690445905 + -6.179993236342045e-21i, -0.005829079232422486 + -0.0417857732628525i }, { 5.4617984805007585e-05 + 3.1613790740155006e-05i, 3.789709119094895e-05 + -9.322888759506854e-05i, -0.0005762479016060127 + -0.0008004392873825715i, -0.001137251249257237 + 0.0010864819235608843i, -0.0007551806851020643 + -0.0025917650103085732i, -0.003927045828164409 + 0.0017637616189370786i, -0.005829079232422487 + 0.04178577326285251i, 0.06728069562588847 + 7.694304981072441e-21i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.19380082610921082, 1.0e-7), DoubleNear(0.08578323740492075, 1.0e-7), DoubleNear(0.20032484916808602, 1.0e-7), DoubleNear(0.08867100537851698, 1.0e-7), DoubleNear(0.14704980887313393, 1.0e-7), DoubleNear(0.06508955053578455, 1.0e-7), DoubleNear(0.15200002690445905, 1.0e-7), DoubleNear(0.06728069562588847, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false, true}), Matrix({ { 0.1440685102224178 + -4.207326961250432e-21i, -0.005524911923281419 + -0.03960534892704217i, -0.00839553628912846 + -0.0027158912652313866i, -0.00042465367738443906 + 0.0024121385281050496i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005524911923281419 + 0.03960534892704217i, 0.0637699201964111 + -6.509723361732255e-20i, 0.0010685778558817047 + -0.0022038340206113937i, -0.0037161672480492333 + -0.0012021514554329438i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00839553628912846 + 0.0027158912652313857i, 0.0010685778558817052 + 0.0022038340206113937i, 0.14915664105241405 + 8.920248624606152e-20i, -0.005720037663434228 + -0.04100410842415457i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0004246536773844394 + -0.0024121385281050496i, -0.0037161672480492333 + 0.001202151455432944i, -0.00572003766343423 + 0.04100410842415457i, 0.0660221104666987 + -6.664505746289608e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19678212475992696 + 1.9038752331643964e-20i, -0.0075464368007714545 + -0.054096656526048566i, -0.01216899447067014 + -0.006520295846579732i, -0.001325799573904815 + 0.003595382027401766i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0075464368007714545 + 0.054096656526048566i, 0.0871028677442942 + 6.089175447747599e-20i, 0.002259141947495756 + -0.0030952857855446715i, -0.005386435974573233 + -0.0028861181749672855i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.012168994470670137 + 0.006520295846579732i, 0.0022591419474957564 + 0.003095285785544672i, 0.20316823502013104 + 2.124620412143552e-19i, -0.007791339011986942 + -0.0558522388163872i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.001325799573904815 + -0.0035953820274017656i, -0.005386435974573233 + 0.0028861181749672855i, -0.007791339011986942 + 0.055852238816387206i, 0.08992959053770674 + 6.956076686363712e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1440685102224178, 1.0e-7), DoubleNear(0.0637699201964111, 1.0e-7), DoubleNear(0.14915664105241405, 1.0e-7), DoubleNear(0.0660221104666987, 1.0e-7), DoubleNear(0.19678212475992696, 1.0e-7), DoubleNear(0.0871028677442942, 1.0e-7), DoubleNear(0.20316823502013104, 1.0e-7), DoubleNear(0.08992959053770674, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false, false}), Matrix({ { 0.16947622972742535 + -1.949045040567468e-19i, -0.00649927760680164 + -0.04659009246942148i, -0.011332665784631634 + -0.0006370308202648552i, 0.00025947483141523 + 0.003139851457823144i, -0.01702310125901508 + -0.01763466754834884i, -0.004195059874045535 + 0.005356034077074597i, 0.0010278762191527585 + 0.0012535681348831201i, 0.0003051956165794454 + -0.00033064303764142745i }, { -0.00649927760680164 + 0.04659009246942148i, 0.07501629348579777 + -1.5781870256340485e-19i, 0.0006097224722760793 + -0.0030909922148290234i, -0.005016246725831033 + -0.00028197282326462804i, 0.005500704458999735 + -0.004003483337838649i, -0.007535038761120596 + -0.007805740064309062i, -0.0003840320752904737 + 0.00023449637069291755i, 0.0004549750973753085 + 0.0005548744815841193i }, { -0.011332665784631636 + 0.0006370308202648548i, 0.0006097224722760792 + 0.003090992214829024i, 0.16521076012508018 + 3.4926940807862503e-19i, -0.006335700265521378 + -0.0454174877712972i, 0.0011304186550951056 + 0.0011795348907683153i, 0.0002809109870865286 + -0.00035599348928806447i, -0.01657094994473604 + -0.0171898883440365i, -0.0040901268850699725 + 0.005214677881556681i }, { 0.00025947483141523016 + -0.003139851457823145i, -0.005016246725831034 + 0.00028197282326462825i, -0.006335700265521377 + 0.045417487771297206i, 0.07312824275408802 + 1.0491967241114673e-19i, -0.00036761228629747674 + 0.0002655250535157863i, 0.0005003640789556259 + 0.000522104696835225i, 0.0053610921888470305 + -0.0038962409944781427i, -0.007334900277119045 + -0.0076088647421430145i }, { -0.01702310125901508 + 0.017634667548348838i, 0.005500704458999735 + 0.004003483337838648i, 0.0011304186550951053 + -0.0011795348907683153i, -0.00036761228629747663 + -0.00026552505351578617i, 0.1815668262862145 + -2.258480604156139e-19i, -0.006962942296497621 + -0.049913874291748046i, -0.012222797420630023 + -0.0007348653054296231i, 0.00026671534473322655 + 0.0033883061749091286i }, { -0.004195059874045536 + -0.005356034077074597i, -0.007535038761120595 + 0.007805740064309062i, 0.0002809109870865285 + 0.00035599348928806447i, 0.0005003640789556258 + -0.000522104696835225i, -0.006962942296497621 + 0.04991387429174804i, 0.08036802771620433 + -9.179682254330065e-20i, 0.0006707536288937971 + -0.003331943183694658i, -0.005410251101279106 + -0.000325277895981646i }, { 0.0010278762191527587 + -0.0012535681348831201i, -0.00038403207529047375 + -0.0002344963706929176i, -0.01657094994473604 + 0.017189888344036505i, 0.0053610921888470305 + 0.0038962409944781427i, -0.012222797420630028 + 0.0007348653054296231i, 0.0006707536288937971 + 0.003331943183694659i, 0.17692169491616977 + 3.879791092245459e-19i, -0.006784805230653404 + -0.04863689816116579i }, { 0.00030519561657944545 + 0.00033064303764142756i, 0.00045497509737530854 + -0.0005548744815841194i, -0.0040901268850699725 + -0.005214677881556681i, -0.007334900277119045 + 0.007608864742143014i, 0.0002667153447332267 + -0.0033883061749091295i, -0.005410251101279107 + 0.000325277895981646i, -0.006784805230653404 + 0.04863689816116579i, 0.07831192498902065 + 1.434060829564533e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.16947622972742535, 1.0e-7), DoubleNear(0.07501629348579777, 1.0e-7), DoubleNear(0.16521076012508018, 1.0e-7), DoubleNear(0.07312824275408802, 1.0e-7), DoubleNear(0.1815668262862145, 1.0e-7), DoubleNear(0.08036802771620433, 1.0e-7), DoubleNear(0.17692169491616977, 1.0e-7), DoubleNear(0.07831192498902065, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true, false}), Matrix({ { 0.1995960320240251 + -6.925407310727792e-20i, -0.00765434788953348 + -0.05487021751360159i, -0.013393163339130314 + -0.0007800325867352051i, 0.0002991811672388527 + 0.003711779331906473i, -0.0025599217669534267 + -0.0024456413895711i, -0.0005741514100740654 + 0.0007975271480356707i, 0.00016221650326681447 + 0.00017411015962981075i, 4.16431163310265e-05 + -5.1271332639633636e-05i }, { -0.00765434788953348 + 0.05487021751360159i, 0.08834840461695717 + -7.809748759836978e-20i, 0.0007280529966818968 + -0.0036519520826019843i, -0.005928297280198706 + -0.0003452705641913685i, 0.0007704933070100947 + -0.000609950372896514i, -0.0011331137285701853 + -0.0010825291106378158i, -5.408486215970496e-05 + 3.791736242895963e-05i, 7.180287664455883e-05 + 7.706743803927906e-05i }, { -0.013393163339130317 + 0.0007800325867352046i, 0.0007280529966818967 + 0.003651952082601985i, 0.1945296432532717 + 4.0019400285723055e-19i, -0.007460055939930471 + -0.053477435046732476i, 0.00018133191312730913 + 0.0001541015214072223i, 3.540955389027682e-05 + -5.575896503428793e-05i, -0.0024949427252230856 + -0.0023835631511023043i, -0.0005595776020318225 + 0.0007772833458608228i }, { 0.0002991811672388529 + -0.0037117793319064738i, -0.005928297280198707 + 0.0003452705641913685i, -0.007460055939930471 + 0.05347743504673248i, 0.08610583816648057 + 1.6964846794877034e-19i, -4.931742102046121e-05 + 4.393962530898435e-05i, 8.026404667709073e-05 + 6.821089290860845e-05i, 0.0007509357106040362 + -0.000594467872124215i, -0.0011043516604458882 + -0.0010550510426896062i }, { -0.002559921766953427 + 0.0024456413895711i, 0.0007704933070100947 + 0.0006099503728965135i, 0.0001813319131273091 + -0.00015410152140722235i, -4.931742102046123e-05 + -4.393962530898429e-05i, 0.1514470239896148 + -3.5149849136508277e-19i, -0.005807872013765782 + -0.041633749247567936i, -0.010162299866131343 + -0.0005918635389592732i, 0.0002270090089096037 + 0.0028163783008258005i }, { -0.000574151410074065 + -0.0007975271480356708i, -0.0011331137285701853 + 0.0010825291106378156i, 3.540955389027684e-05 + 5.575896503428791e-05i, 8.026404667709072e-05 + -6.821089290860849e-05i, -0.005807872013765782 + 0.041633749247567936i, 0.06703591658504493 + -1.715180375083357e-19i, 0.0005524231044879796 + -0.002770983315921697i, -0.004498200546911432 + -0.00026198015505490553i }, { 0.00016221650326681453 + -0.00017411015962981072i, -5.4084862159704956e-05 + -3.7917362428959656e-05i, -0.0024949427252230856 + 0.002383563151102304i, 0.0007509357106040362 + 0.0005944678721242146i, -0.010162299866131347 + 0.0005918635389592732i, 0.0005524231044879796 + 0.002770983315921698i, 0.1476028117879782 + 3.370545144459404e-19i, -0.005660449556244311 + -0.0405769508857305i }, { 4.164311633102646e-05 + 5.127133263963369e-05i, 7.180287664455885e-05 + -7.706743803927907e-05i, -0.0005595776020318224 + -0.0007772833458608232i, -0.0011043516604458885 + 0.0010550510426896062i, 0.00022700900890960398 + -0.002816378300825801i, -0.004498200546911434 + 0.00026198015505490575i, -0.005660449556244311 + 0.0405769508857305i, 0.06533432957662809 + 7.867728741882969e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.1995960320240251, 1.0e-7), DoubleNear(0.08834840461695717, 1.0e-7), DoubleNear(0.1945296432532717, 1.0e-7), DoubleNear(0.08610583816648057, 1.0e-7), DoubleNear(0.1514470239896148, 1.0e-7), DoubleNear(0.06703591658504493, 1.0e-7), DoubleNear(0.1476028117879782, 1.0e-7), DoubleNear(0.06533432957662809, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false, true}), Matrix({ { 0.13437173603319635 + -4.1443780600050203e-19i, -0.005153048403261062 + -0.036939644085380724i, -0.009964365664332658 + 0.0037692542804488435i, 0.0014183173916581225 + 0.002594719557240442i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005153048403261062 + 0.036939644085380724i, 0.05947777810890967 + -3.1458731517592445e-19i, -0.00065406651432461 + -0.0028838153198575646i, -0.004410587728306201 + 0.0016684079282358103i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009964365664332658 + -0.003769254280448844i, -0.00065406651432461 + 0.0028838153198575646i, 0.1588534152416355 + 4.994329652853131e-19i, -0.006091901183454585 + -0.043669813265816024i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001418317391658123 + -0.002594719557240442i, -0.0044105877283062015 + -0.0016684079282358103i, -0.006091901183454585 + 0.043669813265816024i, 0.07031425255420014 + 1.8284502409570586e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21667131998044353 + -6.3147584718586655e-21i, -0.008309171500038199 + -0.0595643226757888i, -0.013591097540929 + -0.005141150406143322i, -0.000892127215509666 + 0.003933438075491832i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008309171500038199 + 0.0595643226757888i, 0.09590654309309243 + 6.497179006921895e-20i, 0.0019345426154944864 + -0.003539120078666117i, -0.0060159100988039374 + -0.0022756586474820843i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.013591097540929006 + 0.005141150406143322i, 0.0019345426154944864 + 0.0035391200786661185i, 0.18327903979961446 + 2.378155520178578e-19i, -0.007028604312720198 + -0.05038457266664696i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.000892127215509666 + -0.0039334380754918324i, -0.006015910098803939 + 0.0022756586474820843i, -0.007028604312720197 + 0.05038457266664696i, 0.08112591518890852 + 6.548073127189418e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.13437173603319635, 1.0e-7), DoubleNear(0.05947777810890967, 1.0e-7), DoubleNear(0.1588534152416355, 1.0e-7), DoubleNear(0.07031425255420014, 1.0e-7), DoubleNear(0.21667131998044353, 1.0e-7), DoubleNear(0.09590654309309243, 1.0e-7), DoubleNear(0.18327903979961446, 1.0e-7), DoubleNear(0.08112591518890852, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true, false}), Matrix({ { 0.19029630126633137 + 1.489244488919582e-19i, -0.007297710666956759 + -0.05231366243423426i, -0.01910090288075692 + -0.01980054313579392i, -0.004710790808615775 + 0.006010294539282195i, -0.0024406479369478247 + -0.002331692198185644i, -0.0005474001090903047 + 0.0007603681540743559i, 2.3637204569814922e-06 + 0.0004879946712690761i, 0.00013406218925284298 + -1.9364006381062443e-05i }, { -0.007297710666956759 + 0.05231366243423426i, 0.08423200827641975 + -2.6133513071923396e-20i, 0.006175799448025072 + -0.00449162461357107i, -0.008454748719930408 + -0.008764434737791121i, 0.0007345938944158781 + -0.0005815310992968779i, -0.001080318828357536 + -0.0010320910875758864i, -0.00013424348282374085 + -1.8064402833830416e-05i, 1.0462679504052126e-06 + 0.00021600404692919846i }, { -0.01910090288075692 + 0.01980054313579392i, 0.006175799448025072 + 0.0044916246135710694i, 0.20382937401096543 + 1.8201548085799442e-19i, -0.007816693162507191 + -0.05603399012609981i, 0.0004875940863898742 + -1.9909627797529655e-05i, -2.4172125693319893e-05 + -0.00013327919443730614i, -0.002614216555228688 + -0.0024975123424877603i, -0.0005863289030155832 + 0.0008144423398221376i }, { -0.004710790808615776 + -0.0060102945392821955i, -0.008454748719930407 + 0.008764434737791121i, -0.007816693162507191 + 0.05603399012609981i, 0.090222234507018 + 1.1768449342232395e-19i, -1.3225559303324647e-05 + 0.00013480623098175085i, 0.00021582673360972884 + -8.812719544532044e-06i, 0.0007868351231982528 + -0.0006228871457238509i, -0.0011571465606585376 + -0.0011054890657515354i }, { -0.0024406479369478247 + 0.002331692198185644i, 0.0007345938944158782 + 0.0005815310992968774i, 0.0004875940863898743 + 1.9909627797529642e-05i, -1.3225559303324679e-05 + -0.00013480623098175088i, 0.14439068858617415 + 5.440455129920026e-21i, -0.005537267205366259 + -0.039693917806484416i, -0.014493148322994198 + -0.015024012756591425i, -0.0035743959504997316 + 0.004560417419349082i }, { -0.0005474001090903045 + -0.0007603681540743563i, -0.001080318828357536 + 0.0010320910875758864i, -2.417212569331992e-05 + 0.0001332791944373062i, 0.00021582673360972886 + 8.812719544532027e-06i, -0.005537267205366259 + 0.039693917806484416i, 0.06391252796346605 + -2.6765517080334734e-20i, 0.004685997199821695 + -0.0034080997187457213i, -0.006415190318309233 + -0.006650170068660955i }, { 2.363720456981404e-06 + -0.00048799467126907603i, -0.00013424348282374085 + 1.8064402833830483e-05i, -0.002614216555228688 + 0.00249751234248776i, 0.0007868351231982526 + 0.0006228871457238508i, -0.014493148322994198 + 0.015024012756591425i, 0.004685997199821695 + 0.0034080997187457213i, 0.15465914719141885 + -1.988443204906241e-20i, -0.005931054364643834 + -0.04251678232681402i }, { 0.000134062189252843 + 1.9364006381062453e-05i, 1.046267950405199e-06 + -0.00021600404692919846i, -0.000586328903015583 + -0.0008144423398221376i, -0.0011571465606585376 + 0.0011054890657515354i, -0.003574395950499732 + -0.004560417419349082i, -0.006415190318309233 + 0.006650170068660955i, -0.005931054364643834 + 0.042516782326814016i, 0.06845771819820698 + -6.60752330091713e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.19029630126633137, 1.0e-7), DoubleNear(0.08423200827641975, 1.0e-7), DoubleNear(0.20382937401096543, 1.0e-7), DoubleNear(0.090222234507018, 1.0e-7), DoubleNear(0.14439068858617415, 1.0e-7), DoubleNear(0.06391252796346605, 1.0e-7), DoubleNear(0.15465914719141885, 1.0e-7), DoubleNear(0.06845771819820698, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false, true}), Matrix({ { 0.1420788417325883 + 9.547904507350456e-20i, -0.0054486097310406205 + -0.0390583764160668i, -0.014552478074954238 + -0.014993182026677718i, -0.0035636451384900435 + 0.00457554521137986i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0054486097310406205 + 0.0390583764160668i, 0.06288922114137224 + -6.932395111038062e-20i, 0.004679796884704121 + -0.0034255921783508457i, -0.006441451806971285 + -0.0066365232753182665i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014552478074954238 + 0.01499318202667772i, 0.004679796884704121 + 0.0034255921783508453i, 0.1511463095422435 + -1.04838857886935e-20i, -0.005796339855675027 + -0.04155108093512995i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0035636451384900435 + -0.00457554521137986i, -0.006441451806971284 + 0.0066365232753182665i, -0.005796339855675027 + 0.04155108093512995i, 0.06690280952173758 + -6.241833996983798e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19260814811991722 + 5.888585894837366e-20i, -0.007386368141282397 + -0.05294920382465188i, -0.019041573128796882 + -0.019831373865707626i, -0.0047215416206254635 + 0.005995166747251418i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.007386368141282396 + 0.05294920382465189i, 0.08525531509851356 + 1.6424920958122486e-20i, 0.006181999763142646 + -0.0044741321539659455i, -0.008428487231268357 + -0.008778081531133809i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.019041573128796882 + 0.019831373865707623i, 0.006181999763142646 + 0.0044741321539659455i, 0.20734221166014077 + 1.726149345976255e-19i, -0.007951407671476 + -0.056999691517783876i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.004721541620625464 + -0.005995166747251418i, -0.008428487231268355 + 0.008778081531133809i, -0.007951407671476 + 0.056999691517783876i, 0.09177714318348741 + 1.1402760038299064e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1420788417325883, 1.0e-7), DoubleNear(0.06288922114137224, 1.0e-7), DoubleNear(0.1511463095422435, 1.0e-7), DoubleNear(0.06690280952173758, 1.0e-7), DoubleNear(0.19260814811991722, 1.0e-7), DoubleNear(0.08525531509851356, 1.0e-7), DoubleNear(0.20734221166014077, 1.0e-7), DoubleNear(0.09177714318348741, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true, true}), Matrix({ { 0.16672193248519027 + 1.337904963110545e-19i, -0.00639365251461187 + -0.0458329186556637i, -0.0021382945325586727 + -0.002042836495797574i, -0.00047958685178231883 + 0.0006661718972143925i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00639365251461187 + 0.0458329186556637i, 0.07379714215936728 + 4.0434247360919844e-20i, 0.0006435906155497404 + -0.0005094896118833098i, -0.0009464863035452595 + -0.0009042331326270386i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0021382945325586723 + 0.002042836495797574i, 0.0006435906155497402 + 0.0005094896118833097i, 0.12650321878964155 + -4.879533702624346e-20i, -0.004851297072103777 + -0.034776538695533044i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00047958685178231867 + -0.0006661718972143925i, -0.0009464863035452594 + 0.0009042331326270386i, -0.004851297072103777 + 0.034776538695533044i, 0.055994888503742526 + -1.7217653844113844e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.22740374279210654 + 1.9714943343889808e-19i, -0.00872075131485208 + -0.06251473390467037i, -0.00291656995961784 + -0.0027863680448758305i, -0.000654142160323569 + 0.000908638596682101i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00872075131485208 + 0.06251473390467037i, 0.10065710062407046 + 5.1116732989480704e-20i, 0.0008778384020643905 + -0.000694928633137419i, -0.001290979085470814 + -0.0012333470207003833i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002916569959617841 + 0.00278636804487583i, 0.0008778384020643907 + 0.0006949286331374185i, 0.17254661698795143 + 3.435136010710107e-20i, -0.006617024497906316 + -0.047434161437765396i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0006541421603235688 + -0.0009086385966821014i, -0.0012909790854708143 + 0.0012333470207003833i, -0.006617024497906316 + 0.047434161437765396i, 0.0763753576579305 + 7.933578835163241e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.16672193248519027, 1.0e-7), DoubleNear(0.07379714215936728, 1.0e-7), DoubleNear(0.12650321878964155, 1.0e-7), DoubleNear(0.055994888503742526, 1.0e-7), DoubleNear(0.22740374279210654, 1.0e-7), DoubleNear(0.10065710062407046, 1.0e-7), DoubleNear(0.17254661698795143, 1.0e-7), DoubleNear(0.0763753576579305, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false, false}), Matrix({ { 0.12434953244531985 + -2.407124178813205e-19i, 0.0037964884751337923 + -3.1182493453769505e-05i, -0.008111216873263136 + -0.0035376645789563566i, -0.0022012798782584672 + -0.0017861582015725281i, -0.008793355288524403 + -0.0005411450835027499i, -0.005832499607685951 + 0.0026170025193671693i, 0.003369993258778462 + 0.0008851963548153249i, 0.0007866106379809995 + -0.0005792896196626556i }, { 0.0037964884751337906 + 3.118249345376953e-05i, 0.12457997385922849 + -1.7372757019253885e-19i, -0.001955730561977599 + -0.00199219007267793i, -0.006966556075102719 + -0.0034873032834226115i, -0.006248004537833366 + 0.0021881652365129574i, -0.007823083604799781 + -0.000493526996857848i, 0.0005170384841574887 + 0.0007770949627793203i, -0.002188835269829141 + -0.0002195611224887043i }, { -0.008111216873263136 + 0.003537664578956357i, -0.001955730561977599 + 0.0019921900726779305i, 0.12887319252171306 + -1.5170483902059035e-19i, 0.005838050756264698 + -8.586269342963476e-05i, 0.003374881999522025 + -0.0007743978640531666i, -0.00035849904510707256 + -0.0008838781047457589i, -0.009907486668736643 + -0.0004481417462315479i, -0.006159751856209934 + 0.0026748333669127274i }, { -0.002201279878258467 + 0.0017861582015725277i, -0.00696655607510272 + 0.003487303283422612i, 0.005838050756264701 + 8.586269342963497e-05i, 0.12862467838938058 + -1.0422326248461645e-19i, 0.000999713861460071 + 3.5481435041823063e-06i, -0.0021955789483285113 + 0.00023057650601518922i, -0.006587456804877275 + 0.0022248185052855477i, -0.00745803547031097 + -0.0004963330183486068i }, { -0.008793355288524405 + 0.0005411450835027501i, -0.006248004537833367 + -0.0021881652365129556i, 0.0033748819995220248 + 0.0007743978640531671i, 0.0009997138614600705 + -3.5481435041826315e-06i, 0.12184468940554191 + 3.0646711835144917e-19i, -0.005138033276897339 + -9.418885562648211e-05i, -0.008604445074732313 + -0.0034925364738052846i, -0.0015600899852576506 + -0.0010259846175098546i }, { -0.005832499607685951 + -0.0026170025193671727i, -0.007823083604799783 + 0.0004935269968578473i, -0.00035849904510707213 + 0.000883878104745759i, -0.002195578948328511 + -0.0002305765060151891i, -0.005138033276897335 + 9.418885562648203e-05i, 0.1209492272129598 + 1.1859881595295718e-19i, -0.0013004668118331265 + -0.0013632639478335046i, -0.005984915959322897 + -0.002806952406027096i }, { 0.003369993258778462 + -0.0008851963548153254i, 0.000517038484157489 + -0.0007770949627793203i, -0.009907486668736644 + 0.0004481417462315479i, -0.006587456804877276 + -0.0022248185052855477i, -0.008604445074732313 + 0.003492536473805284i, -0.0013004668118331265 + 0.0013632639478335046i, 0.12609274270668305 + 1.950570690498454e-19i, -0.0033925650626593206 + -1.905622993841055e-05i }, { 0.0007866106379809995 + 0.0005792896196626554i, -0.002188835269829141 + 0.00021956112248870414i, -0.006159751856209934 + -0.0026748333669127282i, -0.007458035470310973 + 0.0004963330183486068i, -0.0015600899852576508 + 0.0010259846175098544i, -0.005984915959322895 + 0.0028069524060270953i, -0.0033925650626593154 + 1.9056229938410382e-05i, 0.12468596345917382 + 3.6545126931651917e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.12434953244531985, 1.0e-7), DoubleNear(0.12457997385922849, 1.0e-7), DoubleNear(0.12887319252171306, 1.0e-7), DoubleNear(0.12862467838938058, 1.0e-7), DoubleNear(0.12184468940554191, 1.0e-7), DoubleNear(0.1209492272129598, 1.0e-7), DoubleNear(0.12609274270668305, 1.0e-7), DoubleNear(0.12468596345917382, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false, false}), Matrix({ { 0.10283454185505901 + 1.8627028485368455e-20i, -0.0018089424078953117 + 1.3656049926110676e-05i, -0.0033005447623018283 + -0.0023283136464361297i, 0.0015996896606324336 + 0.001659737530519111i, -0.017723431266401787 + -0.009583866094269984i, 0.0008936591574469066 + 0.0011888312409884284i, 0.005315408109677103 + 0.028480908898539256i, -0.0004427489254569387 + 0.0012128206976527909i }, { -0.0018089424078953109 + -1.3656049926110686e-05i, 0.10287549849706004 + 2.116220136187443e-20i, 0.001695999696281732 + 0.0014152473745232142i, -0.0005608024390106343 + -0.003539100115616548i, 0.0008987503711833628 + 0.0011629614570329491i, -0.01785804469303603 + -0.009765990165282075i, -0.00022586405802331344 + 0.0015123043849645849i, 0.002515007834283116 + 0.028962713358583553i }, { -0.0033005447623018287 + 0.0023283136464361297i, 0.0016959996962817325 + -0.001415247374523214i, 0.1396454375557189 + -2.2833975708694677e-21i, 0.001157253864191023 + -0.0002671504067967742i, -0.022685296407248232 + 0.014385825944351095i, 0.0017581644027584815 + 0.0005811697877935278i, -0.006384930660317772 + -0.015369281258541943i, 0.0009377015109283229 + -0.00221759528950385i }, { 0.0015996896606324336 + -0.0016597375305191112i, -0.0005608024390106343 + 0.0035391001156165475i, 0.0011572538641910243 + 0.00026715040679677407i, 0.13747604818455336 + 6.396004159324668e-20i, 0.0021571323304560588 + 0.0003855695133548051i, -0.020746435764251406 + 0.013472839825632632i, 0.0008022475335031478 + -0.002176856171970048i, -0.006497583622235168 + -0.015520023180743418i }, { -0.017723431266401787 + 0.009583866094269984i, 0.0008987503711833629 + -0.0011629614570329491i, -0.022685296407248232 + -0.014385825944351095i, 0.0021571323304560583 + -0.00038556951335480473i, 0.14335967999580276 + 4.7127671984760253e-20i, 0.0004673976061317633 + -0.0001390273990063623i, -0.01341511718569362 + -0.0047018874063255115i, -0.005361059524148552 + -0.004471880349601493i }, { 0.0008936591574469067 + -0.0011888312409884282i, -0.017858044693036028 + 0.009765990165282075i, 0.0017581644027584815 + -0.0005811697877935277i, -0.020746435764251406 + -0.013472839825632632i, 0.0004673976061317646 + 0.00013902739900636225i, 0.14265370257512824 + -7.629095560145612e-20i, -0.004952197070092458 + -0.004770701395034648i, -0.012390669595414981 + -0.0027551555738331594i }, { 0.005315408109677104 + -0.028480908898539256i, -0.00022586405802331333 + -0.0015123043849645838i, -0.006384930660317773 + 0.015369281258541943i, 0.0008022475335031478 + 0.002176856171970048i, -0.01341511718569362 + 0.004701887406325511i, -0.004952197070092458 + 0.0047707013950346495i, 0.11532049767267724 + 4.563562760012451e-20i, 0.001288231829414357 + 0.00016223148342872886i }, { -0.0004427489254569388 + -0.0012128206976527913i, 0.002515007834283116 + -0.028962713358583553i, 0.0009377015109283227 + 0.0022175952895038503i, -0.006497583622235168 + 0.01552002318074342i, -0.0053610595241485514 + 0.004471880349601493i, -0.012390669595414981 + 0.00275515557383316i, 0.0012882318294143613 + -0.00016223148342872873i, 0.11583459366400103 + 1.9726796523865602e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.10283454185505901, 1.0e-7), DoubleNear(0.10287549849706004, 1.0e-7), DoubleNear(0.1396454375557189, 1.0e-7), DoubleNear(0.13747604818455336, 1.0e-7), DoubleNear(0.14335967999580276, 1.0e-7), DoubleNear(0.14265370257512824, 1.0e-7), DoubleNear(0.11532049767267724, 1.0e-7), DoubleNear(0.11583459366400103, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true, false}), Matrix({ { 0.1399810904869892 + 8.041074900690688e-20i, -0.0007627754334615226 + -7.128363138721318e-05i, -0.009504189700722185 + -0.003997231138529702i, -0.0021386393687941097 + -0.0015989279336489433i, -0.001795329480579996 + -0.001715182136542026i, 8.909552049020421e-06 + 1.0260503026385994e-05i, 7.29182240171527e-05 + 0.00016772096301723199i, 7.837556300608341e-06 + 4.67117271033957e-05i }, { -0.00076277543346152 + 7.128363138721314e-05i, 0.13960297302714236 + 3.901423597701892e-20i, -0.0018514084359908803 + -0.0019078437720389527i, -0.007363946908099608 + -0.003578787384160625i, 1.0656422440697726e-05 + 8.432004556099255e-06i, -0.00179047992968406 + -0.0017105490799599718i, 3.6853969657821174e-07 + 4.715430364325355e-05i, 5.05956823246862e-05 + 0.00013612990597825647i }, { -0.009504189700722185 + 0.003997231138529702i, -0.0018514084359908803 + 0.001907843772038953i, 0.14496851056043994 + 9.979288544575582e-20i, 0.0013904540552888449 + -5.9654792851623664e-05i, 0.00017087401819740913 + 6.518787260154148e-05i, 4.712199111962334e-05 + -1.7838515942330488e-06i, -0.0018592957081522454 + -0.0017762927750407953i, -1.8564235946939192e-05 + -1.6272068899628505e-05i }, { -0.0021386393687941093 + 0.0015989279336489429i, -0.0073639469080996065 + 0.003578787384160625i, 0.0013904540552888475 + 5.965479285162369e-05i, 0.14402734398616307 + 2.0327303967067154e-19i, 4.702074339926336e-05 + 5.697580883844393e-06i, 0.00013829713071945784 + 4.4330328290175654e-05i, -1.710234084807596e-05 + -1.7802275699587295e-05i, -0.001847224762776285 + -0.001764760702458033i }, { -0.0017953294805799964 + 0.001715182136542026i, 1.0656422440697563e-05 + -8.43200455609937e-06i, 0.00017087401819740921 + -6.518787260154142e-05i, 4.702074339926326e-05 + -5.697580883844447e-06i, 0.10621313136387256 + -1.4656048536778176e-20i, -0.0005787693683020258 + -5.4087717693038434e-05i, -0.007211472247273263 + -0.0030329699142319392i, -0.0016227304947220083 + -0.0012132148854334395i }, { 8.909552049020557e-06 + -1.0260503026385967e-05i, -0.00179047992968406 + 0.0017105490799599718i, 4.712199111962338e-05 + 1.7838515942330962e-06i, 0.00013829713071945784 + -4.433032829017566e-05i, -0.0005787693683020263 + 5.408771769303842e-05i, 0.10592622804504592 + -9.414299021660061e-20i, -0.0014047889378198453 + -0.001447610248472482i, -0.005587525126326008 + -0.0027154683052890826i }, { 7.29182240171527e-05 + -0.00016772096301723204i, 3.6853969657815033e-07 + -4.715430364325353e-05i, -0.0018592957081522456 + 0.001776292775040795i, -1.710234084807604e-05 + 1.780227569958716e-05i, -0.007211472247273263 + 0.0030329699142319392i, -0.0014047889378198451 + 0.001447610248472482i, 0.10999742466795617 + -5.644065541650078e-20i, 0.0010550316383165352 + -4.5264130516421644e-05i }, { 7.83755630060844e-06 + -4.671172710339566e-05i, 5.0595682324686145e-05 + -0.00013612990597825658i, -1.856423594693903e-05 + 1.6272068899628566e-05i, -0.0018472247627762848 + 0.001764760702458033i, -0.0016227304947220083 + 0.0012132148854334392i, -0.005587525126326008 + 0.002715468305289082i, 0.0010550316383165382 + 4.526413051642165e-05i, 0.10928329786239134 + 5.795496716123116e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1399810904869892, 1.0e-7), DoubleNear(0.13960297302714236, 1.0e-7), DoubleNear(0.14496851056043994, 1.0e-7), DoubleNear(0.14402734398616307, 1.0e-7), DoubleNear(0.10621313136387256, 1.0e-7), DoubleNear(0.10592622804504592, 1.0e-7), DoubleNear(0.10999742466795617, 1.0e-7), DoubleNear(0.10928329786239134, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false, true}), Matrix({ { 0.1039933002266728 + -7.641367066665015e-22i, -0.0004862462288583143 + -3.308611605705768e-05i, -0.006875589556306806 + -0.0020900417336746344i, -0.0018298018820284217 + -0.0011556163534846577i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.000486246228858313 + 3.308611605705757e-05i, 0.10384513019215608 + -6.854042387190645e-20i, -0.001601063358363871 + -0.0013553901558510536i, -0.005236113980870885 + -0.0018280009869896961i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006875589556306806 + 0.002090041733674634i, -0.001601063358363871 + 0.0013553901558510538i, 0.10790392675394894 + 8.11013719010926e-21i, 0.0009532321939513034 + -4.405782816089768e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0018298018820284217 + 0.0011556163534846575i, -0.005236113980870885 + 0.0018280009869896952i, 0.0009532321939513051 + 4.405782816089766e-05i, 0.10727482476516381 + 1.4447291593056172e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.14220092162418896 + 6.651883717679522e-20i, -0.0008552985729052341 + -9.228523302319394e-05i, -0.009840072391688642 + -0.004940159319087006i, -0.0019315679814876966 + -0.001656526465597725i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0008552985729052332 + 9.2285233023194e-05i, 0.1416840708800322 + 1.341166963232475e-20i, -0.0016551340154468547 + -0.0020000638646603813i, -0.00771535805355473 + -0.004466254702460011i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.009840072391688642 + 0.004940159319087006i, -0.0016551340154468545 + 0.0020000638646603813i, 0.14706200847444717 + 3.524209283914578e-20i, 0.0014922534996540766 + -6.0861095207147625e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0019315679814876962 + 0.0016565264655977246i, -0.007715358053554729 + 0.004466254702460012i, 0.0014922534996540805 + 6.086109520714768e-05i, 0.14603581708339058 + 2.467807152388465e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1039933002266728, 1.0e-7), DoubleNear(0.10384513019215608, 1.0e-7), DoubleNear(0.10790392675394894, 1.0e-7), DoubleNear(0.10727482476516381, 1.0e-7), DoubleNear(0.14220092162418896, 1.0e-7), DoubleNear(0.1416840708800322, 1.0e-7), DoubleNear(0.14706200847444717, 1.0e-7), DoubleNear(0.14603581708339058, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false, false}), Matrix({ { 0.12252426046569945 + -1.3301717778895128e-19i, 0.003980249737255959 + -0.00012789701500139317i, -0.009739414209177427 + -0.0004591496038439389i, -0.005765995834551325 + 0.0027615767381631764i, -0.012181963695820003 + -0.012670674106395332i, 0.0005121631548206586 + -0.0009053433879463221i, 0.0005664737438334447 + 0.0006424961526867789i, 0.0006211914968134184 + 0.0005015855702937978i }, { 0.003980249737255959 + 0.00012789701500139333i, 0.12196826274752365 + -2.1970602883120033e-19i, -0.006141218853736412 + 0.0018294787325938509i, -0.006609498301285239 + -0.00045985403968554477i, 0.0004703165709416884 + -0.0009498339795240346i, -0.012376176324315674 + -0.012769733506262572i, 0.000895288646766501 + 0.0004092203255649571i, 0.0009163775726946223 + 0.0011659464637804604i }, { -0.00973941420917743 + 0.0004591496038439389i, -0.0061412188537364135 + -0.0018294787325938509i, 0.11995571894507845 + 1.4936080870345028e-19i, -0.00463193828096025 + -0.0001255973418692703i, 0.0006230796439353603 + 0.0006272931659991653i, 0.00023669803662786874 + 0.0008539453487879428i, -0.011926398230899561 + -0.012282473246416594i, 0.0013191975135545706 + -0.00012342066056909916i }, { -0.005765995834551325 + -0.0027615767381631755i, -0.006609498301285242 + 0.00045985403968554434i, -0.0046319382809602485 + 0.00012559734186927006i, 0.11838328393408976 + 3.0482827178632145e-19i, 0.0004063744035072387 + 0.0008609729167512319i, 0.001007703090115371 + 0.001074346421604375i, 0.001230681333744822 + -6.406073541306433e-05i, -0.011979451990955525 + -0.012516279839762924i }, { -0.012181963695820003 + 0.012670674106395332i, 0.00047031657094168816 + 0.0009498339795240348i, 0.0006230796439353602 + -0.0006272931659991653i, 0.00040637440350723916 + -0.0008609729167512318i, 0.13069846450133343 + -2.5940007911295953e-19i, 0.005654289494142529 + 1.0851828117988945e-05i, -0.008961427748083617 + -0.0005301372258903593i, -0.006226255629344559 + 0.002530259148116723i }, { 0.0005121631548206588 + 0.0009053433879463221i, -0.012376176324315674 + 0.012769733506262572i, 0.00023669803662786863 + -0.0008539453487879428i, 0.0010077030901153709 + -0.001074346421604375i, 0.005654289494142532 + -1.085182811798883e-05i, 0.13123638950108543 + -5.8244803845955e-20i, -0.00669424248897423 + 0.0025835050092046542i, -0.008671620773825512 + -0.0005300059755209098i }, { 0.0005664737438334448 + -0.0006424961526867789i, 0.000895288646766501 + -0.000409220325564957i, -0.011926398230899561 + 0.012282473246416594i, 0.0012306813337448223 + 6.406073541306411e-05i, -0.008961427748083619 + 0.0005301372258903593i, -0.0066942424889742305 + -0.0025835050092046542i, 0.12798171316714652 + 3.5216337869784434e-19i, -0.003898660058596407 + 1.2352256304377627e-05i }, { 0.0006211914968134185 + -0.0005015855702937977i, 0.0009163775726946224 + -0.0011659464637804606i, 0.0013191975135545709 + 0.0001234206605690996i, -0.011979451990955525 + 0.012516279839762924i, -0.006226255629344559 + -0.0025302591481167255i, -0.008671620773825515 + 0.0005300059755209098i, -0.003898660058596407 + -1.2352256304377639e-05i, 0.12725190673804387 + 1.792218134831549e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.12252426046569945, 1.0e-7), DoubleNear(0.12196826274752365, 1.0e-7), DoubleNear(0.11995571894507845, 1.0e-7), DoubleNear(0.11838328393408976, 1.0e-7), DoubleNear(0.13069846450133343, 1.0e-7), DoubleNear(0.13123638950108543, 1.0e-7), DoubleNear(0.12798171316714652, 1.0e-7), DoubleNear(0.12725190673804387, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true, false}), Matrix({ { 0.14397735621287142 + -9.498629004295139e-20i, 0.005478005526741481 + -6.654954276756934e-05i, -0.010632923187726224 + -0.0005624886245888909i, -0.006818553354705643 + 0.003008831614611877i, -0.0018465836438741048 + -0.0017641482044735046i, -7.107366694513519e-05 + -6.626822833729774e-05i, 0.000129480560265025 + 0.00013749894542231647i, 0.00012431853494864262 + 4.495762098539273e-05i }, { 0.005478005526741481 + 6.654954276756944e-05i, 0.14396708042811085 + -5.2365270662696306e-20i, -0.007297985558510139 + 0.0025091339343151463i, -0.008688537431602795 + -0.0005628145263376827i, -6.944280971216347e-05 + -6.797529256481706e-05i, -0.0018464518516495072 + -0.0017640222957354108i, 0.00012434472587557742 + 5.7240962417301385e-05i, 0.00010453881964634832 + 0.00011367865224677336i }, { -0.010632923187726226 + 0.0005624886245888909i, -0.00729798555851014 + -0.0025091339343151463i, 0.14097224483455773 + 2.7518992449561405e-19i, -0.0048503269049141595 + -6.438888147126751e-05i, 0.00014326485695176393 + 0.000123070533603233i, 6.28561107011046e-05 + 0.00012160282882836996i, -0.0018080415448581365 + -0.0017273267071093164i, 6.141898304721637e-05 + 6.025666246405525e-05i }, { -0.006818553354705642 + -0.003008831614611878i, -0.008688537431602797 + 0.0005628145263376824i, -0.0048503269049141595 + 6.438888147126739e-05i, 0.13966323658519458 + 2.9465254631038676e-19i, 5.058437243724435e-05 + 0.00012213724690516488i, 0.00011833110285263593 + 9.924188071259775e-05i, 6.299689130478519e-05 + 5.8605021421329e-05i, -0.0017912528408108375 + -0.001711287486682594i }, { -0.0018465836438741052 + 0.0017641482044735049i, -6.944280971216363e-05 + 6.797529256481695e-05i, 0.000143264856951764 + -0.00012307053360323297i, 5.058437243724442e-05 + -0.00012213724690516488i, 0.10924536875416148 + -2.9743096685895943e-19i, 0.004156533704657007 + -5.049564411583491e-05i, -0.008067918769534818 + -0.0004267982051454071i, -0.005173698109190243 + 0.0022830042716680213i }, { -7.107366694513508e-05 + 6.62682283372978e-05i, -0.0018464518516495075 + 0.0017640222957354108i, 6.28561107011048e-05 + -0.00012160282882837i, 0.00011833110285263583 + -9.924188071259784e-05i, 0.0041565337046570085 + 5.049564411583505e-05i, 0.10923757182049823 + -2.2558556201445905e-19i, -0.005537475784200503 + 0.001903849807483358i, -0.006592581643507957 + -0.00042704548886877166i }, { 0.00012948056026502498 + -0.00013749894542231647i, 0.00012434472587557723 + -5.7240962417301494e-05i, -0.0018080415448581367 + 0.0017273267071093164i, 6.299689130478511e-05 + -5.860502142132919e-05i, -0.00806791876953482 + 0.0004267982051454071i, -0.005537475784200504 + -0.0019038498074833588i, 0.10696518727766724 + 2.2633426290568048e-19i, -0.003680271434642498 + -4.885620409362516e-05i }, { 0.0001243185349486425 + -4.495762098539265e-05i, 0.0001045388196463484 + -0.00011367865224677336i, 6.141898304721664e-05 + -6.02566624640552e-05i, -0.0017912528408108373 + 0.001711287486682594i, -0.005173698109190243 + -0.002283004271668023i, -0.006592581643507961 + 0.00042704548886877123i, -0.003680271434642496 + 4.8856204093625024e-05i, 0.10597195408693906 + 1.893975389590896e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.14397735621287142, 1.0e-7), DoubleNear(0.14396708042811085, 1.0e-7), DoubleNear(0.14097224483455773, 1.0e-7), DoubleNear(0.13966323658519458, 1.0e-7), DoubleNear(0.10924536875416148, 1.0e-7), DoubleNear(0.10923757182049823, 1.0e-7), DoubleNear(0.10696518727766724, 1.0e-7), DoubleNear(0.10597195408693906, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false, true}), Matrix({ { 0.09769869434388724 + -3.585359390117388e-19i, -0.024720663991110878 + -3.6643382578877617e-05i, -0.007760255799094375 + 0.0027185402069667694i, -0.0056792120227000895 + -0.01318468726165727i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.024720663991110878 + 3.6643382578877556e-05i, 0.09615081979821877 + -3.704891821646876e-19i, -0.004823337082715141 + -0.013479090147584308i, -0.006614697593544482 + 0.002719122001717884i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007760255799094376 + -0.0027185402069667694i, -0.004823337082715142 + 0.013479090147584308i, 0.11419853263673452 + 3.6588193949518154e-19i, 0.025187649956203866 + -4.050056163907774e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0056792120227000895 + 0.013184687261657266i, -0.006614697593544484 + -0.0027191220017178845i, 0.025187649956203866 + 4.050056163907768e-05i, 0.11496913515910111 + 3.1639604988583737e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15552403062314565 + -3.3881317890172014e-20i, 0.034355203222509366 + -8.040180430452662e-05i, -0.010940586158166668 + -0.0037078270367010674i, -0.006313039441195796 + 0.018476523147937168i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.034355203222509366 + 8.040180430452694e-05i, 0.15705383245039028 + 9.25383494875323e-20i, -0.008012124259995501 + 0.017892073889382812i, -0.008666421481566268 + -0.0037089820169243382i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.010940586158166671 + 0.0037078270367010674i, -0.008012124259995503 + -0.017892073889382812i, 0.13373889947549045 + 1.3564224790611298e-19i, -0.03371824829576052 + -7.274452392581493e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.006313039441195795 + -0.018476523147937168i, -0.008666421481566274 + 0.0037089820169243382i, -0.03371824829576052 + 7.274452392581473e-05i, 0.1306660555130325 + 1.6765403538363898e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.09769869434388724, 1.0e-7), DoubleNear(0.09615081979821877, 1.0e-7), DoubleNear(0.11419853263673452, 1.0e-7), DoubleNear(0.11496913515910111, 1.0e-7), DoubleNear(0.15552403062314565, 1.0e-7), DoubleNear(0.15705383245039028, 1.0e-7), DoubleNear(0.13373889947549045, 1.0e-7), DoubleNear(0.1306660555130325, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true, false}), Matrix({ { 0.1378692468247486 + 8.934284497705881e-20i, -0.0003705370187805047 + -0.00014413180065838034i, -0.013707530448872733 + -0.014187858477219234i, 0.0010412748987644394 + -0.0005849345784087274i, -0.001768243999448178 + -0.001689305809160642i, 2.9862872350234197e-06 + 6.388738244856394e-06i, 1.962923020105427e-06 + 0.00034992434893921394i, -2.0522063752169035e-05 + -5.256608661946011e-06i }, { -0.0003705370187805047 + 0.00014413180065838034i, 0.1366590627180025 + 3.344809084297598e-20i, 0.0009671532492681367 + -0.0005764801739411472i, -0.013848121151814597 + -0.014377119396365809i, 6.518368445947967e-06 + 2.6916092982130307e-06i, -0.001752722765857183 + -0.0016744774766008885i, -1.9467824029543516e-05 + -4.456831440778435e-06i, 1.4470653872812776e-06 + 0.0003540743692590605i }, { -0.013707530448872733 + 0.014187858477219234i, 0.0009671532492681367 + 0.0005764801739411472i, 0.1470803542226805 + 9.086078947560386e-20i, 0.0009982156406078265 + 1.3193376419543519e-05i, 0.00034964933310953984 + -1.4008815202210032e-05i, -5.340651666839306e-06 + -1.92441408930165e-05i, -0.0018863811892840636 + -0.0018021691024221794i, -1.2640971132942211e-05 + -1.2400304118098912e-05i }, { 0.0010412748987644394 + 0.0005849345784087277i, -0.013848121151814595 + 0.014377119396365809i, 0.0009982156406078283 + -1.3193376419543478e-05i, 0.14697125429530294 + 2.0883918480471447e-19i, -6.187708498297967e-06 + -2.0260782285317314e-05i, 0.0003537714868900632 + -1.4713532139851667e-05i, -1.2964286853326228e-05 + -1.2061880441701091e-05i, -0.0018849819266031618 + -0.0018008323058171162i }, { -0.001768243999448178 + 0.0016893058091606418i, 6.51836844594775e-06 + -2.691609298213261e-06i, 0.0003496493331095399 + 1.4008815202210009e-05i, -6.187708498297943e-06 + 2.0260782285317338e-05i, 0.10461073258602928 + -7.299921406255984e-20i, -0.0002811515249237853 + -0.00010936255621228311i, -0.010400831477846829 + -0.010765288875592693i, 0.0007900857696107899 + -0.000443829470106694i }, { 2.986287235023677e-06 + -6.388738244856299e-06i, -0.0017527227658571828 + 0.0016744774766008887i, -5.340651666839302e-06 + 1.924414089301646e-05i, 0.0003537714868900632 + 1.471353213985166e-05i, -0.0002811515249237836 + 0.00010936255621228305i, 0.10369248396361092 + 5.1674152112145145e-20i, 0.0007338446554183738 + -0.0004374145409959517i, -0.010507507163456602 + -0.010908893949659687i }, { 1.9629230201053154e-06 + -0.00034992434893921405i, -1.9467824029543492e-05 + 4.456831440778418e-06i, -0.0018863811892840638 + 0.0018021691024221794i, -1.2964286853326242e-05 + 1.2061880441701037e-05i, -0.010400831477846827 + 0.010765288875592693i, 0.0007338446554183738 + 0.00043741454099595166i, 0.11159982344579945 + 1.902510109280882e-21i, 0.0007574137949382951 + 1.001070800282305e-05i }, { -2.052206375216907e-05 + 5.256608661946008e-06i, 1.4470653872812878e-06 + -0.0003540743692590605i, -1.264097113294213e-05 + 1.2400304118098912e-05i, -0.0018849819266031622 + 0.0018008323058171162i, 0.0007900857696107901 + 0.0004438294701066941i, -0.010507507163456602 + 0.010908893949659687i, 0.0007574137949382959 + -1.0010708002822987e-05i, 0.11151704194382636 + -8.786217516751459e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1378692468247486, 1.0e-7), DoubleNear(0.1366590627180025, 1.0e-7), DoubleNear(0.1470803542226805, 1.0e-7), DoubleNear(0.14697125429530294, 1.0e-7), DoubleNear(0.10461073258602928, 1.0e-7), DoubleNear(0.10369248396361092, 1.0e-7), DoubleNear(0.11159982344579945, 1.0e-7), DoubleNear(0.11151704194382636, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false, true}), Matrix({ { 0.10293092859376601 + 7.176584835399041e-21i, -0.0004375515228567002 + -0.00010993890199448907i, -0.010421568692731566 + -0.010742132667833665i, 0.001031387483428753 + -0.0004417585748768345i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00043755152285669934 + 0.00010993890199448902i, 0.10203713428019455 + 1.8978509127724914e-20i, 0.0009785824859594575 + -0.00044694468513937016i, -0.01057236118919396 + -0.010887572634162321i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.010421568692731564 + 0.010742132667833665i, 0.0009785824859594573 + 0.0004469446851393703i, 0.10896629838685574 + 1.6941564804368642e-22i, 0.0009045374879496906 + 3.279495777653372e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0010313874834287533 + 0.0004417585748768346i, -0.01057236118919396 + 0.010887572634162321i, 0.0009045374879496923 + -3.279495777653377e-05i, 0.10908282067712534 + -7.307164140657518e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13954905081701188 + 9.167046079099927e-21i, -0.0002141370208475898 + -0.0001435554548761744i, -0.013686793233987998 + -0.014211014684978263i, 0.0007999731849464764 + -0.0005870054736385869i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00021413702084758894 + 0.00014355545487617437i, 0.13831441240141884 + 6.61437338273962e-20i, 0.000722415418727053 + -0.0005669500297977287i, -0.013783267126077239 + -0.014398440711863175i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.013686793233987998 + 0.014211014684978263i, 0.0007224154187270532 + 0.0005669500297977285i, 0.14971387928162422 + 9.259388393684106e-20i, 0.000851091947596431 + -9.590873354167151e-06i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0007999731849464763 + 0.0005870054736385872i, -0.013783267126077237 + 0.014398440711863175i, 0.0008510919475964319 + 9.590873354167304e-06i, 0.14940547556200395 + 1.9404865104377506e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.10293092859376601, 1.0e-7), DoubleNear(0.10203713428019455, 1.0e-7), DoubleNear(0.10896629838685574, 1.0e-7), DoubleNear(0.10908282067712534, 1.0e-7), DoubleNear(0.13954905081701188, 1.0e-7), DoubleNear(0.13831441240141884, 1.0e-7), DoubleNear(0.14971387928162422, 1.0e-7), DoubleNear(0.14940547556200395, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true, true}), Matrix({ { 0.12048050795393872 + 8.074383967009713e-20i, 0.0002655188417680851 + -4.3862497482326954e-05i, -0.0015452244800526359 + -0.0014762423576298134i, -3.942860957157764e-06 + -2.6908315843492765e-06i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00026551884176808684 + 4.386249748232685e-05i, 0.12003856669061885 + 9.348090400187722e-20i, -2.867970457532502e-06 + -3.815949763496748e-06i, -0.0015395563560512962 + -0.001470827270794799i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001545224480052636 + 0.0014762423576298134i, -2.8679704575327865e-06 + 3.815949763496585e-06i, 0.09141671902668304 + -7.33978391866544e-20i, 0.0002014671233249053 + -3.32814467356284e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -3.942860957157452e-06 + 2.6908315843493714e-06i, -0.0015395563560512957 + 0.0014708272707947992i, 0.00020146712332490616 + 3.328144673562839e-05i, 0.09108138826670104 + -1.4757403628072749e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.16446909309349042 + 9.945979478256554e-20i, 0.00036215978005923674 + -8.707592675650987e-05i, -0.0021094007086796054 + -0.002015232553953008i, -5.711822940761028e-06 + -3.3207342888932412e-06i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.00036215978005923674 + 8.707592675651e-05i, 0.16359175032268658 + 1.4880637164581324e-19i, -3.5779479498457593e-06 + -5.554321379991312e-06i, -0.0020981483364090484 + -0.0020044825116232057i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002109400708679606 + 0.002015232553953008i, -3.577947949845705e-06 + 5.55432137999119e-06i, 0.1247938370051457 + 2.301135233375444e-21i, 0.00027479514668960446 + -6.607040147383166e-05i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -5.7118229407610005e-06 + 3.3207342888932412e-06i, -0.0020981483364090493 + 0.0020044825116232057i, 0.0002747951466896062 + 6.607040147383167e-05i, 0.12412813764073623 + 1.1138601322535803e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.12048050795393872, 1.0e-7), DoubleNear(0.12003856669061885, 1.0e-7), DoubleNear(0.09141671902668304, 1.0e-7), DoubleNear(0.09108138826670104, 1.0e-7), DoubleNear(0.16446909309349042, 1.0e-7), DoubleNear(0.16359175032268658, 1.0e-7), DoubleNear(0.1247938370051457, 1.0e-7), DoubleNear(0.12412813764073623, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false, false}), Matrix({ { 0.10415686869714999 + -1.3757132361484667e-19i, -0.0019329502544985584 + -0.0030888774796829113i, -0.006889635462170869 + -0.0004455015644924663i, 5.676834283074552e-05 + 0.0001295264611155396i, -0.017948387901159726 + -0.009710430612035912i, 0.004069626055214718 + 0.02919049873643563i, 0.0010993858467342296 + 0.0006941414865888782i, -0.00015495855948922705 + -0.001981365240224014i }, { -0.0019329502544985584 + 0.0030888774796829113i, 0.14033565451607313 + -2.1515188300530492e-19i, 4.208678830633345e-05 + -0.00011637566190981865i, -0.009459277048291798 + -0.00047350207903701694i, -0.021948931353457896 + 0.014165663686520696i, -0.006609752118975951 + -0.01572997700062199i, 0.0013972971714893657 + -0.0008741089404580791i, 0.0003834654697938373 + 0.001114301129878361i }, { -0.00688963546217087 + 0.00044550156449246607i, 4.208678830633296e-05 + 0.00011637566190981886i, 0.10155317165496908 + 1.7736055346208954e-19i, -0.0019283969468139046 + -0.002778536282369766i, 0.0012262473385452298 + 0.0005024087142385797i, -0.0003432712411151432 + -0.0020513588736622746i, -0.017633088058278096 + -0.009639425647516148i, 0.0037607898887455013 + 0.02825312352068718i }, { 5.67683428307453e-05 + -0.00012952646111553983i, -0.0094592770482918 + 0.0004735020790370167i, -0.0019283969468139044 + 0.0027785362823697663i, 0.13678583122419913 + 2.768285270276821e-19i, 0.0013559173348916215 + -0.001064089245373109i, 0.0004045353955055017 + 0.0011992308733649606i, -0.021482800818041742 + 0.013693002083463031i, -0.006272762163576992 + -0.01515932743866337i }, { -0.017948387901159726 + 0.009710430612035912i, -0.021948931353457896 + -0.014165663686520698i, 0.0012262473385452294 + -0.0005024087142385795i, 0.001355917334891621 + 0.0010640892453731088i, 0.14477263760739834 + -2.768686644590127e-19i, -0.013144822693867297 + -0.003936090382696057i, -0.009726803431153314 + -0.0005891705158681314i, 0.0011243896461185761 + 0.0005361087712110811i }, { 0.004069626055214718 + -0.02919049873643563i, -0.006609752118975951 + 0.015729977000621988i, -0.00034327124111514296 + 0.002051358873662274i, 0.0004045353955055017 + -0.0011992308733649606i, -0.013144822693867297 + 0.003936090382696058i, 0.11716221639502052 + -4.0776218499901855e-20i, 0.0011372162628871805 + -0.00042744569612815874i, -0.007906245090755814 + -0.0004709726855431377i }, { 0.00109938584673423 + -0.0006941414865888785i, 0.0013972971714893657 + 0.0008741089404580792i, -0.017633088058278092 + 0.009639425647516148i, -0.021482800818041742 + -0.013693002083463031i, -0.009726803431153317 + 0.0005891705158681314i, 0.001137216262887181 + 0.0004274456961281591i, 0.14124074496353264 + 2.477053808423168e-19i, -0.012660964087241305 + -0.003520952597462614i }, { -0.0001549585594892272 + 0.0019813652402240144i, 0.00038346546979383734 + -0.001114301129878361i, 0.003760789888745502 + -0.02825312352068718i, -0.006272762163576992 + 0.015159327438663371i, 0.0011243896461185763 + -0.0005361087712110815i, -0.007906245090755815 + 0.0004709726855431377i, -0.012660964087241305 + 0.0035209525974626136i, 0.11399287494165775 + 2.836798113386824e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.10415686869714999, 1.0e-7), DoubleNear(0.14033565451607313, 1.0e-7), DoubleNear(0.10155317165496908, 1.0e-7), DoubleNear(0.13678583122419913, 1.0e-7), DoubleNear(0.14477263760739834, 1.0e-7), DoubleNear(0.11716221639502052, 1.0e-7), DoubleNear(0.14124074496353264, 1.0e-7), DoubleNear(0.11399287494165775, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true, false}), Matrix({ { 0.14153631829753913 + -1.061106680183878e-19i, -0.008572918907520214 + -0.003994255651570725i, -0.009447773464427461 + -0.0005882937666711581i, 0.0006715827125735869 + 0.00037846682585460773i, -0.0018152760771351743 + -0.001734238274407709i, 6.1010655633735955e-05 + 0.0001562719808535386i, 0.0001139642162480323 + 0.00012330832227966027i, -3.976056348863684e-06 + -1.3082905093278902e-05i }, { -0.008572918907520214 + 0.003994255651570726i, 0.14640811834344314 + -4.124089268725987e-20i, 0.000670528032216382 + -0.00030920590319291033i, -0.009873687154901558 + -0.0005370093842554159i, 0.0001588935327926749 + 5.381521473905122e-05i, -0.0018777594183884377 + -0.001793932225801207i, -1.238855319264976e-05 + -4.250225707392368e-06i, 0.000120055163663341 + 0.00012786927538942957i }, { -0.009447773464427465 + 0.0005882937666711579i, 0.000670528032216382 + 0.0003092059031929108i, 0.13804774521659247 + 2.2553565300231362e-19i, -0.00829521770130158 + -0.0035817628711196014i, 0.00012838089147356466 + 0.0001082179820219616i, -4.8111805657503224e-06 + -1.218167518589452e-05i, -0.0017705333331288816 + -0.0016914929420942888i, 6.250325070810295e-05 + 0.00014757888814194987i }, { 0.000671582712573587 + -0.00037846682585460816i, -0.00987368715490156 + 0.0005370093842554156i, -0.00829521770130158 + 0.0035817628711196014i, 0.14258773620315984 + 3.4430681780368724e-19i, -1.3250731045585246e-05 + -3.374841703938943e-06i, 0.00013321506833083522 + 0.00011409443229386913i, 0.00015027761612419207 + 5.570298615266591e-05i, -0.0018287610525400924 + -0.0017471212516976214i }, { -0.0018152760771351745 + 0.001734238274407709i, 0.00015889353279267493 + -5.381521473905128e-05i, 0.00012838089147356466 + -0.00010821798202196163i, -1.3250731045585263e-05 + 3.374841703938952e-06i, 0.10739318800700921 + -3.083293200554716e-19i, -0.006504854040845642 + -0.003030712210808243i, -0.007168665428896721 + -0.00044637831368943954i, 0.0005095752763757346 + 0.0002871684064720129i }, { 6.101065563373597e-05 + -0.00015627198085353867i, -0.0018777594183884377 + 0.0017939322258012065i, -4.811180565750318e-06 + 1.218167518589452e-05i, 0.00013321506833083514 + -0.0001140944322938692i, -0.006504854040845642 + 0.0030307122108082433i, 0.1110897525676505 + -2.1468720881794693e-19i, 0.0005087750189771319 + -0.000234615454845067i, -0.007491834984146054 + -0.000407465380324739i }, { 0.00011396421624803225 + -0.00012330832227966027i, -1.2388553192649753e-05 + 4.250225707392374e-06i, -0.0017705333331288816 + 0.001691492942094289i, 0.00015027761612419212 + -5.57029861526658e-05i, -0.007168665428896723 + 0.00044637831368943954i, 0.0005087750189771319 + 0.00023461545484506716i, 0.10474617140190927 + 1.9953028130209272e-19i, -0.006294143332753629 + -0.002717726008712779i }, { -3.976056348863672e-06 + 1.3082905093278924e-05i, 0.00012005516366334113 + -0.00012786927538942954i, 6.250325070810287e-05 + -0.00014757888814194992i, -0.0018287610525400926 + 0.0017471212516976212i, 0.0005095752763757346 + -0.0002871684064720132i, -0.007491834984146056 + 0.000407465380324739i, -0.006294143332753629 + 0.0027177260087127785i, 0.10819096996269703 + 2.1620152056267734e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.14153631829753913, 1.0e-7), DoubleNear(0.14640811834344314, 1.0e-7), DoubleNear(0.13804774521659247, 1.0e-7), DoubleNear(0.14258773620315984, 1.0e-7), DoubleNear(0.10739318800700921, 1.0e-7), DoubleNear(0.1110897525676505, 1.0e-7), DoubleNear(0.10474617140190927, 1.0e-7), DoubleNear(0.10819096996269703, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false, true}), Matrix({ { 0.09541163465673336 + -4.0270829697239423e-19i, -0.005148929510764065 + -0.0015004574181238465i, -0.007027326893291206 + 0.0027619171690490604i, 0.0003884041993747219 + 0.0002540612392594114i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005148929510764066 + 0.0015004574181238463i, 0.09843787948537268 + -3.263168242040322e-19i, 0.0006032779147178758 + -0.00013610496940164293i, -0.007347626499347651 + 0.002675745039635593i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007027326893291207 + -0.002761917169049061i, 0.0006032779147178757 + 0.00013610496940164312i, 0.11242679576209555 + 3.334037363938213e-19i, -0.006962774026413628 + -0.002417585302540484i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00038840419937472215 + -0.00025406123925941147i, -0.007347626499347651 + -0.0026757450396355936i, -0.006962774026413626 + 0.0024175853025404834i, 0.11674087203374006 + 3.4887425298719773e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.153517871647815 + -1.1731691101465128e-20i, -0.009928843437601791 + -0.005524510444255122i, -0.009589112000032977 + -0.0037965892494096582i, 0.0007927537895745997 + 0.00041157399306720923i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.00992884343760179 + 0.005524510444255122i, 0.15905999142572097 + 7.038872269882543e-20i, 0.0005760251364756381 + -0.0004077163886363344i, -0.01001789563969996 + -0.003620219804215748i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.009589112000032981 + 0.0037965892494096582i, 0.0005760251364756381 + 0.00040771638863633484i, 0.13036712085640617 + 9.166219791058508e-20i, -0.007626587007641582 + -0.0038819035772918965i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0007927537895745995 + -0.0004115739930672099i, -0.010017895639699964 + 0.003620219804215748i, -0.007626587007641582 + 0.0038819035772918965i, 0.13403783413211678 + 2.116340853791669e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.09541163465673336, 1.0e-7), DoubleNear(0.09843787948537268, 1.0e-7), DoubleNear(0.11242679576209555, 1.0e-7), DoubleNear(0.11674087203374006, 1.0e-7), DoubleNear(0.153517871647815, 1.0e-7), DoubleNear(0.15905999142572097, 1.0e-7), DoubleNear(0.13036712085640617, 1.0e-7), DoubleNear(0.13403783413211678, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true, false}), Matrix({ { 0.11696259788767818 + -1.0875072387886248e-20i, -0.002195484475326286 + -0.0033360936360563357i, -0.020230912685497142 + -0.011001939686543095i, 0.004452217255798368 + 0.03266129003606666i, -0.0015001054741210895 + -0.0014331375605274347i, -1.2718790813048082e-05 + 6.968829128266396e-05i, 0.00012466557793578052 + 0.00038899401710248234i, 0.0003430953721385802 + -0.00047345066501559786i }, { -0.002195484475326286 + 0.0033360936360563357i, 0.15756571165507294 + 1.3366600820792106e-19i, -0.024694410719307017 + 0.01583987790077873i, -0.00732473891519019 + -0.017563038187041944i, 6.903522596862861e-05 + -1.5885942122010713e-05i, -0.0020208612911842717 + -0.0019306457252340958i, 0.0005108038445877873 + 9.942494608173753e-05i, -0.00012125558952839382 + 0.0003150047010957922i }, { -0.020230912685497142 + 0.011001939686543095i, -0.024694410719307017 + -0.015839877900778728i, 0.16262146562645338 + 1.3030005737181205e-19i, -0.014672652133495508 + -0.004239924886633991i, 0.00039427814277610715 + 0.00010678294710585688i, 0.00012263319202457265 + 0.000505734107770956i, -0.0020857039361429665 + -0.001992593655974563i, 0.00013623269715488698 + 0.0002341625777128245i }, { 0.004452217255798368 + -0.03266129003606666i, -0.00732473891519019 + 0.017563038187041944i, -0.014672652133495508 + 0.004239924886633991i, 0.13143014289153007 + 1.6939991690850633e-19i, -0.00045729932447919594 + 0.0003643450211235138i, 0.0003091426772234959 + -0.0001355052944479186i, 0.00024013592294823836 + 0.00012540414301372783i, -0.001685659179744259 + -0.0016104077522647326i }, { -0.0015001054741210895 + 0.001433137560527435i, 6.90352259686286e-05 + 1.5885942122010798e-05i, 0.0003942781427761072 + -0.00010678294710585691i, -0.0004572993244791961 + -0.0003643450211235137i, 0.08874744246444088 + 5.0664302235129125e-20i, -0.0016658627259861771 + -0.002531320125996342i, -0.01535056327394068 + -0.008347916573008964i, 0.003378198688161851 + 0.02478233222105615i }, { -1.2718790813048132e-05 + -6.968829128266388e-05i, -0.0020208612911842712 + 0.0019306457252340958i, 0.00012263319202457276 + -0.000505734107770956i, 0.0003091426772234959 + 0.0001355052944479186i, -0.0016658627259861774 + 0.0025313201259963415i, 0.11955577408519931 + -7.198936418554383e-20i, -0.018737321452192618 + 0.012018787869204997i, -0.005557775367362752 + -0.013326266252243417i }, { 0.00012466557793578044 + -0.00038899401710248234i, 0.0005108038445877872 + -9.942494608173753e-05i, -0.002085703936142967 + 0.0019925936559745633i, 0.00024013592294823844 + -0.0001254041430137279i, -0.01535056327394068 + 0.008347916573008964i, -0.018737321452192618 + -0.012018787869204997i, 0.12339191694447763 + -1.5946334098850793e-19i, -0.011133134647613094 + -0.00321711809352468i }, { 0.0003430953721385803 + 0.00047345066501559797i, -0.00012125558952839384 + -0.0003150047010957922i, 0.00013623269715488698 + -0.00023416257771282473i, -0.0016856591797442591 + 0.0016104077522647322i, 0.003378198688161851 + -0.024782332221056153i, -0.005557775367362751 + 0.013326266252243417i, -0.011133134647613094 + 0.00321711809352468i, 0.0997249484451482 + 7.350367593027421e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.11696259788767818, 1.0e-7), DoubleNear(0.15756571165507294, 1.0e-7), DoubleNear(0.16262146562645338, 1.0e-7), DoubleNear(0.13143014289153007, 1.0e-7), DoubleNear(0.08874744246444088, 1.0e-7), DoubleNear(0.11955577408519931, 1.0e-7), DoubleNear(0.12339191694447763, 1.0e-7), DoubleNear(0.0997249484451482, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false, true}), Matrix({ { 0.08662811929552922 + 2.379437880235446e-20i, -0.0018199264992239173 + -0.0018584946460406585i, -0.01523003191188255 + -0.008503659827054552i, 0.0032387279910142336 + 0.023821051848225715i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001819926499223918 + 0.0018584946460406585i, 0.11833994357843135 + 2.360715160769491e-21i, -0.01859434187690449 + 0.011838844919500328i, -0.0057638979700429735 + -0.013126045474941433i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01523003191188255 + 0.008503659827054552i, -0.01859434187690449 + -0.011838844919500328i, 0.12121031112329969 + -9.309893938092742e-20i, -0.010291777037953774 + -0.002059548074623672i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.003238727991014234 + -0.023821051848225715i, -0.0057638979700429735 + 0.013126045474941433i, -0.010291777037953774 + 0.0020595480746236714i, 0.0968388079406814 + 2.0196713622395952e-20i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11908192105658985 + 1.599485104488842e-20i, -0.0020414207020885457 + -0.004008919116012019i, -0.02035144404755527 + -0.010846196432497507i, 0.004591687952945986 + 0.033622570408897094i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0020414207020885452 + 0.004008919116012019i, 0.1587815421618409 + 5.931592886160773e-20i, -0.024837390294595148 + 0.0160198208504834i, -0.007118616312509969 + -0.017763258964343928i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.02035144404755527 + 0.010846196432497507i, -0.024837390294595144 + -0.016019820850483396i, 0.16480307144763132 + 6.393565576423154e-20i, -0.015514009743154828 + -0.005397494905534999i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.004591687952945986 + -0.0336225704088971i, -0.007118616312509968 + 0.017763258964343928i, -0.015514009743154828 + 0.005397494905535i, 0.13431628339599685 + 2.227068792163846e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.08662811929552922, 1.0e-7), DoubleNear(0.11833994357843135, 1.0e-7), DoubleNear(0.12121031112329969, 1.0e-7), DoubleNear(0.0968388079406814, 1.0e-7), DoubleNear(0.11908192105658985, 1.0e-7), DoubleNear(0.1587815421618409, 1.0e-7), DoubleNear(0.16480307144763132, 1.0e-7), DoubleNear(0.13431628339599685, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true, true}), Matrix({ { 0.11817275773740935 + 3.922985417648993e-20i, -0.006886471404744397 + -0.0022277204090737812i, -0.0015156263966033922 + -0.0014479655958670517i, 6.102637755954128e-05 + 0.00011295129082877476i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006886471404744398 + 0.002227720409073781i, 0.12234631690714823 + 1.3499488949548443e-19i, 0.00011561869767307242 + 5.580797081339548e-05i, -0.0015691544395005398 + -0.0014991040325575608i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001515626396603392 + 0.0014479655958670517i, 0.00011561869767307234 + -5.580797081339547e-05i, 0.08966567268141956 + -1.085344147550629e-19i, -0.005225232132433295 + -0.0016903223115905491i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 6.102637755954132e-05 + -0.00011295129082877478i, -0.0015691544395005398 + 0.0014991040325575606i, -0.005225232132433295 + 0.001690322311590549i, 0.09283243461196453 + -1.12437460712319e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.16141130577672222 + 8.019513080743586e-20i, -0.009981665204077396 + -0.005348298113616545i, -0.0020701830136606635 + -0.001977765620634946i, 6.248752878229763e-05 + 0.00019089957816671369i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.009981665204077396 + 0.005348298113616546i, 0.16664953763945478 + 1.6807103562094294e-19i, 0.00019355245124379455 + 5.371023007832164e-05i, -0.0021373660314279903 + -0.0020419494449412674i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0020701830136606644 + 0.0019777656206349465i, 0.00019355245124379468 + -5.3710230078321615e-05i, 0.12247368672749895 + -2.6462399831591e-22i, -0.007573765241165976 + -0.004058115907930473i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 6.248752878229753e-05 + -0.00019089957816671385i, -0.0021373660314279908 + 0.0020419494449412674i, -0.007573765241165976 + 0.004058115907930473i, 0.12644828791838297 + 1.1395177245704938e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.11817275773740935, 1.0e-7), DoubleNear(0.12234631690714823, 1.0e-7), DoubleNear(0.08966567268141956, 1.0e-7), DoubleNear(0.09283243461196453, 1.0e-7), DoubleNear(0.16141130577672222, 1.0e-7), DoubleNear(0.16664953763945478, 1.0e-7), DoubleNear(0.12247368672749895, 1.0e-7), DoubleNear(0.12644828791838297, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true, false}), Matrix({ { 0.13901353881503656 + -1.2410541696307187e-19i, -0.009295663335580977 + -0.0005225270163355098i, -0.013963265240372781 + -0.014464904875836711i, 0.0008431194800477802 + 0.0010282441546884827i, -0.0017829201327559572 + -0.001703326768519524i, 0.00011281916270757782 + 0.00012060103117208484i, 1.8482159303396046e-06 + 0.0003566111186289147i, 1.7855893754993983e-06 + -2.3518465985952845e-05i }, { -0.009295663335580979 + 0.0005225270163355096i, 0.13551477072771456 + 2.4689635278310666e-19i, 0.0009272303133014251 + 0.0009675180972885226i, -0.01359238636031455 + -0.01410007299774833i, 0.0001256241637425223 + 0.00010719767571081492i, -0.0017380466325494035 + -0.0016604565172420064i, -3.724902762886639e-08 + -2.3770229402526954e-05i, 1.5617724770470984e-06 + 0.0003473875995693598i }, { -0.013963265240372781 + 0.01446490487583671i, 0.0009272303133014248 + -0.0009675180972885226i, 0.1489308978259457 + -2.3246143742575802e-20i, -0.010025797283748042 + -0.000602776134591064i, 0.00035632390066035383 + -1.4428570618094128e-05i, -2.3747162294873302e-05 + 1.047605020876048e-06i, -0.0019101153627676553 + -0.0018248437316893918i, 0.0001212002172037955 + 0.000130576566497005i }, { 0.0008431194800477804 + -0.0010282441546884827i, -0.013592386360314549 + 0.01410007299774833i, -0.010025797283748045 + 0.000602776134591064i, 0.14512071069203775 + 3.2294611802289416e-19i, -2.341247130526614e-05 + 2.857054275019438e-06i, 0.00034709691933924923 + -1.429377672396757e-05i, 0.00013597179606187758 + 0.00011511473860501581i, -0.0018612477531195705 + -0.0017781576765499038i }, { -0.0017829201327559572 + 0.001703326768519524i, 0.0001256241637425222 + -0.000107197675710815i, 0.0003563239006603539 + 1.4428570618094118e-05i, -2.341247130526614e-05 + -2.8570542750194186e-06i, 0.10547898439818655 + -2.2861778965707976e-19i, -0.00705324917488169 + -0.0003964766271939734i, -0.010594874779762894 + -0.010975502736821192i, 0.0006397318364802869 + 0.0007801984617787566i }, { 0.00011281916270757791 + -0.00012060103117208484i, -0.0017380466325494035 + 0.0016604565172420064i, -2.374716229487331e-05 + -1.0476050208760556e-06i, 0.0003470969193392493 + 1.429377672396755e-05i, -0.007053249174881692 + 0.0003964766271939734i, 0.10282423215145364 + 2.0729272770666503e-19i, 0.0007035524207493065 + 0.0007341214903150177i, -0.010313463861540535 + -0.010698680088431188i }, { 1.848215930339503e-06 + -0.0003566111186289147i, -3.724902762885368e-08 + 2.377022940252695e-05i, -0.0019101153627676553 + 0.0018248437316893914i, 0.0001359717960618776 + -0.00011511473860501582i, -0.010594874779762894 + 0.010975502736821192i, 0.0007035524207493062 + -0.0007341214903150177i, 0.11300395617647316 + -2.943987392163387e-19i, -0.007607251238161085 + -0.0004573670668202054i }, { 1.7855893754993865e-06 + 2.3518465985952855e-05i, 1.5617724770470984e-06 + -0.0003473875995693598i, 0.00012120021720379547 + -0.00013057656649700496i, -0.0018612477531195705 + 0.001778157676549904i, 0.0006397318364802869 + -0.0007801984617787566i, -0.010313463861540535 + 0.010698680088431188i, -0.007607251238161088 + 0.0004573670668202054i, 0.11011290921315264 + 2.0843907415810501e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.13901353881503656, 1.0e-7), DoubleNear(0.13551477072771456, 1.0e-7), DoubleNear(0.1489308978259457, 1.0e-7), DoubleNear(0.14512071069203775, 1.0e-7), DoubleNear(0.10547898439818655, 1.0e-7), DoubleNear(0.10282423215145364, 1.0e-7), DoubleNear(0.11300395617647316, 1.0e-7), DoubleNear(0.11011290921315264, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false, true}), Matrix({ { 0.0940840475258527 + -3.0070127029042475e-19i, -0.006932353705614024 + 0.002718478986872647i, -0.009862982355111303 + -0.00981276968460519i, 0.0008875225534247272 + 0.0003562958857774314i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006932353705614024 + -0.002718478986872647i, 0.11088401534810786 + 3.268563642535487e-19i, 0.0004375077804361165 + 0.0011553753355705387i, -0.011130947526814223 + -0.011816935617390797i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009862982355111303 + 0.00981276968460519i, 0.00043750778043611646 + -0.0011553753355705387i, 0.09976546661625334 + -4.283238508860017e-19i, -0.007442599687024834 + 0.002719183221812007i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0008875225534247272 + -0.00035629588577743135i, -0.011130947526814221 + 0.011816935617390797i, -0.007442599687024835 + -0.002719183221812007i, 0.11828365244772776 + 3.554216251274702e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15040847568737042 + -5.2021936329726866e-20i, -0.009416558804848643 + -0.00363748263040213i, -0.014695157665024373 + -0.015627637928052714i, 0.0005953287631033399 + 0.001452146730689808i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.009416558804848645 + 0.00363748263040213i, 0.12745498753106033 + 1.2733271623622299e-19i, 0.001193274953614615 + 0.0005462642520330015i, -0.012774902695040863 + -0.012981817468788721i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.014695157665024373 + 0.01562763792805271i, 0.0011932749536146146 + -0.0005462642520330015i, 0.16216938738616554 + 1.1067896792708714e-19i, -0.010190448834884295 + -0.0037793264232232763i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0005953287631033401 + -0.001452146730689808i, -0.012774902695040863 + 0.012981817468788721i, -0.010190448834884298 + 0.0037793264232232763i, 0.13694996745746263 + 1.7596356705352898e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.0940840475258527, 1.0e-7), DoubleNear(0.11088401534810786, 1.0e-7), DoubleNear(0.09976546661625334, 1.0e-7), DoubleNear(0.11828365244772776, 1.0e-7), DoubleNear(0.15040847568737042, 1.0e-7), DoubleNear(0.12745498753106033, 1.0e-7), DoubleNear(0.16216938738616554, 1.0e-7), DoubleNear(0.13694996745746263, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true, true}), Matrix({ { 0.1102189408670318 + -2.9601843363618033e-19i, -0.008173309822113475 + 0.003091745533055872i, -0.0014136146044331434 + -0.0013505078280647209i, 0.00014270992401250193 + 6.049397866458882e-05i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.008173309822113476 + -0.003091745533055872i, 0.13030013377752578 + 4.702431773081547e-19i, 6.694388031928e-05 + 0.00013980043188103428i, -0.0016711662316707889 + -0.0015965618003598919i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0014136146044331434 + 0.0013505078280647209i, 6.694388031928001e-05 + -0.00013980043188103425i, 0.08363057327507424 + -4.3300668754024615e-19i, -0.006201643570525382 + 0.002345916675628782i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0001427099240125019 + -6.049397866458888e-05i, -0.0016711662316707884 + 0.0015965618003598919i, -0.006201643570525384 + -0.002345916675628782i, 0.09886753401830983 + 2.1203481207286423e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1777254957739505 + 1.4866687293053263e-19i, -0.011148150797215544 + -0.0042170486839824455i, -0.002279420891090469 + -0.002177662672144195i, 9.130945589887138e-05 + 0.000190683619004501i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.011148150797215548 + 0.0042170486839824455i, 0.1503353476422265 + 9.959929349784617e-20i, 0.0001946520794851199 + 8.251198243479648e-05i, -0.0019281281539981852 + -0.0018420523934320186i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.002279420891090469 + 0.002177662672144195i, 0.00019465207948511979 + -8.251198243479656e-05i, 0.13485236729958547 + -9.000984133317235e-20i, -0.008458856842517393 + -0.0031997603696429606i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 9.130945589887147e-05 + -0.00019068361900450095i, -0.0019281281539981856 + 0.0018420523934320186i, -0.008458856842517397 + 0.0031997603696429606i, 0.11406960734629645 + 2.036969897919058e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.1102189408670318, 1.0e-7), DoubleNear(0.13030013377752578, 1.0e-7), DoubleNear(0.08363057327507424, 1.0e-7), DoubleNear(0.09886753401830983, 1.0e-7), DoubleNear(0.1777254957739505, 1.0e-7), DoubleNear(0.1503353476422265, 1.0e-7), DoubleNear(0.13485236729958547, 1.0e-7), DoubleNear(0.11406960734629645, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true, true}), Matrix({ { 0.11654072439394392 + 3.278906613427285e-20i, -0.011936726932038014 + -0.012298216068286707i, -0.0014946947295859433 + -0.0014279683631893063i, 2.4051623679333666e-06 + 0.0003039911356634602i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011936726932038014 + 0.012298216068286707i, 0.12397835025061366 + 1.4143567753770152e-19i, 0.00030378416203532144 + -1.1470756926809748e-05i, -0.001590086106517989 + -0.0015191012652353065i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0014946947295859433 + 0.0014279683631893063i, 0.00030378416203532144 + 1.147075692680974e-05i, 0.08842733848001665 + -6.6339721711489186e-21i, -0.00905720294988751 + -0.00933148923370928i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 2.4051623679333463e-06 + -0.00030399113566346016i, -0.0015900861065179885 + 0.0015191012652353065i, -0.00905720294988751 + 0.00933148923370928i, 0.09407076881336743 + -2.14337903296233e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1579875851488072 + 9.000186968576195e-20i, -0.015618924668649316 + -0.016266761805298333i, -0.0020262720357194174 + -0.0019358149225722245i, 1.0048260394533365e-06 + 0.0004000075825348143i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.015618924668649316 + 0.016266761805298333i, 0.1700732582673698 + 1.5826429674261686e-19i, 0.00039963665796428167 + -1.725159041525195e-05i, -0.002181277009369237 + -0.0020839001430039894i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0020262720357194174 + 0.0019358149225722245i, 0.00039963665796428167 + 1.7251590415251928e-05i, 0.11987587806962355 + -1.4691089779265814e-20i, -0.01185113569141592 + -0.012342693591543101i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 1.0048260394532552e-06 + -0.00040000758253481435i, -0.002181277009369237 + 0.002083900143003989i, -0.01185113569141592 + 0.012342693591543101i, 0.12904609657625837 + 1.2837823823799926e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.11654072439394392, 1.0e-7), DoubleNear(0.12397835025061366, 1.0e-7), DoubleNear(0.08842733848001665, 1.0e-7), DoubleNear(0.09407076881336743, 1.0e-7), DoubleNear(0.1579875851488072, 1.0e-7), DoubleNear(0.1700732582673698, 1.0e-7), DoubleNear(0.11987587806962355, 1.0e-7), DoubleNear(0.12904609657625837, 1.0e-7) }));


}
}

}
