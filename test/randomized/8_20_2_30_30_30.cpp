#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.23689036862811275 + -0.25835677616339575i, -0.49072915153487573 + 0.7976964518509247i }, { 0.6635396462104317 + -0.6609461909782285i, 0.3058901570639152 + 0.17116215221163666i } }) }, { QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.2052373552390987 + -0.08878153155084266i, -0.2200700122895339 + -0.13170973652162177i }, { -0.04742279039898523 + -0.12859297744692302i, -0.06027681166770944 + 0.1056422041624206i } }), Matrix({ { 0.010867854238127275 + -0.04651956892455874i, 0.14833879162674726 + -0.26624115968639134i }, { 0.3356492369952112 + -0.025319758681229328i, 0.009390378256260878 + 0.38557801052253265i } }), Matrix({ { -0.19018192243944695 + 0.5922079964268031i, 0.22209293044488865 + -0.11521579456355689i }, { 0.2537992773777827 + -0.1971339689161946i, 0.4902943095982792 + 0.16827515045599561i } }), Matrix({ { -0.40462478684762526 + -0.10067420089988405i, -0.35104691609145433 + 0.13623113801308656i }, { -0.3186579071805566 + -0.22376770886007596i, 0.24194282847961684 + 0.3822913210970042i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.06905009044130582 + 0.06674642735583423i, 0.07079883083259876 + -0.004244625140908036i, -0.13191268350315796 + 0.005393269171749105i, -0.0010264118210163093 + 0.057437808665713484i }, { -0.01298925055590155 + 0.007448733445553863i, -0.010859609804939534 + 0.07414673311656146i, -0.00767453188576072 + -0.10641024700560056i, -0.171555221165573 + 0.0008804265723829346i }, { 0.12761595242586507 + -0.10094370049453734i, -0.13051301852549255 + 0.04286507643868795i, -0.034525616701661675 + -0.02254821746608866i, 0.16621478868493816 + 0.011459612661520924i }, { 0.0632805904791943 + 0.1338423185940602i, 0.018217538132354032 + -0.03850694938422626i, -0.07122817297688874 + 0.11969368540985735i, -0.09627433051758748 + -0.012521242802453285i } }), Matrix({ { -0.10374609256970295 + 0.034299582108654005i, 0.0734065196761367 + 0.015758534476232697i, 0.11961096598805053 + 0.08343863318273921i, -0.02971634118575708 + 0.07503650988907998i }, { -0.11974645943129954 + 0.06824854732988896i, -0.021940868499800384 + -0.021318407434323408i, 0.0026870729615171797 + -0.24346205044742275i, -0.10759060357386142 + 0.14712254687042017i }, { 0.01724829217464052 + -0.01840599027276481i, -0.056517300067986394 + -0.1646398697219799i, 0.13124832969179462 + 0.03904554810259837i, -0.08596621815230798 + 0.0832958008923613i }, { -0.014399474337113211 + -0.023150255781990033i, 0.06035677526862971 + -0.054537684253522074i, -0.11664389525242769 + 0.09932334154829282i, 0.07580272894719868 + 0.11248995818107951i } }), Matrix({ { -0.028079555633716943 + -0.13725888666130975i, -0.010153176380534984 + -0.0060099254725414514i, -0.022066217269287862 + 0.06048085448942521i, -0.044859141711165174 + 0.005046791622120574i }, { -0.00932306908182077 + -0.05877549534843136i, 0.007611518159805209 + -0.0001268607648793924i, 0.060923205248503705 + -0.15997483159656625i, 0.06103302258953885 + 0.05999553828421963i }, { 0.2114528165352758 + 0.01807733549144228i, 0.02060177598224693 + 0.1377974561818836i, -0.09484301707562717 + 0.1232479488599701i, -0.04165535253079118 + 0.007538954851449076i }, { -0.03437266354670144 + 0.022148247166707376i, 0.008581695345751468 + -0.08934165449228071i, 0.06306931991157393 + 0.08045299646073314i, 0.17048787098470822 + 0.09185875068609266i } }), Matrix({ { -0.011617566518753047 + -0.03012158872397561i, -0.056971104416264615 + 0.05026384265322707i, 0.08382972954614157 + 0.1383674584401404i, -0.0213952953435127 + -0.050995275015402054i }, { 0.045803489469527454 + 0.07341853881002744i, -0.08559803517568391 + -0.08869646144311379i, -0.014774671645164366 + -0.0099199010989551i, 0.00508596905720054 + 0.21608313609976113i }, { 0.11840179207842631 + -0.026974054369379656i, -0.16416982017410264 + 0.1288096350159246i, 0.06845928019922011 + -0.07678486774544493i, -0.006092851502625686 + -0.05062281858487683i }, { -0.0006166908022892055 + -0.030980693250146994i, 0.07237741785990358 + -0.04454817939783633i, -0.11222099295303459 + -0.04671923557318184i, -0.08690072327180284 + -0.0072239956429782i } }), Matrix({ { -0.011531868115734168 + -0.0522767759635002i, -0.10352683173620934 + 0.055276868171830904i, 0.004072094227118553 + 0.053151986004833396i, 0.0912080588972905 + -0.08979555775024668i }, { 0.11426989927674239 + -0.022999477607440637i, 0.1846763996767408 + 0.041530935963478934i, -0.02813214985275696 + 0.04391572156500285i, 0.16074401360745352 + 0.002899993930767053i }, { -0.16954628783894538 + 0.014689231572530827i, 0.009230504734420115 + 0.004299880649827156i, -0.03772297321842372 + 0.050824602633277066i, 0.12053630463021987 + -0.06504951815061687i }, { 0.10137892323804107 + -0.04167967916339488i, 0.0563717432895029 + 0.045520731681994775i, 0.05989904579447464 + 0.14227738045469526i, -0.01127685600829051 + -0.0968176408793993i } }), Matrix({ { 0.02802831681050821 + 0.10710787063300202i, 0.06012137845058871 + -0.03416221198397792i, 0.04588230327331405 + 0.09133659433343524i, -0.1014624847724917 + -0.04256958585306155i }, { 0.016551848300410156 + -0.006966749466513598i, 0.08424790453264996 + 0.05251294775065296i, -0.09722691883914258 + 0.020442089825510032i, -0.08585454796979346 + -0.20316497879802728i }, { -0.06609112055804993 + -0.09985949821383713i, 0.04971024463984426 + 0.03304919754680591i, -0.01953791945017778 + 0.01215598076503817i, -0.05284421804750384 + -0.030940899530767427i }, { -0.0859398318032223 + 0.10167263132755876i, 0.02642947295020821 + 0.045161122905897244i, 0.07454541320223984 + -0.04881131605297597i, 0.03917551246847935 + 0.06988736153610314i } }), Matrix({ { 0.14908735850229515 + 0.024170706314022804i, 0.0031943448329599185 + -0.20364540580554047i, 0.10872192174275645 + -0.1386921418025308i, -0.10471038214635359 + -0.006684244620825006i }, { 0.07251971163471245 + -0.09902040508724477i, 0.08018557282776781 + -0.022824696937143014i, -0.08182769869520672 + -0.022454400987079955i, -0.015575629479521737 + -0.08514826648672069i }, { -0.08792453486849734 + -0.11742377015693183i, 0.03997909231379825 + -0.13090771142076488i, -0.07069803624595414 + 0.1718054571226322i, -0.10307853869708812 + 0.059984596544721915i }, { 0.023298588821934262 + -0.10413369431265412i, 0.11839877729017297 + -0.17708128713447485i, 0.07265391743705425 + -0.09641335258979383i, 0.12452663746443023 + -0.06702750687506401i } }), Matrix({ { 0.008892216385430153 + 0.1656694416638562i, -0.05357298259738491 + 0.015257403750064307i, 0.07397667919789971 + -0.062419043829240205i, -0.15521039635048878 + 0.023111313135098635i }, { -0.15114984427261433 + -0.16758636631753418i, 0.1794086413480025 + -0.0715132614509444i, -0.08377753237314278 + -0.004237746504505153i, 0.03549156162264458 + -0.0649668046043798i }, { 0.04566325391754571 + -0.055238436865486726i, 0.008907601627692663 + -0.051149733412247385i, -0.09382716585686081 + 0.04109157194300771i, -0.02731914181897917 + -0.25324473222422567i }, { 0.01241638077564108 + -0.059750850669330904i, -0.14623689830669678 + -0.0529255229431607i, -0.0008135612275570504 + 0.07858847781609893i, 0.03890786138493268 + -0.008872505348020213i } }), Matrix({ { 0.03521301904904156 + -0.08282146645908749i, 0.04736061579944882 + -0.0002449175844543776i, -0.15712924598215 + -0.05562101499963095i, -0.0996468446966757 + -0.041511341037277244i }, { 0.00015577310439234598 + 0.050018127404666164i, -0.010344788865796798 + -0.03509700800058982i, 0.07263603267652263 + 0.21622216691069235i, 0.08020198769568378 + 0.12054965257793i }, { 0.11487699219056953 + -0.044010674824876854i, -0.09384552680971407 + 0.11377868010970499i, -0.0029778403371133006 + -0.17927934752812785i, -0.10480275670386612 + 0.07063093889119904i }, { -0.23280185608037374 + -0.09388679560180038i, -0.1316707869569168 + -0.03640439941306707i, -0.06260777067998273 + -0.08725437324706914i, 0.008719197642787238 + 0.03996823257435641i } }), Matrix({ { 0.08464787255142134 + 0.03166350072497876i, -0.008830231254308027 + 0.1672191040797972i, 0.058576553837832425 + 0.14231454105713018i, -0.040284217492704534 + 0.003276621566031549i }, { -0.022861266576330707 + -0.07388451985825999i, -0.05059895478774427 + 0.06903986869659214i, -0.04779459683064476 + -0.13744082512335695i, 0.02691778326900961 + 0.02771916714973856i }, { 0.11016777321841145 + 0.137716400181786i, 0.06828569808604487 + -0.20042432993632053i, 0.054145594221258815 + -0.05047613642019378i, 0.21395251598251006 + 0.006295671573849003i }, { 0.03687098277983401 + -0.004673501641044998i, 0.10923358538225426 + 0.04566568498698165i, 0.0724058203156632 + 0.01806249534383694i, -0.02430059339394188 + -0.12649097649389393i } }), Matrix({ { -0.05800229300359152 + -0.23229737824925392i, 0.18846595979470696 + -0.02400204516048986i, 0.05507464124989286 + -0.09106441987760941i, 0.04922608103009715 + -0.06640505356966718i }, { 0.14705083447319994 + -0.19698581831901596i, -0.027220267733477747 + -0.03685345029450605i, 0.008922529175612244 + 0.12195557580463587i, -0.04666691371204425 + -0.0004556811667760064i }, { 0.08102891551750442 + 0.049052823084420834i, -0.03612589804565615 + -0.06402734548172814i, -0.0835503865406803 + -0.04550828633094394i, -0.20074514265367854 + -0.0880606544281609i }, { 0.10946791775170747 + 0.07403412959206847i, 0.04128224414763773 + 0.046620270639565704i, -0.0031021760598685267 + -0.03211367321222587i, -0.09088809105366573 + 0.02473181850487913i } }), Matrix({ { 0.04377944157672476 + 0.07466370480213706i, 0.13569912674071677 + 0.023244104533042168i, -0.17293192873727803 + -0.1560051406566932i, -0.06433552885189682 + -0.06730338918756633i }, { 0.019325682923720063 + -0.03723645293236579i, -0.0061307472680489404 + 0.07445635896285996i, 0.016339650112463574 + 0.1258308137544562i, -0.009319667564881342 + -0.01826399505317773i }, { 0.05772142736157832 + 0.061622762644076394i, -0.027072516541045234 + 0.0836607684258802i, 0.03369642856925254 + 0.03581228811775636i, 0.03175751017163324 + -0.09214588426650036i }, { -0.025360878259212512 + 0.17199649636946382i, 0.16829655108106187 + 0.12149240934020498i, -0.016787000356061864 + -0.05391164016607341i, 0.15334528451664617 + -0.08709015885592485i } }), Matrix({ { 0.08955877714301665 + 0.0659012805376754i, -0.045391964101071575 + -0.07179561512898583i, -0.11438357836935804 + -0.07129317655273945i, -0.04267515565795305 + -0.13994222943349943i }, { 0.11975301652480891 + -0.03945300795519666i, -0.0451839415091763 + -0.04536067893557557i, 0.07432311181274598 + -0.052903261110514826i, -0.052809093669463535 + -0.07085810730549993i }, { 0.1616655931764167 + 0.028605524261013437i, 0.0190141249891599 + 0.11709668524681473i, -0.14638578202738675 + -0.028027381786020104i, -0.04775991805702205 + 0.15910199616892626i }, { -0.03811231435816546 + -0.05262479154136925i, -0.04895981798367498 + 0.0281903201481287i, 0.09346268819707548 + -0.02746867472549118i, -0.07785657784138719 + 0.019965982333735234i } }), Matrix({ { 0.0014830544472612375 + -0.06456806382637238i, 0.027580041085360905 + -0.19205307931290672i, -0.045728735011306414 + 0.024218260534205786i, 0.10540209672964997 + -0.15250441204776344i }, { 0.09879688678699304 + 0.0750901629489887i, -0.11021357862733176 + -0.10197535541283559i, -0.05905927102046452 + 0.0664824087458991i, 0.03851625263471008 + -0.06202675817947825i }, { -0.07664717291787464 + 0.03464278262657986i, -0.05965728143561368 + 0.10342685465594464i, 0.059602458668076105 + 0.0629385221566267i, -0.11461249577944084 + -0.0966221688143768i }, { -0.03638618516675219 + 0.014757407320337614i, 0.03383454005191221 + -0.20316686856357583i, -0.020762219105920337 + 0.013457189338021942i, -0.028979290563478702 + -0.061338640211914895i } }), Matrix({ { 0.07216470860584456 + -0.20220861789188707i, -0.008472242968243818 + 0.07614503289654348i, -0.002566934039256502 + -0.023899406795111367i, -0.05075154931894694 + 0.02656295959029736i }, { 0.042788339657792065 + 0.036822757841297654i, 0.1493778856029777 + 0.08773431523582342i, 0.18807323581748284 + 0.12157543218415137i, -0.06216291737263215 + -0.014634052250560052i }, { -0.16347833563117237 + 0.030683727224357676i, 0.06494143807880803 + 0.061429426627982286i, -0.07514794972792742 + -0.10412290856212729i, -0.03983020845550156 + -0.09042217622511868i }, { -0.05036912743203352 + 0.15509694671230664i, 0.18497865666682933 + 0.12548224092885782i, -0.012892758551518975 + 0.14628932561929475i, -0.17529326718426333 + -0.026038212160374996i } }), Matrix({ { -0.0007821267174797615 + 0.006911658911501046i, 0.07842028368287061 + -0.1937927720215313i, -0.06239587611123272 + -0.15120908931980578i, -0.08907942604893702 + 0.09423404844585374i }, { 0.07148450215275723 + 0.07147591207926275i, -0.017733041275456687 + 0.059032794675467265i, 0.0814756623305235 + 0.032751700869644615i, -0.07502773486390871 + -0.08811336594592364i }, { 0.11631350726765191 + 0.010915683076514937i, 0.05110853265974202 + -0.1355708201173277i, -0.11838902398879586 + 0.048716495631667175i, 0.038119985636253316 + -0.019738021759414515i }, { -0.09746802757773344 + -0.06925603903554113i, 0.029205533100420237 + 0.019468129779565167i, -0.034990761973034 + 0.12362415664591901i, 0.027732527738614537 + 0.12433335729479943i } }) }, { QubitIndex{ 2 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.22070746762738702 + -0.0509099164034844i, -0.0067795467988874866 + 0.2169615629004875i, -0.002423896669246076 + -0.13334378444113107i, -0.07021958317039488 + 0.0666506363204809i }, { 0.2058794014567016 + 0.06275503809399345i, -0.07477487085269272 + -0.06306866774451937i, 0.14820748571710124 + 0.02403981756386271i, -0.06949555484388902 + 0.040730556562375515i }, { 0.040100242570373965 + 0.07991646716202279i, -0.14749763792022372 + 0.19385365888126138i, -0.07854988852149374 + -0.11823770483564713i, 0.14677453471119015 + -0.049544132349223065i }, { 0.18857724936730988 + 0.09211072787608983i, 0.1448468229606757 + -0.10315180484623661i, -0.034893204626312506 + -0.013804545885295989i, -0.04360958163873122 + 0.08805800007513478i } }), Matrix({ { 0.03625537158976432 + -0.013850584397963701i, 0.07850591718404806 + -0.02665872890566825i, -0.10435579290788433 + -0.01989397370137924i, 0.02873243435064672 + 0.008773307618179804i }, { -0.017432066693164074 + -0.017596918053998652i, 0.07403191412061262 + 0.0858899153568466i, 0.0384591859711355 + -0.06709714201030295i, 0.057017320439624805 + -0.12799712454392595i }, { 0.023564834120483297 + -0.13712056123715358i, 0.01973587171512706 + 0.03927542283122048i, -0.07476363098888351 + -0.03918629115108365i, -0.14183106806544887 + -0.047428523094890936i }, { -0.12740722621007627 + -0.04764818348623506i, 0.07708854452469481 + 0.06616452785898023i, 0.07267426838022994 + -0.1855001856605831i, -0.07737150470296938 + 0.234824575892674i } }), Matrix({ { 0.07360954868869106 + -0.0021924180360059645i, -0.08938000711870285 + 0.06778262215459038i, -0.04788020839797761 + 0.038634556725087844i, -0.012100545424895972 + 0.013855895385118014i }, { 0.09808490318495568 + 0.01984358933333694i, -0.00410016261462284 + 0.040539747829312356i, 0.03726296119468434 + 0.07361389026378438i, 0.08204278629129506 + 0.05049911037711107i }, { -0.009269930713358078 + 0.18923361541388228i, -0.02473375858709213 + -0.13685701136862127i, 0.05069600575470709 + 0.011227439592078938i, 0.04652685219624756 + -0.008309664976889173i }, { -0.09060800175961038 + -0.04399558022299772i, 0.016063817360949164 + -0.14073938675676587i, -0.0823744101627357 + -0.02873958966122333i, -0.15992486694416366 + 0.022425988798807042i } }), Matrix({ { 0.016167265277779282 + -0.03228806375983079i, 0.026646960113280566 + -0.06815439896662252i, 0.1791476065336129 + -0.017451690049606342i, -0.05165001786664114 + -0.013224908251791385i }, { 0.028453354514887584 + 0.11997060202245495i, -0.031142652981374676 + -0.04506585993808771i, 0.05715374504161369 + -0.08512225151846171i, -0.0683386346646157 + 0.14940999211499692i }, { 0.03829133524717572 + 0.11807212305348246i, 0.035713826237672365 + -0.03118573569018621i, 0.010654092737691261 + -0.0015813332142537487i, -0.05357565885398162 + -0.08875489139620266i }, { -0.04629549081348432 + 0.10197358778252419i, -0.1030332614720335 + -0.09156256545465451i, -0.058413761121135034 + -0.047227999534252725i, 0.015870453267558187 + -0.06259122681729491i } }), Matrix({ { -0.06366118116723134 + -0.1258166497740335i, 0.04058776450077107 + -0.002004482796457828i, 0.11721527873983349 + 0.20983101008996205i, 0.08135893716833045 + -0.007242571592208538i }, { 0.07954744475717283 + -0.0634844094066371i, 0.024420028496587337 + -0.048832317266150164i, 0.04625136603972602 + -0.05013481869855299i, -0.0302628847754674 + 0.1171492804293726i }, { -0.017472589908128788 + 0.011784989865725994i, 0.13664221638566426 + 0.04784986390911052i, -0.07202274504068845 + -0.06673199167317222i, -0.030455205567015496 + -0.026878067085250534i }, { 0.29384835575675283 + 0.08938303123219382i, -0.034807559921862186 + 0.04509935512460991i, -0.07067513643719221 + 0.008766324331936007i, -0.09221368356569704 + -0.05064297613263454i } }), Matrix({ { -0.12213456088646193 + -0.04603980550858401i, 0.03391899186039849 + -0.09290691622008314i, 0.08700754604302337 + -0.15814706485633276i, 0.10950236945686366 + 0.044860782507323005i }, { 0.0186646021709724 + -0.04343917601558628i, 0.041528445906902293 + 0.01796447287954004i, 0.05922829453610432 + -0.03720712564346308i, 0.10673980304508446 + -0.11743279104543371i }, { -0.08074625222772207 + -0.20921755037536183i, -0.05331422749922417 + 0.06895283758330435i, 0.10011453479022449 + -0.05976262785694354i, 0.1508658181037605 + -0.027984586319236487i }, { -0.057902474596511114 + 0.05964792025736478i, 0.022352169828453526 + 0.04811447539698291i, 0.13473493305906503 + -0.008815658383128706i, 0.08254717837673031 + -0.07487773751446251i } }), Matrix({ { 0.11976107252318807 + -0.03822312071747003i, 0.15663479733129654 + 0.04343491533456187i, -0.07576825632300746 + 0.08819087252670363i, -0.19260094437703723 + 0.0074674935154212625i }, { 0.0788066081211542 + -0.13072231458908082i, -0.015406677517235429 + -0.08355162042780327i, 0.1104878457047562 + 0.07104805505907502i, -0.012542793919809453 + -0.0873419944007304i }, { -0.13268701529266919 + 0.026284785618484897i, 0.05355055901038542 + -0.05088657102701942i, -0.04665096010368287 + 0.0450894760673006i, 0.012594981842231722 + 0.037001578904213774i }, { 0.04505060695999176 + 0.020780090390454482i, 0.07360732515748374 + 0.06780153812418283i, -0.03781439703033918 + -0.08717551459760552i, 0.025352925491043548 + 0.016424446460699144i } }), Matrix({ { 0.05647326024360163 + 0.04040653792230382i, -0.13177870552932888 + -0.17746692106511114i, -0.09128004501775822 + -0.04772811800446586i, 0.050681774586082945 + -0.039575031010048854i }, { 0.13882976213406567 + -0.0466751499042052i, 0.05898720830189224 + 0.05616254806532236i, 0.1145261102047184 + 0.015253399781395584i, 0.13722444438081768 + -0.01754122942100842i }, { 0.025737813078580554 + 0.05523617901251937i, -0.07216276780692946 + -0.0744628577687079i, -0.060177273347026716 + 0.0268306159237922i, -0.08378328080913065 + -0.09681944797111877i }, { 0.13869323949187518 + 0.07225261193064438i, 0.05924938140991643 + 0.2518836815306089i, 0.021647833684569198 + 0.0675670298447519i, -0.13728900590149157 + -0.05919033840224459i } }), Matrix({ { -0.1430427699227911 + 0.017359831072331428i, 0.07838707137957153 + 0.09842051021697588i, 0.01700338525991994 + 0.14397191977652413i, 0.0569202443682397 + -0.08041425906991637i }, { -0.026783554027444433 + 0.042043765238745305i, 0.18422356289686384 + 0.08847029618902526i, -0.05761215744472679 + 0.009649017747237958i, 0.11591586733950703 + 0.07085672574270277i }, { 0.03544413840698216 + 0.01623636788416238i, -0.0933299686567782 + 0.04866776416362896i, -0.04412890019396136 + 0.057586731784635525i, 0.0640393325182594 + 0.10318545883803076i }, { 0.01764980777014545 + 0.10677336792241574i, 0.08905211985045793 + -0.17184235116486477i, 0.1536805357319971 + 0.06824020895824938i, -0.09426827078590484 + 0.012308447186759691i } }), Matrix({ { -0.15450433445569206 + -0.06439744652999156i, -0.11833270153631063 + 0.01819624095052213i, 0.10147270584117368 + -0.004351749429575034i, 0.04867433591595447 + 0.09376547772052247i }, { -0.0024131583385958036 + -0.005388565488290923i, -0.02142739433660556 + 0.07166524036748019i, 0.008016068956795939 + -0.16416807928972724i, -0.07139384977215862 + 0.018996895718256513i }, { -0.12416709362577388 + 0.1758436237401411i, -0.1451967675502136 + -0.0012771450028128376i, 0.1253327851393904 + -0.05886237540661195i, -0.05967645352281847 + 0.0962782836711459i }, { -0.0449013035874648 + -0.009040236147510221i, -0.16780842658367576 + 0.0063516824296672315i, -0.002145315540453094 + 0.0631504277209645i, 0.06490861866530065 + -0.04880481705955384i } }), Matrix({ { 0.016361202930396595 + -0.03584634584976887i, 0.047321426274331786 + -0.04395037625432704i, 0.036446109354037685 + -0.0016921630310487328i, 0.010282072623897432 + -0.08041857047376794i }, { 0.012402420366175636 + 0.016370107559878153i, -0.10939344765791766 + -0.0863704415479613i, -0.025042306581416648 + 0.032005105669179565i, -0.07073941049248526 + 0.16118432809416336i }, { -0.03091234572897777 + 0.01962665286099824i, -0.007888672082637901 + 0.040389976675790244i, 0.10099700440262621 + 0.08349751877438548i, -0.05111492876726824 + -0.08041695729978127i }, { 0.021114958990988936 + 0.03999676019271107i, 0.08511355013820524 + -0.08681266633581405i, -0.14581133270136992 + 0.138764598568265i, 0.033719436174196225 + -0.18108309989433713i } }), Matrix({ { -0.15591623296497847 + 0.0995007896557397i, -0.002666171746807939 + -0.015210304982021871i, 0.15325936231058002 + 0.16524959852394738i, -0.052709381155484826 + -0.0067115194509334754i }, { 0.005418919065085143 + 0.18044771110633112i, 0.006390103372623918 + 0.07510086227898899i, -0.06430586241249976 + -0.006173479823091237i, 0.010302928514809668 + -0.014572413732062422i }, { 0.013253579871485345 + 0.014147127748371935i, 0.019029811415621694 + -0.04924763402938809i, -0.12091177153838059 + 0.10671361779277702i, 0.12801403902618874 + 0.11679725434683493i }, { 0.013883969804540975 + -0.04410760311653842i, 0.06938201192389036 + 0.08516714820714359i, 0.04653723422328523 + 0.08686944187510534i, -0.20960290526027134 + 0.20471257007003604i } }), Matrix({ { 0.10323957818606519 + -0.0817214986659469i, -0.14663282339966813 + 0.03277969201482087i, -0.09819639081768528 + -0.10073774637479975i, -0.1533604874370215 + 0.06517527055719871i }, { 0.01258708491619896 + -0.011386860332005163i, -0.11334166364747954 + 0.060398642624164806i, -0.0351506521255022 + 0.09311909687828997i, 0.03105395735003434 + 0.04356829031496421i }, { -0.016851610724614052 + -0.13453958980200909i, 0.08252680349462453 + -0.16422122192202168i, -0.06897353790457028 + -0.2247198778814344i, 0.003558072873762355 + -0.11025600510405889i }, { 0.039066675417983095 + 0.10157146364338344i, 0.06896297104010923 + 0.060156710950552264i, -0.062753390799445 + 0.13156030145803727i, -0.0654168887822549 + 0.1398783684714713i } }), Matrix({ { 0.11583736454996939 + -0.06503224963388475i, 0.01121212461264163 + -0.0049475868410129445i, 0.041362870112444106 + -0.15770942361501325i, -0.09971658324086723 + -0.01722508837873723i }, { -0.13253411858716246 + 0.02341015776923015i, -0.05582352051289001 + -0.07176241205988944i, -0.12287020249977772 + 0.2671504145622806i, -0.14381297087335554 + 0.08629775270908027i }, { 0.003690443167270881 + 0.0410008320324183i, 0.15429487670453407 + -0.034375832446262224i, 0.006172927674283364 + -0.12809963224791948i, 0.015248374195667491 + 0.03589866538797714i }, { -0.015522671688281012 + -0.10225262565241852i, -0.06652329081407556 + -0.07606580200953372i, 0.027131522351463242 + 0.0003933984702538913i, 0.05634468818018257 + -0.029925905969542786i } }), Matrix({ { 0.0036513323830713066 + -0.040924768758624684i, 0.04207687887288128 + -0.12496520937184152i, 0.030016948298432194 + -0.07135077679824724i, -0.015496478666604625 + -0.020910795659399822i }, { -0.07737109228136936 + -0.10360845940326524i, 0.11452074886496727 + -0.02877278658578847i, -0.0911180845559662 + -0.031489789230972044i, -0.1375550817073722 + 0.007625149496802832i }, { 0.04892695364037031 + 0.07371671354328287i, 0.12193147635943717 + 0.06687998420648417i, 0.1075220282395165 + -0.06469686586493363i, -0.1989803941049909 + 0.06889179546876892i }, { 0.10812195678487206 + 0.0285896774819075i, 0.08513976530718473 + -0.11848275138203741i, -0.035762059134915425 + -0.08266373730224355i, 0.0803735998717927 + -0.04347031716337704i } }), Matrix({ { 0.13520085676366497 + -0.04175986687189471i, -0.03211288191283047 + 0.06322414349609123i, -0.02582588507484392 + 0.03658410187635858i, 0.10994118326989614 + 0.018182190506526117i }, { 0.028870440734271644 + 0.06165658383277525i, 0.03068937222980337 + -0.004028347115283836i, 0.0029915000558465945 + 0.09082762953036445i, 0.048966459204425515 + -0.029840816444606746i }, { -0.013045959148933882 + 0.1533555362916507i, -0.1203358259175015 + -0.11806657907990273i, 0.07536285005576865 + -0.13242642809401833i, -0.14726547236185844 + -0.003770622388284063i }, { 0.12050627566854541 + -0.0579179503886772i, -0.09783469953822943 + -0.1635715676847286i, 0.03293340481885646 + 0.026676723168402198i, 0.1400560880918028 + -0.13283820821814596i } }) }, { QubitIndex{ 2 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.026357918682536674 + -0.002007261157113119i, -0.052161139453608785 + -0.0654255871184808i, 0.06441897608701509 + 0.09826899308840753i, -0.01019456860675612 + -0.06818208166291577i }, { -0.03915555656051164 + 0.10554520625963683i, -0.05071952886722514 + 0.05963567309316848i, 0.03561875625153633 + -0.06571073916006871i, 0.09789358002040832 + 0.023521180990607217i }, { 0.06434906050758668 + -0.025792955510950604i, -0.07860719096892216 + -0.06408228566895638i, 0.019260729188973206 + 0.11525620346131184i, -7.49122602808792e-05 + -0.08193058540274809i }, { 0.02949321694525703 + -0.016773061323181484i, 0.04841774256744044 + 0.005644569719432818i, 0.052305270328885274 + -0.013235728810011263i, -0.05471699759626443 + 0.0493914824920869i } }), Matrix({ { 0.08191981857660308 + 0.05144535626120429i, 0.004752901992962352 + -0.03527344582289437i, 0.1551181136765747 + -0.09405193822848504i, 0.00691552923980995 + 0.04760506610943091i }, { 0.018373360410353343 + -0.09293337001523712i, 0.1402993581081046 + 0.0603399122141415i, 0.052679109552626925 + 0.20746239830970503i, 0.035557163320777276 + -0.017072793099406455i }, { -0.03359697746117573 + -0.03402913739135523i, -0.08398448747711693 + -0.05238179293376205i, 0.043941252256067036 + -0.1098272692636241i, -0.13527661767389187 + 0.16973655033611904i }, { -0.1464987734885453 + 0.18430089242764297i, 0.02708306380191121 + 0.02306521460384429i, -0.07739222420096917 + 0.026598740669602355i, 0.0325930103745622 + -0.004979462816185177i } }), Matrix({ { 0.06135041731166265 + -0.03598997953125502i, -0.2135855823693849 + 0.18867748862788986i, 0.005003849525330675 + 0.047034468267654374i, 0.00465066422021026 + -0.06752477388026089i }, { -0.08337749740590356 + 0.011978758158102225i, -0.16807097069380286 + -0.04181466235985372i, -0.011962694429694297 + 0.1354496932441679i, -0.0912264256108955 + -0.1274636064806671i }, { -0.02077583725187201 + -0.02984261874234191i, -0.05847613766658467 + 0.019099614060332715i, 0.18081993282726272 + 0.08786603042553362i, 0.009041088521732297 + 0.09628042673545298i }, { 0.07732585710348461 + -0.06537948938882343i, -0.009543888145889126 + 0.0752347391576381i, 0.09927835016450919 + -0.063574050848627i, 0.11645841356179726 + 0.14111147019867157i } }), Matrix({ { -0.0038368118705002026 + -0.049556488754620924i, -0.06745755966556677 + -0.00034146452495935776i, 0.05810115163160266 + -0.0013355263453877528i, 0.05133100105694288 + -0.03791455916040442i }, { -0.14777746397224462 + -0.30115820664237536i, 0.07891238381992699 + -0.17700464955962691i, -0.008699226867525806 + -0.011413042220297317i, 0.06840681438804694 + -0.03671030222008661i }, { -0.05614572624297885 + 0.11381429117048657i, 0.0031331735894659764 + 0.08414053900146562i, -0.07005903561959179 + -0.08595555140754474i, -0.023512630418252304 + -0.13360521877237896i }, { 0.07387274872637513 + -0.02295597633104207i, 0.04895089674677287 + -0.08917405756560227i, -0.03827766396123794 + 0.012302268488069692i, 0.11444338365884181 + -0.04798028970315266i } }), Matrix({ { 0.12577309475607004 + -0.03683708427852686i, 0.030403606685116814 + 0.017321323821614117i, 0.12774513000751955 + 0.05953419257814479i, 0.12166824853163298 + 0.012592823035298429i }, { 0.015302745064002038 + -0.027594551650292117i, 0.0651324354462002 + 0.10808416065475995i, -0.19955161323735637 + -0.07314595130302458i, -0.0038796636271895223 + 9.728844624881253e-05i }, { -0.08984141786568786 + -0.06428271521557873i, -0.03377462479715596 + -0.01786510758189161i, 0.07932043570527268 + 0.07081261696156252i, -0.053635922597156514 + -0.060464163757035054i }, { 0.09869090468337326 + -0.14598542226630384i, 0.12395643867792772 + -0.0495707467096154i, 0.07288685047916872 + 0.04735833105751429i, -0.05262925568441374 + -0.14845140810998933i } }), Matrix({ { 0.09277545368195556 + 0.05704083924855609i, 0.08067904847489464 + 0.08265901765701515i, -0.12509430808059782 + 0.04224715246529836i, 0.0329838502493454 + -0.14222563149083503i }, { 0.022741722578785557 + -0.08761533741175391i, 0.06926662114726642 + 0.020992554508281743i, 0.021593378632260157 + -0.001092020608500586i, 0.14153636846573703 + 0.02884436920787167i }, { -0.11262748946653096 + 0.06324383862501433i, -0.061244023221380915 + 0.07053386102706907i, 0.036246156603735195 + -0.02501088935021793i, 0.08342100555357819 + -0.048344660784412526i }, { -0.056915670879676646 + 0.131434278438814i, -0.021787286438967688 + -0.04295362045933079i, -0.019679133582465452 + -0.10252907715570087i, -0.17453873464027425 + -0.10770050719958581i } }), Matrix({ { 0.08518100970488363 + -0.176158117876308i, -0.017325153542221455 + -0.002738284059531204i, -0.050801022081398584 + -0.04848492391399171i, -0.14963139371679174 + -0.08000513334690315i }, { -0.09181118250935368 + 0.021188101294977398i, -0.0658674981364398 + -0.012760973336568816i, -0.004748903607894813 + -0.04957919782539827i, 0.15518084217911662 + -0.10518629559219518i }, { 0.11309968098666022 + -0.10430730265240581i, 0.09907679000802988 + -0.08375594895669723i, -0.032441920745696046 + -0.01090316045685488i, 0.013971938045284326 + 0.04424396831268107i }, { 0.09936951918387128 + -0.006392116354380957i, -0.13225851672875644 + -0.08835359125133511i, 0.004668157778487182 + -0.06730160732145934i, -0.14147359166505535 + 0.00093834613432169i } }), Matrix({ { 0.08112933549809909 + 0.04937622027548888i, 0.025202617588795547 + -0.05572727174883746i, 0.2073196752153011 + -0.023853840724673853i, 0.03911541465040861 + -0.18122658291333912i }, { 0.0470038526190434 + -0.15260127355697975i, 0.058342088631201924 + -0.04421018930822292i, -0.057322922883378195 + -0.12074705136017895i, -0.010709190754336928 + 0.011498615792161463i }, { 0.022972983154746236 + -0.05949307775983832i, -0.11287414924085831 + -0.09174476829217623i, -0.16070452020878376 + 0.047755591610689936i, 0.00817927982715771 + -0.09928226086627767i }, { -0.042454829558745785 + -0.1414527289687584i, 0.0772718101814875 + 0.08939523950341544i, 0.025108113068695505 + 0.13039762741753338i, 0.03463731825013613 + -0.040734060123196934i } }), Matrix({ { -0.10184973052706243 + 0.07693266898056911i, 0.04833314183510638 + 0.017596079431053967i, -0.07851783059232002 + 0.10328568022504203i, -0.04984021237298465 + 0.01202648324714135i }, { -0.06784026781148401 + -0.07983775749701735i, -0.028780773886329773 + 0.07075588999471114i, 0.12069083952080877 + -0.05292293682233837i, 0.15964889431199095 + -0.09615365373669969i }, { -0.00015167858568593796 + -0.1533996678816034i, -0.00989657378096115 + 0.09131057141576168i, -0.1408402318347544 + -0.05031819291325818i, 0.10866866832916135 + 0.037521561622742415i }, { -0.0815913178741273 + -0.08723434799942116i, -0.08202082142831423 + 0.035097158060640135i, -0.1822747668545909 + -0.0018137725029044912i, -0.08090915572619593 + -0.10280932477799734i } }), Matrix({ { -0.0180722417823711 + 0.07595942226492505i, -0.0603888256022738 + -0.09536333026180138i, 0.024904870316024424 + 0.13243278638563852i, 0.02455589004389227 + 0.06893508490646132i }, { -0.10024150273829158 + 0.05945896231843981i, 0.06776254320730427 + 0.060713392371771535i, -0.016426943383225714 + -0.08416810389123296i, 0.07171257953090968 + 0.049066602109530594i }, { -0.13199297341080912 + -0.04285081030483956i, -0.03317777685643137 + 0.14633596305162902i, 0.0032043649547120238 + 0.07312724183375237i, -0.022717301569185062 + 0.03192677888185198i }, { 0.05348020034829044 + 0.1404508336737478i, 0.05542225514589368 + -0.2942516250034506i, -0.05032864105822123 + -0.06252582985319705i, 0.052812544441348856 + 0.049901260768781694i } }), Matrix({ { 0.1413913399575281 + 0.038694196187558025i, 0.11852495017194221 + 0.11374066889405074i, -0.014630274718006013 + -0.199328844694592i, 0.09090862120737354 + 0.014317256019936902i }, { -0.08805060317161446 + -0.004951152490833642i, -0.011641574159500808 + -0.051510925613463925i, -0.04969338470448388 + 0.04581266251724251i, 0.03688461801638058 + 0.09883135408893355i }, { -0.02753220512528893 + 0.009005089828491039i, 0.0067682270123229984 + -0.06075243243739095i, 0.0014154517914283585 + -0.09155402756926068i, -0.04418742595644334 + 0.1616252266988174i }, { 0.0028818242040970733 + 0.09114840240682684i, -0.1427902576299496 + 0.08074129968173038i, 0.07365753431866051 + -0.04510989356079958i, 0.09434532861903687 + -0.10792675729454182i } }), Matrix({ { 0.043895077660704454 + -0.2113631091656035i, -0.06274735884246611 + 0.182013683671668i, 0.057066013245532565 + -0.02512598630693616i, -0.06382039932010687 + -0.047352434159719396i }, { 0.004240273285825247 + 0.06810622780811876i, -0.11014528416524205 + -0.02760914649128442i, -0.05498401065464346 + -0.16060789685834823i, -0.026718461981003576 + 0.04571410949130826i }, { -0.00774774163469524 + -0.07722758945005953i, -0.056889600018554386 + -0.12625157255527406i, 0.0017430188610405308 + 0.01242731849585558i, 0.13741061778339667 + -0.16412195606808272i }, { -0.07071832168923214 + -0.04810228124648211i, -0.0402185420853097 + -0.08631082513526604i, -0.056125581806173996 + -0.015736942705268674i, 0.18258182562405573 + 0.0027274191862680834i } }), Matrix({ { -0.14187240118895053 + -0.021117595617457654i, 0.027332680639406103 + -0.17592543568638722i, -0.04814928820888635 + -0.028051822353387896i, -0.056690302665960146 + 0.051487520237924043i }, { -0.06347119005393992 + -0.02196997983879835i, 0.17079250065768398 + -0.04792430863318979i, -0.05173082349313283 + -0.12137109680003809i, -0.0496927734858867 + -0.031206860630090413i }, { 0.17293988004501562 + -0.09442178526397516i, -0.14170622859663026 + -0.1651167509577807i, -0.036025210534265634 + -0.010897752548584029i, -0.03678822615391055 + 0.15755656369316168i }, { 0.030530808348411684 + -0.1760519379364259i, -0.012750635294305644 + -0.1371457389626469i, 0.048645267628971194 + 0.2129437192421645i, -0.11516032557888105 + -0.01772712978402181i } }), Matrix({ { 0.02000018613150315 + -0.13305980990547236i, -0.14571775623208955 + 0.0028570852008728553i, -0.11908053553600245 + -0.10386087657800885i, 0.12305664593870778 + 0.035867021758994026i }, { -0.011657749530826322 + 0.09429869008015779i, -0.015183147909763035 + -0.0879029401932713i, -0.05977822596597143 + 0.11371829435756313i, 0.04222743183513946 + -0.05632078666563821i }, { 0.010293755482894672 + -0.013055536940923334i, 0.00889530370074725 + -0.012164099097537859i, 0.13311908755675061 + -0.18996156847001505i, -0.04269386037847642 + -0.08757360953241033i }, { -0.07342646708739241 + -0.026108743464634106i, 0.05787404587779162 + 0.16362142207481423i, -0.07114431575351336 + 0.020720503152352115i, -0.15457226691303078 + 0.015543597291180258i } }), Matrix({ { -0.07925250809126622 + -0.047623181797091456i, 0.006045727413994252 + -0.0550470373459929i, -0.1357290806153011 + -0.07586741172054248i, 0.20328428344045402 + -0.03755941460944369i }, { 0.1422582959759998 + -0.11211830398798067i, 0.09693098355436183 + 0.06345395474222874i, 0.06193698747936103 + 0.09745731939191392i, 0.1600700917309377 + -0.13289806715919472i }, { 0.010510449177037858 + 0.03767070082044805i, 0.03258310589187646 + -0.19717368603206553i, 0.09424188168700973 + -0.16221937964375185i, 0.017916181075886516 + -0.07329866975279169i }, { 0.08636285553808158 + 0.015554500498525631i, 0.03239027572843098 + -0.06912787937815454i, 0.09350514883589642 + 0.11952866084795477i, 0.01860146861784689 + -0.06888032954909436i } }), Matrix({ { 0.10683282965908256 + -0.0680515926495285i, -0.13475256357397752 + -0.042066266940703985i, 0.12185362879214522 + 0.003413121776751196i, 0.01563919883153027 + -0.08135453455900941i }, { 0.047910073476531735 + -0.0699535784340978i, -0.010413668614785218 + -0.04898952252434899i, -0.10231553097617599 + 0.05757219380022987i, -0.171135222376981 + 0.1639860302980994i }, { 0.19045250011550788 + -0.06216118488700879i, 0.009829209554211528 + 0.11989340191080351i, -0.10150913020924693 + 0.03305474486005476i, -0.13711284395632753 + -0.03912341707140152i }, { -0.022585839902609196 + 0.10284050187340722i, 0.07750455436754772 + -0.1007897731578334i, -0.061003234564819195 + -0.059366662557665144i, -0.041217904256993926 + -0.04230833988359772i } }) }, { QubitIndex{ 1 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.014163373245181798 + -0.04493319941570955i, -0.07212481349053117 + -0.08236355242203457i, -0.0815191964283957 + 0.08251308229208386i, 0.06449120983741699 + 0.041566036792088666i }, { 0.17045805706424078 + 0.07876902949960395i, -0.007235595481557497 + 0.00983887766665003i, 0.11512028724105058 + 0.03666560004320543i, 0.09630072329257738 + 0.017689434095222528i }, { 0.10883731407193552 + -0.13696650515836462i, -0.006398520859404039 + 0.050892186873453704i, -0.012127227456519233 + 0.21378272317816308i, 0.21575529456060882 + -0.010296631026373869i }, { -0.06163224447178109 + -0.05122195694422201i, -0.19509918462655246 + 0.03357089157171696i, -0.040223113294933555 + 0.014245918762372007i, -0.01836329983350227 + -0.059718909699555414i } }), Matrix({ { 0.0054749225488132675 + 0.0633797772077443i, 0.10577565532947916 + 0.021934331083383288i, 0.10113327183609815 + 0.04561669156164022i, 0.17780053013012298 + -0.013875606549238575i }, { 0.008077224332584967 + -0.0600392485448048i, 0.015162140982245803 + 0.09459217358592388i, 0.03117273703850476 + -0.17442175417473335i, -0.038945105018257944 + 0.06683596318973355i }, { -0.04078023488566733 + 0.13646740607321878i, 0.04156443836142881 + -0.05398583184431048i, -0.05904999773675962 + 0.14861695816762552i, -0.12079577603720491 + -0.03943087401375232i }, { 0.061983261502016544 + -0.1175760488802722i, 0.045927703903963134 + -0.1572123192685958i, -0.1385764794552935 + -0.0038614414083936494i, -0.015637966434923926 + -0.032003538951429836i } }), Matrix({ { 0.12100492674089368 + 0.09156999385130501i, 0.07549952035083492 + -0.10933305844148476i, -0.04128096748806266 + -0.11840940385027623i, -0.17651540426489373 + -0.09654048145943533i }, { 0.15253429706692645 + -0.15966328283565162i, -0.001289907487894264 + 0.10034602875728448i, -0.00675735700514685 + -0.027023040345432903i, -0.05370789916482247 + -0.027283486999172733i }, { -0.05347398092629442 + 0.07261593594164997i, -0.07226110567985176 + -0.054442298976988705i, -0.18013220186523798 + 0.09915293326116134i, 0.11786740932611382 + -0.1420136651879223i }, { -0.05695670720389823 + -0.18693777866872047i, 0.034714590993721976 + 0.06913047628981354i, -0.09761435272315713 + -0.009864353801025046i, 0.026613445492699235 + -0.06888169478458242i } }), Matrix({ { -0.0515741340936006 + 0.07261182096431587i, 0.023946036137086405 + 0.11012681014939989i, 0.03539360232815574 + -0.17209990940560305i, 0.13817592183940594 + 0.032211836634558226i }, { -0.0614091137351069 + -0.09476125837642578i, -0.053362667368104806 + 0.07493460132314705i, -0.028902856126511025 + 0.13791498182299877i, 0.04385428990459481 + 0.039074607032113615i }, { 0.05589777252724852 + 0.06581637345359816i, 0.037671295285205256 + 0.07385001367687688i, -0.006746986634132377 + 0.009391845678688315i, -0.013848486384014399 + -0.02148288590050581i }, { 0.16718341604500617 + -0.10406842717249858i, -0.10260114517148561 + 0.06323483693967284i, 0.06219679157835192 + -0.059033138619027974i, 0.03605027606814553 + 0.16811048564014477i } }), Matrix({ { -0.037058406463107076 + -0.03432290960347302i, -0.20642515059599084 + 0.03005785221759955i, -0.1593957386097049 + -0.0840346072125418i, -0.10012062322005656 + 0.006877059953010319i }, { 0.011591569683541164 + 0.05368580085704482i, 0.028880376728662973 + -0.13983996677937235i, 0.0265037236511695 + -0.00309152351501033i, -0.05119742809875644 + -0.00033419437723153524i }, { -0.13157112457827885 + -0.008508966848391952i, 0.06676942639649489 + -0.18966852431635062i, -0.06922904539066868 + 0.18851812309839006i, -0.04432441292187986 + 0.012683018282563055i }, { 0.07515276339674146 + -0.05500751414924546i, 0.07430646766966484 + -0.14014599872692937i, 0.049810919305319855 + -0.048651245575093316i, 0.01947429573822206 + 0.0793293655021589i } }), Matrix({ { 0.15044587880594082 + 0.14871440360892801i, 0.04959600945108258 + 0.15651313837189765i, 0.08228634182195566 + -0.05156628670856836i, -0.1055889453446944 + -0.03743188815657054i }, { -0.03761118427608455 + 0.207817905604591i, -0.18588671503208948 + 0.1074339304732998i, -0.18107502266941758 + -0.23350842136583472i, 0.028103324225916045 + -0.04022716486488607i }, { -0.09571798948184863 + -0.14236870551615655i, -0.09440702961097806 + -0.0530324477169081i, -0.03894024414679518 + -0.026065273147572628i, 0.05128540231321057 + -0.04946826926065895i }, { 0.043968621739527716 + -0.10959314188221615i, -0.008622883159189026 + 0.06575079119278034i, -0.054342831725916675 + -0.1264410526164778i, -0.16306809716757334 + -0.04080518408360234i } }), Matrix({ { -0.12960359314815545 + -0.0014204380451269712i, 0.023644531228542497 + 0.008489263122642301i, -0.0014825254993878192 + 0.013106994147293221i, -0.14150133512238136 + -0.050827072954869656i }, { -0.11724399150540453 + -0.09474199631391252i, 0.17184353031592045 + -0.0902188141335614i, 0.097460085048758 + -0.01123205076746186i, -0.031482030218385984 + 0.045976226368174646i }, { 0.027968205930779342 + 0.11156996752086233i, -0.06599201519187083 + 0.04917283340470259i, 0.06018499454848894 + -0.08585084750216533i, -0.032344809091858905 + -0.01863776642106389i }, { 0.040772385811695955 + -0.1142219756491486i, -0.01749188319373536 + 0.008415818365164683i, 0.06715149697406109 + -0.019954782283599076i, -0.18007656411162953 + 0.07965897950028572i } }), Matrix({ { 0.01789696987153199 + -0.0546228713801484i, 0.20876483060437634 + -0.04713520068005181i, 0.025624813260997505 + 0.07427785924504685i, -0.12427632702524397 + 0.016916647968403514i }, { -0.0211216788798363 + -0.05014559486959247i, 0.0919596695163268 + 0.0710642203241184i, 0.04164381155436824 + 0.05152379576174545i, 0.025389663652149553 + 0.04141489295755222i }, { -0.15173637874910006 + -0.07613789654426298i, 0.11925987154065193 + -0.12005720261629785i, 0.06576065358925602 + 0.1060819506332929i, -0.0011856973461039572 + 0.039887485134584004i }, { -0.048755042729197895 + -0.16339905205562769i, -0.053163505205903044 + 0.026833397388246635i, -0.006426151489465658 + 0.17840831379398986i, -0.10915143073036065 + 0.08090052586302095i } }), Matrix({ { -0.0478628995301043 + -0.11510341637897545i, -0.026804684524315756 + 0.10955979043102575i, 0.01878576133012269 + -0.019539058849084086i, 0.12740376191398053 + -0.0507370148565413i }, { -0.08800890665786905 + -0.11208466643543746i, -0.1669079623239521 + 0.07464919721658546i, -0.057976472706954794 + 0.05880126077173358i, 0.09793547741437153 + -0.20818647481942998i }, { 0.01326874571926148 + 0.02554762232309037i, -0.05907580014496105 + -0.07481017059324692i, -0.02562510543067533 + -0.053649051251904535i, 0.01599227550156735 + 0.021464028112957598i }, { -0.03655872398314796 + -0.07372046231240977i, -0.07601516077283178 + 0.04159980120029224i, -0.0536002135295468 + 0.01797826874148506i, -0.04420425475919294 + -0.15276324530151i } }), Matrix({ { 0.07813066167611117 + -0.11113173116494489i, -0.048502830733427295 + 0.09858721845452668i, 0.05303748953206911 + -0.04810685774902295i, -0.13041085550693257 + 0.04064737669224754i }, { -0.07255243083885832 + -0.13207441082188473i, 0.004125779171692037 + 0.007804093010928676i, -0.06486607012725237 + 0.11870628670032221i, -0.019528159856454487 + -0.06340033207541622i }, { 0.06563923757631603 + -0.03215786601069054i, -0.16577618309625997 + 0.006031690620299402i, 0.1354955745686651 + 0.03601867020193977i, 0.0765737120281272 + 0.08016863692393897i }, { -0.021412626766416722 + -0.005641251870486568i, -0.06775255119511224 + -0.13023492649532253i, 0.010713023577268431 + 0.03674962571047114i, -0.13620587028497366 + -0.21149291780558618i } }), Matrix({ { 0.13314974843825034 + -0.043222344036168495i, -0.17946408686260998 + -0.046596834731854705i, 0.2534973275712803 + 0.03843633137596494i, 0.009733526349350062 + -0.0783772069877023i }, { 0.1952733253622946 + -0.039304768573170744i, -0.014952061757026193 + -0.05506386564459222i, 0.10091960640446443 + 0.08960672099519405i, -0.030988433980029324 + -0.03925810346852026i }, { -0.05508602347581373 + 0.012632439748171072i, 0.013385342155872131 + 0.008624858231463538i, -0.034087859179296076 + -0.02490517879211368i, 0.19820089541137695 + -0.17697780111866315i }, { 0.030921382948495703 + -0.086805616490812i, -0.18414722905861464 + 0.10921541108100272i, -0.03302574873991536 + 0.07427996511415591i, -0.10809966307522573 + -0.07791995478003906i } }), Matrix({ { -0.010394424754428172 + -0.10799434683778637i, -0.05039698898222731 + -0.1433818426541659i, -0.024112025136185992 + -0.03584927894243798i, -0.014786248933460441 + -0.037662372784972024i }, { -0.025945541470574915 + -0.08146486219112754i, 0.060613778161825026 + -0.12847417524929036i, 0.03759169545561106 + -0.015025098499863611i, 0.05023551995792465 + -0.20055729751893228i }, { 0.16099585105349842 + -0.14246830255946186i, 0.08315338614552371 + -0.11815819183988298i, 0.08151833769974234 + 0.032980928560155276i, 0.07928898917368216 + -0.09693522529056738i }, { -0.01878224815004212 + -0.09210647936015486i, -0.037685012447540606 + -0.06359499940250324i, -0.06985391473426063 + 0.08925658901952341i, -0.0995802425707752 + 0.06819225863614382i } }), Matrix({ { 0.09912902922659443 + -0.06877600785833816i, 0.08331221562268945 + 0.018239454385408464i, 0.06264269752133658 + 0.1743910475770031i, 0.133716394448967 + -0.07686527582784358i }, { -0.07277798721849718 + -0.1283070117409985i, -0.11267267671291081 + 0.11138992569648562i, -0.07362332296307826 + 0.24352168281317116i, 0.10977098647859848 + 0.016383715387683948i }, { -0.07922632646195946 + 0.09709316953735583i, 0.02007640856080939 + -0.03140974002244461i, -0.03260860846316335 + -0.007679862734474454i, 0.05825898797481389 + 0.07138806550605428i }, { 0.01743185076012447 + 0.008774249238769141i, 0.1316515041452014 + -0.05399453787692143i, 0.0021099117699117102 + 0.016605466542440023i, 0.0015636538376616238 + 0.20362677735200232i } }), Matrix({ { -0.09197702832296187 + -0.06266843939935915i, 0.005119771132477931 + -0.05151276820519954i, 0.12907308942257262 + -0.09783174726050742i, 0.1191248372706468 + 0.018510325938832655i }, { -0.048848027285637384 + 0.005940833561180926i, -0.06313130908528289 + 0.02092158439384306i, -0.020678868256806857 + -0.030525431156567688i, -0.018390169825960565 + 0.07907190502022798i }, { -0.021778211482937064 + -0.07437280108774622i, 0.10135489244880115 + 0.048572361306136756i, -0.041831089989945835 + -0.17832534633327568i, -0.021290107714022836 + -0.12879625446597562i }, { -0.03360577788142621 + -0.03897950121759088i, 0.0017522600811041911 + 0.027452799917300548i, 0.14731512770140506 + -0.029710342602306924i, -0.07503610739927154 + 0.09487536890689363i } }), Matrix({ { 0.05869820990291584 + -0.046731821349239186i, -0.15216993848186441 + 0.006740286839364236i, -0.011101759919545475 + 0.13654176219143066i, -0.03098699218355075 + 0.056105879077476654i }, { -0.08569131352018608 + -0.05850746748104203i, -0.018119846902040677 + 0.0353019244032407i, 0.042203079716278645 + -0.12850124397151544i, -0.013674149814248882 + 0.103919206220732i }, { 0.11871144792052213 + 0.046764619339857316i, -0.10187532694958011 + 0.17509813674456517i, -0.012341312025246425 + -0.019851541711213155i, 0.07694276760021669 + -0.01994957446409405i }, { 0.05555836403235142 + -0.054369678193936836i, -0.07869893510845279 + 0.058803994853981516i, 0.10429353272445392 + -0.06675248640513516i, 0.0112505976079871 + 0.02288119265883693i } }), Matrix({ { -0.014181033336482206 + -0.13581833405245802i, 0.02712632712192953 + 0.011862258021212779i, 0.04153013690564036 + -0.006524693236408621i, -0.011332008654744216 + -0.0681472054429827i }, { 0.055157732549216375 + 0.031351273238263096i, 0.024754367934040077 + 0.03746224919117911i, -0.04010091060272958 + -0.004958759274190417i, 0.00822577567758155 + -0.05083934454901965i }, { -0.12705896680512166 + 0.029820177157315997i, 0.01995902765571861 + 0.08711743142440426i, -0.018868249507106315 + 0.0007449614334031849i, 0.016568726231359597 + 0.09818410209413352i }, { 0.008624684956604475 + 0.09445348081316314i, 0.03498765246612952 + 0.11944343668130433i, 0.09621692015752308 + 0.06172933666789026i, -0.021639936738117746 + -0.1438825460634585i } }) }, { QubitIndex{ 6 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.3853058729314356 + -0.19086791988438717i, 0.07241523752124354 + -0.11397143094973715i }, { -0.14687984707552162 + 0.35200883276318057i, -0.11040272317730977 + -0.012768537230509289i } }), Matrix({ { 0.24483429741818066 + 0.01969797296459648i, -0.17615650670607735 + -0.5027869409535143i }, { -0.203017035895185 + -0.5487596953607088i, -0.048303951707002565 + -0.340891614169728i } }), Matrix({ { -0.13369347297555847 + -0.1505063369961427i, 0.6449693980496704 + 0.020996825245891082i }, { 0.22558077076979677 + 0.1812811337216985i, 0.14636793724967373 + -0.06544657257039349i } }), Matrix({ { -0.24142145451275093 + 0.2574466792063135i, 0.2507817256199079 + 0.047476109493577154i }, { 0.12435042179996891 + 0.05136317420185131i, -0.2300164677946916 + -0.08283908451217038i } }) }, { QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.36583531207552134 + 0.4285288836995821i, 0.13702063717985122 + 0.40916478112179333i }, { -0.10289695120040258 + 0.3507406456042629i, -0.4212668639605564 + 0.045435632457658914i } }), Matrix({ { 0.22355222620317197 + -0.2536099626630813i, -0.308928149692839 + -0.23671352994512335i }, { 0.1281958480168963 + 0.09411158874043898i, -0.21551683467352833 + -0.35386931121781184i } }), Matrix({ { 0.3287912978162641 + -0.20182880548368756i, 0.19897261796244597 + 0.14477325096086008i }, { -0.08951177273280718 + 0.42024648329579195i, -0.12923044566853814 + -0.27643913829029154i } }), Matrix({ { -0.037580074283765946 + -0.09807859446414306i, 0.08870173538567398 + -0.24446321212457675i }, { 0.254022759408396 + -0.01785150544244595i, -0.2513970893602573 + 0.16321522136959696i } }) }, { QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.10770617891107448 + 0.4177383060441954i, -0.029430062060973552 + 0.2005789806120437i }, { 0.030186260369676754 + 0.09801509654654093i, 0.26664333990840483 + 0.21949074139205196i } }), Matrix({ { -0.016999115988656152 + 0.13256418753336652i, -0.4959228433535954 + 0.02988912629024822i }, { 0.1675174735117873 + -0.289303193574428i, 0.10330238459846479 + -0.09574178925840145i } }), Matrix({ { -0.1920634860957101 + -0.18876952556827453i, 0.2698570552491554 + 0.43605573860159696i }, { -0.4026936422431847 + -0.044238687679611616i, 0.0381984837784349 + 0.11825557484944957i } }), Matrix({ { -0.38911314874697045 + 0.3466915168665023i, -0.10037036075611107 + 0.27806207044097975i }, { -0.3438075743544871 + 0.2174994153393436i, 0.18730030843518533 + -0.41481479716581254i } }) }, { QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.09110003198456784 + 0.061267803029934405i, 0.00016159899779431353 + 0.055626469508544454i, -0.0455358568556904 + 0.09661887539465568i, 0.1339931355879779 + -0.025196223749550307i }, { -0.06809279786674492 + -0.07050453526348754i, 0.03179738347835935 + 0.09811525361261621i, 0.07417568210744332 + 0.09614410702707558i, -0.01541723649780628 + 0.19285999906987275i }, { 0.11129910566089218 + 0.052480678551733974i, -0.08316977926586 + 0.08821109056073864i, -0.03370787337067848 + 0.096467885708737i, -0.0325965186071574 + -0.011212442120717583i }, { -0.07231958798693781 + -0.09303412015283513i, -0.09019789190257149 + 0.1363966027298511i, 0.08706190353931657 + 0.1285770231824676i, -0.040680491952078186 + -0.12288666482782465i } }), Matrix({ { -0.055578210603982735 + 0.054204356204275723i, -0.15742250170671085 + -0.050378654923428974i, -0.20127946054355303 + -0.024730021738763718i, -0.04596315218262696 + 0.07084771458962094i }, { 0.022802269436525885 + 0.057308093318003295i, 0.026853818584229024 + -0.12491825206961993i, 0.022193610388925616 + -0.0700693787946354i, 0.20540211314740153 + 0.10100663649312307i }, { -0.02235545460308612 + 0.035215556833888884i, -0.07744817309356872 + 0.05325256281999735i, -0.010675024263145755 + -0.11445303218510637i, -0.12685262734841038 + 0.13104090838325058i }, { 0.04843174428554083 + 0.07928134437985207i, -0.12945859163848566 + 0.14926987814569626i, 0.057881400938989296 + -0.020309721240474622i, -0.07908390195992346 + -0.117568586788423i } }), Matrix({ { 0.03712264463789311 + -0.013349018550270533i, 0.15303921122202266 + 0.02836342897372396i, -0.06851280803956546 + 0.01875356728476589i, -0.07882422795806235 + 0.09794409114948815i }, { -0.049199787576160815 + -0.11523733926658287i, 0.05324281381224155 + -0.0379701870081204i, -0.060970430955459426 + -0.20440455594713733i, 0.15772074477175888 + -0.08725006148428673i }, { -0.21406558281926974 + 0.1717520041239133i, -0.1768664146472943 + -0.04069128045384068i, -0.13413995866103737 + -0.041503919013174795i, -0.009519820419472623 + -0.10719511032736506i }, { 0.05021343826075262 + 0.037922512422831525i, 0.03713991813409029 + -0.11864287110272054i, -0.05119086629312668 + 0.08113518802284544i, -0.0013511633617811862 + 0.050008807751382806i } }), Matrix({ { -0.051637637199017684 + 0.06880887485012294i, 0.015297225781564535 + 0.021273197381208742i, 0.03182190373200965 + 0.006372026796967971i, -0.035626544221129035 + -0.06359017589590496i }, { 0.017440257654898452 + -0.0615392970388188i, 0.21133798904785034 + 0.07539517218551897i, 0.03398928266302538 + 0.0024859414408612245i, 0.07687272518167647 + -0.03339297693317068i }, { 0.015798826779948438 + -0.04333306607226149i, -0.08675139524330552 + 0.05466043203828898i, -0.050720852812183866 + 0.2326381819865465i, 0.03406633842661864 + -0.06490913700495062i }, { -0.2452254359214711 + 0.17636244076000263i, 0.025900987726806313 + 0.1529877618977916i, 0.06777616913591945 + -0.11147641638632734i, -0.047096443434342425 + 0.007811422668918611i } }), Matrix({ { -0.030620751955131434 + 0.031603633404784205i, -0.10758754253357561 + -0.028265726292271087i, 0.11345875592525102 + 0.11566545402866699i, 0.21753148698307964 + 0.1131569160935538i }, { 0.10755299586495205 + -0.07069916039365048i, 0.19643187499866968 + -0.04115637109767683i, -0.05086574339443534 + 0.04708510557643124i, 0.09526769803919462 + 0.02084188388823246i }, { -0.05814235451074168 + 0.011346550048464242i, -0.09694198043860915 + -0.08691527082525936i, 0.02967826234347199 + -0.057489202963702926i, 0.0642353985580167 + 0.09523078647667425i }, { -0.2043688461698561 + -0.08755161056677227i, -0.1373568451363222 + 0.13940259391746346i, -0.0846552557434067 + 0.012948852429565418i, -0.05349086138338301 + 0.054258139044593826i } }), Matrix({ { 0.0014805507491250781 + -0.08157212829388402i, 0.018824629661403615 + -0.09450073599068838i, 0.021747531420634736 + 0.06602506964732287i, -0.0881675495724576 + 0.0572706487851944i }, { 0.09299835851617518 + 0.07255952043724097i, -0.11007144029689797 + -0.09717736287633395i, 0.10013241702879126 + -0.19673854681331865i, 0.06955858778491968 + 0.033584276390875134i }, { 0.04562530784201919 + 0.07025779853989039i, 0.04096767979675846 + -0.08873410527008967i, 0.006440003571204544 + 0.02400740201341814i, 0.01643100993617546 + -0.18001493928030646i }, { 0.027450407883803516 + -0.03825898905486442i, 0.054362653453212735 + 0.006540313766453316i, 0.025659310397171575 + 0.008343123965312583i, -0.05918500076829395 + -0.05707495040537486i } }), Matrix({ { -0.045067079778607015 + -0.07428950596675869i, 0.07027831404636965 + -0.06564841763211923i, 0.025294943923866914 + 0.13322595656159883i, -0.07901038073950652 + 0.013280081427769243i }, { -0.0024706923036547264 + -0.15303638005214307i, -0.06911965941131579 + -0.07012828837584464i, -0.0025178416400137202 + -0.07606056253586632i, -0.12445508882405527 + -0.05275704261406062i }, { -0.0942485842530594 + -0.0664604590473936i, -0.04691435809717738 + -0.020646289909230717i, 0.018644644824427896 + 0.2019945648449811i, 0.16684983491110716 + -0.011907950227266975i }, { 0.051558782793154005 + -0.012323832383766904i, 0.06792471575755975 + -0.04814377169832524i, -0.01512525316110261 + 0.22732232902617316i, 0.04753119337971764 + 0.014436812276826463i } }), Matrix({ { 0.10003906751587707 + -0.018211472717843548i, -0.011525793647624683 + -0.06185275637723746i, 0.009567289533077951 + 0.11205307927342384i, 0.004359385615446212 + 0.008290152340677402i }, { 0.009589244008178106 + 0.0018138753905600903i, 0.03338058253897329 + -0.08967565618834525i, 0.1550437323075382 + 0.06549319172108448i, -0.01696156533157684 + -0.0716321758440854i }, { 0.11370635326852872 + 0.10844170843668904i, 0.016530140139649686 + -0.04851093642019463i, 0.02620256545899068 + -0.04195044671848173i, 0.1329291133307068 + 0.10419860272330202i }, { -0.004077675678094193 + -0.008267655683614828i, 0.05105107528693041 + -0.07411868937477138i, -0.035351167111415026 + -0.037995877837484524i, 0.023430943402620315 + 0.10457987413581173i } }), Matrix({ { 0.006688229250280266 + -0.11718819406812124i, -0.14763612382430355 + 0.09317960771765242i, -0.05473025336186004 + 0.031776650072554466i, 0.010280081564804266 + 0.009106096514878386i }, { 0.07647913254562085 + 0.0488969756602574i, -0.15242953609994914 + -0.04716912567678818i, -0.046665929304045436 + 0.019366700052715836i, 0.11234358146513813 + -0.06936643617173792i }, { -0.03885806012320575 + -0.00796873302574556i, -0.0788648068906094 + 0.04932487569879113i, -0.0936687541980514 + -0.003707878238309347i, 0.08665625544013071 + -0.046539465266070244i }, { -0.03280522098666148 + -0.037558303197359824i, 0.16642541701316094 + 0.07928554411370818i, 0.18257293731105076 + -0.06385316188672546i, 0.17145798906966184 + -0.07400131526158982i } }), Matrix({ { -0.03413487604295277 + 0.03601005278074782i, -0.13426330278305498 + -0.03693467293201723i, 0.05265700535570962 + -0.05886182960673731i, 0.043946072527975444 + -0.061724038297378055i }, { -0.08768072174486187 + -0.2810974923138813i, -0.028173204851400315 + -0.019050869644934694i, -0.06616471101087422 + -0.045232787966836614i, -0.020788850227166353 + 0.12275286550341379i }, { -0.04123960076174741 + -0.04214754851900823i, 0.10720542500914755 + -0.16140864635318156i, -0.07525817424981783 + -0.11280369365652235i, 0.0766773818406289 + 0.08744086338389334i }, { -0.12272746097327818 + -0.024726015243252977i, -0.012588904229366673 + -0.1345182621327232i, 0.008116600389266815 + -0.06759569633820645i, 0.033754984285670295 + -0.22848458251298226i } }), Matrix({ { -0.1364060078181725 + 0.0691039932216863i, -0.006362994979165703 + 0.003033568740044562i, 0.20560403441103073 + -0.002466111397402119i, 0.008353219398027467 + 0.04826136130682488i }, { -0.10080727789854894 + 0.022720174914843995i, 0.04989544137103923 + 0.008724443669015815i, 0.0840220108850725 + 0.07830422332324659i, 0.050238304245253884 + -0.13828051959557866i }, { -0.06275459741949549 + -0.1887978104264799i, -0.011963167251886361 + 0.06212779145938492i, 0.04138161177599165 + -0.011165011542453437i, 0.05649011207880657 + -0.11329182412639172i }, { 0.034943333885229584 + -0.07561824194279644i, 0.049677029057480344 + -0.08083835531854468i, -0.01192172935625698 + -0.04273138243087584i, -0.051020364840607575 + 0.07593595550317898i } }), Matrix({ { -0.060522177611092756 + -0.0618981702340696i, 0.06528166769620963 + 0.15511067472425202i, -0.11898316038919923 + -0.03791081064965658i, 0.006487675405599412 + 0.09954134002403256i }, { -0.10274146390213765 + 0.004800637840157633i, 0.059766520691827564 + -0.009990245104702101i, 0.04123324735049481 + -0.038939650924023614i, 0.127843024392398 + -0.017636853335174448i }, { 0.09608521315190349 + -0.07501135242489824i, -0.18186208575044505 + 0.0020093451636465803i, 0.20696151388116726 + -0.04691165999421774i, -0.03892672867055483 + 0.238766610573487i }, { -0.10242955224761444 + -0.0913166381424106i, -0.15147971943630661 + 0.018196259344482487i, -0.14485491455405516 + -0.06124534584196259i, 0.0677048687541696 + 0.11422291146617121i } }), Matrix({ { -0.07819814211243495 + -0.21967709571031666i, 0.06875392837107969 + -0.0006329233559847704i, 0.004293711852218774 + 0.0761555770613453i, -0.009471435688088156 + -0.09871056959948375i }, { -0.036060824442224776 + -0.019553814063080977i, -0.020214528566591353 + -0.14352007533871133i, 0.007962831982062888 + 0.07946395786463721i, -0.14195027394115758 + -0.09339377333392923i }, { 0.16461893700394076 + 0.15861368127275177i, 0.047181123611731615 + -0.0584496854174535i, -0.05343490017228445 + 0.10171591803318422i, 0.09147076764433563 + -0.043613265445315165i }, { -0.013312422816188541 + -0.10977607892677324i, -0.02275204938094832 + -0.03010896620212353i, -0.0565017687612626 + -0.06961616534436757i, 0.05869976863589031 + 0.012803266947953145i } }), Matrix({ { -0.07589736297894221 + 0.021671614148467196i, -0.020948943664164513 + 0.0696582038198966i, -0.03284204972354004 + -0.13832167759029027i, 0.02479360714574966 + -0.0006026928714753118i }, { -0.08674741854261439 + -0.0761206182295479i, 0.06554685645921512 + -0.03932525061288449i, -0.0468047038869158 + -0.08033993831068041i, 0.09801678468870663 + 0.07435871221078424i }, { -0.03498627813951087 + 0.10502791637824678i, 0.04858379787613473 + 0.009371331210101998i, 0.10847782973203453 + 0.0022123900322057392i, 0.11948136054367761 + -0.056386085783716185i }, { -0.08901803164597813 + 0.07656355499805369i, 0.03733572546026861 + -0.09210729189210334i, 0.0054223210597495325 + 0.01869345012821821i, 0.028041786392655484 + -0.08402394277645013i } }), Matrix({ { -0.04097920842375083 + -0.19716627292622016i, 0.12373405809776836 + 0.0821426346151937i, 0.030704640593400025 + 0.02299166332553932i, -0.06736284548128008 + -0.16299334666083454i }, { -0.06807452778894242 + -0.029784130596320485i, -0.020323515342157566 + -0.07308338917625727i, -0.1861305116603731 + 0.09096352478813055i, -0.08118720275666462 + 0.038070572777116916i }, { 0.02518072628833992 + 0.025632925163302338i, -0.25436089974356785 + -0.04376782022340797i, 0.11950485299569932 + 0.046002468392024445i, 0.027221232044871882 + -0.02797980253992913i }, { -0.024893174760021487 + 0.01701556586733973i, -0.13119854174446657 + 0.09289919728564625i, 0.18124736271577813 + -0.08734444095520832i, 0.10468150757933964 + 0.0008710602809218408i } }), Matrix({ { 0.15588227748189218 + -0.07057232569609463i, -0.014608144426906727 + 0.10724686308972897i, -0.10433429509601373 + -0.07484310600170008i, 0.0563343205393002 + -0.0828607325228029i }, { -0.12728101133732317 + 0.056561646121106215i, 0.11625340069161273 + 0.06304869697114651i, -0.023390786428021053 + 0.051835200963701165i, -0.10403298373916173 + -0.04482195475680083i }, { 0.053887020899594434 + 0.015103647696538961i, -0.04297626015092501 + 0.023102167977307596i, 0.13786289973104696 + -0.0034584634798368683i, 0.0335348725860257 + 0.020823074318365404i }, { 0.05431359097377537 + -0.0908912988897172i, -0.011788425414913577 + -0.00021918918985768202i, -0.04107381876683819 + -0.08442483841615374i, -0.07599549767743244 + 0.0899819331422671i } }) }, { QubitIndex{ 3 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.46288111416934674 + -0.428455968654224i, -0.30470510787463434 + -0.43495192763325696i, -0.07273267128299771 + 0.4964993655815135i, -0.25587069935514684 + 0.053541560211092784i }, { -0.1369344919325011 + 0.14720196648844644i, -0.23440068348593893 + 0.09971653336677211i, -0.6032589497990225 + 0.27332256011333567i, 0.42678128943582067 + 0.5233780728533918i }, { -0.1240004781083692 + 0.4206051854354017i, -0.5409501172128782 + -0.583140004219762i, 0.23527125448612232 + -0.17919688542950812i, 0.2644570226348809 + -0.1327940579381492i }, { 0.5477366331187256 + 0.2635276516886732i, 0.11966115881894047 + 0.07801579118304636i, 0.46176916213059915 + -0.09421735559736674i, 0.08939887985724541 + 0.6164679002357877i } }) }, { QubitIndex{ 5 }, QubitIndex{ 4 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_20_2_30_30_30) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.9999999999999986 + -1.802486111757151e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999986, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.5289732994619278 + -2.168404344971009e-18i, 0.003944449011694208 + -0.019511615203592157i }, { 0.00394444901169421 + 0.01951161520359216i, 0.47102670053807066 + 3.6591823321385775e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5289732994619278, 1.0e-7), DoubleNear(0.47102670053807066, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.5037834562021166 + -1.328147661294743e-18i, 0.07266615236341108 + 0.011110578448712001i }, { 0.07266615236341109 + -0.011110578448711992i, 0.4962165437978818 + -4.743384504624082e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5037834562021166, 1.0e-7), DoubleNear(0.4962165437978818, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.475521954122209 + -2.439454888092385e-18i, -0.05803025159583994 + -0.0629034761527234i }, { -0.05803025159583995 + 0.0629034761527234i, 0.5244780458777896 + 6.369687763352339e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.475521954122209, 1.0e-7), DoubleNear(0.5244780458777896, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.5004392873475966 + -1.0164395367051604e-18i, -0.025105278567673795 + 0.015327810020165507i }, { -0.0251052785676738 + -0.015327810020165505i, 0.499560712652402 + -7.860465750519907e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5004392873475966, 1.0e-7), DoubleNear(0.499560712652402, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.4629143637518661 + -2.4936649967166602e-18i, -0.01593887913089484 + 0.046959270725881644i }, { -0.01593887913089484 + -0.046959270725881644i, 0.5370856362481324 + 6.911788849595091e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4629143637518661, 1.0e-7), DoubleNear(0.5370856362481324, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.5910940130341693 + -3.713392440762853e-18i, 0.10947345702649944 + 0.04353449357429638i }, { 0.10947345702649944 + -0.04353449357429638i, 0.40890598696582925 + 1.9109063290057016e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5910940130341693, 1.0e-7), DoubleNear(0.40890598696582925, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.486566555347297 + 8.131516293641283e-20i, -0.011983939534078381 + 0.012633552339443185i }, { -0.011983939534078381 + -0.012633552339443183i, 0.5134334446527016 + -1.883801274693564e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.486566555347297, 1.0e-7), DoubleNear(0.5134334446527016, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.5289732994619278 + -2.168404344971009e-18i, 0.0 + 0.0i, 0.003944449011694208 + -0.019511615203592157i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00394444901169421 + 0.01951161520359216i, 0.0 + 0.0i, 0.47102670053807066 + 3.6591823321385775e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5289732994619278, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.47102670053807066, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.5037834562021166 + -1.328147661294743e-18i, 0.0 + 0.0i, 0.07266615236341108 + 0.011110578448712001i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07266615236341109 + -0.011110578448711992i, 0.0 + 0.0i, 0.4962165437978818 + -4.743384504624082e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5037834562021166, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4962165437978818, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.475521954122209 + -2.439454888092385e-18i, 0.0 + 0.0i, -0.05803025159583994 + -0.0629034761527234i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.05803025159583995 + 0.0629034761527234i, 0.0 + 0.0i, 0.5244780458777896 + 6.369687763352339e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.475521954122209, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5244780458777896, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.5004392873475966 + -1.0164395367051604e-18i, 0.0 + 0.0i, -0.025105278567673795 + 0.015327810020165507i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0251052785676738 + -0.015327810020165505i, 0.0 + 0.0i, 0.499560712652402 + -7.860465750519907e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5004392873475966, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.499560712652402, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.4629143637518661 + -2.4936649967166602e-18i, 0.0 + 0.0i, -0.01593887913089484 + 0.046959270725881644i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.01593887913089484 + -0.046959270725881644i, 0.0 + 0.0i, 0.5370856362481324 + 6.911788849595091e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.4629143637518661, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5370856362481324, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.5910940130341693 + -3.713392440762853e-18i, 0.0 + 0.0i, 0.10947345702649944 + 0.04353449357429638i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.10947345702649944 + -0.04353449357429638i, 0.0 + 0.0i, 0.40890598696582925 + 1.9109063290057016e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5910940130341693, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.40890598696582925, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.486566555347297 + 8.131516293641283e-20i, 0.0 + 0.0i, -0.011983939534078381 + 0.012633552339443185i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011983939534078381 + -0.012633552339443183i, 0.0 + 0.0i, 0.5134334446527016 + -1.883801274693564e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.486566555347297, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5134334446527016, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.2992000921003316 + -2.5478751053409354e-18i, 0.027721044954507668 + -0.004549830859953271i, 0.03843755343118338 + 0.10145129612652834i, 0.015349869967289508 + -0.07594153346109753i }, { 0.027721044954507668 + 0.004549830859953271i, 0.20458336410178507 + 1.2197274440461925e-18i, 0.011799641725120324 + 0.05830984549549699i, 0.0342285989322277 + -0.09034071767781635i }, { 0.03843755343118338 + -0.10145129612652834i, 0.011799641725120324 + -0.05830984549549699i, 0.22977320736159623 + 3.7947076036992655e-19i, -0.023776595942813457 + -0.014961784343638885i }, { 0.015349869967289508 + 0.07594153346109753i, 0.0342285989322277 + 0.09034071767781635i, -0.023776595942813457 + 0.014961784343638887i, 0.2664433364362856 + -8.538092108323347e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2992000921003316, 1.0e-7), DoubleNear(0.20458336410178507, 1.0e-7), DoubleNear(0.22977320736159623, 1.0e-7), DoubleNear(0.2664433364362856, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.25157517324041573 + -3.0222135558033436e-18i, 0.001852841484361302 + -0.009265096097441177i, -0.029799650693524183 + -0.030711468872264752i, -0.0012285052679507492 + 0.001175314361592435i }, { 0.0018528414843613028 + 0.009265096097441177i, 0.22394678088179323 + 5.827586677109586e-19i, 0.0009890979723597136 + -0.0010125472413425418i, -0.02823060090231576 + -0.03219200728045865i }, { -0.029799650693524186 + 0.030711468872264752i, 0.0009890979723597138 + 0.0010125472413425414i, 0.27739812622151205 + 8.538092108323347e-19i, 0.002091607527332906 + -0.010246519106150981i }, { -0.0012285052679507488 + -0.001175314361592435i, -0.028230600902315762 + 0.03219200728045865i, 0.002091607527332907 + 0.010246519106150981i, 0.24707991965627749 + -2.168404344971009e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25157517324041573, 1.0e-7), DoubleNear(0.22394678088179323, 1.0e-7), DoubleNear(0.27739812622151205, 1.0e-7), DoubleNear(0.24707991965627749, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.2654594297422407 + -2.588532686809142e-18i, 0.002067610148179593 + -0.009773972307572106i, -0.011826685618033794 + 0.007385747157240887i, 0.0003233294397009087 + 0.00040725868418467676i }, { 0.002067610148179593 + 0.009773972307572106i, 0.2349798576053559 + 1.5720931501039814e-18i, -0.0001819573190354362 + -0.00046162897646896326i, -0.01327859294964 + 0.007942062862924619i }, { -0.011826685618033794 + -0.0073857471572408885i, -0.00018195731903543577 + 0.00046162897646896374i, 0.26351386971968715 + 4.2012834183813297e-19i, 0.0018768388635146153 + -0.009737642896020051i }, { 0.0003233294397009085 + -0.00040725868418467666i, -0.01327859294964 + -0.007942062862924617i, 0.0018768388635146166 + 0.009737642896020053i, 0.2360468429327148 + -1.2061749168901237e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2654594297422407, 1.0e-7), DoubleNear(0.2349798576053559, 1.0e-7), DoubleNear(0.26351386971968715, 1.0e-7), DoubleNear(0.2360468429327148, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.24641801557927842 + -1.3552527156068805e-18i, 0.0020100632262337386 + -0.009086201598317667i, -0.0057571523185526545 + 0.022601724247618492i, 0.0011189338474540142 + 0.0001299544767704558i }, { 0.00201006322623374 + 0.009086201598317667i, 0.2164963481725877 + -1.1384122811097797e-18i, -0.0005597565192647527 + -0.00029397998532367317i, -0.010181726812342185 + 0.024357546478263152i }, { -0.005757152318552656 + -0.022601724247618492i, -0.000559756519264753 + 0.0002939799853236727i, 0.2825552838826494 + -8.131516293641283e-19i, 0.0019343857854604697 + -0.010425413605274492i }, { 0.001118933847454014 + -0.00012995447677045582i, -0.010181726812342185 + -0.024357546478263156i, 0.00193438578546047 + 0.010425413605274492i, 0.25453035236548305 + 1.5043305143236374e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24641801557927842, 1.0e-7), DoubleNear(0.2164963481725877, 1.0e-7), DoubleNear(0.2825552838826494, 1.0e-7), DoubleNear(0.25453035236548305, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.31272692339602465 + -2.791820594150174e-18i, 0.0023465087451406035 + -0.011529549726609996i, 0.057475729516512294 + 0.022997070348418858i, 0.0012410242584628612 + -0.00199455046654236i }, { 0.002346508745140605 + 0.011529549726609994i, 0.2783670896381446 + -9.215718466126788e-19i, -0.0004634298372071634 + 0.0023171667577064i, 0.05199772750998715 + 0.020537423225877524i }, { 0.057475729516512294 + -0.022997070348418858i, -0.0004634298372071633 + -0.0023171667577064i, 0.21624637606590313 + 6.2341624917916505e-19i, 0.001597940266553605 + -0.007982065476982162i }, { 0.0012410242584628614 + 0.00199455046654236i, 0.05199772750998715 + -0.020537423225877524i, 0.001597940266553605 + 0.007982065476982162i, 0.19265961089992611 + 1.2874900798265365e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.31272692339602465, 1.0e-7), DoubleNear(0.2783670896381446, 1.0e-7), DoubleNear(0.21624637606590313, 1.0e-7), DoubleNear(0.19265961089992611, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.2572411818220761 + -7.589415207398531e-19i, 0.0019387571499385886 + -0.009693509820886442i, -0.006352245810539597 + 0.006422354861819505i, 0.0003322120423346532 + 0.00038363328562635013i }, { 0.001938757149938589 + 0.009693509820886443i, 0.22932537352522087 + 8.402566836762659e-19i, -0.0004533676448936299 + -0.0002869068889175967i, -0.0056316937235387846 + 0.00621119747762368i }, { -0.006352245810539598 + -0.0064223548618195046i, -0.0004533676448936299 + 0.0002869068889175965i, 0.2717321176398517 + -1.4094628242311558e-18i, 0.0020056918617556195 + -0.009818105382705715i }, { 0.0003322120423346534 + -0.0003836332856263499i, -0.005631693723538786 + -0.006211197477623678i, 0.002005691861755621 + 0.009818105382705715i, 0.2417013270128498 + -4.743384504624082e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2572411818220761, 1.0e-7), DoubleNear(0.22932537352522087, 1.0e-7), DoubleNear(0.2717321176398517, 1.0e-7), DoubleNear(0.2417013270128498, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.23959273186281463 + -1.5449880957918438e-18i, 0.03454521925542979 + 0.0052910801974412605i, -0.02910911259495457 + -0.03132723535195955i, -0.00448119712760143 + -0.004881137808633371i }, { 0.03454521925542979 + -0.005291080197441253i, 0.23592922225939433 + -8.944667923005412e-19i, -0.003946514910352052 + -0.004269221388626083i, -0.028921139000885374 + -0.031576240800763856i }, { -0.02910911259495457 + 0.03132723535195955i, -0.003946514910352052 + 0.004269221388626083i, 0.2641907243393021 + 2.168404344971009e-19i, 0.038120933107981286 + 0.00581949825127074i }, { -0.00448119712760143 + 0.00488113780863337i, -0.028921139000885374 + 0.031576240800763856i, 0.03812093310798129 + -0.00581949825127074i, 0.26028732153848755 + 4.2012834183813297e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.23959273186281463, 1.0e-7), DoubleNear(0.23592922225939433, 1.0e-7), DoubleNear(0.2641907243393021, 1.0e-7), DoubleNear(0.26028732153848755, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.2522160099535437 + -1.0299920638612292e-18i, 0.03628462386364874 + 0.0058399654198062305i, -0.012445752846829247 + 0.007634449611339406i, -0.0016896397091983551 + 0.001314082848381652i }, { 0.03628462386364874 + -0.005839965419806229i, 0.24822327739405287 + 1.3552527156068805e-20i, -0.0019007244490126113 + 0.000770628070423919i, -0.012659525720844552 + 0.0076933604088260995i }, { -0.012445752846829245 + -0.007634449611339406i, -0.0019007244490126137 + -0.0007706280704239186i, 0.25156744624857297 + -2.981555974335137e-19i, 0.03638152849976234 + 0.0052706130289057705i }, { -0.0016896397091983569 + -0.0013140828483816501i, -0.01265952572084455 + -0.0076933604088260995i, 0.03638152849976234 + -0.005270613028905764i, 0.24799326640382896 + -4.87890977618477e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2522160099535437, 1.0e-7), DoubleNear(0.24822327739405287, 1.0e-7), DoubleNear(0.25156744624857297, 1.0e-7), DoubleNear(0.24799326640382896, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.23348272553000818 + -8.673617379884035e-19i, 0.03362844901776421 + 0.005714751237852384i, -0.007652971818668466 + 0.02336457881050171i, -0.0008351883762606055 + 0.004243264406442429i }, { 0.03362844901776421 + -0.00571475123785238i, 0.22943163822185791 + -1.6263032587282567e-18i, -0.0014970213320773169 + 0.0025702368242840005i, -0.008285907312226372 + 0.02359469191537993i }, { -0.007652971818668467 + -0.023364578810501715i, -0.0014970213320773186 + -0.002570236824284002i, 0.2703007306721085 + -4.607859233063394e-19i, 0.039037703345646865 + 0.005395827210859616i }, { -0.0008351883762606042 + -0.0042432644064424275i, -0.008285907312226374 + -0.02359469191537993i, 0.039037703345646865 + -0.0053958272108596125i, 0.2667849055760239 + 1.1519648082658485e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.23348272553000818, 1.0e-7), DoubleNear(0.22943163822185791, 1.0e-7), DoubleNear(0.2703007306721085, 1.0e-7), DoubleNear(0.2667849055760239, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.29774704868762486 + -2.290377089375628e-18i, 0.04295327117907177 + 0.006599135938177061i, 0.05507880328418246 + 0.021960530101094892i, 0.007488723175072254 + 0.004216249899203247i }, { 0.04295327117907177 + -0.006599135938177056i, 0.2933469643465444 + -1.4230153513872246e-18i, 0.008415015647324636 + 0.0021096850737992705i, 0.05439465374231699 + 0.02157396347320149i }, { 0.05507880328418246 + -0.021960530101094895i, 0.008415015647324636 + -0.0021096850737992697i, 0.20603640751449182 + 9.622294280808852e-19i, 0.029712881184339308 + 0.00451144251053494i }, { 0.007488723175072253 + -0.004216249899203248i, 0.05439465374231699 + -0.02157396347320149i, 0.029712881184339304 + -0.004511442510534936i, 0.20286957945133743 + 9.486769009248164e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.29774704868762486, 1.0e-7), DoubleNear(0.2933469643465444, 1.0e-7), DoubleNear(0.20603640751449182, 1.0e-7), DoubleNear(0.20286957945133743, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.2451417099133544 + -1.7618285302889447e-19i, 0.03606955024403735 + 0.005335690228347111i, -0.006030056191607191 + 0.006357052398906228i, -0.001262040471669773 + 0.0012909412170794797i }, { 0.03606955024403735 + -0.005335690228347107i, 0.24142484543394258 + 2.574980159653073e-19i, -0.001213478893134918 + 0.0015410212317007919i, -0.005953883342471191 + 0.006276499940536957i }, { -0.006030056191607191 + -0.006357052398906227i, -0.0012134788931349176 + -0.0015410212317007923i, 0.25864174628876224 + -1.1519648082658485e-18i, 0.036596602119373725 + 0.00577488822036489i }, { -0.0012620404716697725 + -0.0012909412170794797i, -0.005953883342471192 + -0.006276499940536957i, 0.03659660211937373 + -0.005774888220364885i, 0.2547916983639392 + -7.318364664277155e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2451417099133544, 1.0e-7), DoubleNear(0.24142484543394258, 1.0e-7), DoubleNear(0.25864174628876224, 1.0e-7), DoubleNear(0.2547916983639392, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.24690765811722484 + -1.8566962203814263e-18i, -0.03273736913480239 + -0.020234414626876012i, -0.012960940889058135 + 0.014822371215765972i, 0.0046980677578451185 + 0.0053028046785458145i }, { -0.03273736913480239 + 0.020234414626876016i, 0.2535316292303717 + 8.402566836762659e-19i, 0.015722277265026084 + -0.005158270902332468i, -0.012144337678615662 + 0.000505438804399532i }, { -0.012960940889058133 + -0.014822371215765974i, 0.015722277265026088 + 0.005158270902332466i, 0.22861429600498412 + -5.827586677109586e-19i, -0.025292882461037558 + -0.04266906152584739i }, { 0.0046980677578451185 + -0.0053028046785458145i, -0.01214433767861566 + -0.0005054388043995324i, -0.025292882461037558 + 0.042669061525847395i, 0.2709464166474178 + -2.0328790734103208e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.24690765811722484, 1.0e-7), DoubleNear(0.2535316292303717, 1.0e-7), DoubleNear(0.22861429600498412, 1.0e-7), DoubleNear(0.2709464166474178, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.2227052740241044 + -4.2012834183813297e-19i, -0.026769471025631365 + -0.029292316972302442i, 0.01244919452961845 + 0.011481626929042706i, -0.012763401980368478 + 0.04399021273131325i }, { -0.026769471025631368 + 0.029292316972302442i, 0.2402090897277617 + -2.0735366548785272e-18i, -0.028832710427002688 + -0.02713018701144486i, -0.02838807366051329 + 0.03547764379683894i }, { 0.01244919452961845 + -0.011481626929042704i, -0.028832710427002684 + 0.02713018701144486i, 0.25281668009810454 + -2.019326546254252e-18i, -0.03126078057020858 + -0.03361115918042096i }, { -0.012763401980368475 + -0.04399021273131325i, -0.02838807366051329 + -0.035477643796838945i, -0.03126078057020858 + 0.03361115918042097i, 0.2842689561500279 + 2.710505431213761e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2227052740241044, 1.0e-7), DoubleNear(0.2402090897277617, 1.0e-7), DoubleNear(0.25281668009810454, 1.0e-7), DoubleNear(0.2842689561500279, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.28093917099358856 + -1.8973538018496328e-18i, -0.03427000988224392 + -0.03723435748357502i, 0.05265896185379489 + 0.02078401408978906i, -0.003718128582570661 + -0.009131365670397447i }, { -0.034270009882243935 + 0.03723435748357502i, 0.31015484204058075 + -1.81603863891322e-18i, -0.009157792297980378 + 0.0040586378062673805i, 0.05681449517270456 + 0.02275047948450732i }, { 0.052658961853794886 + -0.02078401408978906i, -0.009157792297980376 + -0.00405863780626738i, 0.19458278312862043 + -5.421010862427522e-19i, -0.023760241713596017 + -0.025669118669148387i }, { -0.003718128582570661 + 0.009131365670397447i, 0.05681449517270455 + -0.02275047948450732i, -0.023760241713596017 + 0.025669118669148387i, 0.21432320383720885 + 2.4530074152484538e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.28093917099358856, 1.0e-7), DoubleNear(0.31015484204058075, 1.0e-7), DoubleNear(0.19458278312862043, 1.0e-7), DoubleNear(0.21432320383720885, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.23144543643186838 + 1.8973538018496328e-19i, -0.028485386170793995 + -0.030739740117115208i, -0.005660876219839997 + 0.00608938163161093i, 0.001516282956421733 + -0.0003775975015276574i }, { -0.028485386170793995 + 0.030739740117115208i, 0.25512111891542866 + -1.0842021724855044e-19i, -0.0004251797333102967 + -0.0017188037993835122i, -0.006323063314238386 + 0.0065441707078322565i }, { -0.005660876219839997 + -0.006089381631610928i, -0.0004251797333102964 + 0.0017188037993835117i, 0.2440765176903406 + -2.6291902682773483e-18i, -0.029544865425045946 + -0.032163736035608195i }, { 0.0015162829564217327 + 0.0003775975015276572i, -0.006323063314238386 + -0.006544170707832255i, -0.029544865425045953 + 0.0321637360356082i, 0.2693569269623609 + 7.453889935837843e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.23144543643186838, 1.0e-7), DoubleNear(0.25512111891542866, 1.0e-7), DoubleNear(0.2440765176903406, 1.0e-7), DoubleNear(0.2693569269623609, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.2291761932424513 + -9.893344823930228e-19i, -0.0020296473779320375 + 0.007126874669280159i, -0.019647938478752444 + 0.030173751155605597i, -0.01169510163793656 + 0.016239853223488393i }, { -0.0020296473779320362 + -0.007126874669280157i, 0.2337381705094148 + -1.5043305143236374e-18i, 0.01532238526654335 + -0.008161708664065669i, 0.0037090593478576045 + 0.016785519570276047i }, { -0.019647938478752444 + -0.030173751155605597i, 0.015322385266543347 + 0.008161708664065665i, 0.27126309410514526 + -2.710505431213761e-20i, -0.02307563118974176 + 0.008200935350885348i }, { -0.011695101637936559 + -0.016239853223488396i, 0.003709059347857604 + -0.016785519570276047i, -0.023075631189741756 + -0.008200935350885348i, 0.2658225421429872 + 7.182839392716467e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2291761932424513, 1.0e-7), DoubleNear(0.2337381705094148, 1.0e-7), DoubleNear(0.27126309410514526, 1.0e-7), DoubleNear(0.2658225421429872, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.2943761196522047 + -2.4530074152484538e-18i, -0.014052860478125585 + 0.008110562188096132i, 0.05898164409085548 + 0.02286845863979472i, -0.006103084306529955 + 0.003332354404116537i }, { -0.014052860478125585 + -0.008110562188096132i, 0.2967178933819645 + -1.260385025514399e-18i, -0.0034519957542122927 + -0.006782007618592384i, 0.05049181293564397 + 0.020666034934501663i }, { 0.058981644090855476 + -0.02286845863979472i, -0.0034519957542122927 + 0.006782007618592384i, 0.20606316769539182 + 1.4365678785432934e-18i, -0.01105241808954821 + 0.007217247832069374i }, { -0.006103084306529956 + -0.003332354404116537i, 0.05049181293564396 + -0.020666034934501663i, -0.01105241808954821 + -0.007217247832069374i, 0.20284281927043743 + 4.743384504624082e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2943761196522047, 1.0e-7), DoubleNear(0.2967178933819645, 1.0e-7), DoubleNear(0.20606316769539182, 1.0e-7), DoubleNear(0.20284281927043743, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.2436164076064327 + -7.724940478959219e-19i, -0.012063344374637259 + 0.007483282746284249i, -0.0059427239296963395 + 0.006431141193565129i, 0.00021921386989609743 + -0.00029039062223399563i }, { -0.012063344374637259 + -0.007483282746284246i, 0.24295014774086432 + 8.538092108323347e-19i, 0.0005948291413036637 + 7.428809811670811e-05i, -0.006041215604382042 + 0.006202411145878056i }, { -0.00594272392969634 + -0.006431141193565127i, 0.0005948291413036639 + -7.428809811670803e-05i, 0.25682287974116386 + -2.439454888092385e-19i, -0.013041934193036536 + 0.007844527273881258i }, { 0.0002192138698960974 + 0.00029039062223399584i, -0.006041215604382043 + -0.006202411145878056i, -0.013041934193036538 + -0.00784452727388126i, 0.25661056491153766 + -1.6398557858843255e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2436164076064327, 1.0e-7), DoubleNear(0.24295014774086432, 1.0e-7), DoubleNear(0.25682287974116386, 1.0e-7), DoubleNear(0.25661056491153766, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.27397493509452253 + -2.8053731213062427e-18i, -0.009082784425664014 + 0.02747971642282586i, 0.04829885611430307 + 0.01980163602614599i, -0.0036792543251545646 + 0.004890412985599752i }, { -0.009082784425664014 + -0.02747971642282586i, 0.3171190779396468 + -9.0801931945661e-19i, 0.0007564330001975374 + -0.007509513124017314i, 0.06117460091219638 + 0.023732857548150393i }, { 0.04829885611430307 + -0.01980163602614599i, 0.0007564330001975365 + 0.007509513124017316i, 0.1889394286573436 + 3.1170812458958252e-19i, -0.006856094705230823 + 0.019479554303055785i }, { -0.0036792543251545646 + -0.004890412985599752i, 0.06117460091219637 + -0.023732857548150393i, -0.006856094705230825 + -0.019479554303055785i, 0.21996655830848566 + 1.599198204416119e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.27397493509452253, 1.0e-7), DoubleNear(0.3171190779396468, 1.0e-7), DoubleNear(0.1889394286573436, 1.0e-7), DoubleNear(0.21996655830848566, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.22519812001818582 + -5.55653613398821e-19i, -0.007474079865368483 + 0.022753386870838152i, -0.005525459501405171 + 0.005843828144516174i, -0.00010600455905693693 + -0.0004991230679135116i }, { -0.007474079865368481 + -0.022753386870838152i, 0.2613684353291112 + 6.369687763352339e-19i, 0.0008020092413861327 + 0.0007794306411980232i, -0.006458480032673211 + 0.006789724194927011i }, { -0.005525459501405171 + -0.005843828144516172i, 0.0008020092413861326 + -0.0007794306411980233i, 0.23771624373368033 + -1.938011383317839e-18i, -0.008464799265526355 + 0.024205883855043492i }, { -0.00010600455905693703 + 0.0004991230679135116i, -0.006458480032673212 + -0.006789724194927011i, -0.00846479926552636 + -0.024205883855043492i, 0.2757172009190212 + 5.421010862427522e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.22519812001818582, 1.0e-7), DoubleNear(0.2613684353291112, 1.0e-7), DoubleNear(0.23771624373368033, 1.0e-7), DoubleNear(0.2757172009190212, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.28748575591430403 + -1.8973538018496328e-19i, 0.05377723348342221 + 0.021266379918776265i, -0.007067284711806574 + 0.007463581340038307i, -0.001933888759722119 + 0.0008670358278699828i }, { 0.05377723348342221 + -0.021266379918776265i, 0.19908079943299298 + 2.710505431213761e-19i, -0.0008282897036859826 + 0.001933186703119099i, -0.004916654822271808 + 0.005169970999404879i }, { -0.007067284711806574 + -0.007463581340038305i, -0.0008282897036859827 + -0.0019331867031190987i, 0.3036082571198653 + -3.5236570605778894e-18i, 0.05569622354307723 + 0.022268113655520116i }, { -0.001933888759722119 + -0.0008670358278699824i, -0.004916654822271808 + -0.005169970999404878i, 0.055696223543077225 + -0.022268113655520116i, 0.2098251875328363 + 1.6398557858843255e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.28748575591430403, 1.0e-7), DoubleNear(0.19908079943299298, 1.0e-7), DoubleNear(0.3036082571198653, 1.0e-7), DoubleNear(0.2098251875328363, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.2992000921003316 + -2.5478751053409354e-18i, 0.0 + 0.0i, 0.027721044954507668 + -0.004549830859953271i, 0.0 + 0.0i, 0.03843755343118338 + 0.10145129612652834i, 0.0 + 0.0i, 0.015349869967289508 + -0.07594153346109753i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.027721044954507668 + 0.004549830859953271i, 0.0 + 0.0i, 0.20458336410178507 + 1.2197274440461925e-18i, 0.0 + 0.0i, 0.011799641725120324 + 0.05830984549549699i, 0.0 + 0.0i, 0.0342285989322277 + -0.09034071767781635i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03843755343118338 + -0.10145129612652834i, 0.0 + 0.0i, 0.011799641725120324 + -0.05830984549549699i, 0.0 + 0.0i, 0.22977320736159623 + 3.7947076036992655e-19i, 0.0 + 0.0i, -0.023776595942813457 + -0.014961784343638885i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.015349869967289508 + 0.07594153346109753i, 0.0 + 0.0i, 0.0342285989322277 + 0.09034071767781635i, 0.0 + 0.0i, -0.023776595942813457 + 0.014961784343638887i, 0.0 + 0.0i, 0.2664433364362856 + -8.538092108323347e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2992000921003316, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20458336410178507, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22977320736159623, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2664433364362856, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.25157517324041573 + -3.0222135558033436e-18i, 0.0 + 0.0i, 0.001852841484361302 + -0.009265096097441177i, 0.0 + 0.0i, -0.029799650693524183 + -0.030711468872264752i, 0.0 + 0.0i, -0.0012285052679507492 + 0.001175314361592435i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0018528414843613028 + 0.009265096097441177i, 0.0 + 0.0i, 0.22394678088179323 + 5.827586677109586e-19i, 0.0 + 0.0i, 0.0009890979723597136 + -0.0010125472413425418i, 0.0 + 0.0i, -0.02823060090231576 + -0.03219200728045865i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.029799650693524186 + 0.030711468872264752i, 0.0 + 0.0i, 0.0009890979723597138 + 0.0010125472413425414i, 0.0 + 0.0i, 0.27739812622151205 + 8.538092108323347e-19i, 0.0 + 0.0i, 0.002091607527332906 + -0.010246519106150981i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0012285052679507488 + -0.001175314361592435i, 0.0 + 0.0i, -0.028230600902315762 + 0.03219200728045865i, 0.0 + 0.0i, 0.002091607527332907 + 0.010246519106150981i, 0.0 + 0.0i, 0.24707991965627749 + -2.168404344971009e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25157517324041573, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22394678088179323, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27739812622151205, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24707991965627749, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.2654594297422407 + -2.588532686809142e-18i, 0.0 + 0.0i, 0.002067610148179593 + -0.009773972307572106i, 0.0 + 0.0i, -0.011826685618033794 + 0.007385747157240887i, 0.0 + 0.0i, 0.0003233294397009087 + 0.00040725868418467676i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002067610148179593 + 0.009773972307572106i, 0.0 + 0.0i, 0.2349798576053559 + 1.5720931501039814e-18i, 0.0 + 0.0i, -0.0001819573190354362 + -0.00046162897646896326i, 0.0 + 0.0i, -0.01327859294964 + 0.007942062862924619i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011826685618033794 + -0.0073857471572408885i, 0.0 + 0.0i, -0.00018195731903543577 + 0.00046162897646896374i, 0.0 + 0.0i, 0.26351386971968715 + 4.2012834183813297e-19i, 0.0 + 0.0i, 0.0018768388635146153 + -0.009737642896020051i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0003233294397009085 + -0.00040725868418467666i, 0.0 + 0.0i, -0.01327859294964 + -0.007942062862924617i, 0.0 + 0.0i, 0.0018768388635146166 + 0.009737642896020053i, 0.0 + 0.0i, 0.2360468429327148 + -1.2061749168901237e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2654594297422407, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2349798576053559, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26351386971968715, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2360468429327148, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.24641801557927842 + -1.3552527156068805e-18i, 0.0 + 0.0i, 0.0020100632262337386 + -0.009086201598317667i, 0.0 + 0.0i, -0.0057571523185526545 + 0.022601724247618492i, 0.0 + 0.0i, 0.0011189338474540142 + 0.0001299544767704558i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.00201006322623374 + 0.009086201598317667i, 0.0 + 0.0i, 0.2164963481725877 + -1.1384122811097797e-18i, 0.0 + 0.0i, -0.0005597565192647527 + -0.00029397998532367317i, 0.0 + 0.0i, -0.010181726812342185 + 0.024357546478263152i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005757152318552656 + -0.022601724247618492i, 0.0 + 0.0i, -0.000559756519264753 + 0.0002939799853236727i, 0.0 + 0.0i, 0.2825552838826494 + -8.131516293641283e-19i, 0.0 + 0.0i, 0.0019343857854604697 + -0.010425413605274492i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001118933847454014 + -0.00012995447677045582i, 0.0 + 0.0i, -0.010181726812342185 + -0.024357546478263156i, 0.0 + 0.0i, 0.00193438578546047 + 0.010425413605274492i, 0.0 + 0.0i, 0.25453035236548305 + 1.5043305143236374e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.24641801557927842, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2164963481725877, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2825552838826494, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25453035236548305, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.31272692339602465 + -2.791820594150174e-18i, 0.0 + 0.0i, 0.0023465087451406035 + -0.011529549726609996i, 0.0 + 0.0i, 0.057475729516512294 + 0.022997070348418858i, 0.0 + 0.0i, 0.0012410242584628612 + -0.00199455046654236i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.002346508745140605 + 0.011529549726609994i, 0.0 + 0.0i, 0.2783670896381446 + -9.215718466126788e-19i, 0.0 + 0.0i, -0.0004634298372071634 + 0.0023171667577064i, 0.0 + 0.0i, 0.05199772750998715 + 0.020537423225877524i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.057475729516512294 + -0.022997070348418858i, 0.0 + 0.0i, -0.0004634298372071633 + -0.0023171667577064i, 0.0 + 0.0i, 0.21624637606590313 + 6.2341624917916505e-19i, 0.0 + 0.0i, 0.001597940266553605 + -0.007982065476982162i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0012410242584628614 + 0.00199455046654236i, 0.0 + 0.0i, 0.05199772750998715 + -0.020537423225877524i, 0.0 + 0.0i, 0.001597940266553605 + 0.007982065476982162i, 0.0 + 0.0i, 0.19265961089992611 + 1.2874900798265365e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.31272692339602465, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2783670896381446, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21624637606590313, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19265961089992611, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.2572411818220761 + -7.589415207398531e-19i, 0.0 + 0.0i, 0.0019387571499385886 + -0.009693509820886442i, 0.0 + 0.0i, -0.006352245810539597 + 0.006422354861819505i, 0.0 + 0.0i, 0.0003322120423346532 + 0.00038363328562635013i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.001938757149938589 + 0.009693509820886443i, 0.0 + 0.0i, 0.22932537352522087 + 8.402566836762659e-19i, 0.0 + 0.0i, -0.0004533676448936299 + -0.0002869068889175967i, 0.0 + 0.0i, -0.0056316937235387846 + 0.00621119747762368i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006352245810539598 + -0.0064223548618195046i, 0.0 + 0.0i, -0.0004533676448936299 + 0.0002869068889175965i, 0.0 + 0.0i, 0.2717321176398517 + -1.4094628242311558e-18i, 0.0 + 0.0i, 0.0020056918617556195 + -0.009818105382705715i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0003322120423346534 + -0.0003836332856263499i, 0.0 + 0.0i, -0.005631693723538786 + -0.006211197477623678i, 0.0 + 0.0i, 0.002005691861755621 + 0.009818105382705715i, 0.0 + 0.0i, 0.2417013270128498 + -4.743384504624082e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2572411818220761, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22932537352522087, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2717321176398517, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2417013270128498, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.23959273186281463 + -1.5449880957918438e-18i, 0.0 + 0.0i, 0.03454521925542979 + 0.0052910801974412605i, 0.0 + 0.0i, -0.02910911259495457 + -0.03132723535195955i, 0.0 + 0.0i, -0.00448119712760143 + -0.004881137808633371i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03454521925542979 + -0.005291080197441253i, 0.0 + 0.0i, 0.23592922225939433 + -8.944667923005412e-19i, 0.0 + 0.0i, -0.003946514910352052 + -0.004269221388626083i, 0.0 + 0.0i, -0.028921139000885374 + -0.031576240800763856i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.02910911259495457 + 0.03132723535195955i, 0.0 + 0.0i, -0.003946514910352052 + 0.004269221388626083i, 0.0 + 0.0i, 0.2641907243393021 + 2.168404344971009e-19i, 0.0 + 0.0i, 0.038120933107981286 + 0.00581949825127074i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00448119712760143 + 0.00488113780863337i, 0.0 + 0.0i, -0.028921139000885374 + 0.031576240800763856i, 0.0 + 0.0i, 0.03812093310798129 + -0.00581949825127074i, 0.0 + 0.0i, 0.26028732153848755 + 4.2012834183813297e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.23959273186281463, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23592922225939433, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2641907243393021, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.26028732153848755, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.2522160099535437 + -1.0299920638612292e-18i, 0.0 + 0.0i, 0.03628462386364874 + 0.0058399654198062305i, 0.0 + 0.0i, -0.012445752846829247 + 0.007634449611339406i, 0.0 + 0.0i, -0.0016896397091983551 + 0.001314082848381652i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03628462386364874 + -0.005839965419806229i, 0.0 + 0.0i, 0.24822327739405287 + 1.3552527156068805e-20i, 0.0 + 0.0i, -0.0019007244490126113 + 0.000770628070423919i, 0.0 + 0.0i, -0.012659525720844552 + 0.0076933604088260995i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012445752846829245 + -0.007634449611339406i, 0.0 + 0.0i, -0.0019007244490126137 + -0.0007706280704239186i, 0.0 + 0.0i, 0.25156744624857297 + -2.981555974335137e-19i, 0.0 + 0.0i, 0.03638152849976234 + 0.0052706130289057705i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0016896397091983569 + -0.0013140828483816501i, 0.0 + 0.0i, -0.01265952572084455 + -0.0076933604088260995i, 0.0 + 0.0i, 0.03638152849976234 + -0.005270613028905764i, 0.0 + 0.0i, 0.24799326640382896 + -4.87890977618477e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2522160099535437, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24822327739405287, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25156744624857297, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24799326640382896, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.23348272553000818 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.03362844901776421 + 0.005714751237852384i, 0.0 + 0.0i, -0.007652971818668466 + 0.02336457881050171i, 0.0 + 0.0i, -0.0008351883762606055 + 0.004243264406442429i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03362844901776421 + -0.00571475123785238i, 0.0 + 0.0i, 0.22943163822185791 + -1.6263032587282567e-18i, 0.0 + 0.0i, -0.0014970213320773169 + 0.0025702368242840005i, 0.0 + 0.0i, -0.008285907312226372 + 0.02359469191537993i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007652971818668467 + -0.023364578810501715i, 0.0 + 0.0i, -0.0014970213320773186 + -0.002570236824284002i, 0.0 + 0.0i, 0.2703007306721085 + -4.607859233063394e-19i, 0.0 + 0.0i, 0.039037703345646865 + 0.005395827210859616i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0008351883762606042 + -0.0042432644064424275i, 0.0 + 0.0i, -0.008285907312226374 + -0.02359469191537993i, 0.0 + 0.0i, 0.039037703345646865 + -0.0053958272108596125i, 0.0 + 0.0i, 0.2667849055760239 + 1.1519648082658485e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.23348272553000818, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22943163822185791, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2703007306721085, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2667849055760239, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.29774704868762486 + -2.290377089375628e-18i, 0.0 + 0.0i, 0.04295327117907177 + 0.006599135938177061i, 0.0 + 0.0i, 0.05507880328418246 + 0.021960530101094892i, 0.0 + 0.0i, 0.007488723175072254 + 0.004216249899203247i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04295327117907177 + -0.006599135938177056i, 0.0 + 0.0i, 0.2933469643465444 + -1.4230153513872246e-18i, 0.0 + 0.0i, 0.008415015647324636 + 0.0021096850737992705i, 0.0 + 0.0i, 0.05439465374231699 + 0.02157396347320149i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.05507880328418246 + -0.021960530101094895i, 0.0 + 0.0i, 0.008415015647324636 + -0.0021096850737992697i, 0.0 + 0.0i, 0.20603640751449182 + 9.622294280808852e-19i, 0.0 + 0.0i, 0.029712881184339308 + 0.00451144251053494i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.007488723175072253 + -0.004216249899203248i, 0.0 + 0.0i, 0.05439465374231699 + -0.02157396347320149i, 0.0 + 0.0i, 0.029712881184339304 + -0.004511442510534936i, 0.0 + 0.0i, 0.20286957945133743 + 9.486769009248164e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.29774704868762486, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2933469643465444, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20603640751449182, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20286957945133743, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.2451417099133544 + -1.7618285302889447e-19i, 0.0 + 0.0i, 0.03606955024403735 + 0.005335690228347111i, 0.0 + 0.0i, -0.006030056191607191 + 0.006357052398906228i, 0.0 + 0.0i, -0.001262040471669773 + 0.0012909412170794797i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03606955024403735 + -0.005335690228347107i, 0.0 + 0.0i, 0.24142484543394258 + 2.574980159653073e-19i, 0.0 + 0.0i, -0.001213478893134918 + 0.0015410212317007919i, 0.0 + 0.0i, -0.005953883342471191 + 0.006276499940536957i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006030056191607191 + -0.006357052398906227i, 0.0 + 0.0i, -0.0012134788931349176 + -0.0015410212317007923i, 0.0 + 0.0i, 0.25864174628876224 + -1.1519648082658485e-18i, 0.0 + 0.0i, 0.036596602119373725 + 0.00577488822036489i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0012620404716697725 + -0.0012909412170794797i, 0.0 + 0.0i, -0.005953883342471192 + -0.006276499940536957i, 0.0 + 0.0i, 0.03659660211937373 + -0.005774888220364885i, 0.0 + 0.0i, 0.2547916983639392 + -7.318364664277155e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2451417099133544, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24142484543394258, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25864174628876224, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2547916983639392, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.24690765811722484 + -1.8566962203814263e-18i, 0.0 + 0.0i, -0.03273736913480239 + -0.020234414626876012i, 0.0 + 0.0i, -0.012960940889058135 + 0.014822371215765972i, 0.0 + 0.0i, 0.0046980677578451185 + 0.0053028046785458145i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.03273736913480239 + 0.020234414626876016i, 0.0 + 0.0i, 0.2535316292303717 + 8.402566836762659e-19i, 0.0 + 0.0i, 0.015722277265026084 + -0.005158270902332468i, 0.0 + 0.0i, -0.012144337678615662 + 0.000505438804399532i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012960940889058133 + -0.014822371215765974i, 0.0 + 0.0i, 0.015722277265026088 + 0.005158270902332466i, 0.0 + 0.0i, 0.22861429600498412 + -5.827586677109586e-19i, 0.0 + 0.0i, -0.025292882461037558 + -0.04266906152584739i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0046980677578451185 + -0.0053028046785458145i, 0.0 + 0.0i, -0.01214433767861566 + -0.0005054388043995324i, 0.0 + 0.0i, -0.025292882461037558 + 0.042669061525847395i, 0.0 + 0.0i, 0.2709464166474178 + -2.0328790734103208e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.24690765811722484, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2535316292303717, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.22861429600498412, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2709464166474178, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.2227052740241044 + -4.2012834183813297e-19i, 0.0 + 0.0i, -0.026769471025631365 + -0.029292316972302442i, 0.0 + 0.0i, 0.01244919452961845 + 0.011481626929042706i, 0.0 + 0.0i, -0.012763401980368478 + 0.04399021273131325i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.026769471025631368 + 0.029292316972302442i, 0.0 + 0.0i, 0.2402090897277617 + -2.0735366548785272e-18i, 0.0 + 0.0i, -0.028832710427002688 + -0.02713018701144486i, 0.0 + 0.0i, -0.02838807366051329 + 0.03547764379683894i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.01244919452961845 + -0.011481626929042704i, 0.0 + 0.0i, -0.028832710427002684 + 0.02713018701144486i, 0.0 + 0.0i, 0.25281668009810454 + -2.019326546254252e-18i, 0.0 + 0.0i, -0.03126078057020858 + -0.03361115918042096i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012763401980368475 + -0.04399021273131325i, 0.0 + 0.0i, -0.02838807366051329 + -0.035477643796838945i, 0.0 + 0.0i, -0.03126078057020858 + 0.03361115918042097i, 0.0 + 0.0i, 0.2842689561500279 + 2.710505431213761e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2227052740241044, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2402090897277617, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25281668009810454, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2842689561500279, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.28093917099358856 + -1.8973538018496328e-18i, 0.0 + 0.0i, -0.03427000988224392 + -0.03723435748357502i, 0.0 + 0.0i, 0.05265896185379489 + 0.02078401408978906i, 0.0 + 0.0i, -0.003718128582570661 + -0.009131365670397447i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.034270009882243935 + 0.03723435748357502i, 0.0 + 0.0i, 0.31015484204058075 + -1.81603863891322e-18i, 0.0 + 0.0i, -0.009157792297980378 + 0.0040586378062673805i, 0.0 + 0.0i, 0.05681449517270456 + 0.02275047948450732i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.052658961853794886 + -0.02078401408978906i, 0.0 + 0.0i, -0.009157792297980376 + -0.00405863780626738i, 0.0 + 0.0i, 0.19458278312862043 + -5.421010862427522e-19i, 0.0 + 0.0i, -0.023760241713596017 + -0.025669118669148387i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.003718128582570661 + 0.009131365670397447i, 0.0 + 0.0i, 0.05681449517270455 + -0.02275047948450732i, 0.0 + 0.0i, -0.023760241713596017 + 0.025669118669148387i, 0.0 + 0.0i, 0.21432320383720885 + 2.4530074152484538e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.28093917099358856, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.31015484204058075, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19458278312862043, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21432320383720885, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.23144543643186838 + 1.8973538018496328e-19i, 0.0 + 0.0i, -0.028485386170793995 + -0.030739740117115208i, 0.0 + 0.0i, -0.005660876219839997 + 0.00608938163161093i, 0.0 + 0.0i, 0.001516282956421733 + -0.0003775975015276574i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.028485386170793995 + 0.030739740117115208i, 0.0 + 0.0i, 0.25512111891542866 + -1.0842021724855044e-19i, 0.0 + 0.0i, -0.0004251797333102967 + -0.0017188037993835122i, 0.0 + 0.0i, -0.006323063314238386 + 0.0065441707078322565i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005660876219839997 + -0.006089381631610928i, 0.0 + 0.0i, -0.0004251797333102964 + 0.0017188037993835117i, 0.0 + 0.0i, 0.2440765176903406 + -2.6291902682773483e-18i, 0.0 + 0.0i, -0.029544865425045946 + -0.032163736035608195i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0015162829564217327 + 0.0003775975015276572i, 0.0 + 0.0i, -0.006323063314238386 + -0.006544170707832255i, 0.0 + 0.0i, -0.029544865425045953 + 0.0321637360356082i, 0.0 + 0.0i, 0.2693569269623609 + 7.453889935837843e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.23144543643186838, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25512111891542866, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2440765176903406, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2693569269623609, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.2291761932424513 + -9.893344823930228e-19i, 0.0 + 0.0i, -0.0020296473779320375 + 0.007126874669280159i, 0.0 + 0.0i, -0.019647938478752444 + 0.030173751155605597i, 0.0 + 0.0i, -0.01169510163793656 + 0.016239853223488393i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0020296473779320362 + -0.007126874669280157i, 0.0 + 0.0i, 0.2337381705094148 + -1.5043305143236374e-18i, 0.0 + 0.0i, 0.01532238526654335 + -0.008161708664065669i, 0.0 + 0.0i, 0.0037090593478576045 + 0.016785519570276047i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.019647938478752444 + -0.030173751155605597i, 0.0 + 0.0i, 0.015322385266543347 + 0.008161708664065665i, 0.0 + 0.0i, 0.27126309410514526 + -2.710505431213761e-20i, 0.0 + 0.0i, -0.02307563118974176 + 0.008200935350885348i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.011695101637936559 + -0.016239853223488396i, 0.0 + 0.0i, 0.003709059347857604 + -0.016785519570276047i, 0.0 + 0.0i, -0.023075631189741756 + -0.008200935350885348i, 0.0 + 0.0i, 0.2658225421429872 + 7.182839392716467e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2291761932424513, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2337381705094148, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.27126309410514526, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2658225421429872, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.2943761196522047 + -2.4530074152484538e-18i, 0.0 + 0.0i, -0.014052860478125585 + 0.008110562188096132i, 0.0 + 0.0i, 0.05898164409085548 + 0.02286845863979472i, 0.0 + 0.0i, -0.006103084306529955 + 0.003332354404116537i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.014052860478125585 + -0.008110562188096132i, 0.0 + 0.0i, 0.2967178933819645 + -1.260385025514399e-18i, 0.0 + 0.0i, -0.0034519957542122927 + -0.006782007618592384i, 0.0 + 0.0i, 0.05049181293564397 + 0.020666034934501663i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.058981644090855476 + -0.02286845863979472i, 0.0 + 0.0i, -0.0034519957542122927 + 0.006782007618592384i, 0.0 + 0.0i, 0.20606316769539182 + 1.4365678785432934e-18i, 0.0 + 0.0i, -0.01105241808954821 + 0.007217247832069374i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.006103084306529956 + -0.003332354404116537i, 0.0 + 0.0i, 0.05049181293564396 + -0.020666034934501663i, 0.0 + 0.0i, -0.01105241808954821 + -0.007217247832069374i, 0.0 + 0.0i, 0.20284281927043743 + 4.743384504624082e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2943761196522047, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2967178933819645, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20606316769539182, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20284281927043743, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.2436164076064327 + -7.724940478959219e-19i, 0.0 + 0.0i, -0.012063344374637259 + 0.007483282746284249i, 0.0 + 0.0i, -0.0059427239296963395 + 0.006431141193565129i, 0.0 + 0.0i, 0.00021921386989609743 + -0.00029039062223399563i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.012063344374637259 + -0.007483282746284246i, 0.0 + 0.0i, 0.24295014774086432 + 8.538092108323347e-19i, 0.0 + 0.0i, 0.0005948291413036637 + 7.428809811670811e-05i, 0.0 + 0.0i, -0.006041215604382042 + 0.006202411145878056i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00594272392969634 + -0.006431141193565127i, 0.0 + 0.0i, 0.0005948291413036639 + -7.428809811670803e-05i, 0.0 + 0.0i, 0.25682287974116386 + -2.439454888092385e-19i, 0.0 + 0.0i, -0.013041934193036536 + 0.007844527273881258i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0002192138698960974 + 0.00029039062223399584i, 0.0 + 0.0i, -0.006041215604382043 + -0.006202411145878056i, 0.0 + 0.0i, -0.013041934193036538 + -0.00784452727388126i, 0.0 + 0.0i, 0.25661056491153766 + -1.6398557858843255e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.2436164076064327, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.24295014774086432, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25682287974116386, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.25661056491153766, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.27397493509452253 + -2.8053731213062427e-18i, 0.0 + 0.0i, -0.009082784425664014 + 0.02747971642282586i, 0.0 + 0.0i, 0.04829885611430307 + 0.01980163602614599i, 0.0 + 0.0i, -0.0036792543251545646 + 0.004890412985599752i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.009082784425664014 + -0.02747971642282586i, 0.0 + 0.0i, 0.3171190779396468 + -9.0801931945661e-19i, 0.0 + 0.0i, 0.0007564330001975374 + -0.007509513124017314i, 0.0 + 0.0i, 0.06117460091219638 + 0.023732857548150393i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.04829885611430307 + -0.01980163602614599i, 0.0 + 0.0i, 0.0007564330001975365 + 0.007509513124017316i, 0.0 + 0.0i, 0.1889394286573436 + 3.1170812458958252e-19i, 0.0 + 0.0i, -0.006856094705230823 + 0.019479554303055785i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.0036792543251545646 + -0.004890412985599752i, 0.0 + 0.0i, 0.06117460091219637 + -0.023732857548150393i, 0.0 + 0.0i, -0.006856094705230825 + -0.019479554303055785i, 0.0 + 0.0i, 0.21996655830848566 + 1.599198204416119e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.27397493509452253, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3171190779396468, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1889394286573436, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.21996655830848566, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.22519812001818582 + -5.55653613398821e-19i, 0.0 + 0.0i, -0.007474079865368483 + 0.022753386870838152i, 0.0 + 0.0i, -0.005525459501405171 + 0.005843828144516174i, 0.0 + 0.0i, -0.00010600455905693693 + -0.0004991230679135116i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007474079865368481 + -0.022753386870838152i, 0.0 + 0.0i, 0.2613684353291112 + 6.369687763352339e-19i, 0.0 + 0.0i, 0.0008020092413861327 + 0.0007794306411980232i, 0.0 + 0.0i, -0.006458480032673211 + 0.006789724194927011i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.005525459501405171 + -0.005843828144516172i, 0.0 + 0.0i, 0.0008020092413861326 + -0.0007794306411980233i, 0.0 + 0.0i, 0.23771624373368033 + -1.938011383317839e-18i, 0.0 + 0.0i, -0.008464799265526355 + 0.024205883855043492i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.00010600455905693703 + 0.0004991230679135116i, 0.0 + 0.0i, -0.006458480032673212 + -0.006789724194927011i, 0.0 + 0.0i, -0.00846479926552636 + -0.024205883855043492i, 0.0 + 0.0i, 0.2757172009190212 + 5.421010862427522e-20i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.22519812001818582, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2613684353291112, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23771624373368033, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2757172009190212, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.28748575591430403 + -1.8973538018496328e-19i, 0.0 + 0.0i, 0.05377723348342221 + 0.021266379918776265i, 0.0 + 0.0i, -0.007067284711806574 + 0.007463581340038307i, 0.0 + 0.0i, -0.001933888759722119 + 0.0008670358278699828i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.05377723348342221 + -0.021266379918776265i, 0.0 + 0.0i, 0.19908079943299298 + 2.710505431213761e-19i, 0.0 + 0.0i, -0.0008282897036859826 + 0.001933186703119099i, 0.0 + 0.0i, -0.004916654822271808 + 0.005169970999404879i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.007067284711806574 + -0.007463581340038305i, 0.0 + 0.0i, -0.0008282897036859827 + -0.0019331867031190987i, 0.0 + 0.0i, 0.3036082571198653 + -3.5236570605778894e-18i, 0.0 + 0.0i, 0.05569622354307723 + 0.022268113655520116i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.001933888759722119 + -0.0008670358278699824i, 0.0 + 0.0i, -0.004916654822271808 + -0.005169970999404878i, 0.0 + 0.0i, 0.055696223543077225 + -0.022268113655520116i, 0.0 + 0.0i, 0.2098251875328363 + 1.6398557858843255e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.28748575591430403, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19908079943299298, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.3036082571198653, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2098251875328363, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.14231471288117264 + -2.2768245622195593e-18i, 0.013160266292795195 + -0.002167554529986683i, 0.01826422026902756 + 0.048244957976108074i, 0.00728366364226095 + -0.036086466727439516i, -0.016850277978711012 + -0.017354789129064116i, -0.002213903483489042 + -0.0010194680516509855i, 0.00372929354630183 + -0.007978107021589385i, -0.004732141716901471 + 0.00474422148661092i }, { 0.013160266292795195 + 0.0021675545299866834i, 0.09727801898164196 + 7.318364664277155e-19i, 0.005581173946660727 + 0.027702244243493823i, 0.01628099898640223 + -0.04295387777866681i, -0.0007999918155155936 + -0.0018199121258238608i, -0.012258834616243556 + -0.01397244622289543i, 0.0029743125861069917 + -0.0029266639452727454i, -0.00821049067390326 + 0.0030969692129560146i }, { 0.018264220269027555 + -0.04824495797610806i, 0.005581173946660728 + -0.027702244243493823i, 0.10926046035924308 + -7.453889935837843e-19i, -0.011307424808433893 + -0.007097541567454495i, -0.008069644601363106 + 0.003457601814532354i, -0.0036367403320994043 + 0.003626065572891448i, -0.012949372714813171 + -0.013356679743200636i, 0.0009853982155382923 + 0.0021947824132434205i }, { 0.0072836636422609485 + 0.036086466727439516i, 0.016280998986402236 + 0.04295387777866681i, -0.011307424808433893 + 0.007097541567454494i, 0.12666876190015125 + -1.4907779871675686e-19i, 0.003886222095239939 + -0.0037953640344358082i, 0.004123129691011052 + -0.007726823203158437i, 0.0017890897878753073 + 0.000807364884481319i, -0.0159717662860722 + -0.01821956105756322i }, { -0.016850277978711015 + 0.017354789129064116i, -0.0007999918155155934 + 0.0018199121258238606i, -0.008069644601363106 + -0.0034576018145323537i, 0.00388622209523994 + 0.003795364034435809i, 0.15688537921915896 + -2.710505431213761e-19i, 0.014560778661712473 + -0.002382276329966588i, 0.020173333162155825 + 0.05320633815042028i, 0.008066206325028559 + -0.039855066733658004i }, { -0.002213903483489041 + 0.0010194680516509855i, -0.012258834616243558 + 0.01397244622289543i, -0.0036367403320994043 + -0.003626065572891448i, 0.004123129691011053 + 0.007726823203158437i, 0.014560778661712473 + 0.002382276329966588i, 0.10730534512014311 + 4.87890977618477e-19i, 0.006218467778459597 + 0.030607601252003167i, 0.017947599945825468 + -0.04738683989914953i }, { 0.003729293546301831 + 0.007978107021589385i, 0.0029743125861069917 + 0.002926663945272746i, -0.012949372714813171 + 0.013356679743200638i, 0.0017890897878753073 + -0.0008073648844813191i, 0.020173333162155825 + -0.05320633815042027i, 0.006218467778459596 + -0.030607601252003167i, 0.12051274700235313 + 1.1248597539537109e-18i, -0.012469171134379566 + -0.007864242776184392i }, { -0.004732141716901471 + -0.00474422148661092i, -0.00821049067390326 + -0.003096969212956014i, 0.0009853982155382927 + -0.0021947824132434205i, -0.015971766286072202 + 0.018219561057563224i, 0.008066206325028559 + 0.039855066733658004i, 0.017947599945825465 + 0.04738683989914953i, -0.012469171134379566 + 0.007864242776184392i, 0.13977457453613437 + -7.047314121155779e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.14231471288117264, 1.0e-7), DoubleNear(0.09727801898164196, 1.0e-7), DoubleNear(0.10926046035924308, 1.0e-7), DoubleNear(0.12666876190015125, 1.0e-7), DoubleNear(0.15688537921915896, 1.0e-7), DoubleNear(0.10730534512014311, 1.0e-7), DoubleNear(0.12051274700235313, 1.0e-7), DoubleNear(0.13977457453613437, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.15021339742823397 + -3.3745792618611326e-18i, 0.013957526961633836 + -0.002150574010448854i, 0.019245082386883213 + 0.05089343378186484i, 0.008076663092488726 + -0.03814829718186969i, -0.006703767085593835 + 0.004240535979430802i, -0.0003676991358921265 + 0.0006773253039876426i, -0.002259163483647667 + -0.0017572427779751552i, 0.0014423303089422868 + 0.0015710759728479254i }, { 0.013957526961633836 + 0.002150574010448854i, 0.10200261252530973 + 2.3445871979999033e-18i, 0.006203248496017123 + 0.02926039862283594i, 0.017039541476765525 + -0.045053468362058605i, -0.0007245048889066014 + 8.095196117250298e-06i, -0.00574198576123541 + 0.0033939136319086037i, -0.0005327351699608109 + -0.001436301822230503i, 0.0005695237744493117 + 0.0030713256263568073i }, { 0.019245082386883217 + -0.05089343378186483i, 0.006203248496017123 + -0.029260398622835943i, 0.11524603231400671 + 7.860465750519907e-19i, -0.011889916813454245 + -0.007623398297123252i, 0.0005436378993786083 + 0.0027757766963906246i, 0.001066133826054009 + 0.0011927224780088278i, -0.00512291853243996 + 0.0031452111778100846i, 0.0006910285755930353 + -0.00027006661980296585i }, { 0.008076663092488725 + 0.03814829718186969i, 0.017039541476765528 + 0.045053468362058605i, -0.011889916813454244 + 0.007623398297123251i, 0.13297724508004616 + -7.724940478959219e-19i, -0.0007227394706780079 + -0.0018743136491316064i, -0.0024443623483912194 + -0.0020051486259667056i, 0.0005425475698711651 + -0.0004697241725862136i, -0.007536607188404591 + 0.004548149231016015i }, { -0.006703767085593837 + -0.004240535979430803i, -0.0007245048889066008 + -8.095196117249837e-06i, 0.0005436378993786063 + -0.0027757766963906238i, -0.0007227394706780073 + 0.0018743136491316064i, 0.14898669467209766 + 8.267041565201971e-19i, 0.013763517992873828 + -0.002399256849504417i, 0.01919247104430017 + 0.050557862344663515i, 0.007273206874800782 + -0.03779323627922783i }, { -0.00036769913589212685 + -0.0006773253039876428i, -0.005741985761235408 + -0.0033939136319086037i, 0.0010661338260540077 + -0.0011927224780088278i, -0.0024443623483912202 + 0.0020051486259667056i, 0.013763517992873831 + 0.002399256849504417i, 0.10258075157647534 + -1.1248597539537109e-18i, 0.005596393229103201 + 0.029049446872661054i, 0.017189057455462176 + -0.04528724931575774i }, { -0.002259163483647669 + 0.001757242777975157i, -0.0005327351699608114 + 0.0014363018222305025i, -0.005122918532439959 + -0.003145211177810086i, 0.000542547569871165 + 0.0004697241725862136i, 0.01919247104430017 + -0.05055786234466351i, 0.0055963932291032015 + -0.029049446872661047i, 0.1145271750475895 + -4.0657581468206416e-19i, -0.011886679129359215 + -0.007338386046515634i }, { 0.0014423303089422862 + -0.001571075972847926i, 0.0005695237744493121 + -0.0030713256263568064i, 0.0006910285755930355 + 0.0002700666198029661i, -0.007536607188404591 + -0.004548149231016013i, 0.007273206874800782 + 0.03779323627922783i, 0.017189057455462176 + 0.04528724931575774i, -0.011886679129359213 + 0.007338386046515635i, 0.1334660913562395 + -8.131516293641283e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.15021339742823397, 1.0e-7), DoubleNear(0.10200261252530973, 1.0e-7), DoubleNear(0.11524603231400671, 1.0e-7), DoubleNear(0.13297724508004616, 1.0e-7), DoubleNear(0.14898669467209766, 1.0e-7), DoubleNear(0.10258075157647534, 1.0e-7), DoubleNear(0.1145271750475895, 1.0e-7), DoubleNear(0.1334660913562395, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.139451472836715 + -6.369687763352339e-19i, 0.012994814817244318 + -0.0018643758398235993i, 0.017883632116047297 + 0.04724049534466702i, 0.007951215502742932 + -0.035374746878127805i, -0.003248816368051963 + 0.012783544126278235i, 0.00042009592687412654 + 0.0015646792025855714i, -0.00476818153575226 + 0.0005426541126590734i, 0.00445986462170881 + 0.0003970081590083164i }, { 0.012994814817244318 + 0.0018643758398235993i, 0.09403125269329321 + -2.303929616531697e-19i, 0.006063455038259722 + 0.027148827260883832i, 0.015744816901716918 + -0.04152574410681463i, -0.0006793089362841475 + 0.0005838890841337314i, -0.004404155450616503 + 0.01058103468422348i, -0.0016541025380812197 + -0.0009098833499592417i, 0.003932993159491654 + 0.003700610293783356i }, { 0.017883632116047293 + -0.04724049534466701i, 0.006063455038259722 + -0.02714882726088383i, 0.10696654274256345 + -7.182839392716467e-19i, -0.010984751591010578 + -0.007221825758494067i, 0.003908486107407634 + 0.00276186677538759i, 0.003393496993700838 + 0.0003094455231599804i, -0.002508335950500691 + 0.009818180121340257i, 0.0006988379205798877 + -0.0014347247258151158i }, { 0.007951215502742932 + 0.035374746878127805i, 0.01574481690171692 + 0.04152574410681463i, -0.010984751591010578 + 0.007221825758494067i, 0.12246509547929446 + -9.0801931945661e-19i, -0.0021273806843090364 + -0.0011727324788489313i, -0.005405507439484951 + -0.00019162995110358973i, 0.00011955241701939477 + -0.0008778690694574045i, -0.00577757136172568 + 0.013776511794039676i }, { -0.0032488163680519646 + -0.012783544126278237i, -0.0006793089362841476 + -0.0005838890841337314i, 0.003908486107407634 + -0.0027618667753875918i, -0.0021273806843090373 + 0.0011727324788489302i, 0.1597486192636166 + -1.9109063290057016e-18i, 0.01472623013726335 + -0.002685455020129672i, 0.020553921315136087 + 0.05421080078186133i, 0.007398654464546574 + -0.040566786582969715i }, { 0.0004200959268741266 + -0.0015646792025855716i, -0.004404155450616502 + -0.010581034684223478i, 0.003393496993700837 + -0.0003094455231599791i, -0.005405507439484952 + 0.00019162995110358962i, 0.01472623013726335 + 0.002685455020129672i, 0.11055211140849186 + 1.4501204056993622e-18i, 0.005736186686860601 + 0.03116101823461316i, 0.01848378203051078 + -0.048814973571001716i }, { -0.004768181535752258 + -0.0005426541126590723i, -0.00165410253808122 + 0.0009098833499592416i, -0.0025083359505006907 + -0.009818180121340255i, 0.00011955241701939472 + 0.0008778690694574041i, 0.020553921315136087 + -0.05421080078186133i, 0.005736186686860601 + -0.03116101823461316i, 0.12280666461903277 + 1.0977546996415732e-18i, -0.012791844351802879 + -0.00773995858514482i }, { 0.00445986462170881 + -0.0003970081590083165i, 0.0039329931594916535 + -0.003700610293783355i, 0.0006988379205798874 + 0.0014347247258151155i, -0.005777571361725683 + -0.013776511794039676i, 0.007398654464546574 + 0.040566786582969715i, 0.018483782030510782 + 0.048814973571001716i, -0.012791844351802879 + 0.00773995858514482i, 0.14397824095699116 + 5.421010862427522e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.139451472836715, 1.0e-7), DoubleNear(0.09403125269329321, 1.0e-7), DoubleNear(0.10696654274256345, 1.0e-7), DoubleNear(0.12246509547929446, 1.0e-7), DoubleNear(0.1597486192636166, 1.0e-7), DoubleNear(0.11055211140849186, 1.0e-7), DoubleNear(0.12280666461903277, 1.0e-7), DoubleNear(0.14397824095699116, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.17686368596959368 + -2.8189256484623115e-18i, 0.016386436771515276 + -0.0026769701610595427i, 0.022731221051273807 + 0.05998270011647373i, 0.009072573711239387 + -0.04486008112975568i, 0.032504189867553365 + 0.013024411807843597i, 0.003245051683332621 + 0.0006416312014183187i, -0.0002320578809747553 + 0.012691886486462231i, 0.004830611174232235 + -0.007714201566325525i }, { 0.016386436771515276 + 0.002676970161059543i, 0.12088336271803121 + 5.285485590866834e-19i, 0.00700628452343036 + 0.03445372223292143i, 0.020222050127797965 + -0.05338356417829667i, 0.002832461152137548 + 0.0017712217145853485i, 0.022574613416629093 + 0.008936118293251295i, -0.0013811263787334139 + 0.006932423715309003i, 0.0077207810560470085 + -0.008475636587258986i }, { 0.022731221051273807 + -0.05998270011647373i, 0.007006284523430358 + -0.034453722232921424i, 0.13586323742643103 + 2.710505431213761e-20i, -0.014039928026374673 + -0.008852579565550451i, 0.008581244943277099 + -0.009361112963570388i, 0.003714029865273461 + -0.005947111877360614i, 0.02497153964895893 + 0.009972658540575259i, -0.00200402742486976 + -0.002636181667960679i }, { 0.009072573711239387 + 0.04486008112975568i, 0.02022205012779797 + 0.05338356417829667i, -0.01403992802637467 + 0.008852579565550453i, 0.15748372692011336 + -1.4501204056993622e-18i, -0.0018231980751927683 + 0.009059349616430927i, -0.00016622929595246205 + 0.011470798037369659i, -0.0032958909893447113 + 0.0005459450431210518i, 0.029423114093358058 + 0.01160130493262623i }, { 0.032504189867553365 + -0.013024411807843597i, 0.002832461152137548 + -0.0017712217145853485i, 0.008581244943277097 + 0.009361112963570388i, -0.001823198075192768 + -0.009059349616430927i, 0.12233640613073793 + 2.710505431213761e-19i, 0.011334608182992392 + -0.0018728606988937281i, 0.015706332379909576 + 0.041468596010054606i, 0.00627729625605012 + -0.03108145233134184i }, { 0.003245051683332621 + -0.0006416312014183186i, 0.022574613416629093 + -0.008936118293251295i, 0.003714029865273461 + 0.005947111877360615i, -0.00016622929595246208 + -0.01147079803736966i, 0.011334608182992392 + 0.0018728606988937281i, 0.08370000138375386 + 6.911788849595091e-19i, 0.004793357201689965 + 0.023856123262575562i, 0.014006548804429732 + -0.036957153499519675i }, { -0.00023205788097475517 + -0.012691886486462233i, -0.0013811263787334143 + -0.006932423715309003i, 0.02497153964895893 + -0.009972658540575257i, -0.003295890989344711 + -0.0005459450431210518i, 0.015706332379909572 + -0.041468596010054606i, 0.004793357201689967 + -0.02385612326257556i, 0.09390996993516518 + 3.5236570605778894e-19i, -0.009736667916438785 + -0.006109204778088434i }, { 0.004830611174232235 + 0.007714201566325525i, 0.0077207810560470085 + 0.008475636587258986i, -0.00200402742486976 + 0.002636181667960679i, 0.029423114093358058 + -0.01160130493262623i, 0.006277296256050119 + 0.03108145233134184i, 0.014006548804429734 + 0.036957153499519675i, -0.009736667916438787 + 0.006109204778088434i, 0.10895960951617226 + 5.963111948670274e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.17686368596959368, 1.0e-7), DoubleNear(0.12088336271803121, 1.0e-7), DoubleNear(0.13586323742643103, 1.0e-7), DoubleNear(0.15748372692011336, 1.0e-7), DoubleNear(0.12233640613073793, 1.0e-7), DoubleNear(0.08370000138375386, 1.0e-7), DoubleNear(0.09390996993516518, 1.0e-7), DoubleNear(0.10895960951617226, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.14585081198540797 + -6.2341624917916505e-19i, 0.013458485389647836 + -0.002340602360476401i, 0.019065593297345095 + 0.0491522824564474i, 0.0074309895845765875 + -0.03706410410833894i, -0.0037280895574776816 + 0.003797344907199686i, -0.00012661672878016748 + 0.00042629503619967426i, -0.001695396805985386 + -0.00034341323006323516i, 0.0008559318118329826 + 0.0010520909857203184i }, { 0.013458485389647836 + 0.002340602360476401i, 0.09929089792794644 + 4.472333961502706e-19i, 0.005682095214437372 + 0.028300941313028787i, 0.017003956946692256 + -0.04381659222810029i, -0.0004735339016068838 + 0.00020624234654415124i, -0.0023019666341295084 + 0.0025597074917065423i, -0.0008786354220099157 + -0.0005966350157319848i, 0.00043335633431561304 + 0.0016343544471427145i }, { 0.01906559329734509 + -0.0491522824564474i, 0.005682095214437372 + -0.028300941313028783i, 0.11139036983666813 + -1.3552527156068805e-19i, -0.011519728239709245 + -0.0073529074604100405i, 0.0003954563104008207 + 0.001800398064581827i, 0.0005856235852116623 + 0.0007147700974856249i, -0.002624156253061915 + 0.00262500995461982i, 0.00045882877111482075 + -4.2661750573324146e-05i }, { 0.0074309895845765875 + 0.03706410410833894i, 0.01700395694669226 + 0.04381659222810029i, -0.011519728239709245 + 0.007352907460410042i, 0.13003447559727443 + 3.9302328752599536e-19i, -0.001231788909302083 + -0.0008462090254716412i, -0.0016089352035357387 + -0.00025937683288103505i, 2.01662567132539e-05 + -0.000493149235461748i, -0.0033297270894092766 + 0.0036514899859171374i }, { -0.003728089557477682 + -0.0037973449071996845i, -0.0004735339016068839 + -0.00020624234654415135i, 0.00039545631040082085 + -0.0018003980645818274i, -0.001231788909302083 + 0.0008462090254716412i, 0.15334928011492363 + -1.9244588561617704e-18i, 0.014262559564859832 + -0.0022092284994768697i, 0.019371960133838288 + 0.05229901367008095i, 0.00791888038271292 + -0.03887742935275858i }, { -0.00012661672878016748 + -0.00042629503619967416i, -0.002301966634129509 + -0.0025597074917065423i, 0.0005856235852116621 + -0.000714770097485625i, -0.0016089352035357383 + 0.00025937683288103515i, 0.01426255956485983 + 0.0022092284994768697i, 0.10529246617383864 + 7.724940478959219e-19i, 0.006117546510682952 + 0.030008904182468207i, 0.01722464198553544 + -0.046524125449716056i }, { -0.0016953968059853853 + 0.00034341323006323527i, -0.0008786354220099157 + 0.0005966350157319849i, -0.0026241562530619155 + -0.0026250099546198196i, 2.0166256713253983e-05 + 0.0004931492354617478i, 0.019371960133838288 + -0.05229901367008094i, 0.006117546510682952 + -0.030008904182468203i, 0.11838283752492809 + 5.149960319306146e-19i, -0.012256867703104211 + -0.007608876883228845i }, { 0.0008559318118329822 + -0.0010520909857203184i, 0.00043335633431561304 + -0.001634354447142715i, 0.00045882877111482086 + 4.2661750573324166e-05i, -0.003329727089409277 + -0.003651489985917137i, 0.00791888038271292 + 0.03887742935275858i, 0.01722464198553544 + 0.046524125449716056i, -0.01225686770310421 + 0.007608876883228845i, 0.13640886083901116 + -1.2468324983583301e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.14585081198540797, 1.0e-7), DoubleNear(0.09929089792794644, 1.0e-7), DoubleNear(0.11139036983666813, 1.0e-7), DoubleNear(0.13003447559727443, 1.0e-7), DoubleNear(0.15334928011492363, 1.0e-7), DoubleNear(0.10529246617383864, 1.0e-7), DoubleNear(0.11838283752492809, 1.0e-7), DoubleNear(0.13640886083901116, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.13138241027292735 + -2.4665599424045226e-18i, 0.0010482633617575684 + -0.0048308511192153925i, -0.016093955132215676 + -0.0092174136989521i, -0.0003145471334797091 + 0.000709472760837238i, -0.005820957464133295 + 0.007994225296038073i, 0.0003646617522464062 + 0.0002772693521862143i, 0.003217793605270203 + 0.002447906442402696i, 0.0002223578620460635 + -0.00012257478374067573i }, { 0.0010482633617575686 + 0.004830851119215392i, 0.11552524784429749 + 6.098637220230962e-19i, 0.00035309500094911014 + -0.0004691872336899358i, -0.016643414002586707 + -0.01101700092792391i, -0.0002126714324609357 + -0.00012847137916629378i, -0.007139983424924839 + 0.0068281459197279005i, 3.278836916620074e-05 + 0.00011982214102621942i, 0.0014802741525749166 + 0.0028548982361431188i }, { -0.016093955132215683 + 0.009217413698952102i, 0.00035309500094911014 + 0.0004691872336899356i, 0.1340770194693133 + -1.2197274440461925e-19i, 0.0010193467864220247 + -0.004943121188356714i, 0.00981526091667256 + -0.002723612130262952i, 0.0001503557178318127 + -0.0003858822472916236i, -0.0060057281539005 + -0.0006084781387971862i, -4.133231254549749e-05 + 0.00012998933199846247i }, { -0.0003145471334797089 + -0.0007094727608372379i, -0.01664341400258671 + 0.011017000927923914i, 0.0010193467864220247 + 0.004943121188356714i, 0.1194546097610584 + 9.622294280808852e-19i, 0.0003422517476434915 + 0.0003487638286987534i, 0.005907016348353526 + -0.002434658772069516i, 3.071411342549949e-05 + -0.0003331575973026695i, -0.006138609524715162 + 0.0011139169431967182i }, { -0.005820957464133294 + -0.007994225296038073i, -0.00021267143246093563 + 0.00012847137916629408i, 0.00981526091667256 + 0.002723612130262951i, 0.0003422517476434914 + -0.00034876382869875337i, 0.12019276296748838 + -5.55653613398821e-19i, 0.0008045781226037337 + -0.0044342449782257855i, -0.013705695561308505 + -0.021494055173312654i, -0.00091395813447104 + 0.00046584160075519726i }, { 0.0003646617522464061 + -0.00027726935218621413i, -0.00713998342492484 + -0.0068281459197279i, 0.00015035571783181278 + 0.00038588224729162353i, 0.005907016348353526 + 0.002434658772069516i, 0.0008045781226037343 + 0.0044342449782257855i, 0.10842153303749573 + -2.710505431213761e-20i, 0.0006360029714106035 + -0.0005433600076526059i, -0.011587186899729051 + -0.02117500635253474i }, { 0.003217793605270204 + -0.0024479064424026966i, 3.2788369166200646e-05 + -0.00011982214102621941i, -0.006005728153900501 + 0.0006084781387971849i, 3.071411342549987e-05 + 0.00033315759730266967i, -0.013705695561308505 + 0.021494055173312654i, 0.0006360029714106037 + 0.0005433600076526059i, 0.14332110675219878 + 9.75781955236954e-19i, 0.0010722607409108815 + -0.005303397917794266i }, { 0.00022235786204606345 + 0.00012257478374067576i, 0.001480274152574916 + -0.0028548982361431183i, -4.133231254549755e-05 + -0.00012998933199846255i, -0.00613860952471516 + -0.0011139169431967173i, -0.0009139581344710399 + -0.0004658416007551971i, -0.011587186899729051 + 0.02117500635253474i, 0.0010722607409108824 + 0.0053033979177942656i, 0.12762530989521909 + -1.179069862577986e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13138241027292735, 1.0e-7), DoubleNear(0.11552524784429749, 1.0e-7), DoubleNear(0.1340770194693133, 1.0e-7), DoubleNear(0.1194546097610584, 1.0e-7), DoubleNear(0.12019276296748838, 1.0e-7), DoubleNear(0.10842153303749573, 1.0e-7), DoubleNear(0.14332110675219878, 1.0e-7), DoubleNear(0.12762530989521909, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.1179562308809824 + -2.0328790734103208e-19i, 0.0008707431865337184 + -0.004333136387226782i, -0.012854515484981175 + -0.014098142784660934i, -0.00045921810583425375 + 0.0005422461467568342i, 0.007094707712626746 + 0.004517797195084046i, 0.0002681914647344308 + -0.0004058525817576558i, -0.0067484737654008205 + 0.023195864262616668i, 0.0008146749889954498 + 0.00044304506280916074i }, { 0.0008707431865337195 + 0.004333136387226782i, 0.10474904314312201 + -2.168404344971009e-19i, 0.0005565503600307626 + -0.0004089020674303218i, -0.013914955540650187 + -0.015194174187641508i, -5.7488771805517353e-05 + 0.00010418054057977075i, 0.005354486816991704 + 0.006963829733958661i, -0.000922684327602294 + -6.537979010933691e-05i, -0.0060149282149676575 + 0.020794348468696582i }, { -0.012854515484981177 + 0.014098142784660934i, 0.0005565503600307627 + 0.0004089020674303216i, 0.12846178469829606 + -1.1519648082658485e-18i, 0.0011393200397000203 + -0.004753065211090883i, -0.014185353884248622 + -0.012664029389238706i, -0.0004637123552105547 + 0.0006624074515129777i, -0.0128518600311794 + 0.01808392705253445i, 0.0008507423827195834 + 0.0005358070585281115i }, { -0.00045921810583425353 + -0.0005422461467568344i, -0.013914955540650191 + 0.015194174187641508i, 0.0011393200397000207 + 0.004753065211090883i, 0.11174730502946567 + -9.215718466126788e-19i, 0.0004643131149674643 + -0.0004247721407866596i, -0.01464735654275406 + -0.014466157622206153i, -0.0005022677474592354 + -0.0003981605259034439i, -0.015536213629333887 + 0.017393716744304493i }, { 0.007094707712626746 + -0.004517797195084043i, -5.748877180551743e-05 + -0.00010418054057977105i, -0.014185353884248622 + 0.012664029389238704i, 0.0004643131149674642 + 0.00042477214078665964i, 0.13361894235943333 + -2.8189256484623115e-18i, 0.0009820982978275836 + -0.004931959710214395i, -0.01694513520854301 + -0.016613326087603818i, -0.0007692871621164955 + 0.0006330682148356009i }, { 0.00026819146473443104 + 0.0004058525817576555i, 0.005354486816991704 + -0.006963829733958661i, -0.00046371235521055473 + -0.0006624074515129776i, -0.01464735654275406 + 0.014466157622206153i, 0.0009820982978275834 + 0.004931959710214395i, 0.1191977377386712 + 7.995991022080595e-19i, 0.00043254761232895103 + -0.00060364517391222i, -0.014315645361665567 + -0.016997833092817143i }, { -0.006748473765400819 + -0.023195864262616668i, -0.0009226843276022938 + 6.53797901093371e-05i, -0.012851860031179402 + -0.01808392705253445i, -0.0005022677474592355 + 0.00039816052590344373i, -0.01694513520854301 + 0.016613326087603818i, 0.00043254761232895114 + 0.0006036451739122199i, 0.14893634152321603 + 2.0057740190981832e-18i, 0.000952287487632886 + -0.005493453895060097i }, { 0.00081467498899545 + -0.0004430450628091607i, -0.0060149282149676575 + -0.020794348468696586i, 0.0008507423827195831 + -0.0005358070585281113i, -0.015536213629333887 + -0.017393716744304493i, -0.0007692871621164952 + -0.0006330682148356007i, -0.01431564536166557 + 0.016997833092817147i, 0.0009522874876328863 + 0.005493453895060097i, 0.13533261462681181 + 7.047314121155779e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1179562308809824, 1.0e-7), DoubleNear(0.10474904314312201, 1.0e-7), DoubleNear(0.12846178469829606, 1.0e-7), DoubleNear(0.11174730502946567, 1.0e-7), DoubleNear(0.13361894235943333, 1.0e-7), DoubleNear(0.1191977377386712, 1.0e-7), DoubleNear(0.14893634152321603, 1.0e-7), DoubleNear(0.13533261462681181, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.14862655392760776 + -3.0086610286472748e-18i, 0.0010998456800380913 + -0.005475297181943699i, -0.01755363503494329 + -0.01812788171712749i, -0.0007254721180122966 + 0.0007016134821607374i, 0.027763406043286823 + 0.01099601971374586i, 0.0005959413011146994 + -0.0009453519109288871i, -0.002109224161181833 + -0.004761816057055977i, -0.00018482669671566037 + 4.302687219425617e-05i }, { 0.001099845680038092 + 0.005475297181943699i, 0.13231261706598077 + 1.111307226797642e-18i, 0.0005914821148194612 + -0.0005988485846438289i, -0.01671637484730063 + -0.019106475766447528i, -0.00021205874030761008 + 0.001099294824342054i, 0.024895555810508067 + 0.009787994376043201i, 0.00012200638970357411 + -7.254179653852621e-05i, -0.0016089044213888279 + -0.00436954961334147i }, { -0.017553635034943293 + 0.018127881717127495i, 0.0005914821148194614 + 0.0005988485846438287i, 0.16410036946841688 + 2.168404344971009e-19i, 0.0012466630651025122 + -0.006054252544666296i, -0.004842463299538833 + 0.0020966424361186196i, 3.4318318473805744e-05 + 0.00014947861459366438i, 0.02971232347322547 + 0.012001050634672997i, 0.0006450829573481621 + -0.001049198555613473i }, { -0.0007254721180122963 + -0.0007016134821607371i, -0.01671637484730064 + 0.019106475766447528i, 0.0012466630651025126 + 0.006054252544666296i, 0.14605447257216383 + -2.032879073410321e-18i, -9.268552247115332e-05 + -0.0001513531656063039i, -0.004315328998441543 + 0.001961995370148761i, -0.0002513710968995533 + 0.0012178719333643462i, 0.02710217169947908 + 0.010749428849834325i }, { 0.027763406043286823 + -0.01099601971374586i, -0.0002120587403076101 + -0.001099294824342054i, -0.004842463299538833 + -0.0020966424361186196i, -9.268552247115335e-05 + 0.00015135316560630402i, 0.10294861931280795 + -1.3552527156068805e-20i, 0.0007529958043232109 + -0.003789798915497478i, -0.012246015658580894 + -0.012583587155137261i, -0.0005030331499384527 + 0.00047370087943169784i }, { 0.0005959413011146995 + 0.0009453519109288871i, 0.024895555810508067 + -0.009787994376043201i, 3.431831847380579e-05 + -0.00014947861459366438i, -0.004315328998441543 + -0.001961995370148761i, 0.0007529958043232109 + 0.0037897989154974778i, 0.09163416381581246 + -5.285485590866834e-19i, 0.00039761585754025244 + -0.00041369865669871277i, -0.011514226055015123 + -0.013085531514011125i }, { -0.002109224161181833 + 0.004761816057055977i, 0.00012200638970357416 + 7.254179653852619e-05i, 0.02971232347322547 + -0.012001050634672997i, -0.0002513710968995532 + -0.0012178719333643465i, -0.012246015658580894 + 0.012583587155137261i, 0.0003976158575402524 + 0.00041369865669871277i, 0.1132977567530952 + 6.369687763352339e-19i, 0.0008449444622303943 + -0.004192266561484685i }, { -0.00018482669671566034 + -4.302687219425617e-05i, -0.0016089044213888283 + 0.00436954961334147i, 0.0006450829573481621 + 0.001049198555613473i, 0.02710217169947908 + -0.010749428849834325i, -0.0005030331499384523 + -0.0004737008794316979i, -0.011514226055015123 + 0.013085531514011126i, 0.0008449444622303942 + 0.004192266561484685i, 0.10102544708411365 + 1.81603863891322e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.14862655392760776, 1.0e-7), DoubleNear(0.13231261706598077, 1.0e-7), DoubleNear(0.16410036946841688, 1.0e-7), DoubleNear(0.14605447257216383, 1.0e-7), DoubleNear(0.10294861931280795, 1.0e-7), DoubleNear(0.09163416381581246, 1.0e-7), DoubleNear(0.1132977567530952, 1.0e-7), DoubleNear(0.10102544708411365, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.12237453509648663 + -6.640738306473715e-19i, 0.0009106289592444313 + -0.004604202812873823i, -0.014651354071920053 + -0.014866384125575626i, -0.0006082854181065054 + 0.0006186840319980409i, -0.003019820315571896 + 0.0030820894567678715i, 0.0001542063941807922 + 0.0001835306393240097i, 0.0006221015869235602 + -3.585535145837307e-05i, -1.603888633060859e-05 + -2.1887236627002432e-05i }, { 0.0009106289592444314 + 0.004604202812873824i, 0.10907090133538175 + 8.538092108323347e-19i, 0.0004825206698782201 + -0.00048256113168851323i, -0.01383403209887394 + -0.01587335599153958i, -0.0002224811027201261 + -0.00013734205536452144i, -0.0026410559042681007 + 0.0030072921748430575i, -7.836979300851858e-06 + 5.726927939305993e-05i, 0.0008941813694981726 + -0.0003417421500692844i }, { -0.014651354071920053 + 0.014866384125575626i, 0.0004825206698782201 + 0.00048256113168851323i, 0.13486664672558948 + -9.486769009248164e-20i, 0.0010281281906941574 + -0.00508930700801262i, -1.3181010967720489e-05 + -0.0009934574775636248i, -2.6972233864078302e-05 + -1.3509575806816362e-05i, -0.0033324254949677005 + 0.003340265405051634i, 0.00017800564815386103 + 0.00020010264630234044i }, { -0.0006082854181065052 + -0.0006186840319980409i, -0.013834032098873942 + 0.01587335599153958i, 0.0010281281906941576 + 0.00508930700801262i, 0.12025447218983915 + -1.3552527156068805e-20i, 7.339989408485694e-05 + -2.1772767389935065e-05i, -0.0004119987223425762 + -0.0007253463218198871i, -0.00023088654217350382 + -0.00014956483355307528i, -0.0029906378192706843 + 0.0032039053027806217i }, { -0.003019820315571896 + -0.003082089456767871i, -0.0002224811027201261 + 0.0001373420553645213i, -1.3181010967720331e-05 + 0.0009934574775636248i, 7.339989408485694e-05 + 2.1772767389935106e-05i, 0.1292006381439291 + -2.358139725155972e-18i, 0.0009422125251168708 + -0.004660893284567354i, -0.01514829662160413 + -0.015845084746689126i, -0.0006202198498442438 + 0.0005566303295943942i }, { 0.00015420639418079222 + -0.00018353063932400958i, -0.002641055904268101 + -0.003007292174843057i, -2.697223386407831e-05 + 1.3509575806816335e-05i, -0.00041199872234257606 + 0.0007253463218198871i, 0.0009422125251168714 + 0.004660893284567353i, 0.11487587954641149 + -2.710505431213761e-19i, 0.0005065773024814935 + -0.0005299861096540286i, -0.014396568803441817 + -0.016318651288919073i }, { 0.0006221015869235601 + 3.5855351458372925e-05i, -7.836979300851844e-06 + -5.726927939305993e-05i, -0.0033324254949677013 + -0.0033402654050516335i, -0.00023088654217350387 + 0.00014956483355307518i, -0.015148296621604133 + 0.015845084746689126i, 0.0005065773024814937 + 0.0005299861096540282i, 0.1425314794959226 + 9.486769009248164e-19i, 0.001063479336638749 + -0.005157212098138362i }, { -1.6038886330608606e-05 + 2.1887236627002432e-05i, 0.0008941813694981725 + 0.0003417421500692843i, 0.00017800564815386114 + -0.00020010264630234033i, -0.0029906378192706843 + -0.0032039053027806213i, -0.0006202198498442436 + -0.000556630329594394i, -0.01439656880344182 + 0.016318651288919076i, 0.0010634793366387494 + 0.005157212098138362i, 0.12682544746643834 + -2.0328790734103208e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12237453509648663, 1.0e-7), DoubleNear(0.10907090133538175, 1.0e-7), DoubleNear(0.13486664672558948, 1.0e-7), DoubleNear(0.12025447218983915, 1.0e-7), DoubleNear(0.1292006381439291, 1.0e-7), DoubleNear(0.11487587954641149, 1.0e-7), DoubleNear(0.1425314794959226, 1.0e-7), DoubleNear(0.12682544746643834, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.12244996052798429 + -1.6940658945086007e-18i, 0.0010425482365684579 + -0.004499244667436054i, -0.0007483631694455797 + 0.004315100399666603i, 0.00019184380400707194 + 0.00014548400366601235i, -0.008452468886971341 + 0.01442341415227939i, 0.0007102068842135861 + 0.00025125136736790945i, -0.0054304868013354945 + 0.008490698660499884i, 0.00036018722040128504 + 0.00024676605608405145i }, { 0.0010425482365684583 + 0.004499244667436054i, 0.10672623271446702 + 7.047314121155779e-19i, -0.00012699625561754069 + 9.188635454471105e-05i, -0.001281284208486458 + 0.002811774269613556i, -0.00037510276115423983 + -0.00037327829368183064i, -0.011195469591781101 + 0.01575033700332621i, -0.0002632094762672652 + -0.00016874231480411685i, -0.006264614836601064 + 0.007749154562988511i }, { -0.0007483631694455789 + -0.004315100399666603i, -0.00012699625561754036 + -9.188635454471066e-05i, 0.12396805505129413 + 3.3881317890172014e-19i, 0.000967514989665281 + -0.004586956930881612i, 0.00740575812638143 + -0.003922107586221807i, -0.00017821429642640946 + -0.00023131942120155954i, 0.0026953165684186877 + 0.008178310095339102i, 0.00040872696324042806 + -0.00012129689059745365i }, { 0.00019184380400707194 + -0.00014548400366601235i, -0.0012812842084864574 + -0.002811774269613554i, 0.0009675149896652817 + 0.004586956930881613i, 0.10977011545812065 + -1.8431436932253575e-18i, 0.00011170832898112107 + 0.0002836346859500296i, 0.00791662714016192 + -0.0042396010778438615i, -0.0001846537581105129 + 7.929830835815752e-05i, 0.0010137427794389173 + 0.008607209474936945i }, { -0.008452468886971343 + -0.01442341415227939i, -0.00037510276115424 + 0.0003732782936818305i, 0.00740575812638143 + 0.0039221075862218065i, 0.00011170832898112111 + -0.0002836346859500296i, 0.1430094692142564 + -8.944667923005412e-19i, 0.0010250619116111354 + -0.005274727640136052i, -0.011078322448588215 + 0.0030706467575742835i, 0.00013148563569383674 + 0.00026177468051866436i }, { 0.0007102068842135861 + -0.0002512513673679097i, -0.011195469591781103 + -0.01575033700332621i, -0.00017821429642640908 + 0.0002313194212015596i, 0.00791662714016192 + 0.00423960107784386i, 0.001025061911611135 + 0.005274727640136052i, 0.12825362489088887 + 8.673617379884035e-19i, -5.496106341789551e-05 + -0.0005535153310136742i, -0.011997308741153543 + 0.005130288593311064i }, { -0.005430486801335495 + -0.008490698660499885i, -0.0002632094762672648 + 0.0001687423148041169i, 0.0026953165684186877 + -0.008178310095339102i, -0.0001846537581105129 + -7.929830835815779e-05i, -0.011078322448588217 + -0.0030706467575742856i, -5.496106341789542e-05 + 0.0005535153310136745i, 0.139545814668393 + 8.131516293641283e-20i, 0.0009093238738493343 + -0.00515068596513844i }, { 0.00036018722040128504 + -0.00024676605608405167i, -0.006264614836601064 + -0.007749154562988512i, 0.0004087269632404279 + 0.00012129689059745392i, 0.0010137427794389168 + -0.008607209474936945i, 0.00013148563569383658 + -0.0002617746805186643i, -0.011997308741153543 + -0.005130288593311063i, 0.0009093238738493349 + 0.00515068596513844i, 0.12627672747459415 + 6.369687763352339e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.12244996052798429, 1.0e-7), DoubleNear(0.10672623271446702, 1.0e-7), DoubleNear(0.12396805505129413, 1.0e-7), DoubleNear(0.10977011545812065, 1.0e-7), DoubleNear(0.1430094692142564, 1.0e-7), DoubleNear(0.12825362489088887, 1.0e-7), DoubleNear(0.139545814668393, 1.0e-7), DoubleNear(0.12627672747459415, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.15612679133151613 + -2.3987973066241786e-18i, 0.001221490968061108 + -0.005761404516173078i, -0.006672825949369181 + 0.003839669814796647i, 0.00017452257766490916 + 0.00022642231290489725i, 0.031160518976551917 + 0.012098500613764178i, 0.0006485542275375668 + -0.0010058650738824185i, -0.0026013110506200076 + 0.0017399826448943729i, 6.594478551901449e-05 + 7.445815022981054e-05i }, { 0.0012214909680611085 + 0.005761404516173078i, 0.1382493283206886 + -5.421010862427522e-20i, -0.00010909427001643201 + -0.0002670324284692239i, -0.007380034528756404 + 0.004270892373299485i, -0.00022083915988865274 + 0.0011738686202807686i, 0.027821125114303562 + 0.010769958026030538i, 4.127337436493875e-05 + -7.086714255886385e-05i, -0.003501773255909947 + 0.0015923717592221647i }, { -0.006672825949369181 + -0.0038396698147966472i, -0.00010909427001643164 + 0.0002670324284692243i, 0.1566001320645085 + -3.9302328752599536e-19i, 0.0011250177770794952 + -0.005768145210436917i, -0.0012987210563874271 + -0.0032433225940276195i, -1.2253431814002369e-05 + 6.835557658618874e-05i, 0.026315210539960374 + 0.010898569734654678i, 0.0005924700309252945 + -0.0009886853926599419i }, { 0.00017452257766490905 + -0.00022642231290489757i, -0.007380034528756404 + -0.004270892373299484i, 0.001125017777079496 + 0.005768145210436917i, 0.14011776131745599 + -8.673617379884035e-19i, 0.00011263514031474852 + -1.9420461651804448e-05i, -0.0021532746978248653 + -0.0035386850245647645i, -0.00024259067731851065 + 0.0011432981374256317i, 0.02417660239568359 + 0.009767465199846987i }, { 0.03116051897655192 + -0.012098500613764178i, -0.00022083915988865266 + -0.0011738686202807684i, -0.0012987210563874276 + 0.00324332259402762i, 0.00011263514031474844 + 1.942046165180434e-05i, 0.10933263841072452 + -1.8973538018496328e-19i, 0.0008461191801184851 + -0.004012567791399028i, -0.005153859668664614 + 0.0035460773424442404i, 0.00014880686203599952 + 0.0001808363712797795i }, { 0.000648554227537567 + 0.0010058650738824185i, 0.027821125114303562 + -0.010769958026030537i, -1.2253431814002313e-05 + -6.835557658618877e-05i, -0.0021532746978248653 + 0.003538685024564765i, 0.0008461191801184847 + 0.004012567791399028i, 0.0967305292846673 + 1.6263032587282567e-18i, -7.286304901900418e-05 + -0.00019459654799973934i, -0.005898558420883597 + 0.0036711704896251335i }, { -0.0026013110506200084 + -0.0017399826448943729i, 4.127337436493881e-05 + 7.086714255886381e-05i, 0.026315210539960374 + -0.010898569734654678i, -0.00024259067731851062 + -0.0011432981374256317i, -0.0051538596686646135 + -0.0035460773424442413i, -7.286304901900412e-05 + 0.00019459654799973945i, 0.10691373765517861 + 8.131516293641283e-19i, 0.0007518210864351201 + -0.003969497685583134i }, { 6.594478551901446e-05 + -7.445815022981046e-05i, -0.0035017732559099474 + -0.0015923717592221643i, 0.0005924700309252945 + 0.0009886853926599417i, 0.02417660239568359 + -0.009767465199846987i, 0.00014880686203599952 + -0.00018083637127977908i, -0.005898558420883595 + -0.0036711704896251326i, 0.0007518210864351204 + 0.003969497685583135i, 0.09592908161525882 + -3.3881317890172014e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.15612679133151613, 1.0e-7), DoubleNear(0.1382493283206886, 1.0e-7), DoubleNear(0.1566001320645085, 1.0e-7), DoubleNear(0.14011776131745599, 1.0e-7), DoubleNear(0.10933263841072452, 1.0e-7), DoubleNear(0.0967305292846673, 1.0e-7), DoubleNear(0.10691373765517861, 1.0e-7), DoubleNear(0.09592908161525882, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.12917090065945616 + -8.673617379884035e-19i, 0.0010189961592476026 + -0.004860409352533233i, -0.005686182576810075 + 0.0035886968568179874i, 0.000163087232781126 + 0.0001959204354854882i, -0.003130182929890212 + 0.003308230453385912i, 0.0001730155162912323 + 0.00019785667284985087i, 0.00016851553034434198 + -0.00012430238982148576i, -3.898682951523526e-06 + -6.611028259880954e-06i }, { 0.0010189961592476024 + 0.004860409352533233i, 0.11444550694697654 + 9.486769009248164e-20i, -8.959629972846807e-05 + -0.00022903023826666038i, -0.006377161797827184 + 0.003894585889466261i, -0.0002295573764654725 + -0.00013831445328599257i, -0.0028125409998061277 + 0.003122910740179217i, 2.1106813323371885e-05 + 4.382958429844326e-06i, 5.069833955175547e-05 + -0.00016608823241250986i }, { -0.005686182576810075 + -0.0035886968568179856i, -8.959629972846763e-05 + 0.00022903023826666065i, 0.12807028116261995 + 1.0842021724855044e-19i, 0.0009197609906909861 + -0.004833100468353209i, 0.0003042405244070402 + 0.00011011311391389316i, 6.131195483970561e-06 + -6.375298559069023e-06i, -0.003222062880649385 + 0.0031141244084335936i, 0.0001591965260434209 + 0.00018577661277649927i }, { 0.00016308723278112594 + -0.0001959204354854883i, -0.006377161797827183 + -0.0038945858894662605i, 0.0009197609906909865 + 0.00483310046835321i, 0.11487986657824434 + 7.453889935837843e-19i, -1.0881906337054931e-06 + 3.0099873507000785e-05i, 0.0002905886168966234 + -3.582501579718507e-05i, -0.00022381026842815737 + -0.00014859243563160416i, -0.0028191527237326573 + 0.0030882867374444627i }, { -0.0031301829298902126 + -0.0033082304533859114i, -0.00022955737646547256 + 0.0001383144532859924i, 0.00030424052440704025 + -0.00011011311391389315i, -1.0881906337054792e-06 + -3.009987350700078e-05i, 0.1362885290827845 + -1.7211709488207383e-18i, 0.0010486139889319904 + -0.004913562955038872i, -0.00614050304122372 + 0.0037970503004229i, 0.0001602422069197827 + 0.00021133824869918856i }, { 0.0001730155162912324 + -0.00019785667284985076i, -0.002812540999806128 + -0.0031229107401792165i, 6.131195483970543e-06 + 6.375298559069039e-06i, 0.00029058861689662356 + 3.582501579718513e-05i, 0.0010486139889319907 + 0.004913562955038872i, 0.12053435065837935 + 1.4772254600114998e-18i, -9.236101930696813e-05 + -0.00023259873820230287i, -0.006901431151812817 + 0.004047476973458358i }, { 0.000168515530344342 + 0.00012430238982148574i, 2.110681332337189e-05 + -4.38295842984431e-06i, -0.003222062880649385 + -0.003114124408433593i, -0.00022381026842815743 + 0.00014859243563160408i, -0.006140503041223719 + -0.003797050300422903i, -9.236101930696813e-05 + 0.0002325987382023031i, 0.13544358855706717 + 3.1170812458958252e-19i, 0.0009570778728236292 + -0.0049045424276668425i }, { -3.898682951523541e-06 + 6.6110282598809465e-06i, 5.0698339551755373e-05 + 0.00016608823241251014i, 0.00015919652604342097 + -0.00018577661277649918i, -0.0028191527237326573 + -0.0030882867374444622i, 0.0001602422069197826 + -0.00021133824869918835i, -0.006901431151812817 + -0.004047476973458357i, 0.0009570778728236301 + 0.0049045424276668425i, 0.12116697635447046 + -1.951563910473908e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.12917090065945616, 1.0e-7), DoubleNear(0.11444550694697654, 1.0e-7), DoubleNear(0.12807028116261995, 1.0e-7), DoubleNear(0.11487986657824434, 1.0e-7), DoubleNear(0.1362885290827845, 1.0e-7), DoubleNear(0.12053435065837935, 1.0e-7), DoubleNear(0.13544358855706717, 1.0e-7), DoubleNear(0.12116697635447046, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.14579651580341838 + -1.802486111757151e-18i, 0.0011872306768909487 + -0.005366155392361499i, -0.003369891073503046 + 0.013325348303638298i, 0.0006470988285660376 + 7.648439710079507e-05i, 0.025638441757585697 + 0.010599941928996819i, 0.0005998399547592296 + -0.0008971779373827647i, -0.0008377975650884514 + 0.002106547226103696i, 0.0001799840832039823 + 4.278750673174831e-05i }, { 0.0011872306768909496 + 0.005366155392361499i, 0.12817841929110416 + -1.0028870095490916e-18i, -0.0003426052678571088 + -0.0001493184511080931i, -0.005712893352160969 + 0.014154368119187561i, -0.0001900867251027894 + 0.0010737721169847185i, 0.022660414356717375 + 0.00920169409714917i, 3.359092413047377e-05 + -0.0001127270514390648i, -0.0028414567600661134 + 0.0027838657594960563i }, { -0.003369891073503046 + -0.013325348303638296i, -0.0003426052678571086 + 0.00014931845110809295i, 0.1669304075926063 + -9.893344823930228e-19i, 0.0011592780682496543 + -0.006163394334248496i, 0.0011493034879597672 + -0.003066801829268027i, -4.281701437624817e-05 + 7.394064099029254e-05i, 0.031837287758926594 + 0.012397128419422039i, 0.0006411843037036317 + -0.0010973725291595956i }, { 0.0006470988285660375 + -7.648439710079525e-05i, -0.005712893352160971 + -0.014154368119187561i, 0.001159278068249655 + 0.006163394334248496i, 0.15018867034704042 + 8.131516293641283e-20i, 0.00020925282328757266 + 7.035621307938263e-05i, -0.0003928704877622298 + -0.004442711294749288i, -0.00027334311210437396 + 0.0012433946407216815i, 0.029337313153269776 + 0.011335729128728355i }, { 0.0256384417575857 + -0.010599941928996819i, -0.00019008672510278934 + -0.0010737721169847188i, 0.0011493034879597674 + 0.0030668018292680276i, 0.00020925282328757277 + -7.035621307938255e-05i, 0.10062149977586005 + 4.472333961502706e-19i, 0.0008228325493427899 + -0.003720046205956167i, -0.002387261245049608 + 0.009276375943980194i, 0.00047183501888797667 + 5.3470079669660735e-05i }, { 0.0005998399547592297 + 0.0008971779373827646i, 0.022660414356717375 + -0.00920169409714917i, -4.281701437624818e-05 + -7.394064099029257e-05i, -0.0003928704877622308 + 0.004442711294749288i, 0.0008228325493427903 + 0.003720046205956167i, 0.08831792888148354 + -1.3552527156068805e-19i, -0.00021715125140764395 + -0.00014466153421558006i, -0.0044688334601812145 + 0.010203178359075592i }, { -0.0008377975650884507 + -0.002106547226103696i, 3.3590924130473746e-05 + 0.00011272705143906479i, 0.031837287758926594 + -0.012397128419422039i, -0.00027334311210437396 + -0.0012433946407216815i, -0.00238726124504961 + -0.009276375943980196i, -0.0002171512514076443 + 0.00014466153421557973i, 0.11562487629004309 + 1.7618285302889447e-19i, 0.0007751077172108153 + -0.004262019271025996i }, { 0.00017998408320398223 + -4.278750673174849e-05i, -0.0028414567600661142 + -0.0027838657594960563i, 0.0006411843037036317 + 0.0010973725291595956i, 0.029337313153269776 + -0.011335729128728354i, 0.00047183501888797645 + -5.347007966966057e-05i, -0.004468833460181215 + -0.010203178359075592i, 0.0007751077172108147 + 0.004262019271025996i, 0.10434168201844257 + 1.4230153513872246e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.14579651580341838, 1.0e-7), DoubleNear(0.12817841929110416, 1.0e-7), DoubleNear(0.1669304075926063, 1.0e-7), DoubleNear(0.15018867034704042, 1.0e-7), DoubleNear(0.10062149977586005, 1.0e-7), DoubleNear(0.08831792888148354, 1.0e-7), DoubleNear(0.11562487629004309, 1.0e-7), DoubleNear(0.10434168201844257, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.11984016519958662 + -1.0842021724855044e-19i, 0.0009973278358669686 + -0.004517295268375467i, -0.002700369089742345 + 0.011014043929828432i, 0.000556994595353744 + 6.933827906202352e-05i, -0.0028838390292464356 + 0.003031730775331495i, 0.0001624260497561066 + 0.0001882184732733769i, 6.0780027934257633e-05 + -0.00018805552663021715i, 3.319305976314659e-06 + 7.155908031306927e-06i }, { 0.000997327835866969 + 0.004517295268375467i, 0.10535795481859919 + -4.472333961502706e-19i, -0.00027872373304451927 + -0.0001291376929036864i, -0.004773710775626138 + 0.01173934294100972i, -0.00020769666337346694 + -0.00011877554414160954i, -0.0026416204721587348 + 0.0028120973691846793i, 3.2546216392057616e-05 + 1.326032885735944e-06i, -0.00016678458699119454 + -0.0003110675412832945i }, { -0.0027003690897423435 + -0.01101404392982843i, -0.00027872373304451943 + 0.00012913769290368612i, 0.1374010166224895 + -6.505213034913027e-19i, 0.0009414293140716202 + -0.005176214552510976i, 0.0004110722324765771 + 0.0005403980463511585i, 2.419781234745449e-05 + -5.01390925533276e-06i, -0.003468406781293161 + 0.0033906240864880104i, 0.00016978599257854663 + 0.00019541481235297318i }, { 0.0005569945953537436 + -6.933827906202335e-05i, -0.004773710775626138 + -0.011739342941009721i, 0.0009414293140716199 + 0.005176214552510976i, 0.1239674187066217 + 1.2874900798265365e-18i, -1.820116808142568e-05 + 4.200603682210929e-05i, 0.00039093700890955555 + 0.0002390325948468646i, -0.0002456709815201629 + -0.00016813134477598719i, -0.00299007325138005 + 0.0033991001084390004i }, { -0.002883839029246436 + -0.003031730775331494i, -0.00020769666337346694 + 0.00011877554414160944i, 0.000411072232476577 + -0.0005403980463511585i, -1.820116808142568e-05 + -4.200603682210933e-05i, 0.1265778503796918 + -1.2468324983583301e-18i, 0.0010127353903667702 + -0.0045689063299422i, -0.0030567832288103092 + 0.01158768031779006i, 0.0005619392521002703 + 6.0616197708432285e-05i }, { 0.00016242604975610664 + -0.00018821847327337685i, -0.0026416204721587356 + -0.002812097369184679i, 2.419781234745449e-05 + 5.013909255332757e-06i, 0.00039093700890955555 + -0.00023903259484686482i, 0.0010127353903667709 + 0.0045689063299422i, 0.11113839335398851 + -6.911788849595091e-19i, -0.00028103278622023346 + -0.00016484229241998678i, -0.005408016036716046 + 0.012618203537253434i }, { 6.078002793425753e-05 + 0.00018805552663021715i, 3.2546216392057596e-05 + -1.32603288573596e-06i, -0.003468406781293162 + -0.0033906240864880104i, -0.000245670981520163 + 0.00016813134477598705i, -0.0030567832288103123 + -0.01158768031779006i, -0.0002810327862202335 + 0.00016484229241998656i, 0.1451542672601599 + -1.6263032587282567e-19i, 0.0009929564713888495 + -0.005249199052763516i }, { 3.3193059763146734e-06 + -7.155908031306938e-06i, -0.00016678458699119454 + 0.0003110675412832945i, 0.00016978599257854674 + -0.0001954148123529731i, -0.0029900732513800502 + -0.003399100108439i, 0.0005619392521002704 + -6.0616197708432474e-05i, -0.005408016036716047 + -0.012618203537253434i, 0.00099295647138885 + 0.005249199052763515i, 0.13056293365886132 + 2.168404344971009e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.11984016519958662, 1.0e-7), DoubleNear(0.10535795481859919, 1.0e-7), DoubleNear(0.1374010166224895, 1.0e-7), DoubleNear(0.1239674187066217, 1.0e-7), DoubleNear(0.1265778503796918, 1.0e-7), DoubleNear(0.11113839335398851, 1.0e-7), DoubleNear(0.1451542672601599, 1.0e-7), DoubleNear(0.13056293365886132, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.15198441299347998 + -7.453889935837843e-19i, 0.0011498740731104558 + -0.005727036882764842i, 0.028334589925954955 + 0.011251031975030074i, 0.0006347069438671976 + -0.000993548609465518i, -0.003767011687475153 + 0.0037767358259692308i, 0.00019495878004929543 + 0.00021328279755754333i, -0.000951130035403224 + 0.0005792362282983428i, 5.14674525201376e-06 + 7.505345839920972e-05i }, { 0.0011498740731104564 + 0.005727036882764842i, 0.13550134292082402 + 5.55653613398821e-19i, -0.0002134202461955809 + 0.001159097719320904i, 0.025442643557467254 + 0.01001534794374619i, -0.0002664687284998241 + -0.00017936939562240118i, -0.00330027302433142 + 0.003686845514069076i, -3.867398322960203e-05 + -4.8129220902240164e-05i, -0.0009827587243188948 + 0.00028779959957164004i }, { 0.02833458992595496 + -0.011251031975030076i, -0.00021342024619558074 + -0.001159097719320904i, 0.10525676882859611 + -1.3552527156068805e-20i, 0.0007888830768281329 + -0.003966472938121601i, -0.00037178835074391456 + 0.001116078054614515i, 6.212775096868135e-05 + 4.716132379539854e-05i, -0.0025852341230644437 + 0.0026456190358502747i, 0.0001372532622853578 + 0.00017035048806880677i }, { 0.0006347069438671976 + 0.000993548609465518i, 0.025442643557467254 + -0.01001534794374619i, 0.0007888830768281326 + 0.003966472938121602i, 0.09382403060439685 + 2.846030702774449e-19i, -4.772863612931128e-05 + -7.289929995320568e-07i, -0.00045650135294206804 + 0.0008171086485045839i, -0.0001868989163938058 + -0.00010753749329519554i, -0.0023314206992073646 + 0.0025243519635546035i }, { -0.0037670116874751543 + -0.0037767358259692303i, -0.0002664687284998241 + 0.00017936939562240105i, -0.00037178835074391456 + -0.001116078054614515i, -4.7728636129311296e-05 + 7.289929995320289e-07i, 0.16074251040254467 + -2.0464316005663896e-18i, 0.0011966346720301475 + -0.0058025128438451545i, 0.029141139590557336 + 0.011746038373388782i, 0.0006063173145956637 + -0.0010010018570768423i }, { 0.00019495878004929551 + -0.0002132827975575432i, -0.003300273024331421 + -0.0036868455140690757i, 6.212775096868137e-05 + -4.716132379539851e-05i, -0.00045650135294206815 + -0.0008171086485045838i, 0.0011966346720301483 + 0.005802512843845154i, 0.14286574671732055 + -1.4772254600114998e-18i, -0.0002500095910115825 + 0.001158069038385496i, 0.026555083952519896 + 0.010522075282131334i }, { -0.0009511300354032241 + -0.0005792362282983426i, -3.867398322960205e-05 + 4.8129220902240117e-05i, -0.0025852341230644437 + -0.0026456190358502742i, -0.0001868989163938058 + 0.00010753749329519545i, 0.029141139590557336 + -0.011746038373388782i, -0.00025000959101158254 + -0.001158069038385496i, 0.11098960723730703 + 6.369687763352339e-19i, 0.0008090571897254723 + -0.004015592538860561i }, { 5.146745252013774e-06 + -7.50534583992097e-05i, -0.0009827587243188948 + -0.00028779959957163983i, 0.00013725326228535787 + -0.00017035048806880672i, -0.002331420699207365 + -0.002524351963554603i, 0.0006063173145956639 + 0.0010010018570768423i, 0.026555083952519896 + -0.010522075282131334i, 0.0008090571897254725 + 0.004015592538860561i, 0.09883558029552926 + 1.0028870095490916e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.15198441299347998, 1.0e-7), DoubleNear(0.13550134292082402, 1.0e-7), DoubleNear(0.10525676882859611, 1.0e-7), DoubleNear(0.09382403060439685, 1.0e-7), DoubleNear(0.16074251040254467, 1.0e-7), DoubleNear(0.14286574671732055, 1.0e-7), DoubleNear(0.11098960723730703, 1.0e-7), DoubleNear(0.09883558029552926, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.12450753710209758 + -1.2332799712022613e-18i, 0.01792079657681394 + 0.0030351329638548035i, -0.016314930060441102 + -0.009997045724136757i, -0.0026912323868420428 + -0.0014021693682043203i, -0.00641208388565587 + 0.00750124361396225i, -0.0011231033743669544 + 0.0013212489877276316i, 0.002450116517159925 + 0.002637036939810509i, 0.000393357258406377 + 0.0006776444380211454i }, { 0.017920796576813933 + -0.003035132963854801i, 0.12240012101512726 + -6.2341624917916505e-19i, -0.002011052699853625 + -0.0015994579250605385i, -0.016422439074361285 + -0.010237368902739255i, -0.000681032686100085 + 0.000811858350497041i, -0.0065488570034022645 + 0.007321127601803723i, 0.00023294792104714294 + 8.639183563961947e-06i, 0.0022479512406851938 + 0.0026657677387353054i }, { -0.016314930060441105 + 0.009997045724136759i, -0.002011052699853625 + 0.0015994579250605385i, 0.12770847285144613 + 2.0328790734103208e-19i, 0.018363827286834805 + 0.0028048324559514265i, 0.008108212878062668 + -0.002615515393350396i, 0.0012252715778193783 + 0.0003859345918057135i, -0.006033668961173375 + 0.00013320599737715565i, -0.000566536334831401 + -7.166139345979571e-06i }, { -0.0026912323868420428 + 0.0014021693682043203i, -0.016422439074361285 + 0.010237368902739255i, 0.0183638272868348 + -0.0028048324559514274i, 0.1258231563789256 + 6.369687763352339e-19i, 0.0011217523500033227 + -0.0011117961441934328i, 0.007614064386963418 + -0.0025427555089820716i, -0.0012196917629125263 + -4.123028007312201e-05i, -0.0061106687174422875 + 0.00037223280702237634i }, { -0.0064120838856558705 + -0.00750124361396225i, -0.0006810326861000856 + -0.0008118583504970409i, 0.008108212878062668 + 0.0026155153933503945i, 0.0011217523500033225 + 0.0011117961441934328i, 0.11508519476071706 + -3.1170812458958252e-19i, 0.016624422678615854 + 0.002255947233586457i, -0.012794182534513466 + -0.021330189627822786i, -0.0017899647407593872 + -0.0034789684404290507i }, { -0.0011231033743669548 + -0.0013212489877276298i, -0.0065488570034022645 + -0.0073211276018037225i, 0.0012252715778193778 + -0.00038593459180571413i, 0.007614064386963418 + 0.0025427555089820716i, 0.016624422678615854 + -0.002255947233586452i, 0.11352910124426706 + -2.710505431213761e-19i, -0.001935462210498428 + -0.002669763463565544i, -0.012498699926524089 + -0.021338871898024605i }, { 0.0024501165171599256 + -0.0026370369398105095i, 0.00023294792104714277 + -8.639183563962272e-06i, -0.006033668961173375 + -0.00013320599737715608i, -0.001219691762912528 + 4.1230280073122256e-05i, -0.01279418253451347 + 0.021330189627822786i, -0.0019354622104984281 + 0.0026697634635655444i, 0.13648225148785592 + 1.3552527156068805e-20i, 0.019757105821146488 + 0.0030146657953193136i }, { 0.0003933572584063766 + -0.0006776444380211456i, 0.0022479512406851933 + -0.002665767738735305i, -0.0005665363348314019 + 7.166139345979897e-06i, -0.006110668717442286 + -0.00037223280702237634i, -0.0017899647407593868 + 0.00347896844042905i, -0.012498699926524089 + 0.021338871898024605i, 0.019757105821146488 + -0.003014665795319312i, 0.13446416515956192 + -2.168404344971009e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.12450753710209758, 1.0e-7), DoubleNear(0.12240012101512726, 1.0e-7), DoubleNear(0.12770847285144613, 1.0e-7), DoubleNear(0.1258231563789256, 1.0e-7), DoubleNear(0.11508519476071706, 1.0e-7), DoubleNear(0.11352910124426706, 1.0e-7), DoubleNear(0.13648225148785592, 1.0e-7), DoubleNear(0.13446416515956192, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.11228287161846366 + -3.5236570605778894e-19i, 0.016170397124159526 + 0.0025144236110494498i, -0.013285266834070284 + -0.014578259915775202i, -0.0021415373114312517 + -0.0019466185429077027i, 0.006357770339014807 + 0.00556868137765552i, 0.001357973603411073 + 0.0011629176298853996i, -0.006436381508883142 + 0.022133249365969977i, -0.0014171760496483842 + 0.00303105289236813i }, { 0.016170397124159526 + -0.0025144236110494467i, 0.11042240240564075 + -6.776263578034403e-20i, -0.0017301421247006223 + -0.0023315539634248183i, -0.01348420419156108 + -0.01471405705652724i, 0.0004340883714468544 + 0.0005060374850782471i, 0.006091424190603644 + 0.005912945551387185i, -0.000491729953428026 + 0.0033093385633138277i, -0.006327020471485336 + 0.021856963365343273i }, { -0.013285266834070284 + 0.014578259915775202i, -0.0017301421247006223 + 0.0023315539634248183i, 0.12119985391154453 + -5.149960319306146e-19i, 0.01745805189360469 + 0.003200327626802935i, -0.014374205764300473 + -0.013444123064425094i, -0.0024587429689610866 + -0.001887387267926937i, -0.014010742157683272 + 0.017795897432846194i, -0.0021931619796716787 + 0.00308034677655703i }, { -0.0021415373114312512 + 0.0019466185429077027i, -0.013484204191561081 + 0.01471405705652724i, 0.01745805189360469 + -0.003200327626802933i, 0.11900923581621717 + -1.5585406229479126e-18i, -0.0017750078847828072 + -0.0020546538828112937i, -0.014458504662702213 + -0.013686063947019765i, -0.0019311097035241715 + 0.002064199339205753i, -0.014377331502830016 + 0.017681746363992744i }, { 0.006357770339014809 + -0.005568681377655519i, 0.0004340883714468543 + -0.0005060374850782483i, -0.014374205764300473 + 0.013444123064425094i, -0.0017750078847828057 + 0.002054653882811294i, 0.12730986024435098 + -1.1926223897340549e-18i, 0.018374822131270268 + 0.0027766565863918107i, -0.015823845760884286 + -0.016748975436184345i, -0.0023396598161701783 + -0.0029345192657256685i }, { 0.0013579736034110739 + -0.001162917629885399i, 0.006091424190603641 + -0.005912945551387184i, -0.0024587429689610866 + 0.001887387267926938i, -0.014458504662702213 + 0.013686063947019763i, 0.018374822131270264 + -0.0027766565863918064i, 0.1255068198537536 + -8.267041565201971e-19i, -0.00221637278565143 + -0.0019376674252012643i, -0.015436934809324293 + -0.01686218374423662i }, { -0.006436381508883141 + -0.022133249365969977i, -0.0004917299534280266 + -0.0033093385633138264i, -0.014010742157683276 + -0.017795897432846194i, -0.0019311097035241728 + -0.002064199339205754i, -0.01582384576088429 + 0.016748975436184345i, -0.0022163727856514305 + 0.0019376674252012645i, 0.14299087042775754 + 7.318364664277155e-19i, 0.0206628812143766 + 0.0026191706244678052i }, { -0.001417176049648385 + -0.003031052892368131i, -0.006327020471485334 + -0.021856963365343277i, -0.002193161979671678 + -0.0030803467765570286i, -0.014377331502830016 + -0.017681746363992744i, -0.0023396598161701783 + 0.002934519265725667i, -0.015436934809324293 + 0.01686218374423662i, 0.0206628812143766 + -0.002619170624467806i, 0.14127808572227032 + 1.9786689647860456e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.11228287161846366, 1.0e-7), DoubleNear(0.11042240240564075, 1.0e-7), DoubleNear(0.12119985391154453, 1.0e-7), DoubleNear(0.11900923581621717, 1.0e-7), DoubleNear(0.12730986024435098, 1.0e-7), DoubleNear(0.1255068198537536, 1.0e-7), DoubleNear(0.14299087042775754, 1.0e-7), DoubleNear(0.14127808572227032, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.14152928682886162 + -1.531435568635775e-18i, 0.02041780964304564 + 0.0031299638613457356i, -0.017182343288743476 + -0.018534825833618332i, -0.0026675444642061605 + -0.002869709305877265i, 0.026513018334756625 + 0.010486687914251083i, 0.0035640667601256576 + 0.0020543819054511282i, -0.0018852569974721727 + -0.004586875643539948i, -0.0001860863581240588 + -0.0007764577735582787i }, { 0.02041780964304564 + -0.0031299638613457308i, 0.13940988416472694 + -3.6591823321385775e-19i, -0.002312138987477904 + -0.0025415394261063236i, -0.01708766659350045 + -0.01869953164995669i, 0.004018873443961802 + 0.0009547511043587354i, 0.02614594351903827 + 0.010297326175537979i, -0.0003437390453891159 + -0.0005817557415612759i, -0.0018328715850984886 + -0.004544490026857499i }, { -0.017182343288743476 + 0.018534825833618332i, -0.0023121389874779046 + 0.002541539426106324i, 0.1562177618587633 + -7.589415207398531e-19i, 0.022535461536026133 + 0.0034691720768313256i, -0.004608997198767895 + 0.002032440532326335i, -0.000691065451474985 + 0.00020884170717879813i, 0.028565784949425837 + 0.01147384218684381i, 0.003924656414946596 + 0.0021618679937521175i }, { -0.0026675444642061605 + 0.002869709305877265i, -0.01708766659350045 + 0.01869953164995669i, 0.022535461536026133 + -0.0034691720768313247i, 0.15393708018181745 + -1.0570971181733668e-18i, -0.000632043997407405 + 0.00041534639606211163i, -0.004548795099212482 + 0.0020261972739410456i, 0.004396142203362834 + 0.0011549339694405347i, 0.028248710223278718 + 0.011276637297663511i }, { 0.026513018334756625 + -0.010486687914251083i, 0.004018873443961801 + -0.0009547511043587349i, -0.004608997198767895 + -0.002032440532326335i, -0.0006320439974074048 + -0.00041534639606211174i, 0.09806344503395302 + -1.3552527156068805e-20i, 0.01412740961238415 + 0.002161116336095525i, -0.011926769306211097 + -0.012792409518341215i, -0.0018136526633952695 + -0.0020114285027561054i }, { 0.003564066760125658 + -0.002054381905451129i, 0.02614594351903827 + -0.010297326175537976i, -0.000691065451474985 + -0.00020884170717879824i, -0.0045487950992124816 + -0.0020261972739410456i, 0.01412740961238415 + -0.0021611163360955223i, 0.0965193380946674 + -5.285485590866834e-19i, -0.0016343759228741482 + -0.0017276819625197594i, -0.01183347240738492 + -0.01287670915080717i }, { -0.0018852569974721727 + 0.004586875643539948i, -0.0003437390453891159 + 0.0005817557415612761i, 0.02856578494942584 + -0.01147384218684381i, 0.004396142203362834 + -0.0011549339694405351i, -0.011926769306211095 + 0.012792409518341217i, -0.0016343759228741482 + 0.0017276819625197588i, 0.1079729624805388 + 9.75781955236954e-19i, 0.015585471571955157 + 0.0023503261744394145i }, { -0.0001860863581240588 + 0.0007764577735582786i, -0.0018328715850984886 + 0.004544490026857499i, 0.003924656414946596 + -0.002161867993752119i, 0.028248710223278718 + -0.011276637297663511i, -0.0018136526633952693 + 0.002011428502756105i, -0.011833472407384922 + 0.01287670915080717i, 0.015585471571955157 + -0.0023503261744394145i, 0.10635024135667007 + 1.4772254600114998e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.14152928682886162, 1.0e-7), DoubleNear(0.13940988416472694, 1.0e-7), DoubleNear(0.1562177618587633, 1.0e-7), DoubleNear(0.15393708018181745, 1.0e-7), DoubleNear(0.09806344503395302, 1.0e-7), DoubleNear(0.0965193380946674, 1.0e-7), DoubleNear(0.1079729624805388, 1.0e-7), DoubleNear(0.10635024135667007, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.11662265598085729 + -5.149960319306146e-19i, 0.017154606690608355 + 0.002539204449673102i, -0.01429364117683795 + -0.015289691822483046i, -0.00229236343977376 + -0.002442477124278905i, -0.0028536075503486644 + 0.0030629721740139514i, -0.000591612997611824 + 0.0006145857995916458i, 0.000751130483787669 + -0.0001786896909262439i, 0.0001058021960018583 + -8.257761484170432e-05i }, { 0.01715460669060835 + -0.002539204449673098i, 0.11482278045101109 + 7.047314121155779e-19i, -0.0019377485260143028 + -0.0021240109608865196i, -0.014191744993956043 + -0.015450048294632162i, -0.0005818206145735052 + 0.0007432653626077341i, -0.002807268669491333 + 0.0030264094575969775i, 0.00022068976492009188 + 2.3292403068752555e-05i, 0.0007651524726340637 + -0.0001989078106014136i }, { -0.01429364117683795 + 0.015289691822483046i, -0.0019377485260143028 + 0.0021240109608865196i, 0.12851905393249713 + 3.3881317890172014e-19i, 0.018914943553428997 + 0.002796485778674009i, -0.0001953119545880959 + -0.0008694339455793582i, 1.0696156540253132e-05 + -0.00010022728708186207i, -0.0031764486412585256 + 0.0032940802248922763i, -0.0006704274740579491 + 0.0006763554174878338i }, { -0.002292363439773759 + 0.002442477124278904i, -0.014191744993956045 + 0.015450048294632162i, 0.018914943553429 + -0.0027964857786740094i, 0.1266020649829315 + -4.472333961502706e-19i, -8.578542066151013e-05 + -0.00025199736318554377i, -0.0002298677787222008 + -0.0008493698538041537i, -0.0006316582785614129 + 0.000797755869093058i, -0.0031466146729798587 + 0.0032500904829399794i }, { -0.0028536075503486644 + -0.003062972174013951i, -0.000581820614573505 + -0.0007432653626077342i, -0.00019531195458809573 + 0.0008694339455793581i, -8.578542066151024e-05 + 0.0002519973631855438i, 0.12297007588195734 + -1.0299920638612292e-18i, 0.017390612564821436 + 0.0027518757477681586i, -0.014815471418116621 + -0.0160375435294765i, -0.00218883368782767 + -0.002438660684354466i }, { -0.0005916129976118237 + -0.0006145857995916459i, -0.002807268669491333 + -0.0030264094575969775i, 1.0696156540253008e-05 + 0.00010022728708186207i, -0.00022986777872220066 + 0.0008493698538041538i, 0.01739061256482144 + -0.002751875747768155i, 0.12110644180838323 + -1.599198204416119e-18i, -0.0020087663843377495 + -0.002145210427739563i, -0.014729394006929328 + -0.016126192506131697i }, { 0.000751130483787669 + 0.00017868969092624379i, 0.0002206897649200919 + -2.3292403068752494e-05i, -0.0031764486412585264 + -0.0032940802248922763i, -0.0006316582785614125 + -0.0007977558690930582i, -0.014815471418116621 + 0.016037543529476502i, -0.0020087663843377495 + 0.002145210427739563i, 0.13567167040680495 + -1.2197274440461925e-19i, 0.019205989554552293 + 0.003023012472596731i }, { 0.00010580219600185827 + 8.25776148417044e-05i, 0.0007651524726340637 + 0.00019890781060141342i, -0.0006704274740579486 + -0.0006763554174878339i, -0.003146614672979859 + -0.0032500904829399786i, -0.002188833687827671 + 0.002438660684354466i, -0.01472939400692933 + 0.016126192506131697i, 0.019205989554552293 + -0.00302301247259673i, 0.13368525655555602 + 8.673617379884035e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11662265598085729, 1.0e-7), DoubleNear(0.11482278045101109, 1.0e-7), DoubleNear(0.12851905393249713, 1.0e-7), DoubleNear(0.1266020649829315, 1.0e-7), DoubleNear(0.12297007588195734, 1.0e-7), DoubleNear(0.12110644180838323, 1.0e-7), DoubleNear(0.13567167040680495, 1.0e-7), DoubleNear(0.13368525655555602, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.11567357975372472 + -8.944667923005412e-19i, 0.016598105549700065 + 0.002996618184412224i, -0.0009838093466102986 + 0.0036316492903107874i, -0.00044338644605549586 + 0.0006000259100216651i, -0.00962494364477327 + 0.014992658186177189i, -0.001203951913163945 + 0.0027176133385216393i, -0.005778086377775194 + 0.008201524404622424i, -0.0009836571470717922 + 0.0013615237900005436i }, { 0.016598105549700065 + -0.0029966181844122224i, 0.11350261348872658 + -9.486769009248164e-20i, 0.00014712315818130332 + 0.000395072885431028i, -0.001045838031321739 + 0.0034952253789693718i, -0.0017025260551053996 + 0.0016869381950387423i, -0.01002299483397917 + 0.015181092969428406i, -0.0007142417891379177 + 0.0010519695503735148i, -0.005917015260161366 + 0.008038328818865972i }, { -0.000983809346610299 + -0.0036316492903107874i, 0.00014712315818130246 + -0.00039507288543102727i, 0.11780914577628346 + 2.710505431213761e-20i, 0.01703034346806415 + 0.0027181330534401605i, 0.007641090056298708 + -0.0040871499102425254i, 0.0010035167759767766 + -0.00070484956139004i, 0.0019719718261048042 + 0.008371920624324524i, 0.0003687635369033394 + 0.0015256510679207903i }, { -0.0004433864460554972 + -0.0006000259100216651i, -0.0010458380313217372 + -0.00349522537896937i, 0.017030343468064153 + -0.0027181330534401574i, 0.11592902473313134 + -1.531435568635775e-18i, 0.001138476924235715 + -0.0005070925677609574i, 0.007681295210244642 + -0.0040745587538231435i, 0.00020550472302808273 + 0.0008832986292452577i, 0.0017370875217528007 + 0.008413598945951523i }, { -0.00962494364477327 + -0.014992658186177192i, -0.0017025260551054014 + -0.0016869381950387423i, 0.007641090056298707 + 0.004087149910242524i, 0.0011384769242357142 + 0.0005070925677609568i, 0.136542430199819 + -1.3552527156068805e-19i, 0.019686518313948676 + 0.002843347235394006i, -0.011461943500218947 + 0.0040028003210286186i, -0.0012462532631428592 + 0.0007140569383599868i }, { -0.0012039519131639444 + -0.0027176133385216385i, -0.010022994833979174 + -0.015181092969428406i, 0.0010035167759767764 + 0.00070484956139004i, 0.007681295210244642 + 0.004074558753823143i, 0.019686518313948676 + -0.002843347235394006i, 0.13472066390532628 + 1.0842021724855044e-19i, -0.0020478476071939143 + 0.000375555184992891i, -0.011613687689522811 + 0.004198135029856729i }, { -0.005778086377775195 + -0.008201524404622428i, -0.0007142417891379158 + -0.001051969550373515i, 0.001971971826104804 + -0.008371920624324522i, 0.0002055047230280828 + -0.0008832986292452597i, -0.011461943500218945 + -0.004002800321028619i, -0.002047847607193916 + -0.00037555518499289136i, 0.13375830047228954 + -3.2526065174565133e-19i, 0.019351185031698193 + 0.00255247997546561i }, { -0.0009836571470717905 + -0.0013615237900005436i, -0.005917015260161364 + -0.00803832881886597i, 0.00036876353690334023 + -0.001525651067920789i, 0.0017370875217528005 + -0.008413598945951523i, -0.0012462532631428596 + -0.000714056938359985i, -0.011613687689522813 + -0.0041981350298567295i, 0.019351185031698193 + -0.0025524799754656066i, 0.13206424167069764 + 1.043544591017298e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.11567357975372472, 1.0e-7), DoubleNear(0.11350261348872658, 1.0e-7), DoubleNear(0.11780914577628346, 1.0e-7), DoubleNear(0.11592902473313134, 1.0e-7), DoubleNear(0.136542430199819, 1.0e-7), DoubleNear(0.13472066390532628, 1.0e-7), DoubleNear(0.13375830047228954, 1.0e-7), DoubleNear(0.13206424167069764, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.14833449936241402 + -1.531435568635775e-18i, 0.0213971945026476 + 0.0034319313326396234i, -0.006971913039019395 + 0.004029870059161304i, -0.0009482374432733296 + 0.0007229927018559967i, 0.02969921286965223 + 0.011526827238602828i, 0.0038023971322706904 + 0.002262517753328285i, -0.0029742597078296455 + 0.0016698465949158345i, -0.0003274053873966476 + 0.00023659826197881427i }, { 0.0213971945026476 + -0.003431931332639622i, 0.1460416202897907 + -9.215718466126788e-19i, -0.0011114864480470772 + 0.00046052036803227725i, -0.00708094743910619 + 0.004080692128934828i, 0.004307865543772079 + 0.0009820270620183296i, 0.029282431221203248 + 0.011341631401191888i, -0.00026883709035941934 + -9.945317148235366e-05i, -0.0031288245987003086 + 0.001662507809200703i }, { -0.006971913039019394 + -0.004029870059161304i, -0.0011114864480470787 + -0.0004605203680322767i, 0.14941254932521086 + -7.589415207398531e-19i, 0.021556076676424174 + 0.0031672046055374378i, -0.0016714420123655326 + -0.0033539655191308147i, -0.00022652571498236595 + -0.0001159684010965584i, 0.02537959041453023 + 0.010433702862492063i, 0.003686326042801563 + 0.0019537321458749615i }, { -0.0009482374432733303 + -0.0007229927018559956i, -0.007080947439106191 + -0.0040806921289348284i, 0.021556076676424174 + -0.0031672046055374334i, 0.1473053440567537 + -5.014435047745458e-19i, -0.00012127633812538038 + -0.00044399349656116366i, -0.0017805537418467603 + -0.0034280420994615697i, 0.004107150103552557 + 0.0011276580117809405i, 0.02511222252111374 + 0.0102323320720096i }, { 0.02969921286965223 + -0.011526827238602828i, 0.004307865543772079 + -0.0009820270620183292i, -0.001671442012365533 + 0.0033539655191308147i, -0.00012127633812538054 + 0.0004439934965611638i, 0.10388151059112967 + 5.014435047745458e-19i, 0.014887429361001143 + 0.0024080340871666067i, -0.0054738398078098514 + 0.003604579552178102i, -0.0007414022659250255 + 0.0005910901465256554i }, { 0.003802397132270691 + -0.0022625177533282855i, 0.029282431221203248 + -0.011341631401191887i, -0.000226525714982366 + 0.00011596840109655851i, -0.00178055374184676 + 0.00342804209946157i, 0.01488742936100114 + -0.0024080340871666063i, 0.10218165710426215 + 9.351243737687476e-19i, -0.0007892380009655341 + 0.0003101077023916417i, -0.005578578281738361 + 0.003612668279891272i }, { -0.002974259707829647 + -0.0016698465949158347i, -0.0002688370903594189 + 9.945317148235354e-05i, 0.025379590414530227 + -0.010433702862492065i, 0.004107150103552556 + -0.0011276580117809405i, -0.005473839807809851 + -0.003604579552178103i, -0.000789238000965535 + -0.0003101077023916419i, 0.10215489692336213 + 4.607859233063394e-19i, 0.014825451823338165 + 0.0021034084233683328i }, { -0.0003274053873966473 + -0.00023659826197881454i, -0.0031288245987003095 + -0.0016625078092007027i, 0.003686326042801563 + -0.001953732145874962i, 0.02511222252111374 + -0.0102323320720096i, -0.0007414022659250265 + -0.0005910901465256544i, -0.00557857828173836 + -0.003612668279891271i, 0.014825451823338167 + -0.0021034084233683306i, 0.1006879223470753 + 1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.14833449936241402, 1.0e-7), DoubleNear(0.1460416202897907, 1.0e-7), DoubleNear(0.14941254932521086, 1.0e-7), DoubleNear(0.1473053440567537, 1.0e-7), DoubleNear(0.10388151059112967, 1.0e-7), DoubleNear(0.10218165710426215, 1.0e-7), DoubleNear(0.10215489692336213, 1.0e-7), DoubleNear(0.1006879223470753, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.12279247813535539 + -2.439454888092385e-19i, 0.018033283462766947 + 0.0028089918038475496i, -0.005980441968598547 + 0.0037254267818833116i, -0.0008233817197718916 + 0.0006566416383051818i, -0.002991181256949939 + 0.003238537781421946i, -0.0006513735560435593 + 0.0006630420890122025i, 0.00011525435682283433 + -0.00014343836310629809i, 9.111695605759916e-06 + -2.3278588683602668e-05i }, { 0.018033283462766947 + -0.002808991803847551i, 0.1208239294710773 + -5.285485590866834e-19i, -0.0009386360456161856 + 0.0004015004840093881i, -0.0060829024060387125 + 0.0037578559644009363i, -0.0005981708362702955 + 0.0007729086251055961i, -0.002951542672746401 + 0.003192603412143183i, 2.375995055241046e-05 + -7.105419003628529e-05i, 0.0001039595130732631 + -0.00014695225912769754i }, { -0.005980441968598547 + -0.0037254267818833116i, -0.0009386360456161866 + -0.00040150048400938807i, 0.12234923177799903 + 6.776263578034403e-20i, 0.0180362667812704 + 0.0025266984244995613i, 0.0003005217965252484 + 4.5144804291039036e-05i, 3.8458436446313636e-05 + 7.227525474852588e-06i, -0.003038874934657251 + 0.0031185146174842818i, -0.0006106669156262137 + 0.000627899128067277i }, { -0.000823381719771894 + -0.0006566416383051801i, -0.006082902406038711 + -0.0037578559644009346i, 0.0180362667812704 + -0.0025266984244995566i, 0.12060091596286528 + 7.860465750519907e-19i, 9.548840680714097e-05 + 1.8819621727883365e-06i, 0.0002943073447784152 + 2.914329382566906e-05i, -0.0006153080568646226 + 0.0007681126065951959i, -0.0030023406697247913 + 0.003083896528393775i }, { -0.0029911812569499395 + -0.003238537781421945i, -0.0005981708362702953 + -0.0007729086251055963i, 0.0003005217965252486 + -4.514480429103899e-05i, 9.548840680714097e-05 + -1.8819621727882695e-06i, 0.1294235318181883 + -7.860465750519907e-19i, 0.01825134040088179 + 0.0030309736159586805i, -0.006465310878230698 + 0.003909022829456094i, -0.0008662579894264636 + 0.0006574412100764703i }, { -0.0006513735560435589 + -0.0006630420890122027i, -0.002951542672746401 + -0.003192603412143182i, 3.845843644631357e-05 + -7.227525474852519e-06i, 0.0002943073447784153 + -2.9143293825669045e-05i, 0.01825134040088179 + -0.0030309736159586775i, 0.12739934792297555 + 5.421010862427522e-19i, -0.0009620884033964257 + 0.00036912758641453083i, -0.00657662331480584 + 0.003935504444425163i }, { 0.00011525435682283439 + 0.00014343836310629814i, 2.3759950552410398e-05 + 7.105419003628532e-05i, -0.0030388749346572513 + -0.0031185146174842818i, -0.0006153080568646222 + -0.000768112606595196i, -0.0064653108782306975 + -0.003909022829456095i, -0.0009620884033964271 + -0.00036912758641453056i, 0.12921821447057397 + -3.6591823321385775e-19i, 0.018345261718491938 + 0.002743914604406209i }, { 9.111695605759928e-06 + 2.3278588683602634e-05i, 0.000103959513073263 + 0.00014695225912769768i, -0.0006106669156262135 + -0.0006278991280672772i, -0.0030023406697247913 + -0.003083896528393774i, -0.0008662579894264629 + -0.00065744121007647i, -0.00657662331480584 + -0.0039355044444251645i, 0.01834526171849194 + -0.0027439146044062074i, 0.1273923504409637 + -1.2739375526704677e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.12279247813535539, 1.0e-7), DoubleNear(0.1208239294710773, 1.0e-7), DoubleNear(0.12234923177799903, 1.0e-7), DoubleNear(0.12060091596286528, 1.0e-7), DoubleNear(0.1294235318181883, 1.0e-7), DoubleNear(0.12739934792297555, 1.0e-7), DoubleNear(0.12921821447057397, 1.0e-7), DoubleNear(0.1273923504409637, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.1381565988432456 + -1.2061749168901237e-18i, 0.019877683981136363 + 0.003370551844925576i, -0.004373319753854913 + 0.013682534220391354i, -0.00049869715610688 + 0.0024512720629947453i, 0.024367397783232186 + 0.010019687691019241i, 0.003358493603357962 + 0.002022691359777329i, -0.0016984427749604132 + 0.002395975343510898i, -0.00017627521070800144 + 0.0006735268623109398i }, { 0.01987768398113636 + -0.0033705518449255716i, 0.13581833625127693 + -1.599198204416119e-18i, -0.0008078410791755818 + 0.0015659498865531884i, -0.004709464671809101 + 0.013797182202434505i, 0.0038815954475739517 + 0.0008919582775314014i, 0.02393145833107089 + 0.009781948335126748i, -0.0004342356907199887 + -8.877800991138562e-05i, -0.0019808115501941514 + 0.002494437642088854i }, { -0.004373319753854913 + -0.013682534220391354i, -0.0008078410791755835 + -0.0015659498865531899i, 0.15959044984437928 + -1.0842021724855044e-18i, 0.02307558719793541 + 0.003228584093251485i, 0.00048617452337611146 + -0.003661453649849839i, -0.00026410871908467395 + -0.00020378893820234187i, 0.030711405500950275 + 0.01194084241007565i, 0.004130229571714291 + 0.0021935585394259175i }, { -0.0004986971561068798 + -0.0024512720629947435i, -0.004709464671809103 + -0.013797182202434503i, 0.023075587197935413 + -0.003228584093251484i, 0.15752862809526746 + 1.7618285302889447e-19i, 0.0002613750463450124 + -0.0007901525335201301i, 0.0002702584768214259 + -0.0038480594741674753i, 0.0045334201997506846 + 0.0012177267962678688i, 0.030463195411246098 + 0.011792015138074742i }, { 0.024367397783232186 + -0.010019687691019241i, 0.003881595447573951 + -0.0008919582775314013i, 0.0004861745233761118 + 0.0036614536498498396i, 0.000261375046345013 + 0.0007901525335201301i, 0.09532612668676259 + 3.3881317890172014e-19i, 0.013750765036627852 + 0.0023441993929268086i, -0.003279652064813553 + 0.009682044590110357i, -0.0003364912201537255 + 0.0017919923434476842i }, { 0.0033584936033579614 + -0.0020226913597773295i, 0.02393145833107089 + -0.009781948335126748i, -0.0002641087190846735 + 0.0002037889382023419i, 0.00027025847682142474 + 0.0038480594741674753i, 0.013750765036627852 + -0.002344199392926808i, 0.09361330197058099 + -2.710505431213761e-20i, -0.0006891802529017351 + 0.001004286937730812i, -0.00357644264041727 + 0.009797509712945426i }, { -0.0016984427749604121 + -0.0023959753435108984i, -0.00043423569071998847 + 8.87780099113861e-05i, 0.030711405500950275 + -0.011940842410075654i, 0.0045334201997506846 + -0.0012177267962678686i, -0.003279652064813554 + -0.00968204459011036i, -0.0006891802529017349 + -0.0010042869377308123i, 0.11071028082772921 + 6.2341624917916505e-19i, 0.01596211614771146 + 0.002167243117608131i }, { -0.00017627521070800165 + -0.0006735268623109399i, -0.0019808115501941522 + -0.002494437642088854i, 0.004130229571714291 + -0.002193558539425918i, 0.030463195411246095 + -0.01179201513807474i, -0.0003364912201537244 + -0.001791992343447684i, -0.0035764426404172704 + -0.009797509712945428i, 0.015962116147711453 + -0.0021672431176081287i, 0.10925627748075645 + 9.75781955236954e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1381565988432456, 1.0e-7), DoubleNear(0.13581833625127693, 1.0e-7), DoubleNear(0.15959044984437928, 1.0e-7), DoubleNear(0.15752862809526746, 1.0e-7), DoubleNear(0.09532612668676259, 1.0e-7), DoubleNear(0.09361330197058099, 1.0e-7), DoubleNear(0.11071028082772921, 1.0e-7), DoubleNear(0.10925627748075645, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.11359641599756291 + 3.5236570605778894e-19i, 0.01669577094860649 + 0.0027565876899696314i, -0.0035872588510208765 + 0.011331524613174732i, -0.00041721219006398867 + 0.0020685649846358045i, -0.00277624394071024 + 0.002944575508199235i, -0.0006079543990036053 + 0.0006175437709825335i, -3.582763728688431e-05 + -0.0002434627863974409i, -5.17281267568436e-05 + -2.3181634570642388e-05i }, { 0.01669577094860649 + -0.002756587689969631i, 0.11160170402062289 + -9.0801931945661e-19i, -0.0006878014361109098 + 0.0012933475746187333i, -0.0038868210143476064 + 0.01142186225766342i, -0.0005374340986171718 + 0.0006980527114166227i, -0.0027492155606949308 + 0.002899252636316939i, -3.701780184051841e-06 + -0.00010611791749676308i, -7.017692177005265e-05 + -0.0002556602815160707i }, { -0.0035872588510208756 + -0.011331524613174732i, -0.0006878014361109107 + -0.0012933475746187335i, 0.1315452939157915 + -5.285485590866834e-19i, 0.01937377929543086 + 0.0025791025383774795i, 0.00040534835458015336 + 0.00040970258138033674i, 2.9158718343456104e-05 + 6.418181005568484e-05i, -0.0032538122508969504 + 0.0034124768907069928i, -0.0006540860726661677 + 0.0006733974460969461i }, { -0.0004172121900639891 + -0.0020685649846358045i, -0.0038868210143476064 + -0.01142186225766342i, 0.01937377929543086 + -0.0025791025383774765i, 0.1298231414133197 + 1.1655173354219173e-18i, 0.00014434472857029448 + 5.900985339121765e-05i, 0.0003966608868059793 + 0.00036972805981768644i, -0.0006760447945177463 + 0.0008429685202841693i, -0.003204667781776261 + 0.003377247304220018i }, { -0.00277624394071024 + -0.0029445755081992345i, -0.0005374340986171714 + -0.0006980527114166229i, 0.00040534835458015336 + -0.0004097025813803368i, 0.0001443447285702945 + -5.9009853391217586e-05i, 0.11988630953244526 + -1.2197274440461925e-18i, 0.01693267806915772 + 0.0029581635478827533i, -0.00406571296764759 + 0.01203305419732698i, -0.0004179761861966168 + 0.0021746994218066248i }, { -0.0006079543990036051 + -0.0006175437709825336i, -0.0027492155606949308 + -0.002899252636316939i, 2.9158718343456178e-05 + -6.418181005568483e-05i, 0.0003966608868059792 + -0.00036972805981768655i, 0.01693267806915772 + -0.002958163547882749i, 0.11782993420123503 + -7.182839392716467e-19i, -0.0008092198959664071 + 0.001276889249665267i, -0.004399086297878765 + 0.01217282965771651i }, { -3.582763728688437e-05 + 0.0002434627863974409i, -3.7017801840518613e-06 + 0.00010611791749676311i, -0.003253812250896951 + -0.0034124768907069923i, -0.000676044794517746 + -0.0008429685202841694i, -0.004065712967647591 + -0.012033054197326983i, -0.0008092198959664079 + -0.0012768892496652687i, 0.13875543675631702 + 6.776263578034403e-20i, 0.019663924050216004 + 0.0028167246724821364i }, { -5.172812675684363e-05 + 2.3181634570642324e-05i, -7.017692177005265e-05 + 0.00025566028151607066i, -0.0006540860726661673 + -0.0006733974460969462i, -0.0032046677817762614 + -0.003377247304220018i, -0.0004179761861966151 + -0.002174699421806623i, -0.004399086297878767 + -0.01217282965771651i, 0.019663924050216004 + -0.002816724672482136i, 0.13696176416270422 + -1.3552527156068805e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.11359641599756291, 1.0e-7), DoubleNear(0.11160170402062289, 1.0e-7), DoubleNear(0.1315452939157915, 1.0e-7), DoubleNear(0.1298231414133197, 1.0e-7), DoubleNear(0.11988630953244526, 1.0e-7), DoubleNear(0.11782993420123503, 1.0e-7), DoubleNear(0.13875543675631702, 1.0e-7), DoubleNear(0.13696176416270422, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.14481965136299302 + -1.0028870095490916e-18i, 0.021310690499271378 + 0.0031568413311362947i, 0.027078867109036224 + 0.010732629001268593i, 0.003759630477216814 + 0.002125447838742925i, -0.003551897805468499 + 0.0037615106285026493i, -0.0007370950644197561 + 0.0007543065033999988i, -0.0009676116054899826 + 0.00044119155488306675i, -0.0002608848821627864 + 0.00010904284281236497i }, { 0.021310690499271374 + -0.0031568413311362925i, 0.142666104551311 + 8.131516293641283e-19i, 0.004220639541386878 + 0.0010287166791263602i, 0.02669836637438599 + 0.010533750917507672i, -0.0007229756118092516 + 0.000919151365244389i, -0.0035153869063380746 + 0.0037020707115356577i, -0.00014726450088302015 + 9.30995319121268e-05i, -0.0009662771542321364 + 0.00042584427298691604i }, { 0.027078867109036224 + -0.010732629001268593i, 0.004220639541386877 + -0.0010287166791263591i, 0.10032205855036139 + 8.267041565201971e-19i, 0.014758859744765974 + 0.002178848897210816i, -0.00042405322934739207 + 0.000984973619496375i, -0.00013462446313200344 + 0.0002293097685288799i, -0.0024781583861386916 + 0.0025955417704035784i, -0.0005249454072500169 + 0.0005366347136794808i }, { 0.0037596304772168137 + -0.0021254478387429253i, 0.02669836637438599 + -0.010533750917507672i, 0.014758859744765974 + -0.002178848897210815i, 0.09875874088263156 + -5.55653613398821e-19i, -2.6256511599838825e-05 + 0.0001928121783921908i, -0.00040423647433859063 + 0.0009482130836227237i, -0.0004905032813256663 + 0.000621869866456403i, -0.0024384964361331167 + 0.0025744292290012993i }, { -0.0035518978054684997 + -0.0037615106285026484i, -0.0007229756118092513 + -0.0009191513652443892i, -0.000424053229347392 + -0.000984973619496375i, -2.6256511599838672e-05 + -0.00019281217839219083i, 0.15292739732463184 + -1.2874900798265365e-18i, 0.021642580679800395 + 0.0034422946070407664i, 0.027999936175146234 + 0.011227901099826298i, 0.0037290926978554395 + 0.0020908020604603218i }, { -0.0007370950644197558 + -0.0007543065033999989i, -0.0035153869063380746 + -0.0037020707115356577i, -0.00013462446313200328 + -0.00022930976852887996i, -0.00040423647433859074 + -0.0009482130836227237i, 0.021642580679800398 + -0.003442294607040763i, 0.15068085979523338 + -2.236166980751353e-18i, 0.004194376105937758 + 0.00108096839467291i, 0.027696287367930998 + 0.011040212555693818i }, { -0.0009676116054899825 + -0.00044119155488306664i, -0.0001472645008830201 + -9.309953191212689e-05i, -0.002478158386138691 + -0.0025955417704035784i, -0.0004905032813256662 + -0.0006218698664564031i, 0.027999936175146234 + -0.0112279010998263i, 0.004194376105937758 + -0.0010809683946729107i, 0.10571434896413041 + 1.3552527156068805e-19i, 0.014954021439573334 + 0.0023325936133241233i }, { -0.0002608848821627863 + -0.00010904284281236508i, -0.0009662771542321364 + -0.0004258442729869158i, -0.0005249454072500167 + -0.0005366347136794809i, -0.002438496436133117 + -0.0025744292290012993i, 0.0037290926978554395 + -0.0020908020604603226i, 0.027696287367930998 + -0.011040212555693818i, 0.014954021439573332 + -0.002332593613324122i, 0.10411083856870587 + 1.5043305143236374e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.14481965136299302, 1.0e-7), DoubleNear(0.142666104551311, 1.0e-7), DoubleNear(0.10032205855036139, 1.0e-7), DoubleNear(0.09875874088263156, 1.0e-7), DoubleNear(0.15292739732463184, 1.0e-7), DoubleNear(0.15068085979523338, 1.0e-7), DoubleNear(0.10571434896413041, 1.0e-7), DoubleNear(0.10411083856870587, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.10630720944872434 + 1.4907779871675686e-19i, -0.005886247549809623 + -0.016642758861403373i, -0.00014141490657998092 + 0.006545236389200975i, -0.01037829015853196 + 0.0034840843013706413i, 0.006264111069042008 + 0.007609348746548334i, -0.011572126008297618 + 0.015535583933155966i, -0.0033013024066246063 + -0.00033360231321542854i, 0.009503457124000789 + -0.0006429883126766278i }, { -0.005886247549809625 + 0.016642758861403373i, 0.12286898379372696 + -1.1384122811097797e-18i, 0.015136479455461493 + -0.008121907097718855i, -0.0018882324713520567 + 0.0005816382800791842i, -0.026522811764501872 + -0.023448181486707062i, -0.02591204954779445 + 0.022564402409057265i, 0.005240842948391971 + -0.010282046823580901i, -0.008393799231311953 + 0.016573455536703825i }, { -0.0001414149065799799 + -0.006545236389200973i, 0.015136479455461494 + 0.008121907097718855i, 0.11639806457538006 + -5.692061405548898e-19i, -0.020883223475821742 + -0.01264955811089907i, 0.008469657808999408 + -0.005032126740098265i, -0.00899523393445172 + 0.005322750273453485i, 0.006185083460576442 + 0.003872278182494372i, -0.0011912759720708605 + 0.028454628798157286i }, { -0.01037829015853196 + -0.0034840843013706413i, -0.0018882324713520562 + -0.0005816382800791847i, -0.020883223475821742 + 0.01264955811089907i, 0.11734010593403474 + -9.351243737687476e-19i, -0.0002872673382512095 + 0.008788446077552855i, 0.006852727457543942 + -0.0031295819239674037i, -0.002309898662500816 + -0.0036820055247377987i, -0.0024760241127188363 + 0.012913241387781674i }, { 0.0062641110690420075 + -0.007609348746548334i, -0.02652281176450187 + 0.023448181486707062i, 0.008469657808999408 + 0.0050321267400982635i, -0.0002872673382512099 + -0.008788446077552855i, 0.14060044866850052 + -2.0057740190981832e-18i, -0.026851121584992765 + -0.0035916557654726393i, -0.012819525982478153 + 0.008277134826564999i, 0.01507635791637708 + 0.0018187203771751735i }, { -0.011572126008297616 + -0.015535583933155968i, -0.025912049547794455 + -0.022564402409057265i, -0.008995233934451721 + -0.005322750273453486i, 0.006852727457543941 + 0.003129581923967403i, -0.026851121584992765 + 0.0035916557654726406i, 0.13066264543664474 + 1.9786689647860456e-18i, 0.0005857978095645925 + 0.0029636361953863885i, -0.010256105207263605 + -7.619947567965224e-05i }, { -0.0033013024066246063 + 0.0003336023132154296i, 0.00524084294839197 + 0.010282046823580901i, 0.0061850834605764425 + -0.003872278182494371i, -0.0023098986625008167 + 0.0036820055247377983i, -0.012819525982478156 + -0.008277134826565002i, 0.0005857978095645917 + -0.0029636361953863898i, 0.11221623142960405 + -1.3552527156068805e-20i, -0.004409658985215817 + -0.030019503414948325i }, { 0.009503457124000789 + 0.0006429883126766265i, -0.008393799231311953 + -0.016573455536703828i, -0.001191275972070859 + -0.028454628798157286i, -0.0024760241127188376 + -0.012913241387781675i, 0.01507635791637708 + -0.0018187203771751735i, -0.010256105207263604 + 7.619947567965224e-05i, -0.004409658985215816 + 0.030019503414948325i, 0.1536063107133831 + 7.318364664277155e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.10630720944872434, 1.0e-7), DoubleNear(0.12286898379372696, 1.0e-7), DoubleNear(0.11639806457538006, 1.0e-7), DoubleNear(0.11734010593403474, 1.0e-7), DoubleNear(0.14060044866850052, 1.0e-7), DoubleNear(0.13066264543664474, 1.0e-7), DoubleNear(0.11221623142960405, 1.0e-7), DoubleNear(0.1536063107133831, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.14528025999788585 + -9.0801931945661e-19i, -0.01917095891474375 + -0.011972548619249672i, -0.007231999018151603 + 0.008347532988605326i, 0.0021633777214504885 + 0.003309468629000071i, 0.029239132855437614 + 0.011125349488544323i, -0.0034768850275116517 + -0.0036274864919117428i, -0.003112895347045626 + 0.002161357675203172i, 0.0014236378738668343 + 0.0010439612686894437i }, { -0.019170958914743755 + 0.011972548619249674i, 0.14909585965431887 + -1.5449880957918438e-18i, 0.009490683260800254 + -0.003095764267440189i, -0.006820861459973982 + -0.00023697080050919406i, -0.0052246726444674756 + 0.0004131872219370517i, 0.029742511235417872 + 0.011743109151250394i, 0.0013366969324287645 + -0.00018376989923797642i, -0.0029901889594843283 + 0.0011709967289133653i }, { -0.007231999018151604 + -0.008347532988605326i, 0.009490683260800256 + 0.0030957642674401885i, 0.1356589109957027 + -9.893344823930228e-19i, -0.015099050967500173 + -0.025261808864325348i, -0.0014304237765021405 + -0.00404225167004767i, 0.0010378469875705642 + 0.0012858632990418075i, 0.023419828998357282 + 0.009658664601244739i, -0.00024124355505900877 + -0.005503879178485704i }, { 0.002163377721450488 + -0.003309468629000071i, -0.006820861459973982 + 0.0002369708005091932i, -0.015099050967500175 + 0.02526180886432535i, 0.16105898238626185 + -2.710505431213761e-19i, 0.0013417741182768519 + 0.0004843497992256604i, -0.002021571977710152 + -0.002739755948544714i, -0.003933119653512902 + 0.0036454505843303286i, 0.027071983937286687 + 0.011007370333256924i }, { 0.02923913285543761 + -0.011125349488544321i, -0.0052246726444674756 + -0.0004131872219370515i, -0.0014304237765021407 + 0.00404225167004767i, 0.0013417741182768514 + -0.0004843497992256602i, 0.10162739811933899 + -9.486769009248164e-19i, -0.013566410220058635 + -0.00826186600762634i, -0.0057289418709065305 + 0.006474838227160647i, 0.0025346900363946304 + 0.0019933360495457434i }, { -0.0034768850275116525 + 0.0036274864919117423i, 0.029742511235417872 + -0.011743109151250394i, 0.001037846987570564 + -0.0012858632990418073i, -0.002021571977710152 + 0.002739755948544714i, -0.013566410220058635 + 0.00826186600762634i, 0.10443576957605283 + 2.3852447794681098e-18i, 0.0062315940042258315 + -0.002062506634892279i, -0.00532347621864168 + 0.0007424096049087261i }, { -0.003112895347045626 + -0.002161357675203172i, 0.0013366969324287645 + 0.00018376989923797648i, 0.023419828998357275 + -0.009658664601244739i, -0.0039331196535129015 + -0.0036454505843303286i, -0.0057289418709065305 + -0.006474838227160648i, 0.0062315940042258315 + 0.002062506634892278i, 0.09295538500928142 + 4.0657581468206416e-19i, -0.010193831493537382 + -0.017407252661522044i }, { 0.0014236378738668345 + -0.001043961268689444i, -0.00299018895948433 + -0.001170996728913365i, -0.00024124355505900856 + 0.005503879178485704i, 0.027071983937286687 + -0.011007370333256928i, 0.002534690036394631 + -0.001993336049545744i, -0.005323476218641678 + -0.0007424096049087256i, -0.010193831493537382 + 0.017407252661522044i, 0.109887434261156 + 6.776263578034403e-20i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.14528025999788585, 1.0e-7), DoubleNear(0.14909585965431887, 1.0e-7), DoubleNear(0.1356589109957027, 1.0e-7), DoubleNear(0.16105898238626185, 1.0e-7), DoubleNear(0.10162739811933899, 1.0e-7), DoubleNear(0.10443576957605283, 1.0e-7), DoubleNear(0.09295538500928142, 1.0e-7), DoubleNear(0.109887434261156, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.120175065602981 + -6.369687763352339e-19i, -0.015993162233592616 + -0.009861591868484228i, -0.006285873331300252 + 0.007197920153992308i, 0.0022448394896571753 + 0.0024789661306002402i, -0.002960574877715205 + 0.003149036254448706i, 0.0006176675954330277 + -0.0002552971013579274i, 2.5820959853449944e-05 + -0.0003644498758776787i, -2.8403124738492504e-05 + -0.0001045003641415126i }, { -0.015993162233592616 + 0.009861591868484227i, 0.12344134200345169 + -1.3552527156068805e-19i, 0.007585162965399871 + -0.0024960559583423964i, -0.005777471043337009 + 0.00028536259229194026i, 6.337855047810291e-05 + -0.0007527556948591712i, -0.002982149051981135 + 0.003282104939116423i, -0.00017749688013022575 + 0.00020004724423091988i, 0.0001933929100426475 + 7.405925364368303e-05i }, { -0.00628587333130025 + -0.0071979201539923085i, 0.007585162965399871 + 0.0024960559583423964i, 0.11127037082888737 + 8.267041565201971e-19i, -0.01249222393720138 + -0.02087814824863098i, 0.00027940981296194466 + 6.53618745593692e-05i, -0.0002904711469279923 + 6.887820565529733e-05i, -0.002700301342124792 + 0.0029403453771622234i, 0.000898615360988705 + -0.00012230040016973005i }, { 0.0022448394896571753 + -0.00247896613060024i, -0.005777471043337007 + -0.0002853625922919383i, -0.01249222393720138 + 0.020878148248630983i, 0.1316797769119769 + 2.710505431213761e-20i, -0.00012064829865844026 + 9.181808428022499e-05i, 0.000315419328341719 + 8.92622355733889e-06i, -0.0004885582837883995 + -0.0009660481045243407i, -0.0033409142622572497 + 0.003262065768715833i }, { -0.002960574877715205 + -0.0031490362544487056i, 6.337855047810304e-05 + 0.000752755694859171i, 0.00027940981296194483 + -6.536187455936915e-05i, -0.00012064829865844018 + -9.181808428022509e-05i, 0.12673259251424385 + -1.2197274440461925e-18i, -0.01674420690120977 + -0.010372822758391784i, -0.006675067557757883 + 0.007624451061773665i, 0.0024532282681879436 + 0.002823838547945574i }, { 0.0006176675954330277 + 0.00025529710135792724i, -0.0029821490519811355 + -0.003282104939116422i, -0.00029047114692799233 + -6.887820565529734e-05i, 0.00031541932834171904 + -8.926223557338876e-06i, -0.01674420690120977 + 0.010372822758391787i, 0.13009028722692 + 9.75781955236954e-19i, 0.008137114299626215 + -0.0026622149439900714i, -0.006366866635278653 + 0.00022007621210759173i }, { 2.5820959853449957e-05 + 0.00036444987587767885i, -0.00017749688013022556 + -0.00020004724423092004i, -0.002700301342124792 + -0.002940345377162223i, -0.0004885582837883995 + 0.0009660481045243407i, -0.006675067557757884 + -0.007624451061773665i, 0.008137114299626217 + 0.0026622149439900697i, 0.11734392517609675 + -1.4094628242311558e-18i, -0.012800658523836177 + -0.02179091327721641i }, { -2.84031247384926e-05 + 0.00010450036414151255i, 0.00019339291004264746 + -7.4059253643683e-05i, 0.0008986153609887049 + 0.00012230040016972997i, -0.00334091426225725 + -0.003262065768715833i, 0.0024532282681879436 + -0.0028238385479455747i, -0.006366866635278653 + -0.00022007621210759411i, -0.012800658523836179 + 0.02179091327721641i, 0.13926663973544093 + -2.303929616531697e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.120175065602981, 1.0e-7), DoubleNear(0.12344134200345169, 1.0e-7), DoubleNear(0.11127037082888737, 1.0e-7), DoubleNear(0.1316797769119769, 1.0e-7), DoubleNear(0.12673259251424385, 1.0e-7), DoubleNear(0.13009028722692, 1.0e-7), DoubleNear(0.11734392517609675, 1.0e-7), DoubleNear(0.13926663973544093, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.13177360396043583 + -7.182839392716467e-19i, -0.01571516273199802 + -0.017103206465197703i, 0.007440004752880952 + 0.006534278251406958i, -0.007747488652119234 + 0.025921776488222265i, 0.023443650322630186 + 0.009552225465430747i, -0.0014949707324244644 + -0.004378454694152438i, 0.0008154789199896695 + 0.002350232070287669i, -0.0033670291942718084 + 0.004565424941104336i }, { -0.015715162731998022 + 0.017103206465197703i, 0.14220133113408667 + -2.087089182034596e-18i, -0.017024426396154643 + -0.015878979722881274i, -0.016522789178544967 + 0.0209454381714189i, -0.004455678779327383 + 0.0017047932909203577i, 0.024855205791672885 + 0.01024941056071524i, -0.001985214346175993 + -0.004821599367634279i, -0.004494733245144235 + 0.002540180915312083i }, { 0.00744000475288095 + -0.006534278251406955i, -0.01702442639615464 + 0.015878979722881274i, 0.1491655670331527 + -1.179069862577986e-18i, -0.018554847150245905 + -0.020131151018377313i, 0.002403205986493554 + -0.0016830081455243137i, -0.004841881911389126 + 0.00239434056650095i, 0.029215311531164703 + 0.011231788624358313i, -0.0022231578501461964 + -0.004752910976245009i }, { -0.007747488652119233 + -0.025921776488222265i, -0.016522789178544967 + -0.020945438171418904i, -0.018554847150245905 + 0.02013115101837732i, 0.16795351090649402 + 2.710505431213761e-19i, 0.0008174877923926224 + -0.005074635332988257i, -0.0016467729862960166 + -0.005826504978493002i, -0.004702113518652994 + 0.0023538445153470228i, 0.03195928938103167 + 0.01250106892379208i }, { 0.023443650322630186 + -0.009552225465430747i, -0.004455678779327382 + -0.0017047932909203575i, 0.0024032059864935533 + 0.0016830081455243143i, 0.000817487792392622 + 0.005074635332988258i, 0.09093167006366858 + 2.981555974335137e-19i, -0.011054308293633342 + -0.012189110507104738i, 0.005009189776737498 + 0.004947348677635747i, -0.005015913328249243 + 0.018068436243090985i }, { -0.0014949707324244642 + 0.004378454694152437i, 0.024855205791672885 + -0.010249410560715242i, -0.004841881911389125 + -0.0023943405665009503i, -0.0016467729862960168 + 0.005826504978493002i, -0.011054308293633344 + 0.012189110507104738i, 0.09800775859367501 + 1.3552527156068805e-20i, -0.011808284030848045 + -0.011251207288563585i, -0.01186528448196832 + 0.014532205625420038i }, { 0.0008154789199896694 + -0.002350232070287669i, -0.001985214346175993 + 0.004821599367634279i, 0.0292153115311647 + -0.011231788624358311i, -0.004702113518652994 + -0.0023538445153470228i, 0.0050091897767375 + -0.004947348677635749i, -0.011808284030848045 + 0.011251207288563585i, 0.10365111306495184 + -8.402566836762659e-19i, -0.012705933419962673 + -0.013480008162043648i }, { -0.003367029194271809 + -0.004565424941104337i, -0.004494733245144234 + -0.002540180915312083i, -0.002223157850146197 + 0.004752910976245009i, 0.031959289381031666 + -0.012501068923792082i, -0.005015913328249242 + -0.018068436243090985i, -0.011865284481968323 + -0.01453220562542004i, -0.012705933419962673 + 0.01348000816204365i, 0.11631544524353382 + 2.439454888092385e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.13177360396043583, 1.0e-7), DoubleNear(0.14220133113408667, 1.0e-7), DoubleNear(0.1491655670331527, 1.0e-7), DoubleNear(0.16795351090649402, 1.0e-7), DoubleNear(0.09093167006366858, 1.0e-7), DoubleNear(0.09800775859367501, 1.0e-7), DoubleNear(0.10365111306495184, 1.0e-7), DoubleNear(0.11631544524353382, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.10848645668767233 + 3.6591823321385775e-19i, -0.01307548812149456 + -0.014356935313292431i, 0.006176428496420794 + 0.005434727792042024i, -0.0063759073514266275 + 0.02116487465380066i, -0.0025688036464070188 + 0.0029947035317381574i, 0.0007696820640270327 + -0.00011748200959056352i, -2.3299151901970394e-05 + 5.879621573167429e-05i, -0.0001917118899124707 + -0.000997717262875934i }, { -0.01307548812149456 + 0.014356935313292431i, 0.1167116633305135 + -9.215718466126788e-19i, -0.013780311450263791 + -0.013038573513804108i, -0.013650508361789278 + 0.01731865907879613i, -0.00021351969620829708 + -0.0007099222236582463i, -0.002956655854998152 + 0.0028491246127780165i, 0.000656902408430576 + 0.00039622296440006523i, -8.270540715496655e-05 + -0.0005579192836451859i }, { 0.0061764284964207945 + -0.005434727792042026i, -0.013780311450263791 + 0.013038573513804108i, 0.12295897974419605 + -1.7618285302889447e-19i, -0.015409898049299434 + -0.016382804803822777i, -0.0001390683152399974 + 0.00053715088560119i, 0.0003851144321924076 + -0.00045684557500631003i, -0.003092072573432978 + 0.0030946780998727715i, 0.0007466008923947001 + -0.0002601154919370939i }, { -0.0063759073514266275 + -0.021164874653800663i, -0.013650508361789276 + -0.01731865907879613i, -0.015409898049299434 + 0.016382804803822777i, 0.13840945558491513 + 8.131516293641283e-19i, 0.0003470428193457543 + 0.00029195540327532036i, 0.0009410775566261301 + 0.00024227975559683323i, -0.0002116600371019996 + -0.0010088815757252657i, -0.003366407459240233 + 0.0036950460950542397i }, { -0.0025688036464070188 + -0.0029947035317381574i, -0.00021351969620829697 + 0.0007099222236582462i, -0.00013906831523999763 + -0.0005371508856011898i, 0.00034704281934575416 + -0.00029195540327532036i, 0.11421881733643208 + -7.860465750519907e-19i, -0.013693982904136804 + -0.01493538165901001i, 0.006272766033197656 + 0.006046899137000681i, -0.0063874946289418505 + 0.02282533807751259i }, { 0.0007696820640270326 + 0.00011748200959056345i, -0.002956655854998152 + -0.002849124612778016i, 0.00038511443219240766 + 0.0004568455750063099i, 0.0009410775566261302 + -0.00024227975559683345i, -0.013693982904136806 + 0.01493538165901001i, 0.1234974263972482 + -1.1519648082658485e-18i, -0.015052398976738896 + -0.01409161349764075i, -0.01473756529872401 + 0.01815898471804281i }, { -2.329915190197057e-05 + -5.8796215731674384e-05i, 0.0006569024084305758 + -0.0003962229644000654i, -0.0030920725734329786 + -0.0030946780998727715i, -0.0002116600371019995 + 0.0010088815757252655i, 0.0062727660331976555 + -0.006046899137000678i, -0.015052398976738893 + 0.01409161349764075i, 0.1298577003539085 + -1.8431436932253575e-18i, -0.015850882520909146 + -0.017228354376598184i }, { -0.00019171188991247052 + 0.0009977172628759337i, -8.270540715496645e-05 + 0.0005579192836451859i, 0.0007466008923947001 + 0.00026011549193709376i, -0.003366407459240233 + -0.0036950460950542384i, -0.006387494628941848 + -0.022825338077512587i, -0.014737565298724015 + -0.018158984718042816i, -0.015850882520909146 + 0.01722835437659819i, 0.14585950056511274 + 1.8973538018496328e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.10848645668767233, 1.0e-7), DoubleNear(0.1167116633305135, 1.0e-7), DoubleNear(0.12295897974419605, 1.0e-7), DoubleNear(0.13840945558491513, 1.0e-7), DoubleNear(0.11421881733643208, 1.0e-7), DoubleNear(0.1234974263972482, 1.0e-7), DoubleNear(0.1298577003539085, 1.0e-7), DoubleNear(0.14585950056511274, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.13668199256947616 + 1.3552527156068805e-19i, -0.01682009054719803 + -0.01819242766375316i, 0.025861872529470198 + 0.010154815894947964i, -0.0018445752231593903 + -0.004494337194804255i, -0.0033366279446183224 + 0.003597630345330077i, 0.0009000680885396381 + -0.00022793810143874598i, -0.0009238834030663428 + 0.0004244478951705832i, 0.00016497887441852904 + 5.2702362286179244e-05i }, { -0.01682009054719803 + 0.01819242766375316i, 0.15080376334482787 + -3.2526065174565133e-19i, -0.004504885478760012 + 0.002000948632454985i, 0.027915360953952018 + 0.0111115640238283i, -0.00025715594029810285 + -0.0010203863398843766i, -0.0037306567671882515 + 0.0038659509947082302i, 5.5702868862353175e-05 + -0.00018243836987314653i, -0.0010100053566557761 + 0.0004425879326993996i }, { 0.025861872529470194 + -0.010154815894947964i, -0.004504885478760011 + -0.002000948632454985i, 0.09476344386239222 + 5.421010862427522e-20i, -0.011665295623595966 + -0.012547312453362049i, -0.000387064294947693 + 0.0009283537070279195i, 0.00014012819640162405 + -7.049146312949358e-05i, -0.0023242482752216746 + 0.0024917512862808527i, 0.0006162148678820947 + -0.00014965940008891148i }, { -0.0018445752231593896 + 0.004494337194804255i, 0.027915360953952018 + -0.011111564023828301i, -0.011665295623595966 + 0.012547312453362049i, 0.10431735557060076 + 2.168404344971009e-19i, -8.937247544038639e-05 + -0.0001559884155355213i, -0.0004412254087382897 + 0.0010048329960911794i, -0.00016802379301219384 + -0.0006984174594991355i, -0.0025924065470501337 + 0.002678219713124026i }, { -0.003336627944618323 + -0.0035976303453300763i, -0.00025715594029810263 + 0.0010203863398843761i, -0.000387064294947693 + -0.0009283537070279194i, -8.93724754403864e-05 + 0.00015598841553552133i, 0.1442571784241124 + -2.032879073410321e-18i, -0.017449919335045895 + -0.019041929819821862i, 0.026797089324324695 + 0.010629198194841096i, -0.0018735533594112707 + -0.004637028475593191i }, { 0.000900068088539638 + 0.0002279381014387458i, -0.0037306567671882515 + -0.003865950994708229i, 0.00014012819640162405 + 7.049146312949354e-05i, -0.00044122540873828975 + -0.0010048329960911794i, -0.017449919335045902 + 0.019041929819821862i, 0.15935107869575285 + -1.4907779871675686e-18i, -0.004652906819220365 + 0.0020576891738123956i, 0.02889913421875254 + 0.01163891546067902i }, { -0.0009238834030663428 + -0.00042444789517058306i, 5.570286886235323e-05 + 0.0001824383698731465i, -0.0023242482752216746 + -0.002491751286280852i, -0.0001680237930121938 + 0.0006984174594991355i, 0.02679708932432469 + -0.010629198194841096i, -0.004652906819220365 + -0.002057689173812395i, 0.0998193392662282 + -5.963111948670274e-19i, -0.012094946090000051 + -0.013121806215786336i }, { 0.000164978874418529 + -5.2702362286179285e-05i, -0.0010100053566557761 + -0.0004425879326993994i, 0.0006162148678820947 + 0.00014965940008891142i, -0.0025924065470501337 + -0.002678219713124026i, -0.0018735533594112714 + 0.004637028475593191i, 0.028899134218752537 + -0.01163891546067902i, -0.012094946090000051 + 0.013121806215786338i, 0.11000584826660809 + 2.236166980751353e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.13668199256947616, 1.0e-7), DoubleNear(0.15080376334482787, 1.0e-7), DoubleNear(0.09476344386239222, 1.0e-7), DoubleNear(0.10431735557060076, 1.0e-7), DoubleNear(0.1442571784241124, 1.0e-7), DoubleNear(0.15935107869575285, 1.0e-7), DoubleNear(0.0998193392662282, 1.0e-7), DoubleNear(0.11000584826660809, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.13517220009010272 + -1.2061749168901237e-18i, -0.0006085667401840772 + 0.0037159593574101163i, -0.011675489890543646 + 0.017711482726339746i, -0.007395137277702055 + 0.010277363787859331i, 0.02571121459370266 + 0.01000996759866267i, -0.0021593432999891535 + 0.0014109422467901219i, -0.002382513280022369 + 0.002436674658076894i, -0.0003386692386609119 + -0.0014982328276791882i }, { -0.0006085667401840767 + -0.003715959357410115i, 0.1388027350044198 + -1.599198204416119e-18i, 0.008879682256600189 + -0.004569258818396683i, 0.002592705464879631 + 0.009768233696486111i, -0.0004765394669619316 + -0.0026841373781453176i, 0.022587641520600416 + 0.00979166842748332i, 0.0035030809605067345 + -0.0015226932878923095i, -0.0012967410451321956 + 0.0024537383275228582i }, { -0.011675489890543646 + -0.017711482726339746i, 0.008879682256600187 + 0.004569258818396682i, 0.159203919562102 + -1.2468324983583301e-18i, -0.013444293737941508 + 0.004394602830686016i, 0.000603625452043166 + -0.004325624576049738i, 0.0024244987490332354 + 0.003003606304033089i, 0.03327042949715282 + 0.012858491041132047i, -0.0039437410065408015 + 0.0019214121573264157i }, { -0.0073951372777020545 + -0.010277363787859331i, 0.0025927054648796307 + -0.00976823369648611i, -0.01344429373794151 + -0.004394602830686017i, 0.15791515837754475 + 3.3881317890172014e-19i, 0.0001024913513253971 + 0.0018122117801470537i, 0.00015280754815437137 + -0.003183888547967576i, -0.002975456287250361 + -0.004097870240447067i, 0.027904171415043554 + 0.010874366507018347i }, { 0.02571121459370266 + -0.01000996759866267i, -0.0004765394669619318 + 0.0026841373781453176i, 0.0006036254520431654 + 0.004325624576049739i, 0.00010249135132539669 + -0.001812211780147053i, 0.09400399315234859 + 2.168404344971009e-19i, -0.0014210806377479605 + 0.0034109153118700424i, -0.007972448588208796 + 0.01246226842926585i, -0.0042999643602345036 + 0.0059624894356290654i }, { -0.002159343299989154 + -0.001410942246790121i, 0.022587641520600412 + -0.00979166842748332i, 0.0024244987490332362 + -0.0030036063040330893i, 0.00015280754815437113 + 0.003183888547967576i, -0.0014210806377479594 + -0.0034109153118700424i, 0.09493543550499502 + 9.486769009248164e-20i, 0.006442703009943161 + -0.0035924498456689864i, 0.0011163538829779738 + 0.007017285873789936i }, { -0.002382513280022369 + -0.0024366746580768935i, 0.0035030809605067345 + 0.0015226932878923097i, 0.033270429497152816 + -0.012858491041132045i, -0.002975456287250361 + 0.004097870240447067i, -0.007972448588208798 + -0.01246226842926585i, 0.00644270300994316 + 0.0035924498456689842i, 0.11205917454304326 + 1.2197274440461925e-18i, -0.00963133745180025 + 0.0038063325201993315i }, { -0.00033866923866091156 + 0.0014982328276791884i, -0.0012967410451321954 + -0.0024537383275228587i, -0.003943741006540802 + -0.0019214121573264162i, 0.027904171415043554 + -0.010874366507018347i, -0.004299964360234504 + -0.0059624894356290654i, 0.0011163538829779736 + -0.007017285873789937i, -0.00963133745180025 + -0.0038063325201993315i, 0.10790738376544241 + 3.7947076036992655e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.13517220009010272, 1.0e-7), DoubleNear(0.1388027350044198, 1.0e-7), DoubleNear(0.159203919562102, 1.0e-7), DoubleNear(0.15791515837754475, 1.0e-7), DoubleNear(0.09400399315234859, 1.0e-7), DoubleNear(0.09493543550499502, 1.0e-7), DoubleNear(0.11205917454304326, 1.0e-7), DoubleNear(0.10790738376544241, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.11157648806248782 + -4.743384504624082e-19i, -0.0009378439385403966 + 0.0036215724652324845i, -0.009470522599704897 + 0.01452362233914643i, -0.00556138752391938 + 0.007865761984728234i, -0.0026831264046919697 + 0.002987346495740337i, -0.00019979793247619867 + 5.5193175160264126e-05i, 9.522800676469799e-05 + -0.0006250420275427809i, -1.5326350070382847e-05 + -0.00017591096988239053i }, { -0.000937843938540397 + -0.003621572465232482i, 0.11362163195569801 + -8.131516293641283e-20i, 0.007408108917181095 + -0.003889443034764595i, 0.001996442734336413 + 0.008229764531691722i, 0.00034436107632331264 + 5.0094110648737784e-05i, -0.0028423330967132007 + 0.0028564816487758374i, -0.00023978918484638708 + 0.0002921045987659399i, -0.0002012325658216349 + 0.00012591895962926931i }, { -0.009470522599704895 + -0.014523622339146431i, 0.007408108917181097 + 0.003889443034764594i, 0.1320399195439449 + -2.981555974335137e-19i, -0.011125500436096863 + 0.003861710281051764i, 0.00046047828889474824 + 0.00029734388850570005i, -0.0001866892426055178 + -7.449860116329936e-05i, -0.00325959752500437 + 0.0034437946978247923i, 0.0004190118023722961 + -0.0003455837973942598i }, { -0.005561387523919379 + -0.007865761984728235i, 0.001996442734336414 + -0.00822976453169172i, -0.01112550043609686 + -0.0038617102810517643i, 0.1293285157851663 + 9.351243737687476e-19i, 0.0004218135142557227 + 0.00016474011773954703i, 0.0003415309524913844 + 0.0004820867526923231i, 0.00025046806498035096 + 2.419398746797031e-05i, -0.003198882507668841 + 0.003345929497102219i }, { -0.00268312640469197 + -0.002987346495740336i, 0.0003443610763233128 + -5.009411064873777e-05i, 0.00046047828889474824 + -0.0002973438885057002i, 0.0004218135142557228 + -0.0001647401177395471i, 0.1175997051799635 + -5.149960319306146e-19i, -0.001091803439391641 + 0.0035053022040476742i, -0.010177415879047545 + 0.015650128816459167i, -0.0061337141140171796 + 0.008374091238760161i }, { -0.0001997979324761987 + -5.5193175160264045e-05i, -0.0028423330967132007 + -0.002856481648775837i, -0.0001866892426055179 + 7.449860116329946e-05i, 0.0003415309524913843 + -0.00048208675269232313i, -0.001091803439391639 + -0.0035053022040476755i, 0.1201165385537168 + -1.4230153513872246e-18i, 0.007914276349362256 + -0.004272265629301074i, 0.0017126166135211917 + 0.008555755038584325i }, { 9.522800676469787e-05 + 0.0006250420275427808i, -0.00023978918484638718 + -0.00029210459876593994i, -0.00325959752500437 + -0.003443794697824791i, 0.00025046806498035107 + -2.419398746797025e-05i, -0.010177415879047549 + -0.015650128816459167i, 0.00791427634936225 + 0.004272265629301072i, 0.13922317456120037 + 2.710505431213761e-19i, -0.011950130753644896 + 0.004339225069833584i }, { -1.532635007038271e-05 + 0.00017591096988239048i, -0.0002012325658216349 + -0.00012591895962926915i, 0.0004190118023722961 + 0.0003455837973942599i, -0.0031988825076688415 + -0.003345929497102219i, -0.0061337141140171796 + -0.008374091238760161i, 0.0017126166135211902 + -0.008555755038584325i, -0.011950130753644898 + -0.004339225069833585i, 0.13649402635782087 + -2.168404344971009e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.11157648806248782, 1.0e-7), DoubleNear(0.11362163195569801, 1.0e-7), DoubleNear(0.1320399195439449, 1.0e-7), DoubleNear(0.1293285157851663, 1.0e-7), DoubleNear(0.1175997051799635, 1.0e-7), DoubleNear(0.1201165385537168, 1.0e-7), DoubleNear(0.13922317456120037, 1.0e-7), DoubleNear(0.13649402635782087, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.14326510077541538 + -8.673617379884035e-19i, -0.0067569502660012205 + 0.003972502242103914i, 0.02893814369347927 + 0.011164850985910413i, -0.002960459430196998 + 0.0016213534068048672i, -0.003493764775728343 + 0.003798894630719555i, 0.00012445405875051365 + -0.0001579187823238641i, -0.0009850004078811921 + 0.0005453813033654885i, 2.2136228651586413e-05 + -0.00013118354470013606i }, { -0.00675695026600122 + -0.003972502242103913i, 0.14422065513888865 + 6.776263578034403e-19i, -0.0016731800042288673 + -0.0032774343850405074i, 0.024839089789942946 + 0.010101528932865853i, 0.00034760793879168935 + 4.1142046859907055e-05i, -0.0035735199360782304 + 0.003664686709318752i, 9.600590018290315e-05 + -3.067007974879431e-05i, -0.0009488883518409268 + 0.0003216545245044943i }, { 0.028938143693479267 + -0.011164850985910411i, -0.0016731800042288677 + 0.0032774343850405074i, 0.10035130683101731 + 9.486769009248164e-20i, -0.005306394108636039 + 0.0035107805041803344i, -0.000361849715137279 + 0.0010533299743847062i, -5.8177619475588334e-05 + -0.00012428027419829105i, -0.002448959153967997 + 0.0026322465628455744i, 9.475981114558378e-05 + -0.00013247183991013152i }, { -0.0029604594301969986 + -0.0016213534068048668i, 0.024839089789942946 + -0.010101528932865854i, -0.005306394108636038 + -0.0035107805041803336i, 0.09872949260197565 + 1.7618285302889447e-19i, 5.62985286962571e-05 + -6.955712104486807e-05i, -0.00046643998854870364 + 0.0008798567287343925i, 0.0002472212025119743 + 3.314605125680105e-05i, -0.0024676956683038114 + 0.002537724436559304i }, { -0.0034937647757283434 + -0.0037988946307195536i, 0.00034760793879168945 + -4.114204685990699e-05i, -0.00036184971513727885 + -0.0010533299743847062i, 5.629852869625704e-05 + 6.955712104486811e-05i, 0.15111101887678935 + -1.5856456772600502e-18i, -0.007295910212124365 + 0.004138059945992218i, 0.030043500397376213 + 0.011703607653884306i, -0.003142624876332957 + 0.0017110009973116702i }, { 0.00012445405875051368 + 0.0001579187823238641i, -0.0035735199360782312 + -0.0036646867093187516i, -5.817761947558843e-05 + 0.0001242802741982909i, -0.00046643998854870386 + -0.0008798567287343924i, -0.007295910212124366 + -0.00413805994599222i, 0.15249723824307587 + -1.938011383317839e-18i, -0.0017788157499834256 + -0.003504573233551877i, 0.025652723145701023 + 0.010564506001635813i }, { -0.000985000407881192 + -0.0005453813033654884i, 9.600590018290313e-05 + 3.06700797487944e-05i, -0.002448959153967997 + -0.0026322465628455735i, 0.00024722120251197447 + -3.3146051256801034e-05i, 0.03004350039737621 + -0.011703607653884306i, -0.0017788157499834252 + 0.003504573233551877i, 0.10571186086437451 + 1.3417001884508117e-18i, -0.005746023980912172 + 0.0037064673278890395i }, { 2.213622865158629e-05 + 0.00013118354470013604i, -0.0009488883518409269 + -0.0003216545245044941i, 9.475981114558373e-05 + 0.00013247183991013173i, -0.0024676956683038114 + -0.0025377244365593038i, -0.0031426248763329577 + -0.0017110009973116704i, 0.02565272314570102 + -0.01056450600163581i, -0.005746023980912172 + -0.0037064673278890403i, 0.10411332666846178 + 2.981555974335137e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.14326510077541538, 1.0e-7), DoubleNear(0.14422065513888865, 1.0e-7), DoubleNear(0.10035130683101731, 1.0e-7), DoubleNear(0.09872949260197565, 1.0e-7), DoubleNear(0.15111101887678935, 1.0e-7), DoubleNear(0.15249723824307587, 1.0e-7), DoubleNear(0.10571186086437451, 1.0e-7), DoubleNear(0.10411332666846178, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.1332224414352854 + -7.589415207398531e-19i, -0.004265695189309203 + 0.013316038942082817i, 0.023806146304660398 + 0.009695826509091586i, -0.0017210275974692995 + 0.0024329059742406872i, -0.0032536786906094137 + 0.0034741892620287758i, -3.6700691145468464e-05 + -0.0002567583743818341i, -0.000848002876816811 + 0.0003821334104810195i, 1.7931019960241452e-05 + -0.000296106244825412i }, { -0.0042656951893092 + -0.013316038942082817i, 0.15426331447901864 + 5.692061405548898e-19i, 0.0004230140720014725 + -0.0036054304904621307i, 0.02997108717876182 + 0.01157055340968468i, 0.0004771055916599259 + 0.0005039837738665487i, -0.00381360602119716 + 0.003989392078009531i, 8.016444063452495e-05 + -7.424286157477016e-05i, -0.0010858858829053079 + 0.0004849024173889633i }, { 0.023806146304660398 + -0.009695826509091586i, 0.00042301407200147215 + 0.0036054304904621316i, 0.09197567858290043 + 2.0328790734103208e-19i, -0.0032083846760592805 + 0.009437347928755335i, -0.0003832832359677126 + 0.0008793867782122232i, -0.00021786861105392834 + -0.0001882130887990295i, -0.002271780810795757 + 0.0023696388824873986i, -6.930386791146847e-05 + -0.00024236469353167752i }, { -0.0017210275974692988 + -0.0024329059742406872i, 0.029971087178761815 + -0.01157055340968468i, -0.0032083846760592805 + -0.009437347928755335i, 0.10710512085009255 + 6.776263578034403e-20i, -5.039991674272109e-05 + -7.472838215576307e-05i, -0.00044500646771827005 + 0.0010537999249068757i, 0.00032490364972620684 + 0.0002754468673314745i, -0.002644874011476051 + 0.00280033211691748i }, { -0.0032536786906094137 + -0.003474189262028775i, 0.00047710559165992577 + -0.0005039837738665487i, -0.0003832832359677127 + -0.0008793867782122232i, -5.03999167427211e-05 + 7.472838215576308e-05i, 0.14075249365923714 + -2.0464316005663896e-18i, -0.0048170892363548126 + 0.014163677480743042i, 0.024492709809642674 + 0.010105809517054403i, -0.0019582267276852653 + 0.002457507011359065i }, { -3.670069114546845e-05 + 0.00025675837438183434i, -0.0038136060211971605 + -0.003989392078009531i, -0.00021786861105392837 + 0.00018821308879902953i, -0.00044500646771827 + -0.0010537999249068755i, -0.004817089236354815 + -0.014163677480743042i, 0.1628557634606281 + -1.4772254600114998e-18i, 0.0003334189281960649 + -0.0039040826335551837i, 0.03120351373343456 + 0.012162304138465713i }, { -0.0008480028768168109 + -0.00038213341048101934i, 8.016444063452493e-05 + 7.424286157477021e-05i, -0.002271780810795757 + -0.0023696388824873977i, 0.0003249036497262068 + -0.0002754468673314746i, 0.024492709809642674 + -0.010105809517054403i, 0.0003334189281960643 + 0.003904082633555184i, 0.09696375007444318 + 1.0842021724855044e-19i, -0.003647710029171542 + 0.01004220637430045i }, { 1.793101996024143e-05 + 0.00029610624482541187i, -0.0010858858829053079 + -0.0004849024173889631i, -6.930386791146858e-05 + 0.0002423646935316773i, -0.002644874011476051 + -0.0028003321169174796i, -0.0019582267276852658 + -0.002457507011359065i, 0.031203513733434555 + -0.012162304138465713i, -0.0036477100291715443 + -0.010042206374300451i, 0.11286143745839311 + 1.531435568635775e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.1332224414352854, 1.0e-7), DoubleNear(0.15426331447901864, 1.0e-7), DoubleNear(0.09197567858290043, 1.0e-7), DoubleNear(0.10710512085009255, 1.0e-7), DoubleNear(0.14075249365923714, 1.0e-7), DoubleNear(0.1628557634606281, 1.0e-7), DoubleNear(0.09696375007444318, 1.0e-7), DoubleNear(0.11286143745839311, 1.0e-7) }));


}
}

}
