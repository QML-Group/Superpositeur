#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ Matrix({ { 0.2873457702916373 + -0.3079800221651044i, 0.22756860502799045 + 0.1418925109202369i }, { -0.18484161695584156 + 0.49259815831928333i, -0.02487735752526092 + 0.4184687307158059i } }), Matrix({ { -0.14084984702284478 + 0.15628871073157727i, 0.2996960764661786 + 0.05617408908512106i }, { -0.10778575561170294 + -0.15084637816903376i, 0.047240078350900924 + 0.030739600680525052i } }), Matrix({ { -0.17950775359910398 + 0.289184403056611i, 0.3937744813081994 + -0.44195430725606205i }, { 0.011986922566739881 + 0.12190483859796651i, 0.43785573741573924 + -0.17981524355010614i } }), Matrix({ { -0.41063516388489874 + 0.10349786823575109i, -0.15499964108912695 + 0.017315574902658407i }, { 0.19349120763796349 + 0.34568350168231443i, -0.2388787500292584 + 0.019322881243867232i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.12681928842715728 + 0.186731207650423i, -0.7261317759244195 + -0.30830809299033557i, -0.10219455076207068 + -0.060252155000069314i, 0.3679232319016054 + 0.4210528886033424i }, { 0.22436468156563377 + 0.519176235221406i, 0.2683104239076143 + -0.22489857222256115i, 0.613655899963978 + 0.22345854492809736i, 0.3619936317816925 + -2.7741069819786635e-05i }, { -0.46376927938727946 + -0.3776351168992185i, -0.3132168241902021 + -0.15060808272716553i, 0.4674142873295025 + 0.34739755362778746i, -0.03920472937289772 + -0.4252340689209273i }, { -0.5209605867583272 + -0.008642432820641782i, 0.347613713177082 + -0.11612943337919729i, -0.17040893044505417 + -0.4372851322748793i, 0.5642844660932586 + -0.2356471670854287i } }) }, { QubitIndex{ 3 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.3240193607055071 + -0.3340949768131156i, 0.32270937137282907 + -0.2843448491164716i, 0.5491558671361104 + 0.30496938142808905i, 0.015057494058574691 + 0.4512133094439413i }, { 0.05437370958579977 + 0.34900398442822506i, -0.12041250790794478 + -0.251578973243052i, 0.1714432737431681 + -0.4891209794957748i, -0.6663823867938093 + 0.29112016865325235i }, { 0.46096177871126776 + -0.3247521866132297i, 0.5105552753659284 + 0.08430125664018773i, -0.16461358786547908 + -0.5284906014196752i, -0.052626336289804926 + -0.3242026903219854i }, { -0.25670699303596495 + 0.5241979535433573i, 0.6186399395593613 + -0.29449405881489654i, -0.14789202177927965 + -0.09228966400326463i, 0.3590552293387317 + 0.17483080343240387i } }) }, { QubitIndex{ 6 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.6273997310522723 + 0.012065356205460148i, -0.5425423130334561 + 0.005350176255253271i, -0.025664179340421714 + 0.34349821865766106i, 0.14363088914571695 + -0.4154078841313967i }, { -0.06554594194185141 + 0.00441843642995237i, -0.4643569589934948 + -0.009962454047735428i, 0.19401072704898073 + 0.37514973697608406i, -0.10945782547299279 + 0.7678535460213455i }, { -0.06297860902275017 + 0.2976832627987555i, -0.17329218033930274 + -0.35297649709100704i, 0.7653716392612965 + -0.2676570782444255i, -0.22529445293737493 + -0.21119690893912602i }, { 0.4141264501101566 + -0.5812278939829442i, 0.22994031337808796 + -0.5314108046927583i, 0.14620828202633376 + -0.15544103982390903i, 0.22636163919870436 + 0.24212611841628925i } }) }, { QubitIndex{ 0 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.0874690824416704 + -0.35709922578658193i, 0.660422085184992 + 0.5969847458271786i, 0.18837707647052077 + 0.17269988371111905i, 0.02853176872598466 + -0.0784598662307957i }, { -0.05066130116121541 + 0.10492155347820228i, -0.012381935611031847 + 0.2427998967750742i, 0.1722557692844686 + -0.8459310137428755i, 0.4176285561162857 + -0.08737766893951975i }, { 0.7435533149439275 + -0.23822626343691547i, 0.12708672556465755 + -0.22784485849902741i, -0.08690489776177282 + -0.23448569071186562i, -0.04664949149194458 + 0.5075433227080537i }, { -0.03372177644163617 + -0.49040163109252755i, -0.27718542367272725 + 0.058742710103346446i, 0.1572587764157413 + -0.3196109729020133i, -0.6918590502306555 + -0.26932540686552614i } }) }, { QubitIndex{ 4 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.06657150384773902 + 0.1272209718413275i, -0.13652602106992184 + -0.14439733043879582i, 0.09077277158539934 + -0.05779574420217999i, 0.07458157530320264 + -0.012831361047760472i }, { 0.10155689908748897 + -0.12745773735973023i, 0.07613026626124068 + -0.06884337157170746i, 0.03924442057434445 + -0.22557707126721424i, -0.010429301003316587 + 0.029250117322147693i }, { -0.0705065670433132 + 0.10337932751356381i, -0.07773053597494198 + 0.02493864991497583i, 0.03598921963134473 + -0.17083048625768651i, 0.0358479351921276 + -0.14722915495327535i }, { -0.15930267330023945 + -0.10048859420403664i, 0.030410443002629597 + -0.14770784985942018i, -0.10131821641241365 + 0.07608598770721774i, -0.027568578161356792 + 0.04729016642952938i } }), Matrix({ { -0.06948505592759392 + -0.02032878157812288i, -0.08283926036405286 + -0.204308562469006i, -0.054550689134260436 + -0.027454814730364832i, 0.017963371735814568 + -0.009375350477139046i }, { 0.07149595569304411 + -0.002305351546933691i, -0.07540253979027868 + -0.13647285927965433i, 0.13484276329162673 + 0.06567122396916486i, -0.07888818693322447 + 0.06484177864598i }, { 0.01110245371597902 + 0.04575340040657063i, 0.07285695316092045 + 0.0438869225593907i, 0.0688688644578476 + 0.053428348140377196i, -0.3208086500705814 + 0.06202756243404046i }, { -0.015599793475048302 + 0.10926566340841841i, 0.06254863514053778 + -0.10640713062756955i, -0.01258278511630716 + 0.16541080154710988i, -0.08543415042532958 + 0.11147433463103874i } }), Matrix({ { 0.010742076924511615 + 0.10086262757953611i, 0.029306078059593083 + -0.032756142444795036i, 0.01101426761991502 + -0.0074090111391434755i, 0.12007905907533405 + -0.1374542641519957i }, { 0.03707658404845632 + -0.07391416558420306i, 0.009504335560428704 + 0.088154352437424i, 0.13021484492738772 + 0.08461907743221442i, 0.14739185597195503 + -0.03139438881831438i }, { -0.007457533153222482 + 0.06817731955966429i, -0.0008931985358286153 + -0.00424119316956501i, 0.04214513319458679 + -0.24091774913126568i, -0.03553947993516304 + -0.0840882787588815i }, { -0.01585693931357758 + -0.18934108797540053i, -0.062053392094061154 + 0.009907016563843556i, -0.04453979449905379 + -0.0505336653917141i, 0.02947136806042217 + -0.014699412282101986i } }), Matrix({ { -0.09940542213486647 + 0.05575992677636789i, -0.10635354411328571 + 0.19252982715807634i, -0.08368973952316124 + 0.07657967847453818i, 0.010859022564394907 + 0.05005847243119165i }, { -0.2013730009270192 + 0.09093406588170878i, 0.07656927292672798 + -0.02686556348487891i, 0.030814197578948866 + 0.0013737294639084938i, -0.0802017351811882 + 0.01381707879209843i }, { 0.10703105401243176 + 0.005046744810988071i, -0.09984823559504613 + 0.09213861258275212i, 0.09221999169208715 + 0.019940974690134783i, -0.12901274642159216 + 0.17903831441942655i }, { 0.16876622186440104 + -0.09702726569466646i, -0.05559096332009311 + -0.12384040448623573i, -0.05613308101012724 + 0.07289936565101626i, -0.04048748621553396 + -0.022846184769115225i } }), Matrix({ { -0.026773387335763784 + 0.0875447392604171i, 0.044083624730525094 + 0.05797393319647834i, -0.11756180384201816 + 0.053999757159819264i, -0.11873262024745407 + 0.004537326169449976i }, { -0.04700552684137001 + -0.03599864323406185i, 0.0056447962081346255 + -0.07810342411060621i, -0.050075269622987334 + -0.0656729605787126i, 0.1172843404783611 + -0.021707556475461888i }, { 0.028062732749911473 + 0.061054546719300745i, -0.11492812548622405 + 0.04333110424010601i, -0.10673296156321803 + -0.006887021686522392i, -0.09882435726097114 + 0.09137019131756181i }, { 0.1090521001154313 + 0.03859168044575176i, -0.03808488540868848 + -0.004719981021986656i, 0.02479744186532633 + -0.04875086882592993i, 0.09090141227469806 + -0.019868682526995595i } }), Matrix({ { 0.22399623468861216 + -0.12062913520565832i, 0.09816222415316248 + -0.012561284093821259i, -0.06583228572198092 + 0.11420520966291568i, -0.07837102976309136 + -0.07871337180904692i }, { -0.061817184400842946 + 0.007821536053679459i, 0.006036520881630369 + 0.08520126026578992i, 0.00366743007068734 + -0.0159062804805886i, -0.07863869500883601 + -0.0831541620315883i }, { 0.030335770362853554 + -0.029286479309556007i, 0.1388818259297609 + 0.061713527922042884i, -0.2310049839355301 + -0.15245305676523144i, 0.025524295523918692 + 0.1574069152684758i }, { 0.11409386256735322 + -0.0033264513721643196i, 0.0858436998759513 + 0.028870873196747762i, 0.1638523782047561 + -0.08275045694309328i, 0.15777784480496712 + 0.0952846495836978i } }), Matrix({ { 0.06442700881224532 + 0.0017681389509335193i, -0.03769679561020911 + -0.08733483913462173i, -0.06915608466943939 + 0.08981405969742727i, 0.14169752655742224 + -0.053440465812673504i }, { -0.10499980032769306 + 0.17403282495547664i, 0.067993754508277 + -0.018696697072493156i, 0.04088340512544613 + -0.03538600119315536i, -0.10907581307183768 + -0.018606691340067323i }, { 0.06414255486609197 + -0.0021872583410871447i, -0.03204270716757462 + -0.005955218899873449i, 0.01833362226841417 + -0.08636913836026087i, -0.08475589675498488 + -0.034611360563638026i }, { -0.018265513398924474 + -0.04096420198108851i, 0.029487033866211754 + -0.0844500254330829i, 0.04147802546271596 + -0.004317494491125513i, -0.017979054610439874 + -0.0220106891188493i } }), Matrix({ { -0.10164934313952291 + 0.010285273497441974i, 0.060307687810871875 + 0.12574587362090278i, 0.029593423216099885 + -0.06324138027318585i, 0.03723854940560701 + 0.004661555088461017i }, { -0.003925641160021424 + 0.09443104736621197i, -0.0766437443719701 + 0.05205676999401419i, -0.07105233112626533 + -0.018905468966523915i, 0.08399941331475763 + -0.08260835774212476i }, { 0.18654897867744522 + 0.0615630165151128i, -0.04361474976082763 + 0.02439981941261147i, -0.009831885224222294 + 0.08123427715667664i, 0.0043558706009495275 + 0.007554763318749743i }, { -0.0807017187403438 + 0.1493684681746962i, -0.013992209486836275 + -0.02713784931796529i, 0.04381404526588593 + 0.04734391341646037i, 0.08359574386825269 + 0.04449568700046416i } }), Matrix({ { 0.02185187222142798 + -0.05332942056541029i, 0.05783448201136457 + -0.07924360309941607i, -0.01446191721002747 + 0.1926729035367109i, -0.0682807606674289 + 0.19647127559080016i }, { -0.02302213004795127 + 0.13799789423809214i, -0.08342922036893018 + 0.1195435627501035i, 0.11914606411297586 + -0.02281789646135795i, 0.0006850397061879577 + 0.09770719170832372i }, { -0.07525723800221276 + 0.08007223048918366i, 0.12013504351123495 + -0.029541267686236945i, -0.12815679456974183 + -0.17609372024416903i, -0.032776518019734364 + 0.002248090493776872i }, { -0.047163748092541445 + -0.0730011578238474i, 0.07006483803782193 + -0.0062885616279018085i, 0.08853340758811089 + -0.04295322822363978i, -0.13487210533757296 + -0.012890197139149032i } }), Matrix({ { 0.046931957351507 + 0.21210006314807237i, 0.1993774455150664 + 0.027943103206528794i, 0.028392939308089518 + -0.137247359777993i, -0.043867901404836894 + -0.02314827516814607i }, { 0.06462061121028966 + 0.11029811447063226i, -0.10210050027780987 + 0.07211433837790243i, -0.02733397335387562 + -0.10941290647104i, 0.047019260608339504 + -0.07926851102534922i }, { 0.16028813074729284 + -0.019525795324392334i, 0.11478947937691078 + 0.04510614286556232i, 0.0868644820502411 + -0.02816328526689854i, 0.006013037320376193 + 0.05518220151251548i }, { -0.11304521744534561 + 0.017309592598234887i, -0.10735916777314795 + 0.08223099538316507i, 0.029732253986839333 + -0.1296586879144075i, -0.1716342040575432 + -0.13395686740438695i } }), Matrix({ { -0.06680234223571292 + 0.011343385667741578i, -0.007068201080422876 + 0.002750008004108098i, 0.028769263028144042 + -0.08615617834522876i, 0.019118371157051506 + 0.18447729908318028i }, { -0.009875308006235678 + 0.08411526177513247i, -0.12103950951147655 + -0.02233201660715156i, -0.10810375322729081 + 0.06139785693661726i, -0.08212819694010741 + 0.22927216098486175i }, { 0.0639660578222935 + 0.08453574694196353i, -0.07477258927737683 + -0.08246824575066813i, -0.02165385862747131 + -0.08353773224843454i, 0.07416060829652762 + 0.04788707529691938i }, { -0.05992014303838487 + -0.17674532821677627i, -0.02847011283340909 + 0.05563942514200481i, 0.02867467578270563 + -0.005529460877389397i, -0.026511761973440344 + -0.05050621113403394i } }), Matrix({ { -0.11885419283244224 + -0.006252299323408855i, 0.1728665433531463 + 0.16300639823792523i, 0.09367404887262017 + 0.07223255022996249i, 0.07078832073836139 + -0.01728405408912232i }, { -0.015343886490713866 + -0.03392398090867853i, -0.020871668270340444 + 0.13516016889294644i, 0.03177019610593512 + 0.1036275899605749i, 0.019966070691946024 + 0.023975559887976006i }, { -0.024599561390074708 + -0.10096618990075092i, 0.006305913780750147 + -0.12659050696789625i, -0.06142679726634863 + -0.1740904771048415i, 0.07855985203329134 + 0.11345863748536753i }, { 0.07282555777049804 + -0.09931390220414135i, 0.09849806820402594 + 0.06520371508667845i, -0.10511693753286189 + -0.008912453376899167i, -0.05891973089596068 + -0.06170796529137413i } }), Matrix({ { 0.04416922598578061 + 0.09285835434305018i, 0.06476301253738524 + -0.1109072621927571i, 0.19982747040400772 + -0.05283835945941538i, 0.03812981488408451 + 0.07583425753120049i }, { -0.06219953303713474 + 0.13079708609310445i, -0.022940750368028055 + 0.020761143719095102i, -0.10113436486059264 + -0.0028237238378455826i, -0.047961155859721376 + -0.04796176260394778i }, { -0.09103323512969154 + -0.047896976482408024i, 0.09789773586231681 + 0.0067575120937742525i, -0.17022524565608385 + -0.018874586279052873i, 0.15385778666525904 + 0.03538966317871974i }, { 0.07413391377753065 + 0.0341113692732667i, -0.05749086990723752 + -0.0432487308227063i, -0.058935235537018744 + 0.013926750004448053i, -0.017427061257322872 + 0.09993586509825435i } }), Matrix({ { -0.0498817606650869 + -0.0014456243353019073i, -0.1256754458324148 + -0.0347314741198805i, 0.022679449393118615 + 0.019162839209534228i, -0.05474161026263784 + -0.05326199113338619i }, { -0.06914598786679767 + -0.11451025922247571i, 0.03195524908899021 + 0.009724226445571828i, 0.09191785090780999 + -0.12652388686924276i, -0.134694778428258 + 0.10452498144614564i }, { -0.04377872802569887 + 0.03646915449080854i, 0.1039910859564674 + 0.040490405295480335i, -0.14812060019517378 + 0.051584603010832696i, 0.031575165231264274 + -0.09689239454590508i }, { -0.017038471293898346 + -0.01710794093766724i, 0.21033672191599118 + -0.07003408483426257i, 0.02019841833601664 + 0.012032893429571348i, -0.01648857868617166 + -0.046396863658582685i } }), Matrix({ { -0.14008213470766057 + 0.06576750862035267i, 0.1282298585039584 + -0.06198047848346088i, -0.02289270671834575 + -0.042610716021880775i, 0.10958781672863613 + 0.07461360748487068i }, { 0.058845956412607675 + 0.08003868125707946i, -0.012492512223582867 + 0.12509490052487407i, -0.13295373949514078 + 0.0029399048725253897i, 0.062234291213578125 + 0.04307359582984711i }, { 0.029136526950257417 + 0.2194449284487245i, 0.08372219739540121 + -0.18453065041901304i, 0.058246524661572596 + -0.018189467502498228i, -0.05779424871526196 + -0.009599098469481416i }, { -0.025478017786954577 + 0.101694807467902i, 0.08052557505763838 + -0.048019486011195316i, -0.006054530384899505 + 0.023200236833753624i, 0.028912004142096645 + 0.038388063165980243i } }), Matrix({ { 0.0011851768485657945 + 0.06609755237350683i, -0.0876950603801802 + 0.03415810514034279i, -0.029455121252082436 + -0.022487846621293148i, -0.0870339129318711 + 0.034844391343265856i }, { 0.029366461314648984 + 0.12353665481680107i, -0.0889116582931934 + 0.10144305699647141i, 0.09560993738495567 + 0.12352825000825077i, 0.032267630971162684 + -0.16915294374335132i }, { -0.09874133384976322 + -0.024972445882456083i, -0.03534709298463898 + -0.17499095416856708i, 0.11506155196758816 + 0.1218650668225162i, -0.07412204203456171 + 0.0018963555798214785i }, { 0.11353877533932058 + -0.03316839667034761i, 0.03608056482819165 + -0.23029548705058797i, 0.09212946336641736 + -0.047588908034093054i, -0.08339454425302185 + -0.2238225039131034i } }) }, { QubitIndex{ 2 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.15954391553076097 + 0.36489768353756186i, -0.0654918145852694 + 0.10334422392539847i }, { 0.05623862916716556 + 0.3786734136726583i, -0.3723194187058233 + 0.157985609718629i } }), Matrix({ { 0.5678411700376065 + -0.20241291154334995i, 0.04146934800813552 + -0.1463433761921264i }, { -0.01132259690201793 + 0.23646700842430957i, 0.12266338617230652 + 0.4580399652458428i } }), Matrix({ { 0.05570802858228871 + 0.1325887263234898i, 0.10155945543183095 + 0.3724777811847407i }, { 0.09722971920353327 + 0.053260437030044266i, -0.16617252911522393 + -0.13358536685072217i } }), Matrix({ { 0.06744402361100776 + 0.23842183730145666i, -0.2249797834384905 + -0.2853977496387427i }, { -0.1083684159441594 + 0.4114229257918378i, 0.37488867957534605 + -0.3261056636567854i } }) }, { QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.07997211617141398 + 0.03332089906880976i, 0.022863529986840145 + 0.06233683101395316i, 0.12027829237218222 + -0.0545985799155107i, -0.021009028161626597 + -0.043068275462811424i }, { -0.030660271482694595 + 0.04328225344393384i, 0.06768607876164054 + -0.06102135779978943i, -0.05278886887292566 + 0.06963817666544724i, 0.04434457974033553 + 0.10651826654610719i }, { 0.04629253055352654 + 0.028050526288659915i, -0.05825786542944257 + -0.08386648956486727i, 0.05711927690884984 + 0.08031610654529876i, -0.0320242430543998 + 0.08333508765551008i }, { 0.0004965492764391552 + -0.18195505859417135i, 0.10103754332432521 + 0.04714789098283784i, 0.045841947245236374 + -0.03896675635645529i, -0.17120699491156519 + 0.09173736423219928i } }), Matrix({ { 0.04939855582883835 + 0.0724084542413009i, 0.09920484095094041 + -0.1302542143622476i, -0.25650448460362385 + -0.039193449406360936i, 0.05296518105087021 + 0.05199601398720581i }, { 0.12612606718750946 + 0.07495629937502862i, -0.015692828603615448 + -0.11973388245403764i, -0.060355932584968394 + -0.06139992208209868i, 0.03860801638726435 + 0.08765863333326815i }, { 0.03669056127412133 + 0.01633203137093803i, -0.1235395765007125 + -0.04571083382884314i, -0.008215274429013297 + -0.13872602980823479i, 0.11789080914531357 + 0.1121403910333208i }, { 0.01315180194474359 + 0.04014394641766483i, -0.11463794736978548 + 0.126830149848799i, 0.02820128489905646 + 0.02789411635076166i, -0.029618679753837963 + -0.002662947750192922i } }), Matrix({ { 0.049114937128613215 + -0.015325161235585702i, -0.03140922874388566 + -0.16606566137934714i, 0.0885386708458993 + 0.05589439491674969i, 0.02249410448717593 + -0.03557536251414859i }, { 0.028936458802025118 + 0.17107493202086183i, 0.07096644102065913 + -0.08893198700412111i, 0.14197474266466423 + 0.05166473743173163i, -0.07095041600584762 + 0.04666702511292575i }, { -0.0503287917222172 + 0.1753736779052331i, 0.029584548696505442 + 0.17522605816940517i, 0.09495370184310382 + 0.051081644078445364i, -0.06201059310408157 + -0.02575263906277026i }, { 0.10716479699492665 + -0.07115531697890931i, -0.052511200233188594 + -0.037649996861090385i, -0.1307538198320558 + 0.09682560295423492i, -0.0023046237192321656 + 0.003727487985662382i } }), Matrix({ { 0.014976158157075821 + -0.13920751555370814i, 0.009670739934569753 + 0.04511490366641313i, -0.24143117499670444 + -0.057973082181782216i, -0.0802259871869452 + -0.022174223310572505i }, { 0.08123396985378221 + 0.07882044021270201i, 0.018756877853609712 + -0.030723489242948803i, -0.04380984303041446 + -0.017411585960991956i, -0.012886665827407032 + -0.19314666969496735i }, { -0.06463559131379132 + 0.08681213820542007i, -0.03966657199906972 + 0.19081959668123433i, -0.08344747187214015 + 0.11702601361767702i, -0.008378943123584203 + -0.04632709448719026i }, { -0.13018052446711006 + -0.07072504860909709i, -0.1552399006549579 + 0.047327225801710344i, 0.08029588474509985 + -0.06989895443529542i, -0.06853405140608511 + -0.042408192752447324i } }), Matrix({ { -0.16243789632016248 + -0.05989699800141639i, 0.16281041261306725 + -0.06792520015618918i, -0.023418393735485165 + -0.08159814817047342i, 0.010085314759311535 + -0.1969520105383256i }, { 0.000414171904832201 + -0.17557137795008174i, 0.02201419646155085 + -0.005978617306321989i, -0.12196259391110459 + 0.019805896485226883i, 0.005080316545666628 + 0.05512455807369829i }, { -0.09179284642136407 + 0.08486642963494914i, -0.11146395255833705 + -0.16700055290120885i, -0.0018290002152582818 + -0.05255670866705943i, 0.09838391334963469 + 0.09678147951631944i }, { -0.04117101284937997 + 0.013111234689782132i, -0.05538723568399159 + -0.059737365092809865i, 0.2020970083812238 + -0.03974630859882262i, 0.048018084045298545 + 0.05152131122407954i } }), Matrix({ { 0.0203746122790459 + -0.09450030787096723i, 0.031659222016986406 + -0.01819026144260363i, 0.0740660113816568 + 0.09321430229168749i, 0.08093286902377872 + -0.05434612013034183i }, { -0.00022124269032165137 + 0.09674012843234026i, 0.1185948477156044 + 0.09940748397810707i, 0.04781869962744893 + 0.050049619182160644i, -0.08222326872739709 + 0.005028149229308269i }, { -0.016579837013821756 + 0.0013624775909239642i, -0.008391658415330898 + 0.09070249369048256i, -0.06209404461382691 + 0.16517148214699393i, 0.08274418271824921 + -0.09902024600071348i }, { -0.0062334547030146155 + -0.02156014684428434i, 0.04022404863820882 + 0.042225985371066754i, 0.02221648723279421 + 0.06245641823429666i, 0.11283449996233555 + 0.010635799879124259i } }), Matrix({ { -0.15868437811275427 + -0.16525926651890313i, 0.011577543468121919 + 0.13206469743488475i, -0.01148984716832221 + -0.1828711590508757i, -0.032606978925720884 + -0.06336227034705878i }, { -0.0008466919304476348 + -0.019588108562063812i, 0.2008731030788002 + 0.004270799601696369i, 0.047899601863216956 + -0.17587359967164964i, 0.12735977574643167 + 0.10209172521511904i }, { 0.08248725168465508 + -0.016664856218140223i, -0.018382294263944294 + 0.10855071953227297i, 0.012997450390570783 + -0.17254660439597208i, -0.02147529095532312 + 0.057014278569365674i }, { -0.046993843092468734 + -0.06849120721071371i, 0.18339715797870854 + -0.028007535414034623i, -0.0678091684628345 + 0.09895027243165556i, 0.1351292399215042 + 0.15227468674546454i } }), Matrix({ { -0.06605722342737927 + 0.08917885362585233i, 0.17247678817748402 + -0.12358212386594769i, 0.06228075909584988 + -0.1306217411977437i, 0.15817287677720485 + -0.17357407386927243i }, { 0.2241780134017563 + 0.03558087062466935i, 0.10662387649149925 + -0.06141379647996187i, -0.050298633139644985 + -0.014340055663624464i, -0.10369263621112276 + 0.06077325057457309i }, { 0.027895271120025354 + 0.2534114394651872i, -0.08198900481721258 + 0.044423667812697416i, 0.0046947147249279024 + -0.035571312166271817i, -0.046729427530648966 + 0.11986674936923325i }, { 0.05149631167702167 + -0.046835052757720916i, 0.07558242899237128 + -0.09977095845612209i, 0.08222712201938644 + -0.08283280576001416i, -0.07712441498554473 + -0.043755982474110534i } }), Matrix({ { -0.08856111726867613 + -0.01110159217479705i, 0.01496674407078929 + -0.04558575962195444i, 0.06335365802236144 + -0.004233083778561094i, 0.07366568702046516 + -0.035907967433271494i }, { 0.018633660945979062 + -0.03148346024048885i, 0.06743428457100312 + 0.03982326323504982i, 0.013801770908273236 + 0.02230078840771326i, -0.07804340246660697 + -0.00265046297001649i }, { 0.051589032240414355 + -0.07493832820299816i, -0.10462507104184081 + -0.02516429230172032i, 0.05207334007937937 + 0.04523382983973439i, 0.0973759898537496 + 0.011621801713078674i }, { 0.17406693474278842 + 0.10276224866306623i, -0.03455256464066697 + -0.07842122659748206i, 0.010308332048949091 + -0.0592228391279196i, -0.11575092194752247 + -0.10831756220771205i } }), Matrix({ { 0.02069416399231009 + -0.06458029644666162i, 0.21144579472009079 + 0.09269822496850635i, 0.03883467634432591 + 0.030758624139973538i, 0.22384713467099704 + -0.07727596669999338i }, { 0.03871123176720459 + 0.004951348685796379i, -0.04390523781782115 + -0.18173261585065595i, 0.12915469044447386 + 0.018834319505924887i, 0.12645171417153486 + -0.14144560263764194i }, { 0.1965762324425005 + 0.01086803881984047i, -0.0375107038222824 + -0.03359964862033298i, -0.0632912669506121 + -0.08156482256178216i, -0.00327968395044976 + 0.08215595528656686i }, { 0.15421526404382763 + 0.05530442953559002i, 0.07995620715292118 + -0.017063113207721078i, -0.09904650128910415 + -0.0030282954324778325i, -0.08232182368909237 + -0.043162723917946164i } }), Matrix({ { 0.07926382617696749 + 0.05984729415076926i, 0.13542463763920232 + 0.03006803818092829i, 0.029622175471856162 + 0.07418302912197877i, 0.09748488960414653 + 0.10874948228667262i }, { 0.06785199969568835 + -0.047870865848510254i, -0.0441535660901511 + -0.10366014472985101i, -0.1395198662534922 + 0.06522468041612818i, -0.09679821158179312 + -0.10659089865022082i }, { -0.04394262585594873 + -0.048829761183086975i, 0.0642084137025242 + -0.12865613938997372i, 0.036272834057980714 + -0.06833306833692923i, 0.136468969666886 + 0.11724007215121089i }, { -0.028765587987535236 + -0.06856602468892853i, 0.03508503034255996 + 0.006239886264171456i, 0.09989715187307975 + -0.09691714278006665i, 0.1530014217697662 + 0.011889620271707585i } }), Matrix({ { 0.11306282213913288 + -0.09640943573781148i, 0.014141239545798387 + -0.039972001277493556i, 0.018831268803804636 + -0.008458495864345458i, -0.1021138531670457 + -0.010602012489191369i }, { -0.10973690513209207 + -0.09522486900982637i, 0.06054271474212581 + 0.18486034785531041i, 0.041157140530440985 + -0.015265683805253392i, -0.07445305147108375 + -0.183144814271763i }, { -0.060025402670090544 + 0.011447671344152454i, -0.1268888705488244 + -0.01691066232206145i, -0.08972518253212139 + -0.1332999749423962i, -0.05643873687870108 + 0.07189785148771512i }, { -0.05616564523497275 + -0.06806933940414746i, -0.03754542104888467 + -0.010966549274164308i, -0.1446228044725276 + -0.05984416722459051i, 0.034044755052774156 + -0.049000818004494545i } }), Matrix({ { 0.13624334403017302 + -0.04638596859654306i, -0.04028558812179109 + 0.06558674022769077i, 0.21098915581368258 + 0.038606917389160396i, -0.06948985317999373 + -0.06932153177994001i }, { -0.030964387272670126 + 0.18675216342425957i, 0.05487251340851787 + 0.04933856705424249i, 0.00828825963537886 + -0.013207148873624529i, 0.06984564634807462 + 0.11147306587223728i }, { 0.03342495705198313 + 0.1704301641130245i, -0.023534108254372705 + 0.04861513352088645i, 0.058076400260268765 + 0.001383675257461153i, -0.006343170986805855 + 0.09312564197160843i }, { -0.047389490806226266 + -0.014587414689384256i, -0.17689252948454887 + -0.03212452660183207i, 0.21824662200315198 + -0.05806799439484623i, 0.15857935244670976 + 0.09593681309208787i } }), Matrix({ { -0.04400880796424367 + -0.0694894853632277i, -0.11172147677907833 + 0.07414035889149519i, -0.05933546188404248 + 0.11188228204328717i, 0.036564782037239715 + -0.09751754513307286i }, { 0.021747506619100545 + -0.020452550633268486i, -0.11378938819445661 + -0.13942914891742475i, -0.003428725293108184 + -0.011093169836475871i, -0.04294784038619021 + 0.04118087447614464i }, { 0.07286668245471106 + 0.03643229180607067i, 0.03852021143508487 + 0.02648602700584619i, -0.11138615834242853 + 0.05561878665422861i, 0.08457653848160107 + -0.07240623712904798i }, { 0.08639135323008569 + 0.04425348560498548i, -0.04987067930234018 + 0.0856696723507117i, -0.054933199898520885 + 0.024807744837793598i, 0.19657868942613005 + -0.0410920282632674i } }), Matrix({ { 0.04496964636824378 + 0.044545373311667844i, -0.05134327288127552 + -0.0504191820254728i, 0.04517954718257491 + -0.05235382576602986i, -0.02025730516936563 + 0.05070718140185418i }, { -0.15406661457688253 + -0.02011796836149619i, 0.028718760707259292 + -0.09455262707546024i, -0.04773650955599631 + 0.08171916001376475i, 0.01786817598399606 + -0.04481584828119024i }, { 0.01089401455828974 + -0.12256071297109436i, 0.0288597745913237 + 0.07752211777858388i, 0.0021239268245679226 + 0.062170007485855106i, 0.06823494026252923 + 0.13524594691492559i }, { -0.06266371871144787 + 0.09880754298683836i, -0.16140308566069753 + -0.019989681995437547i, 0.18836126845747314 + -0.09072211666463002i, 0.023497491007798056 + 0.0051427242255955045i } }), Matrix({ { -0.1263510257696775 + 0.12300773304250721i, -0.058233376440052984 + 0.04115527178642001i, -0.06265972283712491 + -0.08961040769673569i, 0.10205121865647937 + 0.11659129443360218i }, { 0.03800300256434107 + 0.023379686069699028i, -0.03272715290103193 + 0.10620425068168489i, 0.017956945913605395 + -0.05516286396378934i, 0.11245565014071372 + 0.015844187848679882i }, { -0.19378018990039636 + -0.04085773819541344i, 0.02290365480598821 + -0.09590185464278146i, -0.13499221837577283 + -0.17138310332674128i, -0.0016653294116130363 + 0.0010371363977542088i }, { -0.10561268434561355 + 0.09619104039756081i, -0.07477429010169466 + -0.02494147218950905i, -0.06148193136972119 + 0.03447561872751481i, 0.09449538098479973 + 0.1450629715088463i } }) }, { QubitIndex{ 3 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.13306352988764036 + -0.1491603139086158i, 0.01873744302322872 + -0.19924860080248943i }, { 0.3597910177891262 + 0.2921995146373085i, 0.12135956398091598 + -0.15202937350134543i } }), Matrix({ { -0.001043963643398406 + 0.4644719198241486i, -0.11411622973884762 + 0.2836633571359056i }, { 0.10372319667324816 + 0.11903024335319312i, -0.5409356756649539 + 0.10036852917124064i } }), Matrix({ { -0.3197592895713951 + -0.037092410379425685i, 0.518375941618001 + -0.18724544078476887i }, { 0.19392411023075812 + -0.15958761016575634i, -0.2969770210316059 + 0.1896645581342685i } }), Matrix({ { 0.3340791740668389 + -0.03405676432733862i, 0.172245587114271 + -0.2243068710334777i }, { -0.26672542941659155 + 0.39235874139006i, -0.05110730392277796 + 0.12409121419464647i } }) }, { QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.7296473599357551 + -0.3440740097902678i, -0.49959355664645466 + -0.3156486719170145i }, { 0.017452775239290758 + -0.5906972207163973i, 0.693101989185491 + -0.4127733356958586i } }) }, { QubitIndex{ 1 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_20_2_10_30_80) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.27766647719650417 + -4.086086937554745e-18i, -0.21011198236782172 + -0.32363388460253334i }, { -0.21011198236782175 + 0.32363388460253334i, 0.7223335228034949 + -1.9881557337952938e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.27766647719650417, 1.0e-7), DoubleNear(0.7223335228034949, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.4651571218296825 + -9.324138683375338e-18i, 0.008368132841260494 + 0.04904819709835775i }, { 0.008368132841260487 + -0.04904819709835774i, 0.5348428781703167 + -1.4643505592132344e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.4651571218296825, 1.0e-7), DoubleNear(0.5348428781703167, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.5074363629859171 + -1.3179832659276913e-17i, -0.002150574728432386 + -0.00629344225014691i }, { -0.002150574728432384 + 0.006293442250146912i, 0.4925636370140821 + -1.0787811616230769e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5074363629859171, 1.0e-7), DoubleNear(0.4925636370140821, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.566332140607614 + -9.839134715305953e-18i, 0.015399690908202365 + 0.029638757524863307i }, { 0.015399690908202358 + -0.029638757524863307i, 0.43366785939238517 + -1.412850956020173e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.566332140607614, 1.0e-7), DoubleNear(0.43366785939238517, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.5110347244751179 + -1.1119848531554455e-17i, -0.09955286951543948 + -0.21253493948416782i }, { -0.09955286951543947 + 0.21253493948416782i, 0.4889652755248812 + -1.2847795743953228e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5110347244751179, 1.0e-7), DoubleNear(0.4889652755248812, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.5020933778471953 + -1.0679391398982219e-17i, -0.038596442076681045 + 0.0008395119911555569i }, { -0.03859644207668104 + -0.0008395119911555429i, 0.4979066221528038 + -1.3288252876525464e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.5020933778471953, 1.0e-7), DoubleNear(0.4979066221528038, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.5409792845544358 + -1.4921332398831755e-17i, 0.4268476780320255 + 0.04310834770518117i }, { 0.42684767803202545 + -0.0431083477051812i, 0.45902071544556333 + -9.046311876675928e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.5409792845544358, 1.0e-7), DoubleNear(0.45902071544556333, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.47669809463007445 + -1.3335686721571705e-17i, 0.03620052201025774 + -0.24359181927023327i }, { 0.03620052201025775 + 0.24359181927023327i, 0.5233019053699246 + -1.0631957553935978e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.47669809463007445, 1.0e-7), DoubleNear(0.5233019053699246, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.12043470304813464 + -1.7076184216646695e-18i, -0.08999952808210467 + -0.15102170381337515i, 0.0030861322228217143 + 0.017285438931206328i, 0.016637973974879355 + -0.016557729085677007i }, { -0.08999952808210468 + 0.1510217038133751i, 0.3447224187815478 + -7.616520261710669e-18i, -0.01680680383652742 + -0.006164925000070175i, 0.005282000618438778 + 0.03176275816715142i }, { 0.0030861322228217134 + -0.017285438931206328i, -0.01680680383652742 + 0.006164925000070175i, 0.15723177414836953 + -2.3784685158900754e-18i, -0.12011245428571707 + -0.17261218078915821i }, { 0.016637973974879355 + 0.016557729085677007i, 0.005282000618438773 + -0.03176275816715141i, -0.12011245428571707 + 0.17261218078915821i, 0.3776111040219472 + -1.2265037076242269e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12043470304813464, 1.0e-7), DoubleNear(0.3447224187815478, 1.0e-7), DoubleNear(0.15723177414836953, 1.0e-7), DoubleNear(0.3776111040219472, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.1408980673117063 + -1.145188544687814e-18i, -0.10661846015248866 + -0.1642236013417136i, 0.0029201389062568344 + 0.008545494990695178i, -0.00569669498458942 + -0.005639732035924372i }, { -0.10661846015248867 + 0.1642236013417136i, 0.36653829567421076 + -1.2034644114589099e-17i, 0.0010540286602186192 + -0.007946567483380212i, -0.005070713634689221 + -0.014838937240842088i }, { 0.0029201389062568335 + -0.00854549499069518i, 0.0010540286602186194 + 0.007946567483380214i, 0.13676840988479788 + -2.9408983928669308e-18i, -0.10349352221533306 + -0.15941028326081974i }, { -0.00569669498458942 + 0.005639732035924377i, -0.005070713634689217 + 0.01483893724084209i, -0.10349352221533306 + 0.1594102832608197i, 0.3557952271292842 + -7.846913223363838e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.1408980673117063, 1.0e-7), DoubleNear(0.36653829567421076, 1.0e-7), DoubleNear(0.13676840988479788, 1.0e-7), DoubleNear(0.3557952271292842, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.15645754854662444 + -1.0299920638612292e-18i, -0.12485491831574154 + -0.18015690943872656i, 0.009299070281670974 + 0.0028697306137768944i, 0.0033496350567100313 + -0.00807844750068457i }, { -0.12485491831574153 + 0.18015690943872653i, 0.40987459206098953 + -8.809142651444724e-18i, -0.014795412753551592 + -0.0009762232100070244i, 0.006100620626531392 + 0.02676902691108641i }, { 0.009299070281670974 + -0.0028697306137768965i, -0.014795412753551593 + 0.0009762232100070231i, 0.12120892864987973 + -3.0560948736935156e-18i, -0.08525706405208018 + -0.14347697516380675i }, { 0.0033496350567100344 + 0.008078447500684567i, 0.006100620626531385 + -0.026769026911086406i, -0.08525706405208018 + 0.14347697516380678i, 0.31245893074250547 + -1.1072414686508214e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.15645754854662444, 1.0e-7), DoubleNear(0.40987459206098953, 1.0e-7), DoubleNear(0.12120892864987973, 1.0e-7), DoubleNear(0.31245893074250547, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.1417656464173209 + -2.0125502826762176e-18i, -0.10721054745088346 + -0.16577347491379318i, -0.028532847905359256 + -0.06033631164922921i, -0.04288337230707549 + 0.07591542561701442i }, { -0.10721054745088346 + 0.16577347491379318i, 0.36926907805779696 + -9.107298248878237e-18i, 0.0869371928173216 + 0.016693308265198673i, -0.07102002161008024 + -0.15219862783493862i }, { -0.028532847905359253 + 0.06033631164922921i, 0.08693719281732161 + -0.016693308265198673i, 0.13590083077918327 + -2.0735366548785272e-18i, -0.10290143491693826 + -0.15786040968874013i }, { -0.04288337230707549 + -0.07591542561701442i, -0.07102002161008023 + 0.15219862783493862i, -0.10290143491693826 + 0.15786040968874013i, 0.353064444745698 + -1.07742590890747e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.1417656464173209, 1.0e-7), DoubleNear(0.36926907805779696, 1.0e-7), DoubleNear(0.13590083077918327, 1.0e-7), DoubleNear(0.353064444745698, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.1389365589402304 + -1.179069862577986e-18i, -0.10525335542150807 + -0.16215353433508206i, 0.05240783808212989 + 0.00041688692936533956i, -0.04162295775302457 + 0.019735175705827016i }, { -0.10525335542150807 + 0.16215353433508203i, 0.36315681890696494 + -9.500321536404233e-18i, -0.041699141916840224 + -0.021665683120903684i, -0.09100428015881093 + 0.00042262506179021854i }, { 0.05240783808212989 + -0.0004168869293653205i, -0.041699141916840196 + 0.021665683120903674i, 0.13872991825627376 + -2.9070170749767588e-18i, -0.10485862694631365 + -0.16148035026745128i }, { -0.04162295775302459 + -0.01973517570582703i, -0.09100428015881093 + -0.00042262506179022196i, -0.10485862694631365 + 0.16148035026745128i, 0.35917670389653006 + -1.0381235801548705e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1389365589402304, 1.0e-7), DoubleNear(0.36315681890696494, 1.0e-7), DoubleNear(0.13872991825627376, 1.0e-7), DoubleNear(0.35917670389653006, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.13728328918454197 + 1.328147661294743e-18i, -0.12006717068493876 + -0.16700782853086743i, 0.11852129105866024 + -0.0016304764462859022i, -0.08422523505006714 + -0.15393345180057774i }, { -0.12006717068493877 + 0.16700782853086743i, 0.4036959953698938 + -1.6249480060126498e-17i, -0.09514638855075419 + 0.12235129254957414i, 0.30832638697336523 + 0.044738824151467065i }, { 0.11852129105866027 + 0.001630476446285901i, -0.09514638855075419 + -0.12235129254957414i, 0.1403831880119622 + -5.414234598849488e-18i, -0.09004481168288296 + -0.1566260560716659i }, { -0.08422523505006713 + 0.15393345180057777i, 0.30832638697336523 + -0.044738824151467106i, -0.09004481168288296 + 0.1566260560716659i, 0.31863752743360113 + -3.63207727782644e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.13728328918454197, 1.0e-7), DoubleNear(0.4036959953698938, 1.0e-7), DoubleNear(0.1403831880119622, 1.0e-7), DoubleNear(0.31863752743360113, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.13236308062221866 + -2.290377089375628e-18i, -0.1001599816536885 + -0.15427565614775718i, 0.01005167141926279 + -0.06763728233065325i, -0.08644073017014912 + 0.03946584447263368i }, { -0.1001599816536885 + 0.15427565614775718i, 0.3443350140078557 + -1.1045309632196076e-17i, 0.07122840328549868 + 0.06289727559827216i, 0.026148850590994952 + -0.17595453693958005i }, { 0.01005167141926279 + 0.06763728233065325i, 0.07122840328549868 + -0.06289727559827216i, 0.1453033965742855 + -1.7957098481791167e-18i, -0.10995200071413322 + -0.16935822845477616i }, { -0.08644073017014914 + -0.03946584447263369i, 0.026148850590994963 + 0.17595453693958005i, -0.10995200071413323 + 0.16935822845477616i, 0.37799850879563923 + -8.836247705756861e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.13236308062221866, 1.0e-7), DoubleNear(0.3443350140078557, 1.0e-7), DoubleNear(0.1453033965742855, 1.0e-7), DoubleNear(0.37799850879563923, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.2359558843492649 + -5.149960319306146e-18i, 0.004297799495882846 + 0.02496327201924023i, -0.0019400846794627104 + -0.007720153232331235i, -0.001236528075005226 + 0.0012400864316638826i }, { 0.004297799495882843 + -0.024963272019240222i, 0.27148047863665214 + -8.029872339970767e-18i, 0.001768674749076192 + 0.0007372028608748323i, -0.00021049004896967507 + 0.001426710982184325i }, { -0.0019400846794627095 + 0.007720153232331236i, 0.0017686747490761917 + -0.0007372028608748323i, 0.2292012374804176 + -4.174178364069192e-18i, 0.004070333345377647 + 0.024084925079117518i }, { -0.0012365280750052253 + -0.0012400864316638837i, -0.0002104900489696747 + -0.001426710982184324i, 0.004070333345377643 + -0.024084925079117518i, 0.2633623995336645 + -6.613633252161577e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.2359558843492649, 1.0e-7), DoubleNear(0.27148047863665214, 1.0e-7), DoubleNear(0.2292012374804176, 1.0e-7), DoubleNear(0.2633623995336645, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.25609909282594473 + -2.3852447794681098e-18i, -0.015427687595685476 + 0.03671543405352404i, -0.04801715192829709 + 0.014390818856962907i, 0.03035888037016545 + 0.047513227052832674i }, { -0.015427687595685483 + -0.036715434053524024i, 0.31023304778166927 + -7.453889935837843e-18i, 0.024952455557285917 + -0.044519102197260005i, 0.06341684283649945 + 0.015247938667900397i }, { -0.048017151928297086 + -0.014390818856962907i, 0.024952455557285914 + 0.04451910219726001i, 0.20905802900373777 + -6.938893903907228e-18i, 0.023795820436945968 + 0.012332763044833711i }, { 0.030358880370165445 + -0.04751322705283268i, 0.06341684283649945 + -0.015247938667900399i, 0.023795820436945968 + -0.012332763044833708i, 0.22460983038864737 + -7.189615656294501e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25609909282594473, 1.0e-7), DoubleNear(0.31023304778166927, 1.0e-7), DoubleNear(0.20905802900373777, 1.0e-7), DoubleNear(0.22460983038864737, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.23705120961940523 + -2.4936649967166602e-18i, 0.004222862926714813 + 0.025005747631630378i, -0.046469552938110864 + -0.09665684577341423i, 0.011446613881193744 + -0.0046179983207201335i }, { 0.004222862926714808 + -0.025005747631630375i, 0.2739835148557126 + -8.626183534837795e-18i, -0.010685973405637365 + 0.0055958048757313705i, -0.05308331657732863 + -0.11587809371075361i }, { -0.04646955293811086 + 0.09665684577341421i, -0.010685973405637367 + -0.0055958048757313705i, 0.22810591221027726 + -6.830473686658678e-18i, 0.0041452699145456805 + 0.024042449466727372i }, { 0.011446613881193744 + 0.004617998320720131i, -0.053083316577328614 + 0.11587809371075361i, 0.004145269914545679 + -0.024042449466727366i, 0.260859363314604 + -6.0173220572945496e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.23705120961940523, 1.0e-7), DoubleNear(0.2739835148557126, 1.0e-7), DoubleNear(0.22810591221027726, 1.0e-7), DoubleNear(0.260859363314604, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.23356585728064813 + -3.6591823321385775e-18i, 0.00436980582912051 + 0.024666646950730783i, -0.0393005215259111 + 0.0003784303121535909i, 0.005141535446955973 + 0.006180976499963823i }, { 0.0043698058291205075 + -0.02466664695073078i, 0.2685275205665472 + -7.020209066843641e-18i, 0.005330452294209186 + -0.006209002142677281i, 0.000704079449230061 + 0.00046108167900196724i }, { -0.0393005215259111 + -0.0003784303121535828i, 0.005330452294209186 + 0.00620900214267728i, 0.23159126454903434 + -5.664956351236761e-18i, 0.003998327012139983 + 0.024381550147626965i }, { 0.005141535446955971 + -0.006180976499963824i, 0.0007040794492300592 + -0.00046108167900195987i, 0.003998327012139979 + -0.02438155014762696i, 0.26631535760376945 + -7.623296525288703e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.23356585728064813, 1.0e-7), DoubleNear(0.2685275205665472, 1.0e-7), DoubleNear(0.23159126454903434, 1.0e-7), DoubleNear(0.26631535760376945, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.25392659247793115 + -6.532318089225164e-18i, 0.0018002125863853637 + 0.025754787977884826i, 0.19955448393608324 + 0.020449771059873178i, 0.007995301309905625 + 0.022647501736917947i }, { 0.0018002125863853598 + -0.02575478797788482i, 0.28705269207650463 + -8.38901430960659e-18i, 3.7675141453599736e-05 + -0.02309150734551215i, 0.2272931940959422 + 0.022658576645307987i }, { 0.19955448393608327 + -0.0204497710598732i, 3.7675141453599086e-05 + 0.023091507345512144i, 0.2112305293517513 + -2.791820594150174e-18i, 0.006567920254875129 + 0.023293409120472924i }, { 0.007995301309905625 + -0.022647501736917944i, 0.22729319409594223 + -0.022658576645308008i, 0.006567920254875126 + -0.02329340912047292i, 0.247790186093812 + -6.254491282525754e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.25392659247793115, 1.0e-7), DoubleNear(0.28705269207650463, 1.0e-7), DoubleNear(0.2112305293517513, 1.0e-7), DoubleNear(0.247790186093812, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.2217601950401759 + -5.3939058081153846e-18i, 0.00397604379295804 + 0.023362352617230825i, 0.016785209776290052 + -0.11329350166146115i, 0.012298141915315815 + -0.00022335757348400007i }, { 0.003976043792958035 + -0.023362352617230825i, 0.25493789958989854 + -7.94178091345632e-18i, -0.011624592447345034 + -0.0038723192754550385i, 0.01941531223396769 + -0.13029831760877214i }, { 0.016785209776290055 + 0.11329350166146115i, -0.011624592447345036 + 0.0038723192754550415i, 0.24339692678950658 + -3.9302328752599536e-18i, 0.004392089048302454 + 0.025685844481126922i }, { 0.012298141915315813 + 0.00022335757348399953i, 0.019415312233967696 + 0.13029831760877214i, 0.004392089048302452 + -0.025685844481126915i, 0.27990497858041813 + -6.701724678676024e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.2217601950401759, 1.0e-7), DoubleNear(0.25493789958989854, 1.0e-7), DoubleNear(0.24339692678950658, 1.0e-7), DoubleNear(0.27990497858041813, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.28725020018736125 + -6.315477654728063e-18i, -0.0011946001178326832 + -0.0034100903370238664i, 0.007895159746471281 + 0.014934501274272718i, 0.002574708432712352 + 0.000751060015032134i }, { -0.0011946001178326819 + 0.003410090337023868i, 0.2790819404202528 + -3.5236570605778894e-18i, -0.0023510931380395796 + -0.0017044367431887943i, 0.007504531161731085 + 0.014704256250590589i }, { 0.007895159746471276 + -0.014934501274272715i, -0.002351093138039579 + 0.0017044367431887945i, 0.22018616279855582 + -6.86435500454885e-18i, -0.0009559746105997025 + -0.0028833519131230435i }, { 0.0025747084327123514 + -0.0007510600150321355i, 0.007504531161731081 + -0.014704256250590589i, -0.0009559746105997026 + 0.002883351913123044i, 0.21348169659382935 + -7.26415455565288e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.28725020018736125, 1.0e-7), DoubleNear(0.2790819404202528, 1.0e-7), DoubleNear(0.22018616279855582, 1.0e-7), DoubleNear(0.21348169659382935, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.2592503522606011 + -7.555533889508359e-18i, -0.000925779831906067 + -0.003318947086743299i, -0.05029343922207263 + -0.10781237940737493i, -0.001887942329198842 + 0.0024781174037435474i }, { -0.000925779831906066 + 0.0033189470867432992i, 0.2517843722145167 + -3.564314642046096e-18i, 0.003641829001656467 + -2.5934775823233076e-05i, -0.04925943029336685 + -0.10472256007679291i }, { -0.050293439222072626 + 0.10781237940737493i, 0.0036418290016564667 + 2.593477582323153e-05i, 0.24818601072531588 + -5.624298769768554e-18i, -0.0012247948965263193 + -0.0029744951634036116i }, { -0.001887942329198844 + -0.0024781174037435466i, -0.049259430293366845 + 0.10472256007679291i, -0.0012247948965263178 + 0.0029744951634036124i, 0.2407792647995654 + -7.223496974184673e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.2592503522606011, 1.0e-7), DoubleNear(0.2517843722145167, 1.0e-7), DoubleNear(0.24818601072531588, 1.0e-7), DoubleNear(0.2407792647995654, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.3251412711907017 + -7.020209066843641e-18i, -0.0056772947485047584 + -0.0015741380477473422i, -0.01958523819158766 + 0.02864296110086112i, 0.017851215138487413 + 0.05223979900987251i }, { -0.005677294748504759 + 0.0015741380477473413i, 0.17695210665649364 + -3.6591823321385775e-18i, 0.010008538412885926 + -0.02928898850949884i, -0.019011203885093385 + -0.027803449109705558i }, { -0.019585238191587646 + -0.028642961100861106i, 0.010008538412885928 + 0.029288988509498837i, 0.1822950917952153 + -6.159623592433272e-18i, 0.0035267200200723727 + -0.004719304202399568i }, { 0.017851215138487406 + -0.052239799009872516i, -0.01901120388509339 + 0.02780344910970556i, 0.003526720020072375 + 0.00471930420239957i, 0.3156115303575885 + -7.128629284092192e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.3251412711907017, 1.0e-7), DoubleNear(0.17695210665649364, 1.0e-7), DoubleNear(0.1822950917952153, 1.0e-7), DoubleNear(0.3156115303575885, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.2745125606050266 + -7.101524229780054e-18i, -0.002568264225652314 + -0.007515768865675711i, 0.2165980332895549 + 0.02187474317384945i, 0.003678072125805416 + -0.0042568851180205276i }, { -0.0025682642256523113 + 0.007515768865675713i, 0.2664667239494092 + -7.8198081690517e-18i, -0.005514007784336852 + 0.0011157973045871875i, 0.21024964474247054 + 0.02123360453133171i }, { 0.21659803328955488 + -0.02187474317384947i, -0.00551400778433685 + -0.0011157973045871844i, 0.23292380238089044 + -6.078308429496859e-18i, 0.00041768949721992783 + 0.0012223266155288012i }, { 0.0036780721258054183 + 0.004256885118020526i, 0.21024964474247054 + -0.021233604531331732i, 0.0004176894972199273 + -0.0012223266155288017i, 0.22609691306467294 + -2.9680034471790684e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2745125606050266, 1.0e-7), DoubleNear(0.2664667239494092, 1.0e-7), DoubleNear(0.23292380238089044, 1.0e-7), DoubleNear(0.22609691306467294, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.23921267837745247 + -5.366800753803247e-18i, -0.0006266228345406796 + -0.0032763629938998458i, 0.04174943465180553 + -0.1214361582127686i, 0.0002678550119099422 + 0.0009150078178849516i }, { -0.0006266228345406782 + 0.0032763629938998475i, 0.23748541625262198 + -7.968885967768458e-18i, 0.0033019046123047764 + -0.00026119177828424654i, -0.005548912641547787 + -0.12215566105746468i }, { 0.04174943465180553 + 0.1214361582127686i, 0.0033019046123047772 + 0.0002611917782842472i, 0.2682236846084646 + -7.813031905473666e-18i, -0.0015239518938917065 + -0.003017079256247064i }, { 0.00026785501190994206 + -0.0009150078178849531i, -0.0055489126415477815 + 0.1221556610574647i, -0.0015239518938917058 + 0.0030170792562470646i, 0.25507822076146014 + -2.8189256484623115e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.23921267837745247, 1.0e-7), DoubleNear(0.23748541625262198, 1.0e-7), DoubleNear(0.2682236846084646, 1.0e-7), DoubleNear(0.25507822076146014, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.29011193662273005 + -4.47911022508074e-18i, 0.007766709143382606 + 0.015233392680849736i, -0.05638154068928698 + -0.1219010123812653i, 0.0016445139247975964 + -0.009101202506946597i }, { 0.007766709143382604 + -0.015233392680849734i, 0.22092278785238784 + -6.640738306473715e-18i, -0.008144268829704048 + -0.004351327864155689i, -0.04317132882615251 + -0.09063392710290252i }, { -0.056381540689286976 + 0.12190101238126531i, -0.008144268829704048 + 0.004351327864155689i, 0.27622020398488395 + -5.3600244902252125e-18i, 0.007632981764819758 + 0.014405364844013571i }, { 0.0016445139247975961 + 0.009101202506946595i, -0.0431713288261525 + 0.09063392710290252i, 0.007632981764819755 + -0.014405364844013571i, 0.21274507153999733 + -7.487771253728015e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.29011193662273005, 1.0e-7), DoubleNear(0.22092278785238784, 1.0e-7), DoubleNear(0.27622020398488395, 1.0e-7), DoubleNear(0.21274507153999733, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.2842141641912733 + -5.55653613398821e-18i, 0.007585073476937343 + 0.014881853880261819i, -0.02125130935172604 + 0.0003316411188733125i, 0.004065928155957116 + -0.010725149541740562i }, { 0.00758507347693734 + -0.01488185388026182i, 0.217879213655922 + -5.1228552649940085e-18i, 0.0038990177327095196 + 0.011071265592393242i, -0.017345132724954998 + 0.0005078708722822444i }, { -0.021251309351726037 + -0.0003316411188733055i, 0.0038990177327095157 + -0.011071265592393242i, 0.2821179764163406 + -4.2825985813177425e-18i, 0.007814617431265021 + 0.014756903644601485i }, { 0.004065928155957119 + 0.010725149541740558i, -0.017345132724954998 + -0.0005078708722822374i, 0.007814617431265018 + -0.014756903644601483i, 0.21578864573646314 + -9.005654295207721e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2842141641912733, 1.0e-7), DoubleNear(0.217879213655922, 1.0e-7), DoubleNear(0.2821179764163406, 1.0e-7), DoubleNear(0.21578864573646314, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.3140916970700196 + -5.732718987017105e-18i, 0.0027401467232576536 + 0.025203205763625655i, 0.2414736081399875 + 0.03396431528245861i, -0.0009592621360566649 + 0.007175367981365476i }, { 0.002740146723257649 + -0.02520320576362565i, 0.2268875874844162 + -9.18861341181465e-18i, 0.013645513827795455 + -0.015398490974834741i, 0.18537406989203795 + 0.009144032422722558i }, { 0.2414736081399875 + -0.033964315282458635i, 0.013645513827795452 + 0.01539849097483474i, 0.2522404435375944 + -4.106415728288848e-18i, 0.01265954418494471 + 0.004435551761237652i }, { -0.0009592621360566644 + -0.007175367981365478i, 0.18537406989203795 + -0.009144032422722574i, 0.012659544184944709 + -0.004435551761237654i, 0.20678027190796897 + -4.9398961483870796e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.3140916970700196, 1.0e-7), DoubleNear(0.2268875874844162, 1.0e-7), DoubleNear(0.2522404435375944, 1.0e-7), DoubleNear(0.20678027190796897, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.27000166104178164 + -5.1228552649940085e-18i, 0.00732056408956592 + 0.014155372579783249i, 0.020417855474185665 + -0.1379305657835369i, 0.007811052039183993 + -0.0027622742906250122i }, { 0.007320564089565916 + -0.014155372579783247i, 0.20669643358829282 + -8.212831456577696e-18i, -0.0065899145591783856 + -0.004769788455204935i, 0.015782666536072076 + -0.10566125348669637i }, { 0.02041785547418567 + 0.1379305657835369i, -0.0065899145591783856 + 0.004769788455204935i, 0.29633047956583236 + -4.716279450311944e-18i, 0.008079126818636446 + 0.015483384945080059i }, { 0.007811052039183991 + 0.0027622742906250105i, 0.01578266653607208 + 0.10566125348669639i, 0.008079126818636442 + -0.015483384945080059i, 0.22697142580409235 + -5.9156781036240336e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.27000166104178164, 1.0e-7), DoubleNear(0.20669643358829282, 1.0e-7), DoubleNear(0.29633047956583236, 1.0e-7), DoubleNear(0.22697142580409235, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.2575730192896264 + -6.715277205832093e-18i, -0.047810095601481084 + -0.10575815365754523i, -0.01889187847833328 + -0.0001423053893008973i, 0.010178656796443749 + 0.01532552568241133i }, { -0.04781009560148108 + 0.10575815365754523i, 0.24452035855756898 + -3.9641141931501256e-18i, 0.00877035067293842 + -0.017811956865148568i, -0.019704563598347765 + 0.0009818173804564544i }, { -0.018891878478333277 + 0.0001423053893009062i, 0.008770350672938422 + 0.017811956865148564i, 0.2534617051854915 + -4.404571325722362e-18i, -0.0517427739139584 + -0.10677678582662259i }, { 0.01017865679644374 + -0.015325525682411328i, -0.01970456359834776 + -0.0009818173804564492i, -0.051742773913958394 + 0.10677678582662259i, 0.2444449169673123 + -8.883681550803102e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2575730192896264, 1.0e-7), DoubleNear(0.24452035855756898, 1.0e-7), DoubleNear(0.2534617051854915, 1.0e-7), DoubleNear(0.2444449169673123, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.27637474577667653 + -7.677506633912978e-18i, -0.05442757225354994 + -0.11582592308161013i, 0.21820786246549104 + 0.022071977639363055i, -0.0332552643438432 + -0.09398399102922195i }, { -0.05442757225354993 + 0.11582592308161013i, 0.26460453877775925 + -7.243825764918776e-18i, -0.05073265010492237 + 0.08597088947243817i, 0.20863981556653444 + 0.021036370065818107i }, { 0.218207862465491 + -0.022071977639363076i, -0.05073265010492238 + -0.08597088947243817i, 0.23465997869844135 + -3.4423418976414766e-18i, -0.04512529726188955 + -0.09670901640255769i }, { -0.03325526434384318 + 0.09398399102922195i, 0.20863981556653444 + -0.021036370065818127i, -0.04512529726188954 + 0.0967090164025577i, 0.224360736747122 + -5.603969979034451e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.27637474577667653, 1.0e-7), DoubleNear(0.26460453877775925, 1.0e-7), DoubleNear(0.23465997869844135, 1.0e-7), DoubleNear(0.224360736747122, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.24365517123234998 + -7.047314121155779e-18i, -0.04747538993436943 + -0.10134165650020852i, 0.018467384775701666 + -0.12442851897175673i, -0.05525989013899582 + 0.01651526582466329i }, { -0.047475389934369415 + 0.10134165650020852i, 0.23304292339772445 + -6.288372600415926e-18i, 0.048284723542200196 + 0.03205023992965514i, 0.017733137234556075 + -0.11916330029847655i }, { 0.018467384775701673 + 0.12442851897175675i, 0.048284723542200196 + -0.03205023992965514i, 0.26737955324276785 + -4.072534410398676e-18i, -0.05207747958107006 + -0.11119328298395931i }, { -0.05525989013899582 + -0.016515265824663287i, 0.01773313723455608 + 0.11916330029847655i, -0.052077479581070056 + 0.11119328298395931i, 0.2559223521271568 + -6.559423143537302e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.24365517123234998, 1.0e-7), DoubleNear(0.23304292339772445, 1.0e-7), DoubleNear(0.26737955324276785, 1.0e-7), DoubleNear(0.2559223521271568, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.27214438345986575 + -6.600080725005508e-18i, -0.04609273052104418 + 0.0011958337732517386i, 0.21431739248933193 + 0.02219381723560835i, -0.01729120028431581 + -0.027828264292836177i }, { -0.04609273052104417 + -0.0011958337732517208i, 0.26883490109457003 + -8.321251673826247e-18i, -0.015658403077141954 + -0.028544951781045755i, 0.21253028554269354 + 0.020914530469572815i }, { 0.21431739248933193 + -0.02219381723560837i, -0.015658403077141954 + 0.028544951781045762i, 0.2299489943873296 + -4.0793106739767104e-18i, 0.0074962884443631325 + -0.00035632178209618165i }, { -0.017291200284315814 + 0.027828264292836184i, 0.21253028554269351 + -0.020914530469572833i, 0.007496288444363136 + 0.00035632178209617785i, 0.22907172105823373 + -4.967001202699217e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.27214438345986575, 1.0e-7), DoubleNear(0.26883490109457003, 1.0e-7), DoubleNear(0.2299489943873296, 1.0e-7), DoubleNear(0.22907172105823373, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.23859216429811536 + -5.244828009398628e-18i, -0.018398850397453904 + 9.749774643936701e-05i, 0.024757635895272363 + -0.1216946375940037i, -0.0014378247036339116 + 0.012071599456419392i }, { -0.018398850397453897 + -9.749774643935146e-05i, 0.23810593033195906 + -8.090858712173077e-18i, -0.001356597998195144 + 0.006731955629214454i, 0.011442886114985378 + -0.12189718167622958i }, { 0.024757635895272367 + 0.1216946375940037i, -0.001356597998195152 + -0.006731955629214452i, 0.26350121354907996 + -5.434563389583591e-18i, -0.02019759167922714 + 0.0007420142447161898i }, { -0.0014378247036339188 + -0.01207159945641939i, 0.011442886114985382 + 0.12189718167622958i, -0.02019759167922714 + -0.0007420142447161915i, 0.2598006918208447 + -5.197394164352387e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.23859216429811536, 1.0e-7), DoubleNear(0.23810593033195906, 1.0e-7), DoubleNear(0.26350121354907996, 1.0e-7), DoubleNear(0.2598006918208447, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.25788379418144064 + -8.117963766485214e-18i, 0.20347747481513823 + 0.020549667213710623i, 0.019583732497606355 + -0.13177812811212433i, 0.025952949606864638 + -0.10241605775316871i }, { 0.2034774748151382 + -0.02054966721371064i, 0.21881430044863381 + -5.21772295508649e-18i, 0.0049512679203868835 + -0.10553714713302323i, 0.016616789512651386 + -0.11181369115810895i }, { 0.01958373249760636 + 0.13177812811212433i, 0.004951267920386889 + 0.10553714713302323i, 0.28309549037299514 + -6.80336863234654e-18i, 0.22337020321688725 + 0.022558680491470542i }, { 0.025952949606864652 + 0.10241605775316871i, 0.01661678951265139 + 0.11181369115810895i, 0.22337020321688725 + -0.022558680491470563i, 0.24020641499692952 + -3.8285889215894375e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.25788379418144064, 1.0e-7), DoubleNear(0.21881430044863381, 1.0e-7), DoubleNear(0.28309549037299514, 1.0e-7), DoubleNear(0.24020641499692952, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.061181826933572235 + -4.87890977618477e-19i, -0.04573173451180303 + -0.07661299315945991i, 0.0015662973889730742 + 0.008752877776250771i, 0.008432632331938451 + -0.008413502502384014i, 0.0009993609393576944 + 0.0023024875768288865i, -0.00415910353080772 + -0.0010903712141609465i, -0.001083653054195602 + 0.0006120096775388799i, 0.0012465352426674135 + 0.00012000715013304848i }, { -0.04573173451180303 + 0.07661299315945991i, 0.17477405741569263 + -4.662069341687669e-18i, -0.008562316477266456 + -0.003127483009358618i, 0.0027315021069097716 + 0.016210394242989458i, 0.002490281910115374 + -0.0028493232046852427i, -0.0029394456188204044 + -0.010022640809160124i, 4.4474562156585735e-05 + -0.0009212577235998903i, -0.00015287502080962395 + 0.0006280767541250029i }, { 0.0015662973889730742 + -0.008752877776250771i, -0.00856231647726646 + 0.00312748300935862i, 0.07971624037813403 + -6.572975670693371e-19i, -0.06088672564068566 + -0.08761060818225372i, 0.0012291287295945852 + 2.3367003610907494e-06i, -0.0003847421755130175 + -0.0007755958279579943i, 0.00192077796689914 + 0.00624300741386629i, -0.0015375914537817 + -0.004549360821763425i }, { 0.00843263233193845 + 0.008413502502384013i, 0.002731502106909769 + -0.01621039424298945i, -0.060886725640685646 + 0.08761060818225372i, 0.1917642382585181 + -7.37257477290143e-18i, -0.0011727832637058858 + 0.0007601314912554925i, 0.000539546019481607 + 0.0007348661605137415i, -0.0014362532498967545 + -0.005097244278694971i, -0.0021312680158688158 + -0.004816296431681966i }, { 0.0009993609393576942 + -0.0023024875768288874i, 0.002490281910115374 + 0.0028493232046852422i, 0.0012291287295945847 + -2.3367003610914e-06i, -0.0011727832637058874 + -0.0007601314912554923i, 0.059252876114562425 + -1.2197274440461925e-18i, -0.04426779357030164 + -0.07440871065391522i, 0.0015198348338486404 + 0.008532561154955556i, 0.008205341642940903 + -0.008144226583292995i }, { -0.00415910353080772 + 0.0010903712141609487i, -0.0029394456188204035 + 0.010022640809160122i, -0.00038474217551301697 + 0.0007755958279579949i, 0.0005395460194816069 + -0.000734866160513741i, -0.04426779357030164 + 0.07440871065391522i, 0.16994836136585517 + -2.9544509200229996e-18i, -0.00824448735926096 + -0.0030374419907115563i, 0.0025504985115290067 + 0.015552363924161964i }, { -0.0010836530541956022 + -0.0006120096775388804i, 4.447456215658579e-05 + 0.0009212577235998909i, 0.0019207779668991396 + -0.00624300741386629i, -0.001436253249896755 + 0.005097244278694971i, 0.0015198348338486393 + -0.008532561154955556i, -0.008244487359260961 + 0.0030374419907115546i, 0.07751553377023548 + -1.7211709488207383e-18i, -0.05922572864503142 + -0.0850015726069045i }, { 0.001246535242667414 + -0.00012000715013304894i, -0.00015287502080962314 + -0.0006280767541250032i, -0.0015375914537816998 + 0.004549360821763427i, -0.0021312680158688145 + 0.004816296431681966i, 0.008205341642940907 + 0.008144226583292995i, 0.0025504985115290036 + -0.01555236392416196i, -0.059225728645031415 + 0.08500157260690448i, 0.18584686576342904 + -4.892462303340839e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.061181826933572235, 1.0e-7), DoubleNear(0.17477405741569263, 1.0e-7), DoubleNear(0.07971624037813403, 1.0e-7), DoubleNear(0.1917642382585181, 1.0e-7), DoubleNear(0.059252876114562425, 1.0e-7), DoubleNear(0.16994836136585517, 1.0e-7), DoubleNear(0.07751553377023548, 1.0e-7), DoubleNear(0.18584686576342904, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.06604122614719977 + -6.776263578034403e-19i, -0.05169795224782167 + -0.08025092278293267i, -0.0007393176433564974 + 0.015191518224890559i, 0.012311967459187115 + -0.007107655210546517i, -0.007571467411003617 + 0.0014418945202877222i, 0.013079459070197039 + 0.013544944564765092i, 0.012190524337318516 + 0.013770851617237045i, 0.005137622155470438 + -0.020130461585267295i }, { -0.05169795224782167 + 0.08025092278293265i, 0.19005786667874494 + -1.7076184216646695e-18i, -0.008927652441259343 + -0.015541245914680483i, -0.014688369952328978 + 0.021523915828633475i, 0.0017351389291988368 + -0.016428586369855322i, -0.04044568451729347 + 0.012948924336675185i, -0.021711575698658406 + -0.00023187044671114059i, 0.018168356032846934 + 0.033742375435595634i }, { -0.0007393176433564996 + -0.01519151822489056i, -0.008927652441259346 + 0.015541245914680483i, 0.09041632239942465 + -3.5236570605778894e-19i, -0.07315696606791987 + -0.0999059866557939i, 0.00744526302719636 + -0.015775037506613868i, -0.020901622160059793 + -0.0022490711096139647i, 0.01687053769267459 + 0.0014278360934891722i, -0.009729824013487008 + -0.02162339206544966i }, { 0.012311967459187117 + 0.007107655210546514i, -0.014688369952328983 + -0.021523915828633472i, -0.07315696606791987 + 0.0999059866557939i, 0.2198167253822446 + -7.101524229780054e-18i, 0.013260008469452366 + 0.02075838978360104i, 0.01750719253008956 + -0.028744064690646137i, -0.01653055168275043 + 0.015452363159848298i, 0.046546305143824865 + 0.013820102574411226i }, { -0.007571467411003617 + -0.001441894520287724i, 0.0017351389291988355 + 0.016428586369855322i, 0.00744526302719636 + 0.015775037506613868i, 0.013260008469452373 + -0.020758389783601037i, 0.054393476900934885 + -1.0299920638612292e-18i, -0.038301575834282994 + -0.07077078103044246i, 0.0038254498661782124 + 0.0020939207063157676i, 0.00432600651569224 + -0.009450073875130492i }, { 0.013079459070197044 + -0.013544944564765092i, -0.04044568451729347 + -0.012948924336675181i, -0.0209016221600598 + 0.002249071109613961i, 0.017507192530089553 + 0.028744064690646144i, -0.038301575834282994 + 0.07077078103044246i, 0.1546645521028029 + -5.908901840045999e-18i, -0.007879151395268074 + 0.009376320914610308i, 0.019970370570767757 + 0.010238842338517944i }, { 0.012190524337318516 + -0.013770851617237047i, -0.021711575698658406 + 0.00023187044671114416i, 0.01687053769267459 + -0.001427836093489173i, -0.01653055168275043 + -0.0154523631598483i, 0.0038254498661782132 + -0.002093920706315767i, -0.007879151395268076 + -0.009376320914610308i, 0.06681545174894485 + -2.0261028098322864e-18i, -0.0469554882177972 + -0.07270619413336432i }, { 0.005137622155470438 + 0.020130461585267295i, 0.01816835603284693 + -0.033742375435595634i, -0.009729824013487008 + 0.02162339206544966i, 0.04654630514382486 + -0.013820102574411226i, 0.0043260065156922375 + 0.009450073875130492i, 0.019970370570767754 + -0.01023884233851794i, -0.04695548821779719 + 0.07270619413336432i, 0.15779437863970255 + -5.163512846462215e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.06604122614719977, 1.0e-7), DoubleNear(0.19005786667874494, 1.0e-7), DoubleNear(0.09041632239942465, 1.0e-7), DoubleNear(0.2198167253822446, 1.0e-7), DoubleNear(0.054393476900934885, 1.0e-7), DoubleNear(0.1546645521028029, 1.0e-7), DoubleNear(0.06681545174894485, 1.0e-7), DoubleNear(0.15779437863970255, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.061330024514996515 + -4.607859233063394e-19i, -0.04533534418410544 + -0.07733369367507371i, 0.0017850067520095853 + 0.009007654627793816i, 0.00833115095621946 + -0.008732527651307116i, -0.012211756429574248 + -0.02570942417815989i, -0.01993584323754748 + 0.032781143712710376i, 0.004317119461506839 + -0.001901688235505372i, -0.005306369805267949 + -0.0027504380428546643i }, { -0.045335344184105446 + 0.0773336936750737i, 0.1757211851044087 + -2.032879073410321e-18i, -0.00870754734102806 + -0.0033902055050140734i, 0.002437856174705227 + 0.01599809300383656i, 0.03964425311851124 + 0.005468411115641768i, -0.03425779650853662 + -0.07094742159525433i, -0.0013414249385434768 + 0.004039656676494528i, 0.007129494419686905 + -0.002716310085214761i }, { 0.0017850067520095848 + -0.009007654627793814i, -0.008707547341028063 + 0.003390205505014072i, 0.0804356219023244 + -1.5517643593698782e-18i, -0.06187520326677802 + -0.0884397812387195i, -0.0038049480947873653 + 0.0014712761983852582i, 0.003724469189723555 + 0.002332647511822345i, -0.016321091475785008 + -0.03462688747106932i, -0.022947529069528013 + 0.04313428190430406i }, { 0.00833115095621946 + 0.008732527651307116i, 0.0024378561747052225 + -0.01599809300383656i, -0.06187520326677801 + 0.0884397812387195i, 0.19354789295338826 + -7.074419175467916e-18i, 0.00113745751391141 + -0.0048024014002352195i, -0.006881025310850001 + 0.004124528677346112i, 0.047292939698810356 + 0.011224897149556906i, -0.036762225101543616 + -0.08125120623968429i }, { -0.012211756429574245 + 0.02570942417815989i, 0.03964425311851124 + -0.005468411115641769i, -0.0038049480947873653 + -0.0014712761983852584i, 0.0011374575139114116 + 0.0048024014002352195i, 0.05910467853313815 + -1.2468324983583301e-18i, -0.04466418389799921 + -0.07368801013830141i, 0.0013011254708121293 + 0.008277784303412512i, 0.008306823018659894 + -0.007825201434369891i }, { -0.019935843237547483 + -0.032781143712710376i, -0.034257796508536616 + 0.07094742159525433i, 0.003724469189723555 + -0.0023326475118223442i, -0.006881025310850002 + -0.004124528677346111i, -0.04466418389799923 + 0.07368801013830141i, 0.1690012336771391 + -5.583641188300348e-18i, -0.008099256495499356 + -0.002774719495056102i, 0.002844144443733551 + 0.01576466516331486i }, { 0.004317119461506841 + 0.001901688235505371i, -0.001341424938543477 + -0.004039656676494529i, -0.016321091475785005 + 0.03462688747106932i, 0.04729293969881036 + -0.011224897149556906i, 0.0013011254708121282 + -0.008277784303412514i, -0.008099256495499358 + 0.002774719495056103i, 0.07679615224604514 + -8.267041565201971e-19i, -0.05823725101893905 + -0.08417239955043872i }, { -0.005306369805267948 + 0.0027504380428546656i, 0.007129494419686905 + 0.0027163100852147597i, -0.022947529069528017 + -0.043134281904304045i, -0.03676222510154361 + 0.08125120623968429i, 0.008306823018659894 + 0.00782520143436989i, 0.0028441444437335506 + -0.015764665163314852i, -0.05823725101893905 + 0.08417239955043873i, 0.18406321106855889 + -5.1906179007743525e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.061330024514996515, 1.0e-7), DoubleNear(0.1757211851044087, 1.0e-7), DoubleNear(0.0804356219023244, 1.0e-7), DoubleNear(0.19354789295338826, 1.0e-7), DoubleNear(0.05910467853313815, 1.0e-7), DoubleNear(0.1690012336771391, 1.0e-7), DoubleNear(0.07679615224604514, 1.0e-7), DoubleNear(0.18406321106855889, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.060298278552672134 + -4.87890977618477e-19i, -0.04510534313238251 + -0.07569743772411743i, 0.0015905025482929197 + 0.008641149272110085i, 0.008293175002035101 + -0.00837701528848258i, 0.016570777598807054 + 0.00019937448389454964i, -0.01391324089487508 + 0.017012492645230547i, 0.0014768591752269944 + 0.006063294356289177i, 0.0014738910748122566 + -0.006307222394204108i }, { -0.045105343132382514 + 0.07569743772411741i, 0.173267578727976 + -3.1712913545201005e-18i, -0.008461202055223726 + -0.0030261891258428564i, 0.0027793032808275894 + 0.0160254976786207i, -0.013966101944204137 + -0.01785091149845955i, -0.05587129912471815 + 0.00017905582825904066i, -0.0037646218048523073 + -0.0013165574335380352i, 0.003664676271728979 + 0.00011768214367464589i }, { 0.0015905025482929184 + -0.008641149272110085i, -0.00846120205522373 + 0.003026189125842858i, 0.07863828038755828 + -6.911788849595091e-19i, -0.06014801228912557 + -0.08645609661096462i, 0.0015478526921346037 + -0.006038376826243228i, -0.003880405902477664 + 0.0013041181056878924i, 0.03583706048332284 + 0.00021751244547079036i, -0.02770971685814949 + 0.0027226830605964637i }, { 0.008293175002035101 + 0.008377015288482581i, 0.002779303280827589 + -0.016025497678620694i, -0.06014801228912557 + 0.08645609661096462i, 0.18988924017898895 + -6.329030181884132e-18i, 0.0013072662628306597 + 0.006379189216649185i, 0.0037825996020745827 + -0.0001706253164340532i, -0.027733039972636084 + -0.0038147716224441325i, -0.03513298103409278 + 0.00024356923353117726i }, { 0.016570777598807054 + -0.00019937448389454004i, -0.013966101944204124 + 0.01785091149845955i, 0.001547852692134603 + 0.006038376826243228i, 0.0013072662628306581 + -0.0063791892166491886i, 0.060136424495462526 + -1.2197274440461925e-18i, -0.04489418494972215 + -0.0753242660892577i, 0.0014956296745287949 + 0.008644289659096242i, 0.008344798972844254 + -0.008180713797194428i }, { -0.013913240894875088 + -0.017012492645230557i, -0.05587129912471815 + -0.00017905582825904253i, -0.003880405902477663 + -0.0013041181056878954i, 0.0037825996020745835 + 0.00017062531643405082i, -0.04489418494972215 + 0.0753242660892577i, 0.1714548400535718 + -4.445228907190568e-18i, -0.00834560178130369 + -0.0031387358742273183i, 0.002502697337611188 + 0.015737260488530722i }, { 0.001476859175226996 + -0.0060632943562891764i, -0.003764621804852305 + 0.0013165574335380343i, 0.03583706048332283 + -0.0002175124454707807i, -0.027733039972636073 + 0.0038147716224441286i, 0.0014956296745287949 + -0.00864428965909624i, -0.008345601781303691 + 0.003138735874227317i, 0.07859349376081123 + -1.6872896309305663e-18i, -0.0599644419965915 + -0.08615608417819359i }, { 0.0014738910748122536 + 0.006307222394204108i, 0.0036646762717289756 + -0.0001176821436746473i, -0.027709716858149505 + -0.002722683060596475i, -0.03513298103409278 + -0.00024356923353117927i, 0.008344798972844254 + 0.008180713797194428i, 0.002502697337611184 + -0.01573726048853072i, -0.05996444199659148 + 0.08615608417819359i, 0.18772186384295825 + -5.936006894358137e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.060298278552672134, 1.0e-7), DoubleNear(0.173267578727976, 1.0e-7), DoubleNear(0.07863828038755828, 1.0e-7), DoubleNear(0.18988924017898895, 1.0e-7), DoubleNear(0.060136424495462526, 1.0e-7), DoubleNear(0.1714548400535718, 1.0e-7), DoubleNear(0.07859349376081123, 1.0e-7), DoubleNear(0.18772186384295825, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.06094876161095 + 2.710505431213761e-19i, -0.05291281022941484 + -0.07940909661516422i, 0.0008389764715337183 + 0.008356118303018332i, 0.008046476720333946 + -0.008042772444193248i, 0.05062662646951843 + -0.0011114898673529362i, -0.03537536657365537 + -0.07166908474598893i, 0.002532714830156763 + 0.007157059899051795i, 0.008174918835742475 + -0.007971006235506388i }, { -0.052912810229414846 + 0.07940909661516421i, 0.19297783086698114 + -6.80336863234654e-18i, -0.00866538145805443 + -0.004479161964643107i, 0.0009612361148516451 + 0.017398669674866495i, -0.039601962487002186 + 0.05835352402259282i, 0.1489278574665648 + 0.021561260927226114i, -0.007418327740761105 + 0.0009673633772703282i, 0.005462586479748861 + 0.015490441837866152i }, { 0.000838976471533719 + -0.00835611830301833i, -0.008665381458054434 + 0.004479161964643107i, 0.07633452757359198 + 1.0570971181733668e-18i, -0.06715436045552392 + -0.0875987319157032i, -0.0003564504393042257 + -0.00903824303958152i, -0.0069769779056837785 + 0.006145877864006563i, 0.06789466458914183 + -0.0005189865789329658i, -0.04884986847641176 + -0.08226436705458881i }, { 0.008046476720333944 + 0.008042772444193248i, 0.0009612361148516409 + -0.01739866967486649i, -0.06715436045552392 + 0.0875987319157032i, 0.21071816450291267 + -9.446111427779957e-18i, 0.008132725776445611 + 0.008103518208099302i, 0.00039412558075782567 + -0.01405326430593063i, -0.05554442606375201 + 0.06399776852698133i, 0.1593985295068004 + 0.02317756322424095i }, { 0.050626626469518446 + 0.0011114898673529358i, -0.03960196248700218 + -0.05835352402259282i, -0.0003564504393042232 + 0.009038243039581522i, 0.008132725776445611 + -0.0081035182080993i, 0.05948594143718465 + -1.9786689647860456e-18i, -0.03708671785268981 + -0.07161260719821091i, 0.002247155751287996 + 0.008929320628187996i, 0.008591497254545409 + -0.00851495664148376i }, { -0.03537536657365536 + 0.07166908474598896i, 0.1489278574665648 + -0.021561260927226135i, -0.00697697790568378 + -0.0061458778640065635i, 0.000394125580757822 + 0.014053264305930622i, -0.03708671785268983 + 0.0716126071982109i, 0.1517445879145667 + -8.131516293641283e-19i, -0.008141422378472988 + -0.0016857630354270678i, 0.0043207645035871324 + 0.014364088492284925i }, { 0.0025327148301567642 + -0.007157059899051795i, -0.007418327740761104 + -0.0009673633772703299i, 0.06789466458914184 + 0.0005189865789329653i, -0.05554442606375201 + -0.06399776852698133i, 0.0022471557512879943 + -0.008929320628187996i, -0.008141422378472986 + 0.0016857630354270674i, 0.08089724657477754 + -3.435565634063442e-18i, -0.05295809383019315 + -0.08501344887345501i }, { 0.008174918835742477 + 0.007971006235506393i, 0.005462586479748862 + -0.015490441837866147i, -0.04884986847641176 + 0.08226436705458881i, 0.1593985295068004 + -0.02317756322424097i, 0.00859149725454541 + 0.008514956641483759i, 0.004320764503587132 + -0.014364088492284922i, -0.052958093830193134 + 0.08501344887345501i, 0.1668929395190345 + -2.8189256484623115e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.06094876161095, 1.0e-7), DoubleNear(0.19297783086698114, 1.0e-7), DoubleNear(0.07633452757359198, 1.0e-7), DoubleNear(0.21071816450291267, 1.0e-7), DoubleNear(0.05948594143718465, 1.0e-7), DoubleNear(0.1517445879145667, 1.0e-7), DoubleNear(0.08089724657477754, 1.0e-7), DoubleNear(0.1668929395190345, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.05739356899646748 + -1.3552527156068805e-18i, -0.04288674191969066 + -0.07199704832803172i, 0.0014710820939018584 + 0.008244586045845154i, 0.007933840612741421 + -0.007890126541412695i, 0.004405060046510759 + -0.02934951917701256i, -0.040083054371609264 + 0.016481304641516356i, 0.004319130647481427 + -0.0001381454548301399i, -0.003439755137378788 + -0.004657989580156657i }, { -0.04288674191969066 + 0.0719970483280317i, 0.16436662604370839 + -4.038653092508504e-18i, -0.00800318727281585 + -0.002939016477472164i, 0.0025049616990561806 + 0.015117766571385674i, 0.03348459182478039 + 0.02738795225983891i, 0.012380149729779293 + -0.08394398248444858i, -0.00213228708974959 + 0.003877580583558666i, 0.00797901126783439 + -8.521211865386027e-05i }, { 0.001471082093901857 + -0.008244586045845152i, -0.008003187272815852 + 0.002939016477472164i, 0.07496951162575119 + -9.351243737687476e-19i, -0.05727323973399784 + -0.08227860781972546i, -0.004095321268069388 + -0.0013654708126011653i, 0.0008708617384221696 + 0.004322844534458959i, 0.00564661137275203 + -0.0382877631536407i, -0.04635767579853986 + 0.022984539831117326i }, { 0.007933840612741421 + 0.007890126541412693i, 0.0025049616990561767 + -0.015117766571385671i, -0.05727323973399783 + 0.08227860781972546i, 0.17996838796414738 + -7.006656539687572e-18i, 0.004631113697153678 + -0.003444067879502384i, -0.007529271179275646 + -0.002506848462853873i, 0.037743811460718285 + 0.03550932333843324i, 0.01376870086121566 + -0.09201055445513143i }, { 0.0044050600465107585 + 0.02934951917701256i, 0.03348459182478039 + -0.027387952259838914i, -0.004095321268069387 + 0.001365470812601165i, 0.0046311136971536795 + 0.0034440678795023857i, 0.06304113405166717 + -3.5236570605778894e-19i, -0.047112786162414 + -0.07902465548534342i, 0.001615050128919856 + 0.009040852885361174i, 0.008704133362137934 + -0.008667602544264314i }, { -0.040083054371609264 + -0.016481304641516356i, 0.012380149729779296 + 0.08394398248444859i, 0.0008708617384221694 + -0.004322844534458958i, -0.007529271179275648 + 0.0025068484628538766i, -0.04711278616241401 + 0.07902465548534342i, 0.18035579273783942 + -3.577867169202165e-18i, -0.008803616563711567 + -0.0032259085225980113i, 0.002777038919382597 + 0.016644991595765747i }, { 0.004319130647481425 + 0.0001381454548301396i, -0.002132287089749592 + -0.003877580583558666i, 0.005646611372752031 + 0.0382877631536407i, 0.037743811460718285 + -0.03550932333843324i, 0.0016150501289198562 + -0.009040852885361174i, -0.008803616563711569 + 0.003225908522598011i, 0.08226226252261833 + -1.4433441421213278e-18i, -0.06283921455171923 + -0.09033357296943276i }, { -0.0034397551373787877 + 0.004657989580156655i, 0.007979011267834386 + 8.521211865385962e-05i, -0.04635767579853986 + -0.02298453983111733i, 0.013768700861215667 + 0.09201055445513145i, 0.008704133362137934 + 0.008667602544264314i, 0.002777038919382596 + -0.016644991595765744i, -0.06283921455171923 + 0.09033357296943276i, 0.1976427160577998 + -5.2583805365546965e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.05739356899646748, 1.0e-7), DoubleNear(0.16436662604370839, 1.0e-7), DoubleNear(0.07496951162575119, 1.0e-7), DoubleNear(0.17996838796414738, 1.0e-7), DoubleNear(0.06304113405166717, 1.0e-7), DoubleNear(0.18035579273783942, 1.0e-7), DoubleNear(0.08226226252261833, 1.0e-7), DoubleNear(0.1976427160577998, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.0793670185254865 + -2.710505431213761e-20i, -0.0632669715081641 + -0.09140685973030173i, 0.001588853229586502 + 0.004583634532648664i, -0.0036464043624542296 + -0.0033640640224315284i, 0.004695965574646644 + 0.0014815313045382114i, 0.0016810635446554028 + -0.004104180085461031i, 0.0010510266607173932 + 0.0009002655926967942i, -1.3513102518245565e-05 + -0.0015999733695745396i }, { -0.0632669715081641 + 0.09140685973030171i, 0.2078831816618747 + -6.288372600415926e-18i, 0.0009408524426543017 + -0.004831728550302566i, -0.002783453347419185 + -0.00799372486967253i, -0.007492872274158964 + -0.00047347384020946306i, 0.003199194171824636 + 0.013452969969734505i, -0.0007247249522489535 + 0.0008169191221826179i, 0.0015236817719949587 + -0.0001492055776646602i }, { 0.0015888532295865012 + -0.004583634532648664i, 0.0009408524426543018 + 0.004831728550302566i, 0.07709053002113794 + -1.0028870095490916e-18i, -0.06158794680757744 + -0.08875004970842483i, -0.0005446364028746707 + -0.0011931648383852527i, -0.0006161138784758187 + 0.0015322611256326562i, 0.004603104707024329 + 0.0013881993092386832i, 0.001668571512054628 + -0.003974267415223538i }, { -0.0036464043624542287 + 0.003364064022431531i, -0.002783453347419183 + 0.007993724869672533i, -0.06158794680757744 + 0.08875004970842483i, 0.20199141039911483 + -2.520770051028798e-18i, 0.0010047878704792393 + -0.0006233901679309122i, -0.0018064567351649087 + -0.0005112719048035414i, -0.007302540479392628 + -0.0005027493697975613i, 0.002901426454706756 + 0.013316056941351906i }, { 0.004695965574646644 + -0.0014815313045382123i, -0.007492872274158964 + 0.0004734738402094633i, -0.0005446364028746705 + 0.0011931648383852527i, 0.0010047878704792389 + 0.0006233901679309118i, 0.06153104878621976 + -1.1180834903756764e-18i, -0.04335148864432457 + -0.0728167416114119i, 0.0013312856766703328 + 0.003961860458046512i, -0.0020502906221351903 + -0.0022756680134928438i }, { 0.0016810635446554041 + 0.00410418008546103i, 0.0031991941718246325 + -0.013452969969734503i, -0.0006161138784758186 + -0.0015322611256326567i, -0.0018064567351649087 + 0.0005112719048035418i, -0.04335148864432457 + 0.0728167416114119i, 0.15865511401233606 + -5.7462715141731735e-18i, 0.00011317621756431779 + -0.0031148389330776472i, -0.002287260287270035 + -0.006845212371169556i }, { 0.0010510266607173932 + -0.0009002655926967949i, -0.0007247249522489539 + -0.0008169191221826175i, 0.00460310470702433 + -0.0013881993092386847i, -0.0073025404793926295 + 0.0005027493697975598i, 0.0013312856766703324 + -0.003961860458046513i, 0.00011317621756431757 + 0.0031148389330776464i, 0.059677879863659966 + -1.938011383317839e-18i, -0.041905575407755614 + -0.07066023355239487i }, { -1.3513102518244915e-05 + 0.0015999733695745391i, 0.0015236817719949582 + 0.00014920557766465918i, 0.0016685715120546305 + 0.003974267415223536i, 0.0029014264547067526 + -0.013316056941351902i, -0.0020502906221351908 + 0.0022756680134928455i, -0.0022872602872700347 + 0.006845212371169557i, -0.04190557540775561 + 0.07066023355239488i, 0.15380381673016938 + -5.3261431723350405e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.0793670185254865, 1.0e-7), DoubleNear(0.2078831816618747, 1.0e-7), DoubleNear(0.07709053002113794, 1.0e-7), DoubleNear(0.20199141039911483, 1.0e-7), DoubleNear(0.06153104878621976, 1.0e-7), DoubleNear(0.15865511401233606, 1.0e-7), DoubleNear(0.059677879863659966, 1.0e-7), DoubleNear(0.15380381673016938, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.07188833376828739 + -5.353248226647178e-19i, -0.05435096445766838 + -0.08418569657497758i, 0.0014732269201538388 + 0.004412889475015853i, -0.0029787241558336753 + -0.0029652530476208857i, -0.014475167143653905 + -0.030626271045076398i, -0.02166643707368507 + 0.038295041016954856i, 0.0015888484324307808 + -0.001591407388186607i, 1.0024354368669741e-05 + 0.0018190110190814826i }, { -0.054350964457668384 + 0.08418569657497758i, 0.18736201849231374 + -7.020209066843641e-18i, 0.00055637182156194 + -0.0040159796936108764i, -0.002399006752059905 + -0.007731836561759152i, 0.04407309533388191 + 0.008731183096069385i, -0.03581827207841873 + -0.07718610836229851i, -0.002174931610636056 + 5.396569702065425e-05i, -0.003476790761629623 + 0.004069524791930154i }, { 0.0014732269201538385 + -0.004412889475015854i, 0.0005563718215619396 + 0.0040159796936108764i, 0.0698773126490335 + -1.4772254600114998e-18i, -0.05285958299321508 + -0.08158777833881561i, -0.0022580144028966644 + 0.0002376085441019875i, 0.0012562334035123505 + -0.001821115211896068i, -0.014057680761705351 + -0.02971004060415281i, -0.021216935233390428 + 0.03762038460005958i }, { -0.0029787241558336744 + 0.0029652530476208883i, -0.0023990067520599043 + 0.007731836561759153i, -0.052859582993215075 + 0.08158777833881563i, 0.18190705956548323 + -2.087089182034596e-18i, 0.0013380575388736294 + 0.0013683492161674549i, 0.0058998434045531315 + -0.0002635433199252208i, 0.042864097483439695 + 0.007962125169129287i, -0.03520174953166151 + -0.07501251947264011i }, { -0.014475167143653904 + 0.0306262710450764i, 0.044073095333881915 + -0.008731183096069385i, -0.002258014402896664 + -0.0002376085441019872i, 0.0013380575388736286 + -0.0013683492161674546i, 0.06900973354341888 + -6.098637220230962e-19i, -0.052267495694820296 + -0.08003790476673604i, 0.0014469119861029956 + 0.004132605515679323i, -0.0027179708287557447 + -0.002674478988303486i }, { -0.021666437073685065 + -0.038295041016954856i, -0.03581827207841873 + 0.07718610836229853i, 0.0012562334035123505 + 0.0018211152118960679i, 0.005899843404553131 + 0.0002635433199252191i, -0.052267495694820296 + 0.08003790476673604i, 0.17917627718189702 + -5.014435047745458e-18i, 0.0004976568386566796 + -0.003930587789769336i, -0.002671706882629315 + -0.007107100679082936i }, { 0.0015888484324307808 + 0.001591407388186607i, -0.002174931610636056 + -5.3965697020654196e-05i, -0.014057680761705348 + 0.029710040604152808i, 0.042864097483439695 + -0.007962125169129291i, 0.0014469119861029952 + -0.004132605515679324i, 0.0004976568386566796 + 0.003930587789769336i, 0.06689109723576439 + -1.463672932855431e-18i, -0.05063393922211798 + -0.0778225049220041i }, { 1.0024354368668765e-05 + -0.0018190110190814835i, -0.0034767907616296253 + -0.004069524791930153i, -0.021216935233390428 + -0.03762038460005958i, -0.0352017495316615 + 0.0750125194726401i, -0.002717970828755745 + 0.002674478988303488i, -0.0026717068826293136 + 0.0071071006790829365i, -0.05063393922211797 + 0.0778225049220041i, 0.173888167563801 + -5.759824041329242e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.07188833376828739, 1.0e-7), DoubleNear(0.18736201849231374, 1.0e-7), DoubleNear(0.0698773126490335, 1.0e-7), DoubleNear(0.18190705956548323, 1.0e-7), DoubleNear(0.06900973354341888, 1.0e-7), DoubleNear(0.17917627718189702, 1.0e-7), DoubleNear(0.06689109723576439, 1.0e-7), DoubleNear(0.173888167563801, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.07397417751012925 + 3.0357660829594124e-18i, -0.06004301856259703 + -0.0935958445356303i, -0.0008252066924950668 + 0.005053664667687177i, 0.0025143009280034685 + -0.004419178020319995i, 0.026593642748350847 + 0.014223592071427848i, -0.019840683677817616 + -0.022428939906391603i, 0.004061400610848498 + 0.011885283436636494i, 0.011741318629883804 + -0.014785679962819659i }, { -0.060043018562597035 + 0.0935958445356303i, 0.2511670936805725 + -1.0055975149803054e-17i, 0.005746953738459008 + -0.005990219420825676i, -0.004852088056009692 + -0.006627802715434519i, -0.022439979535008703 + -0.04343724113392125i, -0.04617888093993851 + 0.01441936902943327i, -0.018334396389590647 + -0.004508303911755376i, 0.013789814527638913 + 0.04035451557323601i }, { -0.000825206692495066 + -0.005053664667687178i, 0.005746953738459007 + 0.005990219420825676i, 0.06496238143010119 + -4.2148359455373985e-18i, -0.04521033685891106 + -0.06855768979945173i, 0.0036743190133241357 + -0.01075252778396968i, -0.01390474986919608 + 0.0036055109880844933i, 0.025814195333779037 + -0.013806705142062507i, -0.021782274075206953 + 0.04216411561221861i }, { 0.002514300928003468 + 0.004419178020319997i, -0.004852088056009693 + 0.00662780271543452i, -0.04521033685891104 + 0.06855768979945175i, 0.11198972522639244 + 5.55653613398821e-19i, 0.008790491534986886 + 0.01136085546882058i, 0.00633421939956179 + -0.018536460725529155i, -0.01925916238183152 + 0.02177155801301757i, -0.04482539921887242 + -0.013996743967643051i }, { 0.026593642748350854 + -0.014223592071427836i, -0.02243997953500868 + 0.04343724113392124i, 0.0036743190133241366 + 0.010752527783969682i, 0.008790491534986884 + -0.011360855468820576i, 0.06692388980157704 + -4.1809546276472265e-18i, -0.046575441589891645 + -0.07062775680608331i, 0.003745345598751901 + 0.003491830323008i, -0.008210995912592889 + -0.0012205540156043772i }, { -0.019840683677817616 + 0.022428939906391603i, -0.04617888093993851 + -0.01441936902943327i, -0.013904749869196082 + -0.003605510988084492i, 0.006334219399561791 + 0.018536460725529155i, -0.046575441589891645 + 0.07062775680608331i, 0.11537120199363829 + -1.9786689647860456e-18i, -0.004692925078240389 + -0.001956348062554537i, -0.00021862557867952884 + -0.008211134525407568i }, { 0.0040614006108485 + -0.011885283436636496i, -0.018334396389590647 + 0.004508303911755376i, 0.025814195333779037 + 0.013806705142062517i, -0.019259162381831518 + -0.02177155801301757i, 0.0037453455987519 + -0.0034918303230079993i, -0.004692925078240387 + 0.0019563480625545376i, 0.07180602845469672 + 1.2739375526704677e-18i, -0.058283185356422004 + -0.09085259346136798i }, { 0.011741318629883805 + 0.014785679962819655i, 0.01378981452763891 + -0.04035451557323602i, -0.02178227407520697 + -0.04216411561221864i, -0.04482539921887243 + 0.013996743967643048i, -0.008210995912592889 + 0.0012205540156043798i, -0.00021862557867952516 + 0.00821113452540757i, -0.058283185356422004 + 0.09085259346136798i, 0.24380550190289174 + -8.40256683676266e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.07397417751012925, 1.0e-7), DoubleNear(0.2511670936805725, 1.0e-7), DoubleNear(0.06496238143010119, 1.0e-7), DoubleNear(0.11198972522639244, 1.0e-7), DoubleNear(0.06692388980157704, 1.0e-7), DoubleNear(0.11537120199363829, 1.0e-7), DoubleNear(0.07180602845469672, 1.0e-7), DoubleNear(0.24380550190289174, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.06966253296254793 + 1.0299920638612292e-18i, -0.060926448406374685 + -0.08474584509987909i, 0.0008430971405072136 + 0.0024672396150185573i, -0.005236290722150336 + -0.001563673010457642i, 0.0601420128712019 + -0.0008273630378375222i, -0.04273894694544008 + -0.0781114309235532i, 0.0031457668675541612 + 0.002998597819831219i, -0.0037530790642961763 + -0.004919314436842967i }, { -0.06092644840637469 + 0.08474584509987909i, 0.20485002764247867 + -8.131516293641283e-18i, 0.003184343741668293 + -0.004441144981354395i, -0.0034113613661595275 + -0.009983008480694269i, -0.048280737357439645 + 0.06208549489798188i, 0.156456020418353 + 0.022702106211686973i, 0.0009420784787070547 + -0.0005965839276532599i, 0.0005323052582512549 + -0.007255482937851746i }, { 0.0008430971405072137 + -0.0024672396150185573i, 0.003184343741668293 + 0.004441144981354395i, 0.06762075622199405 + 2.981555974335137e-19i, -0.05914072227856407 + -0.08226198343098834i, -0.0006528578442207399 + -0.004296651568993871i, -4.225910632000581e-05 + 0.006187363829558026i, 0.05837927818745836 + -0.0008031134084483801i, -0.04148628810462705 + -0.07582202087702455i }, { -0.005236290722150335 + 0.0015636730104576465i, -0.0034113613661595245 + 0.00998300848069427i, -0.05914072227856407 + 0.08226198343098831i, 0.19884596772741514 + -8.117963766485214e-18i, -0.0011101629889611884 + -0.00010470138832866741i, -0.004861149940116112 + 0.005412448873581059i, -0.04686565119331455 + 0.06026579765159226i, 0.15187036655501218 + 0.022036717939780095i }, { 0.06014201287120191 + 0.0008273630378375218i, -0.04828073735743965 + -0.06208549489798189i, -0.0006528578442207416 + 0.004296651568993871i, -0.0011101629889611864 + 0.00010470138832867099i, 0.07123553434915833 + -2.1751806085490433e-18i, -0.04569201174611398 + -0.07947775624183452i, 0.002077041765749621 + 0.0060782553756766194i, -0.0004604042624390837 + -0.004076059025466729i }, { -0.04273894694544007 + 0.0781114309235532i, 0.156456020418353 + -0.022702106211686994i, -4.22591063200044e-05 + -0.006187363829558026i, -0.0048611499401161095 + -0.005412448873581057i, -0.04569201174611398 + 0.07947775624183452i, 0.16168826803173209 + -3.903127820947816e-18i, -0.0021303150814496736 + -0.0035054225020258187i, -0.001659352268529693 + -0.004855928760147819i }, { 0.0031457668675541612 + -0.0029985978198312185i, 0.0009420784787070543 + 0.0005965839276532613i, 0.05837927818745837 + 0.0008031134084483793i, -0.04686565119331455 + -0.06026579765159226i, 0.00207704176574962 + -0.006078255375676621i, -0.0021303150814496736 + 0.0035054225020258187i, 0.06914765366280384 + -3.2390539903004445e-18i, -0.04435279993676898 + -0.07714829982983139i }, { -0.0037530790642961768 + 0.004919314436842969i, 0.0005323052582512572 + 0.007255482937851745i, -0.041486288104627046 + 0.07582202087702457i, 0.1518703665550122 + -0.022036717939780112i, -0.00046040426243908455 + 0.00407605902546673i, -0.0016593522685296928 + 0.004855928760147819i, -0.04435279993676898 + 0.07714829982983139i, 0.15694925940186907 + 2.710505431213761e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.06966253296254793, 1.0e-7), DoubleNear(0.20485002764247867, 1.0e-7), DoubleNear(0.06762075622199405, 1.0e-7), DoubleNear(0.19884596772741514, 1.0e-7), DoubleNear(0.07123553434915833, 1.0e-7), DoubleNear(0.16168826803173209, 1.0e-7), DoubleNear(0.06914765366280384, 1.0e-7), DoubleNear(0.15694925940186907, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.06642134170580766 + -1.6263032587282567e-19i, -0.050261450061402736 + -0.07741732834947143i, 0.0008508542830432053 + 0.004448780562245824i, -0.0024335892370255714 + -0.003200433862933918i, 0.011592418444712514 + -0.03371875025521682i, -0.048072912091032864 + 0.012003660216893815i, -0.00036370456286550926 + -0.0012424352863490975i, 0.0007798691829345366 + 0.0008440019540785886i }, { -0.050261450061402736 + 0.07741732834947143i, 0.1727913366716448 + -5.204170427930421e-18i, 0.0010808342299375912 + -0.003872587100760429i, -0.0014774771175838847 + -0.00772514355614567i, 0.030528799136179473 + 0.03902672364954072i, 0.030157016207093018 + -0.08771740795755179i, -0.00020162308566234522 + 0.0011313193060791694i, 0.0006315595747754516 + 0.0021574431042340487i }, { 0.0008508542830432057 + -0.004448780562245825i, 0.0010808342299375908 + 0.0038725871007604293i, 0.065941738916411 + -2.1277467635028025e-18i, -0.04989853159228576 + -0.07685832779828573i, -0.004483462023274324 + 0.0003546569499206419i, 0.0034239951540388763 + -0.002052841215022907i, -0.0015407470254497234 + -0.03391853207543644i, -0.03836781807911626 + 0.027462184255739867i }, { -0.002433589237025572 + 0.0032004338629339213i, -0.0014774771175838839 + 0.0077251435561456715i, -0.04989853159228576 + 0.07685832779828572i, 0.17154367733621095 + -5.841139204265655e-18i, 0.003704165121984759 + 0.0014889797238545805i, 0.007785366635579101 + -0.0006158487282048889i, 0.04069960414931921 + 0.02387055194873143i, -0.004008165616098064 + -0.08823712898202825i }, { 0.011592418444712512 + 0.03371875025521682i, 0.030528799136179473 + -0.03902672364954071i, -0.004483462023274324 + -0.00035465694992064216i, 0.0037041651219847575 + -0.0014889797238545794i, 0.07447672560589862 + -9.825582188149884e-19i, -0.05635701009108593 + -0.08680627299224218i, 0.0020692846232136294 + 0.004096714428449354i, -0.0032631057475638486 + -0.002439298172990454i }, { -0.04807291209103286 + -0.012003660216893822i, 0.030157016207093018 + 0.08771740795755179i, 0.0034239951540388754 + 0.002052841215022907i, 0.007785366635579101 + 0.0006158487282048895i, -0.056357010091085936 + 0.08680627299224218i, 0.19374695900256594 + -6.830473686658678e-18i, -2.6805569718972057e-05 + -0.004073980382619784i, -0.0035932365171053356 + -0.007113793684696418i }, { -0.00036370456286550893 + 0.0012424352863490964i, -0.00020162308566234473 + -0.001131319306079169i, -0.0015407470254497234 + 0.033918532075436436i, 0.04069960414931921 + -0.023870551948731437i, 0.002069284623213628 + -0.004096714428449354i, -2.6805569718971406e-05 + 0.004073980382619784i, 0.07082667096838689 + -8.131516293641283e-19i, -0.053594990623047296 + -0.082551955462534i }, { 0.0007798691829345363 + -0.0008440019540785877i, 0.0006315595747754508 + -0.0021574431042340496i, -0.03836781807911627 + -0.027462184255739867i, -0.004008165616098058 + 0.08823712898202826i, -0.003263105747563848 + 0.0024392981729904556i, -0.0035932365171053335 + 0.007113793684696418i, -0.053594990623047296 + 0.082551955462534i, 0.18425154979307323 + -2.0057740190981832e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.06642134170580766, 1.0e-7), DoubleNear(0.1727913366716448, 1.0e-7), DoubleNear(0.065941738916411, 1.0e-7), DoubleNear(0.17154367733621095, 1.0e-7), DoubleNear(0.07447672560589862, 1.0e-7), DoubleNear(0.19374695900256594, 1.0e-7), DoubleNear(0.07082667096838689, 1.0e-7), DoubleNear(0.18425154979307323, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.07952074755071746 + -5.21772295508649e-19i, -0.06355695376252572 + -0.09239791945655157i, 0.004827760210935845 + 0.0012711925679521926i, 0.001535899655299068 + -0.0037225794586132027i, -0.01670655546791046 + -0.033952679323322i, -0.0230360612521415 + 0.043999332534651985i, -0.0012837898723180475 + -0.0032963950365658963i, -0.0020374224806547726 + 0.0023899527797194573i }, { -0.06355695376252572 + 0.09239791945655157i, 0.21059118907201257 + -3.957337929572091e-18i, -0.007893206237723494 + -0.00027777204169365495i, 0.0029389489324467624 + 0.013962200112897541i, 0.05011522609987893 + 0.010897551780514662i, -0.039674985221376524 + -0.0879483330579433i, 0.00251120527271067 + 0.003448898566912737i, 0.002928303797115644 + -0.0058048074703807i }, { 0.004827760210935845 + -0.001271192567952194i, -0.007893206237723495 + 0.0002777720416936543i, 0.06224489886660344 + -1.4907779871675686e-18i, -0.043653593688357736 + -0.07337555545724161i, -0.0015108205100225827 + -0.0027370986373212976i, -8.081601478568293e-06 + 0.003921849459427863i, -0.011826292437448802 + -0.026383632325907208i, -0.019847311054933998 + 0.03191609308236244i }, { 0.0015358996552990694 + 0.003722579458613201i, 0.0029389489324467594 + -0.01396220011289754i, -0.04365359368835773 + 0.07337555545724163i, 0.1586778889857844 + -5.149960319306146e-18i, 0.002185575540771508 + -0.0009114266366960788i, -0.0066334483196814654 + -0.0016142292268343916i, 0.03682196671744266 + 0.0057957564846840125i, -0.03134503638870371 + -0.06425029477699531i }, { -0.016706555467910455 + 0.033952679323322i, 0.05011522609987894 + -0.010897551780514662i, -0.0015108205100225825 + 0.0027370986373212976i, 0.0021855755407715095 + 0.0009114266366960781i, 0.07693680099590698 + -5.082197683525802e-19i, -0.06129796455321582 + -0.08775898998217498i, 0.004471310070735129 + 0.0015985380458247021i, 0.0018137354014109638 + -0.004355868042071367i }, { -0.023036061252141492 + -0.04399933253465198i, -0.03967498522137652 + 0.0879483330579433i, -8.081601478567696e-06 + -0.003921849459427862i, -0.0066334483196814654 + 0.001614229226834392i, -0.06129796455321582 + 0.08775898998217498i, 0.19928340298897698 + -4.851804721872632e-18i, -0.006902206515828098 + -0.0006984511683133696i, 0.0031616716940846296 + 0.01280682679818887i }, { -0.0012837898723180468 + 0.0032963950365658967i, 0.0025112052727106707 + -0.003448898566912737i, -0.011826292437448798 + 0.026383632325907208i, 0.03682196671744266 + -0.005795756484684014i, 0.004471310070735129 + -0.0015985380458247026i, -0.006902206515828098 + 0.0006984511683133688i, 0.05896402978327629 + -1.565316886525947e-18i, -0.041603470363722445 + -0.07010141970656515i }, { -0.0020374224806547717 + -0.0023899527797194573i, 0.0029283037971156436 + 0.005804807470380699i, -0.019847311054934 + -0.03191609308236244i, -0.0313450363887037 + 0.06425029477699531i, 0.0018137354014109651 + 0.004355868042071366i, 0.003161671694084626 + -0.01280682679818887i, -0.041603470363722445 + 0.07010141970656515i, 0.15378104175672105 + -5.922454367202068e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.07952074755071746, 1.0e-7), DoubleNear(0.21059118907201257, 1.0e-7), DoubleNear(0.06224489886660344, 1.0e-7), DoubleNear(0.1586778889857844, 1.0e-7), DoubleNear(0.07693680099590698, 1.0e-7), DoubleNear(0.19928340298897698, 1.0e-7), DoubleNear(0.05896402978327629, 1.0e-7), DoubleNear(0.15378104175672105, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.07826798480346171 + -4.336808689942018e-19i, -0.062489040819305966 + -0.09023433913055022i, 0.004576300284974688 + 0.001467347093064055i, 0.001739977853646366 + -0.003943584217840093i, 0.028370430233331752 + 0.00018490828233660073i, -0.024629461048650107 + 0.012978192415350854i, 0.005227562549277726 + -0.003406090468577614i, -0.0070534303861164264 + -0.0011788259336415218i }, { -0.062489040819305966 + 0.0902343391305502i, 0.20594617938781165 + -5.1228552649940085e-18i, -0.00741464816269435 + -0.0005862197949572977i, 0.0030087731919626543 + 0.013414506787197765i, -0.024537702558861813 + -0.01400331795909852i, -0.04962173958505779 + 0.00014673283653671235i, 0.003139413937508505 + 0.0029462868858275764i, -0.00116163439332061 + -0.007319059073162947i }, { 0.00457630028497469 + -0.0014673470930640564i, -0.007414648162694351 + 0.0005862197949572964i, 0.06066857413676871 + -7.453889935837843e-19i, -0.04276431460220211 + -0.07191919520453183i, 0.0052023657877409615 + 0.00347093484041657i, 0.0032488017755654035 + -0.003079030873673231i, 0.024037407848798136 + 0.00023197864702873884i, -0.016993496704374462 + 0.006756983290476156i }, { 0.0017399778536463678 + 0.003943584217840093i, 0.00300877319196265 + -0.013414506787197765i, -0.04276431460220211 + 0.07191919520453183i, 0.1572106395191533 + -4.377466271410224e-18i, -0.007076154448523138 + 0.0009237845256680325i, -0.0013033480550314412 + 0.0076003307519766725i, -0.01716143935797841 + -0.007662365161805162i, -0.04138254057375314 + 0.0002758922252535062i }, { 0.028370430233331752 + -0.00018490828233658923i, -0.0245377025588618 + 0.014003317959098517i, 0.0052023657877409615 + -0.0034709348404165707i, -0.0070761544485231425 + -0.0009237845256680306i, 0.07818956374316274 + -5.963111948670274e-19i, -0.06236587749643558 + -0.08992257030817634i, 0.0047227699966962845 + 0.0014023835207128397i, 0.0016096572030636657 + -0.004134863282844476i }, { -0.024629461048650117 + -0.012978192415350864i, -0.04962173958505779 + -0.00014673283653671512i, 0.0032488017755654052 + 0.0030790308736732305i, -0.0013033480550314444 + -0.0076003307519766725i, -0.06236587749643557 + 0.08992257030817633i, 0.2039284126731779 + -3.686287386450715e-18i, -0.007380764590857241 + -0.0003900034150497269i, 0.0030918474345687378 + 0.013354520123888646i }, { 0.005227562549277727 + 0.003406090468577614i, 0.0031394139375085046 + -0.0029462868858275764i, 0.024037407848798136 + -0.00023197864702873125i, -0.017161439357978397 + 0.007662365161805158i, 0.0047227699966962845 + -0.0014023835207128404i, -0.007380764590857241 + 0.00039000341504972667i, 0.06054035451311102 + -2.3107058801097313e-18i, -0.04249274944987807 + -0.07155777995927495i }, { -0.007053430386116426 + 0.001178825933641521i, -0.0011616343933206074 + 0.007319059073162947i, -0.016993496704374472 + -0.006756983290476165i, -0.04138254057375314 + -0.00027589222525350684i, 0.0016096572030636662 + 0.004134863282844474i, 0.0030918474345687356 + -0.013354520123888642i, -0.04249274944987807 + 0.07155777995927495i, 0.15524829122335215 + -6.69494841509799e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.07826798480346171, 1.0e-7), DoubleNear(0.20594617938781165, 1.0e-7), DoubleNear(0.06066857413676871, 1.0e-7), DoubleNear(0.1572106395191533, 1.0e-7), DoubleNear(0.07818956374316274, 1.0e-7), DoubleNear(0.2039284126731779, 1.0e-7), DoubleNear(0.06054035451311102, 1.0e-7), DoubleNear(0.15524829122335215, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.07954319503974444 + 1.8295911660692887e-18i, -0.07227334756870848 + -0.09534005327952222i, 0.0016903811383100144 + 0.004564308673436312i, 0.0066665143076940735 + -0.00481023331738828i, 0.06713919556716963 + 0.0022256992522544676i, -0.04761649542542488 + -0.08838892838387767i, 0.0030687830785497937 + -8.22049681500055e-05i, 0.0011926676643040876 + -0.00020856481092459435i }, { -0.07227334756870848 + 0.09534005327952219i, 0.23454850203027516 + -7.562310153086393e-18i, -0.008899406311031347 + -0.005791617220125129i, 0.0010497655849476388 + 0.02063889709018934i, -0.06016947858280334 + 0.06453717857783661i, 0.17433441257281787 + 0.03173861603020414i, -0.0041236715719701325 + -0.0018968418552833136i, -0.0040280452146064585 + 0.007257572949515482i }, { 0.0016903811383100153 + -0.004564308673436313i, -0.008899406311031345 + 0.005791617220125129i, 0.05774009414479754 + -5.014435047745458e-19i, -0.047793823116230275 + -0.07166777525134521i, 0.006111552118200115 + -0.0016357180672056217i, -0.009881671484469681 + -0.0012860352609416971i, 0.051382095491490615 + -0.00385617569854037i, -0.036608739624642256 + -0.06554452341670007i }, { 0.0066665143076940735 + 0.004810233317388279i, 0.0010497655849476344 + -0.020638897090189335i, -0.047793823116230275 + 0.07166777525134521i, 0.16914749333961865 + -8.687169907040104e-18i, -0.0007039398388932694 + 0.004580611391024391i, 0.007533961709595341 + -0.013762772907629122i, -0.03497690996795085 + 0.057814113971737524i, 0.13399197440054733 + 0.01300020812126293i }, { 0.06713919556716966 + -0.0022256992522544684i, -0.060169478582803346 + -0.06453717857783661i, 0.006111552118200114 + 0.0016357180672056213i, -0.0007039398388932717 + -0.0045806113910243935i, 0.07691435350688 + -2.859583229930518e-18i, -0.05258157074703306 + -0.08481685615920434i, 0.0076086891433609595 + -0.001694578059659418i, -0.0033168792509840417 + -0.00326821418329629i }, { -0.04761649542542488 + 0.08838892838387769i, 0.17433441257281787 + -0.03173861603020416i, -0.00988167148446968 + 0.0012860352609416967i, 0.007533961709595337 + 0.013762772907629117i, -0.052581570747033055 + 0.08481685615920434i, 0.17532609003071437 + -1.2468324983583301e-18i, -0.005896006442520245 + 0.004815394010118105i, 0.005050855041583754 + 0.0061301298208970715i }, { 0.0030687830785497937 + 8.220496815000553e-05i, -0.004123671571970135 + 0.001896841855283315i, 0.05138209549149063 + 0.0038561756985403695i, -0.03497690996795085 + -0.057814113971737524i, 0.007608689143360959 + 0.0016945780596594171i, -0.005896006442520247 + -0.004815394010118106i, 0.06346883450508219 + -2.55465136891897e-18i, -0.037463240935849906 + -0.07180919991246155i }, { 0.0011926676643040876 + 0.00020856481092459609i, -0.0040280452146064585 + -0.007257572949515484i, -0.03660873962464225 + 0.06554452341670008i, 0.13399197440054733 + -0.013000208121262942i, -0.003316879250984039 + 0.003268214183296287i, 0.00505085504158375 + -0.006130129820897071i, -0.037463240935849906 + 0.07180919991246157i, 0.1433114374028868 + -2.3852447794681098e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.07954319503974444, 1.0e-7), DoubleNear(0.23454850203027516, 1.0e-7), DoubleNear(0.05774009414479754, 1.0e-7), DoubleNear(0.16914749333961865, 1.0e-7), DoubleNear(0.07691435350688, 1.0e-7), DoubleNear(0.17532609003071437, 1.0e-7), DoubleNear(0.06346883450508219, 1.0e-7), DoubleNear(0.1433114374028868, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.07458939796979865 + -5.149960319306146e-19i, -0.05954060451488473 + -0.08588331585180556i, 0.0044385968034309844 + 0.0013615884548624595i, 0.0016014858750456348 + -0.0038497455080867974i, 0.005647265586081259 + -0.038107159494223844i, -0.04834404011473788 + 0.02388300635801261i, 0.0010253808638671232 + -0.002140490240980106i, -0.0018597426356432457 + -0.0011081788153525516i }, { -0.059540604514884715 + 0.08588331585180556i, 0.19541226307198298 + -4.607859233063394e-18i, -0.007056703758106096 + -0.00047090313721064167i, 0.0028819672861349344 + 0.012793784124920788i, 0.03942131818953305 + 0.036911694692258024i, 0.014770589888104407 + -0.09982340628931308i, -0.0007596292020095499 + 0.003580370258477566i, 0.006785671175316869 + -0.0006217840496449064i }, { 0.0044385968034309844 + -0.001361588454862461i, -0.007056703758106097 + 0.00047090313721064123i, 0.057773682652420014 + -1.7753810574450135e-18i, -0.04061937713880377 + -0.06839234029595159i, -0.0003819784291641424 + -0.0023815449666890333i, -0.00029204736781070044 + 0.003622272146190854i, 0.00440440583318153 + -0.02953012283642942i, -0.03809669005541125 + 0.015582838114621071i }, { 0.0016014858750456355 + 0.003849745508086797i, 0.0028819672861349318 + -0.012793784124920783i, -0.04061937713880377 + 0.06839234029595159i, 0.14892275093587282 + -6.4374503991326826e-18i, 0.0020777324783508976 + -0.0005168747159599526i, -0.006207936130014243 + -0.0023882434885159013i, 0.03180708509596562 + 0.025985580906014126i, 0.011378260702890549 + -0.07613113065026696i }, { 0.0056472655860812584 + 0.03810715949422383i, 0.03942131818953306 + -0.036911694692258024i, -0.00038197842916414134 + 0.0023815449666890337i, 0.0020777324783508976 + 0.0005168747159599507i, 0.0818681505768258 + -5.149960319306146e-19i, -0.06531431380085681 + -0.094273593586921i, 0.004860473478239989 + 0.0015081421589144349i, 0.0017481491816643965 + -0.004228701992597773i }, { -0.048344040114737884 + -0.023883006358012618i, 0.014770589888104408 + 0.09982340628931308i, -0.00029204736781070044 + -0.003622272146190853i, -0.006207936130014244 + 0.0023882434885159026i, -0.06531431380085681 + 0.09427359358692097i, 0.21446232898900658 + -4.20128341838133e-18i, -0.0077387089954454955 + -0.0005053200727963827i, 0.003218653340396458 + 0.013975242786165623i }, { 0.0010253808638671237 + 0.0021404902409801066i, -0.0007596292020095492 + -0.0035803702584775656i, 0.004404405833181531 + 0.029530122836429425i, 0.03180708509596562 + -0.02598558090601413i, 0.00486047347823999 + -0.0015081421589144355i, -0.0077387089954454955 + 0.0005053200727963818i, 0.06343524599745971 + -1.2807138162485021e-18i, -0.04463768691327641 + -0.07508463486785517i }, { -0.0018597426356432452 + 0.0011081788153525537i, 0.006785671175316869 + 0.0006217840496449038i, -0.03809669005541125 + -0.015582838114621071i, 0.01137826070289055 + 0.07613113065026696i, 0.0017481491816643989 + 0.00422870199259777i, 0.0032186533403964534 + -0.013975242786165623i, -0.04463768691327641 + 0.07508463486785519i, 0.16353617980663265 + -4.6349642873755315e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.07458939796979865, 1.0e-7), DoubleNear(0.19541226307198298, 1.0e-7), DoubleNear(0.057773682652420014, 1.0e-7), DoubleNear(0.14892275093587282, 1.0e-7), DoubleNear(0.0818681505768258, 1.0e-7), DoubleNear(0.21446232898900658, 1.0e-7), DoubleNear(0.06343524599745971, 1.0e-7), DoubleNear(0.16353617980663265, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.0712901626779138 + -6.166399856011306e-19i, -0.053907875149569365 + -0.08359199574620854i, -0.013526475937072208 + -0.029855579807786352i, -0.021421704447867014 + 0.03670368762919486i, 0.026713825525489635 + 0.0001506297658412331i, -0.021484681364337163 + 0.010093417543468045i, -0.005538520605925173 + -0.011978284627873176i, 0.010008232578756092 + 0.003932156324988714i }, { -0.05390787514956936 + 0.08359199574620854i, 0.18628285661171257 + -6.0986372202309624e-18i, 0.04262051817572931 + 0.009300174395610705i, -0.034283619664408876 + -0.07590257384975889i, -0.021380456517642973 + -0.010454427752905194i, -0.04560570400382291 + -0.0002929351551421302i, -0.004612115522059122 + 0.012327694995365497i, 0.015717177402368922 + 0.027303810310284504i }, { -0.013526475937072204 + 0.029855579807786352i, 0.042620518175729316 + -0.009300174395610705i, 0.06764639626231661 + -5.624298769768554e-19i, -0.05134548027193872 + -0.0785615385888735i, -0.005821953801455315 + 0.011673803095728576i, -0.003944362965663913 + -0.010765698868526217i, 0.025694012556640253 + 0.00026625716352410647i, -0.02013827638868741 + 0.009641758162358965i }, { -0.02142170444786701 + -0.03670368762919486i, -0.03428361966440887 + 0.07590257384975889i, -0.05134548027193872 + 0.0785615385888735i, 0.17687396229525237 + -3.40168431617327e-18i, 0.011285457081014569 + -0.002669572307393715i, 0.014592304474393735 + -0.029485759960877142i, -0.02031868539919725 + -0.01121125536799849i, -0.04539857615498802 + 0.0007155602169323487i }, { 0.026713825525489635 + -0.0001506297658412224i, -0.021380456517642962 + 0.01045442775290519i, -0.005821953801455311 + -0.011673803095728581i, 0.011285457081014562 + 0.0026695723073937123i, 0.0704754837394071 + -1.395910297075087e-18i, -0.053302672301314094 + -0.08218147916758467i, -0.01500637196828705 + -0.030480731841442857i, -0.021461667859208486 + 0.03921173798781957i }, { -0.02148468136433717 + -0.010093417543468056i, -0.04560570400382291 + 0.00029293515514212747i, -0.003944362965663917 + 0.010765698868526224i, 0.014592304474393733 + 0.029485759960877142i, -0.053302672301314094 + 0.08218147916758467i, 0.1829862214460844 + -3.0086610286472748e-18i, 0.04431667464159228 + 0.007393133869587971i, -0.03673640194567136 + -0.07629605398517973i }, { -0.005538520605925178 + 0.011978284627873176i, -0.004612115522059122 + -0.012327694995365492i, 0.025694012556640253 + -0.00026625716352409807i, -0.020318685399197237 + 0.011211255367998486i, -0.015006371968287049 + 0.03048073184144286i, 0.044316674641592294 + -0.007393133869587971i, 0.06825443451686666 + -1.5111067779016718e-18i, -0.051555954644999555 + -0.07929887109986662i }, { 0.010008232578756101 + -0.003932156324988716i, 0.015717177402368922 + -0.027303810310284504i, -0.02013827638868742 + -0.009641758162358974i, -0.04539857615498802 + -0.0007155602169323494i, -0.021461667859208486 + -0.03921173798781957i, -0.03673640194567135 + 0.07629605398517973i, -0.051555954644999555 + 0.07929887109986662i, 0.17619048245044566 + -7.37257477290143e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.0712901626779138, 1.0e-7), DoubleNear(0.18628285661171257, 1.0e-7), DoubleNear(0.06764639626231661, 1.0e-7), DoubleNear(0.17687396229525237, 1.0e-7), DoubleNear(0.0704754837394071, 1.0e-7), DoubleNear(0.1829862214460844, 1.0e-7), DoubleNear(0.06825443451686666, 1.0e-7), DoubleNear(0.17619048245044566, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.07023413281340324 + 5.89534931288993e-19i, -0.0614430069949616 + -0.08550626958406099i, -0.01314176243845069 + -0.028397416618388634i, -0.022510923647079104 + 0.040215858949922856i, 0.06051195214286679 + -0.000968092329642269i, -0.042934788885144556 + -0.07874266959959783i, -0.011172692689694327 + -0.026508629837644536i, -0.022828379824992622 + 0.033779873363112695i }, { -0.0614430069949616 + 0.08550626958406099i, 0.2061406129632733 + -8.267041565201971e-18i, 0.04527311475219672 + 0.009122032350614099i, -0.04128580981509926 + -0.08742850646322149i, -0.04856931152202872 + 0.0629476043357714i, 0.15769591032262426 + 0.023040069969005324i, 0.03159972955375544 + 0.011437063542589053i, -0.02208257165414887 + -0.0674753611915774i }, { -0.013141762438450687 + 0.028397416618388634i, 0.045273114752196725 + -0.009122032350614099i, 0.06704915637113876 + 7.386127300057499e-19i, -0.05862416368997716 + -0.08150155894680644i, -0.013190875990919872 + 0.025007936286109523i, 0.041049454098163 + -0.004177490544150927i, 0.05800933891579347 + -0.000662384116643633i, -0.041290446164922584 + -0.07519078220097991i }, { -0.022510923647079108 + -0.040215858949922856i, -0.041285809815099245 + 0.08742850646322149i, -0.05862416368997716 + 0.08150155894680644i, 0.19755538240662052 + -7.982438494924526e-18i, -0.011927407890173488 + -0.030088325579418984i, -0.037541774114002495 + 0.06096295318632863i, -0.04657707702872547 + 0.05940368821380275i, 0.15063047665074097 + 0.02169875418246174i }, { 0.0605119521428668 + 0.0009680923296422684i, -0.04856931152202872 + -0.0629476043357714i, -0.013190875990919875 + -0.025007936286109526i, -0.011927407890173488 + 0.030088325579418988i, 0.07153151360391766 + -2.6020852139652106e-18i, -0.04576754045592185 + -0.08026720532973222i, -0.015391085466908568 + -0.031938895030840575i, -0.020372448659996392 + 0.03569956666709158i }, { -0.04293478888514454 + 0.07874266959959783i, 0.15769591032262426 + -0.023040069969005345i, 0.041049454098163005 + 0.004177490544150921i, -0.0375417741140025 + -0.06096295318632863i, -0.04576754045592185 + 0.08026720532973222i, 0.16312846509452367 + -8.402566836762659e-19i, 0.04166407806512488 + 0.007571275914584576i, -0.029734211794980987 + -0.06477012137171713i }, { -0.011172692689694329 + 0.026508629837644543i, 0.03159972955375544 + -0.011437063542589054i, 0.058009338915793476 + 0.0006623841166436327i, -0.046577077028725475 + -0.05940368821380275i, -0.015391085466908564 + 0.031938895030840575i, 0.041664078065124885 + -0.007571275914584575i, 0.06885167440804453 + -2.812149384884277e-18i, -0.04427727122696111 + -0.07635885074193369i }, { -0.022828379824992633 + -0.033779873363112695i, -0.02208257165414886 + 0.06747536119157742i, -0.04129044616492257 + 0.07519078220097992i, 0.15063047665074097 + -0.02169875418246176i, -0.020372448659996392 + -0.035699566667091565i, -0.029734211794980973 + 0.06477012137171713i, -0.04427727122696111 + 0.07635885074193369i, 0.1555090623390775 + -2.791820594150174e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.07023413281340324, 1.0e-7), DoubleNear(0.2061406129632733, 1.0e-7), DoubleNear(0.06704915637113876, 1.0e-7), DoubleNear(0.19755538240662052, 1.0e-7), DoubleNear(0.07153151360391766, 1.0e-7), DoubleNear(0.16312846509452367, 1.0e-7), DoubleNear(0.06885167440804453, 1.0e-7), DoubleNear(0.1555090623390775, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.06759158538195642 + -1.1655173354219173e-18i, -0.05111599476268333 + -0.0790404233808748i, -0.013602620525858335 + -0.0287597266704612i, -0.02048120025756039 + 0.036200192984779056i, 0.0050999208958031166 + -0.03452425785245465i, -0.04418909486233887 + 0.020054057644068726i, -0.015729608751594966 + 0.004759457890415619i, 0.01692769059741121 + 0.013067523264707653i }, { -0.051115994762683324 + 0.0790404233808748i, 0.17606358585039353 + -5.8817967857338616e-18i, 0.0414791387288454 + 0.00793278936724702i, -0.0338727694085111 + -0.07258192982974732i, 0.036498083806887474 + 0.03217054829292462i, 0.01336746387989855 + -0.08990426111930208i, 0.007255469514127264 + -0.020440658460806466i, -0.03953028138740085 + 0.01175580793424767i }, { -0.013602620525858334 + 0.0287597266704612i, 0.0414791387288454 + -0.007932789367247022i, 0.06477149524026224 + -1.1248597539537109e-18i, -0.04904398689100517 + -0.07523523276688235i, 0.013668635563850867 + 0.00913925563491522i, -0.0008015111573677486 + -0.02189367881871418i, 0.004951750523459673 + -0.03311302447819861i, -0.04225163530781026 + 0.019411786828564953i }, { -0.020481200257560388 + -0.036200192984779056i, -0.03387276940851108 + 0.07258192982974732i, -0.04904398689100517 + 0.07523523276688235i, 0.1682714281574622 + -5.163512846462215e-18i, -0.02014092438379618 + 0.007827223173790233i, 0.034616087978349336 + 0.022910984294739922i, 0.0347303194786112 + 0.030726727305347524i, 0.012781386711096403 + -0.08605027582027794i }, { 0.0050999208958031166 + 0.03452425785245465i, 0.036498083806887474 + -0.03217054829292463i, 0.013668635563850864 + -0.00913925563491522i, -0.020140924383796183 + -0.007827223173790232i, 0.07417406103536447 + -8.470329472543003e-19i, -0.05609455268820013 + -0.0867330515329184i, -0.014930227379500921 + -0.03157658497876801i, -0.022402172049515105 + 0.03971523263223537i }, { -0.04418909486233887 + -0.02005405764406873i, 0.013367463879898556 + 0.0899042611193021i, -0.0008015111573677501 + 0.02189367881871418i, 0.034616087978349336 + -0.022910984294739926i, -0.05609455268820013 + 0.0867330515329184i, 0.19320549220740343 + -3.2255014631443757e-18i, 0.045458054088476196 + 0.008760518897951654i, -0.03714725220156914 + -0.0796166980051913i }, { -0.015729608751594966 + -0.004759457890415618i, 0.007255469514127264 + 0.02044065846080647i, 0.004951750523459673 + 0.03311302447819861i, 0.03473031947861121 + -0.030726727305347527i, -0.014930227379500918 + 0.03157658497876801i, 0.04545805408847621 + -0.008760518897951652i, 0.07112933553892103 + -9.486769009248164e-19i, -0.0538574480259331 + -0.08262517692185778i }, { 0.01692769059741121 + -0.01306752326470765i, -0.039530281387400855 + -0.011755807934247669i, -0.04225163530781026 + -0.01941178682856496i, 0.012781386711096406 + 0.08605027582027794i, -0.022402172049515105 + -0.039715232632235364i, -0.037147252201569135 + 0.0796166980051913i, -0.0538574480259331 + 0.08262517692185778i, 0.18479301658823577 + -5.6107462426124854e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.06759158538195642, 1.0e-7), DoubleNear(0.17606358585039353, 1.0e-7), DoubleNear(0.06477149524026224, 1.0e-7), DoubleNear(0.1682714281574622, 1.0e-7), DoubleNear(0.07417406103536447, 1.0e-7), DoubleNear(0.19320549220740343, 1.0e-7), DoubleNear(0.07112933553892103, 1.0e-7), DoubleNear(0.18479301658823577, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.06871967032714678 + 1.0842021724855044e-18i, -0.060375685646127684 + -0.08378060337614388i, 0.015131094734067624 + 0.00045272676596585983i, -0.018031373216436865 + 0.025155159522597333i, 0.05930474757739705 + -0.0007875028464074661i, -0.04208283737579317 + -0.07736646431248567i, 0.022113189048698502 + -0.01147016146673015i, -0.03384849451391336 + 0.011348458918373388i }, { -0.06037568564612769 + 0.08378060337614388i, 0.20342471313271898 + -7.684282897491013e-18i, -0.01879499311695967 + -0.026486933534519874i, -0.0612238252551118 + 0.0007431070072858792i, -0.04777146335770736 + 0.06106325491874662i, 0.1550126449119349 + 0.022981320082015817i, -0.0013317875314556972 + -0.007086623880969929i, -0.03940438933301431 + -0.01635810282610603i }, { 0.015131094734067624 + -0.00045272676596583793i, -0.018794993116959653 + 0.02648693353451987i, 0.0685636188573952 + 2.439454888092385e-19i, -0.059691485038811075 + -0.08322722515472356i, 0.022627138943372538 + -0.011826055902333134i, -0.03426657627480663 + 0.01140926918530086i, 0.0592165434812632 + -0.000842973599878436i, -0.04214239767427396 + -0.07656698748809207i }, { -0.01803137321643688 + -0.025155159522597344i, -0.0612238252551118 + -0.0007431070072858818i, -0.05969148503881108 + 0.08322722515472356i, 0.20027128223717483 + -8.565197162635485e-18i, -0.0016848312254939255 + -0.005499368932799238i, -0.0382855420205145 + -0.016718895878712624i, -0.04737492519304684 + 0.06128803763082753i, 0.15331374206143034 + 0.021757504069451247i }, { 0.059304747577397066 + 0.0007875028464074663i, -0.04777146335770736 + -0.06106325491874662i, 0.022627138943372545 + 0.011826055902333139i, -0.0016848312254939225 + 0.005499368932799235i, 0.07021688861308363 + -2.2632720350634905e-18i, -0.044877669775380394 + -0.07837293095893817i, 0.03727674334806227 + -3.583983660052027e-05i, -0.023591584536587704 + -0.0054199838167703195i }, { -0.04208283737579317 + 0.07736646431248567i, 0.1550126449119349 + -0.022981320082015838i, -0.034266576274806636 + -0.011409269185300863i, -0.0382855420205145 + 0.016718895878712624i, -0.044877669775380394 + 0.07837293095893817i, 0.15973210577424596 + -1.81603863891322e-18i, -0.02290414879988055 + 0.004821250413616189i, -0.029780454903699134 + -0.0003204819454956606i }, { 0.022113189048698502 + 0.011470161466730158i, -0.0013317875314556925 + 0.0070866238809699205i, 0.059216543481263206 + 0.0008429735998784346i, -0.04737492519304684 + -0.06128803763082753i, 0.03727674334806227 + 3.583983660051745e-05i, -0.022904148799880546 + -0.004821250413616196i, 0.07016629939887856 + -3.1509625637859973e-18i, -0.04516714190750257 + -0.07825312511272774i }, { -0.03384849451391338 + -0.01134845891837339i, -0.03940438933301431 + 0.016358102826106027i, -0.042142397674273954 + 0.0765669874880921i, 0.15331374206143034 + -0.021757504069451268i, -0.02359158453658771 + 0.005419983816770311i, -0.02978045490369913 + 0.0003204819454956598i, -0.04516714190750257 + 0.07825312511272774i, 0.15890542165935517 + -1.81603863891322e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.06871967032714678, 1.0e-7), DoubleNear(0.20342471313271898, 1.0e-7), DoubleNear(0.0685636188573952, 1.0e-7), DoubleNear(0.20027128223717483, 1.0e-7), DoubleNear(0.07021688861308363, 1.0e-7), DoubleNear(0.15973210577424596, 1.0e-7), DoubleNear(0.07016629939887856, 1.0e-7), DoubleNear(0.15890542165935517, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.06619353954472404 + -7.318364664277155e-19i, -0.05010291196269004 + -0.07717691859922209i, 0.024982716557432796 + 4.8415670724608344e-05i, -0.01985531920632584 + 0.009755754345727341i, 0.005354415784771198 + -0.03381364280254437i, -0.043831740790143583 + 0.018652941937319457i, 0.0018770232174193872 + -0.011440333890106262i, 0.003702140616448543 + 0.007829793465355263i }, { -0.05010291196269004 + 0.07717691859922207i, 0.1723986247533913 + -4.512991542970912e-18i, -0.019864166946875893 + -0.0099799561730239i, -0.043381566954886694 + 4.908207571475786e-05i, 0.034970259086614705 + 0.03250952218650819i, 0.019403220110501166 + -0.08788099479145933i, -0.006625051315809684 + 0.006327375177350301i, -0.0033148479210532993 + 0.023511933346525654i }, { 0.024982716557432796 + -4.841567072459848e-05i, -0.019864166946875882 + 0.009979956173023897i, 0.06616954107749462 + -1.5585406229479126e-18i, -0.050057069690998456 + -0.07709873754853508i, 0.001917358974584954 + -0.014091907354785426i, 0.0033664664014650633 + 0.013965521079843458i, 0.004697255634491591 + -0.03382363952810889i, -0.04260898938000554 + 0.020812902535314218i }, { -0.019855319206325855 + -0.009755754345727348i, -0.043381566954886694 + -4.9082075714753574e-05i, -0.050057069690998456 + 0.07709873754853508i, 0.17193638925446447 + -6.532318089225164e-18i, -0.006476162708183585 + 0.012470473965447149i, -0.0032739569727801 + 0.02082386298399988i, 0.03625814419888397 + 0.030387753411763963i, 0.006745630480493787 + -0.0880735421481207i }, { 0.005354415784771198 + 0.03381364280254437i, 0.034970259086614705 + -0.03250952218650819i, 0.0019173589745849489 + 0.014091907354785426i, -0.006476162708183579 + -0.012470473965447142i, 0.07274301939550637 + -4.472333961502706e-19i, -0.05515044345881803 + -0.08497661573585996i, 0.027425121524697095 + 0.0003684712586407312i, -0.021767638546698727 + 0.009979421360099673i }, { -0.043831740790143583 + -0.018652941937319468i, 0.01940322011050117 + 0.08788099479145933i, 0.003366466401465063 + -0.013965521079843465i, -0.003273956972780101 + -0.02082386298399988i, -0.05515044345881804 + 0.08497661573585996i, 0.19075819415357365 + -4.9873299934333204e-18i, -0.02183497496996433 + -0.011685726947879784i, -0.047622713203924236 + 0.0003735429860754607i }, { 0.0018770232174193844 + 0.011440333890106263i, -0.006625051315809684 + -0.006327375177350299i, 0.00469725563449159 + 0.03382363952810889i, 0.03625814419888398 + -0.030387753411763967i, 0.027425121524697095 + -0.000368471258640722i, -0.021834974969964317 + 0.011685726947879777i, 0.07256037717877914 + -1.3484764520288461e-18i, -0.054801557255315186 + -0.08438161271891621i }, { 0.0037021406164485407 + -0.00782979346535527i, -0.003314847921053304 + -0.023511933346525654i, -0.04260898938000554 + -0.02081290253531422i, 0.006745630480493793 + 0.0880735421481207i, -0.021767638546698734 + -0.009979421360099683i, -0.047622713203924236 + -0.0003735429860754684i, -0.054801557255315186 + 0.0843816127189162i, 0.1872403146420656 + -3.848917712323541e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.06619353954472404, 1.0e-7), DoubleNear(0.1723986247533913, 1.0e-7), DoubleNear(0.06616954107749462, 1.0e-7), DoubleNear(0.17193638925446447, 1.0e-7), DoubleNear(0.07274301939550637, 1.0e-7), DoubleNear(0.19075819415357365, 1.0e-7), DoubleNear(0.07256037717877914, 1.0e-7), DoubleNear(0.1872403146420656, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.06544268237882073 + 1.8973538018496328e-19i, -0.05723579149313429 + -0.07961231364897076i, 0.05649887362075987 + -0.0007772450152837055i, -0.040150009068137205 + -0.07337978317316587i, 0.004969726731765597 + -0.03344108616786415i, -0.045028235039294706 + 0.023201609969156857i, 0.0038933618818251504 + -0.028929841009716892i, -0.04054592704589863 + 0.01494410692428712i }, { -0.05723579149313429 + 0.07961231364897076i, 0.19244111180261989 + -8.307699146670178e-18i, -0.045356102133077295 + 0.058324628033908865i, 0.14697860119437833 + 0.021326912228994327i, 0.036335246529115704 + 0.03529315111439091i, 0.014614005765840758 + -0.09833704194426018i, 0.026359425009287216 + 0.027606062542995077i, 0.022059587725039485 + -0.07348621674345182i }, { 0.05649887362075988 + 0.0007772450152837037i, -0.045356102133077295 + -0.05832462803390887i, 0.06692039824339793 + -2.4801124695605914e-18i, -0.04292419016055421 + -0.07466334249878641i, 0.0046877033294812475 + -0.028811792812754936i, -0.03324812287514345 + 0.018747701225146386i, 0.0050819446874971926 + -0.03419619616278911i, -0.04141249513085442 + 0.01626423450347682i }, { -0.04015000906813719 + 0.07337978317316589i, 0.14697860119437833 + -0.021326912228994348i, -0.04292419016055421 + 0.07466334249878641i, 0.15189390220523585 + -2.7376104855258987e-18i, 0.03444793209540045 + 0.026089049544330653i, 0.0002635645909056365 + -0.07672535432026828i, 0.03489315675638298 + 0.027604124483881245i, 0.011534844825154194 + -0.07761749499531986i }, { 0.004969726731765595 + 0.03344108616786415i, 0.036335246529115704 + -0.03529315111439091i, 0.0046877033294812475 + 0.02881179281275493i, 0.034447932095400445 + -0.026089049544330657i, 0.07184060680572125 + 1.1384122811097797e-18i, -0.06283137919180447 + -0.08739551488189667i, 0.06202241743790038 + -0.0008532314310021967i, -0.044075225981929936 + -0.08055366862741187i }, { -0.045028235039294706 + -0.023201609969156864i, 0.014614005765840765 + 0.09833704194426018i, -0.03324812287514345 + -0.01874770122514638i, 0.00026356459090564124 + 0.0767253543202683i, -0.06283137919180448 + 0.08739551488189667i, 0.21125488356727393 + -7.94178091345632e-18i, -0.0497902864176769 + 0.06402666451566527i, 0.1613477857789869 + 0.023411911922472738i }, { 0.0038933618818251517 + 0.028929841009716895i, 0.026359425009287216 + -0.02760606254299508i, 0.005081944687497193 + 0.0341961961627891i, 0.03489315675638298 + -0.02760412448388125i, 0.06202241743790039 + 0.0008532314310021972i, -0.0497902864176769 + -0.06402666451566527i, 0.07346278976856425 + -2.9341221292888964e-18i, -0.04712062152232875 + -0.0819627135728795i }, { -0.04054592704589863 + -0.014944106924287118i, 0.0220595877250395 + 0.07348621674345182i, -0.041412495130854425 + -0.016264234503476825i, 0.011534844825154197 + 0.07761749499531986i, -0.044075225981929936 + 0.08055366862741188i, 0.1613477857789869 + -0.02341191192247276i, -0.04712062152232875 + 0.0819627135728795i, 0.16674362522836528 + -8.944667923005412e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.06544268237882073, 1.0e-7), DoubleNear(0.19244111180261989, 1.0e-7), DoubleNear(0.06692039824339793, 1.0e-7), DoubleNear(0.15189390220523585, 1.0e-7), DoubleNear(0.07184060680572125, 1.0e-7), DoubleNear(0.21125488356727393, 1.0e-7), DoubleNear(0.07346278976856425, 1.0e-7), DoubleNear(0.16674362522836528, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.12986114807458335 + -2.574980159653073e-18i, -0.007766048232136079 + 0.018691121118678735i, -0.0013611264781746935 + -0.005233805482916241i, -0.0011903688404519927 + 0.0022286000498660035i, -0.024267658348126636 + 0.007267275242764231i, 0.015466120959863387 + 0.024118944478688824i, 0.0013446955296978987 + 0.0029822579946225166i, 0.0015023627148934141 + 0.001130328995449318i }, { -0.007766048232136081 + -0.01869112111867873i, 0.15738905211277787 + -3.74049749507499e-18i, 0.00203722969984161 + 0.001814893067972299i, 0.00016652636034201047 + 0.0018237151458923742i, 0.012703605852433106 + -0.022681085615753115i, 0.03216281809459792 + 0.007667226031508484i, 0.002532357772668511 + 0.001027189462861546i, 0.0012300129030144533 + -0.0022311979795903826i }, { -0.0013611264781746928 + 0.005233805482916241i, 0.002037229699841609 + -0.0018148930679722983i, 0.12623794475136135 + 1.8973538018496328e-19i, -0.007661639363549398 + 0.0180243129348453i, -8.145494681299618e-05 + -0.003156085836782513i, -0.000993450418863574 + -0.0019361636581037966i, -0.023749493580170453 + 0.007123543614198676i, 0.014892759410302065 + 0.023394282574143853i }, { -0.0011903688404519919 + -0.0022286000498660035i, 0.00016652636034201123 + -0.0018237151458923733i, -0.007661639363549401 + -0.0180243129348453i, 0.15284399566889142 + -3.713392440762853e-18i, -0.0017106374274581501 + -0.0019340583946223654i, -0.002269638191226583 + 0.0014516490935937187i, 0.012248849704852814 + -0.021838016581506893i, 0.03125402474190154 + 0.007580712636391912i }, { -0.024267658348126636 + -0.007267275242764231i, 0.012703605852433103 + 0.022681085615753115i, -8.145494681299564e-05 + 0.0031560858367825134i, -0.0017106374274581486 + 0.0019340583946223654i, 0.10609473627468152 + -2.574980159653073e-18i, 0.012063847728018924 + 0.006272150900561493i, -0.0005789582012880165 + -0.002486347749414995i, -4.615923455323311e-05 + -0.0009885136182021207i }, { 0.015466120959863383 + -0.024118944478688828i, 0.03216281809459791 + -0.007667226031508484i, -0.000993450418863574 + 0.0019361636581037972i, -0.002269638191226583 + -0.0014516490935937184i, 0.012063847728018925 + -0.006272150900561492i, 0.1140914265238743 + -4.289374844895777e-18i, -0.0002685549507654178 + -0.0010776902070974666i, -0.0003770164093116859 + -0.000397004163708049i }, { 0.0013446955296978983 + -0.002982257994622518i, 0.0025323577726685115 + -0.0010271894628615475i, -0.023749493580170457 + -0.007123543614198674i, 0.012248849704852807 + 0.021838016581506893i, -0.0005789582012880164 + 0.0024863477494149943i, -0.0002685549507654174 + 0.0010776902070974658i, 0.10296329272905624 + -4.363913744254155e-18i, 0.011731972708927044 + 0.006060612144272219i }, { 0.0015023627148934141 + -0.0011303289954493183i, 0.0012300129030144535 + 0.0022311979795903826i, 0.014892759410302065 + -0.023394282574143856i, 0.03125402474190154 + -0.007580712636391915i, -4.6159234553233704e-05 + 0.0009885136182021202i, -0.00037701640931168566 + 0.000397004163708049i, 0.011731972708927044 + -0.006060612144272217i, 0.1105184038647731 + -2.9002408113987244e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12986114807458335, 1.0e-7), DoubleNear(0.15738905211277787, 1.0e-7), DoubleNear(0.12623794475136135, 1.0e-7), DoubleNear(0.15284399566889142, 1.0e-7), DoubleNear(0.10609473627468152, 1.0e-7), DoubleNear(0.1140914265238743, 1.0e-7), DoubleNear(0.10296329272905624, 1.0e-7), DoubleNear(0.1105184038647731, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.12022526698869779 + -2.439454888092385e-18i, 0.0022101440601258546 + 0.01271185609123095i, -0.0009198900589841094 + -0.0039997985523313705i, -0.0006563214222943822 + 0.0007984637459159656i, -0.023411111872728808 + -0.04892375155232235i, 0.0059285498556897066 + -0.002329139967810593i, -0.0017679309516698538 + 0.0018481211502220359i, 0.0003535122157653039 + 0.00023765792943350857i }, { 0.0022101440601258546 + -0.01271185609123095i, 0.13902508527190335 + -5.116079001415974e-18i, 0.001046769545697957 + 0.000405158672583689i, -5.889772921957093e-06 + 0.0006808514655880716i, -0.005363072452213749 + 0.0028927074231567956i, -0.02688232734934383 + -0.05888862785505257i, 0.00021603173073953184 + -0.00042753904635228735i, -0.00012001137752898832 + 0.0006299962535215111i }, { -0.0009198900589841091 + 0.0039997985523313705i, 0.0010467695456979566 + -0.00040515867258368913i, 0.11682594263070745 + -5.421010862427522e-20i, 0.002012718866588958 + 0.012293891540399428i, 0.0028016702404183485 + -0.0003743810456085352i, -0.0001728147066764697 + -0.0003459973340624101i, -0.02305844106538206 + -0.04773309422109187i, 0.005518064025504037 + -0.00228885835290954i }, { -0.0006563214222943818 + -0.000798463745915966i, -5.889772921956931e-06 + -0.000680851465588071i, 0.0020127188665889527 + -0.012293891540399424i, 0.1349584295838093 + -3.5101045334218206e-18i, -0.00026332473556045375 + 5.756469222712163e-05i, 0.0008401587612381188 + 0.00034844626978530177i, -0.005322900953423618 + 0.002703097452574575i, -0.026200989227984795 + -0.056989465855701034i }, { -0.023411111872728804 + 0.04892375155232235i, -0.005363072452213749 + -0.0028927074231567965i, 0.0028016702404183485 + 0.00037438104560853444i, -0.0002633247355604537 + -5.756469222712152e-05i, 0.1157306173605671 + -2.710505431213761e-18i, 0.002087655435756991 + 0.012251415928009279i, -0.0010201946204786007 + -0.0037203546799998654i, -0.0005802066527108437 + 0.000441622685747917i }, { 0.0059285498556897066 + 0.0023291399678105926i, -0.026882327349343822 + 0.05888862785505257i, -0.00017281470667646998 + 0.00034599733406240996i, 0.0008401587612381184 + -0.0003484462697853027i, 0.002087655435756989 + -0.012251415928009272i, 0.13245539336474882 + -2.913793338554793e-18i, 0.000721905203378235 + 0.0003320441882911433i, -0.00020460027604771828 + 0.0007458595165962536i }, { -0.001767930951669855 + -0.0018481211502220356i, 0.00021603173073953192 + 0.000427539046352287i, -0.023058441065382053 + 0.04773309422109187i, -0.005322900953423618 + -0.002703097452574573i, -0.0010201946204786002 + 0.0037203546799998654i, 0.0007219052033782353 + -0.00033204418829114335i, 0.11237529484971016 + -4.119968255444917e-18i, 0.0020576144787886894 + 0.01179103353871809i }, { 0.0003535122157653041 + -0.00023765792943350835i, -0.00012001137752898914 + -0.0006299962535215106i, 0.005518064025504038 + 0.0022888583529095383i, -0.02620098922798479 + 0.056989465855701034i, -0.0005802066527108435 + -0.00044162268574791756i, -0.00020460027604771798 + -0.0007458595165962534i, 0.0020576144787886903 + -0.011791033538718092i, 0.12840396994985523 + -3.1035287187397564e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.12022526698869779, 1.0e-7), DoubleNear(0.13902508527190335, 1.0e-7), DoubleNear(0.11682594263070745, 1.0e-7), DoubleNear(0.1349584295838093, 1.0e-7), DoubleNear(0.1157306173605671, 1.0e-7), DoubleNear(0.13245539336474882, 1.0e-7), DoubleNear(0.11237529484971016, 1.0e-7), DoubleNear(0.12840396994985523, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.15715744528781675 + -2.3310346708438345e-18i, 0.005031466584939267 + 0.012349743421042059i, -0.00220186277301133 + -0.0033551672830845485i, 0.00042330681491660374 + 0.0005903012095064619i, -0.01968291113597527 + 0.00871166262339626i, 0.003130100104165163 + -0.0022212307314185397i, 0.008576174944761943 + 0.02557963209979113i, -0.0013754217010639859 + 0.0013266591634660176i }, { 0.0050314665849392655 + -0.012349743421042052i, 0.16798382590288496 + -4.689174395999807e-18i, 0.0019181999942790536 + -0.00011934555752429843i, -0.003475431975493428 + 0.0017810292353372058i, 0.0021303881128360057 + -0.00831345784206163i, 9.767294438760895e-05 + 0.01993129847746486i, 0.001993632570235003 + -0.0001244386618456826i, 0.009275040193725468 + 0.026660166910081377i }, { -0.00220186277301133 + 0.003355167283084547i, 0.0019181999942790543 + 0.00011934555752429824i, 0.07640841199283138 + -1.328147661294743e-18i, -0.0006616607558187577 + 0.012316903529688727i, 0.004343666893110592 + -0.012550635999510444i, 0.002075038816999178 + 0.0007257279524936373i, -0.019617610389935834 + -0.00833323231124267i, 0.002011435342790811 + 0.008402207231382363i }, { 0.00042330681491660406 + -0.0005903012095064626i, -0.0034754319754934284 + -0.001781029235337206i, -0.000661660755818759 + -0.012316903529688727i, 0.10054369466366227 + -2.3310346708438345e-18i, -0.0021774373279416746 + -0.0006277156191461816i, 0.005664871519775334 + -0.016738352509988397i, 0.0032000641813731802 + 0.002104455699384349i, 0.0006064065048424494 + -0.019470216798462888i }, { -0.019682911135975263 + -0.008711662623396257i, 0.002130388112836007 + 0.008313457842061629i, 0.004343666893110594 + 0.012550635999510444i, -0.002177437327941674 + 0.0006277156191461825i, 0.07879843906144812 + -2.8189256484623115e-18i, -0.000733667089056422 + 0.012613528598198172i, 0.00026177809354861964 + -0.0043649859492466865i, -0.0016598348899218296 + 0.0006497852221574208i }, { 0.0031301001041651624 + 0.0022212307314185384i, 9.767294438761415e-05 + -0.01993129847746485i, 0.0020750388169991788 + -0.0007257279524936378i, 0.005664871519775334 + 0.01673835250998839i, -0.0007336670890564226 + -0.01261352859819817i, 0.10349665273376721 + -3.3406979439709605e-18i, -0.00014952524520286172 + 0.0008565484183991308i, 0.003264941926523753 + -0.0003543182531528809i }, { 0.008576174944761941 + -0.025579632099791135i, 0.0019936325702350015 + 0.00012443866184568366i, -0.019617610389935834 + 0.008333232311242673i, 0.0032000641813731794 + -0.0021044556993843498i, 0.0002617780935486206 + 0.004364985949246688i, -0.0001495252452028627 + -0.0008565484183991306i, 0.15279282548758621 + -2.846030702774449e-18i, 0.004731994101196405 + 0.011768021549428792i }, { -0.0013754217010639848 + -0.0013266591634660163i, 0.009275040193725466 + -0.026660166910081377i, 0.002011435342790809 + -0.008402207231382363i, 0.0006064065048424459 + 0.01947021679846289i, -0.0016598348899218294 + -0.000649785222157421i, 0.003264941926523754 + 0.00035431825315288185i, 0.004731994101196402 + -0.011768021549428787i, 0.16281870487000227 + -4.2825985813177425e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.15715744528781675, 1.0e-7), DoubleNear(0.16798382590288496, 1.0e-7), DoubleNear(0.07640841199283138, 1.0e-7), DoubleNear(0.10054369466366227, 1.0e-7), DoubleNear(0.07879843906144812, 1.0e-7), DoubleNear(0.10349665273376721, 1.0e-7), DoubleNear(0.15279282548758621, 1.0e-7), DoubleNear(0.16281870487000227, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.1287723817585144 + -3.144186300207963e-18i, 0.0009800259210198947 + 0.013114642407518171i, -0.001455532229578441 + -0.005180140455611432i, -0.0003375110023434375 + 0.0008248378921172604i, 0.10122008387199213 + 0.010371167472663664i, 0.004015826150301913 + 0.011520434980975415i, 0.0019033306174337135 + -0.004785438608694346i, 8.570576994498667e-05 + 0.00024005197368197163i }, { 0.0009800259210198939 + -0.013114642407518168i, 0.1457401788465122 + -3.957337929572091e-18i, 0.0007463415780507134 + 0.0007173511221039033i, -0.0011127319960738723 + -0.0023356284100642796i, 0.00010894183633911535 + -0.011759712640024185i, 0.11537794941756274 + 0.011503575701185785i, 0.0013468606065490784 + 2.0218181053580076e-06i, 0.0017747415083717035 + 0.0005285534906738192i }, { -0.0014555322295784399 + 0.005180140455611433i, 0.0007463415780507124 + -0.0007173511221039031i, 0.12515421071941674 + -3.3881317890172014e-18i, 0.0008201866653654685 + 0.012640145570366653i, -0.0037749150187846394 + 0.0029352026857959457i, 0.00014875475891972282 + -0.0004372305934318808i, 0.09833440006409111 + 0.010078603587209514i, 0.00397947515960371 + 0.01112706675594253i }, { -0.0003375110023434367 + -0.0008248378921172611i, -0.0011127319960738719 + 0.0023356284100642805i, 0.0008201866653654659 + -0.012640145570366653i, 0.14131251322999244 + -4.431676380034499e-18i, -0.0011640877170171076 + -0.0005950481352625933i, -0.0017390927655522124 + -0.0018194053812087582i, -7.126669488551497e-05 + -0.011331794705487966i, 0.11191524467837946 + 0.011155000944122202i }, { 0.10122008387199213 + -0.010371167472663676i, 0.00010894183633911297 + 0.01175971264002418i, -0.003774915018784639 + -0.0029352026857959444i, -0.0011640877170171076 + 0.0005950481352625935i, 0.10718350259075046 + -2.0057740190981832e-18i, 0.003317773574862951 + 0.011848629611722058i, -0.00048455244988426945 + -0.0025400127767198034i, -0.0008990170726617885 + 0.00041524853954662223i }, { 0.004015826150301913 + -0.011520434980975408i, 0.11537794941756276 + -0.011503575701185795i, 0.00014875475891972228 + 0.0004372305934318803i, -0.0017390927655522124 + 0.00181940538120876i, 0.0033177735748629493 + -0.011848629611722056i, 0.12574029979013995 + -4.072534410398676e-18i, 0.0010223331710254786 + 1.9851738770929045e-05i, 0.0009022419471041972 + 0.0037623393922486047i }, { 0.0019033306174337146 + 0.004785438608694346i, 0.001346860606549078 + -2.0218181053578043e-06i, 0.09833440006409111 + -0.010078603587209526i, -7.126669488551366e-05 + 0.011331794705487964i, -0.0004845524498842697 + 0.0025400127767198034i, 0.0010223331710254792 + -1.985173877092929e-05i, 0.10404702676100086 + -7.860465750519907e-19i, 0.0032501466800121783 + 0.011444779508750865i }, { 8.570576994498672e-05 + -0.00024005197368197077i, 0.001774741508371704 + -0.0005285534906738195i, 0.003979475159603712 + -0.011127066755942534i, 0.11191524467837946 + -0.01115500094412221i, -0.0008990170726617887 + -0.0004152485395466226i, 0.0009022419471041972 + -0.0037623393922486047i, 0.003250146680012177 + -0.011444779508750865i, 0.12204988630367207 + -2.1819568721270777e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1287723817585144, 1.0e-7), DoubleNear(0.1457401788465122, 1.0e-7), DoubleNear(0.12515421071941674, 1.0e-7), DoubleNear(0.14131251322999244, 1.0e-7), DoubleNear(0.10718350259075046, 1.0e-7), DoubleNear(0.12574029979013995, 1.0e-7), DoubleNear(0.10404702676100086, 1.0e-7), DoubleNear(0.12204988630367207, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.11122185376401368 + -1.870248747537495e-18i, 0.0020330284501244448 + 0.01177813403166223i, -0.0003349830399304902 + -0.004046792220314527i, -0.000738796468401639 + 0.0005043450026325964i, 0.019401614175056557 + -0.05646029607550101i, 0.00634141808367241 + 0.0010315662561584844i, 2.4971832382490234e-05 + 0.0009107904440416074i, 0.00012815192816653076 + -7.19654880250016e-05i }, { 0.0020330284501244404 + -0.011778134031662226i, 0.12799082461343875 + -3.496552006265752e-18i, 0.0008464947754779054 + 0.0005307232336185795i, -0.00029163979461018923 + 0.0007704292264146804i, -0.005619463392289472 + -0.003097467069795277i, 0.02234782047674897 + -0.0649758621372676i, -0.00014988032100857318 + -0.00017199517188712767i, 0.00024288317952745193 + 4.21737384334413e-06i }, { -0.0003349830399304893 + 0.004046792220314527i, 0.0008464947754779049 + -0.0005307232336185799i, 0.1105383412761622 + -3.5236570605778894e-18i, 0.0019430153428335946 + 0.011584218585568599i, 0.004109456554104227 + -0.00035375145309970134i, -0.0005996471745948421 + -0.0007660459737114504i, -0.0026164043987665043 + -0.056833205585960146i, 0.005956723831643406 + -0.0012549238296424847i }, { -0.0007387964684016386 + -0.0005043450026325966i, -0.00029163979461018896 + -0.0007704292264146797i, 0.0019430153428335933 + -0.011584218585568599i, 0.1269470749764598 + -4.445228907190568e-18i, -0.00044988833613000075 + 0.0008549648308599221i, -0.0008075519417994493 + 9.255967481545393e-05i, -0.006005129055055562 + -0.0007748522056597613i, -0.002932508242781283 + -0.06532245547150455i }, { 0.019401614175056557 + 0.056460296075501i, -0.005619463392289472 + 0.0030974670697952785i, 0.004109456554104226 + 0.0003537514530997012i, -0.00044988833613000085 + -0.0008549648308599221i, 0.1247340305852512 + -3.279711571768651e-18i, 0.002264771045758401 + 0.013185137987578002i, -0.0016051016395322202 + -0.003673361012016709i, -0.000497731606603587 + 0.0007357414290312862i }, { 0.006341418083672409 + -0.0010315662561584847i, 0.022347820476748975 + 0.0649758621372676i, -0.000599647174594843 + 0.0007660459737114507i, -0.0008075519417994491 + -9.255967481545409e-05i, 0.0022647710457584028 + -0.013185137987577998i, 0.1434896540232134 + -4.5333203337050154e-18i, 0.0009221799735982866 + 0.00020647962725625282i, 8.114974564051415e-05 + 0.0006562817557696447i }, { 2.4971832382490343e-05 + -0.000910790444041608i, -0.0001498803210085729 + 0.00017199517188712742i, -0.0026164043987665017 + 0.056833205585960146i, -0.006005129055055563 + 0.0007748522056597632i, -0.0016051016395322202 + 0.0036733610120167092i, 0.0009221799735982868 + -0.0002064796272562525i, 0.11866289620425541 + -6.505213034913027e-19i, 0.002127318002544052 + 0.012500706493548919i }, { 0.0001281519281665309 + 7.196548802500168e-05i, 0.0002428831795274516 + -4.2173738433451055e-06i, 0.005956723831643404 + 0.0012549238296424843i, -0.00293250824278128 + 0.06532245547150455i, -0.0004977316066035868 + -0.0007357414290312871i, 8.114974564051426e-05 + -0.0006562817557696442i, 0.0021273180025440496 + -0.012500706493548919i, 0.13641532455720473 + -2.168404344971009e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.11122185376401368, 1.0e-7), DoubleNear(0.12799082461343875, 1.0e-7), DoubleNear(0.1105383412761622, 1.0e-7), DoubleNear(0.1269470749764598, 1.0e-7), DoubleNear(0.1247340305852512, 1.0e-7), DoubleNear(0.1434896540232134, 1.0e-7), DoubleNear(0.11866289620425541, 1.0e-7), DoubleNear(0.13641532455720473, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.13049827342266 + 1.3552527156068805e-19i, -0.007824180938271079 + 0.018674642100137934i, -0.02437304971320327 + 0.007411653693730997i, 0.015559873672803199 + 0.02390035315844713i, -0.027092543578555114 + -0.05586511689039708i, 0.012732707581390505 + -0.0021030940305982048i, 0.006041671975875577 + 0.008416361175264545i, 0.009562015292951158 + -0.014108173177220164i }, { -0.007824180938271084 + -0.01867464210013793i, 0.15961366320007003 + -4.614635496641428e-18i, 0.013101137220555656 + -0.02294362504633374i, 0.032139758856585876 + 0.007821738987118737i, -0.00924711697017247 + 0.008429913630283364i, -0.029288997110731865 + -0.06603589549086823i, -0.007996670019559237 + 0.0014498178403724834i, -0.0043971580510779795 + -0.01751756368221114i }, { -0.024373049713203275 + -0.007411653693730995i, 0.013101137220555652 + 0.022943625046333745i, 0.10655293619674525 + -2.6291902682773483e-18i, 0.012047043864985892 + 0.006331105531492444i, 0.003329119568045994 + 0.009542283187977136i, 0.008081017113608 + -0.0048429124076554845i, -0.019377009359555754 + -0.040791728883017145i, -0.0012860937001967603 + -0.0025149042901219283i }, { 0.015559873672803195 + -0.02390035315844713i, 0.032139758856585876 + -0.00782173898711874i, 0.01204704386498589 + -0.006331105531492441i, 0.11436985165564259 + -4.0115480381963664e-18i, -0.016089420301070738 + -0.0006701617671524643i, -0.011473388397750042 + -0.013893611052132826i, -0.0014388564354648956 + -0.0028341087545519935i, -0.023794319466596756 + -0.04984219821988538i }, { -0.02709254357855511 + 0.055865116890397075i, -0.009247116970172472 + -0.008429913630283361i, 0.0033291195680459932 + -0.009542283187977136i, -0.016089420301070734 + 0.0006701617671524667i, 0.1256008194032847 + -2.520770051028798e-18i, -0.007603506657414396 + 0.018040791953386103i, -0.02364410221509382 + 0.006979165163231911i, 0.014799006697362253 + 0.023612873894385548i }, { 0.012732707581390505 + 0.0021030940305982026i, -0.029288997110731862 + 0.06603589549086823i, 0.008081017113608 + 0.004842912407655484i, -0.011473388397750042 + 0.013893611052132826i, -0.007603506657414398 + -0.0180407919533861i, 0.15061938458159924 + -2.8392544391964147e-18i, 0.011851318336730265 + -0.021575477150926267i, 0.03127708397991358 + 0.00742619968078166i }, { 0.006041671975875575 + -0.008416361175264543i, -0.007996670019559237 + -0.0014498178403724853i, -0.01937700935955575 + 0.04079172888301715i, -0.0014388564354648953 + 0.002834108754551992i, -0.023644102215093818 + -0.006979165163231911i, 0.011851318336730261 + 0.021575477150926267i, 0.10250509280699252 + -4.30970363562988e-18i, 0.011748776571960075 + 0.0060016575133412685i }, { 0.00956201529295116 + 0.014108173177220164i, -0.004397158051077979 + 0.01751756368221114i, -0.0012860937001967598 + 0.0025149042901219283i, -0.02379431946659675 + 0.04984219821988537i, 0.014799006697362251 + -0.02361287389438555i, 0.03127708397991358 + -0.00742619968078166i, 0.011748776571960079 + -0.006001657513341268i, 0.11023997873300481 + -3.178067618098135e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.13049827342266, 1.0e-7), DoubleNear(0.15961366320007003, 1.0e-7), DoubleNear(0.10655293619674525, 1.0e-7), DoubleNear(0.11436985165564259, 1.0e-7), DoubleNear(0.1256008194032847, 1.0e-7), DoubleNear(0.15061938458159924, 1.0e-7), DoubleNear(0.10250509280699252, 1.0e-7), DoubleNear(0.11023997873300481, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.12839211655822863 + -1.5178830414797062e-18i, -0.007700648806594556 + 0.0183254025308104i, -0.024092635722782595 + 0.0073184077686955186i, 0.015236598800108081 + 0.023683933358777817i, -0.02717206903725209 + 0.00024848317257807046i, 0.00918829836606462 + 0.005941018356919778i, 0.014083619137882811 + -0.002530112449622181i, 0.006140768873354541 + -0.007301694971623066i }, { -0.007700648806594558 + -0.018325402530810393i, 0.15582204763304472 + -4.038653092508504e-18i, 0.012786153582972642 + -0.022529473593187892i, 0.03167770919971993 + 0.007563446111566299i, 0.009444549651625271 + -0.005909023067501075i, 0.005920759685526046 + 8.3157946295243e-05i, 0.008023467671125916 + -0.00995224966111384i, -0.010017690981925696 + -0.00819503709211838i }, { -0.024092635722782595 + -0.007318407768695519i, 0.01278615358297264 + 0.022529473593187896i, 0.10517374072241951 + -2.1412992906588713e-18i, 0.012070454635715065 + 0.006341244419920384i, 0.013944777564436864 + 0.0026025321040894535i, 0.007945106298481053 + 0.009809990890057477i, -0.012128452488659014 + 0.00012994713957552046i, -0.004046762919108648 + 0.0002399581430440449i }, { 0.01523659880010808 + -0.023683933358777817i, 0.03167770919971993 + -0.007563446111566301i, 0.012070454635715065 + -0.006341244419920384i, 0.1127054729335025 + -2.9815559743351372e-18i, 0.0064531718082546045 + 0.007462589790782091i, -0.010045759831727345 + 0.008468733488303789i, -0.004114097357416086 + -0.00029997907517620545i, -0.0052166802362959876 + 0.00037792373270672424i }, { -0.027172069037252087 + -0.00024848317257806504i, 0.009444549651625271 + 0.0059090230675010735i, 0.013944777564436864 + -0.002602532104089452i, 0.0064531718082546045 + -0.007462589790782091i, 0.1277069762677161 + -8.673617379884035e-19i, -0.0077270387890909205 + 0.018390031522713637i, -0.023924516205514494 + 0.007072411088267389i, 0.01512228157005737 + 0.023829293694054864i }, { 0.009188298366064619 + -0.0059410183569197795i, 0.005920759685526047 + -8.315794629524007e-05i, 0.007945106298481053 + -0.009809990890057477i, -0.010045759831727346 + -0.00846873348830379i, -0.007727038789090924 + -0.018390031522713634i, 0.15441100014862455 + -3.415236843329339e-18i, 0.012166301974313275 + -0.021989628604072116i, 0.03173913363677952 + 0.007684492556334096i }, { 0.014083619137882815 + 0.0025301124496221825i, 0.008023467671125918 + 0.00995224966111384i, -0.012128452488659014 + -0.00012994713957551775i, -0.004114097357416087 + 0.00029997907517620567i, -0.023924516205514498 + -0.007072411088267386i, 0.012166301974313272 + 0.021989628604072116i, 0.10388428828131827 + -4.797594613248357e-18i, 0.011725365801230903 + 0.005991518624913327i }, { 0.006140768873354541 + 0.007301694971623066i, -0.010017690981925695 + 0.008195037092118378i, -0.0040467629191086475 + -0.00023995814304404468i, -0.0052166802362959876 + -0.0003779237327067198i, 0.015122281570057369 + -0.023829293694054864i, 0.031739133636779514 + -0.007684492556334098i, 0.011725365801230903 + -0.0059915186249133254i, 0.11190435745514489 + -4.208059681959364e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.12839211655822863, 1.0e-7), DoubleNear(0.15582204763304472, 1.0e-7), DoubleNear(0.10517374072241951, 1.0e-7), DoubleNear(0.1127054729335025, 1.0e-7), DoubleNear(0.1277069762677161, 1.0e-7), DoubleNear(0.15441100014862455, 1.0e-7), DoubleNear(0.10388428828131827, 1.0e-7), DoubleNear(0.11190435745514489, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.1438227635011161 + -1.463672932855431e-18i, -0.00865323888649245 + 0.020305852068071138i, -0.02878512952167584 + 0.013223614792167127i, 0.01584758182470763 + 0.02855612306535529i, 0.11022123591448615 + 0.012068724014881835i, -0.003781285959700195 + 0.012676294538813327i, -0.023724375795913633 + -0.004885315565836732i, 0.0132353241587818 + 0.01762704377879544i }, { -0.008653238886492453 + -0.02030585206807113i, 0.1702689335689035 + -4.269046054161674e-18i, 0.008002287851309065 + -0.015706930686962415i, 0.031525276244933495 + 0.011979590971458523i, -0.008086086623848745 + -0.018430740986755855i, 0.13125237222550135 + 0.021895591267576772i, 0.012625275283970545 + -0.020298417863656815i, 0.02276511365985697 + 0.012060683547202208i }, { -0.028785129521675848 + -0.013223614792167127i, 0.008002287851309062 + 0.01570693068696242i, 0.11010382897681506 + -5.068645156369733e-18i, 0.010453451472877812 + 0.005448935909813687i, -0.017409279094586443 + -0.01254868751900962i, 0.014312916470360702 + 0.024043566891680357i, 0.08933324802159709 + 0.008381047044991343i, 0.011776587269605818 + 0.00997120719810462i }, { 0.015847581824707628 + -0.028556123065355293i, 0.031525276244933495 + -0.011979590971458525i, 0.010453451472877812 + -0.005448935909813686i, 0.11678375850760113 + -4.119968255444917e-18i, 0.01830311930040949 + -0.02422798183047986i, 0.031054792922381898 + -0.0028498034558251248i, 0.008123761765302343 + -0.004660766358756296i, 0.09604082187044087 + 0.0007629853777312155i }, { 0.11022123591448617 + -0.01206872401488185i, -0.008086086623848745 + 0.018430740986755855i, -0.01740927909458645 + 0.012548687519009618i, 0.018303119300409492 + 0.02422798183047986i, 0.11227632932482862 + -9.215718466126788e-19i, -0.006774448709193026 + 0.0164095819854529i, -0.019232022406621252 + 0.0011672040647957797i, 0.01451129854545782 + 0.018957103987477388i }, { -0.0037812859597001858 + -0.012676294538813325i, 0.13125237222550135 + -0.021895591267576783i, 0.014312916470360702 + -0.024043566891680357i, 0.031054792922381898 + 0.0028498034558251213i, -0.00677444870919303 + -0.016409581985452896i, 0.13996411421276578 + -3.1848438816761693e-18i, 0.016950167705976852 + -0.028812171510297593i, 0.03189156659156596 + 0.0032683476964418725i }, { -0.023724375795913633 + 0.0048853155658367346i, 0.012625275283970547 + 0.020298417863656815i, 0.08933324802159709 + -0.008381047044991348i, 0.008123761765302343 + 0.004660766358756289i, -0.019232022406621245 + -0.0011672040647957792i, 0.016950167705976852 + 0.028812171510297593i, 0.0989542000269227 + -1.870248747537495e-18i, 0.013342368964068155 + 0.006883827135020024i }, { 0.013235324158781798 + -0.017627043778795447i, 0.022765113659856968 + -0.012060683547202213i, 0.011776587269605811 + -0.009971207198104615i, 0.09604082187044086 + -0.0007629853777312237i, 0.014511298545457817 + -0.018957103987477388i, 0.03189156659156596 + -0.0032683476964418742i, 0.013342368964068155 + -0.0068838271350200216i, 0.10782607188104626 + -3.0696474008495844e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1438227635011161, 1.0e-7), DoubleNear(0.1702689335689035, 1.0e-7), DoubleNear(0.11010382897681506, 1.0e-7), DoubleNear(0.11678375850760113, 1.0e-7), DoubleNear(0.11227632932482862, 1.0e-7), DoubleNear(0.13996411421276578, 1.0e-7), DoubleNear(0.0989542000269227, 1.0e-7), DoubleNear(0.10782607188104626, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.12210543649626376 + -1.8431436932253575e-18i, -0.007370165416471606 + 0.01748690436360302i, -0.02291447364380091 + 0.006868967755053178i, 0.01445660913017233 + 0.022647186710552873i, 0.009209912443651854 + -0.06236664556006109i, 0.008437225942504317 + 0.005115402236100813i, 0.0018251945797434178 + 0.012176502984416039i, 0.012714521081885862 + -0.0056804075595802105i }, { -0.00737016541647161 + -0.017486904363603017i, 0.14789622454551787 + -3.279711571768651e-18i, 0.011884208112313128 + -0.021199283783933025i, 0.030235037733366825 + 0.007286404824730069i, -0.009472040253791413 + 0.0023778212572336563i, 0.011207943030533813 + -0.07556392022347583i, -0.00993027984071074 + -0.0077569370360169735i, 0.005985857459440573 + -0.014938777275041053i }, { -0.022914473643800906 + -0.006868967755053176i, 0.011884208112313124 + 0.02119928378393303i, 0.09965475854391213 + -3.550762114890027e-18i, 0.011346209209429645 + 0.005875448253627808i, -0.005172906203734036 + 0.011180786584433541i, 0.011791827337703465 + -0.004414805221357622i, 0.0075752973326382 + -0.050926856101400055i, 0.0038609159728115 + -0.005338759809584813i }, { 0.014456609130172327 + -0.022647186710552873i, 0.030235037733366825 + -0.0072864048247300705i, 0.011346209209429645 + -0.005875448253627806i, 0.10704167504438067 + -4.662069341687669e-18i, -0.010436443241860717 + -0.009132249731952487i, -0.0014170083554443497 + -0.015950575039638478i, -0.0021525521935536218 + -0.006250140532688695i, 0.008207369203433878 + -0.05473439738529631i }, { 0.009209912443651852 + 0.06236664556006109i, -0.009472040253791413 + -0.002377821257233654i, -0.005172906203734036 + -0.011180786584433541i, -0.010436443241860719 + 0.009132249731952487i, 0.13399365632968097 + -5.421010862427522e-19i, -0.008057522179213869 + 0.019228529689921017i, -0.025102678284496183 + 0.0075218511019097285i, 0.01590227123999312 + 0.024866040342279804i }, { 0.008437225942504314 + -0.005115402236100815i, 0.011207943030533815 + 0.07556392022347583i, 0.011791827337703464 + 0.004414805221357622i, -0.0014170083554443493 + 0.015950575039638475i, -0.008057522179213872 + -0.01922852968992101i, 0.1623368232361514 + -4.174178364069192e-18i, 0.013068247444972791 + -0.02331981841332698i, 0.03318180510313263 + 0.007961533843170329i }, { 0.001825194579743417 + -0.01217650298441604i, -0.009930279840710743 + 0.007756937036016971i, 0.0075752973326382 + 0.05092685610140006i, -0.002152552193553623 + 0.006250140532688695i, -0.025102678284496183 + -0.007521851101909729i, 0.01306824744497279 + 0.023319818413326983i, 0.10940327045982563 + -3.3881317890172014e-18i, 0.012449611227516321 + 0.006457314791205903i }, { 0.012714521081885862 + 0.005680407559580208i, 0.005985857459440575 + 0.01493877727504105i, 0.003860915972811499 + 0.005338759809584814i, 0.008207369203433882 + 0.05473439738529631i, 0.015902271239993118 + -0.024866040342279808i, 0.03318180510313262 + -0.007961533843170329i, 0.012449611227516325 + -0.006457314791205902i, 0.1175681553442667 + -2.5275463146068322e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.12210543649626376, 1.0e-7), DoubleNear(0.14789622454551787, 1.0e-7), DoubleNear(0.09965475854391213, 1.0e-7), DoubleNear(0.10704167504438067, 1.0e-7), DoubleNear(0.13399365632968097, 1.0e-7), DoubleNear(0.1623368232361514, 1.0e-7), DoubleNear(0.10940327045982563, 1.0e-7), DoubleNear(0.1175681553442667, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.11943006932547322 + -1.7889335846010823e-18i, 0.002213505025910492 + 0.012636654372848912i, -0.02234541009912393 + -0.04794529411740604i, 0.005747237600221736 + -0.002180307418168218i, -0.01989433732936085 + -0.00016847385897036593i, 0.003243129355660559 + 0.003839903363022406i, 0.006856430116835207 + 0.011383079453075257i, 0.0014372321619258966 + -0.0011756018307645649i }, { 0.0022135050259104914 + -0.012636654372848912i, 0.13814294996415316 + -4.926343621231011e-18i, -0.005303614319159318 + 0.002695985212136782i, -0.025464685502357157 + -0.05781285954013919i, 0.0033379116832789727 + -0.003843988092997524i, 0.0010024588510275717 + 2.616846966946887e-05i, -0.00109529596932079 + -0.002023379719421774i, 0.0033222266796085406 + 0.003942446229336073i }, { -0.022345410099123927 + 0.04794529411740604i, -0.005303614319159319 + -0.0026959852121367827i, 0.11413578795517493 + -1.870248747537495e-18i, 0.0021563008032100188 + 0.01202999257788187i, 0.006705264100138242 + -0.012585566652556071i, -0.000996458038102211 + 0.0017342027347415983i, -0.01940618419655025 + 0.0005469041711239569i, 0.0018984060912954144 + 0.002341073136941417i }, { 0.005747237600221734 + 0.0021803074181682173i, -0.02546468550235715 + 0.05781285954013919i, 0.0021563008032100157 + -0.012029992577881867i, 0.13038457060239406 + -2.0938654456126304e-18i, 0.0012632370673782787 + 0.0014767564588330615i, 0.0020650865728001778 + -0.005226390212592497i, 0.0019925406109302136 + -0.0023650140496797563i, -0.0002983794017975133 + 0.00043491320933249837i }, { -0.01989433732936085 + 0.000168473858970371i, 0.003337911683278973 + 0.003843988092997524i, 0.006705264100138244 + 0.01258556665255607i, 0.001263237067378279 + -0.0014767564588330606i, 0.117621140293932 + -7.047314121155779e-19i, 0.002009357900804321 + 0.012369093258781464i, -0.024124142838986937 + -0.048711551656008184i, 0.005699376280972009 + -0.002437690902551915i }, { 0.0032431293556605574 + -0.0038399033630224064i, 0.0010024588510275725 + -2.6168469669465833e-05i, -0.0009964580381022117 + -0.001734202734741598i, 0.0020650865728001786 + 0.005226390212592495i, 0.0020093579008043164 + -0.01236909325878146i, 0.13584056489155946 + -3.699839913606784e-18i, -0.0053823590864780484 + 0.002899819663594588i, -0.027618631074971468 + -0.05806523417061441i }, { 0.006856430116835203 + -0.011383079453075255i, -0.0010952959693207893 + 0.0020233797194217744i, -0.01940618419655025 + -0.0005469041711239537i, 0.0019925406109302128 + 0.0023650140496797555i, -0.024124142838986933 + 0.04871155165600818i, -0.0053823590864780484 + -0.002899819663594588i, 0.11397012425510233 + -4.960224939121183e-18i, 0.0019889691113356618 + 0.012012456888845498i }, { 0.0014372321619258977 + 0.0011756018307645644i, 0.0033222266796085376 + -0.003942446229336073i, 0.0018984060912954131 + -0.002341073136941418i, -0.0002983794017975133 + -0.00043491320933249404i, 0.00569937628097201 + 0.0024376909025519136i, -0.02761863107497146 + 0.05806523417061441i, 0.001988969111335663 + -0.012012456888845498i, 0.13047479271220996 + -3.923456611681919e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.11943006932547322, 1.0e-7), DoubleNear(0.13814294996415316, 1.0e-7), DoubleNear(0.11413578795517493, 1.0e-7), DoubleNear(0.13038457060239406, 1.0e-7), DoubleNear(0.117621140293932, 1.0e-7), DoubleNear(0.13584056489155946, 1.0e-7), DoubleNear(0.11397012425510233, 1.0e-7), DoubleNear(0.13047479271220996, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.12873755032185444 + -2.3310346708438345e-18i, 0.0006799091700756899 + 0.013068472579100985i, -0.02641539287457057 + -0.052516291431824444i, 0.006224266133273904 + -0.0016689943819174211i, 0.10172342459947942 + 0.00983978051544394i, 0.004170877502859808 + 0.011299296607126832i, -0.01624613347932209 + -0.04378715688908835i, 0.004316429196876972 + -0.0033285038954667086i }, { 0.0006799091700756886 + -0.013068472579100984i, 0.1476371954548221 + -5.346471963069144e-18i, -0.005469324424190863 + 0.003895537259475248i, -0.028012179378979367 + -0.06330963164978567i, -5.885473884901919e-05 + -0.012070159335808673i, 0.11648443786601159 + 0.012232197123919115i, -0.004832714125170289 + 0.0029470484309149564i, -0.017009130864521105 + -0.050196834140133595i }, { -0.026415392874570568 + 0.052516291431824444i, -0.005469324424190862 + -0.003895537259475248i, 0.12518904215607674 + -4.20128341838133e-18i, 0.0011203034163096738 + 0.01268631539878384i, -0.023269064864354927 + 0.038559417533136436i, -0.004936473710703304 + -0.0017257938410805674i, 0.09783105933660381 + 0.010609990544429238i, 0.0038244238070458156 + 0.011348205129791114i }, { 0.006224266133273905 + 0.001668994381917421i, -0.02801217937897936 + 0.06330963164978567i, 0.0011203034163096712 + -0.012686315398783836i, 0.13941549662168254 + -3.042542346537447e-18i, 0.006021610646515274 + 0.001080302011101022i, -0.02746358524056744 + 0.04741147193930173i, 9.652988030261892e-05 + -0.011021348009703478i, 0.11080875622993061 + 0.010426379521388873i }, { 0.10172342459947945 + -0.00983978051544395i, -5.885473884901897e-05 + 0.012070159335808668i, -0.023269064864354934 + -0.038559417533136436i, 0.006021610646515272 + -0.001080302011101022i, 0.1083136592975508 + -1.6263032587282567e-19i, 0.0035429537566391226 + 0.011937275052529391i, -0.020054160063540296 + -0.04414055434158978i, 0.005222347747919839 + -0.002949003938802712i }, { 0.00417087750285981 + -0.011299296607126832i, 0.11648443786601159 + -0.012232197123919125i, -0.004936473710703305 + 0.001725793841080567i, -0.027463585240567447 + -0.04741147193930173i, 0.003542953756639119 + -0.01193727505252939i, 0.12634631940089053 + -3.279711571768651e-18i, -0.005216648981446503 + 0.0017002676162561222i, -0.025071137198349254 + -0.05256846206096792i }, { -0.016246133479322085 + 0.043787156889088366i, -0.004832714125170289 + -0.0029470484309149555i, 0.09783105933660383 + -0.01060999054442925i, 9.652988030261806e-05 + 0.011021348009703476i, -0.020054160063540293 + 0.04414055434158978i, -0.005216648981446504 + -0.0017002676162561222i, 0.10291687005420053 + -2.6291902682773483e-18i, 0.0030249664982360067 + 0.01135613406794353i }, { 0.0043164291968769706 + 0.0033285038954667073i, -0.017009130864521105 + 0.050196834140133595i, 0.0038244238070458156 + -0.011348205129791112i, 0.11080875622993061 + -0.01042637952138888i, 0.005222347747919839 + 0.00294900393880271i, -0.02507113719834925 + 0.05256846206096792i, 0.0030249664982360076 + -0.01135613406794353i, 0.1214438666929215 + -2.9747797107571028e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.12873755032185444, 1.0e-7), DoubleNear(0.1476371954548221, 1.0e-7), DoubleNear(0.12518904215607674, 1.0e-7), DoubleNear(0.13941549662168254, 1.0e-7), DoubleNear(0.1083136592975508, 1.0e-7), DoubleNear(0.12634631940089053, 1.0e-7), DoubleNear(0.10291687005420053, 1.0e-7), DoubleNear(0.1214438666929215, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.11303998693977693 + -2.4123498337802474e-18i, 0.0020093709447270916 + 0.01191248667523363i, -0.022158314912445867 + -0.04610631438591691i, 0.00544569953457443 + -0.0022134861003980733i, 0.00856567869703775 + -0.057705359795124575i, 0.006303498240142379 + -0.00010462741577519329i, -0.02512219410731248 + 0.007851812805349205i, -0.0006480228814426086 + -0.002976765205645936i }, { 0.0020093709447270864 + -0.011912486675233626i, 0.13061518429257302 + -4.6349642873755315e-18i, -0.005090506670232761 + 0.002652159836957657i, -0.02531707502192356 + -0.055235342114291604i, -0.005891521782906318 + -0.001940008694174271i, 0.009901706078663912 + -0.06672315917663216i, 0.001009239797616577 + 0.002816116143786768i, -0.03013769603168334 + 0.008663453019314083i }, { -0.02215831491244586 + 0.046106314385916905i, -0.0050905066702327615 + -0.0026521598369576575i, 0.10872020810039898 + -2.9815559743351372e-18i, 0.0019666728482309486 + 0.011449865941997199i, 0.021983758460086877 + 0.014843845607096288i, -0.0017093500091703436 + 0.0024306229593452694i, 0.0082195310792523 + -0.055588141866336566i, 0.005994643675173436 + -0.00011873015770880684i }, { 0.005445699534574431 + 0.0022134861003980716i, -0.025317075021923555 + 0.055235342114291604i, 0.0019666728482309478 + -0.011449865941997199i, 0.12432271529732551 + -3.3068166260807885e-18i, 0.0016032376010147531 + -0.0025680419055328606i, 0.026300965082113322 + 0.017206394322558854i, -0.005733070664438715 + -0.0019323105812807675i, 0.009513606155303778 + -0.06357515843213998i }, { 0.008565678697037754 + 0.05770535979512459i, -0.00589152178290632 + 0.0019400086941742736i, 0.021983758460086877 + -0.014843845607096288i, 0.0016032376010147527 + 0.0025680419055328614i, 0.1240112226796283 + -8.131516293641283e-20i, 0.0022134919819877213 + 0.013093260956396749i, -0.024311238025665 + -0.050550531387497315i, 0.006000914346619314 + -0.0024045122203220602i }, { 0.006303498240142379 + 0.00010462741577519264i, 0.009901706078663919 + 0.06672315917663216i, -0.0017093500091703434 + -0.0024306229593452685i, 0.026300965082113322 + -0.017206394322558858i, 0.0022134919819877213 + -0.013093260956396747i, 0.14336833056313958 + -3.991219247462263e-18i, -0.005595466735404606 + 0.002943645038773713i, -0.027766241555405066 + -0.060642751596462i }, { -0.02512219410731248 + -0.007851812805349205i, 0.0010092397976165773 + -0.0028161161437867677i, 0.0082195310792523 + 0.055588141866336566i, -0.005733070664438716 + 0.001932310581280768i, -0.024311238025664997 + 0.050550531387497315i, -0.005595466735404606 + -0.0029436450387737125i, 0.11938570410987828 + -3.848917712323541e-18i, 0.002178597066314732 + 0.012592583524730172i }, { -0.0006480228814426085 + 0.0029767652056459353i, -0.03013769603168334 + -0.008663453019314081i, 0.005994643675173434 + 0.00011873015770880684i, 0.009513606155303778 + 0.06357515843213998i, 0.0060009143466193135 + 0.0024045122203220594i, -0.02776624155540506 + 0.060642751596462i, 0.002178597066314731 + -0.012592583524730167i, 0.13653664801727852 + -2.710505431213761e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.11303998693977693, 1.0e-7), DoubleNear(0.13061518429257302, 1.0e-7), DoubleNear(0.10872020810039898, 1.0e-7), DoubleNear(0.12432271529732551, 1.0e-7), DoubleNear(0.1240112226796283, 1.0e-7), DoubleNear(0.14336833056313958, 1.0e-7), DoubleNear(0.11938570410987828, 1.0e-7), DoubleNear(0.13653664801727852, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.12769484274815715 + -2.9544509200229996e-18i, 0.0010051344521337475 + 0.012979530991793478i, -0.02814248231642657 + 0.0005627773978752551i, 0.003962411746280941 + 0.0018532830169601783i, 0.10021252393870936 + 0.010546974057944546i, 0.0040654702796918294 + 0.011372775677585227i, -0.019589853077170986 + -0.016730802876224943i, 0.002108849134983693 + -0.0011289398195105924i }, { 0.0010051344521337456 + -0.012979530991793473i, 0.14444954071170857 + -3.645629804982509e-18i, 0.004133557901139593 + -0.001763671976866138i, -0.017950248204617606 + 0.0006330563753764841i, 0.0001593655655471772 + -0.011608342517639873i, 0.11410486855062257 + 0.011646843177663804i, 0.0018253485476818375 + -0.00613093619788429i, 0.002298652792855175 + -0.011097461416611231i }, { -0.02814248231642657 + -0.0005627773978752459i, 0.004133557901139592 + 0.001763671976866138i, 0.12623174972977402 + -3.577867169202165e-18i, 0.0007950781342516162 + 0.012775256986091348i, -0.018922178896402454 + -0.01705405025847394i, 0.0020796209941936605 + -0.0010054839797850872i, 0.09934195999737389 + 0.009902797001928632i, 0.003929831030213795 + 0.011274726059332718i }, { 0.003962411746280939 + -0.0018532830169601796i, -0.017950248204617606 + -0.0006330563753764742i, 0.0007950781342516142 + -0.012775256986091346i, 0.14260315136479607 + -4.743384504624082e-18i, 0.0015913600087926552 + -0.006213645538725907i, 0.003263775819260498 + -0.011490901522571817i, -0.00012169042409357746 + -0.011483164827872278i, 0.11318832554531963 + 0.011011733467644181i }, { 0.10021252393870936 + -0.010546974057944556i, 0.00015936556554717817 + 0.011608342517639873i, -0.01892217889640245 + 0.01705405025847394i, 0.0015913600087926587 + 0.006213645538725903i, 0.10587101453249097 + -7.047314121155779e-19i, 0.0033646713769867626 + 0.011687115958937306i, -0.011158039209484534 + -0.00018434708572166416i, 0.0011791237006750326 + 0.0043276934830036445i }, { 0.004065470279691832 + -0.011372775677585226i, 0.11410486855062257 + -0.011646843177663818i, 0.002079620994193658 + 0.001005483979785085i, 0.0032637758192604997 + 0.01149090152257182i, 0.0033646713769867613 + -0.011687115958937306i, 0.12407797985483862 + -3.3745792618611326e-18i, 0.0011968943930695938 + -0.0044453301658111425i, 0.01865432765384767 + -0.0001719746963745169i }, { -0.019589853077170986 + 0.01673080287622495i, 0.0018253485476818375 + 0.006130936197884289i, 0.09934195999737389 + -0.009902797001928644i, -0.00012169042409357908 + 0.011483164827872271i, -0.01115803920948453 + 0.00018434708572166307i, 0.001196894393069594 + 0.004445330165811142i, 0.10535951481926034 + -2.087089182034596e-18i, 0.0032032488778883667 + 0.011606293161535617i }, { 0.0021088491349836925 + 0.001128939819510593i, 0.0022986527928551713 + 0.011097461416611238i, 0.003929831030213793 + -0.011274726059332718i, 0.11318832554531963 + -0.01101173346764419i, 0.0011791237006750321 + -0.0043276934830036445i, 0.018654327653847665 + 0.0001719746963745143i, 0.003203248877888365 + -0.011606293161535613i, 0.1237122062389734 + -2.879912020664621e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.12769484274815715, 1.0e-7), DoubleNear(0.14444954071170857, 1.0e-7), DoubleNear(0.12623174972977402, 1.0e-7), DoubleNear(0.14260315136479607, 1.0e-7), DoubleNear(0.10587101453249097, 1.0e-7), DoubleNear(0.12407797985483862, 1.0e-7), DoubleNear(0.10535951481926034, 1.0e-7), DoubleNear(0.1237122062389734, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.11089385845499233 + -1.111307226797642e-18i, 0.0020730343034647434 + 0.011789469205217631i, -0.01880015573909262 + 0.00012107671461274741i, 0.002423406162451052 + 0.0030641153109798596i, 0.012069006571283536 + -0.05655287171760755i, 0.006437406732263185 + -0.00016622585044092579i, -0.0012351695340569822 + 0.010319073295022227i, 0.0017672585315774106 + -0.0015959515380595739i }, { 0.002073034303464741 + -0.011789469205217631i, 0.12769830584312303 + -4.133520782600986e-18i, 0.0025820738371868726 + -0.0028914676574424035i, 0.00040130534163872016 + -2.3578968173380724e-05i, -0.005594025868220773 + -0.001921633185009974i, 0.012688629323988829 + -0.06514176587639617i, -0.0013414907684124837 + -0.0019697583940994786i, -0.00020265516957692958 + 0.0017525261613971681i }, { -0.01880015573909262 + -0.00012107671461274i, 0.0025820738371868704 + 0.0028914676574424026i, 0.11086633658518356 + -4.2825985813177425e-18i, 0.0019030094894932962 + 0.011572883412013195i, -0.0012690567043410074 + 0.008732439087825061i, 0.0015591715782673622 + -0.0006247113218480675i, 0.004716203205006516 + -0.05674062994385361i, 0.005860735183052631 + -5.7131723043074285e-05i }, { 0.0024234061624510534 + -0.003064115310979859i, 0.0004013053416387184 + 2.357896817338788e-05i, 0.0019030094894932935 + -0.011572883412013193i, 0.12723959374677551 + -3.808260130855334e-18i, -0.001296907968803463 + -0.0008918139874950308i, -8.754129385413743e-05 + -0.0020004834586106078i, -0.006030566579124261 + -0.0019506860904450645i, 0.006726682909978862 + -0.06515655173237597i }, { 0.012069006571283536 + 0.05655287171760755i, -0.005594025868220772 + 0.0019216331850099768i, -0.0012690567043410113 + -0.008732439087825061i, -0.0012969079688034636 + 0.0008918139874950289i, 0.1226719988256558 + -2.5478751053409354e-18i, 0.0022967715256557667 + 0.012877177745513151i, -0.02050036578681848 + 0.0002573535975408435i, 0.0027181292845049215 + 0.0031168611889839633i }, { 0.006437406732263183 + 0.00016622585044092383i, 0.012688629323988829 + 0.06514176587639617i, 0.001559171578267362 + 0.0006247113218480695i, -8.754129385414057e-05 + 0.002000483458610609i, 0.0022967715256557663 + -0.012877177745513148i, 0.1408292147234242 + -2.8866882842426556e-18i, 0.0027483784570223138 + -0.0033175344852348775i, 0.0003027741075913408 + 0.00048466064717534796i }, { -0.0012351695340569863 + -0.010319073295022227i, -0.0013414907684124833 + 0.0019697583940994777i, 0.004716203205006517 + 0.05674062994385361i, -0.006030566579124263 + 0.0019506860904450647i, -0.020500365786818478 + -0.0002573535975408428i, 0.002748378457022316 + 0.0033175344852348766i, 0.12072492796385079 + -1.3823577699190182e-18i, 0.0020953175226466865 + 0.01280866673561377i }, { 0.0017672585315774117 + 0.0015959515380595739i, -0.00020265516957693262 + -0.0017525261613971655i, 0.005860735183052629 + 5.7131723043075695e-05i, 0.006726682909978866 + 0.06515655173237597i, 0.0027181292845049176 + -0.003116861188983965i, 0.0003027741075913408 + -0.00048466064717534775i, 0.0020953175226466857 + -0.012808666735613768i, 0.13907576385699394 + -3.815036394433369e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.11089385845499233, 1.0e-7), DoubleNear(0.12769830584312303, 1.0e-7), DoubleNear(0.11086633658518356, 1.0e-7), DoubleNear(0.12723959374677551, 1.0e-7), DoubleNear(0.1226719988256558, 1.0e-7), DoubleNear(0.1408292147234242, 1.0e-7), DoubleNear(0.12072492796385079, 1.0e-7), DoubleNear(0.13907576385699394, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.1210663593528534 + -3.0899761915836876e-18i, 0.0008413270706155843 + 0.012265690871218326i, 0.09513764386025747 + 0.009749831598309364i, 0.0038217876755049455 + 0.010788869661932158i, 0.009140229294790093 + -0.06183993941044385i, 0.0063909150582250485 + 0.000511685700321006i, 0.012177294716301074 + -0.047865823993685844i, 0.00578423025259857 + -0.0011016050103742443i }, { 0.0008413270706155804 + -0.012265690871218322i, 0.13681743482858724 + -5.027987574901527e-18i, -4.76325454330925e-06 + -0.010996991503871864i, 0.10833983095488071 + 0.010799835615401258i, -0.006173139922001882 + -0.0014130820625577693i, 0.010443503202816262 + -0.06993818870168048i, -0.0055722484179164785 + -0.0008893049645725278i, 0.013775654890563564 + -0.05455023375948287i }, { 0.09513764386025748 + -0.009749831598309375i, -4.763254543309467e-06 + 0.010996991503871859i, 0.1006938356873225 + -2.303929616531697e-18i, 0.0031347167223424554 + 0.0110966617460125i, 0.002216620960611348 + -0.04933879951588965i, 0.005693023956103127 + 0.0008380593555063699i, 0.007644980481499959 + -0.0514535622510173i, 0.005907226857090767 + -0.0007350432738050061i }, { 0.0038217876755049472 + -0.010788869661932154i, 0.10833983095488071 + -0.010799835615401267i, 0.0031347167223424537 + -0.011096661746012502i, 0.1181204647613113 + -2.913793338554793e-18i, -0.00525961333429142 + -0.00277845930150589i, 0.0027346469597755363 + -0.056198347617133576i, -0.005451452525343152 + -0.0024592372128972692i, 0.008971809031151428 + -0.06036012890709166i }, { 0.009140229294790093 + 0.061839939410443856i, -0.006173139922001882 + 0.0014130820625577697i, 0.0022166209606113508 + 0.04933879951588965i, -0.005259613334291421 + 0.00277845930150589i, 0.13286023312507778 + -3.4423418976414766e-18i, 0.0009588855157697793 + 0.0134890971066665i, 0.10441684007582577 + 0.010699939461563814i, 0.004173513634400679 + 0.01185863207498579i }, { 0.006390915058225045 + -0.0005116857003210068i, 0.010443503202816265 + 0.06993818870168049i, 0.005693023956103128 + -0.0008380593555063694i, 0.0027346469597755376 + 0.056198347617133576i, 0.0009588855157697793 + -0.013489097106666497i, 0.15023525724791742 + -3.3610267347050637e-18i, 4.2438395996908986e-05 + -0.012094515841640287i, 0.11895336314106149 + 0.011858741029906729i }, { 0.012177294716301083 + 0.047865823993685844i, -0.005572248417916478 + 0.0008893049645725289i, 0.0076449804814999614 + 0.0514535622510173i, -0.005451452525343153 + 0.002459237212897272i, 0.10441684007582577 + -0.010699939461563824i, 4.243839599690855e-05 + 0.012094515841640285i, 0.11053669366442881 + -4.87890977618477e-19i, 0.0034332035325326743 + 0.012196747374460422i }, { 0.00578423025259857 + 0.0011016050103742478i, 0.013775654890563569 + 0.05455023375948287i, 0.005907226857090768 + 0.0007350432738050063i, 0.00897180903115143 + 0.06036012890709166i, 0.004173513634400678 + -0.01185863207498579i, 0.1189533631410615 + -0.01185874102990674i, 0.0034332035325326726 + -0.012196747374460418i, 0.1296697213325007 + -3.3406979439709605e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1210663593528534, 1.0e-7), DoubleNear(0.13681743482858724, 1.0e-7), DoubleNear(0.1006938356873225, 1.0e-7), DoubleNear(0.1181204647613113, 1.0e-7), DoubleNear(0.13286023312507778, 1.0e-7), DoubleNear(0.15023525724791742, 1.0e-7), DoubleNear(0.11053669366442881, 1.0e-7), DoubleNear(0.1296697213325007, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.14710664703517112 + -4.275822317739708e-18i, -0.0006593322295352144 + -0.002032691199904038i, 0.003916022385882725 + 0.007700053811851321i, 0.0014575328693681884 + 0.00037070881626655053i, -0.02851431451668087 + -0.061869050575990674i, -0.0012931065210570558 + 0.0012139758719185332i, 0.0006357067170237591 + -0.004636395451494892i, -5.2635034047289104e-05 + -0.0006421666656302074i }, { -0.0006593322295352137 + 0.0020326911999040383i, 0.1430052895875589 + -2.0328790734103208e-19i, -0.0012567590423936891 + -0.000979721654440253i, 0.003850686757499882 + 0.007533338868998414i, 0.001965084815270744 + 0.0004847828179425829i, -0.02786722617260611 + -0.060031961805274626i, -0.00019548223900184216 + 0.0006172068923678343i, 0.0010088072077738372 + -0.004464807055451704i }, { 0.003916022385882722 + -0.007700053811851321i, -0.001256759042393689 + 0.0009797216544402533i, 0.11214370522542999 + -3.279711571768651e-18i, -0.0002664476023708523 + -0.001286255886839261i, -0.004218684568224595 + -0.002365841920127739i, 0.0005794822055620787 + 0.0005080215446328916i, -0.021779124705391763 + -0.045943328831384245i, -0.0005948358081417865 + 0.001264141531825014i }, { 0.0014575328693681882 + -0.00037070881626655107i, 0.0038506867574998804 + -0.007533338868998414i, -0.00026644760237085237 + 0.001286255886839261i, 0.10877908262695785 + -3.3610267347050637e-18i, -0.00017283444058063192 + -0.0005543834114470261i, -0.003925584261479452 + -0.0019854859440279504i, 0.0016767441863857232 + -0.0005107175937658162i, -0.021392204120760747 + -0.04469059827151828i }, { -0.02851431451668087 + 0.06186905057599068i, 0.001965084815270744 + -0.00048478281794258444i, -0.004218684568224595 + 0.0023658419201277392i, -0.00017283444058063157 + 0.0005543834114470263i, 0.14014355315219007 + -2.0396553369883552e-18i, -0.0005352678882974689 + -0.0013773991371198286i, 0.0039791373605885545 + 0.007234447462421396i, 0.0011171755633441634 + 0.00038035119876558355i }, { -0.001293106521057057 + -0.001213975871918533i, -0.027867226172606098 + 0.060031961805274626i, 0.0005794822055620785 + -0.0005080215446328917i, -0.003925584261479454 + 0.00198548594402795i, -0.000535267888297468 + 0.0013773991371198299i, 0.13607665083269388 + -3.3203691532368573e-18i, -0.0010943340956458903 + -0.0007247150887485412i, 0.003653844404231203 + 0.007170917381592175i }, { 0.0006357067170237595 + 0.004636395451494892i, -0.00019548223900184248 + -0.0006172068923678342i, -0.021779124705391756 + 0.045943328831384245i, 0.0016767441863857235 + 0.000510717593765816i, 0.003979137360588554 + -0.007234447462421395i, -0.00109433409564589 + 0.0007247150887485412i, 0.10804245757312582 + -3.584643432780199e-18i, -0.0006895270082288501 + -0.001597096026283783i }, { -5.26350340472887e-05 + 0.0006421666656302076i, 0.0010088072077738368 + 0.004464807055451704i, -0.000594835808141787 + -0.0012641415318250136i, -0.021392204120760743 + 0.04469059827151828i, 0.0011171755633441634 + -0.0003803511987655845i, 0.0036538444042312004 + -0.007170917381592175i, -0.0006895270082288499 + 0.0015970960262837828i, 0.1047026139668715 + -3.903127820947816e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.14710664703517112, 1.0e-7), DoubleNear(0.1430052895875589, 1.0e-7), DoubleNear(0.11214370522542999, 1.0e-7), DoubleNear(0.10877908262695785, 1.0e-7), DoubleNear(0.14014355315219007, 1.0e-7), DoubleNear(0.13607665083269388, 1.0e-7), DoubleNear(0.10804245757312582, 1.0e-7), DoubleNear(0.1047026139668715, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.18792065796996307 + -3.7947076036992655e-18i, -0.005628663485558878 + -0.0003059806349609111i, -0.005391214300704751 + 0.016664504761985402i, 0.0009499623780690138 + -9.571363254905703e-05i, -0.010794589761589823 + 0.02733101112605126i, 0.010236184016161297 + 0.03070510191959997i, -0.0006266992374411842 + -0.0030598129622563305i, -0.003345750088926531 + -0.00034378580008205225i }, { -0.005628663485558879 + 0.00030598063496091167i, 0.09629350622131026 + -1.7618285302889447e-18i, -0.0013029784269383614 + -0.0016250592110136804i, 0.012976287777642093 + -0.0017826508817235841i, 0.005480452301722711 + -0.015788981355973897i, -0.01045671959013622 + -0.026999370007177947i, 0.0002934112312239914 + -0.0023155162828012946i, 0.0046926273933983005 + -0.00766533657948423i }, { -0.005391214300704754 + -0.016664504761985402i, -0.0013029784269383612 + 0.00162505921101368i, 0.13722061322073864 + -3.2255014631443757e-18i, -4.863126294588061e-05 + -0.0012681574127864311i, 0.004439501934874586 + 0.007729039699355933i, 0.0028569151040160764 + -0.0020392427681585265i, -0.008790648429997838 + 0.0013119499748098533i, 0.007615031122326114 + 0.021534697090272538i }, { 0.0009499623780690135 + 9.57136325490562e-05i, 0.012976287777642093 + 0.0017826508817235813i, -4.8631262945880716e-05 + 0.0012681574127864298i, 0.08065860043518339 + -1.8973538018496328e-18i, 0.001131208084310865 + -0.00217024170351357i, -0.0005404842021650661 + 0.0033422258930373107i, 0.004528086111163214 + -0.013500007153524937i, -0.008554484294957164 + -0.0008040791025276106i }, { -0.010794589761589816 + -0.027331011126051255i, 0.005480452301722713 + 0.015788981355973897i, 0.004439501934874586 + -0.007729039699355933i, 0.0011312080843108654 + 0.00217024170351357i, 0.09932954221739812 + -2.520770051028798e-18i, 0.004434063367726195 + -0.0031041097020629554i, 0.01328637404717603 + -0.001730003487712687i, 0.001624746054643338 + 0.0008467736475811911i }, { 0.010236184016161293 + -0.030705101919599975i, -0.010456719590136223 + 0.026999370007177947i, 0.002856915104016076 + 0.0020392427681585256i, -0.00054048420216507 + -0.0033422258930373107i, 0.004434063367726196 + 0.0031041097020629562i, 0.18278843419894253 + -1.7618285302889447e-18i, -0.001048114711101218 + -7.937753217511392e-05i, -0.005471756615911009 + 0.016486907132314172i }, { -0.0006266992374411827 + 0.0030598129622563296i, 0.0002934112312239918 + 0.0023155162828012946i, -0.008790648429997834 + -0.0013119499748098506i, 0.004528086111163215 + 0.013500007153524937i, 0.01328637404717603 + 0.001730003487712687i, -0.001048114711101218 + 7.937753217511474e-05i, 0.0829655495778172 + -3.638853541404474e-18i, -0.0009073433476538219 + -0.0016151945003366128i }, { -0.00334575008892653 + 0.0003437858000820524i, 0.004692627393398301 + 0.00766533657948423i, 0.007615031122326114 + -0.021534697090272538i, -0.008554484294957167 + 0.0008040791025276132i, 0.001624746054643338 + -0.0008467736475811917i, -0.005471756615911013 + -0.016486907132314172i, -0.0009073433476538219 + 0.001615194500336614i, 0.13282309615864596 + -5.366800753803247e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.18792065796996307, 1.0e-7), DoubleNear(0.09629350622131026, 1.0e-7), DoubleNear(0.13722061322073864, 1.0e-7), DoubleNear(0.08065860043518339, 1.0e-7), DoubleNear(0.09932954221739812, 1.0e-7), DoubleNear(0.18278843419894253, 1.0e-7), DoubleNear(0.0829655495778172, 1.0e-7), DoubleNear(0.13282309615864596, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.15922763118318523 + -3.9979955110402976e-18i, -0.0015093466116996223 + -0.00446105483033928i, 0.0015130410601223482 + 0.012632098131513982i, 0.0008444184208479408 + -0.00035634399476994715i, 0.12247695564367402 + 0.017135152584447273i, 0.0017185612358564858 + -0.002074103244918301i, -0.000393163581641493 + 0.0036472751433931625i, 0.0007213060357067734 + 0.0010459041765916966i }, { -0.001509346611699621 + 0.004461054830339282i, 0.15486406588683438 + -1.734723475976807e-18i, -0.0012560183284044187 + 7.419451446717348e-06i, 0.0012271056631353054 + 0.012571107632111674i, -0.0027031054351338117 + 0.0005462575883844823i, 0.11899665249631347 + 0.016829162698011338i, -0.00036387299447001133 + -0.0011649841232577033i, -0.0005660985544151719 + 0.0035280928379723144i }, { 0.001513041060122346 + -0.012632098131513978i, -0.0012560183284044183 + -7.41945144671686e-06i, 0.11528492942184139 + -3.1035287187397564e-18i, -0.0010589176139526911 + -0.0030547140353364317i, 0.0068982873434650215 + -0.007725056863279256i, -0.0015541743679011724 + 0.0008930398585855963i, 0.09412107764588087 + 0.00473959058940218i, 0.0019595108899489308 + -0.002182781873102226i }, { 0.0008444184208479409 + 0.00035634399476994633i, 0.0012271056631353032 + -0.012571107632111674i, -0.0010589176139526907 + 0.0030547140353364317i, 0.1116026580625748 + -6.085084693074894e-18i, 0.0015877592389884666 + -0.00021665378137199526i, 0.006747226484330435 + -0.007673434111555486i, -0.00281090234920304 + 0.0005695397162027055i, 0.09125299224615707 + 0.00440444183332038i }, { 0.12247695564367403 + -0.017135152584447283i, -0.002703105435133811 + -0.0005462575883844797i, 0.006898287343465019 + 0.007725056863279255i, 0.0015877592389884657 + 0.00021665378137199535i, 0.12802256900417597 + -2.3174821436877657e-18i, 0.0003147464938669392 + 0.0010509644933154134i, 0.0063821186863489325 + 0.002302403142758737i, 0.0017302900118644111 + 0.0011074040098020812i }, { 0.0017185612358564866 + 0.0020741032449183i, 0.1189966524963135 + -0.01682916269801135i, -0.0015541743679011728 + -0.0008930398585855963i, 0.006747226484330432 + 0.007673434111555485i, 0.0003147464938669391 + -0.0010509644933154134i, 0.1242178745334184 + -1.7889335846010823e-18i, -0.0010950748096351607 + -0.0017118561946355116i, 0.00627742549859578 + 0.0021331486184789157i }, { -0.0003931635816414917 + -0.0036472751433931647i, -0.00036387299447001133 + 0.001164984123257703i, 0.09412107764588087 + -0.004739590589402186i, -0.00281090234920304 + -0.0005695397162027043i, 0.00638211868634893 + -0.002302403142758737i, -0.0010950748096351607 + 0.0017118561946355114i, 0.10490123337671443 + -3.7608262858090935e-18i, 0.00010294300335298876 + 0.00017136212221338792i }, { 0.0007213060357067729 + -0.0010459041765916973i, -0.0005660985544151732 + -0.0035280928379723135i, 0.0019595108899489316 + 0.002182781873102226i, 0.09125299224615707 + -0.004404441833320387i, 0.0017302900118644107 + -0.0011074040098020819i, 0.006277425498595777 + -0.0021331486184789166i, 0.00010294300335298811 + -0.00017136212221338816i, 0.10187903853125453 + -1.179069862577986e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.15922763118318523, 1.0e-7), DoubleNear(0.15486406588683438, 1.0e-7), DoubleNear(0.11528492942184139, 1.0e-7), DoubleNear(0.1116026580625748, 1.0e-7), DoubleNear(0.12802256900417597, 1.0e-7), DoubleNear(0.1242178745334184, 1.0e-7), DoubleNear(0.10490123337671443, 1.0e-7), DoubleNear(0.10187903853125453, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.1353965398950538 + -2.1616280813929745e-18i, -0.0003577484759679758 + -0.001774128717623951i, 0.003732847491175429 + 0.007026056920441928i, 0.0012277008063033038 + 0.0006328808079236951i, 0.02361534004475144 + -0.06873177666596735i, 0.0001578873949322984 + 0.0005046839977768865i, 0.004226109660981715 + -0.000682701800591802i, -0.00016583763630312123 + -0.0001390963348594343i }, { -0.0003577484759679748 + 0.0017741287176239516i, 0.13460512114672785 + -2.961227183601034e-18i, -0.0013656157426462849 + -0.0006698597059214169i, 0.0035877165983904907 + 0.00712931565934132i, 0.0017866525144855055 + -0.00014012576404164753i, -0.0031974845705657782 + -0.06919878911756956i, -0.0005505162666824277 + 0.001388690801535517i, 0.0035849423782022766 + -0.0020795724900332106i }, { 0.0037328474911754294 + -0.007026056920441927i, -0.0013656157426462849 + 0.0006698597059214169i, 0.10381613848239868 + -3.2051726724102725e-18i, -0.0002688743585727033 + -0.001502234276275895i, -0.0029038191288244617 + -0.003110029522152512i, 0.00032902857345431114 + -3.129284299565783e-05i, 0.018134094607054084 + -0.05270438154680125i, 0.00010996761697764387 + 0.0004103238201080649i }, { 0.0012277008063033036 + -0.0006328808079236959i, 0.0035877165983904877 + -0.00712931565934132i, -0.0002688743585727033 + 0.0015022342762758953i, 0.10288029510589414 + -5.0076587841674236e-18i, -0.000789816678210299 + -0.001257378168684221i, -0.003686095430353924 + -0.0016597589330524225i, 0.001515252097819271 + -0.00012106601424259904i, -0.0023514280709820094 + -0.05295687193989512i }, { 0.023615340044751444 + 0.06873177666596735i, 0.0017866525144855055 + 0.00014012576404164848i, -0.002903819128824462 + 0.0031100295221525116i, -0.0007898166782102983 + 0.0012573781686842213i, 0.15185366029230743 + -4.153849573335089e-18i, -0.0008368516418647073 + -0.0016359616193999155i, 0.004162312255295852 + 0.00790844435383079i, 0.001347007626409048 + 0.00011817920710843885i }, { 0.00015788739493229778 + -0.0005046839977768875i, -0.003197484570565774 + 0.06919878911756956i, 0.0003290285734543112 + 3.12928429956578e-05i, -0.003686095430353924 + 0.0016597589330524236i, -0.0008368516418647071 + 0.0016359616193999166i, 0.14447681927352496 + -5.624298769768554e-19i, -0.0009854773953932947 + -0.0010345770372673774i, 0.003916814563340594 + 0.007574940591249269i }, { 0.004226109660981715 + 0.0006827018005918016i, -0.0005505162666824279 + -0.0013886908015355167i, 0.018134094607054087 + 0.05270438154680125i, 0.0015152520978192715 + 0.0001210660142425986i, 0.004162312255295847 + -0.007908444353830788i, -0.0009854773953932943 + 0.0010345770372673776i, 0.11637002431615714 + -3.6591823321385775e-18i, -0.0006871002520269992 + -0.0013811176368471486i }, { -0.0001658376363031211 + 0.00013909633485943416i, 0.003584942378202276 + 0.0020795724900332093i, 0.00010996761697764406 + -0.00041032382010806553i, -0.002351428070982007 + 0.05295687193989512i, 0.001347007626409048 + -0.00011817920710843966i, 0.003916814563340593 + -0.007574940591249269i, -0.0006871002520269993 + 0.0013811176368471486i, 0.11060140148793521 + -2.256495771485456e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1353965398950538, 1.0e-7), DoubleNear(0.13460512114672785, 1.0e-7), DoubleNear(0.10381613848239868, 1.0e-7), DoubleNear(0.10288029510589414, 1.0e-7), DoubleNear(0.15185366029230743, 1.0e-7), DoubleNear(0.14447681927352496, 1.0e-7), DoubleNear(0.11637002431615714, 1.0e-7), DoubleNear(0.11060140148793521, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.1676833543641421 + -4.695950659577841e-18i, -0.0028888835280859787 + -0.0009803201829272782i, -0.023958628234554462 + -0.057897997674054236i, 0.0008501769206988415 + 0.0026097315736911203i, -0.009393823487979007 + 0.013754059979858612i, 0.009308139278327663 + 0.02684563889781752i, 0.017529355204844096 + 0.0010513405173918319i, 0.00835070470354066 + -0.00724998918666032i }, { -0.0028888835280859787 + 0.000980320182927278i, 0.08988966492548427 + -2.019326546254252e-18i, 0.0018419271327276491 + 0.002622886960664561i, -0.023851467366926622 + -0.047860155983491i, 0.004880137681645233 + -0.015198184388586368i, -0.009498054990354273 + -0.01389636536915951i, -0.009842723655345309 + 0.0006559376444796064i, -0.007350698408400349 + 0.0142741851650195i }, { -0.02395862823455446 + 0.057897997674054236i, 0.0018419271327276493 + -0.0026228869606645614i, 0.15745791682655957 + -2.3242584072658e-18i, -0.0027884112204187806 + -0.0005938178648200639i, -0.007190216767571098 + -0.016005389979611977i, -0.010048361644203235 + -0.001735385887807102i, -0.010191414703608655 + 0.014888901121002503i, 0.00854307586015975 + 0.02539416011205499i }, { 0.0008501769206988413 + -0.00260973157369112i, -0.02385146736692662 + 0.047860155983491i, -0.0027884112204187798 + 0.0005938178648200635i, 0.08706244173100938 + -1.6398557858843255e-18i, 0.006208688131967245 + 0.006842814153113304i, 0.015960567440509516 + -0.001806566885536591i, 0.005128400731240693 + -0.014090804120912471i, -0.009513148894739112 + -0.013907083740546047i }, { -0.009393823487979 + -0.01375405997985861i, 0.004880137681645234 + 0.015198184388586368i, -0.0071902167675711 + 0.016005389979611973i, 0.006208688131967245 + -0.006842814153113304i, 0.091566997896459 + -2.859583229930518e-18i, 0.0019631036961799114 + -0.00233862690381602i, -0.02633481098751817 + -0.04991438173332068i, -0.002738119249897684 + -0.0001316141699475731i }, { 0.00930813927832766 + -0.026845638897817527i, -0.009498054990354275 + 0.013896365369159513i, -0.010048361644203238 + 0.0017353858878071033i, 0.01596056744050952 + 0.0018065668855365917i, 0.0019631036961799122 + 0.002338626903816022i, 0.1618947072890325 + -1.5449880957918438e-18i, 0.001799901868928818 + -0.0026488217364877943i, -0.025407962926440236 + -0.05686240409330191i }, { 0.01752935520484409 + -0.0010513405173918303i, -0.009842723655345309 + -0.0006559376444796056i, -0.01019141470360865 + -0.014888901121002496i, 0.005128400731240693 + 0.01409080412091247i, -0.026334810987518165 + 0.04991438173332069i, 0.0017999018689288174 + 0.002648821736487793i, 0.09072809389875632 + -3.300040362502754e-18i, 0.0015636163238924611 + -0.002380677298583548i }, { 0.008350704703540662 + 0.007249989186660321i, -0.007350698408400349 + -0.0142741851650195i, 0.008543075860159748 + -0.02539416011205499i, -0.009513148894739112 + 0.013907083740546049i, -0.0027381192498976857 + 0.00013161416994757343i, -0.025407962926440226 + 0.05686240409330191i, 0.0015636163238924622 + 0.002380677298583549i, 0.15371682306855602 + -5.583641188300348e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.1676833543641421, 1.0e-7), DoubleNear(0.08988966492548427, 1.0e-7), DoubleNear(0.15745791682655957, 1.0e-7), DoubleNear(0.08706244173100938, 1.0e-7), DoubleNear(0.091566997896459, 1.0e-7), DoubleNear(0.1618947072890325, 1.0e-7), DoubleNear(0.09072809389875632, 1.0e-7), DoubleNear(0.15371682306855602, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.1401869337287162 + -4.614635496641428e-18i, -0.0011225351032203917 + -0.003956212988432182i, -0.027535320303579205 + -0.058767434693268554i, -0.002178204080752473 + 0.0028203747184294354i, 0.11071476534883926 + 0.011206840192638467i, 0.0019620209514820738 + -0.0023185772666934794i, -0.016754440769873792 + -0.04763649059887277i, -0.000975459380540182 + 0.0008617601865349345i }, { -0.0011225351032203904 + 0.003956212988432182i, 0.13618781204796032 + -3.06287113727155e-18i, 0.004138480656346671 + -4.6840342755593905e-05i, -0.026892251949970733 + -0.057058488388341565i, -0.0026996833810285902 + 0.0005376270153483016i, 0.10749309711665177 + 0.010865137446724588i, 0.002101538080382862 + 8.268875952870645e-06i, -0.016500823573969405 + -0.04634750043034919i }, { -0.027535320303579202 + 0.05876743469326856i, 0.004138480656346671 + 4.6840342755592604e-05i, 0.1343256268763104 + -2.4868887331386258e-18i, -0.0014457291224319224 + -0.0035595558772435294i, -0.025607671198404354 + 0.04362710000736614i, 0.001662200986819648 + -1.890657617608499e-05i, 0.10588326794071565 + 0.010667902981210984i, 0.001716051174323343 + -0.0019383078513270477i }, { -0.0021782040807524746 + -0.0028203747184294345i, -0.026892251949970726 + 0.057058488388341565i, -0.001445729122431921 + 0.0035595558772435303i, 0.13027891190144889 + -4.756937031780151e-18i, -0.0008737615471817726 + -0.001685930118114449i, -0.025124978906518013 + 0.04234378946507202i, -0.0028143244033082618 + 0.0005781702892388857i, 0.10275654762581876 + 0.010368467084607123i }, { 0.11071476534883926 + -0.011206840192638477i, -0.00269968338102859 + -0.0005376270153483i, -0.02560767119840436 + -0.04362710000736614i, -0.0008737615471817724 + 0.0016859301181144488i, 0.11906341853188493 + -2.9408983928669308e-18i, 0.00019675527131432464 + 0.0006372659016888834i, -0.022758118918493428 + -0.049044944714106364i, 0.00029026175155363084 + -0.00034225731468588813i }, { 0.0019620209514820746 + 0.0023185772666934786i, 0.10749309711665178 + -0.010865137446724599i, 0.0016622009868196474 + 1.8906576176084123e-05i, -0.02512497890651802 + -0.04234378946507202i, 0.00019675527131432437 + -0.0006372659016888834i, 0.11559656016655641 + -5.014435047745458e-19i, -0.0004966516546902043 + 2.090556693236083e-05i, -0.02236717834339612 + -0.04766407168845135i }, { -0.016754440769873785 + 0.04763649059887277i, 0.002101538080382862 + -8.268875952870537e-06i, 0.10588326794071565 + -0.010667902981210994i, -0.002814324403308261 + -0.0005781702892388844i, -0.02275811891849342 + 0.049044944714106364i, -0.0004966516546902043 + -2.0905566932361073e-05i, 0.1138603838490055 + -3.1374100366299285e-18i, 0.0002209342259056032 + 0.000585060713839918i }, { -0.000975459380540182 + -0.0008617601865349345i, -0.0165008235739694 + 0.04634750043034919i, 0.0017160511743233436 + 0.001938307851327047i, 0.10275654762581876 + -0.010368467084607135i, 0.0002902617515536304 + 0.00034225731468588813i, -0.02236717834339612 + 0.04766407168845135i, 0.00022093422590560303 + -0.0005850607138399182i, 0.11050035289811652 + -2.4665599424045226e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.1401869337287162, 1.0e-7), DoubleNear(0.13618781204796032, 1.0e-7), DoubleNear(0.1343256268763104, 1.0e-7), DoubleNear(0.13027891190144889, 1.0e-7), DoubleNear(0.11906341853188493, 1.0e-7), DoubleNear(0.11559656016655641, 1.0e-7), DoubleNear(0.1138603838490055, 1.0e-7), DoubleNear(0.11050035289811652, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.12219035878367387 + -3.482999479109683e-18i, -0.00026746798866572445 + -0.0016730562498060704i, -0.02369751140472253 + -0.05080923305335145i, -0.001041385611933838 + 0.0012446513168017557i, 0.021333691174193196 + -0.06202463040178094i, 2.4050951182955088e-05 + 0.00046328394032234407i, -0.02990488899131294 + 0.0031681881871443484i, 0.0003469442297078354 + -0.00029385866473141415i }, { -0.0002674679886657238 + 0.001673056249806071i, 0.12146481244867609 + -3.564314642046096e-18i, 0.0017184934296080297 + -0.00017823249465632066i, -0.023777878529646895 + -0.050532423446857065i, 0.0016516969955858245 + -0.00023787823451238115i, -0.0028663063984915313 + -0.06240388856997581i, -0.0008442250088012441 + -0.00129550085014818i, -0.025355001147682875 + 0.01334707763751894i }, { -0.023697511404722524 + 0.05080923305335145i, 0.0017184934296080297 + 0.00017823249465631977i, 0.11702231959377858 + -1.883801274693564e-18i, -0.00035915484587495513 + -0.0016033067440937754i, 0.021725422028224736 + 0.020920414053455415i, -0.0007107241305562719 + -0.0002427623440954021i, 0.02041574347761233 + -0.059411527810987665i, 0.00024380406072698716 + 0.0004517238775626074i }, { -0.0010413856119338392 + -0.0012446513168017552i, -0.02377787852964689 + 0.050532423446857065i, -0.0003591548458749543 + 0.0016033067440937758i, 0.11602060380394591 + -4.404571325722362e-18i, -0.000520107928196601 + 0.0011264199909079926i, 0.026559301513975463 + 0.011129825876199727i, 0.0016502076167189525 + -2.3313543771865655e-05i, -0.0026826062430562563 + -0.059751772487488884i }, { 0.0213336911741932 + 0.06202463040178093i, 0.0016516969955858245 + 0.00023787823451238148i, 0.021725422028224736 + -0.020920414053455415i, -0.000520107928196601 + -0.0011264199909079924i, 0.13705999347692727 + -4.072534410398676e-18i, -0.0006583118432403425 + -0.0016458908369372284i, -0.026595927817350103 + -0.05700314635402347i, -0.0008465567172650042 + 0.0012334660869417916i }, { 2.405095118295479e-05 + -0.0004632839403223451i, -0.002866306398491528 + 0.06240388856997581i, -0.0007107241305562721 + 0.00024276234409540223i, 0.026559301513975463 + -0.011129825876199727i, -0.0006583118432403422 + 0.0016458908369372282i, 0.13031955976584064 + 0.0i, 0.0019233355720484375 + 0.00015229771883308759i, -0.02548155176371996 + -0.054190136629935846i }, { -0.02990488899131294 + -0.0031681881871443484i, -0.0008442250088012436 + 0.0012955008501481801i, 0.02041574347761233 + 0.059411527810987665i, 0.0016502076167189527 + 2.3313543771865926e-05i, -0.026595927817350103 + 0.05700314635402347i, 0.0019233355720484372 + -0.00015229771883308824i, 0.1311636911315373 + -3.74049749507499e-18i, -0.0008656400506513642 + -0.0013711884193098362i }, { 0.00034694422970783567 + 0.0002938586647314138i, -0.025355001147682875 + -0.01334707763751894i, 0.00024380406072698719 + -0.0004517238775626081i, -0.002682606243056253 + 0.059751772487488884i, -0.0008465567172650049 + -0.0012334660869417913i, -0.025481551763719953 + 0.054190136629935846i, -0.0008656400506513635 + 0.0013711884193098366i, 0.1247586609956195 + -2.8189256484623115e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.12219035878367387, 1.0e-7), DoubleNear(0.12146481244867609, 1.0e-7), DoubleNear(0.11702231959377858, 1.0e-7), DoubleNear(0.11602060380394591, 1.0e-7), DoubleNear(0.13705999347692727, 1.0e-7), DoubleNear(0.13031955976584064, 1.0e-7), DoubleNear(0.1311636911315373, 1.0e-7), DoubleNear(0.1247586609956195, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.19371370774358765 + -6.057979638762756e-18i, -0.007839411742973186 + -0.0015178354818726363i, -0.02338912753568865 + 0.04080015605637607i, 0.010635454119808308 + 0.031123594740597796i, 0.13878579664013224 + 0.0327610986226552i, -0.001654606929379339 + -0.005932494351039236i, -0.03621427847176802 + -0.0020767284293107544i, 0.0023560894124386145 + 0.024097117886324577i }, { -0.007839411742973184 + 0.0015178354818726366i, 0.07843067571627808 + -5.421010862427522e-19i, 0.004436095424276556 + -0.01298179040222237i, -0.02270360298535553 + -0.03960432228312433i, -0.0031920732324260018 + -0.004588660009873596i, 0.07553159584919968 + -0.01056728138704685i, 0.0025230323829267113 + -0.013099629772213784i, 0.018923078187452213 + -0.025751535863525424i }, { -0.023389127535688642 + -0.04080015605637606i, 0.004436095424276556 + 0.01298179040222237i, 0.08079885286143892 + -1.043544591017298e-18i, 0.005271147517320871 + -0.005997933383803075i, 0.019494451580201338 + -0.026529091305039155i, 0.006021210381142683 + 0.011904243702158746i, 0.07781223664942266 + -0.010886355448805748i, 0.005332679055184755 + 0.0016756092330187087i }, { 0.010635454119808308 + -0.031123594740597796i, -0.02270360298535553 + 0.039604322283124334i, 0.005271147517320872 + 0.0059979333838030766i, 0.18803604823313114 + -7.277707082808949e-18i, 0.012883410051388383 + -0.020499755930123025i, -0.03515285465734329 + -0.002015860476006601i, -0.00232193455191085 + 0.005704457314460784i, 0.13471804889327085 + 0.03180088591837856i }, { 0.13878579664013221 + -0.032761098622655214i, -0.0031920732324260005 + 0.004588660009873599i, 0.01949445158020134 + 0.026529091305039165i, 0.012883410051388386 + 0.02049975593012302i, 0.13142756344711404 + -9.622294280808852e-19i, 0.0021621169944684264 + -5.630256587470562e-05i, 0.0038038893441009877 + -0.01215719495551495i, 0.007215761018679103 + 0.021116204269274713i }, { -0.0016546069293793386 + 0.005932494351039235i, 0.0755315958491997 + 0.010567281387046844i, 0.0060212103811426824 + -0.011904243702158746i, -0.035152854657343295 + 0.0020158604760065974i, 0.002162116994468425 + 5.630256587470486e-05i, 0.09852143094021557 + -3.1170812458958252e-18i, 0.00557244298860937 + -0.016307198107276467i, 0.003692399100262144 + 0.011800873173418769i }, { -0.03621427847176803 + 0.0020767284293107535i, 0.00252303238292671 + 0.013099629772213782i, 0.07781223664942266 + 0.010886355448805743i, -0.0023219345519108502 + -0.005704457314460783i, 0.003803889344100992 + 0.01215719495551495i, 0.005572442988609371 + 0.016307198107276467i, 0.10149623893377638 + -5.116079001415974e-18i, -0.0017444274972484987 + 0.001278629181403507i }, { 0.0023560894124386115 + -0.024097117886324584i, 0.018923078187452213 + 0.02575153586352543i, 0.005332679055184757 + -0.0016756092330187091i, 0.13471804889327085 + -0.031800885918378576i, 0.007215761018679101 + -0.02111620426927472i, 0.003692399100262143 + -0.011800873173418772i, -0.0017444274972484978 + -0.0012786291814035065i, 0.12757548212445738 + 1.4907779871675686e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.19371370774358765, 1.0e-7), DoubleNear(0.07843067571627808, 1.0e-7), DoubleNear(0.08079885286143892, 1.0e-7), DoubleNear(0.18803604823313114, 1.0e-7), DoubleNear(0.13142756344711404, 1.0e-7), DoubleNear(0.09852143094021557, 1.0e-7), DoubleNear(0.10149623893377638, 1.0e-7), DoubleNear(0.12757548212445738, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.1532761938362229 + -2.405573570202213e-18i, -0.0027091142374495378 + -0.001179970744058257i, -0.009232758285003084 + 0.013502696971262051i, 0.0052013905316502206 + 0.02719601411782507i, 0.02675106721620168 + -0.07781055858409294i, 0.0008030164666886653 + 0.0002616380069872322i, 0.005243255564600626 + 0.007043609360888868i, -0.0022233765608377113 + -0.007595179648729774i }, { -0.002709114237449538 + 0.0011799707440582567i, 0.08531597046189246 + -2.8392544391964147e-18i, 0.0029162337987963666 + -0.015247833263114437i, -0.009166092112450817 + -0.013405199224822684i, 0.0018419457950259069 + 0.002283883946227518i, -0.001993431320929315 + -0.04388407900991075i, -0.015366701147849306 + 0.001215557828112958i, -0.006681080268234537 + 0.005027990095530527i }, { -0.009232758285003079 + -0.01350269697126204i, 0.002916233798796368 + 0.015247833263114435i, 0.08593648454122957 + -2.961227183601034e-18i, 0.0020824914029088583 + -0.002096392249841589i, -0.008466014837145808 + 0.002330397932058738i, -0.0012465677850398698 + -0.004258345814408381i, 0.014998367435603848 + -0.04362559962867564i, -0.0005351614547787231 + 0.0006533698108977192i }, { 0.005201390531650219 + -0.027196014117825074i, -0.009166092112450818 + 0.013405199224822688i, 0.00208249140290886 + 0.00209639224984159i, 0.15216944579072952 + -5.129631528572043e-18i, -0.027408026711065167 + 0.002168067244961495i, 0.007109416838950664 + 0.004401557697155716i, 0.0014599588172788697 + -0.002545075724511764i, -0.0035554813206184724 + -0.07827158204755394i }, { 0.02675106721620168 + 0.07781055858409294i, 0.0018419457950259075 + -0.0022838839462275182i, -0.008466014837145815 + -0.002330397932058738i, -0.027408026711065167 + -0.002168067244961494i, 0.1718650773544788 + -4.614635496641428e-18i, -0.0029681805110552207 + -0.000394167303689085i, -0.010352479906584578 + 0.015140264129599066i, 0.012649824606837192 + 0.02504378489204744i }, { 0.0008030164666886659 + -0.0002616380069872337i, -0.0019934313209293134 + 0.04388407900991076i, -0.0012465677850398693 + 0.004258345814408383i, 0.007109416838950662 + -0.004401557697155714i, -0.0029681805110552207 + 0.0003941673036890847i, 0.09163613619460118 + -8.199278929421627e-19i, 0.007092304614089559 + -0.014041155246384402i, -0.009845111772642566 + -0.014398249884882874i }, { 0.005243255564600623 + -0.007043609360888863i, -0.015366701147849306 + -0.001215557828112957i, 0.01499836743560385 + 0.04362559962867565i, 0.0014599588172788695 + 0.0025450757245117656i, -0.010352479906584569 + -0.015140264129599068i, 0.007092304614089559 + 0.014041155246384402i, 0.09635860725398575 + -3.198396408832238e-18i, 0.0014442286171635144 + -0.0026229119525579794i }, { -0.00222337656083771 + 0.007595179648729776i, -0.006681080268234543 + -0.005027990095530528i, -0.0005351614547787238 + -0.0006533698108977194i, -0.0035554813206184676 + 0.07827158204755394i, 0.012649824606837189 + -0.025043784892047442i, -0.00984511177264257 + 0.014398249884882874i, 0.0014442286171635148 + 0.00262291195255798i, 0.163442084566859 + -1.9989977555201488e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1532761938362229, 1.0e-7), DoubleNear(0.08531597046189246, 1.0e-7), DoubleNear(0.08593648454122957, 1.0e-7), DoubleNear(0.15216944579072952, 1.0e-7), DoubleNear(0.1718650773544788, 1.0e-7), DoubleNear(0.09163613619460118, 1.0e-7), DoubleNear(0.09635860725398575, 1.0e-7), DoubleNear(0.163442084566859, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.1294091036049847 + -2.7850443305721395e-18i, -0.0007483269414686939 + -0.0039127056392119445i, 0.10210737632123738 + 0.010312063314982902i, 0.002125223677487038 + -0.0018561245267230734i, 0.022585579288485945 + -0.06569444598898287i, 0.0003198784193151131 + 0.0010927227097935251i, 0.023055561372490416 + -0.050034993016785226i, -0.00055388806228775 + 0.0005861808848198439i }, { -0.0007483269414686926 + 0.003912705639211946i, 0.12847469057645594 + -5.332919435913075e-18i, -0.0026601686813381084 + 0.00094089134594934i, 0.1013700984939008 + 0.010237603898727719i, 0.003943208008623893 + -0.0003119210373549379i, -0.0030018467908795895 + -0.06608368212314145i, 0.0016001561442029618 + 0.002299859872010397i, 0.0028973882343742213 + -0.05238106473638349i }, { 0.10210737632123737 + -0.010312063314982911i, -0.0026601686813381075 + -0.0009408913459493383i, 0.10980357477246777 + -2.5817564232311074e-18i, 0.00012170410692801433 + 0.0006363426453120989i, 0.012585737108055566 + -0.05363449130771478i, 0.0007825546420537496 + 0.00019495704007084069i, 0.019163855363319583 + -0.055741712223785725i, -5.2023407405170905e-05 + -0.00017771489190857357i }, { 0.0021252236774870394 + 0.0018561245267230725i, 0.10137009849390081 + -0.01023760389872773i, 0.00012170410692801444 + -0.0006363426453120989i, 0.10901072567616604 + -2.6359665318553827e-18i, 0.0012186644894880995 + -0.002522838080173773i, -0.0076344691876686814 + -0.05190265582530845i, -0.0006413033963191171 + 5.072925907069134e-05i, -0.0025470658506681976 + -0.05607197893432324i }, { 0.022585579288485945 + 0.06569444598898289i, 0.003943208008623894 + 0.0003119210373549379i, 0.012585737108055566 + 0.05363449130771478i, 0.0012186644894881004 + 0.0025228380801737725i, 0.1451034570000419 + -4.3164798992079145e-18i, -0.00181993728418362 + -0.0036030632264637667i, 0.11449065696831752 + 0.01156267985886655i, 0.001552848448318378 + -0.0024007605912974538i }, { 0.0003198784193151128 + -0.0010927227097935262i, -0.0030018467908795848 + 0.06608368212314146i, 0.0007825546420537497 + -0.00019495704007084069i, -0.007634469187668676 + 0.05190265582530844i, -0.0018199372841836187 + 0.003603063226463767i, 0.13799203337295327 + -2.4868887331386258e-18i, -0.0028538391029987436 + 0.00017490595863784743i, 0.10887954624856973 + 0.010996000632603992i }, { 0.023055561372490423 + 0.050034993016785226i, 0.0016001561442029622 + -0.002299859872010399i, 0.019163855363319587 + 0.05574171222378572i, -0.0006413033963191171 + -5.072925907069069e-05i, 0.1144906569683175 + -0.011562679858866559i, -0.002853839102998743 + -0.00017490595863784613i, 0.12312022760842266 + -3.496552006265752e-18i, 0.0002959853902919135 + 0.0005859839702167023i }, { -0.0005538880622877498 + -0.0005861808848198441i, 0.002897388234374229 + 0.05238106473638349i, -5.202340740517074e-05 + 0.00017771489190857313i, -0.0025470658506681963 + 0.05607197893432324i, 0.0015528484483183789 + 0.0024007605912974533i, 0.10887954624856974 + -0.010996000632604003i, 0.00029598539029191285 + -0.0005859839702167026i, 0.11708618738850689 + -3.3203691532368573e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1294091036049847, 1.0e-7), DoubleNear(0.12847469057645594, 1.0e-7), DoubleNear(0.10980357477246777, 1.0e-7), DoubleNear(0.10901072567616604, 1.0e-7), DoubleNear(0.1451034570000419, 1.0e-7), DoubleNear(0.13799203337295327, 1.0e-7), DoubleNear(0.12312022760842266, 1.0e-7), DoubleNear(0.11708618738850689, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.14618135616329153 + -4.14029704617902e-18i, 0.003852577898985177 + 0.007663348465703849i, -0.027085249457080695 + -0.060746006564282126i, 0.0008146664472142586 + -0.0045326135445435765i, -0.011866189343501463 + -0.0001446483587144448i, 0.0025756015475653683 + -0.006143064159346156i, 0.0038477868602741624 + 0.00978093883788763i, -0.002531232330328512 + -0.00027716475478271787i }, { 0.003852577898985175 + -0.007663348465703849i, 0.11139166312633485 + -2.574980159653073e-18i, -0.003997777209554739 + -0.0022389246171807026i, -0.020724846144400386 + -0.04501214709326311i, 0.002388185024778813 + 0.006369752676333685i, -0.007025689134831817 + 2.342969413547495e-06i, 0.0030891000070641227 + -0.001216574227232882i, 0.006330869936169584 + 0.005544586844523698i }, { -0.02708524945708069 + 0.06074600656428213i, -0.003997777209554738 + 0.002238924617180703i, 0.13803280802798182 + -1.4162390878091902e-18i, 0.003732495577952166 + 0.007218505414557971i, 0.0031567498568180257 + -0.011152497079376331i, 0.002761925267333887 + 0.0013981474290976463i, -0.009385120008224581 + 0.00047628947758775734i, 0.0014903266083917477 + -0.004582085382394405i }, { 0.0008146664472142587 + 0.0045326135445435765i, -0.020724846144400386 + 0.04501214709326311i, 0.003732495577952165 + -0.007218505414557971i, 0.10648755052958717 + -2.5478751053409354e-18i, -0.002955051775340595 + -7.67938890147195e-05i, 0.005613600816120393 + -0.006659459785772235i, 0.0015108327079307068 + 0.004701512916059558i, -0.010319443590123184 + 0.0005055279028686969i }, { -0.011866189343501457 + 0.00014464835871444935i, 0.0023881850247788106 + -0.006369752676333685i, 0.003156749856818028 + 0.011152497079376331i, -0.002955051775340595 + 7.679388901472048e-05i, 0.14393058045943846 + -3.3881317890172014e-19i, 0.00391413124439743 + 0.007570044215145886i, -0.029296291232206284 + -0.061155005816983174i, 0.0008298474775833378 + -0.00456858896240302i }, { 0.002575601547565371 + 0.0061430641593461545i, -0.007025689134831818 + -2.3429694135431584e-06i, 0.002761925267333887 + -0.0013981474290976471i, 0.005613600816120393 + 0.006659459785772233i, 0.003914131244397428 + -0.007570044215145885i, 0.10953112472605299 + -4.065758146820642e-18i, -0.004146491620149309 + -0.002112403246974986i, -0.022446482681752124 + -0.045621780009639415i }, { 0.003847786860274157 + -0.00978093883788763i, 0.0030891000070641227 + 0.001216574227232882i, -0.00938512000822458 + -0.00047628947758775485i, 0.0015108327079307055 + -0.004701512916059558i, -0.029296291232206277 + 0.061155005816983174i, -0.004146491620149311 + 0.0021124032469749866i, 0.13818739595690216 + -3.943785402416022e-18i, 0.0039004861868675916 + 0.0071868594294556i }, { -0.0025312323303285124 + 0.00027716475478271885i, 0.006330869936169584 + -0.005544586844523698i, 0.0014903266083917486 + 0.004582085382394404i, -0.01031944359012318 + -0.0005055279028686943i, 0.0008298474775833372 + 0.004568588962403019i, -0.022446482681752117 + 0.045621780009639415i, 0.00390048618686759 + -0.007186859429455598i, 0.10625752101041017 + -4.9398961483870796e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.14618135616329153, 1.0e-7), DoubleNear(0.11139166312633485, 1.0e-7), DoubleNear(0.13803280802798182, 1.0e-7), DoubleNear(0.10648755052958717, 1.0e-7), DoubleNear(0.14393058045943846, 1.0e-7), DoubleNear(0.10953112472605299, 1.0e-7), DoubleNear(0.13818739595690216, 1.0e-7), DoubleNear(0.10625752101041017, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.16128442713516564 + -3.164515090942066e-18i, 0.0017138323728972445 + 0.012984712035346293i, -0.03129725964988536 + -0.06844432562422316i, 0.004054333491448562 + -0.005213433862201388i, 0.12379120907366205 + 0.017813064761762157i, -0.0005024013210711393 + 0.003973792417469386i, -0.016298381943818975 + -0.05433307955097564i, 0.0006468291319019682 + -0.0016261755626025395i }, { 0.0017138323728972422 + -0.01298471203534629i, 0.11509031864151088 + -4.512991542970912e-18i, -0.00521295558054137 + -0.0004276575411097694i, -0.023130312603664584 + -0.047381597457386966i, 0.006766827407872474 + -0.007644125505759748i, 0.09441665339182899 + 0.0042589128776009i, -0.004606848746574813 + -0.0025932046680515256i, -0.01695688240002422 + -0.039650911478246315i }, { -0.031297259649885355 + 0.06844432562422317i, -0.005212955580541371 + 0.0004276575411097705i, 0.15280726993485394 + -2.5682038960750386e-18i, 0.001026314350360409 + 0.01221849372827936i, -0.030881575075184017 + 0.048435980022696196i, -0.0018131917289892162 + 0.0015281562602147156i, 0.11768239906632547 + 0.01615125052069645i, -0.0004568608149855256 + 0.003201575563896091i }, { 0.004054333491448561 + 0.0052134338622013875i, -0.023130312603664577 + 0.047381597457386966i, 0.0010263143503604069 + -0.012218493728279359i, 0.1117972688429053 + -4.675621868843738e-18i, -0.0002264878261664647 + 0.005759470027640146i, -0.019851075029738353 + 0.03753490944974197i, 0.006878686419922982 + -0.007754365469074995i, 0.09095741650020897 + 0.00488511954512166i }, { 0.12379120907366203 + -0.01781306476176217i, 0.0067668274078724715 + 0.0076441255057597465i, -0.03088157507518402 + -0.048435980022696196i, -0.0002264878261664647 + -0.005759470027640145i, 0.12882750948756438 + -1.3145951341386741e-18i, 0.006052876770485362 + 0.0022486806455034422i, -0.02508428103940162 + -0.05345668675704214i, -0.0024098195666509654 + -0.0038877686447452075i }, { -0.0005024013210711388 + -0.003973792417469386i, 0.09441665339182899 + -0.004258912877600907i, -0.0018131917289892175 + -0.0015281562602147158i, -0.019851075029738357 + -0.03753490944974197i, 0.006052876770485362 + -0.002248680645503443i, 0.10583246921087695 + -2.1277467635028025e-18i, -0.002931313249162678 + -0.00392367032304592i, -0.020041016222487926 + -0.043252329645515564i }, { -0.01629838194381897 + 0.05433307955097564i, -0.004606848746574813 + 0.002593204668051525i, 0.11768239906632547 + -0.016151250520696464i, 0.0068786864199229785 + 0.007754365469074994i, -0.02508428103940162 + 0.05345668675704215i, -0.002931313249162678 + 0.003923670323045919i, 0.12341293405003 + -2.791820594150174e-18i, 0.006606667414459349 + 0.0021868711157342104i }, { 0.0006468291319019696 + 0.0016261755626025397i, -0.016956882400024215 + 0.039650911478246315i, -0.0004568608149855256 + -0.003201575563896091i, 0.09095741650020896 + -0.004885119545121665i, -0.0024098195666509645 + 0.003887768644745208i, -0.020041016222487926 + 0.043252329645515564i, 0.006606667414459348 + -0.002186871115734211i, 0.10094780269709201 + -2.812149384884277e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.16128442713516564, 1.0e-7), DoubleNear(0.11509031864151088, 1.0e-7), DoubleNear(0.15280726993485394, 1.0e-7), DoubleNear(0.1117972688429053, 1.0e-7), DoubleNear(0.12882750948756438, 1.0e-7), DoubleNear(0.10583246921087695, 1.0e-7), DoubleNear(0.12341293405003, 1.0e-7), DoubleNear(0.10094780269709201, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.13833260375650433 + -3.3203691532368573e-18i, 0.003689683955000481 + 0.007277664672597315i, -0.026893325117216413 + -0.05812260690193702i, 0.0008087365667556194 + -0.004315057192188958i, 0.010425039819194218 + -0.07063062775082331i, 0.003944933447409437 + -0.0013747771443256467i, -0.03168703834176423 + 0.00928825905154644i, -0.002259589957934313 + -0.0007006217913922538i }, { 0.0036896839550004806 + -0.007277664672597314i, 0.10532256747584563 + -3.7269449679189215e-18i, -0.0038902744217087577 + -0.002040432847760377i, -0.02058206481715301 + -0.0432190495982715i, -0.003443201672263441 + -0.002452147474046355i, 0.008042344956507448 + -0.053797891220933425i, -0.0014223841540738408 + 0.001765145738529819i, -0.02357285179723159 + 0.007227006773116849i }, { -0.026893325117216413 + 0.05812260690193702i, -0.003890274421708758 + 0.0020404328477603767i, 0.13166905728527728 + -1.802486111757151e-18i, 0.003630880134565438 + 0.0068777079071859325i, 0.02767670299690074 + 0.018190796333761736i, 0.0006840841323445454 + 0.002149845081644524i, 0.009992815654991445 + -0.0672999380327136i, 0.0038661185917745543 + -0.0013874971462993655i }, { 0.000808736566755619 + 0.004315057192188956i, -0.020582064817153006 + 0.0432190495982715i, 0.0036308801345654364 + -0.006877707907185932i, 0.10137386611244717 + -4.4858864886587746e-18i, 0.0021972196145306562 + -0.00014119298608361575i, 0.020608020545299463 + 0.013859443595893405i, -0.0031467128869149446 + -0.00231764098115858i, 0.00774032157956463 + -0.05186336226576295i }, { 0.01042503981919422 + 0.07063062775082332i, -0.003443201672263441 + 0.002452147474046356i, 0.02767670299690074 + -0.018190796333761736i, 0.0021972196145306567 + 0.00014119298608361531i, 0.1517793328662257 + -1.1587410718438829e-18i, 0.004077025188382126 + 0.00795572800825242i, -0.029488215572070566 + -0.06377840547932828i, 0.0008357773580419769 + -0.004786145314757639i }, { 0.003944933447409437 + 0.0013747771443256463i, 0.00804234495650745 + 0.053797891220933425i, 0.0006840841323445447 + -0.0021498450816445245i, 0.02060802054529946 + -0.013859443595893407i, 0.004077025188382123 + -0.00795572800825242i, 0.1156002203765422 + -2.913793338554793e-18i, -0.00425399440799529 + -0.002310895016395312i, -0.0225892640089995 + -0.047414877504631026i }, { -0.03168703834176423 + -0.009288259051546437i, -0.0014223841540738414 + -0.0017651457385298194i, 0.009992815654991449 + 0.0672999380327136i, -0.0031467128869149446 + 0.00231764098115858i, -0.029488215572070563 + 0.0637784054793283i, -0.004253994407995291 + 0.0023108950163953125i, 0.14455114669960667 + -3.5575383784680614e-18i, 0.00400210163025432 + 0.007527656936827639i }, { -0.002259589957934312 + 0.0007006217913922545i, -0.02357285179723159 + -0.007227006773116848i, 0.0038661185917745534 + 0.0013874971462993642i, 0.007740321579564631 + 0.05186336226576294i, 0.0008357773580419771 + 0.004786145314757639i, -0.022589264008999493 + 0.047414877504631026i, 0.0040021016302543184 + -0.007527656936827639i, 0.11137120542755015 + -3.0018847650692404e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.13833260375650433, 1.0e-7), DoubleNear(0.10532256747584563, 1.0e-7), DoubleNear(0.13166905728527728, 1.0e-7), DoubleNear(0.10137386611244717, 1.0e-7), DoubleNear(0.1517793328662257, 1.0e-7), DoubleNear(0.1156002203765422, 1.0e-7), DoubleNear(0.14455114669960667, 1.0e-7), DoubleNear(0.11137120542755015, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.15791041042691006 + -3.618524750670371e-18i, 0.0013695797709009402 + 0.012630444909393518i, -0.0271850611812208 + 0.0005760076133521728i, -0.002765508472828869 + -0.004216315219642347i, 0.12116042894549399 + 0.017330443417547883i, -0.0005792674317311607 + 0.0036116467688831737i, -0.009049731059550817 + -0.013509729170662347i, 0.004484383756690386 + -0.0018324591228976628i }, { 0.0013695797709009385 + -0.012630444909393516i, 0.11423397303295568 + -2.9815559743351372e-18i, -0.0027768627480052005 + 0.004413975294549748i, -0.018907669339823376 + 0.0006198261598995658i, 0.006775055548091884 + -0.007745976190724945i, 0.09315696354383793 + 0.004863373818060468i, 0.0013384921590253655 + 0.0074519886756460605i, -0.008241469224764993 + -0.01431853512217383i }, { -0.027185061181220792 + -0.000576007613352165i, -0.002776862748005203 + -0.004413975294549748i, 0.15618128664310954 + -2.1141942363467336e-18i, 0.0013705669523567134 + 0.012572760854232135i, -0.008047691381067002 + -0.013802139673976692i, 0.0044863146356321215 + -0.0019210335459293724i, 0.12031317919449351 + 0.016633871864910724i, -0.0003799947043255042 + 0.0035637212124823023i }, { -0.0027655084728288666 + 0.004216315219642346i, -0.01890766933982338 + -0.0006198261598995558i, 0.0013705669523567106 + -0.012572760854232132i, 0.11265361445146052 + -6.207057437479513e-18i, 0.0014833377556205609 + 0.007237839659017082i, -0.007610711696074952 + -0.014742812107069065i, 0.006870458279703572 + -0.007652514784109797i, 0.09221710634820002 + 0.004280658604662091i }, { 0.121160428945494 + -0.0173304434175479i, 0.00677505554809188 + 0.0077459761907249436i, -0.008047691381067 + 0.013802139673976695i, 0.00148333775562056 + -0.007237839659017078i, 0.12630375376436326 + -1.938011383317839e-18i, 0.006215493706036403 + 0.0022514089708683006i, 0.005933751829494756 + -0.00024436649447886024i, 0.006831436628785985 + -0.006508834322098214i }, { -0.0005792674317311593 + -0.0036116467688831746i, 0.09315696354383793 + -0.004863373818060474i, 0.004486314635632125 + 0.0019210335459293717i, -0.007610711696074952 + 0.014742812107069066i, 0.006215493706036402 + -0.0022514089708683027i, 0.10364524062296633 + -2.1412992906588713e-18i, 0.00667588048071472 + 0.006657290297843495i, 0.001562536614868376 + -0.0001119552876173214i }, { -0.00904973105955082 + 0.013509729170662349i, 0.0013384921590253666 + -0.007451988675646058i, 0.12031317919449351 + -0.016633871864910735i, 0.0068704582797035705 + 0.007652514784109795i, 0.005933751829494757 + 0.0002443664944788595i, 0.006675880480714718 + -0.006657290297843495i, 0.1259366897732311 + -2.168404344971009e-18i, 0.006444050478908309 + 0.0021841427903693516i }, { 0.004484383756690389 + 0.0018324591228976626i, -0.008241469224764993 + 0.014318535122173834i, -0.00037999470432550507 + -0.003563721212482303i, 0.09221710634820002 + -0.004280658604662099i, 0.006831436628785986 + 0.006508834322098213i, 0.0015625366148683789 + 0.00011195528761731837i, 0.006444050478908307 + -0.0021841427903693507i, 0.10313503128500263 + -2.7985968577282083e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.15791041042691006, 1.0e-7), DoubleNear(0.11423397303295568, 1.0e-7), DoubleNear(0.15618128664310954, 1.0e-7), DoubleNear(0.11265361445146052, 1.0e-7), DoubleNear(0.12630375376436326, 1.0e-7), DoubleNear(0.10364524062296633, 1.0e-7), DoubleNear(0.1259366897732311, 1.0e-7), DoubleNear(0.10313503128500263, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.1349657929809775 + -2.2429432443293873e-18i, 0.003746541367165105 + 0.006955185345697239i, -0.010127700622077764 + -0.00025560518318725964i, 0.0020358907791339373 + -0.0051438314483784634i, 0.01437574272151753 + -0.06884293205923181i, 0.0029485791165807275 + -0.0005434656054447035i, -0.0009269445630410782 + 0.007797489008699508i, -0.0027993814243816263 + -0.0010938902598436465i }, { 0.003746541367165104 + -0.006955185345697239i, 0.10362637131713785 + -3.0018847650692404e-18i, 0.001818889009512411 + 0.005315144898813217i, -0.008271149775376135 + 0.00035310292962662665i, -0.004127248858579423 + -0.0033247044110266094i, 0.010381893173754833 + -0.05285170553477189i, 0.002980487687061773 + -0.0004009675723945119i, -0.0005108801405928334 + 0.004274110447719887i }, { -0.01012770062207776 + 0.0002556051831872691i, 0.0018188890095124088 + -0.005315144898813217i, 0.13503586806080412 + -2.879912020664621e-18i, 0.003574022722400814 + 0.007200187234086009i, -0.0006260007841422258 + 0.00255979342378165i, -0.002322426775551245 + -0.0014150734079465003i, 0.006042112752668133 + -0.0690876337243051i, 0.004862472922603264 + -0.002218808685180309i }, { 0.0020358907791339395 + 0.0051438314483784634i, -0.008271149775376135 + -0.0003531029296266206i, 0.0035740227224008133 + -0.007200187234086007i, 0.10307006227115495 + -5.210946691508456e-18i, 0.0024171673905928432 + -0.0008866435760957576i, -0.0007305972140529181 + 0.0041721622054328045i, -0.0024626657005989627 + -0.0014450840441783252i, 0.005400773362317243 + -0.05280954795192448i }, { 0.014375742721517532 + 0.06884293205923181i, -0.004127248858579423 + 0.00332470441102661i, -0.0006260007841422295 + -0.002559793423781648i, 0.0024171673905928432 + 0.0008866435760957566i, 0.14924837121029583 + -3.313592889658823e-18i, 0.0038385321097722377 + 0.00792666853456458i, -0.011123608729648278 + 0.0005872463020605721i, 0.0020300373768231787 + -0.005581318093362098i }, { 0.0029485791165807275 + 0.0005434656054447033i, 0.010381893173754837 + 0.05285170553477189i, -0.0023224267755512446 + 0.0014150734079465014i, -0.0007305972140529225 + -0.004172162205432804i, 0.0038385321097722364 + -0.007926668534564581i, 0.11425284233878416 + -2.120970499924768e-18i, 0.0020801287231971086 + 0.005756120693580026i, -0.009073982949578865 + 0.00015476794265561773i }, { -0.0009269445630410837 + -0.007797489008699506i, 0.0029804876870617725 + 0.0004009675723945108i, 0.0060421127526681375 + 0.0690876337243051i, -0.0024626657005989627 + 0.001445084044178326i, -0.011123608729648276 + -0.0005872463020605746i, 0.002080128723197107 + -0.005756120693580026i, 0.14708210835553653 + -1.4026865606531214e-18i, 0.004240594708864207 + 0.007556716410515477i }, { -0.0027993814243816263 + 0.0010938902598436472i, -0.0005108801405928351 + -0.004274110447719887i, 0.004862472922603263 + 0.0022188086851803075i, 0.005400773362317245 + 0.05280954795192448i, 0.0020300373768231796 + 0.005581318093362096i, -0.009073982949578865 + -0.00015476794265561686i, 0.004240594708864205 + -0.007556716410515476i, 0.11271858346530819 + -3.7947076036992655e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.1349657929809775, 1.0e-7), DoubleNear(0.10362637131713785, 1.0e-7), DoubleNear(0.13503586806080412, 1.0e-7), DoubleNear(0.10307006227115495, 1.0e-7), DoubleNear(0.14924837121029583, 1.0e-7), DoubleNear(0.11425284233878416, 1.0e-7), DoubleNear(0.14708210835553653, 1.0e-7), DoubleNear(0.11271858346530819, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.14976585017807664 + -2.791820594150174e-18i, 0.0012752107195171988 + 0.012054017677366123i, 0.11512405737056677 + 0.01621591426309993i, -0.00048095677943444325 + 0.0034189075981241705i, 0.011269143540802051 + -0.07648198796719068i, 0.006290314079583161 + 0.00011933106916738089i, 0.016960177551358514 + -0.057646734115711806i, 0.0017757819008361161 + 0.0004803789678430303i }, { 0.0012752107195171973 + -0.012054017677366122i, 0.108117944003364 + -5.3261431723350405e-18i, 0.006511353167191588 + -0.00736286920596255i, 0.08835341744457142 + 0.004333752950610696i, -0.0059308141926022045 + -0.0014991748646812062i, 0.008314588956804304 + -0.05529614014493365i, -0.003257779543417054 + -0.0038183357105126166i, 0.00899277205550612 + -0.0447693236374569i }, { 0.11512405737056677 + -0.01621591426309994i, 0.006511353167191586 + 0.00736286920596255i, 0.120235810863705 + -2.3310346708438345e-18i, 0.006045353370048721 + 0.0021013549024171243i, 0.00044978061448721837 + -0.05997492208391012i, 0.004211634987587858 + -0.0028200359753257857i, 0.009148711933383614 + -0.06144857781634623i, 0.0015207379596008312 + -0.002881605359792393i }, { -0.0004809567794344413 + -0.0034189075981241723i, 0.08835341744457142 + -0.0043337529506107045i, 0.006045353370048719 + -0.002101354902417125i, 0.09857848958492882 + -2.8866882842426556e-18i, -0.0017222221394720704 + -4.731600078326163e-05i, 0.004501487305899666 + -0.0455622250491131i, -0.0006591003665761813 + -0.0032706135905237283i, 0.007468077579267773 + -0.050365113341762725i }, { 0.011269143540802053 + 0.07648198796719069i, -0.0059308141926022045 + 0.0014991748646812075i, 0.0004497806144872214 + 0.059974922083910115i, -0.0017222221394720704 + 4.731600078326174e-05i, 0.16432584689194296 + -2.9408983928669308e-18i, 0.0014649360037404548 + 0.01314918808625953i, 0.12634955076942073 + 0.01774840101935868i, -0.0004783053566222216 + 0.0037564603832413055i }, { 0.0062903140795831595 + -0.00011933106916738165i, 0.008314588956804307 + 0.05529614014493365i, 0.004211634987587859 + 0.002820035975325787i, 0.004501487305899667 + 0.04556222504911311i, 0.0014649360037404518 + -0.01314918808625953i, 0.1187696434810522 + -3.8624702394796095e-18i, 0.007134160660603868 + -0.008035621768872191i, 0.09702065244746652 + 0.004810279472111863i }, { 0.016960177551358525 + 0.057646734115711806i, -0.003257779543417054 + 0.0038183357105126174i, 0.009148711933383617 + 0.06144857781634623i, -0.0006591003665761812 + 0.003270613590523728i, 0.12634955076942073 + -0.017748401019358692i, 0.007134160660603865 + 0.00803562176887219i, 0.1320046326738894 + -1.7753810574450135e-18i, 0.006614190814895991 + 0.002334196858820528i }, { 0.0017757819008361166 + -0.0004803789678430317i, 0.008992772055506127 + 0.0447693236374569i, 0.0015207379596008316 + 0.0028816053597923923i, 0.0074680775792677736 + 0.05036511334176273i, -0.0004783053566222231 + -0.0037564603832413055i, 0.09702065244746652 + -0.004810279472111869i, 0.00661419081489599 + -0.0023341968588205283i, 0.10820178232304015 + -2.053207864144424e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.14976585017807664, 1.0e-7), DoubleNear(0.108117944003364, 1.0e-7), DoubleNear(0.120235810863705, 1.0e-7), DoubleNear(0.09857848958492882, 1.0e-7), DoubleNear(0.16432584689194296, 1.0e-7), DoubleNear(0.1187696434810522, 1.0e-7), DoubleNear(0.1320046326738894, 1.0e-7), DoubleNear(0.10820178232304015, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.13948055884317545 + -4.695950659577841e-18i, -0.02635670918009015 + -0.05782210187275842i, -0.022644340024432167 + 0.0004350832994786573i, 0.0111550475808599 + 0.018519670588099217i, 0.11014589006805323 + 0.011377040622902509i, -0.015328413493128207 + -0.046622533739995226i, -0.008210631009053676 + -0.014997800134588807i, 0.004124253409569088 + 0.007746683586893529i }, { -0.02635670918009015 + 0.05782210187275842i, 0.1326638246166903 + -1.904130065427667e-18i, 0.010347669788294331 + -0.019380443122259044i, -0.02344839049661201 + 0.0007607504737730812i, -0.024295372876093492 + 0.04261093019639969i, 0.10417150242127869 + 0.010816776612705841i, 0.006390699186357996 + -0.009588961936451278i, -0.009080569275262134 + -0.01283046415824737i }, { -0.022644340024432164 + -0.0004350832994786465i, 0.010347669788294335 + 0.01938044312225904i, 0.13689418693350106 + -2.9815559743351372e-18i, -0.02807086307345979 + -0.058003821208851704i, -0.007658591280729048 + -0.014701158697196693i, 0.002682546449422645 + 0.008585462261800104i, 0.1080619723974378 + 0.010694937016460546i, -0.017926850850714986 + -0.04736145728922673i }, { 0.011155047580859893 + -0.018519670588099217i, -0.023448390496612008 + -0.0007607504737730743i, -0.02807086307345978 + 0.058003821208851704i, 0.131940714161069 + -5.339695699491109e-18i, 0.006480447148101757 + -0.00756880316881379i, -0.007999811796412907 + -0.013843793083849063i, -0.026437277228828875 + 0.04335995927603847i, 0.10446831314525573 + 0.010219593453112269i }, { 0.11014589006805323 + -0.011377040622902521i, -0.024295372876093495 + -0.04261093019639969i, -0.007658591280729046 + 0.014701158697196695i, 0.006480447148101757 + 0.007568803168813789i, 0.11809246044645091 + -2.019326546254252e-18i, -0.021453386421390934 + -0.04793605178478681i, 0.0037524615460988865 + -0.0005773886887795546i, -0.0009763907844161522 + -0.003194144905687887i }, { -0.015328413493128204 + 0.046622533739995226i, 0.10417150242127869 + -0.010816776612705852i, 0.002682546449422642 + -0.008585462261800108i, -0.007999811796412907 + 0.013843793083849067i, -0.02145338642139093 + 0.04793605178478681i, 0.11185653394087869 + -2.0599841277224584e-18i, -0.001577319115355912 + 0.0015684862571104768i, 0.0037438268982642455 + 0.00022106690668337298i }, { -0.008210631009053674 + 0.01499780013458881i, 0.006390699186357997 + 0.009588961936451278i, 0.10806197239743778 + -0.010694937016460557i, -0.02643727722882888 + -0.04335995927603847i, 0.0037524615460988874 + 0.0005773886887795527i, -0.001577319115355913 + -0.0015684862571104775i, 0.11656751825199041 + -1.4230153513872246e-18i, -0.023671910840498616 + -0.04877296461777089i }, { 0.004124253409569088 + -0.007746683586893531i, -0.009080569275262136 + 0.012830464158247373i, -0.017926850850714986 + 0.04736145728922673i, 0.10446831314525573 + -0.010219593453112278i, -0.0009763907844161514 + 0.0031941449056878887i, 0.003743826898264248 + -0.00022106690668337482i, -0.023671910840498613 + 0.04877296461777089i, 0.11250420280624332 + -3.543985851311993e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.13948055884317545, 1.0e-7), DoubleNear(0.1326638246166903, 1.0e-7), DoubleNear(0.13689418693350106, 1.0e-7), DoubleNear(0.131940714161069, 1.0e-7), DoubleNear(0.11809246044645091, 1.0e-7), DoubleNear(0.11185653394087869, 1.0e-7), DoubleNear(0.11656751825199041, 1.0e-7), DoubleNear(0.11250420280624332, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.12237918626456906 + -3.74049749507499e-18i, -0.022654640631451388 + -0.05003930781061945i, -0.00900388327487137 + -0.00021122084906630557i, 0.004882845961804702 + 0.007240066567806585i, 0.012709284528209425 + -0.062477938339011205i, -0.02749127944248307 + 0.00760180566746476i, -0.0007358782835362935 + 0.0059690915821910984i, 0.0055836520395984145 + -0.002430264349264855i }, { -0.022654640631451388 + 0.05003930781061945i, 0.1162129780335463 + -1.5043305143236374e-18i, 0.004099260872112958 + -0.00843357547787352i, -0.009394967122582532 + 0.0003087185955056726i, 0.024231907483404987 + 0.015593923046150922i, 0.01204835136706294 + -0.05921669925499249i, -0.005086044614319199 + -0.0034598749769296586i, -0.0007019464200976181 + 0.006102507874228295i }, { -0.009003883274871368 + 0.00021122084906631506i, 0.0040992608721129595 + 0.008433575477873517i, 0.12127598496778091 + -3.3068166260807885e-18i, -0.024820749302918037 + -0.051302348689589064i, -0.00033729520646026483 + 0.0033149296145296684i, 0.0035628062887256115 + -0.0010424293570574128i, 0.005758100247492241 + -0.06195058063274552i, -0.027768610696512746 + 0.008913460157198528i }, { 0.004882845961804697 + -0.007240066567806585i, -0.00939496712258253 + -0.0003087185955056665i, -0.02482074930291803 + 0.051302348689589064i, 0.11682994536417816 + -4.784042086092288e-18i, -0.0019506329391424716 + -0.0020502433733274785i, -0.0010193027917348792 + 0.003417026014684786i, 0.02405281605879521 + 0.01645631688350422i, 0.005684785867493136 + -0.05994660104348406i }, { 0.012709284528209427 + 0.06247793833901122i, 0.024231907483404987 + -0.015593923046150922i, -0.00033729520646026933 + -0.0033149296145296684i, -0.0019506329391424716 + 0.0020502433733274802i, 0.13519383302505733 + -2.9747797107571028e-18i, -0.025155454970029696 + -0.055718845846925776i, -0.00988799520346191 + 6.891545976540827e-05i, 0.005295810834639046 + 0.008085459114604746i }, { -0.02749127944248307 + -0.00760180566746476i, 0.01204835136706294 + 0.05921669925499249i, 0.0035628062887256115 + 0.0010424293570574115i, -0.0010193027917348827 + -0.0034170260146847834i, -0.02515545497002969 + 0.05571884584692578i, 0.12830738052402269 + -2.459783678826488e-18i, 0.004671089800825461 + -0.009378381387275047i, -0.010309596475765233 + 0.0006730987849507817i }, { -0.0007358782835362973 + -0.0059690915821910984i, -0.005086044614319197 + 0.00345987497692966i, 0.005758100247492244 + 0.06195058063274553i, 0.02405281605879521 + -0.01645631688350422i, -0.009887995203461907 + -6.891545976540886e-05i, 0.004671089800825462 + 0.009378381387275047i, 0.13218572021771058 + -1.0977546996415732e-18i, -0.026922024611040367 + -0.05547443713703353i }, { 0.005583652039598414 + 0.002430264349264854i, -0.0007019464200976215 + -0.006102507874228294i, -0.027768610696512746 + -0.008913460157198527i, 0.005684785867493139 + 0.05994660104348406i, 0.005295810834639043 + -0.008085459114604744i, -0.010309596475765232 + -0.0006730987849507826i, -0.026922024611040363 + 0.05547443713703353i, 0.12761497160313415 + -4.099639464710814e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.12237918626456906, 1.0e-7), DoubleNear(0.1162129780335463, 1.0e-7), DoubleNear(0.12127598496778091, 1.0e-7), DoubleNear(0.11682994536417816, 1.0e-7), DoubleNear(0.13519383302505733, 1.0e-7), DoubleNear(0.12830738052402269, 1.0e-7), DoubleNear(0.13218572021771058, 1.0e-7), DoubleNear(0.12761497160313415, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.131771774841046 + -4.607859233063394e-18i, -0.02595299740466442 + -0.05522207523623528i, 0.10403918156724065 + 0.010523830708942751i, -0.01585872404693983 + -0.04482104545487958i, 0.0099725934573284 + -0.06729696532821691i, -0.030142100463847344 + 0.009045931770760768i, 0.013270429496733096 + -0.05232125629120334i, -0.02402726195727563 + 0.00469328552915596i }, { -0.02595299740466441 + 0.05522207523623528i, 0.12611201934039462 + -3.5101045334218206e-18i, -0.02419878375561579 + 0.040996954332330984i, 0.09943829324789756 + 0.01002583650476787i, 0.026288951763724 + 0.017492561875681392i, 0.009611139040277956 + -0.06448116278390742i, 0.01915852132529669 + 0.015543555878705321i, 0.012682520110131539 + -0.05009480146196537i }, { 0.10403918156724064 + -0.010523830708942764i, -0.024198783755615794 + -0.040996954332330984i, 0.11188339639130399 + -2.439454888092385e-18i, -0.02152239252970501 + -0.04611958126397324i, 0.002526371081717051 + -0.053931284955425915i, -0.02271458993907942 + 0.009210622140400266i, 0.008494791318373267 + -0.05713155364353982i, -0.025117789675148473 + 0.007469334053902521i }, { -0.015858724046939828 + 0.04482104545487958i, 0.09943829324789756 + -0.01002583650476788i, -0.021522392529705003 + 0.046119581263973246i, 0.10693090405732983 + -2.778268066994105e-18i, 0.02176814923042861 + 0.0115480782534182i, 0.0024248968386698334 + -0.051605862177597314i, 0.021995771778476197 + 0.01455767805397375i, 0.00812199819427812 + -0.054682137514569136i }, { 0.009972593457328403 + 0.06729696532821693i, 0.026288951763724 + -0.017492561875681392i, 0.002526371081717053 + 0.05393128495542591i, 0.02176814923042861 + -0.0115480782534182i, 0.14460297093563051 + -3.0696474008495844e-18i, -0.028474574848885523 + -0.06060384784537485i, 0.11416868089825039 + 0.011548146930420305i, -0.01739654029690336 + -0.04916294557434237i }, { -0.030142100463847344 + -0.009045931770760768i, 0.009611139040277956 + 0.06448116278390742i, -0.022714589939079415 + -0.009210622140400264i, 0.002424896838669835 + 0.051605862177597314i, -0.02847457484888552 + 0.060603847845374856i, 0.13849251943736463 + -3.733721231496956e-18i, -0.02653386634930658 + 0.04497393514010718i, 0.10920152231863686 + 0.011010533561050239i }, { 0.013270429496733106 + 0.05232125629120334i, 0.019158521325296687 + -0.015543555878705324i, 0.008494791318373269 + 0.05713155364353982i, 0.021995771778476197 + -0.01455767805397375i, 0.11416868089825039 + -0.011548146930420312i, -0.026533866349306583 + -0.04497393514010718i, 0.12277658230713735 + -1.0028870095490916e-18i, -0.023602904732184543 + -0.05058943513858446i }, { -0.024027261957275635 + -0.004693285529155957i, 0.012682520110131545 + 0.05009480146196536i, -0.025117789675148473 + -0.007469334053902519i, 0.008121998194278123 + 0.054682137514569136i, -0.017396540296903358 + 0.04916294557434237i, 0.10920152231863686 + -0.011010533561050249i, -0.023602904732184536 + 0.05058943513858446i, 0.11742983268979218 + -2.825701912040346e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.131771774841046, 1.0e-7), DoubleNear(0.12611201934039462, 1.0e-7), DoubleNear(0.11188339639130399, 1.0e-7), DoubleNear(0.10693090405732983, 1.0e-7), DoubleNear(0.14460297093563051, 1.0e-7), DoubleNear(0.13849251943736463, 1.0e-7), DoubleNear(0.12277658230713735, 1.0e-7), DoubleNear(0.11742983268979218, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.1291340724711178 + -2.7985968577282083e-18i, -0.02197231681567926 + 0.00013887961010258148i, 0.10184251132728617 + 0.010349119369329338i, -0.007948320015666244 + -0.013394885658613515i, 0.01505428574646015 + -0.06580901208775417i, -0.0017264321566315126 + 0.015030811023196367i, 0.015787215574944297 + -0.04913060277471695i, -0.010076075823526112 + 0.004092869084840384i }, { -0.021972316815679252 + -0.00013887961010256673i, 0.12874972171032284 + -5.319366908757006e-18i, -0.007758693125557382 + -0.01347811903197551i, 0.10163496348785205 + 0.010200547844381284i, -0.0016107296548483598 + 0.00742481314231117i, 0.0045294467511462055 + -0.06596911602437017i, -0.0048487712797404756 + 0.001892644892938135i, 0.01016573403192034 + -0.05328545497845176i }, { 0.10184251132728617 + -0.010349119369329349i, -0.007758693125557383 + 0.01347811903197551i, 0.10945809182699758 + -2.4462311516704194e-18i, 0.0035734664182253554 + -4.138186366321446e-05i, 0.005348263215974392 + -0.054759544197181764i, 0.008848611551199672 + 0.006212599311370183i, 0.009703350148812215 + -0.05588562550624954i, 0.000288607452997601 + -0.002959211566776974i }, { -0.007948320015666248 + 0.013394885658613518i, 0.10163496348785203 + -0.010200547844381293i, 0.0035734664182253554 + 4.1381863663215274e-05i, 0.10935620862163623 + -2.7714918034160707e-18i, 0.003690649868635487 + 0.0038543943649514928i, -0.00039699529558750806 + -0.05077760293584146i, 0.00025413165665321585 + -0.000692857513096716i, 0.006913439363839172 + -0.05592806565185941i }, { 0.01505428574646015 + 0.06580901208775417i, -0.0016107296548483704 + -0.00742481314231117i, 0.005348263215974392 + 0.05475954419718177i, 0.0036906498686354863 + -0.003854394364951496i, 0.14301031098874795 + -3.8014838672773e-18i, -0.02412041370536492 + 0.001056954163149157i, 0.11247488116204576 + 0.011844697866279012i, -0.009342880268649566 + -0.014433378634222662i }, { -0.0017264321566315191 + -0.015030811023196367i, 0.004529446751146209 + 0.06596911602437017i, 0.008848611551199665 + -0.006212599311370184i, -0.0003969952955875035 + 0.05077760293584145i, -0.02412041370536492 + -0.001056954163149154i, 0.1400851793842472 + -3.0018847650692404e-18i, -0.007899709951584573 + -0.015066832749070246i, 0.11089532205484148 + 0.01071398262519153i }, { 0.015787215574944308 + 0.04913060277471695i, -0.0048487712797404756 + -0.0018926448929381362i, 0.009703350148812217 + 0.05588562550624954i, 0.00025413165665321845 + 0.0006928575130967186i, 0.11247488116204576 + -0.011844697866279022i, -0.00789970995158457 + 0.01506683274907025i, 0.12049090256033203 + -1.633079522306291e-18i, 0.003922822026137777 + -0.0003149399184329672i }, { -0.010076075823526116 + -0.004092869084840384i, 0.010165734031920346 + 0.05328545497845176i, 0.00028860745299760034 + 0.002959211566776975i, 0.006913439363839174 + 0.05592806565185941i, -0.009342880268649564 + 0.014433378634222664i, 0.11089532205484148 + -0.010713982625191541i, 0.003922822026137781 + 0.0003149399184329626i, 0.1197155124365975 + -2.1955093992831465e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.1291340724711178, 1.0e-7), DoubleNear(0.12874972171032284, 1.0e-7), DoubleNear(0.10945809182699758, 1.0e-7), DoubleNear(0.10935620862163623, 1.0e-7), DoubleNear(0.14301031098874795, 1.0e-7), DoubleNear(0.1400851793842472, 1.0e-7), DoubleNear(0.12049090256033203, 1.0e-7), DoubleNear(0.1197155124365975, 1.0e-7) }));


}
}

}
