#include "gtest/gtest.h"
#include "gmock/gmock.h"
#include <chrono>
#include <iostream>

#include "superpositeur/Circuit.hpp"
#include "superpositeur/DefaultOperations.hpp"

namespace superpositeur {

using namespace std::complex_literals;

using testing::ElementsAreArray;
using testing::DoubleNear;

namespace {
Circuit randomCircuit() {

    Circuit c;
    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 6 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.08415542315889146 + -0.32264006023484043i, -0.011415211943755804 + 0.10147763788558535i, 0.1235724911357202 + -0.8273374186763992i, -0.17902934879439825 + -0.3828633771891558i }, { 0.12578609773187027 + -0.5172279123931199i, -0.3760571877270801 + 0.3439927168171876i, -0.42009834137255647 + 0.2098416448274289i, 0.40560096423594005 + -0.26809489379209556i }, { -0.3430349133637006 + -0.622542091487533i, -0.24903735743356142 + -0.20937614069937732i, 0.22850545596944555 + 0.0771887141715133i, -0.18390851338377273 + 0.5448992902821075i }, { 0.0003445021612216298 + 0.3166112354317154i, -0.7789629635767968 + 0.13107521491482574i, 0.1086909627093107 + 0.09869111604697929i, -0.47674653584953397 + -0.16417148084105138i } }) }, { QubitIndex{ 5 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 3 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 2 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 4 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 5 }, QubitIndex{ 0 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 3 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { 0.4709443969330014 + 0.15795813098180447i, 0.3315831114547952 + 0.27525473170001646i, 0.3403862705451833 + 0.36061543037029753i, 0.2782720151691666 + 0.4941725007583211i }, { -0.5684038435013499 + 0.29031174762227996i, 0.21797897992494278 + 0.4294277106261113i, 0.40500406827555185 + 0.1031559835049325i, 0.17981339426685208 + -0.3920597614296888i }, { -0.3611564514083601 + -0.06579029723207953i, 0.29750945897302794 + 0.23279086773803892i, -0.23392807243071229 + -0.5863968695101908i, 0.12295790252054223 + 0.5557264710996147i }, { 0.31674624298433735 + 0.33287570606921735i, -0.5809733445144334 + 0.3195793879696681i, 0.004664755281153024 + -0.42522800280112666i, 0.3948308405076756 + -0.1116806280820784i } }) }, { QubitIndex{ 6 }, QubitIndex{ 1 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 4 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 5 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 7 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 7 }, QubitIndex{ 6 } }));

    c.addInstruction(CircuitInstruction({ Matrix({ { -0.33298907725387855 + -0.5363809701271525i, -0.08654080171639159 + 0.2861477802375104i, 0.3595003964583794 + -0.0783707336657662i, -0.6102085046687828 + 0.06562728624086725i }, { -0.3992438670982982 + -0.3612765437599603i, 0.5481462807138285 + -0.01661640881753594i, 0.0923714986169193 + 0.01064735716872367i, 0.4557023101308597 + -0.4393548542816423i }, { -0.3713855964965465 + 0.26314414175038475i, -0.562441091552264 + 0.18114713298259427i, 0.48789649729621587 + 0.22411633550323162i, 0.3862481947083024 + -0.07883427106472174i }, { 0.23980231553863562 + 0.21637946221392043i, 0.4841172891214097 + -0.1623757140721994i, 0.6286434268046243 + 0.4153407650370591i, -0.1243730748793705 + 0.22753062371123584i } }) }, { QubitIndex{ 1 }, QubitIndex{ 2 } }));

    c.addInstruction(CircuitInstruction({ default_operations::CNOT }, { QubitIndex{ 1 }, QubitIndex{ 7 } }));


    return c;
}

TEST(RandomizedIntegrationTests, 8_20_2_10_30_80) {
    auto c = randomCircuit();
    
    auto s = c.execute();

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, false}), Matrix({ { 0.39452559945655 + -1.3999760552219076e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6054744005434498 + -6.071532165918825e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.39452559945655, 1.0e-7), DoubleNear(0.6054744005434498, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, false}), Matrix({ { 0.399766440064833 + -1.3132398814230672e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6002335599351669 + -6.938893903907228e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.399766440064833, 1.0e-7), DoubleNear(0.6002335599351669, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, false}), Matrix({ { 0.5091877222879538 + -1.8214596497756474e-17i, 0.3675567543733635 + 0.07284594994220453i }, { 0.3675567543733635 + -0.07284594994220454i, 0.49081227771204605 + -1.8566962203814263e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.5091877222879538, 1.0e-7), DoubleNear(0.49081227771204605, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, false}), Matrix({ { 0.39452559945655 + -1.3999760552219076e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6054744005434498 + -6.071532165918825e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.39452559945655, 1.0e-7), DoubleNear(0.6054744005434498, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, false}), Matrix({ { 0.9999999999999999 + -2.00712927181379e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.9999999999999999, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, false}), Matrix({ { 0.6934758782597019 + -7.806255641895632e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.306524121740298 + -1.2265037076242269e-17i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.6934758782597019, 1.0e-7), DoubleNear(0.306524121740298, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, false}), Matrix({ { 0.4386348185067326 + -1.2366681029912785e-17i, -0.2826815383659362 + -0.22516429748883343i }, { -0.28268153836593624 + 0.22516429748883346i, 0.5613651814932673 + -7.704611688225116e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.4386348185067326, 1.0e-7), DoubleNear(0.5613651814932673, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, false, true}), Matrix({ { 0.7773119290512376 + -1.5612511283791264e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2226880709487623 + -4.458781434346637e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.7773119290512376, 1.0e-7), DoubleNear(0.2226880709487623, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, false}), Matrix({ { 0.20864918631055174 + -8.795590124288655e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1911172537542812 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1858764131459983 + -5.204170427930421e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4143571467891686 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.20864918631055174, 1.0e-7), DoubleNear(0.1911172537542812, 1.0e-7), DoubleNear(0.1858764131459983, 1.0e-7), DoubleNear(0.4143571467891686, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, false}), Matrix({ { 0.21792199151987093 + -8.673617379884035e-18i, 0.0 + 0.0i, 0.13214246059166623 + 0.05774965085599834i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2912657307680829 + -9.540979117872439e-18i, 0.0 + 0.0i, 0.23541429378169731 + 0.01509629908620619i }, { 0.13214246059166623 + -0.05774965085599836i, 0.0 + 0.0i, 0.17660360793667906 + -5.3261431723350405e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23541429378169731 + -0.015096299086206189i, 0.0 + 0.0i, 0.314208669775367 + 3.469446951953614e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21792199151987093, 1.0e-7), DoubleNear(0.2912657307680829, 1.0e-7), DoubleNear(0.17660360793667906, 1.0e-7), DoubleNear(0.314208669775367, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, false}), Matrix({ { 0.39452559945655 + -1.3999760552219076e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.6054744005434498 + -6.071532165918825e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.39452559945655, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6054744005434498, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, false}), Matrix({ { 0.39452559945655 + -1.3999760552219076e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6054744005434498 + -6.071532165918825e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.39452559945655, 1.0e-7), DoubleNear(0.6054744005434498, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, false}), Matrix({ { 0.27884935184996507 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.41462652640973685 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.11567624760658496 + -7.060866648311848e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19084787413371296 + -5.204170427930421e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.27884935184996507, 1.0e-7), DoubleNear(0.41462652640973685, 1.0e-7), DoubleNear(0.11567624760658496, 1.0e-7), DoubleNear(0.19084787413371296, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, false}), Matrix({ { 0.1993477465590486 + -9.81880592457185e-18i, 0.0 + 0.0i, -0.15505283173543272 + 0.004059515943061301i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23928707194768395 + -2.5478751053409354e-18i, 0.0 + 0.0i, -0.12762870663050346 + -0.22922381343189474i }, { -0.1550528317354327 + -0.004059515943061285i, 0.0 + 0.0i, 0.19517785289750142 + -4.1809546276472265e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.1276287066305035 + 0.22922381343189474i, 0.0 + 0.0i, 0.36618732859576586 + -3.5236570605778894e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1993477465590486, 1.0e-7), DoubleNear(0.23928707194768395, 1.0e-7), DoubleNear(0.19517785289750142, 1.0e-7), DoubleNear(0.36618732859576586, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, false, true}), Matrix({ { 0.29100411184861114 + -1.214306433183765e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4863078172026264 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.10352148760793888 + -1.8566962203814263e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11916658334082343 + -2.6020852139652106e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.29100411184861114, 1.0e-7), DoubleNear(0.4863078172026264, 1.0e-7), DoubleNear(0.10352148760793888, 1.0e-7), DoubleNear(0.11916658334082343, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, false}), Matrix({ { 0.25900858464425447 + -1.3010426069826053e-17i, 0.0 + 0.0i, 0.17062973042639618 + 0.0382102158386238i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.25017913764369937 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.19692702394696734 + 0.03463573410358073i }, { 0.17062973042639615 + -0.038210215838623815i, 0.0 + 0.0i, 0.1407578554205785 + -1.2197274440461925e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.19692702394696734 + -0.03463573410358073i, 0.0 + 0.0i, 0.35005442229146755 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.25900858464425447, 1.0e-7), DoubleNear(0.25017913764369937, 1.0e-7), DoubleNear(0.1407578554205785, 1.0e-7), DoubleNear(0.35005442229146755, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, false}), Matrix({ { 0.20864918631055174 + -8.795590124288655e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1858764131459983 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1911172537542812 + -4.336808689942018e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4143571467891686 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.20864918631055174, 1.0e-7), DoubleNear(0.1858764131459983, 1.0e-7), DoubleNear(0.1911172537542812, 1.0e-7), DoubleNear(0.4143571467891686, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, false}), Matrix({ { 0.399766440064833 + -1.3132398814230672e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6002335599351669 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.399766440064833, 1.0e-7), DoubleNear(0.6002335599351669, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, false}), Matrix({ { 0.2517065067569848 + -7.806255641895632e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.060476274069877205 + -0.09872462572287817i }, { 0.0 + 0.0i, 0.4417693715027171 + 0.0i, -0.17029741810801038 + -0.07812457320399391i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.1702974181080104 + 0.07812457320399391i, 0.14805993330784814 + -5.3261431723350405e-18i, 0.0 + 0.0i }, { 0.060476274069877226 + 0.09872462572287813i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15846418843244978 + -6.938893903907228e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.2517065067569848, 1.0e-7), DoubleNear(0.4417693715027171, 1.0e-7), DoubleNear(0.14805993330784814, 1.0e-7), DoubleNear(0.15846418843244978, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, false}), Matrix({ { 0.19073073275995228 + -5.4277871260055566e-18i, 0.0 + 0.0i, -0.1588822425321721 + -0.020778171394932324i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.24790408574678025 + -6.938893903907228e-18i, 0.0 + 0.0i, -0.12379929583376409 + -0.20438612609390114i }, { -0.1588822425321721 + 0.020778171394932342i, 0.0 + 0.0i, 0.20903570730488064 + -7.704611688225116e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.1237992958337641 + 0.2043861260939011i, 0.0 + 0.0i, 0.35232947418838667 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.19073073275995228, 1.0e-7), DoubleNear(0.24790408574678025, 1.0e-7), DoubleNear(0.20903570730488064, 1.0e-7), DoubleNear(0.35232947418838667, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, false, true}), Matrix({ { 0.32338779754987435 + -1.0408340855860843e-17i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08989562967049725 + 0.1346065416732698i }, { 0.0 + 0.0i, 0.45392413150136324 + -5.204170427930421e-18i, 0.1168394038586662 + 0.07979941825464708i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1168394038586662 + -0.07979941825464709i, 0.07637864251495861 + -2.72405795836983e-18i, 0.0 + 0.0i }, { -0.08989562967049726 + -0.1346065416732698i, 0.0 + 0.0i, 0.0 + 0.0i, 0.14630942843380368 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.32338779754987435, 1.0e-7), DoubleNear(0.45392413150136324, 1.0e-7), DoubleNear(0.07637864251495861, 1.0e-7), DoubleNear(0.14630942843380368, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, false}), Matrix({ { 0.21792199151987093 + -8.673617379884035e-18i, 0.13214246059166623 + 0.05774965085599834i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13214246059166623 + -0.05774965085599836i, 0.17660360793667906 + -5.3261431723350405e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2912657307680829 + -9.540979117872439e-18i, 0.23541429378169731 + 0.01509629908620619i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.23541429378169731 + -0.015096299086206189i, 0.314208669775367 + 3.469446951953614e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21792199151987093, 1.0e-7), DoubleNear(0.17660360793667906, 1.0e-7), DoubleNear(0.2912657307680829, 1.0e-7), DoubleNear(0.314208669775367, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, false}), Matrix({ { 0.5091877222879538 + -1.8214596497756474e-17i, 0.3675567543733635 + 0.07284594994220453i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.3675567543733635 + -0.07284594994220454i, 0.49081227771204605 + -1.8566962203814263e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.5091877222879538, 1.0e-7), DoubleNear(0.49081227771204605, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, false}), Matrix({ { 0.3445733625821398 + -4.336808689942018e-18i, 0.2613400194443842 + 0.035979794237913316i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.2613400194443842 + -0.03597979423791332i, 0.34890251567756214 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.16461435970581403 + -1.3877787807814457e-17i, 0.10621673492897934 + 0.03686615570429122i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.10621673492897936 + -0.03686615570429123i, 0.14190976203448388 + 1.6127507315721878e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.3445733625821398, 1.0e-7), DoubleNear(0.34890251567756214, 1.0e-7), DoubleNear(0.16461435970581403, 1.0e-7), DoubleNear(0.14190976203448388, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, false}), Matrix({ { 0.2284912051889671 + -1.235990476633475e-17i, 0.15733751695567336 + 0.040712704551375045i, -0.15928152706826873 + -0.09149458911210435i, -0.11534424163452628 + -0.14697605683244963i }, { 0.15733751695567336 + -0.04071270455137506i, 0.2101436133177655 + -6.776263578034403e-21i, -0.0692771830895499 + -0.053530630179429266i, -0.12340001129766745 + -0.1336697083767291i }, { -0.15928152706826873 + 0.09149458911210437i, -0.06927718308954993 + 0.05353063017942927i, 0.28069651709898674 + -5.854691731421724e-18i, 0.21021923741769016 + 0.032133245390829485i }, { -0.11534424163452629 + 0.14697605683244963i, -0.12340001129766746 + 0.1336697083767291i, 0.21021923741769016 + -0.03213324539082949i, 0.2806686643942805 + -1.849919956803392e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.2284912051889671, 1.0e-7), DoubleNear(0.2101436133177655, 1.0e-7), DoubleNear(0.28069651709898674, 1.0e-7), DoubleNear(0.2806686643942805, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, false, true}), Matrix({ { 0.3400858423359262 + -1.3877787807814457e-17i, 0.3654759233324525 + 0.011330710316383127i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.3654759233324525 + -0.011330710316383141i, 0.4372260867153114 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.16910187995202763 + -4.336808689942018e-18i, 0.0020808310409110107 + 0.06151523962582141i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0020808310409110124 + -0.06151523962582141i, 0.053586190996734666 + -1.2197274440461925e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.3400858423359262, 1.0e-7), DoubleNear(0.4372260867153114, 1.0e-7), DoubleNear(0.16910187995202763, 1.0e-7), DoubleNear(0.053586190996734666, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, false}), Matrix({ { 0.39452559945655 + -1.3999760552219076e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.6054744005434498 + -6.071532165918825e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.39452559945655, 1.0e-7), DoubleNear(0.6054744005434498, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, false}), Matrix({ { 0.27884935184996507 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.41462652640973685 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.11567624760658496 + -7.060866648311848e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19084787413371296 + -5.204170427930421e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.27884935184996507, 1.0e-7), DoubleNear(0.41462652640973685, 1.0e-7), DoubleNear(0.11567624760658496, 1.0e-7), DoubleNear(0.19084787413371296, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, false}), Matrix({ { 0.1993477465590486 + -9.81880592457185e-18i, 0.0 + 0.0i, -0.15505283173543272 + 0.004059515943061301i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23928707194768395 + -2.5478751053409354e-18i, 0.0 + 0.0i, -0.12762870663050346 + -0.22922381343189474i }, { -0.1550528317354327 + -0.004059515943061285i, 0.0 + 0.0i, 0.19517785289750142 + -4.1809546276472265e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.1276287066305035 + 0.22922381343189474i, 0.0 + 0.0i, 0.36618732859576586 + -3.5236570605778894e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1993477465590486, 1.0e-7), DoubleNear(0.23928707194768395, 1.0e-7), DoubleNear(0.19517785289750142, 1.0e-7), DoubleNear(0.36618732859576586, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, false, true}), Matrix({ { 0.29100411184861114 + -1.214306433183765e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4863078172026264 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.10352148760793888 + -1.8566962203814263e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11916658334082343 + -2.6020852139652106e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.29100411184861114, 1.0e-7), DoubleNear(0.4863078172026264, 1.0e-7), DoubleNear(0.10352148760793888, 1.0e-7), DoubleNear(0.11916658334082343, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, false}), Matrix({ { 0.6934758782597019 + -7.806255641895632e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.306524121740298 + -1.2265037076242269e-17i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.6934758782597019, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.306524121740298, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, false}), Matrix({ { 0.4386348185067326 + -1.2366681029912785e-17i, 0.0 + 0.0i, -0.2826815383659362 + -0.22516429748883343i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.28268153836593624 + 0.22516429748883346i, 0.0 + 0.0i, 0.5613651814932673 + -7.704611688225116e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.4386348185067326, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.5613651814932673, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, false, true}), Matrix({ { 0.7773119290512376 + -1.5612511283791264e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2226880709487623 + -4.458781434346637e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.7773119290512376, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2226880709487623, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, false}), Matrix({ { 0.29601253968749197 + -4.2825985813177425e-18i, 0.0 + 0.0i, -0.16653738306514426 + -0.14060579729142786i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1426222788192406 + -8.084082448595042e-18i, 0.0 + 0.0i, -0.11614415530079192 + -0.0845585001974056i }, { -0.16653738306514426 + 0.14060579729142783i, 0.0 + 0.0i, 0.39746333857220995 + -3.5236570605778894e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.11614415530079192 + 0.08455850019740563i, 0.0 + 0.0i, 0.16390184292105733 + -4.1809546276472265e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.29601253968749197, 1.0e-7), DoubleNear(0.1426222788192406, 1.0e-7), DoubleNear(0.39746333857220995, 1.0e-7), DoubleNear(0.16390184292105733, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, false, true}), Matrix({ { 0.54689707020533 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09706422643069644 + -0.026933881591907096i }, { 0.0 + 0.0i, 0.23041485884590757 + -8.673617379884035e-18i, -0.09706422643069645 + -0.026933881591907103i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.09706422643069645 + 0.026933881591907093i, 0.14657880805437193 + -8.673617379884035e-19i, 0.0 + 0.0i }, { 0.09706422643069645 + 0.026933881591907096i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07610926289439038 + -3.5914196963582334e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.54689707020533, 1.0e-7), DoubleNear(0.23041485884590757, 1.0e-7), DoubleNear(0.14657880805437193, 1.0e-7), DoubleNear(0.07610926289439038, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, false, true, true}), Matrix({ { 0.3362257391022145 + -8.673617379884035e-18i, -0.20562133750616704 + -0.19631812535870707i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.20562133750616707 + 0.19631812535870707i, 0.44108618994902304 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.10240907940451807 + -3.6930636500287495e-18i, -0.07706020085976914 + -0.028846172130126368i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.07706020085976914 + 0.028846172130126392i, 0.12027899154424423 + -7.657177843178875e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.3362257391022145, 1.0e-7), DoubleNear(0.44108618994902304, 1.0e-7), DoubleNear(0.10240907940451807, 1.0e-7), DoubleNear(0.12027899154424423, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, true, false, false, false, false, false}), Matrix({ { 0.12680606363222643 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09485205686733895 + 0.024888620808969506i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.132202521012028 + -7.806255641895632e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07577767355905723 + 0.013321595029654298i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09111592788764451 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.037290403724327265 + 0.03286103004702884i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15906320975605492 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1596366202226401 + 0.0017747040565518936i }, { 0.09485205686733895 + -0.024888620808969513i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0818431226783253 + -3.5914196963582334e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.07577767355905722 + -0.013321595029654298i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05891473274225323 + 3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.03729040372432727 + -0.032861030047028846i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09476048525835379 + -1.734723475976807e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1596366202226401 + -0.0017747040565518901i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2552939370331137 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, true, false, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12680606363222643, 1.0e-7), DoubleNear(0.132202521012028, 1.0e-7), DoubleNear(0.09111592788764451, 1.0e-7), DoubleNear(0.15906320975605492, 1.0e-7), DoubleNear(0.0818431226783253, 1.0e-7), DoubleNear(0.05891473274225323, 1.0e-7), DoubleNear(0.09476048525835379, 1.0e-7), DoubleNear(0.2552939370331137, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, true, false, false, false, false}), Matrix({ { 0.20864918631055174 + -8.795590124288655e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.043964595942516976 + -0.1572273135519551i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1858764131459983 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.10355092190859737 + 0.052189406777794975i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.10355092190859735 + -0.052189406777794975i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1911172537542812 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.043964595942517004 + 0.15722731355195513i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4143571467891686 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.20864918631055174, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1858764131459983, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1911172537542812, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4143571467891686, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, true, false, false, false}), Matrix({ { 0.20864918631055174 + -8.795590124288655e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1911172537542812 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1858764131459983 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4143571467891686 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.20864918631055174, 1.0e-7), DoubleNear(0.1911172537542812, 1.0e-7), DoubleNear(0.1858764131459983, 1.0e-7), DoubleNear(0.4143571467891686, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, true, false, false}), Matrix({ { 0.19198852527628896 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07250308872647056 + -0.0628768824149274i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.05971798148069584 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.012026814656593351 + -0.035847743307950763i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.08686082657367611 + 0.0i, 0.0 + 0.0i, -0.0012379452150879135 + -0.02027038756440863i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.354908544929041 + 0.0i, 0.0 + 0.0i, -0.16905947289292247 + -0.057854185639585276i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.00123794521508791 + 0.020270387564408625i, 0.0 + 0.0i, 0.016660661034262773 + -1.8566962203814263e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.1690594728929225 + 0.057854185639585276i, 0.0 + 0.0i, 0.13139927227358536 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07250308872647057 + 0.06287688241492737i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09901558657232218 + -5.204170427930421e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.01202681465659335 + 0.035847743307950763i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0594486018601276 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.19198852527628896, 1.0e-7), DoubleNear(0.05971798148069584, 1.0e-7), DoubleNear(0.08686082657367611, 1.0e-7), DoubleNear(0.354908544929041, 1.0e-7), DoubleNear(0.016660661034262773, 1.0e-7), DoubleNear(0.13139927227358536, 1.0e-7), DoubleNear(0.09901558657232218, 1.0e-7), DoubleNear(0.0594486018601276, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, true, false}), Matrix({ { 0.10793194843481624 + -4.614635496641428e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.09200843462489823 + 0.030535739389311055i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.08279878432513604 + -8.131516293641283e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06687380790727386 + -0.051313910784243376i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09141579812423235 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06304439711053449 + -0.026476223446249753i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1564882876225479 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0607548987232296 + -0.17790990264765139i }, { -0.09200843462489822 + -0.03053573938931105i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1007172378757355 + -4.1809546276472265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.06687380790727386 + 0.0513139107842434i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10831846942914516 + -3.5236570605778894e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.06304439711053447 + 0.026476223446249766i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09446061502176593 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06075489872322964 + 0.17790990264765136i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2578688591666207 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.10793194843481624, 1.0e-7), DoubleNear(0.08279878432513604, 1.0e-7), DoubleNear(0.09141579812423235, 1.0e-7), DoubleNear(0.1564882876225479, 1.0e-7), DoubleNear(0.1007172378757355, 1.0e-7), DoubleNear(0.10831846942914516, 1.0e-7), DoubleNear(0.09446061502176593, 1.0e-7), DoubleNear(0.2578688591666207, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, true, false, false, false, false, false, true}), Matrix({ { 0.19198852527628896 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.053369142249594076 + 0.07991306915161756i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.13139927227358536 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03652648742090317 + 0.054693472521652256i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09901558657232218 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.025486466360715027 + 0.0174068432547967i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.354908544929041 + 0.0i, 0.0 + 0.0i, 0.09135293749795118 + 0.062392574999850375i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.02548646636071503 + -0.017406843254796706i, 0.0 + 0.0i, 0.016660661034262773 + -1.8566962203814263e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09135293749795118 + -0.062392574999850375i, 0.0 + 0.0i, 0.05971798148069584 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.053369142249594076 + -0.07991306915161756i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08686082657367611 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.036526487420903184 + -0.054693472521652256i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0594486018601276 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, true, false, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.19198852527628896, 1.0e-7), DoubleNear(0.13139927227358536, 1.0e-7), DoubleNear(0.09901558657232218, 1.0e-7), DoubleNear(0.354908544929041, 1.0e-7), DoubleNear(0.016660661034262773, 1.0e-7), DoubleNear(0.05971798148069584, 1.0e-7), DoubleNear(0.08686082657367611, 1.0e-7), DoubleNear(0.0594486018601276, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, true, false, false, false, false}), Matrix({ { 0.21792199151987093 + -8.673617379884035e-18i, 0.0 + 0.0i, 0.13214246059166623 + 0.05774965085599834i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13214246059166623 + -0.05774965085599836i, 0.0 + 0.0i, 0.17660360793667906 + -5.3261431723350405e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2912657307680829 + -9.540979117872439e-18i, 0.0 + 0.0i, 0.23541429378169731 + 0.01509629908620619i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23541429378169731 + -0.015096299086206189i, 0.0 + 0.0i, 0.314208669775367 + 3.469446951953614e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.21792199151987093, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.17660360793667906, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.2912657307680829, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.314208669775367, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, true, false, false, false}), Matrix({ { 0.21792199151987093 + -8.673617379884035e-18i, 0.0 + 0.0i, 0.13214246059166623 + 0.05774965085599834i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2912657307680829 + -9.540979117872439e-18i, 0.0 + 0.0i, 0.23541429378169731 + 0.01509629908620619i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13214246059166623 + -0.05774965085599836i, 0.0 + 0.0i, 0.17660360793667906 + -5.3261431723350405e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23541429378169731 + -0.015096299086206189i, 0.0 + 0.0i, 0.314208669775367 + 3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21792199151987093, 1.0e-7), DoubleNear(0.2912657307680829, 1.0e-7), DoubleNear(0.17660360793667906, 1.0e-7), DoubleNear(0.314208669775367, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, true, false, false}), Matrix({ { 0.16891532921680835 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.08215057275049734 + 0.06617331025044781i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.17565803336533148 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.17918944669388687 + -0.030193516012534498i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08215057275049734 + -0.06617331025044781i, 0.0 + 0.0i, 0.10993402263315671 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.17918944669388687 + 0.0301935160125345i, 0.0 + 0.0i, 0.2389684930444054 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04900666230306261 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.04999188784116888 + -0.00842365939444947i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11560769740275144 + -8.673617379884035e-18i, 0.0 + 0.0i, 0.05622484708781047 + 0.04528981509874069i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04999188784116888 + 0.008423659394449461i, 0.0 + 0.0i, 0.06666958530352236 + -1.8566962203814263e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05622484708781046 + -0.04528981509874069i, 0.0 + 0.0i, 0.07524017673096153 + 3.469446951953614e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.16891532921680835, 1.0e-7), DoubleNear(0.17565803336533148, 1.0e-7), DoubleNear(0.10993402263315671, 1.0e-7), DoubleNear(0.2389684930444054, 1.0e-7), DoubleNear(0.04900666230306261, 1.0e-7), DoubleNear(0.11560769740275144, 1.0e-7), DoubleNear(0.06666958530352236, 1.0e-7), DoubleNear(0.07524017673096153, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, true, false}), Matrix({ { 0.11095037077663507 + -8.023096076392733e-18i, 0.0 + 0.0i, 0.0661367310235645 + 0.0306066821567472i, 0.0 + 0.0i, -0.08899265583269642 + 0.011737250612642396i, 0.0 + 0.0i, -0.06616940028817302 + -0.034209128342898465i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.117540834412332 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.09120078593210885 + 0.010106022394627849i, 0.0 + 0.0i, -0.07028887123557231 + -0.10323183972474675i, 0.0 + 0.0i, -0.04917484134635326 + -0.11276692848955118i }, { 0.0661367310235645 + -0.030606682156747212i, 0.0 + 0.0i, 0.08839737578241352 + -1.7957098481791167e-18i, 0.0 + 0.0i, -0.032640738064045396 + 0.02258325951727387i, 0.0 + 0.0i, -0.06606017590273629 + -0.007677734669581095i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.09120078593210885 + -0.010106022394627847i, 0.0 + 0.0i, 0.12174623753535196 + 1.7889335846010823e-18i, 0.0 + 0.0i, -0.036636445025504505 + -0.07611388969670313i, 0.0 + 0.0i, -0.05733983539493116 + -0.12599197370714801i }, { -0.08899265583269642 + -0.011737250612642388i, 0.0 + 0.0i, -0.0326407380640454 + -0.02258325951727388i, 0.0 + 0.0i, 0.10697162074323588 + -6.505213034913027e-19i, 0.0 + 0.0i, 0.06600572956810172 + 0.027142968699251147i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.07028887123557231 + 0.10323183972474675i, 0.0 + 0.0i, -0.03663644502550453 + 0.07611388969670314i, 0.0 + 0.0i, 0.1737248963557509 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.14421350784958845 + 0.0049902766915783416i }, { -0.06616940028817303 + 0.034209128342898465i, 0.0 + 0.0i, -0.06606017590273627 + 0.007677734669581098i, 0.0 + 0.0i, 0.06600572956810172 + -0.027142968699251153i, 0.0 + 0.0i, 0.08820623215426555 + -3.530433324155924e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.04917484134635327 + 0.11276692848955117i, 0.0 + 0.0i, -0.057339835394931184 + 0.125991973707148i, 0.0 + 0.0i, 0.14421350784958845 + -0.0049902766915783416i, 0.0 + 0.0i, 0.19246243224001497 + 1.6805133673525319e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.11095037077663507, 1.0e-7), DoubleNear(0.117540834412332, 1.0e-7), DoubleNear(0.08839737578241352, 1.0e-7), DoubleNear(0.12174623753535196, 1.0e-7), DoubleNear(0.10697162074323588, 1.0e-7), DoubleNear(0.1737248963557509, 1.0e-7), DoubleNear(0.08820623215426555, 1.0e-7), DoubleNear(0.19246243224001497, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, true, false, false, false, false, true}), Matrix({ { 0.14449164514441376 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.13735433586750062 + 0.01902532819825127i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.19559419719151241 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.2281215874649519 + -0.0076946178818681436i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13735433586750062 + -0.019025328198251285i, 0.0 + 0.0i, 0.14651246670419737 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.2281215874649519 + 0.007694617881868145i, 0.0 + 0.0i, 0.290713620011114 + 3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07343034637545717 + -1.734723475976807e-18i, 0.0 + 0.0i, -0.005211875275834399 + 0.03872432265774707i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09567153357657046 + -2.6020852139652106e-18i, 0.0 + 0.0i, 0.00729270631674541 + 0.022790916968074334i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0052118752758343965 + -0.03872432265774708i, 0.0 + 0.0i, 0.030091141232481692 + -1.2197274440461925e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.007292706316745409 + -0.022790916968074334i, 0.0 + 0.0i, 0.02349504976425297 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.14449164514441376, 1.0e-7), DoubleNear(0.19559419719151241, 1.0e-7), DoubleNear(0.14651246670419737, 1.0e-7), DoubleNear(0.290713620011114, 1.0e-7), DoubleNear(0.07343034637545717, 1.0e-7), DoubleNear(0.09567153357657046, 1.0e-7), DoubleNear(0.030091141232481692, 1.0e-7), DoubleNear(0.02349504976425297, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, true, false, false, false}), Matrix({ { 0.39452559945655 + -1.3999760552219076e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.6054744005434498 + -6.071532165918825e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.39452559945655, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.6054744005434498, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, true, false, false}), Matrix({ { 0.27884935184996507 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.029363199408518753 + 0.21157201358640565i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.41462652640973685 + -8.673617379884035e-19i, 0.09537163083714346 + 0.19328897955612823i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09537163083714346 + -0.19328897955612823i, 0.11567624760658496 + -7.060866648311848e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.029363199408518774 + -0.21157201358640565i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19084787413371296 + -5.204170427930421e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.27884935184996507, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.41462652640973685, 1.0e-7), DoubleNear(0.11567624760658496, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19084787413371296, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, true, false}), Matrix({ { 0.1993477465590486 + -9.81880592457185e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.15505283173543272 + 0.004059515943061301i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.23928707194768395 + -2.5478751053409354e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.12762870663050346 + -0.22922381343189474i }, { -0.1550528317354327 + -0.004059515943061285i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19517785289750142 + -4.1809546276472265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.1276287066305035 + 0.22922381343189474i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36618732859576586 + -3.5236570605778894e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.1993477465590486, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23928707194768395, 1.0e-7), DoubleNear(0.19517785289750142, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.36618732859576586, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, true, false, false, false, true}), Matrix({ { 0.29100411184861114 + -1.214306433183765e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.03659783067682487 + -0.08556209865670059i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4863078172026264 + -3.469446951953614e-18i, -0.03659783067682487 + -0.0855620986567006i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03659783067682489 + 0.08556209865670059i, 0.10352148760793888 + -1.8566962203814263e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03659783067682488 + 0.08556209865670059i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11916658334082343 + -2.6020852139652106e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.29100411184861114, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.4863078172026264, 1.0e-7), DoubleNear(0.10352148760793888, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11916658334082343, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, true, false, false}), Matrix({ { 0.27884935184996507 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.41462652640973685 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11567624760658496 + -7.060866648311848e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19084787413371296 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.27884935184996507, 1.0e-7), DoubleNear(0.41462652640973685, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11567624760658496, 1.0e-7), DoubleNear(0.19084787413371296, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, true, false}), Matrix({ { 0.1993477465590486 + -9.81880592457185e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.15505283173543272 + 0.004059515943061301i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23928707194768395 + -2.5478751053409354e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.12762870663050346 + -0.22922381343189474i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1550528317354327 + -0.004059515943061285i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19517785289750142 + -4.1809546276472265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.1276287066305035 + 0.22922381343189474i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36618732859576586 + -3.5236570605778894e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.1993477465590486, 1.0e-7), DoubleNear(0.23928707194768395, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19517785289750142, 1.0e-7), DoubleNear(0.36618732859576586, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, true, false, false, true}), Matrix({ { 0.29100411184861114 + -1.214306433183765e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4863078172026264 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10352148760793888 + -1.8566962203814263e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11916658334082343 + -2.6020852139652106e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.29100411184861114, 1.0e-7), DoubleNear(0.4863078172026264, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.10352148760793888, 1.0e-7), DoubleNear(0.11916658334082343, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, true, false}), Matrix({ { 0.1454985415420071 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.12797009366980477 + 0.055009122328884046i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.15051399814548488 + 9.215718466126788e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.038567289395339495 + -0.1956149196203119i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.05384920501704151 + -4.614635496641428e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.027082738065627953 + -0.05094960638582274i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08877307380219908 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08906141723516398 + -0.03360889381158285i }, { -0.12797009366980475 + -0.05500912232888403i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13335081030795798 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.03856728939533953 + 0.19561491962031188i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26411252826425197 + -1.7889335846010823e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.027082738065627943 + 0.05094960638582274i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06182704258954345 + -2.4462311516704194e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08906141723516398 + 0.03360889381158288i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10207480033151388 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1454985415420071, 1.0e-7), DoubleNear(0.15051399814548488, 1.0e-7), DoubleNear(0.05384920501704151, 1.0e-7), DoubleNear(0.08877307380219908, 1.0e-7), DoubleNear(0.13335081030795798, 1.0e-7), DoubleNear(0.26411252826425197, 1.0e-7), DoubleNear(0.06182704258954345, 1.0e-7), DoubleNear(0.10207480033151388, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, true, false, true}), Matrix({ { 0.19198852527628896 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.036190914119402354 + 0.002268740407205573i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.354908544929041 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06087331231129409 + -0.02920262199911267i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09901558657232218 + -5.204170427930421e-18i, 0.0 + 0.0i, -0.03619091411940236 + 0.0022687404072055765i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13139927227358536 + -3.469446951953614e-18i, 0.0 + 0.0i, -0.0608733123112941 + -0.02920262199911268i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.03619091411940236 + -0.0022687404072055765i, 0.0 + 0.0i, 0.08686082657367611 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0608733123112941 + 0.029202621999112673i, 0.0 + 0.0i, 0.05971798148069584 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.036190914119402354 + -0.0022687404072055765i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.016660661034262773 + -1.8566962203814263e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0608733123112941 + 0.029202621999112673i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0594486018601276 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.19198852527628896, 1.0e-7), DoubleNear(0.354908544929041, 1.0e-7), DoubleNear(0.09901558657232218, 1.0e-7), DoubleNear(0.13139927227358536, 1.0e-7), DoubleNear(0.08686082657367611, 1.0e-7), DoubleNear(0.05971798148069584, 1.0e-7), DoubleNear(0.016660661034262773, 1.0e-7), DoubleNear(0.0594486018601276, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({true, false, false, false, false, false, true, true}), Matrix({ { 0.1462695273347191 + -6.938893903907228e-18i, 0.0 + 0.0i, -0.11128980761987245 + -0.005737489790531493i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1899562117674954 + -1.734723475976807e-18i, 0.0 + 0.0i, -0.09433152988629459 + -0.1905806355681756i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11128980761987242 + 0.005737489790531493i, 0.0 + 0.0i, 0.14473458451389204 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.09433152988629462 + 0.1905806355681756i, 0.0 + 0.0i, 0.296351605435131 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0530782192243295 + -2.879912020664621e-18i, 0.0 + 0.0i, -0.043763024115560274 + 0.009797005733592793i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04933086018018858 + -8.131516293641283e-19i, 0.0 + 0.0i, -0.033297176744208866 + -0.03864317786371916i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04376302411556027 + -0.009797005733592778i, 0.0 + 0.0i, 0.05044326838360937 + 1.0232158002831948e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03329717674420887 + 0.038643177863719166i, 0.0 + 0.0i, 0.06983572316063485 + -1.7889335846010823e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({true, false, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1462695273347191, 1.0e-7), DoubleNear(0.1899562117674954, 1.0e-7), DoubleNear(0.14473458451389204, 1.0e-7), DoubleNear(0.296351605435131, 1.0e-7), DoubleNear(0.0530782192243295, 1.0e-7), DoubleNear(0.04933086018018858, 1.0e-7), DoubleNear(0.05044326838360937, 1.0e-7), DoubleNear(0.06983572316063485, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, true, false, false, false, false}), Matrix({ { 0.12680606363222643 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.09485205686733895 + 0.024888620808969506i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.09111592788764451 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.037290403724327265 + 0.03286103004702884i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09485205686733895 + -0.024888620808969513i, 0.0 + 0.0i, 0.0818431226783253 + -3.5914196963582334e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.03729040372432727 + -0.032861030047028846i, 0.0 + 0.0i, 0.09476048525835379 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.132202521012028 + -7.806255641895632e-18i, 0.0 + 0.0i, 0.07577767355905723 + 0.013321595029654298i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15906320975605492 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.1596366202226401 + 0.0017747040565518936i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07577767355905722 + -0.013321595029654298i, 0.0 + 0.0i, 0.05891473274225323 + 3.469446951953614e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1596366202226401 + -0.0017747040565518901i, 0.0 + 0.0i, 0.2552939370331137 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, true, false, false, false, false}), ElementsAreArray({ DoubleNear(0.12680606363222643, 1.0e-7), DoubleNear(0.09111592788764451, 1.0e-7), DoubleNear(0.0818431226783253, 1.0e-7), DoubleNear(0.09476048525835379, 1.0e-7), DoubleNear(0.132202521012028, 1.0e-7), DoubleNear(0.15906320975605492, 1.0e-7), DoubleNear(0.05891473274225323, 1.0e-7), DoubleNear(0.2552939370331137, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, true, false, false, false}), Matrix({ { 0.25900858464425447 + -1.3010426069826053e-17i, 0.0 + 0.0i, 0.17062973042639618 + 0.0382102158386238i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.25017913764369937 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.19692702394696734 + 0.03463573410358073i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.17062973042639615 + -0.038210215838623815i, 0.0 + 0.0i, 0.1407578554205785 + -1.2197274440461925e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.19692702394696734 + -0.03463573410358073i, 0.0 + 0.0i, 0.35005442229146755 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, true, false, false, false}), ElementsAreArray({ DoubleNear(0.25900858464425447, 1.0e-7), DoubleNear(0.25017913764369937, 1.0e-7), DoubleNear(0.1407578554205785, 1.0e-7), DoubleNear(0.35005442229146755, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, true, false, false}), Matrix({ { 0.1672787018297123 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.10453001884083143 + 0.021580152650329094i, 0.0 + 0.0i, 0.0 + 0.0i, 0.020312127441688452 + -0.05686242436944963i, 0.0 + 0.0i, 0.07878576537788981 + -0.04485184753864645i }, { 0.0 + 0.0i, 0.1772946607524275 + 0.0i, 0.0 + 0.0i, 0.15681000060355277 + 0.014399641587584222i, -0.08055989787430455 + -0.029747983175370755i, 0.0 + 0.0i, -0.06735988703132155 + -0.03133894322691955i, 0.0 + 0.0i }, { 0.10453001884083143 + -0.0215801526503291i, 0.0 + 0.0i, 0.08442780492727249 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.026028612339302353 + -0.03647944373677014i, 0.0 + 0.0i, 0.040164146628188756 + -0.041862201353428524i }, { 0.0 + 0.0i, 0.15681000060355277 + -0.014399641587584219i, 0.0 + 0.0i, 0.2644747107502896 + 0.0i, -0.12888476978090752 + -0.026760174683918433i, 0.0 + 0.0i, -0.08973752023370585 + -0.04837659002862315i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.08055989787430454 + 0.029747983175370758i, 0.0 + 0.0i, -0.12888476978090754 + 0.026760174683918433i, 0.09172988281454213 + -8.673617379884035e-18i, 0.0 + 0.0i, 0.06609971158556475 + 0.01663006318829471i, 0.0 + 0.0i }, { 0.020312127441688452 + 0.05686242436944963i, 0.0 + 0.0i, 0.026028612339302357 + 0.03647944373677014i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07288447689127192 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0401170233434146 + 0.02023609251599651i }, { 0.0 + 0.0i, -0.06735988703132155 + 0.031338943226919554i, 0.0 + 0.0i, -0.08973752023370586 + 0.04837659002862314i, 0.06609971158556474 + -0.01663006318829471i, 0.0 + 0.0i, 0.05633005049330603 + 3.347474207548995e-18i, 0.0 + 0.0i }, { 0.07878576537788981 + 0.04485184753864643i, 0.0 + 0.0i, 0.04016414662818876 + 0.0418622013534285i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0401170233434146 + -0.020236092515996517i, 0.0 + 0.0i, 0.08557971154117787 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, true, false, false}), ElementsAreArray({ DoubleNear(0.1672787018297123, 1.0e-7), DoubleNear(0.1772946607524275, 1.0e-7), DoubleNear(0.08442780492727249, 1.0e-7), DoubleNear(0.2644747107502896, 1.0e-7), DoubleNear(0.09172988281454213, 1.0e-7), DoubleNear(0.07288447689127192, 1.0e-7), DoubleNear(0.05633005049330603, 1.0e-7), DoubleNear(0.08557971154117787, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, true, false}), Matrix({ { 0.12104465225966196 + -7.15573433840433e-18i, 0.0 + 0.0i, 0.08315844030305063 + 0.01972369905516609i, 0.0 + 0.0i, -0.09539364585166749 + -0.024850686378896397i, 0.0 + 0.0i, -0.07777210897656202 + -0.02063098718648383i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1074465529293051 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.07417907665262274 + 0.020989005496208954i, 0.0 + 0.0i, -0.06388788121660124 + -0.06664390273320796i, 0.0 + 0.0i, -0.03757213265796426 + -0.1263450696459658i }, { 0.08315844030305063 + -0.019723699055166098i, 0.0 + 0.0i, 0.06968608050029032 + 1.7279472123987727e-18i, 0.0 + 0.0i, -0.0682980362443649 + 0.018650856530026017i, 0.0 + 0.0i, -0.06348859668050459 + 0.004072514983964072i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.07417907665262274 + -0.020989005496208957i, 0.0 + 0.0i, 0.14045753281747514 + -1.734723475976807e-18i, 0.0 + 0.0i, -0.000979146845185002 + -0.07218148670945526i, 0.0 + 0.0i, -0.05991141461716285 + -0.13774222336069317i }, { -0.09539364585166749 + 0.024850686378896404i, 0.0 + 0.0i, -0.06829803624436492 + -0.018650856530026003i, 0.0 + 0.0i, 0.13796393238459245 + -5.854691731421724e-18i, 0.0 + 0.0i, 0.08747129012334555 + 0.01848651678345771i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.06388788121660124 + 0.06664390273320797i, 0.0 + 0.0i, -0.0009791468451850194 + 0.07218148670945526i, 0.0 + 0.0i, 0.14273258471439432 + 0.0i, 0.0 + 0.0i, 0.12274794729434461 + 0.013646728607371775i }, { -0.07777210897656205 + 0.02063098718648384i, 0.0 + 0.0i, -0.06348859668050459 + -0.004072514983964062i, 0.0 + 0.0i, 0.08747129012334555 + -0.018486516783457713i, 0.0 + 0.0i, 0.0710717749202882 + -1.849919956803392e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.03757213265796426 + 0.1263450696459658i, 0.0 + 0.0i, -0.059911414617162866 + 0.13774222336069317i, 0.0 + 0.0i, 0.12274794729434461 + -0.013646728607371775i, 0.0 + 0.0i, 0.20959688947399235 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, true, false}), ElementsAreArray({ DoubleNear(0.12104465225966196, 1.0e-7), DoubleNear(0.1074465529293051, 1.0e-7), DoubleNear(0.06968608050029032, 1.0e-7), DoubleNear(0.14045753281747514, 1.0e-7), DoubleNear(0.13796393238459245, 1.0e-7), DoubleNear(0.14273258471439432, 1.0e-7), DoubleNear(0.0710717749202882, 1.0e-7), DoubleNear(0.20959688947399235, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, true, false, false, false, false, true}), Matrix({ { 0.1872148656558933 + -1.0408340855860843e-17i, 0.0 + 0.0i, 0.15346215961189646 + 0.044079050780995443i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008209444654118454 + 0.13472245284474976i, 0.0 + 0.0i, -0.09201997000705353 + -0.026572369602487413i }, { 0.0 + 0.0i, 0.1528709766800329 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.21201376372055603 + -0.03274834046461232i, 0.08370024424459424 + 0.06300353208065293i, 0.0 + 0.0i, 0.025164975798518705 + 0.008223486521797382i, 0.0 + 0.0i }, { 0.15346215961189646 + -0.04407905078099546i, 0.0 + 0.0i, 0.13617293189398105 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02499053009523316 + 0.112366413937587i, 0.0 + 0.0i, -0.08168618501637881 + -0.00011591117147996804i }, { 0.0 + 0.0i, 0.21201376372055603 + 0.03274834046461232i, 0.0 + 0.0i, 0.3010531548213303 + -1.734723475976807e-18i, 0.10258548109102397 + 0.10530880621830888i, 0.0 + 0.0i, 0.03313915961407196 + 0.016795886173994152i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.08370024424459424 + -0.06300353208065293i, 0.0 + 0.0i, 0.10258548109102397 + -0.10530880621830888i, 0.07179371898836115 + -2.6020852139652106e-18i, 0.0 + 0.0i, 0.017167570814499697 + -0.005868834942371645i, 0.0 + 0.0i }, { -0.00820944465411846 + -0.13472245284474976i, 0.0 + 0.0i, 0.024990530095233162 + -0.11236641393758702i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09730816096366648 + -1.734723475976807e-18i, 0.0 + 0.0i, -0.015086739773588684 + 0.06738407456819305i }, { 0.0 + 0.0i, 0.0251649757985187 + -0.008223486521797383i, 0.0 + 0.0i, 0.03313915961407196 + -0.016795886173994152i, 0.017167570814499693 + 0.005868834942371644i, 0.0 + 0.0i, 0.004584923526597465 + -1.2197274440461925e-19i, 0.0 + 0.0i }, { -0.09201997000705353 + 0.02657236960248742i, 0.0 + 0.0i, -0.0816861850163788 + 0.00011591117147996544i, 0.0 + 0.0i, 0.0 + 0.0i, -0.015086739773588681 + -0.06738407456819305i, 0.0 + 0.0i, 0.049001267470137194 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, true, false, false, false, false, true}), ElementsAreArray({ DoubleNear(0.1872148656558933, 1.0e-7), DoubleNear(0.1528709766800329, 1.0e-7), DoubleNear(0.13617293189398105, 1.0e-7), DoubleNear(0.3010531548213303, 1.0e-7), DoubleNear(0.07179371898836115, 1.0e-7), DoubleNear(0.09730816096366648, 1.0e-7), DoubleNear(0.004584923526597465, 1.0e-7), DoubleNear(0.049001267470137194, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, true, false, false, false}), Matrix({ { 0.20864918631055174 + -8.795590124288655e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1858764131459983 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1911172537542812 + -4.336808689942018e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.4143571467891686 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.20864918631055174, 1.0e-7), DoubleNear(0.1858764131459983, 1.0e-7), DoubleNear(0.1911172537542812, 1.0e-7), DoubleNear(0.4143571467891686, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, true, false, false}), Matrix({ { 0.19198852527628896 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07250308872647056 + -0.0628768824149274i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.08686082657367611 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0012379452150879135 + -0.02027038756440863i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.05971798148069584 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.012026814656593351 + -0.035847743307950763i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.354908544929041 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.16905947289292247 + -0.057854185639585276i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.00123794521508791 + 0.020270387564408625i, 0.0 + 0.0i, 0.0 + 0.0i, 0.016660661034262773 + -1.8566962203814263e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.07250308872647057 + 0.06287688241492737i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09901558657232218 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.1690594728929225 + 0.057854185639585276i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13139927227358536 + -3.469446951953614e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.01202681465659335 + 0.035847743307950763i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0594486018601276 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.19198852527628896, 1.0e-7), DoubleNear(0.08686082657367611, 1.0e-7), DoubleNear(0.05971798148069584, 1.0e-7), DoubleNear(0.354908544929041, 1.0e-7), DoubleNear(0.016660661034262773, 1.0e-7), DoubleNear(0.09901558657232218, 1.0e-7), DoubleNear(0.13139927227358536, 1.0e-7), DoubleNear(0.0594486018601276, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, true, false}), Matrix({ { 0.10793194843481624 + -4.614635496641428e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.09200843462489823 + 0.030535739389311055i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.09141579812423235 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06304439711053449 + -0.026476223446249753i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.08279878432513604 + -8.131516293641283e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06687380790727386 + -0.051313910784243376i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1564882876225479 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0607548987232296 + -0.17790990264765139i }, { -0.09200843462489822 + -0.03053573938931105i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1007172378757355 + -4.1809546276472265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.06304439711053447 + 0.026476223446249766i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09446061502176593 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.06687380790727386 + 0.0513139107842434i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10831846942914516 + -3.5236570605778894e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06075489872322964 + 0.17790990264765136i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.2578688591666207 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.10793194843481624, 1.0e-7), DoubleNear(0.09141579812423235, 1.0e-7), DoubleNear(0.08279878432513604, 1.0e-7), DoubleNear(0.1564882876225479, 1.0e-7), DoubleNear(0.1007172378757355, 1.0e-7), DoubleNear(0.09446061502176593, 1.0e-7), DoubleNear(0.10831846942914516, 1.0e-7), DoubleNear(0.2578688591666207, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, true, false, false, false, true}), Matrix({ { 0.19198852527628896 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.053369142249594076 + 0.07991306915161756i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.09901558657232218 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.025486466360715027 + 0.0174068432547967i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.13139927227358536 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03652648742090317 + 0.054693472521652256i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.354908544929041 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09135293749795118 + 0.062392574999850375i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.02548646636071503 + -0.017406843254796706i, 0.0 + 0.0i, 0.0 + 0.0i, 0.016660661034262773 + -1.8566962203814263e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.053369142249594076 + -0.07991306915161756i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08686082657367611 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09135293749795118 + -0.062392574999850375i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05971798148069584 + -8.673617379884035e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.036526487420903184 + -0.054693472521652256i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0594486018601276 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.19198852527628896, 1.0e-7), DoubleNear(0.09901558657232218, 1.0e-7), DoubleNear(0.13139927227358536, 1.0e-7), DoubleNear(0.354908544929041, 1.0e-7), DoubleNear(0.016660661034262773, 1.0e-7), DoubleNear(0.08686082657367611, 1.0e-7), DoubleNear(0.05971798148069584, 1.0e-7), DoubleNear(0.0594486018601276, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, true, false, false}), Matrix({ { 0.2517065067569848 + -7.806255641895632e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.060476274069877205 + -0.09872462572287817i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4417693715027171 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.17029741810801038 + -0.07812457320399391i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.1702974181080104 + 0.07812457320399391i, 0.0 + 0.0i, 0.0 + 0.0i, 0.14805993330784814 + -5.3261431723350405e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.060476274069877226 + 0.09872462572287813i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15846418843244978 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.2517065067569848, 1.0e-7), DoubleNear(0.4417693715027171, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.14805993330784814, 1.0e-7), DoubleNear(0.15846418843244978, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, true, false}), Matrix({ { 0.19073073275995228 + -5.4277871260055566e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.1588822425321721 + -0.020778171394932324i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.24790408574678025 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.12379929583376409 + -0.20438612609390114i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1588822425321721 + 0.020778171394932342i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.20903570730488064 + -7.704611688225116e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.1237992958337641 + 0.2043861260939011i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.35232947418838667 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.19073073275995228, 1.0e-7), DoubleNear(0.24790408574678025, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.20903570730488064, 1.0e-7), DoubleNear(0.35232947418838667, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, true, false, false, true}), Matrix({ { 0.32338779754987435 + -1.0408340855860843e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08989562967049725 + 0.1346065416732698i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.45392413150136324 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1168394038586662 + 0.07979941825464708i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1168394038586662 + -0.07979941825464709i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07637864251495861 + -2.72405795836983e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08989562967049726 + -0.1346065416732698i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.14630942843380368 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.32338779754987435, 1.0e-7), DoubleNear(0.45392413150136324, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.07637864251495861, 1.0e-7), DoubleNear(0.14630942843380368, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, true, false}), Matrix({ { 0.12185442072780968 + -2.5478751053409354e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.011385496986852962 + -0.08116172798570417i, -0.09366253579773075 + 0.00969983057411131i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07527553164670292 + 0.04139501450594464i }, { 0.0 + 0.0i, 0.17415811895968228 + -1.734723475976807e-18i, -0.05995176541697192 + -0.07691596098336168i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07287484726741353 + -0.15030562786553917i, 0.0207637101909588 + 0.1008340025446419i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.05995176541697191 + 0.07691596098336168i, 0.06887631203214262 + -2.879912020664621e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10586819053223141 + 0.035730099446251114i, -0.06521970673444136 + -0.030478001969043635i, 0.0 + 0.0i }, { 0.011385496986852962 + 0.08116172798570415i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07374596678709798 + -5.204170427930421e-18i, -0.00894413783020728 + -0.06467960320787688i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05092444856635057 + -0.054080498228361966i }, { -0.09366253579773073 + -0.00969983057411131i, 0.0 + 0.0i, 0.0 + 0.0i, -0.008944137830207272 + 0.06467960320787688i, 0.1298520860291751 + -5.2583805365546965e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04909077708302424 + -0.017562897737173983i }, { 0.0 + 0.0i, -0.07287484726741354 + 0.15030562786553914i, 0.10586819053223141 + -0.03573009944625112i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26761125254303486 + 1.734723475976807e-18i, -0.11034565269103846 + -0.0012086122206322273i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.020763710190958788 + -0.10083400254464189i, -0.06521970673444136 + 0.030478001969043652i, 0.0 + 0.0i, 0.0 + 0.0i, -0.11034565269103849 + 0.0012086122206322308i, 0.07918362127570552 + -2.4462311516704194e-18i, 0.0 + 0.0i }, { -0.0752755316467029 + -0.04139501450594462i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05092444856635057 + 0.05408049822836197i, 0.049090777083024256 + 0.017562897737173983i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0847182216453518 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.12185442072780968, 1.0e-7), DoubleNear(0.17415811895968228, 1.0e-7), DoubleNear(0.06887631203214262, 1.0e-7), DoubleNear(0.07374596678709798, 1.0e-7), DoubleNear(0.1298520860291751, 1.0e-7), DoubleNear(0.26761125254303486, 1.0e-7), DoubleNear(0.07918362127570552, 1.0e-7), DoubleNear(0.0847182216453518, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, true, false, true}), Matrix({ { 0.19198852527628896 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07250308872647056 + -0.0628768824149274i, 0.0 + 0.0i, -0.053369142249594076 + 0.07991306915161756i, 0.036190914119402354 + 0.002268740407205573i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.354908544929041 + 0.0i, -0.16905947289292247 + -0.057854185639585276i, 0.0 + 0.0i, 0.09135293749795118 + 0.062392574999850375i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06087331231129409 + -0.02920262199911267i }, { 0.0 + 0.0i, -0.1690594728929225 + 0.057854185639585276i, 0.13139927227358536 + -3.469446951953614e-18i, 0.0 + 0.0i, -0.0608733123112941 + -0.02920262199911268i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03652648742090317 + 0.054693472521652256i }, { 0.07250308872647057 + 0.06287688241492737i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09901558657232218 + -5.204170427930421e-18i, 0.0 + 0.0i, -0.03619091411940236 + 0.0022687404072055765i, 0.025486466360715027 + 0.0174068432547967i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.09135293749795118 + -0.062392574999850375i, -0.0608733123112941 + 0.029202621999112673i, 0.0 + 0.0i, 0.05971798148069584 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i, -0.012026814656593351 + -0.035847743307950763i }, { -0.053369142249594076 + -0.07991306915161756i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03619091411940236 + -0.0022687404072055765i, 0.0 + 0.0i, 0.08686082657367611 + 0.0i, -0.0012379452150879135 + -0.02027038756440863i, 0.0 + 0.0i }, { 0.036190914119402354 + -0.0022687404072055765i, 0.0 + 0.0i, 0.0 + 0.0i, 0.02548646636071503 + -0.017406843254796706i, 0.0 + 0.0i, -0.00123794521508791 + 0.020270387564408625i, 0.016660661034262773 + -1.8566962203814263e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0608733123112941 + 0.029202621999112673i, -0.036526487420903184 + -0.054693472521652256i, 0.0 + 0.0i, -0.01202681465659335 + 0.035847743307950763i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0594486018601276 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.19198852527628896, 1.0e-7), DoubleNear(0.354908544929041, 1.0e-7), DoubleNear(0.13139927227358536, 1.0e-7), DoubleNear(0.09901558657232218, 1.0e-7), DoubleNear(0.05971798148069584, 1.0e-7), DoubleNear(0.08686082657367611, 1.0e-7), DoubleNear(0.016660661034262773, 1.0e-7), DoubleNear(0.0594486018601276, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, true, false, false, false, false, true, true}), Matrix({ { 0.1612966343498202 + -5.204170427930421e-18i, 0.0 + 0.0i, -0.14942677628868584 + 0.01473411462624762i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0448373829144645 + 0.06713791397778011i, 0.0 + 0.0i, 0.03540487927000837 + -0.0662930211467328i }, { 0.0 + 0.0i, 0.1749291047523943 + -3.469446951953614e-18i, 0.0 + 0.0i, -0.0561945612174812 + -0.2110522399849547i, 0.04502649429365828 + 0.030752365486445526i, 0.0 + 0.0i, 0.022638379910319577 + -0.06420348506415745i, 0.0 + 0.0i }, { -0.14942677628868584 + -0.014734114626247602i, 0.0 + 0.0i, 0.16209116320005412 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04767069900398184 + -0.058101416379954085i, 0.0 + 0.0i, -0.04505824675603275 + 0.0674686276954897i }, { 0.0 + 0.0i, -0.05619456121748122 + 0.21105223998495468i, 0.0 + 0.0i, 0.2789950267489689 + -1.734723475976807e-18i, -0.05156717473351399 + 0.044445587287723916i, 0.0 + 0.0i, 0.07181290956500792 + 0.04904705276820155i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.045026494293658285 + -0.030752365486445533i, 0.0 + 0.0i, -0.05156717473351399 + -0.044445587287723916i, 0.0294340984101321 + -2.236166980751353e-19i, 0.0 + 0.0i, -0.009455466243486251 + -0.035512286021179944i, 0.0 + 0.0i }, { -0.04483738291446451 + -0.06713791397778011i, 0.0 + 0.0i, 0.04767069900398185 + 0.05810141637995407i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07297498099438597 + -3.469446951953614e-18i, 0.0 + 0.0i, -0.06760473461628289 + 0.006666113891053574i }, { 0.0 + 0.0i, 0.02263837991031957 + 0.06420348506415743i, 0.0 + 0.0i, 0.07181290956500792 + -0.04904705276820155i, -0.009455466243486253 + 0.035512286021179944i, 0.0 + 0.0i, 0.04694454410482651 + -2.5004412602946946e-18i, 0.0 + 0.0i }, { 0.03540487927000838 + 0.0662930211467328i, 0.0 + 0.0i, -0.04505824675603275 + -0.0674686276954897i, 0.0 + 0.0i, 0.0 + 0.0i, -0.06760473461628289 + -0.006666113891053552i, 0.0 + 0.0i, 0.07333444743941772 + 1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, true, false, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1612966343498202, 1.0e-7), DoubleNear(0.1749291047523943, 1.0e-7), DoubleNear(0.16209116320005412, 1.0e-7), DoubleNear(0.2789950267489689, 1.0e-7), DoubleNear(0.0294340984101321, 1.0e-7), DoubleNear(0.07297498099438597, 1.0e-7), DoubleNear(0.04694454410482651, 1.0e-7), DoubleNear(0.07333444743941772, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, true, false, false, false}), Matrix({ { 0.21792199151987093 + -8.673617379884035e-18i, 0.13214246059166623 + 0.05774965085599834i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13214246059166623 + -0.05774965085599836i, 0.17660360793667906 + -5.3261431723350405e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2912657307680829 + -9.540979117872439e-18i, 0.23541429378169731 + 0.01509629908620619i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.23541429378169731 + -0.015096299086206189i, 0.314208669775367 + 3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, true, false, false, false}), ElementsAreArray({ DoubleNear(0.21792199151987093, 1.0e-7), DoubleNear(0.17660360793667906, 1.0e-7), DoubleNear(0.2912657307680829, 1.0e-7), DoubleNear(0.314208669775367, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, true, false, false}), Matrix({ { 0.16891532921680835 + -3.469446951953614e-18i, 0.08215057275049734 + 0.06617331025044781i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.08215057275049734 + -0.06617331025044781i, 0.10993402263315671 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.17565803336533148 + -8.673617379884035e-19i, 0.17918944669388687 + -0.030193516012534498i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.17918944669388687 + 0.0301935160125345i, 0.2389684930444054 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04900666230306261 + -5.204170427930421e-18i, 0.04999188784116888 + -0.00842365939444947i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04999188784116888 + 0.008423659394449461i, 0.06666958530352236 + -1.8566962203814263e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11560769740275144 + -8.673617379884035e-18i, 0.05622484708781047 + 0.04528981509874069i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05622484708781046 + -0.04528981509874069i, 0.07524017673096153 + 3.469446951953614e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, true, false, false}), ElementsAreArray({ DoubleNear(0.16891532921680835, 1.0e-7), DoubleNear(0.10993402263315671, 1.0e-7), DoubleNear(0.17565803336533148, 1.0e-7), DoubleNear(0.2389684930444054, 1.0e-7), DoubleNear(0.04900666230306261, 1.0e-7), DoubleNear(0.06666958530352236, 1.0e-7), DoubleNear(0.11560769740275144, 1.0e-7), DoubleNear(0.07524017673096153, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, true, false}), Matrix({ { 0.11095037077663507 + -8.023096076392733e-18i, 0.0661367310235645 + 0.0306066821567472i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08899265583269642 + 0.011737250612642396i, -0.06616940028817302 + -0.034209128342898465i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0661367310235645 + -0.030606682156747212i, 0.08839737578241352 + -1.7957098481791167e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.032640738064045396 + 0.02258325951727387i, -0.06606017590273629 + -0.007677734669581095i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.117540834412332 + -4.336808689942018e-18i, 0.09120078593210885 + 0.010106022394627849i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07028887123557231 + -0.10323183972474675i, -0.04917484134635326 + -0.11276692848955118i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09120078593210885 + -0.010106022394627847i, 0.12174623753535196 + 1.7889335846010823e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.036636445025504505 + -0.07611388969670313i, -0.05733983539493116 + -0.12599197370714801i }, { -0.08899265583269642 + -0.011737250612642388i, -0.0326407380640454 + -0.02258325951727388i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10697162074323588 + -6.505213034913027e-19i, 0.06600572956810172 + 0.027142968699251147i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.06616940028817303 + 0.034209128342898465i, -0.06606017590273627 + 0.007677734669581098i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06600572956810172 + -0.027142968699251153i, 0.08820623215426555 + -3.530433324155924e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.07028887123557231 + 0.10323183972474675i, -0.03663644502550453 + 0.07611388969670314i, 0.0 + 0.0i, 0.0 + 0.0i, 0.1737248963557509 + -5.204170427930421e-18i, 0.14421350784958845 + 0.0049902766915783416i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.04917484134635327 + 0.11276692848955117i, -0.057339835394931184 + 0.125991973707148i, 0.0 + 0.0i, 0.0 + 0.0i, 0.14421350784958845 + -0.0049902766915783416i, 0.19246243224001497 + 1.6805133673525319e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, true, false}), ElementsAreArray({ DoubleNear(0.11095037077663507, 1.0e-7), DoubleNear(0.08839737578241352, 1.0e-7), DoubleNear(0.117540834412332, 1.0e-7), DoubleNear(0.12174623753535196, 1.0e-7), DoubleNear(0.10697162074323588, 1.0e-7), DoubleNear(0.08820623215426555, 1.0e-7), DoubleNear(0.1737248963557509, 1.0e-7), DoubleNear(0.19246243224001497, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, true, false, false, false, true}), Matrix({ { 0.14449164514441376 + -6.938893903907228e-18i, 0.13735433586750062 + 0.01902532819825127i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.13735433586750062 + -0.019025328198251285i, 0.14651246670419737 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.19559419719151241 + -6.938893903907228e-18i, 0.2281215874649519 + -0.0076946178818681436i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.2281215874649519 + 0.007694617881868145i, 0.290713620011114 + 3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07343034637545717 + -1.734723475976807e-18i, -0.005211875275834399 + 0.03872432265774707i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0052118752758343965 + -0.03872432265774708i, 0.030091141232481692 + -1.2197274440461925e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09567153357657046 + -2.6020852139652106e-18i, 0.00729270631674541 + 0.022790916968074334i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.007292706316745409 + -0.022790916968074334i, 0.02349504976425297 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, true, false, false, false, true}), ElementsAreArray({ DoubleNear(0.14449164514441376, 1.0e-7), DoubleNear(0.14651246670419737, 1.0e-7), DoubleNear(0.19559419719151241, 1.0e-7), DoubleNear(0.290713620011114, 1.0e-7), DoubleNear(0.07343034637545717, 1.0e-7), DoubleNear(0.030091141232481692, 1.0e-7), DoubleNear(0.09567153357657046, 1.0e-7), DoubleNear(0.02349504976425297, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, true, false, false}), Matrix({ { 0.3445733625821398 + -4.336808689942018e-18i, 0.2613400194443842 + 0.035979794237913316i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.2613400194443842 + -0.03597979423791332i, 0.34890251567756214 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.16461435970581403 + -1.3877787807814457e-17i, 0.10621673492897934 + 0.03686615570429122i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10621673492897936 + -0.03686615570429123i, 0.14190976203448388 + 1.6127507315721878e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, true, false, false}), ElementsAreArray({ DoubleNear(0.3445733625821398, 1.0e-7), DoubleNear(0.34890251567756214, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.16461435970581403, 1.0e-7), DoubleNear(0.14190976203448388, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, true, false}), Matrix({ { 0.2284912051889671 + -1.235990476633475e-17i, 0.15733751695567336 + 0.040712704551375045i, 0.0 + 0.0i, 0.0 + 0.0i, -0.15928152706826873 + -0.09149458911210435i, -0.11534424163452628 + -0.14697605683244963i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.15733751695567336 + -0.04071270455137506i, 0.2101436133177655 + -6.776263578034403e-21i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0692771830895499 + -0.053530630179429266i, -0.12340001129766745 + -0.1336697083767291i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.15928152706826873 + 0.09149458911210437i, -0.06927718308954993 + 0.05353063017942927i, 0.0 + 0.0i, 0.0 + 0.0i, 0.28069651709898674 + -5.854691731421724e-18i, 0.21021923741769016 + 0.032133245390829485i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11534424163452629 + 0.14697605683244963i, -0.12340001129766746 + 0.1336697083767291i, 0.0 + 0.0i, 0.0 + 0.0i, 0.21021923741769016 + -0.03213324539082949i, 0.2806686643942805 + -1.849919956803392e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, true, false}), ElementsAreArray({ DoubleNear(0.2284912051889671, 1.0e-7), DoubleNear(0.2101436133177655, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.28069651709898674, 1.0e-7), DoubleNear(0.2806686643942805, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, true, false, false, true}), Matrix({ { 0.3400858423359262 + -1.3877787807814457e-17i, 0.3654759233324525 + 0.011330710316383127i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.3654759233324525 + -0.011330710316383141i, 0.4372260867153114 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.16910187995202763 + -4.336808689942018e-18i, 0.0020808310409110107 + 0.06151523962582141i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0020808310409110124 + -0.06151523962582141i, 0.053586190996734666 + -1.2197274440461925e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, true, false, false, true}), ElementsAreArray({ DoubleNear(0.3400858423359262, 1.0e-7), DoubleNear(0.4372260867153114, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.16910187995202763, 1.0e-7), DoubleNear(0.053586190996734666, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, true, false}), Matrix({ { 0.1519027613620586 + -4.336808689942018e-18i, 0.10791242479176243 + 0.023567455784897186i, 0.0 + 0.0i, 0.0 + 0.0i, -0.09385812770235383 + -0.04955073459898895i, -0.08166735915140391 + -0.09589292525593388i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.10791242479176243 + -0.023567455784897186i, 0.14410977832543337 + 5.421010862427522e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.027069352959218522 + -0.040773170294929925i, -0.07267925536279043 + -0.09105506269243892i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.07658844382690846 + -8.023096076392733e-18i, 0.04942509216391093 + 0.017145248766477862i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0654233993659149 + -0.04194385451311541i, -0.03367688248312235 + -0.05108313157651576i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.04942509216391093 + -0.01714524876647787i, 0.06603383499233212 + -6.098637220230962e-20i, 0.0 + 0.0i, 0.0 + 0.0i, -0.042207830130331386 + -0.012757459884499335i, -0.05072075593487701 + -0.04261464568429019i }, { -0.09385812770235383 + 0.049550734598988955i, -0.027069352959218546 + 0.040773170294929925i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19267060122008117 + 0.0i, 0.15342759465262176 + 0.01241233845301613i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.08166735915140393 + 0.09589292525593386i, -0.07267925536279046 + 0.09105506269243889i, 0.0 + 0.0i, 0.0 + 0.0i, 0.15342759465262176 + -0.012412338453016133i, 0.20479273735212877 + -3.5236570605778894e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.06542339936591492 + 0.04194385451311542i, -0.042207830130331386 + 0.012757459884499342i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08802591587890557 + -5.854691731421724e-18i, 0.056791642765068415 + 0.019720906937813358i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.03367688248312236 + 0.051083131576515776i, -0.050720755934877 + 0.0426146456842902i, 0.0 + 0.0i, 0.0 + 0.0i, 0.056791642765068415 + -0.019720906937813358i, 0.07587592704215176 + 1.6737371037744975e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1519027613620586, 1.0e-7), DoubleNear(0.14410977832543337, 1.0e-7), DoubleNear(0.07658844382690846, 1.0e-7), DoubleNear(0.06603383499233212, 1.0e-7), DoubleNear(0.19267060122008117, 1.0e-7), DoubleNear(0.20479273735212877, 1.0e-7), DoubleNear(0.08802591587890557, 1.0e-7), DoubleNear(0.07587592704215176, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, true, false, true}), Matrix({ { 0.23067037800919674 + -3.469446951953614e-18i, 0.2568739327467261 + 0.0005639397388066542i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.039452627079159606 + -0.05422095433675943i, 0.04728657743467619 + 0.014337104245421589i }, { 0.2568739327467261 + -0.0005639397388066576i, 0.31622669219613325 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05148205523694687 + -0.08322518906706036i, 0.057611599351536834 + 0.02728707274485233i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.10941546432672945 + -1.0408340855860843e-17i, 0.10860199058572642 + 0.010766770577576473i, -0.06514679091635966 + -0.002239409145763811i, -0.03065909266204205 + -0.0189305882972169i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.10860199058572642 + -0.010766770577576482i, 0.12099939451917811 + 1.734723475976807e-18i, -0.07575802070768921 + 0.021753100532450314i, -0.0319174355143368 + -0.02469447244614329i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.06514679091635965 + 0.002239409145763799i, -0.07575802070768922 + -0.021753100532450317i, 0.11390298457294305 + -8.673617379884035e-19i, 0.00446608669765808 + 0.03541585449910666i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.030659092662042052 + 0.0189305882972169i, -0.0319174355143368 + 0.024694472446143298i, 0.004466086697658081 + -0.03541585449910666i, 0.03267582348142889 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.03945262707915961 + 0.05422095433675943i, 0.05148205523694688 + 0.08322518906706036i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05519889537908459 + -3.469446951953614e-18i, -0.0023852556567470692 + 0.026099385126714746i }, { 0.047286577434676194 + -0.014337104245421593i, 0.05761159935153684 + -0.02728707274485233i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0023852556567470684 + -0.026099385126714746i, 0.020910367515305776 + -1.2197274440461925e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, true, false, true}), ElementsAreArray({ DoubleNear(0.23067037800919674, 1.0e-7), DoubleNear(0.31622669219613325, 1.0e-7), DoubleNear(0.10941546432672945, 1.0e-7), DoubleNear(0.12099939451917811, 1.0e-7), DoubleNear(0.11390298457294305, 1.0e-7), DoubleNear(0.03267582348142889, 1.0e-7), DoubleNear(0.05519889537908459, 1.0e-7), DoubleNear(0.020910367515305776, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, true, false, false, false, true, true}), Matrix({ { 0.15228945974956898 + -8.673617379884035e-18i, 0.15824647313517687 + 0.009365122564331353i, -0.10543078775384121 + -0.06254759575242536i, -0.11439117152877945 + -0.10789720790002094i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.15824647313517687 + -0.00936512256433136i, 0.18393627935264553 + 0.0i, -0.07992182114349365 + -0.07527058215383238i, -0.10019054975232582 + -0.13377052960628172i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.10543078775384121 + 0.06254759575242536i, -0.07992182114349367 + 0.0752705821538324i, 0.18779638258635722 + -5.204170427930421e-18i, 0.20722945019727565 + 0.0019655877520517746i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11439117152877946 + 0.10789720790002093i, -0.10019054975232583 + 0.13377052960628172i, 0.20722945019727565 + -0.0019655877520517815i, 0.2532898073626658 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07620174543939812 + -3.686287386450715e-18i, -0.0009089561795035072 + 0.031347581987043696i, -0.05385073931442751 + -0.028946993359679i, -0.00095307010574683 + -0.0390788489324287i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.000908956179503508 + -0.031347581987043696i, 0.026207333965119962 + -6.776263578034403e-21i, 0.010644638053943745 + 0.021739951974403114i, -0.023209461545341634 + 0.00010082122955262871i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.05385073931442752 + 0.028946993359679013i, 0.010644638053943738 + -0.02173995197440312i, 0.09290013451262953 + -6.505213034913027e-19i, 0.002989787220414518 + 0.030167657638777712i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0009530701057468231 + 0.0390788489324287i, -0.023209461545341634 + -0.00010082122955262351i, 0.0029897872204145207 + -0.030167657638777712i, 0.027378857031614703 + -1.1519648082658485e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, true, false, false, false, true, true}), ElementsAreArray({ DoubleNear(0.15228945974956898, 1.0e-7), DoubleNear(0.18393627935264553, 1.0e-7), DoubleNear(0.18779638258635722, 1.0e-7), DoubleNear(0.2532898073626658, 1.0e-7), DoubleNear(0.07620174543939812, 1.0e-7), DoubleNear(0.026207333965119962, 1.0e-7), DoubleNear(0.09290013451262953, 1.0e-7), DoubleNear(0.027378857031614703, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, true, false, false}), Matrix({ { 0.27884935184996507 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.41462652640973685 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11567624760658496 + -7.060866648311848e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19084787413371296 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, true, false, false}), ElementsAreArray({ DoubleNear(0.27884935184996507, 1.0e-7), DoubleNear(0.41462652640973685, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.11567624760658496, 1.0e-7), DoubleNear(0.19084787413371296, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, true, false}), Matrix({ { 0.1993477465590486 + -9.81880592457185e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.15505283173543272 + 0.004059515943061301i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.23928707194768395 + -2.5478751053409354e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.12762870663050346 + -0.22922381343189474i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.1550528317354327 + -0.004059515943061285i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.19517785289750142 + -4.1809546276472265e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.1276287066305035 + 0.22922381343189474i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.36618732859576586 + -3.5236570605778894e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, true, false}), ElementsAreArray({ DoubleNear(0.1993477465590486, 1.0e-7), DoubleNear(0.23928707194768395, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.19517785289750142, 1.0e-7), DoubleNear(0.36618732859576586, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, true, false, false, true}), Matrix({ { 0.29100411184861114 + -1.214306433183765e-17i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.4863078172026264 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10352148760793888 + -1.8566962203814263e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.11916658334082343 + -2.6020852139652106e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, true, false, false, true}), ElementsAreArray({ DoubleNear(0.29100411184861114, 1.0e-7), DoubleNear(0.4863078172026264, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.10352148760793888, 1.0e-7), DoubleNear(0.11916658334082343, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, true, false}), Matrix({ { 0.1454985415420071 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.12797009366980477 + 0.055009122328884046i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.15051399814548488 + 9.215718466126788e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.038567289395339495 + -0.1956149196203119i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.05384920501704151 + -4.614635496641428e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.027082738065627953 + -0.05094960638582274i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.08877307380219908 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08906141723516398 + -0.03360889381158285i }, { -0.12797009366980475 + -0.05500912232888403i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13335081030795798 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.03856728939533953 + 0.19561491962031188i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.26411252826425197 + -1.7889335846010823e-18i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.027082738065627943 + 0.05094960638582274i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06182704258954345 + -2.4462311516704194e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.08906141723516398 + 0.03360889381158288i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10207480033151388 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, true, false}), ElementsAreArray({ DoubleNear(0.1454985415420071, 1.0e-7), DoubleNear(0.15051399814548488, 1.0e-7), DoubleNear(0.05384920501704151, 1.0e-7), DoubleNear(0.08877307380219908, 1.0e-7), DoubleNear(0.13335081030795798, 1.0e-7), DoubleNear(0.26411252826425197, 1.0e-7), DoubleNear(0.06182704258954345, 1.0e-7), DoubleNear(0.10207480033151388, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, true, false, true}), Matrix({ { 0.19198852527628896 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.036190914119402354 + 0.002268740407205573i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.354908544929041 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.06087331231129409 + -0.02920262199911267i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.09901558657232218 + -5.204170427930421e-18i, 0.0 + 0.0i, -0.03619091411940236 + 0.0022687404072055765i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.13139927227358536 + -3.469446951953614e-18i, 0.0 + 0.0i, -0.0608733123112941 + -0.02920262199911268i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.03619091411940236 + -0.0022687404072055765i, 0.0 + 0.0i, 0.08686082657367611 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.0608733123112941 + 0.029202621999112673i, 0.0 + 0.0i, 0.05971798148069584 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.036190914119402354 + -0.0022687404072055765i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.016660661034262773 + -1.8566962203814263e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0608733123112941 + 0.029202621999112673i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0594486018601276 + -1.734723475976807e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, true, false, true}), ElementsAreArray({ DoubleNear(0.19198852527628896, 1.0e-7), DoubleNear(0.354908544929041, 1.0e-7), DoubleNear(0.09901558657232218, 1.0e-7), DoubleNear(0.13139927227358536, 1.0e-7), DoubleNear(0.08686082657367611, 1.0e-7), DoubleNear(0.05971798148069584, 1.0e-7), DoubleNear(0.016660661034262773, 1.0e-7), DoubleNear(0.0594486018601276, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, true, false, false, true, true}), Matrix({ { 0.1462695273347191 + -6.938893903907228e-18i, 0.0 + 0.0i, -0.11128980761987245 + -0.005737489790531493i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.1899562117674954 + -1.734723475976807e-18i, 0.0 + 0.0i, -0.09433152988629459 + -0.1905806355681756i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.11128980761987242 + 0.005737489790531493i, 0.0 + 0.0i, 0.14473458451389204 + -5.204170427930421e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.09433152988629462 + 0.1905806355681756i, 0.0 + 0.0i, 0.296351605435131 + -1.734723475976807e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0530782192243295 + -2.879912020664621e-18i, 0.0 + 0.0i, -0.043763024115560274 + 0.009797005733592793i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.04933086018018858 + -8.131516293641283e-19i, 0.0 + 0.0i, -0.033297176744208866 + -0.03864317786371916i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.04376302411556027 + -0.009797005733592778i, 0.0 + 0.0i, 0.05044326838360937 + 1.0232158002831948e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03329717674420887 + 0.038643177863719166i, 0.0 + 0.0i, 0.06983572316063485 + -1.7889335846010823e-18i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, true, false, false, true, true}), ElementsAreArray({ DoubleNear(0.1462695273347191, 1.0e-7), DoubleNear(0.1899562117674954, 1.0e-7), DoubleNear(0.14473458451389204, 1.0e-7), DoubleNear(0.296351605435131, 1.0e-7), DoubleNear(0.0530782192243295, 1.0e-7), DoubleNear(0.04933086018018858, 1.0e-7), DoubleNear(0.05044326838360937, 1.0e-7), DoubleNear(0.06983572316063485, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, true, false}), Matrix({ { 0.29601253968749197 + -4.2825985813177425e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.16653738306514426 + -0.14060579729142786i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.1426222788192406 + -8.084082448595042e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.11614415530079192 + -0.0845585001974056i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.16653738306514426 + 0.14060579729142783i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.39746333857220995 + -3.5236570605778894e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.11614415530079192 + 0.08455850019740563i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.16390184292105733 + -4.1809546276472265e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, true, false}), ElementsAreArray({ DoubleNear(0.29601253968749197, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.1426222788192406, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.39746333857220995, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.16390184292105733, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, true, false, true}), Matrix({ { 0.54689707020533 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.09706422643069644 + -0.026933881591907096i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.23041485884590757 + -8.673617379884035e-18i, 0.0 + 0.0i, -0.09706422643069645 + -0.026933881591907103i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, -0.09706422643069645 + 0.026933881591907093i, 0.0 + 0.0i, 0.14657880805437193 + -8.673617379884035e-19i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.09706422643069645 + 0.026933881591907096i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.07610926289439038 + -3.5914196963582334e-18i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, true, false, true}), ElementsAreArray({ DoubleNear(0.54689707020533, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.23041485884590757, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.14657880805437193, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.07610926289439038, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, true, false, true, true}), Matrix({ { 0.3362257391022145 + -8.673617379884035e-18i, 0.0 + 0.0i, -0.20562133750616704 + -0.19631812535870707i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { -0.20562133750616707 + 0.19631812535870707i, 0.0 + 0.0i, 0.44108618994902304 + -6.938893903907228e-18i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.10240907940451807 + -3.6930636500287495e-18i, 0.0 + 0.0i, -0.07706020085976914 + -0.028846172130126368i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, -0.07706020085976914 + 0.028846172130126392i, 0.0 + 0.0i, 0.12027899154424423 + -7.657177843178875e-19i, 0.0 + 0.0i }, { 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i, 0.0 + 0.0i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, true, false, true, true}), ElementsAreArray({ DoubleNear(0.3362257391022145, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.44108618994902304, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.10240907940451807, 1.0e-7), DoubleNear(0.0, 1.0e-7), DoubleNear(0.12027899154424423, 1.0e-7), DoubleNear(0.0, 1.0e-7) }));

    EXPECT_EQ(s.getReducedDensityMatrix({false, false, false, false, false, true, true, true}), Matrix({ { 0.229011848170169 + -3.469446951953614e-18i, 0.0 + 0.0i, -0.12112025777675148 + -0.1295668942098209i, 0.0 + 0.0i, 0.0 + 0.0i, 0.05009554482055688 + -0.010589295859461445i, 0.0 + 0.0i, -0.05372836397759373 + -0.026741389024649394i }, { 0.0 + 0.0i, 0.10721389093204546 + -5.204170427930421e-18i, 0.0 + 0.0i, -0.08450107972941556 + -0.06675123114888618i, -0.05009554482055688 + -0.010589295859461445i, 0.0 + 0.0i, 0.03682095023723367 + 0.04611386759793525i, 0.0 + 0.0i }, { -0.12112025777675149 + 0.12956689420982087i, 0.0 + 0.0i, 0.31788522203516095 + -3.469446951953614e-18i, 0.0 + 0.0i, 0.0 + 0.0i, -0.036820950237233654 + 0.04611386759793525i, 0.0 + 0.0i, 0.04696868161013956 + -0.01634458573244565i }, { 0.0 + 0.0i, -0.08450107972941556 + 0.0667512311488862i, 0.0 + 0.0i, 0.12320096791386209 + -3.469446951953614e-18i, 0.0537283639775937 + -0.02674138902464939i, 0.0 + 0.0i, -0.046968681610139576 + -0.016344585732445658i, 0.0 + 0.0i }, { 0.0 + 0.0i, -0.05009554482055688 + 0.010589295859461447i, 0.0 + 0.0i, 0.05372836397759372 + 0.026741389024649398i, 0.06700069151732294 + -8.131516293641283e-19i, 0.0 + 0.0i, -0.045417125288392785 + -0.01103890308160695i, 0.0 + 0.0i }, { 0.05009554482055688 + 0.010589295859461448i, 0.0 + 0.0i, -0.03682095023723367 + -0.046113867597935246i, 0.0 + 0.0i, 0.0 + 0.0i, 0.035408387887195136 + -2.879912020664621e-18i, 0.0 + 0.0i, -0.031643075571376356 + -0.017807269048519418i }, { 0.0 + 0.0i, 0.036820950237233654 + -0.04611386759793526i, 0.0 + 0.0i, -0.046968681610139576 + 0.016344585732445648i, -0.045417125288392785 + 0.011038903081606963i, 0.0 + 0.0i, 0.07957811653704899 + -5.421010862427522e-20i, 0.0 + 0.0i }, { -0.053728363977593716 + 0.026741389024649388i, 0.0 + 0.0i, 0.046968681610139576 + 0.016344585732445648i, 0.0 + 0.0i, 0.0 + 0.0i, -0.03164307557137636 + 0.01780726904851943i, 0.0 + 0.0i, 0.040700875007195235 + -7.115076756936123e-19i } }));

    EXPECT_THAT(s.getReducedDensityMatrixDiagonal({false, false, false, false, false, true, true, true}), ElementsAreArray({ DoubleNear(0.229011848170169, 1.0e-7), DoubleNear(0.10721389093204546, 1.0e-7), DoubleNear(0.31788522203516095, 1.0e-7), DoubleNear(0.12320096791386209, 1.0e-7), DoubleNear(0.06700069151732294, 1.0e-7), DoubleNear(0.035408387887195136, 1.0e-7), DoubleNear(0.07957811653704899, 1.0e-7), DoubleNear(0.040700875007195235, 1.0e-7) }));


}
}

}
